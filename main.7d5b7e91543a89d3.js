(self.webpackChunkngx_webrtc=self.webpackChunkngx_webrtc||[]).push([[179],{6:(Ac,Sm,Cm)=>{"use strict";function x(e){return"function"==typeof e}function Dc(e){const t=e(o=>{Error.call(o),o.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const da=Dc(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((o,c)=>`${c+1}) ${o.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function ua(e,i){if(e){const t=e.indexOf(i);0<=t&&e.splice(t,1)}}class Dn{constructor(i){this.initialTeardown=i,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let i;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const u of t)u.remove(this);else t.remove(this);const{initialTeardown:o}=this;if(x(o))try{o()}catch(u){i=u instanceof da?u.errors:[u]}const{_finalizers:c}=this;if(c){this._finalizers=null;for(const u of c)try{Nc(u)}catch(f){i=i??[],f instanceof da?i=[...i,...f.errors]:i.push(f)}}if(i)throw new da(i)}}add(i){var t;if(i&&i!==this)if(this.closed)Nc(i);else{if(i instanceof Dn){if(i.closed||i._hasParent(this))return;i._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(i)}}_hasParent(i){const{_parentage:t}=this;return t===i||Array.isArray(t)&&t.includes(i)}_addParent(i){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(i),t):t?[t,i]:i}_removeParent(i){const{_parentage:t}=this;t===i?this._parentage=null:Array.isArray(t)&&ua(t,i)}remove(i){const{_finalizers:t}=this;t&&ua(t,i),i instanceof Dn&&i._removeParent(this)}}Dn.EMPTY=(()=>{const e=new Dn;return e.closed=!0,e})();const xo=Dn.EMPTY;function Oc(e){return e instanceof Dn||e&&"closed"in e&&x(e.remove)&&x(e.add)&&x(e.unsubscribe)}function Nc(e){x(e)?e():e.unsubscribe()}const Br={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Pc={setTimeout(e,i,...t){const{delegate:o}=Pc;return o?.setTimeout?o.setTimeout(e,i,...t):setTimeout(e,i,...t)},clearTimeout(e){const{delegate:i}=Pc;return(i?.clearTimeout||clearTimeout)(e)},delegate:void 0};function xv(e){Pc.setTimeout(()=>{const{onUnhandledError:i}=Br;if(!i)throw e;i(e)})}function Zh(){}const kv=Tm("C",void 0,void 0);function Tm(e,i,t){return{kind:e,value:i,error:t}}let Mc=null;function ep(e){if(Br.useDeprecatedSynchronousErrorHandling){const i=!Mc;if(i&&(Mc={errorThrown:!1,error:null}),e(),i){const{errorThrown:t,error:o}=Mc;if(Mc=null,t)throw o}}else e()}class wm extends Dn{constructor(i){super(),this.isStopped=!1,i?(this.destination=i,Oc(i)&&i.add(this)):this.destination=U0}static create(i,t,o){return new Vl(i,t,o)}next(i){this.isStopped?Rm(function M0(e){return Tm("N",e,void 0)}(i),this):this._next(i)}error(i){this.isStopped?Rm(function P0(e){return Tm("E",void 0,e)}(i),this):(this.isStopped=!0,this._error(i))}complete(){this.isStopped?Rm(kv,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(i){this.destination.next(i)}_error(i){try{this.destination.error(i)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const k0=Function.prototype.bind;function Im(e,i){return k0.call(e,i)}class L0{constructor(i){this.partialObserver=i}next(i){const{partialObserver:t}=this;if(t.next)try{t.next(i)}catch(o){tp(o)}}error(i){const{partialObserver:t}=this;if(t.error)try{t.error(i)}catch(o){tp(o)}else tp(i)}complete(){const{partialObserver:i}=this;if(i.complete)try{i.complete()}catch(t){tp(t)}}}class Vl extends wm{constructor(i,t,o){let c;if(super(),x(i)||!i)c={next:i??void 0,error:t??void 0,complete:o??void 0};else{let u;this&&Br.useDeprecatedNextContext?(u=Object.create(i),u.unsubscribe=()=>this.unsubscribe(),c={next:i.next&&Im(i.next,u),error:i.error&&Im(i.error,u),complete:i.complete&&Im(i.complete,u)}):c=i}this.destination=new L0(c)}}function tp(e){Br.useDeprecatedSynchronousErrorHandling?function x0(e){Br.useDeprecatedSynchronousErrorHandling&&Mc&&(Mc.errorThrown=!0,Mc.error=e)}(e):xv(e)}function Rm(e,i){const{onStoppedNotification:t}=Br;t&&Pc.setTimeout(()=>t(e,i))}const U0={closed:!0,next:Zh,error:function F0(e){throw e},complete:Zh},np="function"==typeof Symbol&&Symbol.observable||"@@observable";function qa(e){return e}function Lv(e){return 0===e.length?qa:1===e.length?e[0]:function(t){return e.reduce((o,c)=>c(o),t)}}let Ln=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const o=new e;return o.source=this,o.operator=t,o}subscribe(t,o,c){const u=function j0(e){return e&&e instanceof wm||function B0(e){return e&&x(e.next)&&x(e.error)&&x(e.complete)}(e)&&Oc(e)}(t)?t:new Vl(t,o,c);return ep(()=>{const{operator:f,source:g}=this;u.add(f?f.call(u,g):g?this._subscribe(u):this._trySubscribe(u))}),u}_trySubscribe(t){try{return this._subscribe(t)}catch(o){t.error(o)}}forEach(t,o){return new(o=Fv(o))((c,u)=>{const f=new Vl({next:g=>{try{t(g)}catch(y){u(y),f.unsubscribe()}},error:u,complete:c});this.subscribe(f)})}_subscribe(t){var o;return null===(o=this.source)||void 0===o?void 0:o.subscribe(t)}[np](){return this}pipe(...t){return Lv(t)(this)}toPromise(t){return new(t=Fv(t))((o,c)=>{let u;this.subscribe(f=>u=f,f=>c(f),()=>o(u))})}}return e.create=i=>new e(i),e})();function Fv(e){var i;return null!==(i=e??Br.Promise)&&void 0!==i?i:Promise}const H0=Dc(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Gt=(()=>{class e extends Ln{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const o=new Uv(this,this);return o.operator=t,o}_throwIfClosed(){if(this.closed)throw new H0}next(t){ep(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const o of this.currentObservers)o.next(t)}})}error(t){ep(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:o}=this;for(;o.length;)o.shift().error(t)}})}complete(){ep(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:o,isStopped:c,observers:u}=this;return o||c?xo:(this.currentObservers=null,u.push(t),new Dn(()=>{this.currentObservers=null,ua(u,t)}))}_checkFinalizedStatuses(t){const{hasError:o,thrownError:c,isStopped:u}=this;o?t.error(c):u&&t.complete()}asObservable(){const t=new Ln;return t.source=this,t}}return e.create=(i,t)=>new Uv(i,t),e})();class Uv extends Gt{constructor(i,t){super(),this.destination=i,this.source=t}next(i){var t,o;null===(o=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===o||o.call(t,i)}error(i){var t,o;null===(o=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===o||o.call(t,i)}complete(){var i,t;null===(t=null===(i=this.destination)||void 0===i?void 0:i.complete)||void 0===t||t.call(i)}_subscribe(i){var t,o;return null!==(o=null===(t=this.source)||void 0===t?void 0:t.subscribe(i))&&void 0!==o?o:xo}}function Vv(e){return x(e?.lift)}function ti(e){return i=>{if(Vv(i))return i.lift(function(t){try{return e(t,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function Wn(e,i,t,o,c){return new G0(e,i,t,o,c)}class G0 extends wm{constructor(i,t,o,c,u,f){super(i),this.onFinalize=u,this.shouldUnsubscribe=f,this._next=t?function(g){try{t(g)}catch(y){i.error(y)}}:super._next,this._error=c?function(g){try{c(g)}catch(y){i.error(y)}finally{this.unsubscribe()}}:super._error,this._complete=o?function(){try{o()}catch(g){i.error(g)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var i;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(i=this.onFinalize)||void 0===i||i.call(this))}}}function dn(e,i){return ti((t,o)=>{let c=0;t.subscribe(Wn(o,u=>{o.next(e.call(i,u,c++))}))})}function Ms(e){return this instanceof Ms?(this.v=e,this):new Ms(e)}function xm(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e=function rp(e){var i="function"==typeof Symbol&&Symbol.iterator,t=i&&e[i],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(u){t[u]=e[u]&&function(f){return new Promise(function(g,y){!function c(u,f,g,y){Promise.resolve(y).then(function(S){u({value:S,done:g})},f)}(g,y,(f=e[u](f)).done,f.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Gv=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function X0(e){return x(e?.then)}function Ka(e){return x(e[np])}function J0(e){return Symbol.asyncIterator&&x(e?.[Symbol.asyncIterator])}function Q0(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Lm=function Wv(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function sp(e){return x(e?.[Lm])}function Z0(e){return function jv(e,i,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,o=t.apply(e,i||[]),u=[];return c={},f("next"),f("throw"),f("return"),c[Symbol.asyncIterator]=function(){return this},c;function f(B){o[B]&&(c[B]=function(G){return new Promise(function(K,ee){u.push([B,G,K,ee])>1||g(B,G)})})}function g(B,G){try{!function y(B){B.value instanceof Ms?Promise.resolve(B.value.v).then(S,R):k(u[0][2],B)}(o[B](G))}catch(K){k(u[0][3],K)}}function S(B){g("next",B)}function R(B){g("throw",B)}function k(B,G){B(G),u.shift(),u.length&&g(u[0][0],u[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:o,done:c}=yield Ms(t.read());if(c)return yield Ms(void 0);yield yield Ms(o)}}finally{t.releaseLock()}})}function yi(e){return x(e?.getReader)}function xi(e){if(e instanceof Ln)return e;if(null!=e){if(Ka(e))return function ha(e){return new Ln(i=>{const t=e[np]();if(x(t.subscribe))return t.subscribe(i);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Gv(e))return function r1(e){return new Ln(i=>{for(let t=0;t<e.length&&!i.closed;t++)i.next(e[t]);i.complete()})}(e);if(X0(e))return function Fm(e){return new Ln(i=>{e.then(t=>{i.closed||(i.next(t),i.complete())},t=>i.error(t)).then(null,xv)})}(e);if(J0(e))return Um(e);if(sp(e))return function Ir(e){return new Ln(i=>{for(const t of e)if(i.next(t),i.closed)return;i.complete()})}(e);if(yi(e))return function ew(e){return Um(Z0(e))}(e)}throw Q0(e)}function Um(e){return new Ln(i=>{(function tw(e,i){var t,o,c,u;return function Nm(e,i,t,o){return new(t||(t=Promise))(function(u,f){function g(R){try{S(o.next(R))}catch(k){f(k)}}function y(R){try{S(o.throw(R))}catch(k){f(k)}}function S(R){R.done?u(R.value):function c(u){return u instanceof t?u:new t(function(f){f(u)})}(R.value).then(g,y)}S((o=o.apply(e,i||[])).next())})}(this,void 0,void 0,function*(){try{for(t=xm(e);!(o=yield t.next()).done;)if(i.next(o.value),i.closed)return}catch(f){c={error:f}}finally{try{o&&!o.done&&(u=t.return)&&(yield u.call(t))}finally{if(c)throw c.error}}i.complete()})})(e,i).catch(t=>i.error(t))})}function Ya(e,i,t,o=0,c=!1){const u=i.schedule(function(){t(),c?e.add(this.schedule(null,o)):this.unsubscribe()},o);if(e.add(u),!c)return u}function fi(e,i,t=1/0){return x(i)?fi((o,c)=>dn((u,f)=>i(o,u,c,f))(xi(e(o,c))),t):("number"==typeof i&&(t=i),ti((o,c)=>function xc(e,i,t,o,c,u,f,g){const y=[];let S=0,R=0,k=!1;const B=()=>{k&&!y.length&&!S&&i.complete()},G=ee=>S<o?K(ee):y.push(ee),K=ee=>{u&&i.next(ee),S++;let de=!1;xi(t(ee,R++)).subscribe(Wn(i,ve=>{c?.(ve),u?G(ve):i.next(ve)},()=>{de=!0},void 0,()=>{if(de)try{for(S--;y.length&&S<o;){const ve=y.shift();f?Ya(i,f,()=>K(ve)):K(ve)}B()}catch(ve){i.error(ve)}}))};return e.subscribe(Wn(i,G,()=>{k=!0,B()})),()=>{g?.()}}(o,c,e,t)))}function us(e=1/0){return fi(qa,e)}const ks=new Ln(e=>e.complete());function nw(e){return e&&x(e.schedule)}function ap(e){return e[e.length-1]}function cp(e){return x(ap(e))?e.pop():void 0}function lp(e){return nw(ap(e))?e.pop():void 0}function nu(e,i=0){return ti((t,o)=>{t.subscribe(Wn(o,c=>Ya(o,e,()=>o.next(c),i),()=>Ya(o,e,()=>o.complete(),i),c=>Ya(o,e,()=>o.error(c),i)))})}function iw(e,i=0){return ti((t,o)=>{o.add(e.schedule(()=>t.subscribe(o),i))})}function ko(e,i){if(!e)throw new Error("Iterable cannot be null");return new Ln(t=>{Ya(t,i,()=>{const o=e[Symbol.asyncIterator]();Ya(t,i,()=>{o.next().then(c=>{c.done?t.complete():t.next(c.value)})},0,!0)})})}function ki(e,i){return i?function qv(e,i){if(null!=e){if(Ka(e))return function s1(e,i){return xi(e).pipe(iw(i),nu(i))}(e,i);if(Gv(e))return function rw(e,i){return new Ln(t=>{let o=0;return i.schedule(function(){o===e.length?t.complete():(t.next(e[o++]),t.closed||this.schedule())})})}(e,i);if(X0(e))return function Bl(e,i){return xi(e).pipe(iw(i),nu(i))}(e,i);if(J0(e))return ko(e,i);if(sp(e))return function a1(e,i){return new Ln(t=>{let o;return Ya(t,i,()=>{o=e[Lm](),Ya(t,i,()=>{let c,u;try{({value:c,done:u}=o.next())}catch(f){return void t.error(f)}u?t.complete():t.next(c)},0,!0)}),()=>x(o?.return)&&o.return()})}(e,i);if(yi(e))return function jl(e,i){return ko(Z0(e),i)}(e,i)}throw Q0(e)}(e,i):xi(e)}function Kv(...e){const i=lp(e),t=function o1(e,i){return"number"==typeof ap(e)?e.pop():i}(e,1/0),o=e;return o.length?1===o.length?xi(o[0]):us(t)(ki(o,i)):ks}class Rr extends Gt{constructor(i){super(),this._value=i}get value(){return this.getValue()}_subscribe(i){const t=super._subscribe(i);return!t.closed&&i.next(this._value),t}getValue(){const{hasError:i,thrownError:t,_value:o}=this;if(i)throw t;return this._throwIfClosed(),o}next(i){super.next(this._value=i)}}function He(...e){return ki(e,lp(e))}function $a(e={}){const{connector:i=(()=>new Gt),resetOnError:t=!0,resetOnComplete:o=!0,resetOnRefCountZero:c=!0}=e;return u=>{let f,g,y,S=0,R=!1,k=!1;const B=()=>{g?.unsubscribe(),g=void 0},G=()=>{B(),f=y=void 0,R=k=!1},K=()=>{const ee=f;G(),ee?.unsubscribe()};return ti((ee,de)=>{S++,!k&&!R&&B();const ve=y=y??i();de.add(()=>{S--,0===S&&!k&&!R&&(g=Vm(K,c))}),ve.subscribe(de),!f&&S>0&&(f=new Vl({next:ae=>ve.next(ae),error:ae=>{k=!0,B(),g=Vm(G,t,ae),ve.error(ae)},complete:()=>{R=!0,B(),g=Vm(G,o),ve.complete()}}),xi(ee).subscribe(f))})(u)}}function Vm(e,i,...t){if(!0===i)return void e();if(!1===i)return;const o=new Vl({next:()=>{o.unsubscribe(),e()}});return xi(i(...t)).subscribe(o)}function Lo(e,i){return ti((t,o)=>{let c=null,u=0,f=!1;const g=()=>f&&!c&&o.complete();t.subscribe(Wn(o,y=>{c?.unsubscribe();let S=0;const R=u++;xi(e(y,R)).subscribe(c=Wn(o,k=>o.next(i?i(y,k,R,S++):k),()=>{c=null,g()}))},()=>{f=!0,g()}))})}function Yv(e,i=qa){return e=e??ow,ti((t,o)=>{let c,u=!0;t.subscribe(Wn(o,f=>{const g=i(f);(u||!e(c,g))&&(u=!1,c=g,o.next(f))}))})}function ow(e,i){return e===i}function _n(e){for(let i in e)if(e[i]===_n)return i;throw Error("Could not find renamed property on target object.")}function dp(e,i){for(const t in i)i.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=i[t])}function zn(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(zn).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const i=e.toString();if(null==i)return""+i;const t=i.indexOf("\n");return-1===t?i:i.substring(0,t)}function Bm(e,i){return null==e||""===e?null===i?"":i:null==i||""===i?e:e+" "+i}const c1=_n({__forward_ref__:_n});function Cn(e){return e.__forward_ref__=Cn,e.toString=function(){return zn(this())},e}function nt(e){return jm(e)?e():e}function jm(e){return"function"==typeof e&&e.hasOwnProperty(c1)&&e.__forward_ref__===Cn}function $v(e){return e&&!!e.\u0275providers}const sw="https://g.co/ng/security#xss";class ue extends Error{constructor(i,t){super(function kc(e,i){return`NG0${Math.abs(e)}${i?": "+i:""}`}(i,t)),this.code=i}}function _t(e){return"string"==typeof e?e:null==e?"":String(e)}function oo(e,i){throw new ue(-201,!1)}function Uo(e,i){null==e&&function tt(e,i,t,o){throw new Error(`ASSERTION ERROR: ${e}`+(null==o?"":` [Expected=> ${t} ${o} ${i} <=Actual]`))}(i,e,null,"!=")}function Me(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function St(e){return{providers:e.providers||[],imports:e.imports||[]}}function Hm(e){return uw(e,Gm)||uw(e,hw)}function uw(e,i){return e.hasOwnProperty(i)?e[i]:null}function ru(e){return e&&(e.hasOwnProperty(Wm)||e.hasOwnProperty(_1))?e[Wm]:null}const Gm=_n({\u0275prov:_n}),Wm=_n({\u0275inj:_n}),hw=_n({ngInjectableDef:_n}),_1=_n({ngInjectorDef:_n});var Ft=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Ft||{});let Lc;function so(e){const i=Lc;return Lc=e,i}function qn(e,i,t){const o=Hm(e);return o&&"root"==o.providedIn?void 0===o.value?o.value=o.factory():o.value:t&Ft.Optional?null:void 0!==i?i:void oo(zn(e))}const On=globalThis,su={},ey="__NG_DI_FLAG__",qm="ngTempTokenPath",b1=/\n/gm,_w="__source";let au;function Ja(e){const i=au;return au=e,i}function T1(e,i=Ft.Default){if(void 0===au)throw new ue(-203,!1);return null===au?qn(e,void 0,i):au.get(e,i&Ft.Optional?null:void 0,i)}function pe(e,i=Ft.Default){return(function zm(){return Lc}()||T1)(nt(e),i)}function Oe(e,i=Ft.Default){return pe(e,Km(i))}function Km(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function ty(e){const i=[];for(let t=0;t<e.length;t++){const o=nt(e[t]);if(Array.isArray(o)){if(0===o.length)throw new ue(900,!1);let c,u=Ft.Default;for(let f=0;f<o.length;f++){const g=o[f],y=w1(g);"number"==typeof y?-1===y?c=g.token:u|=y:c=g}i.push(pe(c,u))}else i.push(pe(o))}return i}function up(e,i){return e[ey]=i,e.prototype[ey]=i,e}function w1(e){return e[ey]}function Qa(e){return{toString:e}.toString()}var Ym=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(Ym||{}),Ar=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(Ar||{});const bi={},Zt=[],$m=_n({\u0275cmp:_n}),ny=_n({\u0275dir:_n}),iy=_n({\u0275pipe:_n}),hs=_n({\u0275mod:_n}),Za=_n({\u0275fac:_n}),hp=_n({__NG_ELEMENT_ID__:_n}),vw=_n({__NG_ENV_ID__:_n});function pp(e,i,t){let o=e.length;for(;;){const c=e.indexOf(i,t);if(-1===c)return c;if(0===c||e.charCodeAt(c-1)<=32){const u=i.length;if(c+u===o||e.charCodeAt(c+u)<=32)return c}t=c+1}}function Xm(e,i,t){let o=0;for(;o<t.length;){const c=t[o];if("number"==typeof c){if(0!==c)break;o++;const u=t[o++],f=t[o++],g=t[o++];e.setAttribute(i,f,g,u)}else{const u=c,f=t[++o];Jm(u)?e.setProperty(i,u,f):e.setAttribute(i,u,f),o++}}return o}function yw(e){return 3===e||4===e||6===e}function Jm(e){return 64===e.charCodeAt(0)}function fp(e,i){if(null!==i&&0!==i.length)if(null===e||0===e.length)e=i.slice();else{let t=-1;for(let o=0;o<i.length;o++){const c=i[o];"number"==typeof c?t=c:0===t||Qm(e,t,c,null,-1===t||2===t?i[++o]:null)}}return e}function Qm(e,i,t,o,c){let u=0,f=e.length;if(-1===i)f=-1;else for(;u<e.length;){const g=e[u++];if("number"==typeof g){if(g===i){f=-1;break}if(g>i){f=u-1;break}}}for(;u<e.length;){const g=e[u];if("number"==typeof g)break;if(g===t){if(null===o)return void(null!==c&&(e[u+1]=c));if(o===e[u+1])return void(e[u+2]=c)}u++,null!==o&&u++,null!==c&&u++}-1!==f&&(e.splice(f,0,i),u=f+1),e.splice(u++,0,t),null!==o&&e.splice(u++,0,o),null!==c&&e.splice(u++,0,c)}const Zm="ng-template";function ry(e,i,t){let o=0,c=!0;for(;o<e.length;){let u=e[o++];if("string"==typeof u&&c){const f=e[o++];if(t&&"class"===u&&-1!==pp(f.toLowerCase(),i,0))return!0}else{if(1===u){for(;o<e.length&&"string"==typeof(u=e[o++]);)if(u.toLowerCase()===i)return!0;return!1}"number"==typeof u&&(c=!1)}}return!1}function bw(e){return 4===e.type&&e.value!==Zm}function R1(e,i,t){return i===(4!==e.type||t?e.value:Zm)}function Fc(e,i,t){let o=4;const c=e.attrs||[],u=function O1(e){for(let i=0;i<e.length;i++)if(yw(e[i]))return i;return e.length}(c);let f=!1;for(let g=0;g<i.length;g++){const y=i[g];if("number"!=typeof y){if(!f)if(4&o){if(o=2|1&o,""!==y&&!R1(e,y,t)||""===y&&1===i.length){if(ao(o))return!1;f=!0}}else{const S=8&o?y:i[++g];if(8&o&&null!==e.attrs){if(!ry(e.attrs,S,t)){if(ao(o))return!1;f=!0}continue}const k=A1(8&o?"class":y,c,bw(e),t);if(-1===k){if(ao(o))return!1;f=!0;continue}if(""!==S){let B;B=k>u?"":c[k+1].toLowerCase();const G=8&o?B:null;if(G&&-1!==pp(G,S,0)||2&o&&S!==B){if(ao(o))return!1;f=!0}}}}else{if(!f&&!ao(o)&&!ao(y))return!1;if(f&&ao(y))continue;f=!1,o=y|1&o}}return ao(o)||f}function ao(e){return 0==(1&e)}function A1(e,i,t,o){if(null===i)return-1;let c=0;if(o||!t){let u=!1;for(;c<i.length;){const f=i[c];if(f===e)return c;if(3===f||6===f)u=!0;else{if(1===f||2===f){let g=i[++c];for(;"string"==typeof g;)g=i[++c];continue}if(4===f)break;if(0===f){c+=4;continue}}c+=u?1:2}return-1}return function N1(e,i){let t=e.indexOf(4);if(t>-1)for(t++;t<e.length;){const o=e[t];if("number"==typeof o)return-1;if(o===i)return t;t++}return-1}(i,e)}function Sw(e,i,t=!1){for(let o=0;o<i.length;o++)if(Fc(e,i[o],t))return!0;return!1}function cu(e,i){e:for(let t=0;t<i.length;t++){const o=i[t];if(e.length===o.length){for(let c=0;c<e.length;c++)if(e[c]!==o[c])continue e;return!0}}return!1}function Cw(e,i){return e?":not("+i.trim()+")":i}function lu(e){let i=e[0],t=1,o=2,c="",u=!1;for(;t<e.length;){let f=e[t];if("string"==typeof f)if(2&o){const g=e[++t];c+="["+f+(g.length>0?'="'+g+'"':"")+"]"}else 8&o?c+="."+f:4&o&&(c+=" "+f);else""!==c&&!ao(f)&&(i+=Cw(u,c),c=""),o=f,u=u||!ao(o);t++}return""!==c&&(i+=Cw(u,c)),i}function Ct(e){return Qa(()=>{const i=Iw(e),t={...i,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===Ym.OnPush,directiveDefs:null,pipeDefs:null,dependencies:i.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||Ar.Emulated,styles:e.styles||Zt,_:null,schemas:e.schemas||null,tView:null,id:""};Rw(t);const o=e.dependencies;return t.directiveDefs=mp(o,!1),t.pipeDefs=mp(o,!0),t.id=function F1(e){let i=0;const t=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const c of t)i=Math.imul(31,i)+c.charCodeAt(0)<<0;return i+=2147483648,"c"+i}(t),t})}function x1(e){return $t(e)||lr(e)}function k1(e){return null!==e}function yn(e){return Qa(()=>({type:e.type,bootstrap:e.bootstrap||Zt,declarations:e.declarations||Zt,imports:e.imports||Zt,exports:e.exports||Zt,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function ww(e,i){if(null==e)return bi;const t={};for(const o in e)if(e.hasOwnProperty(o)){let c=e[o],u=c;Array.isArray(c)&&(u=c[1],c=c[0]),t[c]=o,i&&(i[c]=u)}return t}function Ge(e){return Qa(()=>{const i=Iw(e);return Rw(i),i})}function jr(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function $t(e){return e[$m]||null}function lr(e){return e[ny]||null}function Hr(e){return e[iy]||null}function Vo(e,i){const t=e[hs]||null;if(!t&&!0===i)throw new Error(`Type ${zn(e)} does not have '\u0275mod' property.`);return t}function Iw(e){const i={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:i,inputTransforms:null,inputConfig:e.inputs||bi,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||Zt,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:ww(e.inputs,i),outputs:ww(e.outputs)}}function Rw(e){e.features?.forEach(i=>i(e))}function mp(e,i){if(!e)return null;const t=i?Hr:x1;return()=>("function"==typeof e?e():e).map(o=>t(o)).filter(k1)}const mi=0,ke=1,Tt=2,Qn=3,Ls=4,_p=5,Dr=6,du=7,_i=8,pa=9,uu=10,gt=11,Uc=12,Dw=13,hu=14,Si=15,Fs=16,pu=17,fa=18,Bo=19,Ow=20,Vc=21,ec=22,gp=23,fu=24,Ut=25,oy=1,sy=2,ma=7,Bc=9,ye=11;function co(e){return Array.isArray(e)&&"object"==typeof e[oy]}function Gr(e){return Array.isArray(e)&&!0===e[oy]}function t_(e){return 0!=(4&e.flags)}function jc(e){return e.componentOffset>-1}function n_(e){return 1==(1&e.flags)}function Us(e){return!!e.template}function ay(e){return 0!=(512&e[Tt])}function Hc(e,i){return e.hasOwnProperty(Za)?e[Za]:null}let dr=null,o_=!1;function jo(e){const i=dr;return dr=e,i}const Pw={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function Mw(e){if(!mu(e)||e.dirty){if(!e.producerMustRecompute(e)&&!Lw(e))return void(e.dirty=!1);e.producerRecomputeValue(e),e.dirty=!1}}function kw(e){e.dirty=!0,function xw(e){if(void 0===e.liveConsumerNode)return;const i=o_;o_=!0;try{for(const t of e.liveConsumerNode)t.dirty||kw(t)}finally{o_=i}}(e),e.consumerMarkedDirty?.(e)}function hy(e){return e&&(e.nextProducerIndex=0),jo(e)}function py(e,i){if(jo(i),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(mu(e))for(let t=e.nextProducerIndex;t<e.producerNode.length;t++)Ep(e.producerNode[t],e.producerIndexOfThis[t]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function Lw(e){_u(e);for(let i=0;i<e.producerNode.length;i++){const t=e.producerNode[i],o=e.producerLastReadVersion[i];if(o!==t.version||(Mw(t),o!==t.version))return!0}return!1}function Fw(e){if(_u(e),mu(e))for(let i=0;i<e.producerNode.length;i++)Ep(e.producerNode[i],e.producerIndexOfThis[i]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function Ep(e,i){if(function Vw(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}(e),_u(e),1===e.liveConsumerNode.length)for(let o=0;o<e.producerNode.length;o++)Ep(e.producerNode[o],e.producerIndexOfThis[o]);const t=e.liveConsumerNode.length-1;if(e.liveConsumerNode[i]=e.liveConsumerNode[t],e.liveConsumerIndexOfThis[i]=e.liveConsumerIndexOfThis[t],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,i<e.liveConsumerNode.length){const o=e.liveConsumerIndexOfThis[i],c=e.liveConsumerNode[i];_u(c),c.producerIndexOfThis[o]=i}}function mu(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function _u(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}let s_=null;function Gw(e){const i=jo(null);try{return e()}finally{jo(i)}}const Ww=()=>{},tM=(()=>({...Pw,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:e=>{e.schedule(e.ref)},hasRun:!1,cleanupFn:Ww}))();class zw{constructor(i,t,o){this.previousValue=i,this.currentValue=t,this.firstChange=o}isFirstChange(){return this.firstChange}}function Ho(){return yy}function yy(e){return e.type.prototype.ngOnChanges&&(e.setInput=nM),a_}function a_(){const e=by(this),i=e?.current;if(i){const t=e.previous;if(t===bi)e.previous=i;else for(let o in i)t[o]=i[o];e.current=null,this.ngOnChanges(i)}}function nM(e,i,t,o){const c=this.declaredInputs[t],u=by(e)||function iM(e,i){return e[qw]=i}(e,{previous:bi,current:null}),f=u.current||(u.current={}),g=u.previous,y=g[c];f[c]=new zw(y&&y.currentValue,i,g===bi),e[o]=i}Ho.ngInherit=!0;const qw="__ngSimpleChanges__";function by(e){return e[qw]||null}const fs=function(e,i,t){},c_="svg";function Tn(e){for(;Array.isArray(e);)e=e[mi];return e}function vp(e,i){return Tn(i[e])}function ur(e,i){return Tn(i[e.index])}function yp(e,i){return e.data[i]}function gu(e,i){return e[i]}function Go(e,i){const t=i[e];return co(t)?t:t[mi]}function Gc(e,i){return null==i?null:e[i]}function $w(e){e[pu]=0}function sM(e){1024&e[Tt]||(e[Tt]|=1024,Xw(e,1))}function Ty(e){1024&e[Tt]&&(e[Tt]&=-1025,Xw(e,-1))}function Xw(e,i){let t=e[Qn];if(null===t)return;t[_p]+=i;let o=t;for(t=t[Qn];null!==t&&(1===i&&1===o[_p]||-1===i&&0===o[_p]);)t[_p]+=i,o=t,t=t[Qn]}const ct={lFrame:oI(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Ry(){return ct.bindingsEnabled}function Vs(){return null!==ct.skipHydrationRootTNode}function be(){return ct.lFrame.lView}function Xt(){return ct.lFrame.tView}function _a(e){return ct.lFrame.contextLView=e,e[_i]}function un(e){return ct.lFrame.contextLView=null,e}function hr(){let e=eI();for(;null!==e&&64===e.type;)e=e.parent;return e}function eI(){return ct.lFrame.currentTNode}function ga(e,i){const t=ct.lFrame;t.currentTNode=e,t.isParent=i}function p_(){return ct.lFrame.isParent}function Ay(){ct.lFrame.isParent=!1}function Wr(){const e=ct.lFrame;let i=e.bindingRootIndex;return-1===i&&(i=e.bindingRootIndex=e.tView.bindingStartIndex),i}function Gl(){return ct.lFrame.bindingIndex++}function hM(e,i){const t=ct.lFrame;t.bindingIndex=t.bindingRootIndex=e,Oy(i)}function Oy(e){ct.lFrame.currentDirectiveIndex=e}function f_(){return ct.lFrame.currentQueryIndex}function Tp(e){ct.lFrame.currentQueryIndex=e}function pM(e){const i=e[ke];return 2===i.type?i.declTNode:1===i.type?e[Dr]:null}function rI(e,i,t){if(t&Ft.SkipSelf){let c=i,u=e;for(;!(c=c.parent,null!==c||t&Ft.Host||(c=pM(u),null===c||(u=u[hu],10&c.type))););if(null===c)return!1;i=c,e=u}const o=ct.lFrame=__();return o.currentTNode=i,o.lView=e,!0}function m_(e){const i=__(),t=e[ke];ct.lFrame=i,i.currentTNode=t.firstChild,i.lView=e,i.tView=t,i.contextLView=e,i.bindingIndex=t.bindingStartIndex,i.inI18n=!1}function __(){const e=ct.lFrame,i=null===e?null:e.child;return null===i?oI(e):i}function oI(e){const i={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=i),i}function Bs(){const e=ct.lFrame;return ct.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Wl=Bs;function Eu(){const e=Bs();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function zr(){return ct.lFrame.selectedIndex}function zl(e){ct.lFrame.selectedIndex=e}function ii(){const e=ct.lFrame;return yp(e.tView,e.selectedIndex)}function Wo(){ct.lFrame.currentNamespace=c_}function ic(){!function g_(){ct.lFrame.currentNamespace=null}()}let v_=!0;function y_(){return v_}function zo(e){v_=e}function b_(e,i){for(let t=i.directiveStart,o=i.directiveEnd;t<o;t++){const u=e.data[t].type.prototype,{ngAfterContentInit:f,ngAfterContentChecked:g,ngAfterViewInit:y,ngAfterViewChecked:S,ngOnDestroy:R}=u;f&&(e.contentHooks??=[]).push(-t,f),g&&((e.contentHooks??=[]).push(t,g),(e.contentCheckHooks??=[]).push(t,g)),y&&(e.viewHooks??=[]).push(-t,y),S&&((e.viewHooks??=[]).push(t,S),(e.viewCheckHooks??=[]).push(t,S)),null!=R&&(e.destroyHooks??=[]).push(t,R)}}function Ci(e,i,t){Ip(e,i,3,t)}function S_(e,i,t,o){(3&e[Tt])===t&&Ip(e,i,t,o)}function wp(e,i){let t=e[Tt];(3&t)===i&&(t&=8191,t+=1,e[Tt]=t)}function Ip(e,i,t,o){const u=o??-1,f=i.length-1;let g=0;for(let y=void 0!==o?65535&e[pu]:0;y<f;y++)if("number"==typeof i[y+1]){if(g=i[y],null!=o&&g>=o)break}else i[y]<0&&(e[pu]+=65536),(g<u||-1==u)&&(_M(e,t,i,y),e[pu]=(4294901760&e[pu])+y+2),y++}function C_(e,i){fs(4,e,i);const t=jo(null);try{i.call(e)}finally{jo(t),fs(5,e,i)}}function _M(e,i,t,o){const c=t[o]<0,u=t[o+1],g=e[c?-t[o]:t[o]];c?e[Tt]>>13<e[pu]>>16&&(3&e[Tt])===i&&(e[Tt]+=8192,C_(g,u)):C_(g,u)}const zc=-1;class rc{constructor(i,t,o){this.factory=i,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=o}}function w_(e){return e!==zc}function Rp(e){return 32767&e}function yu(e,i){let t=function Py(e){return e>>16}(e),o=i;for(;t>0;)o=o[hu],t--;return o}let I_=!0;function R_(e){const i=I_;return I_=e,i}const lI=255,dI=5;let EM=0;const js={};function pr(e,i){const t=Su(e,i);if(-1!==t)return t;const o=i[ke];o.firstCreatePass&&(e.injectorIndex=i.length,bu(o.data,e),bu(i,null),bu(o.blueprint,null));const c=D_(e,i),u=e.injectorIndex;if(w_(c)){const f=Rp(c),g=yu(c,i),y=g[ke].data;for(let S=0;S<8;S++)i[u+S]=g[f+S]|y[f+S]}return i[u+8]=c,u}function bu(e,i){e.push(0,0,0,0,0,0,0,0,i)}function Su(e,i){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===i[e.injectorIndex+8]?-1:e.injectorIndex}function D_(e,i){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let t=0,o=null,c=i;for(;null!==c;){if(o=Ly(c),null===o)return zc;if(t++,c=c[hu],-1!==o.injectorIndex)return o.injectorIndex|t<<16}return zc}function O_(e,i,t){!function A_(e,i,t){let o;"string"==typeof t?o=t.charCodeAt(0)||0:t.hasOwnProperty(hp)&&(o=t[hp]),null==o&&(o=t[hp]=EM++);const c=o&lI;i.data[e+(c>>dI)]|=1<<c}(e,i,t)}function qc(e,i,t){if(t&Ft.Optional||void 0!==e)return e;oo()}function Ap(e,i,t,o){if(t&Ft.Optional&&void 0===o&&(o=null),!(t&(Ft.Self|Ft.Host))){const c=e[pa],u=so(void 0);try{return c?c.get(i,o,t&Ft.Optional):qn(i,o,t&Ft.Optional)}finally{so(u)}}return qc(o,0,t)}function uI(e,i,t,o=Ft.Default,c){if(null!==e){if(2048&i[Tt]&&!(o&Ft.Self)){const f=function ky(e,i,t,o,c){let u=e,f=i;for(;null!==u&&null!==f&&2048&f[Tt]&&!(512&f[Tt]);){const g=N_(u,f,t,o|Ft.Self,js);if(g!==js)return g;let y=u.parent;if(!y){const S=f[Ow];if(S){const R=S.get(t,js,o);if(R!==js)return R}y=Ly(f),f=f[hu]}u=y}return c}(e,i,t,o,js);if(f!==js)return f}const u=N_(e,i,t,o,js);if(u!==js)return u}return Ap(i,t,o,c)}function N_(e,i,t,o,c){const u=function vM(e){if("string"==typeof e)return e.charCodeAt(0)||0;const i=e.hasOwnProperty(hp)?e[hp]:void 0;return"number"==typeof i?i>=0?i&lI:xy:i}(t);if("function"==typeof u){if(!rI(i,e,o))return o&Ft.Host?qc(c,0,o):Ap(i,t,o,c);try{let f;if(f=u(o),null!=f||o&Ft.Optional)return f;oo()}finally{Wl()}}else if("number"==typeof u){let f=null,g=Su(e,i),y=zc,S=o&Ft.Host?i[Si][Dr]:null;for((-1===g||o&Ft.SkipSelf)&&(y=-1===g?D_(e,i):i[g+8],y!==zc&&va(o,!1)?(f=i[ke],g=Rp(y),i=yu(y,i)):g=-1);-1!==g;){const R=i[ke];if(My(u,g,R.data)){const k=hI(g,i,t,f,o,S);if(k!==js)return k}y=i[g+8],y!==zc&&va(o,i[ke].data[g+8]===S)&&My(u,g,i)?(f=R,g=Rp(y),i=yu(y,i)):g=-1}}return c}function hI(e,i,t,o,c,u){const f=i[ke],g=f.data[e+8],R=Ea(g,f,t,null==o?jc(g)&&I_:o!=f&&0!=(3&g.type),c&Ft.Host&&u===g);return null!==R?Kc(i,f,R,g):js}function Ea(e,i,t,o,c){const u=e.providerIndexes,f=i.data,g=1048575&u,y=e.directiveStart,R=u>>20,B=c?g+R:e.directiveEnd;for(let G=o?g:g+R;G<B;G++){const K=f[G];if(G<y&&t===K||G>=y&&K.type===t)return G}if(c){const G=f[y];if(G&&Us(G)&&G.type===t)return y}return null}function Kc(e,i,t,o){let c=e[t];const u=i.data;if(function sI(e){return e instanceof rc}(c)){const f=c;f.resolving&&function l1(e,i){const t=i?`. Dependency path: ${i.join(" > ")} > ${e}`:"";throw new ue(-200,`Circular dependency in DI detected for ${e}${t}`)}(function Wt(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():_t(e)}(u[t]));const g=R_(f.canSeeViewProviders);f.resolving=!0;const S=f.injectImpl?so(f.injectImpl):null;rI(e,o,Ft.Default);try{c=e[t]=f.factory(void 0,u,e,o),i.firstCreatePass&&t>=o.directiveStart&&function vu(e,i,t){const{ngOnChanges:o,ngOnInit:c,ngDoCheck:u}=i.type.prototype;if(o){const f=yy(i);(t.preOrderHooks??=[]).push(e,f),(t.preOrderCheckHooks??=[]).push(e,f)}c&&(t.preOrderHooks??=[]).push(0-e,c),u&&((t.preOrderHooks??=[]).push(e,u),(t.preOrderCheckHooks??=[]).push(e,u))}(t,u[t],i)}finally{null!==S&&so(S),R_(g),f.resolving=!1,Wl()}}return c}function My(e,i,t){return!!(t[i+(e>>dI)]&1<<e)}function va(e,i){return!(e&Ft.Self||e&Ft.Host&&i)}class fr{constructor(i,t){this._tNode=i,this._lView=t}get(i,t,o){return uI(this._tNode,this._lView,i,Km(o),t)}}function xy(){return new fr(hr(),be())}function Ti(e){return Qa(()=>{const i=e.prototype.constructor,t=i[Za]||Cu(i),o=Object.prototype;let c=Object.getPrototypeOf(e.prototype).constructor;for(;c&&c!==o;){const u=c[Za]||Cu(c);if(u&&u!==t)return u;c=Object.getPrototypeOf(c)}return u=>new u})}function Cu(e){return jm(e)?()=>{const i=Cu(nt(e));return i&&i()}:Hc(e)}function Ly(e){const i=e[ke],t=i.type;return 2===t?i.declTNode:1===t?e[Dr]:null}const Kl="__parameters__";function wu(e,i,t){return Qa(()=>{const o=function Fy(e){return function(...t){if(e){const o=e(...t);for(const c in o)this[c]=o[c]}}}(i);function c(...u){if(this instanceof c)return o.apply(this,u),this;const f=new c(...u);return g.annotation=f,g;function g(y,S,R){const k=y.hasOwnProperty(Kl)?y[Kl]:Object.defineProperty(y,Kl,{value:[]})[Kl];for(;k.length<=R;)k.push(null);return(k[R]=k[R]||[]).push(f),y}}return t&&(c.prototype=Object.create(t.prototype)),c.prototype.ngMetadataName=e,c.annotationCls=c,c})}function $l(e,i){e.forEach(t=>Array.isArray(t)?$l(t,i):i(t))}function vI(e,i,t){i>=e.length?e.push(t):e.splice(i,0,t)}function Op(e,i){return i>=e.length-1?e.pop():e.splice(i,1)[0]}function Ru(e,i){const t=[];for(let o=0;o<e;o++)t.push(i);return t}function uo(e,i,t){let o=Au(e,i);return o>=0?e[1|o]=t:(o=~o,function yI(e,i,t,o){let c=e.length;if(c==i)e.push(t,o);else if(1===c)e.push(o,e[0]),e[0]=t;else{for(c--,e.push(e[c-1],e[c]);c>i;)e[c]=e[c-2],c--;e[i]=t,e[i+1]=o}}(e,o,i,t)),o}function M_(e,i){const t=Au(e,i);if(t>=0)return e[1|t]}function Au(e,i){return function bI(e,i,t){let o=0,c=e.length>>t;for(;c!==o;){const u=o+(c-o>>1),f=e[u<<t];if(i===f)return u<<t;f>i?c=u:o=u+1}return~(c<<t)}(e,i,1)}const Pp=up(wu("Optional"),8),k_=up(wu("SkipSelf"),4);function j_(e){return 128==(128&e.flags)}var $c=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}($c||{});const FM=/^>|^->|<!--|-->|--!>|<!-$/g,UM=/(<|>)/g,VM="\u200b$1\u200b";const qy=new Map;let BM=0;const Nu="__ngContext__";function er(e,i){co(i)?(e[Nu]=i[Bo],function HM(e){qy.set(e[Bo],e)}(i)):e[Nu]=i}let G_;function Jy(e,i){return G_(e,i)}function kp(e){const i=e[Qn];return Gr(i)?i[Qn]:i}function zI(e){return Zy(e[Uc])}function Qy(e){return Zy(e[Ls])}function Zy(e){for(;null!==e&&!Gr(e);)e=e[Ls];return e}function Xc(e,i,t,o,c){if(null!=o){let u,f=!1;Gr(o)?u=o:co(o)&&(f=!0,o=o[mi]);const g=Tn(o);0===e&&null!==t?null==c?rb(i,t,g):ya(i,t,g,c||null,!0):1===e&&null!==t?ya(i,t,g,c||null,!0):2===e?function Up(e,i,t){const o=Mu(e,i);o&&function ZM(e,i,t,o){e.removeChild(i,t,o)}(e,o,i,t)}(i,g,f):3===e&&i.destroyNode(g),null!=u&&function nx(e,i,t,o,c){const u=t[ma];u!==Tn(t)&&Xc(i,e,o,u,c);for(let g=ye;g<t.length;g++){const y=t[g];Vp(y[ke],y,e,i,o,u)}}(i,e,u,t,c)}}function eb(e,i){return e.createComment(function FI(e){return e.replace(FM,i=>i.replace(UM,VM))}(i))}function z_(e,i,t){return e.createElement(i,t)}function YI(e,i){const t=e[Bc],o=t.indexOf(i);Ty(i),t.splice(o,1)}function q_(e,i){if(e.length<=ye)return;const t=ye+i,o=e[t];if(o){const c=o[Fs];null!==c&&c!==e&&YI(c,o),i>0&&(e[t-1][Ls]=o[Ls]);const u=Op(e,ye+i);!function $M(e,i){Vp(e,i,i[gt],2,null,null),i[mi]=null,i[Dr]=null}(o[ke],o);const f=u[fa];null!==f&&f.detachView(u[ke]),o[Qn]=null,o[Ls]=null,o[Tt]&=-129}return o}function K_(e,i){if(!(256&i[Tt])){const t=i[gt];i[gp]&&Fw(i[gp]),i[fu]&&Fw(i[fu]),t.destroyNode&&Vp(e,i,t,3,null,null),function XM(e){let i=e[Uc];if(!i)return nb(e[ke],e);for(;i;){let t=null;if(co(i))t=i[Uc];else{const o=i[ye];o&&(t=o)}if(!t){for(;i&&!i[Ls]&&i!==e;)co(i)&&nb(i[ke],i),i=i[Qn];null===i&&(i=e),co(i)&&nb(i[ke],i),t=i&&i[Ls]}i=t}}(i)}}function nb(e,i){if(!(256&i[Tt])){i[Tt]&=-129,i[Tt]|=256,function QM(e,i){let t;if(null!=e&&null!=(t=e.destroyHooks))for(let o=0;o<t.length;o+=2){const c=i[t[o]];if(!(c instanceof rc)){const u=t[o+1];if(Array.isArray(u))for(let f=0;f<u.length;f+=2){const g=c[u[f]],y=u[f+1];fs(4,g,y);try{y.call(g)}finally{fs(5,g,y)}}else{fs(4,c,u);try{u.call(c)}finally{fs(5,c,u)}}}}}(e,i),function $I(e,i){const t=e.cleanup,o=i[du];if(null!==t)for(let u=0;u<t.length-1;u+=2)if("string"==typeof t[u]){const f=t[u+3];f>=0?o[f]():o[-f].unsubscribe(),u+=2}else t[u].call(o[t[u+1]]);null!==o&&(i[du]=null);const c=i[Vc];if(null!==c){i[Vc]=null;for(let u=0;u<c.length;u++)(0,c[u])()}}(e,i),1===i[ke].type&&i[gt].destroy();const t=i[Fs];if(null!==t&&Gr(i[Qn])){t!==i[Qn]&&YI(t,i);const o=i[fa];null!==o&&o.detachView(e)}!function GM(e){qy.delete(e[Bo])}(i)}}function ib(e,i,t){return function XI(e,i,t){let o=i;for(;null!==o&&40&o.type;)o=(i=o).parent;if(null===o)return t[mi];{const{componentOffset:c}=o;if(c>-1){const{encapsulation:u}=e.data[o.directiveStart+c];if(u===Ar.None||u===Ar.Emulated)return null}return ur(o,t)}}(e,i.parent,t)}function ya(e,i,t,o,c){e.insertBefore(i,t,o,c)}function rb(e,i,t){e.appendChild(i,t)}function ob(e,i,t,o,c){null!==o?ya(e,i,t,o,c):rb(e,i,t)}function Mu(e,i){return e.parentNode(i)}function QI(e,i,t){return ab(e,i,t)}let Jc,db,ab=function sb(e,i,t){return 40&e.type?ur(e,t):null};function $_(e,i,t,o){const c=ib(e,o,i),u=i[gt],g=QI(o.parent||i[Dr],o,i);if(null!=c)if(Array.isArray(t))for(let y=0;y<t.length;y++)ob(u,c,t[y],g,!1);else ob(u,c,t,g,!1);void 0!==Jc&&Jc(u,o,i,t,c)}function Fp(e,i){if(null!==i){const t=i.type;if(3&t)return ur(i,e);if(4&t)return cb(-1,e[i.index]);if(8&t){const o=i.child;if(null!==o)return Fp(e,o);{const c=e[i.index];return Gr(c)?cb(-1,c):Tn(c)}}if(32&t)return Jy(i,e)()||Tn(e[i.index]);{const o=ZI(e,i);return null!==o?Array.isArray(o)?o[0]:Fp(kp(e[Si]),o):Fp(e,i.next)}}return null}function ZI(e,i){return null!==i?e[Si][Dr].projection[i.projection]:null}function cb(e,i){const t=ye+e+1;if(t<i.length){const o=i[t],c=o[ke].firstChild;if(null!==c)return Fp(o,c)}return i[ma]}function X_(e,i,t,o,c,u,f){for(;null!=t;){const g=o[t.index],y=t.type;if(f&&0===i&&(g&&er(Tn(g),o),t.flags|=2),32!=(32&t.flags))if(8&y)X_(e,i,t.child,o,c,u,!1),Xc(i,e,c,g,u);else if(32&y){const S=Jy(t,o);let R;for(;R=S();)Xc(i,e,c,R,u);Xc(i,e,c,g,u)}else 16&y?lb(e,i,o,t,c,u):Xc(i,e,c,g,u);t=f?t.projectionNext:t.next}}function Vp(e,i,t,o,c,u){X_(t,o,e.firstChild,i,c,u,!1)}function lb(e,i,t,o,c,u){const f=t[Si],y=f[Dr].projection[o.projection];if(Array.isArray(y))for(let S=0;S<y.length;S++)Xc(i,e,c,y[S],u);else{let S=y;const R=f[Qn];j_(o)&&(S.flags|=128),X_(e,i,S,R,c,u,!0)}}function iR(e,i,t){""===t?e.removeAttribute(i,"class"):e.setAttribute(i,"class",t)}function rR(e,i,t){const{mergedAttrs:o,classes:c,styles:u}=t;null!==o&&Xm(e,i,o),null!==c&&iR(e,i,c),null!==u&&function nR(e,i,t){e.setAttribute(i,"style",t)}(e,i,u)}class pb{constructor(i){this.changingThisBreaksApplicationSecurity=i}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${sw})`}}function Qc(e){return e instanceof pb?e.changingThisBreaksApplicationSecurity:e}const px=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Uu=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(Uu||{});function eg(e){const i=function Vu(){const e=be();return e&&e[uu].sanitizer}();return i?i.sanitize(Uu.URL,e)||"":function Fu(e,i){const t=function sR(e){return e instanceof pb&&e.getTypeName()||null}(e);if(null!=t&&t!==i){if("ResourceURL"===t&&"URL"===i)return!0;throw new Error(`Required a safe ${i}, got a ${t} (see ${sw})`)}return t===i}(e,"URL")?Qc(e):function J_(e){return(e=String(e)).match(px)?e:"unsafe:"+e}(_t(e))}class De{constructor(i,t){this._desc=i,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Me({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Hp=new De("ENVIRONMENT_INITIALIZER"),pR=new De("INJECTOR",-1),fR=new De("INJECTOR_DEF_TYPES");class yb{get(i,t=su){if(t===su){const o=new Error(`NullInjectorError: No provider for ${zn(i)}!`);throw o.name="NullInjectorError",o}return t}}function _R(...e){return{\u0275providers:gR(0,e),\u0275fromNgModule:!0}}function gR(e,...i){const t=[],o=new Set;let c;const u=f=>{t.push(f)};return $l(i,f=>{const g=f;tg(g,u,[],o)&&(c||=[],c.push(g))}),void 0!==c&&ER(c,u),t}function ER(e,i){for(let t=0;t<e.length;t++){const{ngModule:o,providers:c}=e[t];ng(c,u=>{i(u,o)})}}function tg(e,i,t,o){if(!(e=nt(e)))return!1;let c=null,u=ru(e);const f=!u&&$t(e);if(u||f){if(f&&!f.standalone)return!1;c=e}else{const y=e.ngModule;if(u=ru(y),!u)return!1;c=y}const g=o.has(c);if(f){if(g)return!1;if(o.add(c),f.dependencies){const y="function"==typeof f.dependencies?f.dependencies():f.dependencies;for(const S of y)tg(S,i,t,o)}}else{if(!u)return!1;{if(null!=u.imports&&!g){let S;o.add(c);try{$l(u.imports,R=>{tg(R,i,t,o)&&(S||=[],S.push(R))})}finally{}void 0!==S&&ER(S,i)}if(!g){const S=Hc(c)||(()=>new c);i({provide:c,useFactory:S,deps:Zt},c),i({provide:fR,useValue:c,multi:!0},c),i({provide:Hp,useValue:()=>pe(c),multi:!0},c)}const y=u.providers;if(null!=y&&!g){const S=e;ng(y,R=>{i(R,S)})}}}return c!==e&&void 0!==e.providers}function ng(e,i){for(let t of e)$v(t)&&(t=t.\u0275providers),Array.isArray(t)?ng(t,i):i(t)}const Rx=_n({provide:String,useValue:_n});function bb(e){return null!==e&&"object"==typeof e&&Rx in e}function ed(e){return"function"==typeof e}const Cb=new De("Set Injector scope."),ig={},Dx={};let Tb;function rg(){return void 0===Tb&&(Tb=new yb),Tb}class qo{}class og extends qo{get destroyed(){return this._destroyed}constructor(i,t,o,c){super(),this.parent=t,this.source=o,this.scopes=c,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Ib(i,f=>this.processProvider(f)),this.records.set(pR,Bu(void 0,this)),c.has("environment")&&this.records.set(qo,Bu(void 0,this));const u=this.records.get(Cb);null!=u&&"string"==typeof u.value&&this.scopes.add(u.value),this.injectorDefTypes=new Set(this.get(fR.multi,Zt,Ft.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();const i=this._onDestroyHooks;this._onDestroyHooks=[];for(const t of i)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(i){return this.assertNotDestroyed(),this._onDestroyHooks.push(i),()=>this.removeOnDestroy(i)}runInContext(i){this.assertNotDestroyed();const t=Ja(this),o=so(void 0);try{return i()}finally{Ja(t),so(o)}}get(i,t=su,o=Ft.Default){if(this.assertNotDestroyed(),i.hasOwnProperty(vw))return i[vw](this);o=Km(o);const u=Ja(this),f=so(void 0);try{if(!(o&Ft.SkipSelf)){let y=this.records.get(i);if(void 0===y){const S=function Mx(e){return"function"==typeof e||"object"==typeof e&&e instanceof De}(i)&&Hm(i);y=S&&this.injectableDefInScope(S)?Bu(wb(i),ig):null,this.records.set(i,y)}if(null!=y)return this.hydrate(i,y)}return(o&Ft.Self?rg():this.parent).get(i,t=o&Ft.Optional&&t===su?null:t)}catch(g){if("NullInjectorError"===g.name){if((g[qm]=g[qm]||[]).unshift(zn(i)),u)throw g;return function Ew(e,i,t,o){const c=e[qm];throw i[_w]&&c.unshift(i[_w]),e.message=function I1(e,i,t,o=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let c=zn(i);if(Array.isArray(i))c=i.map(zn).join(" -> ");else if("object"==typeof i){let u=[];for(let f in i)if(i.hasOwnProperty(f)){let g=i[f];u.push(f+":"+("string"==typeof g?JSON.stringify(g):zn(g)))}c=`{${u.join(", ")}}`}return`${t}${o?"("+o+")":""}[${c}]: ${e.replace(b1,"\n  ")}`}("\n"+e.message,c,t,o),e.ngTokenPath=c,e[qm]=null,e}(g,i,"R3InjectorError",this.source)}throw g}finally{so(f),Ja(u)}}resolveInjectorInitializers(){const i=Ja(this),t=so(void 0);try{const c=this.get(Hp.multi,Zt,Ft.Self);for(const u of c)u()}finally{Ja(i),so(t)}}toString(){const i=[],t=this.records;for(const o of t.keys())i.push(zn(o));return`R3Injector[${i.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ue(205,!1)}processProvider(i){let t=ed(i=nt(i))?i:nt(i&&i.provide);const o=function Nx(e){return bb(e)?Bu(void 0,e.useValue):Bu(yR(e),ig)}(i);if(ed(i)||!0!==i.multi)this.records.get(t);else{let c=this.records.get(t);c||(c=Bu(void 0,ig,!0),c.factory=()=>ty(c.multi),this.records.set(t,c)),t=i,c.multi.push(i)}this.records.set(t,o)}hydrate(i,t){return t.value===ig&&(t.value=Dx,t.value=t.factory()),"object"==typeof t.value&&t.value&&function bR(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(i){if(!i.providedIn)return!1;const t=nt(i.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(i){const t=this._onDestroyHooks.indexOf(i);-1!==t&&this._onDestroyHooks.splice(t,1)}}function wb(e){const i=Hm(e),t=null!==i?i.factory:Hc(e);if(null!==t)return t;if(e instanceof De)throw new ue(204,!1);if(e instanceof Function)return function Ox(e){const i=e.length;if(i>0)throw Ru(i,"?"),new ue(204,!1);const t=function m1(e){return e&&(e[Gm]||e[hw])||null}(e);return null!==t?()=>t.factory(e):()=>new e}(e);throw new ue(204,!1)}function yR(e,i,t){let o;if(ed(e)){const c=nt(e);return Hc(c)||wb(c)}if(bb(e))o=()=>nt(e.useValue);else if(function Sb(e){return!(!e||!e.useFactory)}(e))o=()=>e.useFactory(...ty(e.deps||[]));else if(function vR(e){return!(!e||!e.useExisting)}(e))o=()=>pe(nt(e.useExisting));else{const c=nt(e&&(e.useClass||e.provide));if(!function Px(e){return!!e.deps}(e))return Hc(c)||wb(c);o=()=>new c(...ty(e.deps))}return o}function Bu(e,i,t=!1){return{factory:e,value:i,multi:t?[]:void 0}}function Ib(e,i){for(const t of e)Array.isArray(t)?Ib(t,i):t&&$v(t)?Ib(t.\u0275providers,i):i(t)}const ju=new De("AppId",{providedIn:"root",factory:()=>xx}),xx="ng",Gp=new De("Platform Initializer"),el=new De("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),ba=new De("AnimationModuleType"),Rb=new De("CSP nonce",{providedIn:"root",factory:()=>function ku(){if(void 0!==db)return db;if(typeof document<"u")return document;throw new ue(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let zu=(e,i,t)=>null;function Mb(e,i,t=!1){return zu(e,i,t)}class Hx{}class Lb{}class wR{resolveComponentFactory(i){throw function Ko(e){const i=Error(`No component factory found for ${zn(e)}.`);return i.ngComponent=e,i}(i)}}let qu=(()=>{class e{static#e=this.NULL=new wR}return e})();function IR(){return td(hr(),be())}function td(e,i){return new bn(ur(e,i))}let bn=(()=>{class e{constructor(t){this.nativeElement=t}static#e=this.__NG_ELEMENT_ID__=IR}return e})();function RR(e){return e instanceof bn?e.nativeElement:e}class Yp{}let Sa=(()=>{class e{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function Gx(){const e=be(),t=Go(hr().index,e);return(co(t)?t:e)[gt]}()}return e})(),Fb=(()=>{class e{static#e=this.\u0275prov=Me({token:e,providedIn:"root",factory:()=>null})}return e})();class ac{constructor(i){this.full=i,this.major=i.split(".")[0],this.minor=i.split(".")[1],this.patch=i.split(".").slice(2).join(".")}}const Wx=new ac("16.2.10"),$p={};function jb(e,i=null,t=null,o){const c=nd(e,i,t,o);return c.resolveInjectorInitializers(),c}function nd(e,i=null,t=null,o,c=new Set){const u=[t||Zt,_R(e)];return o=o||("object"==typeof e?void 0:zn(e)),new og(u,i||rg(),o||null,c)}let tr=(()=>{class e{static#e=this.THROW_IF_NOT_FOUND=su;static#t=this.NULL=new yb;static create(t,o){if(Array.isArray(t))return jb({name:""},o,t,"");{const c=t.name??"";return jb({name:c},t.parent,t.providers,c)}}static#n=this.\u0275prov=Me({token:e,providedIn:"any",factory:()=>pe(pR)});static#i=this.__NG_ELEMENT_ID__=-1}return e})();function mg(e){return e.ngOriginalError}class Ca{constructor(){this._console=console}handleError(i){const t=this._findOriginalError(i);this._console.error("ERROR",i),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(i){let t=i&&mg(i);for(;t&&mg(t);)t=mg(t);return t||null}}function Gb(e){return i=>{setTimeout(e,void 0,i)}}const en=class PR extends Gt{constructor(i=!1){super(),this.__isAsync=i}emit(i){super.next(i)}subscribe(i,t,o){let c=i,u=t||(()=>null),f=o;if(i&&"object"==typeof i){const y=i;c=y.next?.bind(y),u=y.error?.bind(y),f=y.complete?.bind(y)}this.__isAsync&&(u=Gb(u),c&&(c=Gb(c)),f&&(f=Gb(f)));const g=super.subscribe({next:c,error:u,complete:f});return i instanceof Dn&&i.add(g),g}};function MR(...e){}class lt{constructor({enableLongStackTrace:i=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:o=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new en(!1),this.onMicrotaskEmpty=new en(!1),this.onStable=new en(!1),this.onError=new en(!1),typeof Zone>"u")throw new ue(908,!1);Zone.assertZonePatched();const c=this;c._nesting=0,c._outer=c._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(c._inner=c._inner.fork(new Zone.TaskTrackingZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(c._inner=c._inner.fork(Zone.longStackTraceZoneSpec)),c.shouldCoalesceEventChangeDetection=!o&&t,c.shouldCoalesceRunChangeDetection=o,c.lastRequestAnimationFrameId=-1,c.nativeRequestAnimationFrame=function Kx(){const e="function"==typeof On.requestAnimationFrame;let i=On[e?"requestAnimationFrame":"setTimeout"],t=On[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&i&&t){const o=i[Zone.__symbol__("OriginalDelegate")];o&&(i=o);const c=t[Zone.__symbol__("OriginalDelegate")];c&&(t=c)}return{nativeRequestAnimationFrame:i,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function kR(e){const i=()=>{!function xR(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(On,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,Yu(e),e.isCheckStableRunning=!0,_g(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),Yu(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,o,c,u,f,g)=>{if(function $u(e){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0].data?.__ignore_ng_zone__}(g))return t.invokeTask(c,u,f,g);try{return zb(e),t.invokeTask(c,u,f,g)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===u.type||e.shouldCoalesceRunChangeDetection)&&i(),gg(e)}},onInvoke:(t,o,c,u,f,g,y)=>{try{return zb(e),t.invoke(c,u,f,g,y)}finally{e.shouldCoalesceRunChangeDetection&&i(),gg(e)}},onHasTask:(t,o,c,u)=>{t.hasTask(c,u),o===c&&("microTask"==u.change?(e._hasPendingMicrotasks=u.microTask,Yu(e),_g(e)):"macroTask"==u.change&&(e.hasPendingMacrotasks=u.macroTask))},onHandleError:(t,o,c,u)=>(t.handleError(c,u),e.runOutsideAngular(()=>e.onError.emit(u)),!1)})}(c)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!lt.isInAngularZone())throw new ue(909,!1)}static assertNotInAngularZone(){if(lt.isInAngularZone())throw new ue(909,!1)}run(i,t,o){return this._inner.run(i,t,o)}runTask(i,t,o,c){const u=this._inner,f=u.scheduleEventTask("NgZoneEvent: "+c,i,Wb,MR,MR);try{return u.runTask(f,t,o)}finally{u.cancelTask(f)}}runGuarded(i,t,o){return this._inner.runGuarded(i,t,o)}runOutsideAngular(i){return this._outer.run(i)}}const Wb={};function _g(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Yu(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function zb(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function gg(e){e._nesting--,_g(e)}class Eg{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new en,this.onMicrotaskEmpty=new en,this.onStable=new en,this.onError=new en}run(i,t,o){return i.apply(t,o)}runGuarded(i,t,o){return i.apply(t,o)}runOutsideAngular(i){return i()}runTask(i,t,o,c){return i.apply(t,o)}}const Jp=new De("",{providedIn:"root",factory:LR});function LR(){const e=Oe(lt);let i=!0;return Kv(new Ln(c=>{i=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{c.next(i),c.complete()})}),new Ln(c=>{let u;e.runOutsideAngular(()=>{u=e.onStable.subscribe(()=>{lt.assertNotInAngularZone(),queueMicrotask(()=>{!i&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(i=!0,c.next(!0))})})});const f=e.onUnstable.subscribe(()=>{lt.assertInAngularZone(),i&&(i=!1,e.runOutsideAngular(()=>{c.next(!1)}))});return()=>{u.unsubscribe(),f.unsubscribe()}}).pipe($a()))}function Yo(e){return e instanceof Function?e():e}let qb=(()=>{class e{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#e=this.\u0275prov=Me({token:e,providedIn:"root",factory:()=>new e})}return e})();function rd(e){for(;e;){e[Tt]|=64;const i=kp(e);if(ay(e)&&!i)return e;e=i}return null}const Kb=new De("",{providedIn:"root",factory:()=>!1});let il=null;function zR(e,i){return e[i]??vg()}function qR(e,i){const t=vg();t.producerNode?.length&&(e[i]=il,t.lView=e,il=KR())}const Zx={...Pw,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{rd(e.lView)},lView:null};function KR(){return Object.create(Zx)}function vg(){return il??=KR(),il}const bt={};function Je(e){YR(Xt(),be(),zr()+e,!1)}function YR(e,i,t,o){if(!o)if(3==(3&i[Tt])){const u=e.preOrderCheckHooks;null!==u&&Ci(i,u,t)}else{const u=e.preOrderHooks;null!==u&&S_(i,u,0,t)}zl(t)}function re(e,i=Ft.Default){const t=be();return null===t?pe(e,i):uI(hr(),t,nt(e),i)}function sd(){throw new Error("invalid")}function yg(e,i,t,o,c,u,f,g,y,S,R){const k=i.blueprint.slice();return k[mi]=c,k[Tt]=140|o,(null!==S||e&&2048&e[Tt])&&(k[Tt]|=2048),$w(k),k[Qn]=k[hu]=e,k[_i]=t,k[uu]=f||e&&e[uu],k[gt]=g||e&&e[gt],k[pa]=y||e&&e[pa]||null,k[Dr]=u,k[Bo]=function jM(){return BM++}(),k[ec]=R,k[Ow]=S,k[Si]=2==i.type?e[Si]:k,k}function Qu(e,i,t,o,c){let u=e.data[i];if(null===u)u=function bg(e,i,t,o,c){const u=eI(),f=p_(),y=e.data[i]=function Qb(e,i,t,o,c,u){let f=i?i.injectorIndex:-1,g=0;return Vs()&&(g|=128),{type:t,index:o,insertBeforeIndex:null,injectorIndex:f,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:g,providerIndexes:0,value:c,attrs:u,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:i,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,f?u:u&&u.parent,t,i,o,c);return null===e.firstChild&&(e.firstChild=y),null!==u&&(f?null==u.child&&null!==y.parent&&(u.child=y):null===u.next&&(u.next=y,y.prev=u)),y}(e,i,t,o,c),function uM(){return ct.lFrame.inI18n}()&&(u.flags|=32);else if(64&u.type){u.type=t,u.value=o,u.attrs=c;const f=function Cp(){const e=ct.lFrame,i=e.currentTNode;return e.isParent?i:i.parent}();u.injectorIndex=null===f?-1:f.injectorIndex}return ga(u,!0),u}function ad(e,i,t,o){if(0===t)return-1;const c=i.length;for(let u=0;u<t;u++)i.push(o),e.blueprint.push(o),e.data.push(null);return c}function $b(e,i,t,o,c){const u=zR(i,gp),f=zr(),g=2&o;try{zl(-1),g&&i.length>Ut&&YR(e,i,Ut,!1),fs(g?2:0,c);const S=g?u:null,R=hy(S);try{null!==S&&(S.dirty=!1),t(o,c)}finally{py(S,R)}}finally{g&&null===i[gp]&&qR(i,gp),zl(f),fs(g?3:1,c)}}function Sg(e,i,t){if(t_(i)){const o=jo(null);try{const u=i.directiveEnd;for(let f=i.directiveStart;f<u;f++){const g=e.data[f];g.contentQueries&&g.contentQueries(1,t[f],f)}}finally{jo(o)}}}function Zu(e,i,t){Ry()&&(function Zb(e,i,t,o){const c=t.directiveStart,u=t.directiveEnd;jc(t)&&function ak(e,i,t){const o=ur(i,e),c=$R(t);let f=16;t.signals?f=4096:t.onPush&&(f=64);const g=Ag(e,yg(e,c,null,f,o,i,null,e[uu].rendererFactory.createRenderer(o,t),null,null,null));e[i.index]=g}(i,t,e.data[c+t.componentOffset]),e.firstCreatePass||pr(t,i),er(o,i);const f=t.initialInputs;for(let g=c;g<u;g++){const y=e.data[g],S=Kc(i,e,g,t);er(S,i),null!==f&&ck(0,g-c,S,y,0,f),Us(y)&&(Go(t.index,i)[_i]=Kc(i,e,g,t))}}(e,i,t,ur(t,i)),64==(64&t.flags)&&eS(e,i,t))}function Cg(e,i,t=ur){const o=i.localNames;if(null!==o){let c=i.index+1;for(let u=0;u<o.length;u+=2){const f=o[u+1],g=-1===f?t(i,e):e[f];e[c++]=g}}}function $R(e){const i=e.tView;return null===i||i.incompleteFirstPass?e.tView=tf(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):i}function tf(e,i,t,o,c,u,f,g,y,S,R){const k=Ut+o,B=k+c,G=function tk(e,i){const t=[];for(let o=0;o<i;o++)t.push(o<e?null:bt);return t}(k,B),K="function"==typeof S?S():S;return G[ke]={type:e,blueprint:G,template:t,queries:null,viewQuery:g,declTNode:i,data:G.slice().fill(null,k),bindingStartIndex:k,expandoStartIndex:B,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof u?u():u,pipeRegistry:"function"==typeof f?f():f,firstChild:null,schemas:y,consts:K,incompleteFirstPass:!1,ssrId:R}}let Tg=e=>null;function JR(e,i,t,o){for(let c in e)if(e.hasOwnProperty(c)){t=null===t?{}:t;const u=e[c];null===o?QR(t,i,c,u):o.hasOwnProperty(c)&&QR(t,i,o[c],u)}return t}function QR(e,i,t,o){e.hasOwnProperty(t)?e[t].push(i,o):e[t]=[i,o]}function ho(e,i,t,o,c,u,f,g){const y=ur(i,t);let R,S=i.inputs;!g&&null!=S&&(R=S[o])?(iS(e,t,R,o,c),jc(i)&&function tA(e,i){const t=Go(i,e);16&t[Tt]||(t[Tt]|=64)}(t,i.index)):3&i.type&&(o=function eA(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(o),c=null!=f?f(c,i.value||"",o):c,u.setProperty(y,o,c))}function wg(e,i,t,o){if(Ry()){const c=null===o?null:{"":-1},u=function ik(e,i){const t=e.directiveRegistry;let o=null,c=null;if(t)for(let u=0;u<t.length;u++){const f=t[u];if(Sw(i,f.selectors,!1))if(o||(o=[]),Us(f))if(null!==f.findHostDirectiveDefs){const g=[];c=c||new Map,f.findHostDirectiveDefs(f,g,c),o.unshift(...g,f),Ig(e,i,g.length)}else o.unshift(f),Ig(e,i,0);else c=c||new Map,f.findHostDirectiveDefs?.(f,o,c),o.push(f)}return null===o?null:[o,c]}(e,t);let f,g;null===u?f=g=null:[f,g]=u,null!==f&&iA(e,i,t,f,c,g),c&&function rk(e,i,t){if(i){const o=e.localNames=[];for(let c=0;c<i.length;c+=2){const u=t[i[c+1]];if(null==u)throw new ue(-301,!1);o.push(i[c],u)}}}(t,o,c)}t.mergedAttrs=fp(t.mergedAttrs,t.attrs)}function iA(e,i,t,o,c,u){for(let S=0;S<o.length;S++)O_(pr(t,i),e,o[S].type);!function Rg(e,i,t){e.flags|=1,e.directiveStart=i,e.directiveEnd=i+t,e.providerIndexes=i}(t,e.data.length,o.length);for(let S=0;S<o.length;S++){const R=o[S];R.providersResolver&&R.providersResolver(R)}let f=!1,g=!1,y=ad(e,i,o.length,null);for(let S=0;S<o.length;S++){const R=o[S];t.mergedAttrs=fp(t.mergedAttrs,R.hostAttrs),sk(e,t,i,y,R),ok(y,R,c),null!==R.contentQueries&&(t.flags|=4),(null!==R.hostBindings||null!==R.hostAttrs||0!==R.hostVars)&&(t.flags|=64);const k=R.type.prototype;!f&&(k.ngOnChanges||k.ngOnInit||k.ngDoCheck)&&((e.preOrderHooks??=[]).push(t.index),f=!0),!g&&(k.ngOnChanges||k.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(t.index),g=!0),y++}!function ZR(e,i,t){const c=i.directiveEnd,u=e.data,f=i.attrs,g=[];let y=null,S=null;for(let R=i.directiveStart;R<c;R++){const k=u[R],B=t?t.get(k):null,K=B?B.outputs:null;y=JR(k.inputs,R,y,B?B.inputs:null),S=JR(k.outputs,R,S,K);const ee=null===y||null===f||bw(i)?null:lk(y,R,f);g.push(ee)}null!==y&&(y.hasOwnProperty("class")&&(i.flags|=8),y.hasOwnProperty("style")&&(i.flags|=16)),i.initialInputs=g,i.inputs=y,i.outputs=S}(e,t,u)}function eS(e,i,t){const o=t.directiveStart,c=t.directiveEnd,u=t.index,f=function iI(){return ct.lFrame.currentDirectiveIndex}();try{zl(u);for(let g=o;g<c;g++){const y=e.data[g],S=i[g];Oy(g),(null!==y.hostBindings||0!==y.hostVars||null!==y.hostAttrs)&&rA(y,S)}}finally{zl(-1),Oy(f)}}function rA(e,i){null!==e.hostBindings&&e.hostBindings(1,i)}function Ig(e,i,t){i.componentOffset=t,(e.components??=[]).push(i.index)}function ok(e,i,t){if(t){if(i.exportAs)for(let o=0;o<i.exportAs.length;o++)t[i.exportAs[o]]=e;Us(i)&&(t[""]=e)}}function sk(e,i,t,o,c){e.data[o]=c;const u=c.factory||(c.factory=Hc(c.type)),f=new rc(u,Us(c),re);e.blueprint[o]=f,t[o]=f,function eh(e,i,t,o,c){const u=c.hostBindings;if(u){let f=e.hostBindingOpCodes;null===f&&(f=e.hostBindingOpCodes=[]);const g=~i.index;(function th(e){let i=e.length;for(;i>0;){const t=e[--i];if("number"==typeof t&&t<0)return t}return 0})(f)!=g&&f.push(g),f.push(t,o,u)}}(e,i,o,ad(e,t,c.hostVars,bt),c)}function wa(e,i,t,o,c,u){const f=ur(e,i);!function tS(e,i,t,o,c,u,f){if(null==u)e.removeAttribute(i,c,t);else{const g=null==f?_t(u):f(u,o||"",c);e.setAttribute(i,c,g,t)}}(i[gt],f,u,e.value,t,o,c)}function ck(e,i,t,o,c,u){const f=u[i];if(null!==f)for(let g=0;g<f.length;)oA(o,t,f[g++],f[g++],f[g++])}function oA(e,i,t,o,c){const u=jo(null);try{const f=e.inputTransforms;null!==f&&f.hasOwnProperty(o)&&(c=f[o].call(i,c)),null!==e.setInput?e.setInput(i,c,t,o):i[o]=c}finally{jo(u)}}function lk(e,i,t){let o=null,c=0;for(;c<t.length;){const u=t[c];if(0!==u)if(5!==u){if("number"==typeof u)break;if(e.hasOwnProperty(u)){null===o&&(o=[]);const f=e[u];for(let g=0;g<f.length;g+=2)if(f[g]===i){o.push(u,f[g+1],t[c+1]);break}}c+=2}else c+=2;else c+=4}return o}function sA(e,i,t,o){return[e,!0,!1,i,null,0,o,t,null,null,null]}function aA(e,i){const t=e.contentQueries;if(null!==t)for(let o=0;o<t.length;o+=2){const u=t[o+1];if(-1!==u){const f=e.data[u];Tp(t[o]),f.contentQueries(2,i[u],u)}}}function Ag(e,i){return e[Uc]?e[Dw][Ls]=i:e[Uc]=i,e[Dw]=i,i}function nS(e,i,t){Tp(0);const o=jo(null);try{i(e,t)}finally{jo(o)}}function cA(e){return e[du]||(e[du]=[])}function lA(e){return e.cleanup||(e.cleanup=[])}function uA(e,i){const t=e[pa],o=t?t.get(Ca,null):null;o&&o.handleError(i)}function iS(e,i,t,o,c){for(let u=0;u<t.length;){const f=t[u++],g=t[u++];oA(e.data[f],i[f],o,g,c)}}function dk(e,i){const t=Go(i,e),o=t[ke];!function uk(e,i){for(let t=i.length;t<e.blueprint.length;t++)i.push(e.blueprint[t])}(o,t);const c=t[mi];null!==c&&null===t[ec]&&(t[ec]=Mb(c,t[pa])),rS(o,t,t[_i])}function rS(e,i,t){m_(i);try{const o=e.viewQuery;null!==o&&nS(1,o,t);const c=e.template;null!==c&&$b(e,i,c,1,t),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&aA(e,i),e.staticViewQueries&&nS(2,e.viewQuery,t);const u=e.components;null!==u&&function hk(e,i){for(let t=0;t<i.length;t++)dk(e,i[t])}(i,u)}catch(o){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),o}finally{i[Tt]&=-5,Eu()}}let hA=(()=>{class e{constructor(){this.all=new Set,this.queue=new Map}create(t,o,c){const u=typeof Zone>"u"?null:Zone.current,f=function eM(e,i,t){const o=Object.create(tM);t&&(o.consumerAllowSignalWrites=!0),o.fn=e,o.schedule=i;const c=f=>{o.cleanupFn=f};return o.ref={notify:()=>kw(o),run:()=>{if(o.dirty=!1,o.hasRun&&!Lw(o))return;o.hasRun=!0;const f=hy(o);try{o.cleanupFn(),o.cleanupFn=Ww,o.fn(c)}finally{py(o,f)}},cleanup:()=>o.cleanupFn()},o.ref}(t,S=>{this.all.has(S)&&this.queue.set(S,u)},c);let g;this.all.add(f),f.notify();const y=()=>{f.cleanup(),g?.(),this.all.delete(f),this.queue.delete(f)};return g=o?.onDestroy(y),{destroy:y}}flush(){if(0!==this.queue.size)for(const[t,o]of this.queue)this.queue.delete(t),o?o.run(()=>t.run()):t.run()}get isQueueEmpty(){return 0===this.queue.size}static#e=this.\u0275prov=Me({token:e,providedIn:"root",factory:()=>new e})}return e})();function Dg(e,i,t){let o=t?e.styles:null,c=t?e.classes:null,u=0;if(null!==i)for(let f=0;f<i.length;f++){const g=i[f];"number"==typeof g?u=g:1==u?c=Bm(c,g):2==u&&(o=Bm(o,g+": "+i[++f]+";"))}t?e.styles=o:e.stylesWithoutHost=o,t?e.classes=c:e.classesWithoutHost=c}function rf(e,i,t,o,c=!1){for(;null!==t;){const u=i[t.index];null!==u&&o.push(Tn(u)),Gr(u)&&pA(u,o);const f=t.type;if(8&f)rf(e,i,t.child,o);else if(32&f){const g=Jy(t,i);let y;for(;y=g();)o.push(y)}else if(16&f){const g=ZI(i,t);if(Array.isArray(g))o.push(...g);else{const y=kp(i[Si]);rf(y[ke],y,g,o,!0)}}t=c?t.projectionNext:t.next}return o}function pA(e,i){for(let t=ye;t<e.length;t++){const o=e[t],c=o[ke].firstChild;null!==c&&rf(o[ke],o,c,i)}e[ma]!==e[mi]&&i.push(e[ma])}function Og(e,i,t,o=!0){const c=i[uu],u=c.rendererFactory,f=c.afterRenderEventManager;u.begin?.(),f?.begin();try{fA(e,i,e.template,t)}catch(y){throw o&&uA(i,y),y}finally{u.end?.(),c.effectManager?.flush(),f?.end()}}function fA(e,i,t,o){const c=i[Tt];if(256!=(256&c)){i[uu].effectManager?.flush(),m_(i);try{$w(i),function nI(e){return ct.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==t&&$b(e,i,t,2,o);const f=3==(3&c);if(f){const S=e.preOrderCheckHooks;null!==S&&Ci(i,S,null)}else{const S=e.preOrderHooks;null!==S&&S_(i,S,0,null),wp(i,0)}if(function mk(e){for(let i=zI(e);null!==i;i=Qy(i)){if(!i[sy])continue;const t=i[Bc];for(let o=0;o<t.length;o++){sM(t[o])}}}(i),mA(i,2),null!==e.contentQueries&&aA(e,i),f){const S=e.contentCheckHooks;null!==S&&Ci(i,S)}else{const S=e.contentHooks;null!==S&&S_(i,S,1),wp(i,1)}!function ek(e,i){const t=e.hostBindingOpCodes;if(null===t)return;const o=zR(i,fu);try{for(let c=0;c<t.length;c++){const u=t[c];if(u<0)zl(~u);else{const f=u,g=t[++c],y=t[++c];hM(g,f),o.dirty=!1;const S=hy(o);try{y(2,i[f])}finally{py(o,S)}}}}finally{null===i[fu]&&qR(i,fu),zl(-1)}}(e,i);const g=e.components;null!==g&&oS(i,g,0);const y=e.viewQuery;if(null!==y&&nS(2,y,o),f){const S=e.viewCheckHooks;null!==S&&Ci(i,S)}else{const S=e.viewHooks;null!==S&&S_(i,S,2),wp(i,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),i[Tt]&=-73,Ty(i)}finally{Eu()}}}function mA(e,i){for(let t=zI(e);null!==t;t=Qy(t))for(let o=ye;o<t.length;o++)_A(t[o],i)}function _k(e,i,t){_A(Go(i,e),t)}function _A(e,i){if(!function Yw(e){return 128==(128&e[Tt])}(e))return;const t=e[ke],o=e[Tt];if(80&o&&0===i||1024&o||2===i)fA(t,e,t.template,e[_i]);else if(e[_p]>0){mA(e,1);const c=t.components;null!==c&&oS(e,c,1)}}function oS(e,i,t){for(let o=0;o<i.length;o++)_k(e,i[o],t)}class sf{get rootNodes(){const i=this._lView,t=i[ke];return rf(t,i,t.firstChild,[])}constructor(i,t){this._lView=i,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[_i]}set context(i){this._lView[_i]=i}get destroyed(){return 256==(256&this._lView[Tt])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const i=this._lView[Qn];if(Gr(i)){const t=i[8],o=t?t.indexOf(this):-1;o>-1&&(q_(i,o),Op(t,o))}this._attachedToViewContainer=!1}K_(this._lView[ke],this._lView)}onDestroy(i){!function Jw(e,i){if(256==(256&e[Tt]))throw new ue(911,!1);null===e[Vc]&&(e[Vc]=[]),e[Vc].push(i)}(this._lView,i)}markForCheck(){rd(this._cdRefInjectingView||this._lView)}detach(){this._lView[Tt]&=-129}reattach(){this._lView[Tt]|=128}detectChanges(){Og(this._lView[ke],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ue(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function KI(e,i){Vp(e,i,i[gt],2,null,null)}(this._lView[ke],this._lView)}attachToAppRef(i){if(this._attachedToViewContainer)throw new ue(902,!1);this._appRef=i}}class sS extends sf{constructor(i){super(i),this._view=i}detectChanges(){const i=this._view;Og(i[ke],i,i[_i],!1)}checkNoChanges(){}get context(){return null}}class gA extends qu{constructor(i){super(),this.ngModule=i}resolveComponentFactory(i){const t=$t(i);return new nh(t,this.ngModule)}}function EA(e){const i=[];for(let t in e)e.hasOwnProperty(t)&&i.push({propName:e[t],templateName:t});return i}class Ek{constructor(i,t){this.injector=i,this.parentInjector=t}get(i,t,o){o=Km(o);const c=this.injector.get(i,$p,o);return c!==$p||t===$p?c:this.parentInjector.get(i,t,o)}}class nh extends Lb{get inputs(){const i=this.componentDef,t=i.inputTransforms,o=EA(i.inputs);if(null!==t)for(const c of o)t.hasOwnProperty(c.propName)&&(c.transform=t[c.propName]);return o}get outputs(){return EA(this.componentDef.outputs)}constructor(i,t){super(),this.componentDef=i,this.ngModule=t,this.componentType=i.type,this.selector=function Tw(e){return e.map(lu).join(",")}(i.selectors),this.ngContentSelectors=i.ngContentSelectors?i.ngContentSelectors:[],this.isBoundToModule=!!t}create(i,t,o,c){let u=(c=c||this.ngModule)instanceof qo?c:c?.injector;u&&null!==this.componentDef.getStandaloneInjector&&(u=this.componentDef.getStandaloneInjector(u)||u);const f=u?new Ek(i,u):i,g=f.get(Yp,null);if(null===g)throw new ue(407,!1);const k={rendererFactory:g,sanitizer:f.get(Fb,null),effectManager:f.get(hA,null),afterRenderEventManager:f.get(qb,null)},B=g.createRenderer(null,this.componentDef),G=this.componentDef.selectors[0][0]||"div",K=o?function nk(e,i,t,o){const u=o.get(Kb,!1)||t===Ar.ShadowDom,f=e.selectRootElement(i,u);return function nf(e){Tg(e)}(f),f}(B,o,this.componentDef.encapsulation,f):z_(B,G,function gk(e){const i=e.toLowerCase();return"svg"===i?c_:"math"===i?"math":null}(G)),ve=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let ae=null;null!==K&&(ae=Mb(K,f,!0));const Ve=tf(0,null,null,1,0,null,null,null,null,null,null),je=yg(null,Ve,null,ve,null,null,k,B,f,null,ae);let Pt,ui;m_(je);try{const hi=this.componentDef;let Po,ca=null;hi.findHostDirectiveDefs?(Po=[],ca=new Map,hi.findHostDirectiveDefs(hi,Po,ca),Po.push(hi)):Po=[hi];const Rc=function vA(e,i){const t=e[ke],o=Ut;return e[o]=i,Qu(t,o,2,"#host",null)}(je,K),$P=function z(e,i,t,o,c,u,f){const g=c[ke];!function yk(e,i,t,o){for(const c of e)i.mergedAttrs=fp(i.mergedAttrs,c.hostAttrs);null!==i.mergedAttrs&&(Dg(i,i.mergedAttrs,!0),null!==t&&rR(o,t,i))}(o,e,i,f);let y=null;null!==i&&(y=Mb(i,c[pa]));const S=u.rendererFactory.createRenderer(i,t);let R=16;t.signals?R=4096:t.onPush&&(R=64);const k=yg(c,$R(t),null,R,c[e.index],e,u,S,null,null,y);return g.firstCreatePass&&Ig(g,e,o.length-1),Ag(c,k),c[e.index]=k}(Rc,K,hi,Po,je,k,B);ui=yp(Ve,Ut),K&&function Ng(e,i,t,o){if(o)Xm(e,t,["ng-version",Wx.full]);else{const{attrs:c,classes:u}=function P1(e){const i=[],t=[];let o=1,c=2;for(;o<e.length;){let u=e[o];if("string"==typeof u)2===c?""!==u&&i.push(u,e[++o]):8===c&&t.push(u);else{if(!ao(c))break;c=u}o++}return{attrs:i,classes:t}}(i.selectors[0]);c&&Xm(e,t,c),u&&u.length>0&&iR(e,t,u.join(" "))}}(B,hi,K,o),void 0!==t&&function Pg(e,i,t){const o=e.projection=[];for(let c=0;c<i.length;c++){const u=t[c];o.push(null!=u?Array.from(u):null)}}(ui,this.ngContentSelectors,t),Pt=function af(e,i,t,o,c,u){const f=hr(),g=c[ke],y=ur(f,c);iA(g,c,f,t,null,o);for(let R=0;R<t.length;R++)er(Kc(c,g,f.directiveStart+R,f),c);eS(g,c,f),y&&er(y,c);const S=Kc(c,g,f.directiveStart+f.componentOffset,f);if(e[_i]=c[_i]=S,null!==u)for(const R of u)R(S,i);return Sg(g,f,e),S}($P,hi,Po,ca,je,[Ra]),rS(Ve,je,null)}finally{Eu()}return new vk(this.componentType,Pt,td(ui,je),je,ui)}}class vk extends Hx{constructor(i,t,o,c,u){super(),this.location=o,this._rootLView=c,this._tNode=u,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new sS(c),this.componentType=i}setInput(i,t){const o=this._tNode.inputs;let c;if(null!==o&&(c=o[i])){if(this.previousInputValues??=new Map,this.previousInputValues.has(i)&&Object.is(this.previousInputValues.get(i),t))return;const u=this._rootLView;iS(u[ke],u,c,i,t),this.previousInputValues.set(i,t),rd(Go(this._tNode.index,u))}}get injector(){return new fr(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(i){this.hostView.onDestroy(i)}}function Ra(){const e=hr();b_(be()[ke],e)}function Ne(e){let i=function Fn(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),t=!0;const o=[e];for(;i;){let c;if(Us(e))c=i.\u0275cmp||i.\u0275dir;else{if(i.\u0275cmp)throw new ue(903,!1);c=i.\u0275dir}if(c){if(t){o.push(c);const f=e;f.inputs=ih(e.inputs),f.inputTransforms=ih(e.inputTransforms),f.declaredInputs=ih(e.declaredInputs),f.outputs=ih(e.outputs);const g=c.hostBindings;g&&dt(e,g);const y=c.viewQuery,S=c.contentQueries;if(y&&cc(e,y),S&&cS(e,S),dp(e.inputs,c.inputs),dp(e.declaredInputs,c.declaredInputs),dp(e.outputs,c.outputs),null!==c.inputTransforms&&(null===f.inputTransforms&&(f.inputTransforms={}),dp(f.inputTransforms,c.inputTransforms)),Us(c)&&c.data.animation){const R=e.data;R.animation=(R.animation||[]).concat(c.data.animation)}}const u=c.features;if(u)for(let f=0;f<u.length;f++){const g=u[f];g&&g.ngInherit&&g(e),g===Ne&&(t=!1)}}i=Object.getPrototypeOf(i)}!function aS(e){let i=0,t=null;for(let o=e.length-1;o>=0;o--){const c=e[o];c.hostVars=i+=c.hostVars,c.hostAttrs=fp(c.hostAttrs,t=fp(t,c.hostAttrs))}}(o)}function ih(e){return e===bi?{}:e===Zt?[]:e}function cc(e,i){const t=e.viewQuery;e.viewQuery=t?(o,c)=>{i(o,c),t(o,c)}:i}function cS(e,i){const t=e.contentQueries;e.contentQueries=t?(o,c,u)=>{i(o,c,u),t(o,c,u)}:i}function dt(e,i){const t=e.hostBindings;e.hostBindings=t?(o,c)=>{i(o,c),t(o,c)}:i}function cf(e){return!!rl(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function rl(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function Ws(e,i,t){return e[i]=t}function mr(e,i,t){return!Object.is(e[i],t)&&(e[i]=t,!0)}function ol(e,i,t,o){const c=mr(e,i,t);return mr(e,i+1,o)||c}function ri(e,i,t,o){const c=be();return mr(c,Gl(),i)&&(Xt(),wa(ii(),c,e,i,t,o)),ri}function Fe(e,i,t,o,c,u,f,g){const y=be(),S=Xt(),R=e+Ut,k=S.firstCreatePass?function gi(e,i,t,o,c,u,f,g,y){const S=i.consts,R=Qu(i,e,4,f||null,Gc(S,g));wg(i,t,R,Gc(S,y)),b_(i,R);const k=R.tView=tf(2,R,o,c,u,i.directiveRegistry,i.pipeRegistry,null,i.schemas,S,null);return null!==i.queries&&(i.queries.template(i,R),k.queries=i.queries.embeddedTView(R)),R}(R,S,y,i,t,o,c,u,f):S.data[R];ga(k,!1);const B=Hg(S,y,k,e);y_()&&$_(S,y,B,k),er(B,y),Ag(y,y[R]=sA(B,y,B,k)),n_(k)&&Zu(S,y,k),null!=f&&Cg(y,k,g)}let Hg=function hf(e,i,t,o){return zo(!0),i[gt].createComment("")};function dd(e){return gu(function dM(){return ct.lFrame.contextLView}(),Ut+e)}function Qe(e,i,t){const o=be();return mr(o,Gl(),i)&&ho(Xt(),ii(),o,e,i,o[gt],t,!1),Qe}function sh(e,i,t,o,c){const f=c?"class":"style";iS(e,t,i.inputs[f],f,o)}function Pe(e,i,t,o){const c=be(),u=Xt(),f=Ut+e,g=c[gt],y=u.firstCreatePass?function Zn(e,i,t,o,c,u){const f=i.consts,y=Qu(i,e,2,o,Gc(f,c));return wg(i,t,y,Gc(f,u)),null!==y.attrs&&Dg(y,y.attrs,!1),null!==y.mergedAttrs&&Dg(y,y.mergedAttrs,!0),null!==i.queries&&i.queries.elementStart(i,y),y}(f,u,c,i,t,o):u.data[f],S=gs(u,c,y,g,i,e);c[f]=S;const R=n_(y);return ga(y,!0),rR(g,S,y),32!=(32&y.flags)&&y_()&&$_(u,c,S,y),0===function aM(){return ct.lFrame.elementDepthCount}()&&er(S,c),function bp(){ct.lFrame.elementDepthCount++}(),R&&(Zu(u,c,y),Sg(u,y,c)),null!==o&&Cg(c,y),Pe}function Re(){let e=hr();p_()?Ay():(e=e.parent,ga(e,!1));const i=e;(function lM(e){return ct.skipHydrationRootTNode===e})(i)&&function Zw(){ct.skipHydrationRootTNode=null}(),function cM(){ct.lFrame.elementDepthCount--}();const t=Xt();return t.firstCreatePass&&(b_(t,e),t_(e)&&t.queries.elementEnd(e)),null!=i.classesWithoutHost&&function aI(e){return 0!=(8&e.flags)}(i)&&sh(t,i,be(),i.classesWithoutHost,!0),null!=i.stylesWithoutHost&&function cI(e){return 0!=(16&e.flags)}(i)&&sh(t,i,be(),i.stylesWithoutHost,!1),Re}function wt(e,i,t,o){return Pe(e,i,t,o),Re(),wt}let gs=(e,i,t,o,c,u)=>(zo(!0),z_(o,c,function E_(){return ct.lFrame.currentNamespace}()));function pf(e,i,t){const o=be(),c=Xt(),u=e+Ut,f=c.firstCreatePass?function Ak(e,i,t,o,c){const u=i.consts,f=Gc(u,o),g=Qu(i,e,8,"ng-container",f);return null!==f&&Dg(g,f,!0),wg(i,t,g,Gc(u,c)),null!==i.queries&&i.queries.elementStart(i,g),g}(u,c,o,i,t):c.data[u];ga(f,!0);const g=OA(c,o,f,e);return o[u]=g,y_()&&$_(c,o,g,f),er(g,o),n_(f)&&(Zu(c,o,f),Sg(c,f,o)),null!=t&&Cg(o,f),pf}function ff(){let e=hr();const i=Xt();return p_()?Ay():(e=e.parent,ga(e,!1)),i.firstCreatePass&&(b_(i,e),t_(e)&&i.queries.elementEnd(e)),ff}let OA=(e,i,t,o)=>(zo(!0),eb(i[gt],""));function ah(){return be()}function ud(e){return!!e&&"function"==typeof e.then}function al(e){return!!e&&"function"==typeof e.subscribe}function tn(e,i,t,o){const c=be(),u=Xt(),f=hr();return function yS(e,i,t,o,c,u,f){const g=n_(o),S=e.firstCreatePass&&lA(e),R=i[_i],k=cA(i);let B=!0;if(3&o.type||f){const ee=ur(o,i),de=f?f(ee):ee,ve=k.length,ae=f?je=>f(Tn(je[o.index])):o.index;let Ve=null;if(!f&&g&&(Ve=function vS(e,i,t,o){const c=e.cleanup;if(null!=c)for(let u=0;u<c.length-1;u+=2){const f=c[u];if(f===t&&c[u+1]===o){const g=i[du],y=c[u+2];return g.length>y?g[y]:null}"string"==typeof f&&(u+=2)}return null}(e,i,c,o.index)),null!==Ve)(Ve.__ngLastListenerFn__||Ve).__ngNextListenerFn__=u,Ve.__ngLastListenerFn__=u,B=!1;else{u=Wg(o,i,R,u,!1);const je=t.listen(de,c,u);k.push(u,je),S&&S.push(c,ae,ve,ve+1)}}else u=Wg(o,i,R,u,!1);const G=o.outputs;let K;if(B&&null!==G&&(K=G[c])){const ee=K.length;if(ee)for(let de=0;de<ee;de+=2){const Pt=i[K[de]][K[de+1]].subscribe(u),ui=k.length;k.push(u,Pt),S&&S.push(c,o.index,ui,-(ui+1))}}}(u,c,c[gt],f,e,i,o),tn}function NA(e,i,t,o){try{return fs(6,i,t),!1!==t(o)}catch(c){return uA(e,c),!1}finally{fs(7,i,t)}}function Wg(e,i,t,o,c){return function u(f){if(f===Function)return o;rd(e.componentOffset>-1?Go(e.index,i):i);let y=NA(i,t,o,f),S=u.__ngNextListenerFn__;for(;S;)y=NA(i,t,S,f)&&y,S=S.__ngNextListenerFn__;return c&&!1===y&&f.preventDefault(),y}}function nn(e=1){return function fM(e){return(ct.lFrame.contextLView=function mM(e,i){for(;e>0;)i=i[hu],e--;return i}(e,ct.lFrame.contextLView))[_i]}(e)}function hd(e,i){let t=null;const o=function D1(e){const i=e.attrs;if(null!=i){const t=i.indexOf(5);if(!(1&t))return i[t+1]}return null}(e);for(let c=0;c<i.length;c++){const u=i[c];if("*"!==u){if(null===o?Sw(e,u,!0):cu(o,u))return c}else t=c}return t}function pd(e){const i=be()[Si][Dr];if(!i.projection){const o=i.projection=Ru(e?e.length:1,null),c=o.slice();let u=i.child;for(;null!==u;){const f=e?hd(u,e):0;null!==f&&(c[f]?c[f].projectionNext=u:o[f]=u,c[f]=u),u=u.next}}}function nr(e,i=0,t){const o=be(),c=Xt(),u=Qu(c,Ut+e,16,null,t||null);null===u.projection&&(u.projection=i),Ay(),(!o[ec]||Vs())&&32!=(32&u.flags)&&function tx(e,i,t){lb(i[gt],0,i,t,ib(e,t,i),QI(t.parent||i[Dr],t,i))}(c,o,u)}function ch(e,i){return e<<17|i<<2}function cl(e){return e>>17&32767}function Yg(e){return 2|e}function ll(e){return(131068&e)>>2}function SS(e,i){return-131069&e|i<<2}function Xg(e){return 1|e}function Jg(e,i,t,o,c){const u=e[t+1],f=null===i;let g=o?cl(u):ll(u),y=!1;for(;0!==g&&(!1===y||f);){const R=e[g+1];FA(e[g],i)&&(y=!0,e[g+1]=o?Xg(R):Yg(R)),g=o?cl(R):ll(R)}y&&(e[t+1]=o?Yg(u):Xg(u))}function FA(e,i){return null===e||null==i||(Array.isArray(e)?e[1]:e)===i||!(!Array.isArray(e)||"string"!=typeof i)&&Au(e,i)>=0}function Qg(e,i,t){return Ks(e,i,t,!1),Qg}function Vt(e,i){return Ks(e,i,null,!0),Vt}function Ks(e,i,t,o){const c=be(),u=Xt(),f=function lo(e){const i=ct.lFrame,t=i.bindingIndex;return i.bindingIndex=i.bindingIndex+e,t}(2);u.firstUpdatePass&&function YA(e,i,t,o){const c=e.data;if(null===c[t+1]){const u=c[zr()],f=function KA(e,i){return i>=e.expandoStartIndex}(e,t);(function tE(e,i){return 0!=(e.flags&(i?8:16))})(u,o)&&null===i&&!f&&(i=!1),i=function Zg(e,i,t,o){const c=function Ny(e){const i=ct.lFrame.currentDirectiveIndex;return-1===i?null:e[i]}(e);let u=o?i.residualClasses:i.residualStyles;if(null===c)0===(o?i.classBindings:i.styleBindings)&&(t=uh(t=eE(null,e,i,t,o),i.attrs,o),u=null);else{const f=i.directiveStylingLast;if(-1===f||e[f]!==c)if(t=eE(c,e,i,t,o),null===u){let y=function xk(e,i,t){const o=t?i.classBindings:i.styleBindings;if(0!==ll(o))return e[cl(o)]}(e,i,o);void 0!==y&&Array.isArray(y)&&(y=eE(null,e,i,y[1],o),y=uh(y,i.attrs,o),function kk(e,i,t,o){e[cl(t?i.classBindings:i.styleBindings)]=o}(e,i,o,y))}else u=function ir(e,i,t){let o;const c=i.directiveEnd;for(let u=1+i.directiveStylingLast;u<c;u++)o=uh(o,e[u].hostAttrs,t);return uh(o,i.attrs,t)}(e,i,o)}return void 0!==u&&(o?i.residualClasses=u:i.residualStyles=u),t}(c,u,i,o),function Pk(e,i,t,o,c,u){let f=u?i.classBindings:i.styleBindings,g=cl(f),y=ll(f);e[o]=t;let R,S=!1;if(Array.isArray(t)?(R=t[1],(null===R||Au(t,R)>0)&&(S=!0)):R=t,c)if(0!==y){const B=cl(e[g+1]);e[o+1]=ch(B,g),0!==B&&(e[B+1]=SS(e[B+1],o)),e[g+1]=function lh(e,i){return 131071&e|i<<17}(e[g+1],o)}else e[o+1]=ch(g,0),0!==g&&(e[g+1]=SS(e[g+1],o)),g=o;else e[o+1]=ch(y,0),0===g?g=o:e[y+1]=SS(e[y+1],o),y=o;S&&(e[o+1]=Yg(e[o+1])),Jg(e,R,o,!0),Jg(e,R,o,!1),function dh(e,i,t,o,c){const u=c?e.residualClasses:e.residualStyles;null!=u&&"string"==typeof i&&Au(u,i)>=0&&(t[o+1]=Xg(t[o+1]))}(i,R,e,o,u),f=ch(g,y),u?i.classBindings=f:i.styleBindings=f}(c,u,i,t,f,o)}}(u,e,f,o),i!==bt&&mr(c,f,i)&&function AS(e,i,t,o,c,u,f,g){if(!(3&i.type))return;const y=e.data,S=y[g+1],R=function $g(e){return 1==(1&e)}(S)?_f(y,i,t,c,ll(S),f):void 0;gf(R)||(gf(u)||function gr(e){return 2==(2&e)}(S)&&(u=_f(y,null,t,c,g,f)),function tR(e,i,t,o,c){if(i)c?e.addClass(t,o):e.removeClass(t,o);else{let u=-1===o.indexOf("-")?void 0:$c.DashCase;null==c?e.removeStyle(t,o,u):("string"==typeof c&&c.endsWith("!important")&&(c=c.slice(0,-10),u|=$c.Important),e.setStyle(t,o,c,u))}}(o,f,vp(zr(),t),c,u))}(u,u.data[zr()],c,c[gt],e,c[f+1]=function JA(e,i){return null==e||""===e||("string"==typeof i?e+=i:"object"==typeof e&&(e=zn(Qc(e)))),e}(i,t),o,f)}function eE(e,i,t,o,c){let u=null;const f=t.directiveEnd;let g=t.directiveStylingLast;for(-1===g?g=t.directiveStart:g++;g<f&&(u=i[g],o=uh(o,u.hostAttrs,c),u!==e);)g++;return null!==e&&(t.directiveStylingLast=g),o}function uh(e,i,t){const o=t?1:2;let c=-1;if(null!==i)for(let u=0;u<i.length;u++){const f=i[u];"number"==typeof f?c=f:c===o&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),uo(e,f,!!t||i[++u]))}return void 0===e?null:e}function _f(e,i,t,o,c,u){const f=null===i;let g;for(;c>0;){const y=e[c],S=Array.isArray(y),R=S?y[1]:y,k=null===R;let B=t[c+1];B===bt&&(B=k?Zt:void 0);let G=k?M_(B,o):R===o?B:void 0;if(S&&!gf(G)&&(G=M_(y,o)),gf(G)&&(g=G,f))return g;const K=e[c+1];c=f?cl(K):ll(K)}if(null!==i){let y=u?i.residualClasses:i.residualStyles;null!=y&&(g=M_(y,o))}return g}function gf(e){return void 0!==e}function Or(e,i=""){const t=be(),o=Xt(),c=e+Ut,u=o.firstCreatePass?Qu(o,c,1,i,null):o.data[c],f=QA(o,t,u,i,e);t[c]=f,y_()&&$_(o,t,f,u),ga(u,!1)}let QA=(e,i,t,o,c)=>(zo(!0),function Lp(e,i){return e.createText(i)}(i[gt],o));function uc(e){return Ef("",e,""),uc}function Ef(e,i,t){const o=be(),c=function X(e,i,t,o){return mr(e,Gl(),t)?i+_t(t)+o:bt}(o,e,i,t);return c!==bt&&function Ia(e,i,t){const o=vp(i,e);!function W_(e,i,t){e.setValue(i,t)}(e[gt],o,t)}(o,zr(),c),Ef}function hh(e,i,t){const o=be();return mr(o,Gl(),i)&&ho(Xt(),ii(),o,e,i,o[gt],t,!0),hh}const oi="en-US";let bf=oi;function it(e,i,t,o,c){if(e=nt(e),Array.isArray(e))for(let u=0;u<e.length;u++)it(e[u],i,t,o,c);else{const u=Xt(),f=be(),g=hr();let y=ed(e)?e:nt(e.provide);const S=yR(e),R=1048575&g.providerIndexes,k=g.directiveStart,B=g.providerIndexes>>20;if(ed(e)||!e.multi){const G=new rc(S,c,re),K=Pr(y,i,c?R:R+B,k);-1===K?(O_(pr(g,f),u,y),we(u,e,i.length),i.push(y),g.directiveStart++,g.directiveEnd++,c&&(g.providerIndexes+=1048576),t.push(G),f.push(G)):(t[K]=G,f[K]=G)}else{const G=Pr(y,i,R+B,k),K=Pr(y,i,R,R+B),de=K>=0&&t[K];if(c&&!de||!c&&!(G>=0&&t[G])){O_(pr(g,f),u,y);const ve=function En(e,i,t,o,c){const u=new rc(e,t,re);return u.multi=[],u.index=i,u.componentProviders=0,XS(u,c,o&&!t),u}(c?jn:bo,t.length,c,o,S);!c&&de&&(t[K].providerFactory=ve),we(u,e,i.length,0),i.push(y),g.directiveStart++,g.directiveEnd++,c&&(g.providerIndexes+=1048576),t.push(ve),f.push(ve)}else we(u,e,G>-1?G:K,XS(t[c?K:G],S,!c&&o));!c&&o&&de&&t[K].componentProviders++}}}function we(e,i,t,o){const c=ed(i),u=function Ax(e){return!!e.useClass}(i);if(c||u){const y=(u?nt(i.useClass):i).prototype.ngOnDestroy;if(y){const S=e.destroyHooks||(e.destroyHooks=[]);if(!c&&i.multi){const R=S.indexOf(t);-1===R?S.push(t,[o,y]):S[R+1].push(o,y)}else S.push(t,y)}}}function XS(e,i,t){return t&&e.componentProviders++,e.multi.push(i)-1}function Pr(e,i,t,o){for(let c=t;c<o;c++)if(i[c]===e)return c;return-1}function bo(e,i,t,o){return vs(this.multi,[])}function jn(e,i,t,o){const c=this.multi;let u;if(this.providerFactory){const f=this.providerFactory.componentProviders,g=Kc(t,t[ke],this.providerFactory.index,o);u=g.slice(0,f),vs(c,u);for(let y=f;y<g.length;y++)u.push(g[y])}else u=[],vs(c,u);return u}function vs(e,i){for(let t=0;t<e.length;t++)i.push((0,e[t])());return i}function Lt(e,i=[]){return t=>{t.providersResolver=(o,c)=>function ne(e,i,t){const o=Xt();if(o.firstCreatePass){const c=Us(e);it(t,o.data,o.blueprint,c,!0),it(i,o.data,o.blueprint,c,!1)}}(o,c?c(e):e,i)}}class ml{}class Mr{}class Dt extends ml{constructor(i,t,o){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new gA(this);const c=Vo(i);this._bootstrapComponents=Yo(c.bootstrap),this._r3Injector=nd(i,t,[{provide:ml,useValue:this},{provide:qu,useValue:this.componentFactoryResolver},...o],zn(i),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(i)}get injector(){return this._r3Injector}destroy(){const i=this._r3Injector;!i.destroyed&&i.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(i){this.destroyCbs.push(i)}}class ys extends Mr{constructor(i){super(),this.moduleType=i}create(i){return new Dt(this.moduleType,i,[])}}class JS extends ml{constructor(i){super(),this.componentFactoryResolver=new gA(this),this.instance=null;const t=new og([...i.providers,{provide:ml,useValue:this},{provide:qu,useValue:this.componentFactoryResolver}],i.parent||rg(),i.debugName,new Set(["environment"]));this.injector=t,i.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(i){this.injector.onDestroy(i)}}function _h(e,i,t=null){return new JS({providers:e,parent:i,debugName:t,runEnvironmentInitializers:!0}).injector}let Jk=(()=>{class e{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const o=gR(0,t.type),c=o.length>0?_h([o],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,c)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=Me({token:e,providedIn:"environment",factory:()=>new e(pe(qo))})}return e})();function Df(e){e.getStandaloneInjector=i=>i.get(Jk).getOrCreateStandaloneInjector(e)}function nC(e,i,t,o,c,u,f){return function Xn(e,i,t,o,c,u,f,g,y){const S=i+t;return function Yr(e,i,t,o,c,u){const f=ol(e,i,t,o);return ol(e,i+2,c,u)||f}(e,S,c,u,f,g)?Ws(e,S+4,y?o.call(y,c,u,f,g):o(c,u,f,g)):Nf(e,S+4)}(be(),Wr(),e,i,t,o,c,u,f)}function Nf(e,i){const t=e[i];return t===bt?void 0:t}function dE(e,i){const t=Xt();let o;const c=e+Ut;t.firstCreatePass?(o=function aL(e,i){if(i)for(let t=i.length-1;t>=0;t--){const o=i[t];if(e===o.name)return o}}(i,t.pipeRegistry),t.data[c]=o,o.onDestroy&&(t.destroyHooks??=[]).push(c,o.onDestroy)):o=t.data[c];const u=o.factory||(o.factory=Hc(o.type)),g=so(re);try{const y=R_(!1),S=u();return R_(y),function DA(e,i,t,o){t>=e.data.length&&(e.data[t]=null,e.blueprint[t]=null),i[t]=o}(t,be(),c,S),S}finally{so(g)}}function pc(e,i,t){const o=e+Ut,c=be(),u=gu(c,o);return function gl(e,i){return e[ke].data[i].pure}(c,o)?function rC(e,i,t,o,c,u){const f=i+t;return mr(e,f,c)?Ws(e,f+1,u?o.call(u,c):o(c)):Nf(e,f+1)}(c,Wr(),i,u.transform,t,u):u.transform(t)}function lL(){return this._results[Symbol.iterator]()}class sC{static#e=Symbol.iterator;get changes(){return this._changes||(this._changes=new en)}constructor(i=!1){this._emitDistinctChangesOnly=i,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=sC.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=lL)}get(i){return this._results[i]}map(i){return this._results.map(i)}filter(i){return this._results.filter(i)}find(i){return this._results.find(i)}reduce(i,t){return this._results.reduce(i,t)}forEach(i){this._results.forEach(i)}some(i){return this._results.some(i)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(i,t){const o=this;o.dirty=!1;const c=function ms(e){return e.flat(Number.POSITIVE_INFINITY)}(i);(this._changesDetected=!function EI(e,i,t){if(e.length!==i.length)return!1;for(let o=0;o<e.length;o++){let c=e[o],u=i[o];if(t&&(c=t(c),u=t(u)),u!==c)return!1}return!0}(o._results,c,t))&&(o._results=c,o.length=c.length,o.last=c[this.length-1],o.first=c[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function uE(e,i,t,o=!0){const c=i[ke];if(function JM(e,i,t,o){const c=ye+o,u=t.length;o>0&&(t[c-1][Ls]=i),o<u-ye?(i[Ls]=t[c],vI(t,ye+o,i)):(t.push(i),i[Ls]=null),i[Qn]=t;const f=i[Fs];null!==f&&t!==f&&function tb(e,i){const t=e[Bc];i[Si]!==i[Qn][Qn][Si]&&(e[sy]=!0),null===t?e[Bc]=[i]:t.push(i)}(f,i);const g=i[fa];null!==g&&g.insertView(e),i[Tt]|=128}(c,i,e,t),o){const u=cb(t,e),f=i[gt],g=Mu(f,e[ma]);null!==g&&function qI(e,i,t,o,c,u){o[mi]=c,o[Dr]=i,Vp(e,o,t,1,c,u)}(c,e[Dr],f,i,g,u)}}let Ss=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=fe}return e})();const gh=Ss,BD=class extends gh{constructor(i,t,o){super(),this._declarationLView=i,this._declarationTContainer=t,this.elementRef=o}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(i,t){return this.createEmbeddedViewImpl(i,t)}createEmbeddedViewImpl(i,t,o){const c=function Ma(e,i,t,o){const c=i.tView,g=yg(e,c,t,4096&e[Tt]?4096:16,null,i,null,null,null,o?.injector??null,o?.hydrationInfo??null);g[Fs]=e[i.index];const S=e[fa];return null!==S&&(g[fa]=S.createEmbeddedView(c)),rS(c,g,t),g}(this._declarationLView,this._declarationTContainer,i,{injector:t,hydrationInfo:o});return new sf(c)}};function fe(){return Ot(hr(),be())}function Ot(e,i){return 4&e.type?new BD(i,e,td(e,i)):null}let Qo=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=dL}return e})();function dL(){return xa(hr(),be())}const jD=Qo,Ii=class extends jD{constructor(i,t,o){super(),this._lContainer=i,this._hostTNode=t,this._hostLView=o}get element(){return td(this._hostTNode,this._hostLView)}get injector(){return new fr(this._hostTNode,this._hostLView)}get parentInjector(){const i=D_(this._hostTNode,this._hostLView);if(w_(i)){const t=yu(i,this._hostLView),o=Rp(i);return new fr(t[ke].data[o+8],t)}return new fr(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(i){const t=yr(this._lContainer);return null!==t&&t[i]||null}get length(){return this._lContainer.length-ye}createEmbeddedView(i,t,o){let c,u;"number"==typeof o?c=o:null!=o&&(c=o.index,u=o.injector);const g=i.createEmbeddedViewImpl(t||{},u,null);return this.insertImpl(g,c,false),g}createComponent(i,t,o,c,u){const f=i&&!function Dp(e){return"function"==typeof e}(i);let g;if(f)g=t;else{const ee=t||{};g=ee.index,o=ee.injector,c=ee.projectableNodes,u=ee.environmentInjector||ee.ngModuleRef}const y=f?i:new nh($t(i)),S=o||this.parentInjector;if(!u&&null==y.ngModule){const de=(f?S:this.parentInjector).get(qo,null);de&&(u=de)}$t(y.componentType??{});const G=y.create(S,c,null,u);return this.insertImpl(G.hostView,g,false),G}insert(i,t){return this.insertImpl(i,t,!1)}insertImpl(i,t,o){const c=i._lView;if(function oM(e){return Gr(e[Qn])}(c)){const y=this.indexOf(i);if(-1!==y)this.detach(y);else{const S=c[Qn],R=new Ii(S,S[Dr],S[Qn]);R.detach(R.indexOf(i))}}const f=this._adjustIndex(t),g=this._lContainer;return uE(g,c,f,!o),i.attachToViewContainerRef(),vI(_c(g),f,i),i}move(i,t){return this.insert(i,t)}indexOf(i){const t=yr(this._lContainer);return null!==t?t.indexOf(i):-1}remove(i){const t=this._adjustIndex(i,-1),o=q_(this._lContainer,t);o&&(Op(_c(this._lContainer),t),K_(o[ke],o))}detach(i){const t=this._adjustIndex(i,-1),o=q_(this._lContainer,t);return o&&null!=Op(_c(this._lContainer),t)?new sf(o):null}_adjustIndex(i,t=0){return i??this.length+t}};function yr(e){return e[8]}function _c(e){return e[8]||(e[8]=[])}function xa(e,i){let t;const o=i[e.index];return Gr(o)?t=o:(t=sA(o,i,null,e),i[e.index]=t,Ag(i,t)),_E(t,i,e,o),new Ii(t,e,i)}let _E=function bd(e,i,t,o){if(e[ma])return;let c;c=8&t.type?Tn(o):function Bi(e,i){const t=e[gt],o=t.createComment(""),c=ur(i,e);return ya(t,Mu(t,c),o,function JI(e,i){return e.nextSibling(i)}(t,c),!1),o}(i,t),e[ma]=c};class gE{constructor(i){this.queryList=i,this.matches=null}clone(){return new gE(this.queryList)}setDirty(){this.queryList.setDirty()}}class EE{constructor(i=[]){this.queries=i}createEmbeddedView(i){const t=i.queries;if(null!==t){const o=null!==i.contentQueries?i.contentQueries[0]:t.length,c=[];for(let u=0;u<o;u++){const f=t.getByIndex(u);c.push(this.queries[f.indexInDeclarationView].clone())}return new EE(c)}return null}insertView(i){this.dirtyQueriesWithMatches(i)}detachView(i){this.dirtyQueriesWithMatches(i)}dirtyQueriesWithMatches(i){for(let t=0;t<this.queries.length;t++)null!==uC(i,t).matches&&this.queries[t].setDirty()}}class Jr{constructor(i,t,o=null){this.predicate=i,this.flags=t,this.read=o}}class vt{constructor(i=[]){this.queries=i}elementStart(i,t){for(let o=0;o<this.queries.length;o++)this.queries[o].elementStart(i,t)}elementEnd(i){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(i)}embeddedTView(i){let t=null;for(let o=0;o<this.length;o++){const c=null!==t?t.length:0,u=this.getByIndex(o).embeddedTView(i,c);u&&(u.indexInDeclarationView=o,null!==t?t.push(u):t=[u])}return null!==t?new vt(t):null}template(i,t){for(let o=0;o<this.queries.length;o++)this.queries[o].template(i,t)}getByIndex(i){return this.queries[i]}get length(){return this.queries.length}track(i){this.queries.push(i)}}class cC{constructor(i,t=-1){this.metadata=i,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(i,t){this.isApplyingToNode(t)&&this.matchTNode(i,t)}elementEnd(i){this._declarationNodeIndex===i.index&&(this._appliesToNextNode=!1)}template(i,t){this.elementStart(i,t)}embeddedTView(i,t){return this.isApplyingToNode(i)?(this.crossesNgTemplate=!0,this.addMatch(-i.index,t),new cC(this.metadata)):null}isApplyingToNode(i){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let o=i.parent;for(;null!==o&&8&o.type&&o.index!==t;)o=o.parent;return t===(null!==o?o.index:-1)}return this._appliesToNextNode}matchTNode(i,t){const o=this.metadata.predicate;if(Array.isArray(o))for(let c=0;c<o.length;c++){const u=o[c];this.matchTNodeWithReadOption(i,t,Eh(t,u)),this.matchTNodeWithReadOption(i,t,Ea(t,i,u,!1,!1))}else o===Ss?4&t.type&&this.matchTNodeWithReadOption(i,t,-1):this.matchTNodeWithReadOption(i,t,Ea(t,i,o,!1,!1))}matchTNodeWithReadOption(i,t,o){if(null!==o){const c=this.metadata.read;if(null!==c)if(c===bn||c===Qo||c===Ss&&4&t.type)this.addMatch(t.index,-2);else{const u=Ea(t,i,c,!1,!1);null!==u&&this.addMatch(t.index,u)}else this.addMatch(t.index,o)}}addMatch(i,t){null===this.matches?this.matches=[i,t]:this.matches.push(i,t)}}function Eh(e,i){const t=e.localNames;if(null!==t)for(let o=0;o<t.length;o+=2)if(t[o]===i)return t[o+1];return null}function Sd(e,i,t,o){return-1===t?function GD(e,i){return 11&e.type?td(e,i):4&e.type?Ot(e,i):null}(i,e):-2===t?function lC(e,i,t){return t===bn?td(i,e):t===Ss?Ot(i,e):t===Qo?xa(i,e):void 0}(e,i,o):Kc(e,e[ke],t,i)}function vE(e,i,t,o){const c=i[fa].queries[o];if(null===c.matches){const u=e.data,f=t.matches,g=[];for(let y=0;y<f.length;y+=2){const S=f[y];g.push(S<0?null:Sd(i,u[S],f[y+1],t.metadata.read))}c.matches=g}return c.matches}function vi(e,i,t,o){const c=e.queries.getByIndex(t),u=c.matches;if(null!==u){const f=vE(e,i,c,t);for(let g=0;g<u.length;g+=2){const y=u[g];if(y>0)o.push(f[g/2]);else{const S=u[g+1],R=i[-y];for(let k=ye;k<R.length;k++){const B=R[k];B[Fs]===B[Qn]&&vi(B[ke],B,S,o)}if(null!==R[Bc]){const k=R[Bc];for(let B=0;B<k.length;B++){const G=k[B];vi(G[ke],G,S,o)}}}}}return o}function $e(e){const i=be(),t=Xt(),o=f_();Tp(o+1);const c=uC(t,o);if(e.dirty&&function Kw(e){return 4==(4&e[Tt])}(i)===(2==(2&c.metadata.flags))){if(null===c.matches)e.reset([]);else{const u=c.crossesNgTemplate?vi(t,i,o,[]):vE(t,i,c,o);e.reset(u,RR),e.notifyOnChanges()}return!0}return!1}function Js(e,i,t){const o=Xt();o.firstCreatePass&&(zD(o,new Jr(e,i,t),-1),2==(2&i)&&(o.staticViewQueries=!0)),yE(o,be(),i)}function ka(e,i,t,o){const c=Xt();if(c.firstCreatePass){const u=hr();zD(c,new Jr(i,t,o),u.index),function dC(e,i){const t=e.contentQueries||(e.contentQueries=[]);i!==(t.length?t[t.length-1]:-1)&&t.push(e.queries.length-1,i)}(c,e),2==(2&t)&&(c.staticContentQueries=!0)}yE(c,be(),t)}function ji(){return function WD(e,i){return e[fa].queries[i].queryList}(be(),f_())}function yE(e,i,t){const o=new sC(4==(4&t));(function Jb(e,i,t,o){const c=cA(i);c.push(t),e.firstCreatePass&&lA(e).push(o,c.length-1)})(e,i,o,o.destroy),null===i[fa]&&(i[fa]=new EE),i[fa].queries.push(new gE(o))}function zD(e,i,t){null===e.queries&&(e.queries=new vt),e.queries.track(new cC(i,t))}function uC(e,i){return e.queries.getByIndex(i)}function Pf(e,i){return Ot(e,i)}const Cs=new De("Application Initializer");let Co=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,o)=>{this.resolve=t,this.reject=o}),this.appInits=Oe(Cs,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const c of this.appInits){const u=c();if(ud(u))t.push(u);else if(al(u)){const f=new Promise((g,y)=>{u.subscribe({complete:g,error:y})});t.push(f)}}const o=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{o()}).catch(c=>{this.reject(c)}),0===t.length&&o(),this.initialized=!0}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Id=(()=>{class e{log(t){console.log(t)}warn(t){console.warn(t)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const Zs=new De("LocaleId",{providedIn:"root",factory:()=>Oe(Zs,Ft.Optional|Ft.SkipSelf)||function wC(){return typeof $localize<"u"&&$localize.locale||oi}()});let cO=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Rr(!1)}add(){this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class lO{constructor(i,t){this.ngModuleFactory=i,this.componentFactories=t}}let Fa=(()=>{class e{compileModuleSync(t){return new ys(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const o=this.compileModuleSync(t),u=Yo(Vo(t).declarations).reduce((f,g)=>{const y=$t(g);return y&&f.push(new nh(y)),f},[]);return new lO(o,u)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const CO=new De(""),bl=new De("");let Sl,OC=(()=>{class e{constructor(t,o,c){this._ngZone=t,this.registry=o,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Sl||(function Od(e){Sl=e}(c),c.addToWindow(o)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{lt.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(o=>!o.updateCb||!o.updateCb(t)||(clearTimeout(o.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,o,c){let u=-1;o&&o>0&&(u=setTimeout(()=>{this._callbacks=this._callbacks.filter(f=>f.timeoutId!==u),t(this._didWork,this.getPendingTasks())},o)),this._callbacks.push({doneCb:t,timeoutId:u,updateCb:c})}whenStable(t,o,c){if(c&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,o,c),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,o,c){return[]}static#e=this.\u0275fac=function(o){return new(o||e)(pe(lt),pe(Hi),pe(bl))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac})}return e})(),Hi=(()=>{class e{constructor(){this._applications=new Map}registerApplication(t,o){this._applications.set(t,o)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,o=!0){return Sl?.findTestabilityInTree(this,t,o)??null}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),Cl=null;const xE=new De("AllowMultipleToken"),NC=new De("PlatformDestroyListeners"),Va=new De("appBootstrapListener");class ns{constructor(i,t){this.name=i,this.token=t}}function IO(e,i,t=[]){const o=`Platform: ${i}`,c=new De(o);return(u=[])=>{let f=vh();if(!f||f.injector.get(xE,!1)){const g=[...t,...u,{provide:c,useValue:!0}];e?e(g):function wO(e){if(Cl&&!Cl.get(xE,!1))throw new ue(400,!1);(function TO(){!function $1(e){s_=e}(()=>{throw new ue(600,!1)})})(),Cl=e;const i=e.get(AO);(function PC(e){e.get(Gp,null)?.forEach(t=>t())})(e)}(function RO(e=[],i){return tr.create({name:i,providers:[{provide:Cb,useValue:"platform"},{provide:NC,useValue:new Set([()=>Cl=null])},...e]})}(g,o))}return function MC(e){const i=vh();if(!i)throw new ue(401,!1);return i}()}}function vh(){return Cl?.get(AO)??null}let AO=(()=>{class e{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,o){const c=function yL(e="zone.js",i){return"noop"===e?new Eg:"zone.js"===e?new lt(i):e}(o?.ngZone,function DO(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:o?.ngZoneEventCoalescing,runCoalescing:o?.ngZoneRunCoalescing}));return c.run(()=>{const u=function RD(e,i,t){return new Dt(e,i,t)}(t.moduleType,this.injector,function Md(e){return[{provide:lt,useFactory:e},{provide:Hp,multi:!0,useFactory:()=>{const i=Oe(Pd,{optional:!0});return()=>i.initialize()}},{provide:PO,useFactory:bL},{provide:Jp,useFactory:LR}]}(()=>c)),f=u.injector.get(Ca,null);return c.runOutsideAngular(()=>{const g=c.onError.subscribe({next:y=>{f.handleError(y)}});u.onDestroy(()=>{kE(this._modules,u),g.unsubscribe()})}),function OO(e,i,t){try{const o=t();return ud(o)?o.catch(c=>{throw i.runOutsideAngular(()=>e.handleError(c)),c}):o}catch(o){throw i.runOutsideAngular(()=>e.handleError(o)),o}}(f,c,()=>{const g=u.injector.get(Co);return g.runInitializers(),g.donePromise.then(()=>(function gD(e){Uo(e,"Expected localeId to be defined"),"string"==typeof e&&(bf=e.toLowerCase().replace(/_/g,"-"))}(u.injector.get(Zs,oi)||oi),this._moduleDoBootstrap(u),u))})})}bootstrapModule(t,o=[]){const c=Bf({},o);return function EL(e,i,t){const o=new ys(t);return Promise.resolve(o)}(0,0,t).then(u=>this.bootstrapModuleFactory(u,c))}_moduleDoBootstrap(t){const o=t.injector.get(ea);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(c=>o.bootstrap(c));else{if(!t.instance.ngDoBootstrap)throw new ue(-403,!1);t.instance.ngDoBootstrap(o)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new ue(404,!1);this._modules.slice().forEach(o=>o.destroy()),this._destroyListeners.forEach(o=>o());const t=this._injector.get(NC,null);t&&(t.forEach(o=>o()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(o){return new(o||e)(pe(tr))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();function Bf(e,i){return Array.isArray(i)?i.reduce(Bf,e):{...e,...i}}let ea=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Oe(PO),this.zoneIsStable=Oe(Jp),this.componentTypes=[],this.components=[],this.isStable=Oe(cO).hasPendingTasks.pipe(Lo(t=>t?He(!1):this.zoneIsStable),Yv(),$a()),this._injector=Oe(qo)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,o){const c=t instanceof Lb;if(!this._injector.get(Co).done)throw!c&&function ps(e){const i=$t(e)||lr(e)||Hr(e);return null!==i&&i.standalone}(t),new ue(405,!1);let f;f=c?t:this._injector.get(qu).resolveComponentFactory(t),this.componentTypes.push(f.componentType);const g=function vL(e){return e.isBoundToModule}(f)?void 0:this._injector.get(ml),S=f.create(tr.NULL,[],o||f.selector,g),R=S.location.nativeElement,k=S.injector.get(CO,null);return k?.registerApplication(R),S.onDestroy(()=>{this.detachView(S.hostView),kE(this.components,S),k?.unregisterApplication(R)}),this._loadComponent(S),S}tick(){if(this._runningTick)throw new ue(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this.internalErrorHandler(t)}finally{this._runningTick=!1}}attachView(t){const o=t;this._views.push(o),o.attachToAppRef(this)}detachView(t){const o=t;kE(this._views,o),o.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const o=this._injector.get(Va,[]);o.push(...this._bootstrapListeners),o.forEach(c=>c(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>kE(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new ue(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function kE(e,i){const t=e.indexOf(i);t>-1&&e.splice(t,1)}const PO=new De("",{providedIn:"root",factory:()=>Oe(Ca).handleError.bind(void 0)});function bL(){const e=Oe(lt),i=Oe(Ca);return t=>e.runOutsideAngular(()=>i.handleError(t))}let Pd=(()=>{class e{constructor(){this.zone=Oe(lt),this.applicationRef=Oe(ea)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();let rr=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=is}return e})();function is(e){return function rs(e,i,t){if(jc(e)&&!t){const o=Go(e.index,i);return new sf(o,o)}return 47&e.type?new sf(i[Si],i):null}(hr(),be(),16==(16&e))}class wh{constructor(){}supports(i){return cf(i)}create(i){return new FO(i)}}const Hf=(e,i)=>i;class FO{constructor(i){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=i||Hf}forEachItem(i){let t;for(t=this._itHead;null!==t;t=t._next)i(t)}forEachOperation(i){let t=this._itHead,o=this._removalsHead,c=0,u=null;for(;t||o;){const f=!o||t&&t.currentIndex<BO(o,c,u)?t:o,g=BO(f,c,u),y=f.currentIndex;if(f===o)c--,o=o._nextRemoved;else if(t=t._next,null==f.previousIndex)c++;else{u||(u=[]);const S=g-c,R=y-c;if(S!=R){for(let B=0;B<S;B++){const G=B<u.length?u[B]:u[B]=0,K=G+B;R<=K&&K<S&&(u[B]=G+1)}u[f.previousIndex]=R-S}}g!==y&&i(f,g,y)}}forEachPreviousItem(i){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)i(t)}forEachAddedItem(i){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)i(t)}forEachMovedItem(i){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)i(t)}forEachRemovedItem(i){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)i(t)}forEachIdentityChange(i){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)i(t)}diff(i){if(null==i&&(i=[]),!cf(i))throw new ue(900,!1);return this.check(i)?this:null}onDestroy(){}check(i){this._reset();let c,u,f,t=this._itHead,o=!1;if(Array.isArray(i)){this.length=i.length;for(let g=0;g<this.length;g++)u=i[g],f=this._trackByFn(g,u),null!==t&&Object.is(t.trackById,f)?(o&&(t=this._verifyReinsertion(t,u,f,g)),Object.is(t.item,u)||this._addIdentityChange(t,u)):(t=this._mismatch(t,u,f,g),o=!0),t=t._next}else c=0,function CA(e,i){if(Array.isArray(e))for(let t=0;t<e.length;t++)i(e[t]);else{const t=e[Symbol.iterator]();let o;for(;!(o=t.next()).done;)i(o.value)}}(i,g=>{f=this._trackByFn(c,g),null!==t&&Object.is(t.trackById,f)?(o&&(t=this._verifyReinsertion(t,g,f,c)),Object.is(t.item,g)||this._addIdentityChange(t,g)):(t=this._mismatch(t,g,f,c),o=!0),t=t._next,c++}),this.length=c;return this._truncate(t),this.collection=i,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let i;for(i=this._previousItHead=this._itHead;null!==i;i=i._next)i._nextPrevious=i._next;for(i=this._additionsHead;null!==i;i=i._nextAdded)i.previousIndex=i.currentIndex;for(this._additionsHead=this._additionsTail=null,i=this._movesHead;null!==i;i=i._nextMoved)i.previousIndex=i.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(i,t,o,c){let u;return null===i?u=this._itTail:(u=i._prev,this._remove(i)),null!==(i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(o,null))?(Object.is(i.item,t)||this._addIdentityChange(i,t),this._reinsertAfter(i,u,c)):null!==(i=null===this._linkedRecords?null:this._linkedRecords.get(o,c))?(Object.is(i.item,t)||this._addIdentityChange(i,t),this._moveAfter(i,u,c)):i=this._addAfter(new UO(t,o),u,c),i}_verifyReinsertion(i,t,o,c){let u=null===this._unlinkedRecords?null:this._unlinkedRecords.get(o,null);return null!==u?i=this._reinsertAfter(u,i._prev,c):i.currentIndex!=c&&(i.currentIndex=c,this._addToMoves(i,c)),i}_truncate(i){for(;null!==i;){const t=i._next;this._addToRemovals(this._unlink(i)),i=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(i,t,o){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(i);const c=i._prevRemoved,u=i._nextRemoved;return null===c?this._removalsHead=u:c._nextRemoved=u,null===u?this._removalsTail=c:u._prevRemoved=c,this._insertAfter(i,t,o),this._addToMoves(i,o),i}_moveAfter(i,t,o){return this._unlink(i),this._insertAfter(i,t,o),this._addToMoves(i,o),i}_addAfter(i,t,o){return this._insertAfter(i,t,o),this._additionsTail=null===this._additionsTail?this._additionsHead=i:this._additionsTail._nextAdded=i,i}_insertAfter(i,t,o){const c=null===t?this._itHead:t._next;return i._next=c,i._prev=t,null===c?this._itTail=i:c._prev=i,null===t?this._itHead=i:t._next=i,null===this._linkedRecords&&(this._linkedRecords=new VO),this._linkedRecords.put(i),i.currentIndex=o,i}_remove(i){return this._addToRemovals(this._unlink(i))}_unlink(i){null!==this._linkedRecords&&this._linkedRecords.remove(i);const t=i._prev,o=i._next;return null===t?this._itHead=o:t._next=o,null===o?this._itTail=t:o._prev=t,i}_addToMoves(i,t){return i.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=i:this._movesTail._nextMoved=i),i}_addToRemovals(i){return null===this._unlinkedRecords&&(this._unlinkedRecords=new VO),this._unlinkedRecords.put(i),i.currentIndex=null,i._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=i,i._prevRemoved=null):(i._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=i),i}_addIdentityChange(i,t){return i.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=i:this._identityChangesTail._nextIdentityChange=i,i}}class UO{constructor(i,t){this.item=i,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class wL{constructor(){this._head=null,this._tail=null}add(i){null===this._head?(this._head=this._tail=i,i._nextDup=null,i._prevDup=null):(this._tail._nextDup=i,i._prevDup=this._tail,i._nextDup=null,this._tail=i)}get(i,t){let o;for(o=this._head;null!==o;o=o._nextDup)if((null===t||t<=o.currentIndex)&&Object.is(o.trackById,i))return o;return null}remove(i){const t=i._prevDup,o=i._nextDup;return null===t?this._head=o:t._nextDup=o,null===o?this._tail=t:o._prevDup=t,null===this._head}}class VO{constructor(){this.map=new Map}put(i){const t=i.trackById;let o=this.map.get(t);o||(o=new wL,this.map.set(t,o)),o.add(i)}get(i,t){const c=this.map.get(i);return c?c.get(i,t):null}remove(i){const t=i.trackById;return this.map.get(t).remove(i)&&this.map.delete(t),i}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function BO(e,i,t){const o=e.previousIndex;if(null===o)return o;let c=0;return t&&o<t.length&&(c=t[o]),o+i+c}class jO{constructor(){}supports(i){return i instanceof Map||rl(i)}create(){return new BE}}class BE{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(i){let t;for(t=this._mapHead;null!==t;t=t._next)i(t)}forEachPreviousItem(i){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)i(t)}forEachChangedItem(i){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)i(t)}forEachAddedItem(i){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)i(t)}forEachRemovedItem(i){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)i(t)}diff(i){if(i){if(!(i instanceof Map||rl(i)))throw new ue(900,!1)}else i=new Map;return this.check(i)?this:null}onDestroy(){}check(i){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(i,(o,c)=>{if(t&&t.key===c)this._maybeAddToChanges(t,o),this._appendAfter=t,t=t._next;else{const u=this._getOrCreateRecordForKey(c,o);t=this._insertBeforeOrAppend(t,u)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let o=t;null!==o;o=o._nextRemoved)o===this._mapHead&&(this._mapHead=null),this._records.delete(o.key),o._nextRemoved=o._next,o.previousValue=o.currentValue,o.currentValue=null,o._prev=null,o._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(i,t){if(i){const o=i._prev;return t._next=i,t._prev=o,i._prev=t,o&&(o._next=t),i===this._mapHead&&(this._mapHead=t),this._appendAfter=i,i}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(i,t){if(this._records.has(i)){const c=this._records.get(i);this._maybeAddToChanges(c,t);const u=c._prev,f=c._next;return u&&(u._next=f),f&&(f._prev=u),c._next=null,c._prev=null,c}const o=new IL(i);return this._records.set(i,o),o.currentValue=t,this._addToAdditions(o),o}_reset(){if(this.isDirty){let i;for(this._previousMapHead=this._mapHead,i=this._previousMapHead;null!==i;i=i._next)i._nextPrevious=i._next;for(i=this._changesHead;null!==i;i=i._nextChanged)i.previousValue=i.currentValue;for(i=this._additionsHead;null!=i;i=i._nextAdded)i.previousValue=i.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(i,t){Object.is(t,i.currentValue)||(i.previousValue=i.currentValue,i.currentValue=t,this._addToChanges(i))}_addToAdditions(i){null===this._additionsHead?this._additionsHead=this._additionsTail=i:(this._additionsTail._nextAdded=i,this._additionsTail=i)}_addToChanges(i){null===this._changesHead?this._changesHead=this._changesTail=i:(this._changesTail._nextChanged=i,this._changesTail=i)}_forEach(i,t){i instanceof Map?i.forEach(t):Object.keys(i).forEach(o=>t(i[o],o))}}class IL{constructor(i){this.key=i,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function HO(){return new jE([new wh])}let jE=(()=>{class e{static#e=this.\u0275prov=Me({token:e,providedIn:"root",factory:HO});constructor(t){this.factories=t}static create(t,o){if(null!=o){const c=o.factories.slice();t=t.concat(c)}return new e(t)}static extend(t){return{provide:e,useFactory:o=>e.create(t,o||HO()),deps:[[e,new k_,new Pp]]}}find(t){const o=this.factories.find(c=>c.supports(t));if(null!=o)return o;throw new ue(901,!1)}}return e})();function Ih(){return new Fd([new jO])}let Fd=(()=>{class e{static#e=this.\u0275prov=Me({token:e,providedIn:"root",factory:Ih});constructor(t){this.factories=t}static create(t,o){if(o){const c=o.factories.slice();t=t.concat(c)}return new e(t)}static extend(t){return{provide:e,useFactory:o=>e.create(t,o||Ih()),deps:[[e,new k_,new Pp]]}}find(t){const o=this.factories.find(c=>c.supports(t));if(o)return o;throw new ue(901,!1)}}return e})();const AL=IO(null,"core",[]);let DL=(()=>{class e{constructor(t){}static#e=this.\u0275fac=function(o){return new(o||e)(pe(ea))};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})(),WC=null;function Rl(){return WC}class zC{}const Yt=new De("DocumentToken");let qC=(()=>{class e{historyGo(t){throw new Error("Not implemented")}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:function(){return Oe(zL)},providedIn:"platform"})}return e})();const zO=new De("Location Initialized");let zL=(()=>{class e extends qC{constructor(){super(),this._doc=Oe(Yt),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Rl().getBaseHref(this._doc)}onPopState(t){const o=Rl().getGlobalEventTarget(this._doc,"window");return o.addEventListener("popstate",t,!1),()=>o.removeEventListener("popstate",t)}onHashChange(t){const o=Rl().getGlobalEventTarget(this._doc,"window");return o.addEventListener("hashchange",t,!1),()=>o.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,o,c){this._history.pushState(t,o,c)}replaceState(t,o,c){this._history.replaceState(t,o,c)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:function(){return new e},providedIn:"platform"})}return e})();function Ud(e,i){if(0==e.length)return i;if(0==i.length)return e;let t=0;return e.endsWith("/")&&t++,i.startsWith("/")&&t++,2==t?e+i.substring(1):1==t?e+i:e+"/"+i}function KE(e){const i=e.match(/#|\?|$/),t=i&&i.index||e.length;return e.slice(0,t-("/"===e[t-1]?1:0))+e.slice(t)}function vc(e){return e&&"?"!==e[0]?"?"+e:e}let Ah=(()=>{class e{historyGo(t){throw new Error("Not implemented")}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:function(){return Oe(qL)},providedIn:"root"})}return e})();const qO=new De("appBaseHref");let qL=(()=>{class e extends Ah{constructor(t,o){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=o??this._platformLocation.getBaseHrefFromDOM()??Oe(Yt).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return Ud(this._baseHref,t)}path(t=!1){const o=this._platformLocation.pathname+vc(this._platformLocation.search),c=this._platformLocation.hash;return c&&t?`${o}${c}`:o}pushState(t,o,c,u){const f=this.prepareExternalUrl(c+vc(u));this._platformLocation.pushState(t,o,f)}replaceState(t,o,c,u){const f=this.prepareExternalUrl(c+vc(u));this._platformLocation.replaceState(t,o,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(o){return new(o||e)(pe(qC),pe(qO,8))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),GV=(()=>{class e extends Ah{constructor(t,o){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=o&&(this._baseHref=o)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let o=this._platformLocation.hash;return null==o&&(o="#"),o.length>0?o.substring(1):o}prepareExternalUrl(t){const o=Ud(this._baseHref,t);return o.length>0?"#"+o:o}pushState(t,o,c,u){let f=this.prepareExternalUrl(c+vc(u));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.pushState(t,o,f)}replaceState(t,o,c,u){let f=this.prepareExternalUrl(c+vc(u));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.replaceState(t,o,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(o){return new(o||e)(pe(qC),pe(qO,8))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac})}return e})(),KC=(()=>{class e{constructor(t){this._subject=new en,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const o=this._locationStrategy.getBaseHref();this._basePath=function YC(e){if(new RegExp("^(https?:)?//").test(e)){const[,t]=e.split(/\/\/[^\/]+/);return t}return e}(KE(YL(o))),this._locationStrategy.onPopState(c=>{this._subject.emit({url:this.path(!0),pop:!0,state:c.state,type:c.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,o=""){return this.path()==this.normalize(t+vc(o))}normalize(t){return e.stripTrailingSlash(function WV(e,i){if(!e||!i.startsWith(e))return i;const t=i.substring(e.length);return""===t||["/",";","?","#"].includes(t[0])?t:i}(this._basePath,YL(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,o="",c=null){this._locationStrategy.pushState(c,"",t,o),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+vc(o)),c)}replaceState(t,o="",c=null){this._locationStrategy.replaceState(c,"",t,o),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+vc(o)),c)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(o=>{this._notifyUrlChangeListeners(o.url,o.state)})),()=>{const o=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(o,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",o){this._urlChangeListeners.forEach(c=>c(t,o))}subscribe(t,o,c){return this._subject.subscribe({next:t,error:o,complete:c})}static#e=this.normalizeQueryParams=vc;static#t=this.joinWithSlash=Ud;static#n=this.stripTrailingSlash=KE;static#i=this.\u0275fac=function(o){return new(o||e)(pe(Ah))};static#r=this.\u0275prov=Me({token:e,factory:function(){return function KL(){return new KC(pe(Ah))}()},providedIn:"root"})}return e})();function YL(e){return e.replace(/\/index.html$/,"")}const pT=/\s+/,Jf=[];let ov=(()=>{class e{constructor(t,o,c,u){this._iterableDiffers=t,this._keyValueDiffers=o,this._ngEl=c,this._renderer=u,this.initialClasses=Jf,this.stateMap=new Map}set klass(t){this.initialClasses=null!=t?t.trim().split(pT):Jf}set ngClass(t){this.rawClass="string"==typeof t?t.trim().split(pT):t}ngDoCheck(){for(const o of this.initialClasses)this._updateState(o,!0);const t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(const o of t)this._updateState(o,!0);else if(null!=t)for(const o of Object.keys(t))this._updateState(o,!!t[o]);this._applyStateDiff()}_updateState(t,o){const c=this.stateMap.get(t);void 0!==c?(c.enabled!==o&&(c.changed=!0,c.enabled=o),c.touched=!0):this.stateMap.set(t,{enabled:o,changed:!0,touched:!0})}_applyStateDiff(){for(const t of this.stateMap){const o=t[0],c=t[1];c.changed?(this._toggleClass(o,c.enabled),c.changed=!1):c.touched||(c.enabled&&this._toggleClass(o,!1),this.stateMap.delete(o)),c.touched=!1}}_toggleClass(t,o){(t=t.trim()).length>0&&t.split(pT).forEach(c=>{o?this._renderer.addClass(this._ngEl.nativeElement,c):this._renderer.removeClass(this._ngEl.nativeElement,c)})}static#e=this.\u0275fac=function(o){return new(o||e)(re(jE),re(Fd),re(bn),re(Sa))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0})}return e})();class Oi{constructor(i,t,o,c){this.$implicit=i,this.ngForOf=t,this.index=o,this.count=c}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let sN=(()=>{class e{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,o,c){this._viewContainer=t,this._template=o,this._differs=c,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const o=this._viewContainer;t.forEachOperation((c,u,f)=>{if(null==c.previousIndex)o.createEmbeddedView(this._template,new Oi(c.item,this._ngForOf,-1,-1),null===f?void 0:f);else if(null==f)o.remove(null===u?void 0:u);else if(null!==u){const g=o.get(u);o.move(g,f),aN(g,c)}});for(let c=0,u=o.length;c<u;c++){const g=o.get(c).context;g.index=c,g.count=u,g.ngForOf=this._ngForOf}t.forEachIdentityChange(c=>{aN(o.get(c.currentIndex),c)})}static ngTemplateContextGuard(t,o){return!0}static#e=this.\u0275fac=function(o){return new(o||e)(re(Qo),re(Ss),re(jE))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return e})();function aN(e,i){e.context.$implicit=i.item}let Gd=(()=>{class e{constructor(t,o){this._viewContainer=t,this._context=new fT,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=o}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){mT("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){mT("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,o){return!0}static#e=this.\u0275fac=function(o){return new(o||e)(re(Qo),re(Ss))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return e})();class fT{constructor(){this.$implicit=null,this.ngIf=null}}function mT(e,i){if(i&&!i.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${zn(i)}'.`)}class _T{constructor(i,t){this._viewContainerRef=i,this._templateRef=t,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(i){i&&!this._created?this.create():!i&&this._created&&this.destroy()}}let Fh=(()=>{class e{constructor(){this._defaultViews=[],this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(t){this._ngSwitch=t,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(t){this._defaultViews.push(t)}_matchCase(t){const o=t==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||o,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),o}_updateDefaultCases(t){if(this._defaultViews.length>0&&t!==this._defaultUsed){this._defaultUsed=t;for(const o of this._defaultViews)o.enforceState(t)}}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ge({type:e,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0})}return e})(),Uh=(()=>{class e{constructor(t,o,c){this.ngSwitch=c,c._addCase(),this._view=new _T(t,o)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}static#e=this.\u0275fac=function(o){return new(o||e)(re(Qo),re(Ss),re(Fh,9))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0})}return e})(),cn=(()=>{class e{constructor(t){this._viewContainerRef=t,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(t){if(t.ngTemplateOutlet||t.ngTemplateOutletInjector){const o=this._viewContainerRef;if(this._viewRef&&o.remove(o.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:c,ngTemplateOutletContext:u,ngTemplateOutletInjector:f}=this;this._viewRef=o.createEmbeddedView(c,u,f?{injector:f}:void 0)}else this._viewRef=null}else this._viewRef&&t.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}static#e=this.\u0275fac=function(o){return new(o||e)(re(Qo))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[Ho]})}return e})();class gT{createSubscription(i,t){return Gw(()=>i.subscribe({next:t,error:o=>{throw o}}))}dispose(i){Gw(()=>i.unsubscribe())}}class Wd{createSubscription(i,t){return i.then(t,o=>{throw o})}dispose(i){}}const dN=new Wd,uN=new gT;let Zr=(()=>{class e{constructor(t){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=t}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(t){return this._obj?t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue:(t&&this._subscribe(t),this._latestValue)}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,o=>this._updateLatestValue(t,o))}_selectStrategy(t){if(ud(t))return dN;if(al(t))return uN;throw function Rs(e,i){return new ue(2100,!1)}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,o){t===this._obj&&(this._latestValue=o,this._ref.markForCheck())}static#e=this.\u0275fac=function(o){return new(o||e)(re(rr,16))};static#t=this.\u0275pipe=jr({name:"async",type:e,pure:!1,standalone:!0})}return e})(),Vh=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})();const TT="browser";function vN(e){return"server"===e}let yN=(()=>{class e{static#e=this.\u0275prov=Me({token:e,providedIn:"root",factory:()=>new l2(pe(Yt),window)})}return e})();class l2{constructor(i,t){this.document=i,this.window=t,this.offset=()=>[0,0]}setOffset(i){this.offset=Array.isArray(i)?()=>i:i}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(i){this.supportsScrolling()&&this.window.scrollTo(i[0],i[1])}scrollToAnchor(i){if(!this.supportsScrolling())return;const t=function uv(e,i){const t=e.getElementById(i)||e.getElementsByName(i)[0];if(t)return t;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const o=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let c=o.currentNode;for(;c;){const u=c.shadowRoot;if(u){const f=u.getElementById(i)||u.querySelector(`[name="${i}"]`);if(f)return f}c=o.nextNode()}}return null}(this.document,i);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(i){this.supportsScrolling()&&(this.window.history.scrollRestoration=i)}scrollToElement(i){const t=i.getBoundingClientRect(),o=t.left+this.window.pageXOffset,c=t.top+this.window.pageYOffset,u=this.offset();this.window.scrollTo(o-u[0],c-u[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class Os extends zC{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class gv extends Os{static makeCurrent(){!function zf(e){WC||(WC=e)}(new gv)}onAndCancel(i,t,o){return i.addEventListener(t,o),()=>{i.removeEventListener(t,o)}}dispatchEvent(i,t){i.dispatchEvent(t)}remove(i){i.parentNode&&i.parentNode.removeChild(i)}createElement(i,t){return(t=t||this.getDefaultDocument()).createElement(i)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(i){return i.nodeType===Node.ELEMENT_NODE}isShadowRoot(i){return i instanceof DocumentFragment}getGlobalEventTarget(i,t){return"window"===t?window:"document"===t?i:"body"===t?i.body:null}getBaseHref(i){const t=function Rn(){return Cc=Cc||document.querySelector("base"),Cc?Cc.getAttribute("href"):null}();return null==t?null:function Pl(e){Ev=Ev||document.createElement("a"),Ev.setAttribute("href",e);const i=Ev.pathname;return"/"===i.charAt(0)?i:`/${i}`}(t)}resetBaseElement(){Cc=null}getUserAgent(){return window.navigator.userAgent}getCookie(i){return function Cr(e,i){i=encodeURIComponent(i);for(const t of e.split(";")){const o=t.indexOf("="),[c,u]=-1==o?[t,""]:[t.slice(0,o),t.slice(o+1)];if(c.trim()===i)return decodeURIComponent(u)}return null}(document.cookie,i)}}let Ev,Cc=null,NN=(()=>{class e{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac})}return e})();const Gh=new De("EventManagerPlugins");let xT=(()=>{class e{constructor(t,o){this._zone=o,this._eventNameToPlugin=new Map,t.forEach(c=>{c.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,o,c){return this._findPluginFor(o).addEventListener(t,o,c)}getZone(){return this._zone}_findPluginFor(t){let o=this._eventNameToPlugin.get(t);if(o)return o;if(o=this._plugins.find(u=>u.supports(t)),!o)throw new ue(5101,!1);return this._eventNameToPlugin.set(t,o),o}static#e=this.\u0275fac=function(o){return new(o||e)(pe(Gh),pe(lt))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac})}return e})();class kT{constructor(i){this._doc=i}}const rm="ng-app-id";let LT=(()=>{class e{constructor(t,o,c,u={}){this.doc=t,this.appId=o,this.nonce=c,this.platformId=u,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=vN(u),this.resetHostNodes()}addStyles(t){for(const o of t)1===this.changeUsageCount(o,1)&&this.onStyleAdded(o)}removeStyles(t){for(const o of t)this.changeUsageCount(o,-1)<=0&&this.onStyleRemoved(o)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(o=>o.remove()),t.clear());for(const o of this.getAllStyles())this.onStyleRemoved(o);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const o of this.getAllStyles())this.addStyleToHost(t,o)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const o of this.hostNodes)this.addStyleToHost(o,t)}onStyleRemoved(t){const o=this.styleRef;o.get(t)?.elements?.forEach(c=>c.remove()),o.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${rm}="${this.appId}"]`);if(t?.length){const o=new Map;return t.forEach(c=>{null!=c.textContent&&o.set(c.textContent,c)}),o}return null}changeUsageCount(t,o){const c=this.styleRef;if(c.has(t)){const u=c.get(t);return u.usage+=o,u.usage}return c.set(t,{usage:o,elements:[]}),o}getStyleElement(t,o){const c=this.styleNodesInDOM,u=c?.get(o);if(u?.parentNode===t)return c.delete(o),u.removeAttribute(rm),u;{const f=this.doc.createElement("style");return this.nonce&&f.setAttribute("nonce",this.nonce),f.textContent=o,this.platformIsServer&&f.setAttribute(rm,this.appId),f}}addStyleToHost(t,o){const c=this.getStyleElement(t,o);t.appendChild(c);const u=this.styleRef,f=u.get(o)?.elements;f?f.push(c):u.set(o,{elements:[c],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}static#e=this.\u0275fac=function(o){return new(o||e)(pe(Yt),pe(ju),pe(Rb,8),pe(el))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac})}return e})();const FT={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},UT=/%COMP%/g,xN=new De("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function om(e,i){return i.map(t=>t.replace(UT,e))}let Wi=(()=>{class e{constructor(t,o,c,u,f,g,y,S=null){this.eventManager=t,this.sharedStylesHost=o,this.appId=c,this.removeStylesOnCompDestroy=u,this.doc=f,this.platformId=g,this.ngZone=y,this.nonce=S,this.rendererByCompId=new Map,this.platformIsServer=vN(g),this.defaultRenderer=new Oo(t,f,y,this.platformIsServer)}createRenderer(t,o){if(!t||!o)return this.defaultRenderer;this.platformIsServer&&o.encapsulation===Ar.ShadowDom&&(o={...o,encapsulation:Ar.Emulated});const c=this.getOrCreateRenderer(t,o);return c instanceof BT?c.applyToHost(t):c instanceof io&&c.applyStyles(),c}getOrCreateRenderer(t,o){const c=this.rendererByCompId;let u=c.get(o.id);if(!u){const f=this.doc,g=this.ngZone,y=this.eventManager,S=this.sharedStylesHost,R=this.removeStylesOnCompDestroy,k=this.platformIsServer;switch(o.encapsulation){case Ar.Emulated:u=new BT(y,S,o,this.appId,R,f,g,k);break;case Ar.ShadowDom:return new ln(y,S,t,o,f,g,this.nonce,k);default:u=new io(y,S,o,R,f,g,k)}c.set(o.id,u)}return u}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(o){return new(o||e)(pe(xT),pe(LT),pe(ju),pe(xN),pe(Yt),pe(el),pe(lt),pe(Rb))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac})}return e})();class Oo{constructor(i,t,o,c){this.eventManager=i,this.doc=t,this.ngZone=o,this.platformIsServer=c,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(i,t){return t?this.doc.createElementNS(FT[t]||t,i):this.doc.createElement(i)}createComment(i){return this.doc.createComment(i)}createText(i){return this.doc.createTextNode(i)}appendChild(i,t){(Tc(i)?i.content:i).appendChild(t)}insertBefore(i,t,o){i&&(Tc(i)?i.content:i).insertBefore(t,o)}removeChild(i,t){i&&i.removeChild(t)}selectRootElement(i,t){let o="string"==typeof i?this.doc.querySelector(i):i;if(!o)throw new ue(-5104,!1);return t||(o.textContent=""),o}parentNode(i){return i.parentNode}nextSibling(i){return i.nextSibling}setAttribute(i,t,o,c){if(c){t=c+":"+t;const u=FT[c];u?i.setAttributeNS(u,t,o):i.setAttribute(t,o)}else i.setAttribute(t,o)}removeAttribute(i,t,o){if(o){const c=FT[o];c?i.removeAttributeNS(c,t):i.removeAttribute(`${o}:${t}`)}else i.removeAttribute(t)}addClass(i,t){i.classList.add(t)}removeClass(i,t){i.classList.remove(t)}setStyle(i,t,o,c){c&($c.DashCase|$c.Important)?i.style.setProperty(t,o,c&$c.Important?"important":""):i.style[t]=o}removeStyle(i,t,o){o&$c.DashCase?i.style.removeProperty(t):i.style[t]=""}setProperty(i,t,o){i[t]=o}setValue(i,t){i.nodeValue=t}listen(i,t,o){if("string"==typeof i&&!(i=Rl().getGlobalEventTarget(this.doc,i)))throw new Error(`Unsupported event target ${i} for event ${t}`);return this.eventManager.addEventListener(i,t,this.decoratePreventDefault(o))}decoratePreventDefault(i){return t=>{if("__ngUnwrap__"===t)return i;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>i(t)):i(t))&&t.preventDefault()}}}function Tc(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class ln extends Oo{constructor(i,t,o,c,u,f,g,y){super(i,u,f,y),this.sharedStylesHost=t,this.hostEl=o,this.shadowRoot=o.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const S=om(c.id,c.styles);for(const R of S){const k=document.createElement("style");g&&k.setAttribute("nonce",g),k.textContent=R,this.shadowRoot.appendChild(k)}}nodeOrShadowRoot(i){return i===this.hostEl?this.shadowRoot:i}appendChild(i,t){return super.appendChild(this.nodeOrShadowRoot(i),t)}insertBefore(i,t,o){return super.insertBefore(this.nodeOrShadowRoot(i),t,o)}removeChild(i,t){return super.removeChild(this.nodeOrShadowRoot(i),t)}parentNode(i){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(i)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class io extends Oo{constructor(i,t,o,c,u,f,g,y){super(i,u,f,g),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=c,this.styles=y?om(y,o.styles):o.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class BT extends io{constructor(i,t,o,c,u,f,g,y){const S=c+"-"+o.id;super(i,t,o,u,f,g,y,S),this.contentAttr=function VT(e){return"_ngcontent-%COMP%".replace(UT,e)}(S),this.hostAttr=function kN(e){return"_nghost-%COMP%".replace(UT,e)}(S)}applyToHost(i){this.applyStyles(),this.setAttribute(i,this.hostAttr,"")}createElement(i,t){const o=super.createElement(i,t);return super.setAttribute(o,this.contentAttr,""),o}}let LN=(()=>{class e extends kT{constructor(t){super(t)}supports(t){return!0}addEventListener(t,o,c){return t.addEventListener(o,c,!1),()=>this.removeEventListener(t,o,c)}removeEventListener(t,o,c){return t.removeEventListener(o,c)}static#e=this.\u0275fac=function(o){return new(o||e)(pe(Yt))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac})}return e})();const FN=["alt","control","meta","shift"],P2={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},jT={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let vv=(()=>{class e extends kT{constructor(t){super(t)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,o,c){const u=e.parseEventName(o),f=e.eventCallback(u.fullKey,c,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Rl().onAndCancel(t,u.domEventName,f))}static parseEventName(t){const o=t.toLowerCase().split("."),c=o.shift();if(0===o.length||"keydown"!==c&&"keyup"!==c)return null;const u=e._normalizeKey(o.pop());let f="",g=o.indexOf("code");if(g>-1&&(o.splice(g,1),f="code."),FN.forEach(S=>{const R=o.indexOf(S);R>-1&&(o.splice(R,1),f+=S+".")}),f+=u,0!=o.length||0===u.length)return null;const y={};return y.domEventName=c,y.fullKey=f,y}static matchEventFullKeyCode(t,o){let c=P2[t.key]||t.key,u="";return o.indexOf("code.")>-1&&(c=t.code,u="code."),!(null==c||!c)&&(c=c.toLowerCase()," "===c?c="space":"."===c&&(c="dot"),FN.forEach(f=>{f!==c&&(0,jT[f])(t)&&(u+=f+".")}),u+=c,u===o)}static eventCallback(t,o,c){return u=>{e.matchEventFullKeyCode(u,t)&&c.runGuarded(()=>o(u))}}static _normalizeKey(t){return"esc"===t?"escape":t}static#e=this.\u0275fac=function(o){return new(o||e)(pe(Yt))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac})}return e})();const Nt=IO(AL,"browser",[{provide:el,useValue:TT},{provide:Gp,useValue:function x2(){gv.makeCurrent()},multi:!0},{provide:Yt,useFactory:function VN(){return function ox(e){db=e}(document),document},deps:[]}]),sm=new De(""),BN=[{provide:bl,useClass:class ON{addToWindow(i){On.getAngularTestability=(o,c=!0)=>{const u=i.findTestabilityInTree(o,c);if(null==u)throw new ue(5103,!1);return u},On.getAllAngularTestabilities=()=>i.getAllTestabilities(),On.getAllAngularRootElements=()=>i.getAllRootElements(),On.frameworkStabilizers||(On.frameworkStabilizers=[]),On.frameworkStabilizers.push(o=>{const c=On.getAllAngularTestabilities();let u=c.length,f=!1;const g=function(y){f=f||y,u--,0==u&&o(f)};c.forEach(y=>{y.whenStable(g)})})}findTestabilityInTree(i,t,o){return null==t?null:i.getTestability(t)??(o?Rl().isShadowRoot(t)?this.findTestabilityInTree(i,t.host,!0):this.findTestabilityInTree(i,t.parentElement,!0):null)}},deps:[]},{provide:CO,useClass:OC,deps:[lt,Hi,bl]},{provide:OC,useClass:OC,deps:[lt,Hi,bl]}],GT=[{provide:Cb,useValue:"root"},{provide:Ca,useFactory:function k2(){return new Ca},deps:[]},{provide:Gh,useClass:LN,multi:!0,deps:[Yt,lt,el]},{provide:Gh,useClass:vv,multi:!0,deps:[Yt]},Wi,LT,xT,{provide:Yp,useExisting:Wi},{provide:class bN{},useClass:NN,deps:[]},[]];let jN=(()=>{class e{constructor(t){}static withServerTransition(t){return{ngModule:e,providers:[{provide:ju,useValue:t.appId}]}}static#e=this.\u0275fac=function(o){return new(o||e)(pe(sm,12))};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({providers:[...GT,...BN],imports:[Vh,DL]})}return e})(),Gn=(()=>{class e{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static#e=this.\u0275fac=function(o){return new(o||e)(pe(Yt))};static#t=this.\u0275prov=Me({token:e,factory:function(o){let c=null;return c=o?new o:function WN(){return new Gn(pe(Yt))}(),c},providedIn:"root"})}return e})();typeof window<"u"&&window;const{isArray:Ee}=Array,{getPrototypeOf:Ze,prototype:yt,keys:xn}=Object;function Ht(e){if(1===e.length){const i=e[0];if(Ee(i))return{args:i,keys:null};if(function di(e){return e&&"object"==typeof e&&Ze(e)===yt}(i)){const t=xn(i);return{args:t.map(o=>i[o]),keys:t}}}return{args:e,keys:null}}const{isArray:ie}=Array;function _e(e){return dn(i=>function ce(e,i){return ie(i)?e(...i):e(i)}(e,i))}function Le(e,i){return e.reduce((t,o,c)=>(t[o]=i[c],t),{})}let le=(()=>{class e{constructor(t,o){this._renderer=t,this._elementRef=o,this.onChange=c=>{},this.onTouched=()=>{}}setProperty(t,o){this._renderer.setProperty(this._elementRef.nativeElement,t,o)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static#e=this.\u0275fac=function(o){return new(o||e)(re(Sa),re(bn))};static#t=this.\u0275dir=Ge({type:e})}return e})(),I=(()=>{class e extends le{static#e=this.\u0275fac=function(){let t;return function(c){return(t||(t=Ti(e)))(c||e)}}();static#t=this.\u0275dir=Ge({type:e,features:[Ne]})}return e})();const F=new De("NgValueAccessor"),Be={provide:F,useExisting:Cn(()=>sr),multi:!0},Pi=new De("CompositionEventMode");let sr=(()=>{class e extends le{constructor(t,o,c){super(t,o),this._compositionMode=c,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function Bt(){const e=Rl()?Rl().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static#e=this.\u0275fac=function(o){return new(o||e)(re(Sa),re(bn),re(Pi,8))};static#t=this.\u0275dir=Ge({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(o,c){1&o&&tn("input",function(f){return c._handleInput(f.target.value)})("blur",function(){return c.onTouched()})("compositionstart",function(){return c._compositionStart()})("compositionend",function(f){return c._compositionEnd(f.target.value)})},features:[Lt([Be]),Ne]})}return e})();function Lr(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}function am(e){return null!=e&&"number"==typeof e.length}const zi=new De("NgValidators"),qi=new De("NgAsyncValidators"),Ml=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Yd{static min(i){return function pn(e){return i=>{if(Lr(i.value)||Lr(e))return null;const t=parseFloat(i.value);return!isNaN(t)&&t<e?{min:{min:e,actual:i.value}}:null}}(i)}static max(i){return function An(e){return i=>{if(Lr(i.value)||Lr(e))return null;const t=parseFloat(i.value);return!isNaN(t)&&t>e?{max:{max:e,actual:i.value}}:null}}(i)}static required(i){return function jt(e){return Lr(e.value)?{required:!0}:null}(i)}static requiredTrue(i){return function Fr(e){return!0===e.value?null:{required:!0}}(i)}static email(i){return function na(e){return Lr(e.value)||Ml.test(e.value)?null:{email:!0}}(i)}static minLength(i){return function fn(e){return i=>Lr(i.value)||!am(i.value)?null:i.value.length<e?{minlength:{requiredLength:e,actualLength:i.value.length}}:null}(i)}static maxLength(i){return function at(e){return i=>am(i.value)&&i.value.length>e?{maxlength:{requiredLength:e,actualLength:i.value.length}}:null}(i)}static pattern(i){return function Tr(e){if(!e)return ia;let i,t;return"string"==typeof e?(t="","^"!==e.charAt(0)&&(t+="^"),t+=e,"$"!==e.charAt(e.length-1)&&(t+="$"),i=new RegExp(t)):(t=e.toString(),i=e),o=>{if(Lr(o.value))return null;const c=o.value;return i.test(c)?null:{pattern:{requiredPattern:t,actualValue:c}}}}(i)}static nullValidator(i){return null}static compose(i){return u3(i)}static composeAsync(i){return h3(i)}}function ia(e){return null}function Ns(e){return null!=e}function WT(e){return ud(e)?ki(e):e}function c3(e){let i={};return e.forEach(t=>{i=null!=t?{...i,...t}:i}),0===Object.keys(i).length?null:i}function l3(e,i){return i.map(t=>t(e))}function d3(e){return e.map(i=>function p5(e){return!e.validate}(i)?i:t=>i.validate(t))}function u3(e){if(!e)return null;const i=e.filter(Ns);return 0==i.length?null:function(t){return c3(l3(t,i))}}function F2(e){return null!=e?u3(d3(e)):null}function h3(e){if(!e)return null;const i=e.filter(Ns);return 0==i.length?null:function(t){return function ut(...e){const i=cp(e),{args:t,keys:o}=Ht(e),c=new Ln(u=>{const{length:f}=t;if(!f)return void u.complete();const g=new Array(f);let y=f,S=f;for(let R=0;R<f;R++){let k=!1;xi(t[R]).subscribe(Wn(u,B=>{k||(k=!0,S--),g[R]=B},()=>y--,void 0,()=>{(!y||!k)&&(S||u.next(o?Le(o,g):g),u.complete())}))}});return i?c.pipe(_e(i)):c}(l3(t,i).map(WT)).pipe(dn(c3))}}function U2(e){return null!=e?h3(d3(e)):null}function p3(e,i){return null===e?[i]:Array.isArray(e)?[...e,i]:[e,i]}function f3(e){return e._rawValidators}function m3(e){return e._rawAsyncValidators}function V2(e){return e?Array.isArray(e)?e:[e]:[]}function zN(e,i){return Array.isArray(e)?e.includes(i):e===i}function _3(e,i){const t=V2(i);return V2(e).forEach(c=>{zN(t,c)||t.push(c)}),t}function g3(e,i){return V2(i).filter(t=>!zN(e,t))}class E3{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(i){this._rawValidators=i||[],this._composedValidatorFn=F2(this._rawValidators)}_setAsyncValidators(i){this._rawAsyncValidators=i||[],this._composedAsyncValidatorFn=U2(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(i){this._onDestroyCallbacks.push(i)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(i=>i()),this._onDestroyCallbacks=[]}reset(i=void 0){this.control&&this.control.reset(i)}hasError(i,t){return!!this.control&&this.control.hasError(i,t)}getError(i,t){return this.control?this.control.getError(i,t):null}}class ds extends E3{get formDirective(){return null}get path(){return null}}class $d extends E3{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class v3{constructor(i){this._cd=i}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let y3=(()=>{class e extends v3{constructor(t){super(t)}static#e=this.\u0275fac=function(o){return new(o||e)(re($d,2))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(o,c){2&o&&Vt("ng-untouched",c.isUntouched)("ng-touched",c.isTouched)("ng-pristine",c.isPristine)("ng-dirty",c.isDirty)("ng-valid",c.isValid)("ng-invalid",c.isInvalid)("ng-pending",c.isPending)},features:[Ne]})}return e})(),b3=(()=>{class e extends v3{constructor(t){super(t)}static#e=this.\u0275fac=function(o){return new(o||e)(re(ds,10))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(o,c){2&o&&Vt("ng-untouched",c.isUntouched)("ng-touched",c.isTouched)("ng-pristine",c.isPristine)("ng-dirty",c.isDirty)("ng-valid",c.isValid)("ng-invalid",c.isInvalid)("ng-pending",c.isPending)("ng-submitted",c.isSubmitted)},features:[Ne]})}return e})();const zT="VALID",KN="INVALID",yv="PENDING",qT="DISABLED";function H2(e){return(YN(e)?e.validators:e)||null}function G2(e,i){return(YN(i)?i.asyncValidators:e)||null}function YN(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function C3(e,i,t){const o=e.controls;if(!(i?Object.keys(o):o).length)throw new ue(1e3,"");if(!o[t])throw new ue(1001,"")}function T3(e,i,t){e._forEachChild((o,c)=>{if(void 0===t[c])throw new ue(1002,"")})}class $N{constructor(i,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(i),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(i){this._rawValidators=this._composedValidatorFn=i}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(i){this._rawAsyncValidators=this._composedAsyncValidatorFn=i}get parent(){return this._parent}get valid(){return this.status===zT}get invalid(){return this.status===KN}get pending(){return this.status==yv}get disabled(){return this.status===qT}get enabled(){return this.status!==qT}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(i){this._assignValidators(i)}setAsyncValidators(i){this._assignAsyncValidators(i)}addValidators(i){this.setValidators(_3(i,this._rawValidators))}addAsyncValidators(i){this.setAsyncValidators(_3(i,this._rawAsyncValidators))}removeValidators(i){this.setValidators(g3(i,this._rawValidators))}removeAsyncValidators(i){this.setAsyncValidators(g3(i,this._rawAsyncValidators))}hasValidator(i){return zN(this._rawValidators,i)}hasAsyncValidator(i){return zN(this._rawAsyncValidators,i)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(i={}){this.touched=!0,this._parent&&!i.onlySelf&&this._parent.markAsTouched(i)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(i=>i.markAllAsTouched())}markAsUntouched(i={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!i.onlySelf&&this._parent._updateTouched(i)}markAsDirty(i={}){this.pristine=!1,this._parent&&!i.onlySelf&&this._parent.markAsDirty(i)}markAsPristine(i={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!i.onlySelf&&this._parent._updatePristine(i)}markAsPending(i={}){this.status=yv,!1!==i.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!i.onlySelf&&this._parent.markAsPending(i)}disable(i={}){const t=this._parentMarkedDirty(i.onlySelf);this.status=qT,this.errors=null,this._forEachChild(o=>{o.disable({...i,onlySelf:!0})}),this._updateValue(),!1!==i.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...i,skipPristineCheck:t}),this._onDisabledChange.forEach(o=>o(!0))}enable(i={}){const t=this._parentMarkedDirty(i.onlySelf);this.status=zT,this._forEachChild(o=>{o.enable({...i,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:i.emitEvent}),this._updateAncestors({...i,skipPristineCheck:t}),this._onDisabledChange.forEach(o=>o(!1))}_updateAncestors(i){this._parent&&!i.onlySelf&&(this._parent.updateValueAndValidity(i),i.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(i){this._parent=i}getRawValue(){return this.value}updateValueAndValidity(i={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===zT||this.status===yv)&&this._runAsyncValidator(i.emitEvent)),!1!==i.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!i.onlySelf&&this._parent.updateValueAndValidity(i)}_updateTreeValidity(i={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(i)),this.updateValueAndValidity({onlySelf:!0,emitEvent:i.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?qT:zT}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(i){if(this.asyncValidator){this.status=yv,this._hasOwnPendingAsyncValidator=!0;const t=WT(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(o=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(o,{emitEvent:i})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(i,t={}){this.errors=i,this._updateControlsErrors(!1!==t.emitEvent)}get(i){let t=i;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((o,c)=>o&&o._find(c),this)}getError(i,t){const o=t?this.get(t):this;return o&&o.errors?o.errors[i]:null}hasError(i,t){return!!this.getError(i,t)}get root(){let i=this;for(;i._parent;)i=i._parent;return i}_updateControlsErrors(i){this.status=this._calculateStatus(),i&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(i)}_initObservables(){this.valueChanges=new en,this.statusChanges=new en}_calculateStatus(){return this._allControlsDisabled()?qT:this.errors?KN:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(yv)?yv:this._anyControlsHaveStatus(KN)?KN:zT}_anyControlsHaveStatus(i){return this._anyControls(t=>t.status===i)}_anyControlsDirty(){return this._anyControls(i=>i.dirty)}_anyControlsTouched(){return this._anyControls(i=>i.touched)}_updatePristine(i={}){this.pristine=!this._anyControlsDirty(),this._parent&&!i.onlySelf&&this._parent._updatePristine(i)}_updateTouched(i={}){this.touched=this._anyControlsTouched(),this._parent&&!i.onlySelf&&this._parent._updateTouched(i)}_registerOnCollectionChange(i){this._onCollectionChange=i}_setUpdateStrategy(i){YN(i)&&null!=i.updateOn&&(this._updateOn=i.updateOn)}_parentMarkedDirty(i){return!i&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(i){return null}_assignValidators(i){this._rawValidators=Array.isArray(i)?i.slice():i,this._composedValidatorFn=function g5(e){return Array.isArray(e)?F2(e):e||null}(this._rawValidators)}_assignAsyncValidators(i){this._rawAsyncValidators=Array.isArray(i)?i.slice():i,this._composedAsyncValidatorFn=function E5(e){return Array.isArray(e)?U2(e):e||null}(this._rawAsyncValidators)}}class KT extends $N{constructor(i,t,o){super(H2(t),G2(o,t)),this.controls=i,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(i,t){return this.controls[i]?this.controls[i]:(this.controls[i]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(i,t,o={}){this.registerControl(i,t),this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}removeControl(i,t={}){this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),delete this.controls[i],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(i,t,o={}){this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),delete this.controls[i],t&&this.registerControl(i,t),this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}contains(i){return this.controls.hasOwnProperty(i)&&this.controls[i].enabled}setValue(i,t={}){T3(this,0,i),Object.keys(i).forEach(o=>{C3(this,!0,o),this.controls[o].setValue(i[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(i,t={}){null!=i&&(Object.keys(i).forEach(o=>{const c=this.controls[o];c&&c.patchValue(i[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(i={},t={}){this._forEachChild((o,c)=>{o.reset(i?i[c]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(i,t,o)=>(i[o]=t.getRawValue(),i))}_syncPendingControls(){let i=this._reduceChildren(!1,(t,o)=>!!o._syncPendingControls()||t);return i&&this.updateValueAndValidity({onlySelf:!0}),i}_forEachChild(i){Object.keys(this.controls).forEach(t=>{const o=this.controls[t];o&&i(o,t)})}_setUpControls(){this._forEachChild(i=>{i.setParent(this),i._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(i){for(const[t,o]of Object.entries(this.controls))if(this.contains(t)&&i(o))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,o,c)=>((o.enabled||this.disabled)&&(t[c]=o.value),t))}_reduceChildren(i,t){let o=i;return this._forEachChild((c,u)=>{o=t(o,c,u)}),o}_allControlsDisabled(){for(const i of Object.keys(this.controls))if(this.controls[i].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(i){return this.controls.hasOwnProperty(i)?this.controls[i]:null}}class w3 extends KT{}const bv=new De("CallSetDisabledState",{providedIn:"root",factory:()=>XN}),XN="always";function YT(e,i,t=XN){W2(e,i),i.valueAccessor.writeValue(e.value),(e.disabled||"always"===t)&&i.valueAccessor.setDisabledState?.(e.disabled),function y5(e,i){i.valueAccessor.registerOnChange(t=>{e._pendingValue=t,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&I3(e,i)})}(e,i),function S5(e,i){const t=(o,c)=>{i.valueAccessor.writeValue(o),c&&i.viewToModelUpdate(o)};e.registerOnChange(t),i._registerOnDestroy(()=>{e._unregisterOnChange(t)})}(e,i),function b5(e,i){i.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&I3(e,i),"submit"!==e.updateOn&&e.markAsTouched()})}(e,i),function v5(e,i){if(i.valueAccessor.setDisabledState){const t=o=>{i.valueAccessor.setDisabledState(o)};e.registerOnDisabledChange(t),i._registerOnDestroy(()=>{e._unregisterOnDisabledChange(t)})}}(e,i)}function QN(e,i,t=!0){const o=()=>{};i.valueAccessor&&(i.valueAccessor.registerOnChange(o),i.valueAccessor.registerOnTouched(o)),eP(e,i),e&&(i._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function ZN(e,i){e.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(i)})}function W2(e,i){const t=f3(e);null!==i.validator?e.setValidators(p3(t,i.validator)):"function"==typeof t&&e.setValidators([t]);const o=m3(e);null!==i.asyncValidator?e.setAsyncValidators(p3(o,i.asyncValidator)):"function"==typeof o&&e.setAsyncValidators([o]);const c=()=>e.updateValueAndValidity();ZN(i._rawValidators,c),ZN(i._rawAsyncValidators,c)}function eP(e,i){let t=!1;if(null!==e){if(null!==i.validator){const c=f3(e);if(Array.isArray(c)&&c.length>0){const u=c.filter(f=>f!==i.validator);u.length!==c.length&&(t=!0,e.setValidators(u))}}if(null!==i.asyncValidator){const c=m3(e);if(Array.isArray(c)&&c.length>0){const u=c.filter(f=>f!==i.asyncValidator);u.length!==c.length&&(t=!0,e.setAsyncValidators(u))}}}const o=()=>{};return ZN(i._rawValidators,o),ZN(i._rawAsyncValidators,o),t}function I3(e,i){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),i.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function R3(e,i){W2(e,i)}function A3(e,i){e._syncPendingControls(),i.forEach(t=>{const o=t.control;"submit"===o.updateOn&&o._pendingChange&&(t.viewToModelUpdate(o._pendingValue),o._pendingChange=!1)})}const R5={provide:ds,useExisting:Cn(()=>tP)},$T=(()=>Promise.resolve())();let tP=(()=>{class e extends ds{constructor(t,o,c){super(),this.callSetDisabledState=c,this.submitted=!1,this._directives=new Set,this.ngSubmit=new en,this.form=new KT({},F2(t),U2(o))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){$T.then(()=>{const o=this._findContainer(t.path);t.control=o.registerControl(t.name,t.control),YT(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){$T.then(()=>{const o=this._findContainer(t.path);o&&o.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){$T.then(()=>{const o=this._findContainer(t.path),c=new KT({});R3(c,t),o.registerControl(t.name,c),c.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){$T.then(()=>{const o=this._findContainer(t.path);o&&o.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,o){$T.then(()=>{this.form.get(t.path).setValue(o)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submitted=!0,A3(this.form,this._directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static#e=this.\u0275fac=function(o){return new(o||e)(re(zi,10),re(qi,10),re(bv,8))};static#t=this.\u0275dir=Ge({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(o,c){1&o&&tn("submit",function(f){return c.onSubmit(f)})("reset",function(){return c.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Lt([R5]),Ne]})}return e})();function D3(e,i){const t=e.indexOf(i);t>-1&&e.splice(t,1)}function O3(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const XT=class extends $N{constructor(i=null,t,o){super(H2(t),G2(o,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(i),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),YN(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=O3(i)?i.value:i)}setValue(i,t={}){this.value=this._pendingValue=i,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(o=>o(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(i,t={}){this.setValue(i,t)}reset(i=this.defaultValue,t={}){this._applyFormState(i),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(i){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(i){this._onChange.push(i)}_unregisterOnChange(i){D3(this._onChange,i)}registerOnDisabledChange(i){this._onDisabledChange.push(i)}_unregisterOnDisabledChange(i){D3(this._onDisabledChange,i)}_forEachChild(i){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(i){O3(i)?(this.value=this._pendingValue=i.value,i.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=i}};let k3=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ge({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}return e})(),F3=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})();const Y2=new De("NgModelWithFormControlWarning"),L5={provide:ds,useExisting:Cn(()=>JT)};let JT=(()=>{class e extends ds{constructor(t,o,c){super(),this.callSetDisabledState=c,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new en,this._setValidators(t),this._setAsyncValidators(o)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(eP(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const o=this.form.get(t.path);return YT(o,t,this.callSetDisabledState),o.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),o}getControl(t){return this.form.get(t.path)}removeControl(t){QN(t.control||null,t,!1),function I5(e,i){const t=e.indexOf(i);t>-1&&e.splice(t,1)}(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,o){this.form.get(t.path).setValue(o)}onSubmit(t){return this.submitted=!0,A3(this.form,this.directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{const o=t.control,c=this.form.get(t.path);o!==c&&(QN(o||null,t),(e=>e instanceof XT)(c)&&(YT(c,t,this.callSetDisabledState),t.control=c))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const o=this.form.get(t.path);R3(o,t),o.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const o=this.form.get(t.path);o&&function C5(e,i){return eP(e,i)}(o,t)&&o.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){W2(this.form,this),this._oldForm&&eP(this._oldForm,this)}_checkFormPresent(){}static#e=this.\u0275fac=function(o){return new(o||e)(re(zi,10),re(qi,10),re(bv,8))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","formGroup",""]],hostBindings:function(o,c){1&o&&tn("submit",function(f){return c.onSubmit(f)})("reset",function(){return c.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Lt([L5]),Ne,Ho]})}return e})();const V5={provide:$d,useExisting:Cn(()=>J2)};let J2=(()=>{class e extends $d{set isDisabled(t){}static#e=this._ngModelWarningSentOnce=!1;constructor(t,o,c,u,f){super(),this._ngModelWarningConfig=f,this._added=!1,this.name=null,this.update=new en,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(o),this._setAsyncValidators(c),this.valueAccessor=function K2(e,i){if(!i)return null;let t,o,c;return Array.isArray(i),i.forEach(u=>{u.constructor===sr?t=u:function w5(e){return Object.getPrototypeOf(e.constructor)===I}(u)?o=u:c=u}),c||o||t||null}(0,u)}ngOnChanges(t){this._added||this._setUpControl(),function q2(e,i){if(!e.hasOwnProperty("model"))return!1;const t=e.model;return!!t.isFirstChange()||!Object.is(i,t.currentValue)}(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return function JN(e,i){return[...i.path,e]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static#t=this.\u0275fac=function(o){return new(o||e)(re(ds,13),re(zi,10),re(qi,10),re(F,10),re(Y2,8))};static#n=this.\u0275dir=Ge({type:e,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[Lt([V5]),Ne,Ho]})}return e})(),e6=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[F3]})}return e})();class Q3 extends $N{constructor(i,t,o){super(H2(t),G2(o,t)),this.controls=i,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(i){return this.controls[this._adjustIndex(i)]}push(i,t={}){this.controls.push(i),this._registerControl(i),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(i,t,o={}){this.controls.splice(i,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:o.emitEvent})}removeAt(i,t={}){let o=this._adjustIndex(i);o<0&&(o=0),this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),this.controls.splice(o,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(i,t,o={}){let c=this._adjustIndex(i);c<0&&(c=0),this.controls[c]&&this.controls[c]._registerOnCollectionChange(()=>{}),this.controls.splice(c,1),t&&(this.controls.splice(c,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(i,t={}){T3(this,0,i),i.forEach((o,c)=>{C3(this,!1,c),this.at(c).setValue(o,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(i,t={}){null!=i&&(i.forEach((o,c)=>{this.at(c)&&this.at(c).patchValue(o,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(i=[],t={}){this._forEachChild((o,c)=>{o.reset(i[c],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(i=>i.getRawValue())}clear(i={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:i.emitEvent}))}_adjustIndex(i){return i<0?i+this.length:i}_syncPendingControls(){let i=this.controls.reduce((t,o)=>!!o._syncPendingControls()||t,!1);return i&&this.updateValueAndValidity({onlySelf:!0}),i}_forEachChild(i){this.controls.forEach((t,o)=>{i(t,o)})}_updateValue(){this.value=this.controls.filter(i=>i.enabled||this.disabled).map(i=>i.value)}_anyControls(i){return this.controls.some(t=>t.enabled&&i(t))}_setUpControls(){this._forEachChild(i=>this._registerControl(i))}_allControlsDisabled(){for(const i of this.controls)if(i.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(i){i.setParent(this),i._registerOnCollectionChange(this._onCollectionChange)}_find(i){return this.at(i)??null}}function Z3(e){return!!e&&(void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn)}let nF,t6=(()=>{class e{constructor(){this.useNonNullable=!1}get nonNullable(){const t=new e;return t.useNonNullable=!0,t}group(t,o=null){const c=this._reduceControls(t);let u={};return Z3(o)?u=o:null!==o&&(u.validators=o.validator,u.asyncValidators=o.asyncValidator),new KT(c,u)}record(t,o=null){const c=this._reduceControls(t);return new w3(c,o)}control(t,o,c){let u={};return this.useNonNullable?(Z3(o)?u=o:(u.validators=o,u.asyncValidators=c),new XT(t,{...u,nonNullable:!0})):new XT(t,o,c)}array(t,o,c){const u=t.map(f=>this._createControl(f));return new Q3(u,o,c)}_reduceControls(t){const o={};return Object.keys(t).forEach(c=>{o[c]=this._createControl(t[c])}),o}_createControl(t){return t instanceof XT||t instanceof $N?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),n6=(()=>{class e extends t6{group(t,o=null){return super.group(t,o)}control(t,o,c){return super.control(t,o,c)}array(t,o,c){return super.array(t,o,c)}static#e=this.\u0275fac=function(){let t;return function(c){return(t||(t=Ti(e)))(c||e)}}();static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),i6=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:Y2,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:bv,useValue:t.callSetDisabledState??XN}]}}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[e6]})}return e})();try{nF=typeof Intl<"u"&&Intl.v8BreakIterator}catch{nF=!1}let Sv,ro=(()=>{class e{constructor(t){this._platformId=t,this.isBrowser=this._platformId?function EN(e){return e===TT}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!nF)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}static#e=this.\u0275fac=function(o){return new(o||e)(pe(el))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const eB=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function tB(){if(Sv)return Sv;if("object"!=typeof document||!document)return Sv=new Set(eB),Sv;let e=document.createElement("input");return Sv=new Set(eB.filter(i=>(e.setAttribute("type",i),e.type===i))),Sv}let QT,lm,iF;function Cv(e){return function r6(){if(null==QT&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>QT=!0}))}finally{QT=QT||!1}return QT}()?e:!!e.capture}function o6(){if(null==lm){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return lm=!1,lm;if("scrollBehavior"in document.documentElement.style)lm=!0;else{const e=Element.prototype.scrollTo;lm=!!e&&!/\{\s*\[native code\]\s*\}/.test(e.toString())}}return lm}function qh(e){return e.composedPath?e.composedPath()[0]:e.target}function rF(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function ra(e,i){return ti((t,o)=>{let c=0;t.subscribe(Wn(o,u=>e.call(i,u,c++)&&o.next(u)))})}function nB(e){return ra((i,t)=>e<=t)}function No(e){return ti((i,t)=>{xi(e).subscribe(Wn(t,()=>t.complete(),Zh)),!t.closed&&i.subscribe(t)})}function oa(e){return null!=e&&"false"!=`${e}`}function oF(e,i=0){return function m6(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}(e)?Number(e):i}function iP(e){return Array.isArray(e)?e:[e]}function ar(e){return null==e?"":"string"==typeof e?e:`${e}px`}function Kh(e){return e instanceof bn?e.nativeElement:e}let _6=(()=>{class e{create(t){return typeof MutationObserver>"u"?null:new MutationObserver(t)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),iB=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({providers:[_6]})}return e})();function rP(...e){const i=lp(e),t=cp(e),{args:o,keys:c}=Ht(e);if(0===o.length)return ki([],i);const u=new Ln(function g6(e,i,t=qa){return o=>{rB(i,()=>{const{length:c}=e,u=new Array(c);let f=c,g=c;for(let y=0;y<c;y++)rB(i,()=>{const S=ki(e[y],i);let R=!1;S.subscribe(Wn(o,k=>{u[y]=k,R||(R=!0,g--),g||o.next(t(u.slice()))},()=>{--f||o.complete()}))},o)},o)}}(o,i,c?f=>Le(c,f):qa));return t?u.pipe(_e(t)):u}function rB(e,i,t){e?Ya(t,e,i):i()}function ZT(...e){return function E6(){return us(1)}()(ki(e,lp(e)))}function wr(e){return e<=0?()=>ks:ti((i,t)=>{let o=0;i.subscribe(Wn(t,c=>{++o<=e&&(t.next(c),e<=o&&t.complete())}))})}class v6 extends Dn{constructor(i,t){super()}schedule(i,t=0){return this}}const oP={setInterval(e,i,...t){const{delegate:o}=oP;return o?.setInterval?o.setInterval(e,i,...t):setInterval(e,i,...t)},clearInterval(e){const{delegate:i}=oP;return(i?.clearInterval||clearInterval)(e)},delegate:void 0};class sF extends v6{constructor(i,t){super(i,t),this.scheduler=i,this.work=t,this.pending=!1}schedule(i,t=0){var o;if(this.closed)return this;this.state=i;const c=this.id,u=this.scheduler;return null!=c&&(this.id=this.recycleAsyncId(u,c,t)),this.pending=!0,this.delay=t,this.id=null!==(o=this.id)&&void 0!==o?o:this.requestAsyncId(u,this.id,t),this}requestAsyncId(i,t,o=0){return oP.setInterval(i.flush.bind(i,this),o)}recycleAsyncId(i,t,o=0){if(null!=o&&this.delay===o&&!1===this.pending)return t;null!=t&&oP.clearInterval(t)}execute(i,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const o=this._execute(i,t);if(o)return o;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(i,t){let c,o=!1;try{this.work(i)}catch(u){o=!0,c=u||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),c}unsubscribe(){if(!this.closed){const{id:i,scheduler:t}=this,{actions:o}=t;this.work=this.state=this.scheduler=null,this.pending=!1,ua(o,this),null!=i&&(this.id=this.recycleAsyncId(t,i,null)),this.delay=null,super.unsubscribe()}}}const aF={now:()=>(aF.delegate||Date).now(),delegate:void 0};class e0{constructor(i,t=e0.now){this.schedulerActionCtor=i,this.now=t}schedule(i,t=0,o){return new this.schedulerActionCtor(this,i).schedule(o,t)}}e0.now=aF.now;class cF extends e0{constructor(i,t=e0.now){super(i,t),this.actions=[],this._active=!1}flush(i){const{actions:t}=this;if(this._active)return void t.push(i);let o;this._active=!0;do{if(o=i.execute(i.state,i.delay))break}while(i=t.shift());if(this._active=!1,o){for(;i=t.shift();)i.unsubscribe();throw o}}}const t0=new cF(sF),y6=t0;function oB(...e){const i=lp(e);return ti((t,o)=>{(i?ZT(e,t,i):ZT(e,t)).subscribe(o)})}const sB=new Set;let dm,S6=(()=>{class e{constructor(t,o){this._platform=t,this._nonce=o,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):T6}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&function C6(e,i){if(!sB.has(e))try{dm||(dm=document.createElement("style"),i&&(dm.nonce=i),dm.setAttribute("type","text/css"),document.head.appendChild(dm)),dm.sheet&&(dm.sheet.insertRule(`@media ${e} {body{ }}`,0),sB.add(e))}catch(t){console.error(t)}}(t,this._nonce),this._matchMedia(t)}static#e=this.\u0275fac=function(o){return new(o||e)(pe(ro),pe(Rb,8))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function T6(e){return{matches:"all"===e||""===e,media:e,addListener:()=>{},removeListener:()=>{}}}let w6=(()=>{class e{constructor(t,o){this._mediaMatcher=t,this._zone=o,this._queries=new Map,this._destroySubject=new Gt}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return aB(iP(t)).some(c=>this._registerQuery(c).mql.matches)}observe(t){let u=rP(aB(iP(t)).map(f=>this._registerQuery(f).observable));return u=ZT(u.pipe(wr(1)),u.pipe(nB(1),function b6(e,i=t0){return ti((t,o)=>{let c=null,u=null,f=null;const g=()=>{if(c){c.unsubscribe(),c=null;const S=u;u=null,o.next(S)}};function y(){const S=f+e,R=i.now();if(R<S)return c=this.schedule(void 0,S-R),void o.add(c);g()}t.subscribe(Wn(o,S=>{u=S,f=i.now(),c||(c=i.schedule(y,e),o.add(c))},()=>{g(),o.complete()},void 0,()=>{u=c=null}))})}(0))),u.pipe(dn(f=>{const g={matches:!1,breakpoints:{}};return f.forEach(({matches:y,query:S})=>{g.matches=g.matches||y,g.breakpoints[S]=y}),g}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const o=this._mediaMatcher.matchMedia(t),u={observable:new Ln(f=>{const g=y=>this._zone.run(()=>f.next(y));return o.addListener(g),()=>{o.removeListener(g)}}).pipe(oB(o),dn(({matches:f})=>({query:t,matches:f})),No(this._destroySubject)),mql:o};return this._queries.set(t,u),u}static#e=this.\u0275fac=function(o){return new(o||e)(pe(S6),pe(lt))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function aB(e){return e.map(i=>i.split(",")).reduce((i,t)=>i.concat(t)).map(i=>i.trim())}function sP(e,i){return(e.getAttribute(i)||"").match(/\S+/g)||[]}const lB="cdk-describedby-message",aP="cdk-describedby-host";let lF=0,A6=(()=>{class e{constructor(t,o){this._platform=o,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+lF++,this._document=t,this._id=Oe(ju)+"-"+lF++}describe(t,o,c){if(!this._canBeDescribed(t,o))return;const u=dF(o,c);"string"!=typeof o?(dB(o,this._id),this._messageRegistry.set(u,{messageElement:o,referenceCount:0})):this._messageRegistry.has(u)||this._createMessageElement(o,c),this._isElementDescribedByMessage(t,u)||this._addMessageReference(t,u)}removeDescription(t,o,c){if(!o||!this._isElementNode(t))return;const u=dF(o,c);if(this._isElementDescribedByMessage(t,u)&&this._removeMessageReference(t,u),"string"==typeof o){const f=this._messageRegistry.get(u);f&&0===f.referenceCount&&this._deleteMessageElement(u)}0===this._messagesContainer?.childNodes.length&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){const t=this._document.querySelectorAll(`[${aP}="${this._id}"]`);for(let o=0;o<t.length;o++)this._removeCdkDescribedByReferenceIds(t[o]),t[o].removeAttribute(aP);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(t,o){const c=this._document.createElement("div");dB(c,this._id),c.textContent=t,o&&c.setAttribute("role",o),this._createMessagesContainer(),this._messagesContainer.appendChild(c),this._messageRegistry.set(dF(t,o),{messageElement:c,referenceCount:0})}_deleteMessageElement(t){this._messageRegistry.get(t)?.messageElement?.remove(),this._messageRegistry.delete(t)}_createMessagesContainer(){if(this._messagesContainer)return;const t="cdk-describedby-message-container",o=this._document.querySelectorAll(`.${t}[platform="server"]`);for(let u=0;u<o.length;u++)o[u].remove();const c=this._document.createElement("div");c.style.visibility="hidden",c.classList.add(t),c.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&c.setAttribute("platform","server"),this._document.body.appendChild(c),this._messagesContainer=c}_removeCdkDescribedByReferenceIds(t){const o=sP(t,"aria-describedby").filter(c=>0!=c.indexOf(lB));t.setAttribute("aria-describedby",o.join(" "))}_addMessageReference(t,o){const c=this._messageRegistry.get(o);(function I6(e,i,t){const o=sP(e,i);o.some(c=>c.trim()==t.trim())||(o.push(t.trim()),e.setAttribute(i,o.join(" ")))})(t,"aria-describedby",c.messageElement.id),t.setAttribute(aP,this._id),c.referenceCount++}_removeMessageReference(t,o){const c=this._messageRegistry.get(o);c.referenceCount--,function R6(e,i,t){const c=sP(e,i).filter(u=>u!=t.trim());c.length?e.setAttribute(i,c.join(" ")):e.removeAttribute(i)}(t,"aria-describedby",c.messageElement.id),t.removeAttribute(aP)}_isElementDescribedByMessage(t,o){const c=sP(t,"aria-describedby"),u=this._messageRegistry.get(o),f=u&&u.messageElement.id;return!!f&&-1!=c.indexOf(f)}_canBeDescribed(t,o){if(!this._isElementNode(t))return!1;if(o&&"object"==typeof o)return!0;const c=null==o?"":`${o}`.trim(),u=t.getAttribute("aria-label");return!(!c||u&&u.trim()===c)}_isElementNode(t){return t.nodeType===this._document.ELEMENT_NODE}static#e=this.\u0275fac=function(o){return new(o||e)(pe(Yt),pe(ro))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function dF(e,i){return"string"==typeof e?`${i||""}/${e}`:e}function dB(e,i){e.id||(e.id=`${lB}-${i}-${lF++}`)}function hB(e){return 0===e.buttons||0===e.offsetX&&0===e.offsetY}function pB(e){const i=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!(!i||-1!==i.identifier||null!=i.radiusX&&1!==i.radiusX||null!=i.radiusY&&1!==i.radiusY)}const x6=new De("cdk-input-modality-detector-options"),k6={ignoreKeys:[18,17,224,91,16]},Tv=Cv({passive:!0,capture:!0});let L6=(()=>{class e{get mostRecentModality(){return this._modality.value}constructor(t,o,c,u){this._platform=t,this._mostRecentTarget=null,this._modality=new Rr(null),this._lastTouchMs=0,this._onKeydown=f=>{this._options?.ignoreKeys?.some(g=>g===f.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=qh(f))},this._onMousedown=f=>{Date.now()-this._lastTouchMs<650||(this._modality.next(hB(f)?"keyboard":"mouse"),this._mostRecentTarget=qh(f))},this._onTouchstart=f=>{pB(f)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=qh(f))},this._options={...k6,...u},this.modalityDetected=this._modality.pipe(nB(1)),this.modalityChanged=this.modalityDetected.pipe(Yv()),t.isBrowser&&o.runOutsideAngular(()=>{c.addEventListener("keydown",this._onKeydown,Tv),c.addEventListener("mousedown",this._onMousedown,Tv),c.addEventListener("touchstart",this._onTouchstart,Tv)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Tv),document.removeEventListener("mousedown",this._onMousedown,Tv),document.removeEventListener("touchstart",this._onTouchstart,Tv))}static#e=this.\u0275fac=function(o){return new(o||e)(pe(ro),pe(lt),pe(Yt),pe(x6,8))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const U6=new De("cdk-focus-monitor-default-options"),cP=Cv({passive:!0,capture:!0});let uF=(()=>{class e{constructor(t,o,c,u,f){this._ngZone=t,this._platform=o,this._inputModalityDetector=c,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Gt,this._rootNodeFocusAndBlurListener=g=>{for(let S=qh(g);S;S=S.parentElement)"focus"===g.type?this._onFocus(g,S):this._onBlur(g,S)},this._document=u,this._detectionMode=f?.detectionMode||0}monitor(t,o=!1){const c=Kh(t);if(!this._platform.isBrowser||1!==c.nodeType)return He();const u=function a6(e){if(function s6(){if(null==iF){const e=typeof document<"u"?document.head:null;iF=!(!e||!e.createShadowRoot&&!e.attachShadow)}return iF}()){const i=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&i instanceof ShadowRoot)return i}return null}(c)||this._getDocument(),f=this._elementInfo.get(c);if(f)return o&&(f.checkChildren=!0),f.subject;const g={checkChildren:o,subject:new Gt,rootNode:u};return this._elementInfo.set(c,g),this._registerGlobalListeners(g),g.subject}stopMonitoring(t){const o=Kh(t),c=this._elementInfo.get(o);c&&(c.subject.complete(),this._setClasses(o),this._elementInfo.delete(o),this._removeGlobalListeners(c))}focusVia(t,o,c){const u=Kh(t);u===this._getDocument().activeElement?this._getClosestElementsInfo(u).forEach(([g,y])=>this._originChanged(g,o,y)):(this._setOrigin(o),"function"==typeof u.focus&&u.focus(c))}ngOnDestroy(){this._elementInfo.forEach((t,o)=>this.stopMonitoring(o))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(t){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(t)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:t&&this._isLastInteractionFromInputLabel(t)?"mouse":"program"}_shouldBeAttributedToTouch(t){return 1===this._detectionMode||!!t?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(t,o){t.classList.toggle("cdk-focused",!!o),t.classList.toggle("cdk-touch-focused","touch"===o),t.classList.toggle("cdk-keyboard-focused","keyboard"===o),t.classList.toggle("cdk-mouse-focused","mouse"===o),t.classList.toggle("cdk-program-focused","program"===o)}_setOrigin(t,o=!1){this._ngZone.runOutsideAngular(()=>{this._origin=t,this._originFromTouchInteraction="touch"===t&&o,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(t,o){const c=this._elementInfo.get(o),u=qh(t);!c||!c.checkChildren&&o!==u||this._originChanged(o,this._getFocusOrigin(u),c)}_onBlur(t,o){const c=this._elementInfo.get(o);!c||c.checkChildren&&t.relatedTarget instanceof Node&&o.contains(t.relatedTarget)||(this._setClasses(o),this._emitOrigin(c,null))}_emitOrigin(t,o){t.subject.observers.length&&this._ngZone.run(()=>t.subject.next(o))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;const o=t.rootNode,c=this._rootNodeFocusListenerCount.get(o)||0;c||this._ngZone.runOutsideAngular(()=>{o.addEventListener("focus",this._rootNodeFocusAndBlurListener,cP),o.addEventListener("blur",this._rootNodeFocusAndBlurListener,cP)}),this._rootNodeFocusListenerCount.set(o,c+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(No(this._stopInputModalityDetector)).subscribe(u=>{this._setOrigin(u,!0)}))}_removeGlobalListeners(t){const o=t.rootNode;if(this._rootNodeFocusListenerCount.has(o)){const c=this._rootNodeFocusListenerCount.get(o);c>1?this._rootNodeFocusListenerCount.set(o,c-1):(o.removeEventListener("focus",this._rootNodeFocusAndBlurListener,cP),o.removeEventListener("blur",this._rootNodeFocusAndBlurListener,cP),this._rootNodeFocusListenerCount.delete(o))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(t,o,c){this._setClasses(t,o),this._emitOrigin(c,o),this._lastFocusOrigin=o}_getClosestElementsInfo(t){const o=[];return this._elementInfo.forEach((c,u)=>{(u===t||c.checkChildren&&u.contains(t))&&o.push([u,c])}),o}_isLastInteractionFromInputLabel(t){const{_mostRecentTarget:o,mostRecentModality:c}=this._inputModalityDetector;if("mouse"!==c||!o||o===t||"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName||t.disabled)return!1;const u=t.labels;if(u)for(let f=0;f<u.length;f++)if(u[f].contains(o))return!0;return!1}static#e=this.\u0275fac=function(o){return new(o||e)(pe(lt),pe(ro),pe(L6),pe(Yt,8),pe(U6,8))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const mB="cdk-high-contrast-black-on-white",_B="cdk-high-contrast-white-on-black",hF="cdk-high-contrast-active";let gB=(()=>{class e{constructor(t,o){this._platform=t,this._document=o,this._breakpointSubscription=Oe(w6).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const o=this._document.defaultView||window,c=o&&o.getComputedStyle?o.getComputedStyle(t):null,u=(c&&c.backgroundColor||"").replace(/ /g,"");switch(t.remove(),u){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(hF,mB,_B),this._hasCheckedHighContrastMode=!0;const o=this.getHighContrastMode();1===o?t.add(hF,mB):2===o&&t.add(hF,_B)}}static#e=this.\u0275fac=function(o){return new(o||e)(pe(ro),pe(Yt))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),V6=(()=>{class e{constructor(t){t._applyBodyHighContrastModeCssClasses()}static#e=this.\u0275fac=function(o){return new(o||e)(pe(gB))};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[iB]})}return e})();const B6=new De("cdk-dir-doc",{providedIn:"root",factory:function j6(){return Oe(Yt)}}),H6=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let pF=(()=>{class e{constructor(t){this.value="ltr",this.change=new en,t&&(this.value=function G6(e){const i=e?.toLowerCase()||"";return"auto"===i&&typeof navigator<"u"&&navigator?.language?H6.test(navigator.language)?"rtl":"ltr":"rtl"===i?"rtl":"ltr"}((t.body?t.body.dir:null)||(t.documentElement?t.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}static#e=this.\u0275fac=function(o){return new(o||e)(pe(B6,8))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),n0=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})();const z6=new De("mat-sanity-checks",{providedIn:"root",factory:function W6(){return!0}});let Ga=(()=>{class e{constructor(t,o,c){this._sanityChecks=o,this._document=c,this._hasDoneGlobalChecks=!1,t._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!rF()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}static#e=this.\u0275fac=function(o){return new(o||e)(pe(gB),pe(z6,8),pe(Yt))};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[n0,n0]})}return e})();function yB(e){return class extends e{get disabled(){return this._disabled}set disabled(i){this._disabled=oa(i)}constructor(...i){super(...i),this._disabled=!1}}}function bB(e,i){return class extends e{get color(){return this._color}set color(t){const o=t||this.defaultColor;o!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),o&&this._elementRef.nativeElement.classList.add(`mat-${o}`),this._color=o)}constructor(...t){super(...t),this.defaultColor=i,this.color=i}}}function SB(e){return class extends e{get disableRipple(){return this._disableRipple}set disableRipple(i){this._disableRipple=oa(i)}constructor(...i){super(...i),this._disableRipple=!1}}}function q6(e,i=0){return class extends e{get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(t){this._tabIndex=null!=t?oF(t):this.defaultTabIndex}constructor(...t){super(...t),this._tabIndex=i,this.defaultTabIndex=i}}}function K6(e){return class extends e{updateErrorState(){const i=this.errorState,u=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);u!==i&&(this.errorState=u,this.stateChanges.next())}constructor(...i){super(...i),this.errorState=!1}}}let $6=(()=>{class e{isErrorState(t,o){return!!(t&&t.invalid&&(t.touched||o&&o.submitted))}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class X6{constructor(i,t,o,c=!1){this._renderer=i,this.element=t,this.config=o,this._animationForciblyDisabledThroughCss=c,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const CB=Cv({passive:!0,capture:!0});class J6{constructor(){this._events=new Map,this._delegateEventHandler=i=>{const t=qh(i);t&&this._events.get(i.type)?.forEach((o,c)=>{(c===t||c.contains(t))&&o.forEach(u=>u.handleEvent(i))})}}addHandler(i,t,o,c){const u=this._events.get(t);if(u){const f=u.get(o);f?f.add(c):u.set(o,new Set([c]))}else this._events.set(t,new Map([[o,new Set([c])]])),i.runOutsideAngular(()=>{document.addEventListener(t,this._delegateEventHandler,CB)})}removeHandler(i,t,o){const c=this._events.get(i);if(!c)return;const u=c.get(t);u&&(u.delete(o),0===u.size&&c.delete(t),0===c.size&&(this._events.delete(i),document.removeEventListener(i,this._delegateEventHandler,CB)))}}const TB={enterDuration:225,exitDuration:150},wB=Cv({passive:!0,capture:!0}),IB=["mousedown","touchstart"],RB=["mouseup","mouseleave","touchend","touchcancel"];class lP{static#e=this._eventManager=new J6;constructor(i,t,o,c){this._target=i,this._ngZone=t,this._platform=c,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,c.isBrowser&&(this._containerElement=Kh(o))}fadeInRipple(i,t,o={}){const c=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),u={...TB,...o.animation};o.centered&&(i=c.left+c.width/2,t=c.top+c.height/2);const f=o.radius||function Z6(e,i,t){const o=Math.max(Math.abs(e-t.left),Math.abs(e-t.right)),c=Math.max(Math.abs(i-t.top),Math.abs(i-t.bottom));return Math.sqrt(o*o+c*c)}(i,t,c),g=i-c.left,y=t-c.top,S=u.enterDuration,R=document.createElement("div");R.classList.add("mat-ripple-element"),R.style.left=g-f+"px",R.style.top=y-f+"px",R.style.height=2*f+"px",R.style.width=2*f+"px",null!=o.color&&(R.style.backgroundColor=o.color),R.style.transitionDuration=`${S}ms`,this._containerElement.appendChild(R);const k=window.getComputedStyle(R),G=k.transitionDuration,K="none"===k.transitionProperty||"0s"===G||"0s, 0s"===G||0===c.width&&0===c.height,ee=new X6(this,R,o,K);R.style.transform="scale3d(1, 1, 1)",ee.state=0,o.persistent||(this._mostRecentTransientRipple=ee);let de=null;return!K&&(S||u.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const ve=()=>this._finishRippleTransition(ee),ae=()=>this._destroyRipple(ee);R.addEventListener("transitionend",ve),R.addEventListener("transitioncancel",ae),de={onTransitionEnd:ve,onTransitionCancel:ae}}),this._activeRipples.set(ee,de),(K||!S)&&this._finishRippleTransition(ee),ee}fadeOutRipple(i){if(2===i.state||3===i.state)return;const t=i.element,o={...TB,...i.config.animation};t.style.transitionDuration=`${o.exitDuration}ms`,t.style.opacity="0",i.state=2,(i._animationForciblyDisabledThroughCss||!o.exitDuration)&&this._finishRippleTransition(i)}fadeOutAll(){this._getActiveRipples().forEach(i=>i.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(i=>{i.config.persistent||i.fadeOut()})}setupTriggerEvents(i){const t=Kh(i);!this._platform.isBrowser||!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,IB.forEach(o=>{lP._eventManager.addHandler(this._ngZone,o,t,this)}))}handleEvent(i){"mousedown"===i.type?this._onMousedown(i):"touchstart"===i.type?this._onTouchStart(i):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{RB.forEach(t=>{this._triggerElement.addEventListener(t,this,wB)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(i){0===i.state?this._startFadeOutTransition(i):2===i.state&&this._destroyRipple(i)}_startFadeOutTransition(i){const t=i===this._mostRecentTransientRipple,{persistent:o}=i.config;i.state=1,!o&&(!t||!this._isPointerDown)&&i.fadeOut()}_destroyRipple(i){const t=this._activeRipples.get(i)??null;this._activeRipples.delete(i),this._activeRipples.size||(this._containerRect=null),i===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),i.state=3,null!==t&&(i.element.removeEventListener("transitionend",t.onTransitionEnd),i.element.removeEventListener("transitioncancel",t.onTransitionCancel)),i.element.remove()}_onMousedown(i){const t=hB(i),o=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!t&&!o&&(this._isPointerDown=!0,this.fadeInRipple(i.clientX,i.clientY,this._target.rippleConfig))}_onTouchStart(i){if(!this._target.rippleDisabled&&!pB(i)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const t=i.changedTouches;if(t)for(let o=0;o<t.length;o++)this.fadeInRipple(t[o].clientX,t[o].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(i=>{!i.config.persistent&&(1===i.state||i.config.terminateOnPointerUp&&0===i.state)&&i.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const i=this._triggerElement;i&&(IB.forEach(t=>lP._eventManager.removeHandler(t,i,this)),this._pointerUpEventsRegistered&&RB.forEach(t=>i.removeEventListener(t,this,wB)))}}const AB=new De("mat-ripple-global-options");let DB=(()=>{class e{get disabled(){return this._disabled}set disabled(t){t&&this.fadeOutAllNonPersistent(),this._disabled=t,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(t){this._trigger=t,this._setupTriggerEventsIfEnabled()}constructor(t,o,c,u,f){this._elementRef=t,this._animationMode=f,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=u||{},this._rippleRenderer=new lP(this,o,t,c)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(t,o=0,c){return"number"==typeof t?this._rippleRenderer.fadeInRipple(t,o,{...this.rippleConfig,...c}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...t})}static#e=this.\u0275fac=function(o){return new(o||e)(re(bn),re(lt),re(ro),re(AB,8),re(ba,8))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(o,c){2&o&&Vt("mat-ripple-unbounded",c.unbounded)},inputs:{color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],radius:["matRippleRadius","radius"],animation:["matRippleAnimation","animation"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"]},exportAs:["matRipple"]})}return e})(),OB=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[Ga,Ga]})}return e})();const NB={capture:!0},PB=["focus","click","mouseenter","touchstart"],fF="mat-ripple-loader-uninitialized",mF="mat-ripple-loader-class-name",MB="mat-ripple-loader-centered",dP="mat-ripple-loader-disabled";let e8=(()=>{class e{constructor(){this._document=Oe(Yt,{optional:!0}),this._animationMode=Oe(ba,{optional:!0}),this._globalRippleOptions=Oe(AB,{optional:!0}),this._platform=Oe(ro),this._ngZone=Oe(lt),this._onInteraction=t=>{if(!(t.target instanceof HTMLElement))return;const c=t.target.closest(`[${fF}]`);c&&this.createRipple(c)},this._ngZone.runOutsideAngular(()=>{for(const t of PB)this._document?.addEventListener(t,this._onInteraction,NB)})}ngOnDestroy(){for(const t of PB)this._document?.removeEventListener(t,this._onInteraction,NB)}configureRipple(t,o){t.setAttribute(fF,""),(o.className||!t.hasAttribute(mF))&&t.setAttribute(mF,o.className||""),o.centered&&t.setAttribute(MB,""),o.disabled&&t.setAttribute(dP,"")}getRipple(t){return t.matRipple?t.matRipple:this.createRipple(t)}setDisabled(t,o){const c=t.matRipple;c?c.disabled=o:o?t.setAttribute(dP,""):t.removeAttribute(dP)}createRipple(t){if(!this._document)return;t.querySelector(".mat-ripple")?.remove();const o=this._document.createElement("span");o.classList.add("mat-ripple",t.getAttribute(mF)),t.append(o);const c=new DB(new bn(o),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return c._isInitialized=!0,c.trigger=t,c.centered=t.hasAttribute(MB),c.disabled=t.hasAttribute(dP),this.attachRipple(t,c),c}attachRipple(t,o){t.removeAttribute(fF),t.matRipple=o}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const t8=["mat-button",""],n8=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],i8=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"],r8=[{selector:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{selector:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{selector:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{selector:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{selector:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{selector:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{selector:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],o8=bB(yB(SB(class{constructor(e){this._elementRef=e}})));let s8=(()=>{class e extends o8{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(t){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,t)}get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=oa(t),this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(t){this._disabled=oa(t),this._updateRippleDisabled()}constructor(t,o,c,u){super(t),this._platform=o,this._ngZone=c,this._animationMode=u,this._focusMonitor=Oe(uF),this._rippleLoader=Oe(e8),this._isFab=!1,this._disableRipple=!1,this._disabled=!1,this._rippleLoader?.configureRipple(this._elementRef.nativeElement,{className:"mat-mdc-button-ripple"});const f=t.nativeElement.classList;for(const g of r8)this._hasHostAttributes(g.selector)&&g.mdcClasses.forEach(y=>{f.add(y)})}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(t="program",o){t?this._focusMonitor.focusVia(this._elementRef.nativeElement,t,o):this._elementRef.nativeElement.focus(o)}_hasHostAttributes(...t){return t.some(o=>this._elementRef.nativeElement.hasAttribute(o))}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}static#e=this.\u0275fac=function(o){sd()};static#t=this.\u0275dir=Ge({type:e,features:[Ne]})}return e})(),c8=(()=>{class e extends s8{constructor(t,o,c,u){super(t,o,c,u)}static#e=this.\u0275fac=function(o){return new(o||e)(re(bn),re(ro),re(lt),re(ba,8))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:7,hostBindings:function(o,c){2&o&&(ri("disabled",c.disabled||null),Vt("_mat-animation-noopable","NoopAnimations"===c._animationMode)("mat-unthemed",!c.color)("mat-mdc-button-base",!0))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[Ne],attrs:t8,ngContentSelectors:i8,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(o,c){1&o&&(pd(n8),wt(0,"span",0),nr(1),Pe(2,"span",1),nr(3,1),Re(),nr(4,2),wt(5,"span",2)(6,"span",3)),2&o&&Vt("mdc-button__ripple",!c._isFab)("mdc-fab__ripple",c._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(\n      100% + 4px\n    );width:calc(\n      100% + 4px\n    );display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{height:var(--mdc-text-button-container-height, 36px);border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color, inherit)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button{height:var(--mdc-filled-button-container-height, 36px);border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color, transparent)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color, inherit)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button{height:var(--mdc-protected-button-container-height, 36px);border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px));box-shadow:var(--mdc-protected-button-container-elevation, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color, transparent)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color, rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color, inherit)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-raised-button.mdc-ripple-upgraded--background-focused,.mat-mdc-raised-button:not(.mdc-ripple-upgraded):focus{box-shadow:var(--mdc-protected-button-focus-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation, 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:not(:disabled):active{box-shadow:var(--mdc-protected-button-pressed-container-elevation, 0px 5px 5px -3px rgba(0, 0, 0, 0.2), 0px 8px 10px 1px rgba(0, 0, 0, 0.14), 0px 3px 14px 2px rgba(0, 0, 0, 0.12))}.mat-mdc-raised-button:disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation, 0px 0px 0px 0px rgba(0, 0, 0, 0.2), 0px 0px 0px 0px rgba(0, 0, 0, 0.14), 0px 0px 0px 0px rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button{height:var(--mdc-outlined-button-container-height, 36px);border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px));padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color, inherit)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color, rgba(0, 0, 0, 0.38))}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape, var(--mdc-shape-small, 4px))}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color, rgba(0, 0, 0, 0.12))}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width, 1px)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width, 1px));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width, 1px))}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0;background-color:var(--mat-mdc-button-persistent-ripple-color)}.mat-mdc-button .mat-ripple-element,.mat-mdc-unelevated-button .mat-ripple-element,.mat-mdc-raised-button .mat-ripple-element,.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-mdc-button-ripple-color)}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button[disabled],.mat-mdc-unelevated-button[disabled],.mat-mdc-raised-button[disabled],.mat-mdc-outlined-button[disabled]{cursor:default;pointer-events:none}.mat-mdc-button .mat-mdc-button-touch-target,.mat-mdc-unelevated-button .mat-mdc-button-touch-target,.mat-mdc-raised-button .mat-mdc-button-touch-target,.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}[dir=rtl] .mat-mdc-button>.mat-icon,.mat-mdc-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}.mat-mdc-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon,.mat-mdc-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem;margin-left:-4px;margin-right:8px}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:-4px}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon,.mat-mdc-raised-button .mdc-button__label+.mat-icon,.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:-4px}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon,.mat-mdc-unelevated-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-raised-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-outlined-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:-4px;margin-right:8px}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px) * -1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px) * -1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0})}return e})(),d8=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[Ga,OB,Ga]})}return e})();const xB=Cv({passive:!0});let u8=(()=>{class e{constructor(t,o){this._platform=t,this._ngZone=o,this._monitoredElements=new Map}monitor(t){if(!this._platform.isBrowser)return ks;const o=Kh(t),c=this._monitoredElements.get(o);if(c)return c.subject;const u=new Gt,f="cdk-text-field-autofilled",g=y=>{"cdk-text-field-autofill-start"!==y.animationName||o.classList.contains(f)?"cdk-text-field-autofill-end"===y.animationName&&o.classList.contains(f)&&(o.classList.remove(f),this._ngZone.run(()=>u.next({target:y.target,isAutofilled:!1}))):(o.classList.add(f),this._ngZone.run(()=>u.next({target:y.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{o.addEventListener("animationstart",g,xB),o.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(o,{subject:u,unlisten:()=>{o.removeEventListener("animationstart",g,xB)}}),u}stopMonitoring(t){const o=Kh(t),c=this._monitoredElements.get(o);c&&(c.unlisten(),c.subject.complete(),o.classList.remove("cdk-text-field-autofill-monitored"),o.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(o))}ngOnDestroy(){this._monitoredElements.forEach((t,o)=>this.stopMonitoring(o))}static#e=this.\u0275fac=function(o){return new(o||e)(pe(ro),pe(lt))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),h8=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})();class p8 extends Gt{constructor(i=1/0,t=1/0,o=aF){super(),this._bufferSize=i,this._windowTime=t,this._timestampProvider=o,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,i),this._windowTime=Math.max(1,t)}next(i){const{isStopped:t,_buffer:o,_infiniteTimeWindow:c,_timestampProvider:u,_windowTime:f}=this;t||(o.push(i),!c&&o.push(u.now()+f)),this._trimBuffer(),super.next(i)}_subscribe(i){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(i),{_infiniteTimeWindow:o,_buffer:c}=this,u=c.slice();for(let f=0;f<u.length&&!i.closed;f+=o?1:2)i.next(u[f]);return this._checkFinalizedStatuses(i),t}_trimBuffer(){const{_bufferSize:i,_timestampProvider:t,_buffer:o,_infiniteTimeWindow:c}=this,u=(c?1:2)*i;if(i<1/0&&u<o.length&&o.splice(0,o.length-u),!c){const f=t.now();let g=0;for(let y=1;y<o.length&&o[y]<=f;y+=2)g=y;g&&o.splice(0,g+1)}}}class m8{constructor(i){this._box=i,this._destroyed=new Gt,this._resizeSubject=new Gt,this._elementObservables=new Map,typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(t=>this._resizeSubject.next(t)))}observe(i){return this._elementObservables.has(i)||this._elementObservables.set(i,new Ln(t=>{const o=this._resizeSubject.subscribe(t);return this._resizeObserver?.observe(i,{box:this._box}),()=>{this._resizeObserver?.unobserve(i),o.unsubscribe(),this._elementObservables.delete(i)}}).pipe(ra(t=>t.some(o=>o.target===i)),function f8(e,i,t){let o,c=!1;return e&&"object"==typeof e?({bufferSize:o=1/0,windowTime:i=1/0,refCount:c=!1,scheduler:t}=e):o=e??1/0,$a({connector:()=>new p8(o,i,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:c})}({bufferSize:1,refCount:!0}),No(this._destroyed))),this._elementObservables.get(i)}destroy(){this._destroyed.next(),this._destroyed.complete(),this._resizeSubject.complete(),this._elementObservables.clear()}}let _8=(()=>{class e{constructor(){this._observers=new Map,this._ngZone=Oe(lt)}ngOnDestroy(){for(const[,t]of this._observers)t.destroy();this._observers.clear()}observe(t,o){const c=o?.box||"content-box";return this._observers.has(c)||this._observers.set(c,new m8(c)),this._observers.get(c).observe(t)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class kB{}class g8{}const Xd="*";function _F(e,i){return{type:7,name:e,definitions:i,options:{}}}function o0(e,i=null){return{type:4,styles:i,timings:e}}function LB(e,i=null){return{type:2,steps:e,options:i}}function xl(e){return{type:6,styles:e,offset:null}}function gF(e,i,t){return{type:0,name:e,styles:i,options:t}}function s0(e,i,t=null){return{type:1,expr:e,animation:i,options:t}}class a0{constructor(i=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=i+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}onStart(i){this._originalOnStartFns.push(i),this._onStartFns.push(i)}onDone(i){this._originalOnDoneFns.push(i),this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(i=>i()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(i){this._position=this.totalTime?i*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(i){const t="start"==i?this._onStartFns:this._onDoneFns;t.forEach(o=>o()),t.length=0}}class FB{constructor(i){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=i;let t=0,o=0,c=0;const u=this.players.length;0==u?queueMicrotask(()=>this._onFinish()):this.players.forEach(f=>{f.onDone(()=>{++t==u&&this._onFinish()}),f.onDestroy(()=>{++o==u&&this._onDestroy()}),f.onStart(()=>{++c==u&&this._onStart()})}),this.totalTime=this.players.reduce((f,g)=>Math.max(f,g.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}init(){this.players.forEach(i=>i.init())}onStart(i){this._onStartFns.push(i)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(i=>i()),this._onStartFns=[])}onDone(i){this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(i=>i.play())}pause(){this.players.forEach(i=>i.pause())}restart(){this.players.forEach(i=>i.restart())}finish(){this._onFinish(),this.players.forEach(i=>i.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(i=>i.destroy()),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}reset(){this.players.forEach(i=>i.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(i){const t=i*this.totalTime;this.players.forEach(o=>{const c=o.totalTime?Math.min(1,t/o.totalTime):1;o.setPosition(c)})}getPosition(){const i=this.players.reduce((t,o)=>null===t||o.totalTime>t.totalTime?o:t,null);return null!=i?i.getPosition():0}beforeDestroy(){this.players.forEach(i=>{i.beforeDestroy&&i.beforeDestroy()})}triggerCallback(i){const t="start"==i?this._onStartFns:this._onDoneFns;t.forEach(o=>o()),t.length=0}}const E8=["notch"],v8=["matFormFieldNotchedOutline",""],y8=["*"],b8=["textField"],S8=["iconPrefixContainer"],C8=["textPrefixContainer"];function T8(e,i){1&e&&wt(0,"span",19)}function w8(e,i){if(1&e&&(Pe(0,"label",17),nr(1,1),Fe(2,T8,1,0,"span",18),Re()),2&e){const t=nn(2);Qe("floating",t._shouldLabelFloat())("monitorResize",t._hasOutline())("id",t._labelId),ri("for",t._control.id),Je(2),Qe("ngIf",!t.hideRequiredMarker&&t._control.required)}}function I8(e,i){1&e&&Fe(0,w8,3,5,"label",16),2&e&&Qe("ngIf",nn()._hasFloatingLabel())}function R8(e,i){1&e&&wt(0,"div",20)}function A8(e,i){}function D8(e,i){1&e&&Fe(0,A8,0,0,"ng-template",22),2&e&&(nn(2),Qe("ngTemplateOutlet",dd(1)))}function O8(e,i){if(1&e&&(Pe(0,"div",21),Fe(1,D8,1,1,"ng-template",9),Re()),2&e){const t=nn();Qe("matFormFieldNotchedOutlineOpen",t._shouldLabelFloat()),Je(1),Qe("ngIf",!t._forceDisplayInfixLabel())}}function N8(e,i){1&e&&(Pe(0,"div",23,24),nr(2,2),Re())}function P8(e,i){1&e&&(Pe(0,"div",25,26),nr(2,3),Re())}function M8(e,i){}function x8(e,i){1&e&&Fe(0,M8,0,0,"ng-template",22),2&e&&(nn(),Qe("ngTemplateOutlet",dd(1)))}function k8(e,i){1&e&&(Pe(0,"div",27),nr(1,4),Re())}function L8(e,i){1&e&&(Pe(0,"div",28),nr(1,5),Re())}function F8(e,i){1&e&&wt(0,"div",29)}function U8(e,i){1&e&&(Pe(0,"div",30),nr(1,6),Re()),2&e&&Qe("@transitionMessages",nn()._subscriptAnimationState)}function V8(e,i){if(1&e&&(Pe(0,"mat-hint",34),Or(1),Re()),2&e){const t=nn(2);Qe("id",t._hintLabelId),Je(1),uc(t.hintLabel)}}function B8(e,i){if(1&e&&(Pe(0,"div",31),Fe(1,V8,2,2,"mat-hint",32),nr(2,7),wt(3,"div",33),nr(4,8),Re()),2&e){const t=nn();Qe("@transitionMessages",t._subscriptAnimationState),Je(1),Qe("ngIf",t.hintLabel)}}const j8=["*",[["mat-label"]],[["","matPrefix",""],["","matIconPrefix",""]],[["","matTextPrefix",""]],[["","matTextSuffix",""]],[["","matSuffix",""],["","matIconSuffix",""]],[["mat-error"],["","matError",""]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],H8=["*","mat-label","[matPrefix], [matIconPrefix]","[matTextPrefix]","[matTextSuffix]","[matSuffix], [matIconSuffix]","mat-error, [matError]","mat-hint:not([align='end'])","mat-hint[align='end']"];let vF=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ge({type:e,selectors:[["mat-label"]]})}return e})();const G8=new De("MatError");let W8=0,UB=(()=>{class e{constructor(){this.align="start",this.id="mat-mdc-hint-"+W8++}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ge({type:e,selectors:[["mat-hint"]],hostAttrs:[1,"mat-mdc-form-field-hint","mat-mdc-form-field-bottom-align"],hostVars:4,hostBindings:function(o,c){2&o&&(hh("id",c.id),ri("align",null),Vt("mat-mdc-form-field-hint-end","end"===c.align))},inputs:{align:"align",id:"id"}})}return e})();const z8=new De("MatPrefix"),q8=new De("MatSuffix"),VB=new De("FloatingLabelParent");let BB=(()=>{class e{get floating(){return this._floating}set floating(t){this._floating=t,this.monitorResize&&this._handleResize()}get monitorResize(){return this._monitorResize}set monitorResize(t){this._monitorResize=t,this._monitorResize?this._subscribeToResize():this._resizeSubscription.unsubscribe()}constructor(t){this._elementRef=t,this._floating=!1,this._monitorResize=!1,this._resizeObserver=Oe(_8),this._ngZone=Oe(lt),this._parent=Oe(VB),this._resizeSubscription=new Dn}ngOnDestroy(){this._resizeSubscription.unsubscribe()}getWidth(){return function K8(e){if(null!==e.offsetParent)return e.scrollWidth;const t=e.cloneNode(!0);t.style.setProperty("position","absolute"),t.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(t);const o=t.scrollWidth;return t.remove(),o}(this._elementRef.nativeElement)}get element(){return this._elementRef.nativeElement}_handleResize(){setTimeout(()=>this._parent._handleLabelResized())}_subscribeToResize(){this._resizeSubscription.unsubscribe(),this._ngZone.runOutsideAngular(()=>{this._resizeSubscription=this._resizeObserver.observe(this._elementRef.nativeElement,{box:"border-box"}).subscribe(()=>this._handleResize())})}static#e=this.\u0275fac=function(o){return new(o||e)(re(bn))};static#t=this.\u0275dir=Ge({type:e,selectors:[["label","matFormFieldFloatingLabel",""]],hostAttrs:[1,"mdc-floating-label","mat-mdc-floating-label"],hostVars:2,hostBindings:function(o,c){2&o&&Vt("mdc-floating-label--float-above",c.floating)},inputs:{floating:"floating",monitorResize:"monitorResize"}})}return e})();const jB="mdc-line-ripple--active",uP="mdc-line-ripple--deactivating";let HB=(()=>{class e{constructor(t,o){this._elementRef=t,this._handleTransitionEnd=c=>{const u=this._elementRef.nativeElement.classList,f=u.contains(uP);"opacity"===c.propertyName&&f&&u.remove(jB,uP)},o.runOutsideAngular(()=>{t.nativeElement.addEventListener("transitionend",this._handleTransitionEnd)})}activate(){const t=this._elementRef.nativeElement.classList;t.remove(uP),t.add(jB)}deactivate(){this._elementRef.nativeElement.classList.add(uP)}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._handleTransitionEnd)}static#e=this.\u0275fac=function(o){return new(o||e)(re(bn),re(lt))};static#t=this.\u0275dir=Ge({type:e,selectors:[["div","matFormFieldLineRipple",""]],hostAttrs:[1,"mdc-line-ripple"]})}return e})(),GB=(()=>{class e{constructor(t,o){this._elementRef=t,this._ngZone=o,this.open=!1}ngAfterViewInit(){const t=this._elementRef.nativeElement.querySelector(".mdc-floating-label");t?(this._elementRef.nativeElement.classList.add("mdc-notched-outline--upgraded"),"function"==typeof requestAnimationFrame&&(t.style.transitionDuration="0s",this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>t.style.transitionDuration="")}))):this._elementRef.nativeElement.classList.add("mdc-notched-outline--no-label")}_setNotchWidth(t){this._notch.nativeElement.style.width=this.open&&t?`calc(${t}px * var(--mat-mdc-form-field-floating-label-scale, 0.75) + 9px)`:""}static#e=this.\u0275fac=function(o){return new(o||e)(re(bn),re(lt))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["div","matFormFieldNotchedOutline",""]],viewQuery:function(o,c){if(1&o&&Js(E8,5),2&o){let u;$e(u=ji())&&(c._notch=u.first)}},hostAttrs:[1,"mdc-notched-outline"],hostVars:2,hostBindings:function(o,c){2&o&&Vt("mdc-notched-outline--notched",c.open)},inputs:{open:["matFormFieldNotchedOutlineOpen","open"]},attrs:v8,ngContentSelectors:y8,decls:5,vars:0,consts:[[1,"mdc-notched-outline__leading"],[1,"mdc-notched-outline__notch"],["notch",""],[1,"mdc-notched-outline__trailing"]],template:function(o,c){1&o&&(pd(),wt(0,"div",0),Pe(1,"div",1,2),nr(3),Re(),wt(4,"div",3))},encapsulation:2,changeDetection:0})}return e})();const Y8={transitionMessages:_F("transitionMessages",[gF("enter",xl({opacity:1,transform:"translateY(0%)"})),s0("void => enter",[xl({opacity:0,transform:"translateY(-5px)"}),o0("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])};let WB=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ge({type:e})}return e})();const zB=new De("MatFormField"),$8=new De("MAT_FORM_FIELD_DEFAULT_OPTIONS");let qB=0,Q8=(()=>{class e{get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(t){this._hideRequiredMarker=oa(t)}get floatLabel(){return this._floatLabel||this._defaults?.floatLabel||"auto"}set floatLabel(t){t!==this._floatLabel&&(this._floatLabel=t,this._changeDetectorRef.markForCheck())}get appearance(){return this._appearance}set appearance(t){const o=this._appearance;this._appearance=t||this._defaults?.appearance||"fill","outline"===this._appearance&&this._appearance!==o&&(this._needsOutlineLabelOffsetUpdateOnStable=!0)}get subscriptSizing(){return this._subscriptSizing||this._defaults?.subscriptSizing||"fixed"}set subscriptSizing(t){this._subscriptSizing=t||this._defaults?.subscriptSizing||"fixed"}get hintLabel(){return this._hintLabel}set hintLabel(t){this._hintLabel=t,this._processHints()}get _control(){return this._explicitFormFieldControl||this._formFieldControl}set _control(t){this._explicitFormFieldControl=t}constructor(t,o,c,u,f,g,y,S){this._elementRef=t,this._changeDetectorRef=o,this._ngZone=c,this._dir=u,this._platform=f,this._defaults=g,this._animationMode=y,this._hideRequiredMarker=!1,this.color="primary",this._appearance="fill",this._subscriptSizing=null,this._hintLabel="",this._hasIconPrefix=!1,this._hasTextPrefix=!1,this._hasIconSuffix=!1,this._hasTextSuffix=!1,this._labelId="mat-mdc-form-field-label-"+qB++,this._hintLabelId="mat-mdc-hint-"+qB++,this._subscriptAnimationState="",this._destroyed=new Gt,this._isFocused=null,this._needsOutlineLabelOffsetUpdateOnStable=!1,g&&(g.appearance&&(this.appearance=g.appearance),this._hideRequiredMarker=!!g?.hideRequiredMarker,g.color&&(this.color=g.color))}ngAfterViewInit(){this._updateFocusState(),this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngAfterContentInit(){this._assertFormFieldControl(),this._initializeControl(),this._initializeSubscript(),this._initializePrefixAndSuffix(),this._initializeOutlineLabelOffsetSubscriptions()}ngAfterContentChecked(){this._assertFormFieldControl()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._textField||this._elementRef}_animateAndLockLabel(){this._hasFloatingLabel()&&(this.floatLabel="always")}_initializeControl(){const t=this._control;t.controlType&&this._elementRef.nativeElement.classList.add(`mat-mdc-form-field-type-${t.controlType}`),t.stateChanges.subscribe(()=>{this._updateFocusState(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),t.ngControl&&t.ngControl.valueChanges&&t.ngControl.valueChanges.pipe(No(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck())}_checkPrefixAndSuffixTypes(){this._hasIconPrefix=!!this._prefixChildren.find(t=>!t._isText),this._hasTextPrefix=!!this._prefixChildren.find(t=>t._isText),this._hasIconSuffix=!!this._suffixChildren.find(t=>!t._isText),this._hasTextSuffix=!!this._suffixChildren.find(t=>t._isText)}_initializePrefixAndSuffix(){this._checkPrefixAndSuffixTypes(),Kv(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._checkPrefixAndSuffixTypes(),this._changeDetectorRef.markForCheck()})}_initializeSubscript(){this._hintChildren.changes.subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._validateHints(),this._syncDescribedByIds()}_assertFormFieldControl(){}_updateFocusState(){this._control.focused&&!this._isFocused?(this._isFocused=!0,this._lineRipple?.activate()):!this._control.focused&&(this._isFocused||null===this._isFocused)&&(this._isFocused=!1,this._lineRipple?.deactivate()),this._textField?.nativeElement.classList.toggle("mdc-text-field--focused",this._control.focused)}_initializeOutlineLabelOffsetSubscriptions(){this._prefixChildren.changes.subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(No(this._destroyed)).subscribe(()=>{this._needsOutlineLabelOffsetUpdateOnStable&&(this._needsOutlineLabelOffsetUpdateOnStable=!1,this._updateOutlineLabelOffset())})}),this._dir.change.pipe(No(this._destroyed)).subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0)}_shouldAlwaysFloat(){return"always"===this.floatLabel}_hasOutline(){return"outline"===this.appearance}_forceDisplayInfixLabel(){return!this._platform.isBrowser&&this._prefixChildren.length&&!this._shouldLabelFloat()}_hasFloatingLabel(){return!!this._labelChildNonStatic||!!this._labelChildStatic}_shouldLabelFloat(){return this._control.shouldLabelFloat||this._shouldAlwaysFloat()}_shouldForward(t){const o=this._control?this._control.ngControl:null;return o&&o[t]}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_handleLabelResized(){this._refreshOutlineNotchWidth()}_refreshOutlineNotchWidth(){this._hasOutline()&&this._floatingLabel&&this._shouldLabelFloat()?this._notchedOutline?._setNotchWidth(this._floatingLabel.getWidth()):this._notchedOutline?._setNotchWidth(0)}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){}_syncDescribedByIds(){if(this._control){let t=[];if(this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&t.push(...this._control.userAriaDescribedBy.split(" ")),"hint"===this._getDisplayedMessages()){const o=this._hintChildren?this._hintChildren.find(u=>"start"===u.align):null,c=this._hintChildren?this._hintChildren.find(u=>"end"===u.align):null;o?t.push(o.id):this._hintLabel&&t.push(this._hintLabelId),c&&t.push(c.id)}else this._errorChildren&&t.push(...this._errorChildren.map(o=>o.id));this._control.setDescribedByIds(t)}}_updateOutlineLabelOffset(){if(!this._platform.isBrowser||!this._hasOutline()||!this._floatingLabel)return;const t=this._floatingLabel.element;if(!this._iconPrefixContainer&&!this._textPrefixContainer)return void(t.style.transform="");if(!this._isAttachedToDom())return void(this._needsOutlineLabelOffsetUpdateOnStable=!0);const o=this._iconPrefixContainer?.nativeElement,c=this._textPrefixContainer?.nativeElement,u=o?.getBoundingClientRect().width??0,f=c?.getBoundingClientRect().width??0;t.style.transform=`var(\n        --mat-mdc-form-field-label-transform,\n        translateY(-50%) translateX(calc(${"rtl"===this._dir.value?"-1":"1"} * (${u+f}px + var(--mat-mdc-form-field-label-offset-x, 0px))))\n    )`}_isAttachedToDom(){const t=this._elementRef.nativeElement;if(t.getRootNode){const o=t.getRootNode();return o&&o!==t}return document.documentElement.contains(t)}static#e=this.\u0275fac=function(o){return new(o||e)(re(bn),re(rr),re(lt),re(pF),re(ro),re($8,8),re(ba,8),re(Yt))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["mat-form-field"]],contentQueries:function(o,c,u){if(1&o&&(ka(u,vF,5),ka(u,vF,7),ka(u,WB,5),ka(u,z8,5),ka(u,q8,5),ka(u,G8,5),ka(u,UB,5)),2&o){let f;$e(f=ji())&&(c._labelChildNonStatic=f.first),$e(f=ji())&&(c._labelChildStatic=f.first),$e(f=ji())&&(c._formFieldControl=f.first),$e(f=ji())&&(c._prefixChildren=f),$e(f=ji())&&(c._suffixChildren=f),$e(f=ji())&&(c._errorChildren=f),$e(f=ji())&&(c._hintChildren=f)}},viewQuery:function(o,c){if(1&o&&(Js(b8,5),Js(S8,5),Js(C8,5),Js(BB,5),Js(GB,5),Js(HB,5)),2&o){let u;$e(u=ji())&&(c._textField=u.first),$e(u=ji())&&(c._iconPrefixContainer=u.first),$e(u=ji())&&(c._textPrefixContainer=u.first),$e(u=ji())&&(c._floatingLabel=u.first),$e(u=ji())&&(c._notchedOutline=u.first),$e(u=ji())&&(c._lineRipple=u.first)}},hostAttrs:[1,"mat-mdc-form-field"],hostVars:42,hostBindings:function(o,c){2&o&&Vt("mat-mdc-form-field-label-always-float",c._shouldAlwaysFloat())("mat-mdc-form-field-has-icon-prefix",c._hasIconPrefix)("mat-mdc-form-field-has-icon-suffix",c._hasIconSuffix)("mat-form-field-invalid",c._control.errorState)("mat-form-field-disabled",c._control.disabled)("mat-form-field-autofilled",c._control.autofilled)("mat-form-field-no-animations","NoopAnimations"===c._animationMode)("mat-form-field-appearance-fill","fill"==c.appearance)("mat-form-field-appearance-outline","outline"==c.appearance)("mat-form-field-hide-placeholder",c._hasFloatingLabel()&&!c._shouldLabelFloat())("mat-focused",c._control.focused)("mat-primary","accent"!==c.color&&"warn"!==c.color)("mat-accent","accent"===c.color)("mat-warn","warn"===c.color)("ng-untouched",c._shouldForward("untouched"))("ng-touched",c._shouldForward("touched"))("ng-pristine",c._shouldForward("pristine"))("ng-dirty",c._shouldForward("dirty"))("ng-valid",c._shouldForward("valid"))("ng-invalid",c._shouldForward("invalid"))("ng-pending",c._shouldForward("pending"))},inputs:{hideRequiredMarker:"hideRequiredMarker",color:"color",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",hintLabel:"hintLabel"},exportAs:["matFormField"],features:[Lt([{provide:zB,useExisting:e},{provide:VB,useExisting:e}])],ngContentSelectors:H8,decls:18,vars:23,consts:[["labelTemplate",""],[1,"mat-mdc-text-field-wrapper","mdc-text-field",3,"click"],["textField",""],["class","mat-mdc-form-field-focus-overlay",4,"ngIf"],[1,"mat-mdc-form-field-flex"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen",4,"ngIf"],["class","mat-mdc-form-field-icon-prefix",4,"ngIf"],["class","mat-mdc-form-field-text-prefix",4,"ngIf"],[1,"mat-mdc-form-field-infix"],[3,"ngIf"],["class","mat-mdc-form-field-text-suffix",4,"ngIf"],["class","mat-mdc-form-field-icon-suffix",4,"ngIf"],["matFormFieldLineRipple","",4,"ngIf"],[1,"mat-mdc-form-field-subscript-wrapper","mat-mdc-form-field-bottom-align",3,"ngSwitch"],["class","mat-mdc-form-field-error-wrapper",4,"ngSwitchCase"],["class","mat-mdc-form-field-hint-wrapper",4,"ngSwitchCase"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id",4,"ngIf"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id"],["aria-hidden","true","class","mat-mdc-form-field-required-marker mdc-floating-label--required",4,"ngIf"],["aria-hidden","true",1,"mat-mdc-form-field-required-marker","mdc-floating-label--required"],[1,"mat-mdc-form-field-focus-overlay"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen"],[3,"ngTemplateOutlet"],[1,"mat-mdc-form-field-icon-prefix"],["iconPrefixContainer",""],[1,"mat-mdc-form-field-text-prefix"],["textPrefixContainer",""],[1,"mat-mdc-form-field-text-suffix"],[1,"mat-mdc-form-field-icon-suffix"],["matFormFieldLineRipple",""],[1,"mat-mdc-form-field-error-wrapper"],[1,"mat-mdc-form-field-hint-wrapper"],[3,"id",4,"ngIf"],[1,"mat-mdc-form-field-hint-spacer"],[3,"id"]],template:function(o,c){1&o&&(pd(j8),Fe(0,I8,1,1,"ng-template",null,0,Pf),Pe(2,"div",1,2),tn("click",function(f){return c._control.onContainerClick(f)}),Fe(4,R8,1,0,"div",3),Pe(5,"div",4),Fe(6,O8,2,2,"div",5),Fe(7,N8,3,0,"div",6),Fe(8,P8,3,0,"div",7),Pe(9,"div",8),Fe(10,x8,1,1,"ng-template",9),nr(11),Re(),Fe(12,k8,2,0,"div",10),Fe(13,L8,2,0,"div",11),Re(),Fe(14,F8,1,0,"div",12),Re(),Pe(15,"div",13),Fe(16,U8,2,1,"div",14),Fe(17,B8,5,2,"div",15),Re()),2&o&&(Je(2),Vt("mdc-text-field--filled",!c._hasOutline())("mdc-text-field--outlined",c._hasOutline())("mdc-text-field--no-label",!c._hasFloatingLabel())("mdc-text-field--disabled",c._control.disabled)("mdc-text-field--invalid",c._control.errorState),Je(2),Qe("ngIf",!c._hasOutline()&&!c._control.disabled),Je(2),Qe("ngIf",c._hasOutline()),Je(1),Qe("ngIf",c._hasIconPrefix),Je(1),Qe("ngIf",c._hasTextPrefix),Je(2),Qe("ngIf",!c._hasOutline()||c._forceDisplayInfixLabel()),Je(2),Qe("ngIf",c._hasTextSuffix),Je(1),Qe("ngIf",c._hasIconSuffix),Je(1),Qe("ngIf",!c._hasOutline()),Je(1),Vt("mat-mdc-form-field-subscript-dynamic-size","dynamic"===c.subscriptSizing),Qe("ngSwitch",c._getDisplayedMessages()),Je(1),Qe("ngSwitchCase","error"),Je(1),Qe("ngSwitchCase","hint"))},dependencies:[Gd,cn,Fh,Uh,UB,BB,GB,HB],styles:['.mdc-text-field{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:0;border-bottom-left-radius:0;display:inline-flex;align-items:baseline;padding:0 16px;position:relative;box-sizing:border-box;overflow:hidden;will-change:opacity,transform,color}.mdc-text-field .mdc-floating-label{top:50%;transform:translateY(-50%);pointer-events:none}.mdc-text-field__input{height:28px;width:100%;min-width:0;border:none;border-radius:0;background:none;appearance:none;padding:0}.mdc-text-field__input::-ms-clear{display:none}.mdc-text-field__input::-webkit-calendar-picker-indicator{display:none}.mdc-text-field__input:focus{outline:none}.mdc-text-field__input:invalid{box-shadow:none}@media all{.mdc-text-field__input::placeholder{opacity:0}}@media all{.mdc-text-field__input:-ms-input-placeholder{opacity:0}}@media all{.mdc-text-field--no-label .mdc-text-field__input::placeholder,.mdc-text-field--focused .mdc-text-field__input::placeholder{opacity:1}}@media all{.mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{opacity:1}}.mdc-text-field__affix{height:28px;opacity:0;white-space:nowrap}.mdc-text-field--label-floating .mdc-text-field__affix,.mdc-text-field--no-label .mdc-text-field__affix{opacity:1}@supports(-webkit-hyphens: none){.mdc-text-field--outlined .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field__affix--prefix,.mdc-text-field__affix--prefix[dir=rtl]{padding-left:2px;padding-right:0}.mdc-text-field--end-aligned .mdc-text-field__affix--prefix{padding-left:0;padding-right:12px}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--end-aligned .mdc-text-field__affix--prefix[dir=rtl]{padding-left:12px;padding-right:0}.mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field__affix--suffix,.mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:12px}.mdc-text-field--end-aligned .mdc-text-field__affix--suffix{padding-left:2px;padding-right:0}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--end-aligned .mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:2px}.mdc-text-field--filled{height:56px}.mdc-text-field--filled::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}.mdc-text-field--filled .mdc-floating-label{left:16px;right:initial}[dir=rtl] .mdc-text-field--filled .mdc-floating-label,.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:16px}.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{height:100%}.mdc-text-field--filled.mdc-text-field--no-label .mdc-floating-label{display:none}.mdc-text-field--filled.mdc-text-field--no-label::before{display:none}@supports(-webkit-hyphens: none){.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field--outlined{height:56px;overflow:visible}.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) scale(1)}.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) scale(0.75)}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--outlined .mdc-text-field__input{height:100%}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px, var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px, var(--mdc-shape-small, 4px))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px, var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px, var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px, var(--mdc-shape-small, 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px, var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px, calc(var(--mdc-shape-small, 4px) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:1px}.mdc-text-field--outlined .mdc-floating-label{left:4px;right:initial}[dir=rtl] .mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:4px}.mdc-text-field--outlined .mdc-text-field__input{display:flex;border:none !important;background-color:rgba(0,0,0,0)}.mdc-text-field--outlined .mdc-notched-outline{z-index:1}.mdc-text-field--textarea{flex-direction:column;align-items:center;width:auto;height:auto;padding:0}.mdc-text-field--textarea .mdc-floating-label{top:19px}.mdc-text-field--textarea .mdc-floating-label:not(.mdc-floating-label--float-above){transform:none}.mdc-text-field--textarea .mdc-text-field__input{flex-grow:1;height:auto;min-height:1.5rem;overflow-x:hidden;overflow-y:auto;box-sizing:border-box;resize:none;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--filled::before{display:none}.mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-10.25px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--filled .mdc-text-field__input{margin-top:23px;margin-bottom:9px}.mdc-text-field--textarea.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-27.25px) scale(1)}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-24.75px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label{top:18px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field__input{margin-bottom:2px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter{align-self:flex-end;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::after{display:inline-block;width:0;height:16px;content:"";vertical-align:-16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::before{display:none}.mdc-text-field__resizer{align-self:stretch;display:inline-flex;flex-direction:column;flex-grow:1;max-height:100%;max-width:100%;min-height:56px;min-width:fit-content;min-width:-moz-available;min-width:-webkit-fill-available;overflow:hidden;resize:both}.mdc-text-field--filled .mdc-text-field__resizer{transform:translateY(-1px)}.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateY(1px)}.mdc-text-field--outlined .mdc-text-field__resizer{transform:translateX(-1px) translateY(-1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer,.mdc-text-field--outlined .mdc-text-field__resizer[dir=rtl]{transform:translateX(1px) translateY(-1px)}.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateX(1px) translateY(1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input[dir=rtl],.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter[dir=rtl]{transform:translateX(-1px) translateY(1px)}.mdc-text-field--with-leading-icon{padding-left:0;padding-right:16px}[dir=rtl] .mdc-text-field--with-leading-icon,.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:16px;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 48px);left:48px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:48px}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100% / 0.75 - 64px / 0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label{left:36px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:36px}.mdc-text-field--with-leading-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) translateX(-32px) scale(1)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-37.25px) translateX(32px) scale(1)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) translateX(-32px) scale(0.75)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl],.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-34.75px) translateX(32px) scale(0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--with-trailing-icon{padding-left:16px;padding-right:0}[dir=rtl] .mdc-text-field--with-trailing-icon,.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0;padding-right:16px}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 64px)}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100% / 0.75 - 64px / 0.75)}.mdc-text-field--with-trailing-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 96px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100% / 0.75 - 96px / 0.75)}.mdc-text-field-helper-line{display:flex;justify-content:space-between;box-sizing:border-box}.mdc-text-field+.mdc-text-field-helper-line{padding-right:16px;padding-left:16px}.mdc-form-field>.mdc-text-field+label{align-self:flex-start}.mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--focused .mdc-notched-outline__trailing{border-width:2px}.mdc-text-field--focused+.mdc-text-field-helper-line .mdc-text-field-helper-text:not(.mdc-text-field-helper-text--validation-msg){opacity:1}.mdc-text-field--focused.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:2px}.mdc-text-field--focused.mdc-text-field--outlined.mdc-text-field--textarea .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--invalid+.mdc-text-field-helper-line .mdc-text-field-helper-text--validation-msg{opacity:1}.mdc-text-field--disabled{pointer-events:none}@media screen and (forced-colors: active){.mdc-text-field--disabled .mdc-text-field__input{background-color:Window}.mdc-text-field--disabled .mdc-floating-label{z-index:1}}.mdc-text-field--disabled .mdc-floating-label{cursor:default}.mdc-text-field--disabled.mdc-text-field--filled .mdc-text-field__ripple{display:none}.mdc-text-field--disabled .mdc-text-field__input{pointer-events:auto}.mdc-text-field--end-aligned .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--end-aligned .mdc-text-field__input[dir=rtl]{text-align:left}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix{direction:ltr}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--leading,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--leading{order:1}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{order:2}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input{order:3}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{order:4}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--trailing,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--trailing{order:5}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--prefix{padding-right:12px}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--suffix{padding-left:2px}.mdc-floating-label{position:absolute;left:0;-webkit-transform-origin:left top;transform-origin:left top;line-height:1.15rem;text-align:left;text-overflow:ellipsis;white-space:nowrap;cursor:text;overflow:hidden;will-change:transform}[dir=rtl] .mdc-floating-label,.mdc-floating-label[dir=rtl]{right:0;left:auto;-webkit-transform-origin:right top;transform-origin:right top;text-align:right}.mdc-floating-label--float-above{cursor:auto}.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:1px;margin-right:0px;content:"*"}[dir=rtl] .mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after,.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)[dir=rtl]::after{margin-left:0;margin-right:1px}.mdc-notched-outline{display:flex;position:absolute;top:0;right:0;left:0;box-sizing:border-box;width:100%;max-width:100%;height:100%;text-align:left;pointer-events:none}[dir=rtl] .mdc-notched-outline,.mdc-notched-outline[dir=rtl]{text-align:right}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{box-sizing:border-box;height:100%;pointer-events:none}.mdc-notched-outline__trailing{flex-grow:1}.mdc-notched-outline__notch{flex:0 0 auto;width:auto}.mdc-notched-outline .mdc-floating-label{display:inline-block;position:relative;max-width:100%}.mdc-notched-outline .mdc-floating-label--float-above{text-overflow:clip}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:133.3333333333%}.mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:0;padding-right:8px;border-top:none}[dir=rtl] .mdc-notched-outline--notched .mdc-notched-outline__notch,.mdc-notched-outline--notched .mdc-notched-outline__notch[dir=rtl]{padding-left:8px;padding-right:0}.mdc-notched-outline--no-label .mdc-notched-outline__notch{display:none}.mdc-line-ripple::before,.mdc-line-ripple::after{position:absolute;bottom:0;left:0;width:100%;border-bottom-style:solid;content:""}.mdc-line-ripple::before{z-index:1}.mdc-line-ripple::after{transform:scaleX(0);opacity:0;z-index:2}.mdc-line-ripple--active::after{transform:scaleX(1);opacity:1}.mdc-line-ripple--deactivating::after{opacity:0}.mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{border-top:1px solid;border-bottom:1px solid}.mdc-notched-outline__leading{border-left:1px solid;border-right:none;width:12px}[dir=rtl] .mdc-notched-outline__leading,.mdc-notched-outline__leading[dir=rtl]{border-left:none;border-right:1px solid}.mdc-notched-outline__trailing{border-left:none;border-right:1px solid}[dir=rtl] .mdc-notched-outline__trailing,.mdc-notched-outline__trailing[dir=rtl]{border-left:1px solid;border-right:none}.mdc-notched-outline__notch{max-width:calc(100% - 12px * 2)}.mdc-line-ripple::before{border-bottom-width:1px}.mdc-line-ripple::after{border-bottom-width:2px}.mdc-text-field--filled{--mdc-filled-text-field-active-indicator-height:1px;--mdc-filled-text-field-focus-active-indicator-height:2px;--mdc-filled-text-field-container-shape:4px;border-top-left-radius:var(--mdc-filled-text-field-container-shape);border-top-right-radius:var(--mdc-filled-text-field-container-shape);border-bottom-right-radius:0;border-bottom-left-radius:0}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-caret-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-error-caret-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-filled-text-field-input-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-filled-text-field-disabled-input-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-focus-label-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-disabled-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-focus-label-text-color)}.mdc-text-field--filled .mdc-floating-label{font-family:var(--mdc-filled-text-field-label-text-font);font-size:var(--mdc-filled-text-field-label-text-size);font-weight:var(--mdc-filled-text-field-label-text-weight);letter-spacing:var(--mdc-filled-text-field-label-text-tracking)}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}.mdc-text-field--filled:not(.mdc-text-field--disabled){background-color:var(--mdc-filled-text-field-container-color)}.mdc-text-field--filled.mdc-text-field--disabled{background-color:var(--mdc-filled-text-field-disabled-container-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-hover-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-focus-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-disabled-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-hover-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-error-focus-active-indicator-color)}.mdc-text-field--filled .mdc-line-ripple::before{border-bottom-width:var(--mdc-filled-text-field-active-indicator-height)}.mdc-text-field--filled .mdc-line-ripple::after{border-bottom-width:var(--mdc-filled-text-field-focus-active-indicator-height)}.mdc-text-field--outlined{--mdc-outlined-text-field-outline-width:1px;--mdc-outlined-text-field-focus-outline-width:2px;--mdc-outlined-text-field-container-shape:4px}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-caret-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-error-caret-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-outlined-text-field-input-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-outlined-text-field-disabled-input-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-focus-label-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-disabled-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-focus-label-text-color)}.mdc-text-field--outlined .mdc-floating-label{font-family:var(--mdc-outlined-text-field-label-text-font);font-size:var(--mdc-outlined-text-field-label-text-size);font-weight:var(--mdc-outlined-text-field-label-text-weight);letter-spacing:var(--mdc-outlined-text-field-label-text-tracking)}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px, var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px, var(--mdc-outlined-text-field-container-shape))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px, calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px, var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px, calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px, var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px, var(--mdc-outlined-text-field-container-shape))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px, var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px, calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px, calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-hover-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-focus-outline-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-disabled-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-hover-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-focus-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-outline-width)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-focus-outline-width)}.mat-mdc-form-field-textarea-control{vertical-align:middle;resize:vertical;box-sizing:border-box;height:auto;margin:0;padding:0;border:none;overflow:auto}.mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:inherit;letter-spacing:inherit;text-decoration:inherit;text-transform:inherit;border:none}.mat-mdc-form-field .mat-mdc-floating-label.mdc-floating-label{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;line-height:normal;pointer-events:all}.mat-mdc-form-field:not(.mat-form-field-disabled) .mat-mdc-floating-label.mdc-floating-label{cursor:inherit}.mdc-text-field--no-label:not(.mdc-text-field--textarea) .mat-mdc-form-field-input-control.mdc-text-field__input,.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control{height:auto}.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control.mdc-text-field__input[type=color]{height:23px}.mat-mdc-text-field-wrapper{height:auto;flex:auto}.mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-left:0;--mat-mdc-form-field-label-offset-x: -16px}.mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-right:0}[dir=rtl] .mat-mdc-text-field-wrapper{padding-left:16px;padding-right:16px}[dir=rtl] .mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-left:0}[dir=rtl] .mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-right:0}.mat-form-field-disabled .mdc-text-field__input::placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-moz-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-webkit-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input:-ms-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-mdc-form-field-label-always-float .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms;opacity:1}.mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-floating-label{left:auto;right:auto}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-text-field__input{display:inline-block}.mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field .mdc-notched-outline__notch{padding-top:0}.mat-mdc-text-field-wrapper::before{content:none}.mat-mdc-form-field-subscript-wrapper{box-sizing:border-box;width:100%;position:relative}.mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-error-wrapper{position:absolute;top:0;left:0;right:0;padding:0 16px}.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-error-wrapper{position:static}.mat-mdc-form-field-bottom-align::before{content:"";display:inline-block;height:16px}.mat-mdc-form-field-bottom-align.mat-mdc-form-field-subscript-dynamic-size::before{content:unset}.mat-mdc-form-field-hint-end{order:1}.mat-mdc-form-field-hint-wrapper{display:flex}.mat-mdc-form-field-hint-spacer{flex:1 0 1em}.mat-mdc-form-field-error{display:block}.mat-mdc-form-field-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;opacity:0;pointer-events:none}select.mat-mdc-form-field-input-control{-moz-appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box}select.mat-mdc-form-field-input-control:not(:disabled){cursor:pointer}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;right:0;top:50%;margin-top:-2.5px;pointer-events:none}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{right:auto;left:0}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:15px}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:0;padding-left:15px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-mdc-text-field-wrapper{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-mdc-text-field-wrapper{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-mdc-text-field-wrapper{outline:dashed 3px}.cdk-high-contrast-active .mat-mdc-form-field.mat-focused .mdc-notched-outline{border:dashed 3px}.mat-mdc-form-field-input-control[type=date],.mat-mdc-form-field-input-control[type=datetime],.mat-mdc-form-field-input-control[type=datetime-local],.mat-mdc-form-field-input-control[type=month],.mat-mdc-form-field-input-control[type=week],.mat-mdc-form-field-input-control[type=time]{line-height:1}.mat-mdc-form-field-input-control::-webkit-datetime-edit{line-height:1;padding:0;margin-bottom:-2px}.mat-mdc-form-field{--mat-mdc-form-field-floating-label-scale: 0.75;display:inline-flex;flex-direction:column;min-width:0;text-align:left;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-container-text-font);line-height:var(--mat-form-field-container-text-line-height);font-size:var(--mat-form-field-container-text-size);letter-spacing:var(--mat-form-field-container-text-tracking);font-weight:var(--mat-form-field-container-text-weight)}[dir=rtl] .mat-mdc-form-field{text-align:right}.mat-mdc-form-field .mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(var(--mat-form-field-outlined-label-text-populated-size) * var(--mat-mdc-form-field-floating-label-scale))}.mat-mdc-form-field .mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mat-form-field-outlined-label-text-populated-size)}.mat-mdc-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-mdc-text-field-wrapper{width:100%}.mat-mdc-form-field-icon-prefix,.mat-mdc-form-field-icon-suffix{align-self:center;line-height:0;pointer-events:auto;position:relative;z-index:1}.mat-mdc-form-field-icon-prefix,[dir=rtl] .mat-mdc-form-field-icon-suffix{padding:0 4px 0 0}.mat-mdc-form-field-icon-suffix,[dir=rtl] .mat-mdc-form-field-icon-prefix{padding:0 0 0 4px}.mat-mdc-form-field-icon-prefix>.mat-icon,.mat-mdc-form-field-icon-suffix>.mat-icon{padding:12px;box-sizing:content-box}.mat-mdc-form-field-subscript-wrapper .mat-icon,.mat-mdc-form-field label .mat-icon{width:1em;height:1em;font-size:inherit}.mat-mdc-form-field-infix{flex:auto;min-width:0;width:180px;position:relative;box-sizing:border-box}.mat-mdc-form-field .mdc-notched-outline__notch{margin-left:-1px;-webkit-clip-path:inset(-9em -999em -9em 1px);clip-path:inset(-9em -999em -9em 1px)}[dir=rtl] .mat-mdc-form-field .mdc-notched-outline__notch{margin-left:0;margin-right:-1px;-webkit-clip-path:inset(-9em 1px -9em -999em);clip-path:inset(-9em 1px -9em -999em)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition-delay:40ms;transition-duration:110ms}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__affix{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled.mdc-ripple-upgraded--background-focused .mdc-text-field__ripple::before,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled:not(.mdc-ripple-upgraded):focus .mdc-text-field__ripple::before{transition-duration:75ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea{transition:none}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-filled 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-filled{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon{0%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}[dir=rtl] .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined[dir=rtl] .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon-rtl{0%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-floating-label{transition:transform 150ms cubic-bezier(0.4, 0, 0.2, 1),color 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-standard 250ms 1}@keyframes mdc-floating-label-shake-float-above-standard{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-line-ripple::after{transition:transform 180ms cubic-bezier(0.4, 0, 0.2, 1),opacity 180ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-notched-outline .mdc-floating-label{max-width:calc(100% + 1px)}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:calc(133.3333333333% + 1px)}'],encapsulation:2,data:{animation:[Y8.transitionMessages]},changeDetection:0})}return e})(),$B=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[Ga,Vh,iB,Ga]})}return e})();const Z8=new De("MAT_INPUT_VALUE_ACCESSOR"),eH=["button","checkbox","file","hidden","image","radio","range","reset","submit"];let tH=0;const nH=K6(class{constructor(e,i,t,o){this._defaultErrorStateMatcher=e,this._parentForm=i,this._parentFormGroup=t,this.ngControl=o,this.stateChanges=new Gt}});let iH=(()=>{class e extends nH{get disabled(){return this._disabled}set disabled(t){this._disabled=oa(t),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(t){this._id=t||this._uid}get required(){return this._required??this.ngControl?.control?.hasValidator(Yd.required)??!1}set required(t){this._required=oa(t)}get type(){return this._type}set type(t){this._type=t||"text",this._validateType(),!this._isTextarea&&tB().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(t){t!==this.value&&(this._inputValueAccessor.value=t,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(t){this._readonly=oa(t)}constructor(t,o,c,u,f,g,y,S,R,k){super(g,u,f,c),this._elementRef=t,this._platform=o,this._autofillMonitor=S,this._formField=k,this._uid="mat-input-"+tH++,this.focused=!1,this.stateChanges=new Gt,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(K=>tB().has(K)),this._iOSKeyupListener=K=>{const ee=K.target;!ee.value&&0===ee.selectionStart&&0===ee.selectionEnd&&(ee.setSelectionRange(1,1),ee.setSelectionRange(0,0))};const B=this._elementRef.nativeElement,G=B.nodeName.toLowerCase();this._inputValueAccessor=y||B,this._previousNativeValue=this.value,this.id=this.id,o.IOS&&R.runOutsideAngular(()=>{t.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._isServer=!this._platform.isBrowser,this._isNativeSelect="select"===G,this._isTextarea="textarea"===G,this._isInFormField=!!k,this._isNativeSelect&&(this.controlType=B.multiple?"mat-native-select-multiple":"mat-native-select")}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(t=>{this.autofilled=t.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngDoCheck(){this.ngControl&&(this.updateErrorState(),null!==this.ngControl.disabled&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(t){this._elementRef.nativeElement.focus(t)}_focusChanged(t){t!==this.focused&&(this.focused=t,this.stateChanges.next())}_onInput(){}_dirtyCheckNativeValue(){const t=this._elementRef.nativeElement.value;this._previousNativeValue!==t&&(this._previousNativeValue=t,this.stateChanges.next())}_dirtyCheckPlaceholder(){const t=this._getPlaceholder();if(t!==this._previousPlaceholder){const o=this._elementRef.nativeElement;this._previousPlaceholder=t,t?o.setAttribute("placeholder",t):o.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){eH.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let t=this._elementRef.nativeElement.validity;return t&&t.badInput}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}get shouldLabelFloat(){if(this._isNativeSelect){const t=this._elementRef.nativeElement,o=t.options[0];return this.focused||t.multiple||!this.empty||!!(t.selectedIndex>-1&&o&&o.label)}return this.focused||!this.empty}setDescribedByIds(t){t.length?this._elementRef.nativeElement.setAttribute("aria-describedby",t.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){const t=this._elementRef.nativeElement;return this._isNativeSelect&&(t.multiple||t.size>1)}static#e=this.\u0275fac=function(o){return new(o||e)(re(bn),re(ro),re($d,10),re(tP,8),re(JT,8),re($6),re(Z8,10),re(u8),re(lt),re(zB,8))};static#t=this.\u0275dir=Ge({type:e,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:18,hostBindings:function(o,c){1&o&&tn("focus",function(){return c._focusChanged(!0)})("blur",function(){return c._focusChanged(!1)})("input",function(){return c._onInput()}),2&o&&(hh("id",c.id)("disabled",c.disabled)("required",c.required),ri("name",c.name||null)("readonly",c.readonly&&!c._isNativeSelect||null)("aria-invalid",c.empty&&c.required?null:c.errorState)("aria-required",c.required)("id",c.id),Vt("mat-input-server",c._isServer)("mat-mdc-form-field-textarea-control",c._isInFormField&&c._isTextarea)("mat-mdc-form-field-input-control",c._isInFormField)("mdc-text-field__input",c._isInFormField)("mat-mdc-native-select-inline",c._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["matInput"],features:[Lt([{provide:WB,useExisting:e}]),Ne,Ho]})}return e})(),rH=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[Ga,$B,$B,h8,Ga]})}return e})();const oH=["switch"];function sH(e,i){1&e&&(Pe(0,"div",12),Wo(),Pe(1,"svg",13),wt(2,"path",14),Re(),Pe(3,"svg",15),wt(4,"path",16),Re()())}const aH=["*"],cH=new De("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1})}),lH={provide:F,useExisting:Cn(()=>JB),multi:!0};class XB{constructor(i,t){this.source=i,this.checked=t}}let dH=0;const uH=q6(bB(SB(yB(class{constructor(e){this._elementRef=e}}))));let hH=(()=>{class e extends uH{get required(){return this._required}set required(t){this._required=oa(t)}get checked(){return this._checked}set checked(t){this._checked=oa(t),this._changeDetectorRef.markForCheck()}get hideIcon(){return this._hideIcon}set hideIcon(t){this._hideIcon=oa(t)}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(t,o,c,u,f,g,y){super(t),this._focusMonitor=o,this._changeDetectorRef=c,this.defaults=f,this._onChange=S=>{},this._onTouched=()=>{},this._required=!1,this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this._hideIcon=!1,this.change=new en,this.toggleChange=new en,this.tabIndex=parseInt(u)||0,this.color=this.defaultColor=f.color||"accent",this._noopAnimations="NoopAnimations"===g,this.id=this._uniqueId=`${y}${++dH}`,this._hideIcon=f.hideIcon??!1}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{"keyboard"===t||"program"===t?(this._focused=!0,this._changeDetectorRef.markForCheck()):t||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(t){this.checked=!!t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}static#e=this.\u0275fac=function(o){sd()};static#t=this.\u0275dir=Ge({type:e,inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],required:"required",checked:"checked",hideIcon:"hideIcon"},outputs:{change:"change",toggleChange:"toggleChange"},features:[Ne]})}return e})(),JB=(()=>{class e extends hH{get buttonId(){return`${this.id||this._uniqueId}-button`}constructor(t,o,c,u,f,g){super(t,o,c,u,f,g,"mat-mdc-slide-toggle-"),this._labelId=this._uniqueId+"-label"}_handleClick(){this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new XB(this,this.checked)))}focus(){this._switchElement.nativeElement.focus()}_createChangeEvent(t){return new XB(this,t)}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}static#e=this.\u0275fac=function(o){return new(o||e)(re(bn),re(uF),re(rr),function Tu(e){return function Hs(e,i){if("class"===i)return e.classes;if("style"===i)return e.styles;const t=e.attrs;if(t){const o=t.length;let c=0;for(;c<o;){const u=t[c];if(yw(u))break;if(0===u)c+=2;else if("number"==typeof u)for(c++;c<o&&"string"==typeof t[c];)c++;else{if(u===i)return t[c+1];c+=2}}}return null}(hr(),e)}("tabindex"),re(cH),re(ba,8))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["mat-slide-toggle"]],viewQuery:function(o,c){if(1&o&&Js(oH,5),2&o){let u;$e(u=ji())&&(c._switchElement=u.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:11,hostBindings:function(o,c){2&o&&(hh("id",c.id),ri("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),Vt("mat-mdc-slide-toggle-focused",c._focused)("mat-mdc-slide-toggle-checked",c.checked)("_mat-animation-noopable",c._noopAnimations))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color",tabIndex:"tabIndex"},exportAs:["matSlideToggle"],features:[Lt([lH]),Ne],ngContentSelectors:aH,decls:13,vars:25,consts:[[1,"mdc-form-field"],["role","switch","type","button",1,"mdc-switch",3,"tabIndex","disabled","click"],["switch",""],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],["class","mdc-switch__icons",4,"ngIf"],[1,"mdc-label",3,"for","click"],[1,"mdc-switch__icons"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(o,c){if(1&o&&(pd(),Pe(0,"div",0)(1,"button",1,2),tn("click",function(){return c._handleClick()}),wt(3,"div",3),Pe(4,"div",4)(5,"div",5)(6,"div",6),wt(7,"div",7),Re(),Pe(8,"div",8),wt(9,"div",9),Re(),Fe(10,sH,5,0,"div",10),Re()()(),Pe(11,"label",11),tn("click",function(f){return f.stopPropagation()}),nr(12),Re()()),2&o){const u=dd(2);Vt("mdc-form-field--align-end","before"==c.labelPosition),Je(1),Vt("mdc-switch--selected",c.checked)("mdc-switch--unselected",!c.checked)("mdc-switch--checked",c.checked)("mdc-switch--disabled",c.disabled),Qe("tabIndex",c.tabIndex)("disabled",c.disabled),ri("id",c.buttonId)("name",c.name)("aria-label",c.ariaLabel)("aria-labelledby",c._getAriaLabelledBy())("aria-describedby",c.ariaDescribedby)("aria-required",c.required||null)("aria-checked",c.checked),Je(8),Qe("matRippleTrigger",u)("matRippleDisabled",c.disableRipple||c.disabled)("matRippleCentered",!0),Je(1),Qe("ngIf",!c.hideIcon),Je(1),Qe("for",c.buttonId),ri("id",c._labelId)}},dependencies:[DB,Gd],styles:['.mdc-form-field{display:inline-flex;align-items:center;vertical-align:middle}.mdc-form-field[hidden]{display:none}.mdc-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{margin-left:auto;margin-right:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{padding-left:0;padding-right:4px}.mdc-form-field--nowrap>label{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{margin-left:0;margin-right:auto}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{padding-left:4px;padding-right:0}.mdc-form-field--space-between{justify-content:space-between}.mdc-form-field--space-between>label{margin:0}[dir=rtl] .mdc-form-field--space-between>label,.mdc-form-field--space-between>label[dir=rtl]{margin:0}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1);background-color:var(--mdc-elevation-overlay-color)}.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative}.mdc-switch[hidden]{display:none}.mdc-switch:disabled{cursor:default;pointer-events:none}.mdc-switch__track{overflow:hidden;position:relative;width:100%}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%}@media screen and (forced-colors: active){.mdc-switch__track::before,.mdc-switch__track::after{border-color:currentColor}}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(-100%)}[dir=rtl] .mdc-switch__track::after,.mdc-switch__track[dir=rtl]::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track[dir=rtl]::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0)}[dir=rtl] .mdc-switch__handle-track,.mdc-switch__handle-track[dir=rtl]{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track,.mdc-switch--selected .mdc-switch__handle-track[dir=rtl]{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto}[dir=rtl] .mdc-switch__handle,.mdc-switch__handle[dir=rtl]{left:auto;right:0}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}@media screen and (forced-colors: active){.mdc-switch__handle::before,.mdc-switch__handle::after{border-color:currentColor}}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-elevation-overlay{bottom:0;left:0;right:0;top:0}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1}.mdc-switch:disabled .mdc-switch__ripple{display:none}.mdc-switch__icons{height:100%;position:relative;width:100%;z-index:1}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mdc-switch{width:var(--mdc-switch-track-width);--mdc-switch-disabled-handle-opacity:0.38;--mdc-switch-disabled-selected-icon-opacity:0.38;--mdc-switch-disabled-track-opacity:0.12;--mdc-switch-disabled-unselected-icon-opacity:0.38;--mdc-switch-handle-height:20px;--mdc-switch-handle-shape:10px;--mdc-switch-handle-width:20px;--mdc-switch-selected-icon-size:18px;--mdc-switch-track-height:14px;--mdc-switch-track-shape:7px;--mdc-switch-track-width:36px;--mdc-switch-unselected-icon-size:18px;--mdc-switch-state-layer-size:40px;--mdc-switch-selected-focus-state-layer-opacity:0.12;--mdc-switch-selected-hover-state-layer-opacity:0.04;--mdc-switch-selected-pressed-state-layer-opacity:0.1;--mdc-switch-unselected-focus-state-layer-opacity:0.12;--mdc-switch-unselected-hover-state-layer-opacity:0.04;--mdc-switch-unselected-pressed-state-layer-opacity:0.1}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color)}.mdc-switch.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color)}.mdc-switch .mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation)}.mdc-switch .mdc-switch__focus-ring-wrapper,.mdc-switch .mdc-switch__handle{height:var(--mdc-switch-handle-height)}.mdc-switch:disabled .mdc-switch__handle::after{opacity:var(--mdc-switch-disabled-handle-opacity)}.mdc-switch .mdc-switch__handle{border-radius:var(--mdc-switch-handle-shape)}.mdc-switch .mdc-switch__handle{width:var(--mdc-switch-handle-width)}.mdc-switch .mdc-switch__handle-track{width:calc(100% - var(--mdc-switch-handle-width))}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__icon{fill:var(--mdc-switch-selected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__icon{fill:var(--mdc-switch-unselected-icon-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity)}.mdc-switch.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size);height:var(--mdc-switch-selected-icon-size)}.mdc-switch.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size);height:var(--mdc-switch-unselected-icon-size)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-hover-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-focus-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-pressed-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-hover-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-focus-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-pressed-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-selected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-selected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-unselected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-unselected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch .mdc-switch__ripple{height:var(--mdc-switch-state-layer-size);width:var(--mdc-switch-state-layer-size)}.mdc-switch .mdc-switch__track{height:var(--mdc-switch-track-height)}.mdc-switch:disabled .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity)}.mdc-switch:enabled .mdc-switch__track::after{background:var(--mdc-switch-selected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color)}.mdc-switch:enabled .mdc-switch__track::before{background:var(--mdc-switch-unselected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color)}.mdc-switch .mdc-switch__track{border-radius:var(--mdc-switch-track-shape)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mat-mdc-slide-toggle .mdc-label{font-family:var(--mat-slide-toggle-label-text-font);font-size:var(--mat-slide-toggle-label-text-size);letter-spacing:var(--mat-slide-toggle-label-text-tracking);line-height:var(--mat-slide-toggle-label-text-line-height);font-weight:var(--mat-slide-toggle-label-text-weight)}.mat-mdc-slide-toggle{display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle .mdc-switch__ripple::after{content:"";opacity:0}.mat-mdc-slide-toggle .mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:opacity 75ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-mdc-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-elevation-overlay,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}'],encapsulation:2,changeDetection:0})}return e})(),QB=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})(),mH=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[QB,Ga,OB,Vh,QB,Ga]})}return e})();const _H=["addListener","removeListener"],gH=["addEventListener","removeEventListener"],EH=["on","off"];function yF(e,i,t,o){if(x(t)&&(o=t,t=void 0),o)return yF(e,i,t).pipe(_e(o));const[c,u]=function bH(e){return x(e.addEventListener)&&x(e.removeEventListener)}(e)?gH.map(f=>g=>e[f](i,g,t)):function vH(e){return x(e.addListener)&&x(e.removeListener)}(e)?_H.map(ZB(e,i)):function yH(e){return x(e.on)&&x(e.off)}(e)?EH.map(ZB(e,i)):[];if(!c&&Gv(e))return fi(f=>yF(f,i,t))(xi(e));if(!c)throw new TypeError("Invalid event target");return new Ln(f=>{const g=(...y)=>f.next(1<y.length?y:y[0]);return c(g),()=>u(g)})}function ZB(e,i){return t=>o=>e[t](i,o)}const c0={schedule(e){let i=requestAnimationFrame,t=cancelAnimationFrame;const{delegate:o}=c0;o&&(i=o.requestAnimationFrame,t=o.cancelAnimationFrame);const c=i(u=>{t=void 0,e(u)});return new Dn(()=>t?.(c))},requestAnimationFrame(...e){const{delegate:i}=c0;return(i?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:i}=c0;return(i?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0};new class CH extends cF{flush(i){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:o}=this;let c;i=i||o.shift();do{if(c=i.execute(i.state,i.delay))break}while((i=o[0])&&i.id===t&&o.shift());if(this._active=!1,c){for(;(i=o[0])&&i.id===t&&o.shift();)i.unsubscribe();throw c}}}(class SH extends sF{constructor(i,t){super(i,t),this.scheduler=i,this.work=t}requestAsyncId(i,t,o=0){return null!==o&&o>0?super.requestAsyncId(i,t,o):(i.actions.push(this),i._scheduled||(i._scheduled=c0.requestAnimationFrame(()=>i.flush(void 0))))}recycleAsyncId(i,t,o=0){var c;if(null!=o?o>0:this.delay>0)return super.recycleAsyncId(i,t,o);const{actions:u}=i;null!=t&&(null===(c=u[u.length-1])||void 0===c?void 0:c.id)!==t&&(c0.cancelAnimationFrame(t),i._scheduled=void 0)}});let bF,wH=1;const hP={};function ej(e){return e in hP&&(delete hP[e],!0)}const IH={setImmediate(e){const i=wH++;return hP[i]=!0,bF||(bF=Promise.resolve()),bF.then(()=>ej(i)&&e()),i},clearImmediate(e){ej(e)}},{setImmediate:RH,clearImmediate:AH}=IH,pP={setImmediate(...e){const{delegate:i}=pP;return(i?.setImmediate||RH)(...e)},clearImmediate(e){const{delegate:i}=pP;return(i?.clearImmediate||AH)(e)},delegate:void 0};new class OH extends cF{flush(i){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:o}=this;let c;i=i||o.shift();do{if(c=i.execute(i.state,i.delay))break}while((i=o[0])&&i.id===t&&o.shift());if(this._active=!1,c){for(;(i=o[0])&&i.id===t&&o.shift();)i.unsubscribe();throw c}}}(class DH extends sF{constructor(i,t){super(i,t),this.scheduler=i,this.work=t}requestAsyncId(i,t,o=0){return null!==o&&o>0?super.requestAsyncId(i,t,o):(i.actions.push(this),i._scheduled||(i._scheduled=pP.setImmediate(i.flush.bind(i,void 0))))}recycleAsyncId(i,t,o=0){var c;if(null!=o?o>0:this.delay>0)return super.recycleAsyncId(i,t,o);const{actions:u}=i;null!=t&&(null===(c=u[u.length-1])||void 0===c?void 0:c.id)!==t&&(pP.clearImmediate(t),i._scheduled===t&&(i._scheduled=void 0))}});function fP(e=0,i,t=y6){let o=-1;return null!=i&&(nw(i)?t=i:o=i),new Ln(c=>{let u=function MH(e){return e instanceof Date&&!isNaN(e)}(e)?+e-t.now():e;u<0&&(u=0);let f=0;return t.schedule(function(){c.closed||(c.next(f++),0<=o?this.schedule(void 0,o):c.complete())},u)})}function tj(e,i=t0){return function PH(e){return ti((i,t)=>{let o=!1,c=null,u=null,f=!1;const g=()=>{if(u?.unsubscribe(),u=null,o){o=!1;const S=c;c=null,t.next(S)}f&&t.complete()},y=()=>{u=null,f&&t.complete()};i.subscribe(Wn(t,S=>{o=!0,c=S,u||xi(e(S)).subscribe(u=Wn(t,g,y))},()=>{f=!0,(!o||!u||u.closed)&&t.complete()}))})}(()=>fP(e,i))}let nj=(()=>{class e{constructor(t,o,c){this._ngZone=t,this._platform=o,this._scrolled=new Gt,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=c}register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){const o=this.scrollContainers.get(t);o&&(o.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=20){return this._platform.isBrowser?new Ln(o=>{this._globalSubscription||this._addGlobalListener();const c=t>0?this._scrolled.pipe(tj(t)).subscribe(o):this._scrolled.subscribe(o);return this._scrolledCount++,()=>{c.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):He()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((t,o)=>this.deregister(o)),this._scrolled.complete()}ancestorScrolled(t,o){const c=this.getAncestorScrollContainers(t);return this.scrolled(o).pipe(ra(u=>!u||c.indexOf(u)>-1))}getAncestorScrollContainers(t){const o=[];return this.scrollContainers.forEach((c,u)=>{this._scrollableContainsElement(u,t)&&o.push(u)}),o}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(t,o){let c=Kh(o),u=t.getElementRef().nativeElement;do{if(c==u)return!0}while(c=c.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>yF(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}static#e=this.\u0275fac=function(o){return new(o||e)(pe(lt),pe(ro),pe(Yt,8))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),ij=(()=>{class e{constructor(t,o,c){this._platform=t,this._change=new Gt,this._changeListener=u=>{this._change.next(u)},this._document=c,o.runOutsideAngular(()=>{if(t.isBrowser){const u=this._getWindow();u.addEventListener("resize",this._changeListener),u.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const t=this._getWindow();t.removeEventListener("resize",this._changeListener),t.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){const t=this.getViewportScrollPosition(),{width:o,height:c}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+c,right:t.left+o,height:c,width:o}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const t=this._document,o=this._getWindow(),c=t.documentElement,u=c.getBoundingClientRect();return{top:-u.top||t.body.scrollTop||o.scrollY||c.scrollTop||0,left:-u.left||t.body.scrollLeft||o.scrollX||c.scrollLeft||0}}change(t=20){return t>0?this._change.pipe(tj(t)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const t=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:t.innerWidth,height:t.innerHeight}:{width:0,height:0}}static#e=this.\u0275fac=function(o){return new(o||e)(pe(ro),pe(lt),pe(Yt,8))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),SF=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})(),rj=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[n0,SF,n0,SF]})}return e})();class CF{attach(i){return this._attachedHost=i,i.attach(this)}detach(){let i=this._attachedHost;null!=i&&(this._attachedHost=null,i.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(i){this._attachedHost=i}}class oj extends CF{constructor(i,t,o,c,u){super(),this.component=i,this.viewContainerRef=t,this.injector=o,this.componentFactoryResolver=c,this.projectableNodes=u}}class LH extends CF{constructor(i,t,o,c){super(),this.templateRef=i,this.viewContainerRef=t,this.context=o,this.injector=c}get origin(){return this.templateRef.elementRef}attach(i,t=this.context){return this.context=t,super.attach(i)}detach(){return this.context=void 0,super.detach()}}class FH extends CF{constructor(i){super(),this.element=i instanceof bn?i.nativeElement:i}}class UH{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(i){return i instanceof oj?(this._attachedPortal=i,this.attachComponentPortal(i)):i instanceof LH?(this._attachedPortal=i,this.attachTemplatePortal(i)):this.attachDomPortal&&i instanceof FH?(this._attachedPortal=i,this.attachDomPortal(i)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(i){this._disposeFn=i}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class VH extends UH{constructor(i,t,o,c,u){super(),this.outletElement=i,this._componentFactoryResolver=t,this._appRef=o,this._defaultInjector=c,this.attachDomPortal=f=>{const g=f.element,y=this._document.createComment("dom-portal");g.parentNode.insertBefore(y,g),this.outletElement.appendChild(g),this._attachedPortal=f,super.setDisposeFn(()=>{y.parentNode&&y.parentNode.replaceChild(g,y)})},this._document=u}attachComponentPortal(i){const o=(i.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(i.component);let c;return i.viewContainerRef?(c=i.viewContainerRef.createComponent(o,i.viewContainerRef.length,i.injector||i.viewContainerRef.injector,i.projectableNodes||void 0),this.setDisposeFn(()=>c.destroy())):(c=o.create(i.injector||this._defaultInjector||tr.NULL),this._appRef.attachView(c.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(c.hostView),c.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(c)),this._attachedPortal=i,c}attachTemplatePortal(i){let t=i.viewContainerRef,o=t.createEmbeddedView(i.templateRef,i.context,{injector:i.injector});return o.rootNodes.forEach(c=>this.outletElement.appendChild(c)),o.detectChanges(),this.setDisposeFn(()=>{let c=t.indexOf(o);-1!==c&&t.remove(c)}),this._attachedPortal=i,o}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(i){return i.hostView.rootNodes[0]}}let BH=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})();const sj=o6();class jH{constructor(i,t){this._viewportRuler=i,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=t}attach(){}enable(){if(this._canBeEnabled()){const i=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=i.style.left||"",this._previousHTMLStyles.top=i.style.top||"",i.style.left=ar(-this._previousScrollPosition.left),i.style.top=ar(-this._previousScrollPosition.top),i.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const i=this._document.documentElement,o=i.style,c=this._document.body.style,u=o.scrollBehavior||"",f=c.scrollBehavior||"";this._isEnabled=!1,o.left=this._previousHTMLStyles.left,o.top=this._previousHTMLStyles.top,i.classList.remove("cdk-global-scrollblock"),sj&&(o.scrollBehavior=c.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),sj&&(o.scrollBehavior=u,c.scrollBehavior=f)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const t=this._document.body,o=this._viewportRuler.getViewportSize();return t.scrollHeight>o.height||t.scrollWidth>o.width}}class HH{constructor(i,t,o,c){this._scrollDispatcher=i,this._ngZone=t,this._viewportRuler=o,this._config=c,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(i){this._overlayRef=i}enable(){if(this._scrollSubscription)return;const i=this._scrollDispatcher.scrolled(0).pipe(ra(t=>!t||!this._overlayRef.overlayElement.contains(t.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=i.subscribe(()=>{const t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=i.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class aj{enable(){}disable(){}attach(){}}function TF(e,i){return i.some(t=>e.bottom<t.top||e.top>t.bottom||e.right<t.left||e.left>t.right)}function cj(e,i){return i.some(t=>e.top<t.top||e.bottom>t.bottom||e.left<t.left||e.right>t.right)}class GH{constructor(i,t,o,c){this._scrollDispatcher=i,this._viewportRuler=t,this._ngZone=o,this._config=c,this._scrollSubscription=null}attach(i){this._overlayRef=i}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:o,height:c}=this._viewportRuler.getViewportSize();TF(t,[{width:o,height:c,bottom:c,right:o,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let WH=(()=>{class e{constructor(t,o,c,u){this._scrollDispatcher=t,this._viewportRuler=o,this._ngZone=c,this.noop=()=>new aj,this.close=f=>new HH(this._scrollDispatcher,this._ngZone,this._viewportRuler,f),this.block=()=>new jH(this._viewportRuler,this._document),this.reposition=f=>new GH(this._scrollDispatcher,this._viewportRuler,this._ngZone,f),this._document=u}static#e=this.\u0275fac=function(o){return new(o||e)(pe(nj),pe(ij),pe(lt),pe(Yt))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class zH{constructor(i){if(this.scrollStrategy=new aj,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,i){const t=Object.keys(i);for(const o of t)void 0!==i[o]&&(this[o]=i[o])}}}class qH{constructor(i,t){this.connectionPair=i,this.scrollableViewProperties=t}}let lj=(()=>{class e{constructor(t){this._attachedOverlays=[],this._document=t}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){const o=this._attachedOverlays.indexOf(t);o>-1&&this._attachedOverlays.splice(o,1),0===this._attachedOverlays.length&&this.detach()}static#e=this.\u0275fac=function(o){return new(o||e)(pe(Yt))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),KH=(()=>{class e extends lj{constructor(t,o){super(t),this._ngZone=o,this._keydownListener=c=>{const u=this._attachedOverlays;for(let f=u.length-1;f>-1;f--)if(u[f]._keydownEvents.observers.length>0){const g=u[f]._keydownEvents;this._ngZone?this._ngZone.run(()=>g.next(c)):g.next(c);break}}}add(t){super.add(t),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}static#e=this.\u0275fac=function(o){return new(o||e)(pe(Yt),pe(lt,8))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),YH=(()=>{class e extends lj{constructor(t,o,c){super(t),this._platform=o,this._ngZone=c,this._cursorStyleIsSet=!1,this._pointerDownListener=u=>{this._pointerDownEventTarget=qh(u)},this._clickListener=u=>{const f=qh(u),g="click"===u.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:f;this._pointerDownEventTarget=null;const y=this._attachedOverlays.slice();for(let S=y.length-1;S>-1;S--){const R=y[S];if(R._outsidePointerEvents.observers.length<1||!R.hasAttached())continue;if(R.overlayElement.contains(f)||R.overlayElement.contains(g))break;const k=R._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>k.next(u)):k.next(u)}}}add(t){if(super.add(t),!this._isAttached){const o=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(o)):this._addEventListeners(o),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=o.style.cursor,o.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const t=this._document.body;t.removeEventListener("pointerdown",this._pointerDownListener,!0),t.removeEventListener("click",this._clickListener,!0),t.removeEventListener("auxclick",this._clickListener,!0),t.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(t.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(t){t.addEventListener("pointerdown",this._pointerDownListener,!0),t.addEventListener("click",this._clickListener,!0),t.addEventListener("auxclick",this._clickListener,!0),t.addEventListener("contextmenu",this._clickListener,!0)}static#e=this.\u0275fac=function(o){return new(o||e)(pe(Yt),pe(ro),pe(lt,8))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),dj=(()=>{class e{constructor(t,o){this._platform=o,this._document=t}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t="cdk-overlay-container";if(this._platform.isBrowser||rF()){const c=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let u=0;u<c.length;u++)c[u].remove()}const o=this._document.createElement("div");o.classList.add(t),rF()?o.setAttribute("platform","test"):this._platform.isBrowser||o.setAttribute("platform","server"),this._document.body.appendChild(o),this._containerElement=o}static#e=this.\u0275fac=function(o){return new(o||e)(pe(Yt),pe(ro))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class $H{constructor(i,t,o,c,u,f,g,y,S,R=!1){this._portalOutlet=i,this._host=t,this._pane=o,this._config=c,this._ngZone=u,this._keyboardDispatcher=f,this._document=g,this._location=y,this._outsideClickDispatcher=S,this._animationsDisabled=R,this._backdropElement=null,this._backdropClick=new Gt,this._attachments=new Gt,this._detachments=new Gt,this._locationChanges=Dn.EMPTY,this._backdropClickHandler=k=>this._backdropClick.next(k),this._backdropTransitionendHandler=k=>{this._disposeBackdrop(k.target)},this._keydownEvents=new Gt,this._outsidePointerEvents=new Gt,c.scrollStrategy&&(this._scrollStrategy=c.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=c.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(i){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const t=this._portalOutlet.attach(i);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(wr(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof t?.onDestroy&&t.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const i=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),i}dispose(){const i=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,i&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(i){i!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=i,this.hasAttached()&&(i.attach(this),this.updatePosition()))}updateSize(i){this._config={...this._config,...i},this._updateElementSize()}setDirection(i){this._config={...this._config,direction:i},this._updateElementDirection()}addPanelClass(i){this._pane&&this._toggleClasses(this._pane,i,!0)}removePanelClass(i){this._pane&&this._toggleClasses(this._pane,i,!1)}getDirection(){const i=this._config.direction;return i?"string"==typeof i?i:i.value:"ltr"}updateScrollStrategy(i){i!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=i,this.hasAttached()&&(i.attach(this),i.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const i=this._pane.style;i.width=ar(this._config.width),i.height=ar(this._config.height),i.minWidth=ar(this._config.minWidth),i.minHeight=ar(this._config.minHeight),i.maxWidth=ar(this._config.maxWidth),i.maxHeight=ar(this._config.maxHeight)}_togglePointerEvents(i){this._pane.style.pointerEvents=i?"":"none"}_attachBackdrop(){const i="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(i)})}):this._backdropElement.classList.add(i)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const i=this._backdropElement;if(i){if(this._animationsDisabled)return void this._disposeBackdrop(i);i.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{i.addEventListener("transitionend",this._backdropTransitionendHandler)}),i.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(i)},500))}}_toggleClasses(i,t,o){const c=iP(t||[]).filter(u=>!!u);c.length&&(o?i.classList.add(...c):i.classList.remove(...c))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const i=this._ngZone.onStable.pipe(No(Kv(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),i.unsubscribe())})})}_disposeScrollStrategy(){const i=this._scrollStrategy;i&&(i.disable(),i.detach&&i.detach())}_disposeBackdrop(i){i&&(i.removeEventListener("click",this._backdropClickHandler),i.removeEventListener("transitionend",this._backdropTransitionendHandler),i.remove(),this._backdropElement===i&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const uj="cdk-overlay-connected-position-bounding-box",XH=/([A-Za-z%]+)$/;class JH{get positions(){return this._preferredPositions}constructor(i,t,o,c,u){this._viewportRuler=t,this._document=o,this._platform=c,this._overlayContainer=u,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Gt,this._resizeSubscription=Dn.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(i)}attach(i){this._validatePositions(),i.hostElement.classList.add(uj),this._overlayRef=i,this._boundingBox=i.hostElement,this._pane=i.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const i=this._originRect,t=this._overlayRect,o=this._viewportRect,c=this._containerRect,u=[];let f;for(let g of this._preferredPositions){let y=this._getOriginPoint(i,c,g),S=this._getOverlayPoint(y,t,g),R=this._getOverlayFit(S,t,o,g);if(R.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(g,y);this._canFitWithFlexibleDimensions(R,S,o)?u.push({position:g,origin:y,overlayRect:t,boundingBoxRect:this._calculateBoundingBoxRect(y,g)}):(!f||f.overlayFit.visibleArea<R.visibleArea)&&(f={overlayFit:R,overlayPoint:S,originPoint:y,position:g,overlayRect:t})}if(u.length){let g=null,y=-1;for(const S of u){const R=S.boundingBoxRect.width*S.boundingBoxRect.height*(S.position.weight||1);R>y&&(y=R,g=S)}return this._isPushed=!1,void this._applyPosition(g.position,g.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(f.position,f.originPoint);this._applyPosition(f.position,f.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&um(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(uj),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const i=this._lastPosition;if(i){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._getOriginPoint(this._originRect,this._containerRect,i);this._applyPosition(i,t)}else this.apply()}withScrollableContainers(i){return this._scrollables=i,this}withPositions(i){return this._preferredPositions=i,-1===i.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(i){return this._viewportMargin=i,this}withFlexibleDimensions(i=!0){return this._hasFlexibleDimensions=i,this}withGrowAfterOpen(i=!0){return this._growAfterOpen=i,this}withPush(i=!0){return this._canPush=i,this}withLockedPosition(i=!0){return this._positionLocked=i,this}setOrigin(i){return this._origin=i,this}withDefaultOffsetX(i){return this._offsetX=i,this}withDefaultOffsetY(i){return this._offsetY=i,this}withTransformOriginOn(i){return this._transformOriginSelector=i,this}_getOriginPoint(i,t,o){let c,u;if("center"==o.originX)c=i.left+i.width/2;else{const f=this._isRtl()?i.right:i.left,g=this._isRtl()?i.left:i.right;c="start"==o.originX?f:g}return t.left<0&&(c-=t.left),u="center"==o.originY?i.top+i.height/2:"top"==o.originY?i.top:i.bottom,t.top<0&&(u-=t.top),{x:c,y:u}}_getOverlayPoint(i,t,o){let c,u;return c="center"==o.overlayX?-t.width/2:"start"===o.overlayX?this._isRtl()?-t.width:0:this._isRtl()?0:-t.width,u="center"==o.overlayY?-t.height/2:"top"==o.overlayY?0:-t.height,{x:i.x+c,y:i.y+u}}_getOverlayFit(i,t,o,c){const u=pj(t);let{x:f,y:g}=i,y=this._getOffset(c,"x"),S=this._getOffset(c,"y");y&&(f+=y),S&&(g+=S);let B=0-g,G=g+u.height-o.height,K=this._subtractOverflows(u.width,0-f,f+u.width-o.width),ee=this._subtractOverflows(u.height,B,G),de=K*ee;return{visibleArea:de,isCompletelyWithinViewport:u.width*u.height===de,fitsInViewportVertically:ee===u.height,fitsInViewportHorizontally:K==u.width}}_canFitWithFlexibleDimensions(i,t,o){if(this._hasFlexibleDimensions){const c=o.bottom-t.y,u=o.right-t.x,f=hj(this._overlayRef.getConfig().minHeight),g=hj(this._overlayRef.getConfig().minWidth);return(i.fitsInViewportVertically||null!=f&&f<=c)&&(i.fitsInViewportHorizontally||null!=g&&g<=u)}return!1}_pushOverlayOnScreen(i,t,o){if(this._previousPushAmount&&this._positionLocked)return{x:i.x+this._previousPushAmount.x,y:i.y+this._previousPushAmount.y};const c=pj(t),u=this._viewportRect,f=Math.max(i.x+c.width-u.width,0),g=Math.max(i.y+c.height-u.height,0),y=Math.max(u.top-o.top-i.y,0),S=Math.max(u.left-o.left-i.x,0);let R=0,k=0;return R=c.width<=u.width?S||-f:i.x<this._viewportMargin?u.left-o.left-i.x:0,k=c.height<=u.height?y||-g:i.y<this._viewportMargin?u.top-o.top-i.y:0,this._previousPushAmount={x:R,y:k},{x:i.x+R,y:i.y+k}}_applyPosition(i,t){if(this._setTransformOrigin(i),this._setOverlayElementStyles(t,i),this._setBoundingBoxStyles(t,i),i.panelClass&&this._addPanelClasses(i.panelClass),this._lastPosition=i,this._positionChanges.observers.length){const o=this._getScrollVisibility(),c=new qH(i,o);this._positionChanges.next(c)}this._isInitialRender=!1}_setTransformOrigin(i){if(!this._transformOriginSelector)return;const t=this._boundingBox.querySelectorAll(this._transformOriginSelector);let o,c=i.overlayY;o="center"===i.overlayX?"center":this._isRtl()?"start"===i.overlayX?"right":"left":"start"===i.overlayX?"left":"right";for(let u=0;u<t.length;u++)t[u].style.transformOrigin=`${o} ${c}`}_calculateBoundingBoxRect(i,t){const o=this._viewportRect,c=this._isRtl();let u,f,g,R,k,B;if("top"===t.overlayY)f=i.y,u=o.height-f+this._viewportMargin;else if("bottom"===t.overlayY)g=o.height-i.y+2*this._viewportMargin,u=o.height-g+this._viewportMargin;else{const G=Math.min(o.bottom-i.y+o.top,i.y),K=this._lastBoundingBoxSize.height;u=2*G,f=i.y-G,u>K&&!this._isInitialRender&&!this._growAfterOpen&&(f=i.y-K/2)}if("end"===t.overlayX&&!c||"start"===t.overlayX&&c)B=o.width-i.x+this._viewportMargin,R=i.x-this._viewportMargin;else if("start"===t.overlayX&&!c||"end"===t.overlayX&&c)k=i.x,R=o.right-i.x;else{const G=Math.min(o.right-i.x+o.left,i.x),K=this._lastBoundingBoxSize.width;R=2*G,k=i.x-G,R>K&&!this._isInitialRender&&!this._growAfterOpen&&(k=i.x-K/2)}return{top:f,left:k,bottom:g,right:B,width:R,height:u}}_setBoundingBoxStyles(i,t){const o=this._calculateBoundingBoxRect(i,t);!this._isInitialRender&&!this._growAfterOpen&&(o.height=Math.min(o.height,this._lastBoundingBoxSize.height),o.width=Math.min(o.width,this._lastBoundingBoxSize.width));const c={};if(this._hasExactPosition())c.top=c.left="0",c.bottom=c.right=c.maxHeight=c.maxWidth="",c.width=c.height="100%";else{const u=this._overlayRef.getConfig().maxHeight,f=this._overlayRef.getConfig().maxWidth;c.height=ar(o.height),c.top=ar(o.top),c.bottom=ar(o.bottom),c.width=ar(o.width),c.left=ar(o.left),c.right=ar(o.right),c.alignItems="center"===t.overlayX?"center":"end"===t.overlayX?"flex-end":"flex-start",c.justifyContent="center"===t.overlayY?"center":"bottom"===t.overlayY?"flex-end":"flex-start",u&&(c.maxHeight=ar(u)),f&&(c.maxWidth=ar(f))}this._lastBoundingBoxSize=o,um(this._boundingBox.style,c)}_resetBoundingBoxStyles(){um(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){um(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(i,t){const o={},c=this._hasExactPosition(),u=this._hasFlexibleDimensions,f=this._overlayRef.getConfig();if(c){const R=this._viewportRuler.getViewportScrollPosition();um(o,this._getExactOverlayY(t,i,R)),um(o,this._getExactOverlayX(t,i,R))}else o.position="static";let g="",y=this._getOffset(t,"x"),S=this._getOffset(t,"y");y&&(g+=`translateX(${y}px) `),S&&(g+=`translateY(${S}px)`),o.transform=g.trim(),f.maxHeight&&(c?o.maxHeight=ar(f.maxHeight):u&&(o.maxHeight="")),f.maxWidth&&(c?o.maxWidth=ar(f.maxWidth):u&&(o.maxWidth="")),um(this._pane.style,o)}_getExactOverlayY(i,t,o){let c={top:"",bottom:""},u=this._getOverlayPoint(t,this._overlayRect,i);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,o)),"bottom"===i.overlayY?c.bottom=this._document.documentElement.clientHeight-(u.y+this._overlayRect.height)+"px":c.top=ar(u.y),c}_getExactOverlayX(i,t,o){let f,c={left:"",right:""},u=this._getOverlayPoint(t,this._overlayRect,i);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,o)),f=this._isRtl()?"end"===i.overlayX?"left":"right":"end"===i.overlayX?"right":"left","right"===f?c.right=this._document.documentElement.clientWidth-(u.x+this._overlayRect.width)+"px":c.left=ar(u.x),c}_getScrollVisibility(){const i=this._getOriginRect(),t=this._pane.getBoundingClientRect(),o=this._scrollables.map(c=>c.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:cj(i,o),isOriginOutsideView:TF(i,o),isOverlayClipped:cj(t,o),isOverlayOutsideView:TF(t,o)}}_subtractOverflows(i,...t){return t.reduce((o,c)=>o-Math.max(c,0),i)}_getNarrowedViewportRect(){const i=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,o=this._viewportRuler.getViewportScrollPosition();return{top:o.top+this._viewportMargin,left:o.left+this._viewportMargin,right:o.left+i-this._viewportMargin,bottom:o.top+t-this._viewportMargin,width:i-2*this._viewportMargin,height:t-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(i,t){return"x"===t?null==i.offsetX?this._offsetX:i.offsetX:null==i.offsetY?this._offsetY:i.offsetY}_validatePositions(){}_addPanelClasses(i){this._pane&&iP(i).forEach(t=>{""!==t&&-1===this._appliedPanelClasses.indexOf(t)&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(i=>{this._pane.classList.remove(i)}),this._appliedPanelClasses=[])}_getOriginRect(){const i=this._origin;if(i instanceof bn)return i.nativeElement.getBoundingClientRect();if(i instanceof Element)return i.getBoundingClientRect();const t=i.width||0,o=i.height||0;return{top:i.y,bottom:i.y+o,left:i.x,right:i.x+t,height:o,width:t}}}function um(e,i){for(let t in i)i.hasOwnProperty(t)&&(e[t]=i[t]);return e}function hj(e){if("number"!=typeof e&&null!=e){const[i,t]=e.split(XH);return t&&"px"!==t?null:parseFloat(i)}return e||null}function pj(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}const fj="cdk-global-overlay-wrapper";class QH{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(i){const t=i.getConfig();this._overlayRef=i,this._width&&!t.width&&i.updateSize({width:this._width}),this._height&&!t.height&&i.updateSize({height:this._height}),i.hostElement.classList.add(fj),this._isDisposed=!1}top(i=""){return this._bottomOffset="",this._topOffset=i,this._alignItems="flex-start",this}left(i=""){return this._xOffset=i,this._xPosition="left",this}bottom(i=""){return this._topOffset="",this._bottomOffset=i,this._alignItems="flex-end",this}right(i=""){return this._xOffset=i,this._xPosition="right",this}start(i=""){return this._xOffset=i,this._xPosition="start",this}end(i=""){return this._xOffset=i,this._xPosition="end",this}width(i=""){return this._overlayRef?this._overlayRef.updateSize({width:i}):this._width=i,this}height(i=""){return this._overlayRef?this._overlayRef.updateSize({height:i}):this._height=i,this}centerHorizontally(i=""){return this.left(i),this._xPosition="center",this}centerVertically(i=""){return this.top(i),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const i=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,o=this._overlayRef.getConfig(),{width:c,height:u,maxWidth:f,maxHeight:g}=o,y=!("100%"!==c&&"100vw"!==c||f&&"100%"!==f&&"100vw"!==f),S=!("100%"!==u&&"100vh"!==u||g&&"100%"!==g&&"100vh"!==g),R=this._xPosition,k=this._xOffset,B="rtl"===this._overlayRef.getConfig().direction;let G="",K="",ee="";y?ee="flex-start":"center"===R?(ee="center",B?K=k:G=k):B?"left"===R||"end"===R?(ee="flex-end",G=k):("right"===R||"start"===R)&&(ee="flex-start",K=k):"left"===R||"start"===R?(ee="flex-start",G=k):("right"===R||"end"===R)&&(ee="flex-end",K=k),i.position=this._cssPosition,i.marginLeft=y?"0":G,i.marginTop=S?"0":this._topOffset,i.marginBottom=this._bottomOffset,i.marginRight=y?"0":K,t.justifyContent=ee,t.alignItems=S?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const i=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,o=t.style;t.classList.remove(fj),o.justifyContent=o.alignItems=i.marginTop=i.marginBottom=i.marginLeft=i.marginRight=i.position="",this._overlayRef=null,this._isDisposed=!0}}let ZH=(()=>{class e{constructor(t,o,c,u){this._viewportRuler=t,this._document=o,this._platform=c,this._overlayContainer=u}global(){return new QH}flexibleConnectedTo(t){return new JH(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static#e=this.\u0275fac=function(o){return new(o||e)(pe(ij),pe(Yt),pe(ro),pe(dj))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),eG=0,mP=(()=>{class e{constructor(t,o,c,u,f,g,y,S,R,k,B,G){this.scrollStrategies=t,this._overlayContainer=o,this._componentFactoryResolver=c,this._positionBuilder=u,this._keyboardDispatcher=f,this._injector=g,this._ngZone=y,this._document=S,this._directionality=R,this._location=k,this._outsideClickDispatcher=B,this._animationsModuleType=G}create(t){const o=this._createHostElement(),c=this._createPaneElement(o),u=this._createPortalOutlet(c),f=new zH(t);return f.direction=f.direction||this._directionality.value,new $H(u,o,c,f,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(t){const o=this._document.createElement("div");return o.id="cdk-overlay-"+eG++,o.classList.add("cdk-overlay-pane"),t.appendChild(o),o}_createHostElement(){const t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(ea)),new VH(t,this._componentFactoryResolver,this._appRef,this._injector,this._document)}static#e=this.\u0275fac=function(o){return new(o||e)(pe(WH),pe(dj),pe(qu),pe(ZH),pe(KH),pe(tr),pe(lt),pe(Yt),pe(pF),pe(KC),pe(YH),pe(ba,8))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const iG={provide:new De("cdk-connected-overlay-scroll-strategy"),deps:[mP],useFactory:function nG(e){return()=>e.scrollStrategies.reposition()}};let rG=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({providers:[mP,iG],imports:[n0,BH,rj,rj]})}return e})();const oG=["tooltip"],mj=new De("mat-tooltip-scroll-strategy"),cG={provide:mj,deps:[mP],useFactory:function aG(e){return()=>e.scrollStrategies.reposition({scrollThrottle:20})}},dG=new De("mat-tooltip-default-options",{providedIn:"root",factory:function lG(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}}),_j="tooltip-panel",gj=Cv({passive:!0});let _G=(()=>{class e{get position(){return this._position}set position(t){t!==this._position&&(this._position=t,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(t){this._positionAtOrigin=oa(t),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(t){this._disabled=oa(t),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(t){this._showDelay=oF(t)}get hideDelay(){return this._hideDelay}set hideDelay(t){this._hideDelay=oF(t),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(t){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=null!=t?String(t).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(t){this._tooltipClass=t,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}constructor(t,o,c,u,f,g,y,S,R,k,B,G){this._overlay=t,this._elementRef=o,this._scrollDispatcher=c,this._viewContainerRef=u,this._ngZone=f,this._platform=g,this._ariaDescriber=y,this._focusMonitor=S,this._dir=k,this._defaultOptions=B,this._position="below",this._positionAtOrigin=!1,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="mat",this.touchGestures="auto",this._message="",this._passiveListeners=[],this._destroyed=new Gt,this._scrollStrategy=R,this._document=G,B&&(this._showDelay=B.showDelay,this._hideDelay=B.hideDelay,B.position&&(this.position=B.position),B.positionAtOrigin&&(this.positionAtOrigin=B.positionAtOrigin),B.touchGestures&&(this.touchGestures=B.touchGestures)),k.change.pipe(No(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)})}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(No(this._destroyed)).subscribe(t=>{t?"keyboard"===t&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const t=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([o,c])=>{t.removeEventListener(o,c,gj)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(t,this.message,"tooltip"),this._focusMonitor.stopMonitoring(t)}show(t=this.showDelay,o){if(this.disabled||!this.message||this._isTooltipVisible())return void this._tooltipInstance?._cancelPendingAnimations();const c=this._createOverlay(o);this._detach(),this._portal=this._portal||new oj(this._tooltipComponent,this._viewContainerRef);const u=this._tooltipInstance=c.attach(this._portal).instance;u._triggerElement=this._elementRef.nativeElement,u._mouseLeaveHideDelay=this._hideDelay,u.afterHidden().pipe(No(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),u.show(t)}hide(t=this.hideDelay){const o=this._tooltipInstance;o&&(o.isVisible()?o.hide(t):(o._cancelPendingAnimations(),this._detach()))}toggle(t){this._isTooltipVisible()?this.hide():this.show(void 0,t)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(t){if(this._overlayRef){const u=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!t)&&u._origin instanceof bn)return this._overlayRef;this._detach()}const o=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),c=this._overlay.position().flexibleConnectedTo(this.positionAtOrigin&&t||this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(o);return c.positionChanges.pipe(No(this._destroyed)).subscribe(u=>{this._updateCurrentPositionClass(u.connectionPair),this._tooltipInstance&&u.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:c,panelClass:`${this._cssClassPrefix}-${_j}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(No(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(No(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(No(this._destroyed)).subscribe(u=>{this._isTooltipVisible()&&27===u.keyCode&&!function f6(e,...i){return i.length?i.some(t=>e[t]):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}(u)&&(u.preventDefault(),u.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(t){const o=t.getConfig().positionStrategy,c=this._getOrigin(),u=this._getOverlayPosition();o.withPositions([this._addOffset({...c.main,...u.main}),this._addOffset({...c.fallback,...u.fallback})])}_addOffset(t){return t}_getOrigin(){const t=!this._dir||"ltr"==this._dir.value,o=this.position;let c;"above"==o||"below"==o?c={originX:"center",originY:"above"==o?"top":"bottom"}:"before"==o||"left"==o&&t||"right"==o&&!t?c={originX:"start",originY:"center"}:("after"==o||"right"==o&&t||"left"==o&&!t)&&(c={originX:"end",originY:"center"});const{x:u,y:f}=this._invertPosition(c.originX,c.originY);return{main:c,fallback:{originX:u,originY:f}}}_getOverlayPosition(){const t=!this._dir||"ltr"==this._dir.value,o=this.position;let c;"above"==o?c={overlayX:"center",overlayY:"bottom"}:"below"==o?c={overlayX:"center",overlayY:"top"}:"before"==o||"left"==o&&t||"right"==o&&!t?c={overlayX:"end",overlayY:"center"}:("after"==o||"right"==o&&t||"left"==o&&!t)&&(c={overlayX:"start",overlayY:"center"});const{x:u,y:f}=this._invertPosition(c.overlayX,c.overlayY);return{main:c,fallback:{overlayX:u,overlayY:f}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(wr(1),No(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(t){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=t,this._tooltipInstance._markForCheck())}_invertPosition(t,o){return"above"===this.position||"below"===this.position?"top"===o?o="bottom":"bottom"===o&&(o="top"):"end"===t?t="start":"start"===t&&(t="end"),{x:t,y:o}}_updateCurrentPositionClass(t){const{overlayY:o,originX:c,originY:u}=t;let f;if(f="center"===o?this._dir&&"rtl"===this._dir.value?"end"===c?"left":"right":"start"===c?"left":"right":"bottom"===o&&"top"===u?"above":"below",f!==this._currentPosition){const g=this._overlayRef;if(g){const y=`${this._cssClassPrefix}-${_j}-`;g.removePanelClass(y+this._currentPosition),g.addPanelClass(y+f)}this._currentPosition=f}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",t=>{let o;this._setupPointerExitEventsIfNeeded(),void 0!==t.x&&void 0!==t.y&&(o=t),this.show(void 0,o)}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",t=>{const o=t.targetTouches?.[0],c=o?{x:o.clientX,y:o.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(void 0,c),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const t=[];if(this._platformSupportsMouseEvents())t.push(["mouseleave",o=>{const c=o.relatedTarget;(!c||!this._overlayRef?.overlayElement.contains(c))&&this.hide()}],["wheel",o=>this._wheelListener(o)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const o=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};t.push(["touchend",o],["touchcancel",o])}this._addListeners(t),this._passiveListeners.push(...t)}_addListeners(t){t.forEach(([o,c])=>{this._elementRef.nativeElement.addEventListener(o,c,gj)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(t){if(this._isTooltipVisible()){const o=this._document.elementFromPoint(t.clientX,t.clientY),c=this._elementRef.nativeElement;o!==c&&!c.contains(o)&&this.hide()}}_disableNativeGesturesIfNecessary(){const t=this.touchGestures;if("off"!==t){const o=this._elementRef.nativeElement,c=o.style;("on"===t||"INPUT"!==o.nodeName&&"TEXTAREA"!==o.nodeName)&&(c.userSelect=c.msUserSelect=c.webkitUserSelect=c.MozUserSelect="none"),("on"===t||!o.draggable)&&(c.webkitUserDrag="none"),c.touchAction="none",c.webkitTapHighlightColor="transparent"}}static#e=this.\u0275fac=function(o){sd()};static#t=this.\u0275dir=Ge({type:e,inputs:{position:["matTooltipPosition","position"],positionAtOrigin:["matTooltipPositionAtOrigin","positionAtOrigin"],disabled:["matTooltipDisabled","disabled"],showDelay:["matTooltipShowDelay","showDelay"],hideDelay:["matTooltipHideDelay","hideDelay"],touchGestures:["matTooltipTouchGestures","touchGestures"],message:["matTooltip","message"],tooltipClass:["matTooltipClass","tooltipClass"]}})}return e})(),gG=(()=>{class e extends _G{constructor(t,o,c,u,f,g,y,S,R,k,B,G){super(t,o,c,u,f,g,y,S,R,k,B,G),this._tooltipComponent=vG,this._cssClassPrefix="mat-mdc",this._viewportMargin=8}_addOffset(t){const c=!this._dir||"ltr"==this._dir.value;return"top"===t.originY?t.offsetY=-8:"bottom"===t.originY?t.offsetY=8:"start"===t.originX?t.offsetX=c?-8:8:"end"===t.originX&&(t.offsetX=c?8:-8),t}static#e=this.\u0275fac=function(o){return new(o||e)(re(mP),re(bn),re(nj),re(Qo),re(lt),re(ro),re(A6),re(uF),re(mj),re(pF,8),re(dG,8),re(Yt))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],hostVars:2,hostBindings:function(o,c){2&o&&Vt("mat-mdc-tooltip-disabled",c.disabled)},exportAs:["matTooltip"],features:[Ne]})}return e})(),EG=(()=>{class e{constructor(t,o){this._changeDetectorRef=t,this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new Gt,this._animationsDisabled="NoopAnimations"===o}show(t){null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},t)}hide(t){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},t)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:t}){(!t||!this._triggerElement.contains(t))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){}_handleAnimationEnd({animationName:t}){(t===this._showAnimation||t===this._hideAnimation)&&this._finalizeAnimation(t===this._showAnimation)}_cancelPendingAnimations(){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(t){t?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(t){const o=this._tooltip.nativeElement,c=this._showAnimation,u=this._hideAnimation;if(o.classList.remove(t?u:c),o.classList.add(t?c:u),this._isVisible=t,t&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const f=getComputedStyle(o);("0s"===f.getPropertyValue("animation-duration")||"none"===f.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}t&&this._onShow(),this._animationsDisabled&&(o.classList.add("_mat-animation-noopable"),this._finalizeAnimation(t))}static#e=this.\u0275fac=function(o){return new(o||e)(re(rr),re(ba,8))};static#t=this.\u0275dir=Ge({type:e})}return e})(),vG=(()=>{class e extends EG{constructor(t,o,c){super(t,c),this._elementRef=o,this._isMultiline=!1,this._showAnimation="mat-mdc-tooltip-show",this._hideAnimation="mat-mdc-tooltip-hide"}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){const t=this._elementRef.nativeElement.getBoundingClientRect();return t.height>24&&t.width>=200}static#e=this.\u0275fac=function(o){return new(o||e)(re(rr),re(bn),re(ba,8))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["mat-tooltip-component"]],viewQuery:function(o,c){if(1&o&&Js(oG,7),2&o){let u;$e(u=ji())&&(c._tooltip=u.first)}},hostAttrs:["aria-hidden","true"],hostVars:2,hostBindings:function(o,c){1&o&&tn("mouseleave",function(f){return c._handleMouseLeave(f)}),2&o&&Qg("zoom",c.isVisible()?1:null)},features:[Ne],decls:4,vars:4,consts:[[1,"mdc-tooltip","mdc-tooltip--shown","mat-mdc-tooltip",3,"ngClass","animationend"],["tooltip",""],[1,"mdc-tooltip__surface","mdc-tooltip__surface-animation"]],template:function(o,c){1&o&&(Pe(0,"div",0,1),tn("animationend",function(f){return c._handleAnimationEnd(f)}),Pe(2,"div",2),Or(3),Re()()),2&o&&(Vt("mdc-tooltip--multiline",c._isMultiline),Qe("ngClass",c.tooltipClass),Je(3),uc(c.message))},dependencies:[ov],styles:['.mdc-tooltip__surface{word-break:break-all;word-break:var(--mdc-tooltip-word-break, normal);overflow-wrap:anywhere}.mdc-tooltip--showing-transition .mdc-tooltip__surface-animation{transition:opacity 150ms 0ms cubic-bezier(0, 0, 0.2, 1),transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-tooltip--hide-transition .mdc-tooltip__surface-animation{transition:opacity 75ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-tooltip{position:fixed;display:none;z-index:9}.mdc-tooltip-wrapper--rich{position:relative}.mdc-tooltip--shown,.mdc-tooltip--showing,.mdc-tooltip--hide{display:inline-flex}.mdc-tooltip--shown.mdc-tooltip--rich,.mdc-tooltip--showing.mdc-tooltip--rich,.mdc-tooltip--hide.mdc-tooltip--rich{display:inline-block;left:-320px;position:absolute}.mdc-tooltip__surface{line-height:16px;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center}.mdc-tooltip__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-tooltip__surface::before{border-color:CanvasText}}.mdc-tooltip--rich .mdc-tooltip__surface{align-items:flex-start;display:flex;flex-direction:column;min-height:24px;min-width:40px;max-width:320px;position:relative}.mdc-tooltip--multiline .mdc-tooltip__surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mdc-tooltip__surface,.mdc-tooltip--multiline .mdc-tooltip__surface[dir=rtl]{text-align:right}.mdc-tooltip__surface .mdc-tooltip__title{margin:0 8px}.mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(200px - (2 * 8px));margin:8px;text-align:left}[dir=rtl] .mdc-tooltip__surface .mdc-tooltip__content,.mdc-tooltip__surface .mdc-tooltip__content[dir=rtl]{text-align:right}.mdc-tooltip--rich .mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(320px - (2 * 8px));align-self:stretch}.mdc-tooltip__surface .mdc-tooltip__content-link{text-decoration:none}.mdc-tooltip--rich-actions,.mdc-tooltip__content,.mdc-tooltip__title{z-index:1}.mdc-tooltip__surface-animation{opacity:0;transform:scale(0.8);will-change:transform,opacity}.mdc-tooltip--shown .mdc-tooltip__surface-animation{transform:scale(1);opacity:1}.mdc-tooltip--hide .mdc-tooltip__surface-animation{transform:scale(1)}.mdc-tooltip__caret-surface-top,.mdc-tooltip__caret-surface-bottom{position:absolute;height:24px;width:24px;transform:rotate(35deg) skewY(20deg) scaleX(0.9396926208)}.mdc-tooltip__caret-surface-top .mdc-elevation-overlay,.mdc-tooltip__caret-surface-bottom .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-tooltip__caret-surface-bottom{box-shadow:0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12);outline:1px solid rgba(0,0,0,0);z-index:-1}@media screen and (forced-colors: active){.mdc-tooltip__caret-surface-bottom{outline-color:CanvasText}}.mat-mdc-tooltip{--mdc-plain-tooltip-container-shape:4px;--mdc-plain-tooltip-supporting-text-line-height:16px}.mat-mdc-tooltip .mdc-tooltip__surface{background-color:var(--mdc-plain-tooltip-container-color)}.mat-mdc-tooltip .mdc-tooltip__surface{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__caret-surface-top,.mat-mdc-tooltip .mdc-tooltip__caret-surface-bottom{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__surface{color:var(--mdc-plain-tooltip-supporting-text-color)}.mat-mdc-tooltip .mdc-tooltip__surface{font-family:var(--mdc-plain-tooltip-supporting-text-font);line-height:var(--mdc-plain-tooltip-supporting-text-line-height);font-size:var(--mdc-plain-tooltip-supporting-text-size);font-weight:var(--mdc-plain-tooltip-supporting-text-weight);letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking)}.mat-mdc-tooltip{position:relative;transform:scale(0)}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}'],encapsulation:2,changeDetection:0})}return e})(),yG=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({providers:[cG],imports:[V6,Vh,rG,Ga,Ga,SF]})}return e})();function Ej(e){return new ue(3e3,!1)}function Yh(e){switch(e.length){case 0:return new a0;case 1:return e[0];default:return new FB(e)}}function vj(e,i,t=new Map,o=new Map){const c=[],u=[];let f=-1,g=null;if(i.forEach(y=>{const S=y.get("offset"),R=S==f,k=R&&g||new Map;y.forEach((B,G)=>{let K=G,ee=B;if("offset"!==G)switch(K=e.normalizePropertyName(K,c),ee){case"!":ee=t.get(G);break;case Xd:ee=o.get(G);break;default:ee=e.normalizeStyleValue(G,K,ee,c)}k.set(K,ee)}),R||u.push(k),g=k,f=S}),c.length)throw function GG(e){return new ue(3502,!1)}();return u}function wF(e,i,t,o){switch(i){case"start":e.onStart(()=>o(t&&IF(t,"start",e)));break;case"done":e.onDone(()=>o(t&&IF(t,"done",e)));break;case"destroy":e.onDestroy(()=>o(t&&IF(t,"destroy",e)))}}function IF(e,i,t){const u=RF(e.element,e.triggerName,e.fromState,e.toState,i||e.phaseName,t.totalTime??e.totalTime,!!t.disabled),f=e._data;return null!=f&&(u._data=f),u}function RF(e,i,t,o,c="",u=0,f){return{element:e,triggerName:i,fromState:t,toState:o,phaseName:c,totalTime:u,disabled:!!f}}function sa(e,i,t){let o=e.get(i);return o||e.set(i,o=t),o}function yj(e){const i=e.indexOf(":");return[e.substring(1,i),e.slice(i+1)]}const tW=(()=>typeof document>"u"?null:document.documentElement)();function AF(e){const i=e.parentNode||e.host||null;return i===tW?null:i}let hm=null,bj=!1;function Sj(e,i){for(;i;){if(i===e)return!0;i=AF(i)}return!1}function Cj(e,i,t){if(t)return Array.from(e.querySelectorAll(i));const o=e.querySelector(i);return o?[o]:[]}let Tj=(()=>{class e{validateStyleProperty(t){return function iW(e){hm||(hm=function rW(){return typeof document<"u"?document.body:null}()||{},bj=!!hm.style&&"WebkitAppearance"in hm.style);let i=!0;return hm.style&&!function nW(e){return"ebkit"==e.substring(1,6)}(e)&&(i=e in hm.style,!i&&bj&&(i="Webkit"+e.charAt(0).toUpperCase()+e.slice(1)in hm.style)),i}(t)}matchesElement(t,o){return!1}containsElement(t,o){return Sj(t,o)}getParentElement(t){return AF(t)}query(t,o,c){return Cj(t,o,c)}computeStyle(t,o,c){return c||""}animate(t,o,c,u,f,g=[],y){return new a0(c,u)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac})}return e})(),DF=(()=>{class e{static#e=this.NOOP=new Tj}return e})();const oW=1e3,OF="ng-enter",_P="ng-leave",gP="ng-trigger",EP=".ng-trigger",Ij="ng-animating",NF=".ng-animating";function Jd(e){if("number"==typeof e)return e;const i=e.match(/^(-?[\.\d]+)(m?s)/);return!i||i.length<2?0:PF(parseFloat(i[1]),i[2])}function PF(e,i){return"s"===i?e*oW:e}function vP(e,i,t){return e.hasOwnProperty("duration")?e:function aW(e,i,t){let c,u=0,f="";if("string"==typeof e){const g=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===g)return i.push(Ej()),{duration:0,delay:0,easing:""};c=PF(parseFloat(g[1]),g[2]);const y=g[3];null!=y&&(u=PF(parseFloat(y),g[4]));const S=g[5];S&&(f=S)}else c=e;if(!t){let g=!1,y=i.length;c<0&&(i.push(function bG(){return new ue(3100,!1)}()),g=!0),u<0&&(i.push(function SG(){return new ue(3101,!1)}()),g=!0),g&&i.splice(y,0,Ej())}return{duration:c,delay:u,easing:f}}(e,i,t)}function l0(e,i={}){return Object.keys(e).forEach(t=>{i[t]=e[t]}),i}function Rj(e){const i=new Map;return Object.keys(e).forEach(t=>{i.set(t,e[t])}),i}function $h(e,i=new Map,t){if(t)for(let[o,c]of t)i.set(o,c);for(let[o,c]of e)i.set(o,c);return i}function kl(e,i,t){i.forEach((o,c)=>{const u=xF(c);t&&!t.has(c)&&t.set(c,e.style[u]),e.style[u]=o})}function pm(e,i){i.forEach((t,o)=>{const c=xF(o);e.style[c]=""})}function d0(e){return Array.isArray(e)?1==e.length?e[0]:LB(e):e}const MF=new RegExp("{{\\s*(.+?)\\s*}}","g");function Dj(e){let i=[];if("string"==typeof e){let t;for(;t=MF.exec(e);)i.push(t[1]);MF.lastIndex=0}return i}function u0(e,i,t){const o=e.toString(),c=o.replace(MF,(u,f)=>{let g=i[f];return null==g&&(t.push(function TG(e){return new ue(3003,!1)}()),g=""),g.toString()});return c==o?e:c}function yP(e){const i=[];let t=e.next();for(;!t.done;)i.push(t.value),t=e.next();return i}const dW=/-+([a-z0-9])/g;function xF(e){return e.replace(dW,(...i)=>i[1].toUpperCase())}function aa(e,i,t){switch(i.type){case 7:return e.visitTrigger(i,t);case 0:return e.visitState(i,t);case 1:return e.visitTransition(i,t);case 2:return e.visitSequence(i,t);case 3:return e.visitGroup(i,t);case 4:return e.visitAnimate(i,t);case 5:return e.visitKeyframes(i,t);case 6:return e.visitStyle(i,t);case 8:return e.visitReference(i,t);case 9:return e.visitAnimateChild(i,t);case 10:return e.visitAnimateRef(i,t);case 11:return e.visitQuery(i,t);case 12:return e.visitStagger(i,t);default:throw function wG(e){return new ue(3004,!1)}()}}function Oj(e,i){return window.getComputedStyle(e)[i]}const bP="*";function pW(e,i){const t=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(o=>function fW(e,i,t){if(":"==e[0]){const y=function mW(e,i){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,o)=>parseFloat(o)>parseFloat(t);case":decrement":return(t,o)=>parseFloat(o)<parseFloat(t);default:return i.push(function VG(e){return new ue(3016,!1)}()),"* => *"}}(e,t);if("function"==typeof y)return void i.push(y);e=y}const o=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==o||o.length<4)return t.push(function UG(e){return new ue(3015,!1)}()),i;const c=o[1],u=o[2],f=o[3];i.push(Nj(c,f));"<"==u[0]&&!(c==bP&&f==bP)&&i.push(Nj(f,c))}(o,t,i)):t.push(e),t}const SP=new Set(["true","1"]),CP=new Set(["false","0"]);function Nj(e,i){const t=SP.has(e)||CP.has(e),o=SP.has(i)||CP.has(i);return(c,u)=>{let f=e==bP||e==c,g=i==bP||i==u;return!f&&t&&"boolean"==typeof c&&(f=c?SP.has(e):CP.has(e)),!g&&o&&"boolean"==typeof u&&(g=u?SP.has(i):CP.has(i)),f&&g}}const _W=new RegExp("s*:selfs*,?","g");function kF(e,i,t,o){return new gW(e).build(i,t,o)}class gW{constructor(i){this._driver=i}build(i,t,o){const c=new yW(t);return this._resetContextStyleTimingState(c),aa(this,d0(i),c)}_resetContextStyleTimingState(i){i.currentQuerySelector="",i.collectedStyles=new Map,i.collectedStyles.set("",new Map),i.currentTime=0}visitTrigger(i,t){let o=t.queryCount=0,c=t.depCount=0;const u=[],f=[];return"@"==i.name.charAt(0)&&t.errors.push(function RG(){return new ue(3006,!1)}()),i.definitions.forEach(g=>{if(this._resetContextStyleTimingState(t),0==g.type){const y=g,S=y.name;S.toString().split(/\s*,\s*/).forEach(R=>{y.name=R,u.push(this.visitState(y,t))}),y.name=S}else if(1==g.type){const y=this.visitTransition(g,t);o+=y.queryCount,c+=y.depCount,f.push(y)}else t.errors.push(function AG(){return new ue(3007,!1)}())}),{type:7,name:i.name,states:u,transitions:f,queryCount:o,depCount:c,options:null}}visitState(i,t){const o=this.visitStyle(i.styles,t),c=i.options&&i.options.params||null;if(o.containsDynamicStyles){const u=new Set,f=c||{};o.styles.forEach(g=>{g instanceof Map&&g.forEach(y=>{Dj(y).forEach(S=>{f.hasOwnProperty(S)||u.add(S)})})}),u.size&&(yP(u.values()),t.errors.push(function DG(e,i){return new ue(3008,!1)}()))}return{type:0,name:i.name,style:o,options:c?{params:c}:null}}visitTransition(i,t){t.queryCount=0,t.depCount=0;const o=aa(this,d0(i.animation),t);return{type:1,matchers:pW(i.expr,t.errors),animation:o,queryCount:t.queryCount,depCount:t.depCount,options:fm(i.options)}}visitSequence(i,t){return{type:2,steps:i.steps.map(o=>aa(this,o,t)),options:fm(i.options)}}visitGroup(i,t){const o=t.currentTime;let c=0;const u=i.steps.map(f=>{t.currentTime=o;const g=aa(this,f,t);return c=Math.max(c,t.currentTime),g});return t.currentTime=c,{type:3,steps:u,options:fm(i.options)}}visitAnimate(i,t){const o=function SW(e,i){if(e.hasOwnProperty("duration"))return e;if("number"==typeof e)return LF(vP(e,i).duration,0,"");const t=e;if(t.split(/\s+/).some(u=>"{"==u.charAt(0)&&"{"==u.charAt(1))){const u=LF(0,0,"");return u.dynamic=!0,u.strValue=t,u}const c=vP(t,i);return LF(c.duration,c.delay,c.easing)}(i.timings,t.errors);t.currentAnimateTimings=o;let c,u=i.styles?i.styles:xl({});if(5==u.type)c=this.visitKeyframes(u,t);else{let f=i.styles,g=!1;if(!f){g=!0;const S={};o.easing&&(S.easing=o.easing),f=xl(S)}t.currentTime+=o.duration+o.delay;const y=this.visitStyle(f,t);y.isEmptyStep=g,c=y}return t.currentAnimateTimings=null,{type:4,timings:o,style:c,options:null}}visitStyle(i,t){const o=this._makeStyleAst(i,t);return this._validateStyleAst(o,t),o}_makeStyleAst(i,t){const o=[],c=Array.isArray(i.styles)?i.styles:[i.styles];for(let g of c)"string"==typeof g?g===Xd?o.push(g):t.errors.push(new ue(3002,!1)):o.push(Rj(g));let u=!1,f=null;return o.forEach(g=>{if(g instanceof Map&&(g.has("easing")&&(f=g.get("easing"),g.delete("easing")),!u))for(let y of g.values())if(y.toString().indexOf("{{")>=0){u=!0;break}}),{type:6,styles:o,easing:f,offset:i.offset,containsDynamicStyles:u,options:null}}_validateStyleAst(i,t){const o=t.currentAnimateTimings;let c=t.currentTime,u=t.currentTime;o&&u>0&&(u-=o.duration+o.delay),i.styles.forEach(f=>{"string"!=typeof f&&f.forEach((g,y)=>{const S=t.collectedStyles.get(t.currentQuerySelector),R=S.get(y);let k=!0;R&&(u!=c&&u>=R.startTime&&c<=R.endTime&&(t.errors.push(function NG(e,i,t,o,c){return new ue(3010,!1)}()),k=!1),u=R.startTime),k&&S.set(y,{startTime:u,endTime:c}),t.options&&function lW(e,i,t){const o=i.params||{},c=Dj(e);c.length&&c.forEach(u=>{o.hasOwnProperty(u)||t.push(function CG(e){return new ue(3001,!1)}())})}(g,t.options,t.errors)})})}visitKeyframes(i,t){const o={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function PG(){return new ue(3011,!1)}()),o;let u=0;const f=[];let g=!1,y=!1,S=0;const R=i.steps.map(ve=>{const ae=this._makeStyleAst(ve,t);let Ve=null!=ae.offset?ae.offset:function bW(e){if("string"==typeof e)return null;let i=null;if(Array.isArray(e))e.forEach(t=>{if(t instanceof Map&&t.has("offset")){const o=t;i=parseFloat(o.get("offset")),o.delete("offset")}});else if(e instanceof Map&&e.has("offset")){const t=e;i=parseFloat(t.get("offset")),t.delete("offset")}return i}(ae.styles),je=0;return null!=Ve&&(u++,je=ae.offset=Ve),y=y||je<0||je>1,g=g||je<S,S=je,f.push(je),ae});y&&t.errors.push(function MG(){return new ue(3012,!1)}()),g&&t.errors.push(function xG(){return new ue(3200,!1)}());const k=i.steps.length;let B=0;u>0&&u<k?t.errors.push(function kG(){return new ue(3202,!1)}()):0==u&&(B=1/(k-1));const G=k-1,K=t.currentTime,ee=t.currentAnimateTimings,de=ee.duration;return R.forEach((ve,ae)=>{const Ve=B>0?ae==G?1:B*ae:f[ae],je=Ve*de;t.currentTime=K+ee.delay+je,ee.duration=je,this._validateStyleAst(ve,t),ve.offset=Ve,o.styles.push(ve)}),o}visitReference(i,t){return{type:8,animation:aa(this,d0(i.animation),t),options:fm(i.options)}}visitAnimateChild(i,t){return t.depCount++,{type:9,options:fm(i.options)}}visitAnimateRef(i,t){return{type:10,animation:this.visitReference(i.animation,t),options:fm(i.options)}}visitQuery(i,t){const o=t.currentQuerySelector,c=i.options||{};t.queryCount++,t.currentQuery=i;const[u,f]=function EW(e){const i=!!e.split(/\s*,\s*/).find(t=>":self"==t);return i&&(e=e.replace(_W,"")),e=e.replace(/@\*/g,EP).replace(/@\w+/g,t=>EP+"-"+t.slice(1)).replace(/:animating/g,NF),[e,i]}(i.selector);t.currentQuerySelector=o.length?o+" "+u:u,sa(t.collectedStyles,t.currentQuerySelector,new Map);const g=aa(this,d0(i.animation),t);return t.currentQuery=null,t.currentQuerySelector=o,{type:11,selector:u,limit:c.limit||0,optional:!!c.optional,includeSelf:f,animation:g,originalSelector:i.selector,options:fm(i.options)}}visitStagger(i,t){t.currentQuery||t.errors.push(function LG(){return new ue(3013,!1)}());const o="full"===i.timings?{duration:0,delay:0,easing:"full"}:vP(i.timings,t.errors,!0);return{type:12,animation:aa(this,d0(i.animation),t),timings:o,options:null}}}class yW{constructor(i){this.errors=i,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function fm(e){return e?(e=l0(e)).params&&(e.params=function vW(e){return e?l0(e):null}(e.params)):e={},e}function LF(e,i,t){return{duration:e,delay:i,easing:t}}function FF(e,i,t,o,c,u,f=null,g=!1){return{type:1,element:e,keyframes:i,preStyleProps:t,postStyleProps:o,duration:c,delay:u,totalTime:c+u,easing:f,subTimeline:g}}class TP{constructor(){this._map=new Map}get(i){return this._map.get(i)||[]}append(i,t){let o=this._map.get(i);o||this._map.set(i,o=[]),o.push(...t)}has(i){return this._map.has(i)}clear(){this._map.clear()}}const wW=new RegExp(":enter","g"),RW=new RegExp(":leave","g");function UF(e,i,t,o,c,u=new Map,f=new Map,g,y,S=[]){return(new AW).buildKeyframes(e,i,t,o,c,u,f,g,y,S)}class AW{buildKeyframes(i,t,o,c,u,f,g,y,S,R=[]){S=S||new TP;const k=new VF(i,t,S,c,u,R,[]);k.options=y;const B=y.delay?Jd(y.delay):0;k.currentTimeline.delayNextStep(B),k.currentTimeline.setStyles([f],null,k.errors,y),aa(this,o,k);const G=k.timelines.filter(K=>K.containsAnimation());if(G.length&&g.size){let K;for(let ee=G.length-1;ee>=0;ee--){const de=G[ee];if(de.element===t){K=de;break}}K&&!K.allowOnlyTimelineStyles()&&K.setStyles([g],null,k.errors,y)}return G.length?G.map(K=>K.buildKeyframes()):[FF(t,[],[],[],0,B,"",!1)]}visitTrigger(i,t){}visitState(i,t){}visitTransition(i,t){}visitAnimateChild(i,t){const o=t.subInstructions.get(t.element);if(o){const c=t.createSubContext(i.options),u=t.currentTimeline.currentTime,f=this._visitSubInstructions(o,c,c.options);u!=f&&t.transformIntoNewTimeline(f)}t.previousNode=i}visitAnimateRef(i,t){const o=t.createSubContext(i.options);o.transformIntoNewTimeline(),this._applyAnimationRefDelays([i.options,i.animation.options],t,o),this.visitReference(i.animation,o),t.transformIntoNewTimeline(o.currentTimeline.currentTime),t.previousNode=i}_applyAnimationRefDelays(i,t,o){for(const c of i){const u=c?.delay;if(u){const f="number"==typeof u?u:Jd(u0(u,c?.params??{},t.errors));o.delayNextStep(f)}}}_visitSubInstructions(i,t,o){let u=t.currentTimeline.currentTime;const f=null!=o.duration?Jd(o.duration):null,g=null!=o.delay?Jd(o.delay):null;return 0!==f&&i.forEach(y=>{const S=t.appendInstructionToTimeline(y,f,g);u=Math.max(u,S.duration+S.delay)}),u}visitReference(i,t){t.updateOptions(i.options,!0),aa(this,i.animation,t),t.previousNode=i}visitSequence(i,t){const o=t.subContextCount;let c=t;const u=i.options;if(u&&(u.params||u.delay)&&(c=t.createSubContext(u),c.transformIntoNewTimeline(),null!=u.delay)){6==c.previousNode.type&&(c.currentTimeline.snapshotCurrentStyles(),c.previousNode=wP);const f=Jd(u.delay);c.delayNextStep(f)}i.steps.length&&(i.steps.forEach(f=>aa(this,f,c)),c.currentTimeline.applyStylesToKeyframe(),c.subContextCount>o&&c.transformIntoNewTimeline()),t.previousNode=i}visitGroup(i,t){const o=[];let c=t.currentTimeline.currentTime;const u=i.options&&i.options.delay?Jd(i.options.delay):0;i.steps.forEach(f=>{const g=t.createSubContext(i.options);u&&g.delayNextStep(u),aa(this,f,g),c=Math.max(c,g.currentTimeline.currentTime),o.push(g.currentTimeline)}),o.forEach(f=>t.currentTimeline.mergeTimelineCollectedStyles(f)),t.transformIntoNewTimeline(c),t.previousNode=i}_visitTiming(i,t){if(i.dynamic){const o=i.strValue;return vP(t.params?u0(o,t.params,t.errors):o,t.errors)}return{duration:i.duration,delay:i.delay,easing:i.easing}}visitAnimate(i,t){const o=t.currentAnimateTimings=this._visitTiming(i.timings,t),c=t.currentTimeline;o.delay&&(t.incrementTime(o.delay),c.snapshotCurrentStyles());const u=i.style;5==u.type?this.visitKeyframes(u,t):(t.incrementTime(o.duration),this.visitStyle(u,t),c.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=i}visitStyle(i,t){const o=t.currentTimeline,c=t.currentAnimateTimings;!c&&o.hasCurrentStyleProperties()&&o.forwardFrame();const u=c&&c.easing||i.easing;i.isEmptyStep?o.applyEmptyStep(u):o.setStyles(i.styles,u,t.errors,t.options),t.previousNode=i}visitKeyframes(i,t){const o=t.currentAnimateTimings,c=t.currentTimeline.duration,u=o.duration,g=t.createSubContext().currentTimeline;g.easing=o.easing,i.styles.forEach(y=>{g.forwardTime((y.offset||0)*u),g.setStyles(y.styles,y.easing,t.errors,t.options),g.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(g),t.transformIntoNewTimeline(c+u),t.previousNode=i}visitQuery(i,t){const o=t.currentTimeline.currentTime,c=i.options||{},u=c.delay?Jd(c.delay):0;u&&(6===t.previousNode.type||0==o&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=wP);let f=o;const g=t.invokeQuery(i.selector,i.originalSelector,i.limit,i.includeSelf,!!c.optional,t.errors);t.currentQueryTotal=g.length;let y=null;g.forEach((S,R)=>{t.currentQueryIndex=R;const k=t.createSubContext(i.options,S);u&&k.delayNextStep(u),S===t.element&&(y=k.currentTimeline),aa(this,i.animation,k),k.currentTimeline.applyStylesToKeyframe(),f=Math.max(f,k.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(f),y&&(t.currentTimeline.mergeTimelineCollectedStyles(y),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=i}visitStagger(i,t){const o=t.parentContext,c=t.currentTimeline,u=i.timings,f=Math.abs(u.duration),g=f*(t.currentQueryTotal-1);let y=f*t.currentQueryIndex;switch(u.duration<0?"reverse":u.easing){case"reverse":y=g-y;break;case"full":y=o.currentStaggerTime}const R=t.currentTimeline;y&&R.delayNextStep(y);const k=R.currentTime;aa(this,i.animation,t),t.previousNode=i,o.currentStaggerTime=c.currentTime-k+(c.startTime-o.currentTimeline.startTime)}}const wP={};class VF{constructor(i,t,o,c,u,f,g,y){this._driver=i,this.element=t,this.subInstructions=o,this._enterClassName=c,this._leaveClassName=u,this.errors=f,this.timelines=g,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=wP,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=y||new IP(this._driver,t,0),g.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(i,t){if(!i)return;const o=i;let c=this.options;null!=o.duration&&(c.duration=Jd(o.duration)),null!=o.delay&&(c.delay=Jd(o.delay));const u=o.params;if(u){let f=c.params;f||(f=this.options.params={}),Object.keys(u).forEach(g=>{(!t||!f.hasOwnProperty(g))&&(f[g]=u0(u[g],f,this.errors))})}}_copyOptions(){const i={};if(this.options){const t=this.options.params;if(t){const o=i.params={};Object.keys(t).forEach(c=>{o[c]=t[c]})}}return i}createSubContext(i=null,t,o){const c=t||this.element,u=new VF(this._driver,c,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(c,o||0));return u.previousNode=this.previousNode,u.currentAnimateTimings=this.currentAnimateTimings,u.options=this._copyOptions(),u.updateOptions(i),u.currentQueryIndex=this.currentQueryIndex,u.currentQueryTotal=this.currentQueryTotal,u.parentContext=this,this.subContextCount++,u}transformIntoNewTimeline(i){return this.previousNode=wP,this.currentTimeline=this.currentTimeline.fork(this.element,i),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(i,t,o){const c={duration:t??i.duration,delay:this.currentTimeline.currentTime+(o??0)+i.delay,easing:""},u=new DW(this._driver,i.element,i.keyframes,i.preStyleProps,i.postStyleProps,c,i.stretchStartingKeyframe);return this.timelines.push(u),c}incrementTime(i){this.currentTimeline.forwardTime(this.currentTimeline.duration+i)}delayNextStep(i){i>0&&this.currentTimeline.delayNextStep(i)}invokeQuery(i,t,o,c,u,f){let g=[];if(c&&g.push(this.element),i.length>0){i=(i=i.replace(wW,"."+this._enterClassName)).replace(RW,"."+this._leaveClassName);let S=this._driver.query(this.element,i,1!=o);0!==o&&(S=o<0?S.slice(S.length+o,S.length):S.slice(0,o)),g.push(...S)}return!u&&0==g.length&&f.push(function FG(e){return new ue(3014,!1)}()),g}}class IP{constructor(i,t,o,c){this._driver=i,this.element=t,this.startTime=o,this._elementTimelineStylesLookup=c,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(i){const t=1===this._keyframes.size&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+i),t&&this.snapshotCurrentStyles()):this.startTime+=i}fork(i,t){return this.applyStylesToKeyframe(),new IP(this._driver,i,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(i){this.applyStylesToKeyframe(),this.duration=i,this._loadKeyframe()}_updateStyle(i,t){this._localTimelineStyles.set(i,t),this._globalTimelineStyles.set(i,t),this._styleSummary.set(i,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(i){i&&this._previousKeyframe.set("easing",i);for(let[t,o]of this._globalTimelineStyles)this._backFill.set(t,o||Xd),this._currentKeyframe.set(t,Xd);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(i,t,o,c){t&&this._previousKeyframe.set("easing",t);const u=c&&c.params||{},f=function OW(e,i){const t=new Map;let o;return e.forEach(c=>{if("*"===c){o=o||i.keys();for(let u of o)t.set(u,Xd)}else $h(c,t)}),t}(i,this._globalTimelineStyles);for(let[g,y]of f){const S=u0(y,u,o);this._pendingStyles.set(g,S),this._localTimelineStyles.has(g)||this._backFill.set(g,this._globalTimelineStyles.get(g)??Xd),this._updateStyle(g,S)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((i,t)=>{this._currentKeyframe.set(t,i)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((i,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,i)}))}snapshotCurrentStyles(){for(let[i,t]of this._localTimelineStyles)this._pendingStyles.set(i,t),this._updateStyle(i,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const i=[];for(let t in this._currentKeyframe)i.push(t);return i}mergeTimelineCollectedStyles(i){i._styleSummary.forEach((t,o)=>{const c=this._styleSummary.get(o);(!c||t.time>c.time)&&this._updateStyle(o,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();const i=new Set,t=new Set,o=1===this._keyframes.size&&0===this.duration;let c=[];this._keyframes.forEach((g,y)=>{const S=$h(g,new Map,this._backFill);S.forEach((R,k)=>{"!"===R?i.add(k):R===Xd&&t.add(k)}),o||S.set("offset",y/this.duration),c.push(S)});const u=i.size?yP(i.values()):[],f=t.size?yP(t.values()):[];if(o){const g=c[0],y=new Map(g);g.set("offset",0),y.set("offset",1),c=[g,y]}return FF(this.element,c,u,f,this.duration,this.startTime,this.easing,!1)}}class DW extends IP{constructor(i,t,o,c,u,f,g=!1){super(i,t,f.delay),this.keyframes=o,this.preStyleProps=c,this.postStyleProps=u,this._stretchStartingKeyframe=g,this.timings={duration:f.duration,delay:f.delay,easing:f.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let i=this.keyframes,{delay:t,duration:o,easing:c}=this.timings;if(this._stretchStartingKeyframe&&t){const u=[],f=o+t,g=t/f,y=$h(i[0]);y.set("offset",0),u.push(y);const S=$h(i[0]);S.set("offset",xj(g)),u.push(S);const R=i.length-1;for(let k=1;k<=R;k++){let B=$h(i[k]);const G=B.get("offset");B.set("offset",xj((t+G*o)/f)),u.push(B)}o=f,t=0,c="",i=u}return FF(this.element,i,this.preStyleProps,this.postStyleProps,o,t,c,!0)}}function xj(e,i=3){const t=Math.pow(10,i-1);return Math.round(e*t)/t}class BF{}const NW=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class PW extends BF{normalizePropertyName(i,t){return xF(i)}normalizeStyleValue(i,t,o,c){let u="";const f=o.toString().trim();if(NW.has(t)&&0!==o&&"0"!==o)if("number"==typeof o)u="px";else{const g=o.match(/^[+-]?[\d\.]+([a-z]*)$/);g&&0==g[1].length&&c.push(function IG(e,i){return new ue(3005,!1)}())}return f+u}}function kj(e,i,t,o,c,u,f,g,y,S,R,k,B){return{type:0,element:e,triggerName:i,isRemovalTransition:c,fromState:t,fromStyles:u,toState:o,toStyles:f,timelines:g,queriedElements:y,preStyleProps:S,postStyleProps:R,totalTime:k,errors:B}}const jF={};class Lj{constructor(i,t,o){this._triggerName=i,this.ast=t,this._stateStyles=o}match(i,t,o,c){return function MW(e,i,t,o,c){return e.some(u=>u(i,t,o,c))}(this.ast.matchers,i,t,o,c)}buildStyles(i,t,o){let c=this._stateStyles.get("*");return void 0!==i&&(c=this._stateStyles.get(i?.toString())||c),c?c.buildStyles(t,o):new Map}build(i,t,o,c,u,f,g,y,S,R){const k=[],B=this.ast.options&&this.ast.options.params||jF,K=this.buildStyles(o,g&&g.params||jF,k),ee=y&&y.params||jF,de=this.buildStyles(c,ee,k),ve=new Set,ae=new Map,Ve=new Map,je="void"===c,Pt={params:xW(ee,B),delay:this.ast.options?.delay},ui=R?[]:UF(i,t,this.ast.animation,u,f,K,de,Pt,S,k);let hi=0;if(ui.forEach(ca=>{hi=Math.max(ca.duration+ca.delay,hi)}),k.length)return kj(t,this._triggerName,o,c,je,K,de,[],[],ae,Ve,hi,k);ui.forEach(ca=>{const Rc=ca.element,$P=sa(ae,Rc,new Set);ca.preStyleProps.forEach(ym=>$P.add(ym));const O0=sa(Ve,Rc,new Set);ca.postStyleProps.forEach(ym=>O0.add(ym)),Rc!==t&&ve.add(Rc)});const Po=yP(ve.values());return kj(t,this._triggerName,o,c,je,K,de,ui,Po,ae,Ve,hi)}}function xW(e,i){const t=l0(i);for(const o in e)e.hasOwnProperty(o)&&null!=e[o]&&(t[o]=e[o]);return t}class kW{constructor(i,t,o){this.styles=i,this.defaultParams=t,this.normalizer=o}buildStyles(i,t){const o=new Map,c=l0(this.defaultParams);return Object.keys(i).forEach(u=>{const f=i[u];null!==f&&(c[u]=f)}),this.styles.styles.forEach(u=>{"string"!=typeof u&&u.forEach((f,g)=>{f&&(f=u0(f,c,t));const y=this.normalizer.normalizePropertyName(g,t);f=this.normalizer.normalizeStyleValue(g,y,f,t),o.set(g,f)})}),o}}class FW{constructor(i,t,o){this.name=i,this.ast=t,this._normalizer=o,this.transitionFactories=[],this.states=new Map,t.states.forEach(c=>{this.states.set(c.name,new kW(c.style,c.options&&c.options.params||{},o))}),Fj(this.states,"true","1"),Fj(this.states,"false","0"),t.transitions.forEach(c=>{this.transitionFactories.push(new Lj(i,c,this.states))}),this.fallbackTransition=function UW(e,i,t){return new Lj(e,{type:1,animation:{type:2,steps:[],options:null},matchers:[(f,g)=>!0],options:null,queryCount:0,depCount:0},i)}(i,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(i,t,o,c){return this.transitionFactories.find(f=>f.match(i,t,o,c))||null}matchStyles(i,t,o){return this.fallbackTransition.buildStyles(i,t,o)}}function Fj(e,i,t){e.has(i)?e.has(t)||e.set(t,e.get(i)):e.has(t)&&e.set(i,e.get(t))}const VW=new TP;class BW{constructor(i,t,o){this.bodyNode=i,this._driver=t,this._normalizer=o,this._animations=new Map,this._playersById=new Map,this.players=[]}register(i,t){const o=[],u=kF(this._driver,t,o,[]);if(o.length)throw function WG(e){return new ue(3503,!1)}();this._animations.set(i,u)}_buildPlayer(i,t,o){const c=i.element,u=vj(this._normalizer,i.keyframes,t,o);return this._driver.animate(c,u,i.duration,i.delay,i.easing,[],!0)}create(i,t,o={}){const c=[],u=this._animations.get(i);let f;const g=new Map;if(u?(f=UF(this._driver,t,u,OF,_P,new Map,new Map,o,VW,c),f.forEach(R=>{const k=sa(g,R.element,new Map);R.postStyleProps.forEach(B=>k.set(B,null))})):(c.push(function zG(){return new ue(3300,!1)}()),f=[]),c.length)throw function qG(e){return new ue(3504,!1)}();g.forEach((R,k)=>{R.forEach((B,G)=>{R.set(G,this._driver.computeStyle(k,G,Xd))})});const S=Yh(f.map(R=>{const k=g.get(R.element);return this._buildPlayer(R,new Map,k)}));return this._playersById.set(i,S),S.onDestroy(()=>this.destroy(i)),this.players.push(S),S}destroy(i){const t=this._getPlayer(i);t.destroy(),this._playersById.delete(i);const o=this.players.indexOf(t);o>=0&&this.players.splice(o,1)}_getPlayer(i){const t=this._playersById.get(i);if(!t)throw function KG(e){return new ue(3301,!1)}();return t}listen(i,t,o,c){const u=RF(t,"","","");return wF(this._getPlayer(i),o,u,c),()=>{}}command(i,t,o,c){if("register"==o)return void this.register(i,c[0]);if("create"==o)return void this.create(i,t,c[0]||{});const u=this._getPlayer(i);switch(o){case"play":u.play();break;case"pause":u.pause();break;case"reset":u.reset();break;case"restart":u.restart();break;case"finish":u.finish();break;case"init":u.init();break;case"setPosition":u.setPosition(parseFloat(c[0]));break;case"destroy":this.destroy(i)}}}const Uj="ng-animate-queued",HF="ng-animate-disabled",zW=[],Vj={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},qW={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},wc="__ng_removed";class GF{get params(){return this.options.params}constructor(i,t=""){this.namespaceId=t;const o=i&&i.hasOwnProperty("value");if(this.value=function XW(e){return e??null}(o?i.value:i),o){const u=l0(i);delete u.value,this.options=u}else this.options={};this.options.params||(this.options.params={})}absorbOptions(i){const t=i.params;if(t){const o=this.options.params;Object.keys(t).forEach(c=>{null==o[c]&&(o[c]=t[c])})}}}const h0="void",WF=new GF(h0);class KW{constructor(i,t,o){this.id=i,this.hostElement=t,this._engine=o,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+i,Wa(t,this._hostClassName)}listen(i,t,o,c){if(!this._triggers.has(t))throw function YG(e,i){return new ue(3302,!1)}();if(null==o||0==o.length)throw function $G(e){return new ue(3303,!1)}();if(!function JW(e){return"start"==e||"done"==e}(o))throw function XG(e,i){return new ue(3400,!1)}();const u=sa(this._elementListeners,i,[]),f={name:t,phase:o,callback:c};u.push(f);const g=sa(this._engine.statesByElement,i,new Map);return g.has(t)||(Wa(i,gP),Wa(i,gP+"-"+t),g.set(t,WF)),()=>{this._engine.afterFlush(()=>{const y=u.indexOf(f);y>=0&&u.splice(y,1),this._triggers.has(t)||g.delete(t)})}}register(i,t){return!this._triggers.has(i)&&(this._triggers.set(i,t),!0)}_getTrigger(i){const t=this._triggers.get(i);if(!t)throw function JG(e){return new ue(3401,!1)}();return t}trigger(i,t,o,c=!0){const u=this._getTrigger(t),f=new zF(this.id,t,i);let g=this._engine.statesByElement.get(i);g||(Wa(i,gP),Wa(i,gP+"-"+t),this._engine.statesByElement.set(i,g=new Map));let y=g.get(t);const S=new GF(o,this.id);if(!(o&&o.hasOwnProperty("value"))&&y&&S.absorbOptions(y.options),g.set(t,S),y||(y=WF),S.value!==h0&&y.value===S.value){if(!function e9(e,i){const t=Object.keys(e),o=Object.keys(i);if(t.length!=o.length)return!1;for(let c=0;c<t.length;c++){const u=t[c];if(!i.hasOwnProperty(u)||e[u]!==i[u])return!1}return!0}(y.params,S.params)){const ee=[],de=u.matchStyles(y.value,y.params,ee),ve=u.matchStyles(S.value,S.params,ee);ee.length?this._engine.reportError(ee):this._engine.afterFlush(()=>{pm(i,de),kl(i,ve)})}return}const B=sa(this._engine.playersByElement,i,[]);B.forEach(ee=>{ee.namespaceId==this.id&&ee.triggerName==t&&ee.queued&&ee.destroy()});let G=u.matchTransition(y.value,S.value,i,S.params),K=!1;if(!G){if(!c)return;G=u.fallbackTransition,K=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:i,triggerName:t,transition:G,fromState:y,toState:S,player:f,isFallbackTransition:K}),K||(Wa(i,Uj),f.onStart(()=>{wv(i,Uj)})),f.onDone(()=>{let ee=this.players.indexOf(f);ee>=0&&this.players.splice(ee,1);const de=this._engine.playersByElement.get(i);if(de){let ve=de.indexOf(f);ve>=0&&de.splice(ve,1)}}),this.players.push(f),B.push(f),f}deregister(i){this._triggers.delete(i),this._engine.statesByElement.forEach(t=>t.delete(i)),this._elementListeners.forEach((t,o)=>{this._elementListeners.set(o,t.filter(c=>c.name!=i))})}clearElementCache(i){this._engine.statesByElement.delete(i),this._elementListeners.delete(i);const t=this._engine.playersByElement.get(i);t&&(t.forEach(o=>o.destroy()),this._engine.playersByElement.delete(i))}_signalRemovalForInnerTriggers(i,t){const o=this._engine.driver.query(i,EP,!0);o.forEach(c=>{if(c[wc])return;const u=this._engine.fetchNamespacesByElement(c);u.size?u.forEach(f=>f.triggerLeaveAnimation(c,t,!1,!0)):this.clearElementCache(c)}),this._engine.afterFlushAnimationsDone(()=>o.forEach(c=>this.clearElementCache(c)))}triggerLeaveAnimation(i,t,o,c){const u=this._engine.statesByElement.get(i),f=new Map;if(u){const g=[];if(u.forEach((y,S)=>{if(f.set(S,y.value),this._triggers.has(S)){const R=this.trigger(i,S,h0,c);R&&g.push(R)}}),g.length)return this._engine.markElementAsRemoved(this.id,i,!0,t,f),o&&Yh(g).onDone(()=>this._engine.processLeaveNode(i)),!0}return!1}prepareLeaveAnimationListeners(i){const t=this._elementListeners.get(i),o=this._engine.statesByElement.get(i);if(t&&o){const c=new Set;t.forEach(u=>{const f=u.name;if(c.has(f))return;c.add(f);const y=this._triggers.get(f).fallbackTransition,S=o.get(f)||WF,R=new GF(h0),k=new zF(this.id,f,i);this._engine.totalQueuedPlayers++,this._queue.push({element:i,triggerName:f,transition:y,fromState:S,toState:R,player:k,isFallbackTransition:!0})})}}removeNode(i,t){const o=this._engine;if(i.childElementCount&&this._signalRemovalForInnerTriggers(i,t),this.triggerLeaveAnimation(i,t,!0))return;let c=!1;if(o.totalAnimations){const u=o.players.length?o.playersByQueriedElement.get(i):[];if(u&&u.length)c=!0;else{let f=i;for(;f=f.parentNode;)if(o.statesByElement.get(f)){c=!0;break}}}if(this.prepareLeaveAnimationListeners(i),c)o.markElementAsRemoved(this.id,i,!1,t);else{const u=i[wc];(!u||u===Vj)&&(o.afterFlush(()=>this.clearElementCache(i)),o.destroyInnerAnimations(i),o._onRemovalComplete(i,t))}}insertNode(i,t){Wa(i,this._hostClassName)}drainQueuedTransitions(i){const t=[];return this._queue.forEach(o=>{const c=o.player;if(c.destroyed)return;const u=o.element,f=this._elementListeners.get(u);f&&f.forEach(g=>{if(g.name==o.triggerName){const y=RF(u,o.triggerName,o.fromState.value,o.toState.value);y._data=i,wF(o.player,g.phase,y,g.callback)}}),c.markedForDestroy?this._engine.afterFlush(()=>{c.destroy()}):t.push(o)}),this._queue=[],t.sort((o,c)=>{const u=o.transition.ast.depCount,f=c.transition.ast.depCount;return 0==u||0==f?u-f:this._engine.driver.containsElement(o.element,c.element)?1:-1})}destroy(i){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,i)}}class YW{_onRemovalComplete(i,t){this.onRemovalComplete(i,t)}constructor(i,t,o){this.bodyNode=i,this.driver=t,this._normalizer=o,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(c,u)=>{}}get queuedPlayers(){const i=[];return this._namespaceList.forEach(t=>{t.players.forEach(o=>{o.queued&&i.push(o)})}),i}createNamespace(i,t){const o=new KW(i,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(o,t):(this.newHostElements.set(t,o),this.collectEnterElement(t)),this._namespaceLookup[i]=o}_balanceNamespaceList(i,t){const o=this._namespaceList,c=this.namespacesByHostElement;if(o.length-1>=0){let f=!1,g=this.driver.getParentElement(t);for(;g;){const y=c.get(g);if(y){const S=o.indexOf(y);o.splice(S+1,0,i),f=!0;break}g=this.driver.getParentElement(g)}f||o.unshift(i)}else o.push(i);return c.set(t,i),i}register(i,t){let o=this._namespaceLookup[i];return o||(o=this.createNamespace(i,t)),o}registerTrigger(i,t,o){let c=this._namespaceLookup[i];c&&c.register(t,o)&&this.totalAnimations++}destroy(i,t){i&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const o=this._fetchNamespace(i);this.namespacesByHostElement.delete(o.hostElement);const c=this._namespaceList.indexOf(o);c>=0&&this._namespaceList.splice(c,1),o.destroy(t),delete this._namespaceLookup[i]}))}_fetchNamespace(i){return this._namespaceLookup[i]}fetchNamespacesByElement(i){const t=new Set,o=this.statesByElement.get(i);if(o)for(let c of o.values())if(c.namespaceId){const u=this._fetchNamespace(c.namespaceId);u&&t.add(u)}return t}trigger(i,t,o,c){if(RP(t)){const u=this._fetchNamespace(i);if(u)return u.trigger(t,o,c),!0}return!1}insertNode(i,t,o,c){if(!RP(t))return;const u=t[wc];if(u&&u.setForRemoval){u.setForRemoval=!1,u.setForMove=!0;const f=this.collectedLeaveElements.indexOf(t);f>=0&&this.collectedLeaveElements.splice(f,1)}if(i){const f=this._fetchNamespace(i);f&&f.insertNode(t,o)}c&&this.collectEnterElement(t)}collectEnterElement(i){this.collectedEnterElements.push(i)}markElementAsDisabled(i,t){t?this.disabledNodes.has(i)||(this.disabledNodes.add(i),Wa(i,HF)):this.disabledNodes.has(i)&&(this.disabledNodes.delete(i),wv(i,HF))}removeNode(i,t,o){if(RP(t)){const c=i?this._fetchNamespace(i):null;c?c.removeNode(t,o):this.markElementAsRemoved(i,t,!1,o);const u=this.namespacesByHostElement.get(t);u&&u.id!==i&&u.removeNode(t,o)}else this._onRemovalComplete(t,o)}markElementAsRemoved(i,t,o,c,u){this.collectedLeaveElements.push(t),t[wc]={namespaceId:i,setForRemoval:c,hasAnimation:o,removedBeforeQueried:!1,previousTriggersValues:u}}listen(i,t,o,c,u){return RP(t)?this._fetchNamespace(i).listen(t,o,c,u):()=>{}}_buildInstruction(i,t,o,c,u){return i.transition.build(this.driver,i.element,i.fromState.value,i.toState.value,o,c,i.fromState.options,i.toState.options,t,u)}destroyInnerAnimations(i){let t=this.driver.query(i,EP,!0);t.forEach(o=>this.destroyActiveAnimationsForElement(o)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(i,NF,!0),t.forEach(o=>this.finishActiveQueriedAnimationOnElement(o)))}destroyActiveAnimationsForElement(i){const t=this.playersByElement.get(i);t&&t.forEach(o=>{o.queued?o.markedForDestroy=!0:o.destroy()})}finishActiveQueriedAnimationOnElement(i){const t=this.playersByQueriedElement.get(i);t&&t.forEach(o=>o.finish())}whenRenderingDone(){return new Promise(i=>{if(this.players.length)return Yh(this.players).onDone(()=>i());i()})}processLeaveNode(i){const t=i[wc];if(t&&t.setForRemoval){if(i[wc]=Vj,t.namespaceId){this.destroyInnerAnimations(i);const o=this._fetchNamespace(t.namespaceId);o&&o.clearElementCache(i)}this._onRemovalComplete(i,t.setForRemoval)}i.classList?.contains(HF)&&this.markElementAsDisabled(i,!1),this.driver.query(i,".ng-animate-disabled",!0).forEach(o=>{this.markElementAsDisabled(o,!1)})}flush(i=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((o,c)=>this._balanceNamespaceList(o,c)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let o=0;o<this.collectedEnterElements.length;o++)Wa(this.collectedEnterElements[o],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const o=[];try{t=this._flushAnimations(o,i)}finally{for(let c=0;c<o.length;c++)o[c]()}}else for(let o=0;o<this.collectedLeaveElements.length;o++)this.processLeaveNode(this.collectedLeaveElements[o]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(o=>o()),this._flushFns=[],this._whenQuietFns.length){const o=this._whenQuietFns;this._whenQuietFns=[],t.length?Yh(t).onDone(()=>{o.forEach(c=>c())}):o.forEach(c=>c())}}reportError(i){throw function QG(e){return new ue(3402,!1)}()}_flushAnimations(i,t){const o=new TP,c=[],u=new Map,f=[],g=new Map,y=new Map,S=new Map,R=new Set;this.disabledNodes.forEach(qe=>{R.add(qe);const ot=this.driver.query(qe,".ng-animate-queued",!0);for(let pt=0;pt<ot.length;pt++)R.add(ot[pt])});const k=this.bodyNode,B=Array.from(this.statesByElement.keys()),G=Hj(B,this.collectedEnterElements),K=new Map;let ee=0;G.forEach((qe,ot)=>{const pt=OF+ee++;K.set(ot,pt),qe.forEach(mn=>Wa(mn,pt))});const de=[],ve=new Set,ae=new Set;for(let qe=0;qe<this.collectedLeaveElements.length;qe++){const ot=this.collectedLeaveElements[qe],pt=ot[wc];pt&&pt.setForRemoval&&(de.push(ot),ve.add(ot),pt.hasAnimation?this.driver.query(ot,".ng-star-inserted",!0).forEach(mn=>ve.add(mn)):ae.add(ot))}const Ve=new Map,je=Hj(B,Array.from(ve));je.forEach((qe,ot)=>{const pt=_P+ee++;Ve.set(ot,pt),qe.forEach(mn=>Wa(mn,pt))}),i.push(()=>{G.forEach((qe,ot)=>{const pt=K.get(ot);qe.forEach(mn=>wv(mn,pt))}),je.forEach((qe,ot)=>{const pt=Ve.get(ot);qe.forEach(mn=>wv(mn,pt))}),de.forEach(qe=>{this.processLeaveNode(qe)})});const Pt=[],ui=[];for(let qe=this._namespaceList.length-1;qe>=0;qe--)this._namespaceList[qe].drainQueuedTransitions(t).forEach(pt=>{const mn=pt.player,Vr=pt.element;if(Pt.push(mn),this.collectedEnterElements.length){const Mo=Vr[wc];if(Mo&&Mo.setForMove){if(Mo.previousTriggersValues&&Mo.previousTriggersValues.has(pt.triggerName)){const bm=Mo.previousTriggersValues.get(pt.triggerName),za=this.statesByElement.get(pt.element);if(za&&za.has(pt.triggerName)){const XP=za.get(pt.triggerName);XP.value=bm,za.set(pt.triggerName,XP)}}return void mn.destroy()}}const Ul=!k||!this.driver.containsElement(k,Vr),la=Ve.get(Vr),Qh=K.get(Vr),Mi=this._buildInstruction(pt,o,Qh,la,Ul);if(Mi.errors&&Mi.errors.length)return void ui.push(Mi);if(Ul)return mn.onStart(()=>pm(Vr,Mi.fromStyles)),mn.onDestroy(()=>kl(Vr,Mi.toStyles)),void c.push(mn);if(pt.isFallbackTransition)return mn.onStart(()=>pm(Vr,Mi.fromStyles)),mn.onDestroy(()=>kl(Vr,Mi.toStyles)),void c.push(mn);const h5=[];Mi.timelines.forEach(Mo=>{Mo.stretchStartingKeyframe=!0,this.disabledNodes.has(Mo.element)||h5.push(Mo)}),Mi.timelines=h5,o.append(Vr,Mi.timelines),f.push({instruction:Mi,player:mn,element:Vr}),Mi.queriedElements.forEach(Mo=>sa(g,Mo,[]).push(mn)),Mi.preStyleProps.forEach((Mo,bm)=>{if(Mo.size){let za=y.get(bm);za||y.set(bm,za=new Set),Mo.forEach((XP,yU)=>za.add(yU))}}),Mi.postStyleProps.forEach((Mo,bm)=>{let za=S.get(bm);za||S.set(bm,za=new Set),Mo.forEach((XP,yU)=>za.add(yU))})});if(ui.length){const qe=[];ui.forEach(ot=>{qe.push(function ZG(e,i){return new ue(3505,!1)}())}),Pt.forEach(ot=>ot.destroy()),this.reportError(qe)}const hi=new Map,Po=new Map;f.forEach(qe=>{const ot=qe.element;o.has(ot)&&(Po.set(ot,ot),this._beforeAnimationBuild(qe.player.namespaceId,qe.instruction,hi))}),c.forEach(qe=>{const ot=qe.element;this._getPreviousPlayers(ot,!1,qe.namespaceId,qe.triggerName,null).forEach(mn=>{sa(hi,ot,[]).push(mn),mn.destroy()})});const ca=de.filter(qe=>Wj(qe,y,S)),Rc=new Map;jj(Rc,this.driver,ae,S,Xd).forEach(qe=>{Wj(qe,y,S)&&ca.push(qe)});const O0=new Map;G.forEach((qe,ot)=>{jj(O0,this.driver,new Set(qe),y,"!")}),ca.forEach(qe=>{const ot=Rc.get(qe),pt=O0.get(qe);Rc.set(qe,new Map([...ot?.entries()??[],...pt?.entries()??[]]))});const ym=[],d5=[],u5={};f.forEach(qe=>{const{element:ot,player:pt,instruction:mn}=qe;if(o.has(ot)){if(R.has(ot))return pt.onDestroy(()=>kl(ot,mn.toStyles)),pt.disabled=!0,pt.overrideTotalTime(mn.totalTime),void c.push(pt);let Vr=u5;if(Po.size>1){let la=ot;const Qh=[];for(;la=la.parentNode;){const Mi=Po.get(la);if(Mi){Vr=Mi;break}Qh.push(la)}Qh.forEach(Mi=>Po.set(Mi,Vr))}const Ul=this._buildAnimation(pt.namespaceId,mn,hi,u,O0,Rc);if(pt.setRealPlayer(Ul),Vr===u5)ym.push(pt);else{const la=this.playersByElement.get(Vr);la&&la.length&&(pt.parentPlayer=Yh(la)),c.push(pt)}}else pm(ot,mn.fromStyles),pt.onDestroy(()=>kl(ot,mn.toStyles)),d5.push(pt),R.has(ot)&&c.push(pt)}),d5.forEach(qe=>{const ot=u.get(qe.element);if(ot&&ot.length){const pt=Yh(ot);qe.setRealPlayer(pt)}}),c.forEach(qe=>{qe.parentPlayer?qe.syncPlayerEvents(qe.parentPlayer):qe.destroy()});for(let qe=0;qe<de.length;qe++){const ot=de[qe],pt=ot[wc];if(wv(ot,_P),pt&&pt.hasAnimation)continue;let mn=[];if(g.size){let Ul=g.get(ot);Ul&&Ul.length&&mn.push(...Ul);let la=this.driver.query(ot,NF,!0);for(let Qh=0;Qh<la.length;Qh++){let Mi=g.get(la[Qh]);Mi&&Mi.length&&mn.push(...Mi)}}const Vr=mn.filter(Ul=>!Ul.destroyed);Vr.length?QW(this,ot,Vr):this.processLeaveNode(ot)}return de.length=0,ym.forEach(qe=>{this.players.push(qe),qe.onDone(()=>{qe.destroy();const ot=this.players.indexOf(qe);this.players.splice(ot,1)}),qe.play()}),ym}afterFlush(i){this._flushFns.push(i)}afterFlushAnimationsDone(i){this._whenQuietFns.push(i)}_getPreviousPlayers(i,t,o,c,u){let f=[];if(t){const g=this.playersByQueriedElement.get(i);g&&(f=g)}else{const g=this.playersByElement.get(i);if(g){const y=!u||u==h0;g.forEach(S=>{S.queued||!y&&S.triggerName!=c||f.push(S)})}}return(o||c)&&(f=f.filter(g=>!(o&&o!=g.namespaceId||c&&c!=g.triggerName))),f}_beforeAnimationBuild(i,t,o){const u=t.element,f=t.isRemovalTransition?void 0:i,g=t.isRemovalTransition?void 0:t.triggerName;for(const y of t.timelines){const S=y.element,R=S!==u,k=sa(o,S,[]);this._getPreviousPlayers(S,R,f,g,t.toState).forEach(G=>{const K=G.getRealPlayer();K.beforeDestroy&&K.beforeDestroy(),G.destroy(),k.push(G)})}pm(u,t.fromStyles)}_buildAnimation(i,t,o,c,u,f){const g=t.triggerName,y=t.element,S=[],R=new Set,k=new Set,B=t.timelines.map(K=>{const ee=K.element;R.add(ee);const de=ee[wc];if(de&&de.removedBeforeQueried)return new a0(K.duration,K.delay);const ve=ee!==y,ae=function ZW(e){const i=[];return Gj(e,i),i}((o.get(ee)||zW).map(hi=>hi.getRealPlayer())).filter(hi=>!!hi.element&&hi.element===ee),Ve=u.get(ee),je=f.get(ee),Pt=vj(this._normalizer,K.keyframes,Ve,je),ui=this._buildPlayer(K,Pt,ae);if(K.subTimeline&&c&&k.add(ee),ve){const hi=new zF(i,g,ee);hi.setRealPlayer(ui),S.push(hi)}return ui});S.forEach(K=>{sa(this.playersByQueriedElement,K.element,[]).push(K),K.onDone(()=>function $W(e,i,t){let o=e.get(i);if(o){if(o.length){const c=o.indexOf(t);o.splice(c,1)}0==o.length&&e.delete(i)}return o}(this.playersByQueriedElement,K.element,K))}),R.forEach(K=>Wa(K,Ij));const G=Yh(B);return G.onDestroy(()=>{R.forEach(K=>wv(K,Ij)),kl(y,t.toStyles)}),k.forEach(K=>{sa(c,K,[]).push(G)}),G}_buildPlayer(i,t,o){return t.length>0?this.driver.animate(i.element,t,i.duration,i.delay,i.easing,o):new a0(i.duration,i.delay)}}class zF{constructor(i,t,o){this.namespaceId=i,this.triggerName=t,this.element=o,this._player=new a0,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(i){this._containsRealPlayer||(this._player=i,this._queuedCallbacks.forEach((t,o)=>{t.forEach(c=>wF(i,o,void 0,c))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(i.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(i){this.totalTime=i}syncPlayerEvents(i){const t=this._player;t.triggerCallback&&i.onStart(()=>t.triggerCallback("start")),i.onDone(()=>this.finish()),i.onDestroy(()=>this.destroy())}_queueEvent(i,t){sa(this._queuedCallbacks,i,[]).push(t)}onDone(i){this.queued&&this._queueEvent("done",i),this._player.onDone(i)}onStart(i){this.queued&&this._queueEvent("start",i),this._player.onStart(i)}onDestroy(i){this.queued&&this._queueEvent("destroy",i),this._player.onDestroy(i)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(i){this.queued||this._player.setPosition(i)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(i){const t=this._player;t.triggerCallback&&t.triggerCallback(i)}}function RP(e){return e&&1===e.nodeType}function Bj(e,i){const t=e.style.display;return e.style.display=i??"none",t}function jj(e,i,t,o,c){const u=[];t.forEach(y=>u.push(Bj(y)));const f=[];o.forEach((y,S)=>{const R=new Map;y.forEach(k=>{const B=i.computeStyle(S,k,c);R.set(k,B),(!B||0==B.length)&&(S[wc]=qW,f.push(S))}),e.set(S,R)});let g=0;return t.forEach(y=>Bj(y,u[g++])),f}function Hj(e,i){const t=new Map;if(e.forEach(g=>t.set(g,[])),0==i.length)return t;const c=new Set(i),u=new Map;function f(g){if(!g)return 1;let y=u.get(g);if(y)return y;const S=g.parentNode;return y=t.has(S)?S:c.has(S)?1:f(S),u.set(g,y),y}return i.forEach(g=>{const y=f(g);1!==y&&t.get(y).push(g)}),t}function Wa(e,i){e.classList?.add(i)}function wv(e,i){e.classList?.remove(i)}function QW(e,i,t){Yh(t).onDone(()=>e.processLeaveNode(i))}function Gj(e,i){for(let t=0;t<e.length;t++){const o=e[t];o instanceof FB?Gj(o.players,i):i.push(o)}}function Wj(e,i,t){const o=t.get(e);if(!o)return!1;let c=i.get(e);return c?o.forEach(u=>c.add(u)):i.set(e,o),t.delete(e),!0}class AP{constructor(i,t,o){this.bodyNode=i,this._driver=t,this._normalizer=o,this._triggerCache={},this.onRemovalComplete=(c,u)=>{},this._transitionEngine=new YW(i,t,o),this._timelineEngine=new BW(i,t,o),this._transitionEngine.onRemovalComplete=(c,u)=>this.onRemovalComplete(c,u)}registerTrigger(i,t,o,c,u){const f=i+"-"+c;let g=this._triggerCache[f];if(!g){const y=[],R=kF(this._driver,u,y,[]);if(y.length)throw function HG(e,i){return new ue(3404,!1)}();g=function LW(e,i,t){return new FW(e,i,t)}(c,R,this._normalizer),this._triggerCache[f]=g}this._transitionEngine.registerTrigger(t,c,g)}register(i,t){this._transitionEngine.register(i,t)}destroy(i,t){this._transitionEngine.destroy(i,t)}onInsert(i,t,o,c){this._transitionEngine.insertNode(i,t,o,c)}onRemove(i,t,o){this._transitionEngine.removeNode(i,t,o)}disableAnimations(i,t){this._transitionEngine.markElementAsDisabled(i,t)}process(i,t,o,c){if("@"==o.charAt(0)){const[u,f]=yj(o);this._timelineEngine.command(u,t,f,c)}else this._transitionEngine.trigger(i,t,o,c)}listen(i,t,o,c,u){if("@"==o.charAt(0)){const[f,g]=yj(o);return this._timelineEngine.listen(f,t,g,u)}return this._transitionEngine.listen(i,t,o,c,u)}flush(i=-1){this._transitionEngine.flush(i)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(i){this._transitionEngine.afterFlushAnimationsDone(i)}}let n9=(()=>{class e{static#e=this.initialStylesByElement=new WeakMap;constructor(t,o,c){this._element=t,this._startStyles=o,this._endStyles=c,this._state=0;let u=e.initialStylesByElement.get(t);u||e.initialStylesByElement.set(t,u=new Map),this._initialStyles=u}start(){this._state<1&&(this._startStyles&&kl(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(kl(this._element,this._initialStyles),this._endStyles&&(kl(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(pm(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(pm(this._element,this._endStyles),this._endStyles=null),kl(this._element,this._initialStyles),this._state=3)}}return e})();function qF(e){let i=null;return e.forEach((t,o)=>{(function i9(e){return"display"===e||"position"===e})(o)&&(i=i||new Map,i.set(o,t))}),i}class zj{constructor(i,t,o,c){this.element=i,this.keyframes=t,this.options=o,this._specialStyles=c,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=o.duration,this._delay=o.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const i=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,i,this.options),this._finalKeyframe=i.length?i[i.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(i){const t=[];return i.forEach(o=>{t.push(Object.fromEntries(o))}),t}_triggerWebAnimation(i,t,o){return i.animate(this._convertKeyframesToObject(t),o)}onStart(i){this._originalOnStartFns.push(i),this._onStartFns.push(i)}onDone(i){this._originalOnDoneFns.push(i),this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(i=>i()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}setPosition(i){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=i*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const i=new Map;this.hasStarted()&&this._finalKeyframe.forEach((o,c)=>{"offset"!==c&&i.set(c,this._finished?o:Oj(this.element,c))}),this.currentSnapshot=i}triggerCallback(i){const t="start"===i?this._onStartFns:this._onDoneFns;t.forEach(o=>o()),t.length=0}}class r9{validateStyleProperty(i){return!0}validateAnimatableStyleProperty(i){return!0}matchesElement(i,t){return!1}containsElement(i,t){return Sj(i,t)}getParentElement(i){return AF(i)}query(i,t,o){return Cj(i,t,o)}computeStyle(i,t,o){return window.getComputedStyle(i)[t]}animate(i,t,o,c,u,f=[]){const y={duration:o,delay:c,fill:0==c?"both":"forwards"};u&&(y.easing=u);const S=new Map,R=f.filter(G=>G instanceof zj);(function uW(e,i){return 0===e||0===i})(o,c)&&R.forEach(G=>{G.currentSnapshot.forEach((K,ee)=>S.set(ee,K))});let k=function cW(e){return e.length?e[0]instanceof Map?e:e.map(i=>Rj(i)):[]}(t).map(G=>$h(G));k=function hW(e,i,t){if(t.size&&i.length){let o=i[0],c=[];if(t.forEach((u,f)=>{o.has(f)||c.push(f),o.set(f,u)}),c.length)for(let u=1;u<i.length;u++){let f=i[u];c.forEach(g=>f.set(g,Oj(e,g)))}}return i}(i,k,S);const B=function t9(e,i){let t=null,o=null;return Array.isArray(i)&&i.length?(t=qF(i[0]),i.length>1&&(o=qF(i[i.length-1]))):i instanceof Map&&(t=qF(i)),t||o?new n9(e,t,o):null}(i,k);return new zj(i,k,y,B)}}let o9=(()=>{class e extends kB{constructor(t,o){super(),this._nextAnimationId=0,this._renderer=t.createRenderer(o.body,{id:"0",encapsulation:Ar.None,styles:[],data:{animation:[]}})}build(t){const o=this._nextAnimationId.toString();this._nextAnimationId++;const c=Array.isArray(t)?LB(t):t;return qj(this._renderer,null,o,"register",[c]),new s9(o,this._renderer)}static#e=this.\u0275fac=function(o){return new(o||e)(pe(Yp),pe(Yt))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac})}return e})();class s9 extends g8{constructor(i,t){super(),this._id=i,this._renderer=t}create(i,t){return new a9(this._id,i,t||{},this._renderer)}}class a9{constructor(i,t,o,c){this.id=i,this.element=t,this._renderer=c,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",o)}_listen(i,t){return this._renderer.listen(this.element,`@@${this.id}:${i}`,t)}_command(i,...t){return qj(this._renderer,this.element,this.id,i,t)}onDone(i){this._listen("done",i)}onStart(i){this._listen("start",i)}onDestroy(i){this._listen("destroy",i)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(i){this._command("setPosition",i)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function qj(e,i,t,o,c){return e.setProperty(i,`@@${t}:${o}`,c)}const Kj="@.disabled";let c9=(()=>{class e{constructor(t,o,c){this.delegate=t,this.engine=o,this._zone=c,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,o.onRemovalComplete=(u,f)=>{const g=f?.parentNode(u);g&&f.removeChild(g,u)}}createRenderer(t,o){const u=this.delegate.createRenderer(t,o);if(!(t&&o&&o.data&&o.data.animation)){let R=this._rendererCache.get(u);return R||(R=new Yj("",u,this.engine,()=>this._rendererCache.delete(u)),this._rendererCache.set(u,R)),R}const f=o.id,g=o.id+"-"+this._currentId;this._currentId++,this.engine.register(g,t);const y=R=>{Array.isArray(R)?R.forEach(y):this.engine.registerTrigger(f,g,t,R.name,R)};return o.data.animation.forEach(y),new l9(this,g,u,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(t,o,c){t>=0&&t<this._microtaskId?this._zone.run(()=>o(c)):(0==this._animationCallbacksBuffer.length&&queueMicrotask(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(u=>{const[f,g]=u;f(g)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([o,c]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}static#e=this.\u0275fac=function(o){return new(o||e)(pe(Yp),pe(AP),pe(lt))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac})}return e})();class Yj{constructor(i,t,o,c){this.namespaceId=i,this.delegate=t,this.engine=o,this._onDestroy=c}get data(){return this.delegate.data}destroyNode(i){this.delegate.destroyNode?.(i)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(i,t){return this.delegate.createElement(i,t)}createComment(i){return this.delegate.createComment(i)}createText(i){return this.delegate.createText(i)}appendChild(i,t){this.delegate.appendChild(i,t),this.engine.onInsert(this.namespaceId,t,i,!1)}insertBefore(i,t,o,c=!0){this.delegate.insertBefore(i,t,o),this.engine.onInsert(this.namespaceId,t,i,c)}removeChild(i,t,o){this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(i,t){return this.delegate.selectRootElement(i,t)}parentNode(i){return this.delegate.parentNode(i)}nextSibling(i){return this.delegate.nextSibling(i)}setAttribute(i,t,o,c){this.delegate.setAttribute(i,t,o,c)}removeAttribute(i,t,o){this.delegate.removeAttribute(i,t,o)}addClass(i,t){this.delegate.addClass(i,t)}removeClass(i,t){this.delegate.removeClass(i,t)}setStyle(i,t,o,c){this.delegate.setStyle(i,t,o,c)}removeStyle(i,t,o){this.delegate.removeStyle(i,t,o)}setProperty(i,t,o){"@"==t.charAt(0)&&t==Kj?this.disableAnimations(i,!!o):this.delegate.setProperty(i,t,o)}setValue(i,t){this.delegate.setValue(i,t)}listen(i,t,o){return this.delegate.listen(i,t,o)}disableAnimations(i,t){this.engine.disableAnimations(i,t)}}class l9 extends Yj{constructor(i,t,o,c,u){super(t,o,c,u),this.factory=i,this.namespaceId=t}setProperty(i,t,o){"@"==t.charAt(0)?"."==t.charAt(1)&&t==Kj?this.disableAnimations(i,o=void 0===o||!!o):this.engine.process(this.namespaceId,i,t.slice(1),o):this.delegate.setProperty(i,t,o)}listen(i,t,o){if("@"==t.charAt(0)){const c=function d9(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(i);let u=t.slice(1),f="";return"@"!=u.charAt(0)&&([u,f]=function u9(e){const i=e.indexOf(".");return[e.substring(0,i),e.slice(i+1)]}(u)),this.engine.listen(this.namespaceId,c,u,f,g=>{this.factory.scheduleListenerCallback(g._data||-1,o,g)})}return this.delegate.listen(i,t,o)}}const $j=[{provide:kB,useClass:o9},{provide:BF,useFactory:function p9(){return new PW}},{provide:AP,useClass:(()=>{class e extends AP{constructor(t,o,c,u){super(t.body,o,c)}ngOnDestroy(){this.flush()}static#e=this.\u0275fac=function(o){return new(o||e)(pe(Yt),pe(DF),pe(BF),pe(ea))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac})}return e})()},{provide:Yp,useFactory:function f9(e,i,t){return new c9(e,i,t)},deps:[Wi,AP,lt]}],KF=[{provide:DF,useFactory:()=>new r9},{provide:ba,useValue:"BrowserAnimations"},...$j],Xj=[{provide:DF,useClass:Tj},{provide:ba,useValue:"NoopAnimations"},...$j];let m9=(()=>{class e{static withConfig(t){return{ngModule:e,providers:t.disableAnimations?Xj:KF}}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({providers:KF,imports:[jN]})}return e})();const OP=Dc(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function Jj(e){return new Ln(i=>{xi(e()).subscribe(i)})}function p0(e,i){const t=x(e)?e:()=>e,o=c=>c.error(t());return new Ln(i?c=>i.schedule(o,0,c):o)}function YF(){return ti((e,i)=>{let t=null;e._refCount++;const o=Wn(i,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(t=null);const c=e._connection,u=t;t=null,c&&(!u||c===u)&&c.unsubscribe(),i.unsubscribe()});e.subscribe(o),o.closed||(t=e.connect())})}class Qj extends Ln{constructor(i,t){super(),this.source=i,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,Vv(i)&&(this.lift=i.lift)}_subscribe(i){return this.getSubject().subscribe(i)}getSubject(){const i=this._subject;return(!i||i.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:i}=this;this._subject=this._connection=null,i?.unsubscribe()}connect(){let i=this._connection;if(!i){i=this._connection=new Dn;const t=this.getSubject();i.add(this.source.subscribe(Wn(t,void 0,()=>{this._teardown(),t.complete()},o=>{this._teardown(),t.error(o)},()=>this._teardown()))),i.closed&&(this._connection=null,i=Dn.EMPTY)}return i}refCount(){return YF()(this)}}function NP(e){return ti((i,t)=>{let o=!1;i.subscribe(Wn(t,c=>{o=!0,t.next(c)},()=>{o||t.next(e),t.complete()}))})}function Zj(e=g9){return ti((i,t)=>{let o=!1;i.subscribe(Wn(t,c=>{o=!0,t.next(c)},()=>o?t.complete():t.error(e())))})}function g9(){return new OP}function mm(e,i){const t=arguments.length>=2;return o=>o.pipe(e?ra((c,u)=>e(c,u,o)):qa,wr(1),t?NP(i):Zj(()=>new OP))}function f0(e,i){return x(i)?fi(e,i,1):fi(e,1)}function Ur(e,i,t){const o=x(e)||i||t?{next:e,error:i,complete:t}:e;return o?ti((c,u)=>{var f;null===(f=o.subscribe)||void 0===f||f.call(o);let g=!0;c.subscribe(Wn(u,y=>{var S;null===(S=o.next)||void 0===S||S.call(o,y),u.next(y)},()=>{var y;g=!1,null===(y=o.complete)||void 0===y||y.call(o),u.complete()},y=>{var S;g=!1,null===(S=o.error)||void 0===S||S.call(o,y),u.error(y)},()=>{var y,S;g&&(null===(y=o.unsubscribe)||void 0===y||y.call(o)),null===(S=o.finalize)||void 0===S||S.call(o)}))}):qa}function _m(e){return ti((i,t)=>{let u,o=null,c=!1;o=i.subscribe(Wn(t,void 0,void 0,f=>{u=xi(e(f,_m(e)(i))),o?(o.unsubscribe(),o=null,u.subscribe(t)):c=!0})),c&&(o.unsubscribe(),o=null,u.subscribe(t))})}function $F(e){return e<=0?()=>ks:ti((i,t)=>{let o=[];i.subscribe(Wn(t,c=>{o.push(c),e<o.length&&o.shift()},()=>{for(const c of o)t.next(c);t.complete()},void 0,()=>{o=null}))})}function e4(e){return dn(()=>e)}function XF(e){return ti((i,t)=>{try{i.subscribe(t)}finally{t.add(e)}})}const Mt="primary",m0=Symbol("RouteTitle");class b9{constructor(i){this.params=i||{}}has(i){return Object.prototype.hasOwnProperty.call(this.params,i)}get(i){if(this.has(i)){const t=this.params[i];return Array.isArray(t)?t[0]:t}return null}getAll(i){if(this.has(i)){const t=this.params[i];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Iv(e){return new b9(e)}function S9(e,i,t){const o=t.path.split("/");if(o.length>e.length||"full"===t.pathMatch&&(i.hasChildren()||o.length<e.length))return null;const c={};for(let u=0;u<o.length;u++){const f=o[u],g=e[u];if(f.startsWith(":"))c[f.substring(1)]=g;else if(f!==g.path)return null}return{consumed:e.slice(0,o.length),posParams:c}}function Ll(e,i){const t=e?Object.keys(e):void 0,o=i?Object.keys(i):void 0;if(!t||!o||t.length!=o.length)return!1;let c;for(let u=0;u<t.length;u++)if(c=t[u],!t4(e[c],i[c]))return!1;return!0}function t4(e,i){if(Array.isArray(e)&&Array.isArray(i)){if(e.length!==i.length)return!1;const t=[...e].sort(),o=[...i].sort();return t.every((c,u)=>o[u]===c)}return e===i}function n4(e){return e.length>0?e[e.length-1]:null}function Xh(e){return function _9(e){return!!e&&(e instanceof Ln||x(e.lift)&&x(e.subscribe))}(e)?e:ud(e)?ki(Promise.resolve(e)):He(e)}const T9={exact:function o4(e,i,t){if(!gm(e.segments,i.segments)||!PP(e.segments,i.segments,t)||e.numberOfChildren!==i.numberOfChildren)return!1;for(const o in i.children)if(!e.children[o]||!o4(e.children[o],i.children[o],t))return!1;return!0},subset:s4},i4={exact:function w9(e,i){return Ll(e,i)},subset:function I9(e,i){return Object.keys(i).length<=Object.keys(e).length&&Object.keys(i).every(t=>t4(e[t],i[t]))},ignored:()=>!0};function r4(e,i,t){return T9[t.paths](e.root,i.root,t.matrixParams)&&i4[t.queryParams](e.queryParams,i.queryParams)&&!("exact"===t.fragment&&e.fragment!==i.fragment)}function s4(e,i,t){return a4(e,i,i.segments,t)}function a4(e,i,t,o){if(e.segments.length>t.length){const c=e.segments.slice(0,t.length);return!(!gm(c,t)||i.hasChildren()||!PP(c,t,o))}if(e.segments.length===t.length){if(!gm(e.segments,t)||!PP(e.segments,t,o))return!1;for(const c in i.children)if(!e.children[c]||!s4(e.children[c],i.children[c],o))return!1;return!0}{const c=t.slice(0,e.segments.length),u=t.slice(e.segments.length);return!!(gm(e.segments,c)&&PP(e.segments,c,o)&&e.children[Mt])&&a4(e.children[Mt],i,u,o)}}function PP(e,i,t){return i.every((o,c)=>i4[t](e[c].parameters,o.parameters))}class Rv{constructor(i=new kn([],{}),t={},o=null){this.root=i,this.queryParams=t,this.fragment=o}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Iv(this.queryParams)),this._queryParamMap}toString(){return D9.serialize(this)}}class kn{constructor(i,t){this.segments=i,this.children=t,this.parent=null,Object.values(t).forEach(o=>o.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return MP(this)}}class _0{constructor(i,t){this.path=i,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=Iv(this.parameters)),this._parameterMap}toString(){return d4(this)}}function gm(e,i){return e.length===i.length&&e.every((t,o)=>t.path===i[o].path)}let g0=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:function(){return new JF},providedIn:"root"})}return e})();class JF{parse(i){const t=new B9(i);return new Rv(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(i){const t=`/${E0(i.root,!0)}`,o=function P9(e){const i=Object.keys(e).map(t=>{const o=e[t];return Array.isArray(o)?o.map(c=>`${xP(t)}=${xP(c)}`).join("&"):`${xP(t)}=${xP(o)}`}).filter(t=>!!t);return i.length?`?${i.join("&")}`:""}(i.queryParams);return`${t}${o}${"string"==typeof i.fragment?`#${function O9(e){return encodeURI(e)}(i.fragment)}`:""}`}}const D9=new JF;function MP(e){return e.segments.map(i=>d4(i)).join("/")}function E0(e,i){if(!e.hasChildren())return MP(e);if(i){const t=e.children[Mt]?E0(e.children[Mt],!1):"",o=[];return Object.entries(e.children).forEach(([c,u])=>{c!==Mt&&o.push(`${c}:${E0(u,!1)}`)}),o.length>0?`${t}(${o.join("//")})`:t}{const t=function A9(e,i){let t=[];return Object.entries(e.children).forEach(([o,c])=>{o===Mt&&(t=t.concat(i(c,o)))}),Object.entries(e.children).forEach(([o,c])=>{o!==Mt&&(t=t.concat(i(c,o)))}),t}(e,(o,c)=>c===Mt?[E0(e.children[Mt],!1)]:[`${c}:${E0(o,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[Mt]?`${MP(e)}/${t[0]}`:`${MP(e)}/(${t.join("//")})`}}function c4(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function xP(e){return c4(e).replace(/%3B/gi,";")}function QF(e){return c4(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function kP(e){return decodeURIComponent(e)}function l4(e){return kP(e.replace(/\+/g,"%20"))}function d4(e){return`${QF(e.path)}${function N9(e){return Object.keys(e).map(i=>`;${QF(i)}=${QF(e[i])}`).join("")}(e.parameters)}`}const M9=/^[^\/()?;#]+/;function ZF(e){const i=e.match(M9);return i?i[0]:""}const x9=/^[^\/()?;=#]+/,L9=/^[^=?&#]+/,U9=/^[^&#]+/;class B9{constructor(i){this.url=i,this.remaining=i}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new kn([],{}):new kn([],this.parseChildren())}parseQueryParams(){const i={};if(this.consumeOptional("?"))do{this.parseQueryParam(i)}while(this.consumeOptional("&"));return i}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const i=[];for(this.peekStartsWith("(")||i.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),i.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let o={};return this.peekStartsWith("(")&&(o=this.parseParens(!1)),(i.length>0||Object.keys(t).length>0)&&(o[Mt]=new kn(i,t)),o}parseSegment(){const i=ZF(this.remaining);if(""===i&&this.peekStartsWith(";"))throw new ue(4009,!1);return this.capture(i),new _0(kP(i),this.parseMatrixParams())}parseMatrixParams(){const i={};for(;this.consumeOptional(";");)this.parseParam(i);return i}parseParam(i){const t=function k9(e){const i=e.match(x9);return i?i[0]:""}(this.remaining);if(!t)return;this.capture(t);let o="";if(this.consumeOptional("=")){const c=ZF(this.remaining);c&&(o=c,this.capture(o))}i[kP(t)]=kP(o)}parseQueryParam(i){const t=function F9(e){const i=e.match(L9);return i?i[0]:""}(this.remaining);if(!t)return;this.capture(t);let o="";if(this.consumeOptional("=")){const f=function V9(e){const i=e.match(U9);return i?i[0]:""}(this.remaining);f&&(o=f,this.capture(o))}const c=l4(t),u=l4(o);if(i.hasOwnProperty(c)){let f=i[c];Array.isArray(f)||(f=[f],i[c]=f),f.push(u)}else i[c]=u}parseParens(i){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const o=ZF(this.remaining),c=this.remaining[o.length];if("/"!==c&&")"!==c&&";"!==c)throw new ue(4010,!1);let u;o.indexOf(":")>-1?(u=o.slice(0,o.indexOf(":")),this.capture(u),this.capture(":")):i&&(u=Mt);const f=this.parseChildren();t[u]=1===Object.keys(f).length?f[Mt]:new kn([],f),this.consumeOptional("//")}return t}peekStartsWith(i){return this.remaining.startsWith(i)}consumeOptional(i){return!!this.peekStartsWith(i)&&(this.remaining=this.remaining.substring(i.length),!0)}capture(i){if(!this.consumeOptional(i))throw new ue(4011,!1)}}function u4(e){return e.segments.length>0?new kn([],{[Mt]:e}):e}function h4(e){const i={};for(const o of Object.keys(e.children)){const u=h4(e.children[o]);if(o===Mt&&0===u.segments.length&&u.hasChildren())for(const[f,g]of Object.entries(u.children))i[f]=g;else(u.segments.length>0||u.hasChildren())&&(i[o]=u)}return function j9(e){if(1===e.numberOfChildren&&e.children[Mt]){const i=e.children[Mt];return new kn(e.segments.concat(i.segments),i.children)}return e}(new kn(e.segments,i))}function Em(e){return e instanceof Rv}function p4(e){let i;const c=u4(function t(u){const f={};for(const y of u.children){const S=t(y);f[y.outlet]=S}const g=new kn(u.url,f);return u===e&&(i=g),g}(e.root));return i??c}function f4(e,i,t,o){let c=e;for(;c.parent;)c=c.parent;if(0===i.length)return eU(c,c,c,t,o);const u=function G9(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new _4(!0,0,e);let i=0,t=!1;const o=e.reduce((c,u,f)=>{if("object"==typeof u&&null!=u){if(u.outlets){const g={};return Object.entries(u.outlets).forEach(([y,S])=>{g[y]="string"==typeof S?S.split("/"):S}),[...c,{outlets:g}]}if(u.segmentPath)return[...c,u.segmentPath]}return"string"!=typeof u?[...c,u]:0===f?(u.split("/").forEach((g,y)=>{0==y&&"."===g||(0==y&&""===g?t=!0:".."===g?i++:""!=g&&c.push(g))}),c):[...c,u]},[]);return new _4(t,i,o)}(i);if(u.toRoot())return eU(c,c,new kn([],{}),t,o);const f=function W9(e,i,t){if(e.isAbsolute)return new FP(i,!0,0);if(!t)return new FP(i,!1,NaN);if(null===t.parent)return new FP(t,!0,0);const o=LP(e.commands[0])?0:1;return function z9(e,i,t){let o=e,c=i,u=t;for(;u>c;){if(u-=c,o=o.parent,!o)throw new ue(4005,!1);c=o.segments.length}return new FP(o,!1,c-u)}(t,t.segments.length-1+o,e.numberOfDoubleDots)}(u,c,e),g=f.processChildren?y0(f.segmentGroup,f.index,u.commands):g4(f.segmentGroup,f.index,u.commands);return eU(c,f.segmentGroup,g,t,o)}function LP(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function v0(e){return"object"==typeof e&&null!=e&&e.outlets}function eU(e,i,t,o,c){let f,u={};o&&Object.entries(o).forEach(([y,S])=>{u[y]=Array.isArray(S)?S.map(R=>`${R}`):`${S}`}),f=e===i?t:m4(e,i,t);const g=u4(h4(f));return new Rv(g,u,c)}function m4(e,i,t){const o={};return Object.entries(e.children).forEach(([c,u])=>{o[c]=u===i?t:m4(u,i,t)}),new kn(e.segments,o)}class _4{constructor(i,t,o){if(this.isAbsolute=i,this.numberOfDoubleDots=t,this.commands=o,i&&o.length>0&&LP(o[0]))throw new ue(4003,!1);const c=o.find(v0);if(c&&c!==n4(o))throw new ue(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class FP{constructor(i,t,o){this.segmentGroup=i,this.processChildren=t,this.index=o}}function g4(e,i,t){if(e||(e=new kn([],{})),0===e.segments.length&&e.hasChildren())return y0(e,i,t);const o=function K9(e,i,t){let o=0,c=i;const u={match:!1,pathIndex:0,commandIndex:0};for(;c<e.segments.length;){if(o>=t.length)return u;const f=e.segments[c],g=t[o];if(v0(g))break;const y=`${g}`,S=o<t.length-1?t[o+1]:null;if(c>0&&void 0===y)break;if(y&&S&&"object"==typeof S&&void 0===S.outlets){if(!v4(y,S,f))return u;o+=2}else{if(!v4(y,{},f))return u;o++}c++}return{match:!0,pathIndex:c,commandIndex:o}}(e,i,t),c=t.slice(o.commandIndex);if(o.match&&o.pathIndex<e.segments.length){const u=new kn(e.segments.slice(0,o.pathIndex),{});return u.children[Mt]=new kn(e.segments.slice(o.pathIndex),e.children),y0(u,0,c)}return o.match&&0===c.length?new kn(e.segments,{}):o.match&&!e.hasChildren()?tU(e,i,t):o.match?y0(e,0,c):tU(e,i,t)}function y0(e,i,t){if(0===t.length)return new kn(e.segments,{});{const o=function q9(e){return v0(e[0])?e[0].outlets:{[Mt]:e}}(t),c={};if(Object.keys(o).some(u=>u!==Mt)&&e.children[Mt]&&1===e.numberOfChildren&&0===e.children[Mt].segments.length){const u=y0(e.children[Mt],i,t);return new kn(e.segments,u.children)}return Object.entries(o).forEach(([u,f])=>{"string"==typeof f&&(f=[f]),null!==f&&(c[u]=g4(e.children[u],i,f))}),Object.entries(e.children).forEach(([u,f])=>{void 0===o[u]&&(c[u]=f)}),new kn(e.segments,c)}}function tU(e,i,t){const o=e.segments.slice(0,i);let c=0;for(;c<t.length;){const u=t[c];if(v0(u)){const y=Y9(u.outlets);return new kn(o,y)}if(0===c&&LP(t[0])){o.push(new _0(e.segments[i].path,E4(t[0]))),c++;continue}const f=v0(u)?u.outlets[Mt]:`${u}`,g=c<t.length-1?t[c+1]:null;f&&g&&LP(g)?(o.push(new _0(f,E4(g))),c+=2):(o.push(new _0(f,{})),c++)}return new kn(o,{})}function Y9(e){const i={};return Object.entries(e).forEach(([t,o])=>{"string"==typeof o&&(o=[o]),null!==o&&(i[t]=tU(new kn([],{}),0,o))}),i}function E4(e){const i={};return Object.entries(e).forEach(([t,o])=>i[t]=`${o}`),i}function v4(e,i,t){return e==t.path&&Ll(i,t.parameters)}const b0="imperative";class Fl{constructor(i,t){this.id=i,this.url=t}}class UP extends Fl{constructor(i,t,o="imperative",c=null){super(i,t),this.type=0,this.navigationTrigger=o,this.restoredState=c}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Jh extends Fl{constructor(i,t,o){super(i,t),this.urlAfterRedirects=o,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class S0 extends Fl{constructor(i,t,o,c){super(i,t),this.reason=o,this.code=c,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Av extends Fl{constructor(i,t,o,c){super(i,t),this.reason=o,this.code=c,this.type=16}}class VP extends Fl{constructor(i,t,o,c){super(i,t),this.error=o,this.target=c,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class y4 extends Fl{constructor(i,t,o,c){super(i,t),this.urlAfterRedirects=o,this.state=c,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class $9 extends Fl{constructor(i,t,o,c){super(i,t),this.urlAfterRedirects=o,this.state=c,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class X9 extends Fl{constructor(i,t,o,c,u){super(i,t),this.urlAfterRedirects=o,this.state=c,this.shouldActivate=u,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class J9 extends Fl{constructor(i,t,o,c){super(i,t),this.urlAfterRedirects=o,this.state=c,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Q9 extends Fl{constructor(i,t,o,c){super(i,t),this.urlAfterRedirects=o,this.state=c,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Z9{constructor(i){this.route=i,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class ez{constructor(i){this.route=i,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class tz{constructor(i){this.snapshot=i,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class nz{constructor(i){this.snapshot=i,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class iz{constructor(i){this.snapshot=i,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class rz{constructor(i){this.snapshot=i,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class b4{constructor(i,t,o){this.routerEvent=i,this.position=t,this.anchor=o,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class nU{}class iU{constructor(i){this.url=i}}class oz{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new C0,this.attachRef=null}}let C0=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(t,o){const c=this.getOrCreateContext(t);c.outlet=o,this.contexts.set(t,c)}onChildOutletDestroyed(t){const o=this.getContext(t);o&&(o.outlet=null,o.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let o=this.getContext(t);return o||(o=new oz,this.contexts.set(t,o)),o}getContext(t){return this.contexts.get(t)||null}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class S4{constructor(i){this._root=i}get root(){return this._root.value}parent(i){const t=this.pathFromRoot(i);return t.length>1?t[t.length-2]:null}children(i){const t=rU(i,this._root);return t?t.children.map(o=>o.value):[]}firstChild(i){const t=rU(i,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(i){const t=oU(i,this._root);return t.length<2?[]:t[t.length-2].children.map(c=>c.value).filter(c=>c!==i)}pathFromRoot(i){return oU(i,this._root).map(t=>t.value)}}function rU(e,i){if(e===i.value)return i;for(const t of i.children){const o=rU(e,t);if(o)return o}return null}function oU(e,i){if(e===i.value)return[i];for(const t of i.children){const o=oU(e,t);if(o.length)return o.unshift(i),o}return[]}class Qd{constructor(i,t){this.value=i,this.children=t}toString(){return`TreeNode(${this.value})`}}function Dv(e){const i={};return e&&e.children.forEach(t=>i[t.value.outlet]=t),i}class C4 extends S4{constructor(i,t){super(i),this.snapshot=t,sU(this,i)}toString(){return this.snapshot.toString()}}function T4(e,i){const t=function sz(e,i){const f=new BP([],{},{},"",{},Mt,i,null,{});return new I4("",new Qd(f,[]))}(0,i),o=new Rr([new _0("",{})]),c=new Rr({}),u=new Rr({}),f=new Rr({}),g=new Rr(""),y=new vm(o,c,f,g,u,Mt,i,t.root);return y.snapshot=t.root,new C4(new Qd(y,[]),t)}class vm{constructor(i,t,o,c,u,f,g,y){this.urlSubject=i,this.paramsSubject=t,this.queryParamsSubject=o,this.fragmentSubject=c,this.dataSubject=u,this.outlet=f,this.component=g,this._futureSnapshot=y,this.title=this.dataSubject?.pipe(dn(S=>S[m0]))??He(void 0),this.url=i,this.params=t,this.queryParams=o,this.fragment=c,this.data=u}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(dn(i=>Iv(i)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(dn(i=>Iv(i)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function w4(e,i="emptyOnly"){const t=e.pathFromRoot;let o=0;if("always"!==i)for(o=t.length-1;o>=1;){const c=t[o],u=t[o-1];if(c.routeConfig&&""===c.routeConfig.path)o--;else{if(u.component)break;o--}}return function az(e){return e.reduce((i,t)=>({params:{...i.params,...t.params},data:{...i.data,...t.data},resolve:{...t.data,...i.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(o))}class BP{get title(){return this.data?.[m0]}constructor(i,t,o,c,u,f,g,y,S){this.url=i,this.params=t,this.queryParams=o,this.fragment=c,this.data=u,this.outlet=f,this.component=g,this.routeConfig=y,this._resolve=S}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Iv(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Iv(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(o=>o.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class I4 extends S4{constructor(i,t){super(t),this.url=i,sU(this,t)}toString(){return R4(this._root)}}function sU(e,i){i.value._routerState=e,i.children.forEach(t=>sU(e,t))}function R4(e){const i=e.children.length>0?` { ${e.children.map(R4).join(", ")} } `:"";return`${e.value}${i}`}function aU(e){if(e.snapshot){const i=e.snapshot,t=e._futureSnapshot;e.snapshot=t,Ll(i.queryParams,t.queryParams)||e.queryParamsSubject.next(t.queryParams),i.fragment!==t.fragment&&e.fragmentSubject.next(t.fragment),Ll(i.params,t.params)||e.paramsSubject.next(t.params),function C9(e,i){if(e.length!==i.length)return!1;for(let t=0;t<e.length;++t)if(!Ll(e[t],i[t]))return!1;return!0}(i.url,t.url)||e.urlSubject.next(t.url),Ll(i.data,t.data)||e.dataSubject.next(t.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function cU(e,i){const t=Ll(e.params,i.params)&&function R9(e,i){return gm(e,i)&&e.every((t,o)=>Ll(t.parameters,i[o].parameters))}(e.url,i.url);return t&&!(!e.parent!=!i.parent)&&(!e.parent||cU(e.parent,i.parent))}let lU=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=Mt,this.activateEvents=new en,this.deactivateEvents=new en,this.attachEvents=new en,this.detachEvents=new en,this.parentContexts=Oe(C0),this.location=Oe(Qo),this.changeDetector=Oe(rr),this.environmentInjector=Oe(qo),this.inputBinder=Oe(jP,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){const{firstChange:o,previousValue:c}=t.name;if(o)return;this.isTrackedInParentContexts(c)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(c)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ue(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ue(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ue(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,o){this.activated=t,this._activatedRoute=o,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,o){if(this.isActivated)throw new ue(4013,!1);this._activatedRoute=t;const c=this.location,f=t.snapshot.component,g=this.parentContexts.getOrCreateContext(this.name).children,y=new cz(t,g,c.injector);this.activated=c.createComponent(f,{index:c.length,injector:y,environmentInjector:o??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ge({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Ho]})}return e})();class cz{constructor(i,t,o){this.route=i,this.childContexts=t,this.parent=o}get(i,t){return i===vm?this.route:i===C0?this.childContexts:this.parent.get(i,t)}}const jP=new De("");let A4=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){const{activatedRoute:o}=t,c=rP([o.queryParams,o.params,o.data]).pipe(Lo(([u,f,g],y)=>(g={...u,...f,...g},0===y?He(g):Promise.resolve(g)))).subscribe(u=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==o||null===o.component)return void this.unsubscribeFromRouteData(t);const f=function GL(e){const i=$t(e);if(!i)return null;const t=new nh(i);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return i.standalone},get isSignal(){return i.signals}}}(o.component);if(f)for(const{templateName:g}of f.inputs)t.activatedComponentRef.setInput(g,u[g]);else this.unsubscribeFromRouteData(t)});this.outletDataSubscriptions.set(t,c)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac})}return e})();function T0(e,i,t){if(t&&e.shouldReuseRoute(i.value,t.value.snapshot)){const o=t.value;o._futureSnapshot=i.value;const c=function dz(e,i,t){return i.children.map(o=>{for(const c of t.children)if(e.shouldReuseRoute(o.value,c.value.snapshot))return T0(e,o,c);return T0(e,o)})}(e,i,t);return new Qd(o,c)}{if(e.shouldAttach(i.value)){const u=e.retrieve(i.value);if(null!==u){const f=u.route;return f.value._futureSnapshot=i.value,f.children=i.children.map(g=>T0(e,g)),f}}const o=function uz(e){return new vm(new Rr(e.url),new Rr(e.params),new Rr(e.queryParams),new Rr(e.fragment),new Rr(e.data),e.outlet,e.component,e)}(i.value),c=i.children.map(u=>T0(e,u));return new Qd(o,c)}}const dU="ngNavigationCancelingError";function D4(e,i){const{redirectTo:t,navigationBehaviorOptions:o}=Em(i)?{redirectTo:i,navigationBehaviorOptions:void 0}:i,c=O4(!1,0,i);return c.url=t,c.navigationBehaviorOptions=o,c}function O4(e,i,t){const o=new Error("NavigationCancelingError: "+(e||""));return o[dU]=!0,o.cancellationCode=i,t&&(o.url=t),o}function N4(e){return e&&e[dU]}let P4=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Ct({type:e,selectors:[["ng-component"]],standalone:!0,features:[Df],decls:1,vars:0,template:function(o,c){1&o&&wt(0,"router-outlet")},dependencies:[lU],encapsulation:2})}return e})();function uU(e){const i=e.children&&e.children.map(uU),t=i?{...e,children:i}:{...e};return!t.component&&!t.loadComponent&&(i||t.loadChildren)&&t.outlet&&t.outlet!==Mt&&(t.component=P4),t}function Ic(e){return e.outlet||Mt}function w0(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let i=e.parent;i;i=i.parent){const t=i.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class vz{constructor(i,t,o,c,u){this.routeReuseStrategy=i,this.futureState=t,this.currState=o,this.forwardEvent=c,this.inputBindingEnabled=u}activate(i){const t=this.futureState._root,o=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,o,i),aU(this.futureState.root),this.activateChildRoutes(t,o,i)}deactivateChildRoutes(i,t,o){const c=Dv(t);i.children.forEach(u=>{const f=u.value.outlet;this.deactivateRoutes(u,c[f],o),delete c[f]}),Object.values(c).forEach(u=>{this.deactivateRouteAndItsChildren(u,o)})}deactivateRoutes(i,t,o){const c=i.value,u=t?t.value:null;if(c===u)if(c.component){const f=o.getContext(c.outlet);f&&this.deactivateChildRoutes(i,t,f.children)}else this.deactivateChildRoutes(i,t,o);else u&&this.deactivateRouteAndItsChildren(t,o)}deactivateRouteAndItsChildren(i,t){i.value.component&&this.routeReuseStrategy.shouldDetach(i.value.snapshot)?this.detachAndStoreRouteSubtree(i,t):this.deactivateRouteAndOutlet(i,t)}detachAndStoreRouteSubtree(i,t){const o=t.getContext(i.value.outlet),c=o&&i.value.component?o.children:t,u=Dv(i);for(const f of Object.keys(u))this.deactivateRouteAndItsChildren(u[f],c);if(o&&o.outlet){const f=o.outlet.detach(),g=o.children.onOutletDeactivated();this.routeReuseStrategy.store(i.value.snapshot,{componentRef:f,route:i,contexts:g})}}deactivateRouteAndOutlet(i,t){const o=t.getContext(i.value.outlet),c=o&&i.value.component?o.children:t,u=Dv(i);for(const f of Object.keys(u))this.deactivateRouteAndItsChildren(u[f],c);o&&(o.outlet&&(o.outlet.deactivate(),o.children.onOutletDeactivated()),o.attachRef=null,o.route=null)}activateChildRoutes(i,t,o){const c=Dv(t);i.children.forEach(u=>{this.activateRoutes(u,c[u.value.outlet],o),this.forwardEvent(new rz(u.value.snapshot))}),i.children.length&&this.forwardEvent(new nz(i.value.snapshot))}activateRoutes(i,t,o){const c=i.value,u=t?t.value:null;if(aU(c),c===u)if(c.component){const f=o.getOrCreateContext(c.outlet);this.activateChildRoutes(i,t,f.children)}else this.activateChildRoutes(i,t,o);else if(c.component){const f=o.getOrCreateContext(c.outlet);if(this.routeReuseStrategy.shouldAttach(c.snapshot)){const g=this.routeReuseStrategy.retrieve(c.snapshot);this.routeReuseStrategy.store(c.snapshot,null),f.children.onOutletReAttached(g.contexts),f.attachRef=g.componentRef,f.route=g.route.value,f.outlet&&f.outlet.attach(g.componentRef,g.route.value),aU(g.route.value),this.activateChildRoutes(i,null,f.children)}else{const g=w0(c.snapshot);f.attachRef=null,f.route=c,f.injector=g,f.outlet&&f.outlet.activateWith(c,f.injector),this.activateChildRoutes(i,null,f.children)}}else this.activateChildRoutes(i,null,o)}}class M4{constructor(i){this.path=i,this.route=this.path[this.path.length-1]}}class HP{constructor(i,t){this.component=i,this.route=t}}function yz(e,i,t){const o=e._root;return I0(o,i?i._root:null,t,[o.value])}function Ov(e,i){const t=Symbol(),o=i.get(e,t);return o===t?"function"!=typeof e||function f1(e){return null!==Hm(e)}(e)?i.get(e):e:o}function I0(e,i,t,o,c={canDeactivateChecks:[],canActivateChecks:[]}){const u=Dv(i);return e.children.forEach(f=>{(function Sz(e,i,t,o,c={canDeactivateChecks:[],canActivateChecks:[]}){const u=e.value,f=i?i.value:null,g=t?t.getContext(e.value.outlet):null;if(f&&u.routeConfig===f.routeConfig){const y=function Cz(e,i,t){if("function"==typeof t)return t(e,i);switch(t){case"pathParamsChange":return!gm(e.url,i.url);case"pathParamsOrQueryParamsChange":return!gm(e.url,i.url)||!Ll(e.queryParams,i.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!cU(e,i)||!Ll(e.queryParams,i.queryParams);default:return!cU(e,i)}}(f,u,u.routeConfig.runGuardsAndResolvers);y?c.canActivateChecks.push(new M4(o)):(u.data=f.data,u._resolvedData=f._resolvedData),I0(e,i,u.component?g?g.children:null:t,o,c),y&&g&&g.outlet&&g.outlet.isActivated&&c.canDeactivateChecks.push(new HP(g.outlet.component,f))}else f&&R0(i,g,c),c.canActivateChecks.push(new M4(o)),I0(e,null,u.component?g?g.children:null:t,o,c)})(f,u[f.value.outlet],t,o.concat([f.value]),c),delete u[f.value.outlet]}),Object.entries(u).forEach(([f,g])=>R0(g,t.getContext(f),c)),c}function R0(e,i,t){const o=Dv(e),c=e.value;Object.entries(o).forEach(([u,f])=>{R0(f,c.component?i?i.children.getContext(u):null:i,t)}),t.canDeactivateChecks.push(new HP(c.component&&i&&i.outlet&&i.outlet.isActivated?i.outlet.component:null,c))}function A0(e){return"function"==typeof e}function x4(e){return e instanceof OP||"EmptyError"===e?.name}const GP=Symbol("INITIAL_VALUE");function Nv(){return Lo(e=>rP(e.map(i=>i.pipe(wr(1),oB(GP)))).pipe(dn(i=>{for(const t of i)if(!0!==t){if(t===GP)return GP;if(!1===t||t instanceof Rv)return t}return!0}),ra(i=>i!==GP),wr(1)))}function k4(e){return function V0(...e){return Lv(e)}(Ur(i=>{if(Em(i))throw D4(0,i)}),dn(i=>!0===i))}class WP{constructor(i){this.segmentGroup=i||null}}class L4{constructor(i){this.urlTree=i}}function Pv(e){return p0(new WP(e))}function F4(e){return p0(new L4(e))}class Gz{constructor(i,t){this.urlSerializer=i,this.urlTree=t}noMatchError(i){return new ue(4002,!1)}lineralizeSegments(i,t){let o=[],c=t.root;for(;;){if(o=o.concat(c.segments),0===c.numberOfChildren)return He(o);if(c.numberOfChildren>1||!c.children[Mt])return p0(new ue(4e3,!1));c=c.children[Mt]}}applyRedirectCommands(i,t,o){return this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),i,o)}applyRedirectCreateUrlTree(i,t,o,c){const u=this.createSegmentGroup(i,t.root,o,c);return new Rv(u,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(i,t){const o={};return Object.entries(i).forEach(([c,u])=>{if("string"==typeof u&&u.startsWith(":")){const g=u.substring(1);o[c]=t[g]}else o[c]=u}),o}createSegmentGroup(i,t,o,c){const u=this.createSegments(i,t.segments,o,c);let f={};return Object.entries(t.children).forEach(([g,y])=>{f[g]=this.createSegmentGroup(i,y,o,c)}),new kn(u,f)}createSegments(i,t,o,c){return t.map(u=>u.path.startsWith(":")?this.findPosParam(i,u,c):this.findOrReturn(u,o))}findPosParam(i,t,o){const c=o[t.path.substring(1)];if(!c)throw new ue(4001,!1);return c}findOrReturn(i,t){let o=0;for(const c of t){if(c.path===i.path)return t.splice(o),c;o++}return i}}const hU={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Wz(e,i,t,o,c){const u=pU(e,i,t);return u.matched?(o=function pz(e,i){return e.providers&&!e._injector&&(e._injector=_h(e.providers,i,`Route: ${e.path}`)),e._injector??i}(i,o),function Bz(e,i,t,o){const c=i.canMatch;return c&&0!==c.length?He(c.map(f=>{const g=Ov(f,e);return Xh(function Dz(e){return e&&A0(e.canMatch)}(g)?g.canMatch(i,t):e.runInContext(()=>g(i,t)))})).pipe(Nv(),k4()):He(!0)}(o,i,t).pipe(dn(f=>!0===f?u:{...hU}))):He(u)}function pU(e,i,t){if(""===i.path)return"full"===i.pathMatch&&(e.hasChildren()||t.length>0)?{...hU}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const c=(i.matcher||S9)(t,e,i);if(!c)return{...hU};const u={};Object.entries(c.posParams??{}).forEach(([g,y])=>{u[g]=y.path});const f=c.consumed.length>0?{...u,...c.consumed[c.consumed.length-1].parameters}:u;return{matched:!0,consumedSegments:c.consumed,remainingSegments:t.slice(c.consumed.length),parameters:f,positionalParamSegments:c.posParams??{}}}function U4(e,i,t,o){return t.length>0&&function Kz(e,i,t){return t.some(o=>zP(e,i,o)&&Ic(o)!==Mt)}(e,t,o)?{segmentGroup:new kn(i,qz(o,new kn(t,e.children))),slicedSegments:[]}:0===t.length&&function Yz(e,i,t){return t.some(o=>zP(e,i,o))}(e,t,o)?{segmentGroup:new kn(e.segments,zz(e,0,t,o,e.children)),slicedSegments:t}:{segmentGroup:new kn(e.segments,e.children),slicedSegments:t}}function zz(e,i,t,o,c){const u={};for(const f of o)if(zP(e,t,f)&&!c[Ic(f)]){const g=new kn([],{});u[Ic(f)]=g}return{...c,...u}}function qz(e,i){const t={};t[Mt]=i;for(const o of e)if(""===o.path&&Ic(o)!==Mt){const c=new kn([],{});t[Ic(o)]=c}return t}function zP(e,i,t){return(!(e.hasChildren()||i.length>0)||"full"!==t.pathMatch)&&""===t.path}class Qz{constructor(i,t,o,c,u,f,g){this.injector=i,this.configLoader=t,this.rootComponentType=o,this.config=c,this.urlTree=u,this.paramsInheritanceStrategy=f,this.urlSerializer=g,this.allowRedirects=!0,this.applyRedirects=new Gz(this.urlSerializer,this.urlTree)}noMatchError(i){return new ue(4002,!1)}recognize(){const i=U4(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,i,Mt).pipe(_m(t=>{if(t instanceof L4)return this.allowRedirects=!1,this.urlTree=t.urlTree,this.match(t.urlTree);throw t instanceof WP?this.noMatchError(t):t}),dn(t=>{const o=new BP([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Mt,this.rootComponentType,null,{}),c=new Qd(o,t),u=new I4("",c),f=function H9(e,i,t=null,o=null){return f4(p4(e),i,t,o)}(o,[],this.urlTree.queryParams,this.urlTree.fragment);return f.queryParams=this.urlTree.queryParams,u.url=this.urlSerializer.serialize(f),this.inheritParamsAndData(u._root),{state:u,tree:f}}))}match(i){return this.processSegmentGroup(this.injector,this.config,i.root,Mt).pipe(_m(o=>{throw o instanceof WP?this.noMatchError(o):o}))}inheritParamsAndData(i){const t=i.value,o=w4(t,this.paramsInheritanceStrategy);t.params=Object.freeze(o.params),t.data=Object.freeze(o.data),i.children.forEach(c=>this.inheritParamsAndData(c))}processSegmentGroup(i,t,o,c){return 0===o.segments.length&&o.hasChildren()?this.processChildren(i,t,o):this.processSegment(i,t,o,o.segments,c,!0)}processChildren(i,t,o){const c=[];for(const u of Object.keys(o.children))"primary"===u?c.unshift(u):c.push(u);return ki(c).pipe(f0(u=>{const f=o.children[u],g=function gz(e,i){const t=e.filter(o=>Ic(o)===i);return t.push(...e.filter(o=>Ic(o)!==i)),t}(t,u);return this.processSegmentGroup(i,g,f,u)}),function v9(e,i){return ti(function E9(e,i,t,o,c){return(u,f)=>{let g=t,y=i,S=0;u.subscribe(Wn(f,R=>{const k=S++;y=g?e(y,R,k):(g=!0,R),o&&f.next(y)},c&&(()=>{g&&f.next(y),f.complete()})))}}(e,i,arguments.length>=2,!0))}((u,f)=>(u.push(...f),u)),NP(null),function y9(e,i){const t=arguments.length>=2;return o=>o.pipe(e?ra((c,u)=>e(c,u,o)):qa,$F(1),t?NP(i):Zj(()=>new OP))}(),fi(u=>{if(null===u)return Pv(o);const f=V4(u);return function Zz(e){e.sort((i,t)=>i.value.outlet===Mt?-1:t.value.outlet===Mt?1:i.value.outlet.localeCompare(t.value.outlet))}(f),He(f)}))}processSegment(i,t,o,c,u,f){return ki(t).pipe(f0(g=>this.processSegmentAgainstRoute(g._injector??i,t,g,o,c,u,f).pipe(_m(y=>{if(y instanceof WP)return He(null);throw y}))),mm(g=>!!g),_m(g=>{if(x4(g))return function Xz(e,i,t){return 0===i.length&&!e.children[t]}(o,c,u)?He([]):Pv(o);throw g}))}processSegmentAgainstRoute(i,t,o,c,u,f,g){return function $z(e,i,t,o){return!!(Ic(e)===o||o!==Mt&&zP(i,t,e))&&("**"===e.path||pU(i,e,t).matched)}(o,c,u,f)?void 0===o.redirectTo?this.matchSegmentAgainstRoute(i,c,o,u,f,g):g&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(i,c,t,o,u,f):Pv(c):Pv(c)}expandSegmentAgainstRouteUsingRedirect(i,t,o,c,u,f){return"**"===c.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(i,o,c,f):this.expandRegularSegmentAgainstRouteUsingRedirect(i,t,o,c,u,f)}expandWildCardWithParamsAgainstRouteUsingRedirect(i,t,o,c){const u=this.applyRedirects.applyRedirectCommands([],o.redirectTo,{});return o.redirectTo.startsWith("/")?F4(u):this.applyRedirects.lineralizeSegments(o,u).pipe(fi(f=>{const g=new kn(f,{});return this.processSegment(i,t,g,f,c,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(i,t,o,c,u,f){const{matched:g,consumedSegments:y,remainingSegments:S,positionalParamSegments:R}=pU(t,c,u);if(!g)return Pv(t);const k=this.applyRedirects.applyRedirectCommands(y,c.redirectTo,R);return c.redirectTo.startsWith("/")?F4(k):this.applyRedirects.lineralizeSegments(c,k).pipe(fi(B=>this.processSegment(i,o,t,B.concat(S),f,!1)))}matchSegmentAgainstRoute(i,t,o,c,u,f){let g;if("**"===o.path){const y=c.length>0?n4(c).parameters:{};g=He({snapshot:new BP(c,y,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,B4(o),Ic(o),o.component??o._loadedComponent??null,o,j4(o)),consumedSegments:[],remainingSegments:[]}),t.children={}}else g=Wz(t,o,c,i).pipe(dn(({matched:y,consumedSegments:S,remainingSegments:R,parameters:k})=>y?{snapshot:new BP(S,k,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,B4(o),Ic(o),o.component??o._loadedComponent??null,o,j4(o)),consumedSegments:S,remainingSegments:R}:null));return g.pipe(Lo(y=>null===y?Pv(t):this.getChildConfig(i=o._injector??i,o,c).pipe(Lo(({routes:S})=>{const R=o._loadedInjector??i,{snapshot:k,consumedSegments:B,remainingSegments:G}=y,{segmentGroup:K,slicedSegments:ee}=U4(t,B,G,S);if(0===ee.length&&K.hasChildren())return this.processChildren(R,S,K).pipe(dn(ve=>null===ve?null:[new Qd(k,ve)]));if(0===S.length&&0===ee.length)return He([new Qd(k,[])]);const de=Ic(o)===u;return this.processSegment(R,S,K,ee,de?Mt:u,!0).pipe(dn(ve=>[new Qd(k,ve)]))}))))}getChildConfig(i,t,o){return t.children?He({routes:t.children,injector:i}):t.loadChildren?void 0!==t._loadedRoutes?He({routes:t._loadedRoutes,injector:t._loadedInjector}):function Vz(e,i,t,o){const c=i.canLoad;return void 0===c||0===c.length?He(!0):He(c.map(f=>{const g=Ov(f,e);return Xh(function wz(e){return e&&A0(e.canLoad)}(g)?g.canLoad(i,t):e.runInContext(()=>g(i,t)))})).pipe(Nv(),k4())}(i,t,o).pipe(fi(c=>c?this.configLoader.loadChildren(i,t).pipe(Ur(u=>{t._loadedRoutes=u.routes,t._loadedInjector=u.injector})):function Hz(e){return p0(O4(!1,3))}())):He({routes:[],injector:i})}}function e7(e){const i=e.value.routeConfig;return i&&""===i.path}function V4(e){const i=[],t=new Set;for(const o of e){if(!e7(o)){i.push(o);continue}const c=i.find(u=>o.value.routeConfig===u.value.routeConfig);void 0!==c?(c.children.push(...o.children),t.add(c)):i.push(o)}for(const o of t){const c=V4(o.children);i.push(new Qd(o.value,c))}return i.filter(o=>!t.has(o))}function B4(e){return e.data||{}}function j4(e){return e.resolve||{}}function H4(e){return"string"==typeof e.title||null===e.title}function fU(e){return Lo(i=>{const t=e(i);return t?ki(t).pipe(dn(()=>i)):He(i)})}const Mv=new De("ROUTES");let mU=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Oe(Fa)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return He(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const o=Xh(t.loadComponent()).pipe(dn(G4),Ur(u=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=u}),XF(()=>{this.componentLoaders.delete(t)})),c=new Qj(o,()=>new Gt).pipe(YF());return this.componentLoaders.set(t,c),c}loadChildren(t,o){if(this.childrenLoaders.get(o))return this.childrenLoaders.get(o);if(o._loadedRoutes)return He({routes:o._loadedRoutes,injector:o._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(o);const u=function a7(e,i,t,o){return Xh(e.loadChildren()).pipe(dn(G4),fi(c=>c instanceof Mr||Array.isArray(c)?He(c):ki(i.compileModuleAsync(c))),dn(c=>{o&&o(e);let u,f,g=!1;return Array.isArray(c)?(f=c,!0):(u=c.create(t).injector,f=u.get(Mv,[],{optional:!0,self:!0}).flat()),{routes:f.map(uU),injector:u}}))}(o,this.compiler,t,this.onLoadEndListener).pipe(XF(()=>{this.childrenLoaders.delete(o)})),f=new Qj(u,()=>new Gt).pipe(YF());return this.childrenLoaders.set(o,f),f}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function G4(e){return function c7(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let qP=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Gt,this.transitionAbortSubject=new Gt,this.configLoader=Oe(mU),this.environmentInjector=Oe(qo),this.urlSerializer=Oe(g0),this.rootContexts=Oe(C0),this.inputBindingEnabled=null!==Oe(jP,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>He(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=c=>this.events.next(new ez(c)),this.configLoader.onLoadStartListener=c=>this.events.next(new Z9(c))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const o=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:o})}setupNavigations(t,o,c){return this.transitions=new Rr({id:0,currentUrlTree:o,currentRawUrl:o,currentBrowserUrl:o,extractedUrl:t.urlHandlingStrategy.extract(o),urlAfterRedirects:t.urlHandlingStrategy.extract(o),rawUrl:o,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:b0,restoredState:null,currentSnapshot:c.snapshot,targetSnapshot:null,currentRouterState:c,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(ra(u=>0!==u.id),dn(u=>({...u,extractedUrl:t.urlHandlingStrategy.extract(u.rawUrl)})),Lo(u=>{this.currentTransition=u;let f=!1,g=!1;return He(u).pipe(Ur(y=>{this.currentNavigation={id:y.id,initialUrl:y.rawUrl,extractedUrl:y.extractedUrl,trigger:y.source,extras:y.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Lo(y=>{const S=y.currentBrowserUrl.toString(),R=!t.navigated||y.extractedUrl.toString()!==S||S!==y.currentUrlTree.toString();if(!R&&"reload"!==(y.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const B="";return this.events.next(new Av(y.id,this.urlSerializer.serialize(y.rawUrl),B,0)),y.resolve(null),ks}if(t.urlHandlingStrategy.shouldProcessUrl(y.rawUrl))return He(y).pipe(Lo(B=>{const G=this.transitions?.getValue();return this.events.next(new UP(B.id,this.urlSerializer.serialize(B.extractedUrl),B.source,B.restoredState)),G!==this.transitions?.getValue()?ks:Promise.resolve(B)}),function t7(e,i,t,o,c,u){return fi(f=>function Jz(e,i,t,o,c,u,f="emptyOnly"){return new Qz(e,i,t,o,c,f,u).recognize()}(e,i,t,o,f.extractedUrl,c,u).pipe(dn(({state:g,tree:y})=>({...f,targetSnapshot:g,urlAfterRedirects:y}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,t.paramsInheritanceStrategy),Ur(B=>{u.targetSnapshot=B.targetSnapshot,u.urlAfterRedirects=B.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:B.urlAfterRedirects};const G=new y4(B.id,this.urlSerializer.serialize(B.extractedUrl),this.urlSerializer.serialize(B.urlAfterRedirects),B.targetSnapshot);this.events.next(G)}));if(R&&t.urlHandlingStrategy.shouldProcessUrl(y.currentRawUrl)){const{id:B,extractedUrl:G,source:K,restoredState:ee,extras:de}=y,ve=new UP(B,this.urlSerializer.serialize(G),K,ee);this.events.next(ve);const ae=T4(0,this.rootComponentType).snapshot;return this.currentTransition=u={...y,targetSnapshot:ae,urlAfterRedirects:G,extras:{...de,skipLocationChange:!1,replaceUrl:!1}},He(u)}{const B="";return this.events.next(new Av(y.id,this.urlSerializer.serialize(y.extractedUrl),B,1)),y.resolve(null),ks}}),Ur(y=>{const S=new $9(y.id,this.urlSerializer.serialize(y.extractedUrl),this.urlSerializer.serialize(y.urlAfterRedirects),y.targetSnapshot);this.events.next(S)}),dn(y=>(this.currentTransition=u={...y,guards:yz(y.targetSnapshot,y.currentSnapshot,this.rootContexts)},u)),function Nz(e,i){return fi(t=>{const{targetSnapshot:o,currentSnapshot:c,guards:{canActivateChecks:u,canDeactivateChecks:f}}=t;return 0===f.length&&0===u.length?He({...t,guardsResult:!0}):function Pz(e,i,t,o){return ki(e).pipe(fi(c=>function Uz(e,i,t,o,c){const u=i&&i.routeConfig?i.routeConfig.canDeactivate:null;return u&&0!==u.length?He(u.map(g=>{const y=w0(i)??c,S=Ov(g,y);return Xh(function Az(e){return e&&A0(e.canDeactivate)}(S)?S.canDeactivate(e,i,t,o):y.runInContext(()=>S(e,i,t,o))).pipe(mm())})).pipe(Nv()):He(!0)}(c.component,c.route,t,i,o)),mm(c=>!0!==c,!0))}(f,o,c,e).pipe(fi(g=>g&&function Tz(e){return"boolean"==typeof e}(g)?function Mz(e,i,t,o){return ki(i).pipe(f0(c=>ZT(function kz(e,i){return null!==e&&i&&i(new tz(e)),He(!0)}(c.route.parent,o),function xz(e,i){return null!==e&&i&&i(new iz(e)),He(!0)}(c.route,o),function Fz(e,i,t){const o=i[i.length-1],u=i.slice(0,i.length-1).reverse().map(f=>function bz(e){const i=e.routeConfig?e.routeConfig.canActivateChild:null;return i&&0!==i.length?{node:e,guards:i}:null}(f)).filter(f=>null!==f).map(f=>Jj(()=>He(f.guards.map(y=>{const S=w0(f.node)??t,R=Ov(y,S);return Xh(function Rz(e){return e&&A0(e.canActivateChild)}(R)?R.canActivateChild(o,e):S.runInContext(()=>R(o,e))).pipe(mm())})).pipe(Nv())));return He(u).pipe(Nv())}(e,c.path,t),function Lz(e,i,t){const o=i.routeConfig?i.routeConfig.canActivate:null;if(!o||0===o.length)return He(!0);const c=o.map(u=>Jj(()=>{const f=w0(i)??t,g=Ov(u,f);return Xh(function Iz(e){return e&&A0(e.canActivate)}(g)?g.canActivate(i,e):f.runInContext(()=>g(i,e))).pipe(mm())}));return He(c).pipe(Nv())}(e,c.route,t))),mm(c=>!0!==c,!0))}(o,u,e,i):He(g)),dn(g=>({...t,guardsResult:g})))})}(this.environmentInjector,y=>this.events.next(y)),Ur(y=>{if(u.guardsResult=y.guardsResult,Em(y.guardsResult))throw D4(0,y.guardsResult);const S=new X9(y.id,this.urlSerializer.serialize(y.extractedUrl),this.urlSerializer.serialize(y.urlAfterRedirects),y.targetSnapshot,!!y.guardsResult);this.events.next(S)}),ra(y=>!!y.guardsResult||(this.cancelNavigationTransition(y,"",3),!1)),fU(y=>{if(y.guards.canActivateChecks.length)return He(y).pipe(Ur(S=>{const R=new J9(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(R)}),Lo(S=>{let R=!1;return He(S).pipe(function n7(e,i){return fi(t=>{const{targetSnapshot:o,guards:{canActivateChecks:c}}=t;if(!c.length)return He(t);let u=0;return ki(c).pipe(f0(f=>function i7(e,i,t,o){const c=e.routeConfig,u=e._resolve;return void 0!==c?.title&&!H4(c)&&(u[m0]=c.title),function r7(e,i,t,o){const c=function o7(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===c.length)return He({});const u={};return ki(c).pipe(fi(f=>function s7(e,i,t,o){const c=w0(i)??o,u=Ov(e,c);return Xh(u.resolve?u.resolve(i,t):c.runInContext(()=>u(i,t)))}(e[f],i,t,o).pipe(mm(),Ur(g=>{u[f]=g}))),$F(1),e4(u),_m(f=>x4(f)?ks:p0(f)))}(u,e,i,o).pipe(dn(f=>(e._resolvedData=f,e.data=w4(e,t).resolve,c&&H4(c)&&(e.data[m0]=c.title),null)))}(f.route,o,e,i)),Ur(()=>u++),$F(1),fi(f=>u===c.length?He(t):ks))})}(t.paramsInheritanceStrategy,this.environmentInjector),Ur({next:()=>R=!0,complete:()=>{R||this.cancelNavigationTransition(S,"",2)}}))}),Ur(S=>{const R=new Q9(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(R)}))}),fU(y=>{const S=R=>{const k=[];R.routeConfig?.loadComponent&&!R.routeConfig._loadedComponent&&k.push(this.configLoader.loadComponent(R.routeConfig).pipe(Ur(B=>{R.component=B}),dn(()=>{})));for(const B of R.children)k.push(...S(B));return k};return rP(S(y.targetSnapshot.root)).pipe(NP(),wr(1))}),fU(()=>this.afterPreactivation()),dn(y=>{const S=function lz(e,i,t){const o=T0(e,i._root,t?t._root:void 0);return new C4(o,i)}(t.routeReuseStrategy,y.targetSnapshot,y.currentRouterState);return this.currentTransition=u={...y,targetRouterState:S},u}),Ur(()=>{this.events.next(new nU)}),((e,i,t,o)=>dn(c=>(new vz(i,c.targetRouterState,c.currentRouterState,t,o).activate(e),c)))(this.rootContexts,t.routeReuseStrategy,y=>this.events.next(y),this.inputBindingEnabled),wr(1),Ur({next:y=>{f=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Jh(y.id,this.urlSerializer.serialize(y.extractedUrl),this.urlSerializer.serialize(y.urlAfterRedirects))),t.titleStrategy?.updateTitle(y.targetRouterState.snapshot),y.resolve(!0)},complete:()=>{f=!0}}),No(this.transitionAbortSubject.pipe(Ur(y=>{throw y}))),XF(()=>{f||g||this.cancelNavigationTransition(u,"",1),this.currentNavigation?.id===u.id&&(this.currentNavigation=null)}),_m(y=>{if(g=!0,N4(y))this.events.next(new S0(u.id,this.urlSerializer.serialize(u.extractedUrl),y.message,y.cancellationCode)),function hz(e){return N4(e)&&Em(e.url)}(y)?this.events.next(new iU(y.url)):u.resolve(!1);else{this.events.next(new VP(u.id,this.urlSerializer.serialize(u.extractedUrl),y,u.targetSnapshot??void 0));try{u.resolve(t.errorHandler(y))}catch(S){u.reject(S)}}return ks}))}))}cancelNavigationTransition(t,o,c){const u=new S0(t.id,this.urlSerializer.serialize(t.extractedUrl),o,c);this.events.next(u),t.resolve(!1)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function W4(e){return e!==b0}let z4=(()=>{class e{buildTitle(t){let o,c=t.root;for(;void 0!==c;)o=this.getResolvedTitleForRoute(c)??o,c=c.children.find(u=>u.outlet===Mt);return o}getResolvedTitleForRoute(t){return t.data[m0]}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:function(){return Oe(l7)},providedIn:"root"})}return e})(),l7=(()=>{class e extends z4{constructor(t){super(),this.title=t}updateTitle(t){const o=this.buildTitle(t);void 0!==o&&this.title.setTitle(o)}static#e=this.\u0275fac=function(o){return new(o||e)(pe(Gn))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),d7=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:function(){return Oe(h7)},providedIn:"root"})}return e})();class u7{shouldDetach(i){return!1}store(i,t){}shouldAttach(i){return!1}retrieve(i){return null}shouldReuseRoute(i,t){return i.routeConfig===t.routeConfig}}let h7=(()=>{class e extends u7{static#e=this.\u0275fac=function(){let t;return function(c){return(t||(t=Ti(e)))(c||e)}}();static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const KP=new De("",{providedIn:"root",factory:()=>({})});let p7=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:function(){return Oe(f7)},providedIn:"root"})}return e})(),f7=(()=>{class e{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,o){return t}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var D0=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(D0||{});function q4(e,i){e.events.pipe(ra(t=>t instanceof Jh||t instanceof S0||t instanceof VP||t instanceof Av),dn(t=>t instanceof Jh||t instanceof Av?D0.COMPLETE:t instanceof S0&&(0===t.code||1===t.code)?D0.REDIRECTING:D0.FAILED),ra(t=>t!==D0.REDIRECTING),wr(1)).subscribe(()=>{i()})}function m7(e){throw e}function _7(e,i,t){return i.parse("/")}const g7={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},E7={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Ps=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=Oe(Id),this.isNgZoneEnabled=!1,this._events=new Gt,this.options=Oe(KP,{optional:!0})||{},this.pendingTasks=Oe(cO),this.errorHandler=this.options.errorHandler||m7,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||_7,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=Oe(p7),this.routeReuseStrategy=Oe(d7),this.titleStrategy=Oe(z4),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=Oe(Mv,{optional:!0})?.flat()??[],this.navigationTransitions=Oe(qP),this.urlSerializer=Oe(g0),this.location=Oe(KC),this.componentInputBindingEnabled=!!Oe(jP,{optional:!0}),this.eventsSubscription=new Dn,this.isNgZoneEnabled=Oe(lt)instanceof lt&&lt.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Rv,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=T4(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(t=>{this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const t=this.navigationTransitions.events.subscribe(o=>{try{const{currentTransition:c}=this.navigationTransitions;if(null===c)return void(K4(o)&&this._events.next(o));if(o instanceof UP)W4(c.source)&&(this.browserUrlTree=c.extractedUrl);else if(o instanceof Av)this.rawUrlTree=c.rawUrl;else if(o instanceof y4){if("eager"===this.urlUpdateStrategy){if(!c.extras.skipLocationChange){const u=this.urlHandlingStrategy.merge(c.urlAfterRedirects,c.rawUrl);this.setBrowserUrl(u,c)}this.browserUrlTree=c.urlAfterRedirects}}else if(o instanceof nU)this.currentUrlTree=c.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(c.urlAfterRedirects,c.rawUrl),this.routerState=c.targetRouterState,"deferred"===this.urlUpdateStrategy&&(c.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,c),this.browserUrlTree=c.urlAfterRedirects);else if(o instanceof S0)0!==o.code&&1!==o.code&&(this.navigated=!0),(3===o.code||2===o.code)&&this.restoreHistory(c);else if(o instanceof iU){const u=this.urlHandlingStrategy.merge(o.url,c.currentRawUrl),f={skipLocationChange:c.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||W4(c.source)};this.scheduleNavigation(u,b0,null,f,{resolve:c.resolve,reject:c.reject,promise:c.promise})}o instanceof VP&&this.restoreHistory(c,!0),o instanceof Jh&&(this.navigated=!0),K4(o)&&this._events.next(o)}catch(c){this.navigationTransitions.transitionAbortSubject.next(c)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const t=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),b0,t)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const o="popstate"===t.type?"popstate":"hashchange";"popstate"===o&&setTimeout(()=>{this.navigateToSyncWithBrowser(t.url,o,t.state)},0)}))}navigateToSyncWithBrowser(t,o,c){const u={replaceUrl:!0},f=c?.navigationId?c:null;if(c){const y={...c};delete y.navigationId,delete y.\u0275routerPageId,0!==Object.keys(y).length&&(u.state=y)}const g=this.parseUrl(t);this.scheduleNavigation(g,o,f,u)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(uU),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,o={}){const{relativeTo:c,queryParams:u,fragment:f,queryParamsHandling:g,preserveFragment:y}=o,S=y?this.currentUrlTree.fragment:f;let k,R=null;switch(g){case"merge":R={...this.currentUrlTree.queryParams,...u};break;case"preserve":R=this.currentUrlTree.queryParams;break;default:R=u||null}null!==R&&(R=this.removeEmptyProps(R));try{k=p4(c?c.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||!t[0].startsWith("/"))&&(t=[]),k=this.currentUrlTree.root}return f4(k,t,R,S??null)}navigateByUrl(t,o={skipLocationChange:!1}){const c=Em(t)?t:this.parseUrl(t),u=this.urlHandlingStrategy.merge(c,this.rawUrlTree);return this.scheduleNavigation(u,b0,null,o)}navigate(t,o={skipLocationChange:!1}){return function v7(e){for(let i=0;i<e.length;i++)if(null==e[i])throw new ue(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,o),o)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let o;try{o=this.urlSerializer.parse(t)}catch(c){o=this.malformedUriErrorHandler(c,this.urlSerializer,t)}return o}isActive(t,o){let c;if(c=!0===o?{...g7}:!1===o?{...E7}:o,Em(t))return r4(this.currentUrlTree,t,c);const u=this.parseUrl(t);return r4(this.currentUrlTree,u,c)}removeEmptyProps(t){return Object.keys(t).reduce((o,c)=>{const u=t[c];return null!=u&&(o[c]=u),o},{})}scheduleNavigation(t,o,c,u,f){if(this.disposed)return Promise.resolve(!1);let g,y,S;f?(g=f.resolve,y=f.reject,S=f.promise):S=new Promise((k,B)=>{g=k,y=B});const R=this.pendingTasks.add();return q4(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(R))}),this.navigationTransitions.handleNavigationRequest({source:o,restoredState:c,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:t,extras:u,resolve:g,reject:y,promise:S,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),S.catch(k=>Promise.reject(k))}setBrowserUrl(t,o){const c=this.urlSerializer.serialize(t);if(this.location.isCurrentPathEqualTo(c)||o.extras.replaceUrl){const f={...o.extras.state,...this.generateNgRouterState(o.id,this.browserPageId)};this.location.replaceState(c,"",f)}else{const u={...o.extras.state,...this.generateNgRouterState(o.id,this.browserPageId+1)};this.location.go(c,"",u)}}restoreHistory(t,o=!1){if("computed"===this.canceledNavigationResolution){const u=this.currentPageId-this.browserPageId;0!==u?this.location.historyGo(u):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===u&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(o&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,o){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:o}:{navigationId:t}}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function K4(e){return!(e instanceof nU||e instanceof iU)}class Y4{}let S7=(()=>{class e{constructor(t,o,c,u,f){this.router=t,this.injector=c,this.preloadingStrategy=u,this.loader=f}setUpPreloading(){this.subscription=this.router.events.pipe(ra(t=>t instanceof Jh),f0(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,o){const c=[];for(const u of o){u.providers&&!u._injector&&(u._injector=_h(u.providers,t,`Route: ${u.path}`));const f=u._injector??t,g=u._loadedInjector??f;(u.loadChildren&&!u._loadedRoutes&&void 0===u.canLoad||u.loadComponent&&!u._loadedComponent)&&c.push(this.preloadConfig(f,u)),(u.children||u._loadedRoutes)&&c.push(this.processRoutes(g,u.children??u._loadedRoutes))}return ki(c).pipe(us())}preloadConfig(t,o){return this.preloadingStrategy.preload(o,()=>{let c;c=o.loadChildren&&void 0===o.canLoad?this.loader.loadChildren(t,o):He(null);const u=c.pipe(fi(f=>null===f?He(void 0):(o._loadedRoutes=f.routes,o._loadedInjector=f.injector,this.processRoutes(f.injector??t,f.routes))));return o.loadComponent&&!o._loadedComponent?ki([u,this.loader.loadComponent(o)]).pipe(us()):u})}static#e=this.\u0275fac=function(o){return new(o||e)(pe(Ps),pe(Fa),pe(qo),pe(Y4),pe(mU))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const gU=new De("");let $4=(()=>{class e{constructor(t,o,c,u,f={}){this.urlSerializer=t,this.transitions=o,this.viewportScroller=c,this.zone=u,this.options=f,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},f.scrollPositionRestoration=f.scrollPositionRestoration||"disabled",f.anchorScrolling=f.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof UP?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Jh?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof Av&&0===t.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof b4&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,o){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new b4(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,o))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(o){sd()};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac})}return e})();function Zd(e,i){return{\u0275kind:e,\u0275providers:i}}function J4(){const e=Oe(tr);return i=>{const t=e.get(ea);if(i!==t.components[0])return;const o=e.get(Ps),c=e.get(Q4);1===e.get(EU)&&o.initialNavigation(),e.get(Z4,null,Ft.Optional)?.setUpPreloading(),e.get(gU,null,Ft.Optional)?.init(),o.resetRootComponentType(t.componentTypes[0]),c.closed||(c.next(),c.complete(),c.unsubscribe())}}const Q4=new De("",{factory:()=>new Gt}),EU=new De("",{providedIn:"root",factory:()=>1}),Z4=new De("");function I7(e){return Zd(0,[{provide:Z4,useExisting:S7},{provide:Y4,useExisting:e}])}const e5=new De("ROUTER_FORROOT_GUARD"),A7=[KC,{provide:g0,useClass:JF},Ps,C0,{provide:vm,useFactory:function X4(e){return e.routerState.root},deps:[Ps]},mU,[]];function D7(){return new ns("Router",Ps)}let O7=(()=>{class e{constructor(t){}static forRoot(t,o){return{ngModule:e,providers:[A7,[],{provide:Mv,multi:!0,useValue:t},{provide:e5,useFactory:x7,deps:[[Ps,new Pp,new k_]]},{provide:KP,useValue:o||{}},o?.useHash?{provide:Ah,useClass:GV}:{provide:Ah,useClass:qL},{provide:gU,useFactory:()=>{const e=Oe(yN),i=Oe(lt),t=Oe(KP),o=Oe(qP),c=Oe(g0);return t.scrollOffset&&e.setOffset(t.scrollOffset),new $4(c,o,e,i,t)}},o?.preloadingStrategy?I7(o.preloadingStrategy).\u0275providers:[],{provide:ns,multi:!0,useFactory:D7},o?.initialNavigation?k7(o):[],o?.bindToComponentInputs?Zd(8,[A4,{provide:jP,useExisting:A4}]).\u0275providers:[],[{provide:t5,useFactory:J4},{provide:Va,multi:!0,useExisting:t5}]]}}static forChild(t){return{ngModule:e,providers:[{provide:Mv,multi:!0,useValue:t}]}}static#e=this.\u0275fac=function(o){return new(o||e)(pe(e5,8))};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({})}return e})();function x7(e){return"guarded"}function k7(e){return["disabled"===e.initialNavigation?Zd(3,[{provide:Cs,multi:!0,useFactory:()=>{const i=Oe(Ps);return()=>{i.setUpLocationChangeListener()}}},{provide:EU,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?Zd(2,[{provide:EU,useValue:0},{provide:Cs,multi:!0,deps:[tr],useFactory:i=>{const t=i.get(zO,Promise.resolve());return()=>t.then(()=>new Promise(o=>{const c=i.get(Ps),u=i.get(Q4);q4(c,()=>{o(!0)}),i.get(qP).afterPreactivation=()=>(o(!0),u.closed?He(void 0):u),c.initialNavigation()}))}}]).\u0275providers:[]]}const t5=new De(""),n5_configs={AppID:"fee9eb8f5bb44a6893ec96fd5e993a31"};let F7=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Ct({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(o,c){1&o&&wt(0,"router-outlet")},dependencies:[lU],changeDetection:0})}return e})();function vU(e=0,i=t0){return e<0&&(e=0),fP(e,e,i)}function r5(e,i){return i?t=>ZT(i.pipe(wr(1),function U7(){return ti((e,i)=>{e.subscribe(Wn(i,Zh))})}()),t.pipe(r5(e))):fi((t,o)=>xi(e(t,o)).pipe(wr(1),e4(t)))}var B7=Cm(291);function j7(e,i){if(1&e){const t=ah();Pe(0,"div",1)(1,"button",2),tn("click",function(){return _a(t),un(nn().onToggleFullScreen())}),Pe(2,"div",3),Wo(),Pe(3,"svg",4)(4,"g",26)(5,"g",6)(6,"g",7)(7,"g",11),wt(8,"path",27)(9,"path",28)(10,"path",29)(11,"path",30),Re()()()(),Pe(12,"g",31)(13,"g",6)(14,"g",32)(15,"g",7),wt(16,"path",33)(17,"path",34)(18,"path",35)(19,"path",36),Re()()()()()(),ic(),Pe(20,"p"),Or(21),Re()()()}if(2&e){const t=nn();Je(1),Vt("controls__button--active",t.fullScreenEnabled),Je(3),Vt("controls__icon--shown",!t.fullScreenEnabled),Je(8),Vt("controls__icon--shown",t.fullScreenEnabled),Je(9),uc(t.fullScreenEnabled?"Exit fullscreen":"Fullscreen")}}function H7(e,i){if(1&e){const t=ah();Pe(0,"div",1)(1,"button",37),tn("click",function(){return _a(t),un(nn().onToggleSmallScreen())}),Pe(2,"div",3),Wo(),Pe(3,"svg",4)(4,"g",38),wt(5,"path",39),Re(),Pe(6,"defs")(7,"filter",40),wt(8,"feFlood",41)(9,"feColorMatrix",42)(10,"feOffset",43)(11,"feGaussianBlur",44)(12,"feComposite",45)(13,"feColorMatrix",46)(14,"feBlend",47)(15,"feBlend",48),Re()()()(),ic(),Pe(16,"p"),Or(17,"Minimize"),Re()()()}if(2&e){const t=nn();Je(1),Vt("controls__button--active",t.smallScreenEnabled)}}function G7(e,i){if(1&e&&(Pe(0,"div",8),Or(1),Re()),2&e){const t=nn();Je(1),uc(t.text)}}const W7=function(e,i,t,o){return{"spinner--connected":e,"spinner--ended":i,"spinner--small":t,"spinner--error":o}};function z7(e,i){if(1&e&&(pf(0),Or(1),ff()),2&e){const t=nn(2);Je(1),Ef(" Calling to ",t.data.user.name," ")}}function q7(e,i){1&e&&Or(0),2&e&&Ef(" ",nn(2).data.user.name," is calling ")}function K7(e,i){if(1&e){const t=ah();pf(0),Pe(1,"button",11),tn("click",function(){return _a(t),un(nn(2).onAcceptCall())}),Re(),ff()}}function Y7(e,i){if(1&e){const t=ah();Pe(0,"div",1)(1,"div",2)(2,"div",3),wt(3,"img",4),Re(),Pe(4,"p",5),Fe(5,z7,2,1,"ng-container",6),Fe(6,q7,1,1,"ng-template",null,7,Pf),Re()(),Pe(8,"div",8),Fe(9,K7,2,0,"ng-container",9),Pe(10,"span")(11,"button",10),tn("click",function(){return _a(t),un(nn().onDeclineCall())}),Re()()()()}if(2&e){const t=dd(7),o=nn();Vt("video-call--full-screen",o.fullScreen),Qe("@fade",void 0),Je(3),Qe("src",o.data.user.photoURL,eg),Je(2),Qe("ngIf",o.data.outcome)("ngIfElse",t),Je(4),Qe("ngIf",!o.data.outcome)}}function $7(e,i){if(1&e&&wt(0,"ngx-spinner",15),2&e){const t=nn().ngIf,o=nn(2);Qe("error",t.error)("text",t.statusText)("connected",t.connected)("ended",t.ended)("small",o.smallScreenEnabled)}}function X7(e,i){1&e&&wt(0,"ngx-timer",16),2&e&&Qe("started",nn().ngIf.started)}function J7(e,i){if(1&e&&(wt(0,"div",17),dE(1,"async")),2&e){const t=i.$implicit;Vt("hidden",!1===pc(1,3,nn(3).remoteStreamVideoToggle$)),Qe("id",t)}}function Q7(e,i){if(1&e){const t=ah();Wo(),ic(),Pe(0,"ngx-controls",18),tn("toggleCamera",function(c){return _a(t),un(nn(3).onToggleCamera(c))})("toggleMicrophone",function(c){return _a(t),un(nn(3).onToggleMicrophone(c))})("toggleFullScreen",function(c){return _a(t),un(nn(3).onToggleFullScreen(c))})("toggleSmallScreen",function(c){return _a(t),un(nn(3).onToggleSmallScreen(c))})("endCall",function(){return _a(t),un(nn(3).onEndCall())}),Re()}if(2&e){const t=nn(3);Qe("cameraEnabled",t.cameraEnabled)("microphoneEnabled",t.microphoneEnabled)("fullScreenEnabled",t.fullScreenEnabled)("smallScreenEnabled",t.smallScreenEnabled)("displaySmallScreen",t.displaySmallScreen)}}function Z7(e,i){if(1&e&&(Pe(0,"div",2),Fe(1,$7,1,5,"ngx-spinner",3),Fe(2,X7,1,1,"ngx-timer",4),wt(3,"div",5),Fe(4,J7,2,5,"div",6),Pe(5,"div",7),Wo(),Pe(6,"svg",8)(7,"g",9),wt(8,"path",10)(9,"path",11),Re(),Pe(10,"defs")(11,"clipPath",12),wt(12,"rect",13),Re()()()(),Fe(13,Q7,1,5,"ngx-controls",14),Re()),2&e){const t=i.ngIf,o=nn(2);Je(1),Qe("ngIf",t.loading),Je(1),Qe("ngIf",t.started),Je(1),Vt("hidden",!o.cameraEnabled||o.smallScreenEnabled),Qe("id",o.localContainerId),Je(1),Qe("ngForOf",o.remoteCalls),Je(9),Qe("ngIf",t.connected&&!t.ended)}}function eq(e,i){if(1&e&&(Pe(0,"div"),Fe(1,Z7,14,7,"div",1),dE(2,"async"),Re()),2&e){const t=nn();Qe("@fade",void 0)("@.disabled",!t.animate),Je(1),Qe("ngIf",pc(2,3,t.streamState$))}}const YP_HIDDEN={opacity:0,"margin-top":"100%"},YP_SHOWN={opacity:1,"margin-top":0},o5=_F("fade",[s0(":enter",[xl(YP_HIDDEN),o0("250ms ease-in-out",xl(YP_SHOWN))]),s0(":leave",[xl(YP_SHOWN),o0("250ms ease-in-out",xl(YP_HIDDEN))])]);class s5{constructor(i){this.cdr=i,this.afterClosed=new Gt,this.shown=!0}closeDialog(i){this.onAfterClosed(i)}onAfterClosed(i){this.shown=!1,this.cdr.markForCheck(),this.afterClosed.next(i)}}let tq=(()=>{class e{constructor(){this.cameraEnabled=!0,this.microphoneEnabled=!0,this.fullScreenEnabled=!1,this.smallScreenEnabled=!1,this.displaySmallScreen=!1,this.toggleCamera=new en,this.toggleMicrophone=new en,this.toggleFullScreen=new en,this.toggleSmallScreen=new en,this.endCall=new en}onToggleCamera(){this.toggleCamera.emit(this.cameraEnabled)}onToggleMicrophone(){this.toggleMicrophone.emit(this.microphoneEnabled)}onToggleFullScreen(){this.toggleFullScreen.emit(this.fullScreenEnabled)}onToggleSmallScreen(){this.toggleSmallScreen.emit(this.smallScreenEnabled)}onEndCall(){this.endCall.emit()}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Ct({type:e,selectors:[["ngx-controls"]],inputs:{cameraEnabled:"cameraEnabled",microphoneEnabled:"microphoneEnabled",fullScreenEnabled:"fullScreenEnabled",smallScreenEnabled:"smallScreenEnabled",displaySmallScreen:"displaySmallScreen"},outputs:{toggleCamera:"toggleCamera",toggleMicrophone:"toggleMicrophone",toggleFullScreen:"toggleFullScreen",toggleSmallScreen:"toggleSmallScreen",endCall:"endCall"},decls:43,vars:16,consts:[[1,"controls"],[1,"controls__item"],[1,"controls__button",3,"click"],[1,"controls__icon-wrapper"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","video-camera",1,"controls__icon"],["id","Group"],["id","Group_2"],["id","Vector","d","M63.4134 16.2294C63.0454 15.9814 62.5787 15.928 62.1707 16.096L50.6668 20.6986V20C50.6668 16.3226 47.6748 13.3334 44.0001 13.3334H6.66663C2.992 13.3334 0 16.3226 0 20V44C0 47.6774 2.992 50.6666 6.66663 50.6666H44C47.6746 50.6666 50.6666 47.6772 50.6666 44V43.3014L62.1706 47.904C62.5812 48.072 63.048 48.0186 63.4132 47.7706C63.7786 47.5226 63.9999 47.1093 63.9999 46.6666V17.3334C64 16.8906 63.7786 16.4774 63.4134 16.2294Z","fill","white"],["id","no-camera",1,"controls__icon"],["id","Vector","d","M44.0002 13.3325H6.66735C2.99276 13.3325 0.000793457 16.3218 0.000793457 19.999V43.9988C0.000793457 47.6761 2.99276 50.6654 6.66735 50.6654H7.67797L44.9176 13.4257C44.6162 13.3832 44.315 13.3325 44.0002 13.3325Z","fill","white"],["id","Group_3"],["id","Group_4"],["id","Vector_2","d","M63.4134 16.2285C63.0454 15.9805 62.5788 15.9271 62.1708 16.0951L50.6669 20.6977V19.9991C50.6669 18.6417 50.2535 17.3831 49.5549 16.3297L63.608 2.2766C64.128 1.75661 64.128 0.911242 63.608 0.391247C63.088 -0.128748 62.2426 -0.128748 61.7226 0.391247L0.389996 61.724C-0.129999 62.244 -0.129999 63.0894 0.389996 63.6094C0.651369 63.868 0.992615 63.9988 1.33399 63.9988C1.67536 63.9988 2.01661 63.8681 2.27798 63.6094L15.2192 50.6655H44.0003C47.6749 50.6655 50.6669 47.6762 50.6669 43.9989V43.3003L62.1708 47.9029C62.5814 48.0709 63.0481 48.0175 63.4134 47.7695C63.7788 47.5215 64 47.1082 64 46.6655V17.3325C64 16.8898 63.7788 16.4765 63.4134 16.2285Z","fill","white"],["id","microphone",1,"controls__icon"],["id","Vector"],["fill-rule","evenodd","clip-rule","evenodd","d","M44.3474 12.1407L44.3468 17.2309V33.8672C44.3468 40.6024 38.9004 46.0823 32.206 46.0823C27.8366 46.0787 23.8059 43.7286 21.6503 39.9279L20.4131 36.8161C20.1824 35.875 20.0659 34.9098 20.0659 33.941V12.1407C20.0659 5.43551 25.5014 0 32.2066 0C38.9118 0 44.3474 5.43551 44.3474 12.1407Z","fill","white"],["fill-rule","evenodd","clip-rule","evenodd","d","M15.0971 33.7512C15.0947 36.1345 15.5932 38.4912 16.5596 40.6697L18.1223 43.4553C22.3699 49.6259 30.1387 52.3143 37.292 50.089C44.4453 47.8638 49.318 41.2426 49.3156 33.7518C49.3156 32.9026 50.0039 32.2143 50.8532 32.2143C51.7018 32.2143 52.3907 32.9026 52.3907 33.7518C52.4051 44.4499 44.0585 53.2951 33.3778 53.9017V60.9246H39.8098C40.6584 60.9246 41.3473 61.6135 41.3473 62.4622C41.3473 63.3114 40.6584 63.9997 39.8098 63.9997H24.6029C23.7537 63.9997 23.0654 63.3114 23.0654 62.4622C23.0654 61.6135 23.7537 60.9246 24.6029 60.9246H30.3033V53.847C25.6228 53.4212 21.2413 51.3623 17.926 48.0313C17.1926 47.298 16.5163 46.51 15.9031 45.6739L14.2418 42.9874C12.7757 40.1297 12.0148 36.9633 12.022 33.7512C12.022 32.902 12.7103 32.2137 13.5595 32.2137C14.4088 32.2137 15.0971 32.902 15.0971 33.7512Z","fill","white"],["id","no-microphone",1,"controls__icon"],["id","Vector","d","M52.9733 4.25592L44.3474 12.8813V12.1407C44.3474 5.43551 38.9118 0 32.2066 0C25.5014 0 20.0659 5.43551 20.0659 12.1407V33.941C20.0659 34.9098 20.1824 35.875 20.4131 36.8161L16.5596 40.6697C15.5932 38.4912 15.0947 36.1345 15.0971 33.7512C15.0971 32.902 14.4088 32.2137 13.5595 32.2137C12.7103 32.2137 12.022 32.902 12.022 33.7512C12.0148 36.9633 12.7757 40.1297 14.2418 42.9874L8.81411 48.4151C8.4117 48.8007 8.24954 49.3731 8.39008 49.9124C8.53002 50.4518 8.95105 50.8728 9.4898 51.0133C10.0291 51.1539 10.6021 50.9917 10.9877 50.5899L15.9031 45.6739C16.5163 46.51 17.1926 47.298 17.926 48.0313C21.2413 51.3623 25.6228 53.4212 30.3033 53.847V60.9246H24.6029C23.7537 60.9246 23.0654 61.6135 23.0654 62.4622C23.0654 63.3114 23.7537 63.9997 24.6029 63.9997H39.8098C40.6584 63.9997 41.3473 63.3114 41.3473 62.4622C41.3473 61.6135 40.6584 60.9246 39.8098 60.9246H33.3778V53.9017C44.0585 53.2951 52.4051 44.4499 52.3907 33.7518C52.3907 32.9026 51.7018 32.2143 50.8532 32.2143C50.0039 32.2143 49.3156 32.9026 49.3156 33.7518C49.318 41.2426 44.4453 47.8638 37.292 50.089C30.1387 52.3143 22.3699 49.6259 18.1224 43.4553L21.6503 39.9279C23.8059 43.7286 27.8366 46.0787 32.206 46.0823C38.9004 46.0823 44.3468 40.6024 44.3468 33.8672V17.2309L55.1475 6.43072C55.7481 5.83071 55.7481 4.85713 55.1475 4.25652C54.5469 3.65591 53.5733 3.65591 52.9733 4.25652V4.25592Z","fill","white"],["class","controls__item",4,"ngIf"],[1,"controls__button","controls__button--danger",3,"click"],["id","phone"],["id","Vector","d","M51.7097 13.2478C51.2458 12.7839 50.4959 12.7839 50.032 13.2478L1.38351 61.8963C0.919568 62.3602 0.919568 63.1101 1.38351 63.574C1.61488 63.8054 1.91864 63.9217 2.2224 63.9217C2.52615 63.9217 2.82991 63.8054 3.06129 63.574L51.7097 14.9256C52.1737 14.4628 52.1737 13.7117 51.7097 13.2478Z","fill","white"],["id","Vector_2","d","M16.9605 42.9635L26.1159 33.8081L21.3365 29.0287C18.91 26.6022 18.6869 24.3679 20.5878 21.5629C20.8535 21.1951 22.5444 19.6941 23.992 18.4839C24.9151 17.9333 25.5487 17.1181 25.8264 16.1155C26.1954 14.783 25.9225 13.2156 25.0516 11.6885C24.8463 11.3373 19.9625 3.06229 15.4583 0.680892C14.6171 0.235937 13.6714 0.0010004 12.721 0.0010004C11.1571 0.0010004 9.68576 0.610886 8.58109 1.71556L5.57082 4.72702C-3.21082 13.5098 -1.58525 24.419 10.2719 36.2749L16.9605 42.9635Z","fill","white"],["id","Vector_3","d","M63.313 48.5357C60.9304 44.0328 52.6566 39.1478 52.2923 38.9342C51.2304 38.329 50.1209 38.0099 49.0839 38.0099C47.5402 38.0099 46.2753 38.717 45.51 40.0033C44.2986 41.452 42.7964 43.1429 42.4345 43.4051C39.6129 45.3154 37.4071 45.1007 34.9652 42.6588L31.148 38.8416L21.9926 47.997L27.7189 53.7233C34.5356 60.5412 41.0367 63.9976 47.0371 63.9976C47.0383 63.9976 47.0383 63.9976 47.0383 63.9976C51.4534 63.9976 55.5672 62.1217 59.2669 58.4232L62.2771 55.413C64.1068 53.5845 64.5233 50.821 63.313 48.5357Z","fill","white"],["id","fullscreen",1,"controls__icon"],["id","Vector","d","M57.8018 53.4382L44.3964 40.0328L40.0328 44.3964L53.4382 57.8018H43.0205V64H64V43.0205H57.8018V53.4382Z","fill","white"],["id","Vector_2","d","M44.3964 23.9803L57.8018 10.5618V20.9795H64V0H43.0205V6.1982H53.4382L40.0328 19.6036L44.3964 23.9803Z","fill","white"],["id","Vector_3","d","M19.6036 40.0328L6.1982 53.4382V43.0205H0V64H20.9795V57.8018H10.5618L23.9803 44.3964L19.6036 40.0328Z","fill","white"],["id","Vector_4","d","M20.9795 6.1982V0H0V20.9795H6.1982V10.5618L19.6036 23.9803L23.9803 19.6036L10.5618 6.1982H20.9795Z","fill","white"],["id","exit-full-screen",1,"controls__icon"],["id","fullscreen_x5F_exit"],["id","Vector","d","M49.172 54.828L58.344 64L64 58.344L54.828 49.172L64 40H40V64L49.172 54.828Z","fill","white"],["id","Vector_2","d","M0 24H24V0L14.828 9.172L5.75 0.086L0.094 5.742L9.172 14.828L0 24Z","fill","white"],["id","Vector_3","d","M0 58.344L5.656 64L14.828 54.828L24 64V40H0L9.172 49.172L0 58.344Z","fill","white"],["id","Vector_4","d","M40 24H64L54.828 14.828L63.922 5.742L58.266 0.086L49.172 9.172L40 0V24Z","fill","white"],[1,"controls__button","controls__button--rotate",3,"click"],["filter","url(#filter0_d_0_4)"],["d","M-4.81762e-07 34.7678V57.0215C-4.81762e-07 60.8696 3.13284 64 6.98275 64H57.016C60.8672 64 64 60.8696 64 57.0215V7.05508C64 3.20697 60.8672 0.0757321 57.016 0.0757321H34.6959C35.8972 1.3077 36.6961 2.93443 36.871 4.74067H57.0168C58.2942 4.74067 59.3335 5.77899 59.3335 7.05508V57.0216C59.3335 58.2969 58.2942 59.3352 57.0168 59.3352H6.98342C5.7062 59.3352 4.66761 58.2969 4.66761 57.0216V36.9389C2.90982 36.7703 1.27948 36.0149 -4.81762e-07 34.7678ZM10.7807 30.6654H26.0384L1.34093 5.97437C-0.02533 4.60686 -0.02533 2.39174 1.34093 1.02583C2.70813 -0.341677 4.92462 -0.341677 6.29089 1.02423L30.9883 25.7159V10.4614C30.9883 8.52907 32.5556 6.96139 34.4888 6.96139C35.4553 6.96139 36.3305 7.35214 36.9642 7.98612C37.5976 8.62116 37.9897 9.49543 37.9897 10.4613V34.1643C37.9897 36.0966 36.4228 37.6635 34.4896 37.6635H10.7807C8.84705 37.6635 7.28056 36.0974 7.28056 34.1643C7.28056 32.2312 8.84705 30.6654 10.7807 30.6654Z","fill","white"],["id","filter0_d_0_4","x","-4","y","0","width","72","height","72","filterUnits","userSpaceOnUse","color-interpolation-filters","sRGB"],["flood-opacity","0","result","BackgroundImageFix"],["in","SourceAlpha","type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0","result","hardAlpha"],["dy","4"],["stdDeviation","2"],["in2","hardAlpha","operator","out"],["type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"],["mode","normal","in2","BackgroundImageFix","result","effect1_dropShadow_0_4"],["mode","normal","in","SourceGraphic","in2","effect1_dropShadow_0_4","result","shape"]],template:function(o,c){1&o&&(Pe(0,"div",0)(1,"div",1)(2,"button",2),tn("click",function(){return c.onToggleCamera()}),Pe(3,"div",3),Wo(),Pe(4,"svg",4)(5,"g",5)(6,"g",6)(7,"g",7),wt(8,"path",8),Re()()(),Pe(9,"g",9)(10,"g",6)(11,"g",7),wt(12,"path",10),Re()(),Pe(13,"g",11)(14,"g",12),wt(15,"path",13),Re()()()()(),ic(),Pe(16,"p"),Or(17,"Camera"),Re()()(),Pe(18,"div",1)(19,"button",2),tn("click",function(){return c.onToggleMicrophone()}),Pe(20,"div",3),Wo(),Pe(21,"svg",4)(22,"g",14)(23,"g",15),wt(24,"path",16)(25,"path",17),Re()(),Pe(26,"g",18),wt(27,"path",19),Re()()(),ic(),Pe(28,"p"),Or(29,"Mic"),Re()()(),Fe(30,j7,22,7,"div",20),Fe(31,H7,18,2,"div",20),Pe(32,"div",1)(33,"button",21),tn("click",function(){return c.onEndCall()}),Pe(34,"div",3),Wo(),Pe(35,"svg",4)(36,"g",22)(37,"g",6),wt(38,"path",23)(39,"path",24)(40,"path",25),Re()()()(),ic(),Pe(41,"p"),Or(42,"End"),Re()()()()),2&o&&(Vt("controls--small",c.smallScreenEnabled),Je(2),Vt("controls__button--active",c.cameraEnabled),Je(3),Vt("controls__icon--shown",c.cameraEnabled),Je(4),Vt("controls__icon--shown",!c.cameraEnabled),Je(10),Vt("controls__button--active",c.microphoneEnabled),Je(3),Vt("controls__icon--shown",c.microphoneEnabled),Je(4),Vt("controls__icon--shown",!c.microphoneEnabled),Je(4),Qe("ngIf",!c.smallScreenEnabled),Je(1),Qe("ngIf",c.displaySmallScreen))},dependencies:[Gd],styles:["[_nghost-%COMP%]{transition:.3s}.controls[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);bottom:0;display:flex;justify-content:center;padding:15px 0;position:absolute;left:0;width:100%}.controls--small[_ngcontent-%COMP%]{border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding:5px 0}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{height:32px;width:32px}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:16px;width:16px}.controls--small[_ngcontent-%COMP%]   .controls__item[_ngcontent-%COMP%]{margin:0}.controls--small[_ngcontent-%COMP%]   .controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:none}.controls__item[_ngcontent-%COMP%]{margin:0 5px;text-align:center}.controls__button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer}.controls__button[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#101316}.controls__button--active[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#0b73c9}.controls__button--active[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#158ef2}.controls__button--active.controls__button--rotate[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transform:translate(-50%,-50%) rotate(-180deg)}.controls__button--danger[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#d73b3d}.controls__button--danger[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#e06567}.controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;margin:8px 0 0}.controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#313a42;border-radius:50%;box-shadow:0 3px 8px #00000080;margin:auto;position:relative;height:60px;width:60px;transition:.3s}.controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%) rotate(0);height:32px;width:32px;transition:.3s}.controls__icon[_ngcontent-%COMP%]{opacity:0;transition:.3s}.controls__icon--shown[_ngcontent-%COMP%]{opacity:1}"],changeDetection:0})}return e})(),nq=(()=>{class e{constructor(){this.error=!1,this.connected=!0,this.ended=!1,this.small=!1}get color(){return this.ended?"#aaa":this.error?"#d73b3d":this.connected?"#37D425":"#1195E6"}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Ct({type:e,selectors:[["ngx-spinner"]],inputs:{text:"text",error:"error",connected:"connected",ended:"ended",small:"small"},decls:8,vars:9,consts:[[1,"spinner",3,"ngClass"],[1,"spinner__wrapper"],[1,"spinner__icon"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 32 32","fill","none"],["d","M5.25 5.5C3.45507 5.5 2 6.95508 2 8.75V19.25C2 21.0449 3.45507 22.5 5.25 22.5H14.75C16.5449 22.5 18 21.0449 18 19.25V8.75C18 6.95507 16.5449 5.5 14.75 5.5H5.25Z"],["d","M23.1232 20.6431L19.5 17.0935V10.9989L23.1121 7.3706C23.8988 6.58044 25.248 7.13753 25.248 8.25251V19.7502C25.248 20.8577 23.9143 21.4181 23.1232 20.6431Z"],[1,"spinner__cirle"],["class","spinner__text",4,"ngIf"],[1,"spinner__text"]],template:function(o,c){1&o&&(Pe(0,"div",0)(1,"div",1)(2,"div",2),Wo(),Pe(3,"svg",3),wt(4,"path",4)(5,"path",5),Re()(),ic(),wt(6,"div",6),Fe(7,G7,2,1,"div",7),Re()()),2&o&&(Qe("ngClass",nC(4,W7,c.connected,c.ended,c.small,c.error)),Je(4),ri("fill",c.color),Je(1),ri("fill",c.color),Je(2),Qe("ngIf",!c.small))},dependencies:[ov,Gd],styles:[".spinner[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;position:relative;transition:.3s}.spinner--connected[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#37d425}.spinner--ended[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:transparent}.spinner--error[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#d73b3d}.spinner--small[_ngcontent-%COMP%]{border-radius:10px;height:200px}.spinner--small[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-width:4px;height:80px;width:80px}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]{top:26px;transform:translate(-35%)}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.spinner__wrapper[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}.spinner__cirle[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 2s linear infinite;border:5px solid #1195E6;border-radius:50%;border-top-color:transparent;height:160px;margin:auto;width:160px;transition:.3s}.spinner__icon[_ngcontent-%COMP%]{left:50%;position:absolute;top:52px;transform:translate(-40%);transition:.3s}.spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px;transition:.3s}.spinner__text[_ngcontent-%COMP%]{color:#fff;font-size:1.3em;margin-top:25px;text-align:center}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"],changeDetection:0})}return e})(),iq=(()=>{class e{constructor(){this.started=Date.now()}ngOnInit(){this.time$=fP(0,1e3).pipe(dn(()=>this.format(Date.now()-this.started)))}format(t){const o=Math.floor(t/1e3%60).toString().padStart(2,"0"),c=Math.floor(t/6e4%60).toString().padStart(2,"0");return[Math.floor(t/36e5%24).toString().padStart(2,"0"),c,o].join(":")}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Ct({type:e,selectors:[["ngx-timer"]],inputs:{started:"started"},decls:4,vars:3,consts:[[1,"timer"]],template:function(o,c){1&o&&(Pe(0,"div",0)(1,"span"),Or(2),dE(3,"async"),Re()()),2&o&&(Je(2),uc(pc(3,1,c.time$)))},dependencies:[Zr],styles:[".timer[_ngcontent-%COMP%]{color:#fff;position:relative;text-align:center;z-index:1}.timer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);border-radius:5px;padding:5px 10px}"],changeDetection:0})}return e})(),rq=(()=>{class e extends s5{constructor(t){super(t),this.fullScreen=!1}ngOnInit(){this.play(`assets/${this.data.outcome?"outcome":"income"}.mp3`)}ngOnDestroy(){this.stop()}onAcceptCall(){this.fullScreen=!0,this.cdr.markForCheck(),this.afterClosed.next(this.data)}onDeclineCall(){this.play("assets/cancel.mp3"),setTimeout(()=>this.closeDialog(null),200)}play(t,o=!0){this.audio&&this.stop(),this.audio=new Audio(t),this.audio.loop=o,this.audio.load(),this.audio.play()}stop(){this.audio.pause(),this.audio.remove()}static#e=this.\u0275fac=function(o){return new(o||e)(re(rr))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["ngx-video-call"]],inputs:{data:"data"},features:[Ne],decls:1,vars:1,consts:[["class","video-call",3,"video-call--full-screen",4,"ngIf"],[1,"video-call"],[1,"video-call-user"],[1,"video-call-user__block","video-call-user__block--animated"],["alt","",1,"video-call-user__img",3,"src"],[1,"video-call-user__title"],[4,"ngIf","ngIfElse"],["income",""],[1,"video-call__actions"],[4,"ngIf"],["aria-label","Decline",1,"video-call__button","video-call__button--decline",3,"click"],["aria-label","Accept",1,"video-call__button","video-call__button--accept",3,"click"]],template:function(o,c){1&o&&Fe(0,Y7,12,7,"div",0),2&o&&Qe("ngIf",c.shown&&c.data)},dependencies:[Gd],styles:['[_nghost-%COMP%]{display:block;height:100vh;position:relative}.video-call[_ngcontent-%COMP%]{background-image:linear-gradient(#3F51B5,#313A42);background-size:cover;border-radius:10px;box-shadow:0 5px 10px #0000001a;display:flex;flex-direction:column;height:100%;justify-content:flex-end;left:50%;max-height:400px;max-width:400px;position:absolute;top:50%;transform:translate(-50%,-50%);width:100%;z-index:5;transition:.3s}.video-call--full-screen[_ngcontent-%COMP%]{background-image:linear-gradient(#22292F);border-radius:0;max-height:100%;max-width:100%}.video-call-user[_ngcontent-%COMP%]{left:50%;position:absolute;text-align:center;top:50%;transform:translate(-50%,-55%);z-index:1}.video-call-user__block[_ngcontent-%COMP%]{background:#fff;border-radius:50%;border:solid 5px #fff;height:180px;margin:0 auto;transform:scale(1);width:180px}.video-call-user__block--animated[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_play 2s ease infinite;backface-visibility:hidden}.video-call-user__img[_ngcontent-%COMP%]{border-radius:50%;height:100%;left:0;object-fit:cover;position:absolute;top:0;width:100%}.video-call-user__title[_ngcontent-%COMP%]{color:#fff;font-size:1.2em;font-weight:700;margin:15px 0 0}.video-call__actions[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:10px 0}.video-call__button[_ngcontent-%COMP%]{border-radius:50%;box-shadow:0 0 #3f51b500,0 .05em .1em #0003;border:0;cursor:pointer;display:block;font-size:40px;height:1em;margin:0 5px;position:relative;transform:translateZ(0) scale(1);width:1em;transition:.3s}.video-call__button[_ngcontent-%COMP%]:before, .video-call__button[_ngcontent-%COMP%]:after{content:"";position:absolute}.video-call__button[_ngcontent-%COMP%]:before{background-color:#ffffff1a;border-radius:50%;height:1em;left:0;opacity:1;top:0;transform:translateZ(0) scale(0);width:1em}.video-call__button[_ngcontent-%COMP%]:after{background-position:50% 50%;background-repeat:no-repeat;background-size:cover;background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTYuNiAxMC44YzEuNCAyLjggMy44IDUuMSA2LjYgNi42bDIuMi0yLjJjLjMtLjMuNy0uNCAxLS4yIDEuMS40IDIuMy42IDMuNi42LjUgMCAxIC40IDEgMVYyMGMwIC41LS41IDEtMSAxLTkuNCAwLTE3LTcuNi0xNy0xNyAwLS42LjQtMSAxLTFoMy41Yy41IDAgMSAuNCAxIDEgMCAxLjIuMiAyLjUuNiAzLjYuMS40IDAgLjctLjIgMWwtMi4zIDIuMnoiIGZpbGw9IiNmZmZmZmYiLz48L3N2Zz4=);height:.5em;left:.25em;top:.25em;transform:translateZ(0);width:.5em;transition:.3s}.video-call__button--accept[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_phone-outer 3s infinite;background-color:#3f51b5}.video-call__button--accept[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_phone-inner 3s infinite}.video-call__button--accept[_ngcontent-%COMP%]:after{animation:_ngcontent-%COMP%_phone-icon 3s infinite}.video-call__button--decline[_ngcontent-%COMP%]{background-color:#d73b3d}.video-call__button--decline[_ngcontent-%COMP%]:hover{background-color:#ce2a2c}.video-call__button--decline[_ngcontent-%COMP%]:after{top:.28em;transform:translateZ(0) rotate(135deg)}@keyframes _ngcontent-%COMP%_play{0%{transform:scale(1)}15%{box-shadow:0 0 0 5px #9b9da466}25%{box-shadow:0 0 0 10px #9b9da466,0 0 0 20px #9b9da433}25%{box-shadow:0 0 0 15px #9b9da466,0 0 0 30px #9b9da433}}@keyframes _ngcontent-%COMP%_phone-outer{0%{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}33.3333%{box-shadow:0 0 #3f51b51a,0 .05em .1em #00000080;transform:translateZ(0) scale(1.1)}66.6666%{box-shadow:0 0 0 .5em #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}to{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}}@keyframes _ngcontent-%COMP%_phone-inner{0%{opacity:1;transform:translateZ(0) scale(0)}33.3333%{opacity:1;transform:translateZ(0) scale(.9)}66.6666%{opacity:0;transform:translateZ(0) scale(0)}to{opacity:0;transform:translateZ(0) scale(0)}}@keyframes _ngcontent-%COMP%_phone-icon{0%{transform:translateZ(0)}2%{transform:translate3d(.01em,0,0)}4%{transform:translate3d(-.01em,0,0)}6%{transform:translate3d(.01em,0,0)}8%{transform:translate3d(-.01em,0,0)}10%{transform:translate3d(.01em,0,0)}12%{transform:translate3d(-.01em,0,0)}14%{transform:translate3d(.01em,0,0)}16%{transform:translate3d(-.01em,0,0)}18%{transform:translate3d(.01em,0,0)}20%{transform:translate3d(-.01em,0,0)}22%{transform:translate3d(.01em,0,0)}24%{transform:translate3d(-.01em,0,0)}26%{transform:translate3d(.01em,0,0)}28%{transform:translate3d(-.01em,0,0)}30%{transform:translate3d(.01em,0,0)}32%{transform:translate3d(-.01em,0,0)}34%{transform:translate3d(.01em,0,0)}36%{transform:translate3d(-.01em,0,0)}38%{transform:translate3d(.01em,0,0)}40%{transform:translate3d(-.01em,0,0)}42%{transform:translate3d(.01em,0,0)}44%{transform:translate3d(-.01em,0,0)}46%{transform:translateZ(0)}}'],data:{animation:[o5]},changeDetection:0})}return e})(),oq=(()=>{class e{constructor(t,o,c,u){this.document=t,this.componentFactoryResolver=o,this.appRef=c,this.injector=u,this.wrapperSelector="ngx-webrtc-wrapper"}open(t,o={}){return this.appendComponent(t,o)}appendComponent(t,o){const c=this.componentFactoryResolver.resolveComponentFactory(t).create(this.injector),{instance:u}=c;Object.keys(o).forEach(g=>u[g]=o[g]),this.appRef.attachView(c.hostView);const f=c.hostView.rootNodes[0];return this.getContainer().append(f),u.afterClosed.pipe(wr(1),function V7(e,i=t0){const t=fP(e,i);return r5(()=>t)}(250)).subscribe(()=>{this.appRef.detachView(c.hostView),c.destroy()}),u}getContainer(){let t=this.document.querySelector(`.${this.wrapperSelector}`);return t||(t=this.document.createElement("div"),t.setAttribute("class",this.wrapperSelector),t.setAttribute("style","position: fixed; top: 0; width: 100%; z-index: 1;"),this.document.body.appendChild(t)),t}static#e=this.\u0275fac=function(o){return new(o||e)(pe(Yt),pe(qu),pe(ea),pe(tr))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const a5={connected:!1,loading:!0,statusText:"Initializing",started:null,ended:!1,error:!1},sq={mode:"rtc",codec:"h264"};let c5=(()=>{class e{constructor(t){this.config=t,this.agoraRTC=B7,this.streamState=new Rr(a5),this.remoteStreamVideoToggle=new Rr(!0),this.callEnd=new Gt,this.localContainerId="local-video",this.remoteCalls=[],this.remoteStreamVideoToggle$=this.remoteStreamVideoToggle.asObservable(),this.streamState$=this.streamState.asObservable(),this.agoraRTC.checkSystemRequirements()||this.handleError(new Error("Web RTC is not supported in this browser"))}init(t,o,c=!1){return this.uid=t,this.agoraRTC.setLogLevel(c?0:4),this.client=this.agoraRTC.createClient(sq),this.assignClientHandlers(),this.initLocalStream().then(()=>{this.client.join(this.config.AppID,o,null,this.uid).then(()=>{this.localTracks.videoTrack.play(this.localContainerId),this.client.publish(Object.values(this.localTracks)),this.streamState.next({...this.streamState.value,connected:!0,statusText:"Waiting others to join"})}).catch(u=>this.handleError(u))}),this.callEnd.asObservable()}deinit(){this.streamState.next(a5)}endCall(){this.client.leave().then(()=>{this.stopLocalStream(),this.streamState.next({...this.streamState.value,started:null,loading:!0,statusText:"",ended:!0}),this.remoteCalls=[],vU(500).pipe(wr(1)).subscribe(()=>this.callEnd.next())})}toggleVideo(t){this.localTracks&&this.localTracks.videoTrack.setMuted(t)}toggleAudio(t){this.localTracks&&this.localTracks.audioTrack.setMuted(t)}toggleFullScreen(t){t?document.exitFullscreen():document.documentElement.requestFullscreen()}isVideoEnabled(){return!!this.localTracks&&!this.localTracks.videoTrack.muted}isAudioEnabled(){return!!this.localTracks&&!this.localTracks.audioTrack.muted}assignClientHandlers(){this.client.on("user-joined",t=>{this.streamState.next({...this.streamState.value,started:Date.now(),loading:!1}),this.remoteCalls.length||this.remoteCalls.push(this.getRemoteId(t))}),this.client.on("user-published",(t,o)=>{const c=this.getRemoteId(t);this.client.subscribe(t,o).then(u=>{this.remoteCalls.includes(c)&&u.play(c)})}),this.client.on("user-info-updated",(t,o)=>{"mute-video"===o&&this.remoteStreamVideoToggle.next(!1),"unmute-video"===o&&this.remoteStreamVideoToggle.next(!0)}),this.client.on("user-left",()=>{this.endCall()})}initLocalStream(){return Promise.all([this.agoraRTC.createCameraVideoTrack(),this.agoraRTC.createMicrophoneAudioTrack()]).then(([t,o])=>{this.localTracks={audioTrack:o,videoTrack:t}}).catch(t=>{this.handleError(t)})}getRemoteId(t){return`remote_call-${t.uid}`}handleError(t){throw this.streamState.next({...this.streamState.value,statusText:t.message,error:!0}),this.stopLocalStream(),vU(5e3).pipe(wr(1)).subscribe(()=>this.callEnd.next()),new Error(t.message)}stopLocalStream(){this.localTracks&&Object.values(this.localTracks).forEach(t=>{t.stop(),t.close()})}static#e=this.\u0275fac=function(o){return new(o||e)(pe("AgoraConfig"))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),aq=(()=>{class e{onEnter(){this.subscription.unsubscribe(),this.setStyle(1)}onLeave(){this.hide()}constructor(t,o){this.renderer=t,this.el=o,this.subscription=new Dn,this.delay=5e3}ngOnInit(){this.hide()}hide(){this.subscription.unsubscribe(),this.subscription=vU(this.delay).pipe(wr(1)).subscribe(()=>this.setStyle(0))}setStyle(t){this.renderer.setStyle(this.el.nativeElement,"opacity",t)}static#e=this.\u0275fac=function(o){return new(o||e)(re(Sa),re(bn))};static#t=this.\u0275dir=Ge({type:e,selectors:[["","ngxToggle",""]],hostBindings:function(o,c){1&o&&tn("mouseenter",function(){return c.onEnter()})("mouseleave",function(){return c.onLeave()})}})}return e})(),l5=(()=>{class e extends s5{constructor(t,o){super(o),this.webRtcService=t,this.animate=!0,this.displaySmallScreen=!1,this.debug=!1,this.callEnd=new en,this.smallScreenEnabled=!1,this.active=!1,this.streamState$=this.webRtcService.streamState$,this.remoteStreamVideoToggle$=this.webRtcService.remoteStreamVideoToggle$}ngOnInit(){this.webRtcService.init(this.uid,this.channel,this.debug).pipe(wr(1)).subscribe(()=>{this.active=this.smallScreenEnabled,this.callEnd.emit(),this.closeDialog(!0)})}ngOnDestroy(){this.webRtcService.deinit()}get localContainerId(){return this.webRtcService.localContainerId}get remoteCalls(){return this.webRtcService.remoteCalls}get cameraEnabled(){return this.webRtcService.isVideoEnabled()}get microphoneEnabled(){return this.webRtcService.isAudioEnabled()}get fullScreenEnabled(){return!!document.fullscreenElement}onToggleCamera(t){this.webRtcService.toggleVideo(t)}onToggleMicrophone(t){this.webRtcService.toggleAudio(t)}onToggleFullScreen(t){this.webRtcService.toggleFullScreen(t)}onToggleSmallScreen(t){this.smallScreenEnabled=!t,this.active=!0}onEndCall(){this.webRtcService.endCall()}static#e=this.\u0275fac=function(o){return new(o||e)(re(c5),re(rr))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["ngx-webrtc"]],hostVars:4,hostBindings:function(o,c){2&o&&Vt("small-screen",c.smallScreenEnabled)("active",c.active)},inputs:{uid:"uid",channel:"channel",animate:"animate",displaySmallScreen:"displaySmallScreen",debug:"debug"},outputs:{callEnd:"callEnd"},features:[Ne],decls:1,vars:1,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[1,"container"],[3,"error","text","connected","ended","small",4,"ngIf"],[3,"started",4,"ngIf"],[1,"container__local",3,"id"],["class","container__remote",3,"id","hidden",4,"ngFor","ngForOf"],[1,"container__user-icon"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","user","clip-path","url(#clip0)"],["id","Vector","d","M31.5439 30.829C35.7793 30.829 39.4468 29.3099 42.4434 26.3129C45.4399 23.3163 46.959 19.6498 46.959 15.414C46.959 11.1796 45.4399 7.51267 42.4429 4.51512C39.4458 1.51904 35.7788 0 31.5439 0C27.3081 0 23.6416 1.51904 20.645 4.51561C17.6484 7.51218 16.1289 11.1792 16.1289 15.414C16.1289 19.6498 17.6484 23.3168 20.6455 26.3134C23.6426 29.3095 27.3096 30.829 31.5439 30.829V30.829Z","fill","#0B73C9"],["id","Vector_2","d","M58.5161 49.2127C58.4297 47.9656 58.2549 46.6053 57.9976 45.1688C57.7378 43.7215 57.4033 42.3533 57.0029 41.1029C56.5894 39.8104 56.0269 38.534 55.3315 37.3109C54.6099 36.0414 53.7622 34.9359 52.811 34.0262C51.8164 33.0746 50.5986 32.3094 49.1904 31.7513C47.7871 31.1962 46.2319 30.9149 44.5684 30.9149C43.915 30.9149 43.2832 31.183 42.063 31.9774C41.312 32.4672 40.4336 33.0336 39.4531 33.66C38.6147 34.1942 37.479 34.6947 36.0762 35.1478C34.7075 35.5907 33.3179 35.8153 31.9463 35.8153C30.5747 35.8153 29.1855 35.5907 27.8154 35.1478C26.4141 34.6952 25.2783 34.1947 24.4409 33.6605C23.4697 33.0399 22.5908 32.4735 21.8286 31.9769C20.6099 31.1825 19.9775 30.9144 19.3242 30.9144C17.6602 30.9144 16.1055 31.1962 14.7026 31.7518C13.2954 32.309 12.0771 33.0741 11.0815 34.0267C10.1309 34.9369 9.28271 36.0419 8.56201 37.3109C7.86719 38.534 7.30469 39.8099 6.89062 41.1034C6.49072 42.3538 6.15625 43.7215 5.89648 45.1688C5.63916 46.6033 5.46436 47.9642 5.37793 49.2142C5.29297 50.4388 5.25 51.7098 5.25 52.9934C5.25 56.3343 6.31201 59.0388 8.40625 61.0335C10.4746 63.0017 13.2114 64.0002 16.5396 64.0002H47.356C50.6841 64.0002 53.4199 63.0022 55.4888 61.0335C57.5835 59.0403 58.6455 56.3352 58.6455 52.993C58.645 51.7034 58.6016 50.4314 58.5161 49.2127V49.2127Z","fill","#0B73C9"],["id","clip0"],["width","64","height","64","fill","#0B73C9"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall",4,"ngIf"],[3,"error","text","connected","ended","small"],[3,"started"],[1,"container__remote",3,"id"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall"]],template:function(o,c){1&o&&Fe(0,eq,3,5,"div",0),2&o&&Qe("ngIf",c.shown)},dependencies:[sN,Gd,tq,iq,nq,aq,Zr],styles:["ngx-timer[_ngcontent-%COMP%]{display:block;padding-top:25px}[_nghost-%COMP%]{bottom:0;max-width:100%;right:0;width:100%;transition:.3s}.active[_nghost-%COMP%]{position:fixed}.small-screen[_nghost-%COMP%]{max-width:210px}.small-screen[_nghost-%COMP%]   ngx-timer[_ngcontent-%COMP%]{padding-top:10px}.small-screen[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{border-radius:10px;box-shadow:#00000059 0 5px 15px;height:200px;max-width:200px;margin-right:10px;margin-bottom:10px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]{border-radius:10px;height:200px;width:200px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]    >div{border-radius:10px}.small-screen[_nghost-%COMP%]   .container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.container[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;max-width:100%;margin-left:auto;overflow:hidden;position:relative;transition:.3s}.container__local[_ngcontent-%COMP%]{border-radius:5px;height:20vh;opacity:1;overflow:hidden;position:absolute;right:1rem;top:1rem;width:20vw;z-index:1;transition:.3s}.container__local.hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden}.container__local[_ngcontent-%COMP%]:not(:empty){box-shadow:0 3px 8px #00000080}.container__remote[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;left:0;position:absolute;top:0;width:100vw;transition:.3s}.container__remote[_ngcontent-%COMP%]    >div{transition:.3s}.container__remote.hidden[_ngcontent-%COMP%]{display:none}.container__remote.hidden[_ngcontent-%COMP%] + .container__user-icon[_ngcontent-%COMP%]{display:block}.container__remote[_ngcontent-%COMP%]:empty{display:none}.container__user-icon[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);border-radius:50%;box-shadow:0 3px 8px #00000080;display:none;left:50%;padding:20px;position:absolute;top:50%;transform:translate(-50%,-50%)}.container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px}@media screen and (max-width: 769px){ngx-controls[_ngcontent-%COMP%]{opacity:1!important}}"],data:{animation:[o5]},changeDetection:0})}return e})(),cq=(()=>{class e{constructor(t){this.dialog=t}open(t){const o=new Gt,c=this.dialog.open(rq,{data:t});return c.afterClosed.asObservable().pipe(Lo(u=>u?.channel?this.dialog.open(l5,{uid:u.uid,channel:u.channel,debug:!!u.debug,displaySmallScreen:!0}).afterClosed.asObservable():He(!1)),wr(1),Ur(()=>o.next(!0))).subscribe(),{acceptCall:c.onAcceptCall.bind(c),close:c.closeDialog.bind(c),afterConfirmation:()=>c.afterClosed.asObservable().pipe(wr(1)),afterCallEnd:()=>o.asObservable().pipe(wr(1))}}static#e=this.\u0275fac=function(o){return new(o||e)(pe(oq))};static#t=this.\u0275prov=Me({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),lq=(()=>{class e{static forRoot(t){return{ngModule:e,providers:[c5,{provide:"AgoraConfig",useValue:t}]}}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e});static#n=this.\u0275inj=St({imports:[Vh]})}return e})();const dq=[{path:"",component:(()=>{class e{constructor(t,o,c,u,f){this.formBuilder=t,this.router=o,this.localStorage=c,this.videoCallDialogService=u,this.cdr=f,this.sessionKey="ngx-webrtc:channelId",this.outcome=!1}get channelId(){return this.localStorage.getItem(this.sessionKey)||"test-channel-ngx-webrtc"}get tooltipText(){return this.outcome?"Outcome":"Income"}ngOnInit(){this.form=this.formBuilder.group({channelId:[this.channelId,Yd.required]})}onSubmit(){this.saveChannel(),this.router.navigate(["conference"],{queryParams:{...this.form.value}})}onModalOpen(){this.saveChannel(),this.dialog=this.videoCallDialogService.open({uid:String(Math.floor(100*Math.random())),channel:this.channelId,outcome:this.outcome,user:{name:"Test User",photoURL:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTvDtoEwuV9E2kHqNDi6MnBzXlefn8TfyrwgQ&usqp=CAU"},debug:!0});const t=setTimeout(()=>this.dialog?.close(),7e3);this.dialog.afterConfirmation().pipe(ra(o=>!!o),Ur(()=>clearTimeout(t))).subscribe(),this.dialog.afterCallEnd().subscribe(()=>{clearTimeout(t),this.dialog=null,this.cdr.markForCheck()})}saveChannel(){const{channelId:t}=this.form.value;this.localStorage.setItem(this.sessionKey,t)}static#e=this.\u0275fac=function(o){return new(o||e)(re(n6),re(Ps),re(Storage),re(cq),re(rr))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["app-home"]],decls:25,vars:8,consts:[[1,"home"],[1,"home__welcome"],[1,"home__form",3,"formGroup","ngSubmit"],[1,"home__wrapper","home__wrapper--center"],["src","assets/user.svg","alt","User",1,"user"],[1,"home__title"],["appearance","outline",1,"home__wrapper"],["matInput","","placeholder","Channel id","formControlName","channelId"],[1,"home__wrapper","home__wrapper--center","home__wrapper--buttons"],["mat-flat-button","","color","primary",1,"home__btn",3,"disabled"],["mat-raised-button","","type","button",1,"home__btn",3,"disabled","click"],[3,"checked","disabled","matTooltip","change","click"],[1,"home__footer"],["href","https://www.npmjs.com/package/ngx-webrtc-lib","target","_blank"],["viewBox","0 0 27.23 27.23"],["width","27.23","height","27.23","rx","2"],["fill","#fff","points","5.8 21.75 13.66 21.75 13.67 9.98 17.59 9.98 17.58 21.76 21.51 21.76 21.52 6.06 5.82 6.04 5.8 21.75"],["href","https://github.com/TarasMoskovych/ngx-webrtc","target","_blank"],["aria-hidden","true","role","img","viewBox","0 0 16 16","width","50","height","50",1,""],["fill-rule","evenodd","d","M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"]],template:function(o,c){1&o&&(Pe(0,"div",0)(1,"div",1)(2,"form",2),tn("ngSubmit",function(){return!c.dialog&&c.onSubmit()}),Pe(3,"div",3),wt(4,"img",4),Re(),Pe(5,"h1",5),Or(6," Welcome "),Re(),Pe(7,"mat-form-field",6)(8,"mat-label"),Or(9,"Channel Id"),Re(),wt(10,"input",7),Re(),Pe(11,"div",8)(12,"button",9),Or(13,"Start / Join call"),Re(),Pe(14,"button",10),tn("click",function(){return!c.dialog&&c.onModalOpen()}),Or(15,"Open Call Dialog "),Pe(16,"mat-slide-toggle",11),tn("change",function(f){return c.outcome=f.checked})("click",function(f){return f.stopPropagation()}),Re()()()(),Pe(17,"div",12)(18,"a",13),Wo(),Pe(19,"svg",14),wt(20,"rect",15)(21,"polygon",16),Re()(),ic(),Pe(22,"a",17),Wo(),Pe(23,"svg",18),wt(24,"path",19),Re()()()()()),2&o&&(Je(2),Qe("formGroup",c.form),Je(5),Vt("mat-focused",c.form.valid),Je(5),Qe("disabled",c.form.invalid||!!c.dialog),Je(2),Qe("disabled",c.form.invalid||!!c.dialog),Je(2),Qe("checked",c.outcome)("disabled",!!c.dialog)("matTooltip",c.tooltipText))},dependencies:[k3,sr,y3,b3,JT,J2,iH,Q8,vF,c8,gG,JB],styles:[".home[_ngcontent-%COMP%]{align-items:center;background-color:#f2f2f2;display:flex;flex-wrap:wrap;justify-content:center;min-height:100vh;width:100%}.home__welcome[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 5px 10px #0000001a;overflow:hidden;padding:10px 35px;width:390px}.home__welcome[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{height:150px}.home__title[_ngcontent-%COMP%]{color:#333;display:block;font-size:30px;font-weight:500;margin:10px 0 60px;text-align:center}.home__wrapper[_ngcontent-%COMP%]{width:100%}.home__wrapper--center[_ngcontent-%COMP%]{text-align:center}.home__wrapper--buttons[_ngcontent-%COMP%]{align-items:center;display:flex}.home__btn[_ngcontent-%COMP%]{letter-spacing:normal}.home__btn[_ngcontent-%COMP%]:first-of-type{margin-right:5px}.home__btn[_ngcontent-%COMP%]:last-of-type{margin-left:5px}.home__footer[_ngcontent-%COMP%]{margin-top:30px;text-align:center}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:#333;cursor:pointer;height:24px;margin:0 5px;width:24px;transition:.3s}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]:hover{fill:#aaa}"],changeDetection:0})}return e})()},{path:"conference",component:(()=>{class e{constructor(t,o){this.route=t,this.router=o,this.uid=String(Math.floor(100*Math.random()))}ngOnInit(){this.channel=this.route.snapshot.queryParams.channelId||"test-channel"}onCallEnd(){this.router.navigateByUrl("/")}static#e=this.\u0275fac=function(o){return new(o||e)(re(vm),re(Ps))};static#t=this.\u0275cmp=Ct({type:e,selectors:[["app-conference"]],decls:1,vars:4,consts:[[3,"animate","channel","debug","uid","callEnd"]],template:function(o,c){1&o&&(Pe(0,"ngx-webrtc",0),tn("callEnd",function(){return c.onCallEnd()}),Re()),2&o&&Qe("animate",!1)("channel",c.channel)("debug",!0)("uid",c.uid)},dependencies:[l5],changeDetection:0})}return e})()},{path:"**",redirectTo:""}];let uq=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=yn({type:e,bootstrap:[F7]});static#n=this.\u0275inj=St({providers:[{provide:Storage,useValue:window.localStorage}],imports:[jN,m9,lq.forRoot(n5_configs),i6,O7.forRoot(dq),rH,d8,yG,mH]})}return e})();Nt().bootstrapModule(uq).catch(e=>console.error(e))},291:function(Ac,Sm,Cm){var x=Cm(156).default;Ac.exports=function(){"use strict";let da=!0,ua=!0;function Dn(s,n,r){const a=s.match(n);return a&&a.length>=r&&parseInt(a[r],10)}function xo(s,n,r){if(!s.RTCPeerConnection)return;const a=s.RTCPeerConnection.prototype,l=a.addEventListener;a.addEventListener=function(h,p){if(h!==n)return l.apply(this,arguments);const m=_=>{const E=r(_);E&&(p.handleEvent?p.handleEvent(E):p(E))};return this._eventMap=this._eventMap||{},this._eventMap[n]||(this._eventMap[n]=new Map),this._eventMap[n].set(p,m),l.apply(this,[h,m])};const d=a.removeEventListener;a.removeEventListener=function(h,p){if(h!==n||!this._eventMap||!this._eventMap[n])return d.apply(this,arguments);if(!this._eventMap[n].has(p))return d.apply(this,arguments);const m=this._eventMap[n].get(p);return this._eventMap[n].delete(p),0===this._eventMap[n].size&&delete this._eventMap[n],0===Object.keys(this._eventMap).length&&delete this._eventMap,d.apply(this,[h,m])},Object.defineProperty(a,"on"+n,{get(){return this["_on"+n]},set(h){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),h&&this.addEventListener(n,this["_on"+n]=h)},enumerable:!0,configurable:!0})}function Oc(s){return"boolean"!=typeof s?new Error("Argument type: "+typeof s+". Please use a boolean."):(da=s,s?"adapter.js logging disabled":"adapter.js logging enabled")}function Nc(s){return"boolean"!=typeof s?new Error("Argument type: "+typeof s+". Please use a boolean."):(ua=!s,"adapter.js deprecation warnings "+(s?"disabled":"enabled"))}function Br(){if("object"==typeof window){if(da)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Pc(s,n){ua&&console.warn(s+" is deprecated, please use "+n+" instead.")}function xv(s){return"[object Object]"===Object.prototype.toString.call(s)}function Zh(s){return xv(s)?Object.keys(s).reduce(function(n,r){const a=xv(s[r]),l=a?Zh(s[r]):s[r],d=a&&!Object.keys(l).length;return void 0===l||d?n:Object.assign(n,{[r]:l})},{}):s}function kv(s,n,r){n&&!r.has(n.id)&&(r.set(n.id,n),Object.keys(n).forEach(a=>{a.endsWith("Id")?kv(s,s.get(n[a]),r):a.endsWith("Ids")&&n[a].forEach(l=>{kv(s,s.get(l),r)})}))}function P0(s,n,r){const a=r?"outbound-rtp":"inbound-rtp",l=new Map;if(null===n)return l;const d=[];return s.forEach(h=>{"track"===h.type&&h.trackIdentifier===n.id&&d.push(h)}),d.forEach(h=>{s.forEach(p=>{p.type===a&&p.trackId===h.id&&kv(s,p,l)})}),l}const M0=Br;function Tm(s,n){const r=s&&s.navigator;if(!r.mediaDevices)return;const a=function(h){if("object"!=typeof h||h.mandatory||h.optional)return h;const p={};return Object.keys(h).forEach(m=>{if("require"===m||"advanced"===m||"mediaSource"===m)return;const _="object"==typeof h[m]?h[m]:{ideal:h[m]};void 0!==_.exact&&"number"==typeof _.exact&&(_.min=_.max=_.exact);const E=function(v,b){return v?v+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==_.ideal){p.optional=p.optional||[];let v={};"number"==typeof _.ideal?(v[E("min",m)]=_.ideal,p.optional.push(v),v={},v[E("max",m)]=_.ideal,p.optional.push(v)):(v[E("",m)]=_.ideal,p.optional.push(v))}void 0!==_.exact&&"number"!=typeof _.exact?(p.mandatory=p.mandatory||{},p.mandatory[E("",m)]=_.exact):["min","max"].forEach(v=>{void 0!==_[v]&&(p.mandatory=p.mandatory||{},p.mandatory[E(v,m)]=_[v])})}),h.advanced&&(p.optional=(p.optional||[]).concat(h.advanced)),p},l=function(h,p){if(n.version>=61)return p(h);if((h=JSON.parse(JSON.stringify(h)))&&"object"==typeof h.audio){const m=function(_,E,v){E in _&&!(v in _)&&(_[v]=_[E],delete _[E])};m((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),m(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&"object"==typeof h.video){let m=h.video.facingMode;m=m&&("object"==typeof m?m:{ideal:m});const _=n.version<66;if(m&&("user"===m.exact||"environment"===m.exact||"user"===m.ideal||"environment"===m.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||_)){let E;if(delete h.video.facingMode,"environment"===m.exact||"environment"===m.ideal?E=["back","rear"]:"user"!==m.exact&&"user"!==m.ideal||(E=["front"]),E)return r.mediaDevices.enumerateDevices().then(v=>{let b=(v=v.filter(T=>"videoinput"===T.kind)).find(T=>E.some(O=>T.label.toLowerCase().includes(O)));return!b&&v.length&&E.includes("back")&&(b=v[v.length-1]),b&&(h.video.deviceId=m.exact?{exact:b.deviceId}:{ideal:b.deviceId}),h.video=a(h.video),M0("chrome: "+JSON.stringify(h)),p(h)})}h.video=a(h.video)}return M0("chrome: "+JSON.stringify(h)),p(h)},d=function(h){return n.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(h,p,m){l(h,_=>{r.webkitGetUserMedia(_,p,E=>{m&&m(d(E))})})}.bind(r),r.mediaDevices.getUserMedia){const h=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(p){return l(p,m=>h(m).then(_=>{if(m.audio&&!_.getAudioTracks().length||m.video&&!_.getVideoTracks().length)throw _.getTracks().forEach(E=>{E.stop()}),new DOMException("","NotFoundError");return _},_=>Promise.reject(d(_))))}}}function Mc(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function ep(s){if("object"==typeof s&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const n=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",a=>{let l;l=s.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.track.id):{track:a.track};const d=new Event("track");d.track=a.track,d.receiver=l,d.transceiver={receiver:l},d.streams=[r.stream],this.dispatchEvent(d)}),r.stream.getTracks().forEach(a=>{let l;l=s.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.id):{track:a};const d=new Event("track");d.track=a,d.receiver=l,d.transceiver={receiver:l},d.streams=[r.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),n.apply(this,arguments)}}else xo(s,"track",n=>(n.transceiver||Object.defineProperty(n,"transceiver",{value:{receiver:n.receiver}}),n))}function x0(s){if("object"==typeof s&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const n=function(l,d){return{track:d,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===d.kind?l.createDTMFSender(d):null),this._dtmf},_pc:l}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const l=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(h,p){let m=l.apply(this,arguments);return m||(m=n(this,h),this._senders.push(m)),m};const d=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const p=this._senders.indexOf(h);-1!==p&&this._senders.splice(p,1)}}const r=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(l){this._senders=this._senders||[],r.apply(this,[l]),l.getTracks().forEach(d=>{this._senders.push(n(this,d))})};const a=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(l){this._senders=this._senders||[],a.apply(this,[l]),l.getTracks().forEach(d=>{const h=this._senders.find(p=>p.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if("object"==typeof s&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const n=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(a=>a._pc=this),r},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function wm(s){if(!s.RTCPeerConnection)return;const n=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[r,a,l]=arguments;if(arguments.length>0&&"function"==typeof r)return n.apply(this,arguments);if(0===n.length&&(0===arguments.length||"function"!=typeof r))return n.apply(this,[]);const d=function(p){const m={};return p.result().forEach(_=>{const E={id:_.id,timestamp:_.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[_.type]||_.type};_.names().forEach(v=>{E[v]=_.stat(v)}),m[E.id]=E}),m},h=function(p){return new Map(Object.keys(p).map(m=>[m,p[m]]))};return arguments.length>=2?n.apply(this,[function(m){a(h(d(m)))},r]):new Promise((p,m)=>{n.apply(this,[function(_){p(h(d(_)))},m])}).then(a,l)}}function k0(s){if(!("object"==typeof s&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const r=s.RTCPeerConnection.prototype.getSenders;r&&(s.RTCPeerConnection.prototype.getSenders=function(){const l=r.apply(this,[]);return l.forEach(d=>d._pc=this),l});const a=s.RTCPeerConnection.prototype.addTrack;a&&(s.RTCPeerConnection.prototype.addTrack=function(){const l=a.apply(this,arguments);return l._pc=this,l}),s.RTCRtpSender.prototype.getStats=function(){const l=this;return this._pc.getStats().then(d=>P0(d,l.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const r=s.RTCPeerConnection.prototype.getReceivers;r&&(s.RTCPeerConnection.prototype.getReceivers=function(){const a=r.apply(this,[]);return a.forEach(l=>l._pc=this),a}),xo(s,"track",a=>(a.receiver._pc=a.srcElement,a)),s.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(l=>P0(l,a.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype)||!("getStats"in s.RTCRtpReceiver.prototype))return;const n=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const r=arguments[0];let a,l,d;return this.getSenders().forEach(h=>{h.track===r&&(a?d=!0:a=h)}),this.getReceivers().forEach(h=>(h.track===r&&(l?d=!0:l=h),h.track===r)),d||a&&l?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():l?l.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}function Im(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const n=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=n.apply(this,arguments);return this._shimmedLocalStreams[h.id]?-1===this._shimmedLocalStreams[h.id].indexOf(p)&&this._shimmedLocalStreams[h.id].push(p):this._shimmedLocalStreams[h.id]=[h,p],p};const r=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(m=>{if(this.getSenders().find(_=>_.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();r.apply(this,arguments);const p=this.getSenders().filter(m=>-1===h.indexOf(m));this._shimmedLocalStreams[d.id]=[d].concat(p)};const a=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],a.apply(this,arguments)};const l=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const p=this._shimmedLocalStreams[h].indexOf(d);-1!==p&&this._shimmedLocalStreams[h].splice(p,1),1===this._shimmedLocalStreams[h].length&&delete this._shimmedLocalStreams[h]}),l.apply(this,arguments)}}function L0(s,n){if(!s.RTCPeerConnection)return;if(s.RTCPeerConnection.prototype.addTrack&&n.version>=65)return Im(s);const r=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const m=r.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(_=>this._reverseStreams[_.id])};const a=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(_=>{if(this.getSenders().find(E=>E.track===_))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const _=new s.MediaStream(m.getTracks());this._streams[m.id]=_,this._reverseStreams[_.id]=m,m=_}a.apply(this,[m])};const l=s.RTCPeerConnection.prototype.removeStream;function d(m,_){let E=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(v=>{const b=m._reverseStreams[v];E=E.replace(new RegExp(m._streams[b.id].id,"g"),b.id)}),new RTCSessionDescription({type:_.type,sdp:E})}s.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},s.RTCPeerConnection.prototype.addTrack=function(m,_){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const E=[].slice.call(arguments,1);if(1!==E.length||!E[0].getTracks().find(b=>b===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(b=>b.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[_.id];if(v)v.addTrack(m),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const b=new s.MediaStream([m]);this._streams[_.id]=b,this._reverseStreams[b.id]=_,this.addStream(b)}return this.getSenders().find(b=>b.track===m)},["createOffer","createAnswer"].forEach(function(m){const _=s.RTCPeerConnection.prototype[m],E={[m](){const v=arguments;return arguments.length&&"function"==typeof arguments[0]?_.apply(this,[b=>{const T=d(this,b);v[0].apply(null,[T])},b=>{v[1]&&v[1].apply(null,b)},arguments[2]]):_.apply(this,arguments).then(b=>d(this,b))}};s.RTCPeerConnection.prototype[m]=E[m]});const h=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,_){let E=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(v=>{const b=m._reverseStreams[v],T=m._streams[b.id];E=E.replace(new RegExp(b.id,"g"),T.id)}),new RTCSessionDescription({type:_.type,sdp:E})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const p=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const m=p.get.apply(this);return""===m.type?m:d(this,m)}}),s.RTCPeerConnection.prototype.removeTrack=function(m){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let _;this._streams=this._streams||{},Object.keys(this._streams).forEach(E=>{this._streams[E].getTracks().find(v=>m.track===v)&&(_=this._streams[E])}),_&&(1===_.getTracks().length?this.removeStream(this._reverseStreams[_.id]):_.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Vl(s,n){!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),s.RTCPeerConnection&&n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const a=s.RTCPeerConnection.prototype[r],l={[r](){return arguments[0]=new("addIceCandidate"===r?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};s.RTCPeerConnection.prototype[r]=l[r]})}function tp(s,n){xo(s,"negotiationneeded",r=>{const a=r.target;if(!(n.version<72||a.getConfiguration&&"plan-b"===a.getConfiguration().sdpSemantics)||"stable"===a.signalingState)return r})}var F0=Object.freeze({__proto__:null,fixNegotiationNeeded:tp,shimAddTrackRemoveTrack:L0,shimAddTrackRemoveTrackWithNative:Im,shimGetDisplayMedia:function(s,n){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&("function"==typeof n?s.navigator.mediaDevices.getDisplayMedia=function(r){return n(r).then(a=>{const l=r.video&&r.video.width,d=r.video&&r.video.height;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:r.video&&r.video.frameRate||3}},l&&(r.video.mandatory.maxWidth=l),d&&(r.video.mandatory.maxHeight=d),s.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:x0,shimGetStats:wm,shimGetUserMedia:Tm,shimMediaStream:Mc,shimOnTrack:ep,shimPeerConnection:Vl,shimSenderReceiverGetStats:k0});function Rm(s,n){const r=s&&s.navigator,a=s&&s.MediaStreamTrack;if(r.getUserMedia=function(l,d,h){Pc("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(l).then(d,h)},!(n.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const l=function(h,p,m){p in h&&!(m in h)&&(h[m]=h[p],delete h[p])},d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(h){return"object"==typeof h&&"object"==typeof h.audio&&(h=JSON.parse(JSON.stringify(h)),l(h.audio,"autoGainControl","mozAutoGainControl"),l(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const p=h.apply(this,arguments);return l(p,"mozAutoGainControl","autoGainControl"),l(p,"mozNoiseSuppression","noiseSuppression"),p}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(p){return"audio"===this.kind&&"object"==typeof p&&(p=JSON.parse(JSON.stringify(p)),l(p,"autoGainControl","mozAutoGainControl"),l(p,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[p])}}}}function U0(s){"object"==typeof s&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function np(s,n){if("object"!=typeof s||!s.RTCPeerConnection&&!s.mozRTCPeerConnection)return;!s.RTCPeerConnection&&s.mozRTCPeerConnection&&(s.RTCPeerConnection=s.mozRTCPeerConnection),n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(l){const d=s.RTCPeerConnection.prototype[l],h={[l](){return arguments[0]=new("addIceCandidate"===l?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};s.RTCPeerConnection.prototype[l]=h[l]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[l,d,h]=arguments;return a.apply(this,[l||null]).then(p=>{if(n.version<53&&!d)try{p.forEach(m=>{m.type=r[m.type]||m.type})}catch(m){if("TypeError"!==m.name)throw m;p.forEach((_,E)=>{p.set(E,Object.assign({},_,{type:r[_.type]||_.type}))})}return p}).then(d,h)}}function qa(s){if("object"!=typeof s||!s.RTCPeerConnection||!s.RTCRtpSender||s.RTCRtpSender&&"getStats"in s.RTCRtpSender.prototype)return;const n=s.RTCPeerConnection.prototype.getSenders;n&&(s.RTCPeerConnection.prototype.getSenders=function(){const a=n.apply(this,[]);return a.forEach(l=>l._pc=this),a});const r=s.RTCPeerConnection.prototype.addTrack;r&&(s.RTCPeerConnection.prototype.addTrack=function(){const a=r.apply(this,arguments);return a._pc=this,a}),s.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function V0(s){if("object"!=typeof s||!s.RTCPeerConnection||!s.RTCRtpSender||s.RTCRtpSender&&"getStats"in s.RTCRtpReceiver.prototype)return;const n=s.RTCPeerConnection.prototype.getReceivers;n&&(s.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(a=>a._pc=this),r}),xo(s,"track",r=>(r.receiver._pc=r.srcElement,r)),s.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Lv(s){s.RTCPeerConnection&&!("removeStream"in s.RTCPeerConnection.prototype)&&(s.RTCPeerConnection.prototype.removeStream=function(n){Pc("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Ln(s){s.DataChannel&&!s.RTCDataChannel&&(s.RTCDataChannel=s.DataChannel)}function Fv(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const n=s.RTCPeerConnection.prototype.addTransceiver;n&&(s.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;void 0===r&&(r=[]),r=[...r];const a=r.length>0;a&&r.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const l=n.apply(this,arguments);if(a){const{sender:d}=l,h=d.getParameters();(!("encodings"in h)||1===h.encodings.length&&0===Object.keys(h.encodings[0]).length)&&(h.encodings=r,d.sendEncodings=r,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return l})}function B0(s){if("object"!=typeof s||!s.RTCRtpSender)return;const n=s.RTCRtpSender.prototype.getParameters;n&&(s.RTCRtpSender.prototype.getParameters=function(){const r=n.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function j0(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const n=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}function H0(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const n=s.RTCPeerConnection.prototype.createAnswer;s.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}var Gt=Object.freeze({__proto__:null,shimAddTransceiver:Fv,shimCreateAnswer:H0,shimCreateOffer:j0,shimGetDisplayMedia:function(s,n){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return!0===r.video?r.video={mediaSource:n}:r.video.mediaSource=n,s.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:B0,shimGetUserMedia:Rm,shimOnTrack:U0,shimPeerConnection:np,shimRTCDataChannel:Ln,shimReceiverGetStats:V0,shimRemoveStream:Lv,shimSenderGetStats:qa});function Uv(s){if("object"==typeof s&&s.RTCPeerConnection){if("getLocalStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in s.RTCPeerConnection.prototype)){const n=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(a=>n.call(this,a,r)),r.getVideoTracks().forEach(a=>n.call(this,a,r))},s.RTCPeerConnection.prototype.addTrack=function(r,...a){return a&&a.forEach(l=>{this._localStreams?this._localStreams.includes(l)||this._localStreams.push(l):this._localStreams=[l]}),n.apply(this,arguments)}}"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(-1===r)return;this._localStreams.splice(r,1);const a=n.getTracks();this.getSenders().forEach(l=>{a.includes(l.track)&&this.removeTrack(l)})})}}function Vv(s){if("object"==typeof s&&s.RTCPeerConnection&&("getRemoteStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in s.RTCPeerConnection.prototype))){Object.defineProperty(s.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(l=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(l))return;this._remoteStreams.push(l);const d=new Event("addstream");d.stream=l,this.dispatchEvent(d)})})}});const n=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(l=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(l)>=0)return;r._remoteStreams.push(l);const d=new Event("addstream");d.stream=l,r.dispatchEvent(d)})}),n.apply(r,arguments)}}}function ti(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const n=s.RTCPeerConnection.prototype,r=n.createOffer,a=n.createAnswer,l=n.setLocalDescription,d=n.setRemoteDescription,h=n.addIceCandidate;n.createOffer=function(m,_){const v=r.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return _?(v.then(m,_),Promise.resolve()):v},n.createAnswer=function(m,_){const v=a.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return _?(v.then(m,_),Promise.resolve()):v};let p=function(m,_,E){const v=l.apply(this,[m]);return E?(v.then(_,E),Promise.resolve()):v};n.setLocalDescription=p,p=function(m,_,E){const v=d.apply(this,[m]);return E?(v.then(_,E),Promise.resolve()):v},n.setRemoteDescription=p,p=function(m,_,E){const v=h.apply(this,[m]);return E?(v.then(_,E),Promise.resolve()):v},n.addIceCandidate=p}function Wn(s){const n=s&&s.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){const r=n.mediaDevices,a=r.getUserMedia.bind(r);n.mediaDevices.getUserMedia=l=>a(G0(l))}!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=function(r,a,l){n.mediaDevices.getUserMedia(r).then(a,l)}.bind(n))}function G0(s){return s&&void 0!==s.video?Object.assign({},s,{video:Zh(s.video)}):s}function dn(s){if(!s.RTCPeerConnection)return;const n=s.RTCPeerConnection;s.RTCPeerConnection=function(r,a){if(r&&r.iceServers){const l=[];for(let d=0;d<r.iceServers.length;d++){let h=r.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(Pc("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,l.push(h)):l.push(r.iceServers[d])}r.iceServers=l}return new n(r,a)},s.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in n&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get:()=>n.generateCertificate})}function Am(s){"object"==typeof s&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function W0(s){const n=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(r){if(r){void 0!==r.offerToReceiveAudio&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const a=this.getTransceivers().find(d=>"audio"===d.receiver.track.kind);!1===r.offerToReceiveAudio&&a?"sendrecv"===a.direction?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":"recvonly"===a.direction&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):!0!==r.offerToReceiveAudio||a||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==r.offerToReceiveVideo&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const l=this.getTransceivers().find(d=>"video"===d.receiver.track.kind);!1===r.offerToReceiveVideo&&l?"sendrecv"===l.direction?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":"recvonly"===l.direction&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):!0!==r.offerToReceiveVideo||l||this.addTransceiver("video",{direction:"recvonly"})}return n.apply(this,arguments)}}function Dm(s){"object"!=typeof s||s.AudioContext||(s.AudioContext=s.webkitAudioContext)}var z0=Object.freeze({__proto__:null,shimAudioContext:Dm,shimCallbacksAPI:ti,shimConstraints:G0,shimCreateOfferLegacy:W0,shimGetUserMedia:Wn,shimLocalStreamsAPI:Uv,shimRTCIceServerUrls:dn,shimRemoteStreamsAPI:Vv,shimTrackEventTransceiver:Am}),eu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cr(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var JP={exports:{}};!function(s){const n={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};n.localCName=n.generateIdentifier(),n.splitLines=function(r){return r.trim().split("\n").map(a=>a.trim())},n.splitSections=function(r){return r.split("\nm=").map((a,l)=>(l>0?"m="+a:a).trim()+"\r\n")},n.getDescription=function(r){const a=n.splitSections(r);return a&&a[0]},n.getMediaSections=function(r){const a=n.splitSections(r);return a.shift(),a},n.matchPrefix=function(r,a){return n.splitLines(r).filter(l=>0===l.indexOf(a))},n.parseCandidate=function(r){let a;a=0===r.indexOf("a=candidate:")?r.substring(12).split(" "):r.substring(10).split(" ");const l={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let d=8;d<a.length;d+=2)switch(a[d]){case"raddr":l.relatedAddress=a[d+1];break;case"rport":l.relatedPort=parseInt(a[d+1],10);break;case"tcptype":l.tcpType=a[d+1];break;case"ufrag":l.ufrag=a[d+1],l.usernameFragment=a[d+1];break;default:void 0===l[a[d]]&&(l[a[d]]=a[d+1])}return l},n.writeCandidate=function(r){const a=[];a.push(r.foundation);const l=r.component;a.push("rtp"===l?1:"rtcp"===l?2:l),a.push(r.protocol.toUpperCase()),a.push(r.priority),a.push(r.address||r.ip),a.push(r.port);const d=r.type;return a.push("typ"),a.push(d),"host"!==d&&r.relatedAddress&&r.relatedPort&&(a.push("raddr"),a.push(r.relatedAddress),a.push("rport"),a.push(r.relatedPort)),r.tcpType&&"tcp"===r.protocol.toLowerCase()&&(a.push("tcptype"),a.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(a.push("ufrag"),a.push(r.usernameFragment||r.ufrag)),"candidate:"+a.join(" ")},n.parseIceOptions=function(r){return r.substring(14).split(" ")},n.parseRtpMap=function(r){let a=r.substring(9).split(" ");const l={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),l.name=a[0],l.clockRate=parseInt(a[1],10),l.channels=3===a.length?parseInt(a[2],10):1,l.numChannels=l.channels,l},n.writeRtpMap=function(r){let a=r.payloadType;void 0!==r.preferredPayloadType&&(a=r.preferredPayloadType);const l=r.channels||r.numChannels||1;return"a=rtpmap:"+a+" "+r.name+"/"+r.clockRate+(1!==l?"/"+l:"")+"\r\n"},n.parseExtmap=function(r){const a=r.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},n.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&"sendrecv"!==r.direction?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+"\r\n"},n.parseFmtp=function(r){const a={};let l;const d=r.substring(r.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)l=d[h].trim().split("="),a[l[0].trim()]=l[1];return a},n.writeFmtp=function(r){let a="",l=r.payloadType;if(void 0!==r.preferredPayloadType&&(l=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const d=[];Object.keys(r.parameters).forEach(h=>{d.push(void 0!==r.parameters[h]?h+"="+r.parameters[h]:h)}),a+="a=fmtp:"+l+" "+d.join(";")+"\r\n"}return a},n.parseRtcpFb=function(r){const a=r.substring(r.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},n.writeRtcpFb=function(r){let a="",l=r.payloadType;return void 0!==r.preferredPayloadType&&(l=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(d=>{a+="a=rtcp-fb:"+l+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+"\r\n"}),a},n.parseSsrcMedia=function(r){const a=r.indexOf(" "),l={ssrc:parseInt(r.substring(7,a),10)},d=r.indexOf(":",a);return d>-1?(l.attribute=r.substring(a+1,d),l.value=r.substring(d+1)):l.attribute=r.substring(a+1),l},n.parseSsrcGroup=function(r){const a=r.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(l=>parseInt(l,10))}},n.getMid=function(r){const a=n.matchPrefix(r,"a=mid:")[0];if(a)return a.substring(6)},n.parseFingerprint=function(r){const a=r.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},n.getDtlsParameters=function(r,a){return{role:"auto",fingerprints:n.matchPrefix(r+a,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(r,a){let l="a=setup:"+a+"\r\n";return r.fingerprints.forEach(d=>{l+="a=fingerprint:"+d.algorithm+" "+d.value+"\r\n"}),l},n.parseCryptoLine=function(r){const a=r.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},n.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+("object"==typeof r.keyParams?n.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+"\r\n"},n.parseCryptoKeyParams=function(r){if(0!==r.indexOf("inline:"))return null;const a=r.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},n.getCryptoParameters=function(r,a){return n.matchPrefix(r+a,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(r,a){const l=n.matchPrefix(r+a,"a=ice-ufrag:")[0],d=n.matchPrefix(r+a,"a=ice-pwd:")[0];return l&&d?{usernameFragment:l.substring(12),password:d.substring(10)}:null},n.writeIceParameters=function(r){let a="a=ice-ufrag:"+r.usernameFragment+"\r\na=ice-pwd:"+r.password+"\r\n";return r.iceLite&&(a+="a=ice-lite\r\n"),a},n.parseRtpParameters=function(r){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=n.splitLines(r)[0].split(" ");a.profile=l[2];for(let h=3;h<l.length;h++){const p=l[h],m=n.matchPrefix(r,"a=rtpmap:"+p+" ")[0];if(m){const _=n.parseRtpMap(m),E=n.matchPrefix(r,"a=fmtp:"+p+" ");switch(_.parameters=E.length?n.parseFmtp(E[0]):{},_.rtcpFeedback=n.matchPrefix(r,"a=rtcp-fb:"+p+" ").map(n.parseRtcpFb),a.codecs.push(_),_.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(_.name.toUpperCase())}}}n.matchPrefix(r,"a=extmap:").forEach(h=>{a.headerExtensions.push(n.parseExtmap(h))});const d=n.matchPrefix(r,"a=rtcp-fb:* ").map(n.parseRtcpFb);return a.codecs.forEach(h=>{d.forEach(p=>{h.rtcpFeedback.find(m=>m.type===p.type&&m.parameter===p.parameter)||h.rtcpFeedback.push(p)})}),a},n.writeRtpDescription=function(r,a){let l="";l+="m="+r+" ",l+=a.codecs.length>0?"9":"0",l+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",l+=a.codecs.map(h=>void 0!==h.preferredPayloadType?h.preferredPayloadType:h.payloadType).join(" ")+"\r\n",l+="c=IN IP4 0.0.0.0\r\n",l+="a=rtcp:9 IN IP4 0.0.0.0\r\n",a.codecs.forEach(h=>{l+=n.writeRtpMap(h),l+=n.writeFmtp(h),l+=n.writeRtcpFb(h)});let d=0;return a.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(l+="a=maxptime:"+d+"\r\n"),a.headerExtensions&&a.headerExtensions.forEach(h=>{l+=n.writeExtmap(h)}),l},n.parseRtpEncodingParameters=function(r){const a=[],l=n.parseRtpParameters(r),d=-1!==l.fecMechanisms.indexOf("RED"),h=-1!==l.fecMechanisms.indexOf("ULPFEC"),p=n.matchPrefix(r,"a=ssrc:").map(b=>n.parseSsrcMedia(b)).filter(b=>"cname"===b.attribute),m=p.length>0&&p[0].ssrc;let _;const E=n.matchPrefix(r,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(T=>parseInt(T,10)));E.length>0&&E[0].length>1&&E[0][0]===m&&(_=E[0][1]),l.codecs.forEach(b=>{if("RTX"===b.name.toUpperCase()&&b.parameters.apt){let T={ssrc:m,codecPayloadType:parseInt(b.parameters.apt,10)};m&&_&&(T.rtx={ssrc:_}),a.push(T),d&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:m,mechanism:h?"red+ulpfec":"red"},a.push(T))}}),0===a.length&&m&&a.push({ssrc:m});let v=n.matchPrefix(r,"b=");return v.length&&(v=0===v[0].indexOf("b=TIAS:")?parseInt(v[0].substring(7),10):0===v[0].indexOf("b=AS:")?1e3*parseInt(v[0].substring(5),10)*.95-16e3:void 0,a.forEach(b=>{b.maxBitrate=v})),a},n.parseRtcpParameters=function(r){const a={},l=n.matchPrefix(r,"a=ssrc:").map(p=>n.parseSsrcMedia(p)).filter(p=>"cname"===p.attribute)[0];l&&(a.cname=l.value,a.ssrc=l.ssrc);const d=n.matchPrefix(r,"a=rtcp-rsize");a.reducedSize=d.length>0,a.compound=0===d.length;const h=n.matchPrefix(r,"a=rtcp-mux");return a.mux=h.length>0,a},n.writeRtcpParameters=function(r){let a="";return r.reducedSize&&(a+="a=rtcp-rsize\r\n"),r.mux&&(a+="a=rtcp-mux\r\n"),void 0!==r.ssrc&&r.cname&&(a+="a=ssrc:"+r.ssrc+" cname:"+r.cname+"\r\n"),a},n.parseMsid=function(r){let a;const l=n.matchPrefix(r,"a=msid:");if(1===l.length)return a=l[0].substring(7).split(" "),{stream:a[0],track:a[1]};const d=n.matchPrefix(r,"a=ssrc:").map(h=>n.parseSsrcMedia(h)).filter(h=>"msid"===h.attribute);return d.length>0?(a=d[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},n.parseSctpDescription=function(r){const a=n.parseMLine(r),l=n.matchPrefix(r,"a=max-message-size:");let d;l.length>0&&(d=parseInt(l[0].substring(19),10)),isNaN(d)&&(d=65536);const h=n.matchPrefix(r,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:d};const p=n.matchPrefix(r,"a=sctpmap:");if(p.length>0){const m=p[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:d}}},n.writeSctpDescription=function(r,a){let l=[];return l="DTLS/SCTP"!==r.protocol?["m="+r.kind+" 9 "+r.protocol+" "+a.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+a.port+"\r\n"]:["m="+r.kind+" 9 "+r.protocol+" "+a.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+a.port+" "+a.protocol+" 65535\r\n"],void 0!==a.maxMessageSize&&l.push("a=max-message-size:"+a.maxMessageSize+"\r\n"),l.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,22)},n.writeSessionBoilerplate=function(r,a,l){let d;const h=void 0!==a?a:2;return d=r||n.generateSessionId(),"v=0\r\no="+(l||"thisisadapterortc")+" "+d+" "+h+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.getDirection=function(r,a){const l=n.splitLines(r);for(let d=0;d<l.length;d++)switch(l[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return l[d].substring(2)}return a?n.getDirection(a):"sendrecv"},n.getKind=function(r){return n.splitLines(r)[0].split(" ")[0].substring(2)},n.isRejected=function(r){return"0"===r.split(" ",2)[1]},n.parseMLine=function(r){const a=n.splitLines(r)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},n.parseOLine=function(r){const a=n.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},n.isValidSDP=function(r){if("string"!=typeof r||0===r.length)return!1;const a=n.splitLines(r);for(let l=0;l<a.length;l++)if(a[l].length<2||"="!==a[l].charAt(1))return!1;return!0},s.exports=n}(JP);var QP=JP.exports,ip=cr(QP),bU=function Dc(s,n){return n.forEach(function(r){r&&"string"!=typeof r&&!Array.isArray(r)&&Object.keys(r).forEach(function(a){if("default"!==a&&!(a in s)){var l=Object.getOwnPropertyDescriptor(r,a);Object.defineProperty(s,a,l.get?l:{enumerable:!0,get:function(){return r[a]}})}})}),Object.freeze(s)}({__proto__:null,default:ip},[QP]);function Om(s){if(!s.RTCIceCandidate||s.RTCIceCandidate&&"foundation"in s.RTCIceCandidate.prototype)return;const n=s.RTCIceCandidate;s.RTCIceCandidate=function(r){if("object"==typeof r&&r.candidate&&0===r.candidate.indexOf("a=")&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const a=new n(r),l=ip.parseCandidate(r.candidate),d=Object.assign(a,l);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new n(r)},s.RTCIceCandidate.prototype=n.prototype,xo(s,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new s.RTCIceCandidate(r.candidate),writable:"false"}),r))}function Nm(s){!s.RTCIceCandidate||s.RTCIceCandidate&&"relayProtocol"in s.RTCIceCandidate.prototype||xo(s,"icecandidate",n=>{if(n.candidate){const r=ip.parseCandidate(n.candidate.candidate);"relay"===r.type&&(n.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return n})}function Pm(s,n){if(!s.RTCPeerConnection)return;"sctp"in s.RTCPeerConnection.prototype||Object.defineProperty(s.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const h=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===n.browser&&n.version>=76){const{sdpSemantics:p}=this.getConfiguration();"plan-b"===p&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(p){if(!p||!p.sdp)return!1;const m=ip.splitSections(p.sdp);return m.shift(),m.some(_=>{const E=ip.parseMLine(_);return E&&"application"===E.kind&&-1!==E.protocol.indexOf("SCTP")})}(arguments[0])){const p=function(p){const m=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===m||m.length<2)return-1;const _=parseInt(m[1],10);return _!=_?-1:_}(arguments[0]),m=function(p){let m=65536;return"firefox"===n.browser&&(m=n.version<57?-1===p?16384:2147483637:n.version<60?57===n.version?65535:65536:2147483637),m}(p),_=function(p,m){let _=65536;"firefox"===n.browser&&57===n.version&&(_=65535);const E=ip.matchPrefix(p.sdp,"a=max-message-size:");return E.length>0?_=parseInt(E[0].substr(19),10):"firefox"===n.browser&&-1!==m&&(_=2147483637),_}(arguments[0],p);let E;E=0===m&&0===_?Number.POSITIVE_INFINITY:0===m||0===_?Math.max(m,_):Math.min(m,_);const v={};Object.defineProperty(v,"maxMessageSize",{get:()=>E}),this._sctp=v}return h.apply(this,arguments)}}function tu(s){if(!s.RTCPeerConnection||!("createDataChannel"in s.RTCPeerConnection.prototype))return;function n(a,l){const d=a.send;a.send=function(){const h=arguments[0];if("open"===a.readyState&&l.sctp&&(h.length||h.size||h.byteLength)>l.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+l.sctp.maxMessageSize+" bytes)");return d.apply(a,arguments)}}const r=s.RTCPeerConnection.prototype.createDataChannel;s.RTCPeerConnection.prototype.createDataChannel=function(){const a=r.apply(this,arguments);return n(a,this),a},xo(s,"datachannel",a=>(n(a.channel,a.target),a))}function Bv(s){if(!s.RTCPeerConnection||"connectionState"in s.RTCPeerConnection.prototype)return;const n=s.RTCPeerConnection.prototype;Object.defineProperty(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const a=n[r];n[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=l=>{const d=l.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",l);d.dispatchEvent(h)}return l},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function rp(s,n){if(!s.RTCPeerConnection||"chrome"===n.browser&&n.version>=71||"safari"===n.browser&&n.version>=605)return;const r=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&-1!==a.sdp.indexOf("\na=extmap-allow-mixed")){const l=a.sdp.split("\n").filter(d=>"a=extmap-allow-mixed"!==d.trim()).join("\n");s.RTCSessionDescription&&a instanceof s.RTCSessionDescription?arguments[0]=new s.RTCSessionDescription({type:a.type,sdp:l}):a.sdp=l}return r.apply(this,arguments)}}function op(s,n){if(!s.RTCPeerConnection||!s.RTCPeerConnection.prototype)return;const r=s.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===n.browser&&n.version<78||"firefox"===n.browser&&n.version<68||"safari"===n.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Mm(s,n){if(!s.RTCPeerConnection||!s.RTCPeerConnection.prototype)return;const r=s.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(s.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if("object"!=typeof a||a.type&&a.sdp)return r.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||"offer"!==a.type&&"answer"!==a.type?r.apply(this,[a]):("offer"===a.type?this.createOffer:this.createAnswer).apply(this).then(l=>r.apply(this,[l]))})}var ZP=Object.freeze({__proto__:null,removeExtmapAllowMixed:rp,shimAddIceCandidateNullOrEmpty:op,shimConnectionState:Bv,shimMaxMessageSize:Pm,shimParameterlessSetLocalDescription:Mm,shimRTCIceCandidate:Om,shimRTCIceCandidateRelayProtocol:Nm,shimSendThrowTypeError:tu});!function({window:s}={},n={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=Br,a=function(d){const h={browser:null,version:null};if(void 0===d||!d.navigator)return h.browser="Not a browser.",h;const{navigator:p}=d;if(p.mozGetUserMedia)h.browser="firefox",h.version=Dn(p.userAgent,/Firefox\/(\d+)\./,1);else if(p.webkitGetUserMedia||!1===d.isSecureContext&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=Dn(p.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!p.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=Dn(p.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(s),l={browserDetails:a,commonShim:ZP,extractVersion:Dn,disableLog:Oc,disableWarnings:Nc,sdp:bU};switch(a.browser){case"chrome":if(!F0||!Vl||!n.shimChrome)return r("Chrome shim is not included in this adapter release."),l;if(null===a.version)return r("Chrome shim can not determine version, not shimming."),l;r("adapter.js shimming chrome."),l.browserShim=F0,op(s,a),Mm(s),Tm(s,a),Mc(s),Vl(s,a),ep(s),L0(s,a),x0(s),wm(s),k0(s),tp(s,a),Om(s),Nm(s),Bv(s),Pm(s,a),tu(s),rp(s,a);break;case"firefox":if(!Gt||!np||!n.shimFirefox)return r("Firefox shim is not included in this adapter release."),l;r("adapter.js shimming firefox."),l.browserShim=Gt,op(s,a),Mm(s),Rm(s,a),np(s,a),U0(s),Lv(s),qa(s),V0(s),Ln(s),Fv(s),B0(s),j0(s),H0(s),Om(s),Bv(s),Pm(s,a),tu(s);break;case"safari":if(!z0||!n.shimSafari)return r("Safari shim is not included in this adapter release."),l;r("adapter.js shimming safari."),l.browserShim=z0,op(s,a),Mm(s),dn(s),W0(s),ti(s),Uv(s),Vv(s),Am(s),Wn(s),Dm(s),Om(s),Nm(s),Pm(s,a),tu(s),rp(s,a);break;default:r("Unsupported browser!")}}({window:typeof window>"u"?void 0:window});var pi=function(s){try{return!!s()}catch{return!0}},Ms=!pi(function(){var s=function(){}.bind();return"function"!=typeof s||s.hasOwnProperty("prototype")}),jv=Ms,q0=Function.prototype,xm=q0.call,e1=jv&&q0.bind.bind(xm,xm),ni=jv?e1:function(s){return function(){return xm.apply(s,arguments)}},xs=ni({}.isPrototypeOf),km=function(s){return s&&s.Math==Math&&s},Zi=km("object"==typeof globalThis&&globalThis)||km("object"==typeof window&&window)||km("object"==typeof self&&self)||km("object"==typeof eu&&eu)||function(){return this}()||eu||Function("return this")(),K0=Function.prototype,Y0=K0.apply,$0=K0.call,Hv="object"==typeof Reflect&&Reflect.apply||(Ms?$0.bind(Y0):function(){return $0.apply(Y0,arguments)}),n1=ni,Gv=n1({}.toString),X0=n1("".slice),Ka=function(s){return X0(Gv(s),8,-1)},J0=Ka,Q0=ni,Wv=function(s){if("Function"===J0(s))return Q0(s)},Lm="object"==typeof document&&document.all,sp={all:Lm,IS_HTMLDDA:void 0===Lm&&void 0!==Lm},Z0=sp.all,yi=sp.IS_HTMLDDA?function(s){return"function"==typeof s||s===Z0}:function(s){return"function"==typeof s},xi={},ha=!pi(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),Fm=Function.prototype.call,Ir=Ms?Fm.bind(Fm):function(){return Fm.apply(Fm,arguments)},Um={},ew={}.propertyIsEnumerable,tw=Object.getOwnPropertyDescriptor,Ya=tw&&!ew.call({1:2},1);Um.f=Ya?function(s){var n=tw(this,s);return!!n&&n.enumerable}:ew;var xc,fi,us=function(s,n){return{enumerable:!(1&s),configurable:!(2&s),writable:!(4&s),value:n}},ks=pi,SU=Ka,zv=Object,nw=ni("".split),ap=ks(function(){return!zv("z").propertyIsEnumerable(0)})?function(s){return"String"==SU(s)?nw(s,""):zv(s)}:zv,cp=function(s){return null==s},lp=cp,o1=TypeError,nu=function(s){if(lp(s))throw o1("Can't call method on "+s);return s},iw=ap,s1=nu,Bl=function(s){return iw(s1(s))},rw=yi,a1=sp.all,ko=sp.IS_HTMLDDA?function(s){return"object"==typeof s?null!==s:rw(s)||s===a1}:function(s){return"object"==typeof s?null!==s:rw(s)},jl={},qv=jl,ki=Zi,Kv=yi,Rr=function(s){return Kv(s)?s:void 0},He=function(s,n){return arguments.length<2?Rr(qv[s])||Rr(ki[s]):qv[s]&&qv[s][n]||ki[s]&&ki[s][n]},$a=typeof navigator<"u"&&String(navigator.userAgent)||"",Lo=$a,Yv=Zi.process,ow=Zi.Deno,_n=Yv&&Yv.versions||ow&&ow.version,dp=_n&&_n.v8;dp&&(fi=(xc=dp.split("."))[0]>0&&xc[0]<4?1:+(xc[0]+xc[1])),!fi&&Lo&&(!(xc=Lo.match(/Edge\/(\d+)/))||xc[1]>=74)&&(xc=Lo.match(/Chrome\/(\d+)/))&&(fi=+xc[1]);var zn=fi,Bm=zn,Cn=Zi.String,nt=!!Object.getOwnPropertySymbols&&!pi(function(){var s=Symbol();return!Cn(s)||!(Object(s)instanceof Symbol)||!Symbol.sham&&Bm&&Bm<41}),jm=nt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,$v=He,CU=yi,sw=xs,ue=Object,kc=jm?function(s){return"symbol"==typeof s}:function(s){var n=$v("Symbol");return CU(n)&&sw(n.prototype,ue(s))},_t=String,Wt=function(s){try{return _t(s)}catch{return"Object"}},l1=yi,TU=Wt,d1=TypeError,oo=function(s){if(l1(s))return s;throw d1(TU(s)+" is not a function")},Fo=oo,wU=cp,Xv=function(s,n){var r=s[n];return wU(r)?void 0:Fo(r)},aw=Ir,Xa=yi,cw=ko,IU=TypeError,u1={exports:{}},h1=Zi,p1=Object.defineProperty,lw="__core-js_shared__",dw=Zi[lw]||function(s,n){try{p1(h1,s,{value:n,configurable:!0,writable:!0})}catch{h1[s]=n}return n}(lw,{}),Uo=dw;(u1.exports=function(s,n){return Uo[s]||(Uo[s]=void 0!==n?n:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var tt=u1.exports,AU=nu,DU=Object,iu=function(s){return DU(AU(s))},Me=iu,OU=ni({}.hasOwnProperty),St=Object.hasOwn||function(s,n){return OU(Me(s),n)},Hm=ni,f1=0,uw=Math.random(),m1=Hm(1..toString),ru=function(s){return"Symbol("+(void 0===s?"":s)+")_"+m1(++f1+uw,36)},Wm=St,hw=ru,_1=nt,Ft=jm,Lc=Zi.Symbol,zm=tt("wks"),so=Ft?Lc.for||Lc:Lc&&Lc.withoutSetter||hw,qn=function(s){return Wm(zm,s)||(zm[s]=_1&&Wm(Lc,s)?Lc[s]:so("Symbol."+s)),zm[s]},NU=Ir,On=ko,g1=kc,PU=Xv,Qv=TypeError,pw=qn("toPrimitive"),Zv=function(s,n){if(!On(s)||g1(s))return s;var r,a=PU(s,pw);if(a){if(void 0===n&&(n="default"),r=NU(a,s,n),!On(r)||g1(r))return r;throw Qv("Can't convert object to primitive value")}return void 0===n&&(n="number"),function(s,n){var r,a;if("string"===n&&Xa(r=s.toString)&&!cw(a=aw(r,s))||Xa(r=s.valueOf)&&!cw(a=aw(r,s))||"string"!==n&&Xa(r=s.toString)&&!cw(a=aw(r,s)))return a;throw IU("Can't convert object to primitive value")}(s,n)},E1=kc,ou=function(s){var n=Zv(s,"string");return E1(n)?n:n+""},v1=ko,fw=Zi.document,MU=v1(fw)&&v1(fw.createElement),mw=function(s){return MU?fw.createElement(s):{}},xU=mw,su=!ha&&!pi(function(){return 7!=Object.defineProperty(xU("div"),"a",{get:function(){return 7}}).a}),qm=Ir,y1=Um,b1=us,S1=Bl,_w=ou,au=St,C1=su,Ja=Object.getOwnPropertyDescriptor;xi.f=ha?Ja:function(s,n){if(s=S1(s),n=_w(n),C1)try{return Ja(s,n)}catch{}if(au(s,n))return b1(!qm(y1.f,s,n),s[n])};var T1=pi,pe=yi,gw=/#|\.prototype\./,Oe=function(s,n){var r=ty[Km(s)];return r==w1||r!=up&&(pe(n)?T1(n):!!n)},Km=Oe.normalize=function(s){return String(s).replace(gw,".").toLowerCase()},ty=Oe.data={},up=Oe.NATIVE="N",w1=Oe.POLYFILL="P",Ew=Oe,I1=oo,Qa=Ms,Ym=Wv(Wv.bind),Ar=function(s,n){return I1(s),void 0===n?s:Qa?Ym(s,n):function(){return s.apply(n,arguments)}},bi={},Zt=ha&&pi(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),$m=ko,ny=String,iy=TypeError,hs=function(s){if($m(s))return s;throw iy(ny(s)+" is not an object")},hp=su,pp=hs,Xm=ou,yw=TypeError,Jm=Object.defineProperty,fp=Object.getOwnPropertyDescriptor,Qm="enumerable",Zm="configurable",ry="writable";bi.f=ha?Zt?function(s,n,r){if(pp(s),n=Xm(n),pp(r),"function"==typeof s&&"prototype"===n&&"value"in r&&ry in r&&!r[ry]){var a=fp(s,n);a&&a[ry]&&(s[n]=r.value,r={configurable:Zm in r?r[Zm]:a[Zm],enumerable:Qm in r?r[Qm]:a[Qm],writable:!1})}return Jm(s,n,r)}:Jm:function(s,n,r){if(pp(s),n=Xm(n),pp(r),hp)try{return Jm(s,n,r)}catch{}if("get"in r||"set"in r)throw yw("Accessors not supported");return"value"in r&&(s[n]=r.value),s};var bw=bi,R1=us,Fc=ha?function(s,n,r){return bw.f(s,n,R1(1,r))}:function(s,n,r){return s[n]=r,s},ao=Zi,A1=Hv,Sw=Wv,D1=yi,O1=xi.f,N1=Ew,cu=jl,Cw=Ar,lu=Fc,Tw=St,P1=function(s){var n=function(r,a,l){if(this instanceof n){switch(arguments.length){case 0:return new s;case 1:return new s(r);case 2:return new s(r,a)}return new s(r,a,l)}return A1(s,this,arguments)};return n.prototype=s.prototype,n},Ct=function(s,n){var r,a,l,d,h,p,m,_,E,v=s.target,b=s.global,T=s.stat,O=s.proto,P=b?ao:T?ao[v]:(ao[v]||{}).prototype,D=b?cu:cu[v]||lu(cu,v,{})[v],L=D.prototype;for(d in n)a=!(r=N1(b?d:v+(T?".":"#")+d,s.forced))&&P&&Tw(P,d),p=D[d],a&&(m=s.dontCallGetSet?(E=O1(P,d))&&E.value:P[d]),h=a&&m?m:n[d],a&&typeof p==typeof h||(_=s.bind&&a?Cw(h,ao):s.wrap&&a?P1(h):O&&D1(h)?Sw(h):h,(s.sham||h&&h.sham||p&&p.sham)&&lu(_,"sham",!0),lu(D,d,_),O&&(Tw(cu,l=v+"Prototype")||lu(cu,l,{}),lu(cu[l],d,h),s.real&&L&&(r||!L[d])&&lu(L,d,h)))},M1=Math.ceil,x1=Math.floor,k1=Math.trunc||function(s){var n=+s;return(n>0?x1:M1)(n)},yn=function(s){var n=+s;return n!=n||0===n?0:k1(n)},L1=yn,ww=Math.max,Ge=Math.min,jr=function(s,n){var r=L1(s);return r<0?ww(r+n,0):Ge(r,n)},$t=yn,lr=Math.min,ps=function(s){return function(s){return s>0?lr($t(s),9007199254740991):0}(s.length)},Vo=Bl,Iw=jr,Rw=ps,mp=function(s){return function(n,r,a){var l,d=Vo(n),h=Rw(d),p=Iw(a,h);if(s&&r!=r){for(;h>p;)if((l=d[p++])!=l)return!0}else for(;h>p;p++)if((s||p in d)&&d[p]===r)return s||p||0;return!s&&-1}},Aw={includes:mp(!0),indexOf:mp(!1)},F1=Aw.includes;Ct({target:"Array",proto:!0,forced:pi(function(){return!Array(1).includes()})},{includes:function(s){return F1(this,s,arguments.length>1?arguments[1]:void 0)}});var mi=jl,ke=function(s){return mi[s+"Prototype"]},Tt=ke("Array").includes,Qn=ko,Ls=Ka,_p=qn("match"),du=TypeError,_i={};_i[qn("toStringTag")]="z";var pa="[object z]"===String(_i),uu=pa,gt=yi,Uc=Ka,Dw=qn("toStringTag"),hu=Object,Si="Arguments"==Uc(function(){return arguments}()),Fs=uu?Uc:function(s){var n,r,a;return void 0===s?"Undefined":null===s?"Null":"string"==typeof(r=function(l,d){try{return l[d]}catch{}}(n=hu(s),Dw))?r:Si?Uc(n):"Object"==(a=Uc(n))&&gt(n.callee)?"Arguments":a},pu=Fs,fa=String,Bo=function(s){if("Symbol"===pu(s))throw TypeError("Cannot convert a Symbol value to a string");return fa(s)},Ow=qn("match"),Vc=Ct,ec=function(s){if(function(s){var n;return Qn(s)&&(void 0!==(n=s[_p])?!!n:"RegExp"==Ls(s))}(s))throw du("The method doesn't accept regular expressions");return s},gp=nu,fu=Bo,kU=ni("".indexOf);Vc({target:"String",proto:!0,forced:!function(s){var n=/./;try{"/./"[s](n)}catch{try{return n[Ow]=!1,"/./"[s](n)}catch{}}return!1}("includes")},{includes:function(s){return!!~kU(fu(gp(this)),fu(ec(s)),arguments.length>1?arguments[1]:void 0)}});var oy=ke("String").includes,sy=xs,ma=Tt,e_=oy,Bc=Array.prototype,Hl=String.prototype,ye=cr(function(s){var n=s.includes;return s===Bc||sy(Bc,s)&&n===Bc.includes?ma:"string"==typeof s||s===Hl||sy(Hl,s)&&n===Hl.includes?e_:n}),U1={exports:{}},t_=bi.f;Ct({target:"Object",stat:!0,forced:Object.defineProperty!==t_,sham:!ha},{defineProperty:t_});var jc=jl.Object,n_=U1.exports=function(s,n,r){return jc.defineProperty(s,n,r)};jc.defineProperty.sham&&(n_.sham=!0);var Us=cr(U1.exports),ay=Ka,cy=Array.isArray||function(s){return"Array"==ay(s)},V1=TypeError,LU=ou,B1=bi,j1=us,H1=function(s,n,r){var a=LU(n);a in s?B1.f(s,a,j1(0,r)):s[a]=r},FU=yi,Nw=dw,UU=ni(Function.toString);FU(Nw.inspectSource)||(Nw.inspectSource=function(s){return UU(s)});var G1=Nw.inspectSource,VU=ni,BU=pi,W1=yi,jU=Fs,HU=G1,z1=function(){},GU=[],ly=He("Reflect","construct"),i_=/^\s*(?:class|function)\b/,WU=VU(i_.exec),zU=!i_.exec(z1),r_=function(s){if(!W1(s))return!1;try{return ly(z1,GU,s),!0}catch{return!1}},Hc=function(s){if(!W1(s))return!1;switch(jU(s)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return zU||!!WU(i_,HU(s))}catch{return!0}};Hc.sham=!0;var tc=!ly||BU(function(){var s;return r_(r_.call)||!r_(Object)||!r_(function(){s=!0})||s})?Hc:r_,q1=cy,qU=tc,dr=ko,o_=qn("species"),jo=Array,dy=function(s,n){return new(function(s){var n;return q1(s)&&(qU(n=s.constructor)&&(n===jo||q1(n.prototype))||dr(n)&&null===(n=n[o_]))&&(n=void 0),void 0===n?jo:n}(s))(0===n?0:n)},Mw=pi,xw=zn,uy=qn("species"),kw=Ct,hy=pi,py=cy,Lw=ko,Fw=iu,Uw=ps,Ep=function(s){if(s>9007199254740991)throw V1("Maximum allowed index exceeded");return s},mu=H1,_u=dy,KU=zn,K1=qn("isConcatSpreadable"),YU=KU>=51||!hy(function(){var s=[];return s[K1]=!1,s.concat()[0]!==s}),Y1=function(s){if(!Lw(s))return!1;var n=s[K1];return void 0!==n?!!n:py(s)};kw({target:"Array",proto:!0,arity:1,forced:!YU||!function(s){return xw>=51||!Mw(function(){var n=[];return(n.constructor={})[uy]=function(){return{foo:1}},1!==n[s](Boolean).foo})}("concat")},{concat:function(s){var n,r,a,l,d,h=Fw(this),p=_u(h,0),m=0;for(n=-1,a=arguments.length;n<a;n++)if(Y1(d=-1===n?h:arguments[n]))for(l=Uw(d),Ep(m+l),r=0;r<l;r++,m++)r in d&&mu(p,m,d[r]);else Ep(m+1),mu(p,m++,d);return p.length=m,p}});var fy={},my={},s_=St,_y=Bl,$1=Aw.indexOf,gy=my,X1=ni([].push),J1=function(s,n){var r,a=_y(s),l=0,d=[];for(r in a)!s_(gy,r)&&s_(a,r)&&X1(d,r);for(;n.length>l;)s_(a,r=n[l++])&&(~$1(d,r)||X1(d,r));return d},Ey=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Bw=J1,jw=Ey,Hw=Object.keys||function(s){return Bw(s,jw)},Gw=bi,eM=hs,Ww=Bl,tM=Hw;fy.f=ha&&!Zt?Object.defineProperties:function(s,n){eM(s);for(var r,a=Ww(n),l=tM(n),d=l.length,h=0;d>h;)Gw.f(s,r=l[h++],a[r]);return s};var vy,zw=He("document","documentElement"),Ho=ru,yy=tt("keys"),a_=function(s){return yy[s]||(yy[s]=Ho(s))},nM=hs,qw=fy,by=Ey,iM=my,Sy=zw,rM=mw,fs="prototype",c_="script",Cy=a_("IE_PROTO"),Tn=function(){},l_=function(s){return"<script>"+s+"</"+c_+">"},vp=function(s){s.write(l_("")),s.close();var n=s.parentWindow.Object;return s=null,n},ur=function(){try{vy=new ActiveXObject("htmlfile")}catch{}var s,n;ur=typeof document<"u"?document.domain&&vy?vp(vy):("javascript:",(n=rM("iframe")).style.display="none",Sy.appendChild(n),n.src=String("javascript:"),(s=n.contentWindow.document).open(),s.write(l_("document.F=Object")),s.close(),s.F):vp(vy);for(var a=by.length;a--;)delete ur[fs][by[a]];return ur()};iM[Cy]=!0;var d_=Object.create||function(s,n){var r;return null!==s?(Tn[fs]=nM(s),r=new Tn,Tn[fs]=null,r[Cy]=s):r=ur(),void 0===n?r:qw.f(r,n)},yp={},gu=J1,Go=Ey.concat("length","prototype");yp.f=Object.getOwnPropertyNames||function(s){return gu(s,Go)};var Kw={},Yw=jr,oM=ps,Gc=H1,$w=Array,sM=Math.max,Ty=function(s,n,r){for(var a=oM(s),l=Yw(n,a),d=Yw(void 0===r?a:r,a),h=$w(sM(d-l,0)),p=0;l<d;l++,p++)Gc(h,p,s[l]);return h.length=p,h},Xw=Ka,Jw=Bl,Qw=yp.f,ct=Ty,wy="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Kw.f=function(s){return wy&&"Window"==Xw(s)?function(n){try{return Qw(n)}catch{return ct(wy)}}(s):Qw(Jw(s))};var Iy={};Iy.f=Object.getOwnPropertySymbols;var aM=Fc,bp=function(s,n,r,a){return a&&a.enumerable?s[n]=r:aM(s,n,r),s},cM=bi,Ry=function(s,n,r){return cM.f(s,n,r)},Vs={};Vs.f=qn;var u_,Sp,h_,Zw=jl,be=St,Xt=Vs,_a=bi.f,un=function(s){var n=Zw.Symbol||(Zw.Symbol={});be(n,s)||_a(n,s,{value:Xt.f(s)})},hr=Ir,eI=He,Cp=qn,ga=bp,p_=function(){var s=eI("Symbol"),n=s&&s.prototype,r=n&&n.valueOf,a=Cp("toPrimitive");n&&!n[a]&&ga(n,a,function(l){return hr(r,this)},{arity:1})},Ay=Fs,$U=pa,tI=bi.f,Wr=Fc,nc=St,nI=pa?{}.toString:function(){return"[object "+Ay(this)+"]"},Gl=qn("toStringTag"),lo=function(s,n,r,a){if(s){var l=r?s:s.prototype;nc(l,Gl)||tI(l,Gl,{configurable:!0,value:n}),a&&!$U&&Wr(l,"toString",nI)}},Dy=Zi.WeakMap,hM=yi(Dy)&&/native code/.test(String(Dy)),Oy=ko,Ny=Fc,f_=St,pM=a_,rI=my,m_="Object already initialized",__=Zi.TypeError;if(hM||dw.state){var Bs=dw.state||(dw.state=new(0,Zi.WeakMap));Bs.get=Bs.get,Bs.has=Bs.has,Bs.set=Bs.set,u_=function(s,n){if(Bs.has(s))throw __(m_);return n.facade=s,Bs.set(s,n),n},Sp=function(s){return Bs.get(s)||{}},h_=function(s){return Bs.has(s)}}else{var Wl=pM("state");rI[Wl]=!0,u_=function(s,n){if(f_(s,Wl))throw __(m_);return n.facade=s,Ny(s,Wl,n),n},Sp=function(s){return f_(s,Wl)?s[Wl]:{}},h_=function(s){return f_(s,Wl)}}var Eu={set:u_,get:Sp,has:h_,enforce:function(s){return h_(s)?Sp(s):u_(s,{})},getterFor:function(s){return function(n){var r;if(!Oy(n)||(r=Sp(n)).type!==s)throw __("Incompatible receiver, "+s+" required");return r}}},fM=Ar,mM=ap,zr=iu,zl=ps,ii=dy,Wo=ni([].push),Wc=function(s){var n=1==s,r=2==s,a=3==s,l=4==s,d=6==s,h=7==s,p=5==s||d;return function(m,_,E,v){for(var b,T,O=zr(m),P=mM(O),D=fM(_,E),L=zl(P),V=0,U=v||ii,J=n?U(m,L):r||h?U(m,0):void 0;L>V;V++)if((p||V in P)&&(T=D(b=P[V],V,O),s))if(n)J[V]=T;else if(T)switch(s){case 3:return!0;case 5:return b;case 6:return V;case 2:Wo(J,b)}else switch(s){case 4:return!1;case 7:Wo(J,b)}return d?-1:a||l?l:J}},ic={forEach:Wc(0),map:Wc(1),filter:Wc(2),some:Wc(3),every:Wc(4),find:Wc(5),findIndex:Wc(6),filterReject:Wc(7)},g_=Ct,E_=Zi,v_=Ir,y_=ni,zo=ha,vu=nt,b_=pi,Ci=St,S_=xs,wp=hs,Ip=Bl,C_=ou,_M=Bo,zc=us,rc=d_,sI=Hw,XU=yp,T_=Kw,JU=Iy,aI=xi,cI=bi,QU=fy,gM=Um,w_=bp,Rp=Ry,Py=tt,yu=my,I_=ru,R_=qn,ZU=Vs,lI=un,dI=p_,EM=lo,js=Eu,A_=ic.forEach,pr=a_("hidden"),bu="Symbol",Su="prototype",D_=js.set,O_=js.getterFor(bu),Hs=Object[Su],qc=E_.Symbol,Ap=qc&&qc[Su],uI=E_.TypeError,N_=E_.QObject,hI=aI.f,Ea=cI.f,Kc=T_.f,vM=gM.f,My=y_([].push),va=Py("symbols"),oc=Py("op-symbols"),yM=Py("wks"),fr=!N_||!N_[Su]||!N_[Su].findChild,xy=zo&&b_(function(){return 7!=rc(Ea({},"a",{get:function(){return Ea(this,"a",{value:7}).a}})).a})?function(s,n,r){var a=hI(Hs,n);a&&delete Hs[n],Ea(s,n,r),a&&s!==Hs&&Ea(Hs,n,a)}:Ea,Ti=function(s,n){var r=va[s]=rc(Ap);return D_(r,{type:bu,tag:s,description:n}),zo||(r.description=n),r},Cu=function(s,n,r){s===Hs&&Cu(oc,n,r),wp(s);var a=C_(n);return wp(r),Ci(va,a)?(r.enumerable?(Ci(s,pr)&&s[pr][a]&&(s[pr][a]=!1),r=rc(r,{enumerable:zc(0,!1)})):(Ci(s,pr)||Ea(s,pr,zc(1,{})),s[pr][a]=!0),xy(s,a,r)):Ea(s,a,r)},ky=function(s,n){wp(s);var r=Ip(n),a=sI(r).concat(Kl(r));return A_(a,function(l){zo&&!v_(Ly,r,l)||Cu(s,l,r[l])}),s},Ly=function(s){var n=C_(s),r=v_(vM,this,n);return!(this===Hs&&Ci(va,n)&&!Ci(oc,n))&&(!(r||!Ci(this,n)||!Ci(va,n)||Ci(this,pr)&&this[pr][n])||r)},Tu=function(s,n){var r=Ip(s),a=C_(n);if(r!==Hs||!Ci(va,a)||Ci(oc,a)){var l=hI(r,a);return!l||!Ci(va,a)||Ci(r,pr)&&r[pr][a]||(l.enumerable=!0),l}},ql=function(s){var n=Kc(Ip(s)),r=[];return A_(n,function(a){Ci(va,a)||Ci(yu,a)||My(r,a)}),r},Kl=function(s){var n=s===Hs,r=Kc(n?oc:Ip(s)),a=[];return A_(r,function(l){!Ci(va,l)||n&&!Ci(Hs,l)||My(a,va[l])}),a};vu||(qc=function(){if(S_(Ap,this))throw uI("Symbol is not a constructor");var s=arguments.length&&void 0!==arguments[0]?_M(arguments[0]):void 0,n=I_(s),r=function(a){this===Hs&&v_(r,oc,a),Ci(this,pr)&&Ci(this[pr],n)&&(this[pr][n]=!1),xy(this,n,zc(1,a))};return zo&&fr&&xy(Hs,n,{configurable:!0,set:r}),Ti(n,s)},w_(Ap=qc[Su],"toString",function(){return O_(this).tag}),w_(qc,"withoutSetter",function(s){return Ti(I_(s),s)}),gM.f=Ly,cI.f=Cu,QU.f=ky,aI.f=Tu,XU.f=T_.f=ql,JU.f=Kl,ZU.f=function(s){return Ti(R_(s),s)},zo&&Rp(Ap,"description",{configurable:!0,get:function(){return O_(this).description}})),g_({global:!0,constructor:!0,wrap:!0,forced:!vu,sham:!vu},{Symbol:qc}),A_(sI(yM),function(s){lI(s)}),g_({target:bu,stat:!0,forced:!vu},{useSetter:function(){fr=!0},useSimple:function(){fr=!1}}),g_({target:"Object",stat:!0,forced:!vu,sham:!zo},{create:function(s,n){return void 0===n?rc(s):ky(rc(s),n)},defineProperty:Cu,defineProperties:ky,getOwnPropertyDescriptor:Tu}),g_({target:"Object",stat:!0,forced:!vu},{getOwnPropertyNames:ql}),dI(),EM(qc,bu),yu[pr]=!0;var Yl=nt&&!!Symbol.for&&!!Symbol.keyFor,pI=Ct,Fy=He,wu=St,eV=Bo,fI=tt,tV=Yl,mI=fI("string-to-symbol-registry"),nV=fI("symbol-to-string-registry");pI({target:"Symbol",stat:!0,forced:!tV},{for:function(s){var n=eV(s);if(wu(mI,n))return mI[n];var r=Fy("Symbol")(n);return mI[n]=r,nV[r]=n,r}});var iV=Ct,rV=St,oV=kc,Iu=Wt,bM=Yl,_I=tt("symbol-to-string-registry");iV({target:"Symbol",stat:!0,forced:!bM},{keyFor:function(s){if(!oV(s))throw TypeError(Iu(s)+" is not a symbol");if(rV(_I,s))return _I[s]}});var Li=ni([].slice),gI=cy,Dp=yi,EI=Ka,ms=Bo,$l=ni([].push),vI=Ct,Op=He,Ru=Hv,SM=Ir,P_=ni,yI=pi,CM=yi,uo=kc,M_=Li,sV=nt,bI=String,Yc=Op("JSON","stringify"),x_=P_(/./.exec),SI=P_("".charAt),TM=P_("".charCodeAt),wM=P_("".replace),IM=P_(1..toString),Uy=/[\uD800-\uDFFF]/g,Np=/^[\uD800-\uDBFF]$/,CI=/^[\uDC00-\uDFFF]$/,Pp=!sV||yI(function(){var s=Op("Symbol")();return"[null]"!=Yc([s])||"{}"!=Yc({a:s})||"{}"!=Yc(Object(s))}),TI=yI(function(){return'"\\udf06\\ud834"'!==Yc("\udf06\ud834")||'"\\udead"'!==Yc("\udead")}),k_=function(s,n){var r=M_(arguments),a=function(s){if(Dp(s))return s;if(gI(s)){for(var n=s.length,r=[],a=0;a<n;a++){var l=s[a];"string"==typeof l?$l(r,l):"number"!=typeof l&&"Number"!=EI(l)&&"String"!=EI(l)||$l(r,ms(l))}var d=r.length,h=!0;return function(p,m){if(h)return h=!1,m;if(gI(this))return m;for(var _=0;_<d;_++)if(r[_]===p)return m}}}(n);if(CM(a)||void 0!==s&&!uo(s))return r[1]=function(l,d){if(CM(a)&&(d=SM(a,this,bI(l),d)),!uo(d))return d},Ru(Yc,null,r)},RM=function(s,n,r){var a=SI(r,n-1),l=SI(r,n+1);return x_(Np,s)&&!x_(CI,l)||x_(CI,s)&&!x_(Np,a)?"\\u"+IM(TM(s,0),16):s};Yc&&vI({target:"JSON",stat:!0,arity:3,forced:Pp||TI},{stringify:function(s,n,r){var a=M_(arguments),l=Ru(Pp?k_:Yc,null,a);return TI&&"string"==typeof l?wM(l,Uy,RM):l}});var Vy=Iy,By=iu;Ct({target:"Object",stat:!0,forced:!nt||pi(function(){Vy.f(1)})},{getOwnPropertySymbols:function(s){var n=Vy.f;return n?n(By(s)):[]}}),un("asyncIterator"),un("hasInstance"),un("isConcatSpreadable"),un("iterator"),un("match"),un("matchAll"),un("replace"),un("search"),un("species"),un("split");var L_=p_;un("toPrimitive"),L_();var wI=He,AM=lo;un("toStringTag"),AM(wI("Symbol"),"Symbol"),un("unscopables"),lo(Zi.JSON,"JSON",!0);var Xl,Jl,Du,DM=jl.Symbol,Mp={},F_=ha,NM=Function.prototype,PM=F_&&Object.getOwnPropertyDescriptor,jy=St(NM,"name"),II={EXISTS:jy,PROPER:jy&&"something"===function(){}.name,CONFIGURABLE:jy&&(!F_||F_&&PM(NM,"name").configurable)},U_=!pi(function(){function s(){}return s.prototype.constructor=null,Object.getPrototypeOf(new s)!==s.prototype}),RI=St,MM=yi,AI=iu,aV=U_,Hy=a_("IE_PROTO"),DI=Object,xM=DI.prototype,Gy=aV?DI.getPrototypeOf:function(s){var n=AI(s);if(RI(n,Hy))return n[Hy];var r=n.constructor;return MM(r)&&n instanceof r?r.prototype:n instanceof DI?xM:null},Wy=pi,cV=yi,lV=ko,zy=d_,kM=Gy,dV=bp,OI=qn("iterator"),LM=!1;[].keys&&("next"in(Du=[].keys())?(Jl=kM(kM(Du)))!==Object.prototype&&(Xl=Jl):LM=!0);var uV=!lV(Xl)||Wy(function(){var s={};return Xl[OI].call(s)!==s});cV((Xl=uV?{}:zy(Xl))[OI])||dV(Xl,OI,function(){return this});var NI={IteratorPrototype:Xl,BUGGY_SAFARI_ITERATORS:LM},V_=NI.IteratorPrototype,B_=d_,PI=us,MI=lo,xI=Mp,Ou=function(){return this},kI=ni,LI=oo,j_=yi,H_=String,$c=TypeError,UM=hs,FI=Object.setPrototypeOf||("__proto__"in{}?function(){var s,n=!1,r={};try{(s=function(s,n,r){try{return kI(LI(Object.getOwnPropertyDescriptor(s,n)[r]))}catch{}}(Object.prototype,"__proto__","set"))(r,[]),n=r instanceof Array}catch{}return function(a,l){return UM(a),function(s){if("object"==typeof s||j_(s))return s;throw $c("Can't set "+H_(s)+" as a prototype")}(l),n?s(a,l):a.__proto__=l,a}}():void 0),qy=Ct,BM=Ir,UI=Gy,GM=lo,VI=bp,qr=Mp,BI=II.PROPER,Nu=NI.BUGGY_SAFARI_ITERATORS,er=qn("iterator"),xp="values",Yy="entries",WM=function(){return this},$y=function(s,n,r,a,l,d,h){!function(s,n,r,a){var l=n+" Iterator";s.prototype=B_(V_,{next:PI(+!a,r)}),MI(s,l,!1,!0),xI[l]=Ou}(r,n,a);var p,m,_,E=function(L){if(L===l&&P)return P;if(!Nu&&L in T)return T[L];switch(L){case"keys":case xp:case Yy:return function(){return new r(this,L)}}return function(){return new r(this)}},v=n+" Iterator",b=!1,T=s.prototype,O=T[er]||T["@@iterator"]||l&&T[l],P=!Nu&&O||E(l),D="Array"==n&&T.entries||O;if(D&&(p=UI(D.call(new s)))!==Object.prototype&&p.next&&(GM(p,v,!0,!0),qr[v]=WM),BI&&l==xp&&O&&O.name!==xp&&(b=!0,P=function(){return BM(O,this)}),l)if(m={values:E(xp),keys:d?P:E("keys"),entries:E(Yy)},h)for(_ in m)(Nu||b||!(_ in T))&&VI(T,_,m[_]);else qy({target:n,proto:!0,forced:Nu||b},m);return h&&T[er]!==P&&VI(T,er,P,{name:l}),qr[n]=P,m},jI=function(s,n){return{value:s,done:n}},HI=Bl,GI=Mp,zM=$y,WI=jI,G_="Array Iterator",Jy=Eu.set,qM=Eu.getterFor(G_);zM(Array,"Array",function(s,n){Jy(this,{type:G_,target:HI(s),index:0,kind:n})},function(){var s=qM(this),n=s.target,r=s.kind,a=s.index++;return!n||a>=n.length?(s.target=void 0,WI(void 0,!0)):WI("keys"==r?a:"values"==r?n[a]:[a,n[a]],!1)},"values"),GI.Arguments=GI.Array;var KM=Zi,YM=Fs,zI=Fc,Qy=Mp,Zy=qn("toStringTag");for(var Xc in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var Lp=KM[Xc],W_=Lp&&Lp.prototype;W_&&YM(W_)!==Zy&&zI(W_,Zy,Xc),Qy[Xc]=Qy.Array}var eb=DM,$M=bi.f,qI=qn("metadata"),KI=Function.prototype;void 0===KI[qI]&&$M(KI,qI,{value:null}),un("dispose"),un("metadata");var XM=eb;un("asyncDispose");var JM=ni,tb=He("Symbol"),YI=tb.keyFor,q_=JM(tb.prototype.valueOf),K_=tb.isRegisteredSymbol||function(s){try{return void 0!==YI(q_(s))}catch{return!1}};Ct({target:"Symbol",stat:!0},{isRegisteredSymbol:K_});for(var nb=tt,$I=He,QM=ni,ib=kc,XI=qn,ya=$I("Symbol"),rb=ya.isWellKnownSymbol,ob=$I("Object","getOwnPropertyNames"),ZM=QM(ya.prototype.valueOf),ex=nb("wks"),Mu=0,JI=ob(ya),QI=JI.length;Mu<QI;Mu++)try{var sb=JI[Mu];ib(ya[sb])&&XI(sb)}catch{}var ab=function(s){if(rb&&rb(s))return!0;try{for(var n=ZM(s),r=0,a=ob(ex),l=a.length;r<l;r++)if(ex[a[r]]==n)return!0}catch{}return!1};Ct({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:ab}),un("matcher"),un("observable"),Ct({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:K_}),Ct({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:ab}),un("metadataKey"),un("patternMatch"),un("replaceAll");var Jc=cr(XM),Y_=ni,$_=yn,Fp=Bo,ZI=nu,cb=Y_("".charAt),Up=Y_("".charCodeAt),eR=Y_("".slice),X_=function(s){return function(n,r){var a,l,d=Fp(ZI(n)),h=$_(r),p=d.length;return h<0||h>=p?s?"":void 0:(a=Up(d,h))<55296||a>56319||h+1===p||(l=Up(d,h+1))<56320||l>57343?s?cb(d,h):a:s?eR(d,h,h+2):l-56320+(a-55296<<10)+65536}},Vp=(X_(!1),X_(!0)),tx=Bo,nx=$y,tR=jI,nR="String Iterator",iR=Eu.set,rR=Eu.getterFor(nR);nx(String,"String",function(s){iR(this,{type:nR,string:tx(s),index:0})},function(){var s,n=rR(this),r=n.string,a=n.index;return a>=r.length?tR(void 0,!0):(s=Vp(r,a),n.index+=s.length,tR(s,!1))});var Bp=cr(Vs.f("iterator"));function Ql(s){return(Ql="function"==typeof Jc&&"symbol"==typeof Bp?function(n){return typeof n}:function(n){return n&&"function"==typeof Jc&&n.constructor===Jc&&n!==Jc.prototype?"symbol":typeof n})(s)}var xu=cr(Vs.f("toPrimitive"));function C(s,n,r){return(n=function ix(s){var n=function(r,a){if("object"!==Ql(r)||null===r)return r;var l=r[xu];if(void 0!==l){var d=l.call(r,"string");if("object"!==Ql(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}(s);return"symbol"===Ql(n)?n:String(n)}(n))in s?Us(s,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[n]=r,s}var hV=ke("Array").keys,rx=Fs,db=St,ox=xs,ku=hV,Lu=Array.prototype,ub={DOMTokenList:!0,NodeList:!0},Kr=cr(function(s){var n=s.keys;return s===Lu||ox(Lu,s)&&n===Lu.keys||db(ub,rx(s))?ku:n}),hb=Wt,oR=TypeError,pb=Ty,sx=Math.floor,fb=function(s,n){var r=s.length,a=sx(r/2);return r<8?ax(s,n):cx(s,fb(pb(s,0,a),n),fb(pb(s,a),n),n)},ax=function(s,n){for(var r,a,l=s.length,d=1;d<l;){for(a=d,r=s[d];a&&n(s[a-1],r)>0;)s[a]=s[--a];a!==d++&&(s[a]=r)}return s},cx=function(s,n,r,a){for(var l=n.length,d=r.length,h=0,p=0;h<l||p<d;)s[h+p]=h<l&&p<d?a(n[h],r[p])<=0?n[h++]:r[p++]:h<l?n[h++]:r[p++];return s},lx=fb,Qc=pi,Fu=function(s,n){var r=[][s];return!!r&&Qc(function(){r.call(null,n||function(){return 1},1)})},sR=$a.match(/firefox\/(\d+)/i),pV=!!sR&&+sR[1],fV=/MSIE|Trident/.test($a),dx=$a.match(/AppleWebKit\/(\d+)\./),_V=Ct,mb=ni,ux=oo,hx=iu,aR=ps,px=function(s,n){if(!delete s[n])throw oR("Cannot delete property "+hb(n)+" of "+hb(s))},J_=Bo,Gs=pi,jp=lx,cR=Fu,_b=pV,lR=fV,fx=zn,mx=!!dx&&+dx[1],Zl=[],Q_=mb(Zl.sort),gb=mb(Zl.push),gV=Gs(function(){Zl.sort(void 0)}),EV=Gs(function(){Zl.sort(null)}),dR=cR("sort"),uR=!Gs(function(){if(fx)return fx<70;if(!(_b&&_b>3)){if(lR)return!0;if(mx)return mx<603;var s,n,r,a,l="";for(s=65;s<76;s++){switch(n=String.fromCharCode(s),s){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(a=0;a<47;a++)Zl.push({k:n+a,v:r})}for(Zl.sort(function(d,h){return h.v-d.v}),a=0;a<Zl.length;a++)n=Zl[a].k.charAt(0),l.charAt(l.length-1)!==n&&(l+=n);return"DGBEFHACIJK"!==l}});_V({target:"Array",proto:!0,forced:gV||!EV||!dR||!uR},{sort:function(s){void 0!==s&&ux(s);var n=hx(this);if(uR)return void 0===s?Q_(n):Q_(n,s);var r,a,l=[],d=aR(n);for(a=0;a<d;a++)a in n&&gb(l,n[a]);for(jp(l,function(h){return function(p,m){return void 0===m?-1:void 0===p?1:void 0!==h?+h(p,m)||0:J_(p)>J_(m)?1:-1}}(s)),r=aR(l),a=0;a<r;)n[a]=l[a++];for(;a<d;)px(n,a++);return n}});var _x=ke("Array").sort,gx=xs,Ex=_x,Z_=Array.prototype,Zc=cr(function(s){var n=s.sort;return s===Z_||gx(Z_,s)&&n===Z_.sort?Ex:n}),vx=He,Eb=yp,yx=Iy,Uu=hs,bx=ni([].concat),Sx=vx("Reflect","ownKeys")||function(s){var n=Eb.f(Uu(s)),r=yx.f;return r?bx(n,r(s)):n},eg=St,hR=Sx,Cx=xi,Tx=bi,wx=ko,Ix=Fc,vb=Error,vV=ni("".replace),yV=String(vb("zxcasd").stack),Vu=/\n\s*at [^:]*:[^\n]*/,De=Vu.test(yV),Hp=us,pR=!pi(function(){var s=Error("a");return!("stack"in s)||(Object.defineProperty(s,"stack",Hp(1,7)),7!==s.stack)}),fR=Fc,mR=pR,_R=Error.captureStackTrace,gR=Mp,ER=qn("iterator"),tg=Array.prototype,bV=Fs,ng=Xv,Rx=cp,bb=Mp,vR=qn("iterator"),Sb=function(s){if(!Rx(s))return ng(s,vR)||ng(s,"@@iterator")||bb[bV(s)]},ed=Ir,Ax=oo,Cb=hs,ig=Wt,Dx=Sb,Tb=TypeError,rg=Ir,qo=hs,og=Xv,wb=Ar,Ox=Ir,Nx=hs,yR=Wt,Px=ps,bR=xs,Ib=Sb,ju=function(s,n,r){var a,l;qo(s);try{if(!(a=og(s,"return"))){if("throw"===n)throw r;return r}a=rg(a,s)}catch(d){l=!0,a=d}if("throw"===n)throw r;if(l)throw a;return qo(a),r},xx=TypeError,Gp=function(s,n){this.stopped=s,this.result=n},el=Gp.prototype,sg=function(s,n,r){var a,l,d,h,p,m,_,v=!(!r||!r.AS_ENTRIES),b=!(!r||!r.IS_RECORD),T=!(!r||!r.IS_ITERATOR),O=!(!r||!r.INTERRUPTED),P=wb(n,r&&r.that),D=function(V){return a&&ju(a,"normal",V),new Gp(!0,V)},L=function(V){return v?(Nx(V),O?P(V[0],V[1],D):P(V[0],V[1])):O?P(V,D):P(V)};if(b)a=s.iterator;else if(T)a=s;else{if(!(l=Ib(s)))throw xx(yR(s)+" is not iterable");if(function(s){return void 0!==s&&(gR.Array===s||tg[ER]===s)}(l)){for(d=0,h=Px(s);h>d;d++)if((p=L(s[d]))&&bR(el,p))return p;return new Gp(!1)}a=function(s,n){var r=arguments.length<2?Dx(s):n;if(Ax(r))return Cb(ed(r,s));throw Tb(ig(s)+" is not iterable")}(s,l)}for(m=b?s.next:a.next;!(_=Ox(m,a)).done;){try{p=L(_.value)}catch(V){ju(a,"throw",V)}if("object"==typeof p&&p&&bR(el,p))return p}return new Gp(!1)},ba=Bo,Rb=Ct,kx=xs,SV=Gy,Ab=FI,SR=d_,Wp=Fc,zp=us,Db=function(s,n,r,a){mR&&(_R?_R(s,n):fR(s,"stack",function(s,n){if(De&&"string"==typeof s&&!vb.prepareStackTrace)for(;n--;)s=vV(s,Vu,"");return s}(r,a)))},Ob=sg,cg=qn("toStringTag"),sc=Error,Nb=[].push,tl=function(s,n){var r,a=kx(Gu,this);Ab?r=Ab(sc(),a?SV(this):Gu):(r=a?this:SR(Gu),Wp(r,cg,"Error")),void 0!==n&&Wp(r,"message",function(s,n){return void 0===s?arguments.length<2?"":n:ba(s)}(n)),Db(r,tl,r.stack,1),arguments.length>2&&function(s,n){wx(n)&&"cause"in n&&Ix(s,"cause",n.cause)}(r,arguments[2]);var l=[];return Ob(s,Nb,{that:l}),Wp(r,"errors",l),r};Ab?Ab(tl,sc):function(s,n,r){for(var a=hR(n),l=Tx.f,d=Cx.f,h=0;h<a.length;h++){var p=a[h];eg(s,p)||r&&eg(r,p)||l(s,p,d(n,p))}}(tl,sc,{name:!0});var Gu=tl.prototype=SR(sc.prototype,{constructor:zp(1,tl),message:zp(1,""),name:zp(1,"AggregateError")});Rb({global:!0,constructor:!0,arity:2},{AggregateError:tl});var lg,nl,Wu,Pb,zu=typeof process<"u"&&"process"==Ka(process),Lx=He,Fx=Ry,Mb=ha,xb=qn("species"),Ux=xs,Vx=TypeError,CV=tc,Bx=Wt,dg=TypeError,ug=hs,CR=cp,kb=qn("species"),Kp=function(s,n){var r,a=ug(s).constructor;return void 0===a||CR(r=ug(a)[kb])?n:function(s){if(CV(s))return s;throw dg(Bx(s)+" is not a constructor")}(r)},Hx=TypeError,Lb=/(?:ipad|iphone|ipod).*applewebkit/i.test($a),Ko=Zi,TR=Hv,TV=Ar,wR=yi,qu=St,IR=pi,td=zw,bn=Li,RR=mw,Sa=Lb,Gx=zu,Fb=Ko.setImmediate,ac=Ko.clearImmediate,Wx=Ko.process,$p=Ko.Dispatch,wV=Ko.Function,hg=Ko.MessageChannel,AR=Ko.String,Ub=0,Xp={},Vb="onreadystatechange";IR(function(){lg=Ko.location});var Bb=function(s){if(qu(Xp,s)){var n=Xp[s];delete Xp[s],n()}},pg=function(s){return function(){Bb(s)}},DR=function(s){Bb(s.data)},OR=function(s){Ko.postMessage(AR(s),lg.protocol+"//"+lg.host)};Fb&&ac||(Fb=function(s){!function(s,n){if(s<n)throw Hx("Not enough arguments")}(arguments.length,1);var n=wR(s)?s:wV(s),r=bn(arguments,1);return Xp[++Ub]=function(){TR(n,void 0,r)},nl(Ub),Ub},ac=function(s){delete Xp[s]},Gx?nl=function(s){Wx.nextTick(pg(s))}:$p&&$p.now?nl=function(s){$p.now(pg(s))}:hg&&!Sa?(Pb=(Wu=new hg).port2,Wu.port1.onmessage=DR,nl=TV(Pb.postMessage,Pb)):Ko.addEventListener&&wR(Ko.postMessage)&&!Ko.importScripts&&lg&&"file:"!==lg.protocol&&!IR(OR)?(nl=OR,Ko.addEventListener("message",DR,!1)):nl=Vb in RR("script")?function(s){td.appendChild(RR("script"))[Vb]=function(){td.removeChild(this),Bb(s)}}:function(s){setTimeout(pg(s),0)});var zx={set:Fb,clear:ac},jb=function(){this.head=null,this.tail=null};jb.prototype={add:function(s){var n={item:s,next:null},r=this.tail;r?r.next=n:this.head=n,this.tail=n},get:function(){var s=this.head;if(s)return null===(this.head=s.next)&&(this.tail=null),s.item}};var nd,tr,fg,NR,mg,Ca=jb,Hb=/ipad|iphone|ipod/i.test($a)&&typeof Pebble<"u",qx=/web0s(?!.*chrome)/i.test($a),Ku=Zi,PR=Ar,en=zx.set,MR=Ca,Kx=Lb,IV=Hb,lt=qx,Wb=zu,_g=Ku.MutationObserver||Ku.WebKitMutationObserver,xR=Ku.document,kR=Ku.process,Yu=Ku.Promise,zb=(0,xi.f)(Ku,"queueMicrotask"),gg=zb&&zb.value;if(!gg){var Eg=new MR,Jp=function(){var s,n;for(Wb&&(s=kR.domain)&&s.exit();n=Eg.get();)try{n()}catch(r){throw Eg.head&&nd(),r}s&&s.enter()};Kx||Wb||lt||!_g||!xR?!IV&&Yu&&Yu.resolve?((NR=Yu.resolve(void 0)).constructor=Yu,mg=PR(NR.then,NR),nd=function(){mg(Jp)}):Wb?nd=function(){kR.nextTick(Jp)}:(en=PR(en,Ku),nd=function(){en(Jp)}):(tr=!0,fg=xR.createTextNode(""),new _g(Jp).observe(fg,{characterData:!0}),nd=function(){fg.data=tr=!tr}),gg=function(s){Eg.head||nd(),Eg.add(s)}}var LR=gg,$u=function(s){try{return{error:!1,value:s()}}catch(n){return{error:!0,value:n}}},id=Zi.Promise,FR="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,UR=!FR&&!zu&&"object"==typeof window&&"object"==typeof document,Xu=Zi,Yo=id,Ju=yi,Yx=Ew,$x=G1,BR=UR,qb=FR,rd=zn,Qp=Yo&&Yo.prototype,jR=qn("species"),Kb=!1,HR=Ju(Xu.PromiseRejectionEvent),Zp={CONSTRUCTOR:Yx("Promise",function(){var s=$x(Yo),n=s!==String(Yo);if(!n&&66===rd||!Qp.catch||!Qp.finally)return!0;if(!rd||rd<51||!/native code/.test(s)){var r=new Yo(function(l){l(1)}),a=function(l){l(function(){},function(){})};if((r.constructor={})[jR]=a,!(Kb=r.then(function(){})instanceof a))return!0}return!n&&(BR||qb)&&!HR}),REJECTION_EVENT:HR,SUBCLASSING:Kb},Ta={},Yb=oo,RV=TypeError,Jx=function(s){var n,r;this.promise=new s(function(a,l){if(void 0!==n||void 0!==r)throw RV("Bad Promise constructor");n=a,r=l}),this.resolve=Yb(n),this.reject=Yb(r)};Ta.f=function(s){return new Jx(s)};var GR,Qx,WR=Ct,ef=zu,od=Zi,il=Ir,zR=bp,qR=lo,KR=oo,vg=yi,bt=ko,YR=Kp,re=zx.set,sd=LR,yg=$u,Qu=Ca,bg=Eu,ad=id,Sg=Ta,Zu="Promise",Cg=Zp.CONSTRUCTOR,$R=Zp.REJECTION_EVENT,tf=bg.getterFor(Zu),tk=bg.set,nf=ad,Tg=ad&&ad.prototype,XR=od.TypeError,Xb=od.document,Jb=od.process,Qb=Sg.f,JR=Qb,QR=!!(Xb&&Xb.createEvent&&od.dispatchEvent),ZR="unhandledrejection",eA=function(s){var n;return!(!bt(s)||!vg(n=s.then))&&n},ho=function(s,n){var r,a,l,d=n.value,h=1==n.state,p=h?s.ok:s.fail,m=s.resolve,_=s.reject,E=s.domain;try{p?(h||(2===n.rejection&&iA(n),n.rejection=1),!0===p?r=d:(E&&E.enter(),r=p(d),E&&(E.exit(),l=!0)),r===s.promise?_(XR("Promise-chain cycle")):(a=eA(r))?il(a,r,m,_):m(r)):_(d)}catch(v){E&&!l&&E.exit(),_(v)}},tA=function(s,n){s.notified||(s.notified=!0,sd(function(){for(var r,a=s.reactions;r=a.get();)ho(r,s);s.notified=!1,n&&!s.rejection&&AV(s)}))},nA=function(s,n,r){var a,l;QR?((a=Xb.createEvent("Event")).promise=n,a.reason=r,a.initEvent(s,!1,!0),od.dispatchEvent(a)):a={promise:n,reason:r},!$R&&(l=od["on"+s])?l(a):s===ZR&&function(s,n){try{1==arguments.length?console.error(s):console.error(s,n)}catch{}}("Unhandled promise rejection",r)},AV=function(s){il(re,od,function(){var n,r=s.facade,a=s.value;if(wg(s)&&(n=yg(function(){ef?Jb.emit("unhandledRejection",a,r):nA(ZR,r,a)}),s.rejection=ef||wg(s)?2:1,n.error))throw n.value})},wg=function(s){return 1!==s.rejection&&!s.parent},iA=function(s){il(re,od,function(){var n=s.facade;ef?Jb.emit("rejectionHandled",n):nA("rejectionhandled",n,s.value)})},eh=function(s,n,r){return function(a){s(n,a,r)}},th=function(s,n,r){s.done||(s.done=!0,r&&(s=r),s.value=n,s.state=2,tA(s,!0))},Zb=function(s,n,r){if(!s.done){s.done=!0,r&&(s=r);try{if(s.facade===n)throw XR("Promise can't be resolved itself");var a=eA(n);a?sd(function(){var l={done:!1};try{il(a,n,eh(Zb,l,s),eh(th,l,s))}catch(d){th(l,d,s)}}):(s.value=n,s.state=1,tA(s,!1))}catch(l){th({done:!1},l,s)}}};Cg&&(Tg=(nf=function(s){(function(s,n){if(Ux(n,s))return s;throw Vx("Incorrect invocation")})(this,Tg),KR(s),il(GR,this);var n=tf(this);try{s(eh(Zb,n),eh(th,n))}catch(r){th(n,r)}}).prototype,(GR=function(s){tk(this,{type:Zu,done:!1,notified:!1,parent:!1,reactions:new Qu,rejection:!1,state:0,value:void 0})}).prototype=zR(Tg,"then",function(s,n){var r=tf(this),a=Qb(YR(this,nf));return r.parent=!0,a.ok=!vg(s)||s,a.fail=vg(n)&&n,a.domain=ef?Jb.domain:void 0,0==r.state?r.reactions.add(a):sd(function(){ho(a,r)}),a.promise}),Qx=function(){var s=new GR,n=tf(s);this.promise=s,this.resolve=eh(Zb,n),this.reject=eh(th,n)},Sg.f=Qb=function(s){return s===nf||void 0===s?new Qx(s):JR(s)}),WR({global:!0,constructor:!0,wrap:!0,forced:Cg},{Promise:nf}),qR(nf,Zu,!1,!0),function(s){var n=Lx(s);Mb&&n&&!n[xb]&&Fx(n,xb,{configurable:!0,get:function(){return this}})}(Zu);var eS=qn("iterator"),rA=!1;try{var ik=0,Ig={next:function(){return{done:!!ik++}},return:function(){rA=!0}};Ig[eS]=function(){return this},Array.from(Ig,function(){throw 2})}catch{}var rk=id,Rg=Zp.CONSTRUCTOR||!function(s,n){if(!n&&!rA)return!1;var r=!1;try{var a={};a[eS]=function(){return{next:function(){return{done:r=!0}}}},s(a)}catch{}return r}(function(s){rk.all(s).then(void 0,function(){})}),sk=Ir,ak=oo,wa=Ta,tS=$u,ck=sg;Ct({target:"Promise",stat:!0,forced:Rg},{all:function(s){var n=this,r=wa.f(n),a=r.resolve,l=r.reject,d=tS(function(){var h=ak(n.resolve),p=[],m=0,_=1;ck(s,function(E){var v=m++,b=!1;_++,sk(h,n,E).then(function(T){b||(b=!0,p[v]=T,--_||a(p))},l)}),--_||a(p)});return d.error&&l(d.value),r.promise}}),Ct({target:"Promise",proto:!0,forced:Zp.CONSTRUCTOR,real:!0},{catch:function(s){return this.then(void 0,s)}});var sA=Ir,aA=oo,Ag=Ta,nS=$u,DV=sg;Ct({target:"Promise",stat:!0,forced:Rg},{race:function(s){var n=this,r=Ag.f(n),a=r.reject,l=nS(function(){var d=aA(n.resolve);DV(s,function(h){sA(d,n,h).then(r.resolve,a)})});return l.error&&a(l.value),r.promise}});var cA=Ir,lA=Ta;Ct({target:"Promise",stat:!0,forced:Zp.CONSTRUCTOR},{reject:function(s){var n=lA.f(this);return cA(n.reject,void 0,s),n.promise}});var dA=hs,uA=ko,iS=Ta,Ia=function(s,n){if(dA(s),uA(n)&&n.constructor===s)return n;var r=iS.f(s);return(0,r.resolve)(n),r.promise},dk=Ct,uk=id,rS=Zp.CONSTRUCTOR,hk=Ia,hA=He("Promise"),pk=!rS;dk({target:"Promise",stat:!0,forced:!0},{resolve:function(s){return hk(pk&&this===hA?uk:this,s)}});var Dg=Ir,rf=oo,pA=Ta,Og=$u,OV=sg;Ct({target:"Promise",stat:!0,forced:Rg},{allSettled:function(s){var n=this,r=pA.f(n),a=r.resolve,l=r.reject,d=Og(function(){var h=rf(n.resolve),p=[],m=0,_=1;OV(s,function(E){var v=m++,b=!1;_++,Dg(h,n,E).then(function(T){b||(b=!0,p[v]={status:"fulfilled",value:T},--_||a(p))},function(T){b||(b=!0,p[v]={status:"rejected",reason:T},--_||a(p))})}),--_||a(p)});return d.error&&l(d.value),r.promise}});var fk=Ir,fA=oo,mA=He,mk=Ta,_k=$u,_A=sg,oS="No one promise resolved";Ct({target:"Promise",stat:!0,forced:Rg},{any:function(s){var n=this,r=mA("AggregateError"),a=mk.f(n),l=a.resolve,d=a.reject,h=_k(function(){var p=fA(n.resolve),m=[],_=0,E=1,v=!1;_A(s,function(b){var T=_++,O=!1;E++,fk(p,n,b).then(function(P){O||v||(v=!0,l(P))},function(P){O||v||(O=!0,m[T]=P,--E||d(new r(m,oS)))})}),--E||d(new r(m,oS))});return h.error&&d(h.value),a.promise}});var EA=He,gk=yi,Ek=Kp,nh=Ia,vk=id&&id.prototype;Ct({target:"Promise",proto:!0,real:!0,forced:!!id&&pi(function(){vk.finally.call({then:function(){}},function(){})})},{finally:function(s){var n=Ek(this,EA("Promise")),r=gk(s);return this.then(r?function(a){return nh(n,s()).then(function(){return a})}:s,r?function(a){return nh(n,s()).then(function(){throw a})}:s)}});var vA=jl.Promise,z=cr(vA);const yk=()=>{};function af(){const s={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:yk};return s.promise=new z((n,r)=>{s.resolve=a=>{s.isFinished||(s.isResolved=!0,s.isFinished=!0,n(a),s.value=a)},s.reject=a=>{s.isFinished||(s.isRejected=!0,s.isFinished=!0,r(a))}}),s}const Ng=new Map,Pg=new Map,Ra=new Map;var Fn,Ne,s;(s=Fn||(Fn={})).WIN_10="Windows 10",s.WIN_81="Windows 8.1",s.WIN_8="Windows 8",s.WIN_7="Windows 7",s.WIN_VISTA="Windows Vista",s.WIN_SERVER_2003="Windows Server 2003",s.WIN_XP="Windows XP",s.WIN_2000="Windows 2000",s.ANDROID="Android",s.HARMONY_OS="HarmonyOS",s.OPEN_BSD="Open BSD",s.SUN_OS="Sun OS",s.LINUX="Linux",s.IOS="iOS",s.MAC_OS="Mac OS",s.QNX="QNX",s.UNIX="UNIX",s.BEOS="BeOS",s.OS_2="OS/2",s.SEARCH_BOT="Search Bot",function(s){s.CHROME="Chrome",s.SAFARI="Safari",s.EDGE="Edge",s.FIREFOX="Firefox",s.OPERA="OPR",s.QQ="QQBrowser",s.WECHAT="MicroMessenger"}(Ne||(Ne={}));var aS={exports:{}};!function(s,n){!function(r,a){var l="function",d="undefined",h="object",p="string",m="major",_="model",E="name",v="type",b="vendor",T="version",O="architecture",P="console",D="mobile",L="tablet",V="smarttv",U="wearable",J="embedded",se="Amazon",q="Apple",Q="ASUS",$="BlackBerry",Y="Browser",me="Chrome",Ee="Firefox",Ze="Google",Ht="Microsoft",di="Motorola",ie="Opera",ce="Samsung",Le="Sony",ut="Xiaomi",le="Zebra",I="Facebook",F="Chromium OS",H="Mac OS",oe=function(pn){for(var An={},jt=0;jt<pn.length;jt++)An[pn[jt].toUpperCase()]=pn[jt];return An},Be=function(pn,An){return typeof pn===p&&-1!==Bt(An).indexOf(Bt(pn))},Bt=function(pn){return pn.toLowerCase()},Pi=function(pn,An){if(typeof pn===p)return pn=pn.replace(/^\s\s*/,""),typeof An===d?pn:pn.substring(0,350)},sr=function(pn,An){for(var jt,Fr,na,fn,at,Tr,ia=0;ia<An.length&&!at;){var Ns=An[ia],WT=An[ia+1];for(jt=Fr=0;jt<Ns.length&&!at&&Ns[jt];)if(at=Ns[jt++].exec(pn))for(na=0;na<WT.length;na++)Tr=at[++Fr],typeof(fn=WT[na])===h&&fn.length>0?2===fn.length?this[fn[0]]=typeof fn[1]==l?fn[1].call(this,Tr):fn[1]:3===fn.length?this[fn[0]]=typeof fn[1]!==l||fn[1].exec&&fn[1].test?Tr?Tr.replace(fn[1],fn[2]):a:Tr?fn[1].call(this,Tr,fn[2]):a:4===fn.length&&(this[fn[0]]=Tr?fn[3].call(this,Tr.replace(fn[1],fn[2])):a):this[fn]=Tr||a;ia+=2}},Lr=function(pn,An){for(var jt in An)if(typeof An[jt]===h&&An[jt].length>0){for(var Fr=0;Fr<An[jt].length;Fr++)if(Be(An[jt][Fr],pn))return"?"===jt?a:jt}else if(Be(An[jt],pn))return"?"===jt?a:jt;return pn},am={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},zi={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[T,[E,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[T,[E,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[E,T],[/opios[\/ ]+([\w\.]+)/i],[T,[E,ie+" Mini"]],[/\bopr\/([\w\.]+)/i],[T,[E,ie]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[E,T],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[T,[E,"UC"+Y]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[T,[E,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[T,[E,"WeChat"]],[/konqueror\/([\w\.]+)/i],[T,[E,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[T,[E,"IE"]],[/yabrowser\/([\w\.]+)/i],[T,[E,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[E,/(.+)/,"$1 Secure "+Y],T],[/\bfocus\/([\w\.]+)/i],[T,[E,Ee+" Focus"]],[/\bopt\/([\w\.]+)/i],[T,[E,ie+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[T,[E,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[T,[E,"Dolphin"]],[/coast\/([\w\.]+)/i],[T,[E,ie+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[T,[E,"MIUI "+Y]],[/fxios\/([-\w\.]+)/i],[T,[E,Ee]],[/\bqihu|(qi?ho?o?|360)browser/i],[[E,"360 "+Y]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[E,/(.+)/,"$1 "+Y],T],[/(comodo_dragon)\/([\w\.]+)/i],[[E,/_/g," "],T],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[E,T],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[E],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[E,I],T],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[E,T],[/\bgsa\/([\w\.]+) .*safari\//i],[T,[E,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[T,[E,me+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[E,me+" WebView"],T],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[T,[E,"Android "+Y]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[E,T],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[T,[E,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[T,E],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[E,[T,Lr,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[E,T],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[E,"Netscape"],T],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[T,[E,Ee+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[E,T],[/(cobalt)\/([\w\.]+)/i],[E,[T,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[O,"amd64"]],[/(ia32(?=;))/i],[[O,Bt]],[/((?:i[346]|x)86)[;\)]/i],[[O,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[O,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[O,"armhf"]],[/windows (ce|mobile); ppc;/i],[[O,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[O,/ower/,"",Bt]],[/(sun4\w)[;\)]/i],[[O,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[O,Bt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[_,[b,ce],[v,L]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[_,[b,ce],[v,D]],[/\((ip(?:hone|od)[\w ]*);/i],[_,[b,q],[v,D]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[_,[b,q],[v,L]],[/(macintosh);/i],[_,[b,q]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[_,[b,"Sharp"],[v,D]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[_,[b,"Huawei"],[v,L]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[_,[b,"Huawei"],[v,D]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[_,/_/g," "],[b,ut],[v,D]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[_,/_/g," "],[b,ut],[v,L]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[_,[b,"OPPO"],[v,D]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[_,[b,"Vivo"],[v,D]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[_,[b,"Realme"],[v,D]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[_,[b,di],[v,D]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[_,[b,di],[v,L]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[_,[b,"LG"],[v,L]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[_,[b,"LG"],[v,D]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[_,[b,"Lenovo"],[v,L]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[_,/_/g," "],[b,"Nokia"],[v,D]],[/(pixel c)\b/i],[_,[b,Ze],[v,L]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[_,[b,Ze],[v,D]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[_,[b,Le],[v,D]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[_,"Xperia Tablet"],[b,Le],[v,L]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[_,[b,"OnePlus"],[v,D]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[_,[b,se],[v,L]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[_,/(.+)/g,"Fire Phone $1"],[b,se],[v,D]],[/(playbook);[-\w\),; ]+(rim)/i],[_,b,[v,L]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[_,[b,$],[v,D]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[_,[b,Q],[v,L]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[_,[b,Q],[v,D]],[/(nexus 9)/i],[_,[b,"HTC"],[v,L]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[b,[_,/_/g," "],[v,D]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[_,[b,"Acer"],[v,L]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[_,[b,"Meizu"],[v,D]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[b,_,[v,D]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[b,_,[v,L]],[/(surface duo)/i],[_,[b,Ht],[v,L]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[_,[b,"Fairphone"],[v,D]],[/(u304aa)/i],[_,[b,"AT&T"],[v,D]],[/\bsie-(\w*)/i],[_,[b,"Siemens"],[v,D]],[/\b(rct\w+) b/i],[_,[b,"RCA"],[v,L]],[/\b(venue[\d ]{2,7}) b/i],[_,[b,"Dell"],[v,L]],[/\b(q(?:mv|ta)\w+) b/i],[_,[b,"Verizon"],[v,L]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[_,[b,"Barnes & Noble"],[v,L]],[/\b(tm\d{3}\w+) b/i],[_,[b,"NuVision"],[v,L]],[/\b(k88) b/i],[_,[b,"ZTE"],[v,L]],[/\b(nx\d{3}j) b/i],[_,[b,"ZTE"],[v,D]],[/\b(gen\d{3}) b.+49h/i],[_,[b,"Swiss"],[v,D]],[/\b(zur\d{3}) b/i],[_,[b,"Swiss"],[v,L]],[/\b((zeki)?tb.*\b) b/i],[_,[b,"Zeki"],[v,L]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[b,"Dragon Touch"],_,[v,L]],[/\b(ns-?\w{0,9}) b/i],[_,[b,"Insignia"],[v,L]],[/\b((nxa|next)-?\w{0,9}) b/i],[_,[b,"NextBook"],[v,L]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[b,"Voice"],_,[v,D]],[/\b(lvtel\-)?(v1[12]) b/i],[[b,"LvTel"],_,[v,D]],[/\b(ph-1) /i],[_,[b,"Essential"],[v,D]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[_,[b,"Envizen"],[v,L]],[/\b(trio[-\w\. ]+) b/i],[_,[b,"MachSpeed"],[v,L]],[/\btu_(1491) b/i],[_,[b,"Rotor"],[v,L]],[/(shield[\w ]+) b/i],[_,[b,"Nvidia"],[v,L]],[/(sprint) (\w+)/i],[b,_,[v,D]],[/(kin\.[onetw]{3})/i],[[_,/\./g," "],[b,Ht],[v,D]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[_,[b,le],[v,L]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[_,[b,le],[v,D]],[/smart-tv.+(samsung)/i],[b,[v,V]],[/hbbtv.+maple;(\d+)/i],[[_,/^/,"SmartTV"],[b,ce],[v,V]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[b,"LG"],[v,V]],[/(apple) ?tv/i],[b,[_,q+" TV"],[v,V]],[/crkey/i],[[_,me+"cast"],[b,Ze],[v,V]],[/droid.+aft(\w)( bui|\))/i],[_,[b,se],[v,V]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[_,[b,"Sharp"],[v,V]],[/(bravia[\w ]+)( bui|\))/i],[_,[b,Le],[v,V]],[/(mitv-\w{5}) bui/i],[_,[b,ut],[v,V]],[/Hbbtv.*(technisat) (.*);/i],[b,_,[v,V]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[b,Pi],[_,Pi],[v,V]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[v,V]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[b,_,[v,P]],[/droid.+; (shield) bui/i],[_,[b,"Nvidia"],[v,P]],[/(playstation [345portablevi]+)/i],[_,[b,Le],[v,P]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[_,[b,Ht],[v,P]],[/((pebble))app/i],[b,_,[v,U]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[_,[b,q],[v,U]],[/droid.+; (glass) \d/i],[_,[b,Ze],[v,U]],[/droid.+; (wt63?0{2,3})\)/i],[_,[b,le],[v,U]],[/(quest( 2| pro)?)/i],[_,[b,I],[v,U]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[b,[v,J]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[_,[v,D]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[_,[v,L]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[v,L]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[v,D]],[/(android[-\w\. ]{0,9});.+buil/i],[_,[b,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[T,[E,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[T,[E,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[E,T],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[T,E]],os:[[/microsoft (windows) (vista|xp)/i],[E,T],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[E,[T,Lr,am]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[E,"Windows"],[T,Lr,am]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[T,/_/g,"."],[E,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[E,H],[T,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[T,E],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[E,T],[/\(bb(10);/i],[T,[E,$]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[T,[E,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[T,[E,Ee+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[T,[E,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[T,[E,"watchOS"]],[/crkey\/([\d\.]+)/i],[T,[E,me+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[E,F],T],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[E,T],[/(sunos) ?([\w\.\d]*)/i],[[E,"Solaris"],T],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[E,T]]},qi=function(pn,An){if(typeof pn===h&&(An=pn,pn=a),!(this instanceof qi))return new qi(pn,An).getResult();var jt=typeof r!==d&&r.navigator?r.navigator:a,Fr=pn||(jt&&jt.userAgent?jt.userAgent:""),na=jt&&jt.userAgentData?jt.userAgentData:a,fn=An?function(at,Tr){var ia={};for(var Ns in at)ia[Ns]=Tr[Ns]&&Tr[Ns].length%2==0?Tr[Ns].concat(at[Ns]):at[Ns];return ia}(zi,An):zi;return this.getBrowser=function(){var Tr,at={};return at[E]=a,at[T]=a,sr.call(at,Fr,fn.browser),at[m]=typeof(Tr=at[T])===p?Tr.replace(/[^\d\.]/g,"").split(".")[0]:a,jt&&jt.brave&&typeof jt.brave.isBrave==l&&(at[E]="Brave"),at},this.getCPU=function(){var at={};return at[O]=a,sr.call(at,Fr,fn.cpu),at},this.getDevice=function(){var at={};return at[b]=a,at[_]=a,at[v]=a,sr.call(at,Fr,fn.device),!at[v]&&na&&na.mobile&&(at[v]=D),"Macintosh"==at[_]&&jt&&typeof jt.standalone!==d&&jt.maxTouchPoints&&jt.maxTouchPoints>2&&(at[_]="iPad",at[v]=L),at},this.getEngine=function(){var at={};return at[E]=a,at[T]=a,sr.call(at,Fr,fn.engine),at},this.getOS=function(){var at={};return at[E]=a,at[T]=a,sr.call(at,Fr,fn.os),!at[E]&&na&&"Unknown"!=na.platform&&(at[E]=na.platform.replace(/chrome os/i,F).replace(/macos/i,H)),at},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Fr},this.setUA=function(at){return Fr=typeof at===p&&at.length>350?Pi(at,350):at,this},this.setUA(Fr),this};qi.VERSION="0.7.34",qi.BROWSER=oe([E,T,m]),qi.CPU=oe([O]),qi.DEVICE=oe([_,b,v,P,D,V,L,U,J]),qi.ENGINE=qi.OS=oe([E,T]),s.exports&&(n=s.exports=qi),n.UAParser=qi;var Ml=typeof r!==d&&(r.jQuery||r.Zepto);if(Ml&&!Ml.ua){var Yd=new qi;Ml.ua=Yd.getResult(),Ml.ua.get=function(){return Yd.getUA()},Ml.ua.set=function(pn){Yd.setUA(pn);var An=Yd.getResult();for(var jt in An)Ml.ua[jt]=An[jt]}}}("object"==typeof window?window:eu)}(aS,aS.exports);const ih=new(cr(aS.exports));let cc=ih.getResult(),cS=null;function dt(s){if(!cS){s&&ih.setUA(s),cc=ih.getResult();const n=function(d){if("Blink"===d.engine.name&&"WeChat"!==d.browser.name)return Ne.CHROME;switch(d.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ne.CHROME;case"Safari":case"Mobile Safari":return Ne.SAFARI;case"Edge":return Ne.EDGE;case"Firefox":return Ne.FIREFOX;case"QQBrowser":return Ne.QQ;case"Opera":return Ne.OPERA;case"WeChat":return Ne.WECHAT;default:return d.browser.name||""}}(cc),r=function(d){let h;return h="Blink"===d.engine.name?d.engine.version||"":d.browser.version||"",h.split(".")[0]}(cc),a="Windows"===(d=cc).os.name?d.os.version?d.os.name+" "+d.os.version:d.os.name:d.os.name||"",l=cc.os.version;if(!(n&&r&&a&&l))return{name:n,version:r,os:a,osVersion:l};cS={name:n,version:r,os:a,osVersion:l}}var d;return cS}function Mg(){return dt().os}function yA(){const s=dt();return"".concat(s.os," ").concat(s.osVersion)}function xg(){const s=dt();return!!("WebKit"===cc.engine.name&&s.os===Fn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&s.name!==Ne.SAFARI||Fi()&&s.name!==Ne.SAFARI)}function kg(){return dt().name===Ne.CHROME}function Ki(){return dt().name===Ne.SAFARI}function zt(){return dt().name===Ne.FIREFOX}function Fi(){return dt().os===Fn.IOS}function Lg(s){const n=dt();return!(n.name!==Ne.CHROME||!n.osVersion)&&Number(n.version)>=s}function Sk(s){const n=dt();return!(n.name!==Ne.EDGE||!n.osVersion)&&Number(n.version)>=s}function cf(s){const n=dt();return!(n.name!==Ne.OPERA||!n.osVersion)&&Number(n.version)>=s}function SA(){const s=dt();return!(s.name!==Ne.CHROME||!s.osVersion)&&Number(s.version)<=90}function CA(){const s=dt();if(s.os!==Fn.IOS||!s.osVersion)return!1;const n=s.osVersion.split(".");return Number(n[0])<14||14===Number(n[0])&&Number(n[1])<=6}function rl(){const s=dt();if(s.os!==Fn.IOS||!s.osVersion)return!1;const n=s.osVersion.split(".");return 15===Number(n[0])}function lS(){const s=dt();if(s.os!==Fn.IOS||!s.osVersion)return!1;const n=s.osVersion.split(".");return 16===Number(n[0])}function Ws(){const s=dt();if(s.os!==Fn.IOS||!s.osVersion)return!1;const n=s.osVersion.split(".");return 15===Number(n[0])&&Number(n[1])>=1}function po(){return Ki()&&navigator.maxTouchPoints>0}function mr(){return dt().name===Ne.WECHAT}function ol(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function zs(){const s=dt();return s.name!==Ne.EDGE&&s.name!==Ne.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Yr(){return Mg()===Fn.ANDROID}function ri(){const s=dt();return Yr()&&(s.name===Ne.CHROME||s.name===Ne.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}var M;!function(s){s.UNEXPECTED_ERROR="UNEXPECTED_ERROR",s.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",s.TIMEOUT="TIMEOUT",s.INVALID_PARAMS="INVALID_PARAMS",s.NOT_READABLE="NOT_READABLE",s.NOT_SUPPORTED="NOT_SUPPORTED",s.INVALID_OPERATION="INVALID_OPERATION",s.OPERATION_ABORTED="OPERATION_ABORTED",s.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",s.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",s.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",s.DATACHANNEL_FAILED="DATACHANNEL_FAILED",s.NETWORK_ERROR="NETWORK_ERROR",s.NETWORK_TIMEOUT="NETWORK_TIMEOUT",s.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",s.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",s.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",s.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",s.ELECTRON_IS_NULL="ELECTRON_IS_NULL",s.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",s.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",s.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",s.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",s.PERMISSION_DENIED="PERMISSION_DENIED",s.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",s.TRACK_IS_DISABLED="TRACK_IS_DISABLED",s.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",s.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",s.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",s.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",s.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",s.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",s.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",s.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",s.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",s.UID_CONFLICT="UID_CONFLICT",s.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",s.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",s.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",s.INVALID_TRACK="INVALID_TRACK",s.SENDER_NOT_FOUND="SENDER_NOT_FOUND",s.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",s.SET_ANSWER_FAILED="SET_ANSWER_FAILED",s.ICE_FAILED="ICE_FAILED",s.PC_CLOSED="PC_CLOSED",s.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",s.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",s.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",s.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",s.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",s.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",s.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",s.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",s.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",s.INVALID_REMOTE_USER="INVALID_REMOTE_USER",s.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",s.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",s.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",s.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",s.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",s.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",s.WS_ABORT="WS_ABORT",s.WS_DISCONNECT="WS_DISCONNECT",s.WS_ERR="WS_ERR",s.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",s.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",s.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",s.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",s.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",s.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",s.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",s.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",s.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",s.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",s.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",s.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",s.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",s.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",s.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",s.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",s.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",s.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",s.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",s.INVALID_PLUGIN="INVALID_PLUGIN",s.DISCONNECT_P2P="DISCONNECT_P2P",s.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",s.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",s.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",s.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",s.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",s.PROHIBITED_OPERATION="PROHIBITED_OPERATION",s.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"}(M||(M={}));let X=class extends Error{constructor(s){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(n),C(this,"code",void 0),C(this,"message",void 0),C(this,"data",void 0),C(this,"name","AgoraRTCException"),this.code=s,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=r}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",n=arguments.length>1?arguments[1]:void 0;return"error"===s&&(n||console).error(this.toString()),"warning"===s&&(n||console).warn(this.toString()),this}throw(s){throw this.print("error",s),this}};function _s(s,n){if("boolean"!=typeof s)throw new X(M.INVALID_PARAMS,"Invalid ".concat(n,": The value is of the boolean type."))}function gn(s,n,r){if(!ye(r).call(r,s))throw new X(M.INVALID_PARAMS,"".concat(n," can only be set as ").concat(JSON.stringify(r)))}function ft(s,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(s<r||s>a||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&("number"!=typeof(l=s)||l%1!=0))throw new X(M.INVALID_PARAMS,"invalid ".concat(n,": the value range is [").concat(r,", ").concat(a,"]. integer only"));var l}function sl(s,n){if("number"!=typeof s){if(!(s.min||s.max||s.ideal||s.exact))throw new X(M.INVALID_PARAMS,"".concat(n," is not a valid ConstrainLong"));void 0!==s.min&&ft(s.min,"".concat(n,".min"),0,1/0),void 0!==s.max&&ft(s.max,"".concat(n,".max"),1,1/0),void 0!==s.exact&&ft(s.exact,"".concat(n,".exact"),1,1/0),void 0!==s.ideal&&ft(s.ideal,"".concat(n,".ideal"),1,1/0)}else ft(s,n,1,1/0)}function Un(s,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==s)throw new X(M.INVALID_PARAMS,"".concat(n||"param"," cannot be empty"));if(!dS(s,r,a,l))throw new X(M.INVALID_PARAMS,"Invalid ".concat(n||"string param",": Length of the string: [").concat(r,",").concat(a,"].").concat(l?" ASCII characters only.":""))}function fo(s,n){if(!Array.isArray(s))throw new X(M.INVALID_PARAMS,"".concat(n," should be an array"))}function kt(s){return null==s}function dS(s){return"string"==typeof s&&s.length<=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:255)&&s.length>=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)&&(!(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])||function(l){if("string"!=typeof l)return!1;for(let d=0;d<l.length;d+=1){const h=l.charCodeAt(d);if(h<0||h>255)return!1}return!0}(s))}function uS(s,n,r){if("getBigUint64"in DataView.prototype)return s.getBigUint64(n,r);const a=s.getUint32(n,r),l=s.getUint32(n+4,r),d=+!!r,h=+!r;return BigInt(a*h+l*d)<<BigInt(32)|BigInt(a*d+l*h)}function hS(s,n,r,a){if("setBigUint64"in DataView.prototype)return s.setBigUint64(n,r,a);const l=Number(r>>BigInt(32)),d=Number(r&BigInt(4294967295));a?(s.setUint32(n+4,l,a),s.setUint32(n,d,a)):(s.setUint32(n,l,a),s.setUint32(n+4,d,a))}var cd,lf;(function(s){s.COVERED="COVERED",s.POSITION="POSITION",s.SIZE="SIZE",s.STYLE="STYLE"})(cd||(cd={})),function(s){s.UNMOUNTED="UNMOUNTED",s.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(lf||(lf={}));const pS=new class{constructor(){C(this,"_clientSize",null),C(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),C(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),C(this,"getStyle",s=>window.getComputedStyle(s,null)),C(this,"checkCssVisibleProperty",s=>{var n;let r=!0;const a=this.getStyle(s),{display:l,visibility:d,opacity:h,filter:p}=a;return("none"===l||ye(n=["hidden","collapse"]).call(n,d)||Number(h)<.1)&&(r=!1),!!r&&(p&&p.split(" ").filter(m=>{var _;const E=m.split("(")[0];return ye(_=["brightness","blur","opacity"]).call(_,E)}).map(m=>{const[_,E]=m.split(/\(|\)/);return[_,Number(E.match(/^[0-9\.]+/))]}).forEach(m=>{const[_,E]=m;switch(_){case"brightness":(E<.1||E>3)&&(r=!1);break;case"blur":E>3&&(r=!1);break;case"opacity":E<.1&&(r=!1)}}),r)}),C(this,"checkPropertyUpToAllParentNodes",(s,n)=>{let r=!0,a=!0;let d=s;for(;d&&a;)n(d)||(r=!1,a=!1),d=d.parentElement,d||(a=!1);return r}),C(this,"checkActualCssVisibleIncludeInherit",s=>this.checkPropertyUpToAllParentNodes(s,this.checkCssVisibleProperty)),C(this,"getSizeAboutClient",s=>{const{width:n,height:r,left:a,right:l,top:d,bottom:h}=s.getBoundingClientRect(),p=this.getClientWidth(),m=this.getClientHeight();return{width:n,height:r,left:a,right:l,top:d,bottom:h,clientWidth:p,clientHeight:m,clientMin:Math.min(p,m)}}),C(this,"checkActualSize",()=>{const{width:s,height:n,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(s,n,r)}),C(this,"elementFromPoint",(s,n)=>document.elementFromPoint?document.elementFromPoint(s,n):null),C(this,"checkCoverForAPoint",(s,n,r)=>{const a=this.elementFromPoint(s,n);return null!==a&&a!==r}),C(this,"getPointPositionList",()=>{const{width:s,height:n,left:r,top:a}=this._clientSize,l=s/6,d=n/6,h=[],p=10**6;for(let m=0;m<5;m++)for(let _=0;_<5;_++)h.push({x:(r*p+(0===m?.1:4===m?(l*m*p-1e5)/p:l*m)*p)/p,y:(a*p+(0===_?.1:4===_?(d*_*p-1e5)/p:d*_)*p)/p});return[...h]}),C(this,"checkElementCover",s=>this.getPointPositionList().map(n=>this.checkCoverForAPoint(n.x,n.y,s)).filter(n=>!!n).length>6),C(this,"checkSizeIsVisible",(s,n,r)=>(s>50||r/s<=10)&&(n>50||r/n<=10)),C(this,"checkSizeOfPartInClient",()=>{const{left:s,right:n,top:r,bottom:a,clientHeight:l,clientWidth:d,clientMin:h}=this._clientSize;let p,m,_,E;if(s<0)p=0;else{if(!(s<d))return!1;p=s}if(n<0)return!1;if(m=n<d?n:d,r<0)_=0;else{if(!(r<l))return!1;_=r}return!(a<0)&&(E=a<l?a:l,this.checkSizeIsVisible(m-p,E-_,h))}),C(this,"returnHiddenResult",s=>(this._clientSize=null,{visible:!1,reason:s})),C(this,"checkOneElementVisible",s=>{if(s instanceof HTMLElement){if(this.checkElementIsMountedOnDom(s)){if(this.checkActualCssVisibleIncludeInherit(s)){if(this._clientSize=this.getSizeAboutClient(s),this.checkElementCover(s))return this.returnHiddenResult(cd.COVERED);{const n=this.checkActualSize(),r=this.checkSizeOfPartInClient();return n&&!r?this.returnHiddenResult(cd.POSITION):n?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(cd.SIZE)}}return this.returnHiddenResult(cd.STYLE)}return this.returnHiddenResult(lf.UNMOUNTED)}return this.returnHiddenResult(lf.INVALID_HTML_ELEMENT)}),C(this,"checkElementIsMountedOnDom",s=>this.checkPropertyUpToAllParentNodes(s,n=>"HTML"!==n.nodeName.toUpperCase()?null!==n.parentElement:!!document.documentElement))}};function Fg(s){return(new TextEncoder).encode(s)}const fS=function(s,n){const r=new Uint8Array(s.byteLength+n.byteLength);return r.set(new Uint8Array(s),0),r.set(new Uint8Array(n),s.byteLength),r},TA=function(){var s=x(function*(n){const r=function(h){const p=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),m=new Uint8Array(new ArrayBuffer(p.length));for(let _=0;_<p.length;_+=1)m[_]=p.charCodeAt(_);return m}(),a=yield window.crypto.subtle.importKey("spki",r,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),l=Fg(n),d=yield window.crypto.subtle.encrypt({name:"RSA-OAEP"},a,l);return function(h){let p="";for(let m=0;m<h.length;m+=1)p+=String.fromCharCode(h[m]);return window.btoa(p)}(new Uint8Array(d))});return function(r){return s.apply(this,arguments)}}(),mS=function(){var s=x(function*(n){return function(r,a){let l="";return new Uint8Array(r).forEach(d=>{l+=d.toString(16).padStart(2,"0")}),l}(yield crypto.subtle.digest("SHA-256",Fg(n)))});return function(r){return s.apply(this,arguments)}}();class qt{constructor(){C(this,"_events",{}),C(this,"addListener",this.on)}getListeners(n){return this._events[n]?this._events[n].map(r=>r.listener):[]}on(n,r){this._events[n]||(this._events[n]=[]);const a=this._events[n];-1===this._indexOfListener(a,r)&&a.push({listener:r,once:!1})}once(n,r){this._events[n]||(this._events[n]=[]);const a=this._events[n];-1===this._indexOfListener(a,r)&&a.push({listener:r,once:!0})}off(n,r){if(!this._events[n])return;const a=this._events[n],l=this._indexOfListener(a,r);-1!==l&&a.splice(l,1),0===this._events[n].length&&delete this._events[n]}removeAllListeners(n){n?delete this._events[n]:this._events={}}emit(n){this._events[n]||(this._events[n]=[]);const r=this._events[n].map(h=>h);for(var a=arguments.length,l=new Array(a>1?a-1:0),d=1;d<a;d++)l[d-1]=arguments[d];for(let h=0;h<r.length;h+=1){const p=r[h];p.once&&this.off(n,p.listener),p.listener.apply(this,l||[])}}safeEmit(n){for(var r=arguments.length,a=new Array(r>1?r-1:0),l=1;l<r;l++)a[l-1]=arguments[l];[...this._events[n]||[]].forEach(d=>{d.once&&this.off(n,d.listener);try{d.listener.apply(this,a)}catch(h){console.error("safeEmit event:".concat(n," error ").concat(h?.toString()))}})}_indexOfListener(n,r){let a=n.length;for(;a--;)if(n[a].listener===r)return a;return-1}}let Ug=null;function Ck(){if(Ug)return Ug;if(window.electron)return Ug=window.electron;if(!window.require)return null;try{return Ug=window.require("electron"),Ug}catch{return null}}var Nn,Jt,wA,Ye,Xe,Kn,Yi,lc;function Vg(s){return ft(s.timeout,"config.timeout",0,1e5),ft(s.timeoutFactor,"config.timeoutFactor",0,100,!1),ft(s.maxRetryCount,"config.maxRetryConfig",0,1/0),ft(s.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function Aa(s){if(!Array.isArray(s)||s.length<1)return!1;try{s.forEach(n=>{if(!n.urls)throw Error()})}catch{return!1}return!0}function Bg(s){return Un(s.turnServerURL,"turnServerURL"),Un(s.username,"username"),Un(s.password,"password"),s.udpport&&ft(s.udpport,"udpport",1,99999,!0),s.forceturn&&_s(s.forceturn,"forceturn"),s.security&&_s(s.security,"security"),s.tcpport&&ft(s.tcpport,"tcpport",1,99999,!0),!0}function df(s){return void 0!==s.level&&gn(s.level,"level",[1,2,3]),void 0!==s.delay&&ft(s.delay,"delay",0,3e3,!0),!0}function Qt(s,n){for(var r=arguments.length,a=new Array(r>2?r-2:0),l=2;l<r;l++)a[l-2]=arguments[l];return 0===s.getListeners(n).length?z.reject(new X(M.UNEXPECTED_ERROR,"can not emit promise")):new z((d,h)=>{s.emit(n,...a,d,h)})}function Et(s,n){if(0===s.getListeners(n).length)return z.resolve();for(var r=arguments.length,a=new Array(r>2?r-2:0),l=2;l<r;l++)a[l-2]=arguments[l];return Qt(s,n,...a)}function _r(s,n){if(0===s.getListeners(n).length)return null;for(var r=arguments.length,a=new Array(r>2?r-2:0),l=2;l<r;l++)a[l-2]=arguments[l];return dc(s,n,...a)}function dc(s,n){let r=null,a=null;for(var l=arguments.length,d=new Array(l>2?l-2:0),h=2;h<l;h++)d[h-2]=arguments[h];if(s.emit(n,...d,p=>{r=p},p=>{a=p}),null!==a)throw a;if(null===r)throw new X(M.UNEXPECTED_ERROR,"handler is not sync");return r}(function(s){s.CREATE_CLIENT="createClient",s.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",s.SET_AREA="setArea",s.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",s.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",s.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",s.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",s.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",s.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",s.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",s.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",s.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",s.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",s.START_PROXY_SERVER="Client.startProxyServer",s.STOP_PROXY_SERVER="Client.stopProxyServer",s.SET_PROXY_SERVER="Client.setProxyServer",s.SET_TURN_SERVER="Client.setTurnServer",s.SET_CLIENT_ROLE="Client.setClientRole",s.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",s.ENABLE_DUAL_STREAM="Client.enableDualStream",s.DISABLE_DUAL_STREAM="Client.disableDualStream",s.JOIN="Client.join",s.LEAVE="Client.leave",s.PUBLISH="Client.publish",s.UNPUBLISH="Client.unpublish",s.SUBSCRIBE="Client.subscribe",s.MASS_SUBSCRIBE="Client.massSubscribe",s.MASS_UNSUBSCRIBE="Client.massUnsubscribe",s.UNSUBSCRIBE="Client.unsubscribe",s.RENEW_TOKEN="Client.renewToken",s.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",s.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",s.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",s.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",s.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",s.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",s.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",s.DATACHANNEL_FAILBACK="Client._datachannelFailback",s.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",s.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",s.START_LIVE_STREAMING="Client.startLiveStreaming",s.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",s.STOP_LIVE_STREAMING="Client.stopLiveStreaming",s.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",s.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",s.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",s.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",s.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",s.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",s.SET_CONFIG_DISTRIBUTE="_configDistribute",s.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",s.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",s.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",s.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",s.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",s.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",s.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",s.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",s.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",s.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",s.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",s.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",s.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",s.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",s.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",s.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",s.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",s.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",s.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",s.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",s.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",s.STREAM_TYPE_CHANGE="streamTypeChange",s.CONNECTION_STATE_CHANGE="connectionStateChange",s.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",s.IMAGE_MODERATION_UPLOAD="imageModerationUpload"})(Nn||(Nn={})),function(s){s.TRACER="tracer"}(Jt||(Jt={})),function(s){s[s.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",s[s.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",s[s.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(wA||(wA={})),function(s){s.LEAVE="LEAVE",s.NETWORK_ERROR="NETWORK_ERROR",s.SERVER_ERROR="SERVER_ERROR",s.UID_BANNED="UID_BANNED",s.IP_BANNED="IP_BANNED",s.CHANNEL_BANNED="CHANNEL_BANNED",s.FALLBACK="FALLBACK",s.LICENSE_MISSING="LICENSE_MISSING",s.LICENSE_EXPIRED="LICENSE_EXPIRED",s.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",s.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",s.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",s.LICENSE_ILLEGAL="LICENSE_ILLEGAL",s.TOKEN_EXPIRE="TOKEN_EXPIRE"}(Ye||(Ye={})),function(s){s.CONNECTION_STATE_CHANGE="connection-state-change",s.MEDIA_RECONNECT_START="media-reconnect-start",s.MEDIA_RECONNECT_END="media-reconnect-end",s.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",s.USER_JOINED="user-joined",s.USER_LEAVED="user-left",s.USER_PUBLISHED="user-published",s.USER_UNPUBLISHED="user-unpublished",s.USER_INFO_UPDATED="user-info-updated",s.CLIENT_BANNED="client-banned",s.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",s.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",s.VOLUME_INDICATOR="volume-indicator",s.CRYPT_ERROR="crypt-error",s.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",s.NETWORK_QUALITY="network-quality",s.STREAM_TYPE_CHANGED="stream-type-changed",s.STREAM_FALLBACK="stream-fallback",s.RECEIVE_METADATA="receive-metadata",s.STREAM_MESSAGE="stream-message",s.LIVE_STREAMING_ERROR="live-streaming-error",s.LIVE_STREAMING_WARNING="live-streaming-warning",s.INJECT_STREAM_STATUS="stream-inject-status",s.EXCEPTION="exception",s.ERROR="error",s.P2P_LOST="p2p_lost",s.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",s.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",s.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",s.PUBLISHED_USER_LIST="published-user-list",s.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",s.CONTENT_INSPECT_ERROR="content-inspect-error",s.CONTENT_INSPECT_RESULT="content-inspect-result",s.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(Xe||(Xe={})),function(s){s.NETWORK_ERROR="NETWORK_ERROR",s.SERVER_ERROR="SERVER_ERROR",s.MULTI_IP="MULTI_IP",s.TIMEOUT="TIMEOUT",s.OFFLINE="OFFLINE",s.LEAVE="LEAVE",s.P2P_FAILED="P2P_FAILED",s.FALLBACK="FALLBACK"}(Kn||(Kn={})),function(s){s.ONLINE="ONLINE",s.OFFLINE="OFFLINE"}(Yi||(Yi={})),function(s){s.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",s.ONLINE="ONLINE",s.OFFLINE="OFFLINE"}(lc||(lc={}));const on=new class extends qt{set networkState(s){this.emit(lc.NETWORK_STATE_CHANGE,s,this._networkState),s===Yi.ONLINE?this.emit(lc.ONLINE):s===Yi.OFFLINE&&(this.onlineWaiter=new z(n=>{this.once(lc.ONLINE,()=>{this.onlineWaiter=void 0,n(Yi.ONLINE)})}),this.emit(lc.OFFLINE)),this._networkState=s}get networkState(){return this._networkState}get isOnline(){return this._networkState===Yi.ONLINE}constructor(){super(),C(this,"_moduleName","network-indicator"),C(this,"_networkState",Yi.ONLINE),C(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Yi.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Yi.OFFLINE})}};function IA(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function ld(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?IA(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):IA(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function _S(s,n){const r=s.indexOf(n);-1!==r&&s.splice(r,1)}function rh(s){const n=[];return s.forEach(r=>{-1===n.indexOf(r)&&n.push(r)}),n}function mo(s){void 0!==z?z.resolve().then(s):setTimeout(s,0)}function hn(s){return JSON.parse(JSON.stringify(s))}function Da(s){try{return hn(s)}catch{return s}}const Tk={};function uf(s,n){Tk[n]||(Tk[n]=!0,s())}function jg(s){const n=window.atob(s),r=new Uint8Array(new ArrayBuffer(n.length));for(let a=0;a<n.length;a+=1)r[a]=n.charCodeAt(a);return r}function oh(s){let n="";for(let r=0;r<s.length;r+=1)n+=String.fromCharCode(s[r]);return window.btoa(n)}function Oa(s){return window.TextEncoder?(new TextEncoder).encode(s).length:s.length}function gS(s){let n=0;return/DingTalk/i.test(navigator.userAgent)&&s.realFormData&&(s=s.realFormData),s.forEach(r=>{n+="string"==typeof r?Oa(r):r.size}),n+138}function wk(s){const n=new X(M.TIMEOUT,"timeout");return new z((r,a)=>{window.setTimeout(()=>a(n),s)})}function gi(s){return new z(n=>{window.setTimeout(n,s)})}function Fe(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,n=arguments.length>1?arguments[1]:void 0;const r=Math.random().toString(16).substr(2,s).toLowerCase();return r.length===s?"".concat(n).concat(r):"".concat(n).concat(r)+Fe(s-r.length,"")}function Hg(){return Fe(32,"").toUpperCase()}const hf=()=>{},RA=new class{constructor(){C(this,"fnMap",new Map)}throttleByKey(s,n,r,a){for(var l=arguments.length,d=new Array(l>4?l-4:0),h=4;h<l;h++)d[h-4]=arguments[h];if(this.fnMap.has(n)){const p=this.fnMap.get(n);if(p.threshold!==r){p.fn(...p.args),clearTimeout(p.timer);const m=window.setTimeout(()=>{const _=this.fnMap.get(n);_&&_.fn(..._.args),this.fnMap.delete(n)},r);this.fnMap.set(n,{fn:s,threshold:r,timer:m,args:d,skipFn:a})}else p.skipFn&&p.skipFn(...p.args),this.fnMap.set(n,ld(ld({},p),{},{fn:s,args:d,skipFn:a}))}else{const p=window.setTimeout(()=>{const m=this.fnMap.get(n);m&&m.fn(...m.args),this.fnMap.delete(n)},r);this.fnMap.set(n,{fn:s,threshold:r,timer:p,args:d,skipFn:a})}}},AA=RA.throttleByKey.bind(RA);function DA(s){return"object"==typeof s&&null!==s&&!(s instanceof RegExp)}function dd(s,n){if(!DA(s)||!DA(n)||Array.isArray(s)&&!Array.isArray(n)||!Array.isArray(s)&&Array.isArray(n))return n;if(Array.isArray(n)&&Array.isArray(s)){const r=[...s];for(let a=0;a<n.length;a++)r[a]=dd(s[a],n[a]);return r}{const r=ld({},s);for(const a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=Object.prototype.hasOwnProperty.call(s,a)?dd(s[a],n[a]):n[a]);return r}}let Qe=1,sh=console;class Zn{static setLogger(n){sh=n}constructor(n){C(this,"lockingPromise",z.resolve()),C(this,"locks",0),C(this,"name",""),C(this,"lockId",void 0),this.lockId=Qe++,n&&(this.name=n),sh.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(n){let r;this.locks+=1,sh.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof n?n:""));const a=new z(d=>{r=()=>{this.locks-=1,sh.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof n?n:"")),d()}}),l=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>a),l}}function Pe(s,n){return function(r,a,l){const d=l.value;if("function"!=typeof d)throw new Error("Cannot use mutex on object property.");return l.value=x(function*(){const h=this[n];if(!h)throw new Error("mutex property key ".concat(n," doesn't exist on ").concat(s));const p=yield h.lock("From ".concat(s,".").concat(a));try{for(var m=arguments.length,_=new Array(m),E=0;E<m;E++)_[E]=arguments[E];return yield d.apply(this,_)}finally{p()}}),l}}const Re={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function wt(s,n){const r=Math.floor(n.timeout*Math.pow(n.timeoutFactor,s));return Math.min(n.maxRetryTimeout,r)}function gs(s,n,r,a){const l=Object.assign({},Re,a);let d=l.timeout;const h=function(){var _=x(function*(){var E;yield(E=d,new z(v=>{window.setTimeout(v,E)})),d*=l.timeoutFactor,d=Math.min(l.maxRetryTimeout,d)});return function(){return _.apply(this,arguments)}}();let p=!1;const m=new z(function(){var _=x(function*(E,v){n=n||(()=>!1),r=r||(()=>!0);for(let b=0;b<l.maxRetryCount;b+=1){if(p)return v(new X(M.OPERATION_ABORTED));try{const T=yield s();if(!n(T,b)||b+1===l.maxRetryCount)return E(T);yield h()}catch(T){if(!r(T,b)||b+1===l.maxRetryCount)return v(T);yield h()}}});return function(E,v){return _.apply(this,arguments)}}());return m.cancel=()=>p=!0,m}var Ik=oo,Rk=iu,Ak=ap,pf=ps,ff=TypeError,ES=function(s){return function(n,r,a,l){Ik(r);var d=Rk(n),h=Ak(d),p=pf(d),m=s?p-1:0,_=s?-1:1;if(a<2)for(;;){if(m in h){l=h[m],m+=_;break}if(m+=_,s?m<0:p<=m)throw ff("Reduce of empty array with no initial value")}for(;s?m>=0:p>m;m+=_)m in h&&(l=r(l,h[m],m,d));return l}},OA=[ES(!1),ES(!0)][0];Ct({target:"Array",proto:!0,forced:!zu&&zn>79&&zn<83||!Fu("reduce")},{reduce:function(s){var n=arguments.length;return OA(this,s,n,n>1?arguments[1]:void 0)}});var Dk=ke("Array").reduce,Ok=xs,ah=Dk,ud=Array.prototype,al=cr(function(s){var n=s.reduce;return s===ud||Ok(ud,s)&&n===ud.reduce?ah:n});let tn=class{constructor(s){C(this,"input",[]),C(this,"size",void 0),this.size=s}add(s){this.input.push(s),this.input.length>this.size&&this.input.splice(0,1)}mean(){var s;return 0===this.input.length?0:al(s=this.input).call(s,(n,r)=>n+r)/this.input.length}};var Gg,vS={exports:{}},yS=function(s,n){return function(){for(var r=new Array(arguments.length),a=0;a<r.length;a++)r[a]=arguments[a];return s.apply(n,r)}},NA=yS,Wg=Object.prototype.toString,nn=(Gg=Object.create(null),function(s){var n=Wg.call(s);return Gg[n]||(Gg[n]=n.slice(8,-1).toLowerCase())});function hd(s){return s=s.toLowerCase(),function(n){return nn(n)===s}}function pd(s){return Array.isArray(s)}function nr(s){return void 0===s}var bS=hd("ArrayBuffer");function zg(s){return null!==s&&"object"==typeof s}function mf(s){if("object"!==nn(s))return!1;var n=Object.getPrototypeOf(s);return null===n||n===Object.prototype}var PA=hd("Date"),MA=hd("File"),xA=hd("Blob"),kA=hd("FileList");function qg(s){return"[object Function]"===Wg.call(s)}var LA=hd("URLSearchParams");function Kg(s,n){if(null!=s)if("object"!=typeof s&&(s=[s]),pd(s))for(var r=0,a=s.length;r<a;r++)n.call(null,s[r],r,s);else for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&n.call(null,s[l],l,s)}var ch,cl=(ch=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(s){return ch&&s instanceof ch}),gr={isArray:pd,isArrayBuffer:bS,isBuffer:function(s){return null!==s&&!nr(s)&&null!==s.constructor&&!nr(s.constructor)&&"function"==typeof s.constructor.isBuffer&&s.constructor.isBuffer(s)},isFormData:function(s){var n="[object FormData]";return s&&("function"==typeof FormData&&s instanceof FormData||Wg.call(s)===n||qg(s.toString)&&s.toString()===n)},isArrayBufferView:function(s){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(s):s&&s.buffer&&bS(s.buffer)},isString:function(s){return"string"==typeof s},isNumber:function(s){return"number"==typeof s},isObject:zg,isPlainObject:mf,isUndefined:nr,isDate:PA,isFile:MA,isBlob:xA,isFunction:qg,isStream:function(s){return zg(s)&&qg(s.pipe)},isURLSearchParams:LA,isStandardBrowserEnv:function(){return(typeof navigator>"u"||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&typeof window<"u"&&typeof document<"u"},forEach:Kg,merge:function s(){var n={};function r(d,h){n[h]=mf(n[h])&&mf(d)?s(n[h],d):mf(d)?s({},d):pd(d)?d.slice():d}for(var a=0,l=arguments.length;a<l;a++)Kg(arguments[a],r);return n},extend:function(s,n,r){return Kg(n,function(a,l){s[l]=r&&"function"==typeof a?NA(a,r):a}),s},trim:function(s){return s.trim?s.trim():s.replace(/^\s+|\s+$/g,"")},stripBOM:function(s){return 65279===s.charCodeAt(0)&&(s=s.slice(1)),s},inherits:function(s,n,r,a){s.prototype=Object.create(n.prototype,a),s.prototype.constructor=s,r&&Object.assign(s.prototype,r)},toFlatObject:function(s,n,r){var a,l,d,h={};n=n||{};do{for(l=(a=Object.getOwnPropertyNames(s)).length;l-- >0;)h[d=a[l]]||(n[d]=s[d],h[d]=!0);s=Object.getPrototypeOf(s)}while(s&&(!r||r(s,n))&&s!==Object.prototype);return n},kindOf:nn,kindOfTest:hd,endsWith:function(s,n,r){s=String(s),(void 0===r||r>s.length)&&(r=s.length);var a=s.indexOf(n,r-=n.length);return-1!==a&&a===r},toArray:function(s){if(!s)return null;var n=s.length;if(nr(n))return null;for(var r=new Array(n);n-- >0;)r[n]=s[n];return r},isTypedArray:cl,isFileList:kA},lh=gr;function Yg(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var ll=function(s,n,r){if(!n)return s;var a;if(r)a=r(n);else if(lh.isURLSearchParams(n))a=n.toString();else{var l=[];lh.forEach(n,function(h,p){null!=h&&(lh.isArray(h)?p+="[]":h=[h],lh.forEach(h,function(m){lh.isDate(m)?m=m.toISOString():lh.isObject(m)&&(m=JSON.stringify(m)),l.push(Yg(p)+"="+Yg(m))}))}),a=l.join("&")}if(a){var d=s.indexOf("#");-1!==d&&(s=s.slice(0,d)),s+=(-1===s.indexOf("?")?"?":"&")+a}return s},SS=gr;function $g(){this.handlers=[]}$g.prototype.use=function(s,n,r){return this.handlers.push({fulfilled:s,rejected:n,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},$g.prototype.eject=function(s){this.handlers[s]&&(this.handlers[s]=null)},$g.prototype.forEach=function(s){SS.forEach(this.handlers,function(n){null!==n&&s(n)})};var Xg,Nk,NV=$g,Pk=gr;function dh(){if(Nk)return Xg;Nk=1;var s=gr;function n(l,d,h,p,m){Error.call(this),this.message=l,this.name="AxiosError",d&&(this.code=d),h&&(this.config=h),p&&(this.request=p),m&&(this.response=m)}s.inherits(n,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var r=n.prototype,a={};return["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(l){a[l]={value:l}}),Object.defineProperties(n,a),Object.defineProperty(r,"isAxiosError",{value:!0}),n.from=function(l,d,h,p,m,_){var E=Object.create(r);return s.toFlatObject(l,E,function(v){return v!==Error.prototype}),n.call(E,l.message,d,h,p,m),E.name=l.name,_&&Object.assign(E,_),E},Xg=n}var Jg,FA,Ui,CS,TS,UA,wS={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function VA(){if(FA)return Jg;FA=1;var s=gr;return Jg=function(n,r){r=r||new FormData;var a=[];function l(d){return null===d?"":s.isDate(d)?d.toISOString():s.isArrayBuffer(d)||s.isTypedArray(d)?"function"==typeof Blob?new Blob([d]):Buffer.from(d):d}return function d(h,p){if(s.isPlainObject(h)||s.isArray(h)){if(-1!==a.indexOf(h))throw Error("Circular reference detected in "+p);a.push(h),s.forEach(h,function(m,_){if(!s.isUndefined(m)){var E,v=p?p+"."+_:_;if(m&&!p&&"object"==typeof m)if(s.endsWith(_,"{}"))m=JSON.stringify(m);else if(s.endsWith(_,"[]")&&(E=s.toArray(m)))return void E.forEach(function(b){!s.isUndefined(b)&&r.append(v,l(b))});d(m,v)}}),a.pop()}else r.append(p,l(h))}(n),r}}var dl,HA,GA,IS,WA,RS,Mk,Qg,Vt,qs,zA,qA,Es=function(s,n){return s&&!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(n)?function(s,n){return n?s.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):s}(s,n):n};function Zg(){if(RS)return WA;RS=1;var s=dh();function n(r){s.call(this,r??"canceled",s.ERR_CANCELED),this.name="CanceledError"}return gr.inherits(n,s,{__CANCEL__:!0}),WA=n}var ir=gr,eE=function(s,n){Pk.forEach(s,function(r,a){a!==n&&a.toUpperCase()===n.toUpperCase()&&(s[n]=r,delete s[a])})},uh=dh(),Lk=wS,$A=VA(),Fk={"Content-Type":"application/x-www-form-urlencoded"};function XA(s,n){!ir.isUndefined(s)&&ir.isUndefined(s["Content-Type"])&&(s["Content-Type"]=n)}var AS,_f={transitional:Lk,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&"[object process]"===Object.prototype.toString.call(process))&&(AS=function kk(){if(qs)return Vt;qs=1;var s=gr,n=function BA(){if(CS)return Ui;CS=1;var s=dh();return Ui=function(n,r,a){var l=a.config.validateStatus;a.status&&l&&!l(a.status)?r(new s("Request failed with status code "+a.status,[s.ERR_BAD_REQUEST,s.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a)):n(a)}}(),r=function jA(){if(UA)return TS;UA=1;var s=gr;return TS=s.isStandardBrowserEnv()?{write:function(n,r,a,l,d,h){var p=[];p.push(n+"="+encodeURIComponent(r)),s.isNumber(a)&&p.push("expires="+new Date(a).toGMTString()),s.isString(l)&&p.push("path="+l),s.isString(d)&&p.push("domain="+d),!0===h&&p.push("secure"),document.cookie=p.join("; ")},read:function(n){var r=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}}(),a=ll,l=Es,d=function KA(){if(HA)return dl;HA=1;var s=gr,n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return dl=function(r){var a,l,d,h={};return r&&s.forEach(r.split("\n"),function(p){if(d=p.indexOf(":"),a=s.trim(p.substr(0,d)).toLowerCase(),l=s.trim(p.substr(d+1)),a){if(h[a]&&n.indexOf(a)>=0)return;h[a]="set-cookie"===a?(h[a]?h[a]:[]).concat([l]):h[a]?h[a]+", "+l:l}}),h}}(),h=function YA(){if(IS)return GA;IS=1;var s=gr;return GA=s.isStandardBrowserEnv()?function(){var n,r=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");function l(d){var h=d;return r&&(a.setAttribute("href",h),h=a.href),a.setAttribute("href",h),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:"/"===a.pathname.charAt(0)?a.pathname:"/"+a.pathname}}return n=l(window.location.href),function(d){var h=s.isString(d)?l(d):d;return h.protocol===n.protocol&&h.host===n.host}}():function(){return!0}}(),p=wS,m=dh(),_=Zg(),E=function xk(){return Qg||(Qg=1,Mk=function(s){var n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return n&&n[1]||""}),Mk}();return Vt=function(v){return new Promise(function(b,T){var O,P=v.data,D=v.headers,L=v.responseType;function V(){v.cancelToken&&v.cancelToken.unsubscribe(O),v.signal&&v.signal.removeEventListener("abort",O)}s.isFormData(P)&&s.isStandardBrowserEnv()&&delete D["Content-Type"];var U=new XMLHttpRequest;if(v.auth){var J=v.auth.username||"",se=v.auth.password?unescape(encodeURIComponent(v.auth.password)):"";D.Authorization="Basic "+btoa(J+":"+se)}var q=l(v.baseURL,v.url);function Q(){if(U){var me="getAllResponseHeaders"in U?d(U.getAllResponseHeaders()):null;n(function(Ze){b(Ze),V()},function(Ze){T(Ze),V()},{data:L&&"text"!==L&&"json"!==L?U.response:U.responseText,status:U.status,statusText:U.statusText,headers:me,config:v,request:U}),U=null}}if(U.open(v.method.toUpperCase(),a(q,v.params,v.paramsSerializer),!0),U.timeout=v.timeout,"onloadend"in U?U.onloadend=Q:U.onreadystatechange=function(){U&&4===U.readyState&&(0!==U.status||U.responseURL&&0===U.responseURL.indexOf("file:"))&&setTimeout(Q)},U.onabort=function(){U&&(T(new m("Request aborted",m.ECONNABORTED,v,U)),U=null)},U.onerror=function(){T(new m("Network Error",m.ERR_NETWORK,v,U,U)),U=null},U.ontimeout=function(){var me=v.timeout?"timeout of "+v.timeout+"ms exceeded":"timeout exceeded";v.timeoutErrorMessage&&(me=v.timeoutErrorMessage),T(new m(me,(v.transitional||p).clarifyTimeoutError?m.ETIMEDOUT:m.ECONNABORTED,v,U)),U=null},s.isStandardBrowserEnv()){var $=(v.withCredentials||h(q))&&v.xsrfCookieName?r.read(v.xsrfCookieName):void 0;$&&(D[v.xsrfHeaderName]=$)}"setRequestHeader"in U&&s.forEach(D,function(me,Ee){void 0===P&&"content-type"===Ee.toLowerCase()?delete D[Ee]:U.setRequestHeader(Ee,me)}),s.isUndefined(v.withCredentials)||(U.withCredentials=!!v.withCredentials),L&&"json"!==L&&(U.responseType=v.responseType),"function"==typeof v.onDownloadProgress&&U.addEventListener("progress",v.onDownloadProgress),"function"==typeof v.onUploadProgress&&U.upload&&U.upload.addEventListener("progress",v.onUploadProgress),(v.cancelToken||v.signal)&&(O=function(me){U&&(T(!me||me&&me.type?new _:me),U.abort(),U=null)},v.cancelToken&&v.cancelToken.subscribe(O),v.signal&&(v.signal.aborted?O():v.signal.addEventListener("abort",O))),P||(P=null);var Y=E(q);Y&&-1===["http","https","file"].indexOf(Y)?T(new m("Unsupported protocol "+Y+":",m.ERR_BAD_REQUEST,v)):U.send(P)})}}()),AS),transformRequest:[function(s,n){if(eE(n,"Accept"),eE(n,"Content-Type"),ir.isFormData(s)||ir.isArrayBuffer(s)||ir.isBuffer(s)||ir.isStream(s)||ir.isFile(s)||ir.isBlob(s))return s;if(ir.isArrayBufferView(s))return s.buffer;if(ir.isURLSearchParams(s))return XA(n,"application/x-www-form-urlencoded;charset=utf-8"),s.toString();var r,a=ir.isObject(s),l=n&&n["Content-Type"];if((r=ir.isFileList(s))||a&&"multipart/form-data"===l){var d=this.env&&this.env.FormData;return $A(r?{"files[]":s}:s,d&&new d)}return a||"application/json"===l?(XA(n,"application/json"),function(h,p,m){if(ir.isString(h))try{return(0,JSON.parse)(h),ir.trim(h)}catch(_){if("SyntaxError"!==_.name)throw _}return(0,JSON.stringify)(h)}(s)):s}],transformResponse:[function(s){var n=this.transitional||_f.transitional,l=!(n&&n.silentJSONParsing)&&"json"===this.responseType;if(l||n&&n.forcedJSONParsing&&ir.isString(s)&&s.length)try{return JSON.parse(s)}catch(d){if(l)throw"SyntaxError"===d.name?uh.from(d,uh.ERR_BAD_RESPONSE,this,null,this.response):d}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:qA?zA:(qA=1,zA=null)},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};ir.forEach(["delete","get","head"],function(s){_f.headers[s]={}}),ir.forEach(["post","put","patch"],function(s){_f.headers[s]=ir.merge(Fk)});var gf,JA,tE=_f,Or=gr,QA=tE;function ZA(){return JA?gf:(JA=1,gf=function(s){return!(!s||!s.__CANCEL__)})}var eD=gr,uc=function(s,n,r){var a=this||QA;return Or.forEach(r,function(l){s=l.call(a,s,n)}),s},Ef=ZA(),tD=tE,nD=Zg();function nE(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new nD}var DS,OS,_o=gr,NS=function(s,n){n=n||{};var r={};function a(_,E){return _o.isPlainObject(_)&&_o.isPlainObject(E)?_o.merge(_,E):_o.isPlainObject(E)?_o.merge({},E):_o.isArray(E)?E.slice():E}function l(_){return _o.isUndefined(n[_])?_o.isUndefined(s[_])?void 0:a(void 0,s[_]):a(s[_],n[_])}function d(_){if(!_o.isUndefined(n[_]))return a(void 0,n[_])}function h(_){return _o.isUndefined(n[_])?_o.isUndefined(s[_])?void 0:a(void 0,s[_]):a(void 0,n[_])}function p(_){return _ in n?a(s[_],n[_]):_ in s?a(void 0,s[_]):void 0}var m={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:p};return _o.forEach(Object.keys(s).concat(Object.keys(n)),function(_){var E=m[_]||l,v=E(_);_o.isUndefined(v)&&E!==p||(r[_]=v)}),r};function PS(){return OS?DS:(OS=1,DS={version:"0.27.2"})}var Uk=PS().version,ul=dh(),MS={};["object","boolean","number","function","string","symbol"].forEach(function(s,n){MS[s]=function(r){return typeof r===s||"a"+(n<1?"n ":" ")+s}});var iD={};MS.transitional=function(s,n,r){function a(l,d){return"[Axios v"+Uk+"] Transitional option '"+l+"'"+d+(r?". "+r:"")}return function(l,d,h){if(!1===s)throw new ul(a(d," has been removed"+(n?" in "+n:"")),ul.ERR_DEPRECATED);return n&&!iD[d]&&(iD[d]=!0,console.warn(a(d," has been deprecated since v"+n+" and will be removed in the near future"))),!s||s(l,d,h)}};var rD,oD,sD,aD,cD,lD,dD=gr,Bk=ll,uD=NV,hD=function(s){return nE(s),s.headers=s.headers||{},s.data=uc.call(s,s.data,s.headers,s.transformRequest),s.headers=eD.merge(s.headers.common||{},s.headers[s.method]||{},s.headers),eD.forEach(["delete","get","head","post","put","patch","common"],function(n){delete s.headers[n]}),(s.adapter||tD.adapter)(s).then(function(n){return nE(s),n.data=uc.call(s,n.data,n.headers,s.transformResponse),n},function(n){return Ef(n)||(nE(s),n&&n.response&&(n.response.data=uc.call(s,n.response.data,n.response.headers,s.transformResponse))),Promise.reject(n)})},iE=NS,jk=Es,pD={assertOptions:function(s,n,r){if("object"!=typeof s)throw new ul("options must be an object",ul.ERR_BAD_OPTION_VALUE);for(var a=Object.keys(s),l=a.length;l-- >0;){var d=a[l],h=n[d];if(h){var p=s[d],m=void 0===p||h(p,d,s);if(!0!==m)throw new ul("option "+d+" must be "+m,ul.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new ul("Unknown option "+d,ul.ERR_BAD_OPTION)}},validators:MS},fd=pD.validators;function md(s){this.defaults=s,this.interceptors={request:new uD,response:new uD}}md.prototype.request=function(s,n){"string"==typeof s?(n=n||{}).url=s:n=s||{},n.method=(n=iE(this.defaults,n)).method?n.method.toLowerCase():this.defaults.method?this.defaults.method.toLowerCase():"get";var r=n.transitional;void 0!==r&&pD.assertOptions(r,{silentJSONParsing:fd.transitional(fd.boolean),forcedJSONParsing:fd.transitional(fd.boolean),clarifyTimeoutError:fd.transitional(fd.boolean)},!1);var a=[],l=!0;this.interceptors.request.forEach(function(v){"function"==typeof v.runWhen&&!1===v.runWhen(n)||(l=l&&v.synchronous,a.unshift(v.fulfilled,v.rejected))});var d,h=[];if(this.interceptors.response.forEach(function(v){h.push(v.fulfilled,v.rejected)}),!l){var p=[hD,void 0];for(Array.prototype.unshift.apply(p,a),p=p.concat(h),d=Promise.resolve(n);p.length;)d=d.then(p.shift(),p.shift());return d}for(var m=n;a.length;){var _=a.shift(),E=a.shift();try{m=_(m)}catch(v){E(v);break}}try{d=hD(m)}catch(v){return Promise.reject(v)}for(;h.length;)d=d.then(h.shift(),h.shift());return d},md.prototype.getUri=function(s){s=iE(this.defaults,s);var n=jk(s.baseURL,s.url);return Bk(n,s.params,s.paramsSerializer)},dD.forEach(["delete","get","head","options"],function(s){md.prototype[s]=function(n,r){return this.request(iE(r||{},{method:s,url:n,data:(r||{}).data}))}}),dD.forEach(["post","put","patch"],function(s){function n(r){return function(a,l,d){return this.request(iE(d||{},{method:s,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:l}))}}md.prototype[s]=n(),md.prototype[s+"Form"]=n(!0)});var xS=gr,fD=yS,vf=md,mD=NS,$r=function s(n){var r=new vf(n),a=fD(vf.prototype.request,r);return xS.extend(a,vf.prototype,r),xS.extend(a,r),a.create=function(l){return s(mD(n,l))},a}(tE);$r.Axios=vf,$r.CanceledError=Zg(),$r.CancelToken=function(){if(oD)return rD;oD=1;var s=Zg();function n(r){if("function"!=typeof r)throw new TypeError("executor must be a function.");var a;this.promise=new Promise(function(d){a=d});var l=this;this.promise.then(function(d){if(l._listeners){var h,p=l._listeners.length;for(h=0;h<p;h++)l._listeners[h](d);l._listeners=null}}),this.promise.then=function(d){var h,p=new Promise(function(m){l.subscribe(m),h=m}).then(d);return p.cancel=function(){l.unsubscribe(h)},p},r(function(d){l.reason||(l.reason=new s(d),a(l.reason))})}return n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.prototype.subscribe=function(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]},n.prototype.unsubscribe=function(r){if(this._listeners){var a=this._listeners.indexOf(r);-1!==a&&this._listeners.splice(a,1)}},n.source=function(){var r;return{token:new n(function(a){r=a}),cancel:r}},rD=n}(),$r.isCancel=ZA(),$r.VERSION=PS().version,$r.toFormData=VA(),$r.AxiosError=dh(),$r.Cancel=$r.CanceledError,$r.all=function(s){return Promise.all(s)},$r.spread=aD?sD:(aD=1,sD=function(s){return function(n){return s.apply(null,n)}}),$r.isAxiosError=function(){if(lD)return cD;lD=1;var s=gr;return cD=function(n){return s.isObject(n)&&!0===n.isAxiosError}}(),vS.exports=$r,vS.exports.default=$r;var Er=cr(vS.exports);function kS(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function hh(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?kS(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):kS(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}let yf,Pa=0,LS=0;function FS(s,n,r,a){return new z((l,d)=>{n.responseType=n.responseType||"json",n.data&&!r?(n.data=JSON.stringify(n.data),Pa+=Oa(n.data)):r&&(n.data.size?Pa+=n.data.size:n.data instanceof FormData?Pa+=gS(n.data):Pa+=Oa(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=s,Er.request(n).then(h=>{"string"==typeof h.data?LS+=Oa(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?LS+=h.data.byteLength:LS+=Oa(JSON.stringify(h.data)),a&&l({data:h.data,headers:h.headers}),l(h.data)}).catch(h=>{Er.isCancel(h)?d(new X(M.OPERATION_ABORTED,"cancel token canceled")):d("ECONNABORTED"===h.code?new X(M.NETWORK_TIMEOUT,h.message):h.response?new X(M.NETWORK_RESPONSE_ERROR,h.response.status):new X(M.NETWORK_ERROR,h.message))})})}function ph(s,n){return _D.apply(this,arguments)}function _D(){return _D=x(function*(s,n){const r=new Blob([n.data],{type:"buffer"});return yield FS(s,hh(hh({},n),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}),_D.apply(this,arguments)}const Hk=()=>void 0!==window.isSecureContext;function US(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Te(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?US(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):US(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}var et;!function(s){s.SET_SESSION_ID="SET_SESSION_ID",s.SET_P2P_ID="SET_P2P_id",s.SET_DC_ID="SET_DC_id",s.SET_UID="SET_UID",s.SET_PUB_ID="SET_PUB_ID",s.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",s.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",s.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",s.AVOID_JOIN_START="AVOID_JOIN_START",s.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",s.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",s.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",s.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",s.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",s.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",s.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",s.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",s.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",s.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",s.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",s.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",s.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",s.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",s.RESET_KEY_METRICS="RESET_KEY_METRICS",s.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",s.SET_USE_P2P="SET_USE_P2P"}(et||(et={}));class Vn{constructor(n,r,a,l){C(this,"state",void 0),this.state={codec:n,audioCodec:r,mode:a,clientId:l,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1}}dispatch(n){this.state=function(r,a){switch(a.type){case et.SET_SESSION_ID:return Te(Te({},r),{},{sessionId:a.sessionId});case et.SET_P2P_ID:return Te(Te({},r),{},{p2pId:a.p2pId});case et.SET_UID:return Te(Te({},r),{},{uid:a.uid});case et.SET_PUB_ID:return Te(Te({},r),{},{pubId:a.pubId});case et.KEY_METRIC_CLIENT_CREATED:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{clientCreated:a.metric})});case et.KEY_METRIC_JOIN_START:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{joinStart:a.metric})});case et.AVOID_JOIN_START:return Te(Te({},r),{},{avoidJoinStart:a.avoidJoinStart});case et.KEY_METRIC_JOIN_END:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{joinEnd:a.metric})});case et.KEY_METRIC_REQUEST_AP_START:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{requestAPStart:a.metric})});case et.KEY_METRIC_REQUEST_AP_END:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{requestAPEnd:a.metric})});case et.KEY_METRIC_JOIN_GATEWAY_START:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{joinGatewayStart:a.metric})});case et.KEY_METRIC_JOIN_GATEWAY_END:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{joinGatewayEnd:a.metric})});case et.KEY_METRIC_PEER_CONNECTION_START:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{peerConnectionStart:a.metric})});case et.KEY_METRIC_PEER_CONNECTION_END:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{peerConnectionEnd:a.metric})});case et.KEY_METRIC_DESCRIPTION_START:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{descriptionStart:a.metric})});case et.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{signalChannelOpen:a.metric})});case et.KEY_METRIC_ICE_CONNECTION_END:return Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{iceConnectionEnd:a.metric})});case et.KEY_METRIC_PUBLISH:{const l=r.keyMetrics.publish,d=l.findIndex(h=>h.trackId===a.metric.trackId);return-1!==d?(l[d]=Te(Te({},l[d]),a.metric),Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{publish:[...l]})})):Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{publish:[...r.keyMetrics.publish,a.metric]})})}case et.KEY_METRIC_SUBSCRIBE:{const l=r.keyMetrics.subscribe,d=l.findIndex(h=>h.userId===a.metric.userId&&h.type===a.metric.type);return-1!==d?(l[d]=Te(Te({},l[d]),a.metric),Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{subscribe:[...l]})})):Te(Te({},r),{},{keyMetrics:Te(Te({},r.keyMetrics),{},{subscribe:[...r.keyMetrics.subscribe,a.metric]})})}case et.SET_CLOUD_PROXY_SERVER_MODE:return r.cloudProxyServerMode=a.mode,r;case et.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof a.index?r.joinChannelServiceRecords=[...r.joinChannelServiceRecords,a.record]:(r.joinChannelServiceRecords[a.index]=Te(Te({},r.joinChannelServiceRecords[a.index]),a.record),r.joinChannelServiceRecords=[...r.joinChannelServiceRecords]),r;case et.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return r.joinChannelServiceRecords=[],r;case et.RESET_KEY_METRICS:return r.keyMetrics={publish:[],subscribe:[]},r;case et.SET_USE_DATACHANNEL:return Te(Te({},r),{},{useDataChannel:a.val});case et.SET_USE_P2P:return Te(Te({},r),{},{useP2P:a.val});default:return r}}(this.state,n)}set sessionId(n){this.dispatch({type:et.SET_SESSION_ID,sessionId:n})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(n){this.dispatch({type:et.SET_P2P_ID,p2pId:n})}get p2pId(){return this.state.p2pId}set dcId(n){this.dispatch({type:et.SET_DC_ID,dcId:n})}get dcId(){return this.state.dcId}set uid(n){this.dispatch({type:et.SET_UID,uid:n})}get uid(){return this.state.uid}set pubId(n){this.dispatch({type:et.SET_PUB_ID,pubId:n})}get pubId(){return this.state.pubId}set cloudProxyServerMode(n){this.dispatch({type:et.SET_CLOUD_PROXY_SERVER_MODE,mode:n})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(n){this.dispatch({type:et.SET_USE_DATACHANNEL,val:n})}get useDataChannel(){return this.state.useDataChannel}set useP2P(n){this.dispatch({type:et.SET_USE_P2P,val:n})}get useP2P(){return this.state.useP2P}clientCreated(){this.dispatch({type:et.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:et.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:et.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:et.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:et.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:et.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:et.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:et.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:et.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:et.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:et.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:et.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(n,r,a,l){this.dispatch({type:et.KEY_METRIC_PUBLISH,metric:Te(Te({trackId:n,type:r},a&&{publishStart:a}),l&&{publishEnd:l})})}subscribe(n,r,a,l,d,h,p){this.dispatch({type:et.KEY_METRIC_SUBSCRIBE,metric:Te(Te(Te(Te(Te({userId:n,type:r},a&&{subscribeStart:a}),l&&{subscribeEnd:l}),d&&{firstFrame:d}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(n,r,a,l){n.forEach(d=>{this.dispatch({type:et.KEY_METRIC_SUBSCRIBE,metric:Te(Te(Te({userId:d.userId,type:d.type},r&&{subscribeStart:r}),a&&{subscribeEnd:a}),l&&{firstFrame:l})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(n,r){"gateway"===n.service&&Array.isArray(n.urls)&&(n.urls=n.urls.map(a=>a.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof r?(this.dispatch({type:et.RECORD_JOIN_CHANNEL_SERVICE,record:Te(Te({},n),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(r<0||r>=this.state.joinChannelServiceRecords.length||this.dispatch({type:et.RECORD_JOIN_CHANNEL_SERVICE,record:n,index:r}),r)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:et.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:et.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(n){this.dispatch({type:et.AVOID_JOIN_START,avoidJoinStart:n})}}const $o=function(s){if(s.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return s;const n=s.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(n&&n[1]&&n[2]){const l=n[2];return"".concat(n[1],".").concat(l)}const r=s.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(r&&r[1]&&r[2]){const l=r[2];return"".concat(r[1],".").concat(100*(Number(l)+1))}return"4.0.0.999"}("4.19.2"),VS=function(){try{return!0===JSON.parse("true")}catch{return!0}}(),BS="v4.19.2-0-g791c0f00(10/18/2023, 4:17:50 PM)",oi={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:100,PROFILE_SWITCH_INTERVAL:2e3,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,RTM2_FLAG:void 0,AP_RTM:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,USE_XR:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:1e4,P2P:!1,SHOW_P2P_LOG:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[]};function At(s,n,r){var a,l;ye(a=Object.keys(oi)).call(a,s)&&(!r&&ye(l=Object.keys(Ys)).call(l,s)||(oi[s]=n))}function j(s){return oi[s]}const Ys={};var Vi,Gk;(function(s){s.h264="h264",s.h265="h265",s.vp8="vp8",s.vp9="vp9",s.av1="av1"})(Vi||(Vi={})),function(s){s.opus="opus",s.pcma="pcma",s.pcmu="pcmu",s.g722="g722"}(Gk||(Gk={}));const bf=new class extends qt{reportLogUploadError(s){this.emit("REPORT_LOG_UPLOAD",s)}};class gD{constructor(n){C(this,"logger",void 0),C(this,"prefixLists",[]),this.logger=n}debug(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];this.logger.debug(...this.prefixLists,...r)}info(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];this.logger.info(...this.prefixLists,...r)}warning(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];this.logger.warning(...this.prefixLists,...r)}error(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];this.logger.error(...this.prefixLists,...r)}prefix(n){return this.prefixLists.push(n),this}popPrefix(){return this.prefixLists.pop(),this}}function jS(){const s=new Date;return s.toTimeString().split(" ")[0]+":"+s.getMilliseconds()}function HS(){const s=new Date,n=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return n?n?.[0]+":"+s.getUTCMilliseconds():s.toTimeString().split(" ")[0]+":"+s.getMilliseconds()}const go={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Sf=Date.now(),fh=s=>{for(const n in go)if(Object.prototype.hasOwnProperty.call(go,n)&&go[n]===s)return n;return"DEFAULT"},w=new class{constructor(){C(this,"proxyServerURL",void 0),C(this,"logLevel",go.DEBUG),C(this,"uploadState","collecting"),C(this,"uploadLogWaitingList",[]),C(this,"uploadLogUploadingList",[]),C(this,"uploadErrorCount",0),C(this,"currentLogID",0),C(this,"url",void 0),C(this,"extLog",(s,n)=>{this.appendLogToWaitingList(s,...n)})}debug(){for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];const a=[go.DEBUG].concat(n);this.log.apply(this,a)}info(){for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];const a=[go.INFO].concat(n);this.log.apply(this,a)}warning(){for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];const a=[go.WARNING].concat(n);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];const a=[go.ERROR].concat(n);this.log.apply(this,a)}upload(){for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];const a=[go.DEBUG].concat(n);this.uploadLog.apply(this,a)}setLogLevel(s){s=Math.min(Math.max(0,s),4),this.logLevel=s}enableLogUpload(){At("UPLOAD_LOG",!0)}disableLogUpload(){At("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(s){this.proxyServerURL=s}prefix(s){return new gD(this).prefix(s)}log(){for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];if(Date.now()-Sf<100)return void setTimeout(()=>{this.log(...n)},Date.now()-Sf);const a=Math.max(0,Math.min(4,n[0]));if(n[0]=jS()+" Agora-SDK [".concat(fh(a),"]:"),this.appendLogToWaitingList(a,...n),a<this.logLevel)return;const l=jS()+" %cAgora-SDK [".concat(fh(a),"]:");let d=[];if(!j("USE_NEW_LOG"))switch(a){case go.DEBUG:d=[l,"color: #64B5F6;"].concat(n.slice(1)),console.log.apply(console,d);break;case go.INFO:d=[l,"color: #1E88E5; font-weight: bold;"].concat(n.slice(1)),console.log.apply(console,d);break;case go.WARNING:d=[l,"color: #FB8C00; font-weight: bold;"].concat(n.slice(1)),console.warn.apply(console,d);break;case go.ERROR:d=[l,"color: #B00020; font-weight: bold;"].concat(n.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];if(Date.now()-Sf<100)return void setTimeout(()=>{this.uploadLog(...n)},Date.now()-Sf);const a=Math.max(0,Math.min(4,n[0]));n[0]=jS()+" Agora-SDK [".concat(fh(a),"]:"),this.appendLogToWaitingList(a,...n)}appendLogToWaitingList(s){if(!j("UPLOAD_LOG"))return;for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];Array.isArray(r[0])?r[0][0]=HS()+" Agora-SDK [".concat(fh(s),"]:"):r[0]=HS()+" Agora-SDK [".concat(fh(s),"]:");let l="";r.forEach(d=>{"object"==typeof d&&(d=JSON.stringify(d)),l+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:l,log_level:s,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}uploadLogs(){var s=this;return x(function*(){const n=s.uploadLogUploadingList,r={sdk_version:$o,process_id:j("PROCESS_ID"),payload:JSON.stringify(n)};return gs(x(function*(){const a=yield Er.post(s.url||(s.proxyServerURL?"https://".concat(s.proxyServerURL,"/ls/?h=").concat(j("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(j("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if("OK"!==a.data){const l=new Error("unexpected upload log response");throw l.response=a,l}}),()=>(s.uploadLogUploadingList=[],!1),a=>(bf.reportLogUploadError(a.response?{status:a.response.status,data:a.response.data,headers:a.response.headers,message:a.message}:a.request?{status:a.request.status,message:a.message}:{status:-1,message:a.message}),!0),{timeout:j("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:j("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})})()}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,j("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_INTERVAL"))}).catch(s=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var ED,vD;function Cf(s){return Un(s.reportId,"params.reportId",0,100,!1),Un(s.category,"params.category",0,100,!1),Un(s.event,"params.event",0,100,!1),Un(s.label,"params.label",0,100,!1),ft(s.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(function(s){s.FREE="free",s.UPLOADING="uploading"})(ED||(ED={})),function(s){s[s.MISC=0]="MISC",s[s.INTERNAL_EVENT=1]="INTERNAL_EVENT",s[s.PUBLIC_EVENT=2]="PUBLIC_EVENT",s[s.WEB_EVENT=3]="WEB_EVENT",s[s.INTERNAL_API=4]="INTERNAL_API",s[s.WEB_API=5]="WEB_API",s[s.PUBLIC_API=6]="PUBLIC_API"}(vD||(vD={}));const Wk={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var Yn,Kt,Tf,GS;function WS(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function We(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?WS(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):WS(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}(function(s){s.PUBLISH="publish",s.SUBSCRIBE="subscribe",s.WS_COMPRESSOR_INIT="ws_compressor_init",s.SESSION_INIT="session_init",s.JOIN_CHOOSE_SERVER="join_choose_server",s.REQ_USER_ACCOUNT="req_user_account",s.JOIN_GATEWAY="join_gateway",s.REJOIN_GATEWAY="rejoin_gateway",s.STREAM_SWITCH="stream_switch",s.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",s.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",s.FIRST_VIDEO_RECEIVED="first_video_received",s.FIRST_AUDIO_RECEIVED="first_audio_received",s.FIRST_VIDEO_DECODE="first_video_decode",s.FIRST_AUDIO_DECODE="first_audio_decode",s.ON_ADD_AUDIO_STREAM="on_add_audio_stream",s.ON_ADD_VIDEO_STREAM="on_add_video_stream",s.ON_UPDATE_STREAM="on_update_stream",s.ON_REMOVE_STREAM="on_remove_stream",s.USER_ANALYTICS="req_user_analytics",s.PC_STATS="pc_stats"})(Yn||(Yn={})),function(s){s.SESSION="io.agora.pb.Wrtc.Session",s.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",s.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",s.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",s.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",s.PUBLISH="io.agora.pb.Wrtc.Publish",s.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",s.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",s.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",s.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",s.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",s.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",s.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",s.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",s.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",s.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",s.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",s.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",s.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",s.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",s.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",s.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",s.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",s.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",s.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",s.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",s.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",s.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",s.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",s.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",s.PC_STATS="io.agora.pb.Wrtc.PCStats"}(Kt||(Kt={})),function(s){s[s.WORKER_EVENT=156]="WORKER_EVENT",s[s.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(Tf||(Tf={})),function(s){s[s.SESSION=26]="SESSION",s[s.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",s[s.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",s[s.JOIN_GATEWAY=28]="JOIN_GATEWAY",s[s.PUBLISH=30]="PUBLISH",s[s.SUBSCRIBE=29]="SUBSCRIBE",s[s.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",s[s.STREAM_SWITCH=32]="STREAM_SWITCH",s[s.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",s[s.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",s[s.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",s[s.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",s[s.API_INVOKE=41]="API_INVOKE",s[s.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",s[s.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",s[s.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",s[s.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",s[s.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",s[s.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",s[s.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",s[s.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",s[s.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",s[s.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",s[s.WORKER_EVENT=156]="WORKER_EVENT",s[s.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",s[s.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",s[s.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",s[s.USER_ANALYTICS=1e4]="USER_ANALYTICS",s[s.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(GS||(GS={}));class wf{constructor(){var n=this;C(this,"baseInfoMap",new Map),C(this,"proxyServer",void 0),C(this,"eventUploadTimer",void 0),C(this,"setSessionIdTimer",void 0),C(this,"url",void 0),C(this,"backupUrl",void 0),C(this,"_appId",void 0),C(this,"keyEventUploadPendingItems",[]),C(this,"normalEventUploadPendingItems",[]),C(this,"apiInvokeUploadPendingItems",[]),C(this,"apiInvokeCount",0),C(this,"ltsList",[]),C(this,"lastSendNormalEventTime",Date.now()),C(this,"customReportCounterTimer",void 0),C(this,"customReportCount",0),C(this,"extApiInvoke",function(){var r=x(function*(a){for(const l of a){const d=We(We({},l),{},{sid:null,invokeId:++n.apiInvokeCount,tag:Jt.TRACER});n.sendApiInvoke(d)}});return function(a){return r.apply(this,arguments)}}()),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),j("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),j("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(n){return this.baseInfoMap.get(n)}adjustSessionStartTime(n){if(!this.baseInfoMap.has(n)&&!this.baseInfoMap.get(n))return void w.error("adjust session ".concat(n," start time, sid is not exist or info is undefined"));const r=this.baseInfoMap.get(n),a=Date.now(),l=r.startTime;r.startTime=a,w.debug("rewrite session ".concat(n," startTime: ").concat(a," , ").concat(a-l,"ms")),this.baseInfoMap.set(n,r)}setAppId(n){this._appId=n}reportApiInvoke(n,r,a){r.timeout=r.timeout||6e4,r.reportResult=void 0===r.reportResult||r.reportResult;const l=Date.now();this.apiInvokeCount+=1;const d=this.apiInvokeCount,h=()=>({tag:r.tag,invokeId:d,sid:n,name:r.name,apiInvokeTime:l,options:r.options,states:r.states||null}),p=!!j("SHOW_REPORT_INVOKER_LOG");p&&w.info("".concat(r.name," start"),r.options);let m=!1;gi(r.timeout).then(()=>{m||(this.sendApiInvoke(We(We({},h()),{},{error:M.API_INVOKE_TIMEOUT,success:!1})),w.debug("".concat(r.name," timeout")))});const _=new X(M.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:E=>{const v=()=>{if(m)throw _;return m=!0,this.sendApiInvoke(We(We({},h()),{},{success:!0},r.reportResult&&{result:E})),p&&w.info("".concat(r.name," onSuccess")),E};return a?AA(v,r.name+"Success",a,()=>m=!0):v()},onError:E=>{const v=()=>{if(m)throw E;m=!0,this.sendApiInvoke(We(We({},h()),{},{success:!1,error:E})),p&&w.info("".concat(r.name," onFailure"),E.toString())};return a?AA(v,r.name+"Error",a,()=>m=!0):v()}}}sessionInit(n,r){if(this.baseInfoMap.has(n))return;const a=Date.now(),l=this.createBaseInfo(n,a);l.cname=r.cname;const d=Object.assign({},{willUploadConsoleLog:j("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:VS?"global":"oversea",areas:j("AREAS")&&j("AREAS").join(",")},r.extend),h=Date.now(),p=We(We({},l),{},{eventType:Yn.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,build:BS,lts:h,elapse:h-a,extend:JSON.stringify(d),mode:r.mode,process:j("PROCESS_ID"),appType:j("APP_TYPE"),success:!0,version:$o});this.send({type:Kt.SESSION,data:p},!0)}joinChooseServer(n,r){const a=this.baseInfoMap.get(n);if(!a)return;const l=a.info,d=Date.now(),h=We(We({},l),{},{eventType:Yn.JOIN_CHOOSE_SERVER,lts:d,eventElapse:d-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:d-a.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3});this.send({type:Kt.JOIN_CHOOSE_SERVER,data:h},!0)}reqUserAccount(n,r){const a=this.baseInfoMap.get(n);if(!a)return;const l=a.info,d=Date.now(),h=We(We({},l),{},{eventType:Yn.REQ_USER_ACCOUNT,lts:d,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:d-a.startTime,eventElapse:d-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Kt.REQ_USER_ACCOUNT,data:h},!0)}joinGateway(n,r){const a=this.baseInfoMap.get(n);if(!a)return;const l=a.info;r.vid&&(l.vid=r.vid),l.uid=r.uid,l.cid=r.cid;const d=Date.now(),{firstSuccess:h,avoidJoinStartTime:p,isProxy:m,addr:_}=r,E=d-(h&&p?p:a.startTime),v=We(We({},l),{},{eventType:Yn.JOIN_GATEWAY,lts:d,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,elapse:E,eventElapse:d-r.lts,firstSuccess:h,signalChannel:r.signalChannel}),b=v.success?1:0;if(r.succ&&(a.lastJoinSuccessTime=d),h)this.send({type:Kt.JOIN_GATEWAY,data:v},!0);else{let T;if(_)if(m){const P=_.match(/h=(\d{1,3}-){3}\d{1,3}/g),D=_.match(/p=[0-9]{1,6}/g);T={isSuccess:b,gatewayIp:P&&P.length?P[0].split("=")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split("=")[1]:"",isProxy:m?1:0}}else{const P=_.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),D=_.match(/(:|p=)[0-9]{1,6}/g);T={isSuccess:b,gatewayIp:P&&P.length?P[0].split("//")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split(/:|p=/g)[1]:"",isProxy:m?1:0}}else T={isSuccess:b,gatewayIp:"",port:"",isProxy:m?1:0};delete v.success,delete v.eventType,delete v.firstSuccess,v.vid=Number(v.vid);const O=Object.assign({},v,T,{eventType:Yn.REJOIN_GATEWAY});this.send({type:Kt.RE_JOIN_GATEWAY,data:O},!0)}}joinChannelTimeout(n,r){const a=this.baseInfoMap.get(n);if(!a)return;const l=Date.now(),d=We(We({},a.info),{},{lts:l,timeout:r,elapse:l-a.startTime});this.send({type:Kt.JOIN_CHANNEL_TIMEOUT,data:d},!0)}publish(n,r){const a=this.baseInfoMap.get(n);if(!a)return;const l=a.info,d=Date.now(),h=We(We({},l),{},{eventType:Yn.PUBLISH,lts:d,eventElapse:r.eventElapse,elapse:d-a.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Kt.PUBLISH,data:h},!0)}subscribe(n,r,a){const l=this.baseInfoMap.get(n);if(!l)return;const d=l.info,h=Date.now(),p=We(We({},d),{},{eventType:Yn.SUBSCRIBE,lts:h,eventElapse:r.eventElapse,elapse:h-l.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid},a&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof r.peerid?p.peerSuid=r.peerid:p.peer=r.peerid,this.send({type:Kt.SUBSCRIBE,data:p},!0)}wsCompressorInit(n){var r;const a=[...Kr(r=this.baseInfoMap).call(r)],d=this.baseInfoMap.get(a.length?a[0]:"UnableToGetSid");if(!d)return;const h=d.info,p=Date.now(),m=We(We({},h),{},{eventType:Yn.WS_COMPRESSOR_INIT,lts:p,eventElapse:n.eventElapse,elapse:p-d.startTime,status:n.status?1:2});this.send({type:Kt.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(n,r,a,l){const d=this.baseInfoMap.get(n);if(!d)return;const h=d.info,p=Date.now(),m=We(We(We({},h),l),{},{elapse:p-d.startTime,eventType:r,lts:p,firstDecodeFrame:Math.max(p-d.startTime,0),apEnd:Math.max(l.apEnd-d.startTime,0),apStart:Math.max(l.apStart-d.startTime,0),joinGwEnd:Math.max(l.joinGwEnd-d.startTime,0),joinGwStart:Math.max(l.joinGwStart-d.startTime,0),pcEnd:Math.max(l.pcEnd-d.startTime,0),pcStart:Math.max(l.pcStart-d.startTime,0),subscriberEnd:Math.max(l.subscriberEnd-d.startTime,0),subscriberStart:Math.max(l.subscriberStart-d.startTime,0),videoAddNotify:Math.max(l.videoAddNotify-d.startTime,0)});this.send({type:a,data:m},!0)}firstRemoteFrame(n,r,a,l){const d=this.baseInfoMap.get(n);if(!d)return;const h=d.info,p=Date.now(),m=We(We(We({},h),l),{},{elapse:p-d.startTime,eventType:r,lts:p});this.send({type:a,data:m},!0)}pcStats(n,r){const a=this.baseInfoMap.get(n);if(!a)return;const l=a.info,d=Date.now(),h=We(We(We({},l),r),{},{vid:void 0===l.vid?0:Number(l.vid),elapse:d-a.startTime,eventType:Yn.PC_STATS,lts:d});this.send({type:Kt.PC_STATS,data:h},!0)}updateRemoteRTPCapabilities(n,r){this.reportApiInvoke(n,{name:"Client.updateRemoteRTPCapabilities",options:r,tag:Jt.TRACER}).onSuccess()}onGatewayStream(n,r,a,l){const d=this.baseInfoMap.get(n);if(!d)return;const h=d.info,p=Date.now(),m=We(We(We({},h),l),{},{eventType:r,lts:p});this.send({type:a,data:m},!0)}streamSwitch(n,r){const a=this.baseInfoMap.get(n);if(!a)return;const l=a.info,d=Date.now(),h=We(We({},l),{},{eventType:Yn.STREAM_SWITCH,lts:d,isDual:r.isdual,elapse:d-a.startTime,success:r.succ});this.send({type:Kt.STREAM_SWITCH,data:h},!0)}requestProxyAppCenter(n,r){const a=this.baseInfoMap.get(n);if(!a)return;const l=a.info,d=Date.now(),h=We(We({},l),{},{eventType:Yn.REQUEST_PROXY_APPCENTER,lts:d,eventElapse:d-r.lts,elapse:d-a.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Kt.REQUEST_PROXY_APPCENTER,data:h},!0)}requestProxyWorkerManager(n,r){const a=this.baseInfoMap.get(n);if(!a)return;const l=a.info,d=Date.now(),h=We(We({},l),{},{eventType:Yn.REQUEST_PROXY_WORKER_MANAGER,lts:d,eventElapse:d-r.lts,elapse:d-a.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Kt.REQUEST_PROXY_WORKER_MANAGER,data:h},!0)}setProxyServer(n){this.proxyServer=n,w.debug(n?"reportProxyServerurl: ".concat(n):"disable reportProxyServerurl: ".concat(n))}peerPublishStatus(n,r){const a=this.baseInfoMap.get(n);if(!a)return;const l=a.info,d=Date.now(),h=We(We({},l),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:d,elapse:d-a.startTime,joinChannelSuccessElapse:d-(a.lastJoinSuccessTime||d),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Kt.PEER_PUBLISH_STATUS,data:h},!0)}workerEvent(n,r){const a=this.baseInfoMap.get(n);if(!a)return;const l=a.info,d=Date.now();(function(p,m,_){const E=p[m];if(!E||"string"!=typeof E)return[p];p[m]="";const v=Oa(JSON.stringify(p));let b=0;const T=[];let O=0;for(let P=0;P<E.length;P++)O+=E.charCodeAt(P)<=127?1:3,O<=1300-v||(T[T.length]=ld(ld({},p),{},{[m]:E.substring(b,P)}),b=P,O=E.charCodeAt(P)<=127?1:3);return b!==E.length-1&&(T[T.length]=ld(ld({},p),{},{[m]:E.substring(b)})),T})(We(We(We({},l),r),{},{elapse:d-a.startTime,lts:d,productType:"WebRTC"}),"payload").forEach(p=>this.send({type:Kt.WORKER_EVENT,data:p},!0))}apworkerEvent(n,r){const a=this.baseInfoMap.get(n);if(!a)return;const l=a.info,d=Date.now(),h=We(We(We({},l),r),{},{elapse:d-a.startTime,lts:d});this.send({type:Kt.AP_WORKER_EVENT,data:h},!0)}joinWebProxyAP(n,r){const a=this.baseInfoMap.get(n);if(!a)return;const l=a.info,d=Date.now(),h=We(We(We({},l),r),{},{elapse:d-a.startTime,lts:d,extend:r.extend||void 0});this.send({type:Kt.JOIN_WEB_PROXY_AP,data:h},!0)}WebSocketQuit(n,r){const a=this.baseInfoMap.get(n);if(!a)return;const l=a.info,d=Date.now(),h=We(We(We({},l),r),{},{elapse:d-a.startTime,lts:d});this.send({type:Kt.WEBSOCKET_QUIT,data:h},!0)}sendCustomReportMessage(n,r){var a=this;return x(function*(){if(a.customReportCount+=r.length,a.customReportCount>j("CUSTOM_REPORT_LIMIT"))throw new X(M.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);a.customReportCounterTimer||(a.customReportCounterTimer=window.setInterval(()=>{a.customReportCount=0},5e3));const l=Date.now(),d=r.map(h=>({type:Kt.USER_ANALYTICS,data:We(We({sid:n},h),{},{lts:l})}));try{j("NEW_REPORT_SERVER")?yield a.postDataToStatsCollector2(d):yield a.postDataToStatsCollector(d)}catch(h){throw w.error("send custom report message failed",h.toString()),new X(M.CUSTOM_REPORT_SEND_FAILED,h.message)}})()}sendApiInvoke(n){const r=j("NOT_REPORT_EVENT");if(n.tag&&ye(r)&&ye(r).call(r,n.tag))return!1;if(null===n.sid)return this.apiInvokeUploadPendingItems.push(n),!1;const a=this.baseInfoMap.get(n.sid);if(!a)return this.apiInvokeUploadPendingItems.push(n),!1;const{cname:l,uid:d,cid:h}=a.info;let p;if(n.lts=n.lts||Date.now(),n.error)if(n.error instanceof X){const{code:_,message:E}=n.error;p=_||E||n.error.toString()}else p=n.error.toString();const m={invokeId:n.invokeId,sid:n.sid,cname:l,cid:h,uid:d,lts:n.lts,success:n.success,elapse:n.lts-a.startTime,execElapse:n.lts-n.apiInvokeTime,apiName:n.name,options:n.options?JSON.stringify(n.options):void 0,execStates:n.states?JSON.stringify(n.states):void 0,execResult:n.result?JSON.stringify(n.result):void 0,errorCode:n.error?p:void 0,errorMsg:n.error?JSON.stringify(n.error):void 0};return this.send({type:Kt.API_INVOKE,data:m},!1),!0}appendSessionId(){wf.__CLIENT_LIST__.forEach(n=>{if(n._sessionId){const r=this.apiInvokeUploadPendingItems.length;for(let a=0;a<r;a++){const l=this.apiInvokeUploadPendingItems.shift();l&&(l.sid=n._sessionId,this.sendApiInvoke(Object.assign({},l)))}}})}send(n,r){if(r)return this.keyEventUploadPendingItems.push(n),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(n),this.normalEventUploadPendingItems.length>j("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(n,r){const a=[],l=[];for(;n.length;){const h=n.shift();a.length<20?a.push(h):l.push(h)}n.push(...l);for(const h of[...a]){var d;-1!==this.ltsList.indexOf(h.data.lts)?(h.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(h.data.lts)):(this.ltsList.push(h.data.lts),Zc(d=this.ltsList).call(d,(p,m)=>p-m))}return r||(this.lastSendNormalEventTime=Date.now()),j("ENABLE_EVENT_REPORT")&&a.length&&(j("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(a):this.postDataToStatsCollector(a)).catch((h=>p=>{j("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(h):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(h),this.normalEventUploadPendingItems.length>j("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-j("NORMAL_EVENT_QUEUE_CAPACITY")),w.warning("report: drop normal events"))))})(a)),n}postDataToStatsCollector2(n){var r=this;return x(function*(){on.networkState===Yi.OFFLINE&&(yield z.race([on.onlineWaiter,gi(2*Re.maxRetryTimeout)]));const a=h=>{let p=new Uint8Array;return h.forEach(m=>{const _=Fg(JSON.stringify(m.data)),E=new ArrayBuffer(5),v=(T=>{let O=0;return Object.entries(Kt).forEach(P=>{let[D,L]=P;L===T.type&&(O=EventNameToID[D])}),O})(m),b=new DataView(E);b.setUint16(0,_.byteLength,!0),b.setUint8(2,255&v),b.setUint8(3,v>>>8&255),b.setUint8(4,v>>>16&255),p=fS(p,new Uint8Array(E)),p=fS(p,_)}),p},l="event";let d=r.proxyServer?"https://".concat(r.proxyServer,"/rs/?h=").concat(j("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(l):"https://".concat(j("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(l);for(let h=0;h<2;h+=1){1===h&&(d=r.proxyServer?"https://".concat(r.proxyServer,"/rs/?h=").concat(j("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(l):"https://".concat(j("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(l));try{yield FS(d,{timeout:1e4,data:a(n),headers:We(We({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},r._appId&&{appid:r._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(p){if(1===h)throw p;continue}return}})()}postDataToStatsCollector(n){var r=arguments,a=this;return x(function*(){let l=r.length>1&&void 0!==r[1]&&r[1];const d={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:n.map(m=>JSON.stringify(m)),vid:(m=>{const _=m&&m.data.sid&&a.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(n[0])};on.networkState===Yi.OFFLINE&&(yield z.race([on.onlineWaiter,gi(2*Re.maxRetryTimeout)]));const h=l?"/events/proto-raws":"/events/messages";let p=a.url||(a.proxyServer?"https://".concat(a.proxyServer,"/rs/?h=").concat(j("EVENT_REPORT_DOMAIN"),"&p=").concat(j("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(j("EVENT_REPORT_DOMAIN"),":").concat(j("STATS_COLLECTOR_PORT")).concat(h));for(let m=0;m<2;m+=1){1===m&&(p=a.backupUrl||(a.proxyServer?"https://".concat(a.proxyServer,"/rs/?h=").concat(j("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(j("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(j("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(j("STATS_COLLECTOR_PORT")).concat(h)));try{l?yield ph(p,{timeout:1e4,data:d}):yield FS(p,{timeout:1e4,data:d})}catch(_){if(1===m)throw _;continue}return}})()}createBaseInfo(n,r){const a=Object.assign({},Wk);return a.sid=n,this.baseInfoMap.set(n,{info:a,startTime:r}),a}reportResourceTiming(n,r){const a=performance.getEntriesByName(n),l=a[a.length-1];l&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:l,tag:Jt.TRACER}).onSuccess()}}function Ae(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(n,r,a){const l=a.value;if("function"==typeof l){const d=s.className||n.__className__||("AgoraRTCClient"===n.constructor.name?"Client":n.constructor.name);a.value=function(){for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];let _=p;if(s.argsMap)try{_=s.argsMap(this,...p)}catch(v){w.warning(v),_=[]}try{JSON.stringify(_)}catch{w.warning("arguments for method ".concat(d,".").concat(String(r)," not serializable for apiInvoke.")),_=[]}const E=(s.report||Se).reportApiInvoke(this._sessionId||null,{name:"".concat(d,".").concat(String(r)),options:_,tag:Jt.TRACER,reportResult:s.reportResult},s.throttleTime);try{const v=l.apply(this,p);return v instanceof z?v.then(b=>(E.onSuccess(s.reportResult&&b),b)).catch(b=>{throw E.onError(b),b}):(E.onSuccess(s.reportResult&&v),v)}catch(v){throw E.onError(v),v}}}return a}}C(wf,"__CLIENT_LIST__",[]);const Se=new wf;bf.on("REPORT_LOG_UPLOAD",s=>{s.networkState=on.networkState,Se.reportApiInvoke(null,{name:"logUploadError",options:s,tag:Jt.TRACER})});const zk=["CHINA","GLOBAL"],Eo=function(){const s="us".concat("erna","me"),n="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");const a=r.join(""),l=[];for(let p=0;p<6;p++)l.push("1");const d=l.join(""),h={};return h[s]=a,h[n]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Eo,VS||(oi.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],oi.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],oi.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],oi.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],oi.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],oi.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],oi.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",oi.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",oi.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",oi.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",oi.AREAS=["NORTH_AMERICA","OVERSEA"]);const yD=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],hc=[];function hl(s,n){return!!n&&hc.some(r=>r.uid===s&&r.channelName===n)}wf.__CLIENT_LIST__=hc;var rE,Nr,_d,If,vo,$i,Ie,Ke,he,Ce,Xi,Ue,bD,gd,xe,Bn,pl,qk=ke("Array").values,Kk=Fs,PV=St,Yk=xs,SD=qk,zS=Array.prototype,$k={DOMTokenList:!0,NodeList:!0},yo=cr(function(s){var n=s.values;return s===zS||Yk(zS,s)&&n===zS.values||PV($k,Kk(s))?SD:n});function te(s,n,r,a){var l,d=arguments.length,h=d<3?n:null===a?a=Object.getOwnPropertyDescriptor(n,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(s,n,r,a);else for(var p=s.length-1;p>=0;p--)(l=s[p])&&(h=(d<3?l(h):d>3?l(n,r,h):l(n,r))||h);return d>3&&h&&Object.defineProperty(n,r,h),h}function N(s,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,n)}(function(s){s.L1T1="L1T1",s.L1T2="L1T2",s.L1T3="L1T3",s.L2T1_KEY="L2T1_KEY",s.L2T2_KEY="L2T2_KEY",s.L2T3_KEY="L2T3_KEY",s.L3T1_KEY="L3T1_KEY",s.L3T2_KEY="L3T2_KEY",s.L3T3_KEY="L3T3_KEY"})(rE||(rE={})),function(s){s.CERTIFICATE="certificate",s.CODEC="codec",s.CANDIDATE_PAIR="candidate-pair",s.LOCAL_CANDIDATE="local-candidate",s.REMOTE_CANDIDATE="remote-candidate",s.INBOUND="inbound-rtp",s.TRACK="track",s.OUTBOUND="outbound-rtp",s.PC="peer-connection",s.REMOTE_INBOUND="remote-inbound-rtp",s.REMOTE_OUTBOUND="remote-outbound-rtp",s.TRANSPORT="transport",s.CSRC="csrc",s.DATA_CHANNEL="data-channel",s.STREAM="stream",s.SENDER="sender",s.RECEIVER="receiver"}(Nr||(Nr={})),function(s){s[s.ACCESS_POINT=101]="ACCESS_POINT",s[s.UNILBS=201]="UNILBS",s[s.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(_d||(_d={})),function(s){s[s.IIIEGAL_APPID=1]="IIIEGAL_APPID",s[s.IIIEGAL_UID=2]="IIIEGAL_UID",s[s.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(If||(If={})),function(s){s[s.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",s[s.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",s[s.INTERNAL_ERROR=8]="INTERNAL_ERROR",s[s.NO_AUTHORIZED=9]="NO_AUTHORIZED",s[s.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",s[s.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",s[s.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",s[s.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",s[s.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",s[s.USER_OVERLOAD=16]="USER_OVERLOAD",s[s.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",s[s.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(vo||(vo={})),function(s){s[s.NO_FLAG_SET=100]="NO_FLAG_SET",s[s.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",s[s.INVALID_FALG_SET=102]="INVALID_FALG_SET",s[s.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",s[s.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",s[s.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",s[s.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",s[s.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",s[s.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",s[s.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",s[s.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",s[s.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",s[s.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",s[s.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",s[s.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",s[s.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",s[s.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",s[s.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",s[s.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}($i||($i={})),function(s){s[s.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",s[s.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",s[s.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",s[s.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",s[s.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",s[s.K_TICKET_INVALID=7]="K_TICKET_INVALID",s[s.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",s[s.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",s[s.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",s[s.K_UID_BANNED=14]="K_UID_BANNED",s[s.K_IP_BANNED=15]="K_IP_BANNED",s[s.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",s[s.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",s[s.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",s[s.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",s[s.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",s[s.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",s[s.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",s[s.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",s[s.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",s[s.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",s[s.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",s[s.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",s[s.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",s[s.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",s[s.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",s[s.ERR_INVALID_UID=117]="ERR_INVALID_UID",s[s.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",s[s.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",s[s.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",s[s.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",s[s.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",s[s.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",s[s.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",s[s.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",s[s.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",s[s.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",s[s.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",s[s.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",s[s.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",s[s.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",s[s.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",s[s.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",s[s.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",s[s.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",s[s.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",s[s.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",s[s.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",s[s.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",s[s.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",s[s.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",s[s.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",s[s.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",s[s.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",s[s.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",s[s.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",s[s.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",s[s.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",s[s.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",s[s.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",s[s.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",s[s.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",s[s.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",s[s.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Ie||(Ie={})),function(s){s.CONNECTING="connecting",s.CONNECTED="connected",s.RECONNECTING="reconnecting",s.CLOSED="closed"}(Ke||(Ke={})),function(s){s.WS_CONNECTED="ws_connected",s.WS_RECONNECTING="ws_reconnecting",s.WS_CLOSED="ws_closed",s.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",s.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",s.ON_BINARY_DATA="on_binary_data",s.REQUEST_RECOVER="request_recover",s.REQUEST_JOIN_INFO="request_join_info",s.REQUEST_REJOIN_INFO="req_rejoin_info",s.IS_P2P_DISCONNECTED="is_p2p_dis",s.DISCONNECT_P2P="dis_p2p",s.ABORT_P2P_EXECUTION="abort_p2p_execution",s.NEED_RENEW_SESSION="need-sid",s.REPORT_JOIN_GATEWAY="report_join_gateway",s.REQUEST_TIMEOUT="request_timeout",s.REQUEST_SUCCESS="request_success",s.JOIN_RESPONSE="join_response",s.DATACHANNEL_PRECONNECT="datachannel_preconnect",s.DATACHANNEL_CONNECTING="datachannel_connecting",s.DATACHANNEL_FAILBACK="datachannel_failback",s.P2P_START="p2p_start",s.P2P_CONNECTION="p2p_connection",s.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",s.P2P_SUBSCRIBE="p2p_subscribe",s.P2P_UNSUBSCRIBE="p2p_unsubscribe",s.P2P_EXCHANGE_SDP="p2p_exchange_sdp",s.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",s.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream"}(he||(he={})),function(s){s.PING="ping",s.PING_BACK="ping_back",s.JOIN="join_v3",s.REJOIN="rejoin_v3",s.LEAVE="leave",s.SET_CLIENT_ROLE="set_client_role",s.PUBLISH="publish",s.PUBLISH_DATASTREAM="publish_datastream",s.UNPUBLISH="unpublish",s.UNPUBLISH_DATASTREAM="unpublish_datastream",s.SUBSCRIBE="subscribe",s.SUBSCRIBE_DATASTREAM="subscribe_datastream",s.SUBSCRIBE_STREAMS="subscribe_streams",s.UNSUBSCRIBE="unsubscribe",s.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",s.UNSUBSCRIBE_STREAMS="unsubscribe_streams",s.SUBSCRIBE_CHANGE="subscribe_change",s.TRAFFIC_STATS="traffic_stats",s.RENEW_TOKEN="renew_token",s.SWITCH_VIDEO_STREAM="switch_video_stream",s.DEFAULT_VIDEO_STREAM="default_video_stream",s.SET_FALLBACK_OPTION="set_fallback_option",s.GATEWAY_INFO="gateway_info",s.CONTROL="control",s.SEND_METADATA="send_metadata",s.DATA_STREAM="data_stream",s.PICK_SVC_LAYER="pick_svc_layer",s.RESTART_ICE="restart_ice",s.CONNECT_PC="connect_pc",s.SET_VIDEO_PROFILE="set_video_profile",s.SET_PARAMETER="set_parameter",s.SET_RTM2_FLAG="set_rtm2_flag"}(Ce||(Ce={})),function(s){s.PUBLISH_STATS="publish_stats",s.PUBLISH_RELATED_STATS="publish_related_stats",s.SUBSCRIBE_STATS="subscribe_stats",s.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",s.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",s.DENOISER_STATS="denoiser_stats",s.TRANSPORT_STATS="transport_stats",s.EXTENSION_USAGE_STATS="extension_usage_stats"}(Xi||(Xi={})),function(s){s.ON_USER_ONLINE="on_user_online",s.ON_USER_OFFLINE="on_user_offline",s.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",s.ON_PUBLISH_STREAM="on_publish_stream",s.ON_UPLINK_STATS="on_uplink_stats",s.ON_P2P_LOST="on_p2p_lost",s.ON_REMOVE_STREAM="on_remove_stream",s.ON_ADD_AUDIO_STREAM="on_add_audio_stream",s.ON_ADD_VIDEO_STREAM="on_add_video_stream",s.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",s.ON_USER_BANNED="on_user_banned",s.ON_USER_LICENSE_BANNED="on_user_license_banned",s.ON_NOTIFICATION="on_notification",s.ON_CRYPT_ERROR="on_crypt_error",s.MUTE_AUDIO="mute_audio",s.MUTE_VIDEO="mute_video",s.UNMUTE_AUDIO="unmute_audio",s.UNMUTE_VIDEO="unmute_video",s.ON_P2P_OK="on_p2p_ok",s.RECEIVE_METADATA="receive_metadata",s.ON_DATA_STREAM="on_data_stream",s.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",s.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",s.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",s.ENABLE_LOCAL_VIDEO="enable_local_video",s.DISABLE_LOCAL_VIDEO="disable_local_video",s.ENABLE_LOCAL_AUDIO="enable_local_audio",s.DISABLE_LOCAL_AUDIO="disable_local_audio",s.ON_PUBLISHED_USER_LIST="on_published_user_list"}(Ue||(Ue={})),function(s){s.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",s.NEED_ANSWER="NEED_ANSWER",s.NEED_RENEGOTIATE="NEED_RENEGOTIATE",s.P2P_LOST="P2P_LOST",s.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",s.NEED_UNPUB="NEED_UNPUB",s.NEED_UNSUB="NEED_UNSUB",s.NEED_UPLOAD="NEED_UPLOAD",s.NEED_CONTROL="NEED_CONTROL",s.START_RECONNECT="START_RECONNECT",s.END_RECONNECT="END_RECONNECT",s.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(bD||(bD={})),function(s){s.SEND_ONLY="SEND_ONLY",s.RECEIVE_ONLY="RECEIVE_ONLY"}(gd||(gd={})),function(s){s.CONNECTED="websocket:connected",s.RECONNECTING="websocket:reconnecting",s.WILL_RECONNECT="websocket:will_reconnect",s.CLOSED="websocket:closed",s.FAILED="websocket:failed",s.ON_MESSAGE="websocket:on_message",s.REQUEST_NEW_URLS="websocket:request_new_urls",s.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",s.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(xe||(xe={}));class W extends X{constructor(n){super(n,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),C(this,"name","AgoraRTCException")}print(){return super.print(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",w)}throw(){super.throw(w)}}function oE(s){if("string"!=typeof s||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(s))throw w.error("Invalid Channel Name ".concat(s)),new W(M.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function qS(s){if(!("number"==typeof(n=s)&&Math.floor(n)===n&&0<=n&&n<=4294967295||dS(s,1,255)))throw new W(M.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var n;"string"==typeof s&&w.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}(function(s){s.TRANSCODE="mix_streaming",s.RAW="raw_streaming",s.INJECT="inject_streaming"})(Bn||(Bn={})),function(s){s[s.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",s[s.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",s[s.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",s[s.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",s[s.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",s[s.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",s[s.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",s[s.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",s[s.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",s[s.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",s[s.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(pl||(pl={}));const CD={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},KS={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Rf(s,n){Un(s.url,"".concat(n,".url"),1,1e3,!1),kt(s.x)||ft(s.x,"".concat(n,".x"),0,1e4),kt(s.y)||ft(s.y,"".concat(n,".y"),0,1e4),kt(s.width)||ft(s.width,"".concat(n,".width"),0,1e4),kt(s.height)||ft(s.height,"".concat(n,".height"),0,1e4),kt(s.zOrder)||ft(s.zOrder,"".concat(n,".zOrder"),0,255),kt(s.alpha)||ft(s.alpha,"".concat(n,".alpha"),0,1,!1)}const Xk={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},TD={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var Xo,mh,Sn,wD,Ei,$s,Ji,fl,It,sn,Ed,Pn,sE,st;function ID(s){if(!s.channelName)throw new W(M.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof s.uid)throw new W(M.INVALID_PARAMS,"invalid uid in info, uid must be a number");return s.token&&Un(s.token,"info.token",1,2047),qS(s.uid),oE(s.channelName),!0}(function(s){s.WARNING="@live_uap-warning",s.ERROR="@line_uap-error",s.PUBLISH_STREAM_STATUS="@live_uap-publish-status",s.INJECT_STREAM_STATUS="@live_uap-inject-status",s.WORKER_STATUS="@live_uap-worker-status",s.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(Xo||(Xo={})),function(s){s.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(mh||(mh={})),function(s){s[s.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",s[s.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",s[s.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",s[s.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",s[s.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",s[s.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",s[s.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",s[s.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",s[s.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",s[s.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",s[s.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",s[s.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",s[s.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",s[s.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",s[s.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",s[s.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",s[s.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",s[s.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Sn||(Sn={})),function(s){s.CONNECT_FAILED="connect failed",s.CONNECT_TIMEOUT="connect timeout",s.WS_DISCONNECTED="websocket disconnected",s.REQUEST_TIMEOUT="request timeout",s.REQUEST_FAILED="request failed",s.WAIT_STATUS_TIMEOUT="wait status timeout",s.WAIT_STATUS_ERROR="wait status error",s.BAD_STATE="bad state",s.WS_ABORT="ws abort",s.AP_REQUEST_TIMEOUT="AP request timeout",s.AP_JSON_PARSE_ERROR="AP json parse error",s.AP_REQUEST_ERROR="AP request error",s.AP_REQUEST_ABORT="AP request abort"}(wD||(wD={})),function(s){s[s.SetSdkProfile=0]="SetSdkProfile",s[s.SetSourceChannel=1]="SetSourceChannel",s[s.SetSourceUserId=2]="SetSourceUserId",s[s.SetDestChannel=3]="SetDestChannel",s[s.StartPacketTransfer=4]="StartPacketTransfer",s[s.StopPacketTransfer=5]="StopPacketTransfer",s[s.UpdateDestChannel=6]="UpdateDestChannel",s[s.Reconnect=7]="Reconnect",s[s.SetVideoProfile=8]="SetVideoProfile"}(Ei||(Ei={})),function(s){s.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",s.NETWORK_CONNECTED="NETWORK_CONNECTED",s.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",s.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",s.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",s.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",s.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",s.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",s.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",s.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}($s||($s={})),function(s){s.RELAY_STATE_IDLE="RELAY_STATE_IDLE",s.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",s.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",s.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(Ji||(Ji={})),function(s){s.RELAY_OK="RELAY_OK",s.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",s.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",s.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(fl||(fl={})),function(s){s.High="high",s.Low="low",s.Audio="audio",s.Screen="screen",s.ScreenLow="screen_low"}(It||(It={})),function(s){s.DISCONNECT="disconnect",s.CONNECTION_STATE_CHANGE="connection-state-change",s.NETWORK_QUALITY="network-quality",s.STREAM_TYPE_CHANGE="stream-type-change",s.IS_P2P_DISCONNECTED="is-p2p-dis",s.DISCONNECT_P2P="dis-p2p",s.REQUEST_NEW_GATEWAY_LIST="req-gate-url",s.NEED_RENEW_SESSION="need-sid",s.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",s.JOIN_RESPONSE="join-response",s.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",s.RESET_CONNECTION_EVENTS="reset-connection-events",s.DATACHANNEL_PRECONNECT="datachannel_preconnect",s.DATACHANNEL_FAILBACK="datachannel_failback",s.RESET_SIGNAL="reset-signal"}(sn||(sn={})),function(s){s.P2P_DISCONNECTED="P2P_DISCONNECTED",s.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",s.TIMEOUT="TIMEOUT",s.UNKNOWN_REASON="UNKNOWN_REASON"}(Ed||(Ed={})),function(s){s[s.Nothing=0]="Nothing",s[s.Audio=1]="Audio",s[s.LwoVideo=2]="LwoVideo",s[s.Video=4]="Video",s[s.Data=8]="Data",s[s.DataStream0=256]="DataStream0",s[s.DataStream1=512]="DataStream1",s[s.DataStream2=1024]="DataStream2",s[s.DataStream3=2048]="DataStream3",s[s.DataStream4=4096]="DataStream4",s[s.DataStream5=8192]="DataStream5",s[s.DataStream6=16384]="DataStream6",s[s.DataStream7=32768]="DataStream7"}(Pn||(Pn={})),function(s){s[s.websocket=0]="websocket",s[s.datachannel=1]="datachannel"}(sE||(sE={})),function(s){s.CHINA="CHINA",s.ASIA="ASIA",s.NORTH_AMERICA="NORTH_AMERICA",s.EUROPE="EUROPE",s.JAPAN="JAPAN",s.INDIA="INDIA",s.KOREA="KOREA",s.HKMC="HKMC",s.US="US",s.OCEANIA="OCEANIA",s.SOUTH_AMERICA="SOUTH_AMERICA",s.AFRICA="AFRICA",s.OVERSEA="OVERSEA",s.GLOBAL="GLOBAL",s.EXTENSIONS="EXTENSIONS"}(st||(st={}));const YS=[st.AFRICA,st.ASIA,st.CHINA,st.EUROPE,st.GLOBAL,st.INDIA,st.JAPAN,st.NORTH_AMERICA,st.OCEANIA,st.OVERSEA,st.SOUTH_AMERICA];var ei;!function(s){s.CHINA="CN",s.ASIA="AS",s.NORTH_AMERICA="NA",s.EUROPE="EU",s.JAPAN="JP",s.INDIA="IN",s.KOREA="KR",s.HKMC="HK",s.US="US",s.OCEANIA="OC",s.SOUTH_AMERICA="SA",s.AFRICA="AF",s.OVERSEA="OVERSEA",s.GLOBAL="GLOBAL",s.EXTENSIONS="GLOBAL"}(ei||(ei={}));const aE={CHINA:{},ASIA:{CODE:ei.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ei.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ei.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ei.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","\tuap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ei.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ei.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ei.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ei.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ei.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ei.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ei.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ei.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ei.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};var Af,$S,ge,wi,Xs,ne,it,we,XS,Pr,bo,jn,vs,En,Lt,ml,Mr,Jo,vd,Dt,ys,RD;VS&&(aE.CHINA={CODE:ei.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(s){s.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(Af||(Af={}));class JS extends qt{constructor(n,r){super(),C(this,"onICEConnectionStateChange",void 0),C(this,"onConnectionStateChange",void 0),C(this,"onDTLSTransportStateChange",void 0),C(this,"onDTLSTransportError",void 0),C(this,"onICETransportStateChange",void 0),C(this,"onFirstAudioReceived",void 0),C(this,"onFirstVideoReceived",void 0),C(this,"onFirstAudioDecoded",void 0),C(this,"onFirstVideoDecoded",void 0),C(this,"onFirstVideoDecodedTimeout",void 0),C(this,"onSelectedLocalCandidateChanged",void 0),C(this,"onSelectedRemoteCandidateChanged",void 0)}}class _h extends JS{constructor(n,r){super(n,r)}}(function(s){s.SEND="sendonly",s.RECV="recvonly",s.SENDRECV="sendrecv",s.INACTIVE="inactive"})($S||($S={})),function(s){s.VIDEO="video",s.AUDIO="audio"}(ge||(ge={})),function(s){s[s.UDP=0]="UDP",s[s.TCP=1]="TCP",s[s.RELAY=2]="RELAY"}(wi||(wi={})),function(s){s[s.FIRST_CONNECTION=0]="FIRST_CONNECTION",s[s.TCP_RESTART=1]="TCP_RESTART",s[s.RELAY_RESTART=2]="RELAY_RESTART",s[s.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",s[s.OLD_RESTART=11]="OLD_RESTART",s[s.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(Xs||(Xs={})),function(s){s.LocalVideoTrack="videoTrack",s.LocalAudioTrack="audioTrack",s.LocalVideoLowTrack="videoLowTrack"}(ne||(ne={})),function(s){s.New="new",s.Connected="connected",s.Reconnecting="reconnecting",s.Disconnected="disconnected"}(it||(it={})),function(s){s.StateChange="stateChange",s.IceConnectionStateChange="iceConnectionStateChange",s.RequestMuteLocal="requestMuteLocal",s.RequestUnmuteLocal="requestUnmuteLocal",s.RequestRePublish="requestRePublish",s.RequestRePublishDataChannel="requestRePublishDataChannel",s.RequestReSubscribe="requestReSubscribe",s.RequestUploadStats="requestUploadStats",s.MediaReconnectStart="MediaReconnectStart",s.MediaReconnectEnd="MediaReconnectEnd",s.NeedSignalRTT="NeedSignalRTT",s.RequestRestartICE="RequestRestartIce",s.PeerConnectionStateChange="PeerConnectionStateChange",s.RequestReconnect="RequestReconnect",s.RequestReconnectPC="RequestReconnectPC",s.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",s.P2PLost="P2PLost",s.UpdateVideoEncoder="UpdateVideoEncoder",s.ConnectionTypeChange="ConnectionTypeChange",s.RequestLowStreamParameter="RequestLowStreamParameter",s.QueryClientConnectionState="QueryClientConnectionState",s.LocalCandidate="LocalCandidate",s.RequestP2PMuteLocal="requestP2PMuteLocal",s.RequestP2PPublish="RequestP2PPublish",s.RequestP2PUnPublish="RequestP2PUnPublish",s.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",s.RequestP2PMuteRemote="RequestP2PMuteRemote",s.RequestP2PRestartICE="RequestP2PRestartICE"}(we||(we={})),function(s){s.MUTE_LOCAL_VIDEO="mute_local_video",s.MUTE_LOCAL_AUDIO="mute_local_audio",s.UNMUTE_LOCAL_VIDEO="unmute_local_video",s.UNMUTE_LOCAL_AUDIO="unmute_local_audio",s.MUTE_REMOTE_VIDEO="mute_remote_video",s.MUTE_REMOTE_AUDIO="mute_remote_audio",s.UNMUTE_REMOTE_VIDEO="unmute_remote_video",s.UNMUTE_REMOTE_AUDIO="unmute_remote_audio"}(XS||(XS={})),function(s){s.CONNECTING="CONNECTING",s.RECONNECTING="RECONNECTING",s.CONNECTED="CONNECTED",s.CLOSED="CLOSED"}(Pr||(Pr={})),function(s){s[s.CONNECT_AP=0]="CONNECT_AP",s[s.AP_CONNECTED=1]="AP_CONNECTED",s[s.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",s[s.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",s[s.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",s[s.CONNECT_WORKER=5]="CONNECT_WORKER",s[s.WORKER_CONNECTED=6]="WORKER_CONNECTED",s[s.CLOSED=7]="CLOSED"}(bo||(bo={})),function(s){s.CONNECTION_STATE_CHANGE="connection-state-change",s.STATE_CHANGE="state-change",s.INSPECT_RESULT="inspect-result",s.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",s.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(jn||(jn={})),function(s){s.NETWORK_ERROR="NETWORK_ERROR",s.SERVER_ERROR="SERVER_ERROR",s.MULTI_IP="MULTI_IP",s.TIMEOUT="TIMEOUT",s.OFFLINE="OFFLINE",s.LEAVE="LEAVE",s.P2P_FAILED="P2P_FAILED",s.FALLBACK="FALLBACK"}(vs||(vs={})),function(s){s.CONNECTED="transmitter:connected",s.RECONNECTING="transmitter:reconnecting",s.WILL_RECONNECT="transmitter:will_reconnect",s.CLOSED="transmitter:closed",s.FAILED="transmitter:failed",s.ON_MESSAGE="transmitter:on_message",s.REQUEST_NEW_URLS="transmitter:request_new_urls",s.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",s.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",s.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",s.FAILBACK="transmitter:failback"}(En||(En={})),function(s){s.CAMERA_CHANGED="camera-changed",s.MICROPHONE_CHANGED="microphone-changed",s.PLAYBACK_DEVICE_CHANGED="playback-device-changed",s.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",s.AUTOPLAY_FAILED="autoplay-failed",s.SECURITY_POLICY_VIOLATION="security-policy-violation"}(Lt||(Lt={})),function(s){s[s.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",s[s.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",s[s.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",s[s.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",s[s.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",s[s.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",s[s.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",s[s.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",s[s.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",s[s.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",s[s.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",s[s.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",s[s.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",s[s.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",s[s.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",s[s.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",s[s.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",s[s.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",s[s.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",s[s.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(ml||(ml={})),function(s){s.CONNECTING="CONNECTING",s.RECONNECTING="RECONNECTING",s.CONNECTED="CONNECTED",s.CLOSED="CLOSED"}(Mr||(Mr={})),function(s){s.CONNECTION_STATE_CHANGE="connection-state-change",s.STATE_CHANGE="state-change",s.INSPECT_RESULT="inspect-result",s.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",s.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Jo||(Jo={})),function(s){s[s.CONNECT_AP=0]="CONNECT_AP",s[s.AP_CONNECTED=1]="AP_CONNECTED",s[s.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",s[s.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",s[s.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",s[s.CONNECT_WORKER=5]="CONNECT_WORKER",s[s.WORKER_CONNECTED=6]="WORKER_CONNECTED",s[s.CLOSED=7]="CLOSED"}(vd||(vd={})),function(s){s.CALL="call",s.CANDIDATE="candidate",s.PUBLISH="publish",s.UNPUBLISH="unpublish",s.SUBSCRIBE="subscribe",s.UNSUBSCRIBE="unsubscribe",s.CONTROL="control",s.RESTART_ICE="restart_ice",s.ACK="ack",s.JOIN="join",s.EXCHANGE_SDP="exchange_sdp",s.DO_SUBSCRIBE="do_subscribe",s.DO_UNSUBSCRIBE="do_unsubscribe"}(Dt||(Dt={})),function(s){s.MUTE_LOCAL_AUDIO="mute_local_audio",s.MUTE_LOCAL_VIDEO="mute_local_video",s.UNMUTE_LOCAL_AUDIO="unmute_local_audio",s.UNMUTE_LOCAL_VIDEO="unmute_local_video"}(ys||(ys={})),function(s){s[s.SUCCESS=1]="SUCCESS",s[s.FAILED=0]="FAILED"}(RD||(RD={}));const Jk={[_d.ACCESS_POINT]:{[$i.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[$i.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[$i.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[$i.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[$i.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[$i.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[_d.UNILBS]:{[vo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[vo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[vo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[vo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[vo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[vo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[vo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[vo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[vo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[vo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[vo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[vo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[_d.STRING_UID_ALLOCATOR]:{[If.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[If.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[If.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Df(s){const n=Jk[Math.floor(s/1e4)];if(!n)return{desc:"unkonw error",retry:!1};const r=n[s%1e4];if(!r){if(Math.floor(s/1e4)===_d.ACCESS_POINT){const a=s%1e4;if("1"===a.toString()[0])return{desc:s.toString(),retry:!1};if("2"===a.toString()[0])return{desc:s.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return r}const QS={[Ie.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ie.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ie.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ie.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ie.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ie.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ie.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ie.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ie.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ie.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ie.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ie.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ie.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ie.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ie.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ie.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ie.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ie.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ie.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ie.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ie.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ie.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ie.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ie.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ie.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ie.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ie.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ie.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ie.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ie.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ie.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ie.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ie.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ie.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ie.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ie.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ie.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ie.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ie.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ie.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ie.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ie.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ie.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ie.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ie.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ie.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ie.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ie.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ie.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ie.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ie.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ie.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ie.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ie.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ie.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ie.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ie.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ie.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ie.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function _l(s){return QS[s]||{desc:"UNKNOW_ERROR_".concat(s),action:"failed"}}function ZS(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function cE(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?ZS(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):ZS(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function eC(s){return s.every(n=>n.readyState===WebSocket.CLOSED||n.readyState===WebSocket.CLOSING)}function AD(s,n){if("string"==typeof s)return s;const{proxy:r,host:a,port:l}=s;if(n){const d=j("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===d?"wss://".concat(a,"/ws/?p=").concat(Number(l)+150):"wss://".concat(a,":").concat(d,"/ws/?p=").concat(Number(l)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(a,"&p=").concat(l):"wss://".concat(a,":").concat(l)}const Qk=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Zk=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,eL=/wss:\/\/(.+):([0-9]+)\/?/,DD=/wss:\/\/(.[^\/]+)\/?/;let MV=0;class OD{constructor(n,r){C(this,"id",0),C(this,"store",void 0),C(this,"recordIndex",void 0),C(this,"websockets",[]),C(this,"try443PortDuration",2e3),C(this,"forceCloseWSDuration",5e3),C(this,"try443PortTimeout",null),C(this,"forceCloseTimeout",null),C(this,"isTry443PortFailed",!1),C(this,"isNormalPortFailed",!1),C(this,"useDoubleDomain",!1),C(this,"useProxy",!1),C(this,"startTime",Date.now()),this.id=++MV,this.try443PortDuration=j("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=n||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach(n=>{n.onopen=null,n.onclose=null,n.onmessage=null,n.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var n;const r=Date.now()-this.startTime;for(var a=arguments.length,l=new Array(a),d=0;d<a;d++)l[d]=arguments[d];w.debug("[choose-best-ws ".concat(null===(n=this.store)||void 0===n?void 0:n.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...l)}createWebSocket(n,r,a){this.logger("createWebSocket:",n,{isTry443Port:r,hasTimeoutDetection:a});const l=j("GATEWAY_DOMAINS"),d=Date.now(),h=[],p=l.find(E=>{var v;return ye(v=n.host).call(v,E)});p||(this.useDoubleDomain=!1);const m=[];if(this.useDoubleDomain)l.forEach(E=>{m.push(AD(cE(cE({},n),{},{host:n.host.replace(p,E)}),r))});else{const E=cE({},n);if(r&&p){const v=l.find(b=>b!==p);v&&(E.host=E.host.replace(p,v))}m.push(AD(E,r))}try{m.forEach(E=>{const v=new WebSocket(E);v.binaryType="arraybuffer",h.push(v),this.logger("ws is connecting:",v.url)})}catch(E){if(this.logger("ws create failed"),h.forEach(v=>v.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(n,r,a);if(!r&&443!==Number(n.port))return this.createWebSocket(n,!0,a);throw new W(M.WS_ERR,"init websocket failed! Error: ".concat(E.toString()))}const _=af();return this.store&&this.store.recordJoinChannelService({urls:h.map(E=>E.url),service:"gateway"},this.recordIndex),h.forEach(E=>{E.onopen=()=>{this.logger("onopen: ws ".concat(E.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(v=>{v!==E&&(v.onopen=null,v.onclose=null,v.onmessage=null,v.close(),this.logger("close backup websocket: ".concat(v.url)))}),this.websockets.length=0,_.resolve(E)},E.onclose=v=>{this.logger("onclose: ws ".concat(E.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(E.readyState)),r?this.isTry443PortFailed=eC(h):this.isNormalPortFailed=eC(h),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(r&&this.isTry443PortFailed||!r&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(v.reason)),_.reject({code:v.code,reason:Ed.A_ROUND_WS_FAILED}))},E.onmessage=v=>this.logger("".concat(E.url," onmessage: ").concat(v.data))}),this.websockets.push(...h),a||(()=>{const E=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",_.isResolved),this.websockets.forEach(v=>v.readyState!==WebSocket.OPEN&&v.close())};if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(E,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",_.isResolved),_.isResolved)return E();dt().os===Fn.MAC_OS&&zt()&&E(),this.createWebSocket(n,!0,!0).then(v=>_.resolve(v)).catch(v=>{this.isNormalPortFailed&&_.reject(v),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(E,this.forceCloseWSDuration)},this.try443PortDuration)})(),_.promise}chooseBestWebsocket(n,r,a,l){return this.useDoubleDomain=!!r,"string"==typeof n&&(n=function(d){let h,p,m;return[,h,p,m]=d.match(Qk)||[],h||([,p,m]=d.match(Zk)||[]),p&&m||([,p,m]=d.match(eL)||[]),p&&m||([,p]=d.match(DD)||[]),p||w.warning("un-destructible url: ",d),{proxy:h,host:p,port:m||"443"}}(n)),this.recordIndex=l,this.useProxy=!!n.proxy,a&&this.useProxy&&(w.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(n,!!a,!1).finally(()=>this.clearTimeout())}}function ND(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}class PD extends qt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(n){var r;ye(r=["tryNext","recover"]).call(r,n)&&this.resetReconnectCount(n),this._reconnectMode=n}get state(){return this._state}set state(n){n!==this._state&&(this._state=n,"reconnecting"===this._state?this.emit(xe.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(xe.CONNECTED):"closed"===this._state?this.emit(xe.CLOSED):"failed"===this._state&&this.emit(xe.FAILED))}resetReconnectCount(n){w.debug("websocket reset reconnect count, reason: "+n),this.reconnectCount=0}constructor(n,r){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),C(this,"connectionID",0),C(this,"currentURLIndex",0),C(this,"urls",[]),C(this,"_reconnectMode","tryNext"),C(this,"reconnectReason",void 0),C(this,"_initMutex",new Zn("websocket")),C(this,"name",void 0),C(this,"_state","closed"),C(this,"reconnectInterrupter",void 0),C(this,"websocket",void 0),C(this,"retryConfig",void 0),C(this,"reconnectCount",0),C(this,"forceCloseTimeout",5e3),C(this,"onlineReconnectListener",void 0),C(this,"useCompress",void 0),C(this,"tryDoubleDomain",!1),C(this,"use443PortOnly",!1),C(this,"wsInflateLength",0),C(this,"wsDeflateLength",0),C(this,"closeEstablishingWs",()=>{}),C(this,"store",void 0),C(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=n,this.retryConfig=function(v){for(var b=1;b<arguments.length;b++){var T=null!=arguments[b]?arguments[b]:{};b%2?ND(Object(T),!0).forEach(function(O){C(v,O,T[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(T)):ND(Object(T)).forEach(function(O){Object.defineProperty(v,O,Object.getOwnPropertyDescriptor(T,O))})}return v}({},r),this.useCompress=a,this.tryDoubleDomain=l,this.use443PortOnly=d;const{timeout:p,timeoutFactor:m}=r,_=Math.max(300,Math.floor(3*p/5)),E=Math.max(1.2,Math.floor(8*m)/10);Yi.ONLINE&&(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=E),on.on(lc.NETWORK_STATE_CHANGE,(v,b)=>{v!==b&&(this.resetReconnectCount("network state change: ".concat(b," -> ").concat(v)),v===Yi.ONLINE?(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=E):(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}init(n){var r=arguments,a=this;return x(function*(){let l=r.length>1&&void 0!==r[1]?r[1]:5e3;const d=yield a._initMutex.lock();a.forceCloseTimeout=l,a.urls=n,a.state="connecting";try{const h=af();a.createWebSocketConnection(a.urls[a.currentURLIndex]).then(h.resolve).catch(h.reject),a.once(xe.CLOSED,()=>{h.reject(new X(M.WS_DISCONNECT))}),a.once(xe.CONNECTED,h.resolve),yield h.promise}catch{}finally{d()}})()}close(n,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;r?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0}this.state=n?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(n,r){if(!this.websocket)return void w.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==n&&(this.reconnectMode=n),w.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:r})}sendMessage(n){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new X(M.WS_ABORT,"websocket is not ready");try{r||(n=JSON.stringify(n)),this.websocket.send(n)}catch(a){throw new X(M.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(n){this.wsDeflateLength=this.wsDeflateLength+n.originLength,this.wsInflateLength=this.wsInflateLength+n.compressedLength}getWsInflateData(){const n=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:n,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}createWebSocketConnection(n){var r=this;return x(function*(){var a;const l=af();r.connectionID+=1,r.joinGatewayRecordIndex=void 0;const d=v=>{var b;null===(b=r.store)||void 0===b||b.signalChannelOpen(),w.debug("[".concat(r.name,"] websocket opened:"),v),r.reconnectMode="retry",r.state="connected",r.resetReconnectCount("opened"),l.resolve()},h=function(){var v=x(function*(b){var T;if(w.debug("[".concat(r.name,"] websocket close ").concat(null===(T=r.websocket)||void 0===T?void 0:T.url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(r.reconnectMode)),r.reconnectCount>=r.retryConfig.maxRetryCount)l.reject(new X(M.WS_DISCONNECT,"websocket close: ".concat(b.code))),r.close();else{"connected"===r.state&&(r.reconnectReason=b.reason,r.state="reconnecting");const O=_r(r,xe.WILL_RECONNECT,r.reconnectMode,b.reason)||r.reconnectMode,P=yield r.reconnectWithAction(O);if("closed"===r.state)return void w.debug("[".concat(r.connectionID,"] ws is closed, no need to reconnect"));if(!P)return l.reject(new X(M.WS_DISCONNECT,"websocket reconnect failed: ".concat(b.code))),r.close(!0);l.resolve()}});return function(T){return v.apply(this,arguments)}}(),p=v=>{r.emit(xe.ON_MESSAGE,v)},m=v=>{w.warn("[".concat(r.connectionID,"] ws open error ").concat(v))};r.websocket&&(r.websocket.onclose=null,r.websocket.close()),j("GATEWAY_WSS_ADDRESS")&&r.name.startsWith("gateway")&&(n=j("GATEWAY_WSS_ADDRESS")),w.debug("[".concat(r.name,"] start connect, url:"),n);const _=null===(a=r.store)||void 0===a?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var E;const v=yield r.chooseBestWebsocketConnection(n);r.websocket=v,d&&d(r.websocket.url),r.websocket.onclose=h,r.websocket.onmessage=p,r.websocket.onerror=m,null===(E=r.store)||void 0===E||E.recordJoinChannelService({endTs:Date.now(),status:"success"},_),r.joinGatewayRecordIndex=_}catch(v){const b="closed"===r.state,T=v instanceof X,O=T&&v.code===M.WS_ABORT,P=T&&v.code===M.WS_ERR,D=T?v.message:v&&(v.reason||v.toString());w.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(D)),r.store&&r.store.recordJoinChannelService({endTs:Date.now(),status:O?"aborted":"error",errors:[v]},_),b||P?(l.reject(b?new X(M.WS_DISCONNECT,"websocket is closed: ".concat(D)):new X(M.WS_ERR,"init websocket failed: ".concat(D))),P&&w.error("[".concat(r.name,"] init websocket failed: ").concat(D))):h&&h(v)}return l.promise})()}reconnectWithAction(n){var r=arguments,a=this;return x(function*(){let l=!(r.length>1&&void 0!==r[1])||r[1];if(a.reconnectCount>=a.retryConfig.maxRetryCount||0===a.urls.length||"closed"===a.state)return!1;w.warning("[choose-best-ws] action: =>",n),a.onlineReconnectListener||on.isOnline||!on.onlineWaiter||(a.onlineReconnectListener=on.onlineWaiter.then(()=>{a.onlineReconnectListener=void 0}));let d=!0;if(a.reconnectInterrupter=()=>d=!1,l){const m=wt(a.reconnectCount,a.retryConfig);w.debug("[".concat(a.name,"] wait ").concat(m,"ms to reconnect websocket, mode: ").concat(n)),yield z.race([gi(m),a.onlineReconnectListener||new z(()=>{})])}if("closed"===a._state||!d)return!1;a.reconnectCount+=1;const h=function(){var m=x(function*(_,E){a.emit(xe.RECONNECT_CREATE_CONNECTION,E),yield a.createWebSocketConnection(_)});return function(E,v){return m.apply(this,arguments)}}();try{if("retry"===n)a.emit(xe.RECONNECT_WAITTING_FINISH,n),yield h(a.urls[a.currentURLIndex],n);else if("tryNext"===n){if(a.currentURLIndex+=1,a.currentURLIndex>=a.urls.length)return a.reconnectWithAction("recover",!1);w.debug("[".concat(a.name,"] websocket url length: ").concat(a.urls.length," current index: ").concat(a.currentURLIndex)),a.emit(xe.RECONNECT_WAITTING_FINISH,n),yield h(a.urls[a.currentURLIndex],n)}else"recover"===n&&(w.debug("[".concat(a.name,"] request new urls")),a.resetReconnectCount("recover mode"),a.emit(xe.RECONNECT_WAITTING_FINISH,n),a.urls=yield Qt(a,xe.REQUEST_NEW_URLS),a.currentURLIndex=0,yield h(a.urls[a.currentURLIndex],n))}catch(m){var p;w.error("[".concat(a.name,"] reconnect failed ").concat(m&&m.toString()));const _=null==m||null===(p=m.data)||void 0===p?void 0:p.desc;return Array.isArray(_)&&ye(_).call(_,"dynamic key expired")?(a.emit(xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):a.reconnectWithAction(n,l)}return!0})()}}class lE extends PD{constructor(n,r){super(n,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(n,r){var a=this;return x(function*(){const l=af(),d=new OD(a.forceCloseTimeout,a.store);a.closeEstablishingWs=()=>{w.debug("[choose-best-ws] close establishing websockets"),d.closeAllWebsockets(),l.reject(new X(M.WS_ABORT,"choose best websocket aborted"))};const h=j("GATEWAY_DOMAINS");return w.debug("[choose-best-ws] currentDomain: ",n,", domains: ",h,"total: ".concat(a.urls.length),"current: ".concat(a.currentURLIndex+1)),d.chooseBestWebsocket(n,a.tryDoubleDomain,a.use443PortOnly,r).then(l.resolve).catch(l.reject),l.promise.finally(()=>{a.closeEstablishingWs=void 0})})()}}class Of extends PD{constructor(n,r){super(n,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(n,r){var a=this;return x(function*(){return new z((l,d)=>{let h=!1;const p=[];a.closeEstablishingWs=()=>{w.debug("[choose-best-ws] close establishing websockets"),p.forEach(P=>{P.onclose=null,P.onopen=null,P.onmessage=null,P.close()}),d(new X(M.WS_ABORT,"choose best websocket aborted"))};const m=j("GATEWAY_DOMAINS");let _;const E=n.indexOf("?h="),v=m.find(P=>-1!==E?ye(n).call(n,P,E):ye(n).call(n,P));w.debug("[choose-best-ws] currentDomain: ",v,", domains: ",m);let b=!a.tryDoubleDomain||!v;if(!b&&v){var T;const P=Date.now();try{m.forEach(D=>{const L=-1===E?n.replace(v,D):n.substr(0,E)+n.substr(E).replace(v,D),V=new WebSocket(L);V.binaryType="arraybuffer",p.push(V),w.debug("[choose-best-ws] ws is connecting:",V.url)})}catch{for(w.debug("[choose-best-ws] ws create failed, fallback to single url"),p.forEach(L=>L.close());p.length;)p.pop();b=!0}null===(T=a.store)||void 0===T||T.recordJoinChannelService({urls:p.map(D=>D.url),service:"gateway"},r),p.forEach(D=>{D.onopen=()=>{if(h)return;const L=Date.now()-P;w.debug("[choose-best-ws] ws open cost ".concat(L,"ms")),p.filter(V=>V!==D).forEach(V=>{w.debug("[choose-best-ws]close backup websocket: ".concat(V.url)),V.close()}),h=!0,l(D)},D.onclose=L=>{_=L,!h&&(p.find(V=>!(V.readyState===WebSocket.CLOSED||V.readyState===WebSocket.CLOSING))||(w.debug("[choose-best-ws] all websocket is closed"),h=!0,d(_)))},D.onmessage=L=>{w.debug("[choose-best-ws]".concat(D.url," onmessage: ").concat(L.data))}}),gi(a.forceCloseTimeout).then(()=>{p.forEach(D=>{D.readyState!==WebSocket.OPEN&&D.close()})})}if(b){var O;let P;w.debug("[choose-best-ws] use single url: ",n),null===(O=a.store)||void 0===O||O.recordJoinChannelService({urls:[n],service:"gateway"},r);try{P=new WebSocket(n),p.push(P),P.binaryType="arraybuffer"}catch(D){const L=new X(M.WS_ERR,"init websocket failed! Error: ".concat(D.toString()));return w.error("[".concat(a.name,"]").concat(L)),void d(L)}P.onopen=()=>{l(P)},P.onclose=D=>{d(D)},P.onmessage=D=>{w.debug("[choose-best-ws]".concat(P.url," onmessage: ").concat(D.data))},gi(a.forceCloseTimeout).then(()=>{P&&P.readyState!==WebSocket.OPEN&&P.close()})}}).then(l=>(a.closeEstablishingWs=void 0,l)).catch(l=>{throw a.closeEstablishingWs=void 0,l})})()}}class MD extends qt{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===Ke.CONNECTED?this.emit(he.WS_CONNECTED):n===Ke.RECONNECTING?this.emit(he.WS_RECONNECTING,this._websocketReconnectReason):n===Ke.CLOSED&&this.emit(he.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,r){super(),C(this,"_disconnectedReason",void 0),C(this,"_websocketReconnectReason",void 0),C(this,"_connectionState",Ke.CLOSED),C(this,"reconnectToken",void 0),C(this,"websocket",void 0),C(this,"openConnectionTime",void 0),C(this,"clientId",void 0),C(this,"lastMsgTime",Date.now()),C(this,"uploadCache",[]),C(this,"uploadCacheInterval",void 0),C(this,"rttRolling",new tn(5)),C(this,"pingpongTimer",void 0),C(this,"wsInflateDataTimer",void 0),C(this,"pingpongTimeoutCount",0),C(this,"joinResponse",void 0),C(this,"multiIpOption",void 0),C(this,"initError",void 0),C(this,"spec",void 0),C(this,"store",void 0),C(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(he.ON_BINARY_DATA,a.data);const l=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(l,"_id")){const d="res-@".concat(l._id);this.emit(d,l._result,l._message)}else if(Object.prototype.hasOwnProperty.call(l,"_type")){if(this.emit(l._type,l._message),l._type===Ue.ON_NOTIFICATION&&this.handleNotification(l._message),l._type===Ue.ON_USER_BANNED)switch(l._message.error_code){case 14:this.close(Ye.UID_BANNED);break;case 15:this.close(Ye.IP_BANNED);break;case 16:this.close(Ye.CHANNEL_BANNED)}if(l._type===Ue.ON_USER_LICENSE_BANNED)switch(l._message.error_code){case Ie.ERR_LICENSE_MISSING:this.close(Ye.LICENSE_MISSING);break;case Ie.ERR_LICENSE_EXPIRED:this.close(Ye.LICENSE_EXPIRED);break;case Ie.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ye.LICENSE_MINUTES_EXCEEDED);break;case Ie.ERR_LICENSE_PERIOD_INVALID:this.close(Ye.LICENSE_PERIOD_INVALID);break;case Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ye.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ie.ERR_LICENSE_ILLEGAL:this.close(Ye.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=r,this.websocket=new lE("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ke.CONNECTED&&this.reconnect("retry",Kn.OFFLINE)})}request(n,r,a,l){var d=this;return x(function*(){const h=Fe(6,""),p={_id:h,_type:n,_message:r},m=d.websocket.connectionID,_=()=>new z((P,D)=>{if(d.connectionState===Ke.CONNECTED)return P();const L=()=>{d.off(he.WS_CLOSED,V),P()},V=()=>{d.off(he.WS_CONNECTED,L),D(new W(M.WS_ABORT))};d.once(he.WS_CONNECTED,L),d.once(he.WS_CLOSED,V),n!==Ce.PUBLISH&&n!==Ce.SUBSCRIBE&&n!==Ce.UNSUBSCRIBE&&n!==Ce.UNPUBLISH&&n!==Ce.CONTROL&&n!==Ce.RESTART_ICE||d.once(he.DISCONNECT_P2P,()=>{D(new W(M.DISCONNECT_P2P))}),n!==Ce.PUBLISH&&n!==Ce.RESTART_ICE||d.once(he.ABORT_P2P_EXECUTION,()=>{D(new W(M.DISCONNECT_P2P))})});if(d.connectionState!==Ke.CONNECTING&&d.connectionState!==Ke.RECONNECTING||n===Ce.JOIN||n===Ce.REJOIN||(yield _()),d.websocket.sendMessage(p,!0),l)return;const E=new z((P,D)=>{let L=!1;const V=(J,se)=>{L=!0,P({isSuccess:"success"===J,message:se||{}}),d.off(he.WS_CLOSED,U),d.off(he.WS_RECONNECTING,U),d.emit(he.REQUEST_SUCCESS,n,r)};d.once("res-@".concat(h),V);const U=()=>{D(new W(M.WS_ABORT,"type: ".concat(n))),d.off(he.WS_CLOSED,U),d.off(he.WS_RECONNECTING,U),d.off("res-@".concat(h),V)};d.once(he.WS_CLOSED,U),d.once(he.WS_RECONNECTING,U),gi(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||L||(w.warning("[".concat(d.clientId,"] ws request timeout, type: ").concat(n)),d.emit(he.REQUEST_TIMEOUT,n,r))})});let v=null;try{v=yield E}catch(P){if(d.connectionState===Ke.CLOSED||n===Ce.LEAVE)throw new W(M.WS_ABORT);return!d.spec.forceWaitGatewayResponse||a?P.throw():n===Ce.JOIN||n===Ce.REJOIN?null:(yield _(),yield d.request(n,r))}if(v.isSuccess)return v.message;const b=Number(v.message.error_code||v.message.code),T=_l(b),O=new W(M.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(v.message.error_str),{code:b,data:v.message});return"success"===T.action?v.message:(w.warning("[".concat(d.clientId,"] [").concat(d.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(b,", message: ").concat(T.desc,", action: ").concat(T.action)),b===Ie.ERR_TOO_MANY_BROADCASTERS?((n===Ce.JOIN||n===Ce.REJOIN)&&(d.initError=O,d.close()),O.throw()):"failed"===T.action?O.throw():"quit"===T.action?(d.initError=O,d.close(),O.throw()):(b===Ie.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=v.message.option,w.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",Kn.MULTI_IP)):d.reconnect(T.action,Kn.SERVER_ERROR),n===Ce.JOIN||n===Ce.REJOIN?null:yield d.request(n,r)))})()}waitMessage(n,r){return new z(a=>{const l=d=>{(!r||r(d))&&(this.off(n,l),a(d))};this.on(n,l)})}upload(n,r){const a={_type:n,_message:r};try{this.websocket.sendMessage(a)}catch{const d=j("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ke.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},j("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,r){this.websocket.sendMessage({_type:n,_message:r})}init(n,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new z((a,l)=>{this.once(he.WS_CONNECTED,()=>a(this.joinResponse)),this.once(he.WS_CLOSED,()=>l(this.initError||new W(M.WS_ABORT))),this.connectionState=Ke.CONNECTING,this.websocket.init(n).catch(l),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||Ye.LEAVE,this.connectionState=Ke.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),n===Ye.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new lE("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}join(){var n=this;return x(function*(){if(!n.joinResponse){n.emit(he.ABORT_P2P_EXECUTION);const r=yield Qt(n,he.REQUEST_JOIN_INFO),a=yield n.request(Ce.JOIN,r);if(!a)return n.emit(he.REPORT_JOIN_GATEWAY,Ed.TIMEOUT,n.url||""),!1;n.joinResponse=a,n.emit(he.JOIN_RESPONSE,n.joinResponse),n.reconnectToken=n.joinResponse.rejoin_token}return n.connectionState=Ke.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),!0})()}rejoin(){var n=this;return x(function*(){if(!n.reconnectToken)throw new W(M.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=dc(n,he.REQUEST_REJOIN_INFO);r.token=n.reconnectToken;const a=yield n.request(Ce.REJOIN,r);return!!a&&(n.connectionState=Ke.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),a.peers&&a.peers.forEach(l=>{n.emit(Ue.ON_USER_ONLINE,{uid:l.uid}),l.audio&&n.emit(Ue.ON_ADD_AUDIO_STREAM,{uid:l.uid,uint_id:l.uint_id,audio:!0,ssrcId:l.audio_ssrc}),l.video&&n.emit(Ue.ON_ADD_VIDEO_STREAM,{uid:l.uid,uint_id:l.uint_id,video:!0,ssrcId:l.video_ssrc}),n.emit(l.audio_mute?Ue.MUTE_AUDIO:Ue.UNMUTE_AUDIO,{uid:l.uid}),n.emit(l.video_mute?Ue.MUTE_VIDEO:Ue.UNMUTE_VIDEO,{uid:l.uid}),n.emit(l.audio_enable_local?Ue.ENABLE_LOCAL_AUDIO:Ue.DISABLE_LOCAL_AUDIO,{uid:l.uid}),n.emit(l.video_enable_local?Ue.ENABLE_LOCAL_VIDEO:Ue.DISABLE_LOCAL_VIDEO,{uid:l.uid}),l.audio||l.video||n.emit(Ue.ON_REMOVE_STREAM,{uid:l.uid,uint_id:l.uint_id})}),!0)})()}reconnect(n,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,r)}handleNotification(n){w.debug("[".concat(this.clientId,"] receive notification: "),n);const r=_l(n.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close(Ye.UID_BANNED),void this.close()):void this.reconnect(r.action,Kn.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=j("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=n&&(w.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>j("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Kn.TIMEOUT):this.request(Ce.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),j("REPORT_STATS")&&this.send(Ce.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:n,wsDeflateLength:r}=this.websocket.getWsInflateData();0!==n&&0!==r&&this.upload(Xi.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:n})}handleWebsocketEvents(){this.websocket.on(xe.RECONNECT_WAITTING_FINISH,n=>{this.emit(he.WS_RECONNECT_WAITTING_FINISH,n)}),this.websocket.on(xe.RECONNECT_CREATE_CONNECTION,n=>{this.emit(he.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(xe.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(xe.CLOSED,()=>{this.connectionState=Ke.CLOSED}),this.websocket.on(xe.FAILED,()=>{this._disconnectedReason=Ye.NETWORK_ERROR,this.connectionState=Ke.CLOSED}),this.websocket.on(xe.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState=this.connectionState===Ke.CONNECTED?Ke.RECONNECTING:Ke.CONNECTING}),this.websocket.on(xe.WILL_RECONNECT,(n,r,a)=>{const l=dc(this,he.IS_P2P_DISCONNECTED),d=l||"retry"!==n;l&&"retry"===n&&(w.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),n="tryNext",r=Ed.P2P_DISCONNECTED),d&&(w.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(n)),this.emit(he.REPORT_JOIN_GATEWAY,r||Ed.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P)),a(n)}),this.websocket.on(xe.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(n=>{w.warning("[".concat(this.clientId,"] rejoin failed ").concat(n)),this.reconnect("tryNext",Kn.SERVER_ERROR)}):this.join().catch(n=>{if(this.emit(he.REPORT_JOIN_GATEWAY,n.message||n.code||Ed.UNKNOWN_REASON,this.url||""),n instanceof W&&n.code===M.UNEXPECTED_RESPONSE&&n.data.code===Ie.ERR_NO_AUTHORIZED)return w.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Kn.SERVER_ERROR);w.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Kn.SERVER_ERROR):(this.initError=n,this.close())})}),this.websocket.on(xe.REQUEST_NEW_URLS,(n,r)=>{Qt(this,he.REQUEST_RECOVER,this.multiIpOption).then(n).catch(r)}),this.websocket.on(xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var xD="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",tL=nu,nL=Bo,tC=xD,nC=ni("".replace),iL=RegExp("^["+tC+"]+"),rL=RegExp("(^|[^"+tC+"])["+tC+"]+$"),iC=function(s){return function(n){var r=nL(tL(n));return 1&s&&(r=nC(r,iL,"")),2&s&&(r=nC(r,rL,"$1")),r}},oL={start:iC(1),end:iC(2),trim:iC(3)},sL=II.PROPER,Nf=pi,rC=xD,kD=oL.trim;Ct({target:"String",proto:!0,forced:function(s){return Nf(function(){return!!rC[s]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[s]()||sL&&rC[s].name!==s})}("trim")},{trim:function(){return kD(this)}});var $n,Xn,LD=ke("String").trim,dE=xs,aL=LD,FD=String.prototype,UD=cr(function(s){var n=s.trim;return"string"==typeof s||s===FD||dE(FD,s)&&n===FD.trim?aL:n});function pc(s,n,r){return{sampleRate:s,stereo:n,bitrate:r}}function rt(s,n,r,a,l){return{width:s,height:n,frameRate:r,bitrateMin:a,bitrateMax:l}}function bs(s,n,r,a,l){return{width:{max:s},height:{max:n},frameRate:r,bitrateMin:a,bitrateMax:l}}function oC(s,n){return{numSpatialLayers:s,numTemporalLayers:n}}(function(s){s[s.CHOOSE_SERVER=11]="CHOOSE_SERVER",s[s.CLOUD_PROXY=18]="CLOUD_PROXY",s[s.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",s[s.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})($n||($n={})),function(s){s.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",s.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",s.IOS_INTERRUPTION_START="ios-interruption-start",s.IOS_INTERRUPTION_END="ios-interruption-end",s.STATE_CHANGE="state-change"}(Xn||(Xn={}));const cL={"90p":rt(160,90),"90p_1":rt(160,90),"120p":rt(160,120,15,30,65),"120p_1":rt(160,120,15,30,65),"120p_3":rt(120,120,15,30,50),"120p_4":rt(212,120),"180p":rt(320,180,15,30,140),"180p_1":rt(320,180,15,30,140),"180p_3":rt(180,180,15,30,100),"180p_4":rt(240,180,15,30,120),"240p":rt(320,240,15,40,200),"240p_1":rt(320,240,15,40,200),"240p_3":rt(240,240,15,40,140),"240p_4":rt(424,240,15,40,220),"360p":rt(640,360,15,80,400),"360p_1":rt(640,360,15,80,400),"360p_3":rt(360,360,15,80,260),"360p_4":rt(640,360,30,80,600),"360p_6":rt(360,360,30,80,400),"360p_7":rt(480,360,15,80,320),"360p_8":rt(480,360,30,80,490),"360p_9":rt(640,360,15,80,800),"360p_10":rt(640,360,24,80,800),"360p_11":rt(640,360,24,80,1e3),"480p":rt(640,480,15,100,500),"480p_1":rt(640,480,15,100,500),"480p_2":rt(640,480,30,100,1e3),"480p_3":rt(480,480,15,100,400),"480p_4":rt(640,480,30,100,750),"480p_6":rt(480,480,30,100,600),"480p_8":rt(848,480,15,100,610),"480p_9":rt(848,480,30,100,930),"480p_10":rt(640,480,10,100,400),"720p":rt(1280,720,15,120,1130),"720p_auto":rt(1280,720,30,900,3e3),"720p_1":rt(1280,720,15,120,1130),"720p_2":rt(1280,720,30,120,2e3),"720p_3":rt(1280,720,30,120,1710),"720p_5":rt(960,720,15,120,910),"720p_6":rt(960,720,30,120,1380),"1080p":rt(1920,1080,15,120,2080),"1080p_1":rt(1920,1080,15,120,2080),"1080p_2":rt(1920,1080,30,120,3e3),"1080p_3":rt(1920,1080,30,120,3150),"1080p_5":rt(1920,1080,60,120,4780),"1440p":rt(2560,1440,30,120,4850),"1440p_1":rt(2560,1440,30,120,4850),"1440p_2":rt(2560,1440,60,120,7350),"4k":rt(3840,2160,30,120,8910),"4k_1":rt(3840,2160,30,120,8910),"4k_3":rt(3840,2160,60,120,13500)},gl=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],lL={"480p":bs(640,480,5),"480p_1":bs(640,480,5),"480p_2":bs(640,480,30),"480p_3":bs(640,480,15),"720p":bs(1280,720,5),"720p_auto":rt(1280,720,30,900,3e3),"720p_1":bs(1280,720,5),"720p_2":bs(1280,720,30),"720p_3":bs(1280,720,15),"1080p":bs(1920,1080,5),"1080p_1":bs(1920,1080,5),"1080p_2":bs(1920,1080,30),"1080p_3":bs(1920,1080,15)},sC={"1SL1TL":oC(1,1),"3SL3TL":oC(3,3),"2SL3TL":oC(2,3)};function Ma(s){return s||(s="480p_1"),"string"==typeof s?Object.assign({},cL[s]):s}function VD(s){return"string"==typeof s?Object.assign({},lL[s]):s}function uE(s){return"string"==typeof s?Object.assign({},sC[s]):s}const xV={speech_low_quality:pc(16e3,!1),speech_standard:pc(32e3,!1,18),music_standard:pc(48e3,!1),standard_stereo:pc(48e3,!0,56),high_quality:pc(48e3,!1,128),high_quality_stereo:pc(48e3,!0,192)};function Ss(s){return"string"==typeof s?Object.assign({},xV[s]):s}const gh=[];function BD(s){return gn(s,"mediaSource",["screen","window","application"]),!0}var fe,Ot,fc,hE,pE,mc,El,yd,vr,fE;(function(s){s.NEED_RENEGOTIATE="@need_renegotiate",s.NEED_REPLACE_TRACK="@need_replace_track",s.NEED_CLOSE="@need_close",s.NEED_ENABLE_TRACK="@need_enable_track",s.NEED_DISABLE_TRACK="@need_disable_track",s.NEED_SESSION_ID="@need_sid",s.SET_OPTIMIZATION_MODE="@set_optimization_mode",s.GET_STATS="@get_stats",s.GET_RTC_STATS="@get_rtc_stats",s.GET_LOW_VIDEO_TRACK="@get_low_video_track",s.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",s.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",s.NEED_MUTE_TRACK="@need_mute_track",s.NEED_UNMUTE_TRACK="@need_unmute_track"})(fe||(fe={})),function(s){s.SCREEN_TRACK="screen_track",s.CUSTOM_TRACK="custome_track",s.LOW_STREAM="low_stream"}(Ot||(Ot={})),function(s){s[s.HIGH_STREAM=0]="HIGH_STREAM",s[s.LOW_STREAM=1]="LOW_STREAM"}(fc||(fc={})),function(s){s[s.HIGH_STREAM=0]="HIGH_STREAM",s[s.LOW_STREAM=1]="LOW_STREAM"}(hE||(hE={})),function(s){s[s.DISABLE=0]="DISABLE",s[s.LOW_STREAM=1]="LOW_STREAM",s[s.AUDIO_ONLY=2]="AUDIO_ONLY"}(pE||(pE={})),function(s){s.TRANSCEIVER_UPDATED="transceiver-updated"}(mc||(mc={})),function(s){s.SOURCE_STATE_CHANGE="source-state-change",s.TRACK_ENDED="track-ended",s.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",s.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",s.CLOSED="closed"}(El||(El={})),function(s){s.FIRST_FRAME_DECODED="first-frame-decoded",s.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(yd||(yd={})),function(s){s.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",s.RECEIVE_TRACK_BUFFER="receive_track_buffer",s.ON_AUDIO_BUFFER="on_audio_buffer",s.UPDATE_SOURCE="update_source"}(vr||(vr={})),function(s){s.UPDATE_TRACK_SOURCE="update-track-source"}(fE||(fE={}));const aC={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},mE={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Qo={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},dL={uplinkNetworkQuality:0,downlinkNetworkQuality:0},jD={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var Ii,yr,_c,xa,Bi;(function(s){s.ON_TRACK="on_track",s.ON_NODE="on_node"})(Ii||(Ii={})),function(s){s.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",s.REQUEST_CONSTRAINTS="request_constraints"}(yr||(yr={})),function(s){s.IDLE="IDLE",s.INITING="INITING",s.INITEND="INITEND"}(_c||(_c={})),function(s){s.STATE_CHANGE="state_change",s.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",s.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",s.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(xa||(xa={})),function(s){s.NONE="none",s.INIT="init",s.CANPLAY="canplay",s.PLAYING="playing",s.PAUSED="paused",s.SUSPEND="suspend",s.STALLED="stalled",s.WAITING="waiting",s.ERROR="error",s.DESTROYED="destroyed",s.ABORT="abort",s.ENDED="ended",s.EMPTIED="emptied",s.LOADEDDATA="loadeddata"}(Bi||(Bi={}));const _E={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};var bd;!function(s){s.OPEN="open",s.MESSAGE="message",s.CLOSE="close",s.CLOSING="closing",s.ERROR="error"}(bd||(bd={}));class HD extends qt{constructor(n,r){super(),C(this,"_ID",void 0),C(this,"_rtpTransceiver",void 0),C(this,"_lowRtpTransceiver",void 0),C(this,"_hints",[]),C(this,"_isClosed",!1),C(this,"_originMediaStreamTrack",void 0),C(this,"_mediaStreamTrack",void 0),C(this,"_external",{}),this._ID=r||Fe(8,"track-"),this._originMediaStreamTrack=n,this._mediaStreamTrack=n,ye(gh).call(gh,this)||gh.push(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(n){if(!n){Se.reportApiInvoke(null,{name:Nn.GET_MEDIA_STREAM_TRACK,options:[],tag:Jt.TRACER}).onSuccess(this._mediaStreamTrack&&"string"==typeof this._mediaStreamTrack.label?this._mediaStreamTrack.label:"")}return this._mediaStreamTrack}getRTCRtpTransceiver(n){return n===fc.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(n){const r=gh.indexOf(n);-1!==r&&gh.splice(r,1)}(this),this.emit(El.CLOSED)}_updateRtpTransceiver(n,r){if(r===fc.LOW_STREAM){if(this._lowRtpTransceiver===n)return;this._lowRtpTransceiver=n}else{if(this._rtpTransceiver===n)return;this._rtpTransceiver=n}this.emit(mc.TRANSCEIVER_UPDATED,n,r)}}class Ri extends HD{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}constructor(n,r){super(n,r),C(this,"_enabled",!0),C(this,"_muted",!1),C(this,"_isExternalTrack",!1),C(this,"_isClosed",!1),C(this,"_enabledMutex",void 0),C(this,"processor",void 0),C(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Zn("".concat(this.getTrackId())),n.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var n,r;return null!==(n=null===(r=this._originMediaStreamTrack)||void 0===r?void 0:r.label)&&void 0!==n?n:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,w.debug("[".concat(this.getTrackId(),"] close")),this.emit(fe.NEED_CLOSE),super.close())}_updateOriginMediaStreamTrack(n,r){var a=arguments,l=this;return x(function*(){l._isExternalTrack=a.length>2&&void 0!==a[2]&&a[2],n!==l._originMediaStreamTrack&&(l._originMediaStreamTrack&&(l._originMediaStreamTrack.removeEventListener("ended",l._handleTrackEnded),r&&l._originMediaStreamTrack.stop()),n.addEventListener("ended",l._handleTrackEnded),l._originMediaStreamTrack=n,l._muted&&(l._originMediaStreamTrack.enabled=!1),l._mediaStreamTrack=l._originMediaStreamTrack,l._updatePlayerSource(),yield Et(l,fe.NEED_REPLACE_TRACK,l),l.processor&&l.processor.updateInput({track:l._originMediaStreamTrack,context:l.processorContext}))})()}_getDefaultPlayerConfig(){return{}}onTrackEnded(){w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(El.TRACK_ENDED)}stateCheck(n,r){if(w.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(n,": ").concat(r,"]")),_s(r,n),this._enabled&&this._muted&&"enabled"===n&&!1===r)throw new X(M.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",w);if(!this._enabled&&!this._muted&&"muted"===n&&!0===r)throw new X(M.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",w)}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function gE(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}const EE=window.AudioContext||window.webkitAudioContext;let Jr=null;const vt=new class extends qt{constructor(){var s;super(...arguments),s=this,C(this,"prevState",void 0),C(this,"curState",void 0),C(this,"currentTime",void 0),C(this,"currentTimeStuckAt",void 0),C(this,"interruptDetectorTrack",void 0),C(this,"onLocalAudioTrackMute",()=>{w.info("ios15-interruption-start"),this.emit(Xn.IOS_15_16_INTERRUPTION_START)}),C(this,"onLocalAudioTrackUnmute",x(function*(){w.info("ios15-interruption-end"),"running"!==s.curState||s.duringInterruption?w.info("ios15-interruption-end-canceled"):(Jr&&(yield Jr.suspend()),s.emit(Xn.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(s){w.debug("webaudio bindInterruptDetectorTrack ".concat(s.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=s,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(s){w.debug("webaudio unbindInterruptDetectorTrack ".concat(s.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===s&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Eh(){if(!Jr){if(function cC(){if(!EE)return void w.error("your browser is not support web audio");w.info("create audio context");const s=function(n){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?gE(Object(a),!0).forEach(function(l){C(n,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):gE(Object(a)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(a,l))})}return n}({},j("WEBAUDIO_INIT_OPTIONS"));var n;w.debug("audio context init option:",JSON.stringify(s)),Jr=new EE(s),vt.curState=Jr.state,Jr.onstatechange=()=>{vt.prevState=vt.curState,vt.curState=Jr?Jr.state:void 0;const{prevState:n,curState:r}=vt,a="running"===r,l="interrupted"===r,d="running"===n,h="suspended"===n,p="interrupted"===n,m=dt().osVersion;(Fi()||po())&&d&&l&&(w.info("ios".concat(m,"-interruption-start")),vt.emit(Xn.IOS_INTERRUPTION_START)),(Fi()||po())&&(h||p)&&a&&(w.info("ios".concat(m,"-interruption-end")),vt.emit(Xn.IOS_INTERRUPTION_END)),n!==r&&(w.debug("AudioContext State Change","".concat(n,"=>").concat(r)),vt.emit(Xn.STATE_CHANGE))},setInterval(()=>{var n;const r=null===(n=Jr)||void 0===n?void 0:n.currentTime;vt.currentTime!==r?(vt.currentTimeStuckAt&&(w.debug("AudioContext current time resume at ".concat(r)),vt.currentTimeStuckAt=void 0),vt.currentTime=r):(r!==vt.currentTimeStuckAt&&(Se.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:Jt.TRACER}).onSuccess(),w.warning("AudioContext current time stuck at ".concat(r))),vt.currentTimeStuckAt=r)},5e3),(n=x(function*(r){const a=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let l,d=!1,h=!1,p=!1;function m(L){"running"===r.state?_(!1):Fi()||po()?"suspended"===r.state&&(_(!0),L&&r.resume().then(v,v)):"closed"!==r.state&&(_(!0),L&&r.resume().then(v,v))}function _(L){if(d!==L){d=L;for(let V=0,U=a;V<U.length;V+=1){const J=U[V];L?window.addEventListener(J,b,{capture:!0,passive:!0}):window.removeEventListener(J,b,{capture:!0,passive:!0})}}}function v(){m(!1)}function b(){m(!0)}function T(L){if(!p)if(l.paused)if(L){let V;O(!1),p=!0;try{V=l.play(),V?V.then(P,P):(l.addEventListener("playing",P),l.addEventListener("abort",P),l.addEventListener("error",P))}catch{P()}}else O(!0);else O(!1)}function O(L){if(h!==L){h=L;for(let V=0,U=a;V<U.length;V++){const J=U[V];L?window.addEventListener(J,D,{capture:!0,passive:!0}):window.removeEventListener(J,D,{capture:!0,passive:!0})}}}function P(){l.removeEventListener("playing",P),l.removeEventListener("abort",P),l.removeEventListener("error",P),p=!1,T(!1)}function D(){T(!0)}if(Fi()){const L=r.createMediaStreamDestination(),V=document.createElement("div");V.innerHTML="<audio x-webkit-airplay='deny'></audio>",l=V.children.item(0),l.controls=!1,l.disableRemotePlayback=!0,l.preload="auto",l.srcObject=L.stream,T(!0)}vt.on(Xn.STATE_CHANGE,function E(){m(!0)}),m(!1)}),function(r){return n.apply(this,arguments)})(Jr)}(),!Jr)throw new X(M.NOT_SUPPORTED,"can not create audio context");return Jr}return Jr}function GD(){return!!Jr}function Sd(s){if(function(){if(null!==lC)return lC;const a=Eh(),l=a.createBufferSource(),d=a.createGain(),h=a.createGain();l.connect(d),l.connect(h),l.disconnect(d);let p=!1;try{l.disconnect(d)}catch{p=!0}return l.disconnect(),lC=p,p}())return;const n=s.connect,r=s.disconnect;s.connect=(a,l,d)=>{var h;return s._inputNodes||(s._inputNodes=[]),ye(h=s._inputNodes).call(h,a)||(a instanceof AudioNode?(s._inputNodes.push(a),n.call(s,a,l,d)):n.call(s,a,l)),s},s.disconnect=(a,l,d)=>{r.call(s),a?_S(s._inputNodes,a):s._inputNodes=[];for(const h of s._inputNodes)n.call(s,h)}}let lC=null;function vE(s,n){let r=!1;const a=1/n;if(j("DISABLE_WEBAUDIO")){const l=window.setInterval(()=>{r?window.clearInterval(l):s(performance.now()/1e3)},1e3*a)}else{const l=Eh();let d=l.createGain();d.gain.value=0,d.connect(l.destination);const h=()=>{if(r)return void(d=null);const p=l.createOscillator();p.onended=h,p.connect(d),p.start(0),p.stop(l.currentTime+a),s(l.currentTime)};h()}return()=>{r=!0}}const vi={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1};function $e(){return vi}class Js{constructor(){C(this,"context",void 0),C(this,"analyserNode",void 0),C(this,"sourceNode",void 0),this.context=Eh(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(n){if(n!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=n,n?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Fi()||po()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode))return 0;const n=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(n);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let l=0;l<n.length;++l)n[l]=a[l]/128-1}const r=al(n).call(n,(a,l)=>a+l*l,0)/n.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var n,r;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(r=this.sourceNode)||void 0===r||r.connect(this.analyserNode)}catch{w.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class ka extends qt{get processSourceNode(){return this.sourceNode}set processedNode(n){var r;if(!this.isDestroyed&&this._processedNode!==n){try{var a;null===(a=this.sourceNode)||void 0===a||a.disconnect(this.outputNode)}catch{}null===(r=this._processedNode)||void 0===r||r.disconnect(),this._processedNode=n,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),C(this,"outputNode",void 0),C(this,"outputTrack",void 0),C(this,"isPlayed",!1),C(this,"context",void 0),C(this,"audioBufferNode",void 0),C(this,"destNode",void 0),C(this,"audioOutputLevel",0),C(this,"volumeLevelAnalyser",void 0),C(this,"_processedNode",void 0),C(this,"playNode",void 0),C(this,"isDestroyed",!1),C(this,"onNoAudioInput",void 0),C(this,"isNoAudioInput",!1),C(this,"_noAudioInputCount",0),this.context=Eh(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Sd(this.outputNode),this.volumeLevelAnalyser=new Js}startGetAudioBuffer(n){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(n),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(vr.ON_AUDIO_BUFFER,function(a){for(let l=0;l<a.outputBuffer.numberOfChannels;l+=1){const d=a.outputBuffer.getChannelData(l);for(let h=0;h<d.length;h+=1)d[h]=0}return a.inputBuffer}(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!$e().webAudioMediaStreamDest)throw new X(M.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(n){"running"!==this.context.state&&mo(()=>{vt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=n||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}checkHasAudioInput(){var n=arguments,r=this;return x(function*(){let a=n.length>0&&void 0!==n[0]?n[0]:0;if(a>5)return r.isNoAudioInput=!0,r.onNoAudioInput&&r.onNoAudioInput(),!1;Fi()||po()?"suspended"===r.context.state&&r.context.resume():"running"!==r.context.state&&r.context.resume();const l=r.volumeLevelAnalyser.getAnalyserNode();let d;l.getFloatTimeDomainData?(d=new Float32Array(l.fftSize),l.getFloatTimeDomainData(d)):(d=new Uint8Array(l.fftSize),l.getByteTimeDomainData(d));let h=!1;for(let p=0;p<d.length;p++)0!==d[p]&&(h=!0);return h?(r.isNoAudioInput=!1,!0):(yield gi(200),(yield r.checkHasAudioInput(a?a+1:1))&&h)})()}getAudioVolume(){return this.outputNode.gain.value}setVolume(n){this.outputNode.gain.setValueAtTime(n,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var n,r;null===(n=this.processedNode)||void 0===n||n.disconnect(),null===(r=this.sourceNode)||void 0===r||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var n;this.processedNode?null===(n=this.processedNode)||void 0===n||n.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class ji extends ka{get isFreeze(){return!1}constructor(n,r,a){var l,d;if(super(),l=this,C(this,"sourceNode",void 0),C(this,"track",void 0),C(this,"clonedTrack",void 0),C(this,"audioElement",void 0),C(this,"isCurrentTrackCloned",!1),C(this,"isRemoteTrack",!1),C(this,"originVolumeLevelAnalyser",void 0),C(this,"rebuildWebAudio",x(function*(){if(w.debug("ready to rebuild web audio, state:",l.context.state),l.isNoAudioInput&&(yield l.checkHasAudioInput()),!l.isNoAudioInput||l.isDestroyed)return document.body.removeEventListener("click",l.rebuildWebAudio,!0),void w.debug("rebuild web audio success, current volume status",l.getAccurateVolumeLevel());l.context.resume().then(()=>w.info("resume success")),w.debug("rebuild web audio because of ios 12 bugs"),l.disconnect();const m=l.track;l.track=l.track.clone(),l.isCurrentTrackCloned?m.stop():l.isCurrentTrackCloned=!0;const _=new MediaStream([l.track]);l.sourceNode=l.context.createMediaStreamSource(_),Sd(l.sourceNode),l.volumeLevelAnalyser.rebuildAnalyser();const E=l.outputNode.gain.value;l.outputNode=l.context.createGain(),l.outputNode.gain.setValueAtTime(E,l.context.currentTime),Sd(l.outputNode),l.emit(vr.UPDATE_SOURCE),l.connect(),l.audioElement.srcObject=_,l.isPlayed&&l.play(l.playNode),l.checkHasAudioInput()})),"audio"!==n.kind)throw new X(M.UNEXPECTED_ERROR);this.track=n;const h=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(h),Sd(this.sourceNode),a){const m=a.clone();m.enabled=!0,this.clonedTrack=m,w.debug("create an unmuted track ".concat(m.id," from the original track ").concat(a.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));Sd(_),this.originVolumeLevelAnalyser=new Js,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=h;const p=dt();r&&p.os===Fn.IOS&&Number(null===(d=p.osVersion)||void 0===d?void 0:d.split(".")[0])<15&&(vt.on(Xn.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(n){this.sourceNode.disconnect(),this.track=n,this.isCurrentTrackCloned=!1;const r=new MediaStream([n]);this.sourceNode=this.context.createMediaStreamSource(r),Sd(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(vr.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var n;this.audioElement.srcObject=null,this.audioElement.remove(),vt.off("state-change",this.rebuildWebAudio),null===(n=this.originVolumeLevelAnalyser)||void 0===n||n.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(n){return this.context.createMediaStreamSource(new MediaStream([n]))}updateOriginTrack(n){const r=n.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),w.debug("create an unmuted track ".concat(r.id," from the original track ").concat(n.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([r]));Sd(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}function WD(s,n,r){return yE.apply(this,arguments)}function yE(){return yE=x(function*(s,n,r){const a=(d,h)=>d?"number"!=typeof d?d.max||d.exact||d.ideal||d.min||h:d:h,l={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxHeight:a(n.height,1080),maxWidth:a(n.width,1920)}}};return n.frameRate&&"number"!=typeof n.frameRate?(l.video.mandatory.maxFrameRate=n.frameRate.max,l.video.mandatory.minFrameRate=n.frameRate.min):"number"==typeof n.frameRate&&(l.video.mandatory.maxFrameRate=n.frameRate),yield navigator.mediaDevices.getUserMedia(l)}),yE.apply(this,arguments)}function dC(){return dC=x(function*(s,n){const r=yield uC(s.mediaSource),{sourceId:a,audio:l}=yield function(d){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new z((p,m)=>{const _=document.createElement("div");_.innerText="share screen",_.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const E=document.createElement("div");E.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const v=document.createElement("div");v.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",v.setAttribute("style","height: 12%;");const b=document.createElement("div");b.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const T=document.createElement("div");T.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const O=document.createElement("button");O.innerHTML="cancel",O.setAttribute("style","width: 85px;"),O.onclick=()=>{document.body.removeChild(L);const V=new Error("NotAllowedError");V.name="NotAllowedError",m(V)};let P=h;const D=document.createElement("div");if(h){const V=document.createElement("input");V.setAttribute("type","checkbox");const U=document.createElement("span");V.setAttribute("style","margin-right: 6px;"),U.innerText="Share audio",V.checked=P,V.onchange=()=>{P=V.checked},D.appendChild(V),D.appendChild(U)}T.appendChild(D),T.appendChild(O),E.appendChild(v),E.appendChild(b),E.appendChild(T);const L=document.createElement("div");L.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),L.appendChild(_),L.appendChild(E),document.body.appendChild(L),d.map(V=>{if(V.id){const U=document.createElement("div");U.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let J=V.thumbnail;try{const{width:se}=J.getSize();se>1920&&(J=J.resize({width:1920}))}catch(se){throw se&&se.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),se}U.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+J.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+V.name.replace(/[\u00A0-\u9999<>\&]/g,function(se){return"&#"+se.charCodeAt(0)+";"})+"</span>",U.onclick=()=>{document.body.removeChild(L),p({sourceId:V.id,audio:P})},b.appendChild(U)}})})}(r,n);return yield WD(a,s,l)}),dC.apply(this,arguments)}function uC(s){return Pf.apply(this,arguments)}function Pf(){return Pf=x(function*(s){let n=["window","screen"];"application"!==s&&"window"!==s||(n=["window"]),"screen"===s&&(n=["screen"]);const r=Ck();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new X(M.ELECTRON_IS_NULL);let a=null;try{var l;a=(null===(l=r.desktopCapturer)||void 0===l?void 0:l.getSources({types:n}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:n})}catch{a=null}a&&a.then||(a=new z((d,h)=>{r.desktopCapturer.getSources({types:n},(p,m)=>{p?h(p):d(m)})}));try{return yield a}catch(d){throw new X(M.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}),Pf.apply(this,arguments)}function xr(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}const vl=new Zn("safari");let qD=!1,KD=!1;function Zo(s,n){return YD.apply(this,arguments)}function YD(){return YD=x(function*(s,n){let r=0,a=null;for(;r<2;)try{a=yield $D(s,n,r>0);break}catch(l){if(l instanceof X)throw w.error("[".concat(n,"] ").concat(l.toString())),l;const d=hC(l.name||l.code||l,l.message);if(d.code===M.MEDIA_OPTION_INVALID){w.debug("[".concat(n,"] detect media option invalid, retry")),r+=1,yield gi(500);continue}throw w.error("[".concat(n,"] ").concat(d.toString())),d}if(!a)throw new X(M.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}),YD.apply(this,arguments)}function $D(s,n,r){return Mf.apply(this,arguments)}function Mf(){return Mf=x(function*(s,n,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new X(M.NOT_SUPPORTED,"can not find getUserMedia");r&&(s.video&&(delete s.video.width,delete s.video.height),s.screen&&(delete s.screen.width,delete s.screen.height));const a=$e(),l=new MediaStream;if(s.audioSource&&l.addTrack(s.audioSource),s.videoSource&&l.addTrack(s.videoSource),!s.audio&&!s.video&&!s.screen)return w.debug("Using Video Source/ Audio Source"),l;if(s.screen)if(Ck())xf(l,s.screen.sourceId?yield WD(s.screen.sourceId,s.screen,s.screenAudio):yield function zD(s,n){return dC.apply(this,arguments)}(s.screen,s.screenAudio));else if(kg()&&s.screen.extensionId&&s.screen.mandatory){if(!a.getStreamFromExtension)throw new X(M.NOT_SUPPORTED,"This browser does not support screen sharing");w.debug("[".concat(n,'] Screen access on chrome stable, looking for extension"'));const b=yield(h=s.screen.extensionId,p=n,new z((T,O)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},P=>{if(!P||!P.streamId)return w.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),P),void O(new X(M.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));T(P.streamId)})}catch(P){w.error("[".concat(p,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),P.toString()),O(new X(M.CHROME_PLUGIN_NOT_INSTALL))}}));s.screen.mandatory.chromeMediaSourceId=b,xf(l,yield navigator.mediaDevices.getUserMedia({video:{mandatory:s.screen.mandatory}}))}else if(a.getDisplayMedia){var d;s.screen.mediaSource&&BD(s.screen.mediaSource);const b={width:s.screen.width,height:s.screen.height,frameRate:s.screen.frameRate,displaySurface:null!==(d=s.screen.displaySurface)&&void 0!==d?d:"screen"===s.screen.mediaSource?"monitor":s.screen.mediaSource},{selfBrowserSurface:T,surfaceSwitching:O,systemAudio:P}=s.screen,D={selfBrowserSurface:T,surfaceSwitching:O,systemAudio:P};!T&&delete D.selfBrowserSurface,!O&&delete D.surfaceSwitching,!P&&delete D.systemAudio,w.debug("[".concat(n,"] getDisplayMedia:"),JSON.stringify({video:b,audio:!!s.screenAudio,controls:D}));const L=yield navigator.mediaDevices.getDisplayMedia(function(V){for(var U=1;U<arguments.length;U++){var J=null!=arguments[U]?arguments[U]:{};U%2?xr(Object(J),!0).forEach(function(se){C(V,se,J[se])}):Object.getOwnPropertyDescriptors?Object.defineProperties(V,Object.getOwnPropertyDescriptors(J)):xr(Object(J)).forEach(function(se){Object.defineProperty(V,se,Object.getOwnPropertyDescriptor(J,se))})}return V}({video:b,audio:!!s.screenAudio},D));xf(l,L)}else{if(!zt())throw w.error("[".concat(n,"] This browser does not support screenSharing")),new X(M.NOT_SUPPORTED,"This browser does not support screen sharing");{s.screen.mediaSource&&BD(s.screen.mediaSource);const b={video:{mediaSource:s.screen.mediaSource,width:s.screen.width,height:s.screen.height,frameRate:s.screen.frameRate}};w.debug("[".concat(n,"] getUserMedia: ").concat(JSON.stringify(b))),xf(l,yield navigator.mediaDevices.getUserMedia(b))}}var h,p;if(!s.video&&!s.audio)return l;let m={video:s.video,audio:s.audio},_=j("MEDIA_DEVICE_CONSTRAINTS");if(_)try{"string"==typeof _&&(_=JSON.parse(_)),m=dd(m,_)}catch{}w.debug("[".concat(n,"] GetUserMedia"),JSON.stringify(m)),dt();let E,v=null;(Ki()||Fi()||xg())&&(v=yield vl.lock());try{E=yield navigator.mediaDevices.getUserMedia(m)}catch(b){throw v&&v(),b}return m.audio&&(qD=!0),m.video&&(KD=!0),xf(l,E),v&&v(),l}),Mf.apply(this,arguments)}function hC(s,n){switch(s){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new X(M.MEDIA_OPTION_INVALID,"".concat(s,": ").concat(n));case"NotFoundError":case"DevicesNotFoundError":return new X(M.DEVICE_NOT_FOUND,"".concat(s,": ").concat(n));case"NotSupportedError":return new X(M.NOT_SUPPORTED,"".concat(s,": ").concat(n));case"NotReadableError":return new X(M.NOT_READABLE,"".concat(s,": ").concat(n));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new X(M.PERMISSION_DENIED,"".concat(s,": ").concat(n));case"ConstraintNotSatisfiedError":return new X(M.CONSTRAINT_NOT_SATISFIED,"".concat(s,": ").concat(n));default:return w.error("getUserMedia unexpected error",s),new X(M.UNEXPECTED_ERROR,"".concat(s,": ").concat(n))}}function xf(s,n){const r=s.getVideoTracks()[0],a=s.getAudioTracks()[0],l=n.getVideoTracks()[0],d=n.getAudioTracks()[0];d&&(a&&s.removeTrack(a),s.addTrack(d)),l&&(r&&s.removeTrack(r),s.addTrack(l))}const es=new class extends qt{get state(){return this._state}set state(s){s!==this._state&&(this.emit(xa.STATE_CHANGE,s),this._state=s)}constructor(){super(),C(this,"_state",_c.IDLE),C(this,"isAccessMicrophonePermission",!1),C(this,"isAccessCameraPermission",!1),C(this,"lastAccessMicrophonePermission",!1),C(this,"lastAccessCameraPermission",!1),C(this,"checkdeviceMatched",!1),C(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(j("ENUMERATE_DEVICES_INTERVAL")||(Yr()||Mg()===Fn.HARMONY_OS)&&zs())&&this.updateDevicesInfo()},j("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(s=>w.error(s.toString()))}enumerateDevices(s,n){var r=arguments,a=this;return x(function*(){let l=r.length>2&&void 0!==r[2]&&r[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new X(M.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const d=yield navigator.mediaDevices.enumerateDevices(),h=a.checkMediaDeviceInfoIsOk(d);let p=!a.isAccessMicrophonePermission&&s,m=!a.isAccessCameraPermission&&n;h.audio&&(p=!1),h.video&&(m=!1);let _=null,E=null,v=null;if(!l&&(p||m)){if(vl.isLocked&&(w.debug("[device manager] wait GUM lock"),(yield vl.lock())(),w.debug("[device manager] GUM unlock")),qD&&(p=!1,a.isAccessMicrophonePermission=!0),KD&&(m=!1,a.isAccessCameraPermission=!0),w.debug("[device manager] check media device permissions",s,n,p,m),p&&m){try{v=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(b){const T=hC(b.name||b.code||b,b.message);if(T.code===M.PERMISSION_DENIED)throw T;w.warning("getUserMedia failed in getDevices",T)}a.isAccessCameraPermission=!0,a.isAccessMicrophonePermission=!0}else if(p){try{_=yield navigator.mediaDevices.getUserMedia({audio:s})}catch(b){const T=hC(b.name||b.code||b,b.message);if(T.code===M.PERMISSION_DENIED)throw T;w.warning("getUserMedia failed in getDevices",T)}a.isAccessMicrophonePermission=!0}else if(m){try{E=yield navigator.mediaDevices.getUserMedia({video:n})}catch(b){const T=hC(b.name||b.code||b,b.message);if(T.code===M.PERMISSION_DENIED)throw T;w.warning("getUserMedia failed in getDevices",T)}a.isAccessCameraPermission=!0}w.debug("[device manager] mic permission",s,"cam permission",n)}try{const b=yield navigator.mediaDevices.enumerateDevices();return _&&_.getTracks().forEach(T=>T.stop()),E&&E.getTracks().forEach(T=>T.stop()),v&&v.getTracks().forEach(T=>T.stop()),_=null,E=null,v=null,b}catch(b){return _&&_.getTracks().forEach(T=>T.stop()),E&&E.getTracks().forEach(T=>T.stop()),v&&v.getTracks().forEach(T=>T.stop()),_=null,E=null,v=null,new X(M.ENUMERATE_DEVICES_FAILED,b.toString()).throw()}})()}getRecordingDevices(){var s=arguments,n=this;return x(function*(){let r=s.length>0&&void 0!==s[0]&&s[0];return(yield n.enumerateDevices(!0,!1,r)).filter(a=>"audioinput"===a.kind)})()}getCamerasDevices(){var s=arguments,n=this;return x(function*(){let r=s.length>0&&void 0!==s[0]&&s[0];return(yield n.enumerateDevices(!1,!0,r)).filter(a=>"videoinput"===a.kind)})()}getSpeakers(){var s=arguments,n=this;return x(function*(){let r=s.length>0&&void 0!==s[0]&&s[0];return(yield n.enumerateDevices(!0,!1,r)).filter(a=>"audiooutput"===a.kind)})()}searchDeviceIdByName(s){let n=null;return this.deviceInfoMap.forEach(r=>{r.device.label===s&&(n=r.device.deviceId)}),n}getDeviceById(s){var n=this;return x(function*(){const r=(yield n.enumerateDevices(!0,!0,!0)).find(a=>a.deviceId===s);if(!r)throw new X(M.DEVICE_NOT_FOUND,"deviceId: ".concat(s));return r})()}init(){var s=this;return x(function*(){s.state=_c.INITING;try{yield s.updateDevicesInfo(),s.state=_c.INITEND}catch(n){throw w.warning("Device Detection functionality cannot start properly.",n.toString()),s.state=_c.IDLE,!("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)&&new X(M.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),n}})()}updateDevicesInfo(){var s=this;return x(function*(){const n=yield s.enumerateDevices(!0,!0,!0),r=Date.now(),a=[];if(n[0]&&n[0].label&&!1===s.checkdeviceMatched){s.checkdeviceMatched=!0;const d=n.find(p=>"audioinput"===p.kind&&"default"===p.deviceId),h=n.find(p=>"audiooutput"===p.kind&&"default"===p.deviceId);d&&h?h.groupId===d.groupId?w.debug("[device-check] default input ".concat(d.label," and output ").concat(h.label," is the same group")):w.warning("[device-check] default input ".concat(d.label," and output ").concat(h.label," is not the same group")):w.debug("[device-check] default input or output not found")}const l=s.checkMediaDeviceInfoIsOk(n);if(n.forEach(d=>{if(!d.deviceId)return;const h=s.deviceInfoMap.get("".concat(d.kind,"_").concat(d.deviceId));if("ACTIVE"!==(h?h.state:"INACTIVE")){const p={initAt:r,updateAt:r,device:d,state:"ACTIVE"};s.deviceInfoMap.set("".concat(d.kind,"_").concat(d.deviceId),p),a.push(p)}h&&(h.updateAt=r)}),s.deviceInfoMap.forEach((d,h)=>{"ACTIVE"===d.state&&d.updateAt!==r&&(d.state="INACTIVE",a.push(d))}),s.state!==_c.INITEND)return l.audio&&(s.lastAccessMicrophonePermission=!0,s.isAccessMicrophonePermission=!0),void(l.video&&(s.lastAccessCameraPermission=!0,s.isAccessCameraPermission=!0));a.forEach(d=>{switch(d.device.kind){case"audioinput":s.lastAccessMicrophonePermission&&s.isAccessMicrophonePermission&&s.emit(xa.RECORDING_DEVICE_CHANGED,d);break;case"videoinput":s.lastAccessCameraPermission&&s.isAccessCameraPermission&&s.emit(xa.CAMERA_DEVICE_CHANGED,d);break;case"audiooutput":s.lastAccessMicrophonePermission&&s.isAccessMicrophonePermission&&s.emit(xa.PLAYOUT_DEVICE_CHANGED,d)}}),l.audio&&(s.lastAccessMicrophonePermission=!0,s.isAccessMicrophonePermission=!0),l.video&&(s.lastAccessCameraPermission=!0,s.isAccessCameraPermission=!0)})()}checkMediaDeviceInfoIsOk(s){const n=s.filter(l=>"audioinput"===l.kind),r=s.filter(l=>"videoinput"===l.kind),a={audio:!1,video:!1};for(const l of n)if(l.label&&l.deviceId){a.audio=!0;break}for(const l of r)if(l.label&&l.deviceId){a.video=!0;break}return a}};let Cd=!1;const So=new class extends qt{constructor(){super(...arguments),C(this,"onAutoplayFailed",void 0),C(this,"onAudioAutoplayFailed",void 0)}};function bE(){if(dt(),!Cd){const s=n=>{n.preventDefault(),Cd=!1,ri()?document.body.removeEventListener("click",s,!0):(document.body.removeEventListener("touchstart",s,!0),document.body.removeEventListener("mousedown",s,!0))};Cd=!0,ri()?document.body.addEventListener("click",s,!0):(document.body.addEventListener("touchstart",s,!0),document.body.addEventListener("mousedown",s,!0)),w.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),So.onAutoplayFailed?So.onAutoplayFailed():w.warning(So.onAudioAutoplayFailed?"AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .":"We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),So.emit("autoplay-failed")}}function XD(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function pC(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?XD(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):XD(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function JD(s,n,r,a){if(!s)return;const l=Se.getBaseInfoBySessionId(s);if(!l)return;const d=l.info,h=Date.now(),p=pC(pC({},d),{},{vid:void 0===d.vid?0:Number(d.vid),lts:h,elapse:h-l.startTime,cbRegistered:So.onAutoplayFailed||So.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:n,trackId:a,extend:void 0});Se.send({type:Kt.AUTOPLAY_FAILED,data:p},!0)}const uL=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Qr=new class{constructor(){C(this,"onAutoplayFailed",void 0),C(this,"elementMap",new Map),C(this,"elementStateMap",new Map),C(this,"elementsNeedToResume",[]),C(this,"sinkIdMap",new Map),C(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(s=>{let[n,r]=s;const a=this.elementStateMap.get(n),l=r.srcObject.getAudioTracks()[0];rl()?l&&"live"===l.readyState&&"running"===vt.curState&&(w.debug("auto resume after interruption for iOS 15"),r.pause(),r.play()):a&&"paused"===a&&l&&"live"===l.readyState&&"running"===vt.curState&&(w.debug("auto resume after interruption for iOS"),r.play())})}),C(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(s=>{let[n,r]=s;const a=r.srcObject.getAudioTracks()[0];a&&"live"===a.readyState&&(w.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),vt.on(Xn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),vt.on(Xn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),vt.on(Xn.STATE_CHANGE,()=>{Fi()&&"suspended"===vt.prevState&&"running"===vt.curState&&this.autoResumeAfterInterruption()})}setSinkID(s,n){var r=this;return x(function*(){const a=r.elementMap.get(s);if(r.sinkIdMap.set(s,n),a)try{yield a.setSinkId(n)}catch(l){throw new X(M.PERMISSION_DENIED,"can not set sink id: "+l.toString())}})()}play(s,n,r,a){if(this.elementMap.has(n))return;const l=document.createElement("audio");l.autoplay=!0,l.srcObject=new MediaStream([s]),this.bindAudioElementEvents(n,l),this.elementMap.set(n,l),this.elementStateMap.set(n,Bi.INIT),this.setVolume(n,r);const d=this.sinkIdMap.get(n);if(d)try{l.setSinkId(d).catch(p=>{w.warning("[".concat(n,"] set sink id failed"),p.toString())})}catch(p){w.warning("[".concat(n,"] set sink id failed"),p.toString())}const h=l.play();h&&h.then&&h.catch(p=>{a&&JD(a,"audio",p.message,n),w.warning("audio element play warning",p.toString()),this.elementMap.has(n)&&"NotAllowedError"===p.name&&(w.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(l),mo(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),bE()}))})}updateTrack(s,n){const r=this.elementMap.get(s);r&&(r.srcObject=new MediaStream([n]))}isPlaying(s){return this.elementMap.has(s)&&"playing"===this.elementStateMap.get(s)}setVolume(s,n){const r=this.elementMap.get(s);r&&(n=Math.max(0,Math.min(100,n)),r.volume=n/100)}stop(s){const n=this.elementMap.get(s);if(this.sinkIdMap.delete(s),!n)return;const r=this.elementsNeedToResume.indexOf(n);this.elementsNeedToResume.splice(r,1),n.srcObject=null,n.remove(),this.elementMap.delete(s),this.elementStateMap.delete(s)}bindAudioElementEvents(s,n){uL.forEach(r=>{n.addEventListener(r,a=>{const l=this.elementStateMap.get(s),d="pause"===a.type?"paused":a.type;if(w.debug("[".concat(s,"] audio-element-status change ").concat(l," => ").concat(d)),"error"===a.type){const h=n?.error;h&&w.error("[".concat(s,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(s,d)})})}getPlayerState(s){return this.elementStateMap.get(s)||"uninit"}autoResumeAudioElement(){const s=()=>{this.elementsNeedToResume.forEach(n=>{n.play().then(r=>{w.debug("Auto resume audio element success")}).catch(r=>{w.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new z(n=>{document.body?n():window.addEventListener("load",()=>n())}).then(()=>{ri()?document.body.addEventListener("click",s,!0):(document.body.addEventListener("touchstart",s,!0),document.body.addEventListener("mousedown",s,!0))})}};function an(){return function(s,n,r){const a=r.value;return"function"==typeof a&&(r.value=function(){this._isClosed&&new X(M.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",w);for(var l=arguments.length,d=new Array(l),h=0;h<l;h++)d[h]=arguments[h];const p=a.apply(this,d);return p instanceof z?new z((m,_)=>{p.then(m).catch(_)}):p}),r}}function fC(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function SE(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?fC(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):fC(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class kf extends qt{constructor(n){super(),C(this,"name","VideoProcessorDestination"),C(this,"ID","0"),C(this,"_source",void 0),C(this,"videoContext",void 0),C(this,"inputTrack",void 0),this.videoContext=n}get kind(){return"video"}get enabled(){return!0}pipe(){throw new X(M.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new X(M.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(n){if(n.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");n.track&&n.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=n.track,this.emit(Ii.ON_TRACK,n.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Ii.ON_TRACK,void 0)}}class CE extends qt{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,r){super(),C(this,"constraintsMap",new Map),C(this,"statsRegistry",[]),C(this,"usageRegistry",[]),C(this,"trackId",void 0),C(this,"direction",void 0),C(this,"_chained",!1),this.trackId=n,this.direction=r}getConstraints(){var n=this;return x(function*(){return yield Qt(n,yr.REQUEST_CONSTRAINTS)})()}requestApplyConstraints(n,r){var a=this;return x(function*(){var l;return w.info("processor ".concat(r.name," requestApplyConstraints for ").concat(a.trackId)),n&&a.constraintsMap.set(r,n),Et(a,yr.REQUEST_UPDATE_CONSTRAINTS,Array.from(yo(l=a.constraintsMap).call(l)))})()}requestRevertConstraints(n){var r=this;return x(function*(){var a;if(r.constraintsMap.has(n))return w.info("processor ".concat(n.name," requestRevertConstraints for ").concat(r.trackId)),r.constraintsMap.delete(n),Et(r,yr.REQUEST_UPDATE_CONSTRAINTS,Array.from(yo(a=r.constraintsMap).call(a)))})()}registerStats(n,r,a){this.statsRegistry.find(l=>l.processorID===n.ID&&l.processorName===n.name&&l.type===r)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:r,cb:a})}unregisterStats(n,r){const a=this.statsRegistry.findIndex(l=>l.processorID===n.ID&&l.processorName===n.name&&l.type===r);-1!==a&&this.statsRegistry.splice(a,1)}gatherStats(){const n=[];for(const{processorID:r,processorName:a,type:l,cb:d}of this.statsRegistry)try{const h=d();n.push({processorID:r,processorName:a,type:l,stats:h})}catch(h){w.error(new X(M.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,r){this.usageRegistry.find(a=>a.processorID===n.ID&&a.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:r})}unregisterUsage(n){const r=this.usageRegistry.findIndex(a=>a.processorID===n.ID&&a.processorName===n.name);-1!==r&&this.usageRegistry.splice(r,1)}gatherUsage(){var n=this;return x(function*(){const r=[];if(!n.chained)return[];for(const{cb:a}of n.usageRegistry)try{let l=a();l instanceof z&&(l=yield l),r.push(SE(SE({},l),{},{direction:n.direction}))}catch(l){w.error("gather extension usage error",l)}return r})()}getDirection(){return this.direction}}class mC extends qt{constructor(n){super(),C(this,"name","AudioProcessorDestination"),C(this,"ID","0"),C(this,"inputTrack",void 0),C(this,"inputNode",void 0),C(this,"audioProcessorContext",void 0),C(this,"_source",void 0),this.audioProcessorContext=n}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new X(M.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new X(M.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Ii.ON_TRACK,void 0),this.emit(Ii.ON_NODE,void 0)}updateInput(n){if(n.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");n.track&&this.inputTrack!==n.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=n.track,this.emit(Ii.ON_TRACK,this.inputTrack)),n.node&&this.inputNode!==n.node&&(this.audioProcessorContext.chained=!0,this.inputNode=n.node,this.emit(Ii.ON_NODE,this.inputNode))}}class Lf extends qt{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,r,a){super(),C(this,"constraintsMap",new Map),C(this,"statsRegistry",[]),C(this,"audioContext",void 0),C(this,"trackId",void 0),C(this,"direction",void 0),C(this,"usageRegistry",[]),C(this,"_chained",!1),this.audioContext=n,this.trackId=r,this.direction=a}getConstraints(){var n=this;return x(function*(){return Qt(n,yr.REQUEST_CONSTRAINTS)})()}getAudioContext(){return this.audioContext}requestApplyConstraints(n,r){var a=this;return x(function*(){var l;return w.info("processor ".concat(r.name," requestApplyConstraints for ").concat(a.trackId)),n&&a.constraintsMap.set(r,n),Et(a,yr.REQUEST_UPDATE_CONSTRAINTS,Array.from(yo(l=a.constraintsMap).call(l)))})()}requestRevertConstraints(n){var r=this;return x(function*(){var a;if(r.constraintsMap.has(n))return r.constraintsMap.delete(n),Et(r,yr.REQUEST_UPDATE_CONSTRAINTS,Array.from(yo(a=r.constraintsMap).call(a)))})()}registerStats(n,r,a){this.statsRegistry.find(l=>l.processorID===n.ID&&l.processorName===n.name&&l.type===r)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:r,cb:a})}unregisterStats(n,r){const a=this.statsRegistry.findIndex(l=>l.processorID===n.ID&&l.processorName===n.name&&l.type===r);-1!==a&&this.statsRegistry.splice(a,1)}gatherStats(){const n=[];for(const{processorID:r,processorName:a,type:l,cb:d}of this.statsRegistry)try{const h=d();n.push({processorID:r,processorName:a,type:l,stats:h})}catch(h){w.error(new X(M.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,r){this.usageRegistry.find(a=>a.processorID===n.ID&&a.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:r})}unregisterUsage(n){const r=this.usageRegistry.findIndex(a=>a.processorID===n.ID&&a.processorName===n.name);-1!==r&&this.usageRegistry.splice(r,1)}gatherUsage(){var n=this;return x(function*(){const r=[];if(!n.chained)return[];for(const{cb:a}of n.usageRegistry)try{let l=a();l instanceof z&&(l=yield l),r.push(SE(SE({},l),{},{direction:n.direction}))}catch(l){w.error("gather extension usage error",l)}return r})()}getDirection(){return this.direction}}class _C extends qt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),C(this,"context",void 0),C(this,"processSourceNode",void 0),C(this,"outputTrack",void 0),C(this,"processedNode",void 0),C(this,"clonedTrack",void 0),C(this,"outputNode",void 0),this.outputNode=new QD}setVolume(){}createOutputTrack(){throw new X(M.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class QD{disconnect(){}connect(){}}let Qs=null;class hL{constructor(){C(this,"state","open"),C(this,"trigger",void 0),C(this,"tasks",[]),w.debug("[macro-task-queue] is created."),this.trigger=window.setTimeout(()=>{this.state="closed",w.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(n=>n.key),"]")),this.trigger=void 0,this.tasks.forEach(n=>{let{func:r}=n;return r()}),this.tasks.length=0,w.debug("[macro-task-queue] is closed.")})}enqueue(n,r){"closed"!==this.state&&(this.tasks.push({key:n,func:r}),w.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof n?n:"")))}runTask(n){if("closed"===this.state)return;const r=this.tasks.findIndex(a=>a.key===n);if(-1!==r){const a=this.tasks.splice(r,1);w.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof n?n:"")),a[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,w.debug("[macro-task-queue] is closed."))}}function TE(s){return function(n,r,a){var l;const d=null!==(l=a.value)&&void 0!==l?l:a.get,h=function(){Qs&&"open"===Qs.state&&Qs.runTask(s);for(var p=arguments.length,m=new Array(p),_=0;_<p;_++)m[_]=arguments[_];return d?.apply(this,...m)};return a.value?a.value=h:a.get=h,a}}function wE(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function ZD(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?wE(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):wE(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class mt extends Ri{get _source(){return this._trackSource}set _source(n){this._trackSource=n}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}get processorDestination(){return this._processorDestination}set processorDestination(n){this._processorDestination=n}get isPlaying(){return this._useAudioElement?Qr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(n,r,a,l,d){super(n,a),C(this,"trackMediaType","audio"),C(this,"_encoderConfig",void 0),C(this,"_trackSource",void 0),C(this,"_enabled",!0),C(this,"_volume",100),C(this,"_useAudioElement",!1),C(this,"_bypassWebAudio",!1),C(this,"processor",void 0),C(this,"_processorContext",void 0),C(this,"_processorDestination",void 0),C(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!l;const h=()=>{this.processorContext=new Lf(this._source.context,this.getTrackId(),"local"),this.processorDestination=new mC(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(vr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},p=d&&Ki()&&!GD();j("DISABLE_WEBAUDIO")?(this._source=new _C,this._useAudioElement=!0,this._bypassWebAudio=!0):p?this._source=new _C:(this._source=new ji(n,!1,this._getOriginVolumeLevel?n:void 0),j("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),h(),!j("DISABLE_WEBAUDIO")&&p&&(Qs||(Qs=new hL),Qs).enqueue("INIT_WEBAUDIO",()=>{this._source=new ji(n,!1,this._getOriginVolumeLevel?n:void 0),j("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),h(),this.emit(fE.UPDATE_TRACK_SOURCE)})}setVolume(n){ft(n,"volume",0,1e3),this._volume=n,this._source.setVolume(n/100),this._useAudioElement&&Qr.setVolume(this.getTrackId(),n);try{if(this._bypassWebAudio)return void w.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,Et(this,fe.NEED_REPLACE_TRACK,this).then(()=>{w.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(a=>{w.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),a)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}setPlaybackDevice(n){var r=this;return x(function*(){if(!r._useAudioElement)throw new X(M.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield Qr.setSinkID(r.getTrackId(),n)})()}setEnabled(n,r,a){var l=this;return x(function*(){return l._setEnabled(n,r,a)})()}_setEnabled(n,r,a){var l=this;return x(function*(){if(!a){if(n===l._enabled)return;l.stateCheck("enabled",n)}if(w.info("[".concat(l.getTrackId(),"] start setEnabled"),n),n){l._originMediaStreamTrack.enabled=!0;try{a||(l._enabled=!0),yield Et(l,fe.NEED_ENABLE_TRACK,l),w.info("[".concat(l.getTrackId(),"] setEnabled to ").concat(n," success"))}catch(d){throw a||(l._enabled=!1),w.error("[".concat(l.getTrackId(),"] setEnabled to true error"),d.toString()),d}}else{l._originMediaStreamTrack.enabled=!1,a||(l._enabled=!1);try{yield Et(l,fe.NEED_DISABLE_TRACK,l)}catch(d){throw a||(l._enabled=!0),w.error("[".concat(l.getTrackId(),"] setEnabled to false error"),d.toString()),d}}})()}setMuted(n){var r=this;return x(function*(){n!==r._muted&&(r.stateCheck("muted",n),r._muted=n,r._originMediaStreamTrack.enabled=!n,w.debug("[".concat(r.getTrackId(),"] start set muted: ").concat(n)),n?yield Et(r,fe.NEED_MUTE_TRACK,r):yield Et(r,fe.NEED_UNMUTE_TRACK,r))})()}getStats(){return uf(()=>{w.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),_r(this,fe.GET_STATS)||ZD({},aC)}setAudioFrameCallback(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!n)return this._source.removeAllListeners(vr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(vr.ON_AUDIO_BUFFER),this._source.on(vr.ON_AUDIO_BUFFER,a=>n(a))}play(){w.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(w.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Qr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){w.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Qr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];w.debug("[".concat(this.getTrackId(),"] update player source track")),n&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Qr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}_updateOriginMediaStreamTrack(n,r){var a=this;return x(function*(){a._originMediaStreamTrack!==n&&(a._originMediaStreamTrack&&(a._originMediaStreamTrack.removeEventListener("ended",a._handleTrackEnded),r&&a._originMediaStreamTrack.stop()),n.addEventListener("ended",a._handleTrackEnded),a._originMediaStreamTrack=n,a._muted&&(a._originMediaStreamTrack.enabled=!1),a.processor&&a.processor.updateInput({track:n,context:a.processorContext}),a._mediaStreamTrack!==a._source.outputTrack?(a._mediaStreamTrack=a._originMediaStreamTrack,a._updatePlayerSource(),yield Et(a,fe.NEED_REPLACE_TRACK,a)):a._source.updateTrack(a._originMediaStreamTrack),a._getOriginVolumeLevel&&a._source.updateOriginTrack(n))})()}renewMediaStreamTrack(n){return z.resolve(void 0)}pipe(n){if(this._bypassWebAudio)throw new X(M.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===n)return n;if(n._source)throw new X(M.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),n}unpipe(){var n;if(!this.processor)return;const r=this.processor;null===(n=this._source.processSourceNode)||void 0===n||n.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(Ii.ON_TRACK,function(){var r=x(function*(a){a?a!==n._mediaStreamTrack&&(n._mediaStreamTrack=a,n._updatePlayerSource(!1),n._source.processedNode=n._source.createMediaStreamSourceNode(a),yield Et(n,fe.NEED_REPLACE_TRACK,n)):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource(),yield Et(n,fe.NEED_REPLACE_TRACK,n))});return function(a){return r.apply(this,arguments)}}()),this.processorDestination.on(Ii.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ii.ON_TRACK),this.processorDestination.removeAllListeners(Ii.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(yr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(yr.REQUEST_CONSTRAINTS)}}te([TE("INIT_WEBAUDIO"),N("design:type",Object),N("design:paramtypes",[Object])],mt.prototype,"_source",null),te([TE("INIT_WEBAUDIO"),N("design:type",Lf),N("design:paramtypes",[Lf])],mt.prototype,"processorContext",null),te([TE("INIT_WEBAUDIO"),N("design:type",mC),N("design:paramtypes",[mC])],mt.prototype,"processorDestination",null),te([Ae({argsMap:(s,n)=>[s.getTrackId(),n],throttleTime:300}),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],mt.prototype,"setVolume",null),te([Ae({argsMap:(s,n)=>[s.getTrackId(),n]}),an(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],mt.prototype,"setPlaybackDevice",null),te([Pe("LocalAudioTrack","_enabledMutex"),Ae({argsMap:(s,n)=>[s.getTrackId(),n]}),an(),N("design:type",Function),N("design:paramtypes",[Boolean,Object,Boolean]),N("design:returntype",z)],mt.prototype,"setEnabled",null),te([Pe("LocalAudioTrack","_enabledMutex"),Ae({argsMap:(s,n)=>[s.getTrackId(),n]}),an(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",z)],mt.prototype,"setMuted",null),te([an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Object)],mt.prototype,"getStats",null),te([an(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",void 0)],mt.prototype,"setAudioFrameCallback",null),te([Ae({argsMap:s=>[s.getTrackId()]}),an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],mt.prototype,"play",null),te([Ae({argsMap:s=>[s.getTrackId()]}),an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],mt.prototype,"stop",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],mt.prototype,"close",null),te([Ae({argsMap:(s,n)=>[s.getTrackId(),n.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],mt.prototype,"pipe",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],mt.prototype,"unpipe",null);class Td extends mt{get __className__(){return"MicrophoneAudioTrack"}constructor(n,r,a,l){super(n,r.encoderConfig?Ss(r.encoderConfig):{},l,j("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),C(this,"_config",void 0),C(this,"_deviceName","default"),C(this,"_constraints",void 0),C(this,"_originalConstraints",void 0),C(this,"_enabled",!0),this._config=r,this._constraints=a,this._originalConstraints=a,this._deviceName=n.label,"boolean"==typeof r.bypassWebAudio&&(this._bypassWebAudio=r.bypassWebAudio),(rl()||lS())&&vt.bindInterruptDetectorTrack(this),this.on(fE.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),GD()&&this.bindProcessorContextEvents()}setDevice(n){var r=this;return x(function*(){if(w.info("[".concat(r.getTrackId(),"] start set device to ").concat(n)),r._enabled)try{const a=yield es.getDeviceById(n),l={};l.audio=ZD({},r._constraints),l.audio.deviceId={exact:n},r._originMediaStreamTrack.stop();let d=null;try{d=yield Zo(l,r.getTrackId())}catch(h){throw w.error("[".concat(r.getTrackId(),"] setDevice failed"),h.toString()),d=yield Zo({audio:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),h}yield r._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),r._deviceName=a.label,r._config.microphoneId=n,r._constraints.deviceId={exact:n}}catch(a){throw w.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}else try{const a=yield es.getDeviceById(n);r._deviceName=a.label,r._config.microphoneId=n,r._constraints.deviceId={exact:n}}catch(a){throw w.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}w.info("[".concat(r.getTrackId(),"] set device to ").concat(n," success"))})()}setEnabled(n,r,a){var l=()=>super._setEnabled,d=this;return x(function*(){if(r)return w.debug("[".concat(d.getTrackId(),"] setEnabled false (do not close microphone)")),yield l().call(d,n);if(!a){if(n===d._enabled)return;d.stateCheck("enabled",n)}if(w.info("[".concat(d.getTrackId(),"] start setEnabled"),n),!n){var h;d._originMediaStreamTrack.onended=null,d._originMediaStreamTrack.stop(),null===(h=d._source.clonedTrack)||void 0===h||h.stop(),a||(d._enabled=!1);try{yield Et(d,fe.NEED_DISABLE_TRACK,d)}catch(_){throw w.error("[".concat(d.getTrackId(),"] setEnabled false failed"),_.toString()),_}return}const p=ZD({},d._constraints),m=es.searchDeviceIdByName(d._deviceName);m&&!p.deviceId&&(p.deviceId=m);try{a||(d._enabled=!0);const _=yield Zo({audio:d._constraints},d.getTrackId());yield d._updateOriginMediaStreamTrack(_.getAudioTracks()[0],!1),yield Et(d,fe.NEED_ENABLE_TRACK,d)}catch(_){throw a||(d._enabled=!1),w.error("[".concat(d.getTrackId(),"] setEnabled true failed"),_.toString()),_}w.info("[".concat(d.getTrackId(),"] setEnabled success"))})()}close(){super.close(),(rl()||lS())&&vt.unbindInterruptDetectorTrack(this)}onTrackEnded(){var n=this;if((Fi()||po())&&this._enabled&&!this._isClosed&&vt.duringInterruption){const r=function(){var a=x(function*(){vt.off(Xn.IOS_INTERRUPTION_END,r),n._enabled&&!n._isClosed&&(w.debug("[".concat(n.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),yield n.setEnabled(!1),yield n.setEnabled(!0))});return function(){return a.apply(this,arguments)}}();vt.on(Xn.IOS_INTERRUPTION_END,r)}else w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(El.TRACK_ENDED)}renewMediaStreamTrack(n){var r=this;return x(function*(){const a=n||r._constraints,l=es.searchDeviceIdByName(r._deviceName);if(l&&!a.deviceId&&(a.deviceId=l),r._constraints=a,r._enabled){r._originMediaStreamTrack.stop();const d=yield Zo({audio:r._constraints},r.getTrackId());yield r._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!0)}})()}bindProcessorContextEvents(){var n=this;this.processorContext.on(yr.REQUEST_UPDATE_CONSTRAINTS,function(){var r=x(function*(a,l,d){try{const h=Object.assign({},n._originalConstraints,...a);yield n.renewMediaStreamTrack(h),l()}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this.processorContext.on(yr.REQUEST_CONSTRAINTS,function(){var r=x(function*(a){a(n._originMediaStreamTrack.getSettings())});return function(a){return r.apply(this,arguments)}}())}}te([Ae({argsMap:(s,n)=>[s.getTrackId(),n]}),an(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Td.prototype,"setDevice",null),te([Pe("MicrophoneAudioTrack","_enabledMutex"),Ae({argsMap:(s,n,r)=>[s.getTrackId(),n,r]}),an(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean,Boolean]),N("design:returntype",z)],Td.prototype,"setEnabled",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Td.prototype,"close",null);class yl extends mt{get __className__(){return"BufferSourceAudioTrack"}constructor(n,r,a,l){super(r.createOutputTrack(),a,l),C(this,"source",void 0),C(this,"_bufferSource",void 0),this.source=n,this._bufferSource=r,this._bufferSource.on(vr.AUDIO_SOURCE_STATE_CHANGE,d=>{this.safeEmit(El.SOURCE_STATE_CHANGE,d)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(n){n&&this._bufferSource.updateOptions(n),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(n){this._bufferSource.seekAudioBuffer(n)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(n){ft(n,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(n)}}te([Ae({argsMap:(s,n)=>[s.getTrackId(),n,s.duration]}),an(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],yl.prototype,"startProcessAudioBuffer",null),te([Ae({argsMap:s=>[s.getTrackId()]}),an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],yl.prototype,"pauseProcessAudioBuffer",null),te([Ae({argsMap:s=>[s.getTrackId()]}),an(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],yl.prototype,"seekAudioBuffer",null),te([Ae({argsMap:s=>[s.getTrackId()]}),an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],yl.prototype,"resumeProcessAudioBuffer",null),te([Ae({argsMap:s=>[s.getTrackId()]}),an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],yl.prototype,"stopProcessAudioBuffer",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],yl.prototype,"close",null),te([Ae({argsMap:s=>[s.getTrackId()]}),an(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],yl.prototype,"setAudioBufferPlaybackSpeed",null);class wn extends mt{get __className__(){return"MixingAudioTrack"}get isActive(){for(const n of this.trackList)if(n._enabled&&!n._isClosed&&!n.muted)return!0;return!1}constructor(){const n=Eh().createMediaStreamDestination();super(n.stream.getAudioTracks()[0],void 0,Fe(8,"track-mix-")),C(this,"trackList",void 0),C(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=n,this.trackList=[]}hasAudioTrack(n){return-1!==this.trackList.indexOf(n)}addAudioTrack(n){-1===this.trackList.indexOf(n)?(w.debug("add ".concat(n.getTrackId()," to mixing track")),n._source.outputNode.connect(this.destNode),this.trackList.push(n),this.updateEncoderConfig()):w.debug("track ".concat(n.getTrackId()," is already added"))}removeAudioTrack(n){if(-1!==this.trackList.indexOf(n)){w.debug("remove ".concat(n.getTrackId()," from mixing track"));try{n._source.outputNode.disconnect(this.destNode)}catch{}_S(this.trackList,n),this.updateEncoderConfig()}}updateEncoderConfig(){const n={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(n.bitrate||0)&&(n.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(n.sampleRate||0)&&(n.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(n.sampleSize||0)&&(n.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(n.stereo=!0))}),this._encoderConfig=n}_updateRtpTransceiver(n){this._rtpTransceiver!==n&&(this._rtpTransceiver=n,this.trackList.forEach(r=>{r instanceof wn?r.emit(mc.TRANSCEIVER_UPDATED,n):r._updateRtpTransceiver(n)}))}}function IE(s){const n={};s.facingMode&&(n.facingMode=s.facingMode),s.cameraId&&(n.deviceId={exact:s.cameraId});const r=Ma(s.encoderConfig);return null!=r.width&&(n.width=r.width),null!=r.height&&(n.height=r.height),!ol()&&r.frameRate&&(n.frameRate=r.frameRate),dt().name===Ne.EDGE&&"object"==typeof n.frameRate&&(n.frameRate.max=60),zt()&&(n.frameRate={ideal:30,max:30}),n}function gC(s){const n={};if(ol()||(void 0!==s.AGC&&(n.autoGainControl=s.AGC),void 0!==s.AEC&&(n.echoCancellation=s.AEC),void 0!==s.ANS&&(n.noiseSuppression=s.ANS,kg()&&s.ANS&&(n.googHighpassFilter=s.ANS))),s.encoderConfig){const r=Ss(s.encoderConfig);n.channelCount=r.stereo?2:1,n.sampleRate=r.sampleRate,n.sampleSize=r.sampleSize}return s.microphoneId&&(n.deviceId={exact:s.microphoneId}),Yr()&&(n.sampleRate=void 0),n}class eO extends ka{set currentState(n){n!==this._currentState&&(this._currentState=n,this.safeEmit(vr.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),C(this,"audioBuffer",void 0),C(this,"sourceNode",void 0),C(this,"startPlayTime",0),C(this,"startPlayOffset",0),C(this,"pausePlayTime",0),C(this,"options",void 0),C(this,"currentLoopCount",0),C(this,"currentPlaybackSpeed",100),C(this,"_currentState","stopped"),this.audioBuffer=n,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:(this.playbackSpeed/100*(this.context.currentTime-this.startPlayTime)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(n){"stopped"===this.currentState?(this.options=n,this.startPlayOffset=this.options.startPlayTime||0):w.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(n){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=n,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=n))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(n){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=n/100),this.currentPlaybackSpeed=n}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const n=this.context.createBufferSource();return n.buffer=this.audioBuffer,n.loop=!!this.options.loop,n.connect(this.outputNode),n.playbackRate.value=this.currentPlaybackSpeed/100,n}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const tO=new Map;function RE(){return RE=x(function*(s,n){let r=null;if("string"==typeof s){const l=tO.get(s);if(l)return w.debug("use cached audio resource: ",s),l;try{r=(yield gs(()=>Er.get(s,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(d){throw new X(M.FETCH_AUDIO_FILE_FAILED,d.toString())}}else r=yield new z((d,h)=>{const p=new FileReader;p.onload=m=>{m.target?d(m.target.result):h(new X(M.READ_LOCAL_AUDIO_FILE_ERROR))},p.onerror=()=>{h(new X(M.READ_LOCAL_AUDIO_FILE_ERROR))},p.readAsArrayBuffer(s)});const a=yield function(l){const d=Eh();return new z((h,p)=>{d.decodeAudioData(l,m=>{h(m)},m=>{p(new X(M.DECODE_AUDIO_FILE_FAILED,m.toString()))})})}(r);return"string"==typeof s&&n&&tO.set(s,a),a}),RE.apply(this,arguments)}const EC=s=>{const n=document.createElement("canvas");return n.width=2,n.height=2,new z((r,a)=>{n.toBlob(function(){var l=x(function*(d){if(n.remove(),d){const h=yield iO(d);r({buffer:h,width:n.width,height:n.height})}else a(new X(M.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(d){return l.apply(this,arguments)}}(),s,1)})},iO=function(){var s=x(function*(n){const r=yield n.arrayBuffer();return new Uint8Array(r)});return function(r){return s.apply(this,arguments)}}(),La=new class extends qt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),C(this,"_lastHiddenTime",0),C(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),w.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function rO(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function vC(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?rO(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):rO(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class AE{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(n){n!==this._videoElementStatus&&(w.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(n)),this._videoElementStatus=n)}constructor(n){C(this,"trackId",void 0),C(this,"config",void 0),C(this,"onFirstVideoFrameDecoded",void 0),C(this,"freezeTimeCounterList",[]),C(this,"renderFreezeAccTime",0),C(this,"isKeepLastFrame",!1),C(this,"timeUpdatedCount",0),C(this,"freezeTime",0),C(this,"playbackTime",0),C(this,"lastTimeUpdatedTime",0),C(this,"autoplayFailed",!1),C(this,"videoTrack",void 0),C(this,"videoElement",void 0),C(this,"cacheVideoElement",void 0),C(this,"videoElementCheckInterval",void 0),C(this,"_videoElementStatus",Bi.NONE),C(this,"isGettingVideoDimensions",!1),C(this,"startGetVideoDimensions",()=>{const r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return w.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()}),C(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===vt.curState&&(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(yA())),Ws()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),C(this,"handleVideoEvents",r=>{switch(r.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Bi.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Bi.CANPLAY;break;case"stalled":this.videoElementStatus=Bi.STALLED;break;case"suspend":this.videoElementStatus=Bi.SUSPEND;break;case"pause":this.videoElementStatus=Bi.PAUSED,Fi()||po()||Ki()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Bi.WAITING;break;case"abort":this.videoElementStatus=Bi.ABORT;break;case"ended":this.videoElementStatus=Bi.ENDED;break;case"emptied":this.videoElementStatus=Bi.EMPTIED;break;case"error":{this.videoElementStatus=Bi.ERROR;const a=this.videoElement.error;a&&w.error("[".concat(this.trackId,"] media error, code: ").concat(a.code,", message: ").concat(a.message));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const l=a-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,La.lastVisibleTime<La.lastHiddenTime||d<La.lastHiddenTime||d<La.lastVisibleTime)return;for(l>j("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=l),this.playbackTime+=l;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),C(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(w.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(yA())),Ws()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=n.trackId,this.config=n,this.videoElement=n.element instanceof HTMLVideoElement?n.element:document.createElement("video"),vt.on(Xn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),vt.on(Xn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var n;return null!==(n=this.videoElement.parentElement)&&void 0!==n?n:void 0}updateConfig(n){this.config=n,this.trackId=n.trackId,n.element!==this.videoElement&&(this.destroy(),this.videoElement=n.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.initVideoElement())}play(n){const r=this.videoElement.play();r&&r.catch&&r.catch(l=>{n&&JD(n,"video",l.message,this.trackId),"NotAllowedError"===l.name?(w.warning("detected video element autoplay failed",l),this.autoplayFailed=!0,this.handleAutoPlayFailed()):w.warning("[".concat(this.trackId,"] play warning: "),l)});const a=dt();if(("Safari"===a.name&&15===Number(a.version)||rl())&&r&&r.then){const l=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(l).catch(l)}}getCurrentFrame(){const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const r=n.getContext("2d");if(!r)return w.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,n.width,n.height);const a=r.getImageData(0,0,n.width,n.height);return n.remove(),a}getCurrentFrameToUint8Array(n){var r=arguments,a=this;return x(function*(){let l=r.length>1&&void 0!==r[1]?r[1]:1;const d=document.createElement("canvas");d.width=a.videoElement.videoWidth,d.height=a.videoElement.videoHeight;const h=d.getContext("2d");return h?(h.drawImage(a.videoElement,0,0,d.width,d.height),new z((p,m)=>{d.toBlob(function(){var _=x(function*(E){if(d.remove(),E){const v=yield iO(E);p({buffer:v,width:d.width,height:d.height})}else m(new X(M.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(E){return _.apply(this,arguments)}}(),n,l<0?.1:l>1?1:l)})):yield EC(n)})()}destroy(){vt.off(Xn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),vt.off(Xn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=Bi.INIT,!this.videoElementCheckInterval&&(yC.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{var d;(d=this.videoElement)!==document.body&&document.body.contains(d)||(this.videoElementStatus=Bi.DESTROYED)},1e3),j("ENABLE_VIDEO_FRAME_CALLBACK"))){var n,r;let d;const h=(p,m)=>{if(this.videoElementStatus===Bi.PLAYING){if(d){const v=m.presentationTime-d.presentationTime;v>j("VIDEO_FREEZE_DURATION")&&La.lastVisibleTime>=La.lastHiddenTime&&d.timestamp>La.lastVisibleTime&&d.timestamp>La.lastHiddenTime&&(this.renderFreezeAccTime+=v)}d=vC(vC({},m),{},{timestamp:p})}var _,E;j("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(_=(E=this.videoElement).requestVideoFrameCallback)||void 0===_||_.call(E,h))};null===(n=(r=this.videoElement).requestVideoFrameCallback)||void 0===n||n.call(r,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Yr()&&(this.videoElement.poster="noposter");const a=dt();"Safari"===a.name&&15===Number(a.version)||rl()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.videoElement.style.objectFit=this.config.fit?this.config.fit:"cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,zt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,zt()&&this.videoElement.load());const l=this.videoElement.play();void 0!==l&&l.catch(d=>{w.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){yC.forEach(n=>{this.videoElement&&this.videoElement.removeEventListener(n,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Bi.NONE}handleAutoPlayFailed(){const n=r=>{r.preventDefault(),this.videoElement.play().then(()=>{w.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{w.error(a)}),this.autoplayFailed=!1,ri()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};ri()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),bE()}}const yC=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class bC extends AE{constructor(n){super(n),C(this,"container",void 0),C(this,"slot",void 0),this.slot=n.element,this.updateConfig(n)}updateConfig(n){this.config=n,this.trackId=n.trackId;const r=n.element;r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.createElements())}play(n){var r;null!==(r=this.container)&&void 0!==r&&r.contains(this.videoElement)&&super.play(n)}getCurrentFrame(){var n;return null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}getCurrentFrameToUint8Array(n){var r=arguments,a=()=>super.getCurrentFrameToUint8Array,l=this;return x(function*(){var d;let h=r.length>1&&void 0!==r[1]?r[1]:1;return null!==(d=l.container)&&void 0!==d&&d.contains(l.videoElement)?yield a().call(l,n,h):yield EC(n)})()}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",j("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var n;!this.container||null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var n;if(null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var n;null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function oO(s){return new z((n,r)=>{let a=!1;const l=document.createElement("video");l.setAttribute("autoplay",""),l.setAttribute("muted",""),l.muted=!0,l.autoplay=!0,l.setAttribute("playsinline",""),l.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(l);const d=Fi()?"canplay":"playing";l.addEventListener(d,()=>{const h=l.videoWidth,p=l.videoHeight;!h&&zt()||(a=!0,l.srcObject=null,l.remove(),n([h,p]))}),l.srcObject=new MediaStream([s]),l.play().catch(hf),setTimeout(()=>{a||(l.srcObject=null,l.remove(),n([l.videoWidth,l.videoHeight]))},4e3)})}const pL=function(){var s=x(function*(n,r,a){const l=function(p){const m=[];for(let _=0;_<p.length;_+=2)m.push(parseInt(p.slice(_,_+2),16));return Uint8Array.from(m)}(function(p){const m="0123456789abcdef";function _(me){let Ee,Ze="";for(Ee=0;Ee<=3;Ee++)Ze+=m.charAt(me>>8*Ee+4&15)+m.charAt(me>>8*Ee&15);return Ze}function E(me,Ee){const Ze=(65535&me)+(65535&Ee);return(me>>16)+(Ee>>16)+(Ze>>16)<<16|65535&Ze}function v(me,Ee,Ze,yt,xn,Ht){return E((di=E(E(Ee,me),E(yt,Ht)))<<(ie=xn)|di>>>32-ie,Ze);var di,ie}function b(me,Ee,Ze,yt,xn,Ht,di){return v(Ee&Ze|~Ee&yt,me,Ee,xn,Ht,di)}function T(me,Ee,Ze,yt,xn,Ht,di){return v(Ee&yt|Ze&~yt,me,Ee,xn,Ht,di)}function O(me,Ee,Ze,yt,xn,Ht,di){return v(Ee^Ze^yt,me,Ee,xn,Ht,di)}function P(me,Ee,Ze,yt,xn,Ht,di){return v(Ze^(Ee|~yt),me,Ee,xn,Ht,di)}const D=function(me){let Ee;const Ze=1+(me.length+8>>6),yt=new Array(16*Ze);for(Ee=0;Ee<16*Ze;Ee++)yt[Ee]=0;for(Ee=0;Ee<me.length;Ee++)yt[Ee>>2]|=me.charCodeAt(Ee)<<Ee%4*8;return yt[Ee>>2]|=128<<Ee%4*8,yt[16*Ze-2]=8*me.length,yt}(p);let L,V,U,J,se,q=1732584193,Q=-271733879,$=-1732584194,Y=271733878;for(L=0;L<D.length;L+=16)V=q,U=Q,J=$,se=Y,q=b(q,Q,$,Y,D[L+0],7,-680876936),Y=b(Y,q,Q,$,D[L+1],12,-389564586),$=b($,Y,q,Q,D[L+2],17,606105819),Q=b(Q,$,Y,q,D[L+3],22,-1044525330),q=b(q,Q,$,Y,D[L+4],7,-176418897),Y=b(Y,q,Q,$,D[L+5],12,1200080426),$=b($,Y,q,Q,D[L+6],17,-1473231341),Q=b(Q,$,Y,q,D[L+7],22,-45705983),q=b(q,Q,$,Y,D[L+8],7,1770035416),Y=b(Y,q,Q,$,D[L+9],12,-1958414417),$=b($,Y,q,Q,D[L+10],17,-42063),Q=b(Q,$,Y,q,D[L+11],22,-1990404162),q=b(q,Q,$,Y,D[L+12],7,1804603682),Y=b(Y,q,Q,$,D[L+13],12,-40341101),$=b($,Y,q,Q,D[L+14],17,-1502002290),Q=b(Q,$,Y,q,D[L+15],22,1236535329),q=T(q,Q,$,Y,D[L+1],5,-165796510),Y=T(Y,q,Q,$,D[L+6],9,-1069501632),$=T($,Y,q,Q,D[L+11],14,643717713),Q=T(Q,$,Y,q,D[L+0],20,-373897302),q=T(q,Q,$,Y,D[L+5],5,-701558691),Y=T(Y,q,Q,$,D[L+10],9,38016083),$=T($,Y,q,Q,D[L+15],14,-660478335),Q=T(Q,$,Y,q,D[L+4],20,-405537848),q=T(q,Q,$,Y,D[L+9],5,568446438),Y=T(Y,q,Q,$,D[L+14],9,-1019803690),$=T($,Y,q,Q,D[L+3],14,-187363961),Q=T(Q,$,Y,q,D[L+8],20,1163531501),q=T(q,Q,$,Y,D[L+13],5,-1444681467),Y=T(Y,q,Q,$,D[L+2],9,-51403784),$=T($,Y,q,Q,D[L+7],14,1735328473),Q=T(Q,$,Y,q,D[L+12],20,-1926607734),q=O(q,Q,$,Y,D[L+5],4,-378558),Y=O(Y,q,Q,$,D[L+8],11,-2022574463),$=O($,Y,q,Q,D[L+11],16,1839030562),Q=O(Q,$,Y,q,D[L+14],23,-35309556),q=O(q,Q,$,Y,D[L+1],4,-1530992060),Y=O(Y,q,Q,$,D[L+4],11,1272893353),$=O($,Y,q,Q,D[L+7],16,-155497632),Q=O(Q,$,Y,q,D[L+10],23,-1094730640),q=O(q,Q,$,Y,D[L+13],4,681279174),Y=O(Y,q,Q,$,D[L+0],11,-358537222),$=O($,Y,q,Q,D[L+3],16,-722521979),Q=O(Q,$,Y,q,D[L+6],23,76029189),q=O(q,Q,$,Y,D[L+9],4,-640364487),Y=O(Y,q,Q,$,D[L+12],11,-421815835),$=O($,Y,q,Q,D[L+15],16,530742520),Q=O(Q,$,Y,q,D[L+2],23,-995338651),q=P(q,Q,$,Y,D[L+0],6,-198630844),Y=P(Y,q,Q,$,D[L+7],10,1126891415),$=P($,Y,q,Q,D[L+14],15,-1416354905),Q=P(Q,$,Y,q,D[L+5],21,-57434055),q=P(q,Q,$,Y,D[L+12],6,1700485571),Y=P(Y,q,Q,$,D[L+3],10,-1894986606),$=P($,Y,q,Q,D[L+10],15,-1051523),Q=P(Q,$,Y,q,D[L+1],21,-2054922799),q=P(q,Q,$,Y,D[L+8],6,1873313359),Y=P(Y,q,Q,$,D[L+15],10,-30611744),$=P($,Y,q,Q,D[L+6],15,-1560198380),Q=P(Q,$,Y,q,D[L+13],21,1309151649),q=P(q,Q,$,Y,D[L+4],6,-145523070),Y=P(Y,q,Q,$,D[L+11],10,-1120210379),$=P($,Y,q,Q,D[L+2],15,718787259),Q=P(Q,$,Y,q,D[L+9],21,-343485551),q=E(q,V),Q=E(Q,U),$=E($,J),Y=E(Y,se);return _(q)+_(Q)+_($)+_(Y)}(""+r+a)).slice(0,16),d=l.slice(0,12),h=yield window.crypto.subtle.importKey("raw",l,"AES-GCM",!0,["encrypt"]);return new Uint8Array(yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:d},h,n))});return function(r,a,l){return s.apply(this,arguments)}}(),fL=function(){var s=x(function*(n,r,a){return yield pL(n.buffer,r,a)});return function(r,a,l){return s.apply(this,arguments)}}();function SC(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function ts(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?SC(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):SC(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class ze extends Ri{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Bi.PLAYING)}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}get __className__(){return"LocalVideoTrack"}constructor(n,r,a,l,d,h){if(super(n,d),C(this,"trackMediaType","video"),C(this,"_player",void 0),C(this,"isUseScaleResolutionDownBy",!1),C(this,"_videoVisibleTimer",null),C(this,"_statsTimer",null),C(this,"_previousVideoVisibleStatus",void 0),C(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),C(this,"_encoderConfig",void 0),C(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),C(this,"_optimizationMode",void 0),C(this,"_videoHeight",void 0),C(this,"_videoWidth",void 0),C(this,"_forceBitrateLimit",void 0),C(this,"_enabled",!0),C(this,"processorDestination",void 0),C(this,"_processorContext",void 0),Ki()){const{width:p,height:m}=n.getSettings();this._videoWidth=p,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=r,this._scalabilityMode=a,this._optimizationMode=l,this._hints=h||[],-1===this._hints.indexOf(Ot.SCREEN_TRACK))this.updateBitrateFromProfile();else if(function(p,m,_){const E=dt();return!(E.name!==p||!E.osVersion)&&115===Number(E.version)}(Ne.CHROME)&&-1!==Mg().indexOf("Windows")){const p=function(m,_){if("VideoFrame"in window&&"TransformStream"in window&&$e().supportWebRTCInsertableStream){const E=new MediaStreamTrackProcessor(m),v=new MediaStreamTrackGenerator({kind:"video"});let b,T,O=Date.now();const P=()=>{D&&(clearInterval(D),D=void 0),b&&(b.close(),b=void 0),m.stop(),T=void 0,v.removeEventListener("ended",P)};let D=window.setInterval(()=>{if(T&&b&&Date.now()-O>1e3)try{"live"===v.readyState?T.enqueue(b.clone()):P()}catch{P()}},1e3);const L=new TransformStream({transform:(V,U)=>{"live"===v.readyState?(T=U,O=Date.now(),void 0===b?(b=V,U.enqueue(V.clone())):(U.enqueue(b),b=V)):V.close()}});return v.addEventListener("ended",P),E.readable.pipeThrough(L).pipeTo(v.writable),v}}(n);p&&(w.info("local screen video track begin to inject frame"),this._mediaStreamTrack=p)}r&&-1!==this._hints.indexOf(Ot.CUSTOM_TRACK)&&this.setEncoderConfiguration(r),this.processorContext=new CE(this.getTrackId(),"local"),this.processorDestination=new kf(this.processorContext),this.bindProcessorDestinationEvents()}play(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof n){const l=document.getElementById(n);l?n=l:(w.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}w.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const a=ts(ts(ts({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:n});this._player?this._player.updateConfig(a):(this._player=n instanceof HTMLVideoElement?new AE(a):new bC(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const l=this.getVideoElementVisibleStatus();this.safeEmit(El.VIDEO_ELEMENT_VISIBLE_STATUS,l)}catch{}},j("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,w.debug("[".concat(this.getTrackId(),"] stop video playback")))}setEnabled(n,r){var a=this;return x(function*(){if(!r){if(n===a._enabled)return;a.stateCheck("enabled",n)}if(w.info("[".concat(a.getTrackId(),"] start setEnabled"),n),!n){a._originMediaStreamTrack.enabled=!1;try{yield Et(a,fe.NEED_DISABLE_TRACK,a)}catch(l){throw w.error("[".concat(a.getTrackId(),"] setEnabled to false error"),l.toString()),l}return r||(a._enabled=!1),void w.info("[".concat(a.getTrackId(),"] setEnabled to false success"))}a._originMediaStreamTrack.enabled=!0;try{yield Et(a,fe.NEED_ENABLE_TRACK,a)}catch(l){throw w.error("[".concat(a.getTrackId(),"] setEnabled to true error"),l.toString()),l}w.info("[".concat(a.getTrackId(),"] setEnabled to true success")),r||(a._enabled=!0)})()}setMuted(n){var r=this;return x(function*(){n!==r._muted&&(r.stateCheck("muted",n),r._muted=n,r._originMediaStreamTrack.enabled=!n,w.debug("[".concat(r.getTrackId(),"] start set muted: ").concat(n)),n?yield Et(r,fe.NEED_MUTE_TRACK,r):yield Et(r,fe.NEED_UNMUTE_TRACK,r))})()}setEncoderConfiguration(n,r){var a=this;return x(function*(){if(!a._enabled)throw new X(M.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if("720p_auto"===n?a.startMonitorStats():a._statsTimer&&(window.clearInterval(a._statsTimer),a._statsTimer=null),n=Ma(n),a._forceBitrateLimit&&(n.bitrateMax=a._forceBitrateLimit.max_bitrate?a._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=a._forceBitrateLimit.min_bitrate?a._forceBitrateLimit.min_bitrate:n.bitrateMin),n.width||n.height||n.frameRate){const l=IE({encoderConfig:n});(Ki()||Fi()||po())&&(l.deviceId=void 0),w.debug("[".concat(a.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(l));try{yield a._originMediaStreamTrack.applyConstraints(l),a.updateMediaStreamTrackResolution()}catch(d){const h=new X(M.UNEXPECTED_ERROR,d.toString());throw w.error("[".concat(a.getTrackId(),"] applyConstraints error"),h.toString()),h}}a._encoderConfig=n,-1===a._hints.indexOf(Ot.SCREEN_TRACK)&&a.updateBitrateFromProfile();try{yield Et(a,fe.NEED_UPDATE_VIDEO_ENCODER,a)}catch(l){return l.throw(w)}})()}getStats(){return uf(()=>{w.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),_r(this,fe.GET_STATS)||ts({},mE)}setBeautyEffect(n){return x(function*(){w.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")})()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}getCurrentFrameImage(n){var r=arguments,a=this;return x(function*(){return a._player?a._player.getCurrentFrameToUint8Array(n,r.length>1&&void 0!==r[1]?r[1]:1):yield EC(n)})()}setBitrateLimit(n){var r=this;return x(function*(){if(w.debug("[".concat(r.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(n))),n){r._forceBitrateLimit=n,r._encoderConfig&&(r._encoderConfig.bitrateMax=r._encoderConfig.bitrateMax&&r._encoderConfig.bitrateMax<n.max_bitrate?r._encoderConfig.bitrateMax:n.max_bitrate,r._encoderConfig.bitrateMin=n.min_bitrate);try{yield Et(r,fe.NEED_UPDATE_VIDEO_ENCODER,r)}catch(a){return a.throw(w)}}})()}setOptimizationMode(n){var r=this;return x(function*(){if("motion"!==n&&"detail"!==n&&"balanced"!==n)return void w.error(M.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const a=r._optimizationMode;try{r._optimizationMode=n,yield Et(r,fe.SET_OPTIMIZATION_MODE,r)}catch(l){throw r._optimizationMode=a,w.error("[".concat(r.getTrackId(),"] set optimization mode failed"),l.toString()),l}w.info("[".concat(r.getTrackId(),"] set optimization mode success (").concat(n,")"))})()}setScalabiltyMode(n){if(1===n.numSpatialLayers&&1!==n.numTemporalLayers)return w.error(M.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=n,w.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(n,")"))}updateMediaStreamTrackResolution(){oO(this._originMediaStreamTrack).then(n=>{let[r,a]=n;this._videoHeight=a,this._videoWidth=r}).catch(hf)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}setSenderConfiguration(n){var r=this;return x(function*(){if(!r._enabled)throw new X(M.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");w.debug("[".concat(r.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(n)),n=Ma(n),r._forceBitrateLimit&&(n.bitrateMax=r._forceBitrateLimit.max_bitrate?r._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=r._forceBitrateLimit.min_bitrate?r._forceBitrateLimit.min_bitrate:n.bitrateMin),r._encoderConfig=n,-1===r._hints.indexOf(Ot.SCREEN_TRACK)&&r.updateBitrateFromProfile();try{yield Et(r,fe.NEED_UPDATE_VIDEO_ENCODER,r)}catch(a){return a.throw(w)}})()}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:n,height:r,frameRate:a}=this.getMediaStreamTrackSettings();if(!n||!r||!a)return;const[l,d]=function(h,p,m,_){let E;const v=200*Math.pow(m/15,.6)*Math.pow(h*p/640/360,.75),b=v;if("STANDARD_BITRATE"===_)E=4*v;else{if("COMPATIABLE_BITRATE"!==_)return;E=2*v}return[Math.floor(E),Math.floor(b)]}(n,r,a,j("BITRATE_ADAPTER_TYPE"))||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=d,this._encoderConfig.bitrateMax=l,w.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(n,", h: ").concat(r,", fps: ").concat(a,"] => [brMax: ").concat(l,", brMin: ").concat(d,"]")))}getVideoElementVisibleStatus(){try{var n,r;const a=null==this||null===(n=this._player)||void 0===n?void 0:n.getContainerElement(),l={track:this,element:null==this||null===(r=this._player)||void 0===r?void 0:r.getVideoElement(),slot:a?.parentElement},{element:d,slot:h}=l;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=pS.checkOneElementVisible(d),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;Se.reportApiInvoke(null,{tag:Jt.TRACER,name:Nn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(m.visible?"Video is visible":"Invisible because of ".concat(m.reason))}return m}return}catch(a){throw new X(M.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}renewMediaStreamTrack(n){return x(function*(){})()}pipe(n){if(this.processor===n)return n;if(n._source)throw new X(M.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;const n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(n){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this._encoderConfig;n&&(a=ts(ts({},a),Ma(n))),a=Da(a);const l=Fe(8,"track-video-cloned-"),d=new ze(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,Da(this._scalabilityMode),this._optimizationMode,l,Da(this._hints));return n&&a&&d.setEncoderConfiguration(a),w.debug("clone video track from ".concat(this.getTrackId()," to ").concat(l,", clone ").concat(r)),d}replaceTrack(n,r){var a=this;return x(function*(){if(!(n instanceof MediaStreamTrack))throw new X(M.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==n.kind)throw new X(M.INVALID_PARAMS,"track should be a video MediaStreamTrack");yield a._updateOriginMediaStreamTrack(n,r,!0),a.updateMediaStreamTrackResolution()})()}startMonitorStats(){if(!Ki()&&!Fi())return;this._statsTimer&&window.clearInterval(this._statsTimer);let n=2,r=gl[n],a=-1,l=Date.now();const d=h=>{h>2||h<0||(l=Date.now(),r=gl[h],this.setSenderConfiguration(r))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval(()=>{const h=this.getStats(),p=_r(this,fe.GET_RTC_STATS);if(h.sendPackets>0&&p){-1===a&&(a=Date.now());const m=Date.now();if(m-a<1e3||m-l<j("PROFILE_SWITCH_INTERVAL"))return;const _=h.sendFrameRate,v=.9*r.frameRate;"number"==typeof _&&_>0&&_<.6*r.frameRate?n>0&&(n--,d(n),w.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(_,", switchProfile to ").concat(n))):p.OutgoingAvailableBandwidth<r.bitrateMin?n>0&&(n--,d(n),w.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(p.OutgoingAvailableBandwidth,", bitrateMin ").concat(r.bitrateMin,", switchProfile to ").concat(n))):"number"==typeof _&&_>v&&n<gl.length-1&&p.OutgoingAvailableBandwidth>1.2*gl[n+1].bitrateMin&&(n++,d(n),w.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(_,", OutgoingAvailableBandwidth ").concat(p.OutgoingAvailableBandwidth,", switchProfile to ").concat(n)))}},j("CHECK_LOCAL_STATS_INTERVAL"))}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(Ii.ON_TRACK,function(){var r=x(function*(a){a?a!==n._mediaStreamTrack&&(n._mediaStreamTrack=a,n._updatePlayerSource(),yield Et(n,fe.NEED_REPLACE_TRACK,n)):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource(),yield Et(n,fe.NEED_REPLACE_TRACK,n))});return function(a){return r.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ii.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(yr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(yr.REQUEST_CONSTRAINTS)}}te([Ae({argsMap:(s,n,r)=>[s.getTrackId(),"string"==typeof n?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),an(),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",void 0)],ze.prototype,"play",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ze.prototype,"stop",null),te([Pe("LocalVideoTrack","_enabledMutex"),Ae({argsMap:(s,n)=>[s.getTrackId(),n]}),an(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean]),N("design:returntype",z)],ze.prototype,"setEnabled",null),te([Pe("LocalVideoTrack","_enabledMutex"),Ae({argsMap:(s,n)=>[s.getTrackId(),n]}),an(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",z)],ze.prototype,"setMuted",null),te([Ae({argsMap:(s,n)=>[s.getTrackId(),n]}),an(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",z)],ze.prototype,"setEncoderConfiguration",null),te([an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Object)],ze.prototype,"getStats",null),te([Ae({argsMap:(s,n,r)=>[s.getTrackId(),n,r]}),an(),N("design:type",Function),N("design:paramtypes",[Boolean,Object]),N("design:returntype",z)],ze.prototype,"setBeautyEffect",null),te([an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",ImageData)],ze.prototype,"getCurrentFrameData",null),te([an(),N("design:type",Function),N("design:paramtypes",[String,Number]),N("design:returntype",z)],ze.prototype,"getCurrentFrameImage",null),te([an(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],ze.prototype,"setBitrateLimit",null),te([an(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],ze.prototype,"setOptimizationMode",null),te([an(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],ze.prototype,"setScalabiltyMode",null),te([an(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ze.prototype,"updateMediaStreamTrackResolution",null),te([Ae({argsMap:(s,n)=>[s.getTrackId(),n.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],ze.prototype,"pipe",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ze.prototype,"unpipe",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ze.prototype,"close",null),te([Ae({argsMap:(s,n,r)=>[s.getTrackId(),n.label,r]}),N("design:type",Function),N("design:paramtypes",[MediaStreamTrack,Boolean]),N("design:returntype",z)],ze.prototype,"replaceTrack",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ze.prototype,"startMonitorStats",null);class wd extends ze{get __className__(){return"CameraVideoTrack"}constructor(n,r,a,l,d,h){var p;super(n,Ma(r.encoderConfig),l,d,h),p=this,C(this,"_config",void 0),C(this,"_originalConstraints",void 0),C(this,"_constraints",void 0),C(this,"_enabled",!0),C(this,"_deviceName","default"),C(this,"tryResumeVideoForIOS15_16WeChat",x(function*(){(rl()||lS())&&!function(){const m=dt();if(m.os!==Fn.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return 15===Number(_[0])&&Number(_[1])>=2}()&&mr()&&p._enabled&&!p._isClosed&&(w.debug("[".concat(p.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),yield p.renewMediaStreamTrack())})),this._config=r,this._originalConstraints=a,this._constraints=a,this._deviceName=n.label,this._encoderConfig=Ma(this._config.encoderConfig),vt.on(Xn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),vt.on(Xn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}setDevice(n){var r=this;return x(function*(){return"string"==typeof n?r._setDeviceById(n):n.deviceId?r._setDeviceById(n.deviceId):n.facingMode?r._setDeviceByFacingModel(n.facingMode):void 0})()}_setDeviceById(n){var r=this;return x(function*(){if(w.info("[".concat(r.getTrackId(),"] set device to ").concat(n)),r._enabled)try{const a=yield es.getDeviceById(n),l={};l.video=ts({},r._constraints),l.video.deviceId={exact:n},l.video.facingMode=void 0,r._originMediaStreamTrack.stop();let d=null;try{d=yield Zo(l,r.getTrackId())}catch(h){throw w.error("[".concat(r.getTrackId(),"] setDevice failed"),h.toString()),d=yield Zo({video:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),h}yield r._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),r.updateMediaStreamTrackResolution(),r._deviceName=a.label,r._config.cameraId=n,r._constraints.deviceId={exact:n}}catch(a){throw w.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}else try{const a=yield es.getDeviceById(n);r._deviceName=a.label,r._config.cameraId=n,r._constraints.deviceId={exact:n}}catch(a){throw w.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}w.info("[".concat(r.getTrackId(),"] setDevice success"))})()}_setDeviceByFacingModel(n){var r=this;return x(function*(){w.info("[".concat(r.getTrackId(),"] set facingMode ").concat(n));const a={video:ts(ts({},r._constraints),{},{deviceId:void 0,facingMode:{exact:n}})};if(r._enabled){r._originMediaStreamTrack.stop();let l=null;try{l=yield Zo(a,r.getTrackId())}catch(d){throw w.error("[".concat(r.getTrackId(),"] setDeviceByFacingModel failed"),d.toString()),l=yield Zo({video:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),d}yield r._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),r.updateMediaStreamTrackResolution()}r._deviceName="",r._config.facingMode=n,r._config.cameraId=void 0,r._constraints=ts({},a.video),w.info("[".concat(r.getTrackId(),"] setDeviceByFacingModel success"))})()}setEnabled(n,r){var a=this;return x(function*(){if(!r){if(n===a._enabled)return;a.stateCheck("enabled",n)}if(w.info("[".concat(a.getTrackId(),"] start setEnabled"),n),n){try{if(a.isExternalTrack)a._originMediaStreamTrack.enabled=!0;else{const l=yield Zo({video:a._constraints},a.getTrackId());yield a._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1)}yield Et(a,fe.NEED_ENABLE_TRACK,a)}catch(l){throw w.error("[".concat(a.getTrackId(),"] setEnabled true error"),l.toString()),l}a.updateMediaStreamTrackResolution(),w.info("[".concat(a.getTrackId(),"] setEnabled to true success")),r||(a._enabled=!0)}else{a.isExternalTrack?a._originMediaStreamTrack.enabled=!1:(a._originMediaStreamTrack.onended=null,a._originMediaStreamTrack.stop()),r||(a._enabled=!1);try{yield Et(a,fe.NEED_DISABLE_TRACK,a)}catch(l){throw w.error("[".concat(a.getTrackId(),"] setEnabled to false error"),l.toString()),l}w.info("[".concat(a.getTrackId(),"] setEnabled to false success"))}})()}setEncoderConfiguration(n,r){var a=this;return x(function*(){if(!a._enabled)throw new X(M.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");"720p_auto"===n?a.startMonitorStats():a._statsTimer&&(window.clearInterval(a._statsTimer),a._statsTimer=null),n=Ma(n),a._forceBitrateLimit&&(n.bitrateMax=a._forceBitrateLimit.max_bitrate?a._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=a._forceBitrateLimit.min_bitrate?a._forceBitrateLimit.min_bitrate:n.bitrateMin);const l=hn(a._config);l.encoderConfig=n;const d=IE(l);(Ki()||Fi()||po())&&(d.deviceId=void 0),w.debug("[".concat(a.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(d));try{yield a._originMediaStreamTrack.applyConstraints(d),a.updateMediaStreamTrackResolution()}catch(h){const p=new X(M.UNEXPECTED_ERROR,h.toString());throw w.error("[".concat(a.getTrackId(),"] applyConstraints error"),p.toString()),p}a._config=l,a._constraints=d,a._originalConstraints=d,a._encoderConfig=n,-1===a._hints.indexOf(Ot.SCREEN_TRACK)&&a.updateBitrateFromProfile();try{yield Et(a,fe.NEED_UPDATE_VIDEO_ENCODER,a)}catch(h){return h.throw(w)}})()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){var n=this;if((Fi()||po())&&this._enabled&&!this._isClosed&&vt.duringInterruption){const r=function(){var a=x(function*(){vt.off(Xn.IOS_INTERRUPTION_END,r),n._enabled&&!n._isClosed&&(w.debug("[".concat(n.getTrackId(),"] try capture camera media device for interrupted iOS device.")),yield n.setEnabled(!1),yield n.setEnabled(!0))});return function(){return a.apply(this,arguments)}}();vt.on(Xn.IOS_INTERRUPTION_END,r)}else w.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(El.TRACK_ENDED)}renewMediaStreamTrack(n){var r=this;return x(function*(){const a=n||r._constraints,l=es.searchDeviceIdByName(r._deviceName);if(l&&!a.deviceId&&(a.deviceId={exact:l}),r._enabled){const d=yield Zo({video:a},r.getTrackId());r._constraints=a,yield r._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!0),r.updateMediaStreamTrackResolution()}})()}close(){super.close(),vt.off(Xn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),vt.off(Xn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(n){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this._encoderConfig;n&&(a=ts(ts({},a),Ma(n))),a=Da(a);const l=Fe(8,"track-cam-cloned-"),d=new wd(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,Da(ts(ts({},this._config),{},{encoderConfig:a})),Da(this._constraints),Da(this._scalabilityMode),this._optimizationMode,l);return n&&a&&d.setEncoderConfiguration(a),w.debug("clone track from ".concat(this.getTrackId()," to ").concat(l,", clone ").concat(r)),d}bindProcessorContextEvents(){var n=this;this.processorContext.on(yr.REQUEST_UPDATE_CONSTRAINTS,function(){var r=x(function*(a,l,d){try{const h=Object.assign({},n._originalConstraints,...a);yield n.renewMediaStreamTrack(h),l()}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this.processorContext.on(yr.REQUEST_CONSTRAINTS,function(){var r=x(function*(a){a(n._originMediaStreamTrack.getSettings())});return function(a){return r.apply(this,arguments)}}())}}function mL(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function CC(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?mL(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):mL(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function sO(s,n,r,a){r.optimizationMode&&(a&&a.width&&a.height?(r.encoderConfig=CC(CC({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),"motion"!==r.optimizationMode&&"detail"!==r.optimizationMode||(n.contentHint=r.optimizationMode,n.contentHint===r.optimizationMode?w.debug("[".concat(s,"] set content hint to"),r.optimizationMode):w.debug("[".concat(s,"] set content hint failed")))):w.warning("[".concat(s,"] can not apply optimization mode bitrate config, no encoderConfig")))}function _L(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function TC(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?_L(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):_L(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}te([Ae({argsMap:(s,n)=>[s.getTrackId(),n]}),an(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],wd.prototype,"setDevice",null),te([Pe("CameraVideoTrack","_enabledMutex"),Ae({argsMap:(s,n)=>[s.getTrackId(),n]}),an(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean]),N("design:returntype",z)],wd.prototype,"setEnabled",null),te([Ae({argsMap:(s,n)=>[s.getTrackId(),n]}),an(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",z)],wd.prototype,"setEncoderConfiguration",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],wd.prototype,"close",null);class gL extends HD{getUserId(){return this._userId}constructor(n,r,a,l){super(n,"track-".concat(n.kind,"-").concat(r,"-").concat(l.clientId,"_").concat(Fe(5,""))),C(this,"_userId",void 0),C(this,"_uintId",void 0),C(this,"_isDestroyed",!1),C(this,"store",void 0),C(this,"processor",void 0),this._userId=r,this._uintId=a,this.store=l}_updateOriginMediaStreamTrack(n){this._originMediaStreamTrack=n,this._mediaStreamTrack=n,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,w.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}class Cs extends gL{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Bi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(n,r,a,l){super(n,r,a,l),C(this,"_videoVisibleTimer",null),C(this,"_previousVideoVisibleStatus",void 0),C(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),C(this,"trackMediaType","video"),C(this,"_videoWidth",void 0),C(this,"_videoHeight",void 0),C(this,"_player",void 0),C(this,"processorDestination",void 0),C(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new CE(this.getTrackId(),"remote"),this.processorDestination=new kf(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return uf(()=>{w.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),_r(this,fe.GET_STATS)||TC({},jD)}play(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof n){const l=document.getElementById(n);l?n=l:(w.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}w.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const a=TC(TC({fit:"cover"},r),{},{trackId:this.getTrackId(),element:n});this._player?this._player.updateConfig(a):(this._player=n instanceof HTMLVideoElement?new AE(a):new bC(a),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(yd.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const l=this.getVideoElementVisibleStatus();this.safeEmit(yd.VIDEO_ELEMENT_VISIBLE_STATUS,l)}catch{}},j("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,w.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){oO(this._originMediaStreamTrack).then(n=>{let[r,a]=n;this._videoHeight=a,this._videoWidth=r}).catch(hf)}_updatePlayerSource(){w.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var n,r;const a=null==this||null===(n=this._player)||void 0===n?void 0:n.getContainerElement(),l={track:this,element:null==this||null===(r=this._player)||void 0===r?void 0:r.getVideoElement(),slot:a?.parentElement},{element:d,slot:h}=l;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=pS.checkOneElementVisible(d),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;Se.reportApiInvoke(null,{tag:Jt.TRACER,name:Nn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(m.visible?"Video is visible":"Invisible because of ".concat(m.reason))}return m}return}catch(a){throw new X(M.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}pipe(n){if(this.processor===n)return n;if(n._source)throw new X(M.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;const n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(Ii.ON_TRACK,function(){var r=x(function*(a){a?a!==n._mediaStreamTrack&&(n._mediaStreamTrack=a,n._updatePlayerSource()):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource())});return function(a){return r.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ii.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}te([Ae({argsMap:(s,n,r)=>[s.getTrackId(),"string"==typeof n?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",void 0)],Cs.prototype,"play",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Cs.prototype,"stop",null),te([Ae({argsMap:(s,n)=>[s.getTrackId(),n.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],Cs.prototype,"pipe",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Cs.prototype,"unpipe",null);class Co extends gL{get isPlaying(){return this._useAudioElement?Qr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(n,r,a,l){super(n,r,a,l),C(this,"trackMediaType","audio"),C(this,"_source",void 0),C(this,"_useAudioElement",!0),C(this,"_volume",100),C(this,"processorContext",void 0),C(this,"processorDestination",void 0),C(this,"_played",!1),C(this,"_bypassWebAudio",!1),j("DISABLE_WEBAUDIO")?(this._source=new _C,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new ji(n,!0),j("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(vr.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(yd.FIRST_FRAME_DECODED)}),this.processorContext=new Lf(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new mC(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(vr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!n)return this._source.removeAllListeners(vr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(vr.ON_AUDIO_BUFFER),this._source.on(vr.ON_AUDIO_BUFFER,a=>n(a))}setVolume(n){this._volume=n,this._useAudioElement?Qr.setVolume(this.getTrackId(),n):this._source.setVolume(n/100)}setPlaybackDevice(n){var r=this;return x(function*(){if(!r._useAudioElement)throw new X(M.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield Qr.setSinkID(r.getTrackId(),n)})()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return uf(()=>{w.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),_r(this,fe.GET_STATS)||TC({},Qo)}play(){w.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(w.debug("[".concat(this.getTrackId(),"] use audio element to play")),Qr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){w.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Qr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];w.debug("[".concat(this.getTrackId(),"] update player source track")),n&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Qr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(n){if(this._bypassWebAudio)throw new X(M.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===n)return n;if(n._source)throw new X(M.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),n}unpipe(){var n;if(this._bypassWebAudio)throw new X(M.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;null===(n=this._source.processSourceNode)||void 0===n||n.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(Ii.ON_TRACK,function(){var r=x(function*(a){a?a!==n._mediaStreamTrack&&(n._mediaStreamTrack=a,n._updatePlayerSource(!1),n._source.processedNode=n._source.createMediaStreamSourceNode(a)):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource())});return function(a){return r.apply(this,arguments)}}()),this.processorDestination.on(Ii.ON_NODE,r=>{this._source.processedNode=r;const a=!r;this._useAudioElement!==a&&(this._played?(this.stop(),this._useAudioElement=a,this.play()):this._useAudioElement=a)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ii.ON_TRACK),this.processorDestination.removeAllListeners(Ii.ON_NODE)}}function Id(s){let n=s.length;for(;--n>=0;)s[n]=0}te([Ae({argsMap:(s,n)=>[s.getTrackId(),n],throttleTime:300}),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],Co.prototype,"setVolume",null),te([Ae({argsMap:(s,n)=>[s.getTrackId(),n]}),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Co.prototype,"setPlaybackDevice",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Co.prototype,"play",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Co.prototype,"stop",null),te([Ae({argsMap:(s,n)=>[s.getTrackId(),n.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],Co.prototype,"pipe",null),te([Ae({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Co.prototype,"unpipe",null);const aO=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),OE=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),cO=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),lO=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Fa=new Array(576);Id(Fa);const Uf=new Array(60);Id(Uf);const NE=new Array(512);Id(NE);const Vf=new Array(256);Id(Vf);const Rd=new Array(29);Id(Rd);const Ad=new Array(30);function IC(s,n,r,a,l){this.static_tree=s,this.extra_bits=n,this.extra_base=r,this.elems=a,this.max_length=l,this.has_stree=s&&s.length}let dO,uO,hO;function RC(s,n){this.dyn_tree=s,this.max_code=0,this.stat_desc=n}Id(Ad);const pO=s=>s<256?NE[s]:NE[256+(s>>>7)],Dd=(s,n)=>{s.pending_buf[s.pending++]=255&n,s.pending_buf[s.pending++]=n>>>8&255},To=(s,n,r)=>{s.bi_valid>16-r?(s.bi_buf|=n<<s.bi_valid&65535,Dd(s,s.bi_buf),s.bi_buf=n>>16-s.bi_valid,s.bi_valid+=r-16):(s.bi_buf|=n<<s.bi_valid&65535,s.bi_valid+=r)},Ua=(s,n,r)=>{To(s,r[2*n],r[2*n+1])},fO=(s,n)=>{let r=0;do{r|=1&s,s>>>=1,r<<=1}while(--n>0);return r>>>1},mO=(s,n,r)=>{const a=new Array(16);let l,d,h=0;for(l=1;l<=15;l++)h=h+r[l-1]<<1,a[l]=h;for(d=0;d<=n;d++){let p=s[2*d+1];0!==p&&(s[2*d]=fO(a[p]++,p))}},_O=s=>{let n;for(n=0;n<286;n++)s.dyn_ltree[2*n]=0;for(n=0;n<30;n++)s.dyn_dtree[2*n]=0;for(n=0;n<19;n++)s.bl_tree[2*n]=0;s.dyn_ltree[512]=1,s.opt_len=s.static_len=0,s.sym_next=s.matches=0},gO=s=>{s.bi_valid>8?Dd(s,s.bi_buf):s.bi_valid>0&&(s.pending_buf[s.pending++]=s.bi_buf),s.bi_buf=0,s.bi_valid=0},EO=(s,n,r,a)=>{const l=2*n,d=2*r;return s[l]<s[d]||s[l]===s[d]&&a[n]<=a[r]},AC=(s,n,r)=>{const a=s.heap[r];let l=r<<1;for(;l<=s.heap_len&&(l<s.heap_len&&EO(n,s.heap[l+1],s.heap[l],s.depth)&&l++,!EO(n,a,s.heap[l],s.depth));)s.heap[r]=s.heap[l],r=l,l<<=1;s.heap[r]=a},vO=(s,n,r)=>{let a,l,d,h,p=0;if(0!==s.sym_next)do{a=255&s.pending_buf[s.sym_buf+p++],a+=(255&s.pending_buf[s.sym_buf+p++])<<8,l=s.pending_buf[s.sym_buf+p++],0===a?Ua(s,l,n):(d=Vf[l],Ua(s,d+256+1,n),h=aO[d],0!==h&&(l-=Rd[d],To(s,l,h)),a--,d=pO(a),Ua(s,d,r),h=OE[d],0!==h&&(a-=Ad[d],To(s,a,h)))}while(p<s.sym_next);Ua(s,256,n)},PE=(s,n)=>{const r=n.dyn_tree,a=n.stat_desc.static_tree,l=n.stat_desc.has_stree,d=n.stat_desc.elems;let h,p,m,_=-1;for(s.heap_len=0,s.heap_max=573,h=0;h<d;h++)0!==r[2*h]?(s.heap[++s.heap_len]=_=h,s.depth[h]=0):r[2*h+1]=0;for(;s.heap_len<2;)m=s.heap[++s.heap_len]=_<2?++_:0,r[2*m]=1,s.depth[m]=0,s.opt_len--,l&&(s.static_len-=a[2*m+1]);for(n.max_code=_,h=s.heap_len>>1;h>=1;h--)AC(s,r,h);m=d;do{h=s.heap[1],s.heap[1]=s.heap[s.heap_len--],AC(s,r,1),p=s.heap[1],s.heap[--s.heap_max]=h,s.heap[--s.heap_max]=p,r[2*m]=r[2*h]+r[2*p],s.depth[m]=(s.depth[h]>=s.depth[p]?s.depth[h]:s.depth[p])+1,r[2*h+1]=r[2*p+1]=m,s.heap[1]=m++,AC(s,r,1)}while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1],((E,v)=>{const b=v.dyn_tree,T=v.max_code,O=v.stat_desc.static_tree,P=v.stat_desc.has_stree,D=v.stat_desc.extra_bits,L=v.stat_desc.extra_base,V=v.stat_desc.max_length;let U,J,se,q,Q,$,Y=0;for(q=0;q<=15;q++)E.bl_count[q]=0;for(b[2*E.heap[E.heap_max]+1]=0,U=E.heap_max+1;U<573;U++)J=E.heap[U],q=b[2*b[2*J+1]+1]+1,q>V&&(q=V,Y++),b[2*J+1]=q,J>T||(E.bl_count[q]++,Q=0,J>=L&&(Q=D[J-L]),$=b[2*J],E.opt_len+=$*(q+Q),P&&(E.static_len+=$*(O[2*J+1]+Q)));if(0!==Y){do{for(q=V-1;0===E.bl_count[q];)q--;E.bl_count[q]--,E.bl_count[q+1]+=2,E.bl_count[V]--,Y-=2}while(Y>0);for(q=V;0!==q;q--)for(J=E.bl_count[q];0!==J;)se=E.heap[--U],se>T||(b[2*se+1]!==q&&(E.opt_len+=(q-b[2*se+1])*b[2*se],b[2*se+1]=q),J--)}})(s,n),mO(r,_,s.bl_count)},ME=(s,n,r)=>{let a,l,d=-1,h=n[1],p=0,m=7,_=4;for(0===h&&(m=138,_=3),n[2*(r+1)+1]=65535,a=0;a<=r;a++)l=h,h=n[2*(a+1)+1],++p<m&&l===h||(p<_?s.bl_tree[2*l]+=p:0!==l?(l!==d&&s.bl_tree[2*l]++,s.bl_tree[32]++):p<=10?s.bl_tree[34]++:s.bl_tree[36]++,p=0,d=l,0===h?(m=138,_=3):l===h?(m=6,_=3):(m=7,_=4))},yO=(s,n,r)=>{let a,l,d=-1,h=n[1],p=0,m=7,_=4;for(0===h&&(m=138,_=3),a=0;a<=r;a++)if(l=h,h=n[2*(a+1)+1],!(++p<m&&l===h)){if(p<_)do{Ua(s,l,s.bl_tree)}while(0!=--p);else 0!==l?(l!==d&&(Ua(s,l,s.bl_tree),p--),Ua(s,16,s.bl_tree),To(s,p-3,2)):p<=10?(Ua(s,17,s.bl_tree),To(s,p-3,3)):(Ua(s,18,s.bl_tree),To(s,p-11,7));p=0,d=l,0===h?(m=138,_=3):l===h?(m=6,_=3):(m=7,_=4)}};let bO=!1;const DC=(s,n,r,a)=>{To(s,0+(a?1:0),3),gO(s),Dd(s,r),Dd(s,~r),r&&s.pending_buf.set(s.window.subarray(n,n+r),s.pending),s.pending+=r};var CO={_tr_init:s=>{bO||((()=>{let n,r,a,l,d;const h=new Array(16);for(a=0,l=0;l<28;l++)for(Rd[l]=a,n=0;n<1<<aO[l];n++)Vf[a++]=l;for(Vf[a-1]=l,d=0,l=0;l<16;l++)for(Ad[l]=d,n=0;n<1<<OE[l];n++)NE[d++]=l;for(d>>=7;l<30;l++)for(Ad[l]=d<<7,n=0;n<1<<OE[l]-7;n++)NE[256+d++]=l;for(r=0;r<=15;r++)h[r]=0;for(n=0;n<=143;)Fa[2*n+1]=8,n++,h[8]++;for(;n<=255;)Fa[2*n+1]=9,n++,h[9]++;for(;n<=279;)Fa[2*n+1]=7,n++,h[7]++;for(;n<=287;)Fa[2*n+1]=8,n++,h[8]++;for(mO(Fa,287,h),n=0;n<30;n++)Uf[2*n+1]=5,Uf[2*n]=fO(n,5);dO=new IC(Fa,aO,257,286,15),uO=new IC(Uf,OE,0,30,15),hO=new IC(new Array(0),cO,0,19,7)})(),bO=!0),s.l_desc=new RC(s.dyn_ltree,dO),s.d_desc=new RC(s.dyn_dtree,uO),s.bl_desc=new RC(s.bl_tree,hO),s.bi_buf=0,s.bi_valid=0,_O(s)},_tr_stored_block:DC,_tr_flush_block:(s,n,r,a)=>{let l,d,h=0;s.level>0?(2===s.strm.data_type&&(s.strm.data_type=(p=>{let m,_=4093624447;for(m=0;m<=31;m++,_>>>=1)if(1&_&&0!==p.dyn_ltree[2*m])return 0;if(0!==p.dyn_ltree[18]||0!==p.dyn_ltree[20]||0!==p.dyn_ltree[26])return 1;for(m=32;m<256;m++)if(0!==p.dyn_ltree[2*m])return 1;return 0})(s)),PE(s,s.l_desc),PE(s,s.d_desc),h=(p=>{let m;for(ME(p,p.dyn_ltree,p.l_desc.max_code),ME(p,p.dyn_dtree,p.d_desc.max_code),PE(p,p.bl_desc),m=18;m>=3&&0===p.bl_tree[2*lO[m]+1];m--);return p.opt_len+=3*(m+1)+5+5+4,m})(s),l=s.opt_len+3+7>>>3,d=s.static_len+3+7>>>3,d<=l&&(l=d)):l=d=r+5,r+4<=l&&-1!==n?DC(s,n,r,a):4===s.strategy||d===l?(To(s,2+(a?1:0),3),vO(s,Fa,Uf)):(To(s,4+(a?1:0),3),((p,m,_,E)=>{let v;for(To(p,m-257,5),To(p,_-1,5),To(p,E-4,4),v=0;v<E;v++)To(p,p.bl_tree[2*lO[v]+1],3);yO(p,p.dyn_ltree,m-1),yO(p,p.dyn_dtree,_-1)})(s,s.l_desc.max_code+1,s.d_desc.max_code+1,h+1),vO(s,s.dyn_ltree,s.dyn_dtree)),_O(s),a&&gO(s)},_tr_tally:(s,n,r)=>(s.pending_buf[s.sym_buf+s.sym_next++]=n,s.pending_buf[s.sym_buf+s.sym_next++]=n>>8,s.pending_buf[s.sym_buf+s.sym_next++]=r,0===n?s.dyn_ltree[2*r]++:(s.matches++,n--,s.dyn_ltree[2*(Vf[r]+256+1)]++,s.dyn_dtree[2*pO(n)]++),s.sym_next===s.sym_end),_tr_align:s=>{var n;To(s,2,3),Ua(s,256,Fa),16===(n=s).bi_valid?(Dd(n,n.bi_buf),n.bi_buf=0,n.bi_valid=0):n.bi_valid>=8&&(n.pending_buf[n.pending++]=255&n.bi_buf,n.bi_buf>>=8,n.bi_valid-=8)}},bl=(s,n,r,a)=>{let l=65535&s|0,d=s>>>16&65535|0,h=0;for(;0!==r;){h=r>2e3?2e3:r,r-=h;do{l=l+n[a++]|0,d=d+l|0}while(--h);l%=65521,d%=65521}return l|d<<16|0};const OC=new Uint32Array((()=>{let s,n=[];for(var r=0;r<256;r++){s=r;for(var a=0;a<8;a++)s=1&s?3988292384^s>>>1:s>>>1;n[r]=s}return n})());var Hi=(s,n,r,a)=>{const l=OC,d=a+r;s^=-1;for(let h=a;h<d;h++)s=s>>>8^l[255&(s^n[h])];return-1^s},Od={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Sl={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Cl,_tr_stored_block:xE,_tr_flush_block:NC,_tr_tally:Va,_tr_align:EL}=CO,{Z_NO_FLUSH:Nd,Z_PARTIAL_FLUSH:TO,Z_FULL_FLUSH:vL,Z_FINISH:ns,Z_BLOCK:wO,Z_OK:br,Z_STREAM_END:PC,Z_STREAM_ERROR:gc,Z_DATA_ERROR:IO,Z_BUF_ERROR:MC,Z_DEFAULT_COMPRESSION:RO,Z_FILTERED:LV,Z_HUFFMAN_ONLY:vh,Z_RLE:AO,Z_FIXED:DO,Z_DEFAULT_STRATEGY:yL,Z_UNKNOWN:OO,Z_DEFLATED:Bf}=Sl,Ec=262,yh=(s,n)=>(s.msg=Od[n],n),SL=s=>2*s-(s>4?9:0),kd=s=>{let n=s.length;for(;--n>=0;)s[n]=0},MO=s=>{let n,r,a,l=s.w_size;n=s.hash_size,a=n;do{r=s.head[--a],s.head[a]=r>=l?r-l:0}while(--n);n=l,a=n;do{r=s.prev[--a],s.prev[a]=r>=l?r-l:0}while(--n)};let rr=(s,n,r)=>(n<<s.hash_shift^r)&s.hash_mask;const is=s=>{const n=s.state;let r=n.pending;r>s.avail_out&&(r=s.avail_out),0!==r&&(s.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+r),s.next_out),s.next_out+=r,n.pending_out+=r,s.total_out+=r,s.avail_out-=r,n.pending-=r,0===n.pending&&(n.pending_out=0))},rs=(s,n)=>{NC(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,n),s.block_start=s.strstart,is(s.strm)},vn=(s,n)=>{s.pending_buf[s.pending++]=n},FE=(s,n)=>{s.pending_buf[s.pending++]=n>>>8&255,s.pending_buf[s.pending++]=255&n},xO=(s,n,r,a)=>{let l=s.avail_in;return l>a&&(l=a),0===l?0:(s.avail_in-=l,n.set(s.input.subarray(s.next_in,s.next_in+l),r),1===s.state.wrap?s.adler=bl(s.adler,n,l,r):2===s.state.wrap&&(s.adler=Hi(s.adler,n,l,r)),s.next_in+=l,s.total_in+=l,l)},CL=(s,n)=>{let r,a,l=s.max_chain_length,d=s.strstart,h=s.prev_length,p=s.nice_match;const m=s.strstart>s.w_size-Ec?s.strstart-(s.w_size-Ec):0,_=s.window,E=s.w_mask,v=s.prev,b=s.strstart+258;let T=_[d+h-1],O=_[d+h];s.prev_length>=s.good_match&&(l>>=2),p>s.lookahead&&(p=s.lookahead);do{if(r=n,_[r+h]===O&&_[r+h-1]===T&&_[r]===_[d]&&_[++r]===_[d+1]){d+=2,r++;do{}while(_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&_[++d]===_[++r]&&d<b);if(a=258-(b-d),d=b-258,a>h){if(s.match_start=n,h=a,a>=p)break;T=_[d+h-1],O=_[d+h]}}}while((n=v[n&E])>m&&0!=--l);return h<=s.lookahead?h:s.lookahead},jf=s=>{const n=s.w_size;let r,a,l;do{if(a=s.window_size-s.lookahead-s.strstart,s.strstart>=n+(n-Ec)&&(s.window.set(s.window.subarray(n,n+n-a),0),s.match_start-=n,s.strstart-=n,s.block_start-=n,s.insert>s.strstart&&(s.insert=s.strstart),MO(s),a+=n),0===s.strm.avail_in)break;if(r=xO(s.strm,s.window,s.strstart+s.lookahead,a),s.lookahead+=r,s.lookahead+s.insert>=3)for(l=s.strstart-s.insert,s.ins_h=s.window[l],s.ins_h=rr(s,s.ins_h,s.window[l+1]);s.insert&&(s.ins_h=rr(s,s.ins_h,s.window[l+3-1]),s.prev[l&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=l,l++,s.insert--,!(s.lookahead+s.insert<3)););}while(s.lookahead<Ec&&0!==s.strm.avail_in)},kO=(s,n)=>{let r,a,l,d=s.pending_buf_size-5>s.w_size?s.w_size:s.pending_buf_size-5,h=0,p=s.strm.avail_in;do{if(r=65535,l=s.bi_valid+42>>3,s.strm.avail_out<l||(l=s.strm.avail_out-l,a=s.strstart-s.block_start,r>a+s.strm.avail_in&&(r=a+s.strm.avail_in),r>l&&(r=l),r<d&&(0===r&&n!==ns||n===Nd||r!==a+s.strm.avail_in)))break;h=n===ns&&r===a+s.strm.avail_in?1:0,xE(s,0,0,h),s.pending_buf[s.pending-4]=r,s.pending_buf[s.pending-3]=r>>8,s.pending_buf[s.pending-2]=~r,s.pending_buf[s.pending-1]=~r>>8,is(s.strm),a&&(a>r&&(a=r),s.strm.output.set(s.window.subarray(s.block_start,s.block_start+a),s.strm.next_out),s.strm.next_out+=a,s.strm.avail_out-=a,s.strm.total_out+=a,s.block_start+=a,r-=a),r&&(xO(s.strm,s.strm.output,s.strm.next_out,r),s.strm.next_out+=r,s.strm.avail_out-=r,s.strm.total_out+=r)}while(0===h);return p-=s.strm.avail_in,p&&(p>=s.w_size?(s.matches=2,s.window.set(s.strm.input.subarray(s.strm.next_in-s.w_size,s.strm.next_in),0),s.strstart=s.w_size,s.insert=s.strstart):(s.window_size-s.strstart<=p&&(s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,s.insert>s.strstart&&(s.insert=s.strstart)),s.window.set(s.strm.input.subarray(s.strm.next_in-p,s.strm.next_in),s.strstart),s.strstart+=p,s.insert+=p>s.w_size-s.insert?s.w_size-s.insert:p),s.block_start=s.strstart),s.high_water<s.strstart&&(s.high_water=s.strstart),h?4:n!==Nd&&n!==ns&&0===s.strm.avail_in&&s.strstart===s.block_start?2:(l=s.window_size-s.strstart,s.strm.avail_in>l&&s.block_start>=s.w_size&&(s.block_start-=s.w_size,s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,l+=s.w_size,s.insert>s.strstart&&(s.insert=s.strstart)),l>s.strm.avail_in&&(l=s.strm.avail_in),l&&(xO(s.strm,s.window,s.strstart,l),s.strstart+=l,s.insert+=l>s.w_size-s.insert?s.w_size-s.insert:l),s.high_water<s.strstart&&(s.high_water=s.strstart),l=s.bi_valid+42>>3,l=s.pending_buf_size-l>65535?65535:s.pending_buf_size-l,d=l>s.w_size?s.w_size:l,a=s.strstart-s.block_start,(a>=d||(a||n===ns)&&n!==Nd&&0===s.strm.avail_in&&a<=l)&&(r=a>l?l:a,h=n===ns&&0===s.strm.avail_in&&r===a?1:0,xE(s,s.block_start,r,h),s.block_start+=r,is(s.strm)),h?3:1)},bh=(s,n)=>{let r,a;for(;;){if(s.lookahead<Ec){if(jf(s),s.lookahead<Ec&&n===Nd)return 1;if(0===s.lookahead)break}if(r=0,s.lookahead>=3&&(s.ins_h=rr(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),0!==r&&s.strstart-r<=s.w_size-Ec&&(s.match_length=CL(s,r)),s.match_length>=3)if(a=Va(s,s.strstart-s.match_start,s.match_length-3),s.lookahead-=s.match_length,s.match_length<=s.max_lazy_match&&s.lookahead>=3){s.match_length--;do{s.strstart++,s.ins_h=rr(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart}while(0!=--s.match_length);s.strstart++}else s.strstart+=s.match_length,s.match_length=0,s.ins_h=s.window[s.strstart],s.ins_h=rr(s,s.ins_h,s.window[s.strstart+1]);else a=Va(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++;if(a&&(rs(s,!1),0===s.strm.avail_out))return 1}return s.insert=s.strstart<2?s.strstart:2,n===ns?(rs(s,!0),0===s.strm.avail_out?3:4):s.sym_next&&(rs(s,!1),0===s.strm.avail_out)?1:2},Sh=(s,n)=>{let r,a,l;for(;;){if(s.lookahead<Ec){if(jf(s),s.lookahead<Ec&&n===Nd)return 1;if(0===s.lookahead)break}if(r=0,s.lookahead>=3&&(s.ins_h=rr(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),s.prev_length=s.match_length,s.prev_match=s.match_start,s.match_length=2,0!==r&&s.prev_length<s.max_lazy_match&&s.strstart-r<=s.w_size-Ec&&(s.match_length=CL(s,r),s.match_length<=5&&(s.strategy===LV||3===s.match_length&&s.strstart-s.match_start>4096)&&(s.match_length=2)),s.prev_length>=3&&s.match_length<=s.prev_length){l=s.strstart+s.lookahead-3,a=Va(s,s.strstart-1-s.prev_match,s.prev_length-3),s.lookahead-=s.prev_length-1,s.prev_length-=2;do{++s.strstart<=l&&(s.ins_h=rr(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart)}while(0!=--s.prev_length);if(s.match_available=0,s.match_length=2,s.strstart++,a&&(rs(s,!1),0===s.strm.avail_out))return 1}else if(s.match_available){if(a=Va(s,0,s.window[s.strstart-1]),a&&rs(s,!1),s.strstart++,s.lookahead--,0===s.strm.avail_out)return 1}else s.match_available=1,s.strstart++,s.lookahead--}return s.match_available&&(a=Va(s,0,s.window[s.strstart-1]),s.match_available=0),s.insert=s.strstart<2?s.strstart:2,n===ns?(rs(s,!0),0===s.strm.avail_out?3:4):s.sym_next&&(rs(s,!1),0===s.strm.avail_out)?1:2};function Ba(s,n,r,a,l){this.good_length=s,this.max_lazy=n,this.nice_length=r,this.max_chain=a,this.func=l}const Ch=[new Ba(0,0,0,0,kO),new Ba(4,4,8,4,bh),new Ba(4,5,16,8,bh),new Ba(4,6,32,32,bh),new Ba(4,4,16,16,Sh),new Ba(8,16,32,32,Sh),new Ba(8,16,128,128,Sh),new Ba(8,32,128,256,Sh),new Ba(32,128,258,1024,Sh),new Ba(32,258,258,4096,Sh)];function Ld(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Bf,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),kd(this.dyn_ltree),kd(this.dyn_dtree),kd(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),kd(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),kd(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Th=s=>{if(!s)return 1;const n=s.state;return!n||n.strm!==s||42!==n.status&&57!==n.status&&69!==n.status&&73!==n.status&&91!==n.status&&103!==n.status&&113!==n.status&&666!==n.status?1:0},UE=s=>{if(Th(s))return yh(s,gc);s.total_in=s.total_out=0,s.data_type=OO;const n=s.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=2===n.wrap?57:n.wrap?42:113,s.adler=2===n.wrap?0:1,n.last_flush=-2,Cl(n),br},VE=s=>{const n=UE(s);var r;return n===br&&((r=s.state).window_size=2*r.w_size,kd(r.head),r.max_lazy_match=Ch[r.level].max_lazy,r.good_match=Ch[r.level].good_length,r.nice_match=Ch[r.level].nice_length,r.max_chain_length=Ch[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),n},LO=(s,n,r,a,l,d)=>{if(!s)return gc;let h=1;if(n===RO&&(n=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),l<1||l>9||r!==Bf||a<8||a>15||n<0||n>9||d<0||d>DO||8===a&&1!==h)return yh(s,gc);8===a&&(a=9);const p=new Ld;return s.state=p,p.strm=s,p.status=42,p.wrap=h,p.gzhead=null,p.w_bits=a,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=l+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<l+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.sym_buf=p.lit_bufsize,p.sym_end=3*(p.lit_bufsize-1),p.level=n,p.strategy=d,p.method=r,VE(s)};var Tl={deflateInit:(s,n)=>LO(s,n,Bf,15,8,yL),deflateInit2:LO,deflateReset:VE,deflateResetKeep:UE,deflateSetHeader:(s,n)=>Th(s)||2!==s.state.wrap?gc:(s.state.gzhead=n,br),deflate:(s,n)=>{if(Th(s)||n>wO||n<0)return s?yh(s,gc):gc;const r=s.state;if(!s.output||0!==s.avail_in&&!s.input||666===r.status&&n!==ns)return yh(s,0===s.avail_out?MC:gc);const a=r.last_flush;if(r.last_flush=n,0!==r.pending){if(is(s),0===s.avail_out)return r.last_flush=-1,br}else if(0===s.avail_in&&SL(n)<=SL(a)&&n!==ns)return yh(s,MC);if(666===r.status&&0!==s.avail_in)return yh(s,MC);if(42===r.status&&0===r.wrap&&(r.status=113),42===r.status){let l=Bf+(r.w_bits-8<<4)<<8,d=-1;if(d=r.strategy>=vh||r.level<2?0:r.level<6?1:6===r.level?2:3,l|=d<<6,0!==r.strstart&&(l|=32),l+=31-l%31,FE(r,l),0!==r.strstart&&(FE(r,s.adler>>>16),FE(r,65535&s.adler)),s.adler=1,r.status=113,is(s),0!==r.pending)return r.last_flush=-1,br}if(57===r.status)if(s.adler=0,vn(r,31),vn(r,139),vn(r,8),r.gzhead)vn(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),vn(r,255&r.gzhead.time),vn(r,r.gzhead.time>>8&255),vn(r,r.gzhead.time>>16&255),vn(r,r.gzhead.time>>24&255),vn(r,9===r.level?2:r.strategy>=vh||r.level<2?4:0),vn(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(vn(r,255&r.gzhead.extra.length),vn(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(s.adler=Hi(s.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(vn(r,0),vn(r,0),vn(r,0),vn(r,0),vn(r,0),vn(r,9===r.level?2:r.strategy>=vh||r.level<2?4:0),vn(r,3),r.status=113,is(s),0!==r.pending)return r.last_flush=-1,br;if(69===r.status){if(r.gzhead.extra){let l=r.pending,d=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+d>r.pending_buf_size;){let p=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+p),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>l&&(s.adler=Hi(s.adler,r.pending_buf,r.pending-l,l)),r.gzindex+=p,is(s),0!==r.pending)return r.last_flush=-1,br;l=0,d-=p}let h=new Uint8Array(r.gzhead.extra);r.pending_buf.set(h.subarray(r.gzindex,r.gzindex+d),r.pending),r.pending+=d,r.gzhead.hcrc&&r.pending>l&&(s.adler=Hi(s.adler,r.pending_buf,r.pending-l,l)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let l,d=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>d&&(s.adler=Hi(s.adler,r.pending_buf,r.pending-d,d)),is(s),0!==r.pending)return r.last_flush=-1,br;d=0}l=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,vn(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>d&&(s.adler=Hi(s.adler,r.pending_buf,r.pending-d,d)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let l,d=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>d&&(s.adler=Hi(s.adler,r.pending_buf,r.pending-d,d)),is(s),0!==r.pending)return r.last_flush=-1,br;d=0}l=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,vn(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>d&&(s.adler=Hi(s.adler,r.pending_buf,r.pending-d,d))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(is(s),0!==r.pending))return r.last_flush=-1,br;vn(r,255&s.adler),vn(r,s.adler>>8&255),s.adler=0}if(r.status=113,is(s),0!==r.pending)return r.last_flush=-1,br}if(0!==s.avail_in||0!==r.lookahead||n!==Nd&&666!==r.status){let l=0===r.level?kO(r,n):r.strategy===vh?((d,h)=>{let p;for(;;){if(0===d.lookahead&&(jf(d),0===d.lookahead)){if(h===Nd)return 1;break}if(d.match_length=0,p=Va(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,p&&(rs(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,h===ns?(rs(d,!0),0===d.strm.avail_out?3:4):d.sym_next&&(rs(d,!1),0===d.strm.avail_out)?1:2})(r,n):r.strategy===AO?((d,h)=>{let p,m,_,E;const v=d.window;for(;;){if(d.lookahead<=258){if(jf(d),d.lookahead<=258&&h===Nd)return 1;if(0===d.lookahead)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(_=d.strstart-1,m=v[_],m===v[++_]&&m===v[++_]&&m===v[++_])){E=d.strstart+258;do{}while(m===v[++_]&&m===v[++_]&&m===v[++_]&&m===v[++_]&&m===v[++_]&&m===v[++_]&&m===v[++_]&&m===v[++_]&&_<E);d.match_length=258-(E-_),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(p=Va(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(p=Va(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),p&&(rs(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,h===ns?(rs(d,!0),0===d.strm.avail_out?3:4):d.sym_next&&(rs(d,!1),0===d.strm.avail_out)?1:2})(r,n):Ch[r.level].func(r,n);if(3!==l&&4!==l||(r.status=666),1===l||3===l)return 0===s.avail_out&&(r.last_flush=-1),br;if(2===l&&(n===TO?EL(r):n!==wO&&(xE(r,0,0,!1),n===vL&&(kd(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),is(s),0===s.avail_out))return r.last_flush=-1,br}return n!==ns?br:r.wrap<=0?PC:(2===r.wrap?(vn(r,255&s.adler),vn(r,s.adler>>8&255),vn(r,s.adler>>16&255),vn(r,s.adler>>24&255),vn(r,255&s.total_in),vn(r,s.total_in>>8&255),vn(r,s.total_in>>16&255),vn(r,s.total_in>>24&255)):(FE(r,s.adler>>>16),FE(r,65535&s.adler)),is(s),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?br:PC)},deflateEnd:s=>{if(Th(s))return gc;const n=s.state.status;return s.state=null,113===n?yh(s,IO):br},deflateSetDictionary:(s,n)=>{let r=n.length;if(Th(s))return gc;const a=s.state,l=a.wrap;if(2===l||1===l&&42!==a.status||a.lookahead)return gc;if(1===l&&(s.adler=bl(s.adler,n,r,0)),a.wrap=0,r>=a.w_size){0===l&&(kd(a.head),a.strstart=0,a.block_start=0,a.insert=0);let m=new Uint8Array(a.w_size);m.set(n.subarray(r-a.w_size,r),0),n=m,r=a.w_size}const d=s.avail_in,h=s.next_in,p=s.input;for(s.avail_in=r,s.next_in=0,s.input=n,jf(a);a.lookahead>=3;){let m=a.strstart,_=a.lookahead-2;do{a.ins_h=rr(a,a.ins_h,a.window[m+3-1]),a.prev[m&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=m,m++}while(--_);a.strstart=m,a.lookahead=2,jf(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,s.next_in=h,s.input=p,s.avail_in=d,a.wrap=l,br},deflateInfo:"pako deflate (from Nodeca project)"};const FV=(s,n)=>Object.prototype.hasOwnProperty.call(s,n);var LC={assign:function(s){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const r=n.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const a in r)FV(r,a)&&(s[a]=r[a])}}return s},flattenChunks:s=>{let n=0;for(let a=0,l=s.length;a<l;a++)n+=s[a].length;const r=new Uint8Array(n);for(let a=0,l=0,d=s.length;a<d;a++){let h=s[a];r.set(h,l),l+=h.length}return r}};let TL=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{TL=!1}const wh=new Uint8Array(256);for(let s=0;s<256;s++)wh[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;wh[254]=wh[254]=1;var Hf={string2buf:s=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(s);let n,r,a,l,d,h=s.length,p=0;for(l=0;l<h;l++)r=s.charCodeAt(l),55296==(64512&r)&&l+1<h&&(a=s.charCodeAt(l+1),56320==(64512&a)&&(r=65536+(r-55296<<10)+(a-56320),l++)),p+=r<128?1:r<2048?2:r<65536?3:4;for(n=new Uint8Array(p),d=0,l=0;d<p;l++)r=s.charCodeAt(l),55296==(64512&r)&&l+1<h&&(a=s.charCodeAt(l+1),56320==(64512&a)&&(r=65536+(r-55296<<10)+(a-56320),l++)),r<128?n[d++]=r:r<2048?(n[d++]=192|r>>>6,n[d++]=128|63&r):r<65536?(n[d++]=224|r>>>12,n[d++]=128|r>>>6&63,n[d++]=128|63&r):(n[d++]=240|r>>>18,n[d++]=128|r>>>12&63,n[d++]=128|r>>>6&63,n[d++]=128|63&r);return n},buf2string:(s,n)=>{const r=n||s.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(s.subarray(0,n));let a,l;const d=new Array(2*r);for(l=0,a=0;a<r;){let h=s[a++];if(h<128){d[l++]=h;continue}let p=wh[h];if(p>4)d[l++]=65533,a+=p-1;else{for(h&=2===p?31:3===p?15:7;p>1&&a<r;)h=h<<6|63&s[a++],p--;p>1?d[l++]=65533:h<65536?d[l++]=h:(h-=65536,d[l++]=55296|h>>10&1023,d[l++]=56320|1023&h)}}return((h,p)=>{if(p<65534&&h.subarray&&TL)return String.fromCharCode.apply(null,h.length===p?h:h.subarray(0,p));let m="";for(let _=0;_<p;_++)m+=String.fromCharCode(h[_]);return m})(d,l)},utf8border:(s,n)=>{(n=n||s.length)>s.length&&(n=s.length);let r=n-1;for(;r>=0&&128==(192&s[r]);)r--;return r<0||0===r?n:r+wh[s[r]]>n?r:n}},FO=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const UO=Object.prototype.toString,{Z_NO_FLUSH:wL,Z_SYNC_FLUSH:VO,Z_FULL_FLUSH:BO,Z_FINISH:jO,Z_OK:BE,Z_STREAM_END:IL,Z_DEFAULT_COMPRESSION:HO,Z_DEFAULT_STRATEGY:jE,Z_DEFLATED:UV}=Sl;function Ih(s){this.options=LC.assign({level:HO,method:UV,chunkSize:16384,windowBits:15,memLevel:8,strategy:jE},s||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new FO,this.strm.avail_out=0;let r=Tl.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(r!==BE)throw new Error(Od[r]);if(n.header&&Tl.deflateSetHeader(this.strm,n.header),n.dictionary){let a;if(a="string"==typeof n.dictionary?Hf.string2buf(n.dictionary):"[object ArrayBuffer]"===UO.call(n.dictionary)?new Uint8Array(n.dictionary):n.dictionary,r=Tl.deflateSetDictionary(this.strm,a),r!==BE)throw new Error(Od[r]);this._dict_set=!0}}function Fd(s,n){const r=new Ih(n);if(r.push(s,!0),r.err)throw r.msg||Od[r.err];return r.result}Ih.prototype.push=function(s,n){const r=this.strm,a=this.options.chunkSize;let l,d;if(this.ended)return!1;for(d=n===~~n?n:!0===n?jO:wL,r.input="string"==typeof s?Hf.string2buf(s):"[object ArrayBuffer]"===UO.call(s)?new Uint8Array(s):s,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),(d===VO||d===BO)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(l=Tl.deflate(r,d),l===IL)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),l=Tl.deflateEnd(this.strm),this.onEnd(l),this.ended=!0,l===BE;if(0!==r.avail_out){if(d>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},Ih.prototype.onData=function(s){this.chunks.push(s)},Ih.prototype.onEnd=function(s){s===BE&&(this.result=LC.flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};var RL={Deflate:Ih,deflate:Fd,deflateRaw:function(s,n){return(n=n||{}).raw=!0,Fd(s,n)},gzip:function(s,n){return(n=n||{}).gzip=!0,Fd(s,n)},constants:Sl};const HE=16209;var VV=function(s,n){let r,a,l,d,h,p,m,_,E,v,b,T,O,P,D,L,V,U,J,se,q,Q,$,Y;const me=s.state;r=s.next_in,$=s.input,a=r+(s.avail_in-5),l=s.next_out,Y=s.output,d=l-(n-s.avail_out),h=l+(s.avail_out-257),p=me.dmax,m=me.wsize,_=me.whave,E=me.wnext,v=me.window,b=me.hold,T=me.bits,O=me.lencode,P=me.distcode,D=(1<<me.lenbits)-1,L=(1<<me.distbits)-1;e:do{T<15&&(b+=$[r++]<<T,T+=8,b+=$[r++]<<T,T+=8),V=O[b&D];t:for(;;){if(U=V>>>24,b>>>=U,T-=U,U=V>>>16&255,0===U)Y[l++]=65535&V;else{if(!(16&U)){if(!(64&U)){V=O[(65535&V)+(b&(1<<U)-1)];continue t}if(32&U){me.mode=16191;break e}s.msg="invalid literal/length code",me.mode=HE;break e}J=65535&V,U&=15,U&&(T<U&&(b+=$[r++]<<T,T+=8),J+=b&(1<<U)-1,b>>>=U,T-=U),T<15&&(b+=$[r++]<<T,T+=8,b+=$[r++]<<T,T+=8),V=P[b&L];n:for(;;){if(U=V>>>24,b>>>=U,T-=U,U=V>>>16&255,!(16&U)){if(!(64&U)){V=P[(65535&V)+(b&(1<<U)-1)];continue n}s.msg="invalid distance code",me.mode=HE;break e}if(se=65535&V,U&=15,T<U&&(b+=$[r++]<<T,T+=8,T<U&&(b+=$[r++]<<T,T+=8)),se+=b&(1<<U)-1,se>p){s.msg="invalid distance too far back",me.mode=HE;break e}if(b>>>=U,T-=U,U=l-d,se>U){if(U=se-U,U>_&&me.sane){s.msg="invalid distance too far back",me.mode=HE;break e}if(q=0,Q=v,0===E){if(q+=m-U,U<J){J-=U;do{Y[l++]=v[q++]}while(--U);q=l-se,Q=Y}}else if(E<U){if(q+=m+E-U,U-=E,U<J){J-=U;do{Y[l++]=v[q++]}while(--U);if(q=0,E<J){U=E,J-=U;do{Y[l++]=v[q++]}while(--U);q=l-se,Q=Y}}}else if(q+=E-U,U<J){J-=U;do{Y[l++]=v[q++]}while(--U);q=l-se,Q=Y}for(;J>2;)Y[l++]=Q[q++],Y[l++]=Q[q++],Y[l++]=Q[q++],J-=3;J&&(Y[l++]=Q[q++],J>1&&(Y[l++]=Q[q++]))}else{q=l-se;do{Y[l++]=Y[q++],Y[l++]=Y[q++],Y[l++]=Y[q++],J-=3}while(J>2);J&&(Y[l++]=Y[q++],J>1&&(Y[l++]=Y[q++]))}break}}break}}while(r<a&&l<h);J=T>>3,r-=J,T-=J<<3,b&=(1<<T)-1,s.next_in=r,s.next_out=l,s.avail_in=r<a?a-r+5:5-(r-a),s.avail_out=l<h?h-l+257:257-(l-h),me.hold=b,me.bits=T};const AL=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),DL=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),OL=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),NL=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Rh=(s,n,r,a,l,d,h,p)=>{const m=p.bits;let _,E,v,b,T,O,P=0,D=0,L=0,V=0,U=0,J=0,se=0,q=0,Q=0,$=0,Y=null;const me=new Uint16Array(16),Ee=new Uint16Array(16);let Ze,yt,xn,Ht=null;for(P=0;P<=15;P++)me[P]=0;for(D=0;D<a;D++)me[n[r+D]]++;for(U=m,V=15;V>=1&&0===me[V];V--);if(U>V&&(U=V),0===V)return l[d++]=20971520,l[d++]=20971520,p.bits=1,0;for(L=1;L<V&&0===me[L];L++);for(U<L&&(U=L),q=1,P=1;P<=15;P++)if(q<<=1,q-=me[P],q<0)return-1;if(q>0&&(0===s||1!==V))return-1;for(Ee[1]=0,P=1;P<15;P++)Ee[P+1]=Ee[P]+me[P];for(D=0;D<a;D++)0!==n[r+D]&&(h[Ee[n[r+D]]++]=D);if(0===s?(Y=Ht=h,O=20):1===s?(Y=AL,Ht=DL,O=257):(Y=OL,Ht=NL,O=0),$=0,D=0,P=L,T=d,J=U,se=0,v=-1,Q=1<<U,b=Q-1,1===s&&Q>852||2===s&&Q>592)return 1;for(;;){Ze=P-se,h[D]+1<O?(yt=0,xn=h[D]):h[D]>=O?(yt=Ht[h[D]-O],xn=Y[h[D]-O]):(yt=96,xn=0),_=1<<P-se,E=1<<J,L=E;do{E-=_,l[T+($>>se)+E]=Ze<<24|yt<<16|xn|0}while(0!==E);for(_=1<<P-1;$&_;)_>>=1;if(0!==_?($&=_-1,$+=_):$=0,D++,0==--me[P]){if(P===V)break;P=n[r+h[D]]}if(P>U&&($&b)!==v){for(0===se&&(se=U),T+=L,J=P-se,q=1<<J;J+se<V&&(q-=me[J+se],!(q<=0));)J++,q<<=1;if(Q+=1<<J,1===s&&Q>852||2===s&&Q>592)return 1;v=$&b,l[v]=U<<24|J<<16|T-d|0}}return 0!==$&&(l[T+$]=P-se<<24|64<<16|0),p.bits=U,0};const{Z_FINISH:UC,Z_BLOCK:PL,Z_TREES:Gf,Z_OK:wl,Z_STREAM_END:BV,Z_NEED_DICT:ML,Z_STREAM_ERROR:Io,Z_DATA_ERROR:VC,Z_MEM_ERROR:BC,Z_BUF_ERROR:xL,Z_DEFLATED:Wf}=Sl,GE=16180,WE=16190,ja=16191,qE=16199,jC=16200,si=16209,kL=s=>(s>>>24&255)+(s>>>8&65280)+((65280&s)<<8)+((255&s)<<24);function LL(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ts=s=>{if(!s)return 1;const n=s.state;return!n||n.strm!==s||n.mode<GE||n.mode>16211?1:0},FL=s=>{if(Ts(s))return Io;const n=s.state;return s.total_in=s.total_out=n.total=0,s.msg="",n.wrap&&(s.adler=1&n.wrap),n.mode=GE,n.last=0,n.havedict=0,n.flags=-1,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(852),n.distcode=n.distdyn=new Int32Array(592),n.sane=1,n.back=-1,wl},UL=s=>{if(Ts(s))return Io;const n=s.state;return n.wsize=0,n.whave=0,n.wnext=0,FL(s)},VL=(s,n)=>{let r;if(Ts(s))return Io;const a=s.state;return n<0?(r=0,n=-n):(r=5+(n>>4),n<48&&(n&=15)),n&&(n<8||n>15)?Io:(null!==a.window&&a.wbits!==n&&(a.window=null),a.wrap=r,a.wbits=n,UL(s))},BL=(s,n)=>{if(!s)return Io;const r=new LL;s.state=r,r.strm=s,r.window=null,r.mode=GE;const a=VL(s,n);return a!==wl&&(s.state=null),a};let WO,GC,jL=!0;const jV=s=>{if(jL){WO=new Int32Array(512),GC=new Int32Array(32);let n=0;for(;n<144;)s.lens[n++]=8;for(;n<256;)s.lens[n++]=9;for(;n<280;)s.lens[n++]=7;for(;n<288;)s.lens[n++]=8;for(Rh(1,s.lens,0,288,WO,0,s.work,{bits:9}),n=0;n<32;)s.lens[n++]=5;Rh(2,s.lens,0,32,GC,0,s.work,{bits:5}),jL=!1}s.lencode=WO,s.lenbits=9,s.distcode=GC,s.distbits=5},HL=(s,n,r,a)=>{let l;const d=s.state;return null===d.window&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),a>=d.wsize?(d.window.set(n.subarray(r-d.wsize,r),0),d.wnext=0,d.whave=d.wsize):(l=d.wsize-d.wnext,l>a&&(l=a),d.window.set(n.subarray(r-a,r-a+l),d.wnext),(a-=l)?(d.window.set(n.subarray(r-a,r),0),d.wnext=a,d.whave=d.wsize):(d.wnext+=l,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=l))),0};var Il={inflateReset:UL,inflateReset2:VL,inflateResetKeep:FL,inflateInit:s=>BL(s,15),inflateInit2:BL,inflate:(s,n)=>{let r,a,l,d,h,p,m,_,E,v,b,T,O,P,D,L,V,U,J,se,q,Q,$=0;const Y=new Uint8Array(4);let me,Ee;const Ze=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ts(s)||!s.output||!s.input&&0!==s.avail_in)return Io;r=s.state,r.mode===ja&&(r.mode=16192),h=s.next_out,l=s.output,m=s.avail_out,d=s.next_in,a=s.input,p=s.avail_in,_=r.hold,E=r.bits,v=p,b=m,Q=wl;e:for(;;)switch(r.mode){case GE:if(0===r.wrap){r.mode=16192;break}for(;E<16;){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}if(2&r.wrap&&35615===_){0===r.wbits&&(r.wbits=15),r.check=0,Y[0]=255&_,Y[1]=_>>>8&255,r.check=Hi(r.check,Y,2,0),_=0,E=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&_)<<8)+(_>>8))%31){s.msg="incorrect header check",r.mode=si;break}if((15&_)!==Wf){s.msg="unknown compression method",r.mode=si;break}if(_>>>=4,E-=4,q=8+(15&_),0===r.wbits&&(r.wbits=q),q>15||q>r.wbits){s.msg="invalid window size",r.mode=si;break}r.dmax=1<<r.wbits,r.flags=0,s.adler=r.check=1,r.mode=512&_?16189:ja,_=0,E=0;break;case 16181:for(;E<16;){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}if(r.flags=_,(255&r.flags)!==Wf){s.msg="unknown compression method",r.mode=si;break}if(57344&r.flags){s.msg="unknown header flags set",r.mode=si;break}r.head&&(r.head.text=_>>8&1),512&r.flags&&4&r.wrap&&(Y[0]=255&_,Y[1]=_>>>8&255,r.check=Hi(r.check,Y,2,0)),_=0,E=0,r.mode=16182;case 16182:for(;E<32;){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}r.head&&(r.head.time=_),512&r.flags&&4&r.wrap&&(Y[0]=255&_,Y[1]=_>>>8&255,Y[2]=_>>>16&255,Y[3]=_>>>24&255,r.check=Hi(r.check,Y,4,0)),_=0,E=0,r.mode=16183;case 16183:for(;E<16;){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}r.head&&(r.head.xflags=255&_,r.head.os=_>>8),512&r.flags&&4&r.wrap&&(Y[0]=255&_,Y[1]=_>>>8&255,r.check=Hi(r.check,Y,2,0)),_=0,E=0,r.mode=16184;case 16184:if(1024&r.flags){for(;E<16;){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}r.length=_,r.head&&(r.head.extra_len=_),512&r.flags&&4&r.wrap&&(Y[0]=255&_,Y[1]=_>>>8&255,r.check=Hi(r.check,Y,2,0)),_=0,E=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(T=r.length,T>p&&(T=p),T&&(r.head&&(q=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(a.subarray(d,d+T),q)),512&r.flags&&4&r.wrap&&(r.check=Hi(r.check,a,T,d)),p-=T,d+=T,r.length-=T),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===p)break e;T=0;do{q=a[d+T++],r.head&&q&&r.length<65536&&(r.head.name+=String.fromCharCode(q))}while(q&&T<p);if(512&r.flags&&4&r.wrap&&(r.check=Hi(r.check,a,T,d)),p-=T,d+=T,q)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===p)break e;T=0;do{q=a[d+T++],r.head&&q&&r.length<65536&&(r.head.comment+=String.fromCharCode(q))}while(q&&T<p);if(512&r.flags&&4&r.wrap&&(r.check=Hi(r.check,a,T,d)),p-=T,d+=T,q)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;E<16;){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}if(4&r.wrap&&_!==(65535&r.check)){s.msg="header crc mismatch",r.mode=si;break}_=0,E=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),s.adler=r.check=0,r.mode=ja;break;case 16189:for(;E<32;){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}s.adler=r.check=kL(_),_=0,E=0,r.mode=WE;case WE:if(0===r.havedict)return s.next_out=h,s.avail_out=m,s.next_in=d,s.avail_in=p,r.hold=_,r.bits=E,ML;s.adler=r.check=1,r.mode=ja;case ja:if(n===PL||n===Gf)break e;case 16192:if(r.last){_>>>=7&E,E-=7&E,r.mode=16206;break}for(;E<3;){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}switch(r.last=1&_,_>>>=1,E-=1,3&_){case 0:r.mode=16193;break;case 1:if(jV(r),r.mode=qE,n===Gf){_>>>=2,E-=2;break e}break;case 2:r.mode=16196;break;case 3:s.msg="invalid block type",r.mode=si}_>>>=2,E-=2;break;case 16193:for(_>>>=7&E,E-=7&E;E<32;){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}if((65535&_)!=(_>>>16^65535)){s.msg="invalid stored block lengths",r.mode=si;break}if(r.length=65535&_,_=0,E=0,r.mode=16194,n===Gf)break e;case 16194:r.mode=16195;case 16195:if(T=r.length,T){if(T>p&&(T=p),T>m&&(T=m),0===T)break e;l.set(a.subarray(d,d+T),h),p-=T,d+=T,m-=T,h+=T,r.length-=T;break}r.mode=ja;break;case 16196:for(;E<14;){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}if(r.nlen=257+(31&_),_>>>=5,E-=5,r.ndist=1+(31&_),_>>>=5,E-=5,r.ncode=4+(15&_),_>>>=4,E-=4,r.nlen>286||r.ndist>30){s.msg="too many length or distance symbols",r.mode=si;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;E<3;){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}r.lens[Ze[r.have++]]=7&_,_>>>=3,E-=3}for(;r.have<19;)r.lens[Ze[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,me={bits:r.lenbits},Q=Rh(0,r.lens,0,19,r.lencode,0,r.work,me),r.lenbits=me.bits,Q){s.msg="invalid code lengths set",r.mode=si;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;$=r.lencode[_&(1<<r.lenbits)-1],D=$>>>24,L=$>>>16&255,V=65535&$,!(D<=E);){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}if(V<16)_>>>=D,E-=D,r.lens[r.have++]=V;else{if(16===V){for(Ee=D+2;E<Ee;){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}if(_>>>=D,E-=D,0===r.have){s.msg="invalid bit length repeat",r.mode=si;break}q=r.lens[r.have-1],T=3+(3&_),_>>>=2,E-=2}else if(17===V){for(Ee=D+3;E<Ee;){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}_>>>=D,E-=D,q=0,T=3+(7&_),_>>>=3,E-=3}else{for(Ee=D+7;E<Ee;){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}_>>>=D,E-=D,q=0,T=11+(127&_),_>>>=7,E-=7}if(r.have+T>r.nlen+r.ndist){s.msg="invalid bit length repeat",r.mode=si;break}for(;T--;)r.lens[r.have++]=q}}if(r.mode===si)break;if(0===r.lens[256]){s.msg="invalid code -- missing end-of-block",r.mode=si;break}if(r.lenbits=9,me={bits:r.lenbits},Q=Rh(1,r.lens,0,r.nlen,r.lencode,0,r.work,me),r.lenbits=me.bits,Q){s.msg="invalid literal/lengths set",r.mode=si;break}if(r.distbits=6,r.distcode=r.distdyn,me={bits:r.distbits},Q=Rh(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,me),r.distbits=me.bits,Q){s.msg="invalid distances set",r.mode=si;break}if(r.mode=qE,n===Gf)break e;case qE:r.mode=jC;case jC:if(p>=6&&m>=258){s.next_out=h,s.avail_out=m,s.next_in=d,s.avail_in=p,r.hold=_,r.bits=E,VV(s,b),h=s.next_out,l=s.output,m=s.avail_out,d=s.next_in,a=s.input,p=s.avail_in,_=r.hold,E=r.bits,r.mode===ja&&(r.back=-1);break}for(r.back=0;$=r.lencode[_&(1<<r.lenbits)-1],D=$>>>24,L=$>>>16&255,V=65535&$,!(D<=E);){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}if(L&&!(240&L)){for(U=D,J=L,se=V;$=r.lencode[se+((_&(1<<U+J)-1)>>U)],D=$>>>24,L=$>>>16&255,V=65535&$,!(U+D<=E);){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}_>>>=U,E-=U,r.back+=U}if(_>>>=D,E-=D,r.back+=D,r.length=V,0===L){r.mode=16205;break}if(32&L){r.back=-1,r.mode=ja;break}if(64&L){s.msg="invalid literal/length code",r.mode=si;break}r.extra=15&L,r.mode=16201;case 16201:if(r.extra){for(Ee=r.extra;E<Ee;){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}r.length+=_&(1<<r.extra)-1,_>>>=r.extra,E-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;$=r.distcode[_&(1<<r.distbits)-1],D=$>>>24,L=$>>>16&255,V=65535&$,!(D<=E);){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}if(!(240&L)){for(U=D,J=L,se=V;$=r.distcode[se+((_&(1<<U+J)-1)>>U)],D=$>>>24,L=$>>>16&255,V=65535&$,!(U+D<=E);){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}_>>>=U,E-=U,r.back+=U}if(_>>>=D,E-=D,r.back+=D,64&L){s.msg="invalid distance code",r.mode=si;break}r.offset=V,r.extra=15&L,r.mode=16203;case 16203:if(r.extra){for(Ee=r.extra;E<Ee;){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}r.offset+=_&(1<<r.extra)-1,_>>>=r.extra,E-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){s.msg="invalid distance too far back",r.mode=si;break}r.mode=16204;case 16204:if(0===m)break e;if(T=b-m,r.offset>T){if(T=r.offset-T,T>r.whave&&r.sane){s.msg="invalid distance too far back",r.mode=si;break}T>r.wnext?(T-=r.wnext,O=r.wsize-T):O=r.wnext-T,T>r.length&&(T=r.length),P=r.window}else P=l,O=h-r.offset,T=r.length;T>m&&(T=m),m-=T,r.length-=T;do{l[h++]=P[O++]}while(--T);0===r.length&&(r.mode=jC);break;case 16205:if(0===m)break e;l[h++]=r.length,m--,r.mode=jC;break;case 16206:if(r.wrap){for(;E<32;){if(0===p)break e;p--,_|=a[d++]<<E,E+=8}if(b-=m,s.total_out+=b,r.total+=b,4&r.wrap&&b&&(s.adler=r.check=r.flags?Hi(r.check,l,b,h-b):bl(r.check,l,b,h-b)),b=m,4&r.wrap&&(r.flags?_:kL(_))!==r.check){s.msg="incorrect data check",r.mode=si;break}_=0,E=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;E<32;){if(0===p)break e;p--,_+=a[d++]<<E,E+=8}if(4&r.wrap&&_!==(4294967295&r.total)){s.msg="incorrect length check",r.mode=si;break}_=0,E=0}r.mode=16208;case 16208:Q=BV;break e;case si:Q=VC;break e;case 16210:return BC;default:return Io}return s.next_out=h,s.avail_out=m,s.next_in=d,s.avail_in=p,r.hold=_,r.bits=E,(r.wsize||b!==s.avail_out&&r.mode<si&&(r.mode<16206||n!==UC))&&HL(s,s.output,s.next_out,b-s.avail_out),v-=s.avail_in,b-=s.avail_out,s.total_in+=v,s.total_out+=b,r.total+=b,4&r.wrap&&b&&(s.adler=r.check=r.flags?Hi(r.check,l,b,s.next_out-b):bl(r.check,l,b,s.next_out-b)),s.data_type=r.bits+(r.last?64:0)+(r.mode===ja?128:0)+(r.mode===qE||16194===r.mode?256:0),(0===v&&0===b||n===UC)&&Q===wl&&(Q=xL),Q},inflateEnd:s=>{if(Ts(s))return Io;let n=s.state;return n.window&&(n.window=null),s.state=null,wl},inflateGetHeader:(s,n)=>{if(Ts(s))return Io;const r=s.state;return 2&r.wrap?(r.head=n,n.done=!1,wl):Io},inflateSetDictionary:(s,n)=>{const r=n.length;let a,l,d;return Ts(s)?Io:(a=s.state,0!==a.wrap&&a.mode!==WE?Io:a.mode===WE&&(l=1,l=bl(l,n,r,0),l!==a.check)?VC:(d=HL(s,n,r,r),d?(a.mode=16210,BC):(a.havedict=1,wl)))},inflateInfo:"pako inflate (from Nodeca project)"},GL=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const WL=Object.prototype.toString,{Z_NO_FLUSH:WC,Z_FINISH:Rl,Z_OK:zf,Z_STREAM_END:zC,Z_NEED_DICT:Yt,Z_STREAM_ERROR:qC,Z_DATA_ERROR:zO,Z_MEM_ERROR:zL}=Sl;function Ud(s){this.options=LC.assign({chunkSize:65536,windowBits:15,to:""},s||{});const n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,0===n.windowBits&&(n.windowBits=-15)),!(n.windowBits>=0&&n.windowBits<16)||s&&s.windowBits||(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&!(15&n.windowBits)&&(n.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new FO,this.strm.avail_out=0;let r=Il.inflateInit2(this.strm,n.windowBits);if(r!==zf)throw new Error(Od[r]);if(this.header=new GL,Il.inflateGetHeader(this.strm,this.header),n.dictionary&&("string"==typeof n.dictionary?n.dictionary=Hf.string2buf(n.dictionary):"[object ArrayBuffer]"===WL.call(n.dictionary)&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(r=Il.inflateSetDictionary(this.strm,n.dictionary),r!==zf)))throw new Error(Od[r])}function KE(s,n){const r=new Ud(n);if(r.push(s),r.err)throw r.msg||Od[r.err];return r.result}Ud.prototype.push=function(s,n){const r=this.strm,a=this.options.chunkSize,l=this.options.dictionary;let d,h,p;if(this.ended)return!1;for(h=n===~~n?n:!0===n?Rl:WC,r.input="[object ArrayBuffer]"===WL.call(s)?new Uint8Array(s):s,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),d=Il.inflate(r,h),d===Yt&&l&&(d=Il.inflateSetDictionary(r,l),d===zf?d=Il.inflate(r,h):d===zO&&(d=Yt));r.avail_in>0&&d===zC&&r.state.wrap>0&&0!==s[r.next_in];)Il.inflateReset(r),d=Il.inflate(r,h);switch(d){case qC:case zO:case Yt:case zL:return this.onEnd(d),this.ended=!0,!1}if(p=r.avail_out,r.next_out&&(0===r.avail_out||d===zC))if("string"===this.options.to){let m=Hf.utf8border(r.output,r.next_out),_=r.next_out-m,E=Hf.buf2string(r.output,m);r.next_out=_,r.avail_out=a-_,_&&r.output.set(r.output.subarray(m,m+_),0),this.onData(E)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(d!==zf||0!==p){if(d===zC)return d=Il.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},Ud.prototype.onData=function(s){this.chunks.push(s)},Ud.prototype.onEnd=function(s){s===zf&&(this.result="string"===this.options.to?this.chunks.join(""):LC.flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};var vc={Inflate:Ud,inflate:KE,inflateRaw:function(s,n){return(n=n||{}).raw=!0,KE(s,n)},ungzip:KE,constants:Sl};const{deflate:qO}=RL,{inflate:KL}=vc;var YC,KO=qO,YE=KL;!function(s){s[s.ONE_BYTE=0]="ONE_BYTE",s[s.TWO_BYTE=1]="TWO_BYTE"}(YC||(YC={}));class Dh{constructor(){C(this,"_sequence",0),C(this,"_startTime",Date.now()),C(this,"isUseOneByte",!0)}get startTime(){const n=Date.now()-this._startTime;return n<Math.pow(2,16)?n:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(n){const r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:n};if(n.byteLength>128){const p=new Uint8Array(4);p.set([1,0,0,0]);const _={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[{id:0,length:4,data:p.buffer}]};r.commonPacketHeader.extension=1,r.extension=_,r.payload=this.compress(n),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;const a=new ArrayBuffer(r.commonPacketHeader.length),l=new Uint8Array(a),d=new DataView(a);let h=0;if(d.setUint16(h,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),h+=2,d.setUint32(h,r.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,r.commonStreamHeader,!0),h+=2,r.extension){const p=this.serializeExtension(r.extension);l.set(new Uint8Array(p),h),h+=p.byteLength}if(l.set(new Uint8Array(r.payload),h),h+=r.payload.byteLength,h!==r.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(n){if(n.byteLength<4)return new ArrayBuffer(0);const r=new DataView(n);let a=0;const l=r.getUint16(a,!0);a+=2;const d=(32768&l)>>15;let h,p;if(r.getUint16(a+2,!0),r.getUint16(a,!0),a+=4,r.getUint16(a,!0),a+=2,d){p=this.deserializeExtension(n.slice(a)),a+=2+p.length,h=n.slice(a);let m=!1;if(p.datas.length>0){const _=p.datas.find(E=>0===E.id);_&&(m=1==(1&new DataView(_.data).getUint32(0,!0)))}h=m?this.decompress(h):h}else h=n.slice(8);return h}serializeExtension(n){const{profile:r,length:a,datas:l}=n,d=new ArrayBuffer(a+2),h=new Uint8Array(d),p=new DataView(d);let m=0;if(p.setUint8(m++,r),p.setUint8(m++,a),l.forEach(_=>{r?(p.setUint8(m++,_.id),p.setUint8(m++,_.length),h.set(new Uint8Array(_.data),m),m+=_.data.byteLength):(p.setUint8(m++,_.id|_.length<<4),h.set(new Uint8Array(_.data),m),m+=_.data.byteLength)}),m!==a+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(a+2));return d}deserializeExtension(n){const r=new DataView(n);let a=0;const l=r.getUint8(a);a++;const d=r.getUint8(a);a++;const h=l===YC.TWO_BYTE,p=[],m=new DataView(n,2);let _=0;for(;_<d;){let E=0,v=0,b=new ArrayBuffer(0);h?(E=m.getUint8(_),_++,v=m.getUint8(_),_++):(E=15&m.getUint8(_),v=m.getUint8(_)>>4,_++),v>0&&(b=m.buffer.slice(_+2,_+2+v),_+=b.byteLength),p.push({id:E,length:v,data:b})}if(_!==d)throw Error("parse error");return{profile:l,length:d,datas:p}}decompress(n){return YE(new Uint8Array(n))}compress(n){return KO(new Uint8Array(n))}}class kr extends qt{constructor(n,r){super(),C(this,"_version",1),C(this,"_type",3),C(this,"_config",void 0),C(this,"_originDataChannel",void 0),C(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),C(this,"_dataStreamPacketHandler",void 0),C(this,"_datachannelEventMap",new Map),this._config=n,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader(),this._dataStreamPacketHandler=new Dh}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return j("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var n,r;return null!==(n=null===(r=this._originDataChannel)||void 0===r?void 0:r.readyState)&&void 0!==n?n:"connecting"}get _originDataChannelId(){var n,r;return null!==(n=null===(r=this._originDataChannel)||void 0===r?void 0:r.id)&&void 0!==n?n:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}_waitTillOpen(){var n=this;return x(function*(){return new z((r,a)=>{if(n._originDataChannel){"open"===n._originDataChannel.readyState&&r();const l=setTimeout(()=>{var d;a(new X(M.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(d=n._originDataChannel)||void 0===d?void 0:d.id)))},1e4);n._originDataChannel.onopen=()=>{clearTimeout(l),n._originDataChannel&&n._bandDataChannelEvents(n._originDataChannel),r()},n._originDataChannel.onerror=()=>{throw clearTimeout(l),new X(M.DATACHANNEL_CONNECTION_TIMEOUT)}}else a(new X(M.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})})()}_updateOriginDataChannel(n){this._originDataChannel=n,this._bandDataChannelEvents(n)}_initPacketHeader(){const n=new DataView(this._dataStreamPacketHeader);n.setUint16(0,this._version),n.setUint8(2,this._type),n.setUint8(3,this._config.id)}_bandDataChannelEvents(n){this._unbindDataChannelEvents(n),[bd.OPEN,bd.CLOSE,bd.ERROR].forEach(r=>{const a=()=>{this.emit(r)};this._datachannelEventMap.set(r,a),n.addEventListener(r,a)})}_unbindDataChannelEvents(n){Array.from(this._datachannelEventMap.entries()).forEach(r=>{let[a,l]=r;n.removeEventListener(a,l)}),this._datachannelEventMap.clear()}}class Mn extends kr{constructor(n){super(n),C(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=r.data.slice(0,this._dataStreamPacketHeader.byteLength);if(new DataView(a).getUint8(3)!==this.id)return;let l=r.data.slice(this._dataStreamPacketHeader.byteLength);l=this._dataStreamPacketHandler.deserialize(l),this.emit(bd.MESSAGE,l)}}_updateOriginDataChannel(n){super._updateOriginDataChannel(n),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Ro extends kr{send(n){if(this._originDataChannel){let r=n;r=this._dataStreamPacketHandler.serialize(n);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}class Ai extends qt{constructor(){super(...arguments),C(this,"resultStorage",new Map)}setLocalAudioStats(n,r,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",n,this.checkAudioInputLevel(a,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",n,this.checkSendAudioBitrate(a,r))}setLocalVideoStats(n,r,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",n,this.checkSendVideoBitrate(a,r)),this.record("FRAMERATE_INPUT_TOO_LOW",n,this.checkFramerateInput(a,r)),this.record("FRAMERATE_SENT_TOO_LOW",n,this.checkFramerateSent(a))}setRemoteAudioStats(n,r){const a=n.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(r))}setRemoteVideoStats(n,r){const a=n.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(r))}record(n,r,a){if(j("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(n)||this.resultStorage.set(n,{result:[],isPrevNormal:!0});const l=this.resultStorage.get(n);if(l&&(l.result.push(a),l.result.length>=5)){var d;const h=ye(d=l.result).call(d,!0);l.isPrevNormal&&!h&&this.emit("exception",YO[n],n,r),!l.isPrevNormal&&h&&this.emit("exception",YO[n]+2e3,n+"_RECOVER",r),l.isPrevNormal=h,l.result=[]}}checkAudioOutputLevel(n){return!(n.receiveBitrate>0&&0===n.receiveLevel)}checkAudioInputLevel(n,r){return r instanceof wn&&!r.isActive||!!r.muted||0!==n.sendVolumeLevel}checkFramerateInput(n,r){let a=null;r._encoderConfig&&r._encoderConfig.frameRate&&(a=Sr(r._encoderConfig.frameRate));const l=n.captureFrameRate;return!a||!l||!(a>10&&l<5||a<10&&a>=5&&l<=1)}checkFramerateSent(n){return!(n.captureFrameRate&&n.sendFrameRate&&n.captureFrameRate>5&&n.sendFrameRate<=1)}checkSendVideoBitrate(n,r){return!!r.muted||0!==n.sendBitrate}checkSendAudioBitrate(n,r){return r instanceof wn&&!r.isActive||!!r.muted||0!==n.sendBitrate}checkVideoDecode(n){return 0===n.receiveBitrate||0!==n.decodeFrameRate}}const YO={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Di=new class{markSubscribeStart(s,n){performance.mark("agora-web-sdk/".concat(s,"/subscribe-").concat(n))}markPublishStart(s,n){performance.mark("agora-web-sdk/".concat(s,"/publish-").concat(n))}measureFromSubscribeStart(s,n){const r=performance.getEntriesByName("agora-web-sdk/".concat(s,"/subscribe-").concat(n));if(r.length>0){const a=r[r.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(s,n){const r=performance.getEntriesByName("agora-web-sdk/".concat(s,"/publish-").concat(n));if(r.length>0){const a=r[r.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function $O(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Vd(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?$O(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):$O(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class Oh{constructor(n){C(this,"store",void 0),C(this,"onStatsException",void 0),C(this,"onUploadPublishDuration",void 0),C(this,"onStatsChanged",void 0),C(this,"localStats",new Map),C(this,"remoteStats",new Map),C(this,"updateStatsInterval",void 0),C(this,"trafficStats",void 0),C(this,"trafficStatsPeerList",[]),C(this,"uplinkStats",void 0),C(this,"exceptionMonitor",void 0),C(this,"p2pChannel",void 0),C(this,"scalabilityMode",rE.L1T1),C(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=n,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new Ai,this.exceptionMonitor.on("exception",(r,a,l)=>{this.onStatsException&&this.onStatsException(r,a,l)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ne.LocalAudioTrack)||Vd({},aC)}getLocalVideoTrackStats(){return this.localStats.get(ne.LocalVideoTrack)||Vd({},mE)}getRemoteAudioTrackStats(n){const r=(d,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return p&&(h.publishDuration=p.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(n){var l;const d=null===(l=this.remoteStats.get(n))||void 0===l?void 0:l.audioStats;d&&(a[n]=r(n,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:p}]=d;p&&(a[h]=r(h,p))});return a}getRemoteNetworkQualityStats(n){const r={};if(n){var a;const l=null===(a=this.remoteStats.get(n))||void 0===a?void 0:a.networkStats;l&&(r[n]=l)}else Array.from(this.remoteStats.entries()).forEach(l=>{let[d,{networkStats:h}]=l;h&&(r[d]=h)});return r}getRemoteVideoTrackStats(n){const r=(d,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return p&&(h.publishDuration=p.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(n){var l;const d=null===(l=this.remoteStats.get(n))||void 0===l?void 0:l.videoStats;d&&(a[n]=r(n,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:p}]=d;p&&(a[h]=r(h,p))});return a}getRTCStats(){let n=0,r=0,a=0,l=0;const d=this.localStats.get(ne.LocalAudioTrack);d&&(n+=d.sendBytes,r+=d.sendBitrate);const h=this.localStats.get(ne.LocalVideoTrack);h&&(n+=h.sendBytes,r+=h.sendBitrate);const p=this.localStats.get(ne.LocalVideoLowTrack);p&&(n+=p.sendBytes,r+=p.sendBitrate),this.remoteStats.forEach(_=>{let{audioStats:E,videoStats:v}=_;E&&(a+=E.receiveBytes,l+=E.receiveBitrate),v&&(a+=v.receiveBytes,l+=v.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:r,SendBytes:n,RecvBytes:a,RecvBitrate:l,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(n){this.localStats.set(n,void 0)}removeLocalStats(n){n?this.localStats.delete(n):this.localStats.clear()}addRemoteStats(n){this.remoteStats.set(n,{})}removeRemoteStats(n){n?this.remoteStats.delete(n):this.remoteStats.clear()}addP2PChannel(n){this.p2pChannel=n}updateTrafficStats(n){n.peer_delay=n.peer_delay.filter(r=>void 0!==r.B_ppad||void 0!==r.B_ppvd),n.peer_delay.filter(r=>-1===this.trafficStatsPeerList.indexOf(r.peer_uid)).forEach(r=>{var a;const l=null===(a=this.p2pChannel)||void 0===a?void 0:a.getRemoteMedia(r.peer_uid),d=null!=l&&l.videoSSRC?Di.measureFromSubscribeStart(this.store.clientId,l.videoSSRC):0,h=null!=l&&l.audioSSRC?Di.measureFromSubscribeStart(this.store.clientId,l.audioSSRC):0;void 0!==r.B_ppad&&void 0!==r.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=n}updateUplinkStats(n){this.uplinkStats&&this.uplinkStats.B_fir!==n.B_fir&&w.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(n.B_fir)),this.uplinkStats=n}static isRemoteVideoFreeze(n,r,a){return!!n&&(!!a&&r.framesDecodeFreezeTime>a.framesDecodeFreezeTime||!(!a||r.framesDecodeCount>a.framesDecodeCount))}static isRemoteAudioFreeze(n){return!!n&&n._isFreeze()}isLocalVideoFreeze(n){return!(!n.inputFrame||!n.sentFrame)&&n.inputFrame.frameRate>5&&n.sentFrame.frameRate<3}updateLocalStats(n){Array.from(this.localStats.entries()).forEach(r=>{let[a,l]=r;switch(a){case ne.LocalVideoTrack:case ne.LocalVideoLowTrack:{const h=l,p=Vd({},mE),m=n.getStats(),_=n.getLocalMedia(a);if(m){const E=m.videoSend.find(v=>v.ssrc===_?.ssrcs[0].ssrcId);if(E){const v=n.getLocalVideoSize(),b=n.getEncoderConfig(ne.LocalVideoTrack);"H264"!==E.codec&&"H265"!==E.codec&&"VP8"!==E.codec&&"VP9"!==E.codec&&"AV1X"!==E.codec&&"AV1"!==E.codec||(p.codecType=E.codec),p.sendBytes=E.bytes,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0,E.inputFrame?(p.captureFrameRate=E.inputFrame.frameRate,p.captureResolutionHeight=E.inputFrame.height,p.captureResolutionWidth=E.inputFrame.width):v&&(p.captureResolutionWidth=v.width,p.captureResolutionHeight=v.height),E.sentFrame?(p.sendFrameRate=E.sentFrame.frameRate,p.sendResolutionHeight=E.sentFrame.height,p.sendResolutionWidth=E.sentFrame.width):v&&(p.sendResolutionWidth=v.width,p.sendResolutionHeight=v.height),E.avgEncodeMs&&(p.encodeDelay=E.avgEncodeMs),b&&b.bitrateMax&&(p.targetSendBitrate=1e3*b.bitrateMax),p.sendPackets=E.packets,p.sendPacketsLost=E.packetsLost,p.sendJitterMs=E.jitterMs,p.sendRttMs=E.rttMs,p.totalDuration=h?h.totalDuration+1:1,p.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(E)&&(p.totalFreezeTime+=1),E.scalabilityMode&&this.scalabilityMode!==E.scalabilityMode&&(w.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(E.scalabilityMode)),this.scalabilityMode=E.scalabilityMode)}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(a,p),(h?.sendResolutionWidth!==p.sendResolutionWidth||h?.sendResolutionHeight!==p.sendResolutionHeight)&&(null===(d=this.onStatsChanged)||void 0===d||d.call(this,"resolution",{width:p.sendResolutionWidth,height:p.sendResolutionHeight})),p&&_&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,_.track,p);break}case ne.LocalAudioTrack:{const h=l,p=Vd({},aC),m=n.getStats(),_=n.getLocalMedia(a);if(m){const E=m.audioSend.find(v=>v.ssrc===_?.ssrcs[0].ssrcId);if(E){if("opus"!==E.codec&&"aac"!==E.codec&&"PCMU"!==E.codec&&"PCMA"!==E.codec&&"G722"!==E.codec||(p.codecType=E.codec),E.inputLevel)p.sendVolumeLevel=Math.round(32767*E.inputLevel);else{const v=n.getLocalAudioVolume();v&&(p.sendVolumeLevel=Math.round(32767*v))}p.sendBytes=E.bytes,p.sendPackets=E.packets,p.sendPacketsLost=E.packetsLost,p.sendJitterMs=E.jitterMs,p.sendRttMs=E.rttMs,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0}}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ne.LocalAudioTrack,p),p&&_&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,_.track,p);break}}})}updateRemoteStats(n){Array.from(this.remoteStats.entries()).forEach(r=>{let[a,{videoStats:l,audioStats:d,videoPcStats:h}]=r;const p=d,m=l,_=h,E=Vd({},Qo),v=Vd({},jD),b=Vd({},dL),{audioTrack:T,videoTrack:O,audioSSRC:P,videoSSRC:D}=n.getRemoteMedia(a),L=n.getStats(),V=L?.audioRecv.find(se=>se.ssrc===P),U=L?.videoRecv.find(se=>se.ssrc===D),J=this.trafficStats&&this.trafficStats.peer_delay.find(se=>se.peer_uid===a);if(V&&("opus"!==V.codec&&"aac"!==V.codec&&"PCMU"!==V.codec&&"PCMA"!==V.codec&&"G722"!==V.codec||(E.codecType=V.codec),V.outputLevel?E.receiveLevel=Math.round(32767*V.outputLevel):T&&(E.receiveLevel=Math.round(32767*T.getVolumeLevel())),E.receiveBytes=V.bytes,E.receivePackets=V.packets,E.receivePacketsLost=V.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.receiveBitrate=p?8*Math.max(0,E.receiveBytes-p.receiveBytes):0,E.totalDuration=p?p.totalDuration+1:1,E.totalFreezeTime=p?p.totalFreezeTime:0,E.freezeRate=E.totalFreezeTime/E.totalDuration,E.receiveDelay=V.jitterBufferMs,E.totalDuration>10&&Oh.isRemoteAudioFreeze(T)&&(E.totalFreezeTime+=1)),U){"H264"!==U.codec&&"H265"!==U.codec&&"VP8"!==U.codec&&"VP9"!==U.codec&&"AV1X"!==U.codec&&"AV1"!==U.codec||(v.codecType=U.codec),v.receiveBytes=U.bytes,v.receiveBitrate=m?8*Math.max(0,v.receiveBytes-m.receiveBytes):0,v.decodeFrameRate=U.decodeFrameRate<0?0:U.decodeFrameRate,v.renderFrameRate=U.decodeFrameRate<0?0:U.decodeFrameRate,U.outputFrame&&(v.renderFrameRate=U.outputFrame.frameRate),U.receivedFrame?(v.receiveFrameRate=U.receivedFrame.frameRate,v.receiveResolutionHeight=U.receivedFrame.height,v.receiveResolutionWidth=U.receivedFrame.width):O&&(v.receiveResolutionHeight=O._videoHeight||0,v.receiveResolutionWidth=O._videoWidth||0),void 0!==U.framesRateFirefox&&(v.receiveFrameRate=Math.round(U.framesRateFirefox)),v.receivePackets=U.packets,v.receivePacketsLost=U.packetsLost,v.packetLossRate=v.receivePacketsLost/(v.receivePackets+v.receivePacketsLost),v.totalDuration=m?m.totalDuration+1:1,v.totalFreezeTime=m?m.totalFreezeTime:0,v.receiveDelay=U.jitterBufferMs||0;const se=!!D&&n.getRemoteVideoIsReady(D);O&&se&&Oh.isRemoteVideoFreeze(O,U,_)&&(v.totalFreezeTime+=1),v.freezeRate=v.totalFreezeTime/v.totalDuration}J&&(E.end2EndDelay=J.B_ad,v.end2EndDelay=J.B_vd,E.transportDelay=J.B_ed,v.transportDelay=J.B_ed,E.currentPacketLossRate=J.B_ealr4/100,v.currentPacketLossRate=J.B_evlr4/100,b.uplinkNetworkQuality=J.B_punq?J.B_punq:0,b.downlinkNetworkQuality=J.B_pdnq?J.B_pdnq:0),this.remoteStats.set(a,{audioStats:E,videoStats:v,videoPcStats:U,networkStats:b}),T&&this.exceptionMonitor.setRemoteAudioStats(T,E),O&&this.exceptionMonitor.setRemoteVideoStats(O,v)})}}function XO(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function $C(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?XO(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):XO(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function $E(s){return s.match(/^[\.\:\d]+$/)?"".concat(s.replace(/[^\d]/g,"-"),".").concat(j("TURN_DOMAIN")):(w.info("Cannot recognized as IP address ".concat(s,". Used As Host instead")),s)}function qf(s,n){var r,a;const l=j("GATEWAY_DOMAINS");let d=l[1]&&-1!==n.indexOf(l[1])?1:0;s.addresses=s.addresses||[];const h=s.addresses.map(m=>m.domain_prefix?{address:"".concat(m.domain_prefix,".").concat(l[d++%l.length],":").concat(m.port)}:m.ip.match(/^[\.\:\d]+$/)?{ip:m.ip,port:m.port,address:"".concat(m.ip.replace(/[^\d]/g,"-"),".").concat(l[d++%l.length],":").concat(m.port)}:(w.info("Cannot recognized as IP address ".concat(m.ip,". Used As Host instead")),{ip:m.ip,port:m.port,address:"".concat(m.ip,":").concat(m.port)}));if(null!==(r=s.detail)&&void 0!==r&&r[18]&&"string"==typeof(null===(a=s.detail)||void 0===a?void 0:a[18])){const m=s.detail[18],_=m?.split(";");for(let E=0;E<_.length;E++){var p;const v=UD(p=_[E]).call(p);h[E]&&v&&(h[E].ip6=v)}}return{gatewayAddrs:h,uid:s.uid,cid:s.cid,cert:s.cert,vid:s.detail&&s.detail[8],uni_lbs_ip:s.detail&&s.detail[1],res:s,csIp:s.detail&&s.detail[502]}}function Sr(s){return"number"==typeof s?s:s.exact||s.ideal||s.max||s.min||0}function Bd(s){const n=s._encoderConfig;if(!n)return{};const r={resolution:n.width&&n.height?"".concat(Sr(n.width),"x").concat(Sr(n.height)):void 0,maxVideoBW:n.bitrateMax,minVideoBW:n.bitrateMin};return"number"==typeof n.frameRate?(r.maxFrameRate=n.frameRate,r.minFrameRate=n.frameRate):n.frameRate&&(r.maxFrameRate=n.frameRate.max||n.frameRate.ideal||n.frameRate.exact||n.frameRate.min,r.minFrameRate=n.frameRate.min||n.frameRate.ideal||n.frameRate.exact||n.frameRate.max),r}function os(s){const n={connectionType:0,googRtt:s.rtt};switch(s.selectedCandidatePair.localCandidate.candidateType){case"relay":{const r=s.selectedCandidatePair.localCandidate.relayProtocol;"udp"===r&&(n.connectionType=1),"tcp"===r&&(n.connectionType=3),"tls"===r&&(n.connectionType=4);break}case"srflx":n.connectionType=2}return n}function XE(s){return s>=0&&s<.17?1:s>=.17&&s<.36?2:s>=.36&&s<.59?3:s>=.59&&s<=1?4:s>1?5:0}function JO(s,n){let r,a,l;switch(n){case $n.CHOOSE_SERVER:a=4096,l="choose server";break;case $n.CLOUD_PROXY:a=1048576,l="proxy";break;case $n.CLOUD_PROXY_5:a=4194304,l="proxy5";break;case $n.CLOUD_PROXY_FALLBACK:a=4194310,l="proxy fallback";break;default:throw new W(M.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:s.detail&&s.detail[502],retry:!1})}if(s.response_body.forEach(d=>{d.buffer&&d.buffer.flag===a&&(r={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>$C($C({},h),{},{ticket:d.buffer.cert})),server_ts:s.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:$C($C({},d.buffer.detail),s.detail),flag:d.buffer.flag,opid:s.opid,cert:d.buffer.cert})}),!r)throw new W(M.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(l," from multi unilbs response"),{csIp:s.detail&&s.detail[502]});return r}function zV(s,n){return QO.apply(this,arguments)}function QO(){return QO=x(function*(s,n){return yield z.all(s.addresses.map(function(){var r=x(function*(a){return{address:$E(a.ip),tcpport:a.port,udpport:a.port,username:n&&j("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?n.toString():Eo.username,password:n&&j("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?yield mS(n.toString()):Eo.password}});return function(a){return r.apply(this,arguments)}}()))}),QO.apply(this,arguments)}function XC(s,n){const r=n._videoHeight||n.getMediaStreamTrack(!0).getSettings().height;return r?Math.max(r/Sr(s.height),1):(w.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Al(s){let{candidateType:n,relayProtocol:r,type:a,address:l,port:d,protocol:h}=s;return"local-candidate"===a?{candidateType:n,relayProtocol:r,protocol:h}:{candidateType:n,relayProtocol:r,address:l,port:d,protocol:h}}function JC(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}class $L extends qt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(n){var r;ye(r=["tryNext","recover"]).call(r,n)&&this.resetReconnectCount(n),this._reconnectMode=n}get state(){return this._state}set state(n){n!==this._state&&(this._state=n,"reconnecting"===this._state?this.emit(En.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(En.CONNECTED):"closed"===this._state?this.emit(En.CLOSED):"failed"===this._state&&this.emit(En.FAILED))}constructor(n,r,a,l){super(),C(this,"connectionID",0),C(this,"currentURLIndex",0),C(this,"reconnectReason",void 0),C(this,"_reconnectMode","tryNext"),C(this,"_name",void 0),C(this,"_state","closed"),C(this,"_retryConfig",void 0),C(this,"_reconnectCount",0),C(this,"_forceCloseTimeout",5e3),C(this,"_onlineReconnectListener",void 0),C(this,"_closeEstablishingTransmitter",()=>{}),C(this,"_store",void 0),C(this,"_joinChannelServiceRecordIndex",void 0),C(this,"_useCompress",void 0),C(this,"_inflateLength",0),C(this,"_deflateLength",0),this._store=l,this._name=n,this._retryConfig=function(d){for(var h=1;h<arguments.length;h++){var p=null!=arguments[h]?arguments[h]:{};h%2?JC(Object(p),!0).forEach(function(m){C(d,m,p[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(p)):JC(Object(p)).forEach(function(m){Object.defineProperty(d,m,Object.getOwnPropertyDescriptor(p,m))})}return d}({},r),this._useCompress=a}resetReconnectCount(n){w.debug("".concat(this._name," reset reconnect count, reason: ").concat(n)),this._reconnectCount=0}close(n,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const a=this._transmitter;r?setTimeout(()=>a.close(),500):a.close(),this._transmitter=void 0}this.state=n?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(n,r){if(!this._transmitter)return void w.warning("[".concat(this._name,"] can not reconnect, no websocket"));var a;void 0!==n&&(this.reconnectMode=n),w.debug("[".concat(this._name,"] reconnect is triggered initiative")),"number"==typeof this._joinChannelServiceRecordIndex&&(null===(a=this._store)||void 0===a||a.recordJoinChannelService({status:"error",errors:[new Error(r)]},this._joinChannelServiceRecordIndex));const l=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),l&&l.bind(this._transmitter)({code:9999,reason:r})}getInflateData(){const n=this._inflateLength,r=this._deflateLength;return this.clearInflateData(),{inflateLength:n,deflateLength:r}}setInflateData(n){this._deflateLength=this._deflateLength+n.originLength,this._inflateLength=this._inflateLength+n.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}var ss;!function(s){s[s.Default=0]="Default",s[s.Ack=1]="Ack"}(ss||(ss={}));class qV{constructor(n,r,a){C(this,"version",1),C(this,"initialRTO",void 0),C(this,"maxBatchAckCount",void 0),C(this,"maxRTO",void 0),C(this,"initialRTT",void 0),C(this,"ID",void 0),C(this,"rtt",void 0),C(this,"packetNumber",1),C(this,"rtoRatioMap",new Map),C(this,"timeoutMap",new Map),C(this,"unorderedPacketQueue",[]),C(this,"batchAckPacketQueue",[]),C(this,"lastOrderedPacketNumber",0),C(this,"batchAckTimer",void 0),C(this,"sendImpl",void 0),C(this,"receiveImpl",void 0),this.sendImpl=n,this.receiveImpl=r,this.ID=Fe(7,"transmitter-"),this.initialRTO=void 0!==a?.initialRTO?a.initialRTO:j("TRANSMITTER_INITIAL_RTO"),this.initialRTT=void 0!==a?.initialRTT?a.initialRTT:j("TRANSMITTER_INITIAL_RTT"),this.rtt=void 0!==a?.initialRTT?a.initialRTT:j("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=void 0!==a?.maxBatchAckCount?a.maxBatchAckCount:j("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=void 0!==a?.maxRTO?a.maxRTO:j("TRANSMITTER_MAX_RTO")}packetize(n,r){return{type:ss.Default,version:this.version,packetNumber:r,payload:n}}serialize(n){switch(n.type){case ss.Default:{let r;r="string"==typeof n.payload?(new TextEncoder).encode(n.payload):n.payload;const a=new ArrayBuffer(r.length+15),l=new DataView(a);return l.setUint16(0,n.version),l.setUint8(2,n.type),l.setUint32(3,n.packetNumber),hS(l,7,BigInt(n.sendTs)),new Uint8Array(l.buffer).set(r,15),a}case ss.Ack:{const r=new ArrayBuffer(16),a=new DataView(r);return a.setUint16(0,n.version),a.setUint8(2,n.type),a.setUint32(3,n.maxAckPacketNumber),a.setUint8(7,n.shift),hS(a,8,BigInt(n.ackSendTs)),r}}}deserialize(n){const r=new DataView(n),a=r.getUint16(0),l=r.getUint8(2);switch(l){case ss.Default:{const d=r.getUint32(3),h=uS(r,7),p=n.slice(15),m=(new TextDecoder).decode(p);return{version:a,type:l,packetNumber:d,sendTs:Number(h),payload:m}}case ss.Ack:{const d=r.getUint32(3),h=r.getUint8(7),p=uS(r,8);return{version:a,type:l,maxAckPacketNumber:d,shift:h,ackSendTs:Number(p)}}default:throw w.error("[".concat(this.ID,"] Unrecognized packet type ").concat(l)),new Error("Unrecognized packet type ".concat(l))}}sendMessage(n){const r=this.packetize(n,this.packetNumber);this.packetNumber=4294967295===this.packetNumber?1:this.packetNumber+1;const a=this.calculateRTO(r),l=window.setTimeout(()=>{this.resendMessage(r)},a);this.timeoutMap.set(r.packetNumber,l),this.sendPacket(r)}onData(n){const r=this.deserialize(n);r.type===ss.Default?this.ack(r):r.type===ss.Ack&&(this.updateRTT(r,Math.round(performance.now())),this.clearRTO(r))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(n=>{let[r,a]=n;window.clearTimeout(a)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,void 0!==this.batchAckTimer&&window.clearTimeout(this.batchAckTimer)}resendMessage(n){const r=this.calculateRTO(n),a=window.setTimeout(()=>{this.resendMessage(n)},r);this.timeoutMap.set(n.packetNumber,a),this.sendPacket(n)}calculateRTO(n){const r=this.rtoRatioMap.get(n.packetNumber);if(void 0===r)return this.rtoRatioMap.set(n.packetNumber,1),this.initialRTO;{const a=9*this.rtt/8*r;return this.rtoRatioMap.set(n.packetNumber,r+1),a>this.maxRTO?this.maxRTO:a}}updateRTT(n,r){this.rtt=this.rtt*(7/8)+(r-n.ackSendTs-this.rtt)/8}ack(n){if(n.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(n):(this.batchAckPacketQueue.push(n),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(n.payload);;){const r=this.unorderedPacketQueue[0];if(!r){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(r.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else n.packetNumber<=this.lastOrderedPacketNumber?this.sendPacket({ackSendTs:n.sendTs,maxAckPacketNumber:n.packetNumber,shift:0,type:ss.Ack,version:this.version}):n.packetNumber>this.lastOrderedPacketNumber&&(this.unorderedPacketQueue[n.packetNumber-this.lastOrderedPacketNumber-2]=n,this.sendPacket({ackSendTs:n.sendTs,maxAckPacketNumber:n.packetNumber,shift:0,type:ss.Ack,version:this.version}))}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0,this.sendPacket({ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:ss.Ack,version:this.version}),this.batchAckPacketQueue=[]}sendPacket(n){n.type===ss.Default&&(n.sendTs=Math.round(performance.now()));const r=this.serialize(n);this.sendImpl(r)}clearRTO(n){for(let r=n.maxAckPacketNumber-n.shift;r<=n.maxAckPacketNumber;r++){const a=this.timeoutMap.get(r);void 0!==a&&window.clearTimeout(a),this.timeoutMap.delete(r),this.rtoRatioMap.delete(r)}}}class as extends $L{constructor(n,r){super(n,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0),C(this,"_initMutex",void 0),C(this,"_reconnectInterrupter",void 0),C(this,"_url",void 0),C(this,"_transmitter",void 0),C(this,"_addresses",void 0),C(this,"_reliableTransmission",void 0),this._initMutex=new Zn("datachannel");const{timeout:a,timeoutFactor:l}=r,d=Math.max(300,Math.floor(3*a/5)),h=Math.max(1.2,Math.floor(8*l)/10);Yi.ONLINE&&(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h),on.on(lc.NETWORK_STATE_CHANGE,(p,m)=>{p!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(p)),p===Yi.ONLINE?(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h):(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=l))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}init(n){var r=arguments,a=this;return x(function*(){a._forceCloseTimeout=r.length>1&&void 0!==r[1]?r[1]:5e3;return a._initMutex.lock().then(h=>new z((p,m)=>{((h,p)=>{a._addresses=n,a.currentURLIndex=a._addresses.findIndex(_=>_.fingerprint||j("FINGERPRINT"));const m=a._addresses[a.currentURLIndex];a.state="connecting",a.createTransmitterConnection(m).then(h).catch(p),a.once(En.CLOSED,()=>p(new W(M.WS_DISCONNECT))),a.once(En.CONNECTED,()=>h())})(p,m)}).then(()=>{h()}).catch(()=>{h()}))})()}sendMessage(n){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new W(M.WS_ABORT,"datachannel is not ready");try{r||(n=JSON.stringify(n)),this._reliableTransmission.sendMessage(n)}catch(a){throw new W(M.WS_ERR,"send datachannel signal message error"+a.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(n){const r=JSON.stringify(n);return{compressed:r,compressedLength:r.length,origin:n}}sendMessageWithUint8Array(n){return{compressed:n,compressedLength:n.byteLength,origin:n}}createTransmitterConnection(n){var r=this;return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(n.ip,":").concat(n.port),new z((a,l)=>{var d;const h=()=>{w.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a()},p=function(){var v=x(function*(b){var T;if(null===(T=r._closeEstablishingTransmitter)||void 0===T||T.call(r),w.debug("[".concat(r._name,"] datachannel close ").concat(r._url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(r.reconnectMode)),r._reconnectCount<r._retryConfig.maxRetryCount){"connected"===r.state&&(r.reconnectReason=b.reason,r.state="reconnecting");const O=_r(r,En.WILL_RECONNECT,r.reconnectMode)||r.reconnectMode,P=yield r.reconnectWithAction(O);if("closed"===r.state)return void w.debug("[".concat(r.connectionID,"] dc is closed, no need to reconnect"));if(!P)return l(new W(M.WS_DISCONNECT,"datachannel reconnect failed: ".concat(b.code))),void r.close(!0);a()}else l(new W(M.WS_DISCONNECT,"datachannel close: ".concat(b.code))),r.close()});return function(T){return v.apply(this,arguments)}}(),m=v=>{var b;null===(b=this._reliableTransmission)||void 0===b||b.onData(v.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),w.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(n)));const _=null===(d=this._store)||void 0===d?void 0:d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),E=Date.now();Qt(this,En.TO_CONNECT_DATACHANNEL,n).then(v=>{var b,T;if(!v)throw new Error("transmissonInfo not exist yet");const{transmitter:O,close:P}=v;this._transmitter=O,null===(b=this._store)||void 0===b||b.signalChannelOpen();const D=Date.now()-E;w.debug("[choose dc] dc open cost ".concat(D,"ms")),this._reliableTransmission=new qV(L=>{var V;this._transmitter&&"open"===this._transmitter.readyState&&(null===(V=this._transmitter)||void 0===V||V.send(L))},L=>{"string"==typeof L&&this.emit(En.ON_MESSAGE,L)}),this._closeEstablishingTransmitter=()=>{var L;null===(L=this._reliableTransmission)||void 0===L||L.close(),this._reliableTransmission=void 0,P()},h&&h(),O.onclose=p,O.onmessage=m,null===(T=this._store)||void 0===T||T.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this._joinChannelServiceRecordIndex=_}).catch(v=>{var b;if(null===(b=this._store)||void 0===b||b.recordJoinChannelService({endTs:Date.now(),status:v instanceof W&&v.code===M.WS_ABORT?"aborted":"error",errors:[v]},_),"closed"!==this.state){if(v instanceof W&&v.code===M.WS_ERR){const T=new W(M.WS_ERR,"init datachannel failed! Error: ".concat(v.toString()));return w.error("[".concat(this._name,"]").concat(T)),void l(T)}p&&p(v)}else l(new W(M.WS_DISCONNECT,"datachannel is closed: ".concat(v.toString())))})})}reconnectWithAction(n){var r=arguments,a=this;return x(function*(){let l=!(r.length>1&&void 0!==r[1])||r[1];if(a._reconnectCount>=a._retryConfig.maxRetryCount||!a._addresses||"closed"===a.state)return!1;a._onlineReconnectListener||on.networkState!==Yi.OFFLINE||(a._onlineReconnectListener=on.onlineWaiter&&on.onlineWaiter.then(()=>{a._onlineReconnectListener=void 0}));let d=!0;if(a._reconnectInterrupter=()=>{d=!1},l){const _=wt(a._reconnectCount,a._retryConfig);w.debug("[".concat(a._name,"] wait ").concat(_,"ms to reconnect datachannel, mode: ").concat(n)),yield z.race([gi(_),a._onlineReconnectListener||new z(()=>{})])}if("closed"===a.state||!d)return!1;a._reconnectCount+=1;const h=function(){var _=x(function*(E,v){a.emit(En.RECONNECT_CREATE_CONNECTION,v),yield a.createTransmitterConnection(E)});return function(v,b){return _.apply(this,arguments)}}();try{if("retry"===n){const _=a._addresses[a.currentURLIndex];a.emit(En.RECONNECT_WAITTING_FINISH,n),yield h(_,n)}else if("tryNext"===n){a.currentURLIndex+=1;for(let E=a.currentURLIndex;E<a._addresses.length;E++){if(a._addresses[E].fingerprint||j("FINGERPRINT")){a.currentURLIndex=E;break}a.currentURLIndex+=1}if(a.currentURLIndex>=a._addresses.length)return w.debug("[".concat(a._name,"] the available addresses are exhausted, change to recover")),yield a.reconnectWithAction("recover",!1);w.debug("[".concat(a._name,"] datachannel url length: ").concat(a._addresses.length," current index: ").concat(a.currentURLIndex));const _=a._addresses[a.currentURLIndex];a.emit(En.RECONNECT_WAITTING_FINISH,n),yield h(_,n)}else"recover"===n&&(w.debug("[".concat(a._name,"] start to failback to websocket")),a.resetReconnectCount("recover mode"),a.emit(En.RECONNECT_WAITTING_FINISH,n),a.emit(En.FAILBACK));return!0}catch(_){var p,m;return w.error("[".concat(a._name,"] reconnect failed"),_.toString()),null!=_&&null!==(p=_.data)&&void 0!==p&&p.desc&&Array.isArray(_.data.desc)&&_.data.desc.length&&ye(m=_.data.desc).call(m,"dynamic key expired")?(a.emit(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):yield a.reconnectWithAction(n,l)}})()}}class ta extends qt{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===Ke.CONNECTED?this.emit(he.WS_CONNECTED):n===Ke.RECONNECTING?this.emit(he.WS_RECONNECTING,this._websocketReconnectReason):n===Ke.CLOSED&&this.emit(he.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(n,r){super(),C(this,"_disconnectedReason",void 0),C(this,"_websocketReconnectReason",void 0),C(this,"_connectionState",Ke.CLOSED),C(this,"reconnectToken",void 0),C(this,"websocket",void 0),C(this,"openConnectionTime",void 0),C(this,"clientId",void 0),C(this,"lastMsgTime",Date.now()),C(this,"uploadCache",[]),C(this,"uploadCacheInterval",void 0),C(this,"rttRolling",new tn(5)),C(this,"pingpongTimer",void 0),C(this,"inflateDataTimer",void 0),C(this,"pingpongTimeoutCount",0),C(this,"joinResponse",void 0),C(this,"multiIpOption",void 0),C(this,"initError",void 0),C(this,"spec",void 0),C(this,"store",void 0),C(this,"onWebsocketMessage",a=>{if(a instanceof ArrayBuffer)return void this.emit(he.ON_BINARY_DATA,a);const l=JSON.parse(a);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(l,"_id")){const d="res-@".concat(l._id);this.emit(d,l._result,l._message)}else if(Object.prototype.hasOwnProperty.call(l,"_type")&&(this.emit(l._type,l._message),l._type===Ue.ON_NOTIFICATION&&this.handleNotification(l._message),l._type===Ue.ON_USER_BANNED))switch(l._message.error_code){case 14:this.close(Ye.UID_BANNED);break;case 15:this.close(Ye.IP_BANNED);break;case 16:this.close(Ye.CHANNEL_BANNED)}}),this.clientId=n.clientId,this.spec=n,this.store=r,this.websocket=new as("gateway-".concat(this.clientId),this.spec.retryConfig,!0,r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ke.CONNECTED&&this.reconnect("retry",vs.OFFLINE)})}request(n,r,a,l){var d=this;return x(function*(){const h=Fe(6,""),p={_id:h,_type:n,_message:r},m=d.websocket.connectionID,_=()=>new z((P,D)=>{if(d.connectionState===Ke.CONNECTED)return P();const L=()=>{d.off(he.WS_CLOSED,V),P()},V=()=>{d.off(he.WS_CONNECTED,L),D(new W(M.WS_ABORT))};d.once(he.WS_CONNECTED,L),d.once(he.WS_CLOSED,V),n!==Ce.PUBLISH&&n!==Ce.SUBSCRIBE&&n!==Ce.UNSUBSCRIBE&&n!==Ce.UNPUBLISH&&n!==Ce.CONTROL&&n!==Ce.RESTART_ICE||d.once(he.DISCONNECT_P2P,()=>{D(new W(M.DISCONNECT_P2P))}),n!==Ce.PUBLISH&&n!==Ce.RESTART_ICE||d.once(he.ABORT_P2P_EXECUTION,()=>{D(new W(M.DISCONNECT_P2P))})});if(d.connectionState!==Ke.CONNECTING&&d.connectionState!==Ke.RECONNECTING||n===Ce.JOIN||n===Ce.REJOIN||(yield _()),n===Ce.LEAVE&&(d.websocket.unbindDcCloseEventListener(),l=!0),d.websocket.sendMessage(p,!0,!1),l)return;const E=new z((P,D)=>{let L=!1;const V=(J,se)=>{L=!0,P({isSuccess:"success"===J,message:se||{}}),d.off(he.WS_CLOSED,U),d.off(he.WS_RECONNECTING,U),d.emit(he.REQUEST_SUCCESS,n,r)};d.once("res-@".concat(h),V);const U=()=>{D(new W(M.WS_ABORT,"type: ".concat(n))),d.off(he.WS_CLOSED,U),d.off(he.WS_RECONNECTING,U),d.off("res-@".concat(h),V)};d.once(he.WS_CLOSED,U),d.once(he.WS_RECONNECTING,U),gi(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||L||(w.warning("dc request timeout, type: ".concat(n)),d.emit(he.REQUEST_TIMEOUT,n,r))})});let v=null;try{v=yield E}catch(P){if(d.connectionState===Ke.CLOSED||n===Ce.LEAVE)throw new W(M.WS_ABORT);return!d.spec.forceWaitGatewayResponse||a?P.throw():n===Ce.JOIN||n===Ce.REJOIN?null:(yield _(),yield d.request(n,r))}if(v.isSuccess)return v.message;const b=Number(v.message.error_code||v.message.code),T=_l(b),O=new W(M.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(v.message.error_str),{code:b,data:v.message});return"success"===T.action?v.message:(w.warning("[".concat(d.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(b,", message: ").concat(T.desc,", action: ").concat(T.action)),b===Ie.ERR_TOO_MANY_BROADCASTERS?((n===Ce.JOIN||n===Ce.REJOIN)&&(d.initError=O,d.close()),O.throw()):"failed"===T.action?O.throw():"quit"===T.action?(d.initError=O,d.close(),O.throw()):(b===Ie.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=v.message.option,w.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",vs.MULTI_IP)):d.reconnect(T.action,vs.SERVER_ERROR),n===Ce.JOIN||n===Ce.REJOIN?null:yield d.request(n,r)))})()}waitMessage(n,r){return new z(a=>{const l=d=>{(!r||r(d))&&(this.off(n,l),a(d))};this.on(n,l)})}upload(n,r){const a={_type:n,_message:r};try{this.websocket.sendMessage(a)}catch{const d=j("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ke.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},j("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,r){this.websocket.sendMessage({_type:n,_message:r})}init(n,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new z((a,l)=>{this.once(he.WS_CONNECTED,()=>a(this.joinResponse)),this.once(he.WS_CLOSED,()=>l(this.initError||new W(M.WS_ABORT))),this.connectionState=Ke.CONNECTING,this.websocket.init(n).catch(l),this.websocket.once(En.FAILBACK,()=>{void 0===this.openConnectionTime&&l(new W(M.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{r&&void 0===this.openConnectionTime&&(w.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),l(new W(M.INIT_DATACHANNEL_TIMEOUT)))},j("DC_JOIN_WITH_FAILBACK"))})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||Ye.LEAVE,this.connectionState=Ke.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),n===Ye.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new as("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}join(){var n=this;return x(function*(){if(!n.joinResponse){n.emit(he.ABORT_P2P_EXECUTION);const r=yield Qt(n,he.DATACHANNEL_CONNECTING),a=yield n.request(Ce.JOIN,r);if(!a)return n.emit(he.REPORT_JOIN_GATEWAY,M.TIMEOUT,n.url||""),!1;n.joinResponse=a,n.emit(he.JOIN_RESPONSE,n.joinResponse),n.reconnectToken=n.joinResponse.rejoin_token}return n.connectionState=Ke.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),!0})()}rejoin(){var n=this;return x(function*(){if(!n.reconnectToken)throw new W(M.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=dc(n,he.REQUEST_REJOIN_INFO);r.token=n.reconnectToken;const a=yield n.request(Ce.REJOIN,r);return!!a&&(n.connectionState=Ke.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),a.peers&&a.peers.forEach(l=>{n.emit(Ue.ON_USER_ONLINE,{uid:l.uid}),l.audio&&n.emit(Ue.ON_ADD_AUDIO_STREAM,{uid:l.uid,uint_id:l.uint_id,audio:!0,ssrcId:l.audio_ssrc}),l.video&&n.emit(Ue.ON_ADD_VIDEO_STREAM,{uid:l.uid,uint_id:l.uint_id,video:!0,ssrcId:l.video_ssrc}),n.emit(l.audio_mute?Ue.MUTE_AUDIO:Ue.UNMUTE_AUDIO,{uid:l.uid}),n.emit(l.video_mute?Ue.MUTE_VIDEO:Ue.UNMUTE_VIDEO,{uid:l.uid}),n.emit(l.audio_enable_local?Ue.ENABLE_LOCAL_AUDIO:Ue.DISABLE_LOCAL_AUDIO,{uid:l.uid}),n.emit(l.video_enable_local?Ue.ENABLE_LOCAL_VIDEO:Ue.DISABLE_LOCAL_VIDEO,{uid:l.uid}),l.audio||l.video||n.emit(Ue.ON_REMOVE_STREAM,{uid:l.uid,uint_id:l.uint_id})}),!0)})()}reconnect(n,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,r)}handleNotification(n){w.debug("[".concat(this.clientId,"] receive notification: "),n);const r=_l(n.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close(Ye.UID_BANNED),void this.close()):void this.reconnect(r.action,vs.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=j("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=n&&(w.warning("PINGPONG Timeout. Last Socket Message: ".concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>j("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",vs.TIMEOUT):this.request(Ce.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),j("REPORT_STATS")&&this.send(Ce.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleInflateData(){const{inflateLength:n,deflateLength:r}=this.websocket.getInflateData();0!==n&&0!==r&&this.upload(Xi.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:n})}handleWebsocketEvents(){var n=this;this.websocket.on(En.RECONNECT_WAITTING_FINISH,r=>{this.emit(he.WS_RECONNECT_WAITTING_FINISH,r)}),this.websocket.on(En.RECONNECT_CREATE_CONNECTION,r=>{this.emit(he.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(En.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(En.CLOSED,()=>{this.connectionState=Ke.CLOSED}),this.websocket.on(En.FAILED,()=>{this._disconnectedReason=Ye.NETWORK_ERROR,this.connectionState=Ke.CLOSED}),this.websocket.on(En.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState=this.connectionState===Ke.CONNECTED?Ke.RECONNECTING:Ke.CONNECTING}),this.websocket.on(En.WILL_RECONNECT,(r,a)=>{if(dc(this,he.IS_P2P_DISCONNECTED)&&"retry"===r)return w.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P),a("tryNext");"retry"!==r&&(w.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P)),a(r)}),this.websocket.on(En.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{w.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",vs.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(he.REPORT_JOIN_GATEWAY,r.message||r.code,this.url||""),r instanceof W&&r.code===M.UNEXPECTED_RESPONSE&&r.data.code===Ie.ERR_NO_AUTHORIZED)return w.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",vs.SERVER_ERROR);w.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",vs.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(En.REQUEST_NEW_URLS,(r,a)=>{Qt(this,he.REQUEST_RECOVER,this.multiIpOption).then(r).catch(a)}),this.websocket.on(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(En.TO_CONNECT_DATACHANNEL,function(){var r=x(function*(a,l,d){return Qt(n,he.DATACHANNEL_PRECONNECT,a).then(l).catch(d)});return function(a,l,d){return r.apply(this,arguments)}}()),this.websocket.on(En.FAILBACK,()=>{void 0!==this.openConnectionTime&&this.emit(he.DATACHANNEL_FAILBACK)})}}class JE extends qt{constructor(n){super(),C(this,"_signal",void 0),C(this,"_sequence",0),C(this,"_userMap",new Map),C(this,"_encoder",new TextEncoder),this._signal=n}send(n,r,a,l,d){var h=this;return x(function*(){var p,m,_;"string"!=typeof r&&(r=JSON.stringify(r)),l=null!==(p=l)&&void 0!==p?p:Fe(6,""),d=null!==(m=d)&&void 0!==m?m:h._sequence++;const E={_id:l,_type:n,_seq:null!==(_=d)&&void 0!==_?_:h._sequence++,_message:r};if(j("SHOW_P2P_LOG")&&w.debug("send message",E),h.sendStreamMessage(JSON.stringify(E)),a)return;const v=new z((T,O)=>{const P=window.setTimeout(()=>{h.off("res-@".concat(l),D),w.warning("[external-signal] request timeout, type: ".concat(n)),O(new X(0===h._userMap.size?M.INVALID_REMOTE_USER:M.TIMEOUT))},j("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),D=(L,V)=>{P&&window.clearTimeout(P),"success"===L?T({isSuccess:!0,message:V}):O(new X(M.UNEXPECTED_ERROR,V))};h.once("res-@".concat(l),D)});let b;try{b=yield v}catch(T){if(T.code===M.TIMEOUT)return yield h.send(n,r,!1,l,d);throw T}return b.isSuccess?b.message:void 0})()}sendStreamMessage(n){this._splitMessage(n).forEach(r=>{this._signal.request(Ce.DATA_STREAM,{payload:oh(this._encoder.encode(r))})})}onMessage(n){const{_uid:r}=n;let a;const l=this._userMap.get(r);if(l?a=l.splitMessageMap:(a=new Map,this._userMap.set(r,{isStart:!1,splitMessageMap:a,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map})),"id"in n&&"total"in n){var d;const{id:h,total:p}=n,m=null!==(d=a.get(h))&&void 0!==d?d:[];if(m.push(n),a.has(h)||a.set(h,m),m.length!==p)return;{const _=Zc(m).call(m,(E,v)=>E.index-v.index).map(E=>E.payload).join("");a.delete(h),(n=JSON.parse(_))._uid=r}}this.handleReceivedMessage(n)}setStart(n){this._userMap.has(n)?this._userMap.get(n).isStart=!0:this._userMap.set(n,{isStart:!0,splitMessageMap:new Map,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map}),this.handleReceivedMessage()}setEnd(n){return this._userMap.delete(n),0===this._userMap.size}ack(n,r,a){this.send(Dt.ACK,JSON.stringify({success:!a,message:r}),!0,n)}handleReceivedMessage(n){const r=()=>{this._userMap.forEach(_=>{const{receivedMessagesMap:E,nextExpectedSequenceNumber:v}=_;for(;E.has(v);){const b=E.get(v);E.delete(v),this.receiveMessage(b),_.nextExpectedSequenceNumber++}})};if(!n)return void r();const{_uid:a,_seq:l}=n,d=this._userMap.get(a),{receivedMessagesMap:h,isStart:p,nextExpectedSequenceNumber:m}=d;l<m?w.debug("[external-signal] receive old message, seq: ".concat(l)):(h.set(l,n),p&&l===m&&(this.receiveMessage(n),h.delete(m),d.nextExpectedSequenceNumber++,r()))}receiveMessage(n){const{_id:r,_type:a,_message:l,_uid:d}=n;if(j("SHOW_P2P_LOG")&&w.debug("\u6536\u5230\u6d88\u606f",n),r)switch(n._type){case Dt.PUBLISH:const h=JSON.parse(l);this._signal.emit(a,h,d),this.ack(n._id);break;case Dt.CONTROL:case Dt.UNPUBLISH:case Dt.DO_SUBSCRIBE:case Dt.DO_UNSUBSCRIBE:{const p=JSON.parse(l);p.uid=d,Qt(this._signal,a,p).then(m=>{this.ack(n._id,m)}).catch(m=>{this.ack(n._id,void 0,!0)});break}case Dt.ACK:{const{success:p,message:m}=JSON.parse(l);this.emit("res-@".concat(r),p?"success":"failed",m);break}case Dt.CALL:Qt(this,a,l).then(p=>{this.ack(r,p)});break;case Dt.RESTART_ICE:case Dt.EXCHANGE_SDP:case Dt.SUBSCRIBE:case Dt.UNSUBSCRIBE:Qt(this._signal,a,l).then(p=>{this.ack(r,p)}).catch(p=>{this.ack(n._id,void 0,!0)});break;case Dt.CANDIDATE:this._signal.emit(a,l),this.ack(r);break;case Dt.JOIN:this.emit(a,JSON.parse(l));break;default:this.emit(a,l),this.ack(r)}}_splitMessage(n){if(n.length<JE.MAX_MESSAGE_SIZE)return[n];const r=[],a=Fe(6,"");let l=0;const d=Math.ceil(n.length/800);for(;n.length>0;){l++;const h=n.slice(0,800);r.push({id:a,index:l,total:d,payload:h}),n=n.slice(800)}return r.map(h=>JSON.stringify(h))}clear(){this._sequence=0,this._userMap.clear()}}C(JE,"MAX_MESSAGE_SIZE",1024);class ZO extends qt{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===Ke.CONNECTED?this.emit(he.WS_CONNECTED):n===Ke.RECONNECTING?this.emit(he.WS_RECONNECTING,this._websocketReconnectReason):n===Ke.CLOSED&&this.emit(he.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,r){super(),C(this,"_disconnectedReason",void 0),C(this,"_websocketReconnectReason",void 0),C(this,"_connectionState",Ke.CLOSED),C(this,"reconnectToken",void 0),C(this,"_userInRoom",!1),C(this,"_userOnlineTime",void 0),C(this,"websocket",void 0),C(this,"openConnectionTime",void 0),C(this,"clientId",void 0),C(this,"lastMsgTime",Date.now()),C(this,"uploadCache",[]),C(this,"uploadCacheInterval",void 0),C(this,"rttRolling",new tn(5)),C(this,"pingpongTimer",void 0),C(this,"wsInflateDataTimer",void 0),C(this,"pingpongTimeoutCount",0),C(this,"joinResponse",void 0),C(this,"multiIpOption",void 0),C(this,"initError",void 0),C(this,"spec",void 0),C(this,"store",void 0),C(this,"_external_signal",void 0),C(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(he.ON_BINARY_DATA,a.data);const l=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(l,"_id")){const d="res-@".concat(l._id);this.emit(d,l._result,l._message)}else if(Object.prototype.hasOwnProperty.call(l,"_type")){switch(l._type){case Ue.ON_DATA_STREAM:return void this.handleDataStream(l._message);case Ue.MUTE_AUDIO:case Ue.MUTE_VIDEO:case Ue.ON_P2P_LOST:return;case Ue.ON_USER_ONLINE:this.emit(l._type,l._message);const{uid:d}=l._message;return this._external_signal.setStart(d),void this._external_signal.send(Dt.JOIN,{onlineTime:this._userOnlineTime},!0)}if(this.emit(l._type,l._message),l._type===Ue.ON_NOTIFICATION&&this.handleNotification(l._message),l._type===Ue.ON_USER_BANNED)switch(l._message.error_code){case 14:this.close(Ye.UID_BANNED);break;case 15:this.close(Ye.IP_BANNED);break;case 16:this.close(Ye.CHANNEL_BANNED)}if(l._type===Ue.ON_USER_LICENSE_BANNED)switch(l._message.error_code){case Ie.ERR_LICENSE_MISSING:this.close(Ye.LICENSE_MISSING);break;case Ie.ERR_LICENSE_EXPIRED:this.close(Ye.LICENSE_EXPIRED);break;case Ie.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ye.LICENSE_MINUTES_EXCEEDED);break;case Ie.ERR_LICENSE_PERIOD_INVALID:this.close(Ye.LICENSE_PERIOD_INVALID);break;case Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ye.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ie.ERR_LICENSE_ILLEGAL:this.close(Ye.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=r,this.websocket=new lE("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ke.CONNECTED&&this.reconnect("retry",Kn.OFFLINE)}),this._external_signal=new JE(this),this._handleSignalP2PEvents()}request(n,r,a,l){var d=this;return x(function*(){const h=Fe(6,""),p={_id:h,_type:n,_message:r},m=d.websocket.connectionID,_=()=>new z((P,D)=>{if(d.connectionState===Ke.CONNECTED)return P();const L=()=>{d.off(he.WS_CLOSED,V),P()},V=()=>{d.off(he.WS_CONNECTED,L),D(new X(M.WS_ABORT))};d.once(he.WS_CONNECTED,L),d.once(he.WS_CLOSED,V),n!==Ce.PUBLISH&&n!==Ce.SUBSCRIBE&&n!==Ce.UNSUBSCRIBE&&n!==Ce.UNPUBLISH&&n!==Ce.CONTROL&&n!==Ce.RESTART_ICE||d.once(he.DISCONNECT_P2P,()=>{D(new X(M.DISCONNECT_P2P))}),n!==Ce.PUBLISH&&n!==Ce.RESTART_ICE||d.once(he.ABORT_P2P_EXECUTION,()=>{D(new X(M.DISCONNECT_P2P))})});if(d.connectionState!==Ke.CONNECTING&&d.connectionState!==Ke.RECONNECTING||n===Ce.JOIN||n===Ce.REJOIN||(yield _()),d.websocket.sendMessage(p,!0),l)return;const E=new z((P,D)=>{let L=!1;const V=(J,se)=>{L=!0,P({isSuccess:"success"===J,message:se||{}}),d.off(he.WS_CLOSED,U),d.off(he.WS_RECONNECTING,U),d.emit(he.REQUEST_SUCCESS,n,r)};d.once("res-@".concat(h),V);const U=()=>{D(new X(M.WS_ABORT,"type: ".concat(n))),d.off(he.WS_CLOSED,U),d.off(he.WS_RECONNECTING,U),d.off("res-@".concat(h),V)};d.once(he.WS_CLOSED,U),d.once(he.WS_RECONNECTING,U),gi(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||L||(w.warning("[".concat(d.clientId,"] ws request timeout, type: ").concat(n)),d.emit(he.REQUEST_TIMEOUT,n,r))})});let v=null;try{v=yield E}catch(P){if(d.connectionState===Ke.CLOSED||n===Ce.LEAVE)throw new X(M.WS_ABORT);return!d.spec.forceWaitGatewayResponse||a?P.throw():n===Ce.JOIN||n===Ce.REJOIN?null:(yield _(),yield d.request(n,r))}if(v.isSuccess)return v.message;const b=Number(v.message.error_code||v.message.code),T=_l(b),O=new X(M.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(v.message.error_str),{code:b,data:v.message});return"success"===T.action?v.message:(w.warning("[".concat(d.clientId,"] [").concat(d.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(b,", message: ").concat(T.desc,", action: ").concat(T.action)),b===Ie.ERR_TOO_MANY_BROADCASTERS?((n===Ce.JOIN||n===Ce.REJOIN)&&(d.initError=O,d.close()),O.throw()):"failed"===T.action?O.throw():"quit"===T.action?(d.initError=O,d.close(),O.throw()):(b===Ie.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=v.message.option,w.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",Kn.MULTI_IP)):d.reconnect(T.action,Kn.SERVER_ERROR),n===Ce.JOIN||n===Ce.REJOIN?null:yield d.request(n,r)))})()}waitMessage(n,r){return new z(a=>{const l=d=>{(!r||r(d))&&(this.off(n,l),a(d))};this.on(n,l)})}upload(n,r){const a={_type:n,_message:r};try{this.websocket.sendMessage(a)}catch{const d=j("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ke.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},j("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,r){this.websocket.sendMessage({_type:n,_message:r})}sendExtensionMessage(n,r,a){var l=this;return x(function*(){return yield l.waitTillUserOnline(),yield l._external_signal.send(n,r,a)})()}init(n,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new z((a,l)=>{this.once(he.WS_CONNECTED,()=>a(this.joinResponse)),this.once(he.WS_CLOSED,()=>l(this.initError||new X(M.WS_ABORT))),this.connectionState=Ke.CONNECTING,this.websocket.init(n).catch(l),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||Ye.LEAVE,this.connectionState=Ke.CLOSED,w.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),n===Ye.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new lE("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}join(){var n=this;return x(function*(){if(!n.joinResponse){n.emit(he.ABORT_P2P_EXECUTION);const r=yield Qt(n,he.REQUEST_JOIN_INFO),a=yield n.request(Ce.JOIN,r);if(!a)return n.emit(he.REPORT_JOIN_GATEWAY,M.TIMEOUT,n.url||""),!1;n.joinResponse=a,n.emit(he.JOIN_RESPONSE,n.joinResponse),n.reconnectToken=n.joinResponse.rejoin_token}return n.connectionState=Ke.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),n._userOnlineTime=(new Date).getTime(),n._external_signal.clear(),!0})()}rejoin(){var n=this;return x(function*(){if(!n.reconnectToken)throw new X(M.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=dc(n,he.REQUEST_REJOIN_INFO);return r.token=n.reconnectToken,!!(yield n.request(Ce.REJOIN,r))&&(n.connectionState=Ke.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),!0)})()}reconnect(n,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,r)}handleDataStream(n){try{var r;const a=jg(n.payload),l=(new TextDecoder).decode(a),d=JSON.parse(l);"total"in d&&"id"in d||ye(r=Object.values(Dt)).call(r,d._type)?(n.seq&&delete n.seq,d._uid=n.uid,this._external_signal.onMessage(d)):this.emit(Ue.ON_DATA_STREAM,n)}catch{}}handleNotification(n){w.debug("[".concat(this.clientId,"] receive notification: "),n);const r=_l(n.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close(Ye.UID_BANNED),void this.close()):void this.reconnect(r.action,Kn.SERVER_ERROR);w.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=j("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=n&&(w.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>j("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Kn.TIMEOUT):this.request(Ce.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),j("REPORT_STATS")&&this.send(Ce.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:n,wsDeflateLength:r}=this.websocket.getWsInflateData();0!==n&&0!==r&&this.upload(Xi.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:n})}handleWebsocketEvents(){this.websocket.on(xe.RECONNECT_WAITTING_FINISH,n=>{this.emit(he.WS_RECONNECT_WAITTING_FINISH,n)}),this.websocket.on(xe.RECONNECT_CREATE_CONNECTION,n=>{this.emit(he.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(xe.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(xe.CLOSED,()=>{this.connectionState=Ke.CLOSED}),this.websocket.on(xe.FAILED,()=>{this._disconnectedReason=Ye.NETWORK_ERROR,this.connectionState=Ke.CLOSED}),this.websocket.on(xe.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState=this.connectionState===Ke.CONNECTED?Ke.RECONNECTING:Ke.CONNECTING}),this.websocket.on(xe.WILL_RECONNECT,(n,r,a)=>{if(dc(this,he.IS_P2P_DISCONNECTED)&&"retry"===n)return w.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P),a("tryNext");"retry"!==n&&(w.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(n)),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P)),a(n)}),this.websocket.on(xe.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(n=>{w.warning("[".concat(this.clientId,"] rejoin failed ").concat(n)),this.reconnect("tryNext",Kn.SERVER_ERROR)}):this.join().catch(n=>{if(this.emit(he.REPORT_JOIN_GATEWAY,n.message||n.code,this.url||""),n instanceof X&&n.code===M.UNEXPECTED_RESPONSE&&n.data.code===Ie.ERR_NO_AUTHORIZED)return w.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Kn.SERVER_ERROR);w.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Kn.SERVER_ERROR):(this.initError=n,this.close())})}),this.websocket.on(xe.REQUEST_NEW_URLS,(n,r)=>{Qt(this,he.REQUEST_RECOVER,this.multiIpOption).then(n).catch(r)}),this.websocket.on(xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}_handleSignalP2PEvents(){var n=this;this._external_signal.on(Dt.JOIN,function(){var r=x(function*(a){if(n._userOnlineTime&&n._userOnlineTime<a.onlineTime){const l=yield Qt(n,he.P2P_START,void 0),d=yield n._external_signal.send(Dt.CALL,l);n.emit(he.P2P_CONNECTION,d,!0)}n._userInRoom=!0,n.emit("user-online")});return function(a){return r.apply(this,arguments)}}()),this.on(Ue.ON_USER_OFFLINE,function(){var r=x(function*(a){n._external_signal.clear(),n._userInRoom=!1});return function(a){return r.apply(this,arguments)}}()),this._external_signal.on(Dt.CALL,function(){var r=x(function*(a,l,d){n._userInRoom=!0,n.emit("user-online");try{l(yield Qt(n,he.P2P_START,a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}())}waitTillUserOnline(){var n=this;return x(function*(){return new z(r=>{if(n._userInRoom)r();else{const a=()=>{n.off("user-online",a),r()};n.on("user-online",a)}})})()}}function eN(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function ws(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?eN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):eN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}const jd=new Map;class XL extends qt{get state(){return this._state}set state(n){if(n===this._state)return;const r=this._state;this._state=n,"DISCONNECTED"===n&&this._disconnectedReason?this.emit(sn.CONNECTION_STATE_CHANGE,n,r,this._disconnectedReason):this.emit(sn.CONNECTION_STATE_CHANGE,n,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(n){w.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(n)),this._joinGatewayStartTime=n}constructor(n,r){super(),C(this,"store",void 0),C(this,"joinInfo",void 0),C(this,"key",void 0),C(this,"ntpOffset",0),C(this,"signal",void 0),C(this,"role",void 0),C(this,"inChannelInfo",{joinAt:null,duration:0}),C(this,"spec",void 0),C(this,"_state","DISCONNECTED"),C(this,"_statsCollector",void 0),C(this,"_disconnectedReason",void 0),C(this,"isSignalRecover",!1),C(this,"hasChangeBGPAddress",!1),C(this,"trafficStatsInterval",void 0),C(this,"networkQualityInterval",void 0),C(this,"_joinGatewayStartTime",0),C(this,"_signalTimeout",!1),C(this,"_clientRoleOptions",void 0),C(this,"_isProactiveJoin",!1),this.store=n,this.spec=r,this.signal=this.store.useP2P?new ZO(ws(ws({},r),{},{retryConfig:r.websocketRetryConfig}),n):this.store.useDataChannel?new ta(ws(ws({},r),{},{retryConfig:r.websocketRetryConfig}),n):new MD(ws(ws({},r),{},{retryConfig:r.websocketRetryConfig}),n),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}join(n,r,a){var l=this;return x(function*(){if(l.signal instanceof ta){let _=!1;"disabled"!==n.cloudProxyServer?(w.debug("[".concat(l.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(n.cloudProxyServer,")")),_=!0):"".concat(n.apResponse.cid,"_").concat(n.apResponse.cert).length>255||"".concat(n.apResponse.cid,"_").concat(n.apResponse.cert).length<22?(w.debug("[".concat(l.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),_=!0):n.apResponse.addresses.some(E=>E.fingerprint)||j("FINGERPRINT")||(w.debug("[".concat(l.store.clientId,"] Dc is not supported, because fingerprint does not exist")),_=!0),_&&l.resetSignal()}l.store.joinGatewayStart(),"disabled"!==n.cloudProxyServer&&(l.hasChangeBGPAddress=!0);const d=Date.now();let h=jd.get(n.cname);if(h||(h=new Map,jd.set(n.cname,h)),l._isProactiveJoin=!0,h.has(n.uid)){const _=new W(M.UID_CONFLICT);throw Se.joinGateway(n.sid,{lts:d,succ:!1,ec:_.message,addr:null,uid:n.uid,cid:n.cid,firstSuccess:l._isProactiveJoin,avoidJoinStartTime:l.store.avoidJoinStart,isProxy:!!n.proxyServer,signalChannel:l.signal instanceof ta?"1":"0"}),l._isProactiveJoin=!1,_}h.set(n.uid,!0),l.joinInfo=n,l.key=r;let p=0;l.joinGatewayStartTime=d;const m=n.proxyServer;try{let _;if(w.debug("[".concat(l.store.clientId,"] use ").concat(l.signal instanceof ta?"datachannel":"websocket"," join uid ").concat(p)),l.signal instanceof ta)_=yield l.signal.init(n.apResponse.addresses,a);else{const E=n.gatewayAddrs.map(v=>{let{address:b}=v;const[T,O]=b.split(":"),P={host:T,port:O};return n.proxyServer&&(P.proxy=n.proxyServer),P});_=yield l.signal.init(E,a)}p=_.uid,w.debug("[".concat(l.store.clientId,"] ").concat(l.signal instanceof ta?"datachannel":"websocket"," join uid ").concat(p," cost ").concat(Date.now()-l.joinGatewayStartTime))}catch(_){throw _&&_.code===M.INIT_WEBSOCKET_TIMEOUT?(w.warning("[".concat(l.store.clientId,"] User join failed"),_.toString()),_):_&&_.code===M.INIT_DATACHANNEL_TIMEOUT?(w.warning("[".concat(l.store.clientId,"] User join datachannel failed"),_.toString()),l.resetSignal(),_):(w.error("[".concat(l.store.clientId,"] User join failed"),_.toString()),Se.joinGateway(n.sid,{lts:d,succ:!1,ec:_.message,addr:l.signal.url,uid:n.uid,cid:n.cid,firstSuccess:l._isProactiveJoin,avoidJoinStartTime:l.store.avoidJoinStart,isProxy:!!m,signalChannel:l.signal instanceof ta?"1":"0"}),l._isProactiveJoin=!1,h.delete(n.uid),l.signal.close(),_)}return l.state="CONNECTED",l.inChannelInfo.joinAt=Date.now(),w.debug("[".concat(l.store.clientId,"] Connected to gateway server")),l.trafficStatsInterval=window.setInterval(()=>{l.updateTrafficStats().catch(_=>{w.warning("[".concat(l.store.clientId,"] get traffic stats error"),_.toString())})},3e3),l.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?l.emit(sn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):l.emit(sn.NETWORK_QUALITY,l._signalTimeout?{downlinkNetworkQuality:5,uplinkNetworkQuality:5}:"CONNECTED"===l.state&&l._statsCollector.trafficStats?{uplinkNetworkQuality:XE(l._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:XE(l._statsCollector.trafficStats.B_dnq)}:{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),l.store.joinGatewayEnd(),p})()}leave(){var n=arguments,r=this;return x(function*(){let a=n.length>0&&void 0!==n[0]&&n[0],l=n.length>1?n[1]:void 0;if("DISCONNECTED"!==r.state){l!==Ye.FALLBACK&&(r.state="DISCONNECTING");try{a||r.signal.connectionState!==Ke.CONNECTED||(yield(d=r.signal.request(Ce.LEAVE,void 0,!0),3e3,z.race([d,wk(3e3)])))}catch(d){w.warning("[".concat(r.store.clientId,"] leave request failed, ignore"),d)}r.signal.close(l),l!==Ye.FALLBACK&&(r.state="DISCONNECTED"),r.reset()}var d})()}publish(n,r,a){var l=this;return x(function*(){if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new W(M.INVALID_OPERATION,"can not publish when connection state is ".concat(l.state));const d={state:"offer",p2p_id:l.store.p2pId,ortc:r,mode:l.spec.mode,extend:j("PUB_EXTEND"),twcc:!!j("PUBLISH_TWCC"),rtx:!!j("USE_PUB_RTX")};try{return(yield l.signal.request(Ce.PUBLISH,d,!0))._message}catch(h){if(a&&h.data&&h.data.code===Ie.ERR_PUBLISH_REQUEST_INVALID)return w.warning("[".concat(l.store.clientId,"] receive publish error code, retry"),h.toString()),yield l.tryUnpubBeforeRepub(n,r),l.publish(n,r,!1);throw h}})()}publishDataChannel(n,r,a){var l=this;return x(function*(){var d;if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new W(M.INVALID_OPERATION,"can not publish when connection state is ".concat(l.state));const h={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:null!==(d=r.maxRetransmits)&&void 0!==d?d:10,channel_id:r.channelId,metadata:r.metadata};try{yield l.signal.request(Ce.PUBLISH_DATASTREAM,h,!0)}catch(p){if(a&&p.data&&p.data.code===Ie.ERR_PUBLISH_REQUEST_INVALID)return w.warning("[".concat(l.store.clientId,"] receive publish datachannels error code, retry"),p.toString()),yield l.tryUnpubDataChannelBeforeRepub(n,r),l.publishDataChannel(n,r,!1);throw p}})()}unpublish(n,r){var a=this;return x(function*(){try{if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new W(M.INVALID_OPERATION,"can not publish when connection state is ".concat(a.state));yield a.signal.request(Ce.UNPUBLISH,{stream_id:r,ortc:n},!0)}catch(l){w.warning("[".concat(a.store.clientId,"] unpublish warning: "),l)}})()}unpublishDataChannel(n){var r=this;return x(function*(){try{if("CONNECTED"!==r.state&&"RECONNECTING"!==r.state)throw new W(M.INVALID_OPERATION,"can not publish when connection state is ".concat(r.state));yield z.all(n.map(a=>r.signal.request(Ce.UNPUBLISH_DATASTREAM,{channel_id:a},!0)))}catch(a){w.warning("unpublish datachannels warning: ",a)}})()}subscribe(n,r,a){var l=this;return x(function*(){if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new W(M.INVALID_OPERATION,"can not subscribe when connection state is ".concat(l.state));const d={stream_id:n,stream_type:r.stream_type,mode:l.spec.mode,codec:l.spec.codec,p2p_id:l.store.p2pId,twcc:!!j("SUBSCRIBE_TWCC"),rtx:!!j("USE_SUB_RTX"),extend:j("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(j("SVC"))&&0!==j("SVC").length?j("SVC"):void 0};try{return(yield l.signal.request(Ce.SUBSCRIBE,d,!0))._message}catch(h){if(a&&h.data&&h.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(l.store.clientId,"] receiver subscribe error code, retry"),h.toString()),yield l.tryUnsubBeforeResub(n,r),yield l.subscribe(n,r,!1);throw h}})()}subscribeDataChannel(n,r,a){var l=this;return x(function*(){if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new W(M.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(l.state));const d={uid:n,stream_id:r.id,channel_id:r.datachannelId};try{return void(yield l.signal.request(Ce.SUBSCRIBE_DATASTREAM,d,!0))}catch(h){if(a&&h.data&&h.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(l.store.clientId,"] receiver subscribe datachannel error code, retry"),h.toString()),yield l.tryUnsubDataChannelBeforeResub(n,r),yield l.subscribeDataChannel(n,r,!1);throw h}})()}subscribeAll(n,r){var a=this;return x(function*(){if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new W(M.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(a.state));const l={p2p_id:a.store.p2pId,users:n,dtx:!1,rtx:!!j("USE_SUB_RTX")};try{return yield a.signal.request(Ce.SUBSCRIBE_STREAMS,l,!0)}catch(d){if(r&&d.data&&d.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return w.warning("[".concat(a.store.clientId,"] receiver massSubscribe error code, retry"),d.toString()),yield a.tryMassUnsubBeforeResub(n),yield a.subscribeAll(n,!1);throw d}})()}setVideoProfile(n){var r=this;return x(function*(){const a=function(l){if(!(l.bitrateMax&&l.bitrateMin&&l.frameRate&&l.height&&l.width))return;let d=l.frameRate,h=l.width,p=l.height,m=!0;return"number"!=typeof d&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),"number"!=typeof h&&(h=h.exact||h.ideal||h.max||h.min||0,h||(m=!1)),"number"!=typeof p&&(p=p.exact||p.ideal||p.max||p.min||0,d||(m=!1)),m?{stream_type:0,width:h,height:p,fps:d,start_bps:1e3*l.bitrateMax,min_bps:1e3*l.bitrateMin,target_bps:1e3*l.bitrateMax}:void 0}(n);if(a)return r.signal.request(Ce.SET_VIDEO_PROFILE,a);w.debug("[".concat(r.store.clientId,"] encoder config is not complete, do not report to gateway"))})()}unsubscribe(n,r){var a=this;return x(function*(){try{yield a.signal.request(Ce.UNSUBSCRIBE,{p2p_id:a.store.p2pId,ortc:n,stream_id:r},!0)}catch(l){w.warning("[".concat(a.store.clientId,"] unsubscribe warning: "),l)}})()}unsubscribeDataChannel(n,r){var a=this;return x(function*(){try{if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new W(M.INVALID_OPERATION,"can not publish when connection state is ".concat(a.state));yield z.all(n.map(l=>a.signal.request(Ce.UNSUBSCRIBE_DATASTREAM,{stream_id:l,uid:r},!0)))}catch(l){w.warning("unsubscribeDataChannel warning: ",l)}})()}massUnsubscribe(n){var r=this;return x(function*(){try{yield r.signal.request(Ce.UNSUBSCRIBE_STREAMS,n,!0)}catch(a){w.warning("[".concat(r.store.clientId,"] massUnsubscribeAll warning: "),a)}})()}reconnectPC(n){var r=this;return x(function*(){const{iceParameters:a,dtlsParameters:l,rtpCapabilities:d}=n;return{gatewayEstablishParams:yield r.signal.request(Ce.CONNECT_PC,{p2p_id:r.store.p2pId,stream_id:r.store.uid,ortc:{iceParameters:a,dtlsParameters:l,rtpCapabilities:d}},!0),gatewayAddress:r.getCurrentGatewayAddress()}})()}getGatewayInfo(){return this.signal.request(Ce.GATEWAY_INFO)}renewToken(n){var r=this;return x(function*(){yield r.signal.request(Ce.RENEW_TOKEN,n),r.key=n.token})()}setClientRole(n,r){var a=this;return x(function*(){if(r&&(a._clientRoleOptions=Object.assign({},r)),"CONNECTED"!==a.state)return void(a.role=n);let l,d=0;"audience"===n?a._clientRoleOptions&&a._clientRoleOptions.delay?(l=a._clientRoleOptions.delay,d=1):d=a._clientRoleOptions&&a._clientRoleOptions.level?a._clientRoleOptions.level:2:d=0,yield a.signal.request(Ce.SET_CLIENT_ROLE,{role:n,level:d,delay:l,client_ts:Date.now()}),a.role=n})()}setRemoteVideoStreamType(n,r){var a=this;return x(function*(){yield a.signal.request(Ce.SWITCH_VIDEO_STREAM,{stream_id:n,stream_type:r})})()}setDefaultRemoteVideoStreamType(n){var r=this;return x(function*(){yield r.signal.request(Ce.DEFAULT_VIDEO_STREAM,{stream_type:n})})()}setStreamFallbackOption(n,r){var a=this;return x(function*(){yield a.signal.request(Ce.SET_FALLBACK_OPTION,{stream_id:n,fallback_type:r})})()}pickSVCLayer(n,r){var a=this;return x(function*(){yield a.signal.request(Ce.PICK_SVC_LAYER,{stream_id:n,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})})()}setRTM2Flag(n){var r=this;return x(function*(){yield r.signal.request(Ce.SET_RTM2_FLAG,{rtm2_flag:n})})()}sendExtensionMessage(n,r,a){var l=this;return x(function*(){if(l.signal instanceof ZO)return l.signal.sendExtensionMessage(n,r,a)})()}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),ws({},this.inChannelInfo)}getGatewayVersion(){var n=this;return x(function*(){return(yield n.signal.request(Ce.GATEWAY_INFO)).version})()}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const n=jd.get(this.joinInfo.cname);n&&n.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const n=function(r){let a;return a=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:Eo.username,password:Eo.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],n&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(ws(ws({},Eo),{},{turnServerURL:n.turnServerURL,tcpport:n.tcpport,udpport:n.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}updateTrafficStats(){var n=this;return x(function*(){if("CONNECTED"!==n.state)return;const r=yield n.signal.request(Ce.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),null!=r.ntp_offset&&(n.ntpOffset=r.ntp_offset),r.peer_delay.forEach(a=>{const l=n._statsCollector.trafficStats&&n._statsCollector.trafficStats.peer_delay.find(d=>d.peer_uid===a.peer_uid);l&&l.B_st!==a.B_st&&mo(()=>{n.emit(sn.STREAM_TYPE_CHANGE,a.peer_uid,a.B_st)})}),n._statsCollector.updateTrafficStats(r)})()}getJoinMessage(n){if(!this.joinInfo||!this.key)throw new W(M.UNEXPECTED_ERROR,"can not generate join message, no join info");const r=Object.assign({},this.joinInfo.apResponse);let a=j("REPORT_APP_SCENARIO");if("string"!=typeof a)try{a=JSON.stringify(a)}catch{a=void 0}a&&a.length>128&&(a=void 0);const l=ws({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:$o,browser:navigator.userAgent,process_id:j("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:j("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:a,attributes:{userAttributes:{enablePublishedUserList:j("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:j("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof j("SUBSCRIBE_AUDIO_FILTER_TOPN")?j("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof j("ENABLE_PUBLISH_AUDIO_FILTER")?j("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof j("ENABLE_USER_LICENSE_CHECK")?j("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===j("USE_PUB_RTX")||!0===j("USE_SUB_RTX")||void 0,disableFEC:j("DISABLE_FEC"),enableNTPReport:!!j("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!j("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:"boolean"==typeof j("ENABLE_DATASTREAM_2")?j("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:"number"==typeof j("RTM2_FLAG")?j("RTM2_FLAG"):void 0,enableUserAutoRebalanceCheck:!!j("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:"boolean"==typeof j("USE_XR")?j("USE_XR"):void 0}},join_ts:this.joinGatewayStartTime},n);return this.joinInfo.stringUid&&(l.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(l.aes_mode=this.joinInfo.aesmode,j("ENCRYPT_AES")?(l.aes_secret=this.joinInfo.aespassword,l.aes_encrypt=!0):l.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(l.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(l.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),void 0!==this.joinInfo.defaultVideoStream&&(l.default_video_stream=this.joinInfo.defaultVideoStream),l}getRejoinMessage(){if(!this.joinInfo)throw new W(M.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){var n=this;this.signal.on(he.WS_RECONNECT_WAITTING_FINISH,r=>{var a;ye(a=["tryNext","recover"]).call(a,r)&&this.joinInfo&&Se.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(he.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(he.WS_RECONNECTING,r=>{this.joinInfo&&Se.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Kn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Se.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(he.WS_CLOSED,r=>{let a;switch(r){case Ye.LEAVE:a=Kn.LEAVE;break;case Ye.UID_BANNED:case Ye.IP_BANNED:case Ye.CHANNEL_BANNED:case Ye.SERVER_ERROR:a=Kn.SERVER_ERROR;break;case Ye.FALLBACK:a=Kn.FALLBACK;break;case Ye.LICENSE_MISSING:case Ye.LICENSE_EXPIRED:case Ye.LICENSE_MINUTES_EXCEEDED:case Ye.LICENSE_PERIOD_INVALID:case Ye.LICENSE_MULTIPLE_SDK_SERVICE:case Ye.LICENSE_ILLEGAL:case Ye.TOKEN_EXPIRE:a=r;break;default:a=Kn.NETWORK_ERROR}w.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(a||"undefined -> "+Kn.NETWORK_ERROR)),this.joinInfo&&Se.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===Ye.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:a}),this._disconnectedReason=r,r!==Ye.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(he.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(w.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),Se.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof ta?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void w.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));At("EVENT_REPORT_DOMAIN",r[1]),At("EVENT_REPORT_BACKUP_DOMAIN",r[1]),At("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}),this.signal.on(Ue.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(he.REQUEST_RECOVER,(r,a,l)=>{if(!this.joinInfo)return l(new W(M.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Qt(this,sn.REQUEST_NEW_GATEWAY_LIST).then(a).catch(l)}),this.signal.on(he.REQUEST_JOIN_INFO,function(){var r=x(function*(a){var l;if(n.updateTurnConfigFromSignal(),n.store.useP2P)return void a(n.getJoinMessage({ortc:{}}));const{iceParameters:d,dtlsParameters:h,rtpCapabilities:p}=yield Qt(n,sn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(l=n.joinInfo)||void 0===l?void 0:l.turnServer});a(n.getJoinMessage({ortc:{iceParameters:d,dtlsParameters:h,rtpCapabilities:p,version:"2"}}))});return function(a){return r.apply(this,arguments)}}()),this.signal.on(he.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(he.REPORT_JOIN_GATEWAY,(r,a)=>{this.joinInfo&&(Se.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,addr:a,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof ta?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(he.IS_P2P_DISCONNECTED,r=>{r(dc(this,sn.IS_P2P_DISCONNECTED))}),this.signal.on(he.DISCONNECT_P2P,()=>{this.emit(sn.DISCONNECT_P2P)}),this.signal.on(he.NEED_RENEW_SESSION,()=>{this.emit(sn.NEED_RENEW_SESSION)}),this.signal.on(he.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(he.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(he.JOIN_RESPONSE,r=>{const a=this.getCurrentGatewayAddress();this.emit(sn.JOIN_RESPONSE,r,a)}),this.signal.on(he.DATACHANNEL_PRECONNECT,function(){var r=x(function*(a,l,d){n.updateTurnConfigFromSignal();const h=n.getCurrentGatewayAddress();return Qt(n,sn.DATACHANNEL_PRECONNECT,a,h).then(l).catch(d)});return function(a,l,d){return r.apply(this,arguments)}}()),this.signal.on(he.DATACHANNEL_CONNECTING,function(){var r=x(function*(a){const{iceParameters:l,dtlsParameters:d,rtpCapabilities:h}=yield Qt(n,sn.REQUEST_DC_CONNECTION_PARAMS);a(n.getJoinMessage({ortc:{iceParameters:l,dtlsParameters:d,rtpCapabilities:h,version:"2"}}))});return function(a){return r.apply(this,arguments)}}()),this.signal.on(he.DATACHANNEL_FAILBACK,()=>{w.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(sn.DATACHANNEL_FAILBACK)})}tryUnsubBeforeResub(n,r){var a=this;return x(function*(){try{yield a.signal.request(Ce.UNSUBSCRIBE,{p2p_id:a.store.p2pId,stream_id:n,ortc:[r]},!0)}catch(l){throw w.warning("[".concat(a.store.clientId,"] tryUnsubBeforeResub warning"),l),l}})()}tryUnsubDataChannelBeforeResub(n,r){var a=this;return x(function*(){try{yield a.signal.request(Ce.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(l){throw w.warning("unsubscribe datachannel warning",l),l}})()}tryUnpubBeforeRepub(n,r){var a=this;return x(function*(){try{yield a.signal.request(Ce.UNPUBLISH,{stream_id:n,ortc:r},!0)}catch(l){throw w.warning("[".concat(a.store.clientId,"] tryUnpubBeforeRepub warning: "),l),l}})()}tryUnpubDataChannelBeforeRepub(n,r){var a=this;return x(function*(){try{yield a.signal.request(Ce.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(l){throw w.warning("unpublish datastream warning: ",l),l}})()}tryMassUnsubBeforeResub(n){var r=this;return x(function*(){const a={users:n.map(l=>({stream_id:l.stream_id,stream_type:l.stream_type}))};try{yield r.signal.request(Ce.UNSUBSCRIBE_STREAMS,a,!0)}catch(l){throw w.warning("[".concat(r.store.clientId,"] tryMassUnsubBeforeResub warning"),l),l}})()}muteLocal(n,r){var a=this;return x(function*(){const l={action:n.find(d=>d.stream_type===It.Audio)?"mute_local_audio":"mute_local_video",p2p_id:a.store.p2pId,ortc:n,stream_id:r};try{yield a.signal.request(Ce.CONTROL,l,!0,!0)}catch(d){throw w.warning("[".concat(a.store.clientId,"] gateway muteLocal warning: "),d),d}})()}unmuteLocal(n,r){var a=this;return x(function*(){const l={action:n.find(d=>d.stream_type===It.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:a.store.p2pId,ortc:n,stream_id:r};try{yield a.signal.request(Ce.CONTROL,l,!0,!0)}catch(d){throw w.warning("[".concat(a.store.clientId,"] gateway unmuteLocal warning: "),d),d}})()}muteRemote(n,r){var a=this;return x(function*(){const l={action:n===ge.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:a.store.p2pId,stream_id:r};try{yield a.signal.request(Ce.CONTROL,l,!0,!0)}catch(d){throw w.warning("[".concat(a.store.clientId,"] gateway muteRemote warning: "),d),d}})()}unmuteRemote(n,r){var a=this;return x(function*(){const l={action:n===ge.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:a.store.p2pId,stream_id:r};try{yield a.signal.request(Ce.CONTROL,l,!0,!0)}catch(d){throw w.warning("[".concat(a.store.clientId,"] gateway unmuteRemote warning: "),d),d}})()}uploadStats(n,r){this.signal.upload(n,r)}getSignalRTT(){return this.signal.rtt}restartICE(n){var r=this;return x(function*(){const a={p2p_id:r.store.p2pId,stream_id:r.store.uid,ortc:n};try{return yield r.signal.request(Ce.RESTART_ICE,a,!0)}catch(l){throw w.warning("[".concat(r.store.clientId,"] P2PChannel.restartICE warning: "),l),l}})()}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,Kn.P2P_FAILED)}getCurrentGatewayAddress(){var n;if(!j("GATEWAY_WSS_ADDRESS"))return null!==(n=this.joinInfo)&&void 0!==n&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}setPublishAudioFilterEnabled(n){var r=this;return x(function*(){yield r.signal.request(Ce.SET_PARAMETER,{enablePublishAudioFilter:n})})()}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Ye.FALLBACK)),this.store.useDataChannel=!1,this.signal=new MD(ws(ws({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(sn.RESET_SIGNAL,sE.websocket)}}let Is=0,rn=0;function xt(s,n,r,a){return new z((l,d)=>{n.timeout=n.timeout||j("HTTP_CONNECT_TIMEOUT"),n.responseType=n.responseType||"json",n.data&&!r?(n.data=JSON.stringify(n.data),Is+=Oa(n.data)):r&&(n.data.size?Is+=n.data.size:n.data instanceof FormData?Is+=gS(n.data):Is+=Oa(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=s,Er.request(n).then(h=>{"string"==typeof h.data?rn+=Oa(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?rn+=h.data.byteLength:rn+=Oa(JSON.stringify(h.data)),a&&l({data:h.data,headers:h.headers}),l(h.data)}).catch(h=>{Er.isCancel(h)?d(new W(M.OPERATION_ABORTED,"cancel token canceled")):d("ECONNABORTED"===h.code?new W(M.NETWORK_TIMEOUT,h.message):h.response?new W(M.NETWORK_RESPONSE_ERROR,h.response.status):new W(M.NETWORK_ERROR,h.message))})})}!function(){var s;function n(ie){var ce=0;return function(){return ce<ie.length?{done:!1,value:ie[ce++]}:{done:!0}}}var a,r="function"==typeof Object.defineProperties?Object.defineProperty:function(ie,ce,_e){return ie==Array.prototype||ie==Object.prototype||(ie[ce]=_e.value),ie},l=function(ie){ie=["object"==typeof globalThis&&globalThis,ie,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof eu&&eu];for(var ce=0;ce<ie.length;++ce){var _e=ie[ce];if(_e&&_e.Math==Math)return _e}throw Error("Cannot find global object")}(this);function d(ie,ce){if(ce)e:{var _e=l;ie=ie.split(".");for(var Le=0;Le<ie.length-1;Le++){var ut=ie[Le];if(!(ut in _e))break e;_e=_e[ut]}(ce=ce(Le=_e[ie=ie[ie.length-1]]))!=Le&&null!=ce&&r(_e,ie,{configurable:!0,writable:!0,value:ce})}}function h(ie){return(ie={next:ie})[Symbol.iterator]=function(){return this},ie}function p(ie){var ce=typeof Symbol<"u"&&Symbol.iterator&&ie[Symbol.iterator];return ce?ce.call(ie):{next:n(ie)}}if(d("Symbol",function(ie){function ce(ut,le){this.A=ut,r(this,"description",{configurable:!0,writable:!0,value:le})}if(ie)return ie;ce.prototype.toString=function(){return this.A};var _e="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Le=0;return function ut(le){if(this instanceof ut)throw new TypeError("Symbol is not a constructor");return new ce(_e+(le||"")+"_"+Le++,le)}}),d("Symbol.iterator",function(ie){if(ie)return ie;ie=Symbol("Symbol.iterator");for(var ce="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),_e=0;_e<ce.length;_e++){var Le=l[ce[_e]];"function"==typeof Le&&"function"!=typeof Le.prototype[ie]&&r(Le.prototype,ie,{configurable:!0,writable:!0,value:function(){return h(n(this))}})}return ie}),"function"==typeof Object.setPrototypeOf)a=Object.setPrototypeOf;else{var m;e:{var _={};try{_.__proto__={a:!0},m=_.a;break e}catch{}m=!1}a=m?function(ie,ce){if(ie.__proto__=ce,ie.__proto__!==ce)throw new TypeError(ie+" is not extensible");return ie}:null}var E=a;function v(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function b(ie){if(ie.m)throw new TypeError("Generator is already running");ie.m=!0}function T(ie,ce){return ie.h=3,{value:ce}}function O(ie){this.g=new v,this.G=ie}function P(ie,ce,_e,Le){try{var ut=ce.call(ie.g.j,_e);if(!(ut instanceof Object))throw new TypeError("Iterator result "+ut+" is not an object");if(!ut.done)return ie.g.m=!1,ut;var le=ut.value}catch(I){return ie.g.j=null,ie.g.s(I),D(ie)}return ie.g.j=null,Le.call(ie.g,le),D(ie)}function D(ie){for(;ie.g.h;)try{var ce=ie.G(ie.g);if(ce)return ie.g.m=!1,{value:ce.value,done:!1}}catch(_e){ie.g.v=void 0,ie.g.s(_e)}if(ie.g.m=!1,ie.g.l){if(ce=ie.g.l,ie.g.l=null,ce.F)throw ce.D;return{value:ce.return,done:!0}}return{value:void 0,done:!0}}function L(ie){this.next=function(ce){return ie.o(ce)},this.throw=function(ce){return ie.s(ce)},this.return=function(ce){return function(_e,Le){b(_e.g);var ut=_e.g.j;return ut?P(_e,"return"in ut?ut.return:function(le){return{value:le,done:!0}},Le,_e.g.return):(_e.g.return(Le),D(_e))}(ie,ce)},this[Symbol.iterator]=function(){return this}}function V(ie,ce){return ce=new L(new O(ce)),E&&ie.prototype&&E(ce,ie.prototype),ce}if(v.prototype.o=function(ie){this.v=ie},v.prototype.s=function(ie){this.l={D:ie,F:!0},this.h=this.C||this.u},v.prototype.return=function(ie){this.l={return:ie},this.h=this.u},O.prototype.o=function(ie){return b(this.g),this.g.j?P(this,this.g.j.next,ie,this.g.o):(this.g.o(ie),D(this))},O.prototype.s=function(ie){return b(this.g),this.g.j?P(this,this.g.j.throw,ie,this.g.o):(this.g.s(ie),D(this))},d("Array.prototype.entries",function(ie){return ie||function(){return function(ce,_e){ce instanceof String&&(ce+="");var Le=0,ut=!1,le={next:function(){if(!ut&&Le<ce.length){var I=Le++;return{value:_e(I,ce[I]),done:!1}}return ut=!0,{done:!0,value:void 0}}};return le[Symbol.iterator]=function(){return le},le}(this,function(ce,_e){return[ce,_e]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var U=function(ie,ce){for(var _e=0;_e<ie.length;_e++)ce(ie[_e])},J=function(ie){return ie.replace(/\r?\n|\r/g,"\r\n")},se=function(ie,ce,_e){return ce instanceof Blob?(ce.name===(_e=void 0!==_e?_e+"":"string"==typeof ce.name?ce.name:"blob")&&"[object Blob]"!==Object.prototype.toString.call(ce)||(ce=new File([ce],_e)),[String(ie),ce]):[String(ie),String(ce)]},q=function(ie,ce){if(ie.length<ce)throw new TypeError(ce+" argument required, but only "+ie.length+" present.")},Q="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,$=Q.FormData,Y=Q.XMLHttpRequest&&Q.XMLHttpRequest.prototype.send,me=Q.Request&&Q.fetch,Ee=Q.navigator&&Q.navigator.sendBeacon,Ze=Q.Element&&Q.Element.prototype,yt=Q.Symbol&&Symbol.toStringTag;yt&&(Blob.prototype[yt]||(Blob.prototype[yt]="Blob"),"File"in Q&&!File.prototype[yt]&&(File.prototype[yt]="File"));try{new File([],"")}catch{Q.File=function(ce,_e,Le){return ce=new Blob(ce,Le||{}),Object.defineProperties(ce,{name:{value:_e},lastModified:{value:+(Le&&void 0!==Le.lastModified?new Date(Le.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),yt&&Object.defineProperty(ce,yt,{value:"File"}),ce}}var xn=function(ie){return ie.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Ht=function(ie){this.i=[];var ce=this;ie&&U(ie.elements,function(_e){if(_e.name&&!_e.disabled&&"submit"!==_e.type&&"button"!==_e.type&&!_e.matches("form fieldset[disabled] *"))if("file"===_e.type){var Le=_e.files&&_e.files.length?_e.files:[new File([],"",{type:"application/octet-stream"})];U(Le,function(ut){ce.append(_e.name,ut)})}else"select-multiple"===_e.type||"select-one"===_e.type?U(_e.options,function(ut){!ut.disabled&&ut.selected&&ce.append(_e.name,ut.value)}):"checkbox"===_e.type||"radio"===_e.type?_e.checked&&ce.append(_e.name,_e.value):(Le="textarea"===_e.type?J(_e.value):_e.value,ce.append(_e.name,Le))})};if((s=Ht.prototype).append=function(ie,ce,_e){q(arguments,2),this.i.push(se(ie,ce,_e))},s.delete=function(ie){q(arguments,1);var ce=[];ie=String(ie),U(this.i,function(_e){_e[0]!==ie&&ce.push(_e)}),this.i=ce},s.entries=function ie(){var ce,_e=this;return V(ie,function(Le){if(1==Le.h&&(ce=0),3!=Le.h)return ce<_e.i.length?Le=T(Le,_e.i[ce]):(Le.h=0,Le=void 0),Le;ce++,Le.h=2})},s.forEach=function(ie,ce){q(arguments,1);for(var _e=p(this),Le=_e.next();!Le.done;Le=_e.next()){var ut=p(Le.value);Le=ut.next().value,ut=ut.next().value,ie.call(ce,ut,Le,this)}},s.get=function(ie){q(arguments,1);var ce=this.i;ie=String(ie);for(var _e=0;_e<ce.length;_e++)if(ce[_e][0]===ie)return ce[_e][1];return null},s.getAll=function(ie){q(arguments,1);var ce=[];return ie=String(ie),U(this.i,function(_e){_e[0]===ie&&ce.push(_e[1])}),ce},s.has=function(ie){q(arguments,1),ie=String(ie);for(var ce=0;ce<this.i.length;ce++)if(this.i[ce][0]===ie)return!0;return!1},s.keys=function ie(){var ce,_e,le=this;return V(ie,function(I){if(1==I.h&&(ce=p(le),_e=ce.next()),3!=I.h)return _e.done?void(I.h=0):T(I,p(_e.value).next().value);_e=ce.next(),I.h=2})},s.set=function(ie,ce,_e){q(arguments,2),ie=String(ie);var Le=[],ut=se(ie,ce,_e),le=!0;U(this.i,function(I){I[0]===ie?le&&(le=!Le.push(ut)):Le.push(I)}),le&&Le.push(ut),this.i=Le},s.values=function ie(){var ce,_e,ut,le=this;return V(ie,function(I){if(1==I.h&&(ce=p(le),_e=ce.next()),3!=I.h)return _e.done?void(I.h=0):((ut=p(_e.value)).next(),T(I,ut.next().value));_e=ce.next(),I.h=2})},Ht.prototype._asNative=function(){for(var ie=new $,ce=p(this),_e=ce.next();!_e.done;_e=ce.next()){var Le=p(_e.value);_e=Le.next().value,Le=Le.next().value,ie.append(_e,Le)}return ie},Ht.prototype._blob=function(){var ie="----formdata-polyfill-"+Math.random(),ce=[],_e="--"+ie+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(Le,ut){return"string"==typeof Le?ce.push(_e+xn(J(ut))+'"\r\n\r\n'+J(Le)+"\r\n"):ce.push(_e+xn(J(ut))+'"; filename="'+xn(Le.name)+'"\r\nContent-Type: '+(Le.type||"application/octet-stream")+"\r\n\r\n",Le,"\r\n")}),ce.push("--"+ie+"--"),new Blob(ce,{type:"multipart/form-data; boundary="+ie})},Ht.prototype[Symbol.iterator]=function(){return this.entries()},Ht.prototype.toString=function(){return"[object FormData]"},Ze&&!Ze.matches&&(Ze.matches=Ze.matchesSelector||Ze.mozMatchesSelector||Ze.msMatchesSelector||Ze.oMatchesSelector||Ze.webkitMatchesSelector||function(ie){for(var ce=(ie=(this.document||this.ownerDocument).querySelectorAll(ie)).length;0<=--ce&&ie.item(ce)!==this;);return-1<ce}),yt&&(Ht.prototype[yt]="FormData"),Y){var di=Q.XMLHttpRequest.prototype.setRequestHeader;Q.XMLHttpRequest.prototype.setRequestHeader=function(ie,ce){di.call(this,ie,ce),"content-type"===ie.toLowerCase()&&(this.B=!0)},Q.XMLHttpRequest.prototype.send=function(ie){ie instanceof Ht?(ie=ie._blob(),this.B||this.setRequestHeader("Content-Type",ie.type),Y.call(this,ie)):Y.call(this,ie)}}me&&(Q.fetch=function(ie,ce){return ce&&ce.body&&ce.body instanceof Ht&&(ce.body=ce.body._blob()),me.call(this,ie,ce)}),Ee&&(Q.navigator.sendBeacon=function(ie,ce){return ce instanceof Ht&&(ce=ce._asNative()),Ee.call(this,ie,ce)}),Q.FormData=Ht}}();const QE=()=>{const s=j("AREAS");return 0===s.length&&s.push(st.GLOBAL),al(s).call(s,(n,r,a)=>{const l=Kf(r);return l?0===a?l:"".concat(n,",").concat(l):n},"")},Kf=s=>s===st.OVERSEA?"".concat(ei.ASIA,",").concat(ei.EUROPE,",").concat(ei.AFRICA,",").concat(ei.NORTH_AMERICA,",").concat(ei.SOUTH_AMERICA,",").concat(ei.OCEANIA):ei[s],yc=s=>{const n={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return s.map(r=>{const a=aE[r],l=Object.keys(a);l&&l.map(d=>{"CODE"!==d&&(n[d]=n[d].concat(a[d]))})}),n},Hd={GLOBAL:{ASIA:[st.CHINA,st.JAPAN,st.INDIA,st.KOREA,st.HKMC],EUROPE:[],NORTH_AMERICA:[st.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Ao=Object.keys(Hd[st.GLOBAL]),QC=[st.CHINA,st.NORTH_AMERICA,st.EUROPE,st.ASIA,st.JAPAN,st.INDIA,st.OCEANIA,st.SOUTH_AMERICA,st.AFRICA,st.KOREA,st.HKMC,st.US],Gi=function(s,n){let r=[];if(ye(s).call(s,st.GLOBAL)){const d=[st.GLOBAL,st.OVERSEA],h=Object.keys(aE);if(n===st.GLOBAL)throw new W(M.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(n===st.CHINA)r=[st.OVERSEA];else if(l=n,ye(Ao).call(Ao,l)){const p=Hd[st.GLOBAL][n]||[],m=[...d,n,...p];r=h.filter(_=>!ye(m).call(m,_))}else if(function(p){let m=!1;return Ao.forEach(_=>{var E;ye(E=Hd[st.GLOBAL][_]).call(E,p)&&(m=!0)}),m}(n)){const p=function(_){let E;return Ao.forEach(v=>{var b;ye(b=Hd[st.GLOBAL][v]).call(b,_)&&(E=v)}),E}(n),m=[...d,p,n];r=h.filter(_=>!ye(m).call(m,_))}else r=s;r=function(p){const m=[];return QC.forEach(_=>{ye(p).call(p,_)&&m.push(_)}),m.concat(p.filter(_=>!ye(QC).call(QC,_)))}(r)}else r=s;var l;return r};function tN(s){var n,r;if(!s&&ye(n=j("AREAS")).call(n,st.EXTENSIONS))return w.debug("update area from ap : reset"),void In(zk,!0);if(!ye(r=j("AREAS")).call(r,st.GLOBAL)||!s)return;let a=aE.EXTENSIONS;a&&(a={CODE:Kf(st.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(s,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(s,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(s,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(s,".agora.io"),"cds-ap-web-2-".concat(s,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(s,".agora.io"),"sua-ap-web-2-".concat(s,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(s,".agora.io"),"uap-ap-web-2-".concat(s,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(s,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(s,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(s,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(s,".agora.io")]},w.debug("update area from ap success: ".concat(s,",config is "),a),At("AREAS",[st.EXTENSIONS],!0),Object.keys(a).map(l=>{At(l,"LOG_UPLOAD_SERVER"===l||"EVENT_REPORT_DOMAIN"===l||"EVENT_REPORT_BACKUP_DOMAIN"===l||"PROXY_SERVER_TYPE3"===l?a[l][0]:a[l])}))}function In(s){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=Se.reportApiInvoke(null,{name:Nn.SET_AREA,options:s,tag:Jt.TRACER});try{let a=[];if("string"==typeof s&&(a=[s]),Array.isArray(s)&&(s.forEach(d=>{if(!ye(YS).call(YS,d))throw new W(M.INVALID_PARAMS,"invalid area code")}),a=s),"[object Object]"===Object.prototype.toString.call(s)){const{areaCode:d,excludedArea:h}=s;if(!d)throw new W(M.INVALID_PARAMS,"area code is needed");let p=d;"string"==typeof d&&(p=[d]),a=h?Gi(p,h):p}if(!n){if(Ys.AREAS){const d=new W(M.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(d),void w.warning("setArea is prohibited because of config-distribute")}if(ye(a).call(a,st.GLOBAL)&&j("AREAS")===st.EXTENSIONS){const d=new W(M.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(d),void w.warning("setArea is prohibited because of ap extensions")}}At("AREAS",a,n);const l=yc(a);Object.keys(l).map(d=>{At(d,"LOG_UPLOAD_SERVER"===d||"EVENT_REPORT_DOMAIN"===d||"EVENT_REPORT_BACKUP_DOMAIN"===d||"PROXY_SERVER_TYPE3"===d?l[d][0]:l[d])}),w.debug("set area success:",a.join(","))}catch(a){throw r.onError(a),a}r.onSuccess()}function nN(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Nh(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?nN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):nN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}let ZC=1;let eT=1;function tT(s,n,r,a){let{url:l,areaCode:d}=s;const h=Date.now();let p;const[m,_]=nT(n,d,[$n.CHOOSE_SERVER]);let E=on.networkState;return gs(x(function*(){E&&on.networkState===Yi.OFFLINE&&on.onlineWaiter&&(yield z.race([on.onlineWaiter,gi(a&&a.maxRetryTimeout||Re.maxRetryTimeout)])),E=on.networkState;const{data:v,headers:b}=yield xt(l,{data:m,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p="1"===b.http3?1:-1,Se.reportResourceTiming(l,n.sid),Yf(v,l,n,h,[$n.CHOOSE_SERVER],p);const T=JO(v,$n.CHOOSE_SERVER);return tv(T),qf(T,l)}),v=>(v&&Se.joinChooseServer(n.sid,{lts:h,succ:!0,csAddr:l,opid:_,serverList:v.gatewayAddrs.map(b=>b.address),ec:null,cid:v.cid.toString(),uid:v.uid.toString(),csIp:v.csIp,unilbsServerIds:[$n.CHOOSE_SERVER].toString(),isHttp3:p}),!1),v=>v.code!==M.OPERATION_ABORTED&&(v.code===M.CAN_NOT_GET_GATEWAY_SERVER?v.data.retry:(Se.joinChooseServer(n.sid,{lts:h,succ:!1,csAddr:l,serverList:null,opid:_,ec:v.code,csIp:v.data&&v.data.csIp,unilbsServerIds:[$n.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:E}),isHttp3:p}),w.warning("[".concat(n.clientId,"] Choose server network error, retry"),v),!0)),a)}function ev(s,n,r,a){let l,{url:d,areaCode:h,serviceIds:p}=s;const m=Date.now(),[_,E]=nT(n,h,p);let v;return gs(x(function*(){v&&on.networkState===Yi.OFFLINE&&on.onlineWaiter&&(yield z.race([on.onlineWaiter,gi(a&&a.maxRetryTimeout||Re.maxRetryTimeout)])),v=on.networkState;const{data:b,headers:T}=yield xt(d,{data:_,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l="1"===T.http3?1:-1,Se.reportResourceTiming(d,n.sid),Yf(b,d,n,m,p,l);const O=JO(b,$n.CHOOSE_SERVER),P=JO(b,"proxy5"===n.cloudProxyServer?$n.CLOUD_PROXY_5:"proxy3"===n.cloudProxyServer||"proxy4"===n.cloudProxyServer?$n.CLOUD_PROXY:$n.CLOUD_PROXY_FALLBACK);return tv(O),{gatewayInfo:qf(O,d),proxyInfo:P,url:d}}),b=>(b.gatewayInfo&&Se.joinChooseServer(n.sid,{lts:m,succ:!0,csAddr:d,serverList:b.gatewayInfo.gatewayAddrs.map(T=>T.address),ec:null,opid:E,cid:b.gatewayInfo.cid.toString(),uid:b.gatewayInfo.uid.toString(),csIp:b.gatewayInfo.csIp,unilbsServerIds:p.toString(),isHttp3:l}),b.proxyInfo&&Se.joinWebProxyAP(n.sid,{lts:m,sucess:1,apServerAddr:d,turnServerAddrList:b.proxyInfo.addresses.map(T=>T.ip).join(","),errorCode:null,eventType:n.cloudProxyServer,unilbsServerIds:p.toString()}),!1),b=>b.code!==M.OPERATION_ABORTED&&(b.code===M.CAN_NOT_GET_GATEWAY_SERVER?b.data.retry:(Se.joinWebProxyAP(n.sid,{lts:m,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:b.code,eventType:n.cloudProxyServer,unilbsServerIds:p.toString(),extend:JSON.stringify({networkState:v})}),w.warning("[".concat(n.clientId,"] multi unilbs network error, retry"),b),!0)),a)}const Yf=(s,n,r,a,l,d)=>{const h=[],p=m=>{4096===m.flag?Se.joinChooseServer(r.sid,{lts:a,succ:!1,csAddr:n,opid:s.opid,serverList:null,ec:m.error.message,csIp:m.error.data&&m.error.data.csIp,unilbsServerIds:l.toString(),isHttp3:d}):1048576!==m.flag&&4194304!==m.flag&&4194310!==m.flag||Se.joinWebProxyAP(r.sid,{lts:a,sucess:0,apServerAddr:n,turnServerAddrList:null,errorCode:m.error.code,eventType:r.cloudProxyServer,unilbsServerIds:l.toString()})};if(s.response_body.forEach(m=>{const _=m.buffer.code;if(23===m.uri&&0===_&&!m.buffer.edges_services)if(4194310===m.buffer.flag)w.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),m.buffer.edges_services=[];else{const E={error:new W(M.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:s.detail[502]}),flag:m.buffer.flag};h.push(E),p(E)}if(0!==_){const E=Df(_),v={error:new W(M.CAN_NOT_GET_GATEWAY_SERVER,E.desc,{desc:E.desc,retry:E.retry,csIp:s.detail[502]}),flag:m.buffer.flag};4194310===m.buffer.flag?w.warning(v.error.toString()):h.push(v),p(v)}}),h.length)throw w.warning("[".concat(r.clientId,"] multi unilbs ").concat(n," failed, ").concat(h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message,", retry: ").concat(m.error.data.retry)).join(" | "))),new W(M.CAN_NOT_GET_GATEWAY_SERVER,h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message)).join(" | "),{retry:!!h.find(m=>m.error.data.retry),csIp:s.detail[502],desc:[...new Set(h.map(m=>{var _;return null==m||null===(_=m.error)||void 0===_||null===(_=_.data)||void 0===_?void 0:_.desc}).filter(m=>!!m))]})},tv=s=>{var n,r,a,l;if(s.addresses&&0===s.addresses.length&&0===s.code)throw new W(M.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:s.detail&&s.detail[502]});if(j("AP_AREA")&&(null!==(a=s.detail)&&void 0!==a&&a[23]&&"string"==typeof(null===(l=s.detail)||void 0===l?void 0:l[23])?tN(s.detail[23].toLowerCase()):tN()),null!==(n=s.detail)&&void 0!==n&&n[19]&&"string"==typeof(null===(r=s.detail)||void 0===r?void 0:r[19])){const h=s.detail[19],p=h?.split(";");for(let m=0;m<p.length;m++){var d;const _=UD(d=p[m]).call(d);s.addresses[m]&&p&&(s.addresses[m].fingerprint=_)}}if(j("GATEWAY_ADDRESS")&&j("GATEWAY_ADDRESS").length>0){w.debug("assign gateway address to",j("GATEWAY_ADDRESS"));const h=j("GATEWAY_ADDRESS").map(p=>{var m,_;const E=null!==(m=null===(_=s.addresses.find(v=>v.ip===p.ip&&v.port===p.port))||void 0===_?void 0:_.fingerprint)&&void 0!==m?m:"";return{ip:p.ip,port:p.port,ticket:s.addresses[0]&&s.addresses[0].ticket,fingerprint:E}});s.addresses=h}},JL=(s,n)=>{if(s.response_body&&s.response_body.length){const r=s.response_body[0];if(0!==r.buffer.code){const a=Df(r.buffer.code);throw new W(M.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return r.buffer.ticket}throw w.debug("update ticket request received ap response without response body:",n),new W(M.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},nT=(s,n,r)=>{const a=Math.floor(1e12*Math.random()),l={appid:s.appId,client_ts:Date.now(),opid:a,sid:s.sid,request_bodies:[{uri:22,buffer:{cname:s.cname,detail:Nh({6:s.stringUid,11:n,12:j("USE_NEW_TOKEN")?"1":void 0,22:n},j("AP_RTM")?{26:"RTM2"}:{}),key:s.token,service_ids:r,uid:s.uid||0}}]};l.request_bodies.forEach(h=>{s.multiIP&&s.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[s.multiIP.uni_lbs_ip],vos_ip:[s.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",JSON.stringify(l)),[d,a]},QL=(s,n)=>{const r=Math.floor(1e12*Math.random()),a={appid:s.appId,client_ts:Date.now(),opid:r,sid:s.sid,request_bodies:[{uri:28,buffer:{cname:s.cname,detail:{1:"",6:s.stringUid,12:"1"},token:s.token,service_ids:n,uid:s.uid||0,edges_services:s.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},l=new FormData;return l.append("request",JSON.stringify(a)),[l,r]};let Ph=0;function Mh(s){return z.all(s.map(n=>n.then(r=>{throw r},r=>r))).then(n=>{throw n},n=>n)}const $f=function(){var s=x(function*(n){let{fragementLength:r,referenceList:a,asyncMapHandler:l,allFailedhandler:d,promisesCollector:h}=n,p=0;const m=r;let _,E=0;const v=function(){var b=x(function*(){const T=(()=>{const O=p*m;return a.slice(O,O+m).map(l)})();h&&h.push(...T);try{_=yield Mh(T)}catch(O){if(E+=m,p++,!(E>=a.length))return void(yield v());d(O)}T.forEach(O=>O.cancel())});return function(){return b.apply(this,arguments)}}();return yield v(),_});return function(r){return s.apply(this,arguments)}}();function nv(s,n,r,a){return iT.apply(this,arguments)}function iT(){return iT=x(function*(s,n,r,a){return{gatewayInfo:yield(d=x(function*(h,p,m,_){let E=null;const v=[],b=function(){var O=x(function*(){const P=j("WEBCS_DOMAIN").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(V=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:QE()})),D=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(V=>V.url)}),L=yield $f({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:V=>(w.debug("[".concat(h.clientId,"] Connect to choose_server:"),V.url),tT(V,h,p,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},D),V[0]},promisesCollector:v});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},D),L});return function(){return O.apply(this,arguments)}}(),T=function(){var O=x(function*(){if(yield gi(1e3),null!==E)return E;const P=j("WEBCS_DOMAIN_BACKUP_LIST").map(V=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:QE()})),D=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(V=>V.url)}),L=yield $f({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:V=>(w.debug("[".concat(h.clientId,"] Connect to backup choose_server:"),V.url),tT(V,h,p,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},D),V[0]},promisesCollector:v});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},D),L});return function(){return O.apply(this,arguments)}}();try{return E=yield Mh([b(),T()]),v.length&&v.forEach(O=>O.cancel&&"function"==typeof O.cancel&&O.cancel()),E}catch(O){throw O[0]}}),function(h,p,m,_){return d.apply(this,arguments)})(s,n,r,a)};var d}),iT.apply(this,arguments)}function rT(s,n,r,a,l){return xh.apply(this,arguments)}function xh(){return xh=x(function*(s,n,r,a,l){const d=s.cloudProxyServer;if("disabled"===d){if(!a)return;if(s.useLocalAccessPoint)return yield nv(s,n,r,l);if(j("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:_,proxyInfo:E}=yield sT(s,n,r,l);return s.turnServer&&"auto"!==s.turnServer.mode||(s.turnServer={mode:"manual",servers:E.map(v=>({turnServerURL:v.address,tcpport:v.tcpport||Eo.tcpport,udpport:v.udpport||Eo.udpport,username:v.username||Eo.username,password:v.password||Eo.password,forceturn:!1,security:!0}))}),{gatewayInfo:_}}return yield nv(s,n,r,l)}const{proxyInfo:h,gatewayInfo:p}=yield sT(s,n,r,l),m={gatewayInfo:p};return s.turnServer={mode:"manual",servers:h.map(_=>({turnServerURL:_.address,tcpport:"proxy3"===d?void 0:_.tcpport?_.tcpport:Eo.tcpport,udpport:"proxy4"===d?void 0:_.udpport?_.udpport:Eo.udpport,username:_.username||Eo.username,password:_.password||Eo.password,forceturn:"proxy4"!==d,security:"proxy5"===d}))},w.debug("[".concat(s.clientId,"] set proxy server: ").concat(s.proxyServer,", mode: ").concat(d)),m}),xh.apply(this,arguments)}function kh(s,n,r,a,l){return oT.apply(this,arguments)}function oT(){return oT=x(function*(s,n,r,a,l){let h=[];h=j("ACCOUNT_REGISTER").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(n.proxyServer?m=>"https://".concat(n.proxyServer,"/ap/?url=").concat(m+"/api/v1"):m=>"https://".concat(m,"/api/v1"));const p=l?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const m=yield(_=x(function*(E,v,b,T,O){const P=Date.now(),D={sid:b.sid,opid:10,appid:b.appId,string_uid:v};let L=E[0];const V=yield gs(()=>xt(L+"".concat(-1===L.indexOf("?")?"?":"&","action=stringuid"),{data:D,cancelToken:T,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(U,J)=>{if(0===U.code){if(U.uid<=0||U.uid>=Math.pow(2,32))throw w.error("Invalid Uint Uid ".concat(v," => ").concat(U.uid),U),Se.reqUserAccount(D.sid,{lts:P,success:!1,serverAddr:L,stringUid:D.string_uid,uid:U.uid,errorCode:M.INVALID_UINT_UID_FROM_STRING_UID,extend:D}),new W(M.INVALID_UINT_UID_FROM_STRING_UID);return Se.reqUserAccount(D.sid,{lts:P,success:!0,serverAddr:L,stringUid:D.string_uid,uid:U.uid,errorCode:null,extend:D}),!1}const se=Df(U.code);return se.retry&&(L=E[(J+1)%E.length]),Se.reqUserAccount(D.sid,{lts:P,success:!1,serverAddr:L,stringUid:D.string_uid,uid:U.uid,errorCode:se.desc,extend:D}),se.retry},(U,J)=>U.code!==M.OPERATION_ABORTED&&(Se.reqUserAccount(D.sid,{lts:P,success:!1,serverAddr:L,stringUid:D.string_uid,uid:null,errorCode:U.code,extend:D}),L=E[(J+1)%E.length],!0),O);if(0!==V.code){const U=Df(V.code);throw new W(M.UNEXPECTED_RESPONSE,U.desc)}return V}),function(E,v,b,T,O){return _.apply(this,arguments)})(h,s,n,r,a);return l?.recordJoinChannelService({status:"success",endTs:Date.now()},p),m.uid}catch(m){throw l?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},p),m}var _}),oT.apply(this,arguments)}function Xf(){return Xf=x(function*(s,n,r){const a=j("CDS_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(p=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(p+"/api/v1"):"https://".concat(p,"/api/v1?action=config")).map(p=>function(m,_,E,v){const b=dt(),T={flag:64,cipher_method:0,features:{device:b.name,system:b.os,system_general:navigator.userAgent,vendor:_.appId,version:$o,cname:_.cname,sid:_.sid,session_id:_.sid,detail:"",proxyServer:_.proxyServer}};return gs(()=>xt(m,{data:T,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,O=>O.code!==M.OPERATION_ABORTED,v)}(p,s,n,r));let l=null,d=null,h={};try{l=yield Mh(a)}catch(p){if(p.code===M.OPERATION_ABORTED)throw p;d=p}if(a.forEach(p=>p.cancel()),Se.reportApiInvoke(s.sid,{name:Nn.REQUEST_CONFIG_DISTRIBUTE,options:{error:d,res:l}}).onSuccess(),l&&l.test_tags)try{h=function(p){if(!p.test_tags)return{};const m=p.test_tags,_=Object.keys(m),E={};return _.forEach(v=>{var b;const T=UD(b=v.slice(4)).call(b),O=JSON.parse(m[v])[1];E[T]=O}),E}(l)}catch{}return h}),Xf.apply(this,arguments)}function sT(s,n,r,a){return aT.apply(this,arguments)}function aT(){return aT=x(function*(s,n,r,a){const l=j("PROXY_SERVER_TYPE3"),d=(T,O,P)=>{let D=P||l;return Array.isArray(D)&&(D=O%2==0?l[1]:l[0]),"https://".concat(D,"/ap/?url=").concat(T)};let h=null;const p=[],m=function(){var T=x(function*(){const O=j("WEBCS_DOMAIN").slice(0,j("AJAX_REQUEST_CONCURRENT")).map((L,V)=>{let U;return U="disabled"===s.cloudProxyServer&&s.proxyServer?d("".concat(L,"/api/v2/transpond/webrtc?v=2"),V,s.proxyServer):"disabled"===s.cloudProxyServer||"fallback"===s.cloudProxyServer?"https://".concat(L,"/api/v2/transpond/webrtc?v=2"):d("".concat(L,"/api/v2/transpond/webrtc?v=2"),V),{url:U,areaCode:QE(),serviceIds:[$n.CHOOSE_SERVER,"proxy5"===s.cloudProxyServer?$n.CLOUD_PROXY_5:"proxy3"===s.cloudProxyServer||"proxy4"===s.cloudProxyServer?$n.CLOUD_PROXY:$n.CLOUD_PROXY_FALLBACK]}}),P=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(L=>L.url)}),D=yield $f({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:L=>(w.debug("[".concat(s.clientId,"] Connect to choose_server:"),L.url),ev(L,s,n,r)),allFailedhandler:L=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:L},P),L[0]},promisesCollector:p});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},P),D});return function(){return T.apply(this,arguments)}}(),_=function(){var T=x(function*(){if(yield gi(1e3),null!==h)return h;const O=j("WEBCS_DOMAIN_BACKUP_LIST").map((L,V)=>{let U;return U="disabled"===s.cloudProxyServer&&s.proxyServer?d("".concat(L,"/api/v2/transpond/webrtc?v=2"),V,s.proxyServer):"disabled"===s.cloudProxyServer||"fallback"===s.cloudProxyServer?"https://".concat(L,"/api/v2/transpond/webrtc?v=2"):d("".concat(L,"/api/v2/transpond/webrtc?v=2"),V),{url:U,areaCode:QE(),serviceIds:[$n.CHOOSE_SERVER,"proxy5"===s.cloudProxyServer?$n.CLOUD_PROXY_5:"proxy3"===s.cloudProxyServer||"proxy4"===s.cloudProxyServer?$n.CLOUD_PROXY:$n.CLOUD_PROXY_FALLBACK]}}),P=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(L=>L.url)}),D=yield $f({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:L=>(w.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),L.url),ev(L,s,n,r)),allFailedhandler:L=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:L},P),L[0]},promisesCollector:p});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},P),D});return function(){return T.apply(this,arguments)}}();let E,v,b;try{({gatewayInfo:E,proxyInfo:v,url:b}=yield Mh([m(),_()]))}catch(T){throw T[0]}if(p.length&&p.forEach(T=>T.cancel&&"function"==typeof T.cancel&&T.cancel()),!E||!v)throw new W(M.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(s.apUrl=b,"disabled"!==s.cloudProxyServer&&Array.isArray(l)&&b){const T=/^https?:\/\/(.+?)(\/.*)?$/.exec(b)[1];ye(l).call(l,T)&&(s.proxyServer=T,w.setProxyServer(T),Se.setProxyServer(T))}return h={gatewayInfo:E,proxyInfo:yield zV(v,E.uid)},h}),aT.apply(this,arguments)}function iv(s,n,r,a){return cT.apply(this,arguments)}function cT(){return cT=x(function*(s,n,r,a){const l=j("UAP_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(d=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap"));return yield function ZE(s,n,r,a,l){ZC+=1;const d={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:ZC,requestId:ZC,version:$o,cname:r.cname},h={service_name:n,json_body:JSON.stringify(d)};let p,m,_=s[0];return gs(x(function*(){p=Date.now();const E=yield xt(_,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-p,0!==E.code){const T=new W(M.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:m});throw w.error(T.toString()),T}const v=JSON.parse(E.json_body);if(200!==v.code){const T=new W(M.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(v.code,", reason: ").concat(v.reason),{code:v.code,responseTime:m});throw w.error(T.toString()),T}if(!v.servers||0===v.servers.length){const T=new W(M.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:v.code,responseTime:m});throw w.error(T.toString()),T}const b=(O=n,{addressList:(T=v).servers.map(P=>"wss://".concat(P.address.replace(/\./g,"-"),".").concat(j("WORKER_DOMAIN"),":").concat(P.wss,"?serviceName=").concat(encodeURIComponent(O))),workerToken:T.workerToken,vid:T.vid});var T,O;return j("LIVE_STREAMING_ADDRESS")&&(b.addressList=j("LIVE_STREAMING_ADDRESS")instanceof Array?j("LIVE_STREAMING_ADDRESS"):[j("LIVE_STREAMING_ADDRESS")]),Nh(Nh({},b),{},{responseTime:m})}),(E,v)=>(Se.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:n,responseDetail:JSON.stringify(E.addressList),firstSuccess:0===v,responseTime:m,serverIp:s[v%s.length]}),!1),(E,v)=>(Se.apworkerEvent(r.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:n,responseTime:m,serverIp:s[v%s.length]}),!!(E.code!==M.OPERATION_ABORTED&&E.code!==M.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(_=s[(v+1)%s.length],!0)),l)}(l,s,n,r,a)}),cT.apply(this,arguments)}function lT(){return lT=x(function*(s,n,r){const a=j("UAP_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(l=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(l+"/api/v1?action=uap"):"https://".concat(l,"/api/v1?action=uap")).map(l=>function(d,h,p,m){const _={command:"convergeAllocateEdge",sid:h.sid,appId:h.appId,token:h.token,ts:Date.now(),version:$o,cname:h.cname,uid:h.uid.toString(),requestId:eT,seq:eT};eT+=1;const E={service_name:"tele_channel",json_body:JSON.stringify(_)};return gs(x(function*(){const v=yield xt(d,{data:E,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==v.code){const T=new W(M.UNEXPECTED_RESPONSE,"cross channel ap error, code"+v.code,{retry:!0});throw w.error(T.toString()),T}const b=JSON.parse(v.json_body);if(200!==b.code){const T=new W(M.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(b.code,", reason: ").concat(b.reason));throw w.error(T.toString()),T}if(!b.servers||0===b.servers.length){const T=new W(M.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw w.error(T.toString()),T}return{vid:b.vid,workerToken:b.workerToken,addressList:(j("CHANNEL_MEDIA_RELAY_SERVERS")||b.servers).map(T=>"wss://".concat(T.address.replace(/\./g,"-"),".").concat(j("WORKER_DOMAIN"),":").concat(T.wss))}}),void 0,v=>!!(v.code!==M.OPERATION_ABORTED&&v.code!==M.UNEXPECTED_RESPONSE||v.data&&v.data.retry),m)}(l,s,n,r));try{const l=yield Mh(a);return a.forEach(d=>d.cancel()),l}catch(l){throw l[0]}}),lT.apply(this,arguments)}function uT(){return uT=x(function*(s,n,r){let a=null;const l=[],d=function(){var h=x(function*(p){const m=j(p?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return p&&(yield gi(1e3),null!==a)?a:yield $f({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(w.debug("[".concat(s.clientId,"] update ticket, Connect to ").concat(p?"backup":""," choose_server:"),_),function(E,v,b,T){const[O]=QL(v,[$n.CHOOSE_SERVER]);let P=on.networkState;return gs(x(function*(){P&&on.networkState===Yi.OFFLINE&&on.onlineWaiter&&(yield z.race([on.onlineWaiter,gi(T&&T.maxRetryTimeout||Re.maxRetryTimeout)])),P=on.networkState;const D=yield xt(E,{data:O,cancelToken:b,headers:{"Content-Type":"multipart/form-data;"}},!0);return JL(D,E)}),()=>!1,D=>D.code!==M.OPERATION_ABORTED&&(D.code===M.UPDATE_TICKET_FAILED?D.data.retry:(w.warning("[".concat(v.clientId,"] update ticket network error, retry"),D),!0)),T)}(_,s,n,r)),allFailedhandler:_=>{throw _[0]},promisesCollector:l})});return function(m){return h.apply(this,arguments)}}();try{return a=yield Mh([d(!1),d(!0)]),l.length&&l.forEach(h=>h.cancel&&"function"==typeof h.cancel&&h.cancel()),a}catch(h){throw h[0]}}),uT.apply(this,arguments)}function iN(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function rN(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?iN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):iN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class hT extends qt{constructor(){super(),C(this,"configs",void 0),C(this,"joinInfo",void 0),C(this,"cancelToken",void 0),C(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),C(this,"interval",void 0),C(this,"mutex",new Zn("config-distribute")),C(this,"mutableParamsRead",!1)}startGetConfigDistribute(n,r){this.joinInfo=n,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),j("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},j("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}awaitConfigDistributeComplete(){var n=this;return x(function*(){n.mutex.isLocked&&(yield n.mutex.lock())()})()}updateConfigDistribute(){var n=this;return x(function*(){if(n.mutableParamsRead||(n.mutableParamsRead=!0,Se.reportApiInvoke(null,{options:void 0,name:Nn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Jt.TRACER}).onSuccess(JSON.stringify(Ys))),!n.joinInfo||!n.cancelToken||!n.retryConfig)return void w.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const a=yield n.mutex.lock();try{r=yield function ZL(s,n,r){return Xf.apply(this,arguments)}(n.joinInfo,n.cancelToken,n.retryConfig),w.debug("[config-distribute] get config distribute",JSON.stringify(r)),r.limit_bitrate&&n.handleBitrateLimit(r.limit_bitrate),n.cacheGlobalParameterConfig(r),n.configs=r}catch(l){const d=new W(M.NETWORK_RESPONSE_ERROR,l);w.warning("[config-distribute] ".concat(d.toString()))}finally{a()}})()}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(n){var r;(r=n)&&r.uplink&&r.id&&void 0!==r.uplink.max_bitrate&&void 0!==r.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==n.id&&this.emit(Af.UPDATE_BITRATE_LIMIT,n):this.emit(Af.UPDATE_BITRATE_LIMIT,n))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&rN({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(n){var r;const a=Zc(r=Object.keys(n).filter(d=>/^webrtc_ng_global_parameter/.test(d))).call(r);for(let d=0;d<a.length;d++)for(let h=a.length-1;h>d;h--){const p=a[h];if("number"==typeof n[p].__priority){const _=a[h-1];if("number"==typeof n[_].__priority){if(!(n[p].__priority>n[_].__priority))continue;{const E=p;a[h]=a[h-1],a[h-1]=E}}else{const E=p;a[h]=a[h-1],a[h-1]=E}}}const l={};a.forEach(d=>{const h=n[d],p=h.__expires;Object.keys(h).forEach(m=>{"__priority"===m||"__expires"===m||Object.prototype.hasOwnProperty.call(l,m)||(l[m]=rN({value:h[m]},p&&{expires:p}))})});try{!function(p){try{const m=Date.now();Object.keys(p).forEach(_=>{switch(_){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":if(Object.prototype.hasOwnProperty.call(oi,_)){const{value:E,expires:v}=p[_];if(v&&v<=m)return;Ys[_]=E,oi[_]=E,w.debug("Update global parameters from config distribute",_,E)}}})}catch(m){w.error("Error update config immediately: ".concat(p),m.message)}}(l);const d=JSON.stringify(l),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),w.debug("Caching global parameters ".concat(d))}catch(d){w.error("Error caching global parameters:",d.message)}}}function rv(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Lh(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?rv(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):rv(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class t2 extends qt{constructor(n,r,a,l){super(),C(this,"spec",void 0),C(this,"token",void 0),C(this,"websocket",void 0),C(this,"pingpongTimer",void 0),C(this,"reconnectMode","retry"),C(this,"serviceMode",void 0),C(this,"reqId",0),C(this,"commandReqId",0),C(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),C(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):this.serviceMode===Bn.INJECT?this.emit(Xo.INJECT_STREAM_STATUS,h):(Se.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Bn.TRANSCODE?1:2}),this.emit(Xo.PUBLISH_STREAM_STATUS,h))}),this.spec=r,this.token=n,this.serviceMode=l,this.websocket=new Of("live-streaming",a),this.websocket.on(xe.CONNECTED,this.handleWebSocketOpen),this.websocket.on(xe.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(xe.REQUEST_NEW_URLS,(d,h)=>{Qt(this,Xo.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(xe.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(n){return this.websocket.init(n)}request(n,r,a,l){var d=this;return x(function*(){d.reqId+=1,"request"===n&&(d.commandReqId+=1);const h=d.commandReqId,p=d.reqId;if(!p||!d.websocket)throw new W(M.UNEXPECTED_ERROR);const m=Lh({command:n,sdkVersion:"4.19.2"===$o?"0.0.1":$o,seq:p,requestId:p,allocate:a,cname:d.spec.cname,appId:d.spec.appId,sid:d.spec.sid,uid:d.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if("closed"===d.websocket.state)throw new W(M.WS_DISCONNECT);const _=()=>new z((T,O)=>{d.websocket.once(xe.CLOSED,()=>O(new W(M.WS_ABORT))),d.websocket.once(xe.CONNECTED,T)});"connected"!==d.websocket.state&&(yield _()),m.clientRequest&&(m.clientRequest.workerToken=d.token);const E=new z((T,O)=>{const P=()=>{O(new W(M.WS_ABORT))};d.websocket.once(xe.RECONNECTING,P),d.websocket.once(xe.CLOSED,P),d.once("@".concat(p,"-").concat(d.spec.sid),D=>{T(D)})});l&&Se.workerEvent(d.spec.sid,Lh(Lh({},l),{},{requestId:h,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));const v=Date.now();d.websocket.sendMessage(m);let b=null;try{b=yield E}catch(T){if("closed"===d.websocket.state)throw T;return yield _(),yield d.request(n,r,a)}return l&&Se.workerEvent(d.spec.sid,Lh(Lh({},l),{},{requestId:h,actionType:"response",payload:JSON.stringify(b.serverResponse),serverCode:b.code,success:200===b.code,responseTime:Date.now()-v})),200!==b.code&&d.handleResponseError(b),b})()}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const n="4.19.2"===$o?"0.0.1":$o;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:n,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(n){switch(n.code){case Sn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void w.warning("live stream response already exists stream");case Sn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Sn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Sn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new W(M.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:n.code}).throw();case Sn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===n.serverResponse.command||"UninjectStream"===n.serverResponse.command)return;throw new W(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Sn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new W(M.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:n.code}).throw();case Sn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const r=new W(M.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Xo.WARNING,r,n.serverResponse.url)}case Sn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const r=new W(M.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Xo.WARNING,r,n.serverResponse.url)}case Sn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new W(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Sn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new W(M.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:n.code}).throw();case Sn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const r=new W(M.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Xo.WARNING,r,n.serverResponse.url)}case Sn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new W(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code}).throw();case Sn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new W(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Sn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Sn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===n.serverResponse.command||"UninjectStream"===n.serverResponse.command)return;throw new W(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Sn.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===n.serverResponse.command||"UninjectStream"===n.serverResponse.command)return;if("UpdateTranscoding"===n.serverResponse.command||"ControlStream"===n.serverResponse.command)return new W(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:n.code}).throw();throw new W(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Sn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new W(M.LIVE_STREAMING_CDN_ERROR,"",{code:n.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(hf)},6e3)}}function n2(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Cr(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?n2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):n2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class pT extends qt{constructor(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Re,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Re;super(),C(this,"onLiveStreamWarning",void 0),C(this,"onLiveStreamError",void 0),C(this,"onInjectStatusChange",void 0),C(this,"spec",void 0),C(this,"retryTimeout",1e4),C(this,"connection",void 0),C(this,"httpRetryConfig",void 0),C(this,"wsRetryConfig",void 0),C(this,"streamingTasks",new Map),C(this,"isStartingStreamingTask",!1),C(this,"taskMutex",new Zn("live-streaming")),C(this,"cancelToken",Er.CancelToken.source()),C(this,"transcodingConfig",void 0),C(this,"injectConfig",Cr({},TD)),C(this,"injectLoopTimes",0),C(this,"uapResponse",void 0),C(this,"lastTaskId",1),C(this,"statusError",new Map),this.spec=n,this.httpRetryConfig=a,this.wsRetryConfig=r}setTranscodingConfig(n){var r=this;return x(function*(){const a=Cr(Cr({},Xk),n);var p;66!==a.videoCodecProfile&&77!==a.videoCodecProfile&&100!==a.videoCodecProfile&&(w.debug("[".concat(r.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(a.videoCodecProfile," -> 100")),a.videoCodecProfile=100),a.transcodingUsers||(a.transcodingUsers=a.userConfigs),a.transcodingUsers&&(a.transcodingUsers=a.transcodingUsers.map(p=>Cr(Cr(Cr({},CD),p),{},{zOrder:p.zOrder?p.zOrder+1:1}))),kt((p=a).width)||ft(p.width,"config.width",0,1e4),kt(p.height)||ft(p.height,"config.height",0,1e4),kt(p.videoBitrate)||ft(p.videoBitrate,"config.videoBitrate",1,1e6),kt(p.videoFrameRate)||ft(p.videoFrameRate,"config.videoFrameRate"),kt(p.lowLatency)||_s(p.lowLatency,"config.lowLatency"),kt(p.audioSampleRate)||gn(p.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),kt(p.audioBitrate)||ft(p.audioBitrate,"config.audioBitrate",1,128),kt(p.audioChannels)||gn(p.audioChannels,"config.audioChannels",[1,2,3,4,5]),kt(p.videoGop)||ft(p.videoGop,"config.videoGop"),kt(p.videoCodecProfile)||gn(p.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),kt(p.userCount)||ft(p.userCount,"config.userCount",0,17),kt(p.backgroundColor)||ft(p.backgroundColor,"config.backgroundColor",0,16777215),kt(p.userConfigExtraInfo)||Un(p.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),p.transcodingUsers&&!kt(p.transcodingUsers)&&(fo(p.transcodingUsers,"config.transcodingUsers"),p.transcodingUsers.forEach((m,_)=>{qS(m.uid),kt(m.x)||ft(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),kt(m.y)||ft(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),kt(m.width)||ft(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),kt(m.height)||ft(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),kt(m.zOrder)||ft(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),kt(m.alpha)||ft(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),kt(p.watermark)||Rf(p.watermark,"watermark"),kt(p.backgroundImage)||Rf(p.backgroundImage,"backgroundImage"),p.images&&!kt(p.images)&&(fo(p.images,"config.images"),p.images.forEach((m,_)=>{Rf(m,"images[".concat(_,"]"))}));const l=[];a.images&&l.push(...a.images.map(p=>Cr(Cr(Cr({},KS),p),{},{zOrder:255}))),a.backgroundImage&&(l.push(Cr(Cr(Cr({},KS),a.backgroundImage),{},{zOrder:0})),delete a.backgroundImage),a.watermark&&(l.push(Cr(Cr(Cr({},KS),a.watermark),{},{zOrder:255})),delete a.watermark),a.images=l,a.transcodingUsers&&(a.userConfigs=a.transcodingUsers.map(p=>Cr({},p)),a.userCount=a.transcodingUsers.length,delete a.transcodingUsers);const d=(a.userConfigs||[]).map(p=>"number"==typeof p.uid?z.resolve(p.uid):kh(p.uid,r.spec,r.cancelToken.token,r.httpRetryConfig));if((yield z.all(d)).forEach((p,m)=>{a.userConfigs&&a.userConfigs[m]&&(a.userConfigs[m].uid=p)}),r.transcodingConfig=a,r.connection)try{var h;const p=yield r.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:r.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(yo(h=r.streamingTasks).call(h)).map(m=>m.taskId).join("#")});w.debug("[".concat(r.spec.clientId,"] update live transcoding config success, code: ").concat(p.code,", config:"),JSON.stringify(r.transcodingConfig))}catch(p){if(!p.data||!p.data.retry)throw p;p.data.changeAddress&&r.connection.tryNextAddress(),r.streamingTasks.forEach(m=>{w.warning("[".concat(r.spec.clientId,"] live streaming receive error"),p.toString(),"try to republish",m.url),r.startLiveStreamingTask(m.url,m.mode,p).then(()=>{w.debug("[".concat(r.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{w.error("[".concat(r.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),r.onLiveStreamError&&r.onLiveStreamError(m.url,_)})})}})()}setInjectStreamConfig(n,r){this.injectConfig=Object.assign({},this.injectConfig,n),this.injectLoopTimes=r}startLiveStreamingTask(n,r,a){var l=this;return x(function*(){var d;if(Array.from(yo(d=l.streamingTasks).call(d)).find(_=>_.mode===Bn.INJECT)&&r===Bn.INJECT)return new W(M.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!l.transcodingConfig&&r===Bn.TRANSCODE)throw new W(M.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let h={command:"PublishStream",ts:Date.now(),url:n,uid:l.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};w.debug("[".concat(l.spec.clientId,"] start live streaming ").concat(n,", mode: ").concat(r));const p=yield l.taskMutex.lock();if(!l.connection&&a)return void p();if(l.streamingTasks.get(n)&&!a)return p(),new W(M.LIVE_STREAMING_TASK_CONFLICT).throw();try{l.connection||(l.connection=yield l.connect(r))}catch(_){throw p(),_}switch(r){case Bn.TRANSCODE:h.transcodingConfig=Cr({},l.transcodingConfig);break;case Bn.RAW:break;case Bn.INJECT:h={cname:l.spec.cname,command:"InjectStream",sid:l.spec.sid,transcodingConfig:l.injectConfig,ts:Date.now(),url:n,loopTimes:l.injectLoopTimes}}l.uapResponse&&l.uapResponse.vid&&(h.vid=l.uapResponse.vid),l.isStartingStreamingTask=!0;const m=l.lastTaskId++;try{const _=new z((v,b)=>{gi(l.retryTimeout).then(()=>{if(a)return b(a);const T=l.statusError.get(n);return T?(l.statusError.delete(n),b(T)):void 0})}),E=yield z.race([l.connection.request("request",{clientRequest:h},!0,{url:n,command:"PublishStream",workerType:r===Bn.TRANSCODE?1:2,requestByUser:!a,tid:m.toString()}),_]);l.isStartingStreamingTask=!1,w.debug("[".concat(l.spec.clientId,"] live streaming started, code: ").concat(E.code)),l.streamingTasks.set(n,{clientRequest:h,mode:r,url:n,taskId:m}),p()}catch(_){if(p(),l.isStartingStreamingTask=!1,!_.data||!_.data.retry||a)throw _;return _.data.changeAddress?(l.connection.tryNextAddress(),yield l.startLiveStreamingTask(n,r,_)):yield l.startLiveStreamingTask(n,r,_)}})()}stopLiveStreamingTask(n){return new z((r,a)=>{const l=this.streamingTasks.get(n);if(!l||!this.connection)return new W(M.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=l.mode;l.abortTask=()=>{w.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(n),r()},this.connection.request("request",{clientRequest:{command:d===Bn.INJECT?"UninjectStream":"UnpublishStream",url:l.url}},!1,{url:n,command:"UnPublishStream",workerType:d===Bn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{w.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(n),0===this.streamingTasks.size&&d!==Bn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),r(),d===Bn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(pl.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,n)}).catch(a)})}controlInjectStream(n,r,a,l){var d=this;return x(function*(){const h=d.streamingTasks.get(n);if(!h||!d.connection||h.mode!==Bn.INJECT)throw new W(M.INVALID_OPERATION,"can not find inject stream task to control");return(yield d.connection.request("request",{clientRequest:{command:"ControlStream",url:n,control:r,audioVolume:a,position:l}})).serverResponse})()}resetAllTask(){var n;const r=Array.from(yo(n=this.streamingTasks).call(n));this.terminate();for(const a of r)this.startLiveStreamingTask(a.url,a.mode).catch(l=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,l)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Er.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}connect(n){var r=this;return x(function*(){if(r.connection)throw new W(M.UNEXPECTED_ERROR,"live streaming connection has already connected");const a=yield Qt(r,mh.REQUEST_WORKER_MANAGER_LIST,n);return r.uapResponse=a,r.connection=new t2(a.workerToken,r.spec,r.wsRetryConfig,n),r.connection.on(Xo.WARNING,(l,d)=>r.onLiveStreamWarning&&r.onLiveStreamWarning(d,l)),r.connection.on(Xo.PUBLISH_STREAM_STATUS,l=>r.handlePublishStreamServer(l)),r.connection.on(Xo.INJECT_STREAM_STATUS,l=>r.handleInjectStreamServerStatus(l)),r.connection.on(Xo.REQUEST_NEW_ADDRESS,(l,d)=>{if(!r.connection)return d(new W(M.UNEXPECTED_ERROR,"can not get new live streaming address list"));Qt(r,mh.REQUEST_WORKER_MANAGER_LIST,n).then(h=>{r.uapResponse=h,l(h.addressList)}).catch(d)}),yield r.connection.init(a.addressList),r.connection})()}handlePublishStreamServer(n){const r=n.serverStatus&&n.serverStatus.url||"empty_url",a=this.streamingTasks.get(r),l=n.reason;switch(n.code){case Sn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Sn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new W(M.LIVE_STREAMING_CDN_ERROR,"",{code:n.code});if(a)return w.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,h);if(!this.isStartingStreamingTask)return;this.statusError.set(r,h)}case Sn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new W(M.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,l);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,h)}case Sn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Sn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(yo(d=this.streamingTasks).call(d));for(const p of h)p.abortTask?p.abortTask():(w.warning("[".concat(this.spec.clientId,"] publish stream status code"),n.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new W(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code})).then(()=>{w.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(m=>{w.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,m)}));return}}}handleInjectStreamServerStatus(n){const r=Number(n.uid),a=n.serverStatus&&n.serverStatus.url;switch(n.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(pl.INJECT_STREAM_STATUS_START_SUCCESS,r,a));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(pl.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,r,a),void this.streamingTasks.delete(a);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(pl.INJECT_STREAM_STATUS_START_UNAUTHORIZED,r,a),void this.streamingTasks.delete(a);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(pl.INJECT_STREAM_STATUS_BROKEN,r,a),void this.streamingTasks.delete(a);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(pl.INJECT_STREAM_STATUS_START_TIMEOUT,r,a),void this.streamingTasks.delete(a);default:return void w.debug("inject stream server status",n)}}hasUrl(n){return this.streamingTasks.has(n)}}class Jf{constructor(){C(this,"destChannelMediaInfos",new Map),C(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(n){ID(n),this.srcChannelMediaInfo=n}addDestChannelInfo(n){ID(n),this.destChannelMediaInfos.set(n.channelName,n)}removeDestChannelInfo(n){oE(n),this.destChannelMediaInfos.delete(n)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function ov(s){if(!(s instanceof Jf))return new W(M.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const n=s.getSrcChannelMediaInfo(),r=s.getDestChannelMediaInfo();return n?0===r.size?new W(M.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new W(M.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class r2 extends qt{constructor(n,r,a){super(),C(this,"ws",void 0),C(this,"requestId",1),C(this,"heartBeatTimer",void 0),C(this,"joinInfo",void 0),C(this,"clientId",void 0),C(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),C(this,"onClose",l=>{this.emit("close"),this.dispose()}),C(this,"onMessage",l=>{const d=JSON.parse(l.data);if(!d||"serverResponse"!==d.command||!d.requestId)return d&&"serverStatus"===d.command&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=n,this.clientId=r,this.ws=new Of("cross-channel-".concat(this.clientId),a),this.ws.on(xe.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(xe.CONNECTED,this.onOpen),this.ws.on(xe.ON_MESSAGE,this.onMessage),this.ws.on(xe.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(n){const r=this.requestId++;return n.requestId=r,n.seq=r,this.ws.sendMessage(n),r}waitStatus(n){return new z((r,a)=>{const l=window.setTimeout(()=>{a(new W(M.TIMEOUT,"wait status timeout, status: ".concat(n)))},5e3);this.once(n,d=>{window.clearTimeout(l),d.state&&0!==d.state?a(new W(M.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(n))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(l),a(new W(M.WS_ABORT))})})}request(n){var r=this;return x(function*(){if("closed"===r.ws.state)throw new W(M.WS_DISCONNECT);"connected"!==r.ws.state&&(yield new z((p,m)=>{r.ws.once(xe.CLOSED,()=>m(new W(M.WS_ABORT))),r.ws.once(xe.CONNECTED,p)}));const l=r.sendMessage(n),d=new z((p,m)=>{const _=()=>{m(new W(M.WS_ABORT))};r.ws.once(xe.RECONNECTING,_),r.ws.once(xe.CLOSED,_),r.once("req_".concat(l),p),gi(3e3).then(()=>{r.removeAllListeners("req_".concat(l)),r.ws.off(xe.RECONNECTING,_),r.ws.off(xe.CLOSED,_),m(new W(M.TIMEOUT,"cross channel ws request timeout"))})}),h=yield d;if(!h||200!==h.code)throw new W(M.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(h)));return h})()}connect(n){var r=this;return x(function*(){r.ws.removeAllListeners(xe.REQUEST_NEW_URLS),r.ws.on(xe.REQUEST_NEW_URLS,a=>{a(n)}),yield r.ws.init(n)})()}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(n){const r=this.requestId++;return n.requestId=r,this.ws.sendMessage(n),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class oN extends qt{set state(n){n!==this._state&&(n!==Ji.RELAY_STATE_FAILURE&&(this.errorCode=fl.RELAY_OK),this.emit("state",n,this.errorCode),this._state=n)}get state(){return this._state}constructor(n,r,a,l,d){var h;super(),h=this,C(this,"joinInfo",void 0),C(this,"sid",void 0),C(this,"clientId",void 0),C(this,"cancelToken",Er.CancelToken.source()),C(this,"workerToken",void 0),C(this,"requestId",0),C(this,"signal",void 0),C(this,"prevChannelMediaConfig",void 0),C(this,"httpRetryConfig",void 0),C(this,"_resolution",void 0),C(this,"_state",Ji.RELAY_STATE_IDLE),C(this,"errorCode",fl.RELAY_OK),C(this,"onStatus",p=>{w.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(p))),p&&p.command&&("onAudioPacketReceived"===p.command&&this.emit("event",$s.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===p.command&&this.emit("event",$s.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===p.command&&(this.errorCode=fl.SRC_TOKEN_EXPIRED,this.state=Ji.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===p.command&&(this.errorCode=fl.DEST_TOKEN_EXPIRED,this.state=Ji.RELAY_STATE_FAILURE))}),C(this,"onReconnect",x(function*(){w.debug("[".concat(h.clientId,"] ChannelMediaSocket disconnect, reconnecting")),h.emit("event",$s.NETWORK_DISCONNECTED),h.state=Ji.RELAY_STATE_IDLE,h.prevChannelMediaConfig&&h.sendStartRelayMessage(h.prevChannelMediaConfig).catch(p=>{h.state!==Ji.RELAY_STATE_IDLE&&(w.error("auto restart channel media relay failed",p.toString()),h.errorCode=fl.SERVER_CONNECTION_LOST,h.state=Ji.RELAY_STATE_FAILURE)})})),this.joinInfo=n,this.clientId=r,this.sid=Hg(),this.signal=new r2(this.joinInfo,this.clientId,a),this.httpRetryConfig=l,this._resolution=d}startChannelMediaRelay(n){var r=this;return x(function*(){if(r.state!==Ji.RELAY_STATE_IDLE)throw new W(M.INVALID_OPERATION);r.state=Ji.RELAY_STATE_CONNECTING,yield r.connect(),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: connect success"));try{yield r.sendStartRelayMessage(n)}catch(a){throw a.data&&a.data.serverResponse&&"SetSourceChannel"===a.data.serverResponse.command?new W(M.CROSS_CHANNEL_FAILED_JOIN_SRC):a.data&&a.data.serverResponse&&"SetDestChannelStatus"===a.serverResponse.command?new W(M.CROSS_CHANNEL_FAILED_JOIN_DEST):a.data&&a.data.serverResponse&&"StartPacketTransfer"===a.serverResponse.command?new W(M.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):a}r.prevChannelMediaConfig=n})()}updateChannelMediaRelay(n){var r=this;return x(function*(){if(r.state!==Ji.RELAY_STATE_RUNNING)throw new W(M.INVALID_OPERATION);yield r.sendUpdateMessage(n),r.prevChannelMediaConfig=n})()}setVideoProfile(n){var r=this;return x(function*(){if(r._resolution=n,r.state!==Ji.RELAY_STATE_RUNNING)throw new W(M.INVALID_OPERATION);const a=r.genMessage(Ei.SetVideoProfile);yield r.signal.request(a),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: setVideoProfile success"))})()}stopChannelMediaRelay(){var n=this;return x(function*(){yield n.sendStopRelayMessage(),w.debug("[".concat(n.clientId,"] stopChannelMediaRelay: send stop message success")),n.state=Ji.RELAY_STATE_IDLE,n.dispose()})()}dispose(){w.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Er.CancelToken.source(),this.state=Ji.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}connect(){var n=this;return x(function*(){const r=yield function e2(s,n,r){return lT.apply(this,arguments)}(n.joinInfo,n.cancelToken.token,n.httpRetryConfig);n.workerToken=r.workerToken,yield n.signal.connect(r.addressList),n.emit("event",$s.NETWORK_CONNECTED),n.signal.on("status",n.onStatus),n.signal.on("reconnecting",n.onReconnect)})()}sendStartRelayMessage(n){var r=this;return x(function*(){const a=r.genMessage(Ei.StopPacketTransfer);yield r.signal.request(a),yield r.signal.waitStatus("Normal Quit"),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const l=r.genMessage(Ei.SetSdkProfile,n);yield r.signal.request(l),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const d=r.genMessage(Ei.SetSourceChannel,n);yield r.signal.request(d),yield r.signal.waitStatus("SetSourceChannelStatus"),r.emit("event",$s.PACKET_JOINED_SRC_CHANNEL),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const h=r.genMessage(Ei.SetSourceUserId,n);yield r.signal.request(h),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const p=r.genMessage(Ei.SetDestChannel,n);yield r.signal.request(p),yield r.signal.waitStatus("SetDestChannelStatus"),r.emit("event",$s.PACKET_JOINED_DEST_CHANNEL),w.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=r.genMessage(Ei.StartPacketTransfer,n);yield r.signal.request(m),r.emit("event",$s.PACKET_SENT_TO_DEST_CHANNEL),r.state=Ji.RELAY_STATE_RUNNING,w.debug("[".concat(r.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),r.setVideoProfile(r._resolution)})()}sendUpdateMessage(n){var r=this;return x(function*(){const a=r.genMessage(Ei.UpdateDestChannel,n);yield r.signal.request(a),r.emit("event",$s.PACKET_UPDATE_DEST_CHANNEL),w.debug("[".concat(r.clientId,"] sendUpdateMessage: UpdateDestChannel success"))})()}sendStopRelayMessage(){var n=this;return x(function*(){const r=n.genMessage(Ei.StopPacketTransfer);yield n.signal.request(r),w.debug("[".concat(n.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))})()}genMessage(n,r){const a=[],l=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:$o,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.19.2"===h.sdkVersion&&(h.sdkVersion="0.0.1");let p=null,m=null;switch(n){case Ei.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Ei.SetSourceChannel:if(m=r&&r.getSrcChannelMediaInfo(),!m)throw new W(M.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},h;case Ei.SetSourceUserId:if(m=r&&r.getSrcChannelMediaInfo(),!m)throw new W(M.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:m.uid+""},h;case Ei.SetDestChannel:if(p=r&&r.getDestChannelMediaInfo(),!p)throw new W(M.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{a.push(_.channelName),l.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:a,uid:l,token:d},h;case Ei.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Ei.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Ei.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Ei.UpdateDestChannel:if(p=r&&r.getDestChannelMediaInfo(),!p)throw new W(M.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{a.push(_.channelName),l.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:l,token:d},h;case Ei.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}class Oi{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(n,r){C(this,"uid",void 0),C(this,"_uintid",void 0),C(this,"_trust_in_room_",!0),C(this,"_trust_audio_enabled_state_",!0),C(this,"_trust_video_enabled_state_",!0),C(this,"_trust_audio_mute_state_",!0),C(this,"_trust_video_mute_state_",!0),C(this,"_audio_muted_",!1),C(this,"_video_muted_",!1),C(this,"_audio_enabled_",!0),C(this,"_video_enabled_",!0),C(this,"_audio_added_",!1),C(this,"_video_added_",!1),C(this,"_trust_video_stream_added_state_",!0),C(this,"_trust_audio_stream_added_state_",!0),C(this,"_audioTrack",void 0),C(this,"_videoTrack",void 0),C(this,"_dataChannels",[]),C(this,"_audioSSRC",void 0),C(this,"_videoSSRC",void 0),C(this,"_audioOrtc",void 0),C(this,"_videoOrtc",void 0),C(this,"_cname",void 0),C(this,"_rtxSsrcId",void 0),this.uid=n,this._uintid=r}}var sN=vA,aN=Ta;Ct({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var s=aN.f(this);return{promise:s.promise,resolve:s.resolve,reject:s.reject}}});var KV=Ta,Gd=$u;Ct({target:"Promise",stat:!0,forced:!0},{try:function(s){var n=KV.f(this),r=Gd(s);return(r.error?n.reject:n.resolve)(r.value),n.promise}});var fT=cr(sN),mT=Vs.f("asyncIterator"),_T=cr(mT);function Fh(s,n){this.v=s,this.k=n}function Uh(s){var n,r;function a(d,h){try{var p=s[d](h),m=p.value,_=m instanceof Fh;fT.resolve(_?m.v:m).then(function(E){if(_){var v="return"===d?"return":"next";if(!m.k||E.done)return a(v,E);E=s[v](E).value}l(p.done?"return":"normal",E)},function(E){a("throw",E)})}catch(E){l("throw",E)}}function l(d,h){switch(d){case"return":n.resolve({value:h,done:!0});break;case"throw":n.reject(h);break;default:n.resolve({value:h,done:!1})}(n=n.next)?a(n.key,n.arg):r=null}this._invoke=function(d,h){return new fT(function(p,m){var _={key:d,arg:h,resolve:p,reject:m,next:null};r?r=r.next=_:(n=r=_,a(d,h))})},"function"!=typeof s.return&&(this.return=void 0)}function cs(s){return function(){return new Uh(s.apply(this,arguments))}}function ht(s){return new Fh(s,0)}function Qf(s){var n={},r=!1;function a(l,d){return r=!0,{done:!1,value:new Fh(d=new fT(function(h){h(s[l](d))}),1)}}return n[void 0!==Jc&&Bp||"@@iterator"]=function(){return this},n.next=function(l){return r?(r=!1,l):a("next",l)},"function"==typeof s.throw&&(n.throw=function(l){if(r)throw r=!1,l;return a("throw",l)}),"function"==typeof s.return&&(n.return=function(l){return r?(r=!1,l):a("return",l)}),n}Uh.prototype["function"==typeof Jc&&_T||"@@asyncIterator"]=function(){return this},Uh.prototype.next=function(s){return this._invoke("next",s)},Uh.prototype.throw=function(s){return this._invoke("throw",s)},Uh.prototype.return=function(s){return this._invoke("return",s)};var cN=cr(mT),lN={exports:{}};!function(s,n){s.exports=(()=>{var r={8:(d,h,p)=>{p.r(h),p.d(h,{Parser:()=>Ee,Printer:()=>di,parse:()=>Le,print:()=>ut});const m="\n",_="".concat("\r").concat(m),E=" ";let v;function b(le){return le>="0"&&le<="9"}function T(le){return le>="!"&&le<="~"}function O(le){return T(le)||le>="\x80"&&le<="\xff"}function P(le){return"!"===le||le>="#"&&le<="'"||le>="*"&&le<="+"||le>="-"&&le<="."||le>="0"&&le<="9"||le>="A"&&le<="Z"||le>="^"&&le<="~"}function D(le){return le>="1"&&le<="9"}function L(le){return le>="A"&&le<="Z"||le>="a"&&le<="z"}function V(le){return"d"===le||"h"===le||"m"===le||"s"===le}function U(le){return le>"\x01"&&le<"\t"||le>"\v"&&le<"\f"||le>"\x0e"&&le<"\xff"}function J(le){return L(le)||b(le)||"+"===le||"/"===le}function se(le){return b(le)||L(le)||"+"===le||"/"===le||"-"===le||"_"===le}function q(le){return L(le)||b(le)||"+"===le||"/"===le}function Q(le,I){var F=Object.keys(le);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(le);I&&(H=H.filter(function(oe){return Object.getOwnPropertyDescriptor(le,oe).enumerable})),F.push.apply(F,H)}return F}function $(le){for(var I=1;I<arguments.length;I++){var F=null!=arguments[I]?arguments[I]:{};I%2?Q(Object(F),!0).forEach(function(H){Y(le,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(le,Object.getOwnPropertyDescriptors(F)):Q(Object(F)).forEach(function(H){Object.defineProperty(le,H,Object.getOwnPropertyDescriptor(F,H))})}return le}function Y(le,I,F){return I in le?Object.defineProperty(le,I,{value:F,enumerable:!0,configurable:!0,writable:!0}):le[I]=F,le}var le;(le=v||(v={})).VERSION="v",le.ORIGIN="o",le.SESSION_NAME="s",le.INFORMATION="i",le.URI="u",le.EMAIL="e",le.PHONE="p",le.CONNECTION="c",le.BANDWIDTH="b",le.TIME="t",le.REPEAT="r",le.ZONE_ADJUSTMENTS="z",le.KEY="k",le.ATTRIBUTE="a",le.MEDIA="m";class me{consumeText(I,F){let H=F;for(;H<I.length;){const oe=I[H];if("\0"===oe||"\r"===oe||oe===m)break;H+=1}if(H-F==0)throw new Error("Invalid text, at ".concat(I));return H}consumeUnicastAddress(I,F,H){return this.consumeTill(I,F,E)}consumeOneOrMore(I,F,H){let oe=F;for(;H(I[oe]);)oe++;if(oe-F==0)throw new Error("Invalid rule at ".concat(F,"."));return oe}consumeSpace(I,F){if(I[F]===E)return F+1;throw new Error("Invalid space at ".concat(F,"."))}consumeIP4Address(I,F){let H=F;for(let oe=0;oe<4;oe++)if(H=this.consumeDecimalUChar(I,H),3!==oe){if("."!==I[H])throw new Error("Invalid IP4 address.");H++}return H}consumeDecimalUChar(I,F){let H=F;for(let Be=0;Be<3&&b(I[H]);Be++,H++);if(H-F==0)throw new Error("Invalid decimal uchar.");const oe=parseInt(I.slice(F,H));if(oe>=0&&oe<=255)return H;throw new Error("Invalid decimal uchar")}consumeIP6Address(I,F){let H=this.consumeHexpart(I,F);return":"===I[H]&&(H+=1,H=this.consumeIP4Address(I,H)),H}consumeHexpart(I,F){let H=F;if(":"===I[H]&&":"===I[H+1]){H+=2;try{H=this.consumeHexseq(I,H)}catch{}return H}if(H=this.consumeHexseq(I,H),":"===I[H]&&":"===I[H+1]){H+=2;try{H=this.consumeHexseq(I,H)}catch{}return H}return H}consumeHexseq(I,F){let H=F;for(;H=this.consumeHex4(I,H),":"===I[H]&&":"!==I[H+1];)H+=1;return H}consumeHex4(I,F){let H=0;for(;H<4;H++)if(!((oe=I[F+H])>="0"&&oe<="9"||oe>="a"&&oe<="f"||oe>="A"&&oe<="F")){if(0===H)throw new Error("Invalid hex 4");break}var oe;return F+H}consumeFQDN(I,F){let H=F;for(;b(I[H])||L(I[H])||"-"===I[H]||"."===I[H];)H+=1;if(H-F<4)throw new Error("Invalid FQDN");return H}consumeExtnAddr(I,F){return this.consumeOneOrMore(I,F,O)}consumeMulticastAddress(I,F,H){switch(H){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(I,F);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(I,F);default:try{return this.consumeFQDN(I,F)}catch{return this.consumeExtnAddr(I,F)}}}consumeIP6MulticastAddress(I,F){const H=this.consumeHexpart(I,F);return"/"===I[H]?this.consumeInteger(I,H+1):H}consumeIP4MulticastAddress(I,F){let H=F+3;const oe=I.slice(F,H),Be=parseInt(oe);if(Be<224||Be>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Bt=0;Bt<3;Bt++){if("."!==I[H])throw new Error("Invalid IP4 multicast address.");H+=1,H=this.consumeDecimalUChar(I,H)}return"/"===I[H]&&(H+=1),H=this.consumeTTL(I,H),"/"===I[H]&&(H=this.consumeInteger(I,H)),H}consumeInteger(I,F){if(!D(I[F]))throw new Error("Invalid integer.");for(F+=1;b(I[F]);)F+=1;return F}consumeTTL(I,F){if("0"===I[F])return F+1;if(!D(I[F]))throw new Error("Invalid TTL.");F+=1;for(let H=0;H<2&&b(I[F]);H++)F+=1;return F}consumeToken(I,F){return this.consumeOneOrMore(I,F,P)}consumeTime(I,F){let H=F;if("0"===I[H])return H+1;for(D(I[H])&&(H+=1);b(I[H]);)H++;if(H-F<10)throw new Error("Invalid time");return H}consumeAddress(I,F){return this.consumeTill(I,F,E)}consumeTypedTime(I,F){let H=F;return H=this.consumeOneOrMore(I,H,b),V(I[H])?H+1:H}consumeRepeatInterval(I,F){if(!D(I[F]))throw new Error("Invalid repeat interval");for(F+=1;b(I[F]);)F+=1;return V(I[F])&&(F+=1),F}consumePort(I,F){return this.consumeOneOrMore(I,F,b)}consume(I,F,H){for(let oe=0;oe<H.length;oe++){if(F+oe>=I.length)throw new Error("consume exceeding value length");if(I[F+oe]!==H[oe])throw new Error("consume ".concat(H," failed at ").concat(oe))}return F+H.length}consumeTill(I,F,H){let oe=F;for(;oe<I.length&&("string"!=typeof H||I[oe]!==H)&&("function"!=typeof H||!H(I[oe]));)oe++;return oe}}class Ee extends me{constructor(){super(),Y(this,"records",[]),Y(this,"currentLine",0)}parse(I){const F=this.probeEOL(I);this.records=I.split(F).filter(An=>!!An.trim()).map(this.parseLine),this.currentLine=0;const H=this.parseVersion(),oe=this.parseOrigin(),Be=this.parseSessionName(),Bt=this.parseInformation(),Pi=this.parseUri(),sr=this.parseEmail(),Lr=this.parsePhone(),am=this.parseConnection(),zi=this.parseBandWidth(),qi=this.parseTimeFields(),Ml=this.parseKey(),Yd=this.parseSessionAttribute(),pn=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:H,origin:oe,sessionName:Be,information:Bt,uri:Pi,emails:sr,phones:Lr,connection:am,bandwidths:zi,timeFields:qi,key:Ml,attributes:Yd,mediaDescriptions:pn}}getCurrentRecord(){const I=this.records[this.currentLine];if(!I)throw new Error("Record doesn't exit.");return I}probeEOL(I){for(let F=0;F<I.length;F++)if(I[F]===m)return"\r"===I[F-1]?_:m;throw new Error("Invalid newline character.")}parseLine(I,F){if(I.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const H=I[0];if("="!==I[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:H,value:I.slice(2),line:F,cur:0}}parseSessionAttribute(){const I=new yt;for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==v.ATTRIBUTE)break;const H={attField:this.extractOneOrMore(F,oe=>P(oe)&&":"!==oe),_cur:0};":"===F.value[F.cur]&&(F.cur+=1,H.attValue=this.extractOneOrMore(F,U)),I.parse(H),this.currentLine++}return I.digest()}parseMediaAttributes(I){const F=new xn(I);for(;this.currentLine<this.records.length;){const H=this.getCurrentRecord();if(H.type!==v.ATTRIBUTE)break;const oe={attField:this.extractOneOrMore(H,Be=>P(Be)&&":"!==Be),_cur:0};":"===H.value[H.cur]&&(H.cur+=1,oe.attValue=this.extractOneOrMore(H,U)),F.parse(oe),this.currentLine++}return F.digest()}parseKey(){const I=this.getCurrentRecord();if(I.type===v.KEY){if("prompt"===I.value||"clear:"===I.value||"base64:"===I.value||"uri:"===I.value)return I.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const I=this.getCurrentRecord();if(I.type===v.ZONE_ADJUSTMENTS){const F=[];for(;;)try{const H=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);let oe=!1;"-"===I.value[I.cur]&&(oe=!0,I.cur+=1);const Be=this.extract(I,this.consumeTypedTime);F.push({time:H,typedTime:Be,back:oe})}catch{break}if(0===F.length)throw new Error("Invalid zone adjustments");return this.currentLine++,F}return[]}parseRepeat(){const I=[];for(;;){const F=this.getCurrentRecord();if(F.type!==v.REPEAT)break;{const H=this.extract(F,this.consumeRepeatInterval),oe=this.parseTypedTime(F);I.push({repeatInterval:H,typedTimes:oe}),this.currentLine++}}return I}parseTypedTime(I){const F=[];for(;;)try{this.consumeSpaceForRecord(I),F.push(this.extract(I,this.consumeTypedTime))}catch{break}if(0===F.length)throw new Error("Invalid typed time.");return F}parseTime(){const I=this.getCurrentRecord(),F=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);const H=this.extract(I,this.consumeTime);return this.currentLine++,{startTime:F,stopTime:H}}parseBandWidth(){const I=[];for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==v.BANDWIDTH)break;{const H=this.extractOneOrMore(F,P);if(":"!==F.value[F.cur])throw new Error("Invalid bandwidth field.");F.cur++;const oe=this.extractOneOrMore(F,b);I.push({bwtype:H,bandwidth:oe}),this.currentLine++}}return I}parseVersion(){const I=this.getCurrentRecord();if(I.type!==v.VERSION)throw new Error("first sdp record must be version");const F=I.value.slice(0,this.consumeOneOrMore(I.value,0,b));if(F.length!==I.value.length)throw new Error('invalid proto version, "v='.concat(I.value,'"'));return this.currentLine++,F}parseOrigin(){const I=this.getCurrentRecord();if(I.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const F=this.extractOneOrMore(I,O);this.consumeSpaceForRecord(I);const H=this.extractOneOrMore(I,b);this.consumeSpaceForRecord(I);const oe=this.extractOneOrMore(I,b);this.consumeSpaceForRecord(I);const Be=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const Bt=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const Pi=this.extract(I,this.consumeUnicastAddress);return this.currentLine++,{username:F,sessId:H,sessVersion:oe,nettype:Be,addrtype:Bt,unicastAddress:Pi}}parseSessionName(){const I=this.getCurrentRecord();if(I.type===v.SESSION_NAME){const F=this.extract(I,this.consumeText);return this.currentLine++,F}}parseInformation(){const I=this.getCurrentRecord();if(I.type!==v.INFORMATION)return;const F=this.extract(I,this.consumeText);return this.currentLine++,F}parseUri(){const I=this.getCurrentRecord();if(I.type===v.URI)return this.currentLine++,I.value}parseEmail(){const I=[];for(;;){const F=this.getCurrentRecord();if(F.type!==v.EMAIL)break;I.push(F.value),this.currentLine++}return I}parsePhone(){const I=[];for(;;){const F=this.getCurrentRecord();if(F.type!==v.PHONE)break;I.push(F.value),this.currentLine++}return I}parseConnection(){const I=this.getCurrentRecord();if(I.type===v.CONNECTION){const F=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const H=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const oe=this.extract(I,this.consumeAddress);return this.currentLine++,{nettype:F,addrtype:H,address:oe}}}parseMedia(){const I=this.getCurrentRecord(),F=this.extract(I,this.consumeToken);this.consumeSpaceForRecord(I);let H=this.extract(I,this.consumePort);"/"===I.value[I.cur]&&(I.cur+=1,H+=this.extract(I,this.consumeInteger)),this.consumeSpaceForRecord(I);const oe=[];for(oe.push(this.extract(I,this.consumeToken));"/"===I.value[I.cur];)I.cur+=1,oe.push(this.extract(I,this.consumeToken));if(0===oe.length)throw new Error("Invalid proto");const Be=this.parseFmt(I);return this.currentLine++,{mediaType:F,port:H,protos:oe,fmts:Be}}parseTimeFields(){const I=[];for(;this.getCurrentRecord().type===v.TIME;){const F=this.parseTime(),H=this.parseRepeat(),oe=this.parseZone();I.push({time:F,repeats:H,zones:oe})}return I}parseMediaDescription(){const I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const F=this.parseMedia(),H=this.parseInformation(),oe=this.parseConnections(),Be=this.parseBandWidth(),Bt=this.parseKey(),Pi=this.parseMediaAttributes(F);I.push({media:F,information:H,connections:oe,bandwidths:Be,key:Bt,attributes:Pi})}return I}parseConnections(){const I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)I.push(this.parseConnection());return I}parseFmt(I){const F=[];for(;;)try{this.consumeSpaceForRecord(I),F.push(this.extract(I,this.consumeToken))}catch{break}if(0===F.length)throw new Error("Invalid fmts");return F}extract(I,F,...H){const oe=F.call(this,I.value,I.cur,...H),Be=I.value.slice(I.cur,oe);return I.cur=oe,Be}extractOneOrMore(I,F){const H=this.consumeOneOrMore(I.value,I.cur,F),oe=I.value.slice(I.cur,H);return I.cur=H,oe}consumeSpaceForRecord(I){if(I.value[I.cur]!==E)throw new Error("Invalid space at ".concat(I.cur,"."));I.cur+=1}}class Ze extends me{constructor(...I){super(...I),Y(this,"attributes",void 0),Y(this,"digested",!1)}extractOneOrMore(I,F,H){const oe=this.consumeOneOrMore(I.attValue,I._cur,F),Be=I.attValue.slice(I._cur,oe),[Bt,Pi]=H||[];if("number"==typeof Bt&&Be.length<Bt)throw new Error("error in length, should be more or equal than ".concat(Bt," characters."));if("number"==typeof Pi&&Be.length>Pi)throw new Error("error in length, should be less or equal than ".concat(Pi," characters."));return I._cur=oe,Be}consumeAttributeSpace(I){if(I.attValue[I._cur]!==E)throw new Error("Invalid space at ".concat(I._cur,"."));I._cur+=1}extract(I,F,...H){if(!I.attValue)throw new Error("Nothing to extract from attValue.");const oe=F.call(this,I.attValue,I._cur,...H),Be=I.attValue.slice(I._cur,oe);return I._cur=oe,Be}atEnd(I){if(!I.attValue)throw new Error;return I._cur>=I.attValue.length}peekChar(I){if(!I.attValue)throw new Error;return I.attValue[I._cur]}peek(I,F){if(!I.attValue)throw new Error;for(let H=0;H<F.length;H++)if(F[H]!==I.attValue[I._cur+H])return!1;return!0}parseIceUfrag(I){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(I,J,[4,256])}parseIcePwd(I){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(I,J,[22,256])}parseIceOptions(I){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const F=[];for(;!this.atEnd(I);){F.push(this.extractOneOrMore(I,J));try{this.consumeAttributeSpace(I)}catch(H){if(this.atEnd(I))break;throw H}}this.attributes.iceOptions=F}parseFingerprint(I){const F=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const H=this.extract(I,this.consumeTill);this.attributes.fingerprints.push({hashFunction:F,fingerprint:H})}parseExtmap(I){const F=this.extractOneOrMore(I,b);let H;"/"===this.peekChar(I)&&(this.extract(I,this.consume,"/"),H=this.extract(I,this.consumeToken)),this.consumeAttributeSpace(I);const oe=this.extract(I,this.consumeTill,E),Be=$($({entry:parseInt(F,10)},H&&{direction:H}),{},{extensionName:oe});this.peekChar(I)===E&&(this.consumeAttributeSpace(I),Be.extensionAttributes=this.extract(I,this.consumeTill)),this.attributes.extmaps.push(Be)}parseSetup(I){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const F=this.extract(I,this.consumeTill);if("active"!==F&&"passive"!==F&&"actpass"!==F&&"holdconn"!==F)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=F}}class yt extends Ze{constructor(...I){super(...I),Y(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"group":this.parseGroup(I);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"fingerprint":this.parseFingerprint(I);break;case"setup":this.parseSetup(I);break;case"tls-id":this.parseTlsId(I);break;case"identity":this.parseIdentity(I);break;case"extmap":this.parseExtmap(I);break;case"msid-semantic":this.parseMsidSemantic(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(F){throw console.error("parsing session attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),F}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(I){const F=this.extract(I,this.consumeToken),H=[];for(;!this.atEnd(I)&&this.peekChar(I)===E;)this.consumeAttributeSpace(I),H.push(this.extract(I,this.consumeToken));this.attributes.groups.push({semantic:F,identificationTag:H})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(I){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(I,se)}parseIdentity(I){const F=this.extractOneOrMore(I,q),H=[];for(;!this.atEnd(I)&&this.peekChar(I)===E;){this.consumeAttributeSpace(I);const oe=this.extract(I,this.consumeToken);this.extract(I,this.consume,"=");const Be=this.extractOneOrMore(I,Bt=>Bt!==E&&U(Bt));H.push({name:oe,value:Be})}this.attributes.identities.push({assertionValue:F,extensions:H})}parseMsidSemantic(I){this.peekChar(I)===E&&this.consumeAttributeSpace(I);const F={semantic:this.extract(I,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(I)}catch{break}if("*"===this.peekChar(I)){this.extract(I,this.consume,"*"),F.applyForAll=!0;break}{const H=this.extract(I,this.consumeTill,E);F.identifierList.push(H)}}this.attributes.msidSemantic=F}}class xn extends Ze{constructor(I){super(),Y(this,"attributes",void 0),-1!==I.protos.indexOf("RTP")||I.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"extmap":this.parseExtmap(I);break;case"setup":this.parseSetup(I);break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"candidate":this.parseCandidate(I);break;case"remote-candidate":this.parseRemoteCandidate(I);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(I);break;case"rtpmap":this.parseRtpmap(I);break;case"ptime":this.parsePtime(I);break;case"maxptime":this.parseMaxPtime(I);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(I);break;case"ssrc":this.parseSSRC(I);break;case"fmtp":this.parseFmtp(I);break;case"rtcp-fb":this.parseRtcpFb(I);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(I);break;case"mid":this.parseMid(I);break;case"msid":this.parseMsid(I);break;case"imageattr":this.parseImageAttr(I);break;case"rid":this.parseRid(I);break;case"simulcast":this.parseSimulcast(I);break;case"sctp-port":this.parseSctpPort(I);break;case"max-message-size":this.parseMaxMessageSize(I);break;case"ssrc-group":this.parseSSRCGroup(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(F){throw console.error("parsing media attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),F}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}parseCandidate(I){const F=this.extractOneOrMore(I,J,[1,32]);this.consumeAttributeSpace(I);const H=this.extractOneOrMore(I,b,[1,5]);this.consumeAttributeSpace(I);const oe=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const Be=this.extractOneOrMore(I,b,[1,10]);this.consumeAttributeSpace(I);const Bt=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);const Pi=this.extract(I,this.consumePort);this.consumeAttributeSpace(I),this.extract(I,this.consume,"typ"),this.consumeAttributeSpace(I);const sr={foundation:F,componentId:H,transport:oe,priority:Be,connectionAddress:Bt,port:Pi,type:this.extract(I,this.consumeToken),extension:{}};for(this.peek(I," raddr")&&(this.extract(I,this.consume," raddr"),this.consumeAttributeSpace(I),sr.relAddr=this.extract(I,this.consumeAddress)),this.peek(I," rport")&&(this.extract(I,this.consume," rport"),this.consumeAttributeSpace(I),sr.relPort=this.extract(I,this.consumePort));this.peekChar(I)===E;){this.consumeAttributeSpace(I);const Lr=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I),sr.extension[Lr]=this.extractOneOrMore(I,T)}this.attributes.candidates.push(sr)}parseRemoteCandidate(I){const F=[];for(;;){const H=this.extractOneOrMore(I,b,[1,5]);this.consumeAttributeSpace(I);const oe=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);const Be=this.extract(I,this.consumePort);F.push({componentId:H,connectionAddress:oe,port:Be});try{this.consumeAttributeSpace(I)}catch{break}}this.attributes.remoteCandidatesList.push(F)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(I){const F=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const H=this.extract(I,this.consumeTill,"/");this.extract(I,this.consume,"/");const oe={encodingName:H,clockRate:this.extractOneOrMore(I,b)};this.atEnd(I)||"/"!==this.peekChar(I)||(this.extract(I,this.consume,"/"),oe.encodingParameters=parseInt(this.extract(I,this.consumeTill),10));const Be=this.attributes.payloads.find(Bt=>Bt.payloadType===parseInt(F,10));Be?Be.rtpMap=oe:this.attributes.payloads.push({payloadType:parseInt(F,10),rtpMap:oe,rtcpFeedbacks:[]})}parsePtime(I){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(I,this.consumeTill)}parseMaxPtime(I){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(I,this.consumeTill)}parseDirection(I){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=I.attField}parseSSRC(I){const F=this.extractOneOrMore(I,b);this.consumeAttributeSpace(I);const H=this.extract(I,this.consumeTill,":");let oe;":"===this.peekChar(I)&&(this.extract(I,this.consume,":"),oe=this.extract(I,this.consumeTill));const Be=this.attributes.ssrcs.find(Bt=>Bt.ssrcId===parseInt(F,10));Be?Be.attributes[H]=oe:this.attributes.ssrcs.push({ssrcId:parseInt(F,10),attributes:{[H]:oe}})}parseFmtp(I){const F=this.extract(I,this.consumeTill,E);this.consumeAttributeSpace(I);const H=this.extract(I,this.consumeTill),oe={};H.split(";").forEach(Bt=>{let[Pi,sr]=Bt.split("=");Pi=Pi.trim();const Lr="string"==typeof sr?sr.trim():null;"string"==typeof Pi&&Pi.length>0&&(oe[Pi]=Lr)});const Be=this.attributes.payloads.find(Bt=>Bt.payloadType===parseInt(F,10));Be?Be.fmtp={parameters:oe}:this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[],fmtp:{parameters:oe}})}parseFmtParameters(I){const F={},H=this.extract(I,this.consumeTill,"=");I._cur++;const oe=this.extract(I,this.consumeTill,";");for(F[H]=oe;";"===I.attValue[I._cur];){const Be=this.extract(I,this.consumeTill,"=");I._cur++;const Bt=this.extract(I,this.consumeTill,";");F[Be]=Bt}return F}parseRtcpFb(I){let F="";F="*"===this.peekChar(I)?this.extract(I,this.consume,"*"):this.extract(I,this.consumeTill,E),this.consumeAttributeSpace(I);const H=this.extract(I,this.consumeTill,E);let oe;if("trr-int"===H)oe={type:H,interval:this.extract(I,this.consumeTill)};else{const Be={type:H};this.peekChar(I)===E&&(this.consumeAttributeSpace(I),Be.parameter=this.extract(I,this.consumeToken),this.peekChar(I)===E&&(Be.additional=this.extract(I,this.consumeTill))),oe=Be}if("*"===F)this.attributes.rtcpFeedbackWildcards.push(oe);else{const Be=this.attributes.payloads.find(Bt=>Bt.payloadType===parseInt(F,10));Be?Be.rtcpFeedbacks.push(oe):this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[oe]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(I){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const F={port:this.extract(I,this.consumePort)};this.peekChar(I)===E&&(this.consumeAttributeSpace(I),F.netType=this.extractOneOrMore(I,P),this.consumeAttributeSpace(I),F.addressType=this.extractOneOrMore(I,P),this.consumeAttributeSpace(I),F.address=this.extract(I,this.consumeAddress)),this.attributes.rtcp=F}parseMsid(I){const F={id:this.extractOneOrMore(I,P,[1,64])};this.peekChar(I)===E&&(this.consumeAttributeSpace(I),F.appdata=this.extractOneOrMore(I,P,[1,64])),this.attributes.msids.push(F)}parseImageAttr(I){this.attributes.imageattr.push(I.attValue)}parseRid(I){const F=this.extractOneOrMore(I,oe=>L(oe)||b(oe)||"_"===oe||"-"===oe);this.consumeAttributeSpace(I);const H={id:F,direction:this.extract(I,this.consumeToken),params:[]};if(this.peekChar(I)===E){if(this.consumeAttributeSpace(I),this.peek(I,"pt=")){this.extract(I,this.consume,"pt=");const oe=[];for(;;){const Be=this.extract(I,this.consumeToken);oe.push(Be);try{this.extract(I,this.consume,",")}catch{break}}H.payloads=oe,this.peekChar(I)===E&&this.extract(I,this.consume,E)}for(;;){const oe=this.extract(I,this.consumeToken);switch(oe){case"depend":{const Be={type:oe,rids:this.extract(I,this.consume,"=").split(",")};H.params.push(Be);break}default:{const Be={type:oe};"="===this.peekChar(I)&&(this.extract(I,this.consume,"="),Be.val=this.extract(I,this.consumeTill,";")),H.params.push(Be)}}try{this.extract(I,this.consume,";")}catch{break}}}this.attributes.rids.push(H)}parseSimulcast(I){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=I.attValue,this.extract(I,this.consumeTill)}parseSctpPort(I){this.attributes.sctpPort=this.extractOneOrMore(I,b,[1,5])}parseMaxMessageSize(I){this.attributes.maxMessageSize=this.extractOneOrMore(I,b,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(I){this.attributes.mid=this.extract(I,this.consumeToken)}parseSSRCGroup(I){const F=this.extract(I,this.consumeToken),H=[];for(;;)try{this.consumeAttributeSpace(I);const oe=this.extract(I,this.consumeInteger);H.push(parseInt(oe,10))}catch{break}this.attributes.ssrcGroups.push({semantic:F,ssrcIds:H})}}function Ht(le,I,F){return I in le?Object.defineProperty(le,I,{value:F,enumerable:!0,configurable:!0,writable:!0}):le[I]=F,le}class di{constructor(){Ht(this,"eol",_)}print(I,F){let H="";return F&&(this.eol=F),H+=this.printVersion(I.version),H+=this.printOrigin(I.origin),H+=this.printSessionName(I.sessionName),H+=this.printInformation(I.information),H+=this.printUri(I.uri),H+=this.printEmail(I.emails),H+=this.printPhone(I.phones),H+=this.printConnection(I.connection),H+=this.printBandwidth(I.bandwidths),H+=this.printTimeFields(I.timeFields),H+=this.printKey(I.key),H+=this.printSessionAttributes(I.attributes),H+=this.printMediaDescription(I.mediaDescriptions),H}printVersion(I){return"v=".concat(I).concat(this.eol)}printOrigin(I){return"o=".concat(I.username," ").concat(I.sessId," ").concat(I.sessVersion," ").concat(I.nettype," ").concat(I.addrtype," ").concat(I.unicastAddress).concat(this.eol)}printSessionName(I){return I?"s=".concat(I).concat(this.eol):""}printInformation(I){return I?"i=".concat(I).concat(this.eol):""}printUri(I){return I?"u=".concat(I).concat(this.eol):""}printEmail(I){let F="";for(const H of I)F+="e=".concat(H).concat(this.eol);return F}printPhone(I){let F="";for(const H of I)F+="e=".concat(H).concat(this.eol);return F}printConnection(I){return I?"c=".concat(I.nettype," ").concat(I.addrtype," ").concat(I.address).concat(this.eol):""}printBandwidth(I){let F="";for(const H of I)F+="b=".concat(H.bwtype,":").concat(H.bandwidth).concat(this.eol);return F}printTimeFields(I){let F="";for(const H of I){F+="t=".concat(H.time.startTime," ").concat(H.time.startTime).concat(this.eol);for(const oe of H.repeats)F+="r=".concat(oe.repeatInterval," ").concat(oe.typedTimes.join(" ")).concat(this.eol);H.zoneAdjustments&&(F+="z=",F+="z=".concat(H.zoneAdjustments.map(oe=>"".concat(oe.time," ").concat(oe.back?"-":""," ").concat(oe.typedTime)).join(" ")).concat(this.eol),F+=this.eol)}return F}printKey(I){return I?"k=".concat(I).concat(this.eol):""}printAttributes(I){let F="";for(const H of I)F+="a=".concat(H.attField).concat(H.attValue?":".concat(H.attValue):"").concat(this.eol);return F}printMediaDescription(I){let F="";for(const H of I)F+=this.printMedia(H.media),F+=this.printInformation(H.information),F+=this.printConnections(H.connections),F+=this.printBandwidth(H.bandwidths),F+=this.printKey(H.key),F+=this.printMediaAttributes(H);return F}printConnections(I){let F="";for(const H of I)F+=this.printConnection(H);return F}printMedia(I){return"m=".concat(I.mediaType," ").concat(I.port," ").concat(I.protos.join("/")," ").concat(I.fmts.join(" ")).concat(this.eol)}printSessionAttributes(I){return new ce(this.eol).print(I)}printMediaAttributes(I){return new _e(this.eol).print(I)}}class ie{constructor(I){Ht(this,"eol",void 0),this.eol=I}printIceUfrag(I){return void 0===I?"":"a=ice-ufrag:".concat(I).concat(this.eol)}printIcePwd(I){return void 0===I?"":"a=ice-pwd:".concat(I).concat(this.eol)}printIceOptions(I){return void 0===I?"":"a=ice-options:".concat(I.join(E)).concat(this.eol)}printFingerprints(I){return I.length>0?I.map(F=>"a=fingerprint:".concat(F.hashFunction).concat(E).concat(F.fingerprint)).join(this.eol)+this.eol:""}printExtmap(I){return I.map(F=>"a=extmap:".concat(F.entry).concat(F.direction?"/".concat(F.direction):"").concat(E).concat(F.extensionName).concat(F.extensionAttributes?"".concat(E).concat(F.extensionAttributes):"").concat(this.eol)).join("")}printSetup(I){return void 0===I?"":"a=setup:".concat(I).concat(this.eol)}printUnrecognized(I){return I.map(F=>"a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol)).join("")}}class ce extends ie{print(I){let F="";return F+=this.printGroups(I.groups),F+=this.printMsidSemantic(I.msidSemantic),F+=this.printIceLite(I.iceLite),F+=this.printIceUfrag(I.iceUfrag),F+=this.printIcePwd(I.icePwd),F+=this.printIceOptions(I.iceOptions),F+=this.printFingerprints(I.fingerprints),F+=this.printSetup(I.setup),F+=this.printTlsId(I.tlsId),F+=this.printIdentity(I.identities),F+=this.printExtmap(I.extmaps),F+=this.printUnrecognized(I.unrecognized),F}printGroups(I){let F="";return I.length>0&&(F+=I.map(H=>"a=group:".concat(H.semantic).concat(H.identificationTag.map(oe=>"".concat(E).concat(oe)).join("")).concat(this.eol)).join("")),F}printIceLite(I){return void 0===I?"":"a=ice-lite"+this.eol}printTlsId(I){return I?"a=tls-id:".concat(I).concat(this.eol):""}printIdentity(I){return 0===I.length?"":I.map(F=>"a=identity:".concat(F.assertionValue).concat(F.extensions.map(H=>"".concat(E).concat(H.name).concat(H.value?"=".concat(H.value):"")))).join(this.eol)+this.eol}printMsidSemantic(I){if(!I)return"";let F="a=msid-semantic:".concat(I.semantic);return I.applyForAll?F+="".concat(E,"*"):I.identifierList.length>0&&(F+=I.identifierList.map(H=>"".concat(E).concat(H))),F+this.eol}}class _e extends ie{print(I){const F=I.attributes;let H="";return H+=this.printRTCP(F.rtcp),H+=this.printIceUfrag(F.iceUfrag),H+=this.printIcePwd(F.icePwd),H+=this.printIceOptions(F.iceOptions),H+=this.printCandidates(F.candidates),H+=this.printRemoteCandidatesList(F.remoteCandidatesList),H+=this.printEndOfCandidates(F.endOfCandidates),H+=this.printFingerprints(F.fingerprints),H+=this.printSetup(F.setup),H+=this.printMid(F.mid),H+=this.printExtmap(F.extmaps),H+=this.printRTPRelated(F),H+=this.printPtime(F.ptime),H+=this.printMaxPtime(F.maxPtime),H+=this.printDirection(F.direction),H+=this.printSSRCGroups(F.ssrcGroups),H+=this.printSSRC(F.ssrcs),H+=this.printRTCPMux(F.rtcpMux),H+=this.printRTCPMuxOnly(F.rtcpMuxOnly),H+=this.printRTCPRsize(F.rtcpRsize),H+=this.printMSId(F.msids),H+=this.printImageattr(F.imageattr),H+=this.printRid(F.rids),H+=this.printSimulcast(F.simulcast),H+=this.printSCTPPort(F.sctpPort),H+=this.printMaxMessageSize(F.maxMessageSize),H+=this.printUnrecognized(F.unrecognized),H}printCandidates(I){return I.map(F=>"a=candidate:".concat(F.foundation).concat(E).concat(F.componentId).concat(E).concat(F.transport).concat(E).concat(F.priority).concat(E).concat(F.connectionAddress).concat(E).concat(F.port).concat(E,"typ").concat(E).concat(F.type).concat(F.relAddr?"".concat(E,"raddr").concat(E).concat(F.relAddr):"").concat(F.relPort?"".concat(E,"rport").concat(E).concat(F.relPort):"").concat(Object.keys(F.extension).map(H=>"".concat(E).concat(H).concat(E).concat(F.extension[H])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(I){return I.map(F=>"a=remote-candidates:".concat(F.join(E)).concat(this.eol)).join("")}printEndOfCandidates(I){return void 0===I?"":"a=end-of-candidates"+this.eol}printRTPRelated(I){if(!I.payloads)return"";const F=I.payloads;let H="";H+=I.rtcpFeedbackWildcards.map(oe=>this.printRTCPFeedback("*",oe)).join("");for(const oe of F)H+=this.printRtpMap(oe.payloadType,oe.rtpMap),H+=this.printFmtp(oe.payloadType,oe.fmtp),H+=oe.rtcpFeedbacks.map(Be=>this.printRTCPFeedback(oe.payloadType,Be)).join("");return H}printFmtp(I,F){if(!F)return"";const H=Object.keys(F.parameters);return 1===H.length&&null===F.parameters[H[0]]?"a=fmtp:".concat(I).concat(E).concat(H[0]).concat(this.eol):"a=fmtp:".concat(I).concat(E).concat(Object.keys(F.parameters).map(oe=>"".concat(oe,"=").concat(F.parameters[oe])).join(";")).concat(this.eol)}printRtpMap(I,F){return F?"a=rtpmap:".concat(I).concat(E).concat(F.encodingName,"/").concat(F.clockRate).concat(F.encodingParameters?"/".concat(F.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(I,F){let H="a=rtcp-fb:".concat(I).concat(E),oe=F;return"trr-int"===oe.type?H+="ttr-int".concat(E).concat(oe.interval):(H+="".concat(oe.type),oe.parameter&&(H+="".concat(E).concat(oe.parameter),oe.additional&&(H+="".concat(E).concat(oe.additional)))),H+this.eol}printPtime(I){return void 0===I?"":"a=ptime:".concat(I).concat(this.eol)}printMaxPtime(I){return void 0===I?"":"a=maxptime:".concat(I).concat(this.eol)}printDirection(I){return void 0===I?"":"a=".concat(I).concat(this.eol)}printSSRC(I){return I.map(F=>Object.keys(F.attributes).map(H=>"a=ssrc:".concat(F.ssrcId.toString(10)).concat(E).concat(H).concat(F.attributes[H]?":".concat(F.attributes[H]):"").concat(this.eol)).join("")).join("")}printRTCPMux(I){return void 0===I?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(I){return void 0===I?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(I){return void 0===I?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(I){if(void 0===I)return"";let F="a=rtcp:".concat(I.port);return I.netType&&(F+="".concat(E).concat(I.netType)),I.addressType&&(F+="".concat(E).concat(I.addressType)),I.address&&(F+="".concat(E).concat(I.address)),F+this.eol}printMSId(I){return I.map(F=>"a=msid:".concat(F.id).concat(F.appdata?"".concat(E).concat(F.appdata):"").concat(this.eol)).join("")}printImageattr(I){return I.map(F=>"a=imageattr:".concat(F).concat(this.eol)).join("")}printRid(I){return I.map(F=>{let H="a=rid:".concat(F.id).concat(E).concat(F.direction);return F.payloads&&(H+="".concat(E,"pt=").concat(F.payloads.join(","))),F.params.length>0&&(H+="".concat(E).concat(F.params.map(oe=>"depend"===oe.type?"depend=".concat(oe.rids.join(",")):"".concat(oe.type,"=").concat(oe.val)).join(";"))),H+this.eol}).join("")}printSimulcast(I){return void 0===I?"":"a=simulcast:".concat(I).concat(this.eol)}printSCTPPort(I){return void 0===I?"":"a=sctp-port:".concat(I).concat(this.eol)}printMaxMessageSize(I){return void 0===I?"":"a=max-message-size:".concat(I).concat(this.eol)}printMid(I){return void 0===I?"":"a=mid:".concat(I).concat(this.eol)}printSSRCGroups(I){return I.map(F=>"a=ssrc-group:".concat(F.semantic).concat(F.ssrcIds.map(H=>"".concat(E).concat(H.toString(10))).join("")).concat(this.eol)).join("")}}function Le(le){return(new Ee).parse(le)}function ut(le,I){return(new di).print(le,I)}}},a={};function l(d){if(a[d])return a[d].exports;var h=a[d]={exports:{}};return r[d](h,h.exports,l),h.exports}return l.d=(d,h)=>{for(var p in h)l.o(h,p)&&!l.o(d,p)&&Object.defineProperty(d,p,{enumerable:!0,get:h[p]})},l.o=(d,h)=>Object.prototype.hasOwnProperty.call(d,h),l.r=d=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},l(8)})()}(lN);var cn=lN.exports;function o2(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Rs(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?o2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):o2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function gT(s){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:l,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:p,filterVideoCodec:m}=n,{useXR:_}=r;let E=[],v=[],b=[],T=[],O=!1,P=!1;if(cn.parse(s).mediaDescriptions.forEach(D=>{a&&a!==D.attributes.direction||("video"!==D.media.mediaType||O||(v=D.attributes.payloads,T=D.attributes.extmaps,O=!0),"audio"!==D.media.mediaType||P||(E=D.attributes.payloads,b=D.attributes.extmaps,P=!0))}),!T||0===v.length)throw new Error("Cannot get video capabilities from SDP.");if(!b||0===E.length)throw new Error("Cannot get audio capabilities from SDP.");return v.forEach(D=>{var L;null!==(L=D.rtpMap)&&void 0!==L&&L.clockRate&&(D.rtpMap.clockRate=parseInt(D.rtpMap.clockRate)),_&&D.rtcpFeedbacks.push({type:"rrtr"})}),E.forEach(D=>{var L;null!==(L=D.rtpMap)&&void 0!==L&&L.clockRate&&(D.rtpMap.clockRate=parseInt(D.rtpMap.clockRate)),_&&D.rtcpFeedbacks.push({type:"rrtr"})}),l&&(E=E.filter(D=>{var L;return"rtx"!==(null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName.toLowerCase())}),v=v.filter(D=>{var L;return"rtx"!==(null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName.toLowerCase())})),d&&(v=v.filter(D=>{var L;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName)||"")})),h&&(E=E.filter(D=>{var L;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName)||"")})),p&&p?.length>0&&(E=E.filter(D=>{var L;return ye(p).call(p,(null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName.toLowerCase())||"")})),m&&m?.length>0&&(v=v.filter(D=>{var L;return ye(m).call(m,(null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName.toLowerCase())||"")})),{audioCodecs:E,videoCodecs:v,audioExtensions:b,videoExtensions:T}}function Wd(s){const n=cn.parse(s);let r,a;for(const l of n.mediaDescriptions){if(!r){const d=l.attributes.iceUfrag,h=l.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:d,icePwd:h}}if(!a){const d=l.attributes.fingerprints;d.length>0&&(a={fingerprints:d})}}if(!a&&n.attributes.fingerprints.length>0&&(a={fingerprints:n.attributes.fingerprints}),!a||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:a}}function dN(s,n){const r=[],a=s.attributes.ssrcGroups.filter(h=>"FID"===h.semantic),l=s.attributes.ssrcGroups.find(h=>"SIM"===h.semantic),d=s.attributes.ssrcs;if(l)l.ssrcIds.forEach(h=>{var p;const m=null===(p=a.find(_=>_.ssrcIds[0]===h))||void 0===p?void 0:p.ssrcIds[1];r.push({ssrcId:h,rtx:n?m:void 0})});else if(a.length>0)r.push({ssrcId:a[0].ssrcIds[0],rtx:n?a[0].ssrcIds[1]:void 0});else{if(0===d.length)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:d[0].ssrcId})}return r}function uN(s,n){const{cname:r}=s;let a;n&&n.ip&&"number"==typeof n.port?(a=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:n.ip,port:n.port.toString(),type:"host",extension:{}}],w.debug("Using remote candidate from AP ".concat(n.ip,":").concat(n.port)),n.ip6&&(a.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:n.ip6,port:n.port.toString(),type:"host",extension:{}}),w.debug("Using IPV6 remote candidate from AP ".concat(n.ip6,":").concat(n.port)))):a=s.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}}));const l={fingerprints:s.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},d={iceUfrag:s.iceParameters.iceUfrag,icePwd:s.iceParameters.icePwd};let h;switch(s.dtlsParameters.role){case"server":h="passive";break;case"client":h="active";break;case"auto":h="actpass"}return{dtlsParameters:l,iceParameters:d,candidates:a,rtpCapabilities:cv(s.rtpCapabilities),setup:h,cname:r}}function Zr(s,n,r){const a=[],l=[];return s.forEach(d=>{let{ssrcId:h,rtx:p}=d;const m=Fe(8,"track-"),_={ssrcId:h,attributes:Rs({label:m,mslabel:r=r||Fe(10,""),msid:"".concat(r," ").concat(m)},n&&{cname:n})};if(a.push(_),void 0!==p){const E={ssrcId:p,attributes:Rs({label:m,mslabel:r,msid:"".concat(r," ").concat(m)},n&&{cname:n})};a.push(E),l.push({semantic:"FID",ssrcIds:[h,p]})}}),s.length>1&&l.push({semantic:"SIM",ssrcIds:s.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:a,ssrcGroups:l}}function zd(s,n){n instanceof mt&&s.attributes.payloads.forEach(r=>{var a;const l=null===(a=r.rtpMap)||void 0===a?void 0:a.encodingName.toLowerCase();if(!l||-1===["opus","pcmu","pcma","g722"].indexOf(l))return;r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";const d=n._encoderConfig;d&&"pcmu"!==l&&"pcma"!==l&&"g722"!==l&&(d.bitrate&&!zt()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"))})}function ET(s){const n=s.attributes.unrecognized.findIndex(r=>"x-google-flag"===r.attField&&"conference"===r.attValue);-1!==n&&s.attributes.unrecognized.splice(n,1)}function vT(s,n){var r;if(!(n instanceof ze&&n._encoderConfig&&-1===n._hints.indexOf(Ot.SCREEN_TRACK)))return;const a=n._encoderConfig;$e().supportMinBitrate&&a.bitrateMin&&s.attributes.payloads.forEach(l=>{var d,h;ye(d=["h264","h265","vp8","vp9","av1"]).call(d,(null===(h=l.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(l.fmtp||(l.fmtp={parameters:{}}),l.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),$e().supportMinBitrate&&!ye(r=n._hints).call(r,Ot.LOW_STREAM)&&a.bitrateMax&&s.attributes.payloads.forEach(l=>{var d,h;ye(d=["h264","h265","vp8","vp9","av1"]).call(d,(null===(h=l.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(l.fmtp||(l.fmtp={parameters:{}}),l.fmtp.parameters["x-google-start-bitrate"]="".concat(j("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function hN(s){if("video"!==s.media.mediaType)return;const n=dt();if(n.name!==Ne.SAFARI&&n.os!==Fn.IOS)return;const r=s.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));-1!==r&&s.attributes.extmaps.splice(r,1)}function sv(s,n,r){if(!n)return;let a,l;if("video"===s.media.mediaType?(a=r.videoExtensions,l=r.videoCodecs):(a=r.audioExtensions,l=r.audioCodecs),!0===n.twcc){const d=a.find(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);d&&(s.attributes.extmaps.find(p=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===p.extensionName)||s.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),(p=l,m=s.attributes.payloads,m.filter(_=>!!p.find(E=>E.payloadType===_.payloadType&&!!E.rtcpFeedbacks.find(v=>"transport-cc"===v.type)))).forEach(p=>{p.rtcpFeedbacks.find(m=>"transport-cc"===m.type)||p.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(!1===n.twcc){const d=s.attributes.extmaps.findIndex(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);-1!==d&&s.attributes.extmaps.splice(d,1),s.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>"transport-cc"===m.type);-1!==p&&h.rtcpFeedbacks.splice(p,1)})}var p,m;if(!0===n.remb){const d=a.find(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);d&&(s.attributes.extmaps.find(p=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===p.extensionName)||s.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(p,m){return m.filter(_=>!!p.find(E=>E.payloadType===_.payloadType&&!!E.rtcpFeedbacks.find(v=>"goog-remb"===v.type)))}(l,s.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(m=>"goog-remb"===m.type)||p.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(!1===n.remb){const d=s.attributes.extmaps.findIndex(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);-1!==d&&s.attributes.extmaps.splice(d,1),s.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>"goog-remb"===m.type);-1!==p&&h.rtcpFeedbacks.splice(p,1)})}}function yT(s,n,r){if(zt()||"video"!==s.media.mediaType||!(n instanceof ze)||"vp9"!==r&&"vp8"!==r||"vp8"===r&&!j("SIMULCAST")||void 0===n._scalabilityMode||n._scalabilityMode.numSpatialLayers<=1)return;const a="vp8"===r?2:n._scalabilityMode.numSpatialLayers,l=s.attributes.ssrcs[0],d=s.attributes.ssrcGroups.find(p=>"FID"===p.semantic&&p.ssrcIds[0]===l.ssrcId),h={semantic:"SIM",ssrcIds:[l.ssrcId]};for(let p=1;p<a;p++)s.attributes.ssrcs.push({ssrcId:l.ssrcId+p,attributes:hn(l.attributes)}),h.ssrcIds.push(l.ssrcId+p),d&&(s.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+p,attributes:hn(l.attributes)}),s.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[l.ssrcId+p,d.ssrcIds[1]+p]}));s.attributes.ssrcGroups.unshift(h)}function pN(){return bT.apply(this,arguments)}function bT(){return bT=x(function*(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{filterRTX:r,filterVideoFec:a,filterAudioFec:l,filterAudioCodec:d,filterVideoCodec:h}=s,{useXR:p}=n,m=new RTCPeerConnection;m.addTransceiver("video",{direction:"sendonly"}),m.addTransceiver("audio",{direction:"sendonly"}),m.addTransceiver("video",{direction:"recvonly"}),m.addTransceiver("audio",{direction:"recvonly"});const _=(yield m.createOffer()).sdp,E=gT(_,{filterRTX:r,filterVideoFec:a,filterAudioFec:l,filterAudioCodec:d,filterVideoCodec:h},{useXR:p},"sendonly"),v=gT(_,{filterRTX:r,filterVideoFec:a,filterAudioFec:l,filterAudioCodec:d,filterVideoCodec:h},{useXR:p},"recvonly"),b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(av(E,v,"videoExtensions",b,T,O),av(E,v,"videoCodecs",b,T,O),av(E,v,"audioExtensions",b,T,O),av(E,v,"audioCodecs",b,T,O),j("RAISE_H264_BASELINE_PRIORITY")){const P=O.videoCodecs.findIndex(D=>{var L,V;return"h264"===(null===(L=D.rtpMap)||void 0===L?void 0:L.encodingName.toLocaleLowerCase())&&"42001f"===(null===(V=D.fmtp)||void 0===V?void 0:V.parameters["profile-level-id"])});if(-1!==P){const D=O.videoCodecs.findIndex(L=>{var V;return"h264"===(null===(V=L.rtpMap)||void 0===V?void 0:V.encodingName.toLocaleLowerCase())});if(D<P){w.debug("raising H264 baseline profile priority");const L=O.videoCodecs[P];O.videoCodecs.splice(P,1),O.videoCodecs.splice(D,0,L)}-1!==D&&(T.videoCodecs=T.videoCodecs.filter(L=>{var V,U;return!("h264"===(null===(V=L.rtpMap)||void 0===V?void 0:V.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(U=L.fmtp)||void 0===U?void 0:U.parameters["profile-level-id"]))})),-1!==D&&j("FILTER_SEND_H264_BASELINE")&&(b.videoCodecs=b.videoCodecs.filter(L=>{var V,U;return!("h264"===(null===(V=L.rtpMap)||void 0===V?void 0:V.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(U=L.fmtp)||void 0===U?void 0:U.parameters["profile-level-id"]))}))}}try{m.close()}catch{}return{send:b,recv:T,sendrecv:O}}),bT.apply(this,arguments)}function av(s,n,r,a,l,d){if("videoExtensions"===r||"audioExtensions"===r){const h=[];return s[r].forEach(p=>{n[r].some((m,_)=>{if(p.entry===m.entry&&p.extensionName===m.extensionName)return h.push(_),!0})?d[r].push(p):a[r].push(p)}),void n[r].forEach((p,m)=>{-1===h.indexOf(m)&&l[r].push(p)})}if("videoCodecs"===r||"audioCodecs"===r){const h=[];return s[r].forEach(p=>{n[r].some((m,_)=>{if(p.payloadType===m.payloadType&&JSON.stringify(p)===JSON.stringify(m))return h.push(_),!0})?d[r].push(p):a[r].push(p)}),void n[r].forEach((p,m)=>{-1===h.indexOf(m)&&l[r].push(p)})}}function cv(s){const{send:n,recv:r,sendrecv:a}=s;if(!a){if(!n||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:n,recv:r}}let l,d;return n?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...n.audioCodecs,...a.audioCodecs],l.videoCodecs=[...n.videoCodecs,...a.videoCodecs],l.audioExtensions=[...n.audioExtensions,...a.audioExtensions],l.videoExtensions=[...n.videoExtensions,...a.videoExtensions]):l=a,r?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...r.audioCodecs,...a.audioCodecs],d.videoCodecs=[...r.videoCodecs,...a.videoCodecs],d.audioExtensions=[...r.audioExtensions,...a.audioExtensions],d.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):d=a,{send:l,recv:d}}function Dl(s){"audio"===s.media.mediaType&&s.attributes.payloads.filter(n=>{var r;return"opus"===(null===(r=n.rtpMap)||void 0===r?void 0:r.encodingName.toLowerCase())}).forEach(n=>{n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"})}function lv(s){s.mediaDescriptions.forEach(n=>{"video"!==n.media.mediaType&&"audio"!==n.media.mediaType||n.attributes.payloads.forEach(r=>{-1===r.rtcpFeedbacks.findIndex(a=>"rrtr"===a.type)&&r.rtcpFeedbacks.push({type:"rrtr"})})})}function dv(s,n,r,a){let l=[];if(s===ge.VIDEO){if(j("H264_PROFILE_LEVEL_ID")&&"h264"===a&&(l=n.videoCodecs.filter(d=>{var h;return ye(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===j("H264_PROFILE_LEVEL_ID")})),!Array.isArray(l)||0===l.length){const d=r.videoCodecs.filter(h=>{var p;return ye(p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(p,a)});0!==d.length&&(l=n.videoCodecs.filter(h=>d.some(p=>p.payloadType===h.payloadType)))}if(j("USE_PUB_RTX")){const d=l.map(p=>p.payloadType.toString()),h=n.videoCodecs.filter(p=>p.rtpMap&&"rtx"===p.rtpMap.encodingName&&ye(d).call(d,p.fmtp&&p.fmtp.parameters.apt||""));l=[...l,...h]}0===l.length&&(w.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(n.videoCodecs[0].rtpMap&&n.videoCodecs[0].rtpMap.encodingName)),l=n.videoCodecs)}else l=n.audioCodecs.filter(d=>{var h;return ye(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)}),0===l.length&&(w.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),l=n.audioCodecs.filter(d=>{var h;return ye(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return l}function fN(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function ST(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?fN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):fN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function As(s){if(Array.isArray(s))return s.map(r=>r);if(!mN(s))return s;const n={};for(const r in s){const a=s[r];n[r]=mN(a)||Array.isArray(a)?As(a):a}return n}function mN(s){return!("object"!=typeof s||Array.isArray(s)||!s)}class CT{constructor(n){C(this,"input",[]),C(this,"size",void 0),this.size=n}add(n){this.input.push(n),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Ds={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},qd={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Ds,remoteCandidate:Ds}},s2={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},a2={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},Vh={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},TT={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function _N(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function gN(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?_N(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):_N(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class wT{constructor(n,r){var a=this;C(this,"onFirstVideoReceived",void 0),C(this,"onFirstVideoDecoded",void 0),C(this,"onFirstAudioReceived",void 0),C(this,"onFirstVideoDecodedTimeout",void 0),C(this,"onFirstAudioDecoded",void 0),C(this,"onSelectedLocalCandidateChanged",void 0),C(this,"onSelectedRemoteCandidateChanged",void 0),C(this,"videoIsReady",!1),C(this,"videoIsReady2",{}),C(this,"pc",void 0),C(this,"options",void 0),C(this,"intervalTimer",void 0),C(this,"stats",As(qd)),C(this,"isFirstVideoReceived",{}),C(this,"isFirstVideoDecoded",{}),C(this,"isFirstAudioReceived",{}),C(this,"isFirstAudioDecoded",{}),C(this,"isFirstVideoDecodedTimeout",{}),C(this,"lossRateWindowStats",[]),this.pc=n,this.options=r,this.intervalTimer=window.setInterval(x(function*(){a.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new z(n=>{n({local:gN({},Ds),remote:gN({},Ds)})})}setVideoIsReady(n){this.videoIsReady=n}setVideoIsReady2(n,r){this.videoIsReady2[n]=r}getVideoIsReady(n){return this.videoIsReady2[n]||!1}setIsFirstAudioDecoded(n){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(n){this.lossRateWindowStats.push(n),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,a=["videoSend","audioSend","videoRecv","audioRecv"];let l=0,d=0,h=0,p=0;for(const m of a)n[m].forEach((_,E)=>{if(!this.lossRateWindowStats[r-1][m][E]||!this.lossRateWindowStats[0][m][E])return;const v=this.lossRateWindowStats[r-1][m][E].packets-this.lossRateWindowStats[0][m][E].packets,b=this.lossRateWindowStats[r-1][m][E].packetsLost-this.lossRateWindowStats[0][m][E].packetsLost;"videoSend"===m||"audioSend"===m?(l+=v,h+=b):(d+=v,p+=b),_.packetLostRate=Number.isNaN(v)||Number.isNaN(v)||v<=0||b<=0?0:b/(v+b)});n.sendPacketLossRate=l<=0||h<=0?0:h/(l+h),n.recvPacketLossRate=d<=0||p<=0?0:p/(d+p)}}function EN(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function vN(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?EN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):EN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class YV extends wT{constructor(){super(...arguments),C(this,"_stats",qd),C(this,"lastDecodeVideoReceiverStats",new Map)}updateStats(){var n=this;return x(function*(){const r=yield n._getStats(),a=n.statsResponsesToObjects(r);n._stats=As(qd);const l=a.filter(h=>"ssrc"===h.type);n.processSSRCStats(l);const d=a.find(h=>"VideoBwe"===h.type);d&&n.processBandwidthStats(d),n._stats.timestamp=Date.now(),n.calcLossRate(n._stats),n.stats=n._stats})()}processBandwidthStats(n){this._stats.bitrate={actualEncoded:Number(n.googActualEncBitrate),targetEncoded:Number(n.googTargetEncBitrate),retransmit:Number(n.googRetransmitBitrate),transmit:Number(n.googTransmitBitrate)},this._stats.sendBandwidth=Number(n.googAvailableSendBandwidth)}processSSRCStats(n){n.forEach(r=>{var a;const l=ye(a=r.id).call(a,"send");switch("".concat(r.mediaType,"_").concat(l?"send":"recv")){case"video_send":{const d=As(a2);d.codec=r.googCodecName,d.adaptionChangeReason="none",r.googCpuLimitedResolution&&(d.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(d.adaptionChangeReason="bandwidth"),d.avgEncodeMs=Number(r.googAvgEncodeMs),d.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},d.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},d.firsCount=Number(r.googFirReceived),d.nacksCount=Number(r.googNacksReceived),d.plisCount=Number(r.googPlisReceived),d.frameCount=Number(r.framesEncoded),d.bytes=Number(r.bytesSent),d.packets=Number(r.packetsSent),d.packetsLost=Number(r.packetsLost),d.ssrc=Number(r.ssrc),d.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(d),this._stats.rtt=d.rttMs;break}case"video_recv":{const d=As(s2),h=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(d.codec=r.googCodecName,d.targetDelayMs=Number(r.googTargetDelayMs),d.renderDelayMs=Number(r.googRenderDelayMs),d.currentDelayMs=Number(r.googCurrentDelayMs),d.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),d.decodeMs=Number(r.googDecodeMs),d.maxDecodeMs=Number(r.googMaxDecodeMs),d.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},d.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},d.decodeFrameRate=Number(r.googFrameRateDecoded),d.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},d.jitterBufferMs=Number(r.googJitterBufferMs),d.firsCount=Number(r.googFirsSent),d.nacksCount=Number(r.googNacksSent),d.plisCount=Number(r.googPlisSent),d.framesDecodeCount=Number(r.framesDecoded),d.bytes=Number(r.bytesReceived),d.packets=Number(r.packetsReceived),d.packetsLost=Number(r.packetsLost),d.ssrc=Number(r.ssrc),d.packets>0&&!this.isFirstVideoReceived[d.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(d.ssrc),this.isFirstVideoReceived[d.ssrc]=!0),d.framesDecodeCount>0&&!this.isFirstVideoDecoded[d.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(d.ssrc,d.decodedFrame.width,d.decodedFrame.height),this.isFirstVideoDecoded[d.ssrc]=!0),h){const p=h.stats,m=Date.now()-h.lts;d.framesDecodeFreezeTime=p.framesDecodeFreezeTime,d.framesDecodeInterval=p.framesDecodeInterval,d.framesDecodeCount>p.framesDecodeCount&&this.isFirstVideoDecoded[d.ssrc]?(h.lts=Date.now(),d.framesDecodeInterval=m,d.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?d.framesDecodeFreezeTime+=d.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):d.framesDecodeCount<h.stats.framesDecodeCount&&(d.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(d.ssrc,{stats:vN({},d),lts:Date.now()}),this._stats.videoRecv.push(d);break}case"audio_recv":{const d=As(TT);d.codec=r.googCodecName,d.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,d.decodingCNG=Number(r.googDecodingCNG),d.decodingCTN=Number(r.googDecodingCTN),d.decodingCTSG=Number(r.googDecodingCTSG),d.decodingNormal=Number(r.googDecodingNormal),d.decodingPLC=Number(r.googDecodingPLC),d.decodingPLCCNG=Number(r.googDecodingPLCCNG),d.expandRate=Number(r.googExpandRate),d.accelerateRate=Number(r.googAccelerateRate),d.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),d.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),d.speechExpandRate=Number(r.googSpeechExpandRate),d.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),d.jitterBufferMs=Number(r.googJitterBufferMs),d.jitterMs=Number(r.googJitterReceived),d.bytes=Number(r.bytesReceived),d.packets=Number(r.packetsReceived),d.packetsLost=Number(r.packetsLost),d.ssrc=Number(r.ssrc),d.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),d.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),d.receivedFrames>0&&!this.isFirstAudioReceived[d.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(d.ssrc),this.isFirstAudioReceived[d.ssrc]=!0),d.decodingNormal>0&&!this.isFirstAudioDecoded[d.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(d.ssrc),this.isFirstAudioDecoded[d.ssrc]=!0),this._stats.audioRecv.push(d);break}case"audio_send":{const d=As(Vh);d.codec=r.googCodecName,d.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,d.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),d.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),d.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),d.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),d.bytes=Number(r.bytesSent),d.packets=Number(r.packetsSent),d.packetsLost=Number(r.packetsLost),d.ssrc=Number(r.ssrc),d.rttMs=Number(r.googRtt||0),this._stats.rtt=d.rttMs,this._stats.audioSend.push(d);break}}})}_getStats(){return new z((n,r)=>{this.pc.getStats(n,r)})}statsResponsesToObjects(n){const r=[];return n.result().forEach(a=>{const l={id:a.id,timestamp:a.timestamp.valueOf().toString(),type:a.type};a.names().forEach(d=>{l[d]=a.stat(d)}),r.push(l)}),r}}function c2(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Bh(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?c2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):c2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class yN extends wT{constructor(){super(...arguments),C(this,"_stats",qd),C(this,"report",void 0),C(this,"lastDecodeVideoReceiverStats",new Map),C(this,"lastVideoFramesRecv",new Map),C(this,"lastVideoFramesSent",new Map),C(this,"lastVideoFramesDecode",new Map),C(this,"lastVideoJBDelay",new Map),C(this,"lastAudioJBDelay",new Map),C(this,"mediaBytesSent",new Map),C(this,"mediaBytesRetransmit",new Map),C(this,"mediaBytesTargetEncode",new Map),C(this,"lastEncoderMs",new Map)}updateStats(){var n=this;return x(function*(){n.report=yield n.pc.getStats(),n._stats=As(qd),n.report.forEach(r=>{switch(r.type){case Nr.OUTBOUND:case Nr.INBOUND:{const a=r.mediaType||r.kind,l=!a&&"frameWidth"in r,d=!a&&!("frameWidth"in r);r.type===Nr.OUTBOUND?"audio"===a||d?n.processAudioOutboundStats(r):("video"===a||l)&&n.processVideoOutboundStats(r):r.type===Nr.INBOUND&&("audio"===a||d?n.processAudioInboundStats(r):("video"===a||l)&&n.processVideoInboundStats(r));break}case Nr.TRANSPORT:{const a=n.report.get(r.selectedCandidatePairId);a&&n.processCandidatePairStats(a);break}case Nr.CANDIDATE_PAIR:r.selected&&n.processCandidatePairStats(r)}}),n.updateSendBitrate(),n._stats.timestamp=Date.now(),n.calcLossRate(n._stats),n.stats=n._stats})()}getSelectedCandidatePair(){var n=this;return x(function*(){const r=yield n.pc.getStats(),a={local:Bh({},Ds),remote:Bh({},Ds)};return r.forEach(l=>{let d;if(l.type===Nr.TRANSPORT&&(d=r.get(l.selectedCandidatePairId)),l.type===Nr.CANDIDATE_PAIR&&l.selected&&(d=l),d){const h=(p,m)=>{p.type=m.type,p.id=m.id,m.address&&(p.address=m.address),m.candidateType&&(p.candidateType=m.candidateType),m.port&&(p.port=m.port),m.priority&&(p.priority=m.priority),m.protocol&&(p.protocol=m.protocol),m.relayProtocol&&(p.relayProtocol=m.relayProtocol)};if(d.localCandidateId){const p=r.get(d.localCandidateId);p&&h(a.local,p)}if(d.remoteCandidateId){const p=r.get(d.remoteCandidateId);p&&h(a.remote,p)}}}),a})()}processCandidatePairStats(n){if(this._stats.sendBandwidth=n.availableOutgoingBitrate||0,n.currentRoundTripTime&&(this._stats.rtt=1e3*n.currentRoundTripTime),this._stats.videoSend.forEach(r=>{n.currentRoundTripTime&&(r.rttMs=1e3*n.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{n.currentRoundTripTime&&(r.rttMs=1e3*n.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=n.id,n.localCandidateId){const r=this.report.get(n.localCandidateId);r&&this.processCandidateStats(r)}if(n.remoteCandidateId){const r=this.report.get(n.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(n){let r;n.type===Nr.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),n.type===Nr.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=n.type,r.id=n.id,n.address&&(r.address=n.address),n.candidateType&&(r.candidateType=n.candidateType),n.port&&(r.port=n.port),n.priority&&(r.priority=n.priority),n.protocol&&(r.protocol=n.protocol),n.relayProtocol&&(r.relayProtocol=n.relayProtocol),n.type===Nr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Bh({},r),Bh({},this.stats.selectedCandidatePair.localCandidate)),n.type===Nr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Bh({},r),Bh({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(n){let r=this._stats.audioRecv.find(a=>a.ssrc===n.ssrc);r||(r=As(TT),this._stats.audioRecv.push(r)),r.ssrc=n.ssrc,r.packets=n.packetsReceived,r.packetsLost=n.packetsLost,r.bytes=n.bytesReceived,r.jitterMs=1e3*n.jitter,this.processAudioTrackReceiverStats(n,n.trackId,r),n.codecId&&(r.codec=this.getCodecFromCodecStats(n.codecId)),r.receivedFrames||(r.receivedFrames=n.packetsReceived),r.droppedFrames||(r.droppedFrames=n.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),"number"==typeof n.concealedSamples&&(r.concealedSamples=n.concealedSamples)}processVideoInboundStats(n){let r=this._stats.videoRecv.find(h=>h.ssrc===n.ssrc);r||(r=As(s2),this._stats.videoRecv.push(r)),r.ssrc=n.ssrc,r.packets=n.packetsReceived,r.packetsLost=n.packetsLost,r.bytes=n.bytesReceived,r.firsCount=n.firCount,r.nacksCount=n.nackCount,r.plisCount=n.pliCount,r.framesDecodeCount=n.framesDecoded,r.totalInterFrameDelay=n.totalInterFrameDelay,r.totalSquaredInterFrameDelay=n.totalSquaredInterFrameDelay;const a=this.lastDecodeVideoReceiverStats.get(r.ssrc),l=this.lastVideoFramesDecode.get(r.ssrc),d=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame?r.decodedFrame.width:0,r.decodedFrame?r.decodedFrame.height:0),this.isFirstVideoDecoded[r.ssrc]=!0),a){const h=a.stats,p=d-a.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&p>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(a.lts=Date.now(),r.framesDecodeInterval=p,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),n.framesDecoded&&n.qpSum&&(r.qpSumPerFrame=a.stats.framesDecodeCount>n.framesDecoded?n.qpSum/n.framesDecoded:(n.qpSum-a.qpSum)/(n.framesDecoded-a.stats.framesDecodeCount))}l&&d-l.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-l.count)/((d-l.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:r.decodeFrameRate})):l?r.decodeFrameRate=l.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:0}),n.totalDecodeTime&&(r.decodeMs=1e3*n.totalDecodeTime),this.processVideoTrackReceiverStats(n,n.trackId,r),n.codecId&&(r.codec=this.getCodecFromCodecStats(n.codecId)),n.framerateMean&&(r.framesRateFirefox=n.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:Bh({},r),lts:a?a.lts:Date.now(),qpSum:n.qpSum})}processVideoOutboundStats(n){let r=this._stats.videoSend.find(l=>l.ssrc===n.ssrc);r||(r=As(a2),this._stats.videoSend.push(r));const a=this.mediaBytesSent.get(n.ssrc);if(a)a.add(n.bytesSent);else{const l=new CT(10);l.add(n.bytesSent),this.mediaBytesSent.set(n.ssrc,l)}if(void 0!==n.retransmittedBytesSent){const l=this.mediaBytesRetransmit.get(n.ssrc);if(l)l.add(n.retransmittedBytesSent);else{const d=new CT(10);d.add(n.retransmittedBytesSent),this.mediaBytesRetransmit.set(n.ssrc,d)}}if(n.totalEncodedBytesTarget){const l=this.mediaBytesTargetEncode.get(n.ssrc);if(l)l.add(n.totalEncodedBytesTarget);else{const d=new CT(10);d.add(n.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(n.ssrc,d)}}if(r.ssrc=n.ssrc,r.bytes=n.bytesSent,r.packets=n.packetsSent,r.firsCount=n.firCount,r.nacksCount=n.nackCount,r.plisCount=n.pliCount,r.frameCount=n.framesEncoded,r.adaptionChangeReason=n.qualityLimitationReason,r.scalabilityMode=n.scalabilityMode,n.totalEncodeTime&&n.framesEncoded){const l=this.lastEncoderMs.get(n.ssrc);r.avgEncodeMs=!l||l.lastFrameCount>n.framesEncoded?1e3*n.totalEncodeTime/n.framesEncoded:1e3*(n.totalEncodeTime-l.lastEncoderTime)/(n.framesEncoded-l.lastFrameCount)}if(n.framesEncoded&&n.qpSum){const l=this.lastEncoderMs.get(n.ssrc);r.qpSumPerFrame=!l||l.lastFrameCount>n.framesEncoded?n.qpSum/n.framesEncoded:(n.qpSum-l.lastQpSum)/(n.framesEncoded-l.lastFrameCount)}if(this.lastEncoderMs.set(n.ssrc,{lastFrameCount:n.framesEncoded,lastEncoderTime:n.totalEncodeTime,lastQpSum:n.qpSum,lts:Date.now()}),n.codecId&&(r.codec=this.getCodecFromCodecStats(n.codecId)),n.mediaSourceId&&this.processVideoMediaSource(n.mediaSourceId,r),this.processVideoTrackSenderStats(n,n.trackId,r),n.remoteId)this.processRemoteInboundStats(n.remoteId,r);else{const l=this.findRemoteStatsId(n.ssrc,Nr.REMOTE_INBOUND);l&&this.processRemoteInboundStats(l,r)}}processAudioOutboundStats(n){let r=this._stats.audioSend.find(a=>a.ssrc===n.ssrc);if(r||(r=As(Vh),this._stats.audioSend.push(r)),r.ssrc=n.ssrc,r.packets=n.packetsSent,r.bytes=n.bytesSent,n.mediaSourceId&&this.processAudioMediaSource(n.mediaSourceId,r),n.codecId&&(r.codec=this.getCodecFromCodecStats(n.codecId)),this.processAudioTrackSenderStats(n,n.trackId,r),n.remoteId)this.processRemoteInboundStats(n.remoteId,r);else{const a=this.findRemoteStatsId(n.ssrc,Nr.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,r)}}findRemoteStatsId(n,r){var a;const l=Array.from(yo(a=this.report).call(a)).find(d=>d.type===r&&d.ssrc===n);return l?l.id:null}processVideoMediaSource(n,r){const a=this.report.get(n);a&&a.width&&a.height&&a.framesPerSecond&&(r.inputFrame={width:a.width,height:a.height,frameRate:a.framesPerSecond})}processAudioMediaSource(n,r){const a=this.report.get(n);a&&(r.inputLevel=a.audioLevel)}processVideoTrackSenderStats(n,r,a){var l,d,h,p;const m=r?this.report.get(r):void 0,_=null!==(l=m?.framesSent)&&void 0!==l?l:n.framesSent;if("number"!=typeof _)return;let E=null!==(d=m?.frameWidth)&&void 0!==d?d:n.frameWidth,v=null!==(h=m?.frameHeight)&&void 0!==h?h:n.frameHeight,b=null!==(p=m?.framesPerSecond)&&void 0!==p?p:n.framesPerSecond;if("number"==typeof E&&"number"==typeof v||(E=0,v=0),null==b){const T=Date.now(),O=this.lastVideoFramesSent.get(a.ssrc);O&&T-O.lts>=800?(b=Math.round((_-O.count)/((T-O.lts)/1e3)),this.lastVideoFramesSent.set(a.ssrc,{count:_,lts:T,rate:b})):O?b=O.rate:this.lastVideoFramesSent.set(a.ssrc,{count:_,lts:T,rate:0})}a.sentFrame={width:E,height:v,frameRate:Math.max(0,b)}}processVideoTrackReceiverStats(n,r,a){var l,d,h,p,m;const _=r?this.report.get(r):void 0,E=null!==(l=_?.framesReceived)&&void 0!==l?l:n.framesReceived,v=null!==(d=_?.frameWidth)&&void 0!==d?d:n.frameWidth,b=null!==(h=_?.frameHeight)&&void 0!==h?h:n.frameHeight,T=null!==(p=_?.jitterBufferDelay)&&void 0!==p?p:n.jitterBufferDelay,O=null!==(m=_?.jitterBufferEmittedCount)&&void 0!==m?m:n.jitterBufferEmittedCount;if("number"==typeof E){const P=this.lastVideoFramesRecv.get(a.ssrc),D=Date.now();a.framesReceivedCount=E;let L=0;P&&D-P.lts>=800?(L=Math.round((E-P.count)/((D-P.lts)/1e3)),this.lastVideoFramesRecv.set(a.ssrc,{count:E,lts:D,rate:L})):P?L=P.rate:this.lastVideoFramesRecv.set(a.ssrc,{count:E,lts:D,rate:0}),a.receivedFrame={width:v||0,height:b||0,frameRate:L||0},a.decodedFrame={width:v||0,height:b||0,frameRate:a.decodeFrameRate||0},a.outputFrame={width:v||0,height:b||0,frameRate:a.decodeFrameRate||0}}if(T&&O){const P=this.lastVideoJBDelay.get(a.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let D=P.jitterBufferMs;const L=O-P.jitterBufferEmittedCount;L>0&&(D=1e3*(T-P.jitterBufferDelay)/L),a.jitterBufferMs=D,a.currentDelayMs=Math.round(D),this.lastVideoJBDelay.set(a.ssrc,{jitterBufferDelay:T,jitterBufferEmittedCount:O,jitterBufferMs:a.currentDelayMs})}}processAudioTrackSenderStats(n,r,a){var l,d,h,p;const m=r?this.report.get(r):void 0,_=null!==(l=null!==(d=m?.echoReturnLoss)&&void 0!==d?d:n.echoReturnLoss)&&void 0!==l?l:0,E=null!==(h=null!==(p=m?.echoReturnLossEnhancement)&&void 0!==p?p:n.echoReturnLossEnhancement)&&void 0!==h?h:0;a.aecReturnLoss=_,a.aecReturnLossEnhancement=E}processAudioTrackReceiverStats(n,r,a){var l,d,h,p,m,_,E;const v=r?this.report.get(r):void 0,b=null!==(l=v?.removedSamplesForAcceleration)&&void 0!==l?l:n.removedSamplesForAcceleration,T=null!==(d=v?.totalSamplesReceived)&&void 0!==d?d:n.totalSamplesReceived,O=null!==(h=v?.jitterBufferDelay)&&void 0!==h?h:n.jitterBufferDelay,P=null!==(p=v?.jitterBufferEmittedCount)&&void 0!==p?p:n.jitterBufferEmittedCount,D=null!==(m=v?.audioLevel)&&void 0!==m?m:n?.audioLevel,L=null!==(_=v?.totalSamplesDuration)&&void 0!==_?_:n?.totalSamplesDuration,V=null!==(E=v?.concealedSamples)&&void 0!==E?E:n.concealedSamples;if(b&&T&&(a.accelerateRate=b/T),O&&P){const J=this.lastAudioJBDelay.get(a.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let se=J.jitterBufferMs;const q=P-J.jitterBufferEmittedCount;q>0&&(se=1e3*(O-J.jitterBufferDelay)/q),a.jitterBufferMs=Math.round(se),this.lastAudioJBDelay.set(a.ssrc,{jitterBufferDelay:O,jitterBufferEmittedCount:P,jitterBufferMs:a.jitterBufferMs})}a.outputLevel=D;let U=1920;L&&T&&(U=T/L/50,a.receivedFrames=Math.round(T/U)),V&&(a.droppedFrames=Math.round(V/U))}processRemoteInboundStats(n,r){const a=this.report.get(n);a&&(r.packetsLost=a.packetsLost,a.roundTripTime&&(r.rttMs=1e3*a.roundTripTime),a.jitter&&(r.jitterMs=1e3*a.jitter),a.timestamp&&(r.timestamp=a.timestamp))}getCodecFromCodecStats(n){const r=this.report.get(n);if(!r)return"";const a=r.mimeType.match(/\/(.*)$/);return a&&a[1]?a[1]:""}updateSendBitrate(){let n=0,r=null,a=null;this.mediaBytesSent.forEach(d=>{n+=d.diffMean()}),this.mediaBytesRetransmit.forEach(d=>{r=null===r?d.diffMean():r+d.diffMean()}),this.mediaBytesTargetEncode.forEach(d=>{a=null===a?d.diffMean():a+d.diffMean()}),this._stats.bitrate={actualEncoded:8*(null!==r?n-r:n)/(this.options.updateInterval/1e3),transmit:8*n/(this.options.updateInterval/1e3)},null!==r&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),null!==a&&(this._stats.bitrate.targetEncoded=8*a/(this.options.updateInterval/1e3))}}class l2 extends wT{updateStats(){return z.resolve()}}function uv(s){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const d=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new YV(s,{updateInterval:n,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:l}):new yN(s,{updateInterval:n,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:l}):window.RTCStatsReport&&s.getStats()instanceof z?new yN(s,{updateInterval:n,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:l}):new l2(s,{updateInterval:n,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:l})}function d2(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function bN(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?d2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):d2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class ai extends _h{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(n,r){super(n,r),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"statsFilter",void 0),C(this,"useRTX",!1),C(this,"localCapabilities",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"establishPromise",void 0),C(this,"mutex",new Zn("P2PConnection-mutex")),this.store=r,this.peerConnection=new RTCPeerConnection(ai.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.statsFilter=uv(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,zt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){var n=this;return x(function*(){try{const r=yield n.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=Wd(r.sdp),l=gT(r.sdp,{filterRTX:!n.useRTX,filterVideoFec:j("FILTER_VIDEO_FEC"),filterAudioFec:j("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return n.localCapabilities=l,n.initialOffer=r,bN(bN({},a),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:l},offerSDP:r.sdp})}catch(r){throw new X(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}})()}connect(n,r,a,l,d,h){var p=this;return x(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");p.remoteSDP=new class{constructor(_){C(this,"sessionDesc",void 0),C(this,"localCapabilities",void 0),C(this,"rtpCapabilities",void 0),C(this,"candidates",void 0),C(this,"iceParameters",void 0),C(this,"dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),_=hn(_);const{remoteIceParameters:E,remoteDtlsParameters:v,candidates:b,remoteRTPCapabilities:T,remoteSetup:O,localCapabilities:P,sdkCodec:D,cname:L}=_,V=cn.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=T,this.candidates=b,this.iceParameters=E,this.dtlsParameters=v,this.setup=O,this.localCapabilities=P,this.cname=L;for(let U=0;U<V.mediaDescriptions.length;U++){const J=V.mediaDescriptions[U];if(J.attributes.iceUfrag=E.iceUfrag,J.attributes.icePwd=E.icePwd,J.attributes.fingerprints=v.fingerprints,J.attributes.candidates=b,J.attributes.setup=O,"video"===J.media.mediaType){J.media.fmts=T.videoCodecs.map(q=>q.payloadType.toString(10));let se=T.videoCodecs.filter(q=>{var Q,$;return null===(Q=q.rtpMap)||void 0===Q?void 0:ye($=Q.encodingName.toLowerCase()).call($,D)});0===se.length&&(se=T.videoCodecs),J.attributes.payloads=se,J.attributes.extmaps=T.videoExtensions}"audio"===J.media.mediaType&&(J.media.fmts=T.audioCodecs.map(se=>se.payloadType.toString(10)),J.attributes.payloads=T.audioCodecs,J.attributes.extmaps=T.audioExtensions),V.mediaDescriptions[U]=this.mungMediaDesc(J)}this.sessionDesc=V,this.currentMidIndex=V.mediaDescriptions.length-1}toString(){return cn.print(this.sessionDesc)}send(_,E,v){const{ssrcs:b,ssrcGroups:T}=Zr(E,this.cname),O=this.sessionDesc.mediaDescriptions.find(L=>_===ge.VIDEO?"video"===L.media.mediaType:"audio"===L.media.mediaType),P=b[0].attributes.label,D=b[0].attributes.mslabel;return O.attributes.ssrcs=O.attributes.ssrcs.concat(b),O.attributes.ssrcGroups=O.attributes.ssrcGroups.concat(T),{id:P,mslabel:D}}batchSend(_){return _.map(E=>{let{kind:v,ssrcMsg:b}=E;return this.send(v,b,void 0)})}stopSending(_){this.sessionDesc.mediaDescriptions.forEach(E=>{const v=[],b=[],T=[];E.attributes.ssrcs.forEach(O=>{ye(_).call(_,O.attributes.label||"")?T.push(O):v.push(O)}),E.attributes.ssrcGroups.forEach(O=>{var P;ye(P=T.map(D=>D.ssrcId)).call(P,O.ssrcIds[0])||b.push(O)}),E.attributes.ssrcs=v,E.attributes.ssrcGroups=b})}mute(_){const E=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===_);if(!E)throw new Error("mediaDescription not found with ".concat(_," in remote SDP when calling RemoteSDP.mute."));E.attributes.direction="inactive"}unmute(_){const E=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===_);if(!E)throw new Error("mediaDescription not found with ".concat(_," in remote SDP when calling RemoteSDP.unmute."));E.attributes.direction="sendonly"}receive(_,E,v){_.forEach((b,T)=>{const O=b._mediaStreamTrack,P=this.sessionDesc.mediaDescriptions.findIndex(L=>L.attributes.mid===O.kind),D=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[P],b);this.sessionDesc.mediaDescriptions[P]=D})}stopReceiving(_){}updateCandidates(_){_===wi.TCP?this.candidates.forEach(E=>{-1===this.candidates.findIndex(v=>"tcp"===v.transport&&v.connectionAddress===E.connectionAddress&&v.port===E.port)&&this.candidates.push(ST(ST({},E),{},{foundation:"tcpcandidate",priority:Number(E.priority)-1+"",transport:"tcp",port:Number(E.port)+90+""}))}):this.candidates=this.candidates.filter(E=>"tcp"!==E.transport);for(const E of this.sessionDesc.mediaDescriptions)E.attributes.candidates=this.candidates}restartICE(_){_=hn(_),this.iceParameters=_,this.sessionDesc.mediaDescriptions.forEach(E=>{E.attributes.iceUfrag=_.iceUfrag,E.attributes.icePwd=_.icePwd})}predictReceivingMids(_){const E=[];for(let v=0;v<_;v++)E.push((this.currentMidIndex+v+1).toString(10));return E}mungRecvMediaDsec(_,E){const v=hn(_);return zd(v,E),vT(v,E),v}updateRecvMedia(_,E){const v=this.sessionDesc.mediaDescriptions.findIndex(b=>b.attributes.mid===_);if(-1!==v){const b=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[v],E);this.sessionDesc.mediaDescriptions[v]=b}}bumpMid(_){this.currentMidIndex+=_}updateTrackLabel(_,E,v){const b=this.sessionDesc.mediaDescriptions.find(O=>_===ge.VIDEO?"video"===O.attributes.mid:"audio"===O.attributes.mid);if(b){const O=b.attributes.ssrcs.find(P=>P.attributes.label===E);var T;O&&(O.attributes.label=v,null===(T=O.attributes.msid)||void 0===T||T.replace(E,v))}}mungMediaDesc(_){const E=hn(_);return ET(E),function(v){const b=v.attributes.extmaps.find(T=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===T.extensionName);b&&v.attributes.extmaps.splice(v.attributes.extmaps.indexOf(b),1),v.attributes.payloads.forEach(T=>{const O=T.rtcpFeedbacks.findIndex(P=>"transport-cc"===P.type);-1!==O&&T.rtcpFeedbacks.splice(O,1)})}(E),E}getSSRC(_){for(const E of this.sessionDesc.mediaDescriptions)for(const v of E.attributes.ssrcs)if(v.attributes.label===_)return[v]}}({remoteIceParameters:n,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:l.send,remoteSetup:d,localCapabilities:p.localCapabilities,sdkCodec:p.store.codec,cname:h});const m=p.remoteSDP.toString();yield p.peerConnection.setLocalDescription(p.initialOffer),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}})()}updateRemoteRTPCapabilities(n,r){return x(function*(){throw new X(M.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")})()}send(n,r){var a=this;return cs(function*(){const l=yield ht(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=n.map(b=>a.peerConnection.addTrack(b._mediaStreamTrack)),h=yield ht(a.peerConnection.createOffer()),p=cn.parse(h.sdp),m=n.map(b=>{const T=b._mediaStreamTrack,O=p.mediaDescriptions.find(P=>P.attributes.mid===T.kind);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return function(P,D,L){const V=P.attributes.ssrcs.filter(J=>J.attributes.label===D),U=P.attributes.ssrcGroups;if(0===V.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(U&&V.length>1){const J=U.find(se=>-1!==se.ssrcIds.indexOf(V[0].ssrcId));return J?[{ssrcId:J.ssrcIds[0],rtx:L?J.ssrcIds[1]:void 0}]:[{ssrcId:V[0].ssrcId}]}return[{ssrcId:V[0].ssrcId}]}(O,T.id,a.useRTX)});let _;try{_=yield m}catch(b){throw d.forEach(T=>{Ki()&&T.replaceTrack(null),a.peerConnection.removeTrack(T)}),b}const E=a.mungSendOfferSDP(h.sdp,n);a.remoteSDP.receive(n,r,_);const v=a.remoteSDP.toString();return yield ht(a.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield ht(a.applySendEncodings(d,n)),yield ht(a.peerConnection.setRemoteDescription({type:"answer",sdp:v})),n.map((b,T)=>({localSSRC:m[T],id:b._mediaStreamTrack.id}))}catch(d){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{l()}})()}stopSending(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=r.peerConnection.getSenders().filter(h=>{var p;return-1!==n.indexOf((null===(p=h.track)||void 0===p?void 0:p.id)||"")});if(a.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");a.map(h=>{Ki()&&h.replaceTrack(null),r.peerConnection.removeTrack(h)});const l=yield r.peerConnection.createOffer();yield r.peerConnection.setLocalDescription(l),r.remoteSDP.stopReceiving(n);const d=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}})()}receive(n,r,a,l){var d=this;return x(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{id:h,mslabel:p}=d.remoteSDP.send(n,r,l),m=new z((v,b)=>{const T=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(h)))},1e4),O=P=>{const D=dt();if(("Safari"===D.name&&11===Number(D.version)||Fi())&&P.track.id!==h&&P.streams[0].id===p){var L;const V=P.streams[0].getTracks()[0];return null===(L=d.remoteSDP)||void 0===L||L.updateTrackLabel(n,h,P.track.id),d.peerConnection.removeEventListener("track",O),clearTimeout(T),void v(V)}if(P.track.id===h)return d.peerConnection.removeEventListener("track",O),clearTimeout(T),void v(P.track)};d.peerConnection.addEventListener("track",O)}),_=d.remoteSDP.toString();yield d.peerConnection.setRemoteDescription({type:"offer",sdp:_});const E=yield d.peerConnection.createAnswer();return yield d.peerConnection.setLocalDescription(E),{track:yield m,id:h}}catch(h){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}stopReceiving(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(n);const a=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=yield r.peerConnection.createAnswer();yield r.peerConnection.setLocalDescription(l)}catch(a){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(n){return x(function*(){})()}unmuteRemote(n){return x(function*(){})()}muteLocal(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=r.peerConnection.getSenders().filter(l=>{var d;return-1!==n.indexOf((null===(d=l.track)||void 0===d?void 0:d.id)||"")});if(a.length!==n.length)throw new Error("sender' length doesn't match mids' length.");a.map(l=>{if(Ki()&&l.track)l.track.enabled=!1;else{const d=l.getParameters();d.encodings.forEach(h=>h.active=!1),l.setParameters(d)}})}catch(a){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=r.peerConnection.getSenders().filter(h=>{var p;return-1!==n.indexOf((null===(p=h.track)||void 0===p?void 0:p.id)||"")});if(a.length!==n.length)throw new Error("Senders' length doesn't match mids' length.");a.map(function(){var h=x(function*(p){if(Ki()&&p.track)p.track.enabled=!0;else{const m=p.getParameters();m.encodings.forEach(_=>_.active=!0),yield p.setParameters(m)}});return function(p){return h.apply(this,arguments)}}());const l=yield r.peerConnection.createOffer();yield r.peerConnection.setLocalDescription(l);const d=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(n){var r=this;return cs(function*(){const a=yield ht(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if($e().supportPCSetConfiguration){const m=r.peerConnection.getConfiguration(),_=n===wi.RELAY?"relay":"all";m.iceTransportPolicy!==_&&(w.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(_,"]")),m.iceTransportPolicy=_,r.peerConnection.setConfiguration(m))}else if(n===wi.RELAY)return;n!==wi.RELAY&&r.remoteSDP.updateCandidates(n);const l=yield ht(r.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Wd(l.sdp),{remoteIceParameters:h}=yield d.iceParameters;r.remoteSDP.restartICE(h);const p=r.remoteSDP.toString();yield ht(r.peerConnection.setLocalDescription(l)),yield ht(r.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(l){w.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),l)}finally{a()}})()}close(){var n;this.peerConnection.close(),null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}updateEncoderConfig(n,r){var a=this;return x(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const l=yield a.peerConnection.createOffer(),d=a.mungSendOfferSDP(l.sdp,[r]);a.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);const h=a.remoteSDP.toString();yield a.peerConnection.setLocalDescription({type:"offer",sdp:d}),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(l){throw new X(M.EXCHANGE_SDP_FAILED,l.toString())}})()}updateSendParameters(n,r){var a=this;return x(function*(){const l=a.peerConnection.getSenders().filter(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===n});1===l.length&&(yield a.applySendEncodings(l,[r]))})()}setStatsRemoteVideoIsReady(n,r){this.statsFilter.setVideoIsReady2(n,r)}replaceTrack(n,r){var a=this;return x(function*(){const l=a.peerConnection.getSenders().find(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===r});l&&(yield l.replaceTrack(n._mediaStreamTrack))})()}createDataChannels(n,r){throw new X(M.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(n){throw new X(M.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;null===(n=this.onICEConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const r={iceServers:[],sdpSemantics:"plan-b"};return n.iceServers?r.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(Aa(n.turnServer.servers)?r.iceServers=n.turnServer.servers:(r.iceServers&&r.iceServers.push(...ai.turnServerConfigToIceServers(n.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&n.turnServer.serversFromGateway&&r.iceServers.push(...ai.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(n){const r=[];return n.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}updateRtpSenderEncodings(n,r){var a=this;return x(function*(){var l;if(r||(r=a.peerConnection.getSenders().find(E=>{var v;return(null===(v=E.track)||void 0===v?void 0:v.id)===n._mediaStreamTrack.id})),!r)return w.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(!$e().supportSetRtpSenderParameters)return w.warn("Browser not support set rtp-sender parameters");const d={},h={};if(n instanceof ze)switch(n._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(j("DSCP_TYPE")&&zs()){var p;const E=j("DSCP_TYPE");ye(p=["very-low","low","medium","high"]).call(p,E)&&(h.networkPriority=E)}const m=r.getParameters(),_=null===(l=m.encodings)||void 0===l?void 0:l[0];_&&Object.assign(_,h),Object.assign(m,d),w.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),yield r.setParameters(m)})()}applySendEncodings(n,r){var a=this;return x(function*(){try{if(!$e().supportSetRtpSenderParameters||n.length!==r.length)return;for(let l=0;l<n.length;l++){const d=n[l],h=r[l];d&&h&&(yield a.updateRtpSenderEncodings(h,d))}}catch{w.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(n,r){const a=cn.parse(n);return r.forEach((l,d)=>{const h=l._mediaStreamTrack,p=a.mediaDescriptions.find(m=>m.attributes.mid===h.kind);p&&zd(p,l)}),cn.print(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,r,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,n,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(n,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,n,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,n,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}batchReceive(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const a=r.remoteSDP.batchSend(n).map((h,p)=>{let{id:m,mslabel:_}=h;const{kind:E}=n[p];return new z((v,b)=>{const T=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(m)))},1e4),O=P=>{const D=dt();if("Safari"===D.name&&11===Number(D.version)&&P.track.id!==m&&P.streams[0].id===_){var L;const V=P.streams[0].getTracks()[0];return null===(L=r.remoteSDP)||void 0===L||L.updateTrackLabel(E,m,P.track.id),r.peerConnection.removeEventListener("track",O),clearTimeout(T),void v({track:V,id:m})}if(P.track.id===m)return r.peerConnection.removeEventListener("track",O),clearTimeout(T),void v({track:P.track,id:m})};r.peerConnection.addEventListener("track",O)})}),l=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:l});const d=yield r.peerConnection.createAnswer();return yield r.peerConnection.setLocalDescription(d),yield z.all(a)}catch(a){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}})()}getRemoteSSRC(n){var r=this;return x(function*(){if(!r.remoteSDP)return;const a=r.remoteSDP.getSSRC(n);return a?.[0].ssrcId})()}setConfiguration(n){if($e().supportPCSetConfiguration){const r=ai.resolvePCConfiguration(n);this.peerConnection.setConfiguration(r)}}}function eo(s,n,r){const a=s[n];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const l=this.mutex,d=yield l.lock("Locking from P2PConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{d()}}),r}function u2(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Ol(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?u2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):u2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}te([eo,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",z)],ai.prototype,"connect",null),te([eo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],ai.prototype,"stopSending",null),te([eo,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",z)],ai.prototype,"receive",null),te([eo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],ai.prototype,"stopReceiving",null),te([eo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],ai.prototype,"muteRemote",null),te([eo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],ai.prototype,"unmuteRemote",null),te([eo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],ai.prototype,"muteLocal",null),te([eo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],ai.prototype,"unmuteLocal",null),te([eo,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ai.prototype,"close",null),te([eo,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",z)],ai.prototype,"updateEncoderConfig",null),te([eo,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",z)],ai.prototype,"updateSendParameters",null),te([eo,N("design:type",Function),N("design:paramtypes",[Ri,String]),N("design:returntype",z)],ai.prototype,"replaceTrack",null),te([eo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],ai.prototype,"getRemoteSSRC",null);function em(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function jh(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?em(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):em(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}let Jn=class N0 extends _h{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,r;return null!==(n=null===(r=this.peerConnection.getReceivers()[0])||void 0===r||null===(r=r.transport)||void 0===r?void 0:r.state)&&void 0!==n?n:null}constructor(n,r){super(n,r),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"transportEventReceiver",void 0),C(this,"statsFilter",void 0),C(this,"useXR",j("USE_XR")),C(this,"localCapabilities",void 0),C(this,"remoteCodecs",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"dataStreamChannelMap",new Map),C(this,"establishPromise",void 0),C(this,"mutex",new Zn("P2PConnection-mutex")),this.store=r,this.peerConnection=new RTCPeerConnection(N0.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.statsFilter=uv(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,zt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}updateRemoteRTPCapabilities(n,r){var a=this;return x(function*(){a.remoteCodecs=r;const l=[...new Set(a.localCapabilities&&a.localCapabilities.send.videoCodecs.map(d=>d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").filter(d=>{var h;return ye(h=Object.keys(Vi)).call(h,d)}))];if(Se.updateRemoteRTPCapabilities(a.store.sessionId,{mids:n,localCodecs:l,remoteCodecs:a.remoteCodecs}),a.remoteSDP)if(a.remoteSDP.updateRemoteCodec(n,r,a.store.codec)){const d=yield a.peerConnection.createOffer(),h=a.logSDPExchange(d.sdp||"","offer","local","muteLocal");yield a.peerConnection.setLocalDescription(d);const p=a.remoteSDP.toString();h?.(p),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:p})}else w.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else w.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(l,", codecs: ").concat(r))})()}establish(){var n=this;return x(function*(){try{n.peerConnection.addTransceiver("video",{direction:"recvonly"}),n.peerConnection.addTransceiver("audio",{direction:"recvonly"});const r=yield n.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=Wd(r.sdp),l=yield pN({filterRTX:!j("USE_PUB_RTX")&&!j("USE_SUB_RTX"),filterVideoFec:j("FILTER_VIDEO_FEC"),filterAudioFec:j("FILTER_AUDIO_FEC"),filterVideoCodec:j("FILTER_VIDEO_CODEC")},{useXR:n.useXR});return n.localCapabilities=cv(l),n.initialOffer=r,jh(jh({},a),{},{rtpCapabilities:l,offerSDP:r.sdp})}catch(r){throw new X(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}})()}connect(n,r,a,l,d,h){var p=this;return x(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");p.remoteSDP=new class{get localCapabilities(){return hn(this._localCapabilities)}get rtpCapabilities(){return hn(this._rtpCapabilities)}get candidates(){return hn(this._candidates)}get iceParameters(){return hn(this._iceParameters)}get dtlsParameters(){return hn(this._dtlsParameters)}constructor(O){C(this,"sessionDesc",void 0),C(this,"_localCapabilities",void 0),C(this,"_rtpCapabilities",void 0),C(this,"_candidates",void 0),C(this,"_iceParameters",void 0),C(this,"_dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),C(this,"firefoxSsrcMidMap",new Map),O=hn(O);const{remoteIceParameters:P,remoteDtlsParameters:D,candidates:L,remoteRTPCapabilities:V,remoteSetup:U,localCapabilities:J,cname:se}=O,q=cn.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=V,this._candidates=L,this._iceParameters=P,this._dtlsParameters=D,this._localCapabilities=J,this.setup=U,this.cname=se;const Q=this.rtpCapabilities.send;for(const $ of q.mediaDescriptions){if($.attributes.iceUfrag=P.iceUfrag,$.attributes.icePwd=P.icePwd,$.attributes.fingerprints=D.fingerprints,$.attributes.candidates=L,$.attributes.setup=U,"video"===$.media.mediaType&&($.media.fmts=Q.videoCodecs.map(Y=>Y.payloadType.toString(10)),$.attributes.payloads=Q.videoCodecs,$.attributes.extmaps=Q.videoExtensions,j("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:Y,ssrcGroups:me}=Zr([{ssrcId:4e4,rtx:j("USE_SUB_RTX")?40001:void 0}],this.cname);$.attributes.ssrcs=Y,$.attributes.ssrcGroups=me}if("audio"===$.media.mediaType&&($.media.fmts=Q.audioCodecs.map(Y=>Y.payloadType.toString(10)),$.attributes.payloads=Q.audioCodecs,$.attributes.extmaps=Q.audioExtensions,Dl($),j("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:Y,ssrcGroups:me}=Zr([{ssrcId:2e4}],this.cname);$.attributes.ssrcs=Y,$.attributes.ssrcGroups=me}}this.sessionDesc=q,this.currentMidIndex=q.mediaDescriptions.length-1}preloadRemoteMedia(){const O=j("PRELOAD_MEDIA_COUNT"),P=this.candidates,D=this.dtlsParameters,L=this.iceParameters,V=this.rtpCapabilities.send;for(let U=1;U<O;U++){const J=2*U+2e4,se=2*U+4e4,{ssrcs:q,ssrcGroups:Q}=Zr([{ssrcId:J}],this.cname),{ssrcs:$,ssrcGroups:Y}=Zr([{ssrcId:se,rtx:j("USE_SUB_RTX")?se+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:V.videoCodecs.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:L.iceUfrag,icePwd:L.icePwd,unrecognized:[],candidates:P,extmaps:V.videoExtensions,fingerprints:D.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:$,ssrcGroups:Y,rtcpFeedbackWildcards:[],payloads:V.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*U)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:V.audioCodecs.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:L.iceUfrag,icePwd:L.icePwd,unrecognized:[],candidates:P,extmaps:V.audioExtensions,fingerprints:D.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:q,ssrcGroups:Q,rtcpFeedbackWildcards:[],payloads:V.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*U+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return cn.print(this.sessionDesc)}send(O,P,D,L){const{ssrcs:V,ssrcGroups:U}=Zr(P,this.cname,j("SYNC_GROUP")?D:void 0),J=this.findPreloadMediaDesc(V);if(J){if(zt()&&this.firefoxSsrcMidMap.set(V[0].ssrcId,J.attributes.mid),L&&(L.twcc||L.remb)){const se=this.sessionDesc.mediaDescriptions.indexOf(J);return this.sessionDesc.mediaDescriptions[se]=this.mungSendMediaDesc(J,L),{mid:J.attributes.mid,needExchangeSDP:!0}}return{mid:J.attributes.mid,needExchangeSDP:!1}}{const se=this.findAvailableMediaIndex(O,V);let q;return-1===se||1===se&&(Ki()||SA())||0===se&&j("USE_SUB_RTX")||CA()?(q=this.createOrRecycleSendMedia(O,V,U,"sendonly",L),this.updateBundleMids()):(q=hn(this.sessionDesc.mediaDescriptions[se]),q.attributes.direction="sendonly",q.attributes.ssrcs=V,q.attributes.ssrcGroups=U,this.sessionDesc.mediaDescriptions[se]=this.mungSendMediaDesc(q,L)),zt()&&this.firefoxSsrcMidMap.set(V[0].ssrcId,q.attributes.mid),{mid:q.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:O,needExchangeSDP:P}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:O.attributes.mid,needExchangeSDP:P}}batchSend(O){const P=O.map(V=>{let{kind:U,ssrcMsg:J,mslabel:se}=V;return this.send(U,J,se)}),D=[];let L=!1;return P.forEach(V=>{let{mid:U,needExchangeSDP:J}=V;J&&(L=!0),D.push(U)}),{mids:D,needExchangeSDP:L}}stopSending(O){const P=this.sessionDesc.mediaDescriptions.filter(D=>D.attributes.mid&&-1!==O.indexOf(D.attributes.mid));if(P.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");P.forEach(D=>{"0"===D.attributes.mid||zt()||CA()?D.attributes.ssrcs=[]:(D.attributes.ssrcs=[],D.attributes.direction="inactive",D.media.port="0")}),this.updateBundleMids()}mute(O){const P=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===O);if(!P)throw new Error("mediaDescription not found with ".concat(O," in remote SDP when calling RemoteSDP.mute."));P.attributes.direction="inactive"}unmute(O){const P=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===O);if(!P)throw new Error("mediaDescription not found with ".concat(O," in remote SDP when calling RemoteSDP.unmute."));P.attributes.direction="sendonly"}muteRemote(O){const P=this.sessionDesc.mediaDescriptions.filter(D=>ye(O).call(O,D.attributes.mid||""));if(P.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");P.forEach(D=>{D.attributes.direction="inactive"})}unmuteRemote(O){const P=this.sessionDesc.mediaDescriptions.filter(D=>ye(O).call(O,D.attributes.mid||""));if(P.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");P.forEach(D=>{D.attributes.direction="recvonly"})}receive(O,P,D,L){O.forEach((V,U)=>{this.createOrRecycleRecvMedia(V,[],"recvonly",P,D,L[U])}),this.updateBundleMids()}stopReceiving(O){const P=this.sessionDesc.mediaDescriptions.filter(D=>-1!==O.indexOf(D.attributes.mid));if(P.length!==O.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");P.forEach(D=>{D.media.port="0",D.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(O){const P=this._candidates.filter(D=>"udp"===D.transport);if(O===wi.TCP){if(0===P.length)return;if(j("TCP_CANDIDATE_ONLY")){const D=this._candidates.filter(L=>"tcp"===L.transport);P.forEach(L=>{-1===D.findIndex(V=>V.connectionAddress===L.connectionAddress)&&D.push(Ol(Ol({},L),{},{foundation:"tcpcandidate",priority:Number(L.priority)-1+"",transport:"tcp",port:Number(L.port)+90+""}))}),this._candidates=D}else{const D=[];P.forEach(L=>{D.push(Ol(Ol({},L),{},{foundation:"tcpcandidate",priority:Number(L.priority)-1+"",transport:"tcp",port:Number(L.port)+90+""}))}),this._candidates=[...P,...D]}}else if(O===wi.RELAY){if(0!==P.length)return;{const D=this._candidates.filter(L=>"tcp"===L.transport);D.forEach(L=>{P.push(Ol(Ol({},L),{},{foundation:"udpcandidate",priority:Number(L.priority)+1+"",transport:"udp",port:Number(L.port)-90+""}))}),this._candidates=[...P,...D]}}else 0===P.length?(this._candidates.filter(D=>"tcp"===D.transport).forEach(D=>{P.push(Ol(Ol({},D),{},{foundation:"udpcandidate",priority:Number(D.priority)+1+"",transport:"udp",port:Number(D.port)-90+""}))}),this._candidates=P):this._candidates=this._candidates.filter(D=>"tcp"!==D.transport);for(const D of this.sessionDesc.mediaDescriptions)D.attributes.candidates=this.candidates}restartICE(O){O=hn(O),this._iceParameters=O,this.sessionDesc.mediaDescriptions.forEach(P=>{P.attributes.iceUfrag=O.iceUfrag,P.attributes.icePwd=O.icePwd})}predictReceivingMids(O){const P=[];for(let D=0;D<O;D++)P.push((this.currentMidIndex+D+1).toString(10));return P}findAvailableMediaIndex(O,P){return this.sessionDesc.mediaDescriptions.findIndex(D=>{const L=D.media.mediaType===O&&"0"!==D.media.port&&("sendonly"===D.attributes.direction||"sendrecv"===D.attributes.direction)&&0===D.attributes.ssrcs.length;if(zt()){if(L){const V=this.firefoxSsrcMidMap.get(P[0].ssrcId);return!(V||"0"!==D.attributes.mid&&"1"!==D.attributes.mid)||!(!V||V!==D.attributes.mid)}return!1}return L})}createOrRecycleDataChannel(){for(const D of this.sessionDesc.mediaDescriptions)if("application"===D.media.mediaType)return{mediaDesc:D,needExchangeSDP:!1};this.currentMidIndex+=1;const O="".concat(this.currentMidIndex),P={media:{mediaType:"application",port:"9",protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(O),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(P),{mediaDesc:P,needExchangeSDP:!0}}createOrRecycleRecvMedia(O,P,D,L,V,U){const J=O._mediaStreamTrack.kind,se=this.rtpCapabilities.recv,q=dv(J,se,this.localCapabilities.send,J===ge.VIDEO?L:V),Q=J===ge.VIDEO?se.videoExtensions:se.audioExtensions;this.currentMidIndex+=1;const $="".concat(this.currentMidIndex);let Y={media:{mediaType:J,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:q.map(Ee=>Ee.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Q,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:P,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:q,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:D,rtcpMux:!0,rtcpRsize:!0,mid:"".concat($)}};Y=this.mungRecvMediaDsec(Y,O,U);const me=this.findFirstClosedMedia(J);if(me){const Ee=this.sessionDesc.mediaDescriptions.indexOf(me);this.sessionDesc.mediaDescriptions[Ee]=Y}else this.sessionDesc.mediaDescriptions.push(Y);return Y}updateRemoteCodec(O,P,D){const L=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(Y=>Y.rtpMap&&Y.rtpMap.encodingName.toLowerCase()||"").filter(Y=>{var me;return ye(me=Object.keys(Vi)).call(me,Y)}))],V=new Set(P);if(L.every(Y=>V.has(Y)))return w.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(P)),!1;const U=this._rtpCapabilities.recv.videoCodecs.filter(Y=>P.some(me=>{var Ee;return ye(Ee=Y.rtpMap&&Y.rtpMap.encodingName.toLowerCase()||"").call(Ee,me)}));if(0===U.length)return w.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(L," codecs: ").concat(P)),!1;const J=[...new Set(U.map(Y=>Y.rtpMap&&Y.rtpMap.encodingName.toLowerCase()||""))];let se;if(w.debug("updateRemoteCodec, from ".concat(L," to ").concat(J)),0===O.length)se=this.sessionDesc.mediaDescriptions.filter(Y=>"video"===Y.media.mediaType&&"recvonly"===Y.attributes.direction);else if(se=this.sessionDesc.mediaDescriptions.filter(Y=>Y.attributes.mid&&ye(O).call(O,Y.attributes.mid)&&"recvonly"===Y.attributes.direction),se.length!==O.length)return w.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(O,", codecs: ").concat(P)),!1;this._rtpCapabilities.recv.videoCodecs=U;const $=dv(ge.VIDEO,this.rtpCapabilities.recv,this.localCapabilities.send,D);return se.forEach(Y=>{const me=$.map(Ee=>Ee.payloadType.toString(10));w.debug("updateRemoteCodec mid: ".concat(Y.attributes.mid,", from ").concat(Y.attributes.payloads," to ").concat($)),Y.attributes.payloads=$,Y.media.fmts=me}),!0}createOrRecycleSendMedia(O,P,D,L,V){const U=this.rtpCapabilities.send,J=O===ge.VIDEO?U.videoCodecs:U.audioCodecs,se=O===ge.VIDEO?U.videoExtensions:U.audioExtensions;this.currentMidIndex+=1;const q="".concat(this.currentMidIndex);let Q={media:{mediaType:O,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:J.map(Y=>Y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:se,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:P,ssrcGroups:D,rtcpFeedbackWildcards:[],payloads:J,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:L,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(q)}};Q=this.mungSendMediaDesc(Q,V);const $=this.findFirstClosedMedia(O);if($){const Y=this.sessionDesc.mediaDescriptions.indexOf($);this.sessionDesc.mediaDescriptions[Y]=Q}else this.sessionDesc.mediaDescriptions.push(Q);return Q}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(O=>"0"!==O.media.port).map(O=>O.attributes.mid)}mungRecvMediaDsec(O,P,D){const L=hn(O);return ET(L),zd(L,P),vT(L,P),hN(L),sv(L,D,this.localCapabilities.send),L}mungSendMediaDesc(O,P){const D=hn(O);return sv(D,P,this.localCapabilities.recv),Dl(D),D}updateRecvMedia(O,P){const D=this.sessionDesc.mediaDescriptions.findIndex(L=>L.attributes.mid===O);if(-1!==D){const L=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[D],P);this.sessionDesc.mediaDescriptions[D]=L}}bumpMid(O){this.currentMidIndex+=O}findFirstClosedMedia(O){return this.sessionDesc.mediaDescriptions.find(P=>zt()?"0"===P.media.port&&P.media.mediaType===O:"0"===P.media.port)}findPreloadMediaDesc(O){return this.sessionDesc.mediaDescriptions.find(P=>{var D;return(null===(D=P.attributes)||void 0===D||null===(D=D.ssrcs[0])||void 0===D?void 0:D.ssrcId)===O[0].ssrcId})}getSSRC(O){var P;return null===(P=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===O))||void 0===P?void 0:P.attributes.ssrcs}}({remoteIceParameters:n,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:l,remoteSetup:d,localCapabilities:p.localCapabilities,cname:h}),Array.isArray(p.remoteCodecs)&&p.remoteCodecs.length>0&&p.remoteSDP.updateRemoteCodec([],p.remoteCodecs,p.store.codec);const m=p.remoteSDP.toString(),_=cn.parse(p.initialOffer.sdp),E=_.mediaDescriptions.find(O=>"audio"===O.media.mediaType);E&&Dl(E),p.useXR&&lv(_);const v=cn.print(_),b=p.logSDPExchange(v||"","offer","local","connect");p.store.descriptionStart(),yield p.peerConnection.setLocalDescription({type:"offer",sdp:v}),b?.(m),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m});const T=p.peerConnection.getTransceivers()[0];if(null!=T&&T.receiver&&p.tryBindTransportEvents(T.receiver),j("PRELOAD_MEDIA_COUNT")>0){p.remoteSDP.preloadRemoteMedia();const O=p.remoteSDP.toString();yield p.peerConnection.setRemoteDescription({type:"offer",sdp:O});const P=yield p.peerConnection.createAnswer();yield p.peerConnection.setLocalDescription(P)}}catch(m){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}})()}send(n,r,a){var l=this;return cs(function*(){const d=yield ht(l.mutex.lock("From P2PConnection.send"));try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[];n.forEach(P=>{const D=l.peerConnection.addTransceiver(P._mediaStreamTrack,{direction:"sendonly"});h.push(D),P._updateRtpTransceiver(D)}),zt()&&!0===j("SIMULCAST")&&(yield ht(l.applySimulcastForFirefox(h,n)));const p=yield ht(l.peerConnection.createOffer()),m=l.remoteSDP.predictReceivingMids(n.length),_=l.mungSendOfferSDP(p.sdp,n,m),E=cn.parse(_),v=m.map(P=>{const D=E.mediaDescriptions.find(L=>L.attributes.mid===P);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return dN(D,j("USE_PUB_RTX"))});let b;try{b=yield v}catch(P){b=[],l.remoteSDP.receive(n,r,a,b);const D=l.remoteSDP.toString();throw yield ht(l.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield ht(l.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield ht(l.stopSending(m,!0)),P}l.remoteSDP.receive(n,r,a,b);const T=l.remoteSDP.toString(),O=l.logSDPExchange(_,"offer","local","send");return yield ht(l.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield ht(l.applySimulcastEncodings(h,n)),yield ht(l.applySendEncodings(h,n)),O?.(T),yield ht(l.peerConnection.setRemoteDescription({type:"answer",sdp:T})),h.map((P,D)=>({localSSRC:v[D],id:m[D],transceiver:P}))}catch(h){throw h instanceof X?h:new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}createDataChannels(n,r){var a=this;return x(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let l=a.dataStreamChannelMap.get(n);l&&"open"===l.readyState?w.debug("[P2PConnection] Channels are already available and can be reused directly."):(l=a.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:j("DATASTREAM_MAX_RETRANSMITS")}),l.binaryType="arraybuffer",a.dataStreamChannelMap.set(n,l)),r.forEach(h=>{h._updateOriginDataChannel(l)});const{needExchangeSDP:d}=a.remoteSDP.sendDataChannel();if(d){const h=a.remoteSDP.toString();yield a.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=yield a.peerConnection.createAnswer();yield a.peerConnection.setLocalDescription(p),w.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else w.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(l){throw l instanceof X?l:new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(l.toString()))}})()}stopDataChannels(n){var r=this;return x(function*(){try{const a=r.dataStreamChannelMap.get(n);return a?.close(),void r.dataStreamChannelMap.delete(n)}catch(a){throw a instanceof X?a:new X(M.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(a.toString()))}})()}stopSending(n,r){var a=this;return x(function*(){const l=r?void 0:yield a.mutex.lock("From P2PConnection.stopSending");try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const d=a.peerConnection.getTransceivers().filter(_=>-1!==n.indexOf(_.mid));if(d.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");d.map(_=>{var E;_.direction="inactive",null===(E=_.stop)||void 0===E||E.call(_)});const h=yield a.peerConnection.createOffer(),p=a.logSDPExchange(h.sdp||"","offer","local","stopSending");yield a.peerConnection.setLocalDescription(h),a.remoteSDP.stopReceiving(n);const m=a.remoteSDP.toString();p?.(m),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{l&&l()}})()}receive(n,r,a,l){var d=this;return x(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=d.remoteSDP.send(n,r,a,l);if(p){const _=d.remoteSDP.toString(),E=d.logSDPExchange(_,"offer","remote","receive");yield d.peerConnection.setRemoteDescription({type:"offer",sdp:_});const v=yield d.peerConnection.createAnswer(),b=d.mungReceiveAnswerSDP(v.sdp,h,n);E?.(b||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:b}),w.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."))}else w.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(n," no need to exchange SDP."));const m=d.peerConnection.getTransceivers().find(_=>_.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h,transceiver:m}}catch(h){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:a,needExchangeSDP:l}=r.remoteSDP.batchSend(n);if(l){const d=r.remoteSDP.toString(),h=r.logSDPExchange(d,"offer","remote","receive");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:d});const p=yield r.peerConnection.createAnswer();h?.(p.sdp||""),yield r.peerConnection.setLocalDescription(p),w.debug("[".concat(r.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else w.debug("[".concat(r.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return a.map(d=>{const h=r.peerConnection.getTransceivers().find(p=>p.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d,transceiver:h}})}catch(a){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}})()}stopReceiving(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(n);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","stopReceiving");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();l?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(n," before remote SDP created."));r.remoteSDP.mute(n);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","muteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();l?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(a.toString()))}})()}unmuteRemote(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(n," before remote SDP created."));r.remoteSDP.unmute(n);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","unmuteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();l?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(a.toString()))}})()}muteLocal(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==n.indexOf(p.mid));if(a.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(p=>{p.direction="inactive"});const l=yield r.peerConnection.createOffer(),d=r.logSDPExchange(l.sdp||"","offer","local","muteLocal");yield r.peerConnection.setLocalDescription(l),r.remoteSDP.muteRemote(n);const h=r.remoteSDP.toString();d?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==n.indexOf(p.mid));if(a.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(function(){var p=x(function*(m,_){m.direction="sendonly"});return function(m,_){return p.apply(this,arguments)}}());const l=yield r.peerConnection.createOffer(),d=r.logSDPExchange(l.sdp||"","offer","local","unmuteLocal");yield r.peerConnection.setLocalDescription(l),r.remoteSDP.unmuteRemote(n);const h=r.remoteSDP.toString();d?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(n){var r=this;return cs(function*(){const a=yield ht(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if($e().supportPCSetConfiguration){const _=r.peerConnection.getConfiguration(),E=n===wi.RELAY?"relay":"all";_.iceTransportPolicy!==E&&(w.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(E,"]")),_.iceTransportPolicy=E,r.peerConnection.setConfiguration(_))}else if(n===wi.RELAY)return;r.remoteSDP.updateCandidates(n);const l=yield ht(r.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Wd(l.sdp),{remoteIceParameters:h}=yield d.iceParameters;r.remoteSDP.restartICE(h);const p=r.remoteSDP.toString(),m=r.logSDPExchange(l.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield ht(r.peerConnection.setLocalDescription(l)),m?.(p),yield ht(r.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(l){w.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),l)}finally{a()}})()}close(){var n;this.peerConnection.close(),null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}updateEncoderConfig(n,r){var a=this;return x(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const l=yield a.peerConnection.createOffer(),d=a.mungSendOfferSDP(l.sdp,[r],[n]);a.remoteSDP.updateRecvMedia(n,r);const h=a.remoteSDP.toString(),p=a.logSDPExchange(d,"offer","local","updateEncoderConfig");yield a.peerConnection.setLocalDescription({type:"offer",sdp:d}),p?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(l){throw new X(M.EXCHANGE_SDP_FAILED,l.toString())}})()}updateSendParameters(n,r){var a=this;return x(function*(){const l=a.peerConnection.getTransceivers().filter(d=>d.mid===n);1===l.length&&(a.isVP8Simulcast(r)?zt()||(yield a.applySimulcastEncodings(l,[r])):yield a.applySendEncodings(l,[r]))})()}setStatsRemoteVideoIsReady(n,r){this.statsFilter.setVideoIsReady2(n,r)}replaceTrack(n,r){var a=this;return x(function*(){const l=a.peerConnection.getTransceivers().find(d=>d.mid===r);l&&(yield l.sender.replaceTrack(n._mediaStreamTrack))})()}getSelectedCandidatePair(){var n=this;return x(function*(){const r=n.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const a=r[0].transport.iceTransport,{local:l,remote:d}=a.getSelectedCandidatePair();return{local:jh(jh({},Ds),{},{candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port}),remote:jh(jh({},Ds),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return n.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;null===(n=this.onICEConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const r={iceServers:[]};return n.iceServers?r.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(Aa(n.turnServer.servers)?r.iceServers=n.turnServer.servers:(r.iceServers&&r.iceServers.push(...N0.turnServerConfigToIceServers(n.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&n.turnServer.serversFromGateway&&r.iceServers.push(...N0.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),j("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),j("ENABLE_ENCODED_TRANSFORM")&&$e().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(n){const r=[];return n.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat($E(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!j("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}tryBindTransportEvents(n){const r=n.transport;if(r){this.transportEventReceiver=n,r.onstatechange=()=>{var l;null!=r&&r.state&&(null===(l=this.onDTLSTransportStateChange)||void 0===l||l.call(this,r.state))},r.onerror=l=>{var d;null===(d=this.onDTLSTransportError)||void 0===d||d.call(this,"error"in l?l.error:l)};const a=r.iceTransport;a&&(a.onstatechange=()=>{const l=r?.iceTransport.state;var d;l&&(null===(d=this.onICETransportStateChange)||void 0===d||d.call(this,l))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:l,remote:d}=a.getSelectedCandidatePair();w.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(n,r){var a=this;return x(function*(){var l;if(r||(r=a.peerConnection.getSenders().find(v=>v.track===n._mediaStreamTrack)),!r)return w.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(a.isVP8Simulcast(n))return w.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!$e().supportSetRtpSenderParameters)return w.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(n._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(n._encoderConfig){var p;const{bitrateMax:v,frameRate:b,scaleResolutionDownBy:T}=n._encoderConfig;v&&(h.maxBitrate=1e3*v),(ye(p=n._hints).call(p,Ot.LOW_STREAM)||n.isUseScaleResolutionDownBy)&&(b&&(h.maxFramerate=Sr(b)),T&&T>=1&&(h.scaleResolutionDownBy=T))}if(j("DSCP_TYPE")&&zs()){var m;const v=j("DSCP_TYPE");ye(m=["very-low","low","medium","high"]).call(m,v)&&(h.networkPriority=v)}const _=r.getParameters(),E=null===(l=_.encodings)||void 0===l?void 0:l[0];zt()&&!E&&(d.encodings=[h]),E&&Object.assign(E,h),Object.assign(_,d),w.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),yield r.setParameters(_)})()}applySendEncodings(n,r){var a=this;return x(function*(){try{if(!$e().supportSetRtpSenderParameters||n.length!==r.length)return;for(let l=0;l<n.length;l++){const d=n[l],h=r[l];h instanceof ze&&!a.isVP8Simulcast(h)&&(yield a.updateRtpSenderEncodings(h,d.sender))}}catch{w.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(n,r,a){const l=cn.parse(n);return r.forEach((d,h)=>{const p=a[h],m=l.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(zd(m,d),yT(m,d,this.store.codec))}),cn.print(l)}mungReceiveAnswerSDP(n,r,a){const l=cn.parse(n),d=l.mediaDescriptions.find(h=>h.attributes.mid===r);return d&&(a===ge.AUDIO&&"audio"===d.media.mediaType&&Dl(d),this.useXR&&lv(l)),cn.print(l)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,r,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,n,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(n,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,n,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,n,r)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(n,r){var a=this;return x(function*(){if(n.length===r.length)for(let _=0;_<n.length;_++){var l,d,h,p,m;const E=n[_],v=r[_];if(v instanceof ze&&!ye(l=v._hints).call(l,Ot.LOW_STREAM)&&null!==(d=v._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=v._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=v._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=v._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===a.store.codec){const b={},T={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const O=E.sender.getParameters();yield E.sender.setParameters(Object.assign(O,b))}}})()}applySimulcastEncodings(n,r){var a=this;return x(function*(){if(!zt()&&n.length===r.length)for(let l=0;l<n.length;l++){const d=r[l];if(d instanceof ze&&a.isVP8Simulcast(d)){const h=n[l],p={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=h.sender.getParameters();yield h.sender.setParameters(Object.assign(_,p))}}})()}isVP8Simulcast(n){var r,a,l,d,h;return!!(n instanceof ze&&j("SIMULCAST")&&"vp8"===this.store.codec&&!ye(r=n._hints).call(r,Ot.LOW_STREAM)&&null!==(a=n._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(l=n._encoderConfig)||void 0===l?void 0:l.bitrateMax)>200&&null!==(d=n._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=n._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,r,a,l){if(j("SDP_LOGGING"))return w.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(r," SDP during P2PConnection.").concat(l,"\n"),n),"offer"===r?d=>{this.logSDPExchange(d,"answer","local"===a?"remote":"local",l)}:void 0}getRemoteSSRC(n){var r=this;return x(function*(){if(!r.remoteSDP)return;const a=r.remoteSDP.getSSRC(n);return a?.[0].ssrcId})()}setConfiguration(n){if($e().supportPCSetConfiguration){const r=N0.resolvePCConfiguration(n);this.peerConnection.setConfiguration(r)}}};function to(s,n,r){const a=s[n];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const l=this.mutex,d=yield l.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{d()}}),r}function IT(s,n){let r=document.createElement("video"),a=document.createElement("canvas");r.setAttribute("style","display:none"),a.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),a.width=Sr(n.width),a.height=Sr(n.height);const l=Sr(n.framerate||15);document.body.append(r),document.body.append(a);let d=s._mediaStreamTrack;r.srcObject=new MediaStream([d]),r.play();const h=a.getContext("2d");if(!h)throw new W(M.UNEXPECTED_ERROR,"can not get canvas context");const p=$e(),m=a.captureStream(p.supportRequestFrame?0:l).getVideoTracks()[0];m.canvas||(m.canvas=a),a.startCapture=()=>{if(!r)return a.stopCapture&&a.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){const b=a.width*(r.videoHeight/r.videoWidth);Math.abs(b-a.height)>=2&&(w.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(b)),a.height=b)}h.drawImage(r,0,0,a.width,a.height),m.requestFrame&&m.requestFrame(),d!==s._mediaStreamTrack&&(d=s._mediaStreamTrack,r.srcObject=new MediaStream([d]))},a.stopCapture=vE(()=>a.startCapture&&a.startCapture(),l);const _=m.stop;return m.stop=()=>{_.call(m),r&&(r.remove(),r.srcObject=null,r=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),w.debug("clean low stream renderer")},m}function h2(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function p2(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?h2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):h2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}te([to,N("design:type",Function),N("design:paramtypes",[Array,Array]),N("design:returntype",z)],Jn.prototype,"updateRemoteRTPCapabilities",null),te([to,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",z)],Jn.prototype,"connect",null),te([to,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",z)],Jn.prototype,"createDataChannels",null),te([to,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",z)],Jn.prototype,"receive",null),te([to,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Jn.prototype,"batchReceive",null),te([to,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Jn.prototype,"stopReceiving",null),te([to,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Jn.prototype,"muteRemote",null),te([to,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Jn.prototype,"unmuteRemote",null),te([to,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Jn.prototype,"muteLocal",null),te([to,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Jn.prototype,"unmuteLocal",null),te([to,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Jn.prototype,"close",null),te([to,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",z)],Jn.prototype,"updateEncoderConfig",null),te([to,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",z)],Jn.prototype,"updateSendParameters",null),te([to,N("design:type",Function),N("design:paramtypes",[Ri,String]),N("design:returntype",z)],Jn.prototype,"replaceTrack",null),te([to,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Jn.prototype,"getRemoteSSRC",null);const CN="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\na=ice-lite\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 127.0.0.1\na=mid:0\n";class $V{get localCapabilities(){return hn(this._localCapabilities)}get rtpCapabilities(){return hn(this._rtpCapabilities)}get candidates(){return hn(this._candidates)}get iceParameters(){return hn(this._iceParameters)}get dtlsParameters(){return hn(this._dtlsParameters)}constructor(n){C(this,"sessionDesc",void 0),C(this,"_localCapabilities",void 0),C(this,"_rtpCapabilities",void 0),C(this,"_candidates",void 0),C(this,"_iceParameters",void 0),C(this,"_dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),C(this,"firefoxSsrcMidMap",new Map),n=hn(n);const{remoteIceParameters:r,remoteDtlsParameters:a,candidates:l,remoteRTPCapabilities:d,remoteSetup:h,localCapabilities:p,cname:m}=n,_=cn.parse(CN);this._rtpCapabilities=d,this._candidates=l,this._iceParameters=r,this._dtlsParameters=a,this._localCapabilities=p,this.setup=h,this.cname=m;const E=this.rtpCapabilities.send;for(const v of _.mediaDescriptions){if(v.attributes.iceUfrag=r.iceUfrag,v.attributes.icePwd=r.icePwd,v.attributes.fingerprints=a.fingerprints,v.attributes.candidates=l,v.attributes.setup=h,"application"===v.media.mediaType&&(v.attributes.sctpPort="5000"),"video"===v.media.mediaType&&(v.media.fmts=E.videoCodecs.map(b=>b.payloadType.toString(10)),v.attributes.payloads=E.videoCodecs,v.attributes.extmaps=E.videoExtensions,j("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:b,ssrcGroups:T}=Zr([{ssrcId:4e4,rtx:j("USE_SUB_RTX")?40001:void 0}],this.cname);v.attributes.ssrcs=b,v.attributes.ssrcGroups=T}if("audio"===v.media.mediaType&&(v.media.fmts=E.audioCodecs.map(b=>b.payloadType.toString(10)),v.attributes.payloads=E.audioCodecs,v.attributes.extmaps=E.audioExtensions,Dl(v),j("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:b,ssrcGroups:T}=Zr([{ssrcId:2e4}],this.cname);v.attributes.ssrcs=b,v.attributes.ssrcGroups=T}}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}updateRemoteRTPCapabilities(n){const r=cn.parse(CN);this._rtpCapabilities=n;const a=this.rtpCapabilities.send;for(const l of r.mediaDescriptions){if(l.attributes.iceUfrag=this._iceParameters.iceUfrag,l.attributes.icePwd=this._iceParameters.icePwd,l.attributes.fingerprints=this._dtlsParameters.fingerprints,l.attributes.candidates=this._candidates,l.attributes.setup=this.setup,"application"===l.media.mediaType&&(l.attributes.sctpPort="5000"),"video"===l.media.mediaType&&(l.media.fmts=a.videoCodecs.map(d=>d.payloadType.toString(10)),l.attributes.payloads=a.videoCodecs,l.attributes.extmaps=a.videoExtensions,j("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=Zr([{ssrcId:4e4,rtx:j("USE_SUB_RTX")?40001:void 0}],this.cname);l.attributes.ssrcs=d,l.attributes.ssrcGroups=h}if("audio"===l.media.mediaType&&(l.media.fmts=a.audioCodecs.map(d=>d.payloadType.toString(10)),l.attributes.payloads=a.audioCodecs,l.attributes.extmaps=a.audioExtensions,j("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=Zr([{ssrcId:2e4}],this.cname);l.attributes.ssrcs=d,l.attributes.ssrcGroups=h}}this.sessionDesc=r,this.currentMidIndex=r.mediaDescriptions.length-1}preloadRemoteMedia(n){const r=this.candidates,a=this.dtlsParameters,l=this.iceParameters,d=this.rtpCapabilities.send;for(let h=1;h<n;h++){const p=2*h+2e4,m=2*h+4e4,{ssrcs:_,ssrcGroups:E}=Zr([{ssrcId:p}],this.cname),{ssrcs:v,ssrcGroups:b}=Zr([{ssrcId:m,rtx:j("USE_SUB_RTX")?m+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.videoCodecs.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:l.iceUfrag,icePwd:l.icePwd,unrecognized:[],candidates:r,extmaps:d.videoExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:v,ssrcGroups:b,rtcpFeedbackWildcards:[],payloads:d.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.audioCodecs.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:l.iceUfrag,icePwd:l.icePwd,unrecognized:[],candidates:r,extmaps:d.audioExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:d.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return cn.print(this.sessionDesc)}send(n,r,a,l){const{ssrcs:d,ssrcGroups:h}=Zr(r,this.cname,j("SYNC_GROUP")?a:void 0),p=this.findPreloadMediaDesc(d);if(p){if(zt()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,p.attributes.mid),l&&(l.twcc||l.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(p,l),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(n,d);let _;return-1===m||Ki()||Fi()||SA()||0===m&&j("USE_SUB_RTX")?(_=this.createOrRecycleSendMedia(n,d,h,"sendonly",l),this.updateBundleMids()):(_=hn(this.sessionDesc.mediaDescriptions[m]),_.attributes.direction="sendonly",_.attributes.ssrcs=d,_.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(_,l)),zt()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,_.attributes.mid),{mid:_.attributes.mid,needExchangeSDP:!0}}}batchSend(n){const r=n.map(d=>{let{kind:h,ssrcMsg:p,mslabel:m}=d;return this.send(h,p,m)}),a=[];let l=!1;return r.forEach(d=>{let{mid:h,needExchangeSDP:p}=d;p&&(l=!0),a.push(h)}),{mids:a,needExchangeSDP:l}}stopSending(n){const r=this.sessionDesc.mediaDescriptions.filter(a=>a.attributes.mid&&-1!==n.indexOf(a.attributes.mid));if(r.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(a=>{"0"===a.attributes.mid||zt()||Ki()||Fi()?a.attributes.ssrcs=[]:(a.attributes.ssrcs=[],a.attributes.direction="inactive",a.media.port="0")}),this.updateBundleMids()}mute(n){const r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===n);if(!r)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(n){const r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===n);if(!r)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}muteRemote(n){const r=this.sessionDesc.mediaDescriptions.filter(a=>ye(n).call(n,a.attributes.mid||""));if(r.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(a=>{a.attributes.direction="inactive"})}unmuteRemote(n){const r=this.sessionDesc.mediaDescriptions.filter(a=>ye(n).call(n,a.attributes.mid||""));if(r.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(a=>{a.attributes.direction="recvonly"})}receive(n,r,a,l){n.forEach((d,h)=>{this.createOrRecycleRecvMedia(d,[],"recvonly",r,a,l[h])}),this.updateBundleMids()}stopReceiving(n){const r=this.sessionDesc.mediaDescriptions.filter(a=>-1!==n.indexOf(a.attributes.mid));if(r.length!==n.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(a=>{a.media.port="0",a.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(n){n===wi.TCP?this._candidates.forEach(r=>{-1===this._candidates.findIndex(a=>"tcp"===a.transport&&a.connectionAddress===r.connectionAddress&&a.port===r.port)&&this._candidates.push(p2(p2({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}):this._candidates=this._candidates.filter(r=>"tcp"!==r.transport);for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}restartICE(n){n=hn(n),this._iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=n.iceUfrag,r.attributes.icePwd=n.icePwd})}predictReceivingMids(n){const r=[];for(let a=0;a<n;a++)r.push((this.currentMidIndex+a+1).toString(10));return r}findAvailableMediaIndex(n,r){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const l=a.media.mediaType===n&&"0"!==a.media.port&&("sendonly"===a.attributes.direction||"sendrecv"===a.attributes.direction)&&0===a.attributes.ssrcs.length;if(zt()){if(l){const d=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(d||"0"!==a.attributes.mid&&"1"!==a.attributes.mid)||!(!d||d!==a.attributes.mid)}return!1}return l})}createOrRecycleRecvMedia(n,r,a,l,d,h){const p=n._mediaStreamTrack.kind,m=this.rtpCapabilities.recv,_=dv(p,m,this.localCapabilities.send,p===ge.VIDEO?l:d),E=p===ge.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;const v="".concat(this.currentMidIndex);let b={media:{mediaType:p,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:_.map(O=>O.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:E,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:_,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};b=this.mungRecvMediaDsec(b,n,h);const T=this.findFirstClosedMedia(p);if(T){const O=this.sessionDesc.mediaDescriptions.indexOf(T);this.sessionDesc.mediaDescriptions[O]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}updateRemoteCodec(n,r,a){const l=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(b=>b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").filter(b=>{var T;return ye(T=Object.keys(Vi)).call(T,b)}))],d=new Set(r);if(l.every(b=>d.has(b)))return w.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(r)),!1;const h=this._rtpCapabilities.recv.videoCodecs.filter(b=>r.some(T=>{var O;return ye(O=b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").call(O,T)}));if(0===h.length)return w.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(l," codecs: ").concat(r)),!1;const p=[...new Set(h.map(b=>b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||""))];let m;if(w.debug("updateRemoteCodec, from ".concat(l," to ").concat(p)),0===n.length)m=this.sessionDesc.mediaDescriptions.filter(b=>"video"===b.media.mediaType&&"recvonly"===b.attributes.direction);else if(m=this.sessionDesc.mediaDescriptions.filter(b=>b.attributes.mid&&ye(n).call(n,b.attributes.mid)&&"recvonly"===b.attributes.direction),m.length!==n.length)return w.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(n,", codecs: ").concat(r)),!1;this._rtpCapabilities.recv.videoCodecs=h;const v=dv(ge.VIDEO,this.rtpCapabilities.recv,this.localCapabilities.send,a);return m.forEach(b=>{const T=v.map(O=>O.payloadType.toString(10));w.debug("updateRemoteCodec mid: ".concat(b.attributes.mid,", from ").concat(b.attributes.payloads," to ").concat(v)),b.attributes.payloads=v,b.media.fmts=T}),!0}createOrRecycleSendMedia(n,r,a,l,d){const h=this.rtpCapabilities.send,p=n===ge.VIDEO?h.videoCodecs:h.audioCodecs,m=n===ge.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const _="".concat(this.currentMidIndex);let E={media:{mediaType:n,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:a,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:l,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};E=this.mungSendMediaDesc(E,d);const v=this.findFirstClosedMedia(n);if(v){const b=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[b]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(n=>"0"!==n.media.port).map(n=>n.attributes.mid)}mungRecvMediaDsec(n,r,a){const l=hn(n);return ET(l),zd(l,r),vT(l,r),hN(l),sv(l,a,this.localCapabilities.send),l}mungSendMediaDesc(n,r){const a=hn(n);return sv(a,r,this.localCapabilities.recv),Dl(a),a}updateRecvMedia(n,r){const a=this.sessionDesc.mediaDescriptions.findIndex(l=>l.attributes.mid===n);if(-1!==a){const l=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],r);this.sessionDesc.mediaDescriptions[a]=l}}bumpMid(n){this.currentMidIndex+=n}findFirstClosedMedia(n){return this.sessionDesc.mediaDescriptions.find(r=>zt()?"0"===r.media.port&&r.media.mediaType===n:"0"===r.media.port)}findPreloadMediaDesc(n){return this.sessionDesc.mediaDescriptions.find(r=>{var a;return(null===(a=r.attributes)||void 0===a||null===(a=a.ssrcs[0])||void 0===a?void 0:a.ssrcId)===n[0].ssrcId})}getSSRC(n){var r;return null===(r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===n))||void 0===r?void 0:r.attributes.ssrcs}}function wN(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function pv(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?wN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):wN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class Ni extends _h{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(n,r,a){super(n,r),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"transportEventReceiver",void 0),C(this,"statsFilter",void 0),C(this,"useXR",j("USE_XR")),C(this,"localCapabilities",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"remoteCodecs",void 0),C(this,"dataStreamChannelMap",new Map),C(this,"establishPromise",void 0),C(this,"mutex",new Zn("NVExtentionsConnection-mutex")),C(this,"rtcMedia",void 0),this.store=r,this.peerConnection=a,this.statsFilter=uv(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,zt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(n){var r=this;return x(function*(){try{const a=yield r.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const l=Wd(a.sdp),d=yield pN({filterRTX:!j("USE_PUB_RTX")&&!j("USE_SUB_RTX"),filterVideoFec:j("FILTER_VIDEO_FEC"),filterAudioFec:j("FILTER_AUDIO_FEC"),filterVideoCodec:j("FILTER_VIDEO_CODEC")},{useXR:r.useXR});return r.localCapabilities=d,r.initialOffer=a,pv(pv({},l),{},{rtpCapabilities:d,offerSDP:a.sdp})}catch(a){throw new W(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}})()}connect(n,r,a,l,d,h){var p=this;return x(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");p.remoteSDP=new $V({remoteIceParameters:n,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:l,remoteSetup:d,localCapabilities:cv(p.localCapabilities),cname:h});const m=p.remoteSDP.toString(),_=cn.parse(p.initialOffer.sdp),E=_.mediaDescriptions.find(T=>"audio"===T.media.mediaType);E&&Dl(E),p.useXR&&lv(_);const v=cn.print(_),b=p.logSDPExchange(v||"","offer","local","connect");yield p.peerConnection.setLocalDescription({type:"offer",sdp:v}),b?.(m),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new W(M.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(m.toString()))}})()}updateRemoteRTPCapabilities(n,r){var a=this;return x(function*(){let l;a.remoteCodecs=r,a.localCapabilities&&(l=cv(a.localCapabilities));const d=[...new Set(l&&l.send.videoCodecs.map(h=>h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").filter(h=>{var p;return ye(p=Object.keys(Vi)).call(p,h)}))];if(Se.updateRemoteRTPCapabilities(a.store.sessionId,{mids:n,localCodecs:d,remoteCodecs:a.remoteCodecs}),a.remoteSDP)if(a.remoteSDP.updateRemoteCodec(n,r,a.store.codec)){const h=yield a.peerConnection.createOffer(),p=a.logSDPExchange(h.sdp||"","offer","local","muteLocal");yield a.peerConnection.setLocalDescription(h);const m=a.remoteSDP.toString();p?.(m),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:m})}else w.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else w.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(d,", codecs: ").concat(r))})()}updateRemoteConnect(n){var r=this;return x(function*(){var a,l,d,h;null===(a=r.remoteSDP)||void 0===a||a.updateRemoteRTPCapabilities(n),Array.isArray(r.remoteCodecs)&&r.remoteCodecs.length>0&&(null===(h=r.remoteSDP)||void 0===h||h.updateRemoteCodec([],r.remoteCodecs,r.store.codec)),null===(l=r.remoteSDP)||void 0===l||l.preloadRemoteMedia(2);const p=null===(d=r.remoteSDP)||void 0===d?void 0:d.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:p});const m=yield r.peerConnection.createAnswer();yield r.peerConnection.setLocalDescription(m),w.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")})()}send(n,r,a){var l=this;return cs(function*(){const d=yield ht(l.mutex.lock("From NVExtentionsConnection.send"));try{if(!l.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const h=[];n.forEach(P=>{const D=l.peerConnection.addTransceiver(P._mediaStreamTrack,{direction:"sendonly"});h.push(D)}),zt()&&!0===j("SIMULCAST")&&(yield ht(l.applySimulcastForFirefox(h,n)));const p=yield ht(l.peerConnection.createOffer()),m=l.remoteSDP.predictReceivingMids(n.length),_=l.mungSendOfferSDP(p.sdp,n,m),E=cn.parse(_),v=m.map(P=>{const D=E.mediaDescriptions.find(L=>L.attributes.mid===P);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return dN(D,j("USE_PUB_RTX"))});let b;try{b=yield v}catch(P){b=[],l.remoteSDP.receive(n,r,a,b);const D=l.remoteSDP.toString();throw yield ht(l.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield ht(l.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield ht(l.stopSending(m,!0)),P}l.remoteSDP.receive(n,r,a,b);const T=l.remoteSDP.toString(),O=l.logSDPExchange(_,"offer","local","send");return yield ht(l.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield ht(l.applySimulcastEncodings(h,n)),yield ht(l.applySendEncodings(h,n)),O?.(T),yield ht(l.peerConnection.setRemoteDescription({type:"answer",sdp:T})),h.map((P,D)=>({localSSRC:v[D],id:m[D],transceiver:P}))}catch(h){throw h instanceof W?h:new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(h.toString()))}finally{d()}})()}stopSending(n,r){var a=this;return x(function*(){const l=r?void 0:yield a.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const d=a.peerConnection.getTransceivers().filter(_=>-1!==n.indexOf(_.mid));if(d.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");d.map(_=>{var E;_.direction="inactive",null===(E=_.stop)||void 0===E||E.call(_)});const h=yield a.peerConnection.createOffer(),p=a.logSDPExchange(h.sdp||"","offer","local","stopSending");yield a.peerConnection.setLocalDescription(h),a.remoteSDP.stopReceiving(n);const m=a.remoteSDP.toString();p?.(m),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(d.toString()))}finally{l&&l()}})()}createDataChannels(n,r){var a=this;return x(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let l=a.dataStreamChannelMap.get(n);return l&&"open"===l.readyState?w.debug("[P2PConnection] Channels are already available and can be reused directly."):(l=a.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:j("DATASTREAM_MAX_RETRANSMITS")}),l.binaryType="arraybuffer",a.dataStreamChannelMap.set(n,l)),void r.forEach(d=>{d._updateOriginDataChannel(l)})}catch(l){throw l instanceof W?l:new W(M.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(l.toString()))}})()}stopDataChannels(n){var r=this;return x(function*(){try{const a=r.dataStreamChannelMap.get(n);return a?.close(),void r.dataStreamChannelMap.delete(n)}catch(a){throw a instanceof W?a:new W(M.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(a.toString()))}})()}receive(n,r,a,l){var d=this;return x(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(n," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=d.remoteSDP.send(n,r,a,l);if(p){const _=d.remoteSDP.toString(),E=d.logSDPExchange(_,"offer","remote","receive");yield d.peerConnection.setRemoteDescription({type:"offer",sdp:_});const v=yield d.peerConnection.createAnswer(),b=d.mungReceiveAnswerSDP(v.sdp,h,n);E?.(b||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:b}),w.debug("[NVExtentionsConnection] receive ".concat(n," by exchanging SDP."))}else w.debug("[NVExtentionsConnection] receive ".concat(n," no need to exchange SDP."));const m=d.peerConnection.getTransceivers().find(_=>_.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h}}catch(h){throw new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:a,needExchangeSDP:l}=r.remoteSDP.batchSend(n);if(l){const d=r.remoteSDP.toString(),h=r.logSDPExchange(d,"offer","remote","receive");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:d});const p=yield r.peerConnection.createAnswer();h?.(p.sdp||""),yield r.peerConnection.setLocalDescription(p),w.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else w.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return a.map(d=>{const h=r.peerConnection.getTransceivers().find(p=>p.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d}})}catch(a){throw new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(a.toString()))}})()}stopReceiving(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(n);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","stopReceiving");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();l?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(n," before remote SDP created."));r.remoteSDP.mute(n);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","muteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();l?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(a.toString()))}})()}unmuteRemote(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(n," before remote SDP created."));r.remoteSDP.unmute(n);const a=r.remoteSDP.toString(),l=r.logSDPExchange(a,"offer","remote","unmuteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();l?.(d.sdp||""),yield r.peerConnection.setLocalDescription(d)}catch(a){throw new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(a.toString()))}})()}muteLocal(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==n.indexOf(p.mid));if(a.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(p=>{p.direction="inactive"});const l=yield r.peerConnection.createOffer(),d=r.logSDPExchange(l.sdp||"","offer","local","muteLocal");yield r.peerConnection.setLocalDescription(l),r.remoteSDP.muteRemote(n);const h=r.remoteSDP.toString();d?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(n){var r=this;return x(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==n.indexOf(p.mid));if(a.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(function(){var p=x(function*(m,_){m.direction="sendonly"});return function(m,_){return p.apply(this,arguments)}}());const l=yield r.peerConnection.createOffer(),d=r.logSDPExchange(l.sdp||"","offer","local","unmuteLocal");yield r.peerConnection.setLocalDescription(l),r.remoteSDP.unmuteRemote(n);const h=r.remoteSDP.toString();d?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(n){var r=this;return cs(function*(){const a=yield ht(r.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if($e().supportPCSetConfiguration){const _=r.peerConnection.getConfiguration(),E=n===wi.RELAY?"relay":"all";_.iceTransportPolicy!==E&&(w.debug("restartICE change iceTransportPolicy from [".concat(_.iceTransportPolicy,"] to [").concat(E,"]")),_.iceTransportPolicy=E,r.peerConnection.setConfiguration(_))}else if(n===wi.RELAY)return;n!==wi.RELAY&&r.remoteSDP.updateCandidates(n);const l=yield ht(r.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Wd(l.sdp),{remoteIceParameters:h}=yield d.iceParameters;r.remoteSDP.restartICE(h);const p=r.remoteSDP.toString(),m=r.logSDPExchange(l.sdp||"","offer","local","restartICE");yield ht(r.peerConnection.setLocalDescription(l)),m?.(p),yield ht(r.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(l){w.warning("restart ICE failed, abort operation",l)}finally{a()}})()}close(){var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}updateEncoderConfig(n,r){var a=this;return x(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const l=yield a.peerConnection.createOffer(),d=a.mungSendOfferSDP(l.sdp,[r],[n]);a.remoteSDP.updateRecvMedia(n,r);const h=a.remoteSDP.toString(),p=a.logSDPExchange(d,"offer","local","updateEncoderConfig");yield a.peerConnection.setLocalDescription({type:"offer",sdp:d}),p?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(l){throw new W(M.EXCHANGE_SDP_FAILED,l.toString())}})()}updateSendParameters(n,r){var a=this;return x(function*(){const l=a.peerConnection.getTransceivers().filter(d=>d.mid===n);1===l.length&&(a.isVP8Simulcast(r)?zt()||(yield a.applySimulcastEncodings(l,[r])):yield a.applySendEncodings(l,[r]))})()}setStatsRemoteVideoIsReady(n,r){this.statsFilter.setVideoIsReady2(n,r)}replaceTrack(n,r){var a=this;return x(function*(){const l=a.peerConnection.getTransceivers().find(d=>d.mid===r);l&&(yield l.sender.replaceTrack(n._mediaStreamTrack))})()}getP2PConnectionParams(){var n;if(null===(n=this.peerConnection.currentLocalDescription)||void 0===n||!n.sdp||!this.localCapabilities)throw new Error;return pv(pv({},Wd(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;null===(n=this.onICEConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const r={iceServers:[]};return n.iceServers?r.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(Aa(n.turnServer.servers)?r.iceServers=n.turnServer.servers:(r.iceServers&&r.iceServers.push(...Ni.turnServerConfigToIceServers(n.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&n.turnServer.serversFromGateway&&r.iceServers.push(...Ni.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),j("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(n){const r=[];return n.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat($E(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!j("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}applySendEncodings(n,r){var a=this;return x(function*(){try{if(!$e().supportSetRtpSenderParameters||n.length!==r.length)return;for(let b=0;b<n.length;b++){const T=n[b],O=r[b];if(O&&O instanceof ze){var l,d,h;if(a.isVP8Simulcast(O))continue;const P={},D={};switch(O._optimizationMode){case"motion":P.degradationPreference="maintain-framerate";break;case"detail":P.degradationPreference="maintain-resolution";break;default:P.degradationPreference="balanced"}var p,m,_,E;if(null!==(l=O._encoderConfig)&&void 0!==l&&l.bitrateMax&&(D.maxBitrate=1e3*(null===(p=O._encoderConfig)||void 0===p?void 0:p.bitrateMax)),ye(d=O._hints).call(d,Ot.LOW_STREAM)&&(null!==(m=O._encoderConfig)&&void 0!==m&&m.frameRate&&(D.maxFramerate=Sr(O._encoderConfig.frameRate)),null!==(_=O._encoderConfig)&&void 0!==_&&_.scaleResolutionDownBy&&(null===(E=O._encoderConfig)||void 0===E?void 0:E.scaleResolutionDownBy)>1&&(D.scaleResolutionDownBy=O._encoderConfig.scaleResolutionDownBy)),j("DSCP_TYPE")&&zs()){var v;const U=j("DSCP_TYPE");ye(v=["very-low","low","medium","high"]).call(v,U)&&(D.networkPriority=U)}const L=T.sender.getParameters(),V=null===(h=L.encodings)||void 0===h?void 0:h[0];zt()&&!V&&(P.encodings=[D]),V&&Object.assign(V,D),Object.assign(L,P),yield T.sender.setParameters(L)}}}catch{w.debug("Apply RTPSendEncodings failed.")}})()}mungSendOfferSDP(n,r,a){const l=cn.parse(n);return r.forEach((d,h)=>{const p=a[h],m=l.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(zd(m,d),yT(m,d,this.store.codec))}),cn.print(l)}mungReceiveAnswerSDP(n,r,a){const l=cn.parse(n),d=l.mediaDescriptions.find(h=>h.attributes.mid===r);return d&&a===ge.AUDIO&&"audio"===d.media.mediaType&&Dl(d),this.useXR&&lv(l),cn.print(l)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,r,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,n,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(n,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,n,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,n,r)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(n,r){var a=this;return x(function*(){if(n.length===r.length)for(let _=0;_<n.length;_++){var l,d,h,p,m;const E=n[_],v=r[_];if(v instanceof ze&&!ye(l=v._hints).call(l,Ot.LOW_STREAM)&&null!==(d=v._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=v._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=v._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=v._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===a.store.codec){const b={},T={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const O=E.sender.getParameters();yield E.sender.setParameters(Object.assign(O,b))}}})()}applySimulcastEncodings(n,r){var a=this;return x(function*(){if(!zt()&&n.length===r.length)for(let l=0;l<n.length;l++){const d=r[l];if(d instanceof ze&&a.isVP8Simulcast(d)){const h=n[l],p={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=h.sender.getParameters();yield h.sender.setParameters(Object.assign(_,p))}}})()}isVP8Simulcast(n){var r,a,l,d,h;return!!(n instanceof ze&&j("SIMULCAST")&&"vp8"===this.store.codec&&!ye(r=n._hints).call(r,Ot.LOW_STREAM)&&null!==(a=n._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(l=n._encoderConfig)||void 0===l?void 0:l.bitrateMax)>200&&null!==(d=n._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=n._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,r,a,l){if(j("SDP_LOGGING"))return w.upload("exchanging ".concat(a," ").concat(r," SDP during NVExtentionsConnection.").concat(l,"\n"),n),"offer"===r?d=>{this.logSDPExchange(d,"answer","local"===a?"remote":"local",l)}:void 0}getRemoteSSRC(n){var r=this;return x(function*(){if(!r.remoteSDP)return;const a=r.remoteSDP.getSSRC(n);return a?.[0].ssrcId})()}setConfiguration(n){if($e().supportPCSetConfiguration){const r=Ni.resolvePCConfiguration(n);this.peerConnection.setConfiguration(r)}}}function no(s,n,r){const a=s[n];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const l=this.mutex,d=yield l.lock("From NVExtentionsConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{d()}}),r}function f2(s){var n,r,a,l=2;for(typeof Symbol<"u"&&(r=cN,a=Symbol.iterator);l--;){if(r&&null!=(n=s[r]))return n.call(s);if(a&&null!=(n=s[a]))return new fv(n.call(s));r="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function fv(s){function n(r){if(Object(r)!==r)return z.reject(new TypeError(r+" is not an object."));var a=r.done;return z.resolve(r.value).then(function(l){return{value:l,done:a}})}return(fv=function(r){this.s=r,this.n=r.next}).prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(r){var a=this.s.return;return void 0===a?z.resolve({value:r,done:!0}):n(a.apply(this.s,arguments))},throw:function(r){var a=this.s.return;return void 0===a?z.reject(r):n(a.apply(this.s,arguments))}},new fv(s)}te([no,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",z)],Ni.prototype,"connect",null),te([no,N("design:type",Function),N("design:paramtypes",[Array,Array]),N("design:returntype",z)],Ni.prototype,"updateRemoteRTPCapabilities",null),te([no,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],Ni.prototype,"updateRemoteConnect",null),te([no,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",z)],Ni.prototype,"createDataChannels",null),te([no,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",z)],Ni.prototype,"receive",null),te([no,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Ni.prototype,"batchReceive",null),te([no,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Ni.prototype,"stopReceiving",null),te([no,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Ni.prototype,"muteRemote",null),te([no,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Ni.prototype,"unmuteRemote",null),te([no,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Ni.prototype,"muteLocal",null),te([no,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Ni.prototype,"unmuteLocal",null),te([no,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Ni.prototype,"close",null),te([no,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",z)],Ni.prototype,"updateEncoderConfig",null),te([no,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",z)],Ni.prototype,"updateSendParameters",null),te([no,N("design:type",Function),N("design:paramtypes",[Ri,String]),N("design:returntype",z)],Ni.prototype,"replaceTrack",null),te([no,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Ni.prototype,"getRemoteSSRC",null);class Hn extends _h{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(n,r){super(n,r),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"cname",void 0),C(this,"mutex",new Zn("DataChannelConnection-mutex")),C(this,"dataChannel",void 0),C(this,"_p2pConnection",void 0),C(this,"establishPromise",void 0),C(this,"_nvMedia",void 0),this.store=r,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(Hn.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new Ni(n,r,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}establish(){var n=this;return x(function*(){var r;const a=null===(r=n._nvMedia)||void 0===r?void 0:r.getLocalRtpCapabilities();return yield n._p2pConnection.establish(a)})()}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}connect(n,r,a,l,d,h){var p=this;return x(function*(){return p.cname=h,yield p._p2pConnection.connect(n,r,a,l,d,h),yield new z((m,_)=>{const E=setTimeout(()=>{p.closeSignal(),_(new W(M.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(a))))},2e3);p.dataChannel.onopen=()=>{if("open"===p.dataChannel.readyState)return clearTimeout(E),void m()},p.dataChannel.onerror=v=>{p.closeSignal(),_(v)}}),{transmitter:p.dataChannel,close:p.closeSignal.bind(p)}})()}updateRemoteRTPCapabilities(n,r){var a=this;return x(function*(){return a._p2pConnection.updateRemoteRTPCapabilities(n,r)})()}send(n,r,a){var l=this;return cs(function*(){const d=yield ht(l.mutex.lock("From DataChannelConnection.send"));try{return yield*Qf(f2(l._p2pConnection.send(n,r,a)))}finally{d()}})()}stopSending(n,r){var a=this;return x(function*(){return a._p2pConnection.stopSending(n,r)})()}createDataChannels(n,r){var a=this;return x(function*(){return a._p2pConnection.createDataChannels(n,r)})()}stopDataChannels(n){var r=this;return x(function*(){return r._p2pConnection.stopDataChannels(n)})()}receive(n,r,a,l){var d=this;return x(function*(){return d._nvMedia?(w.debug("[DataChannelConnection] receive ".concat(n," by DataChannel.")),yield d._nvMedia.reveiveByRTCMedia(n,r,d.cname)):(w.debug("[DataChannelConnection] receive ".concat(n," by WebRTC.")),yield d._p2pConnection.receive(n,r,a,l))})()}batchReceive(n){var r=this;return x(function*(){return[...yield r._p2pConnection.batchReceive(n)]})()}stopReceiving(n){var r=this;return x(function*(){return yield r._p2pConnection.stopReceiving(n)})()}muteRemote(n){var r=this;return x(function*(){return yield r._p2pConnection.muteRemote(n)})()}unmuteRemote(n){var r=this;return x(function*(){return yield r._p2pConnection.unmuteRemote(n)})()}muteLocal(n){var r=this;return x(function*(){return yield r._p2pConnection.muteLocal(n)})()}unmuteLocal(n){var r=this;return x(function*(){return yield r._p2pConnection.unmuteLocal(n)})()}restartICE(n){var r=this;return cs(function*(){return yield*Qf(f2(r._p2pConnection.restartICE(n)))})()}close(){var n;null===(n=this._nvMedia)||void 0===n||n.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(n){return this._p2pConnection.getRemoteVideoIsReady(n)}updateRemoteConnect(n){var r;null===(r=this._nvMedia)||void 0===r||r.setRemoteRtpCapabilities(n),this._p2pConnection.updateRemoteConnect(n)}updateEncoderConfig(n,r){var a=this;return x(function*(){return yield a._p2pConnection.updateEncoderConfig(n,r)})()}updateSendParameters(n,r){var a=this;return x(function*(){return yield a._p2pConnection.updateSendParameters(n,r)})()}setStatsRemoteVideoIsReady(n,r){this._p2pConnection.setStatsRemoteVideoIsReady(n,r)}replaceTrack(n,r){var a=this;return x(function*(){return yield a._p2pConnection.replaceTrack(n,r)})()}getRemoteSSRC(n){var r=this;return x(function*(){return r._p2pConnection.getRemoteSSRC(n)})()}logSDPExchange(n,r,a,l){if(j("SDP_LOGGING"))return w.upload("exchanging ".concat(a," ").concat(r," SDP during DataChannelConnection.").concat(l,"\n"),n),"offer"===r?d=>{this.logSDPExchange(d,"answer","local"===a?"remote":"local",l)}:void 0}static resolvePCConfiguration(n){const r={iceServers:[]};return n.iceServers?r.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(Aa(n.turnServer.servers)?r.iceServers=n.turnServer.servers:(r.iceServers&&r.iceServers.push(...Hn.turnServerConfigToIceServers(n.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&n.turnServer.serversFromGateway&&r.iceServers.push(...Hn.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),j("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(n){const r=[];return n.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat($E(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!j("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=n=>{var r;return null===(r=this.onICEConnectionStateChange)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onConnectionStateChange=n=>{var r;return null===(r=this.onConnectionStateChange)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onDTLSTransportStateChange=n=>{var r;return null===(r=this.onDTLSTransportStateChange)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onDTLSTransportError=n=>{var r;return null===(r=this.onDTLSTransportError)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onICETransportStateChange=n=>{var r;return null===(r=this.onICETransportStateChange)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onFirstAudioReceived=n=>{var r;return null===(r=this.onFirstAudioReceived)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onFirstVideoReceived=n=>{var r;return null===(r=this.onFirstVideoReceived)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onFirstAudioDecoded=n=>{var r;return null===(r=this.onFirstAudioDecoded)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onFirstVideoDecoded=(n,r,a)=>{var l;return null===(l=this.onFirstVideoDecoded)||void 0===l?void 0:l.call(this,n,r,a)},this._p2pConnection.onFirstVideoDecodedTimeout=n=>{var r;return null===(r=this.onFirstVideoDecodedTimeout)||void 0===r?void 0:r.call(this,n)},this._p2pConnection.onSelectedLocalCandidateChanged=(n,r)=>{var a;return null===(a=this.onSelectedLocalCandidateChanged)||void 0===a?void 0:a.call(this,n,r)},this._p2pConnection.onSelectedRemoteCandidateChanged=(n,r)=>{var a;return null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a?void 0:a.call(this,n,r)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0}setConfiguration(n){this._p2pConnection.setConfiguration(n)}}function Do(s,n,r){const a=s[n];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const l=this.mutex,d=yield l.lock("From DataChannelConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{d()}}),r}function m2(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function _2(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?m2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):m2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}te([Do,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",z)],Hn.prototype,"connect",null),te([Do,N("design:type",Function),N("design:paramtypes",[Array,Array]),N("design:returntype",z)],Hn.prototype,"updateRemoteRTPCapabilities",null),te([Do,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",z)],Hn.prototype,"createDataChannels",null),te([Do,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",z)],Hn.prototype,"receive",null),te([Do,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Hn.prototype,"stopReceiving",null),te([Do,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Hn.prototype,"muteRemote",null),te([Do,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Hn.prototype,"unmuteRemote",null),te([Do,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Hn.prototype,"muteLocal",null),te([Do,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Hn.prototype,"unmuteLocal",null),te([Do,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Hn.prototype,"close",null),te([Do,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",z)],Hn.prototype,"updateEncoderConfig",null),te([Do,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",z)],Hn.prototype,"updateSendParameters",null),te([Do,N("design:type",Function),N("design:paramtypes",[Ri,String]),N("design:returntype",z)],Hn.prototype,"replaceTrack",null),te([Do,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Hn.prototype,"getRemoteSSRC",null);class ci extends qt{constructor(){super(),C(this,"uplinkStatsUploadInterval",void 0),C(this,"uplinkRelatedStatsUploadInterval",void 0),C(this,"uplinkDenoiserStatsUploadInterval",void 0),C(this,"transportStatsUploadInterval",void 0),C(this,"uplinkExtensionStatsUploadInterval",void 0),C(this,"downlinkExtensionStatsUploadInterval",void 0),C(this,"extensionUsageStatsUploadInterval",void 0),C(this,"downlinkStatsUploadInterval",void 0),C(this,"downlinkRelatedStatsUploadInterval",void 0),C(this,"lastStats",void 0),C(this,"uploadUnplinkStarted",!1),C(this,"uploadDownlinkStarted",!1),C(this,"uploadTransportStarted",!1),C(this,"uploadExtensionUsageStarted",!1),C(this,"requestStats",void 0),C(this,"requestTransportStats",void 0),C(this,"requestLocalMedia",void 0),C(this,"requestRemoteMedia",void 0),C(this,"requestAllTracks",void 0),C(this,"requestVideoIsReady",void 0),C(this,"requestUpload",void 0)}startUploadTransportStats(n){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var r;const a=null===(r=this.requestStats)||void 0===r?void 0:r.call(this);if(a){const d=os(a);if(n){var l;const h=null===(l=this.requestStats)||void 0===l?void 0:l.call(this,!0);if(h){const p=os(h);d.connectionType+=p.connectionType<<3}d.connectionType+=110}else d.connectionType+=100;mo(()=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,Xi.TRANSPORT_STATS,d)})}},1e3))}startUploadExtensionUsageStats(){var n=this;if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const r=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(x(function*(){var a,l,d;const h=Date.now(),p={connectionInterval:j("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:h};let m=[];const _=(null===(a=n.requestAllTracks)||void 0===a?void 0:a.call(n))||[];for(const T of _)!T.muted&&T.enabled&&(m=m.concat(yield T.getProcessorUsage()));const E=(null===(l=n.requestRemoteMedia)||void 0===l?void 0:l.call(n))||[];for(const[T,O]of E)O.has(ge.VIDEO)&&T.videoTrack&&(m=m.concat(yield T.videoTrack.getProcessorUsage())),O.has(ge.AUDIO)&&T.audioTrack&&(m=m.concat(yield T.audioTrack.getProcessorUsage()));if(0===m.length)return;p.details=function(T,O){const P={};for(const{id:U,value:J,level:se,direction:q}of T){var D;const Q=null!==(D=O.get(U))&&void 0!==D?D:0,$=2===J?Q+j("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:Q;var L,V;O.set(U,$),P[U]?(2===J&&(P[U].value=J),se>P[U].level&&(P[U].level=se),"remote"===q&&(P[U].remoteUidCount+=1),P[U].totalTs=null!==(L=O.get(U))&&void 0!==L?L:0):P[U]={value:J,level:se,remoteUidCount:"local"===q?0:1,totalTs:null!==(V=O.get(U))&&void 0!==V?V:0}}return Object.keys(P).map(U=>{const{level:J,value:se,totalTs:q}=P[U];return{id:U,level:J,value:se,totalTs:q}})}(m,r);const v=Date.now();null===(d=n.requestUpload)||void 0===d||d.call(n,Xi.EXTENSION_USAGE_STATS,{usageStats:p,sendTs:v>h?v:h+1})}),j("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var n;const r=null===(n=this.requestStats)||void 0===n?void 0:n.call(this);r&&(this.uploadUplinkStats(r),this.lastStats=r)},3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var n;const r=null===(n=this.requestStats)||void 0===n?void 0:n.call(this);r&&this.uploadRelatedUplinkStats(r,this.lastStats),this.lastStats=r},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var n;const r=null===(n=this.requestAllTracks)||void 0===n?void 0:n.call(this);r&&this.uploadDenoiserStats(r)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var n;const r=null===(n=this.requestAllTracks)||void 0===n?void 0:n.call(this);r&&this.uploadExtensionStats(r)},2e3))}uploadUplinkStats(n){var r;((null===(r=this.requestLocalMedia)||void 0===r?void 0:r.call(this))||[]).forEach(a=>{let[l,{track:d,ssrcs:h}]=a;switch(l){case ne.LocalVideoLowTrack:case ne.LocalVideoTrack:{const p=function(E,v,b){var T;const O=v.videoSend.find(D=>D.ssrc===E);if(!O)return null;const P={id:Fe(10,""),timestamp:new Date(v.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:O.ssrc.toString()};switch(P.A_vstd=b._originMediaStreamTrack&&!b._originMediaStreamTrack.enabled||b._mediaStreamTrack&&!b._mediaStreamTrack.enabled?"1":"0",O.sentFrame&&(P.A_fhs=O.sentFrame.height.toString(),P.A_frs=O.sentFrame.frameRate.toString(),P.A_fws=O.sentFrame.width.toString()),O.adaptionChangeReason){case"none":P.A_ac="0";break;case"cpu":P.A_ac="1";break;case"bandwidth":P.A_ac="2";break;case"other":P.A_ac="3"}return P.A_lvps=_E[b._player?b._player.videoElementStatus:"uninit"].toString(),P.A_nr=null===(T=O.nacksCount)||void 0===T?void 0:T.toString(),O.avgEncodeMs&&(P.A_aem=O.avgEncodeMs.toFixed(0).toString()),j("P2P")&&(O.bytes&&(P.bytesSent=O.bytes.toString()),"number"==typeof O.packetsLost&&(P.packetsLost=O.packetsLost.toString()),O.packets&&(P.packetsSent=O.packets.toString())),P}(h[0].ssrcId,n,d),m=l===ne.LocalVideoTrack?function(E,v,b){var T,O,P,D,L,V,U,J;const se=v.videoSend.find(me=>me.ssrc===E);if(!se)return null;const q={id:Fe(10,""),timestamp:new Date(v.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:se.ssrc.toString()},Q=null!==(T=null!==(O=null===(P=se.inputFrame)||void 0===P?void 0:P.height)&&void 0!==O?O:b?._videoHeight)&&void 0!==T?T:0,$=null!==(D=null!==(L=null===(V=se.inputFrame)||void 0===V?void 0:V.width)&&void 0!==L?L:b?._videoWidth)&&void 0!==D?D:0,Y=null!==(U=null===(J=se.inputFrame)||void 0===J?void 0:J.frameRate)&&void 0!==U?U:0;return Q&&(q.A_fhi=Q+""),$&&(q.A_fwi=$+""),Y&&(q.A_fri=Y+""),q}(h[0].ssrcId,n,d):null;p&&mo(()=>{var E;return null===(E=this.requestUpload)||void 0===E?void 0:E.call(this,Xi.PUBLISH_STATS,{stream_type:l===ne.LocalVideoLowTrack?"low":"high",stats:_2(_2({},p),m)})});const _=function(E){const v={id:"bweforvideo",timestamp:new Date(E.timestamp).toISOString(),type:"VideoBwe"};return E.bitrate.retransmit&&(v.A_rb=E.bitrate.retransmit.toString()),E.bitrate.targetEncoded&&(v.A_teb=E.bitrate.targetEncoded.toString()),v.A_aeb=E.bitrate.actualEncoded.toString(),v.A_tb=E.bitrate.transmit.toString(),void 0!==E.sendBandwidth&&(v.A_asb=E.sendBandwidth.toString()),v}(n);_&&setTimeout(()=>{var E;return null===(E=this.requestUpload)||void 0===E?void 0:E.call(this,Xi.PUBLISH_STATS,{stream_type:l===ne.LocalVideoLowTrack?"low":"high",stats:_})},1e3);break}case ne.LocalAudioTrack:{const p=function(m,_,E){const v=_.audioSend.find(T=>T.ssrc===m);if(!v)return null;const b={id:Fe(10,""),timestamp:new Date(_.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:v.ssrc.toString()};return b.A_astd=E._originMediaStreamTrack&&!E._originMediaStreamTrack.enabled||E._mediaStreamTrack&&!E._mediaStreamTrack.enabled?"1":"0",b.A_ail=v.inputLevel?Math.round(100*v.inputLevel).toString():Math.round(100*E._source.getAccurateVolumeLevel()).toString(),b.A_apil=Math.round(100*E._source.getAccurateVolumeLevel()).toString(),v.aecReturnLoss&&(b.A_ecrl=Math.round(v.aecReturnLoss).toString()),v.aecReturnLossEnhancement&&(b.A_ecrle=Math.round(v.aecReturnLossEnhancement).toString()),j("P2P")&&(v.bytes&&(b.bytesSent=v.bytes.toString()),"number"==typeof v.packetsLost&&(b.packetsLost=v.packetsLost.toString()),v.packets&&(b.packetsSent=v.packets.toString())),b}(h[0].ssrcId,n,d);p&&mo(()=>{var m;return null===(m=this.requestUpload)||void 0===m?void 0:m.call(this,Xi.PUBLISH_STATS,{stream_type:"high",stats:p})});break}}})}uploadRelatedUplinkStats(n,r){var a;((null===(a=this.requestLocalMedia)||void 0===a?void 0:a.call(this))||[]).filter(l=>{let[d]=l;return d===ne.LocalVideoLowTrack||d===ne.LocalVideoTrack}).forEach(l=>{let[d,{ssrcs:h}]=l;const p=function(m,_){const E=_.videoSend.find(v=>v.ssrc===m);return E?{mediaType:"video",isVideoMute:!1,frameRateInput:E.inputFrame&&E.inputFrame.frameRate.toString(),frameRateSent:E.sentFrame&&E.sentFrame.frameRate.toString(),googRtt:E.rttMs.toString(),qpSumPerFrame:Math.floor(E.qpSumPerFrame).toString()}:null}(h[0].ssrcId,n);p&&mo(()=>{var m;null===(m=this.requestUpload)||void 0===m||m.call(this,Xi.PUBLISH_RELATED_STATS,{stream_type:d===ne.LocalVideoLowTrack?"low":"high",stats:p})})})}uploadDenoiserStats(n){for(let d=0;d<n.length;d++){const h=n[d];if(h instanceof Td){var r,a,l;const p=null===(r=(a=h._external).getDenoiserStats)||void 0===r?void 0:r.call(a);return void(p&&(null===(l=this.requestUpload)||void 0===l||l.call(this,Xi.DENOISER_STATS,p)))}}}uploadExtensionStats(n){for(let r=0;r<n.length;r++)n[r].getProcessorStats().forEach(a=>{var l;null===(l=this.requestUpload)||void 0===l||l.call(this,a.type,a.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let n;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let r=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var a;const l=null===(a=this.requestStats)||void 0===a?void 0:a.call(this,!0);l&&(this.uploadDownlinkStats(l,r,n),n=l),r=!r},3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var a;const l=null===(a=this.requestStats)||void 0===a?void 0:a.call(this,!0);l&&(this.uploadRelatedDownlinkStats(l,this.lastStats),this.lastStats=l)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var a;const l=null===(a=this.requestRemoteMedia)||void 0===a?void 0:a.call(this);l&&this.uploadDownlinkExtensionStats(l)},2e3)}uploadDownlinkStats(n,r,a){var l;((null===(l=this.requestRemoteMedia)||void 0===l?void 0:l.call(this))||[]).forEach(d=>{let[h,p]=d;if(p.has(ge.VIDEO)&&h.videoTrack){const m=h.videoTrack?function(_,E,v,b,T){const O=E.videoRecv.find(V=>V.ssrc===_);if(!O)return null;const P={id:Fe(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:O.ssrc.toString()};var D,L;if(P.bytesReceived=O.bytes.toString(),P.packetsLost=O.packetsLost.toString(),P.packetsReceived=O.packets.toString(),O.framesRateFirefox&&(P.A_frr=O.framesRateFirefox.toString()),O.receivedFrame?(P.A_frr=O.receivedFrame.frameRate.toString(),P.A_fhr=O.receivedFrame.height.toString(),P.A_fwr=O.receivedFrame.width.toString()):(P.A_fhr=null===(D=b._videoHeight)||void 0===D?void 0:D.toString(),P.A_fwr=null===(L=b._videoWidth)||void 0===L?void 0:L.toString()),P.A_frd=O.decodeFrameRate.toString(),O.outputFrame&&(P.A_fro=O.outputFrame.frameRate.toString()),void 0!==O.jitterBufferMs&&(P.A_jbm=Math.floor(O.jitterBufferMs).toString()),void 0!==O.currentDelayMs&&(P.A_cdm=Math.floor(O.currentDelayMs).toString()),P.A_fs=O.firsCount.toString(),P.A_ns=O.nacksCount.toString(),P.A_ps=O.plisCount.toString(),b&&(P.A_vrtd=b._originMediaStreamTrack.enabled&&b._mediaStreamTrack.enabled?"0":"1"),b._player&&b._player.freezeTimeCounterList.length>0&&(P.A_vrft=Math.round(b._player.freezeTimeCounterList.splice(0,1)[0]).toString()),T&&b._player&&"visible"===La.visibility){const V=Math.min(6e3,b._player.renderFreezeAccTime);P.A_vrrft=Math.round(V).toString(),b._player.renderFreezeAccTime=Math.max(0,b._player.renderFreezeAccTime-V)}if(P.A_rvps=_E[b._player?b._player.videoElementStatus:"uninit"].toString(),v){const V=v.videoRecv.find(U=>U.ssrc===_);if(V&&void 0!==O.totalInterFrameDelay&&void 0!==O.totalSquaredInterFrameDelay&&void 0!==V.totalInterFrameDelay&&void 0!==V.totalSquaredInterFrameDelay){const U=O.totalInterFrameDelay-V.totalInterFrameDelay,se=O.framesDecodeCount-V.framesDecodeCount,q=U/se*1e3,Q=Math.round(1e3*Math.sqrt((O.totalSquaredInterFrameDelay-V.totalSquaredInterFrameDelay-Math.pow(U,2)/se)/se));!isNaN(Q)&&q+Q>Math.max(3*q,q+150)&&(P.A_ifdsd=Q.toString())}}return P}(h._videoSSRC,n,a,h.videoTrack,r):void 0;m&&mo(()=>{var _;return null===(_=this.requestUpload)||void 0===_?void 0:_.call(this,Xi.SUBSCRIBE_STATS,{stream_id:h.uid,stats:m})})}if(p.has(ge.AUDIO)&&h.audioTrack){const m=h.audioTrack?function(_,E,v,b){const T=E.audioRecv.find(P=>P.ssrc===_);if(!T)return null;const O={id:Fe(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:T.ssrc.toString()};if(O.bytesReceived=T.bytes.toString(),O.packetsLost=T.packetsLost.toString(),O.packetsReceived=T.packets.toString(),O.A_aol=T.outputLevel?Math.round(100*T.outputLevel).toString():Math.round(100*b._source.getAccurateVolumeLevel()).toString(),O.A_apol=Math.round(100*b._source.getAccurateVolumeLevel()).toString(),b&&(O.A_artd=b._originMediaStreamTrack.enabled&&b._mediaStreamTrack.enabled?"0":"1"),O.A_jr=T.jitterMs.toString(),O.A_jbm=Math.floor(T.jitterBufferMs).toString(),O.A_cdm=Math.floor(T.jitterBufferMs).toString(),O.A_raps=_E[Qr.getPlayerState(b.getTrackId())].toString(),v){const P=v.audioRecv.find(D=>D.ssrc===_);if(P){const D=T.concealedSamples-P.concealedSamples;D>0&&(O.A_cs=Math.round(D).toString())}}return O}(h._audioSSRC,n,a,h.audioTrack):void 0;m&&mo(()=>{var _;return null===(_=this.requestUpload)||void 0===_?void 0:_.call(this,Xi.SUBSCRIBE_STATS,{stream_id:h.uid,stats:m})})}})}uploadRelatedDownlinkStats(n,r){var a;((null===(a=this.requestRemoteMedia)||void 0===a?void 0:a.call(this))||[]).forEach(l=>{let[d,h]=l;if(h.has(ge.VIDEO)&&d.videoTrack){var p;const m=!0===(d._videoSSRC&&(null===(p=this.requestVideoIsReady)||void 0===p?void 0:p.call(this,d._videoSSRC))||!1),_=function(E,v,b,T,O,P){const D=b.videoRecv.find(J=>J.ssrc===E),L=O?O.videoRecv.find(J=>J.ssrc===E):void 0;if(!D)return null;const V=Oh.isRemoteVideoFreeze(P,D,L)&&v,U={mediaType:"video",isVideoMute:!1,peerId:T,frameRateReceived:D.receivedFrame&&D.receivedFrame.frameRate.toString(),frameRateDecoded:D.decodedFrame&&D.decodedFrame.frameRate.toString(),isFreeze:V,bytesReceived:D.bytes.toString(),packetsReceived:D.packets.toString(),packetsLost:D.packetsLost.toString(),qpSumPerFrame:Math.floor(D.qpSumPerFrame).toString()};return D.framesRateFirefox&&(U.frameRateDecoded=D.framesRateFirefox.toString(),U.frameRateReceived=D.framesRateFirefox.toString()),U}(d._videoSSRC,m,n,d.uid,r,d.videoTrack);_&&mo(()=>{var E;null===(E=this.requestUpload)||void 0===E||E.call(this,Xi.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:_})})}if(h.has(ge.AUDIO)&&d.audioTrack){const m=function(_,E,v,b){const T=E.audioRecv.find(P=>P.ssrc===_);if(!T)return null;const O=Oh.isRemoteAudioFreeze(b);return{mediaType:"audio",isAudioMute:!1,peerId:v,googJitterReceived:T.jitterMs.toString(),isFreeze:O,bytesReceived:T.bytes.toString(),packetsReceived:T.packets.toString(),packetsLost:T.packetsLost.toString(),frameReceived:T.receivedFrames.toString(),frameDropped:T.droppedFrames.toString()}}(d._audioSSRC,n,d.uid,d.audioTrack);m&&mo(()=>{var _;null===(_=this.requestUpload)||void 0===_||_.call(this,Xi.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:m})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(n){n.forEach(r=>{let[a,l]=r;l.has(ge.VIDEO)&&a.videoTrack&&a.videoTrack.getProcessorStats().forEach(d=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,d.type,d.stats)}),l.has(ge.AUDIO)&&a.audioTrack&&a.audioTrack.getProcessorStats().forEach(d=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,d.type,d.stats)})})}}function g2(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Kd(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?g2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):g2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function E2(s){var n,r,a,l=2;for(typeof Symbol<"u"&&(r=cN,a=Symbol.iterator);l--;){if(r&&null!=(n=s[r]))return n.call(s);if(a&&null!=(n=s[a]))return new AT(n.call(s));r="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function AT(s){function n(r){if(Object(r)!==r)return z.reject(new TypeError(r+" is not an object."));var a=r.done;return z.resolve(r.value).then(function(l){return{value:l,done:a}})}return(AT=function(r){this.s=r,this.n=r.next}).prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(r){var a=this.s.return;return void 0===a?z.resolve({value:r,done:!0}):n(a.apply(this.s,arguments))},throw:function(r){var a=this.s.return;return void 0===a?z.reject(r):n(a.apply(this.s,arguments))}},new AT(s)}class li extends qt{get state(){return this._state}set state(n){const r=this._state;this._state=n,this.emit(we.StateChange,r,this._state)}constructor(n,r){var a;super(),a=this,C(this,"store",void 0),C(this,"statsUploader",void 0),C(this,"connection",void 0),C(this,"localTrackMap",new Map),C(this,"remoteUserMap",new Map),C(this,"localDataChannels",[]),C(this,"remoteDataChannelMap",new Map),C(this,"pendingLocalTracks",[]),C(this,"pendingRemoteTracks",[]),C(this,"pendingLocalDataChannels",[]),C(this,"pendingRemoteDataChannels",[]),C(this,"statsCollector",void 0),C(this,"isPlanB",!1),C(this,"shouldForwardP2PCreation",void 0),C(this,"iceFailedCount",0),C(this,"dtlsFailedCount",0),C(this,"mutex",new Zn("P2PChannel-mutex")),C(this,"_state",it.Disconnected),C(this,"_pcStatsUploadType",j("NEW_ICE_RESTART")?Xs.FIRST_CONNECTION:Xs.OLD_FIRST_CONNECTION),C(this,"_isInRestartIce",!1),C(this,"_isStartRestartIce",!1),C(this,"_restartStates",["disconnected","failed"]),C(this,"_restartTimer",void 0),C(this,"_isFirstConnected",!0),C(this,"handleMuteLocalTrack",function(){var l=x(function*(d,h,p){const m=yield a.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!a.connection||a.state!==it.Connected)return void p(new X(M.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const _=a.filterTobeMutedTracks(d);if(0===_.length)return void h();const E=_.find(b=>"videoLowTrack"===b[0]);E&&E[1].track._originMediaStreamTrack.stop(),yield a.connection.muteLocal(_.map(b=>{let[,{id:T}]=b;return T}));const v=a.createMuteMessage(_);yield Et(a,we.RequestMuteLocal,v),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return l.apply(this,arguments)}}()),C(this,"handleUnmuteLocalTrack",function(){var l=x(function*(d,h,p){const m=yield a.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!a.connection||a.state!==it.Connected)return void p(new X(M.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const _=a.filterTobeUnmutedTracks(d);if(0===_.length)return void h();const E=_.find(b=>"videoLowTrack"===b[0]);if(E){const b=E[1];if(b.track._originMediaStreamTrack.stop(),!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&$e().supportDualStreamEncoding){const T=d._mediaStreamTrack.clone();b.track._mediaStreamTrack=T,b.track._originMediaStreamTrack=T}else{const T=IT(d,dc(a,we.RequestLowStreamParameter));b.track._mediaStreamTrack=T,b.track._originMediaStreamTrack=T}yield new z((T,O)=>{a.handleReplaceTrack(b.track,T,O,!0)})}yield a.connection.unmuteLocal(_.map(b=>{let[,{id:T}]=b;return T}));const v=a.createUnmuteMessage(_);yield Et(a,we.RequestUnmuteLocal,v),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return l.apply(this,arguments)}}()),C(this,"handleUpdateVideoEncoder",function(){var l=x(function*(d,h,p){const m=yield a.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const _=a.localTrackMap.get(ne.LocalVideoTrack);if(!a.connection||!_||_.track!==d||a.state!==it.Connected)return void h();const{id:E,track:v}=_;yield a.connection.updateSendParameters(E,v),yield a.connection.updateEncoderConfig(E,v),a.emit(we.UpdateVideoEncoder,v),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return l.apply(this,arguments)}}()),C(this,"handleSetOptimizationMode",function(){var l=x(function*(d,h,p){const m=yield a.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const _=a.localTrackMap.get(ne.LocalVideoTrack);if(!a.connection||!_||_.track!==d||a.state!==it.Connected)return;const{id:E,track:v}=_;yield a.connection.updateSendParameters(E,v),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return l.apply(this,arguments)}}()),C(this,"handleReplaceTrack",function(){var l=x(function*(d,h,p,m){let _;w.debug("[".concat(a.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(d.getTrackId(),"]")),"boolean"==typeof m&&m||(_=yield a.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var E;const b=Array.from(a.localTrackMap.entries()).find(T=>{let[,{track:O}]=T;return d===O});if(!a.connection||!b||a.state!==it.Connected)return void h();if(yield null===(E=a.connection)||void 0===E?void 0:E.replaceTrack(d,b[1].id),a.isPlanB){const T=b[1];T.id=d._mediaStreamTrack.id,a.localTrackMap.set(b[0],T)}if(b[0]===ne.LocalVideoTrack&&!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&$e().supportDualStreamEncoding){const T=a.localTrackMap.get(ne.LocalVideoLowTrack);if(T){const O=d._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=O,T.track._originMediaStreamTrack=O,yield new z((P,D)=>{a.handleReplaceTrack(T.track,P,D,!0)})}}h()}catch(b){p(b)}finally{var v;null===(v=_)||void 0===v||v()}});return function(d,h,p,m){return l.apply(this,arguments)}}()),C(this,"handleGetRTCStats",l=>{l(this.statsCollector.getRTCStats())}),C(this,"handleGetLocalVideoStats",l=>{l(this.statsCollector.getLocalVideoTrackStats())}),C(this,"handleGetLocalAudioStats",l=>{l(this.statsCollector.getLocalAudioTrackStats())}),C(this,"handleGetRemoteVideoStats",l=>this.statsCollector.getRemoteVideoTrackStats(l.uid)[l.uid]),C(this,"handleGetRemoteAudioStats",l=>this.statsCollector.getRemoteAudioTrackStats(l.uid)[l.uid]),this.store=n,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new ci,this.bindStatsUploaderEvents(),this.isPlanB=!$e().supportUnifiedPlan||j("CHROME_FORCE_PLAN_B")&&zs(),this.shouldForwardP2PCreation=j("FORWARD_P2P_CREATION")&&$e().supportPCSetConfiguration&&function(){const l=Mg();return l===Fn.ANDROID||l===Fn.IOS||l===Fn.HARMONY_OS}(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Hn({},this.store):this.isPlanB?new ai({},this.store):new Jn({},this.store),this.bindConnectionEvents(this.connection))}startP2PConnection(n,r){var a=this;return x(function*(){var l;a.state=it.New;const d=a.shouldForwardP2PCreation&&"closed"===(null===(l=a.connection)||void 0===l?void 0:l.peerConnectionState);if(a.shouldForwardP2PCreation&&!d||(d&&a.connection&&(w.warning("[".concat(a.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),a.connection.close(),a.unbindConnectionEvents(a.connection)),a.connection=a.store.useDataChannel?new Hn(n,a.store):a.isPlanB?new ai(n,a.store):new Jn(n,a.store),a.bindConnectionEvents(a.connection)),!a.connection)throw new X(M.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return a._pcStatsUploadType=j("NEW_ICE_RESTART")?Xs.FIRST_CONNECTION:Xs.OLD_FIRST_CONNECTION,a._isFirstConnected=!0,a._isInRestartIce=!1,a._isStartRestartIce=!1,a.connection.setConfiguration(n),a.connection.establishPromise})()}connect(n,r,a,l,d,h){var p=this;return x(function*(){if(!p.connection)throw new X(M.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");p.connection instanceof Hn?p.connection.updateRemoteConnect(l):(p.store.peerConnectionStart(),yield p.connection.connect(n,r,a,l,d,h),p.statsUploader.startUploadTransportStats(),p.statsUploader.startUploadExtensionUsageStats(),p.state=it.Connected)})()}updateRemoteRTPCapabilities(n){const r=Array.from(this.localTrackMap.entries()).filter(a=>{var l;let[d]=a;return ye(l=[ne.LocalVideoLowTrack,ne.LocalVideoTrack]).call(l,d)}).map(a=>{let[,{id:l}]=a;return l});this.connection instanceof Jn&&this.connection.updateRemoteRTPCapabilities(r,n)}preConnect(n,r,a,l,d,h){var p=this;return x(function*(){if(!p.connection)throw new X(M.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");p.store.peerConnectionStart();const m=yield p.connection.connect(n,r,a,l,d,h);return p.statsUploader.startUploadTransportStats(),p.statsUploader.startUploadExtensionUsageStats(),p.state=it.Connected,m})()}getEstablishParams(){if(this.connection instanceof Hn)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publishDataChannel(n){var r=this;return x(function*(){if(!r.connection){if(r.state===it.Disconnected)throw new X(M.UNEXPECTED_ERROR,"PeerConnection already disconnected.");const l=n.filter(d=>-1!==r.pendingLocalDataChannels.findIndex(h=>h.id===d.id));return void(r.pendingLocalDataChannels=r.pendingLocalDataChannels.concat(l))}const a=r.filterTobePublishedDataChannels(n);0!==a.length&&(a.forEach(l=>{const d=Date.now();r.store.publish(l.id.toString(),"datachannel",d)}),yield r.connection.createDataChannels(r.store.uid,a),a.forEach(l=>{r.localDataChannels.push(l);const d=Date.now();r.store.publish(l.id+"","datachannel",void 0,d)}))})()}publish(n,r,a){var l=this;return cs(function*(){const d=yield ht(l.mutex.lock("From P2PChannel.publish"));try{if(!l.connection||l.state!==it.Connected){if(l.state===it.Disconnected)throw new X(M.UNEXPECTED_ERROR,"PeerConnection already disconnected.");l.throwIfTrackTypeNotMatch(n);const p=n.filter(m=>-1===l.pendingLocalTracks.indexOf(m));return void(l.pendingLocalTracks=l.pendingLocalTracks.concat(p))}l.store.pubId=l.store.pubId+1,Di.markPublishStart(l.store.clientId,l.store.pubId);const h=l.filterTobePublishedTracks(n,r,a);if(0===h.length)return void(yield ht(l.tryToUnmuteAudio(n)));yield*Qf(E2(l.doPublish(l.connection,h)))}finally{d()}})()}doPublish(n,r){var a=this;return cs(function*(){r.forEach(E=>{let{track:v,type:b}=E;const T=Date.now();a.store.publish(v.getTrackId(),b===ne.LocalAudioTrack?"audio":"video",T)}),a.bindLocalTrackEvents(r);const l=yield ht(n.send(r.map(E=>{let{track:v}=E;return v}),a.store.codec,a.store.audioCodec)),d=(yield ht(l.next())).value,h=a.createGatewayPublishMessage(r,d);let p;try{p=yield h}catch(E){throw l.throw(E),E?.code===M.WS_ABORT&&r.forEach(v=>{let{track:b}=v;-1===a.pendingLocalTracks.indexOf(b)&&a.pendingLocalTracks.push(b)}),a.unbindLocalTrackEvents(r),E}const m=a.mapPubResToRemoteConfig(h,p),_=(yield ht(l.next(m))).value;r.forEach(E=>{let{type:v}=E;a.statsCollector.addLocalStats(v)}),a.assignLocalTracks(r,_),a.statsUploader.startUploadUplinkStats(),r.forEach(E=>{let{track:v,type:b}=E;const T=Date.now();a.store.publish(v.getTrackId(),b===ne.LocalAudioTrack?"audio":"video",void 0,T)})})()}updateVideoStreamParameter(n,r){var a=this;return x(function*(){const l=a.localTrackMap.get(r);if(!l)return;if(!(l.track instanceof ze))return w.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(a.connection instanceof Jn||a.connection instanceof ai))return w.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:d}=l,h=function(p,m){const _={};return p.height&&p.width&&(_.scaleResolutionDownBy=XC(p,m)),_.maxFramerate=p.framerate?Sr(p.framerate):void 0,_.maxBitrate=p.bitrate?1e3*p.bitrate:void 0,_}(n,d);if(d._encoderConfig||(d._encoderConfig={}),r!==ne.LocalVideoLowTrack||!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&$e().supportDualStreamEncoding)null!=h.scaleResolutionDownBy&&(d._encoderConfig.scaleResolutionDownBy=h.scaleResolutionDownBy);else{const p=d._originMediaStreamTrack;if(!p.canvas)return w.warn("[".concat(d.getTrackId(),"] no canvas on track"));!function(m,_){const E=m.canvas;_.width&&(E.width=Sr(_.width)),_.height&&(E.height=Sr(_.height)),_.framerate&&(E.stopCapture&&E.stopCapture(),E.stopCapture=vE(()=>{!E.startCapture&&E.stopCapture&&E.stopCapture(),E.startCapture&&E.startCapture()},Sr(_.framerate)))}(p,n)}null!=h.maxBitrate&&(d._encoderConfig.bitrateMax=h.maxBitrate/1e3),null!=h.maxFramerate&&(d._encoderConfig.frameRate&&"object"==typeof d._encoderConfig.frameRate?d._encoderConfig.frameRate.max=h.maxFramerate:d._encoderConfig.frameRate={max:h.maxFramerate}),w.debug("[".concat(d.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(d._encoderConfig))),yield a.connection.updateRtpSenderEncodings(d)})()}publishLowStream(n){var r=this;return cs(function*(){if(!r.connection||r.state!==it.Connected)return;const a=yield ht(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const d=r.localTrackMap.get(ne.LocalVideoTrack);if(!d)throw new X(M.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(ne.LocalVideoLowTrack))throw new X(M.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const h=[{track:r.getLowVideoTrack(d.track,n),type:ne.LocalVideoLowTrack}];if(yield*Qf(E2(r.doPublish(r.connection,h))),d.track.muted||!d.track.enabled){var l;const p=null===(l=r.localTrackMap.get(ne.LocalVideoLowTrack))||void 0===l?void 0:l.id;void 0!==p&&(yield ht(r.connection.muteLocal([p])))}}finally{a()}})()}republish(){var n=this;return x(function*(){n.pendingLocalTracks.length>0&&(w.debug("[".concat(n.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield Qt(n,we.RequestRePublish,n.pendingLocalTracks),n.emit(we.MediaReconnectEnd,n.store.uid),n.pendingLocalTracks=[]),n.pendingLocalDataChannels.length>0&&(w.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),yield Qt(n,we.RequestRePublishDataChannel,n.pendingLocalDataChannels),n.pendingLocalDataChannels=[])})()}reSubscribe(n){var r=this;return x(function*(){for(let a=r.pendingRemoteTracks.length-1;a>=0;a--){const{user:l,kind:d}=r.pendingRemoteTracks[a];(d!==ge.AUDIO||l._audio_added_&&l._audioSSRC)&&(d!==ge.VIDEO||l._video_added_&&l._videoSSRC)||r.pendingRemoteTracks.splice(a,1)}if(n)yield Qt(r,we.RequestReSubscribe,r.pendingRemoteTracks);else for(const{user:a,kind:l}of r.pendingRemoteTracks)yield r.subscribe(a,l,l===ge.VIDEO?a._videoSSRC:a._audioSSRC);r.pendingRemoteTracks.forEach(a=>{let{user:l}=a;r.emit(we.MediaReconnectEnd,l.uid)}),r.pendingRemoteTracks=[]})()}unpublish(n){var r=this;return x(function*(){if(!r.connection||r.state!==it.Connected)return void n.forEach(d=>{const h=r.pendingLocalTracks.indexOf(d);-1!==h&&r.pendingLocalTracks.splice(h,1)});const a=r.filterTobeUnpublishedTracks(n);if(0===a.length)return;const l=a.find(d=>"videoLowTrack"===d[0]);return l&&l[1].track.close(),r.doUnpublish(r.connection,a)})()}unpublishDataChannel(n){var r=this;return x(function*(){if(!r.connection||r.state!==it.Connected)return void n.forEach(l=>{const d=r.pendingLocalDataChannels.indexOf(l);-1!==d&&r.pendingLocalDataChannels.splice(d,1)});const a=r.filterTobeUnpublishedDataChannels(n);return 0!==a.length?(a.forEach(l=>{const d=r.localDataChannels.indexOf(l);-1!==d&&r.localDataChannels.splice(d,1)}),0===r.localDataChannels.length&&(yield r.connection.stopDataChannels(r.store.uid)),a.map(l=>l.id)):void 0})()}unpublishLowStream(){var n=this;return x(function*(){if(!n.connection||n.state!==it.Connected)return;const r=n.localTrackMap.get(ne.LocalVideoLowTrack);return r?(r.track.close(),n.doUnpublish(n.connection,[[ne.LocalVideoLowTrack,r]])):void 0})()}doUnpublish(n,r){var a=this;return x(function*(){const l=a.createGatewayUnpublishMessage(r);return yield n.stopSending(r.map(d=>{let[,{id:h}]=d;return h})),a.withdrawLocalTracks(r),a.unbindLocalTrackEvents(r.map(d=>{let[h,{track:p}]=d;return{type:h,track:p}})),r.forEach(d=>{let[h]=d;a.statsCollector.removeLocalStats(h)}),0===a.localTrackMap.size&&a.statsUploader.stopUploadUplinkStats(),l})()}subscribeDataChannel(n,r){var a=this;return x(function*(){if(!a.connection||a.state!==it.Connected)throw new X(M.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const l=r.filter(d=>{var h;return!(null!==(h=a.remoteDataChannelMap.get(n))&&void 0!==h&&h.get(d.id))});if(0!==l.length)return yield a.connection.createDataChannels(n.uid,l),l.forEach(d=>{var h;a.remoteDataChannelMap.has(n)?null===(h=a.remoteDataChannelMap.get(n))||void 0===h||h.set(d.id,d):a.remoteDataChannelMap.set(n,new Map([[d.id,d]]));const p=a.pendingRemoteDataChannels.findIndex(m=>{let{user:_,id:E}=m;return _.uid===n.uid&&E===d.id});-1!==p&&a.pendingRemoteDataChannels.splice(p,1)}),l.map(d=>d.id)})()}subscribe(n,r,a,l,d){var h=this;return x(function*(){var p;if(!h.connection||h.state!==it.Connected)throw new X(M.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(p=h.remoteUserMap.get(n))&&void 0!==p&&p.has(r))return;let m,_,E;if(d){const T=d.find(P=>{let{stream_type:D}=P;return D===r});if(!T)throw new X(M.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(n.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const O=yield h.connection.receive(r,T.ssrcs,String(n._uintid),T.attributes);h.connection instanceof Jn&&(E=O.transceiver),m=O.track,_=O.id}else{const T=yield h.connection.receive(r,[{ssrcId:a,rtx:l}],String(n._uintid),void 0);h.connection instanceof Jn&&(E=T.transceiver),m=T.track,_=T.id}r===ge.AUDIO?(n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(m):(n._audioTrack=new Co(m,n.uid,n._uintid,h.store),w.info("[".concat(h.store.clientId,"] [").concat(h.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),E&&n._audioTrack._updateRtpTransceiver(E),h.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(m):(n._videoTrack=new Cs(m,n.uid,n._uintid,h.store),w.info("[".concat(h.store.clientId,"] [").concat(h.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),E&&n._videoTrack._updateRtpTransceiver(E),h.bindRemoteTrackEvents(n,n._videoTrack));const v=h.remoteUserMap.get(n);v?v.set(r,_):h.remoteUserMap.set(n,new Map([[r,_]])),h.statsCollector.addRemoteStats(n.uid),h.statsUploader.startUploadDownlinkStats();const b=h.pendingRemoteTracks.findIndex(T=>{let{user:O,kind:P}=T;return O.uid===n.uid&&r===P});-1!==b&&(h.pendingRemoteTracks.splice(b,1),h.emit(we.MediaReconnectEnd,n.uid))})()}massSubscribe(n){var r=this;return x(function*(){return r.massSubscribeNoLock(n)})()}massSubscribeNoLock(n){var r=this;return x(function*(){if(!r.connection||r.state!==it.Connected)throw new X(M.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");n=n.filter(l=>{var d;let{user:h,mediaType:p}=l;return!(null!==(d=r.remoteUserMap.get(h))&&void 0!==d&&d.has(p))});const a=yield r.connection.batchReceive(n.map(l=>{let{user:d,mediaType:h,ssrcId:p,rtxSsrcId:m}=l;return{kind:h,ssrcMsg:[{ssrcId:p,rtx:m}],mslabel:String(d._uintid)}}));n.forEach((l,d)=>{let{user:h,mediaType:p}=l;const{track:m,id:_,transceiver:E}=a[d];p===ge.AUDIO?(h._audioTrack?h._audioTrack._updateOriginMediaStreamTrack(m):(h._audioTrack=new Co(m,h.uid,h._uintid,r.store),w.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote audio track: ").concat(h._audioTrack.getTrackId()))),E&&h._audioTrack._updateRtpTransceiver(E),r.bindRemoteTrackEvents(h,h._audioTrack)):(h._videoTrack?h._videoTrack._updateOriginMediaStreamTrack(m):(h._videoTrack=new Cs(m,h.uid,h._uintid,r.store),w.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote video track: ").concat(h._videoTrack.getTrackId()))),E&&h._videoTrack._updateRtpTransceiver(E),r.bindRemoteTrackEvents(h,h._videoTrack));const v=r.remoteUserMap.get(h);v?v.set(p,_):r.remoteUserMap.set(h,new Map([[p,_]])),r.statsCollector.addRemoteStats(h.uid),r.statsUploader.startUploadDownlinkStats();const b=r.pendingRemoteTracks.findIndex(T=>{let{user:O,kind:P}=T;return O.uid===h.uid&&p===P});-1!==b&&(r.pendingRemoteTracks.splice(b,1),r.emit(we.MediaReconnectEnd,h.uid))})})()}unsubscribe(n,r,a){var l=this;return x(function*(){const d=l.pendingRemoteTracks.filter(m=>{let{user:_,kind:E}=m;return void 0!==r?_.uid===n.uid&&r===E:_.uid===n.uid});if(d.forEach(m=>{const _=l.pendingRemoteTracks.indexOf(m);l.pendingRemoteTracks.splice(_,1)}),l.connection&&l.state===it.Connected||a||d.forEach(m=>{let{kind:_}=m;var E;if(_===ge.AUDIO)null===(E=n._audioTrack)||void 0===E||E._destroy(),n._audioTrack=void 0;else if(_===ge.VIDEO){var v;null===(v=n._videoTrack)||void 0===v||v._destroy(),n._videoTrack=void 0}}),!l.connection||l.state!==it.Connected)return;const h=l.filterTobeUnSubscribedTracks(n,r);if(0===h.length)return;yield l.connection.stopReceiving(h.map(m=>{let[,{id:_}]=m;return _}));const p=l.createUnsubscribeMessage(h);return l.withdrawRemoteTracks(h),0===l.remoteUserMap.size&&l.statsUploader.stopUploadDownlinkStats(),h.forEach(m=>{let[_,{kind:E}]=m;var v,b;if(E===ge.VIDEO&&_._videoSSRC&&(null===(v=l.connection)||void 0===v||v.setStatsRemoteVideoIsReady(_._videoSSRC,!1)),E===ge.VIDEO)l.unbindRemoteTrackEvents(_._videoTrack),a||(null===(b=_._videoTrack)||void 0===b||b._destroy(),_._videoTrack=void 0);else if(E===ge.AUDIO){var T;l.unbindRemoteTrackEvents(_._audioTrack),!a&&(null===(T=_._audioTrack)||void 0===T||T._destroy(),_._audioTrack=void 0)}}),p})()}unsubscribeDataChannel(n,r){var a=this;return x(function*(){if(r.forEach(h=>{const p=a.pendingRemoteDataChannels.findIndex(m=>m.id===h.id);-1!==p&&a.pendingRemoteDataChannels.splice(p,1)}),!a.connection)return;const l=a.filterTobeUnSubscribedDataChannels(n,r);if(0===l.length)return;r.forEach(h=>{h._close()});const d=a.remoteDataChannelMap.get(n);return l.forEach(h=>{d&&d.delete(h.id)}),d&&0===d.size&&(a.remoteDataChannelMap.delete(n),yield a.connection.stopDataChannels(n.uid)),l.map(h=>h.id)})()}massUnsubscribe(n){var r=this;return x(function*(){return r.massUnsubscribeNoLock(n)})()}massUnsubscribeNoLock(n){var r=this;return x(function*(){let a=[];for(const{user:h,mediaType:p}of n){const m=r.pendingRemoteTracks.filter(_=>{let{user:E,kind:v}=_;return void 0!==p?E.uid===h.uid&&p===v:E.uid===h.uid});m.forEach(_=>{const E=r.pendingRemoteTracks.indexOf(_);r.pendingRemoteTracks.splice(E,1)}),a=a.concat(m)}if(!r.connection||r.state!==it.Connected)return void a.forEach(h=>{let{user:p,kind:m}=h;var _;if(m===ge.AUDIO)null===(_=p._audioTrack)||void 0===_||_._destroy(),p._audioTrack=void 0;else if(m===ge.VIDEO){var E;null===(E=p._videoTrack)||void 0===E||E._destroy(),p._videoTrack=void 0}});const l=al(n).call(n,(h,p)=>{let{user:m,mediaType:_}=p;const E=r.filterTobeUnSubscribedTracks(m,_);return h.concat(E)},[]);if(0===l.length)return;yield r.connection.stopReceiving(l.map(h=>{let[,{id:p}]=h;return p}));const d=r.createUnsubscribeAllMessage(l);return r.withdrawRemoteTracks(l),0===r.remoteUserMap.size&&r.statsUploader.stopUploadDownlinkStats(),l.forEach(h=>{let[p,{kind:m}]=h;var _,E;if(m===ge.VIDEO&&p._videoSSRC&&(null===(_=r.connection)||void 0===_||_.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),m===ge.VIDEO)r.unbindRemoteTrackEvents(p._videoTrack),null===(E=p._videoTrack)||void 0===E||E._destroy(),p._videoTrack=void 0;else if(m===ge.AUDIO){var v;r.unbindRemoteTrackEvents(p._audioTrack),null===(v=p._audioTrack)||void 0===v||v._destroy(),p._audioTrack=void 0}}),d})()}muteRemote(n,r){var a=this;return x(function*(){if(!a.connection)return;const l=a.remoteUserMap.get(n);if(!l)return void w.warning("[".concat(a.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(n.uid,"."));if(!l.get(r))return void w.warning("[".concat(a.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(n.uid," media type ").concat(r,"."));const d=r===ge.VIDEO?n._videoSSRC:n._audioSSRC;void 0!==d&&a.connection.setStatsRemoteVideoIsReady(d,!1)})()}unmuteRemote(n,r){var a=this;return x(function*(){return a.unmuteRemoteNoLock(n,r)})()}unmuteRemoteNoLock(n,r){var a=this;return x(function*(){if(!a.connection)return;const l=a.remoteUserMap.get(n);l?l.get(r)||w.warning("[".concat(a.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(n.uid," media type ").concat(r,".")):w.warning("[".concat(a.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(n.uid,"."))})()}getAllTracks(n){const r=this.localTrackMap.get(ne.LocalAudioTrack);if(r?.track instanceof wn){const a=r.track;return Array.from(this.localTrackMap.entries()).filter(l=>{let[d]=l;return d!==ne.LocalAudioTrack}).filter(l=>{let[d]=l;return!(n&&d===ne.LocalVideoLowTrack)}).map(l=>{let[,{track:d}]=l;return d}).concat(a.trackList)}return Array.from(this.localTrackMap.entries()).filter(a=>{let[l]=a;return!(n&&l===ne.LocalVideoLowTrack)}).map(a=>{let[,{track:l}]=a;return l})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(n,r,a,l,d){if(n){const p=this.localTrackMap.get(ne.LocalAudioTrack),m=this.localTrackMap.get(l?ne.LocalVideoLowTrack:ne.LocalVideoTrack);Se.publish(this.store.sessionId,{eventElapse:Di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:r,audioName:p?.track.getTrackLabel(),videoName:m?.track.getTrackLabel(),screenshare:-1!==m?.track._hints.indexOf(Ot.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}else{var h;a||(a=[]);const p=a.find(_=>_ instanceof mt),m=l?null===(h=this.localTrackMap.get(ne.LocalVideoTrack))||void 0===h?void 0:h.track:a.find(_=>_ instanceof ze);Se.publish(this.store.sessionId,{eventElapse:Di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:r,audioName:p?.getTrackLabel(),videoName:m?.getTrackLabel(),screenshare:-1!==m?._hints.indexOf(Ot.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}}reportSubscribeEvent(n,r,a,l){const d=l===ge.VIDEO?a._videoSSRC:a._audioSSRC;d&&Se.subscribe(this.store.sessionId,{succ:n,ec:r,video:l===ge.VIDEO,audio:l===ge.AUDIO,peerid:a.uid,subscribeRequestid:l===ge.VIDEO?a._videoSSRC:a._audioSSRC,p2pid:this.store.p2pId,eventElapse:Di.measureFromSubscribeStart(this.store.clientId,d)})}reset(){w.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Zn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Hn({},this.store):this.isPlanB?new ai({},this.store):new Jn({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const n=this.localTrackMap.get(ne.LocalAudioTrack);if(n?.track instanceof wn){if(n.track.trackList.length>0){const r=n.track;n.track.trackList.forEach(a=>{r.removeAudioTrack(a)})}n.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=it.Disconnected}getStats(){var n;return null===(n=this.connection)||void 0===n?void 0:n.getStats()}getRemoteVideoIsReady(n){var r;return(null===(r=this.connection)||void 0===r?void 0:r.getRemoteVideoIsReady(n))||!1}getLocalAudioVolume(){const n=this.localTrackMap.get(ne.LocalAudioTrack);if(n)return n.track.getVolumeLevel()}getLocalVideoSize(){const n=this.localTrackMap.get(ne.LocalVideoTrack);if(n)return{width:n.track._videoWidth||0,height:n.track._videoHeight||0}}getEncoderConfig(n){const r=this.localTrackMap.get(n);return r&&r.track instanceof ze||r&&r.track instanceof mt?r.track._encoderConfig:void 0}getLocalMedia(n){return this.localTrackMap.get(n)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(n,r){if(!n)return this.remoteUserMap.size>0;const a=this.remoteUserMap.get(n);return!!a&&(!r||a.has(r))}hasRemoteMediaWithLock(n,r){var a=this;return x(function*(){if(!n)return a.remoteUserMap.size>0;const l=a.remoteUserMap.get(n);return!!l&&(!r||l.has(r))})()}getRemoteMedia(n){var r;const a=Array.from(Kr(r=this.remoteUserMap).call(r)).find(l=>l.uid===n);return a?{audioTrack:a.audioTrack,audioSSRC:a._audioSSRC,videoTrack:a.videoTrack,videoSSRC:a._videoSSRC}:{}}getAudioLevels(){let n=Array.from(this.remoteUserMap.entries()).map(a=>{let[l]=a;return{uid:l.uid,level:l.audioTrack?100*l.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(ne.LocalAudioTrack);return r&&n.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),n=Zc(n).call(n,(a,l)=>a.level-l.level),n}disconnectForReconnect(){var n=this;return x(function*(){n.connection&&(w.debug("[".concat(n.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),n.state=it.Reconnecting,j("KEEP_LAST_FRAME")&&0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(r=>{let[a]=r;var l;a._videoTrack&&a._videoTrack._player&&(null===(l=a._videoTrack._player.getVideoElement())||void 0===l||l.pause(),a._videoTrack._player.isKeepLastFrame=!0,a._videoTrack._originMediaStreamTrack.stop())}),n.connection.close(),n.unbindConnectionEvents(n.connection),n.connection=void 0,n.shouldForwardP2PCreation&&(n.connection=n.store.useDataChannel?new Hn({},n.store):n.isPlanB?new ai({},n.store):new Jn({},n.store),n.bindConnectionEvents(n.connection)),0!==n.localTrackMap.size&&(Array.from(n.localTrackMap.entries()).forEach(r=>{var a;let[l,{track:d}]=r;switch(l){case ne.LocalVideoTrack:ye(a=d._hints).call(a,Ot.LOW_STREAM)?d.close():n.pendingLocalTracks.push(d);break;case ne.LocalAudioTrack:d instanceof wn?n.pendingLocalTracks=n.pendingLocalTracks.concat(d.trackList):n.pendingLocalTracks.push(d)}}),n.emit(we.MediaReconnectStart,n.store.uid)),n.unbindLocalTrackEvents(),n.localTrackMap.clear(),0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(r=>{let[a,l]=r;Array.from(Kr(l).call(l)).forEach(d=>{n.setPendingRemoteMedia(a,d)}),n.emit(we.MediaReconnectStart,a.uid)}),n.unbindAllRemoteTrackEvents(),n.remoteUserMap.clear(),0!==n.localDataChannels.length&&(n.localDataChannels.forEach(r=>{n.pendingLocalDataChannels.push(r)}),n.localDataChannels.length=0),0!==n.remoteDataChannelMap.size&&(Array.from(n.remoteDataChannelMap.entries()).forEach(r=>{let[a,l]=r;Array.from(Kr(l).call(l)).forEach(d=>{n.setPendingRemoteDataChannel(a,d)})}),n.remoteDataChannelMap.clear()),n.statsUploader.stopUploadUplinkStats(),n.statsUploader.stopUploadDownlinkStats(),n.statsUploader.stopUploadTransportStats(),w.debug("[".concat(n.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))})()}hasPendingRemoteDataChannel(n,r){for(const a of this.pendingRemoteDataChannels){const{user:l,id:d}=a;if((n instanceof Oi?n.uid:n)===l.uid&&d===r)return!0}return!1}setPendingRemoteDataChannel(n,r){this.hasPendingRemoteDataChannel(n,r)||this.pendingRemoteDataChannels.push({user:n,id:r})}hasPendingRemoteMedia(n,r){for(const a of this.pendingRemoteTracks){const{user:l,kind:d}=a;if((n instanceof Oi?n.uid:n)===l.uid&&r===d)return!0}return!1}setPendingRemoteMedia(n,r){this.hasPendingRemoteMedia(n,r)||this.pendingRemoteTracks.push({user:n,kind:r})}restartICE(n){var r=this;return cs(function*(){if(!r.connection||r.state!==it.Connected||r.connection instanceof Hn)return;const a=yield ht(r.mutex.lock("From P2PChannel.restartICE"));let l;try{l=yield ht(r.connection.restartICE(n));const h=yield ht(l.next());if(h.done)return;const p=h.value,m=yield p;switch(r.reportPCDisconnectedOrFailed(n),n){case wi.TCP:r._pcStatsUploadType=Xs.TCP_RESTART;break;case wi.RELAY:r._pcStatsUploadType=Xs.RELAY_RESTART;break;default:r._pcStatsUploadType=Xs.OLD_RESTART}r._isInRestartIce=!0,l.next(m)}catch(h){var d;null===(d=l)||void 0===d||d.throw(h)}finally{a()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const n=this.connection.getStats(),r=this.localTrackMap.get(ne.LocalVideoTrack),a=this.localTrackMap.get(ne.LocalAudioTrack),l=n.videoSend.find(O=>O.ssrc===r?.ssrcs[0].ssrcId),d=n.audioSend.find(O=>O.ssrc===a?.ssrcs[0].ssrcId);if(!l||!d)return 1;const h=_r(this,we.NeedSignalRTT),p=l?l.rttMs:void 0,m=d?d.rttMs:void 0,_=p&&m?(p+m)/2:p||m,v=100*n.sendPacketLossRate*.7/50+.3*((_&&h?(_+h)/2:_||h)||0)/1500,b=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,T=r?.track;if(T&&T._encoderConfig&&-1===T._hints.indexOf(Ot.SCREEN_TRACK)){const O=T._encoderConfig.bitrateMax,P=n.bitrate.actualEncoded;if(O&&P){const D=(1e3*O-P)/(1e3*O);return yD[D<.15?0:D<.3?1:D<.45?2:D<.6?3:4][b]}}return b}getDownlinkNetworkQuality(){if(!this.connection)return 0;const n=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(a=>{let[l]=a;const d=l._audioSSRC,h=l._videoSSRC,p=n.audioRecv.find(P=>P.ssrc===d),m=n.videoRecv.find(P=>P.ssrc===h);if(!p&&!m)return void(r+=1);const _=_r(this,we.NeedSignalRTT),E=n.rtt,v=(E&&_?(E+_)/2:E||_)||0,b=p?p.jitterMs:void 0,T=n.recvPacketLossRate;let O=.7*T*100/50+.3*v/1500;b&&(O=.6*T*100/50+.2*v/1500+.2*b/400),r+=O<.1?1:O<.17?2:O<.36?3:O<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}muteLocalTrack(n){var r=this;return x(function*(){return new z((a,l)=>{r.handleMuteLocalTrack(n,a,l)})})()}filterTobePublishedTracks(n,r,a){const l=[],d=$e(),h=this.getAllTracks();n=rh(n=n.filter(_=>-1===h.indexOf(_)));let p=!1,m=!1;for(const _ of n){if(_ instanceof ze&&(this.localTrackMap.has(ne.LocalVideoTrack)||p?new X(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(l.push({track:_,type:ne.LocalVideoTrack}),p=!0),r)){const E=this.getLowVideoTrack(_,a);l.push({track:E,type:ne.LocalVideoLowTrack})}if(_ instanceof mt){const E=this.localTrackMap.get(ne.LocalAudioTrack);if(E){if(!(E.track instanceof wn))throw new X(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new X(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const v=l.find(b=>{let{type:T}=b;return T===ne.LocalAudioTrack});if(!(v.track instanceof wn))throw new X(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new X(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(_)}else{if(!d.webAudioMediaStreamDest||_ instanceof wn||_._bypassWebAudio)l.push({track:_,type:ne.LocalAudioTrack});else{const v=new wn;v.addAudioTrack(_),l.push({track:v,type:ne.LocalAudioTrack})}m=!0}}}return l}filterTobeUnpublishedTracks(n){const r=[],a=this.getAllTracks();n=rh(n=n.filter(l=>-1!==a.indexOf(l)));for(const l of n){if(l instanceof mt){const d=this.localTrackMap.get(ne.LocalAudioTrack);if(!d)continue;d.track instanceof wn?(d.track.removeAudioTrack(l),this.unbindLocalAudioTrackEvents(l),0===d.track.trackList.length&&(r.push([ne.LocalAudioTrack,d]),d.track.close())):r.push([ne.LocalAudioTrack,d])}if(l instanceof ze){const d=this.localTrackMap.get(ne.LocalVideoTrack);if(!d)continue;r.push([ne.LocalVideoTrack,d]);const h=this.localTrackMap.get(ne.LocalVideoLowTrack);h&&r.push([ne.LocalVideoLowTrack,h])}}return r}filterTobePublishedDataChannels(n){return(n=rh(n)).filter(r=>-1===this.localDataChannels.findIndex(a=>a.id===r.id))}filterTobeUnpublishedDataChannels(n){return(n=(n=rh(n)).filter(r=>-1!==this.localDataChannels.indexOf(r))).filter(r=>r._originDataChannel)}bindLocalTrackEvents(n){n.forEach(r=>{let{track:a,type:l}=r;switch(l){case ne.LocalVideoTrack:a.addListener(fe.GET_STATS,this.handleGetLocalVideoStats),a.addListener(fe.GET_RTC_STATS,this.handleGetRTCStats),a.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(fe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.addListener(fe.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.addListener(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.bindLocalAudioTrackEvents(a)}})}bindLocalAudioTrackEvents(n,r){n instanceof wn?n.trackList.forEach(a=>{a.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(fe.GET_STATS,this.handleGetLocalAudioStats),a.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.addListener(fe.GET_STATS,this.handleGetLocalAudioStats),n.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||n.addListener(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(n){n||(n=Array.from(this.localTrackMap.entries()).map(r=>{let[a,{track:l}]=r;return{track:l,type:a}})),n.forEach(r=>{let{track:a,type:l}=r;switch(l){case ne.LocalVideoTrack:a.off(fe.GET_STATS,this.handleGetLocalVideoStats),a.off(fe.GET_RTC_STATS,this.handleGetRTCStats),a.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.off(fe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.off(fe.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.off(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.unbindLocalAudioTrackEvents(a)}})}unbindLocalAudioTrackEvents(n){n instanceof wn?n.trackList.forEach(r=>{r.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(fe.GET_STATS,this.handleGetLocalAudioStats),r.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.off(fe.GET_STATS,this.handleGetLocalAudioStats),n.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(n,r){r instanceof Cs&&r.addListener(fe.GET_STATS,a=>{a(this.handleGetRemoteVideoStats(n))}),r instanceof Co&&r.addListener(fe.GET_STATS,a=>{a(this.handleGetRemoteAudioStats(n))})}unbindRemoteTrackEvents(n){n&&n.removeAllListeners(fe.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r,a]=n;a.has(ge.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),a.has(ge.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(n,r){return n.map((a,l)=>{var d;let h,p,{track:m,type:_}=a;switch(_){case ne.LocalAudioTrack:h=It.Audio,p={dtx:m instanceof Td&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ne.LocalVideoTrack:h=ye(d=m._hints).call(d,Ot.SCREEN_TRACK)?It.Screen:It.High,p=Kd(Kd({},Bd(m)),{},{codec:this.store.codec});break;case ne.LocalVideoLowTrack:h=It.Low,p=Kd(Kd({},Bd(m)),{},{codec:this.store.codec})}return{stream_type:h,attributes:p,ssrcs:r[l]}})}createGatewayUnpublishMessage(n){return n.map(r=>{var a;let l,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case ne.LocalVideoTrack:l=ye(a=h._hints).call(a,Ot.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalAudioTrack:l=It.Audio;break;case ne.LocalVideoLowTrack:l=It.Low}return{stream_type:l,ssrcs:p,mid:m}})}assignLocalTracks(n,r){n.forEach((a,l)=>{let{track:d,type:h}=a;this.localTrackMap.set(h,{track:d,id:r[l].id,ssrcs:r[l].localSSRC})})}withdrawLocalTracks(n){n.forEach(r=>{let[a]=r;this.localTrackMap.delete(a)})}bindConnectionEvents(n){var r=this;n.onConnectionStateChange=function(){var a=x(function*(l){if(w.info("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(l,")")),r.emit(we.PeerConnectionStateChange,l),"connected"!==l||r.store.keyMetrics.peerConnectionEnd||r.store.peerConnectionEnd(),"connected"===l&&(r._restartTimer&&(clearTimeout(r._restartTimer),r._restartTimer=void 0),(r._isFirstConnected||r._isInRestartIce)&&r.reportPCStats(Date.now(),!0,r._pcStatsUploadType),r._isInRestartIce=!1,r._isFirstConnected=!1,r._isStartRestartIce=!1),j("NEW_ICE_RESTART")){var d;if(ye(d=r._restartStates).call(d,l)){if(r._isStartRestartIce)return;r._isStartRestartIce=!0;const h=_=>{("disconnected"===n.iceConnectionState||"checking"===n.iceConnectionState||"failed"===n.iceConnectionState)&&(w.debug("[".concat(r.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(_)),"CONNECTED"===_r(r,we.QueryClientConnectionState)&&r.emit(we.RequestRestartICE,_))},p=()=>{"disconnected"!==n.iceConnectionState&&"checking"!==n.iceConnectionState&&"failed"!==n.iceConnectionState||(r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),w.debug("[".concat(r.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>r.emit(we.P2PLost),0),r.iceFailedCount+=1,r.requestReconnect())},m=j("ICE_RESTART_INTERVAL");return void(r._restartTimer=window.setTimeout(()=>{if(j("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&$e().supportPCSetConfiguration)h(wi.RELAY),r._restartTimer=window.setTimeout(p,m);else if(zt())h(wi.UDP),r._restartTimer=window.setTimeout(p,4e3);else{if(h(wi.TCP),$e().supportPCSetConfiguration)return void(r._restartTimer=window.setTimeout(()=>{h(wi.RELAY),r._restartTimer=window.setTimeout(p,m)},m));r._restartTimer=window.setTimeout(p,m)}},800))}}else{if("disconnected"===l&&"disconnected"===n.iceConnectionState)return setTimeout(()=>{"disconnected"===n.iceConnectionState&&j("ICE_RESTART")&&"CONNECTED"===_r(r,we.QueryClientConnectionState)&&r.emit(we.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===n.peerConnectionState&&(w.debug("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),r._isInRestartIce=!1,setTimeout(()=>r.emit(we.P2PLost),0),r.iceFailedCount+=1,r.requestReconnect())},4e3);"failed"===l&&(w.debug("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection state failed, force reconnect")),r.reportPCDisconnectedOrFailed(),setTimeout(()=>r.emit(we.P2PLost),0),r.iceFailedCount+=1,yield r.requestReconnect())}});return function(l){return a.apply(this,arguments)}}(),n.onICEConnectionStateChange=a=>{"connected"!==a||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(a,")")),Se.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:a,tag:Jt.TRACER}).onSuccess(),this.emit(we.IceConnectionStateChange,a)},n.onICETransportStateChange=a=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(a,")"))},n.onDTLSTransportStateChange=a=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(a,")"))},n.onDTLSTransportError=a=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(a,")"))},n.onFirstAudioDecoded=a=>{var l;const d=Array.from(Kr(l=this.remoteUserMap).call(l)).find(p=>p._audioSSRC===a);var h;d&&(this.store.subscribe(d.uid,"audio",void 0,void 0,void 0,Date.now()),null===(h=d.audioTrack)||void 0===h||h.emit(yd.FIRST_FRAME_DECODED),Se.firstRemoteFrame(this.store.sessionId,Yn.FIRST_AUDIO_DECODE,Kt.FIRST_AUDIO_DECODE,{peer:d._uintid,subscribeElapse:Di.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId}))},n.onFirstAudioReceived=a=>{var l;const d=Array.from(Kr(l=this.remoteUserMap).call(l)).find(h=>h._audioSSRC===a);d&&Se.firstRemoteFrame(this.store.sessionId,Yn.FIRST_AUDIO_RECEIVED,Kt.FIRST_AUDIO_RECEIVED,{peer:d._uintid,subscribeElapse:Di.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},n.onFirstVideoDecoded=(a,l,d)=>{this.reportVideoFirstFrameDecoded(a,l,d)},n.onFirstVideoReceived=a=>{var l;const d=Array.from(Kr(l=this.remoteUserMap).call(l)).find(h=>h._videoSSRC===a);d&&Se.firstRemoteFrame(this.store.sessionId,Yn.FIRST_VIDEO_RECEIVED,Kt.FIRST_VIDEO_RECEIVED,{peer:d._uintid,subscribeElapse:Di.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},n.onSelectedLocalCandidateChanged=(a,l)=>{const d="relay"===a.candidateType;"unknown"!==l.candidateType&&d===("relay"===l.candidateType)||this.emit(we.ConnectionTypeChange,d),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Al(l))," -> ").concat(JSON.stringify(Al(a)),")"))},n.onSelectedRemoteCandidateChanged=(a,l)=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Al(l))," -> ").concat(JSON.stringify(Al(a)),")"))},n.onFirstVideoDecodedTimeout=a=>{this.reportVideoFirstFrameDecoded(a,void 0,void 0,!0)}}unbindConnectionEvents(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(n){const r=[];if(-1===this.getAllTracks().indexOf(n))return r;const a=this.localTrackMap.get(ne.LocalAudioTrack);if(n instanceof mt&&a?.track instanceof wn)return a.track.isActive||r.push([ne.LocalAudioTrack,a]),r;const l=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(l&&(r.push(l),l[0]===ne.LocalVideoTrack)){const d=this.localTrackMap.get(ne.LocalVideoLowTrack);d&&r.push([ne.LocalVideoLowTrack,d])}return r}filterTobeUnmutedTracks(n){const r=[],a=this.localTrackMap.get(ne.LocalAudioTrack);if(n instanceof mt&&a?.track instanceof wn)return a.track.isActive&&r.push([ne.LocalAudioTrack,a]),r;const l=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(l)if(l[0]===ne.LocalVideoTrack){r.push(l);const d=this.localTrackMap.get(ne.LocalVideoLowTrack);d&&r.push([ne.LocalVideoLowTrack,d])}else r.push(l);return r}createMuteMessage(n){return n.map(r=>{var a;let l,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case ne.LocalAudioTrack:l=It.Audio;break;case ne.LocalVideoTrack:l=ye(a=h._hints).call(a,Ot.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalVideoLowTrack:l=It.Low}return{stream_type:l,ssrcs:p,mid:m}})}createUnmuteMessage(n){return n.map(r=>{var a;let l,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case ne.LocalAudioTrack:l=It.Audio;break;case ne.LocalVideoTrack:l=ye(a=h._hints).call(a,Ot.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalVideoLowTrack:l=It.Low}return{stream_type:l,ssrcs:p,mid:m}})}filterTobeUnSubscribedTracks(n,r){const a=[],l=this.remoteUserMap.get(n);if(!l)return a;if(r){const d=l.get(r);if(!d)return a;a.push([n,{kind:r,id:d}])}else Array.from(l.entries()).forEach(d=>{let[h,p]=d;a.push([n,{kind:h,id:p}])});return a}filterTobeUnSubscribedDataChannels(n,r){const a=[];return r.forEach(l=>{var d;null!==(d=this.remoteDataChannelMap.get(n))&&void 0!==d&&d.has(l.id)&&a.push(l)}),a}createUnsubscribeMessage(n){const r=[];return n.forEach(a=>{let[l,{kind:d}]=a;switch(d){case ge.VIDEO:return void(l._videoSSRC&&r.push({stream_type:ge.VIDEO,ssrcId:l._videoSSRC}));case ge.AUDIO:return void(l._audioSSRC&&r.push({stream_type:ge.AUDIO,ssrcId:l._audioSSRC}))}}),r}createUnsubscribeAllMessage(n){const r=new Map;return n.forEach(a=>{let[l,{kind:d}]=a;if(r.has(l)){let h=r.get(l);h|=d===ge.VIDEO?Pn.Video:Pn.Audio,r.set(l,h)}else r.set(l,d===ge.VIDEO?Pn.Video:Pn.Audio)}),{users:Array.from(r.entries()).map(a=>{let[l,d]=a;return{stream_id:l.uid,stream_type:d}})}}withdrawRemoteTracks(n){n.forEach(r=>{let[a,{kind:l}]=r;const d=this.remoteUserMap.get(a);d&&(d.delete(l),0===Array.from(d.entries()).length&&this.remoteUserMap.delete(a))})}updateBitrateLimit(n){var r=this;return x(function*(){const a=r.localTrackMap.get(ne.LocalVideoTrack),l=r.localTrackMap.get(ne.LocalVideoLowTrack);a&&(yield a.track.setBitrateLimit(n.uplink)),l&&n.low_stream_uplink&&(yield l.track.setBitrateLimit({max_bitrate:n.low_stream_uplink.bitrate,min_bitrate:n.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(n,r){return n.map((a,l)=>{var d;let{stream_type:h}=a;return null===(d=r.find(p=>{let{stream_type:m}=p;return h===m}))||void 0===d?void 0:d.attributes})}tryToUnmuteAudio(n){var r=this;return x(function*(){for(let l=0;l<n.length;l++)if(n[l]instanceof mt){var a;const d=r.filterTobeUnmutedTracks(n[l]);if(0===d.length)continue;yield null===(a=r.connection)||void 0===a?void 0:a.unmuteLocal(d.map(p=>{let[,{id:m}]=p;return m}));const h=r.createUnmuteMessage(d);return void(yield Et(r,we.RequestUnmuteLocal,h))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=n=>{var r;return!(null===(r=this.connection)||void 0===r||!r.getRemoteVideoIsReady(n))},this.statsUploader.requestUpload=(n,r)=>this.emit(we.RequestUploadStats,n,r),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var n=this;return x(function*(){n.dtlsFailedCount+=1,yield gi(wt(n.dtlsFailedCount,Re)),n.emit(we.RequestReconnect)})()}reconnectP2P(){var n=this;return x(function*(){const r=Array.from(n.localTrackMap.entries()),a=n.createGatewayUnpublishMessage(r);Array.from(n.remoteUserMap.entries()),a.length>0&&(yield Qt(n,we.RequestUnpublishForReconnectPC,a)),n.disconnectForReconnect(),n.emit(we.RequestReconnectPC)})()}canPublishLowStream(){return this.localTrackMap.has(ne.LocalVideoTrack)||this.pendingLocalTracks.some(n=>n instanceof ze)}throwIfTrackTypeNotMatch(n){if(n.filter(r=>r instanceof ze).length>1)throw new X(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n.filter(r=>r instanceof mt).length>1&&(n.some(r=>r instanceof mt&&r._bypassWebAudio)||!$e().webAudioMediaStreamDest))throw new X(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of n){if(r instanceof ze&&this.pendingLocalTracks.some(a=>a instanceof ze))throw new X(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof mt&&this.pendingLocalTracks.some(a=>a instanceof mt)&&(!$e().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(a=>a instanceof mt&&a._bypassWebAudio)))throw new X(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(n,r){const a=!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&$e().supportDualStreamEncoding,l=Kd(Kd({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=a?n._mediaStreamTrack.clone():IT(n,l);const h=Fe(8,"track-low-"),p=new ze(d,Kd(Kd({},a&&{scaleResolutionDownBy:XC(l,n)}),{},{frameRate:l.framerate,bitrateMax:l.bitrate,bitrateMin:l.bitrate}),void 0,void 0,h);return p.on(mc.TRANSCEIVER_UPDATED,m=>{n._updateRtpTransceiver(m,fc.LOW_STREAM)}),p._hints.push(Ot.LOW_STREAM),n.addListener(fe.NEED_CLOSE,()=>{p.close()}),p}globalLock(){var n=this;return x(function*(){return n.mutex.lock("From P2PChannel.globalLock")})()}reportPCStats(n,r,a){var l=arguments,d=this;return x(function*(){let h=l.length>3&&void 0!==l[3]?l[3]:null;if(d.connection&&d.connection instanceof Jn){var p,m,_,E;const v=d.store.keyMetrics.descriptionStart||0,{iceConnectionState:b,dtlsTransportState:T,peerConnectionState:O}=d.connection,{local:P,remote:D}=yield d.connection.getSelectedCandidatePair();Se.pcStats(d.store.sessionId,{startTime:v,eventElapse:n-v||0,iceconnectionsate:b,dtlsstate:T,connectionstate:O,intSucc:r?1:2,error:h,selectedLocalCandidateProtocol:null!==(p=P?.protocol)&&void 0!==p?p:"",selectedLocalCandidateType:null!==(m=P.candidateType)&&void 0!==m?m:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:null!==(_=D.protocol)&&void 0!==_?_:"",selectedRemoteCandidateType:null!==(E=D.candidateType)&&void 0!==E?E:"",selectedRemoteCandidateAddress:"".concat(D.address,":").concat(D.port),restartCnt:a})}})()}reportVideoFirstFrameDecoded(n,r,a,l){var d;const h=Array.from(Kr(d=this.remoteUserMap).call(d)).find(p=>p._videoSSRC===n);if(h){l||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const p=this.store.keyMetrics,m=p.subscribe.find(_=>_.userId===h.uid&&"video"===_.type);Se.firstRemoteVideoDecode(this.store.sessionId,Yn.FIRST_VIDEO_DECODE,Kt.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:r,videoheight:a,subscribeElapse:Di.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId,apEnd:p.requestAPEnd||0,apStart:p.requestAPStart||0,joinGwEnd:p.joinGatewayEnd||0,joinGwStart:p.joinGatewayStart||0,pcEnd:p.peerConnectionEnd||0,pcStart:p.peerConnectionStart||0,subscriberEnd:m?.subscribeEnd||0,subscriberStart:m?.subscribeStart||0,videoAddNotify:m?.streamAdded||0,state:l?1:0})}}remoteMediaSsrcChanged(n,r,a){var l=this;return x(function*(){if(!l.connection)return!1;const d=l.remoteUserMap.get(n);if(!d)return!1;const h=d.get(r);if(!h)return!1;const p=yield l.connection.getRemoteSSRC(h);return void 0!==p&&p!==a})()}resetConnection(n){w.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(n)),this.state===it.Connected?(w.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=n===sE.datachannel?new Hn({},this.store):this.isPlanB?new ai({},this.store):new Jn({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(n=>{let[r,{track:a}]=n;r===ne.LocalVideoLowTrack?a._updateRtpTransceiver(void 0,fc.LOW_STREAM):a._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(n){this.connection&&this.connection instanceof Jn&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this.reportPCStats(Date.now(),!1,this._pcStatsUploadType===Xs.TCP_RESTART&&n===wi.RELAY?this._pcStatsUploadType:Xs.DISCONNECTED_OR_FAILED)))}}function Qi(s,n,r){const a=s[n];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const l=this.mutex,d=yield l.lock("From P2PChannel.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{d()}}),r}function JV(s){let n={};e:for(;!C2(s);){let r=Sc(s);switch(r>>>3){case 0:break e;case 1:n.requestId=PT(s,Sc(s));break;case 2:n.requestType=Sc(s)>>>0;break;case 3:n.scorePorn=RN(s);break;case 4:n.scoreSexy=RN(s);break;case 5:n.scoreNeutral=RN(s);break;case 6:n.requestScene=Sc(s)>>>0;break;case 7:n.scene=Sc(s)>>>0;break;default:DT(s,7&r)}}return n}function QV(s,n){let r=s.service;void 0!==r&&(Rt(n,8),Rt(n,r));let a=s.vendor;void 0!==a&&(Rt(n,16),Rt(n,a));let l=s.token;void 0!==l&&(Rt(n,26),bc(n,l));let d=s.callbackUrl;void 0!==d&&(Rt(n,34),bc(n,d))}function ZV(s){let n=Sc(s),r=s.limit;return s.limit=s.offset+n,r}function DT(s,n){switch(n){case 0:for(;128&T2(s););break;case 2:mv(s,Sc(s));break;case 5:mv(s,4);break;case 1:mv(s,8);break;default:throw new Error("Unimplemented type: "+n)}}te([Qi,N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",z)],li.prototype,"startP2PConnection",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",z)],li.prototype,"connect",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",void 0)],li.prototype,"updateRemoteRTPCapabilities",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",z)],li.prototype,"preConnect",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],li.prototype,"publishDataChannel",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],li.prototype,"unpublish",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],li.prototype,"unpublishDataChannel",null),te([Qi,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],li.prototype,"unpublishLowStream",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Oi,Array]),N("design:returntype",z)],li.prototype,"subscribeDataChannel",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Oi,String,Number,Number,Array]),N("design:returntype",z)],li.prototype,"subscribe",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],li.prototype,"massSubscribe",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Oi,String,Boolean]),N("design:returntype",z)],li.prototype,"unsubscribe",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Oi,Array]),N("design:returntype",z)],li.prototype,"unsubscribeDataChannel",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],li.prototype,"massUnsubscribe",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Oi,String]),N("design:returntype",z)],li.prototype,"muteRemote",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Oi,String]),N("design:returntype",z)],li.prototype,"unmuteRemote",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Oi,String]),N("design:returntype",z)],li.prototype,"hasRemoteMediaWithLock",null),te([Qi,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],li.prototype,"disconnectForReconnect",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],li.prototype,"updateBitrateLimit",null),te([Qi,N("design:type",Function),N("design:paramtypes",[Oi,String,Number]),N("design:returntype",z)],li.prototype,"remoteMediaSsrcChanged",null);let y2=new Float32Array(1);new Uint8Array(y2.buffer);let OT=new Float64Array(1),or=new Uint8Array(OT.buffer);function Ha(s){return{low:s|=0,high:s>>31,unsigned:s>=0}}let b2=[];function S2(){const s=b2.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}function IN(s){b2.push(s)}function mv(s,n){if(s.offset+n>s.limit)throw new Error("Skip past limit");s.offset+=n}function C2(s){return s.offset>=s.limit}function tm(s,n){let r=s.bytes,a=s.offset,l=s.limit,d=a+n;if(d>r.length){let h=new Uint8Array(2*d);h.set(r),s.bytes=h}return s.offset=d,d>l&&(s.limit=d),a}function NT(s,n){let r=s.offset;if(r+n>s.limit)throw new Error("Read past limit");return s.offset+=n,r}function PT(s,n){let r=NT(s,n),a=String.fromCharCode,l=s.bytes,d="\ufffd",h="";for(let p=0;p<n;p++){let m,_,E,v,b=l[p+r];128&b?192==(224&b)?p+1>=n?h+=d:(m=l[p+r+1],128!=(192&m)?h+=d:(v=(31&b)<<6|63&m,v<128?h+=d:(h+=a(v),p++))):224==(240&b)?p+2>=n?h+=d:(m=l[p+r+1],_=l[p+r+2],32896!=(49344&(m|_<<8))?h+=d:(v=(15&b)<<12|(63&m)<<6|63&_,v<2048||v>=55296&&v<=57343?h+=d:(h+=a(v),p+=2))):240==(248&b)?p+3>=n?h+=d:(m=l[p+r+1],_=l[p+r+2],E=l[p+r+3],8421504!=(12632256&(m|_<<8|E<<16))?h+=d:(v=(7&b)<<18|(63&m)<<12|(63&_)<<6|63&E,v<65536||v>1114111?h+=d:(v-=65536,h+=a(55296+(v>>10),56320+(1023&v)),p+=3))):h+=d:h+=a(b)}return h}function bc(s,n){let r=n.length,a=0;for(let h=0;h<r;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+n.charCodeAt(++h)-56613888),a+=p<128?1:p<2048?2:p<65536?3:4}Rt(s,a);let l=tm(s,a),d=s.bytes;for(let h=0;h<r;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+n.charCodeAt(++h)-56613888),p<128?d[l++]=p:(p<2048?d[l++]=p>>6&31|192:(p<65536?d[l++]=p>>12&15|224:(d[l++]=p>>18&7|240,d[l++]=p>>12&63|128),d[l++]=p>>6&63|128),d[l++]=63&p|128)}}function e3(s,n){let r=tm(s,n.limit),a=s.bytes,l=n.bytes;for(let d=0,h=n.limit;d<h;d++)a[d+r]=l[d]}function T2(s){return s.bytes[NT(s,1)]}function w2(s,n){let r=tm(s,1);s.bytes[r]=n}function RN(s){let n=NT(s,8),r=s.bytes;return or[0]=r[n++],or[1]=r[n++],or[2]=r[n++],or[3]=r[n++],or[4]=r[n++],or[5]=r[n++],or[6]=r[n++],or[7]=r[n++],OT[0]}function AN(s,n){let r=tm(s,8),a=s.bytes;OT[0]=n,a[r++]=or[0],a[r++]=or[1],a[r++]=or[2],a[r++]=or[3],a[r++]=or[4],a[r++]=or[5],a[r++]=or[6],a[r++]=or[7]}function Sc(s){let n,r=0,a=0;do{n=T2(s),r<32&&(a|=(127&n)<<r),r+=7}while(128&n);return a}function Rt(s,n){for(n>>>=0;n>=128;)w2(s,127&n|128),n>>>=7;w2(s,n)}function Nl(s,n){let r=n.low>>>0,a=(n.low>>>28|n.high<<4)>>>0,l=n.high>>>24,d=0===l?0===a?r<16384?r<128?1:2:r<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:l<128?9:10,h=tm(s,d),p=s.bytes;switch(d){case 10:p[h+9]=l>>>7&1;case 9:p[h+8]=9!==d?128|l:127&l;case 8:p[h+7]=8!==d?a>>>21|128:a>>>21&127;case 7:p[h+6]=7!==d?a>>>14|128:a>>>14&127;case 6:p[h+5]=6!==d?a>>>7|128:a>>>7&127;case 5:p[h+4]=5!==d?128|a:127&a;case 4:p[h+3]=4!==d?r>>>21|128:r>>>21&127;case 3:p[h+2]=3!==d?r>>>14|128:r>>>14&127;case 2:p[h+1]=2!==d?r>>>7|128:r>>>7&127;case 1:p[h]=1!==d?128|r:127&r}}function I2(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}const R2=new Map([["moderation",1],["supervise",2]]);class _v extends qt{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const r=this._connectionState;this._connectionState=n,this.emit(jn.CONNECTION_STATE_CHANGE,r,n)}get inspectType(){return this._inspectType}set inspectType(n){var r;this._inspectMode=al(r=n.map(a=>R2.get(a)||0)).call(r,(a,l)=>a+l),this._inspectType=n}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(n){super(),C(this,"name","AgoraRTCVideoContentInspect"),C(this,"_connectionState",Pr.CONNECTING),C(this,"_innerConnectionState",void 0),C(this,"sequence",0),C(this,"inspectStartTime",void 0),C(this,"workerManagerConnection",void 0),C(this,"workerConnection",void 0),C(this,"workerMessageLengthLimit",void 0),C(this,"inspectIntervalMinimum",void 0),C(this,"qualityRatio",void 0),C(this,"_connectInfo",void 0),C(this,"_cancelTokenSource",Er.CancelToken.source()),C(this,"_retryConfig",void 0),C(this,"wmSequence",0),C(this,"inspectInterval",void 0),C(this,"inspectTimer",null),C(this,"ossFilePrefix",void 0),C(this,"extraInfo",void 0),C(this,"_inspectType",void 0),C(this,"_inspectMode",void 0),C(this,"_quality",1),C(this,"qualityTimer",null),C(this,"_inspectId",void 0),C(this,"_needWorkUrlOnly",!1),C(this,"inspectImage",()=>{if(this.connectionState!==Pr.CONNECTED)throw new W(M.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Pr.CONNECTED?this.requestToInspectImage():w.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Fe(5,"inspect-"),this.workerMessageLengthLimit=j("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=j("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=j("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=n.interval,this.ossFilePrefix=n.ossFilePrefix,this.extraInfo=n.extraInfo,this.inspectType=n.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Of("worker-manager-"+this._inspectId,Re),this.on(jn.STATE_CHANGE,(r,a)=>{this._innerConnectionState=r,w.debug("[".concat(this._inspectId,"] Inspect operation :").concat(bo[r]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Of("worker-"+this._inspectId,Re),this.handleWorkerEvents()}init(n,r){var a=this;return x(function*(){a.emit(jn.STATE_CHANGE,bo.CONNECT_AP),a._connectInfo=n;const l=a._cancelTokenSource.token;return a._retryConfig=r,new z((d,h)=>{a.on(jn.CONNECTION_STATE_CHANGE,(p,m)=>{m===Pr.CONNECTED&&d()}),a.requestAP(n,l,r).then(p=>{a.connectWorkerManager(p)}).catch(p=>{h(p)})})})()}requestAP(n,r,a){var l=this;return x(function*(){const d=j("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),h=yield function(m,_,E,v){let{appId:b,areaCode:T,cname:O,sid:P,token:D,uid:L}=_;Ph++;const V="image_moderation_api",U={service_name:V,json_body:JSON.stringify({appId:b,areaCode:T,cname:O,command:"allocateEdge",requestId:Ph,seq:Ph,sid:P,token:D,ts:Date.now(),uid:L+""})};let J,se,q=m[0];return gs(x(function*(){J=Date.now();const Q=yield xt(q,{data:U,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(se=Date.now()-J,0!==Q.code){const Ee=new W(M.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Q.code,{retry:!0,responseTime:se});throw w.error(Ee.toString()),Ee}const $=JSON.parse(Q.json_body);if(200!==$.code){const Ee=new W(M.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat($.code,", reason: ").concat($.reason),{code:$.code,responseTime:se});throw w.error(Ee.toString()),Ee}if(!$.servers||!Array.isArray($.servers)||0===$.servers.length){const Ee=new W(M.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:$.code,responseTime:se});throw w.error(Ee.toString()),Ee}const Y=j("VIDEO_INSPECT_WORKER_MANAGER_HOST"),me=j("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:$.servers.map(Ee=>{let{address:Ze,wss:yt}=Ee;if(Ze&&yt)return"wss://".concat(Ze.replace(/\./g,"-"),".").concat(Y,":").concat(me||yt)}).filter(Ee=>!!Ee),workerToken:$.workerToken,vid:$.vid,responseTime:se}}),(Q,$)=>(Se.apworkerEvent(P,{success:!0,sc:200,serviceName:V,responseDetail:JSON.stringify(Q.addressList),firstSuccess:0===$,responseTime:se,serverIp:m[$%m.length]}),!1),(Q,$)=>(Se.apworkerEvent(P,{success:!1,sc:Q.data&&Q.data.code||200,serviceName:V,responseTime:se,serverIp:m[$%m.length]}),!!(Q.code!==M.OPERATION_ABORTED&&Q.code!==M.UNEXPECTED_RESPONSE||Q.data&&Q.data.retry)&&(q=m[($+1)%m.length],!0)),v)}(d,n,r,a);l.emit(jn.STATE_CHANGE,bo.AP_CONNECTED);const{addressList:p}=h;return l.wmSequence++,p})()}connectWorkerManager(n){var r=arguments,a=this;return x(function*(){a._needWorkUrlOnly=r.length>1&&void 0!==r[1]&&r[1],a.emit(jn.STATE_CHANGE,bo.CONNECT_WORKER_MANAGER),yield a.workerManagerConnection.init(n,1e4)})()}connectWorker(n){var r=this;return x(function*(){yield r.workerConnection.init([n])})()}handleWorkerManagerEvents(){var n=this;this.workerManagerConnection.on(xe.CONNECTED,x(function*(){n.emit(jn.STATE_CHANGE,bo.WORKER_MANAGER_CONNECTED,n.workerManagerConnection.url),n.workerManagerConnection.sendMessage({appId:n._connectInfo.appId,cname:n._connectInfo.cname,uid:n._connectInfo.uid+"",sdkVersion:"4.19.2",sid:n._connectInfo.sid,seq:n.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(xe.CLOSED,()=>{this._innerConnectionState<bo.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(xe.FAILED,()=>{this._innerConnectionState<bo.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(xe.RECONNECTING,()=>{this._innerConnectionState<bo.GET_WORKER_MANAGER_RESPONSE&&w.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(xe.ON_MESSAGE,function(){var r=x(function*(a){n.emit(jn.STATE_CHANGE,bo.GET_WORKER_MANAGER_RESPONSE);const l=n.workerManagerConnection.url;n.workerManagerConnection.close();const d=JSON.parse(a.data);if(200!==d.code)throw w.error("[".concat(n._inspectId,"] Unexpected code ").concat(d.code," from worker manager")),new W(M.UNEXPECTED_RESPONSE,"response code of worker is unexpected",d);if(!(d.serverResponse&&d.serverResponse.portWss&&l))throw w.error("[".concat(n._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(d))),new W(M.UNEXPECTED_RESPONSE,"response content of worker is unexpected",d);{const h=j("VIDEO_INSPECT_WORKER_PORT")||d.serverResponse.portWss,p=l.replace(/:\d+\/?$/,":".concat(h));n.emit(jn.STATE_CHANGE,bo.CONNECT_WORKER,p),n._needWorkUrlOnly?n.emit(jn.REQUEST_NEW_WORKER_URL,p):yield n.connectWorker(p)}});return function(a){return r.apply(this,arguments)}}()),this.workerManagerConnection.on(xe.WILL_RECONNECT,(r,a,l)=>{l(r)}),this.workerManagerConnection.on(xe.REQUEST_NEW_URLS,(r,a)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(a)})}handleWorkerEvents(){var n=this;this.workerConnection.on(xe.CONNECTED,x(function*(){n.emit(jn.STATE_CHANGE,bo.WORKER_CONNECTED,n.workerConnection.url),n.connectionState=Pr.CONNECTED})),this.workerConnection.on(xe.ON_MESSAGE,function(){var r=x(function*(a){if(a.data instanceof ArrayBuffer){const d=function v2(s){return function(r){let a={};e:for(;!C2(r);){let l=Sc(r);switch(l>>>3){case 0:break e;case 1:a.code=Sc(r);break;case 2:a.msg=PT(r,Sc(r));break;case 3:{let d=ZV(r);a.data=JV(r),r.limit=d;break}default:DT(r,7&l)}}return a}({bytes:n=s,offset:0,limit:n.length});var n}(new Uint8Array(a.data));if(j("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&w.debug("[".concat(n._inspectId,"] Response message for worker of inspect content "),JSON.stringify(d)),200===d.code){if(Array.isArray(n.inspectType)&&1===n.inspectType.length&&"supervise"===n.inspectType[0])return void n.emit(jn.INSPECT_RESULT,void 0,void 0);if(d.data&&d.data.scorePorn&&d.data.scoreSexy&&d.data.scoreNeutral){var l;const h={porn:d.data.scorePorn,sexy:d.data.scoreSexy,neutral:d.data.scoreNeutral},p=al(l=Object.keys(h)).call(l,(_,E)=>h[_]>h[E]?_:E,"porn"),m=Object.keys(h).find(_=>_===p);n.emit(jn.INSPECT_RESULT,m)}else n.emit(jn.INSPECT_RESULT,void 0,new W(M.UNEXPECTED_RESPONSE,d.code+"","There is an unexpected data on message"))}else n.emit(jn.INSPECT_RESULT,void 0,new W(M.UNEXPECTED_RESPONSE,d.code+"",d.msg))}else w.error("[".concat(n._inspectId,"] Unexpected message type from worker")),n.emit(jn.INSPECT_RESULT,void 0,new W(M.UNEXPECTED_RESPONSE,"invalid worker message type"))});return function(a){return r.apply(this,arguments)}}()),this.workerConnection.on(xe.CLOSED,()=>{this.connectionState=Pr.CLOSED}),this.workerConnection.on(xe.FAILED,()=>{this.connectionState=Pr.CLOSED}),this.workerConnection.on(xe.RECONNECTING,()=>{this.connectionState=this.connectionState===Pr.CONNECTED?Pr.RECONNECTING:Pr.CONNECTING}),this.workerConnection.on(xe.WILL_RECONNECT,(r,a,l)=>{"recover"===r&&l(r),l("tryNext")}),this.workerConnection.on(xe.REQUEST_NEW_URLS,(r,a)=>{this.workerManagerConnection.close(),this.once(jn.REQUEST_NEW_WORKER_URL,l=>{r([l])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(l=>{this.connectWorkerManager(l,!0)}).catch(l=>{a(l)})})}static intToLong(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}requestToInspectImage(){var n=this;return x(function*(){n.sequence++;const r=_r(n,jn.CLIENT_LOCAL_VIDEO_TRACK),a={appId:n._connectInfo.appId,cname:n._connectInfo.cname,cid:n._connectInfo.cid,sid:n._connectInfo.sid,uid:n._connectInfo.uid,vid:n._connectInfo.vid};if(r){if(!r.isPlaying)return void n.emit(jn.INSPECT_RESULT,void 0,new W(M.INVALID_OPERATION,"Only the track being played can be inspected"));const l=yield n.generateRequestData(r,a);n.workerConnection.sendMessage(l,!0,!0)}else n.emit(jn.INSPECT_RESULT,void 0,new W(M.INVALID_OPERATION,"Only the track being published can be inspected"))})()}generateRequestData(n,r){var a=this;return x(function*(){let{appId:l,cname:d,cid:h,vid:p,sid:m,uid:_}=r;const E=Date.now(),v=yield n.getCurrentFrameImage("image/jpeg",a.quality),b=yield fL(v,l,d),T=a.sequence+"-"+h+"-"+_+"-"+E+"-"+Fe(12,""),O={appId:l,cid:h,cname:d,deviceId:"",elapse:_v.intToLong(Number(E-a.inspectStartTime)),fileSize:b.byteLength,jpgEncryption:2,height:v.height,width:v.width,jpg:b,networkType:6,osType:7,requestId:T,sdkVersion:"4.19.2",sequence:a.sequence,sid:m,timestamp:_v.intToLong(E),uid:_,vid:p,service:a._inspectMode,callbackData:a.extraInfo,ossFilePrefix:a.ossFilePrefix};void 0===a.extraInfo&&delete O.callbackData,void 0===a.ossFilePrefix&&delete O.ossFilePrefix;const P=function XV(s){let n=S2();return function(r,a){let l=r.appId;void 0!==l&&(Rt(a,10),bc(a,l));let d=r.cid;void 0!==d&&(Rt(a,16),Rt(a,d));let h=r.cname;void 0!==h&&(Rt(a,26),bc(a,h));let p=r.deviceId;void 0!==p&&(Rt(a,34),bc(a,p));let m=r.elapse;void 0!==m&&(Rt(a,40),Nl(a,m));let _=r.fileSize;void 0!==_&&(Rt(a,48),Nl(a,Ha(_)));let E=r.height;void 0!==E&&(Rt(a,56),Nl(a,Ha(E)));let v=r.jpg;void 0!==v&&(Rt(a,66),Rt(a,v.length),function(di,ie){let ce=tm(di,ie.length);di.bytes.set(ie,ce)}(a,v));let b=r.networkType;void 0!==b&&(Rt(a,72),Nl(a,Ha(b)));let T=r.osType;void 0!==T&&(Rt(a,80),Nl(a,Ha(T)));let O=r.requestId;void 0!==O&&(Rt(a,90),bc(a,O));let P=r.sdkVersion;void 0!==P&&(Rt(a,98),bc(a,P));let D=r.sequence;void 0!==D&&(Rt(a,104),Nl(a,Ha(D)));let L=r.sid;void 0!==L&&(Rt(a,114),bc(a,L));let V=r.timestamp;void 0!==V&&(Rt(a,120),Nl(a,V));let U=r.uid;void 0!==U&&(Rt(a,128),Rt(a,U));let J=r.vid;void 0!==J&&(Rt(a,136),Rt(a,J));let se=r.width;void 0!==se&&(Rt(a,144),Nl(a,Ha(se)));let q=r.service;void 0!==q&&(Rt(a,152),Rt(a,q));let Q=r.callbackData;void 0!==Q&&(Rt(a,162),bc(a,Q));let $=r.jpgEncryption;void 0!==$&&(Rt(a,168),Rt(a,$));let Y=r.requestType;void 0!==Y&&(Rt(a,176),Rt(a,Y));let me=r.scorePorn;void 0!==me&&(Rt(a,185),AN(a,me));let Ee=r.scoreSexy;void 0!==Ee&&(Rt(a,193),AN(a,Ee));let Ze=r.scoreNeutral;void 0!==Ze&&(Rt(a,201),AN(a,Ze));let yt=r.scene;void 0!==yt&&(Rt(a,208),Rt(a,yt));let xn=r.ossFilePrefix;void 0!==xn&&(Rt(a,218),bc(a,xn));let Ht=r.serviceVendor;if(void 0!==Ht)for(let di of Ht){Rt(a,226);let ie=S2();QV(di,ie),Rt(a,ie.limit),e3(a,ie),IN(ie)}}(s,n),function(r){let a=r.bytes,l=r.limit;return a.length===l?a:a.subarray(0,l)}(n)}(O);if(P.byteLength<a.workerMessageLengthLimit){if(j("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const D=function(L){for(var V=1;V<arguments.length;V++){var U=null!=arguments[V]?arguments[V]:{};V%2?I2(Object(U),!0).forEach(function(J){C(L,J,U[J])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(U)):I2(Object(U)).forEach(function(J){Object.defineProperty(L,J,Object.getOwnPropertyDescriptor(U,J))})}return L}({},O);delete D.jpg,w.debug("[".concat(a._inspectId,"] Request message for worker of inspect content "),JSON.stringify(D))}return P}return a.quality=a.quality*a.qualityRatio,yield a.generateRequestData(n,{appId:l,cname:d,cid:h,vid:p,sid:m,uid:_})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Er.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Pr.CLOSED,this.emit(jn.STATE_CHANGE,bo.CLOSED)}}function r3(s,n){switch(n){case 0:for(;128&Os(s););break;case 2:DN(s,Cc(s));break;case 5:DN(s,4);break;case 1:DN(s,8);break;default:throw new Error("Unimplemented type: "+n)}}function nm(s){return{low:s|=0,high:s>>31,unsigned:s>=0}}let o3=[];function DN(s,n){if(s.offset+n>s.limit)throw new Error("Skip past limit");s.offset+=n}function s3(s){return s.offset>=s.limit}function MT(s,n){let r=s.bytes,a=s.offset,l=s.limit,d=a+n;if(d>r.length){let h=new Uint8Array(2*d);h.set(r),s.bytes=h}return s.offset=d,d>l&&(s.limit=d),a}function A2(s,n){let r=s.offset;if(r+n>s.limit)throw new Error("Read past limit");return s.offset+=n,r}function D2(s,n){let r=MT(s,n.length);s.bytes.set(n,r)}function im(s,n){let r=A2(s,n),a=String.fromCharCode,l=s.bytes,d="\ufffd",h="";for(let p=0;p<n;p++){let m,_,E,v,b=l[p+r];128&b?192==(224&b)?p+1>=n?h+=d:(m=l[p+r+1],128!=(192&m)?h+=d:(v=(31&b)<<6|63&m,v<128?h+=d:(h+=a(v),p++))):224==(240&b)?p+2>=n?h+=d:(m=l[p+r+1],_=l[p+r+2],32896!=(49344&(m|_<<8))?h+=d:(v=(15&b)<<12|(63&m)<<6|63&_,v<2048||v>=55296&&v<=57343?h+=d:(h+=a(v),p+=2))):240==(248&b)?p+3>=n?h+=d:(m=l[p+r+1],_=l[p+r+2],E=l[p+r+3],8421504!=(12632256&(m|_<<8|E<<16))?h+=d:(v=(7&b)<<18|(63&m)<<12|(63&_)<<6|63&E,v<65536||v>1114111?h+=d:(v-=65536,h+=a(55296+(v>>10),56320+(1023&v)),p+=3))):h+=d:h+=a(b)}return h}function Hh(s,n){let r=n.length,a=0;for(let h=0;h<r;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+n.charCodeAt(++h)-56613888),a+=p<128?1:p<2048?2:p<65536?3:4}Rn(s,a);let l=MT(s,a),d=s.bytes;for(let h=0;h<r;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+n.charCodeAt(++h)-56613888),p<128?d[l++]=p:(p<2048?d[l++]=p>>6&31|192:(p<65536?d[l++]=p>>12&15|224:(d[l++]=p>>18&7|240,d[l++]=p>>12&63|128),d[l++]=p>>6&63|128),d[l++]=63&p|128)}}function Os(s){return s.bytes[A2(s,1)]}function gv(s,n){let r=MT(s,1);s.bytes[r]=n}function Cc(s){let n,r=0,a=0;do{n=Os(s),r<32&&(a|=(127&n)<<r),r+=7}while(128&n);return a}function Rn(s,n){for(n>>>=0;n>=128;)gv(s,127&n|128),n>>>=7;gv(s,n)}function Ev(s,n){let r,a=0,l=0,d=0;return r=Os(s),a=127&r,128&r&&(r=Os(s),a|=(127&r)<<7,128&r&&(r=Os(s),a|=(127&r)<<14,128&r&&(r=Os(s),a|=(127&r)<<21,128&r&&(r=Os(s),l=127&r,128&r&&(r=Os(s),l|=(127&r)<<7,128&r&&(r=Os(s),l|=(127&r)<<14,128&r&&(r=Os(s),l|=(127&r)<<21,128&r&&(r=Os(s),d=127&r,128&r&&(r=Os(s),d|=(127&r)<<7))))))))),{low:a|l<<28,high:l>>>4|d<<24,unsigned:n}}function Pl(s,n){let r=n.low>>>0,a=(n.low>>>28|n.high<<4)>>>0,l=n.high>>>24,d=0===l?0===a?r<16384?r<128?1:2:r<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:l<128?9:10,h=MT(s,d),p=s.bytes;switch(d){case 10:p[h+9]=l>>>7&1;case 9:p[h+8]=9!==d?128|l:127&l;case 8:p[h+7]=8!==d?a>>>21|128:a>>>21&127;case 7:p[h+6]=7!==d?a>>>14|128:a>>>14&127;case 6:p[h+5]=6!==d?a>>>7|128:a>>>7&127;case 5:p[h+4]=5!==d?128|a:127&a;case 4:p[h+3]=4!==d?r>>>21|128:r>>>21&127;case 3:p[h+2]=3!==d?r>>>14|128:r>>>14&127;case 2:p[h+1]=2!==d?r>>>7|128:r>>>7&127;case 1:p[h]=1!==d?128|r:127&r}}const ON={},NN={},Gh=4294967296,xT=Gh*Gh,kT=xT/2,rm=MN(0,!0),LT=MN(0),FT=Wh(0,-2147483648,!1),UT=Wh(-1,2147483647,!1),PN=Wh(-1,-1,!0);function MN(s,n){let r,a,l;return n?(l=0<=(s>>>=0)&&s<256)&&(a=NN[s],a)?a:(r=Wh(s,0,!0),l&&(NN[s]=r),r):(l=-128<=(s|=0)&&s<128)&&(a=ON[s],a)?a:(r=Wh(s,s<0?-1:0,!1),l&&(ON[s]=r),r)}function Wh(s,n,r){return{low:0|s,high:0|n,unsigned:!!r}}function O2(s,n){if(isNaN(s))return n?rm:LT;if(n){if(s<0)return rm;if(s>=xT)return PN}else{if(s<=-kT)return FT;if(s+1>=kT)return UT}return s<0?n?rm:LT:Wh(s%Gh|0,s/Gh|0,n)}function xN(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}class VT extends qt{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const r=this._connectionState;this._connectionState=n,this.emit(Jo.CONNECTION_STATE_CHANGE,n,r)}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(n){var r;super(),C(this,"name","AgoraRTCImageModeration"),C(this,"_connectionState",Mr.CONNECTING),C(this,"_sequence",0),C(this,"_moderationStartTime",void 0),C(this,"_workerConnection",void 0),C(this,"_workerMessageLengthLimit",void 0),C(this,"_qualityRatio",void 0),C(this,"_connectInfo",void 0),C(this,"_cancelTokenSource",Er.CancelToken.source()),C(this,"_retryConfig",void 0),C(this,"_moderationInterval",void 0),C(this,"_moderationTimer",null),C(this,"_moderationMode",1),C(this,"_quality",1),C(this,"_qualityTimer",null),C(this,"_ticket",void 0),C(this,"_moderationIntervalMinimum",void 0),C(this,"_uploadFailedNum",0),C(this,"_uploadNum",0),C(this,"_uploadTimer",null),C(this,"_moderationId",void 0),C(this,"inspectImage",()=>{if(this.connectionState!==Mr.CONNECTED)throw new W(M.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Mr.CONNECTED?this.requestToInspectImage():w.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Fe(5,"image-moderation-"),this._workerMessageLengthLimit=j("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=j("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(r=n.interval)&&void 0!==r?r:1e3,this._qualityRatio=j("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Of("worker-"+this._moderationId,Re),this.on(Jo.STATE_CHANGE,(a,l)=>{w.debug("[".concat(this._moderationId,"] Moderation operation :").concat(vd[a]," ").concat(l||""))}),this.handleWorkerEvents()}init(n,r){var a=this;return x(function*(){a.emit(Jo.STATE_CHANGE,vd.CONNECT_AP),a._connectInfo=n;const l=a._cancelTokenSource.token;return a._retryConfig=r,new z((d,h)=>{a.on(Jo.CONNECTION_STATE_CHANGE,(p,m)=>{p===Mr.CONNECTED&&d()}),a.requestAP(n,l,r).then(p=>{a.connectWorker(p)}).catch(p=>{h(p)})})})()}updateConfig(n){var r;this._moderationInterval=null!==(r=n.interval)&&void 0!==r?r:1e3,w.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(n))),this.connectionState===Mr.CONNECTED&&this.inspectImage()}requestAP(n,r,a){var l=this;return x(function*(){const d=j("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),h=yield function(_,E,v,b){let{appId:T,areaCode:O,cname:P,sid:D,token:L,uid:V}=E;Ph++;const U="moderation_plugin",J={service_name:U,json_body:JSON.stringify({appId:T,areaCode:O,cname:P,command:"allocateEdge",requestId:Ph,seq:Ph,sid:D,appToken:L,ts:Date.now(),uid:V+""})};let se,q,Q=_[0];return gs(x(function*(){se=Date.now();const $=yield xt(Q,{data:J,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(q=Date.now()-se,0!==$.code){const Ee=new W(M.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+$.code,{retry:!0,responseTime:q});throw w.error(Ee.toString()),Ee}const Y=JSON.parse($.json_body);if(200!==Y.code){const Ee=new W(M.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Y.code,", reason: ").concat(Y.reason),{code:Y.code,responseTime:q});throw w.error(Ee.toString()),Ee}if(!Y.servers||!Array.isArray(Y.servers)||0===Y.servers.length){const Ee=new W(M.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Y.code,responseTime:q});throw w.error(Ee.toString()),Ee}if(!Y.servers.some(Ee=>!!Ee.wss)){const Ee=new W(M.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Y.code,responseTime:q});throw w.error(Ee.toString()),Ee}const me=j("IMAGE_MODERATION_WORKER_HOST");return{addressList:Y.servers.map(Ee=>{let{address:Ze,wss:yt}=Ee;if(Ze&&yt)return"wss://".concat(Ze.replace(/\./g,"-"),".").concat(me,":").concat(yt,"/moderation")}).filter(Ee=>!!Ee),workerToken:Y.workerToken,vid:Y.vid,ticket:Y.appTicket,responseTime:q}}),($,Y)=>(Se.apworkerEvent(D,{success:!0,sc:200,serviceName:U,responseDetail:JSON.stringify($.addressList),firstSuccess:0===Y,responseTime:q,serverIp:_[Y%_.length]}),!1),($,Y)=>(Se.apworkerEvent(D,{success:!1,sc:$.data&&$.data.code||200,serviceName:U,responseTime:q,serverIp:_[Y%_.length]}),!!($.code!==M.OPERATION_ABORTED&&$.code!==M.UNEXPECTED_RESPONSE||$.data&&$.data.retry)&&(Q=_[(Y+1)%_.length],!0)),b)}(d,n,r,a);l.emit(Jo.STATE_CHANGE,vd.AP_CONNECTED);const{addressList:p,ticket:m}=h;return l._ticket=m,p})()}connectWorker(n){var r=this;return x(function*(){r.emit(Jo.STATE_CHANGE,vd.CONNECT_WORKER),yield r._workerConnection.init(n,1e4)})()}handleWorkerEvents(){var n=this;this._workerConnection.on(xe.CONNECTED,x(function*(){n.emit(Jo.STATE_CHANGE,vd.WORKER_CONNECTED,n._workerConnection.url),n.connectionState=Mr.CONNECTED})),this._workerConnection.on(xe.CLOSED,()=>{this.connectionState=Mr.CLOSED}),this._workerConnection.on(xe.FAILED,()=>{this.connectionState=Mr.CLOSED}),this._workerConnection.on(xe.RECONNECTING,()=>{this.connectionState=this.connectionState===Mr.CONNECTED?Mr.RECONNECTING:Mr.CONNECTING}),this._workerConnection.on(xe.ON_MESSAGE,function(){var r=x(function*(a){if(a.data instanceof ArrayBuffer){const l=function n3(s){return function(r){let a={};e:for(;!s3(r);){let l=Cc(r);switch(l>>>3){case 0:break e;case 1:a.code=Cc(r);break;case 2:a.msg=im(r,Cc(r));break;case 3:a.requestId=im(r,Cc(r));break;case 4:a.timestamp=Ev(r,!1);break;default:r3(r,7&l)}}return a}({bytes:n=s,offset:0,limit:n.length});var n}(new Uint8Array(a.data));j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("[".concat(n._moderationId,"] Response message for worker of image moderation "),JSON.stringify(l)),n._uploadNum++,void 0===l.code||0===l.code||(n._uploadFailedNum++,w.error("[".concat(n._moderationId,"] Error response from worke, code is ").concat(l.code,", msg is ").concat(l.msg)),n._uploadTimer||(n._uploadTimer=window.setTimeout(()=>{Se.reportApiInvoke(n._connectInfo.sid||null,{name:Nn.IMAGE_MODERATION_UPLOAD,options:[n._uploadFailedNum,n._uploadNum,l.code],tag:Jt.TRACER}).onError(new W(M.IMAGE_MODERATION_UPLOAD_FAILED,l.msg)),n._uploadTimer=null},j("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else w.error("[".concat(n._moderationId,"] Unexpected message type from worker"))});return function(a){return r.apply(this,arguments)}}()),this._workerConnection.on(xe.WILL_RECONNECT,(r,a,l)=>{"recover"===r&&l(r),l("tryNext")}),this._workerConnection.on(xe.REQUEST_NEW_URLS,(r,a)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(a)})}static intToLong(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}requestToInspectImage(){var n=this;return x(function*(){const r=_r(n,Jo.CLIENT_LOCAL_VIDEO_TRACK),a={appId:n._connectInfo.appId,cname:n._connectInfo.cname,cid:n._connectInfo.cid,sid:n._connectInfo.sid,uid:n._connectInfo.uid,vid:n._connectInfo.vid};if(r){if(!r.isPlaying)return void(j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("Only the track being played can be inspected"));n._sequence++;const l=yield n.generateRequestData(r,a);n._workerConnection.sendMessage(l,!0,!0)}else j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&w.debug("Only the track being published can be inspected")})()}generateRequestData(n,r){var a=this;return x(function*(){let{appId:l,cname:d,cid:h,vid:p,sid:m,uid:_}=r;const E=Date.now(),v=yield n.getCurrentFrameImage("image/jpeg",a.quality),b=yield fL(v,l,d),T=a._sequence+"-"+h+"-"+_+"-"+E+"-"+Fe(12,""),O={appId:l,cid:h,cname:d,deviceId:"",elapse:VT.intToLong(Number(E-a._moderationStartTime)),fileSize:v.buffer.byteLength,height:v.height,width:v.width,jpg:b,networkType:6,osType:7,requestId:T,sdkVersion:"4.19.2",sequence:a._sequence,sid:m,timestamp:O2(E),uid:_,vid:p,service:a._moderationMode,ticket:a._ticket},P=function t3(s){let n=function(){const r=o3.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r,a){let l=r.appId;void 0!==l&&(Rn(a,10),Hh(a,l));let d=r.cid;void 0!==d&&(Rn(a,16),Rn(a,d));let h=r.cname;void 0!==h&&(Rn(a,26),Hh(a,h));let p=r.deviceId;void 0!==p&&(Rn(a,34),Hh(a,p));let m=r.elapse;void 0!==m&&(Rn(a,40),Pl(a,m));let _=r.fileSize;void 0!==_&&(Rn(a,48),Pl(a,nm(_)));let E=r.height;void 0!==E&&(Rn(a,56),Pl(a,nm(E)));let v=r.jpg;void 0!==v&&(Rn(a,66),Rn(a,v.length),D2(a,v));let b=r.networkType;void 0!==b&&(Rn(a,72),Pl(a,nm(b)));let T=r.osType;void 0!==T&&(Rn(a,80),Pl(a,nm(T)));let O=r.requestId;void 0!==O&&(Rn(a,90),Hh(a,O));let P=r.sdkVersion;void 0!==P&&(Rn(a,98),Hh(a,P));let D=r.sequence;void 0!==D&&(Rn(a,104),Pl(a,nm(D)));let L=r.sid;void 0!==L&&(Rn(a,114),Hh(a,L));let V=r.timestamp;void 0!==V&&(Rn(a,120),Pl(a,V));let U=r.uid;void 0!==U&&(Rn(a,128),Rn(a,U));let J=r.vid;void 0!==J&&(Rn(a,136),Rn(a,J));let se=r.width;void 0!==se&&(Rn(a,144),Pl(a,nm(se)));let q=r.service;void 0!==q&&(Rn(a,152),Rn(a,q));let Q=r.callbackData;void 0!==Q&&(Rn(a,162),Rn(a,Q.length),D2(a,Q));let $=r.ticket;void 0!==$&&(Rn(a,170),Hh(a,$))}(s,n),function(r){let a=r.bytes,l=r.limit;return a.length===l?a:a.subarray(0,l)}(n)}(O);if(P.byteLength<a._workerMessageLengthLimit){if(j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const D=function(L){for(var V=1;V<arguments.length;V++){var U=null!=arguments[V]?arguments[V]:{};V%2?xN(Object(U),!0).forEach(function(J){C(L,J,U[J])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(U)):xN(Object(U)).forEach(function(J){Object.defineProperty(L,J,Object.getOwnPropertyDescriptor(U,J))})}return L}({},O);delete D.jpg,w.debug("[".concat(a._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(D))}return P}return a.quality=a.quality*a._qualityRatio,yield a.generateRequestData(n,{appId:l,cname:d,cid:h,vid:p,sid:m,uid:_})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Er.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Mr.CLOSED,this.emit(Jo.STATE_CHANGE,vd.CLOSED)}}function kN(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function om(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?kN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):kN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class Wi extends JS{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,r;return null!==(n=null===(r=this.peerConnection.getReceivers()[0])||void 0===r||null===(r=r.transport)||void 0===r?void 0:r.state)&&void 0!==n?n:null}constructor(n,r,a){super(n,r),C(this,"direction",void 0),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"transportEventReceiver",void 0),C(this,"statsFilter",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"mutex",new Zn("P2PConnection-mutex")),C(this,"dataChannel",void 0),C(this,"onLocalCandidate",void 0),this.store=r,this.peerConnection=new RTCPeerConnection(Wi.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.direction=a??gd.SEND_ONLY,this.dataChannel=this.peerConnection.createDataChannel("agora-p2p-signal",{ordered:!0}),this.statsFilter=uv(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,zt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}establish(n){var r=this;return x(function*(){try{if(n){yield r.peerConnection.setRemoteDescription({type:"offer",sdp:n});const a=yield r.peerConnection.createAnswer();if(yield r.peerConnection.setLocalDescription(a),!a.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");return a.sdp}{const a=yield r.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");return yield r.peerConnection.setLocalDescription(a),a.sdp}}catch(a){throw new X(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}})()}connect(n){var r=this;return x(function*(){try{yield r.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(a){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(a.toString()))}})()}addRemoteCandidate(n){var r=this;return x(function*(){try{yield r.peerConnection.addIceCandidate(n)}catch(a){throw new X(M.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(a.toString()))}})()}send(n){var r=this;return x(function*(){try{const a=[];n.forEach(h=>{const p=r.peerConnection.addTransceiver(h._mediaStreamTrack,{direction:"sendonly"});a.push(p)}),zt()&&!0===j("SIMULCAST")&&(yield r.applySimulcastForFirefox(a,n)),yield r.applySimulcastEncodings(a,n),yield r.applySendEncodings(a,n);const l=yield r.peerConnection.createOffer();if(yield r.peerConnection.setLocalDescription(l),!l.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");const d=a.map(h=>{const p=r.getLocalSSRC(h.mid,l.sdp);if(!p)throw new Error("Cannot get ssrc when trying to send PeerConnection.");return{mid:h.mid,localSSRC:[{ssrcId:p}]}});return{sdp:l.sdp,trackMessage:d}}catch(a){throw a instanceof X?a:new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}})()}stopSending(n,r){var a=this;return x(function*(){const l=r?void 0:yield a.mutex.lock("From P2PConnection.stopSending");try{const d=a.peerConnection.getTransceivers().filter(p=>-1!==n.indexOf(p.mid));if(d.length!==n.length)throw new Error("Transceivers' length (".concat(d.length,") doesn't match mids' length (").concat(n.length,") when trying to call P2PConnection.stopSending."));d.map(p=>{var m;p.direction="inactive",null===(m=p.stop)||void 0===m||m.call(p),a.peerConnection.removeTrack(p.sender)});const h=yield a.peerConnection.createOffer();if(yield a.peerConnection.setLocalDescription(h),!h.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");return h.sdp}catch(d){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{l&&l()}})()}receive(n,r,a){var l=this;return x(function*(){try{yield l.peerConnection.setRemoteDescription({type:"offer",sdp:r});const d=yield l.peerConnection.createAnswer();if(!d.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");yield l.peerConnection.setLocalDescription(d),w.debug("[".concat(l.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."));const h=l.getRemoteMid(a,r);if(void 0===h)throw new Error("Cannot get transceiver mid when trying to receive track.");const p=l.peerConnection.getTransceivers().find(m=>m.mid===h);if(!p||null===p.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,mid:p.mid,sdp:d.sdp}}catch(d){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}})()}setDescription(n,r){var a=this;return x(function*(){try{if("remote"===n){yield a.peerConnection.setRemoteDescription({type:"offer",sdp:r});const l=yield a.peerConnection.createAnswer();if(!l.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return yield a.peerConnection.setLocalDescription(l),w.debug("[".concat(a.store.clientId,"] [P2PConnection] exchanging SDP, type is ").concat(n)),l.sdp}yield a.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(l){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection.setDescription failed; ".concat(l.toString()))}})()}stopReceiving(n,r){var a=this;return x(function*(){try{const l=a.peerConnection.getTransceivers().filter(h=>-1!==n.indexOf(h.mid));if(l.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");l.map(h=>{var p;h.direction="inactive",null===(p=h.stop)||void 0===p||p.call(h)}),yield a.peerConnection.setRemoteDescription({type:"offer",sdp:r});const d=yield a.peerConnection.createAnswer();if(yield a.peerConnection.setLocalDescription(d),!d.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return d.sdp}catch(l){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(l.toString()))}})()}restartICE(){var n=this;return x(function*(){try{const r=yield n.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");return n.store.descriptionStart(),yield n.peerConnection.setLocalDescription(r),r.sdp}catch(r){throw new X(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}})()}close(){var n;this.peerConnection.close(),null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}updateEncoderConfig(n,r){return x(function*(){})()}updateSendParameters(n,r){var a=this;return x(function*(){const l=a.peerConnection.getTransceivers().filter(d=>d.mid===n);1===l.length&&(a.isVP8Simulcast(r)?zt()||(yield a.applySimulcastEncodings(l,[r])):yield a.applySendEncodings(l,[r]))})()}setStatsRemoteVideoIsReady(n,r){this.statsFilter.setVideoIsReady2(n,r)}replaceTrack(n,r){var a=this;return x(function*(){const l=a.peerConnection.getTransceivers().find(d=>d.mid===r);l&&(yield l.sender.replaceTrack(n._mediaStreamTrack))})()}getSelectedCandidatePair(){var n=this;return x(function*(){const r=n.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const a=r[0].transport.iceTransport,{local:l,remote:d}=a.getSelectedCandidatePair();return{local:om(om({},Ds),{},{candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port}),remote:om(om({},Ds),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return n.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;null===(n=this.onICEConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{var r;n.candidate&&(null===(r=this.onLocalCandidate)||void 0===r||r.call(this,n.candidate)),n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,w.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const r={iceServers:[]};return n.iceServers?r.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(Aa(n.turnServer.servers)?r.iceServers=n.turnServer.servers:(r.iceServers&&r.iceServers.push(...Wi.turnServerConfigToIceServers(n.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&n.turnServer.serversFromGateway&&r.iceServers.push(...Wi.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),j("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),j("ENABLE_ENCODED_TRANSFORM")&&$e().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(n){const r=[];return n.forEach(a=>{a.tcpport&&(r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat($E(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"stun:".concat(a.turnServerURL,":").concat(a.tcpport)}))}),r}tryBindTransportEvents(n){const r=n.transport;if(r){this.transportEventReceiver=n,r.onstatechange=()=>{var l;null!=r&&r.state&&(null===(l=this.onDTLSTransportStateChange)||void 0===l||l.call(this,r.state))},r.onerror=l=>{var d;null===(d=this.onDTLSTransportError)||void 0===d||d.call(this,"error"in l?l.error:l)};const a=r.iceTransport;a&&(a.onstatechange=()=>{const l=r?.iceTransport.state;var d;l&&(null===(d=this.onICETransportStateChange)||void 0===d||d.call(this,l))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:l,remote:d}=a.getSelectedCandidatePair();w.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(n,r){var a=this;return x(function*(){var l;if(r||(r=a.peerConnection.getSenders().find(v=>v.track===n._mediaStreamTrack)),!r)return w.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(a.isVP8Simulcast(n))return w.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!$e().supportSetRtpSenderParameters)return w.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(n._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(n._encoderConfig){var p;const{bitrateMax:v,frameRate:b,scaleResolutionDownBy:T}=n._encoderConfig;v&&(h.maxBitrate=1e3*v),ye(p=n._hints).call(p,Ot.LOW_STREAM)&&(b&&(h.maxFramerate=Sr(b)),T&&T>=1&&(h.scaleResolutionDownBy=T))}if(j("DSCP_TYPE")&&zs()){var m;const v=j("DSCP_TYPE");ye(m=["very-low","low","medium","high"]).call(m,v)&&(h.networkPriority=v)}const _=r.getParameters(),E=null===(l=_.encodings)||void 0===l?void 0:l[0];zt()&&!E&&(d.encodings=[h]),E&&Object.assign(E,h),Object.assign(_,d),w.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),yield r.setParameters(_)})()}applySendEncodings(n,r){var a=this;return x(function*(){try{if(!$e().supportSetRtpSenderParameters||n.length!==r.length)return;for(let l=0;l<n.length;l++){const d=n[l],h=r[l];h instanceof ze&&!a.isVP8Simulcast(h)&&(yield a.updateRtpSenderEncodings(h,d.sender))}}catch{w.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(n,r,a){const l=cn.parse(n);return r.forEach((d,h)=>{const p=a[h],m=l.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(zd(m,d),yT(m,d,this.store.codec))}),cn.print(l)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,r,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,n,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(n,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,n,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,n,r)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(n,r){var a=this;return x(function*(){if(n.length===r.length)for(let _=0;_<n.length;_++){var l,d,h,p,m;const E=n[_],v=r[_];if(v instanceof ze&&!ye(l=v._hints).call(l,Ot.LOW_STREAM)&&null!==(d=v._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=v._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=v._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=v._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===a.store.codec){const b={},T={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const O=E.sender.getParameters();yield E.sender.setParameters(Object.assign(O,b))}}})()}applySimulcastEncodings(n,r){var a=this;return x(function*(){if(!zt()&&n.length===r.length)for(let l=0;l<n.length;l++){const d=r[l];if(d instanceof ze&&a.isVP8Simulcast(d)){const h=n[l],p={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=h.sender.getParameters();yield h.sender.setParameters(Object.assign(_,p))}}})()}isVP8Simulcast(n){var r,a,l,d,h;return!!(n instanceof ze&&j("SIMULCAST")&&"vp8"===this.store.codec&&!ye(r=n._hints).call(r,Ot.LOW_STREAM)&&null!==(a=n._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(l=n._encoderConfig)||void 0===l?void 0:l.bitrateMax)>200&&null!==(d=n._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=n._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,r,a,l){if(j("SDP_LOGGING"))return w.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(r," SDP during P2PConnection.").concat(l,"\n"),n),"offer"===r?d=>{this.logSDPExchange(d,"answer","local"===a?"remote":"local",l)}:void 0}getLocalSSRC(n,r){var a,l;if(r=null!==(a=r)&&void 0!==a?a:null===(l=this.currentLocalDescription)||void 0===l?void 0:l.sdp){var d;const h=null===(d=cn.parse(r).mediaDescriptions.find(p=>p.attributes.mid===n))||void 0===d?void 0:d.attributes.ssrcs;return h?.[0].ssrcId}}getRemoteMid(n,r){var a,l,d;if(r=null!==(a=r)&&void 0!==a?a:null===(l=this.currentRemoteDescription)||void 0===l?void 0:l.sdp)return null===(d=cn.parse(r).mediaDescriptions.find(h=>h.attributes.ssrcs.some(p=>p.ssrcId===n)))||void 0===d?void 0:d.attributes.mid}getRemoteSSRC(n,r){var a=this;return x(function*(){var l,d;if(r=null!==(l=r)&&void 0!==l?l:null===(d=a.currentRemoteDescription)||void 0===d?void 0:d.sdp){var h;const p=null===(h=cn.parse(r).mediaDescriptions.find(m=>m.attributes.mid===n))||void 0===h?void 0:h.attributes.ssrcs;return p?.[0].ssrcId}})()}}function Oo(s,n,r){const a=s[n];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=x(function*(){const l=this.mutex,d=yield l.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{d()}}),r}var ls;function N2(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Tc(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?N2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):N2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}te([Oo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Wi.prototype,"establish",null),te([Oo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Wi.prototype,"connect",null),te([Oo,N("design:type",Function),N("design:paramtypes",[RTCIceCandidate]),N("design:returntype",z)],Wi.prototype,"addRemoteCandidate",null),te([Oo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Wi.prototype,"send",null),te([Oo,N("design:type",Function),N("design:paramtypes",[String,String,Number]),N("design:returntype",z)],Wi.prototype,"receive",null),te([Oo,N("design:type",Function),N("design:paramtypes",[String,String]),N("design:returntype",z)],Wi.prototype,"setDescription",null),te([Oo,N("design:type",Function),N("design:paramtypes",[Array,String]),N("design:returntype",z)],Wi.prototype,"stopReceiving",null),te([Oo,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],Wi.prototype,"restartICE",null),te([Oo,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Wi.prototype,"close",null),te([Oo,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",z)],Wi.prototype,"updateEncoderConfig",null),te([Oo,N("design:type",Function),N("design:paramtypes",[String,Ri]),N("design:returntype",z)],Wi.prototype,"updateSendParameters",null),te([Oo,N("design:type",Function),N("design:paramtypes",[Ri,String]),N("design:returntype",z)],Wi.prototype,"replaceTrack",null),function(s){s.SEND_ONLY="SEND_ONLY",s.RECEIVE_ONLY="RECEIVE_ONLY"}(ls||(ls={}));class ln extends qt{get state(){return this._state}set state(n){const r=this._state;this._state=n,this.emit(we.StateChange,r,this._state)}constructor(n,r){var a;super(),a=this,C(this,"store",void 0),C(this,"statsUploader",void 0),C(this,"sendConnection",void 0),C(this,"recvConnection",void 0),C(this,"localTrackMap",new Map),C(this,"remoteUserMap",new Map),C(this,"localDataChannels",[]),C(this,"pendingLocalTracks",[]),C(this,"pendingRemoteTracks",[]),C(this,"statsCollector",void 0),C(this,"dtlsFailedCount",0),C(this,"sendMutex",new Zn("P2PChannel2-send-mutex")),C(this,"recvMutex",new Zn("P2PChannel2-recv-mutex")),C(this,"_state",it.Disconnected),C(this,"_restartStates",["disconnected","failed"]),C(this,"_restartTimer",void 0),C(this,"handleMuteLocalTrack",function(){var l=x(function*(d,h,p){const m=yield a.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!a.sendConnection||a.state!==it.Connected)return void p(new X(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const v=a.filterTobeMutedTracks(d);if(0===v.length)return void h();const b=v.find(U=>"videoLowTrack"===U[0]);b&&b[1].track._originMediaStreamTrack.stop();let T=!1;var _,E;T="video"===d.trackMediaType?!(null===(_=a.localTrackMap.get(ne.LocalAudioTrack))||void 0===_||!_.track._muted):void 0===(null===(E=a.localTrackMap.get(ne.LocalVideoTrack))||void 0===E?void 0:E.id);const O=v.filter(U=>{let[J,se]=U;return(J!==ne.LocalAudioTrack||T)&&void 0!==se.id}).map(U=>{let[,J]=U;return J});let P;O.length>0&&(P=yield a.sendConnection.stopSending(O.map(U=>U.id)),O.forEach(U=>{U.id=void 0,U.ssrcs=void 0}));const D=a.createMuteMessage(v),L="video"===d.trackMediaType?ys.MUTE_LOCAL_VIDEO:ys.MUTE_LOCAL_AUDIO,V=yield Qt(a,we.RequestP2PMuteLocal,{action:L,sdp:P,message:D,isMuteAll:T});V&&(yield a.sendConnection.setDescription("local",V)),(P||"audio"===d.trackMediaType)&&(yield Et(a,we.RequestMuteLocal,D)),h()}catch(v){p(v)}finally{m()}});return function(d,h,p){return l.apply(this,arguments)}}()),C(this,"handleUnmuteLocalTrack",function(){var l=x(function*(d,h,p){const m=yield a.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!a.sendConnection||a.state!==it.Connected)return void p(new X(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const _=a.filterTobeUnmutedTracks(d);if(0===_.length)return void h();const E=a.createUnmuteMessage(_),v="video"===d.trackMediaType?ys.UNMUTE_LOCAL_VIDEO:ys.UNMUTE_LOCAL_AUDIO;yield Et(a,we.RequestP2PMuteLocal,{action:v,message:E}),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return l.apply(this,arguments)}}()),C(this,"handleUpdateVideoEncoder",function(){var l=x(function*(d,h,p){const m=yield a.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const _=a.localTrackMap.get(ne.LocalVideoTrack);if(!a.sendConnection||!_||_.track!==d||a.state!==it.Connected)return void h();const{id:E,track:v}=_;E&&(yield a.sendConnection.updateSendParameters(E,v),yield a.sendConnection.updateEncoderConfig(E,v),a.emit(we.UpdateVideoEncoder,v)),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return l.apply(this,arguments)}}()),C(this,"handleSetOptimizationMode",function(){var l=x(function*(d,h,p){const m=yield a.sendMutex.lock("Locking from P2PChannel2.handleSetOptimizationMode");try{const _=a.localTrackMap.get(ne.LocalVideoTrack);if(!a.sendConnection||!_||_.track!==d||a.state!==it.Connected)return;const{id:E,track:v}=_;E&&(yield a.sendConnection.updateSendParameters(E,v)),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return l.apply(this,arguments)}}()),C(this,"handleReplaceTrack",function(){var l=x(function*(d,h,p,m){let _;w.debug("[".concat(a.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(d.getTrackId(),"]")),"boolean"==typeof m&&m||(_=yield a.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var E;const b=Array.from(a.localTrackMap.entries()).find(T=>{let[,{track:O}]=T;return d===O});if(!a.sendConnection||!b||void 0===b[1].id||a.state!==it.Connected)return void h();if(yield null===(E=a.sendConnection)||void 0===E?void 0:E.replaceTrack(d,b[1].id),b[0]===ne.LocalVideoTrack&&$e().supportDualStreamEncoding){const T=a.localTrackMap.get(ne.LocalVideoLowTrack);if(T){const O=d._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=O,T.track._originMediaStreamTrack=O,yield new z((P,D)=>{a.handleReplaceTrack(T.track,P,D,!0)})}}h()}catch(b){p(b)}finally{var v;null===(v=_)||void 0===v||v()}});return function(d,h,p,m){return l.apply(this,arguments)}}()),C(this,"handleGetLocalVideoStats",l=>{l(this.statsCollector.getLocalVideoTrackStats())}),C(this,"handleGetLocalAudioStats",l=>{l(this.statsCollector.getLocalAudioTrackStats())}),C(this,"handleGetRemoteVideoStats",l=>this.statsCollector.getRemoteVideoTrackStats(l.uid)[l.uid]),C(this,"handleGetRemoteAudioStats",l=>this.statsCollector.getRemoteAudioTrackStats(l.uid)[l.uid]),this.store=n,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new ci,this.bindStatsUploaderEvents()}startP2PConnection(n,r){return x(function*(){throw new X(M.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")})()}connect(n,r,a,l,d,h){return x(function*(){throw new X(M.NOT_SUPPORTED,"p2p mode does not support connect.")})()}startP2P(n,r){var a=this;return x(function*(){if(a.state=it.New,a.sendConnection&&(w.warning("[".concat(a.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),a.sendConnection.close(),a.unbindConnectionEvents(a.sendConnection)),a.recvConnection&&(w.warning("[".concat(a.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),a.recvConnection.close(),a.unbindConnectionEvents(a.recvConnection)),a.sendConnection=new Wi(n,a.store),a.bindConnectionEvents(a.sendConnection),a.recvConnection=new Wi(n,a.store,gd.RECEIVE_ONLY),a.bindConnectionEvents(a.recvConnection),r){a.store.peerConnectionStart(),yield a.recvConnection.establish(r);const l=yield a.sendConnection.establish(r);return a.statsUploader.startUploadTransportStats(!0),a.statsUploader.startUploadExtensionUsageStats(),a.state=it.Connected,l}return yield a.recvConnection.establish(r),a.sendConnection.establish(r)})()}p2pConnect(n){var r=this;return x(function*(){if(!r.sendConnection||!r.recvConnection)throw new X(M.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.startP2PConnection .");r.store.peerConnectionStart(),yield r.recvConnection.connect(n),yield r.sendConnection.connect(n),r.statsUploader.startUploadTransportStats(),r.statsUploader.startUploadExtensionUsageStats(),r.state=it.Connected})()}addRemoteCandidate(n){var r=this;return x(function*(){if(!r.sendConnection||!r.recvConnection)throw new X(M.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield r.recvConnection.addRemoteCandidate(n),yield r.sendConnection.addRemoteCandidate(n)})()}publish(n,r,a){var l=this;return x(function*(){if(!l.sendConnection||l.state!==it.Connected){l.throwIfTrackTypeNotMatch(n);const p=n.filter(m=>-1===l.pendingLocalTracks.indexOf(m));return void(l.pendingLocalTracks=l.pendingLocalTracks.concat(p))}l.store.pubId=l.store.pubId+1,Di.markPublishStart(l.store.clientId,l.store.pubId);const d=l.filterTobePublishedTracks(n,r,a);if(0===d.length)return void(yield l.tryToUnmuteAudio(n));d.forEach(p=>{let{track:m,type:_}=p;const E=Date.now();l.store.publish(m.getTrackId(),_===ne.LocalAudioTrack?"audio":"video",E)}),l.bindLocalTrackEvents(d);const h=l.createGatewayPublishMessage(d);return l.assignLocalTracks(d),d.forEach(p=>{let{track:m,type:_}=p;const E=Date.now();l.store.publish(m.getTrackId(),_===ne.LocalAudioTrack?"audio":"video",void 0,E)}),h})()}dopublish(n){var r=this;return x(function*(){if(!r.sendConnection||r.state!==it.Connected)return;const a=r.localTrackMap.get(n);if(a){const{sdp:l,trackMessage:d}=yield r.sendConnection.send([a.track]),{mid:h,localSSRC:p}=d[0];a.id=h,a.ssrcs=p,r.statsCollector.addLocalStats(n),r.statsUploader.startUploadUplinkStats();const m=yield Qt(r,we.RequestP2PPublish,{kind:n===ne.LocalAudioTrack?ge.AUDIO:ge.VIDEO,sdp:l,ssrcId:p[0].ssrcId});yield r.sendConnection.setDescription("local",m);const _=r.createUnmuteMessage([[n,a]]);yield Et(r,we.RequestUnmuteLocal,_)}})()}setDescription(n,r){var a=this;return x(function*(){let l,d;"local"===n?(l=yield a.sendMutex.lock("From P2PChannel.restartICE"),d=a.sendConnection):(l=yield a.recvMutex.lock("From P2PChannel.restartICE"),d=a.recvConnection);try{return d&&a.state===it.Connected?yield d.setDescription(n,r):void 0}finally{l()}})()}publishLowStream(n){return cs(function*(){throw new X(M.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}republish(){var n=this;return x(function*(){n.pendingLocalTracks.length>0&&(w.debug("[".concat(n.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield Qt(n,we.RequestRePublish,n.pendingLocalTracks),n.emit(we.MediaReconnectEnd,n.store.uid),n.pendingLocalTracks=[])})()}unpublish(n){var r=this;return x(function*(){if(!r.sendConnection||r.state!==it.Connected)return void(0===n.length?r.pendingLocalTracks.length=0:r.pendingLocalTracks=r.pendingLocalTracks.filter(_=>!ye(n).call(n,_)));const a=r.filterTobeUnpublishedTracks(n);if(0===a.length)return;r.unbindLocalTrackEvents(a.map(_=>{let[E,{track:v}]=_;return{type:E,track:v}}));const l=a.filter(_=>{let[,{id:E}]=_;return void 0!==E});if(!r.sendConnection||r.state!==it.Connected)return void n.forEach(_=>{const E=r.pendingLocalTracks.indexOf(_);-1!==E&&r.pendingLocalTracks.splice(E,1)});const d=a.find(_=>"videoLowTrack"===_[0]);let h;d&&d[1].track.close();const p=r.createGatewayUnpublishMessage(a);l.length>0&&(h=yield r.sendConnection.stopSending(l.map(_=>{let[,{id:E}]=_;return E}))),r.withdrawLocalTracks(a),r.unbindLocalTrackEvents(a.map(_=>{let[E,{track:v}]=_;return{type:E,track:v}})),a.forEach(_=>{let[E]=_;r.statsCollector.removeLocalStats(E)}),0===r.localTrackMap.size&&r.statsUploader.stopUploadUplinkStats();const m=r.createMuteMessage(a);return yield z.all(m.map(function(){var _=x(function*(E){yield Et(r,we.RequestMuteLocal,[E])});return function(E){return _.apply(this,arguments)}}())),{sdp:h,unpubMsg:p}})()}unpublishLowStream(){return x(function*(){throw new X(M.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")})()}doUnpublish(n){var r=this;return x(function*(){if(!r.sendConnection||r.state!==it.Connected)return;const a=[];if(n!==ge.AUDIO){const l=r.localTrackMap.get(ne.LocalVideoTrack);void 0!==l?.id&&a.push([ne.LocalVideoTrack,l]);const d=r.localTrackMap.get(ne.LocalVideoLowTrack);void 0!==d?.id&&a.push([ne.LocalVideoLowTrack,d]),r.statsCollector.removeLocalStats(ne.LocalVideoTrack),r.statsCollector.removeLocalStats(ne.LocalVideoLowTrack)}if(n!==ge.VIDEO){const l=r.localTrackMap.get(ne.LocalAudioTrack);void 0!==l?.id&&a.push([ne.LocalAudioTrack,l]),r.statsCollector.removeLocalStats(ne.LocalAudioTrack)}if(a.length>0){const l=yield r.sendConnection.stopSending(a.map(p=>{let[,m]=p;return m.id}));a.forEach(p=>{let[,m]=p;m.id=void 0,m.ssrcs=void 0});const d=yield Qt(r,we.RequestP2PUnPublish,{sdp:l,kind:n});yield r.sendConnection.setDescription("local",d);const h=r.createMuteMessage(a);yield z.all(h.map(function(){var p=x(function*(m){yield Et(r,we.RequestMuteLocal,[m])});return function(m){return p.apply(this,arguments)}}()))}})()}subscribe(n,r,a,l){var d=this;return x(function*(){var h;if(!d.recvConnection||d.state!==it.Connected)throw new X(M.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(h=d.remoteUserMap.get(n))&&void 0!==h&&h.has(r))return;const{track:p,mid:m,sdp:_}=yield d.recvConnection.receive(r,a,l);r===ge.AUDIO?(n._audioSSRC=l,n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(p):(n._audioTrack=new Co(p,n.uid,n._uintid,d.store),w.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),d.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoSSRC=l,n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(p):(n._videoTrack=new Cs(p,n.uid,n._uintid,d.store),w.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),d.bindRemoteTrackEvents(n,n._videoTrack));const E=d.remoteUserMap.get(n);E?E.set(r,m):d.remoteUserMap.set(n,new Map([[r,m]])),d.statsCollector.addRemoteStats(n.uid),d.statsUploader.startUploadDownlinkStats(),yield Et(d,we.RequestP2PUnmuteRemote,r);const v=d.pendingRemoteTracks.findIndex(b=>{let{user:T,kind:O}=b;return T.uid===n.uid&&r===O});return-1!==v&&(d.pendingRemoteTracks.splice(v,1),d.emit(we.MediaReconnectEnd,n.uid)),_})()}unsubscribe(n,r,a,l){var d=this;return x(function*(){const h=d.pendingRemoteTracks.filter(_=>{let{user:E,kind:v}=_;return void 0!==a?E.uid===n.uid&&a===v:E.uid===n.uid});if(h.forEach(_=>{const E=d.pendingRemoteTracks.indexOf(_);d.pendingRemoteTracks.splice(E,1)}),d.recvConnection&&d.state===it.Connected||l||h.forEach(_=>{let{kind:E}=_;var v;if(E===ge.AUDIO)null===(v=n._audioTrack)||void 0===v||v._destroy(),n._audioTrack=void 0;else if(E===ge.VIDEO){var b;null===(b=n._videoTrack)||void 0===b||b._destroy(),n._videoTrack=void 0}}),!d.recvConnection||d.state!==it.Connected)return;const p=d.filterTobeUnSubscribedTracks(n,a);if(0===p.length)return void(a!==ge.VIDEO&&Et(d,we.RequestP2PMuteRemote,ge.AUDIO));const m=yield d.recvConnection.stopReceiving(p.map(_=>{let[,{id:E}]=_;return E}),r);return d.withdrawRemoteTracks(p),0===d.remoteUserMap.size&&d.statsUploader.stopUploadDownlinkStats(),p.forEach(_=>{let[E,{kind:v}]=_;var b,T;if(v===ge.VIDEO&&E._videoSSRC&&(null===(b=d.recvConnection)||void 0===b||b.setStatsRemoteVideoIsReady(E._videoSSRC,!1)),v===ge.VIDEO)d.unbindRemoteTrackEvents(E._videoTrack),l||(null===(T=E._videoTrack)||void 0===T||T._destroy(),E._videoTrack=void 0);else if(v===ge.AUDIO){var O;d.unbindRemoteTrackEvents(E._audioTrack),!l&&(null===(O=E._audioTrack)||void 0===O||O._destroy(),E._audioTrack=void 0)}}),p.filter(_=>{let[,{kind:E}]=_;return E!==ge.AUDIO}).forEach(_=>{let[,{kind:E}]=_;Et(d,we.RequestP2PMuteRemote,E)}),a!==ge.VIDEO&&Et(d,we.RequestP2PMuteRemote,ge.AUDIO),m})()}getAllDataChannels(){return this.localDataChannels}massSubscribe(n){return x(function*(){throw new X(M.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")})()}massSubscribeNoLock(n){return x(function*(){throw new X(M.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")})()}massUnsubscribe(n){return x(function*(){throw new X(M.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")})()}massUnsubscribeNoLock(n){return x(function*(){throw new X(M.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")})()}muteRemote(n,r){var a=this;return x(function*(){if(!a.recvConnection)return;const l=a.remoteUserMap.get(n);if(!l)return void w.warning("[".concat(a.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(n.uid,"."));if(!l.get(r))return void w.warning("[".concat(a.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(n.uid," media type ").concat(r,"."));const d=r===ge.VIDEO?n._videoSSRC:n._audioSSRC;void 0!==d&&a.recvConnection.setStatsRemoteVideoIsReady(d,!1)})()}unmuteRemote(n,r){var a=this;return x(function*(){return a.unmuteRemoteNoLock(n,r)})()}unmuteRemoteNoLock(n,r){var a=this;return x(function*(){if(!a.recvConnection)return;const l=a.remoteUserMap.get(n);l?l.get(r)||w.warning("[".concat(a.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(n.uid," media type ").concat(r,".")):w.warning("[".concat(a.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(n.uid,"."))})()}getAllTracks(n){const r=this.localTrackMap.get(ne.LocalAudioTrack);if(r?.track instanceof wn){const a=r.track;return Array.from(this.localTrackMap.entries()).filter(l=>{let[d]=l;return d!==ne.LocalAudioTrack}).filter(l=>{let[d]=l;return!(n&&d===ne.LocalVideoLowTrack)}).map(l=>{let[,{track:d}]=l;return d}).concat(a.trackList)}return Array.from(this.localTrackMap.entries()).filter(a=>{let[l]=a;return!(n&&l===ne.LocalVideoLowTrack)}).map(a=>{let[,{track:l}]=a;return l})}reportPublishEvent(n,r,a,l,d){if(n){const p=this.localTrackMap.get(ne.LocalAudioTrack),m=this.localTrackMap.get(l?ne.LocalVideoLowTrack:ne.LocalVideoTrack);Se.publish(this.store.sessionId,{eventElapse:Di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:r,audioName:p?.track.getTrackLabel(),videoName:m?.track.getTrackLabel(),screenshare:-1!==m?.track._hints.indexOf(Ot.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}else{var h;a||(a=[]);const p=a.find(_=>_ instanceof mt),m=l?null===(h=this.localTrackMap.get(ne.LocalVideoTrack))||void 0===h?void 0:h.track:a.find(_=>_ instanceof ze);Se.publish(this.store.sessionId,{eventElapse:Di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:r,audioName:p?.getTrackLabel(),videoName:m?.getTrackLabel(),screenshare:-1!==m?._hints.indexOf(Ot.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}}reportSubscribeEvent(n,r,a,l){const d=l===ge.VIDEO?a._videoSSRC:a._audioSSRC;d&&Se.subscribe(this.store.sessionId,{succ:n,ec:r,video:l===ge.VIDEO,audio:l===ge.AUDIO,peerid:a.uid,subscribeRequestid:l===ge.VIDEO?a._videoSSRC:a._audioSSRC,p2pid:this.store.p2pId,eventElapse:Di.measureFromSubscribeStart(this.store.clientId,d)})}reset(){w.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Zn("P2PChannel2-send-mutex"),this.sendMutex=new Zn("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const n=this.localTrackMap.get(ne.LocalAudioTrack);if(n?.track instanceof wn){if(n.track.trackList.length>0){const r=n.track;n.track.trackList.forEach(a=>{r.removeAudioTrack(a)})}n.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=it.Disconnected}getStats(n){var r,a;return n?null===(a=this.recvConnection)||void 0===a?void 0:a.getStats():null===(r=this.sendConnection)||void 0===r?void 0:r.getStats()}getRemoteVideoIsReady(n){var r;return(null===(r=this.recvConnection)||void 0===r?void 0:r.getRemoteVideoIsReady(n))||!1}getLocalAudioVolume(){const n=this.localTrackMap.get(ne.LocalAudioTrack);if(n)return n.track.getVolumeLevel()}getLocalVideoSize(){const n=this.localTrackMap.get(ne.LocalVideoTrack);if(n)return{width:n.track._videoWidth||0,height:n.track._videoHeight||0}}getEncoderConfig(n){const r=this.localTrackMap.get(n);return r&&r.track instanceof ze||r&&r.track instanceof mt?r.track._encoderConfig:void 0}getLocalMedia(n){return this.localTrackMap.get(n)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(n,r){if(!n)return this.remoteUserMap.size>0;const a=this.remoteUserMap.get(n);return!!a&&(!r||a.has(r))}hasRemoteMediaWithLock(n,r){var a=this;return x(function*(){if(!n)return a.remoteUserMap.size>0;const l=a.remoteUserMap.get(n);return!!l&&(!r||l.has(r))})()}getRemoteMedia(n){var r;const a=Array.from(Kr(r=this.remoteUserMap).call(r)).find(l=>l.uid===n);return a?{audioTrack:a.audioTrack,audioSSRC:a._audioSSRC,videoTrack:a.videoTrack,videoSSRC:a._videoSSRC}:{}}getAudioLevels(){let n=Array.from(this.remoteUserMap.entries()).map(a=>{let[l]=a;return{uid:l.uid,level:l.audioTrack?100*l.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(ne.LocalAudioTrack);return r&&n.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),n=Zc(n).call(n,(a,l)=>a.level-l.level),n}disconnectForReconnect(){var n=this;return x(function*(){n.sendConnection&&n.recvConnection&&(w.debug("[".concat(n.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),n.state=it.Reconnecting,j("KEEP_LAST_FRAME")&&0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(r=>{let[a]=r;var l;a._videoTrack&&a._videoTrack._player&&(null===(l=a._videoTrack._player.getVideoElement())||void 0===l||l.pause(),a._videoTrack._player.isKeepLastFrame=!0,a._videoTrack._originMediaStreamTrack.stop())}),n.sendConnection.close(),n.unbindConnectionEvents(n.sendConnection),n.sendConnection=void 0,n.recvConnection.close(),n.unbindConnectionEvents(n.recvConnection),n.recvConnection=void 0,0!==n.localTrackMap.size&&(Array.from(n.localTrackMap.entries()).forEach(r=>{var a;let[l,{track:d}]=r;switch(l){case ne.LocalVideoTrack:ye(a=d._hints).call(a,Ot.LOW_STREAM)?d.close():n.pendingLocalTracks.push(d);break;case ne.LocalAudioTrack:d instanceof wn?n.pendingLocalTracks=n.pendingLocalTracks.concat(d.trackList):n.pendingLocalTracks.push(d)}}),n.emit(we.MediaReconnectStart,n.store.uid)),n.unbindLocalTrackEvents(),n.localTrackMap.clear(),0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(r=>{let[a,l]=r;Array.from(Kr(l).call(l)).forEach(d=>{n.setPendingRemoteMedia(a,d)}),n.emit(we.MediaReconnectStart,a.uid)}),n.unbindAllRemoteTrackEvents(),n.remoteUserMap.clear(),n.statsUploader.stopUploadUplinkStats(),n.statsUploader.stopUploadDownlinkStats(),n.statsUploader.stopUploadTransportStats(),w.debug("[".concat(n.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))})()}hasPendingRemoteMedia(n,r){for(const a of this.pendingRemoteTracks){const{user:l,kind:d}=a;if((n instanceof Oi?n.uid:n)===l.uid&&r===d)return!0}return!1}setPendingRemoteMedia(n,r){this.hasPendingRemoteMedia(n,r)||this.pendingRemoteTracks.push({user:n,kind:r})}restartICE(n){var r=this;return x(function*(){let a;a=n.direction===gd.SEND_ONLY?yield r.sendMutex.lock("From P2PChannel.restartICE"):yield r.recvMutex.lock("From P2PChannel.restartICE");try{const l=yield n.restartICE(),d=yield Qt(r,we.RequestP2PRestartICE,l);n.setDescription("local",d)}finally{a()}})()}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const n=this.sendConnection.getStats(),r=this.localTrackMap.get(ne.LocalVideoTrack),a=this.localTrackMap.get(ne.LocalAudioTrack),l=n.videoSend.find(O=>{var P;return O.ssrc===(null==r||null===(P=r.ssrcs)||void 0===P?void 0:P[0].ssrcId)}),d=n.audioSend.find(O=>{var P;return O.ssrc===(null==a||null===(P=a.ssrcs)||void 0===P?void 0:P[0].ssrcId)});if(!l||!d)return 1;const h=_r(this,we.NeedSignalRTT),p=l?l.rttMs:void 0,m=d?d.rttMs:void 0,_=p&&m?(p+m)/2:p||m,v=100*n.sendPacketLossRate*.7/50+.3*((_&&h?(_+h)/2:_||h)||0)/1500,b=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,T=r?.track;if(T&&T._encoderConfig&&-1===T._hints.indexOf(Ot.SCREEN_TRACK)){const O=T._encoderConfig.bitrateMax,P=n.bitrate.actualEncoded;if(O&&P){const D=(1e3*O-P)/(1e3*O);return yD[D<.15?0:D<.3?1:D<.45?2:D<.6?3:4][b]}}return b}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const n=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(a=>{let[l]=a;const d=l._audioSSRC,h=l._videoSSRC,p=n.audioRecv.find(P=>P.ssrc===d),m=n.videoRecv.find(P=>P.ssrc===h);if(!p&&!m)return void(r+=1);const _=_r(this,we.NeedSignalRTT),E=n.rtt,v=(E&&_?(E+_)/2:E||_)||0,b=p?p.jitterMs:void 0,T=n.recvPacketLossRate;let O=.7*T*100/50+.3*v/1500;b&&(O=.6*T*100/50+.2*v/1500+.2*b/400),r+=O<.1?1:O<.17?2:O<.36?3:O<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}muteLocalTrack(n){var r=this;return x(function*(){return new z((a,l)=>{r.handleMuteLocalTrack(n,a,l)})})()}filterTobePublishedTracks(n,r,a){const l=[],d=$e(),h=this.getAllTracks();n=rh(n=n.filter(_=>-1===h.indexOf(_)));let p=!1,m=!1;for(const _ of n){if(_ instanceof ze&&(this.localTrackMap.has(ne.LocalVideoTrack)||p?new X(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(l.push({track:_,type:ne.LocalVideoTrack}),p=!0),r)){const E=this.getLowVideoTrack(_,a);l.push({track:E,type:ne.LocalVideoLowTrack})}if(_ instanceof mt){const E=this.localTrackMap.get(ne.LocalAudioTrack);if(E){if(!(E.track instanceof wn))throw new X(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new X(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const v=l.find(b=>{let{type:T}=b;return T===ne.LocalAudioTrack});if(!(v.track instanceof wn))throw new X(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new X(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(_)}else{if(!d.webAudioMediaStreamDest||_ instanceof wn||_._bypassWebAudio)l.push({track:_,type:ne.LocalAudioTrack});else{const v=new wn;v.addAudioTrack(_),l.push({track:v,type:ne.LocalAudioTrack})}m=!0}}}return l}filterTobeUnpublishedTracks(n){const r=[],a=this.getAllTracks();n=rh(n=n.filter(l=>-1!==a.indexOf(l)));for(const l of n){if(l instanceof mt){const d=this.localTrackMap.get(ne.LocalAudioTrack);if(!d)continue;d.track instanceof wn?(d.track.removeAudioTrack(l),this.unbindLocalAudioTrackEvents(l),0===d.track.trackList.length&&(r.push([ne.LocalAudioTrack,d]),d.track.close())):r.push([ne.LocalAudioTrack,d])}if(l instanceof ze){const d=this.localTrackMap.get(ne.LocalVideoTrack);if(!d)continue;r.push([ne.LocalVideoTrack,d]);const h=this.localTrackMap.get(ne.LocalVideoLowTrack);h&&r.push([ne.LocalVideoLowTrack,h])}}return r}bindLocalTrackEvents(n){n.forEach(r=>{let{track:a,type:l}=r;switch(l){case ne.LocalVideoTrack:a.addListener(fe.GET_STATS,this.handleGetLocalVideoStats),a.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(fe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.addListener(fe.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.addListener(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.bindLocalAudioTrackEvents(a)}})}bindLocalAudioTrackEvents(n,r){n instanceof wn?n.trackList.forEach(a=>{a.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(fe.GET_STATS,this.handleGetLocalAudioStats),a.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.addListener(fe.GET_STATS,this.handleGetLocalAudioStats),n.addListener(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||n.addListener(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(n){n||(n=Array.from(this.localTrackMap.entries()).map(r=>{let[a,{track:l}]=r;return{track:l,type:a}})),n.forEach(r=>{let{track:a,type:l}=r;switch(l){case ne.LocalVideoTrack:a.off(fe.GET_STATS,this.handleGetLocalVideoStats),a.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.off(fe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.off(fe.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.off(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.unbindLocalAudioTrackEvents(a)}})}unbindLocalAudioTrackEvents(n){n instanceof wn?n.trackList.forEach(r=>{r.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(fe.GET_STATS,this.handleGetLocalAudioStats),r.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.off(fe.GET_STATS,this.handleGetLocalAudioStats),n.off(fe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(fe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(fe.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(fe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(fe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(n,r){r instanceof Cs&&r.addListener(fe.GET_STATS,a=>{a(this.handleGetRemoteVideoStats(n))}),r instanceof Co&&r.addListener(fe.GET_STATS,a=>{a(this.handleGetRemoteAudioStats(n))})}unbindRemoteTrackEvents(n){n&&n.removeAllListeners(fe.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r,a]=n;a.has(ge.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),a.has(ge.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(n){return n.map(r=>{var a;let l,d,{track:h,type:p}=r;switch(p){case ne.LocalAudioTrack:l=It.Audio,d={dtx:h instanceof Td&&h._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ne.LocalVideoTrack:l=ye(a=h._hints).call(a,Ot.SCREEN_TRACK)?It.Screen:It.High,d=Tc(Tc({},Bd(h)),{},{codec:this.store.codec});break;case ne.LocalVideoLowTrack:l=It.Low,d=Tc(Tc({},Bd(h)),{},{codec:this.store.codec})}return{kind:p===ne.LocalAudioTrack?ge.AUDIO:ge.VIDEO,stream_type:l,attributes:d,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(n){return n.map(r=>{var a;let l,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case ne.LocalVideoTrack:l=ye(a=h._hints).call(a,Ot.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalAudioTrack:l=It.Audio;break;case ne.LocalVideoLowTrack:l=It.Low}return{stream_type:l,ssrcs:p,mid:m}})}assignLocalTracks(n){n.forEach(r=>{let{track:a,type:l}=r;this.localTrackMap.set(l,{track:a})})}withdrawLocalTracks(n){n.forEach(r=>{let[a]=r;this.localTrackMap.delete(a)})}bindConnectionEvents(n){var r=this;n.onConnectionStateChange=function(){var a=x(function*(l){var d;if(w.info("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(l,")")),r.emit(we.PeerConnectionStateChange,l),"connected"!==l||r.store.keyMetrics.peerConnectionEnd||r.store.peerConnectionEnd(),ye(d=r._restartStates).call(d,l)||n.direction===gd.SEND_ONLY){if(r._restartTimer)return;const h=()=>{("disconnected"===n.iceConnectionState||"checking"===n.iceConnectionState||"failed"===n.iceConnectionState)&&(w.debug("[".concat(r.store.clientId,"] [P2PChannel] start use restartICE")),"CONNECTED"===_r(r,we.QueryClientConnectionState)&&r.restartICE(n))};r._restartTimer=window.setTimeout(()=>{h(),r._restartTimer=void 0},800)}});return function(l){return a.apply(this,arguments)}}(),n.onICEConnectionStateChange=a=>{"connected"!==a||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(a,")")),Se.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:a,tag:Jt.TRACER}).onSuccess(),this.emit(we.IceConnectionStateChange,a)},n.onICETransportStateChange=a=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(a,")"))},n.onDTLSTransportStateChange=a=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(a,")"))},n.onDTLSTransportError=a=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(a,")"))},n.onFirstAudioDecoded=a=>{var l;const d=Array.from(Kr(l=this.remoteUserMap).call(l)).find(p=>p._audioSSRC===a);var h;d&&(this.store.subscribe(d.uid,"audio",void 0,void 0,void 0,Date.now()),null===(h=d.audioTrack)||void 0===h||h.emit(yd.FIRST_FRAME_DECODED),Se.firstRemoteFrame(this.store.sessionId,Yn.FIRST_AUDIO_DECODE,Kt.FIRST_AUDIO_DECODE,{peer:d._uintid,subscribeElapse:Di.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId}))},n.onFirstAudioReceived=a=>{var l;const d=Array.from(Kr(l=this.remoteUserMap).call(l)).find(h=>h._audioSSRC===a);d&&Se.firstRemoteFrame(this.store.sessionId,Yn.FIRST_AUDIO_RECEIVED,Kt.FIRST_AUDIO_RECEIVED,{peer:d._uintid,subscribeElapse:Di.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},n.onFirstVideoDecoded=(a,l,d)=>{this.reportVideoFirstFrameDecoded(a,l,d)},n.onFirstVideoReceived=a=>{var l;const d=Array.from(Kr(l=this.remoteUserMap).call(l)).find(h=>h._videoSSRC===a);d&&Se.firstRemoteFrame(this.store.sessionId,Yn.FIRST_VIDEO_RECEIVED,Kt.FIRST_VIDEO_RECEIVED,{peer:d._uintid,subscribeElapse:Di.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},n.onSelectedLocalCandidateChanged=(a,l)=>{const d="relay"===a.candidateType;"unknown"!==l.candidateType&&d===("relay"===l.candidateType)||this.emit(we.ConnectionTypeChange,d),w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Al(l))," -> ").concat(JSON.stringify(Al(a)),")"))},n.onSelectedRemoteCandidateChanged=(a,l)=>{w.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Al(l))," -> ").concat(JSON.stringify(Al(a)),")"))},n.onFirstVideoDecodedTimeout=a=>{this.reportVideoFirstFrameDecoded(a,void 0,void 0,!0)},n.onLocalCandidate=a=>{this.emit(we.LocalCandidate,a)}}unbindConnectionEvents(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0,n.onLocalCandidate=void 0}filterTobeMutedTracks(n){const r=[];if(-1===this.getAllTracks().indexOf(n))return r;const a=this.localTrackMap.get(ne.LocalAudioTrack);if(n instanceof mt&&a?.track instanceof wn)return a.track.isActive||r.push([ne.LocalAudioTrack,a]),r;const l=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(l&&(r.push(l),l[0]===ne.LocalVideoTrack)){const d=this.localTrackMap.get(ne.LocalVideoLowTrack);d&&r.push([ne.LocalVideoLowTrack,d])}return r}filterTobeUnmutedTracks(n){const r=[],a=this.localTrackMap.get(ne.LocalAudioTrack);if(n instanceof mt&&a?.track instanceof wn)return a.track.isActive&&r.push([ne.LocalAudioTrack,a]),r;const l=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(l)if(l[0]===ne.LocalVideoTrack){r.push(l);const d=this.localTrackMap.get(ne.LocalVideoLowTrack);d&&r.push([ne.LocalVideoLowTrack,d])}else r.push(l);return r}createMuteMessage(n){return n.map(r=>{var a;let l,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case ne.LocalAudioTrack:l=It.Audio;break;case ne.LocalVideoTrack:l=ye(a=h._hints).call(a,Ot.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalVideoLowTrack:l=It.Low}return{stream_type:l,ssrcs:p,mid:m}})}createUnmuteMessage(n){return n.map(r=>{var a;let l,[d,{track:h,ssrcs:p,id:m}]=r;switch(d){case ne.LocalAudioTrack:l=It.Audio;break;case ne.LocalVideoTrack:l=ye(a=h._hints).call(a,Ot.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalVideoLowTrack:l=It.Low}return{stream_type:l,ssrcs:p,mid:m}})}filterTobeUnSubscribedTracks(n,r){const a=[],l=this.remoteUserMap.get(n);if(!l)return a;if(r){const d=l.get(r);if(!d)return a;a.push([n,{kind:r,id:d}])}else Array.from(l.entries()).forEach(d=>{let[h,p]=d;a.push([n,{kind:h,id:p}])});return a}createUnsubscribeMessage(n){const r=[];return n.forEach(a=>{let[l,{kind:d}]=a;switch(d){case ge.VIDEO:return void(l._videoSSRC&&r.push({stream_type:ge.VIDEO,ssrcId:l._videoSSRC}));case ge.AUDIO:return void(l._audioSSRC&&r.push({stream_type:ge.AUDIO,ssrcId:l._audioSSRC}))}}),r}withdrawRemoteTracks(n){n.forEach(r=>{let[a,{kind:l}]=r;const d=this.remoteUserMap.get(a);d&&(d.delete(l),0===Array.from(d.entries()).length&&this.remoteUserMap.delete(a))})}updateBitrateLimit(n){var r=this;return x(function*(){const a=r.localTrackMap.get(ne.LocalVideoTrack),l=r.localTrackMap.get(ne.LocalVideoLowTrack);a&&(yield a.track.setBitrateLimit(n.uplink)),l&&n.low_stream_uplink&&(yield l.track.setBitrateLimit({max_bitrate:n.low_stream_uplink.bitrate,min_bitrate:n.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.sendConnection||!this.recvConnection||"connected"!==this.sendConnection.peerConnectionState&&"connected"!==this.recvConnection.peerConnectionState}tryToUnmuteAudio(n){var r=this;return x(function*(){for(let a=0;a<n.length;a++)if(n[a]instanceof mt){const l=r.filterTobeUnmutedTracks(n[a]);if(0===l.length)continue;const d=r.createUnmuteMessage(l);return void(yield Et(r,we.RequestUnmuteLocal,d))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=n=>this.getStats(n),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(n=>{let[,{ssrcs:r}]=n;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=n=>{var r;return!(null===(r=this.recvConnection)||void 0===r||!r.getRemoteVideoIsReady(n))},this.statsUploader.requestUpload=(n,r)=>this.emit(we.RequestUploadStats,n,r),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var n=this;return x(function*(){n.dtlsFailedCount+=1,yield gi(wt(n.dtlsFailedCount,Re)),n.emit(we.RequestReconnect)})()}reconnectP2P(){return x(function*(){})()}canPublishLowStream(){return this.localTrackMap.has(ne.LocalVideoTrack)||this.pendingLocalTracks.some(n=>n instanceof ze)}throwIfTrackTypeNotMatch(n){if(n.filter(r=>r instanceof ze).length>1)throw new X(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n.filter(r=>r instanceof mt).length>1&&(n.some(r=>r instanceof mt&&r._bypassWebAudio)||!$e().webAudioMediaStreamDest))throw new X(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of n){if(r instanceof ze&&this.pendingLocalTracks.some(a=>a instanceof ze))throw new X(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof mt&&this.pendingLocalTracks.some(a=>a instanceof mt)&&(!$e().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(a=>a instanceof mt&&a._bypassWebAudio)))throw new X(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(n,r){const a=!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&$e().supportDualStreamEncoding,l=Tc(Tc({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=a?n._mediaStreamTrack.clone():IT(n,l);const h=Fe(8,"track-low-"),p=new ze(d,Tc(Tc({},a&&{scaleResolutionDownBy:XC(l,n)}),{},{frameRate:l.framerate,bitrateMax:l.bitrate,bitrateMin:l.bitrate}),void 0,void 0,h);return p.on(mc.TRANSCEIVER_UPDATED,m=>{n._updateRtpTransceiver(m,fc.LOW_STREAM)}),p._hints.push(Ot.LOW_STREAM),n.addListener(fe.NEED_CLOSE,()=>{p.close()}),p}globalLock(){var n=this;return x(function*(){return n.recvMutex.lock("From P2PChannel2.globalLock")})()}reportVideoFirstFrameDecoded(n,r,a,l){var d;const h=Array.from(Kr(d=this.remoteUserMap).call(d)).find(p=>p._videoSSRC===n);if(h){l||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const p=this.store.keyMetrics,m=p.subscribe.find(_=>_.userId===h.uid&&"video"===_.type);Se.firstRemoteVideoDecode(this.store.sessionId,Yn.FIRST_VIDEO_DECODE,Kt.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:r,videoheight:a,subscribeElapse:Di.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId,apEnd:p.requestAPEnd||0,apStart:p.requestAPStart||0,joinGwEnd:p.joinGatewayEnd||0,joinGwStart:p.joinGatewayStart||0,pcEnd:p.peerConnectionEnd||0,pcStart:p.peerConnectionStart||0,subscriberEnd:m?.subscribeEnd||0,subscriberStart:m?.subscribeStart||0,videoAddNotify:m?.streamAdded||0,state:l?1:0})}}remoteMediaSsrcChanged(n,r,a){var l=this;return x(function*(){if(!l.recvConnection)return!1;const d=l.remoteUserMap.get(n);if(!d)return!1;const h=d.get(r);if(!h)return!1;const p=yield l.recvConnection.getRemoteSSRC(h);return void 0!==p&&p!==a})()}resetConnection(n){w.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(n)),this.state===it.Connected?(w.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}publishDataChannel(n){return x(function*(){throw new X(M.NOT_SUPPORTED)})()}unpublishDataChannel(n){return x(function*(){throw new X(M.NOT_SUPPORTED)})()}subscribeDataChannel(n,r){return x(function*(){throw new X(M.NOT_SUPPORTED)})()}unsubscribeDataChannel(n,r){return x(function*(){throw new X(M.NOT_SUPPORTED)})()}hasPendingRemoteDataChannel(n,r){throw new X(M.NOT_SUPPORTED)}setPendingRemoteDataChannel(n,r){throw new X(M.NOT_SUPPORTED)}preConnect(n,r,a,l,d,h){return x(function*(){throw new X(M.NOT_SUPPORTED)})()}getEstablishParams(){throw new X(M.NOT_SUPPORTED)}reSubscribe(n){return x(function*(){throw new X(M.NOT_SUPPORTED)})()}updateVideoStreamParameter(n,r){return x(function*(){throw new X(M.NOT_SUPPORTED)})()}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(n=>{let[r,{track:a}]=n;r===ne.LocalVideoLowTrack?a._updateRtpTransceiver(void 0,fc.LOW_STREAM):a._updateRtpTransceiver(void 0)})}}function io(s){return function(n,r,a){const l=n[r];if("function"!=typeof l)throw new Error("Cannot use mutex on object property.");return a.value=x(function*(){for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];switch(s){case ls.SEND_ONLY:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(r));try{return yield l.apply(this,h)}finally{m()}}case ls.RECEIVE_ONLY:{const m=yield this.recvMutex.lock("From P2PChannel2.".concat(r));try{return yield l.apply(this,h)}finally{m()}}default:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(r)),_=yield this.recvMutex.lock("From P2PChannel2.".concat(r));try{return yield l.apply(this,h)}finally{m(),_()}}}}),a}}function BT(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function LN(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?BT(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):BT(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}te([io(),N("design:type",Function),N("design:paramtypes",[Object,String]),N("design:returntype",z)],ln.prototype,"startP2P",null),te([io(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],ln.prototype,"p2pConnect",null),te([io(ls.SEND_ONLY),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],ln.prototype,"dopublish",null),te([io(ls.SEND_ONLY),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],ln.prototype,"unpublish",null),te([io(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],ln.prototype,"unpublishLowStream",null),te([io(ls.SEND_ONLY),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],ln.prototype,"doUnpublish",null),te([io(ls.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Oi,String,String,Number]),N("design:returntype",z)],ln.prototype,"subscribe",null),te([io(ls.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Oi,String,String,Boolean]),N("design:returntype",z)],ln.prototype,"unsubscribe",null),te([io(ls.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Oi,String]),N("design:returntype",z)],ln.prototype,"muteRemote",null),te([io(ls.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Oi,String]),N("design:returntype",z)],ln.prototype,"unmuteRemote",null),te([io(ls.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Oi,String]),N("design:returntype",z)],ln.prototype,"hasRemoteMediaWithLock",null),te([io(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],ln.prototype,"disconnectForReconnect",null),te([io(ls.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Oi,String,Number]),N("design:returntype",z)],ln.prototype,"remoteMediaSsrcChanged",null);const FN=Date.now(),P2=20,jT=new Map,vv=new Map;function M2(s){return UN.apply(this,arguments)}function UN(){return UN=x(function*(s){const n=jT.get(s),r=Array.isArray(n)&&n[n.length-1],a=vv.get(s);if(!r)return void(a.isSyncing=!1);const l={uid:r.uid,payload:jg(r.payload)};0===a.firstRecvTs&&(a.firstRecvTs=r.recvTs,a.firstSendTs=r.sendTs);const d=r.sendTs-a.firstSendTs,h=d-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-d);let p=r.mediaDelay+h;p<=0?(n.pop(),HT(r.context,l),p=0):p=Math.min(p,P2),setTimeout(()=>n.length&&M2(s),p)}),UN.apply(this,arguments)}function HT(s,n){s.safeEmit(Xe.STREAM_MESSAGE,n.uid,n.payload),s.onStreamMessage&&s.onStreamMessage(n)}const x2=dt().name;function VN(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function zh(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?VN(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):VN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}Zn.setLogger(w);class Nt extends qt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var n;return(null===(n=this._config)||void 0===n?void 0:n.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(n){var r;let a;if(super(),r=this,C(this,"store",void 0),C(this,"_uid",void 0),C(this,"_channelName",void 0),C(this,"_uintUid",void 0),C(this,"_users",[]),C(this,"_config",void 0),C(this,"_clientId",void 0),C(this,"_appId",void 0),C(this,"_sessionId",null),C(this,"_key",void 0),C(this,"_joinInfo",void 0),C(this,"_gateway",void 0),C(this,"_statsCollector",void 0),C(this,"_configDistribute",void 0),C(this,"_leaveMutex",new Zn("client-leave")),C(this,"_publishMutex",new Zn("client-publish")),C(this,"_renewTokenMutex",new Zn("client-renewtoken")),C(this,"_subscribeMutex",new Zn("client-subscribe")),C(this,"_encryptionMode","none"),C(this,"_encryptionSecret",null),C(this,"_encryptionSalt",null),C(this,"_proxyServer",void 0),C(this,"_turnServer",{servers:[],mode:"auto"}),C(this,"_cloudProxyServerMode","disabled"),C(this,"_isDualStreamEnabled",!1),C(this,"_defaultStreamFallbackType",void 0),C(this,"_lowStreamParameter",void 0),C(this,"_streamFallbackTypeCacheMap",new Map),C(this,"_remoteStreamTypeCacheMap",new Map),C(this,"_axiosCancelSource",Er.CancelToken.source()),C(this,"_audioVolumeIndicationInterval",void 0),C(this,"_networkQualityInterval",void 0),C(this,"_userOfflineTimeout",void 0),C(this,"_streamRemovedTimeout",void 0),C(this,"_injectStreamingClient",void 0),C(this,"_liveTranscodeStreamingClient",void 0),C(this,"_liveRawStreamingClient",void 0),C(this,"_channelMediaRelayClient",void 0),C(this,"_networkQualitySensitivity","normal"),C(this,"_p2pChannel",void 0),C(this,"_useLocalAccessPoint",!1),C(this,"_setLocalAPVersion",void 0),C(this,"_joinAndNotLeaveYet",!1),C(this,"_numberOfJoinCount",0),C(this,"_remoteDefaultVideoStreamType",void 0),C(this,"_inspect",void 0),C(this,"_moderation",void 0),C(this,"_license",void 0),C(this,"_pendingPublishedUsers",[]),C(this,"ntpAlignErrorCount",0),C(this,"remoteInboundOffset",0),C(this,"_handleLocalTrackEnable",(l,d,h)=>{this.publish(l,!1).then(d).catch(h)}),C(this,"_handleLocalTrackDisable",(l,d,h)=>{this.unpublish(l).then(d).catch(h)}),C(this,"_handleUserOnline",l=>{if(j("BLOCK_LOCAL_CLIENT")&&hl(l.uid,this.channelName))return void w.debug("[".concat(l.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof l.uid&&w.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find(h=>h.uid===l.uid);if(d)d._trust_in_room_=!0;else{const h=new Oi(l.uid,l.uint_id||l.uid);this._users.push(h),w.debug("[".concat(this._clientId,"] user online"),l.uid),this.safeEmit(Xe.USER_JOINED,h)}}),C(this,"_handleUserOffline",l=>{if(j("BLOCK_LOCAL_CLIENT")&&hl(l.uid,this.channelName))return;const d=this._users.find(h=>h.uid===l.uid);d&&(this._handleRemoveStream(l),this._handleRemoveDataChannels(l),_S(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),w.debug("[".concat(this._clientId,"] user offline"),l.uid,"reason:",l.reason),this.safeEmit(Xe.USER_LEAVED,d,l.reason))}),C(this,"_handleAddAudioOrVideoStream",(l,d,h,p,m,_,E)=>{if(j("BLOCK_LOCAL_CLIENT")&&hl(d,this.channelName))return;const v=this._users.find(T=>T.uid===d);if(!v)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));w.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(l)),this.store.subscribe(v.uid,l,void 0,void 0,void 0,Date.now());const b="audio"===l?v.hasAudio:v.hasVideo;v._uintid||(v._uintid=m||d),"audio"===l?v._trust_audio_stream_added_state_=!0:v._trust_video_stream_added_state_=!0,"audio"===l?(v._audio_added_=!0,void 0!==h&&(v._audioSSRC=h),void 0!==p&&(v._cname=p),_&&(v._audioOrtc=_)):(v._video_added_=!0,void 0!==h&&(v._videoSSRC=h),void 0!==p&&(v._cname=p),void 0!==E&&(v._rtxSsrcId=E),_&&(v._videoOrtc=_)),("audio"===l?v.hasAudio:v.hasVideo)&&!b&&(w.info("[".concat(this._clientId,"] remote user ").concat(v.uid," published ").concat(l)),this.safeEmit(Xe.USER_PUBLISHED,v,l)),"video"===l?Se.onGatewayStream(this._sessionId,Yn.ON_ADD_VIDEO_STREAM,Kt.ON_ADD_VIDEO_STREAM,{peer:m||d,ssrc:v._videoSSRC}):Se.onGatewayStream(this._sessionId,Yn.ON_ADD_AUDIO_STREAM,Kt.ON_ADD_AUDIO_STREAM,{peer:m||d,ssrc:v._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(v,l,h).then(T=>{if(T&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(v.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof li))return this._p2pChannel.unsubscribe(v,l,!0).then(()=>this._subscribe(v,l,!0).catch(O=>{w.error("[".concat(this._clientId,"] resubscribe error"),O.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(v,l)&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(v.uid," after reconnect.")),this._subscribe(v,l,!0).catch(T=>{w.error("[".concat(this._clientId,"] resubscribe error"),T.toString())}))}),C(this,"_handleRemoveStream",(l,d,h)=>{if(j("BLOCK_LOCAL_CLIENT")&&hl(l.uid,this.channelName))return;const p=this._users.find(_=>_.uid===l.uid);if(!p)return void w.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));w.debug("[".concat(this._clientId,"] stream removed with uid ").concat(l.uid));let m=()=>{};if(p.hasAudio&&p.hasVideo?m=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished audio track")),this.safeEmit(Xe.USER_UNPUBLISHED,p,"audio"),w.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished video track")),this.safeEmit(Xe.USER_UNPUBLISHED,p,"video")}:p.hasVideo?m=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished video track")),this.safeEmit(Xe.USER_UNPUBLISHED,p,"video")}:p.hasAudio&&(m=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished audio track")),this.safeEmit(Xe.USER_UNPUBLISHED,p,"audio")}),p._trust_audio_stream_added_state_=!0,p._trust_video_stream_added_state_=!0,p._audio_added_=!1,p._video_added_=!1,this._p2pChannel instanceof li)this._p2pChannel.unsubscribe(p).then(_=>{if(_)return this._gateway.unsubscribe(_,p.uid)});else if(d&&h)if(l.sdp){const{sdp:_}=l;this._p2pChannel.unsubscribe(p,_).then(E=>{E&&d(E)}).catch(h)}else d&&d();p._audioSSRC=void 0,p._videoSSRC=void 0,p._audioOrtc=void 0,p._videoOrtc=void 0,p._rtxSsrcId=void 0,Se.onGatewayStream(this._sessionId,Yn.ON_REMOVE_STREAM,Kt.ON_REMOVE_STREAM,{peer:l.uint_id||l.uid}),m()}),C(this,"_handleSetStreamLocalEnable",(l,d,h)=>{if(j("BLOCK_LOCAL_CLIENT")&&hl(d,this.channelName))return;const p=this._users.find(E=>E.uid===d);if(!p)return void w.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));w.debug("[".concat(this._clientId,"] local ").concat(l," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const m="audio"===l?p.hasAudio:p.hasVideo;if("audio"===l){p._trust_audio_enabled_state_=!0;const E=p._audio_enabled_;if(p._audio_enabled_=h,p._audio_enabled_===E)return;{const v=p._audio_enabled_?"enable-local-audio":"disable-local-audio";w.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(v)),this.safeEmit(Xe.USER_INFO_UPDATED,d,v)}}else{p._trust_video_enabled_state_=!0;const E=p._video_enabled_;if(p._video_enabled_=h,p._video_enabled_===E)return;{const v=p._video_enabled_?"enable-local-video":"disable-local-video";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(v)),this.safeEmit(Xe.USER_INFO_UPDATED,d,v)}}const _="audio"===l?p.hasAudio:p.hasVideo;return m!==_?!m&&_?(w.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(l)),void this.safeEmit(Xe.USER_PUBLISHED,p,l)):("video"===l&&p._videoTrack&&p._videoTrack._destroy(),this._p2pChannel.muteRemote(p,l),w.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(l)),void this.safeEmit(Xe.USER_UNPUBLISHED,p,l)):void 0}),C(this,"_handleMuteStream",(l,d,h,p,m,_)=>{if(j("BLOCK_LOCAL_CLIENT")&&hl(l,this.channelName))return;w.debug("[".concat(this._clientId,"] receive mute message"),l,d,h);const E=this._users.find(T=>T.uid===l);if(!E)return void w.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(l));const v="audio"===d?E.hasAudio:E.hasVideo;if("audio"===d){E._trust_audio_mute_state_=!0;const T=E._audio_muted_;if(E._audio_muted_=h,E._audio_muted_===T)return;{const O=E._audio_muted_?"mute-audio":"unmute-audio";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(O)),this.safeEmit(Xe.USER_INFO_UPDATED,l,O)}}else{E._trust_video_mute_state_=!0;const T=E._video_muted_;if(E._video_muted_=h,E._video_muted_===T)return;{const O=E._video_muted_?"mute-video":"unmute-video";w.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(O)),this.safeEmit(Xe.USER_INFO_UPDATED,l,O)}}const b="audio"===d?E.hasAudio:E.hasVideo;if(v!==b){if(!v&&b)return this.store.useP2P||("audio"===d?E._audioSSRC:E._videoSSRC)?(w.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(d)),void this.safeEmit(Xe.USER_PUBLISHED,E,d)):void w.warning("[".concat(this._clientId,"] remote user ").concat(l," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));"video"===d&&E._videoTrack&&E._videoTrack._destroy(),m&&_&&this._p2pChannel instanceof ln&&(p?this._p2pChannel.unsubscribe(E,p,d).then(T=>{m(T)}).catch(_):m()),this._p2pChannel.muteRemote(E,d),w.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(d)),this.safeEmit(Xe.USER_UNPUBLISHED,E,d)}}),C(this,"_handleP2PLost",function(){var l=x(function*(d){w.debug("[".concat(r._clientId,"] receive p2p lost"),d),parseInt(d.p2pid,10)===r.store.p2pId?yield r._p2pChannel.requestReconnect():w.warning("[".concat(r._clientId,"] P2PLost stream not found"),d)});return function(d){return l.apply(this,arguments)}}()),C(this,"_handleTokenWillExpire",()=>{w.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Xe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),C(this,"_handleBeforeUnload",l=>{"beforeunload"===l.type&&void 0!==l.returnValue&&""!==l.returnValue||(this.leave(),w.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),C(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(Xe.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const l={downlinkNetworkQuality:0,uplinkNetworkQuality:0};l.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),l.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Xe.NETWORK_QUALITY,l)}),C(this,"_handleP2PAddAudioOrVideoStream",(l,d)=>{const h=this._users.find(m=>m.uid===d);if(!h)return void w.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));w.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(l)),this.store.subscribe(h.uid,l,void 0,void 0,void 0,Date.now());const p="audio"===l?h.hasAudio:h.hasVideo;"audio"===l?h._trust_audio_stream_added_state_=!0:h._trust_video_stream_added_state_=!0,"audio"===l?h._audio_added_=!0:h._video_added_=!0,("audio"===l?h.hasAudio:h.hasVideo)&&!p&&(w.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published ").concat(l)),this.safeEmit(Xe.USER_PUBLISHED,h,l)),this._p2pChannel.hasPendingRemoteMedia(h,l)&&(w.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(h.uid," after reconnect.")),this._subscribe(h,l,!0).catch(m=>{w.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._config=n,this._clientId=Fe(5,"client-"),this.store=new Vn(n.codec,n.audioCodec,n.mode,this._clientId),this.store.clientCreated(),n.proxyServer&&this.setProxyServer(n.proxyServer,!0),n.turnServer&&this.setTurnServer(n.turnServer,!0),w.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat($o," build: ").concat(BS,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),n.clientRoleOptions)try{df(n.clientRoleOptions),a=Object.assign({},n.clientRoleOptions)}catch(l){w.warning("[".concat(this._clientId,"] ").concat(l.toString()))}this._statsCollector=new Oh(this.store),this._statsCollector.onStatsException=(l,d,h)=>{w.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(l,", msg: ").concat(d,", uid: ").concat(h)),this.safeEmit(Xe.EXCEPTION,{code:l,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(l,d,h,p)=>{const m=this._users.find(_=>_.uid===l);m&&Se.peerPublishStatus(this._sessionId,{subscribeElapse:p,audioPublishDuration:d,videoPublishDuration:h,peer:m._uintid})},this.store.useDataChannel=$e().supportDataChannel&&j("SIGNAL_CHANNEL"),this.store.useP2P=j("P2P"),this._gateway=new XL(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:n.websocketRetryConfig||Re,httpRetryConfig:n.httpRetryConfig||Re,forceWaitGatewayResponse:void 0===n.forceWaitGatewayResponse||n.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:n.role,clientRoleOptions:a}),this._configDistribute=new hT,this.store.useP2P?(this._p2pChannel=new ln(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new li(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}joinMeta(n,r,a,l,d){var h=arguments,p=this;return x(function*(){let m=!(h.length>5&&void 0!==h[5])||h[5],_=h.length>6&&void 0!==h[6]&&h[6];At("JOIN_GATEWAY_USE_443PORT_ONLY",m),At("JOIN_GATEWAY_USE_DUAL_DOMAIN",_);const E=p._gateway.signal.websocket;return E instanceof lE&&(E.use443PortOnly=m,E.tryDoubleDomain=_),(v=x(function*(b,T,O){Ng.get(b)||Ng.set(b,[]),Pg.get(b)||Pg.set(b,T),Ra.get(b)||Ra.set(b,0);const P=Ng.get(b),D=Pg.get(b);if(!P||!D)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Ra.get(b)===D){const se=af();P.push(se),yield se.promise}Ra.set(b,Ra.get(b)+1);for(var L=arguments.length,V=new Array(L>3?L-3:0),U=3;U<L;U++)V[U-3]=arguments[U];const J=yield O(...V);return Ra.set(b,Ra.get(b)-1),Ra.get(b)===D-1&&P.length>0&&(P[0].resolve(),P.shift()),0===Ra.get(b)&&(Ng.set(b,[]),Pg.set(b,0),Ra.set(b,0)),J}),function(b,T,O){return v.apply(this,arguments)})("client.join",j("JOIN_MAX_CONCURRENCY"),p.join.bind(p),n,r,a,l,d);var v})()}join(n,r,a,l,d){var h=this;return x(function*(){const p=++h._numberOfJoinCount;h.store.joinStart(),l&&(h.store.uid=l);const m="HTTPS"===(yf||yf||(yf=(window.location.protocol.split(":")[0]||"").toUpperCase(),yf)),_=Hk()?window.isSecureContext:"Browser Not Support";(Hk()||m)&&window.isSecureContext||w.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");const E=Hg();"DISCONNECTED"===h.connectionState&&(h.store.avoidJoinStart=Math.round(Date.now()),w.debug("[".concat(h._clientId,"] set avoidJoinStart to ").concat(h.store.avoidJoinStart)));const v=Se.reportApiInvoke(E,{name:Nn.JOIN,options:[n,r,a,l],states:{isHttps:m,isSecureContext:_},tag:Jt.TRACER});Se.setAppId(n);try{if(!a&&null!==a)throw new W(M.INVALID_PARAMS,"Invalid token: ".concat(a,". If you don not use token, set it to null"));a&&Un(a,"token",1,2047),Un(n,"appid",1,2047),oE(r),l&&qS(l),d&&Un(d,"optionalInfo",1,2047)}catch(D){throw v.onError(D),D}if(w.info("[".concat(h._clientId,"] start join channel ").concat(r,", join number: ").concat(p)),h._leaveMutex.isLocked&&(w.debug("[".concat(h._clientId,"] join: waiting leave operation")),(yield h._leaveMutex.lock())(),w.debug("[".concat(h._clientId,"] join: continue"))),h._joinAndNotLeaveYet=!0,"DISCONNECTED"!==h.connectionState){const D=new W(M.INVALID_OPERATION,"[".concat(h._clientId,"] Client already in connecting/connected state"));throw v.onError(D),D}h._sessionId||(h._sessionId=E,h.store.sessionId=h._sessionId),h._gateway.state="CONNECTING";const b=zh({clientId:h._clientId,appId:n,sid:h._sessionId,cname:r,uid:"string"!=typeof l?l:null,turnServer:h._turnServer,proxyServer:h._proxyServer,token:a||n,cloudProxyServer:h._cloudProxyServerMode,optionalInfo:d,license:h._license,useLocalAccessPoint:h._useLocalAccessPoint},void 0!==h._remoteDefaultVideoStreamType&&{defaultVideoStream:h._remoteDefaultVideoStreamType});if(h._useLocalAccessPoint&&(b.setLocalAPVersion=h._setLocalAPVersion),"string"==typeof l&&(b.stringUid=l,h._uintUid?(b.uid=h._uintUid,h._uintUid=void 0):b.uid=0),"none"!==h._encryptionMode&&h._encryptionSecret){if(b.aesmode=h._encryptionMode,b.aespassword=yield TA(h._encryptionSecret),!h._joinAndNotLeaveYet)throw new W(M.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));h._encryptionSalt&&(b.aessalt=h._encryptionSalt)}h._startSession(h._sessionId,{channel:r,appId:n});const T=h._sessionId;setTimeout(()=>{"CONNECTING"===h.connectionState&&T===h._sessionId&&Se.joinChannelTimeout(h._sessionId,5)},5e3);try{var O;let D;const L=b.cloudProxyServer;if(ye(O=["proxy3","proxy4","proxy5"]).call(O,L)){const se=j("PROXY_SERVER_TYPE3");b.proxyServer=Array.isArray(se)?se[0]:se}if(Se.setProxyServer(b.proxyServer),w.setProxyServer(b.proxyServer),h.store.requestAPStart(),b.stringUid&&!b.uid){const se=yield kh(b.stringUid,b,h._axiosCancelSource.token,h._config.httpRetryConfig||Re,h.store);w.debug("[".concat(h._clientId,"] getUserAccount Success ").concat(b.stringUid," => ").concat(se)),b.uid=se,D=yield rT(b,h._axiosCancelSource.token,h._config.httpRetryConfig||Re,!0,h.store)}else D=yield rT(b,h._axiosCancelSource.token,h._config.httpRetryConfig||Re,!0,h.store);if(!h._joinAndNotLeaveYet)throw new W(M.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));h.store.requestAPEnd(),setTimeout(()=>{h._configDistribute.startGetConfigDistribute(b,h._axiosCancelSource.token),h._configDistribute.on(Af.UPDATE_BITRATE_LIMIT,se=>{h._p2pChannel.updateBitrateLimit(se)})},0),h._key=a||n;const V=D.gatewayInfo;h._joinInfo=zh(zh({},b),{},{cid:V.cid,uid:b.uid?b.uid:V.uid,vid:V.vid,apResponse:V.res,uni_lbs_ip:V.uni_lbs_ip,gatewayAddrs:V.gatewayAddrs});const U=yield h._joinGateway();if(!h._joinAndNotLeaveYet)throw new W(M.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));v.onSuccess(U),h._appId=n,h._channelName=b.cname,h._uid=U,h.store.uid=U,setTimeout(()=>{h._networkQualityInterval&&window.clearInterval(h._networkQualityInterval),h._networkQualityInterval=window.setInterval(h._handleUpdateNetworkQuality,2e3),window.addEventListener(Ki()?"beforeunload":"pagehide",h._handleBeforeUnload)},0);const J=b.stringUid?"string uid: ".concat(b.stringUid,",uid: ").concat(b.uid):"uid: ".concat(h._uid);return w.info("[".concat(h._clientId,"] Joining channel success: channel: ").concat(r,",").concat(J)),setTimeout(()=>{w.startUpload()},5e3),h.store.joinEnd(),P=h,ye(hc).call(hc,P)||hc.push(P),U}catch(D){const L=Array.isArray(D)?D[0]:D;throw L&&L.code===M.OPERATION_ABORTED?w.warning("[".concat(h._clientId,"] join number: ").concat(p,", Joining channel failed, rollback"),L):w.error("[".concat(h._clientId,"] join number: ").concat(p,", Joining channel failed, rollback"),L),L.code!==M.OPERATION_ABORTED&&h._numberOfJoinCount===p&&(h._gateway.state="DISCONNECTED",h._reset()),v.onError(L),L}var P})()}_joinGateway(){if(!this._joinInfo||!this._key)throw new W(M.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!j("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(n=>n).catch(n=>{if(n.code===M.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,Ye.FALLBACK),n;if(n.code===M.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,Ye.FALLBACK),n;throw n}).then(n=>{if(n instanceof W){if(n.code===M.INIT_WEBSOCKET_TIMEOUT){if(w.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new W(M.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const r=j("PROXY_SERVER_TYPE3");if(Array.isArray(r))if(this._joinInfo.apUrl){const l=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),d=l.slice(l.length-2).join(".");r.forEach(h=>{this._joinInfo&&ye(h).call(h,d)&&(this._joinInfo.proxyServer=h)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=r[0])}else this._joinInfo.proxyServer=r[0];else this._joinInfo.proxyServer=r;const a=j("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return a&&a[1]&&"443"!==a[1]&&w.setProxyServer(this._joinInfo.proxyServer),"443"!==j("STATS_COLLECTOR_PORT").toString()&&Se.setProxyServer(this._joinInfo.proxyServer),Se.reportApiInvoke(this._sessionId,{name:Nn.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:Jt.TRACER}).onSuccess(),this.safeEmit(Xe.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),j("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(l=>{"forceturn"in l&&(l.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(w.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new W(M.INVALID_OPERATION);return Se.reportApiInvoke(this._sessionId,{name:Nn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Jt.TRACER}).onSuccess(),this._joinGateway()}return n}).then(n=>n)}leave(){var n=this;return x(function*(){w.info("[".concat(n._clientId,"] Leaving channel")),window.removeEventListener(Ki()?"beforeunload":"pagehide",n._handleBeforeUnload),n._reset(),function(a){const l=hc.indexOf(a);-1!==l&&hc.splice(l,1)}(n);const r=yield n._leaveMutex.lock();if("DISCONNECTED"===n.connectionState)return w.info("[".concat(n._clientId,"] Leaving channel repeated, success")),void r();yield n._gateway.leave("CONNECTED"!==n.connectionState),w.info("[".concat(n._clientId,"] Leaving channel success")),n._joinAndNotLeaveYet=!1,n.store.resetJoinChannelServiceRecords(),r()})()}publish(n){var r=arguments,a=this;return x(function*(){let l=!(r.length>1&&void 0!==r[1])||r[1];if(!Array.isArray(n)){if(!(n instanceof Ri))return a._publishDataChannel(n);n=[n]}if(0===n.length)throw new W(M.INVALID_PARAMS,"param list is empty");const d=n;if("audience"===a._gateway.role)throw new W(M.INVALID_OPERATION,"audience can not publish stream");for(const p of d){if(!(p instanceof Ri))throw new W(M.INVALID_PARAMS,"parameter is not local track");if(!p._enabled&&l)throw new W(M.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(p.getTrackId()))}w.info("[".concat(a._clientId,"] Publishing tracks, id ").concat(d.map(p=>"".concat(p.getTrackId()," "))));const h=yield a._publishMutex.lock();yield a._configDistribute.awaitConfigDistributeComplete(),l&&d.forEach(p=>{const m=a._configDistribute.getBitrateLimit();p instanceof ze&&m&&p.setBitrateLimit(m.uplink)});try{yield a._publishHighStream(d),w.info("[".concat(a._clientId,"] Publish success, id ").concat(d.map(p=>"".concat(p.getTrackId()," "))))}catch(p){throw w.error("[".concat(a._clientId,"] publish error"),p.toString()),p}finally{h()}})()}_publishDataChannel(n){var r=this;return x(function*(){ft(n.id,"id",0,65535,!0),_s(n.ordered,"ordered"),Un(n.metadata,"metadata",0,512),w.info("[".concat(r._clientId,"] Publishing datachannels, id ").concat(n.id));const a=yield r._publishMutex.lock();try{if(-1!==r._p2pChannel.getAllDataChannels().findIndex(d=>d.id===n.id))throw new W(M.INVALID_PARAMS,"Invalid id: ".concat(n.id,". If you want to republish the datachannel, unpublish first"));if(!r._joinInfo||void 0===r._uid)throw new W(M.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new W(M.INVALID_OPERATION,"can not publish datachannel in ".concat(r.connectionState," state"));if("auto"===r._turnServer.mode&&j("FORCE_TURN")&&!j("TURN_ENABLE_TCP")&&!j("TURN_ENABLE_UDP"))throw new W(M.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const l=new Ro(n);yield r._p2pChannel.publishDataChannel([l]);try{const d={streamId:n.id,ordered:n.ordered,maxRetransmits:j("DATASTREAM_MAX_RETRANSMITS"),metadata:n.metadata,channelId:l._originDataChannelId};yield r._gateway.publishDataChannel(r._uid,d,!0)}catch(d){if(d.code!==M.DISCONNECT_P2P)throw d}return yield l._waitTillOpen(),w.info("[".concat(r._clientId,"] Publish dataChannels success, id ").concat(l.id)),l}catch(l){throw w.error("[".concat(r._clientId,"] publish datachannels error"),l.toString()),l}finally{a()}})()}unpublish(n){var r=this;return x(function*(){if(!r._joinInfo||void 0===r._uid)throw new W(M.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let a=[];if(n)if(Array.isArray(n))a=n;else{if(!(n instanceof Ri))return r._unpublishDataChannel([n]);a=[n]}else r.store.useP2P||(yield r._unpublishDataChannel()),a=r._p2pChannel.getAllTracks(!0);w.info("[".concat(r._clientId,"] Unpublish tracks, tracks ").concat(a.map(d=>"".concat(d.getTrackId()," "))," "));const l=yield r._publishMutex.lock();try{if(r._p2pChannel instanceof ln){const d=yield r._p2pChannel.unpublish(a);if(d){const h=yield r._gateway.sendExtensionMessage(Dt.UNPUBLISH,d);h&&(yield r._p2pChannel.setDescription("local",h))}}else{const d=yield r._p2pChannel.unpublish(a);d&&(yield r._gateway.unpublish(d,r._uid)),w.info("[".concat(r._clientId,"] Unpublish success,tracks ").concat(a.map(h=>"".concat(h.getTrackId()))))}}catch(d){throw w.error("[".concat(r._clientId,"] unpublish error"),d.toString()),d}finally{l&&l()}})()}_unpublishDataChannel(n){var r=this;return x(function*(){void 0!==n&&0!==n.length||(n=r._p2pChannel.getAllDataChannels()),w.info("[".concat(r._clientId,"] Unpublish datachannels, datachannels ").concat(n.map(l=>"".concat(l.id," "))," "));const a=yield r._publishMutex.lock();try{const l=yield r._p2pChannel.unpublishDataChannel(n);l&&(yield r._gateway.unpublishDataChannel(l)),w.info("[".concat(r._clientId,"] Unpublish dataChannel success,dataChannel ").concat(n.map(d=>"".concat(d.id))))}catch(l){throw w.error("[".concat(r._clientId,"] unpublish dataChannel error"),l.toString()),l}finally{a&&a()}})()}subscribe(n,r,a){var l=this;return x(function*(){return"datachannel"===r?l._subscribeDataChannel(n,a):l._subscribe(n,r)})()}_subscribeDataChannel(n,r){var a=this;return x(function*(){var l;if(ft(r,"channelId",0,65535,!0),!a._joinInfo)throw new W(M.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==a.connectionState&&"RECONNECTING"!==a.connectionState)throw new W(M.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(a.connectionState," state"));if(!a._users.find(m=>m===n))throw w.error("[".concat(a._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),new W(M.INVALID_REMOTE_USER,"user is not in the channel");if(!n.hasAudio&&!n.hasVideo&&0===n._dataChannels.length)throw w.error("[".concat(a._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),new W(M.INVALID_REMOTE_USER,"user is not published");const d=null===(l=n._dataChannels)||void 0===l?void 0:l.find(m=>m.id===r);if(!d)throw w.error("[".concat(a._clientId,"] can not subscribe ").concat(n.uid," with mediaType datachannel, remote datachannel is not published")),new W(M.REMOTE_USER_IS_NOT_PUBLISHED);const h=yield a._subscribeMutex.lock();w.info("[".concat(a._clientId,"] subscribe user ").concat(n.uid,", mediaType: datachannel"));try{const m=yield a._p2pChannel.subscribeDataChannel(n,[d]);if(m&&ye(m).call(m,d.id))try{var p;if(!d._originDataChannelId)throw w.error("[".concat(a._clientId,"] can not subscribe ").concat(n.uid," with mediaType datachannel, cannot get RTCDatachannel")),new W(M.REMOTE_USER_IS_NOT_PUBLISHED);const _={id:d.id,datachannelId:d._originDataChannelId,ordered:d.ordered,maxRetransmits:d.maxRetransmits,metadata:null!==(p=d.metadata)&&void 0!==p?p:""};yield a._gateway.subscribeDataChannel(n.uid,_,!0)}catch(_){if(_?.code!==M.WS_ABORT)throw yield a._p2pChannel.unsubscribeDataChannel(n,[d]),_;yield a._p2pChannel.unsubscribeDataChannel(n,[d]),a._p2pChannel.setPendingRemoteDataChannel(n,d.id)}return yield d._waitTillOpen(),w.info("[".concat(a._clientId,"] subscribe success user ").concat(n.uid,", mediaType: datachannel")),d}finally{h()}})()}_p2pSubscribe(n,r,a){var l=this;return x(function*(){if(gn(r,"mediaType",["audio","video"]),!l._joinInfo)throw new W(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==l.connectionState&&"RECONNECTING"!==l.connectionState)throw new W(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(l.connectionState," state"));if(!l._users.find(p=>p===n)){const p=new W(M.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(l._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),p}if(!n.hasAudio&&!n.hasVideo){const p=new W(M.INVALID_REMOTE_USER,"user is not published");throw w.error("[".concat(l._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),p}if(!a&&("audio"===r&&!n.hasAudio||"video"===r&&!n.hasVideo)){const p=new W(M.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(l._clientId,"] can not subscribe ").concat(n.uid," with mediaType ").concat(r,", remote track is not published")),p}const d=yield l._subscribeMutex.lock();w.info("[".concat(l._clientId,"] subscribe user ").concat(n.uid,", mediaType: ").concat(r));const h="audio"===r?ne.LocalAudioTrack:l._joinInfo.defaultVideoStream===hE.LOW_STREAM?ne.LocalVideoLowTrack:ne.LocalVideoTrack;try{(yield l._p2pChannel.hasRemoteMediaWithLock(n,r))?yield l._p2pChannel.unmuteRemote(n,r):(l.store.subscribe(n.uid,r,Date.now()),l._p2pChannel instanceof ln&&(yield l._gateway.sendExtensionMessage(Dt.SUBSCRIBE,{trackType:h}))),w.info("[".concat(l._clientId,"] subscribe success user ").concat(n.uid,", mediaType: ").concat(r)),l._defaultStreamFallbackType&&l.setStreamFallbackOption(n.uid,l._defaultStreamFallbackType).catch(m=>{w.warning("[".concat(l._clientId,"] auto set fallback failed"),m)});const p="audio"===r?n._audioTrack:n._videoTrack;if(!p)throw new W(M.UNEXPECTED_ERROR,"can not find remote track in user object");return p}catch(p){throw w.error("[".concat(l._clientId,"] subscribe user ").concat(n.uid," error"),p),p}finally{d()}})()}_subscribe(n,r,a){var l=this;return x(function*(){if(l._p2pChannel instanceof ln)return l._p2pSubscribe(n,r);if(gn(r,"mediaType",["audio","video"]),!l._joinInfo)throw new W(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==l.connectionState&&"RECONNECTING"!==l.connectionState)throw new W(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(l.connectionState," state"));if(!l._users.find(E=>E===n)){const E=new W(M.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(l._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),E}if(!n.hasAudio&&!n.hasVideo){const E=new W(M.INVALID_REMOTE_USER,"user is not published");throw w.error("[".concat(l._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),E}if(!(a||("audio"!==r||n.hasAudio&&void 0!==n._audioSSRC)&&("video"!==r||n.hasVideo&&void 0!==n._videoSSRC))){const E=new W(M.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(l._clientId,"] can not subscribe ").concat(n.uid," with mediaType ").concat(r,", remote track is not published")),E}let d="audio"===r?n._audioSSRC:n._videoSSRC,h="audio"===r?n._audioOrtc:n._videoOrtc,p="video"===r?n._rtxSsrcId:void 0,m={stream_type:"audio"===r?ge.AUDIO:ge.VIDEO,ssrcId:d};const _=yield l._subscribeMutex.lock();w.info("[".concat(l._clientId,"] subscribe user ").concat(n.uid,", mediaType: ").concat(r));try{if(yield l._p2pChannel.hasRemoteMediaWithLock(n,r))yield l._p2pChannel.unmuteRemote(n,r);else try{const v="audio"===r?n._audioSSRC:n._videoSSRC;void 0!==v&&v!==d&&(d=v,h="audio"===r?n._audioOrtc:n._videoOrtc,p="video"===r?n._rtxSsrcId:void 0,m={stream_type:"audio"===r?ge.AUDIO:ge.VIDEO,ssrcId:d}),Di.markSubscribeStart(l.store.clientId,d),l.store.subscribe(n.uid,r,Date.now()),yield l._p2pChannel.subscribe(n,r,d,p,h);try{yield l._gateway.subscribe(n.uid,m,!0)}catch(b){if(b?.code!==M.WS_ABORT)throw yield l._p2pChannel.unsubscribe(n,r),b;yield l._p2pChannel.unsubscribe(n,r,!0),l._p2pChannel.setPendingRemoteMedia(n,r)}l.store.subscribe(n.uid,r,void 0,Date.now()),l._p2pChannel.reportSubscribeEvent(!0,null,n,r)}catch(v){throw l._p2pChannel.reportSubscribeEvent(!1,v?.code,n,r),v}w.info("[".concat(l._clientId,"] subscribe success user ").concat(n.uid,", mediaType: ").concat(r)),l._defaultStreamFallbackType&&l.setStreamFallbackOption(n.uid,l._defaultStreamFallbackType).catch(v=>{w.warning("[".concat(l._clientId,"] auto set fallback failed"),v)});const E="audio"===r?n._audioTrack:n._videoTrack;if(!E)throw new W(M.UNEXPECTED_ERROR,"can not find remote track in user object");return E}catch(E){throw w.error("[".concat(l._clientId,"] subscribe user ").concat(n.uid," error"),E),E}finally{_()}})()}massSubscribe(n){var r=this;return x(function*(){if(fo(n,"subscribeList"),!r._joinInfo)throw new W(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new W(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(r.connectionState," state"));const a=Date.now(),l=new Map,d=yield r._subscribeMutex.lock();w.info("[".concat(r._clientId,"]start massSubscribe user ").concat(n.map(_=>{let{user:E,mediaType:v}=_;return"user: ".concat(E?.uid,", mediaType: ").concat(v)}).join("; ")));const h=(n=[...n]).map(_=>{let{user:E,mediaType:v}=_;return{user:E,mediaType:v}}),p=yield r._p2pChannel.globalLock();try{var m;for(let E=n.length-1;E>=0;E--){const v=n[E],{user:b,mediaType:T}=v;if(gn(T,"mediaType",["audio","video"]),!b){const D=new W(M.INVALID_PARAMS,"user property does not exist in subscribeList item");throw w.error("[".concat(r._clientId,"] user property does not exist in subscribeList item")),D}if(!r._users.find(D=>D===b)){const D=new W(M.INVALID_REMOTE_USER,"user is not in the channel");w.error("[".concat(r._clientId,"] can not massSubscribe ").concat(b.uid,", this user is not in the channel")),h[E].error=D,n.splice(E,1);continue}if("audio"===T&&(!b.hasAudio||void 0===b._audioSSRC)||"video"===T&&(!b.hasVideo||void 0===b._videoSSRC)){const D=new W(M.REMOTE_USER_IS_NOT_PUBLISHED);w.error("[".concat(r._clientId,"] can not subscribe ").concat(b.uid," with mediaType ").concat(T,", remote user is not published")),h[E].error=D,n.splice(E,1);continue}const O=Pn.Video|Pn.LwoVideo,P=l.get(b);if(P){if("video"===T?P&O:P&Pn.Audio){n.splice(E,1),w.warning("[".concat(r._clientId,"] repeat massSubscribe user:").concat(b.uid,", mediaType:").concat(T," twice"));continue}l.set(b,P|("video"===T?O:Pn.Audio))}else l.set(b,"video"===T?O:Pn.Audio)}for(let E=n.length-1;E>=0;E--){const v=n[E],{user:b,mediaType:T}=v,O=Pn.Video|Pn.LwoVideo;if(r._p2pChannel.hasRemoteMedia(b,T)){yield r._p2pChannel.unmuteRemoteNoLock(b,T);const P=l.get(b);l.set(b,"video"===T?P^O:P^Pn.Audio),n.splice(E,1)}}r.store.massSubscribe(n.map(E=>({userId:E.user.uid,type:E.mediaType})),a);const _=al(m=Array.from(l.entries())).call(m,(E,v)=>{let[b,T]=v;if(0===T)return E;const O={stream_id:b.uid,stream_type:T};return T&Pn.Audio&&(O.audio_ssrc=b._audioSSRC),T&Pn.Video&&(O.video_ssrc=b._videoSSRC),E.push(O),E},[]);try{n.length>0&&(yield r._p2pChannel.massSubscribeNoLock(n.map(v=>{let{user:b,mediaType:T}=v;return{user:b,mediaType:T,ssrcId:T===ge.VIDEO?b._videoSSRC:b._audioSSRC,rtxSsrcId:T===ge.VIDEO?b._rtxSsrcId:void 0}})));const E=new Map;if(_.length>0){const v=yield r._gateway.subscribeAll(_,!0);(v?.users||[]).forEach(b=>{let{stream_id:T,video_error_code:O,audio_error_code:P,error_code:D}=b;(O||P||D)&&E.set(T,{video_error_code:O,audio_error_code:P,error_code:D})})}if(Array.from(E.entries()).length>0){const v=Array.from(E.entries()).map(b=>{let T,[O,P]=b;return P.error_code||P.video_error_code&&P.audio_error_code?T=void 0:P.video_error_code?T=ge.VIDEO:P.audio_error_code&&(T=ge.AUDIO),{user:r.remoteUsers.find(D=>D.uid===O),mediaType:T}});yield r._p2pChannel.massUnsubscribeNoLock(v)}for(const v of h){const b=E.get(v.user.uid);if(b){const T=b.error_code||"audio"===v.mediaType&&b.audio_error_code||"video"===v.mediaType&&b.video_error_code;if(T){const O=_l(T);w.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(O.desc)),v.error=new W(M.SUBSCRIBE_FAILED,"code ".concat(T,": ").concat(O.desc))}}v.error||(v.track="video"===v.mediaType?v.user.videoTrack:v.user.audioTrack)}return r.store.massSubscribe(h.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),h.forEach(v=>{var b;Se.subscribe(r.store.sessionId,{succ:!!v.error,ec:(null===(b=v.error)||void 0===b?void 0:b.code)||null,video:v.mediaType===ge.VIDEO,audio:v.mediaType===ge.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===ge.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:r.store.p2pId,eventElapse:Math.floor(performance.now()-a)},!0)}),w.info("[".concat(r._clientId,"] massSubscribe success ").concat(n.map(v=>{let{user:b,mediaType:T}=v;return"user: ".concat(b?.uid,", mediaType: ").concat(T)}).join("; "))),h}catch(E){throw yield r._p2pChannel.massUnsubscribeNoLock(n),E}}finally{p(),d()}})()}unsubscribe(n,r,a){var l=this;return x(function*(){if(r||l.store.useP2P){if("datachannel"===r)return l._unsubscribeDataChannel(n,a)}else yield l._unsubscribeDataChannel(n,a);if(r&&gn(r,"mediaType",["audio","video"]),!l._joinInfo)throw new W(M.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!l._users.find(h=>h===n)){const h=new W(M.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(l._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),h}w.info("[".concat(l._clientId,"] unsubscribe uid: ").concat(n.uid,", mediaType: ").concat(r));const d=yield l._subscribeMutex.lock();try{if(l._p2pChannel instanceof ln)yield l._gateway.sendExtensionMessage(Dt.UNSUBSCRIBE,{mediaType:r});else{const h=yield l._p2pChannel.unsubscribe(n,r);h&&(yield l._gateway.unsubscribe(h,n.uid)),w.info("[".concat(l._clientId,"] unsubscribe success uid: ").concat(n.uid,", mediaType: ").concat(r))}}catch(h){if(h.code===M.DISCONNECT_P2P)return void w.warning("disconnecting p2p, abort unsubscribe request.");throw w.error("[".concat(l._clientId,"] unsubscribe user ").concat(n.uid," error"),h.toString()),h}finally{d()}})()}_unsubscribeDataChannel(n,r){var a=this;return x(function*(){if(r&&ft(r,"id",0,65535,!0),!a._joinInfo)throw new W(M.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!a._users.find(d=>d===n)){const d=new W(M.INVALID_REMOTE_USER,"user is not in the channel");throw w.error("[".concat(a._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),d}let l;if("number"==typeof r){const d=n._dataChannels.find(h=>h.id===r);d&&(l=[d])}else l=n._dataChannels;if(void 0===l){const d=new W(M.REMOTE_USER_IS_NOT_PUBLISHED);throw w.error("[".concat(a._clientId,"] can not unsubscribe ").concat(n.uid," with channelId ").concat(r,", remote datachannel is not published")),d}w.info("[".concat(a._clientId,"] unsubscribe uid: ").concat(n.uid,", mediaType: datachannel, ids: ").concat(l.map(d=>d.id)));try{const d=yield a._p2pChannel.unsubscribeDataChannel(n,l);d&&(yield a._gateway.unsubscribeDataChannel(d,n.uid)),w.info("[".concat(a._clientId,"] unsubscribe datachannel success uid: ").concat(n.uid,", mediaType: datachannel, ids: ").concat(d))}catch(d){if(d.code===M.DISCONNECT_P2P)return void w.warning("disconnecting p2p, abort unsubscribe request.");throw w.error("[".concat(a._clientId,"] unsubscribe user ").concat(n.uid," error"),d.toString()),d}})()}massUnsubscribe(n){var r=this;return x(function*(){if(fo(n,"unsubscribeList"),!r._joinInfo)throw new W(M.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");w.info("[".concat(r._clientId,"] start massUnsubscribe ").concat(n.map(l=>{let{user:d,mediaType:h}=l;return"user: ".concat(d?.uid,", mediaType: ").concat(h,";")}).join())),n=[...n];const a=new Map;for(let l=n.length-1;l>=0;l--){const{user:d,mediaType:h}=n[l];if(!d){const m=new W(M.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw w.error("[".concat(r._clientId,"] user property does not exist in unsubscribeList item")),m}if(gn(h,"mediaType",["video","audio",void 0]),!r._users.find(m=>m===d)){w.warning("[".concat(r._clientId,"] can not unsubscribe ").concat(d.uid,", user is not in the channel")),n.splice(l,1);continue}const p=Pn.Video|Pn.LwoVideo;if(a.has(d)){const m=a.get(d);let _;switch(h){case"video":_=m&p;break;case"audio":_=m&Pn.Audio;break;default:_=m&(Pn.Audio|p)}if(_){w.warning("[".concat(r._clientId,"] repeat massUnsubscribe user:").concat(d.uid,",mediaType:").concat(h," twice.")),n.splice(l,1);continue}h?"audio"===h?a.set(d,m|Pn.Audio):"video"===h&&a.set(d,m|p):a.set(d,m|Pn.Audio|p)}else h?"audio"===h?a.set(d,Pn.Audio):"video"===h&&a.set(d,p):a.set(d,Pn.Audio|p)}try{const l=yield r._p2pChannel.massUnsubscribe(n);l&&(yield r._gateway.massUnsubscribe(l)),w.info("[".concat(r._clientId,"] massUnsubscribe success ").concat(n.map(d=>{let{user:h,mediaType:p}=d;return"user: ".concat(h?.uid,", mediaType: ").concat(p,";")}).join()))}catch(l){if(l.code===M.DISCONNECT_P2P)return void w.warning("[".concat(r._clientId,"] disconnecting p2p, abort unsubscribe request."));throw w.error("[".concat(r._clientId,"] massUnsubscribe error"),l.toString()),l}})()}setLowStreamParameter(n){var r=this;return x(function*(){(function(l){if(!l)throw new X(M.INVALID_PARAMS);kt(l.width)||sl(l.width,"streamParameter.width"),kt(l.height)||sl(l.height,"streamParameter.height"),kt(l.framerate)||sl(l.framerate,"streamParameter.framerate"),kt(l.bitrate)||ft(l.bitrate,"streamParameter.bitrate")})(n),(!n.width&&n.height||n.width&&!n.height)&&w.warning("[".concat(r._clientId,"] The width and height parameters take effect only when both are set")),w.info("[".concat(r._clientId,"] set low stream parameter to"),JSON.stringify(n));const a=r._configDistribute.getLowStreamConfigDistribute();if(a&&a.bitrate&&n.bitrate&&a.bitrate<n.bitrate&&(n.bitrate=a.bitrate),r._lowStreamParameter=n,r._isDualStreamEnabled)return r._p2pChannel.updateVideoStreamParameter(n,ne.LocalVideoLowTrack)})()}enableDualStream(){var n=this;return x(function*(){if(!$e().supportDualStream)throw Se.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new W(M.NOT_SUPPORTED,"Your browser is not support dual stream");if(n._isDualStreamEnabled)throw new W(M.INVALID_OPERATION,"Dual stream is already enabled");if(n._p2pChannel.canPublishLowStream())try{yield n._publishLowStream()}catch(r){throw Se.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),r}n._isDualStreamEnabled=!0,Se.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),w.info("[".concat(n._clientId,"] enable dual stream"))})()}disableDualStream(){var n=this;return x(function*(){if(n._isDualStreamEnabled){if(!n._joinInfo)throw new W(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(n._p2pChannel.getLocalMedia(ne.LocalVideoLowTrack))try{const r=yield n._p2pChannel.unpublishLowStream();r&&(yield n._gateway.unpublish(r,n._joinInfo.stringUid||n._joinInfo.uid))}catch(r){throw Se.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),r}n._isDualStreamEnabled=!1,Se.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),w.info("[".concat(n._clientId,"] disable dual stream"))}})()}setClientRole(n,r){var a=this;return x(function*(){if(gn(n,"role",["audience","host"]),r&&df(r),"rtc"===a.mode)throw w.warning("[".concat(a._clientId,"]rtc mode can not use setClientRole")),new W(M.INVALID_OPERATION,"rtc mode can not use setClientRole");if(r&&r.level&&"host"===n)throw new W(M.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===n&&a._p2pChannel.hasLocalMedia())throw new W(M.INVALID_OPERATION,"can not set client role to audience when publishing stream");yield a._gateway.setClientRole(n,r),a._config.role=n,w.info("[".concat(a._clientId,"] set client role to ").concat(n,", level: ").concat(r&&r.level))})()}getRemoteInboundOffset(){var n;const r=null===(n=this._p2pChannel.getStats())||void 0===n?void 0:n.audioSend[0];if(!r||!r.timestamp)return 0;const a=r.timestamp-Date.now();return Math.abs(a)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?a:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(n,r){if(Un(n,"proxyServer"),!r){if("DISCONNECTED"!==this.connectionState)throw new W(M.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new W(M.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=n,Se.setProxyServer(this._proxyServer),w.setProxyServer(this._proxyServer),w.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(n,r){if(Array.isArray(n)||(n=[n]),!r){if("DISCONNECTED"!==this.connectionState)throw new W(M.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new W(M.INVALID_OPERATION,"You have already set the proxy")}if(Aa(n))return this._turnServer={servers:n,mode:"original-manual"},void w.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(n.map(a=>a.urls).join(","),"."));n.forEach(a=>Bg(a)),this._turnServer={servers:n,mode:"manual"},w.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(n){if("DISCONNECTED"!==this.connectionState)throw new W(M.INVALID_OPERATION,"you should set license before join channel");if(Un(n,"license",32,32),!/^[A-Za-z\d]+$/.test(n))throw new W(M.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=n,w.info("[".concat(this._clientId,"] set license success"),n)}startProxyServer(n){if("DISCONNECTED"!==this.connectionState)throw new W(M.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new W(M.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let a;switch(void 0===n&&(n=3),n){case 1:case 2:throw new W(M.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:a="proxy3";break;case 4:a="proxy4";break;case 5:a="proxy5";break;default:throw new W(M.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=a,this.store.cloudProxyServerMode=a,w.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new W(M.INVALID_OPERATION,"Stop proxy server after leave channel");Se.setProxyServer(),w.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",w.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(n){if(!n.accessPoints)throw new W(M.INVALID_PARAMS,"accessPoints is required.");fo(n.accessPoints.serverList,"accessPoints.serverList"),Un(n.accessPoints.domain,"accessPoints.domain");const r=(T,O)=>{ft(T,O,0,65535,!0)};let a=443;if(n.accessPoints.port&&(r(n.accessPoints.port,"accessPoints.port"),a=n.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new W(M.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");j("CLOSE_AFB_FOR_LOCAL_AP")&&(At("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),At("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const l=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,d=n.accessPoints.domain,h=n.accessPoints.serverList.map(T=>l.test(T)?"".concat(T.replace(/\./g,"-"),".").concat(d):T),p=h.map(T=>"".concat(T,":").concat(a));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,At("WEBCS_DOMAIN",p),At("WEBCS_DOMAIN_BACKUP_LIST",p),At("GATEWAY_DOMAINS",[d]),n.report&&n.report.hostname&&Array.isArray(n.report.hostname)&&n.report.hostname.length?(fo(n.report.hostname,"report.hostname"),At("EVENT_REPORT_DOMAIN",n.report.hostname[0]),At("EVENT_REPORT_BACKUP_DOMAIN",n.report.hostname[1]||n.report.hostname[0])):(At("EVENT_REPORT_DOMAIN",h[0]),At("EVENT_REPORT_BACKUP_DOMAIN",h[1]||h[0]));let m=6443;n.report&&n.report.port&&(r(n.report.port,"report.port"),m=n.report.port),At("STATS_COLLECTOR_PORT",m),At("ENABLE_EVENT_REPORT",!!n.report);let _="";n.log&&n.log.hostname&&Array.isArray(n.log.hostname)&&n.log.hostname.length?(fo(n.log.hostname,"log.hostname"),_=n.log.hostname[0]):_=h[0];let E=6444;n.log&&n.log.port&&(r(n.log.port,"log.port"),E=n.log.port),At("LOG_UPLOAD_SERVER","".concat(_,":").concat(E));let v=[];n.cds&&n.cds.hostname&&Array.isArray(n.cds.hostname)&&n.cds.hostname.length?(fo(n.cds.hostname,"cds.hostname"),v=n.cds.hostname):v=h;let b=443;n.cds&&n.cds.port&&(r(n.cds.port,"cds.port"),b=n.cds.port),At("CDS_AP",v.map(T=>"".concat(T,":").concat(b))),At("ENABLE_CONFIG_DISTRIBUTE",!!n.cds),w.info("set local access point v2 success")}setLocalAccessPoints(n,r){if(fo(n,"serverList"),Un(r,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new W(M.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const a=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;n=n.map(l=>a.test(l)?"".concat(l.replace(/\./g,"-"),".").concat(r):l),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,At("WEBCS_DOMAIN",n),At("WEBCS_DOMAIN_BACKUP_LIST",n),At("GATEWAY_DOMAINS",[r]),At("EVENT_REPORT_DOMAIN",n[0]),At("EVENT_REPORT_BACKUP_DOMAIN",n[1]||n[0]),At("LOG_UPLOAD_SERVER","".concat(n[0],":6444")),w.info("[".concat(this._clientId,"] set local access point success"))}setRemoteDefaultVideoStreamType(n){var r=this;return x(function*(){if(gn(n,"streamType",[0,1]),r._remoteDefaultVideoStreamType=n,r._joinInfo)try{yield r._gateway.setDefaultRemoteVideoStreamType(n),r._joinInfo.defaultVideoStream=r._remoteDefaultVideoStreamType}catch(a){throw w.error("[".concat(r._clientId,"] set default remote video stream type error"),a.toString()),a}else w.debug("[".concat(r._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(n))})()}setRemoteVideoStreamType(n,r){var a=this;return x(function*(){gn(r,"streamType",[0,1]);try{yield a._gateway.setRemoteVideoStreamType(n,r),setTimeout(()=>{const l=a._users.find(d=>d.uid===n);l&&l.videoTrack&&l.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(l){throw w.error("[".concat(a._clientId,"] set remote video stream type error"),l.toString()),l}w.info("[".concat(a._clientId,"] set remote ").concat(n," video stream type to ").concat(r)),a._remoteStreamTypeCacheMap.set(n,r)})()}setStreamFallbackOption(n,r){var a=this;return x(function*(){gn(r,"fallbackType",[0,1,2]);try{yield a._gateway.setStreamFallbackOption(n,r)}catch(l){throw w.error("[".concat(a._clientId,"] set stream fallback option"),l.toString()),l}w.info("[".concat(a._clientId,"] set remote ").concat(n," stream fallback type to ").concat(r)),a._streamFallbackTypeCacheMap.set(n,r)})()}setEncryptionConfig(n,r,a){gn(n,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"]),Un(r,"secret");const l=["aes-128-gcm2","aes-256-gcm2"];if(ye(l).call(l,n)){if(!a||!(a instanceof Uint8Array&&32===a.length))throw new W(M.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(a)throw new W(M.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(r)||w.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=n,this._encryptionSecret=r,a&&(this._encryptionSalt=oh(a))}renewToken(n){var r=this;return x(function*(){if(Un(n,"token",1,2047),!r._key||!r._joinInfo)throw new W(M.INVALID_OPERATION,"renewToken should not be called before user join");const a=r._key;r._key=n,r._joinInfo&&(r._joinInfo.token=n);const l=yield r._renewTokenMutex.lock();try{if(j("USE_NEW_TOKEN")){w.debug("[".concat(r._clientId,"] start renew token with ticket from unilbs"));const d=yield function dT(s,n,r){return uT.apply(this,arguments)}(r._joinInfo,r._axiosCancelSource.token,r._config.httpRetryConfig||Re);w.debug("[".concat(r._clientId,"] get ticket from unilbs success")),yield r._gateway.renewToken({token:n,ticket:d})}else w.debug("[".concat(r._clientId,"] start renew token without ticket")),yield r._gateway.renewToken({token:n});w.debug("[".concat(r._clientId,"] renewToken success"))}catch(d){throw r._key=a,r._joinInfo.token=a,w.error("[".concat(r._clientId,"] renewToken failed"),d.toString()),d}finally{l()}})()}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?w.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const n=this._p2pChannel.getAudioLevels();this.safeEmit(Xe.VOLUME_INDICATOR,n)},j("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const n=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return n.Duration=Math.round(r.duration/1e3),n}startLiveStreaming(n,r){var a=this;return x(function*(){if(!r){if("h264"!==a.codec)throw new W(M.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!a._p2pChannel.hasLocalMedia())throw new W(M.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(a._liveRawStreamingClient&&a._liveRawStreamingClient.hasUrl(n)||a._liveTranscodeStreamingClient&&a._liveTranscodeStreamingClient.hasUrl(n))throw new W(M.LIVE_STREAMING_TASK_CONFLICT);const l=r?Bn.TRANSCODE:Bn.RAW;return a._createLiveStreamingClient(l).startLiveStreamingTask(n,l)})()}setLiveTranscoding(n){return this._createLiveStreamingClient(Bn.TRANSCODE).setTranscodingConfig(n)}stopLiveStreaming(n){var r=this;return x(function*(){const a=[r._liveRawStreamingClient,r._liveTranscodeStreamingClient].filter(l=>l&&l.hasUrl(n));if(!a.length)throw new W(M.INVALID_PARAMS,"can not find live streaming url to stop");yield z.all(a.map(l=>l&&l.stopLiveStreamingTask(n)))})()}addInjectStreamUrl(n,r){var a=this;return x(function*(){if(!a._joinInfo)throw new W(M.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const l=a._createLiveStreamingClient(Bn.INJECT);l.setInjectStreamConfig(r,0),yield l.startLiveStreamingTask(n,Bn.INJECT)})()}removeInjectStreamUrl(){var n=this;return x(function*(){var r;const a=n._createLiveStreamingClient(Bn.INJECT),l=Array.from(yo(r=a.streamingTasks).call(r)).find(d=>d.mode===Bn.INJECT);if(!n._joinInfo||!l)throw new W(M.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");yield a.stopLiveStreamingTask(l.url)})()}startChannelMediaRelay(n){var r=this;return x(function*(){ov(n),yield r._createChannelMediaRelayClient().startChannelMediaRelay(n)})()}updateChannelMediaRelay(n){var r=this;return x(function*(){ov(n),yield r._createChannelMediaRelayClient().updateChannelMediaRelay(n)})()}stopChannelMediaRelay(){var n=this;return x(function*(){yield n._createChannelMediaRelayClient().stopChannelMediaRelay(),n._statsCollector.onStatsChanged&&(n._statsCollector.onStatsChanged=void 0)})()}sendStreamMessage(n){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new W(M.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof n||n instanceof Uint8Array)&&(n={payload:n}),"string"==typeof n.payload){const a=new TextEncoder;n.payload=a.encode(n.payload)}if(new Blob([n.payload]).size>1024)throw new W(M.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(Ce.DATA_STREAM,{payload:oh(n.payload),syncWithAudio:n.syncWithAudio,sendTs:Date.now()-FN},!r)}sendMetadata(n){if(!this._joinInfo)throw new W(M.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([n]).size>1024)throw new W(M.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ce.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:oh(n)})}sendCustomReportMessage(n){var r=this;return x(function*(){if(Array.isArray(n)||(n=[n]),n.forEach(Cf),!r._joinInfo)throw new W(M.INVALID_OPERATION,"can not send custom report, not joined");yield Se.sendCustomReportMessage(r._joinInfo.sid,n)})()}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}pickSVCLayer(n,r){var a=this;return x(function*(){gn(r.spatialLayer,"spatialLayer",[0,1,2,3]),gn(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{yield a._gateway.pickSVCLayer(n,r)}catch(l){throw w.error("[".concat(a._clientId,"] pick SVC layer failed"),l.toString()),l}})()}setRTM2Flag(n){if(gn(n,"flag",[0,1]),!this._joinInfo)throw new W(M.INVALID_OPERATION,"Can't setRtm2Flag, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new W(M.INVALID_OPERATION,"Can't setRtm2Flag in ".concat(this.connectionState," state"));return this._gateway.setRTM2Flag(n)}_reset(){if(w.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Er.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._pendingPublishedUsers=[],this._users.forEach(n=>{n._audioTrack&&n._audioTrack._destroy(),n._videoTrack&&n._videoTrack._destroy(),n._dataChannels&&(n._dataChannels.forEach(r=>r._close()),n._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Zn("client-publish"),this._subscribeMutex=new Zn("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(n,r){const a=n||Hg();w.debug(n?"[".concat(this._clientId,"] new Session ").concat(a):"[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a)),this._sessionId=a,this.store.sessionId=a,r?Se.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:r.channel,appid:r.appId,mode:this.mode}):this._joinInfo?Se.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&Se.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}_publishHighStream(n){var r=this;return x(function*(){if(!r._joinInfo||void 0===r._uid)throw new W(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new W(M.INVALID_OPERATION,"can not publish stream in ".concat(r.connectionState," state"));if("auto"===r._turnServer.mode&&j("FORCE_TURN")&&!j("TURN_ENABLE_TCP")&&!j("TURN_ENABLE_UDP"))throw new W(M.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");w.debug("[".concat(r._clientId,"] publish high stream"));try{if(r._p2pChannel instanceof ln){const l=yield r._p2pChannel.publish(n,r._isDualStreamEnabled,r._lowStreamParameter);if(l)try{yield r._gateway.sendExtensionMessage(Dt.PUBLISH,l)}catch(d){throw r._p2pChannel.unpublish(n),d}}else{const l=yield r._p2pChannel.publish(n,r._isDualStreamEnabled,r._lowStreamParameter),d=(yield l.next()).value;if(d){var a;let h;try{h=yield r._gateway.publish(r._uid,d,!0)}catch(p){if(p.code!==M.DISCONNECT_P2P)throw l.throw(p),p}yield l.next((null===(a=h)||void 0===a?void 0:a.ortc)||[])}r._p2pChannel.reportPublishEvent(!0,null);for(const h of n)h instanceof ze&&h._encoderConfig&&r._gateway.setVideoProfile(h._encoderConfig),!h.muted&&h.enabled||(yield r._p2pChannel.muteLocalTrack(h))}}catch(l){if(r._p2pChannel.reportPublishEvent(!1,l?.code,n),l?.code===M.WS_ABORT)return;throw l}})()}_publishLowStream(){var n=this;return x(function*(){if(!n._joinInfo||void 0===n._uid)throw new W(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==n.connectionState&&"RECONNECTING"!==n.connectionState)throw new W(M.INVALID_OPERATION,"can not publish stream in ".concat(n.connectionState," state"));w.debug("[".concat(n._clientId,"] publish low stream"));const r=n._configDistribute.getLowStreamConfigDistribute();r&&r.bitrate&&(n._lowStreamParameter||(n._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),n._lowStreamParameter&&n._lowStreamParameter.bitrate&&r.bitrate<n._lowStreamParameter.bitrate&&(n._lowStreamParameter.bitrate=r.bitrate));try{const l=yield n._p2pChannel.publishLowStream(n._lowStreamParameter),d=(yield l.next()).value;if(d){var a;let h;try{h=yield n._gateway.publish(n._uid,d,!0)}catch(p){if(p.code!==M.DISCONNECT_P2P)throw l.throw(p),p}l.next((null===(a=h)||void 0===a?void 0:a.ortc)||[]),n._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(l){if(n._p2pChannel.reportPublishEvent(!1,l?.code,void 0,!0),l?.code===M.WS_ABORT)return;throw l}})()}_createLiveStreamingClient(n){if(!this._joinInfo||!this._appId)return new W(M.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r=()=>new pT(this._joinInfo,this._config.websocketRetryConfig||Re,this._config.httpRetryConfig||Re),a=l=>{l.onLiveStreamError=(d,h)=>{Se.reportApiInvoke(this._sessionId,{name:Nn.ON_LIVE_STREAM_ERROR,options:[d,h],tag:Jt.TRACER}).onSuccess(),this.safeEmit(Xe.LIVE_STREAMING_ERROR,d,h)},l.onLiveStreamWarning=(d,h)=>{Se.reportApiInvoke(this._sessionId,{name:Nn.ON_LIVE_STREAM_WARNING,options:[d,h],tag:Jt.TRACER}).onSuccess(),this.safeEmit(Xe.LIVE_STREAMING_WARNING,d,h)},l.on(mh.REQUEST_WORKER_MANAGER_LIST,(d,h,p)=>{if(!this._joinInfo)return p(new W(M.INVALID_OPERATION,"can not find join info to get worker manager"));iv(d,this._joinInfo,this._axiosCancelSource.token,Re).then(h).catch(p)})};switch(n){case Bn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=r(),a(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Bn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=r(),a(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Bn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=r(),this._injectStreamingClient.on(mh.REQUEST_WORKER_MANAGER_LIST,(l,d,h)=>{if(!this._joinInfo)return h(new W(M.INVALID_OPERATION,"can not find join info to get worker manager"));iv(l,this._joinInfo,this._axiosCancelSource.token,Re).then(d).catch(h)}),this._injectStreamingClient.onInjectStatusChange=(l,d,h)=>{this.safeEmit(Xe.INJECT_STREAM_STATUS,l,d,h)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new W(M.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:n,sendResolutionHeight:r}=this.getLocalVideoStats();this._channelMediaRelayClient=new oN(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Re,this._config.httpRetryConfig||Re,{width:n,height:r}),this._channelMediaRelayClient.on("state",l=>{l===Ji.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(Xe.CHANNEL_MEDIA_RELAY_STATE,l)}),this._channelMediaRelayClient.on("event",l=>{this.safeEmit(Xe.CHANNEL_MEDIA_RELAY_EVENT,l)}),this._statsCollector.onStatsChanged=(l,d)=>{var h;"resolution"===l&&(null===(h=this._channelMediaRelayClient)||void 0===h||h.setVideoProfile(d))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(n,r){const{added:a,deleted:l}=n,d=[];Array.isArray(a)&&a.length>0&&a.forEach(h=>{const{uid:p,stream_id:m,ordered:_,max_retrans_times:E,metadata:v}=h,b=this._users.find(T=>T._uintid===p);if(b){if(w.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(p)),ye(d).call(d,b)||d.push(b),b._uintid||(b._uintid=p),-1===b._dataChannels.findIndex(T=>T.id===h.stream_id)){const T={id:m,ordered:!!_,maxRetransmits:E,metadata:v},O=new Mn(T);b._dataChannels.push(O),w.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published datachannel")),r||this.safeEmit(Xe.USER_PUBLISHED,b,"datachannel",T)}this._p2pChannel.hasPendingRemoteDataChannel(b,h.stream_id)&&(w.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(b.uid," after reconnect.")),this._subscribeDataChannel(b,h.stream_id).catch(T=>{w.error("[".concat(this._clientId,"] resubscribe datachannel error"),T.toString())}))}else w.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))}),r&&(this.safeEmit(Xe.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(l)&&l.length>0&&l.forEach(h=>{const{uid:p}=h,_=this._users.find(v=>v._uintid===p);if(!_)return void w.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const E=_._dataChannels.find(v=>v.id===h.stream_id);E&&(w.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(p)),this._p2pChannel.unsubscribeDataChannel(_,[E]).then(v=>{if(v)return _._dataChannels=_._dataChannels.filter(b=>b!==E),this._gateway.unsubscribeDataChannel(v,_.uid)}),w.info("[".concat(this._clientId,"] remote user ").concat(p," unpublished datachannel ,id:").concat(E.id)),this.safeEmit(Xe.USER_UNPUBLISHED,_,"datachannel",E._config))})}_handleRemoveDataChannels(n){const r=this._users.find(a=>a.uid===n.uid);if(r){if(void 0!==r._dataChannels&&r._dataChannels.length>0){w.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(n.uid));const a=()=>{w.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(l=>{this.safeEmit(Xe.USER_UNPUBLISHED,r,"datachannel",l._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(l=>{if(l)return this._gateway.unsubscribeDataChannel(l,r.uid)}),a()}}else w.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){var n=this;this._gateway.on(sn.DISCONNECT_P2P,x(function*(){yield n._p2pChannel.disconnectForReconnect()})),this._gateway.on(sn.CONNECTION_STATE_CHANGE,(r,a,l)=>{var d;if(l===Ye.FALLBACK)return;const h=()=>{this.safeEmit(Xe.CONNECTION_STATE_CHANGE,r,a,l)};if(Se.reportApiInvoke(this._sessionId||(null===(d=this._gateway.joinInfo)||void 0===d?void 0:d.sid)||null,{name:Nn.CONNECTION_STATE_CHANGE,options:[r,a,l],tag:Jt.TRACER}).onSuccess(JSON.stringify({cur:r,prev:a,reason:l})),w.info("[".concat(this._clientId,"] connection state change: ").concat(a," -> ").concat(r)),"DISCONNECTED"===r)return this._reset(),void h();if("RECONNECTING"===r)this._users.forEach(m=>{m._trust_in_room_=!1,m._trust_audio_enabled_state_=!1,m._trust_video_enabled_state_=!1,m._trust_audio_mute_state_=!1,m._trust_video_mute_state_=!1,m._trust_audio_stream_added_state_=!1,m._trust_video_stream_added_state_=!1,m._audioSSRC=void 0,m._videoSSRC=void 0,m._videoOrtc=void 0,m._audioOrtc=void 0,m._cname=void 0,m._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===r){var p;this._streamFallbackTypeCacheMap.forEach((m,_)=>{this._gateway.setStreamFallbackOption(_,m).catch(E=>{w.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),E)})}),this._remoteStreamTypeCacheMap.forEach((m,_)=>{this._gateway.setRemoteVideoStreamType(_,m).catch(E=>{w.warning("[".concat(this._clientId,"] auto set remote stream type failed"),E)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(p=this._joinInfo)||void 0===p?void 0:p.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{w.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(m=>{w.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(m))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(m=>!m._trust_in_room_).forEach(m=>{w.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(m.uid)),this._handleUserOffline({uid:m.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(m=>{m._trust_audio_mute_state_||(w.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(m.uid)),this._handleMuteStream(m.uid,ge.AUDIO,!1)),m._trust_video_mute_state_||(w.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(m.uid)),this._handleMuteStream(m.uid,ge.VIDEO,!1)),m._trust_audio_enabled_state_||(w.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(m.uid)),this._handleSetStreamLocalEnable("audio",m.uid,!0)),m._trust_video_enabled_state_||(w.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(m.uid)),this._handleSetStreamLocalEnable("video",m.uid,!0)),m._trust_video_stream_added_state_||(w.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(m.uid)),this._handleResetAddStream(m,"video")),m._trust_audio_stream_added_state_||(w.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(m.uid)),this._handleResetAddStream(m,"audio")),m._video_added_||m._audio_added_||(w.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(m.uid)),this._handleRemoveStream({uid:m.uid,uint_id:m._uintid}))}))},1e3))}h()}),this._gateway.on(sn.REQUEST_NEW_GATEWAY_LIST,(r,a)=>{if(!this._joinInfo)return a(new W(M.UNEXPECTED_ERROR,"can not recover, no join info"));nv(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Re,this.store).then(l=>{this._joinInfo&&(this._joinInfo.apResponse=l.gatewayInfo.res,this._joinInfo.gatewayAddrs=l.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=l.gatewayInfo.uni_lbs_ip);const d=[];l.gatewayInfo.gatewayAddrs.forEach(h=>{let{address:p}=h;const[m,_]=p.split(":");d.push(this._joinInfo&&this._joinInfo.proxyServer?{proxy:this._joinInfo.proxyServer,host:m,port:_}:{host:m,port:_})}),r(d)}).catch(a)}),this._gateway.on(sn.NETWORK_QUALITY,r=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(Xe.NETWORK_QUALITY,r)}),this._gateway.on(sn.STREAM_TYPE_CHANGE,(r,a)=>{this.safeEmit(Xe.STREAM_TYPE_CHANGED,r,a),Se.reportApiInvoke(this._sessionId,{name:Nn.STREAM_TYPE_CHANGE,options:[r,a],tag:Jt.TRACER}).onSuccess(JSON.stringify({uid:r,streamType:a}))}),this._gateway.on(sn.IS_P2P_DISCONNECTED,r=>{this._p2pChannel.isP2PDisconnected()?r(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?r(!1):r(!0)}),this._gateway.on(sn.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(sn.REQUEST_P2P_CONNECTION_PARAMS,function(){var r=x(function*(a,l,d){try{l(yield n._p2pChannel.startP2PConnection(a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.on(sn.JOIN_RESPONSE,(r,a)=>{if(this.store.useP2P)return;const{dtlsParameters:l,iceParameters:d,candidates:h,rtpCapabilities:p,setup:m,cname:_}=uN(r.ortc,a);this._p2pChannel.connect(d,l,h,p,m,_)}),this._gateway.on(sn.REQUEST_DC_CONNECTION_PARAMS,r=>{r(this._p2pChannel.getEstablishParams())}),this._gateway.on(sn.RESET_SIGNAL,r=>{this._p2pChannel.resetConnection(r),this._handleGatewaySignalEvents()}),this._gateway.on(sn.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(sn.DATACHANNEL_PRECONNECT,function(){var r=x(function*(a,l,d,h){var p,m,_,E,v,b;yield n._p2pChannel.startP2PConnection({turnServer:null===(p=n._joinInfo)||void 0===p?void 0:p.turnServer},!0);const T=function(O,P){let D;return P&&P.ip&&"number"==typeof P.port?(D=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:P.ip,port:P.port.toString(),type:"host",extension:{}}],w.debug("Using remote candidate from AP ".concat(P.ip,":").concat(P.port)),P.ip6&&(D.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:P.ip6,port:P.port.toString(),type:"host",extension:{}}),w.debug("Using IPV6 remote candidate from AP ".concat(P.ip6,":").concat(P.port)))):D=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:O.ip,port:O.port.toString(),type:"host",extension:{}}],D}(a,l);return n._p2pChannel.preConnect({iceUfrag:"".concat(null===(m=n._joinInfo)||void 0===m?void 0:m.apResponse.cid,"_").concat(null===(_=n._joinInfo)||void 0===_?void 0:_.apResponse.cert),icePwd:"".concat(null===(E=n._joinInfo)||void 0===E?void 0:E.apResponse.cid,"_").concat(null===(v=n._joinInfo)||void 0===v?void 0:v.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(b=j("FINGERPRINT"))&&void 0!==b?b:a.fingerprint}]},T,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(d).catch(h)});return function(a,l,d,h){return r.apply(this,arguments)}}())}_handleGatewaySignalEvents(){var n=this;this._gateway.signal.on(Ue.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Ue.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Ue.ON_ADD_AUDIO_STREAM,r=>this._handleAddAudioOrVideoStream("audio",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc)),this._gateway.signal.on(Ue.ON_ADD_VIDEO_STREAM,r=>this._handleAddAudioOrVideoStream("video",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc,r.rtxSsrcId)),this._gateway.signal.on(Ue.ON_REMOTE_DATASTREAM_UPDATE,r=>{this._handleUpdateDataChannel(r)}),this._gateway.signal.on(Ue.ON_REMOTE_FULL_DATASTREAM_INFO,r=>{this._handleUpdateDataChannel({added:r.datastreams,deleted:[]},!0)}),this._gateway.signal.on(Ue.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Ue.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Ue.MUTE_AUDIO,r=>this._handleMuteStream(r.uid,ge.AUDIO,!0)),this._gateway.signal.on(Ue.UNMUTE_AUDIO,r=>this._handleMuteStream(r.uid,ge.AUDIO,!1)),this._gateway.signal.on(Ue.MUTE_VIDEO,r=>this._handleMuteStream(r.uid,ge.VIDEO,!0)),this._gateway.signal.on(Ue.UNMUTE_VIDEO,r=>this._handleMuteStream(r.uid,ge.VIDEO,!1)),this._gateway.signal.on(Ue.RECEIVE_METADATA,r=>{const a=jg(r.metadata);this.safeEmit(Xe.RECEIVE_METADATA,r.uid,a)}),this._gateway.signal.on(Ue.ON_DATA_STREAM,function(){var r=x(function*(a){if(!a)return;let l=0;if(a.ordered||a.syncWithAudio){const d=n._p2pChannel.getStats(),h=n.remoteUsers.find(m=>m.uid===a.uid),p=d?.audioRecv.find(m=>m.ssrc===h?._audioSSRC);l=p?.jitterBufferMs}null==l&&(l=0),function a3(s){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!s.syncWithAudio)return HT(r,{uid:s.uid,payload:jg(s.payload)});const a="".concat(r.id,"-").concat(s.uid),l=jT.get(a)||[],d=l.findIndex(_=>s.sendTs>=_.sendTs),h=LN(LN({},s),{},{context:r,mediaDelay:n,recvTs:Date.now()});-1===d?l.push(h):l.splice(d,0,h),jT.set(a,l);let p=!1;var m;vv.has(a)?p=!(null===(m=vv.get(a))||void 0===m||!m.isSyncing):vv.set(a,{isSyncing:p,firstRecvTs:0,firstSendTs:0}),p||M2(a)}(a,l,{id:n._clientId,onStreamMessage:"function"==typeof n.onStreamMessage?n.onStreamMessage.bind(n):void 0,safeEmit:n.safeEmit.bind(n)})});return function(a){return r.apply(this,arguments)}}()),this._gateway.signal.on(Ue.ON_CRYPT_ERROR,()=>{uf(()=>{w.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Xe.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Ue.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Ue.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{w.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ye.TOKEN_EXPIRE),this.safeEmit(Xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Ue.ON_STREAM_FALLBACK_UPDATE,r=>{w.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(r.stream_id,", attr: ").concat(r.stream_type)),this.safeEmit(Xe.STREAM_FALLBACK,r.stream_id,1===r.stream_type?"fallback":"recover")}),this._gateway.signal.on(Ue.ON_PUBLISH_STREAM,r=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:r.proxy})),w.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(r))))}),this._gateway.signal.on(Ue.ENABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!0)}),this._gateway.signal.on(Ue.DISABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!1)}),this._gateway.signal.on(he.REQUEST_TIMEOUT,(r,a)=>{if(this._joinInfo)switch(r){case Ce.PUBLISH:{if(!a)return;const h=a.ortc;if(h){var l,d;const p=h.some(E=>{let{stream_type:v}=E;return v===It.Audio}),m=h.some(E=>{let{stream_type:v}=E;return v!==It.Audio}),_=h.some(E=>{let{stream_type:v}=E;return v===It.Screen||v===It.ScreenLow});"offer"===a.state&&Se.publish(this._joinInfo.sid,{eventElapse:Di.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:M.TIMEOUT,audio:p,video:m,p2pid:a.p2p_id,publishRequestid:this.store.pubId,screenshare:_,audioName:p?null===(l=h.find(E=>{let{stream_type:v}=E;return v===It.Audio}))||void 0===l||null===(l=l.ssrcs[0])||void 0===l?void 0:l.ssrcId.toString():void 0,videoName:m?null===(d=h.find(E=>{let{stream_type:v}=E;return v!==It.Audio}))||void 0===d||null===(d=d.ssrcs[0])||void 0===d?void 0:d.ssrcId.toString():void 0})}break}case Ce.SUBSCRIBE:a&&Se.subscribe(this._joinInfo.sid,{succ:!1,ec:M.TIMEOUT,audio:a.stream_type===ge.AUDIO,video:a.stream_type===ge.VIDEO,peerid:a.stream_id,subscribeRequestid:a.ssrcId,p2pid:this.store.p2pId,eventElapse:Di.measureFromSubscribeStart(this.store.clientId,a.ssrcId)})}}),this._gateway.signal.on(Ue.ON_P2P_OK,r=>{}),this._gateway.signal.on(Ue.ON_PUBLISHED_USER_LIST,r=>{if(null==r||!r.users)return;j("BLOCK_LOCAL_CLIENT")&&(r.users=r.users.filter(d=>!hl(d.string_id||d.stream_id,this.channelName)));const a=[],l=[];for(const d of r.users){let h=this._users.find(b=>b._uintid===d.stream_id);h?h._trust_in_room_=!0:(h=new Oi(d.string_id||d.stream_id,d.stream_id),this._users.push(h),0===this.getListeners(Xe.PUBLISHED_USER_LIST).length&&(w.debug("[".concat(this._clientId,"] user online"),d.stream_id),this.safeEmit(Xe.USER_JOINED,h)));const p=Pn.Audio&d.stream_type,m=(Pn.Video|Pn.LwoVideo)&d.stream_type,_=0!=(65280&d.stream_type),E=p&&h.hasAudio,v=m&&h.hasVideo;m&&(h._trust_video_stream_added_state_=!0,h._video_added_=!0,h._videoSSRC=d.video_ssrc,h._rtxSsrcId=d.video_rtx),p&&(h._trust_audio_stream_added_state_=!0,h._audio_added_=!0,h._audioSSRC=d.audio_ssrc),p&&!E&&0===this.getListeners(Xe.PUBLISHED_USER_LIST).length&&(w.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published audio")),this.safeEmit(Xe.USER_PUBLISHED,h,"audio")),m&&!v&&0===this.getListeners(Xe.PUBLISHED_USER_LIST).length&&(w.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published video")),this.safeEmit(Xe.USER_PUBLISHED,h,"video")),(p&&!E||m&&!v||_)&&a.push(h),m&&this._p2pChannel.hasPendingRemoteMedia(h,"video")&&l.push({user:h,mediaType:"video"}),p&&this._p2pChannel.hasPendingRemoteMedia(h,"audio")&&l.push({user:h,mediaType:"audio"})}l.length>0&&(w.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(l.map(d=>"user: ".concat(d.user.uid,", mediaType: ").concat(d.mediaType)).join("; ")," ")),this.massSubscribe(l).catch(d=>{w.error("[".concat(this._clientId,"] mass resubscribe error"),d.toString())})),this.getListeners(Xe.PUBLISHED_USER_LIST).length>0?j("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=a:(w.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(a.map(d=>d.uid).join(", "))),this.safeEmit(Xe.PUBLISHED_USER_LIST,a)):w.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(a.map(d=>d.uid).join(", ")))}),this._gateway.signal.on(Ue.ON_RTP_CAPABILITY_CHANGE,r=>{const{video_codec:a}=r;this._p2pChannel instanceof li&&this._p2pChannel.updateRemoteRTPCapabilities(a.map(l=>l.toLowerCase()).filter(l=>{var d;return ye(d=Object.keys(Vi)).call(d,l)}))})}_handleP2PEvents(){var n=this;this._gateway.signal.on(Ue.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Dt.PUBLISH,function(){var r=x(function*(a,l){a.forEach(d=>d.kind===ge.VIDEO?(n._handleP2PAddAudioOrVideoStream("video",l),n._handleMuteStream(l,ge.VIDEO,!!d.isMuted)):(n._handleP2PAddAudioOrVideoStream("audio",l),n._handleMuteStream(l,ge.AUDIO,!!d.isMuted)))});return function(a,l){return r.apply(this,arguments)}}()),this._gateway.signal.on(he.P2P_START,function(){var r=x(function*(a,l){var d;n._p2pChannel instanceof ln&&l(yield n._p2pChannel.startP2P({turnServer:null===(d=n._joinInfo)||void 0===d?void 0:d.turnServer},a))});return function(a,l){return r.apply(this,arguments)}}()),this._gateway.signal.on(he.P2P_CONNECTION,function(){var r=x(function*(a){n._p2pChannel instanceof ln&&(yield n._p2pChannel.p2pConnect(a))});return function(a){return r.apply(this,arguments)}}()),this._gateway.signal.on(he.P2P_REMOTE_CANDIDATE_UPDATE,r=>{this._p2pChannel instanceof ln&&this._p2pChannel.addRemoteCandidate(JSON.parse(r))}),this._gateway.signal.on(Dt.SUBSCRIBE,function(){var r=x(function*(a,l,d){if(n._p2pChannel instanceof ln){const{trackType:h}=JSON.parse(a);try{yield n._p2pChannel.dopublish(h),l()}catch(p){d(p)}}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(Dt.UNSUBSCRIBE,function(){var r=x(function*(a,l,d){if(n._p2pChannel instanceof ln){const{mediaType:h}=JSON.parse(a);try{yield n._p2pChannel.doUnpublish(h),l()}catch(p){d(p)}}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(Dt.EXCHANGE_SDP,function(){var r=x(function*(a,l,d){if(n._p2pChannel instanceof ln){const{type:h,sdp:p}=JSON.parse(a);try{l(yield n._p2pChannel.setDescription(h,p))}catch(m){d(m)}}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(Dt.UNPUBLISH,function(){var r=x(function*(a,l,d){if(n._p2pChannel instanceof ln){const{unpubMsg:h,uid:p}=a;if(1===h.length){const m=h[0].stream_type===It.Audio?ge.AUDIO:ge.VIDEO;n._handleMuteStream(p,m,!0);const{sdp:_}=a;if(n._p2pChannel instanceof ln&&_){const E=n._users.find(v=>v.uid===p);if(!E)return w.warning("[".concat(n._clientId,"] can not find remote user, ignore mute event, uid: ").concat(p)),void l();n._p2pChannel.unsubscribe(E,_,m).then(v=>{v&&l(v)}).catch(d)}else l()}else n._handleRemoveStream(a,l,d)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(Dt.CONTROL,function(){var r=x(function*(a,l,d){const{action:h,sdp:p,isMuteAll:m,uid:_}=a;switch(h){case ys.MUTE_LOCAL_VIDEO:n._handleMuteStream(_,ge.VIDEO,!0,p,l,d);break;case ys.MUTE_LOCAL_AUDIO:l(),n._handleMuteStream(_,ge.AUDIO,!0);break;case ys.UNMUTE_LOCAL_VIDEO:l(),n._handleP2PAddAudioOrVideoStream("video",_),n._handleMuteStream(_,ge.VIDEO,!1);break;case ys.UNMUTE_LOCAL_AUDIO:l(),n._handleP2PAddAudioOrVideoStream("audio",_),n._handleMuteStream(_,ge.AUDIO,!1)}m&&n._handleRemoveStream(a,l,d)});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(Dt.DO_SUBSCRIBE,function(){var r=x(function*(a,l,d){if(n._p2pChannel instanceof ln){const{kind:h,sdp:p,ssrcId:m,uid:_}=a,E=n._users.find(v=>v.uid===_);if(!E)return w.error("[".concat(n._clientId,"] can not find target user!(on_add_stream)")),void l();try{l(yield n._p2pChannel.subscribe(E,h,p,m))}catch(v){d(v)}}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(Dt.DO_UNSUBSCRIBE,function(){var r=x(function*(a,l,d){if(n._p2pChannel instanceof ln){const{uid:h,kind:p,sdp:m}=a,_=n._users.find(E=>E.uid===h);if(!_)return w.error("[".concat(n._clientId,"] can not find target user!(on_add_stream)")),void l();try{l(yield n._p2pChannel.unsubscribe(_,m,p))}catch(E){d(E)}}});return function(a,l,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(Dt.RESTART_ICE,function(){var r=x(function*(a,l,d){if(n._p2pChannel instanceof ln)try{l(yield n._p2pChannel.setDescription("remote",a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestP2PRestartICE,function(){var r=x(function*(a,l,d){try{l(yield n._gateway.sendExtensionMessage(Dt.RESTART_ICE,a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.LocalCandidate,r=>{this._gateway.sendExtensionMessage(Dt.CANDIDATE,JSON.stringify(r))}),this._p2pChannel.on(we.RequestP2PMuteLocal,function(){var r=x(function*(a,l,d){try{l(yield n._gateway.sendExtensionMessage(Dt.CONTROL,a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestP2PPublish,function(){var r=x(function*(a,l,d){try{l(yield n._gateway.sendExtensionMessage(Dt.DO_SUBSCRIBE,a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestP2PUnPublish,function(){var r=x(function*(a,l,d){try{l(yield n._gateway.sendExtensionMessage(Dt.DO_UNSUBSCRIBE,a))}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestP2PUnmuteRemote,function(){var r=x(function*(a,l,d){if(n._joinInfo)try{yield n._gateway.unmuteRemote(a,n._joinInfo.stringUid||n._joinInfo.uid),l()}catch(h){h.code===M.DISCONNECT_P2P?l():d(h)}else l()});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestP2PMuteRemote,function(){var r=x(function*(a,l,d){if(n._joinInfo)try{yield n._gateway.muteRemote(a,n._joinInfo.stringUid||n._joinInfo.uid),l()}catch(h){h.code===M.DISCONNECT_P2P?l():d(h)}else l()});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.StateChange,(r,a)=>{a===it.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){var n=this;this._p2pChannel.on(we.RequestMuteLocal,function(){var r=x(function*(a,l,d){if(n._joinInfo)try{yield n._gateway.muteLocal(a,n._joinInfo.stringUid||n._joinInfo.uid),l()}catch(h){h.code===M.DISCONNECT_P2P?l():d(h)}else l()});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestUnmuteLocal,function(){var r=x(function*(a,l,d){if(n._joinInfo)try{yield n._gateway.unmuteLocal(a,n._joinInfo.stringUid||n._joinInfo.uid),l()}catch(h){h.code===M.DISCONNECT_P2P?l():d(h)}else l()});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestRePublish,(r,a,l)=>{this.publish(r,!1).then(a).catch(l)}),this._p2pChannel.on(we.RequestRePublishDataChannel,(r,a,l)=>{z.all(r.map(function(){var d=x(function*(h){yield n._p2pChannel.publishDataChannel([h]);const p={streamId:h.id,ordered:h.ordered,maxRetransmits:h.maxRetransmits,metadata:h.metadata,channelId:h._originDataChannelId};try{yield n._gateway.publishDataChannel(n._uid,p,!0)}catch(m){if(m.code!==M.DISCONNECT_P2P)throw m}});return function(h){return d.apply(this,arguments)}}())).then(a).catch(l)}),this._p2pChannel.on(we.RequestReSubscribe,function(){var r=x(function*(a,l,d){try{for(const{user:h,kind:p}of a)p===ge.VIDEO?yield n.subscribe(h,"video"):yield n.subscribe(h,"audio");l()}catch(h){d(h)}});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestUploadStats,(r,a)=>{this._gateway.uploadStats(r,a)}),this._p2pChannel.on(we.MediaReconnectStart,r=>{this.safeEmit(Xe.MEDIA_RECONNECT_START,r)}),this._p2pChannel.on(we.MediaReconnectEnd,r=>{this.safeEmit(Xe.MEDIA_RECONNECT_END,r)}),this._p2pChannel.on(we.NeedSignalRTT,r=>{r(this._gateway.getSignalRTT())}),this._p2pChannel.on(we.RequestRestartICE,function(){var r=x(function*(a){if(n._p2pChannel instanceof ln)return;const l=yield n._p2pChannel.restartICE(a),d=yield l.next();if(d.done)return;const h=d.value;let p;try{p=yield n._gateway.restartICE({iceParameters:h})}catch(_){return void l.throw(_)}const{iceParameters:m}=function(_){const E=_.iceParameters;return{iceParameters:{iceUfrag:E.iceUfrag,icePwd:E.icePwd}}}(p);yield l.next({remoteIceParameters:m})});return function(a){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.RequestReconnect,x(function*(){n._gateway.reconnect()})),this._p2pChannel.on(we.RequestReconnectPC,x(function*(){var r;const{iceParameters:a,dtlsParameters:l,rtpCapabilities:d}=yield n._p2pChannel.startP2PConnection({turnServer:null===(r=n._joinInfo)||void 0===r?void 0:r.turnServer}),{gatewayEstablishParams:h,gatewayAddress:p}=yield n._gateway.reconnectPC({iceParameters:a,dtlsParameters:l,rtpCapabilities:d}),{dtlsParameters:m,iceParameters:_,candidates:E,rtpCapabilities:v,setup:b,cname:T}=uN(h,p);yield n._p2pChannel.connect(_,m,E,v,b,T),yield n._p2pChannel.republish(),yield n._p2pChannel.reSubscribe()})),this._p2pChannel.on(we.RequestUnpublishForReconnectPC,function(){var r=x(function*(a,l,d){n._joinInfo&&void 0!==n._uid?(yield n._gateway.unpublish(a,n._uid),l()):d()});return function(a,l,d){return r.apply(this,arguments)}}()),this._p2pChannel.on(we.P2PLost,()=>{this.safeEmit(Xe.P2P_LOST,this.store.uid)}),this._p2pChannel.on(we.UpdateVideoEncoder,r=>{r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig)}),this._p2pChannel.on(we.ConnectionTypeChange,r=>{this.safeEmit(Xe.IS_USING_CLOUD_PROXY,r)}),this._p2pChannel.on(we.RequestLowStreamParameter,r=>{r(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(we.QueryClientConnectionState,r=>{r(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}enableContentInspect(n){var r=this;return x(function*(){if("CONNECTED"!==r.connectionState||!r._joinInfo)throw new W(M.INVALID_OPERATION,"[".concat(r._clientId,"] Client did not join channel"));if(r._inspect)throw new W(M.INVALID_OPERATION,"[".concat(r._clientId,"] Inspect content service already in connecting/connected state"));if(!n)throw new W(M.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig is necessary"));if(!n.inspectType||!Array.isArray(n.inspectType))throw new W(M.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const a=[...new Set(n.inspectType)];a.forEach(l=>{var d;if(!ye(d=["supervise","moderation"]).call(d,l))throw new W(M.INVALID_PARAMS,"[".concat(r._clientId,"] ").concat(l," is not a valid inspect type."))}),n.inspectType=a}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new W(M.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const a=new _v(n);r._inspect=a,r.handleVideoInspectEvents(r._inspect),yield a.init({appId:r._joinInfo.appId,areaCode:"",cname:r._joinInfo.cname,sid:r._joinInfo.sid,token:r._joinInfo.token,uid:r._joinInfo.uid,cid:r._joinInfo.cid,vid:r._joinInfo.vid?Number(r._joinInfo.vid):0},Re)}catch(a){throw Array.isArray(a)?a[0]:a}})()}disableContentInspect(){var n=this;return x(function*(){if(!n._inspect)throw new W(M.INVALID_OPERATION,"[".concat(n._clientId,"] inspectVideoContent not started"));try{n._inspect.close(),n._inspect=void 0}catch(r){throw Array.isArray(r)?r[0]:r}})()}setImageModeration(n,r){var a=this;return x(function*(){if(_s(n,"enabled"),n){if(!r)throw new W(M.INVALID_PARAMS,"[".concat(a._clientId,"] config is necessary"));if(ft(r.interval,"interval",1e3,1/0),"CONNECTED"!==a.connectionState||!a._joinInfo)throw new W(M.INVALID_OPERATION,"[".concat(a._clientId,'] can not enable image moderation, not joined"'));try{if(a._moderation)return void a._moderation.updateConfig(r);const l=new VT(r);a._moderation=l,a.handleImageModerationEvents(a._moderation),yield l.init({appId:a._joinInfo.appId,areaCode:"",cname:a._joinInfo.cname,sid:a._joinInfo.sid,token:a._joinInfo.token,uid:a._joinInfo.uid,cid:a._joinInfo.cid,vid:a._joinInfo.vid?Number(a._joinInfo.vid):0},Re)}catch(l){throw Array.isArray(l)?l[0]:l}}else{if(!a._moderation)throw new W(M.INVALID_OPERATION,"[".concat(a._clientId,"] image moderation not started"));try{a._moderation.close(),a._moderation.removeAllListeners(),a._moderation=void 0}catch(l){throw Array.isArray(l)?l[0]:l}}})()}handleImageModerationEvents(n){n.on(Jo.CONNECTION_STATE_CHANGE,(r,a)=>{if(this.safeEmit(Xe.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,a),r===Mr.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new W(M.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");n.inspectImage()}}),n.on(Jo.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(a=>"video"===a.trackMediaType)[0])})}handleVideoInspectEvents(n){n.on(jn.CONNECTION_STATE_CHANGE,(r,a)=>{if(this.safeEmit(Xe.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,a),a===Pr.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(Xe.CONTENT_INSPECT_ERROR,new W(M.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));n.inspectImage()}}),n.on(jn.INSPECT_RESULT,(r,a)=>{var l;if(a?.code===M.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return w.debug("Stop inspect content because that has left channel"),null==this||null===(l=this._inspect)||void 0===l||l.close(),void(this._inspect=void 0);this.safeEmit(Xe.CONTENT_INSPECT_RESULT,r,a)}),n.on(jn.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(a=>"video"===a.trackMediaType)[0])})}getJoinChannelServiceRecords(){return w.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}setPublishAudioFilterEnabled(n){var r=this;return x(function*(){_s(n,"enabled"),At("ENABLE_PUBLISH_AUDIO_FILTER",n),r._joinInfo&&(yield r._gateway.setPublishAudioFilterEnabled(n))})()}_handleResetAddStream(n,r){switch(r){case"audio":n._audio_added_=!1,n._trust_audio_stream_added_state_=!0;break;case"video":n._video_added_=!1,n._trust_video_stream_added_state_=!0}}}te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],Nt.prototype,"leave",null),te([Ae({argsMap:(s,n)=>{if(!Array.isArray(n)){if(!(n instanceof Ri))return[n];n=[n]}return n.map(r=>r?Object(r).toString():"null")}}),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",z)],Nt.prototype,"publish",null),te([Ae({argsMap:(s,n)=>(n||(n=[]),n instanceof Ro?[n.getChannelId()]:(Array.isArray(n)||(n=[n]),n.map(r=>r.getTrackId())))}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],Nt.prototype,"unpublish",null),te([Ae({argsMap:(s,n,r,a)=>[n.uid,r,a]}),N("design:type",Function),N("design:paramtypes",[Oi,String,Number]),N("design:returntype",z)],Nt.prototype,"subscribe",null),te([Ae({argsMap:(s,n)=>n.map(r=>{let{user:a,mediaType:l}=r;return[a?.uid,l]})}),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Nt.prototype,"massSubscribe",null),te([Ae({argsMap:(s,n,r,a)=>[n.uid,r,a]}),N("design:type",Function),N("design:paramtypes",[Oi,String,Number]),N("design:returntype",z)],Nt.prototype,"unsubscribe",null),te([Ae({argsMap:(s,n)=>n.map(r=>{let{user:a,mediaType:l}=r;return{uid:a?.uid,mediaType:l}})}),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Nt.prototype,"massUnsubscribe",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],Nt.prototype,"setLowStreamParameter",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],Nt.prototype,"enableDualStream",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],Nt.prototype,"disableDualStream",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[String,Object]),N("design:returntype",z)],Nt.prototype,"setClientRole",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[String,Boolean]),N("design:returntype",void 0)],Nt.prototype,"setProxyServer",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",void 0)],Nt.prototype,"setTurnServer",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",void 0)],Nt.prototype,"setLicense",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],Nt.prototype,"startProxyServer",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Nt.prototype,"stopProxyServer",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],Nt.prototype,"setLocalAccessPointsV2",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Array,String]),N("design:returntype",void 0)],Nt.prototype,"setLocalAccessPoints",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",z)],Nt.prototype,"setRemoteDefaultVideoStreamType",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",z)],Nt.prototype,"setRemoteVideoStreamType",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",z)],Nt.prototype,"setStreamFallbackOption",null),te([Ae({argsMap:(s,n)=>[n]}),N("design:type",Function),N("design:paramtypes",[String,String,Uint8Array]),N("design:returntype",void 0)],Nt.prototype,"setEncryptionConfig",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Nt.prototype,"renewToken",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Nt.prototype,"enableAudioVolumeIndicator",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[String,Boolean]),N("design:returntype",z)],Nt.prototype,"startLiveStreaming",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],Nt.prototype,"setLiveTranscoding",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Nt.prototype,"stopLiveStreaming",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[String,Object]),N("design:returntype",z)],Nt.prototype,"addInjectStreamUrl",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],Nt.prototype,"removeInjectStreamUrl",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Jf]),N("design:returntype",z)],Nt.prototype,"startChannelMediaRelay",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Jf]),N("design:returntype",z)],Nt.prototype,"updateChannelMediaRelay",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],Nt.prototype,"stopChannelMediaRelay",null),te([Ae({argsMap:(s,n)=>(Array.isArray(n)||(n=[n]),[JSON.stringify(n)])}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],Nt.prototype,"sendCustomReportMessage",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",z)],Nt.prototype,"pickSVCLayer",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",z)],Nt.prototype,"setRTM2Flag",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],Nt.prototype,"enableContentInspect",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],Nt.prototype,"disableContentInspect",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Boolean,Object]),N("design:returntype",z)],Nt.prototype,"setImageModeration",null),te([Ae({reportResult:!0}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Array)],Nt.prototype,"getJoinChannelServiceRecords",null),te([Ae(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",z)],Nt.prototype,"setPublishAudioFilterEnabled",null);class sm{constructor(n,r){C(this,"id",0),C(this,"element",void 0),C(this,"peerPair",void 0),C(this,"context",void 0),C(this,"audioPlayerElement",void 0),C(this,"audioTrack",void 0),sm.count+=1,this.id=sm.count,this.element=n,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=n=>{const r=document.createElement("audio");r.srcObject=new MediaStream([n.track]),r.play(),this.audioPlayerElement=r}}switchSdp(){var n=this;return x(function*(){if(!n.peerPair)return;const r=function(){var l=x(function*(d,h){const p="offer"===h?yield d.createOffer():yield d.createAnswer();return yield d.setLocalDescription(p),"complete"===d.iceGatheringState?d.localDescription:new z(m=>{d.onicegatheringstatechange=()=>{"complete"===d.iceGatheringState&&m(d.localDescription)}})});return function(h,p){return l.apply(this,arguments)}}(),a=function(){var l=x(function*(d,h){return yield d.setRemoteDescription(h)});return function(h,p){return l.apply(this,arguments)}}();try{const l=yield r(n.peerPair[0],"offer");yield a(n.peerPair[1],l);const d=yield r(n.peerPair[1],"answer");yield a(n.peerPair[0],d)}catch(l){throw new W(M.LOCAL_AEC_ERROR,l.toString()).print()}})()}getTracksFromMediaElement(n){var r=this;return x(function*(){if(r.audioTrack)return r.audioTrack;let a;try{n instanceof HTMLVideoElement&&(n.captureStream?n.captureStream():n.mozCaptureStream()),a=r.context.createMediaStreamDestination(),r.context.createMediaElementSource(n).connect(a)}catch(d){throw new W(M.LOCAL_AEC_ERROR,d.toString()).print()}if(!a)throw new W(M.LOCAL_AEC_ERROR,"no dest node when local aec").print();const l=a.stream.getAudioTracks()[0];return r.audioTrack=l,l})()}getElement(){return this.element}startEchoCancellation(){var n=this;return x(function*(){n.context.resume(),n.peerPair&&n.close(),n.initPeers();const r=n.element,a=yield n.getTracksFromMediaElement(r);n.peerPair&&n.peerPair[0].addTrack(a),yield n.switchSdp()})()}close(){w.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(n=>{n.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}C(sm,"count",0);const BN=window.AudioContext||window.webkitAudioContext;class GT{constructor(){C(this,"units",[]),C(this,"context",void 0)}processExternalMediaAEC(n){if(!this._doesEnvironmentNeedAEC())return w.debug("the system does not need to process local aec"),-1;this.context||(this.context=new BN);let r=this.units.find(a=>a&&a.getElement()===n);return r||(r=new sm(n,this.context),this.units.push(r)),r.startEchoCancellation(),w.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return dt().name!==Ne.SAFARI}}te([Ae({report:Se}),N("design:type",Function),N("design:paramtypes",[HTMLAudioElement]),N("design:returntype",Number)],GT.prototype,"processExternalMediaAEC",null);const jN=new GT;function L2(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function HN(s){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?L2(Object(r),!0).forEach(function(a){C(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):L2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}const GN=window||document;function WN(s){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!GN)return;const r=Gn._cspEventHandlerPointer;if(r&&n)return void console.error(r,n);const a=l=>{if(!(l&&l.blockedURI&&(Gn.onSecurityPolicyViolation||Gn.getListeners(Lt.SECURITY_POLICY_VIOLATION).length>0)))return;const d=l.blockedURI;j("CSP_DETECTED_HOSTNAME_LIST").some(h=>ye(d).call(d,h))&&(Gn.onSecurityPolicyViolation&&"function"==typeof Gn.onSecurityPolicyViolation&&Gn.onSecurityPolicyViolation(l),Gn.getListeners(Lt.SECURITY_POLICY_VIOLATION).length>0&&Gn.safeEmit(Lt.SECURITY_POLICY_VIOLATION,l))};r&&GN.removeEventListener("securitypolicyviolation",r),(n||s&&"function"==typeof s||Gn.getListeners(Lt.SECURITY_POLICY_VIOLATION).length>0)&&GN.addEventListener("securitypolicyviolation",a),Gn._cspEventHandlerPointer=a}At("PROCESS_ID","process-".concat(Fe(8,""),"-").concat(Fe(4,""),"-").concat(Fe(4,""),"-").concat(Fe(4,""),"-").concat(Fe(12,""))),function(){const s=dt();vi.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),vi.getStreamFromExtension=s.name===Ne.CHROME&&Number(s.version)>34,vi.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const n=new RTCPeerConnection;let r=!1;try{n.addTransceiver("audio"),r=!0}catch{}return n.close(),r}(),vi.supportMinBitrate=s.name===Ne.CHROME||s.name===Ne.EDGE,vi.supportSetRtpSenderParameters=function(){const n=dt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!zs()||!(!Ki()&&!xg())||n.name===Ne.FIREFOX&&Number(n.version)>=64)}(),s.name===Ne.SAFARI&&(vi.supportDualStream=Number(s.version)>=14),vi.webAudioMediaStreamDest=function(){const n=dt();return!(n.name===Ne.SAFARI&&Number(n.version)<12)}(),vi.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,vi.supportWebGL=typeof WebGLRenderingContext<"u",vi.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,zs()||(vi.webAudioWithAEC=!0),vi.supportShareAudio=function(){const n=dt();return(n.os===Fn.WIN_10||n.os===Fn.WIN_81||n.os===Fn.WIN_7||n.os===Fn.LINUX||n.os===Fn.MAC_OS)&&n.name===Ne.CHROME&&Number(n.version)>=74}(),vi.supportDataChannel=!!(Lg(76)||function(n){const r=dt();return!(r.name!==Ne.FIREFOX||!r.osVersion)&&Number(r.version)>=68}()||function(n){const r=dt();return!(r.name!==Ne.SAFARI||!r.osVersion)&&Number(r.version)>=14}()),vi.supportPCSetConfiguration=function(){const n=window.RTCPeerConnection;return!zt()&&!!n&&n.prototype.setConfiguration instanceof Function}(),vi.supportWebRTCEncodedTransform=function(){const n=dt();return"Chrome"===n.name&&Number(n.version)>=86}(),vi.supportWebRTCInsertableStream=function(){const n=dt();return(n.name===Ne.CHROME||n.name===Ne.EDGE)&&Number(n.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),mo(()=>{vi.supportDualStreamEncoding=function(){const n=dt();return!!j("DISABLE_WEBAUDIO")||"Safari"===n.name&&Number(n.version)>=14||!!("Chrome"===n.name&&/Windows/i.test(n.os||"")&&Number(n.version)>=100&&j("CHROME_DUAL_STREAM_USE_ENCODING"))}(),w.info("browser compatibility",JSON.stringify(vi),JSON.stringify(s))})}(),function(){let s;try{s=window.localStorage.getItem("websdk_ng_global_parameter")}catch(n){return void w.error("Error loading sdk config",n.message)}if(s)try{const n=JSON.parse(window.atob(s)),r=Date.now();w.debug("Loading global parameters from cache",n),Object.keys(n).forEach(a=>{if(Object.prototype.hasOwnProperty.call(oi,a)){const{value:l,expires:d}=n[a];if(d&&d<=r)return;Ys[a]=l,oi[a]=l}})}catch(n){w.error("Error loading mutableParamsCache: ".concat(s),n.message)}}(),Array.isArray(Ys.AREAS)&&Ys.AREAS.length>0&&In(Ys.AREAS,!0);const Gn=function(s){const n=new qt,r=s,a={getListeners:n.getListeners.bind(n),on:(l,d)=>(l===Lt.SECURITY_POLICY_VIOLATION&&WN(d,!0),n.on.bind(n)(l,d)),addListener:n.addListener.bind(n),once:n.once.bind(n),off:n.off.bind(n),removeAllListeners:n.removeAllListeners.bind(n),emit:n.emit.bind(n),safeEmit:n.safeEmit.bind(n)};return HN(HN({},r),a)}({__TRACK_LIST__:gh,VERSION:$o,BUILD:BS,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:(s,n,r)=>{w.debug("setParameter key:".concat(s,", value:").concat(JSON.stringify(n))),At(s,n,r)},getParameter:j,getSupportedCodec:function(){var s=x(function*(){let n={audio:[],video:[]};try{let r=new RTCPeerConnection;r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});const a=(yield r.createOffer()).sdp;if(!a)return n;r.close(),r=null,n=function(l){const d={video:[],audio:[]};return l.match(/ VP8/i)&&d.video.push("VP8"),l.match(/ VP9/i)&&d.video.push("VP9"),l.match(/ AV1/i)&&d.video.push("AV1"),l.match(/ H264/i)&&d.video.push("H264"),l.match(/ H265/i)&&d.video.push("H265"),l.match(/ opus/i)&&d.audio.push("OPUS"),l.match(/ PCMU/i)&&d.audio.push("PCMU"),l.match(/ PCMA/i)&&d.audio.push("PCMA"),l.match(/ G722/i)&&d.audio.push("G722"),d}(a)}catch(r){throw new W(M.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return n});return function(){return s.apply(this,arguments)}}(),checkSystemRequirements:function(){const s=Se.reportApiInvoke(null,{name:Nn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Jt.TRACER});let n=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,p=window.WebSocket;n=!!(d&&h&&p)}catch(d){return w.error("check system requirement failed: ",d),!1}let r=!1;const a=dt();a.name===Ne.CHROME&&Number(a.version)>=58&&(!function bA(){return"WebKit"===cc.engine.name}()||function bk(){const s=dt();if(xg()){if(s.os===Fn.MAC_OS)return!0;if(s.os===Fn.IOS){const n=cc.os.version&&cc.os.version.split(".");if(n&&14===Number(n[0])&&n[1]&&Number(n[1])>=3||n&&Number(n[0])>14)return!0}}return!1}())&&(r=!0),a.name===Ne.FIREFOX&&Number(a.version)>=56&&(r=!0),a.name===Ne.OPERA&&Number(a.version)>=45&&(r=!0),a.name===Ne.SAFARI&&Number(a.version)>=11&&(r=!0),(mr()||dt().name===Ne.QQ)&&(r=!0),w.debug("checkSystemRequirements, api:",n,"browser",r);const l=n&&r;return s.onSuccess(l),l},getDevices:function(s){return es.enumerateDevices(!0,!0,s)},getMicrophones:function(s){return es.getRecordingDevices(s)},getCameras:function(s){return es.getCamerasDevices(s)},getElectronScreenSources:uC,getPlaybackDevices:function(s){return es.getSpeakers(s)},createClient:function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Se.reportApiInvoke(null,{name:Nn.CREATE_CLIENT,options:[s],tag:Jt.TRACER});try{gn((r=s).codec,"config.codec",["vp8","vp9","av1","h264","h265"]),gn(r.mode,"config.mode",["rtc","live"]),void 0!==r.audioCodec&&gn(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==r.proxyServer&&Un(r.proxyServer,"config.proxyServer",1,1e4),void 0!==r.turnServer&&Bg(r.turnServer),void 0!==r.httpRetryConfig&&Vg(r.httpRetryConfig),void 0!==r.websocketRetryConfig&&Vg(r.websocketRetryConfig)}catch(r){throw n.onError(r),r}var r;return function k2(){return!function(s,n,r){const a=dt();if(a.os!==Fn.IOS||!a.osVersion)return!1;const l=a.osVersion.split(".");return Number(l[0])<16}()&&!function(s,n,r){const a=dt();if(a.name!==Ne.SAFARI||!a.osVersion)return!1;const l=a.version.split(".");return Number(l[0])<16}()}()||(s.codec="vp8",w.debug("browser not support vp9, force use vp8"),At("FILTER_VIDEO_CODEC",["vp8"])),void 0===s.audioCodec&&(s.audioCodec="opus"),n.onSuccess(),new Nt(zh(zh({forceWaitGatewayResponse:!0},s),{},{role:"rtc"===s.mode?"host":s.role||"audience"}))},createCameraVideoTrack:function(){var s=x(function*(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=Se.reportApiInvoke(null,{tag:Jt.TRACER,name:Nn.CREATE_CAM_VIDEO_TRACK,options:[CC({},n)]}),a=IE(n),l=Fe(8,"track-cam-");let d=null;const h="720p_auto"===n.encoderConfig;w.info("start create camera video track with config",JSON.stringify(n),"trackId",l);try{d=(yield Zo({video:a},l)).getVideoTracks()[0]||null}catch(m){throw r.onError(m),m}if(!d){const m=new X(M.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(m),m.throw(w)}n.optimizationMode&&sO(l,d,n,Ma(n.encoderConfig));const p=new wd(d,n,a,n.scalabiltyMode?uE(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,l);return h&&p.startMonitorStats(),r.onSuccess(p.getTrackId()),w.info("create camera video success, trackId:",l),p});return function(){return s.apply(this,arguments)}}(),createCustomVideoTrack:function(s){const n=Se.reportApiInvoke(null,{tag:Jt.TRACER,name:Nn.CREATE_CUSTOM_VIDEO_TRACK,options:[s]}),r=new ze(s.mediaStreamTrack,{width:s.width,height:s.height,frameRate:s.frameRate,bitrateMax:s.bitrateMax,bitrateMin:s.bitrateMin},s.scalabiltyMode?uE(s.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},s.optimizationMode,Fe(8,"track-cus-"),[Ot.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),w.info("create custom video track success with config",s,"trackId",r.getTrackId()),r},createScreenVideoTrack:function(){var s=x(function*(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const a=Se.reportApiInvoke(null,{tag:Jt.TRACER,name:Nn.CREATE_SCREEN_VIDEO_TRACK,options:[CC({},n),r]}),l="720p_auto"===n.encoderConfig;n.encoderConfig?"string"==typeof n.encoderConfig||n.encoderConfig.width&&n.encoderConfig.height||(n.encoderConfig.width={max:1920},n.encoderConfig.height={max:1080}):n.encoderConfig="1080p_2";const d=function(b){const T={};b.screenSourceType&&(T.mediaSource=b.screenSourceType),b.extensionId&&kg()&&(T.extensionId=b.extensionId);const{displaySurface:O,selfBrowserSurface:P,surfaceSwitching:D,systemAudio:L}=b;(Lg(107)||Sk(107)||cf(93))&&(O&&(gn(O,"displaySurface",["browser","window","monitor"]),T.displaySurface=O),P?(gn(P,"selfBrowserSurface",["exclude","include"]),T.selfBrowserSurface=P):T.selfBrowserSurface="include",D&&(gn(D,"surfaceSwitching",["exclude","include"]),T.surfaceSwitching=D)),(Lg(105)||Sk(105)||cf(91))&&L&&(gn(L,"systemAudio",["exclude","include"]),T.systemAudio=L),b.electronScreenSourceId&&(T.sourceId=b.electronScreenSourceId);const V=b.encoderConfig?VD(b.encoderConfig):null;return T.mandatory={chromeMediaSource:"desktop",maxWidth:V?V.width:void 0,maxHeight:V?V.height:void 0},V&&(V.frameRate&&("number"==typeof V.frameRate?(T.mandatory.maxFrameRate=V.frameRate,T.mandatory.minFrameRate=V.frameRate):(T.mandatory.maxFrameRate=V.frameRate.max||V.frameRate.ideal||V.frameRate.exact||void 0,T.mandatory.minFrameRate=V.frameRate.min||V.frameRate.ideal||V.frameRate.exact||void 0),T.frameRate=V.frameRate),V.width&&(T.width=V.width),V.height&&(T.height=V.height)),T}(n),h=Fe(8,"track-scr-v-");let p=null,m=null;const _=$e();if(!_.supportShareAudio&&"enable"===r){const b=new X(M.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return a.onError(b),b.throw(w)}w.info("start create screen video track with config",n,"withAudio",r,"trackId",h);try{const b=yield Zo({screen:d,screenAudio:"auto"===r?_.supportShareAudio:"enable"===r},h);p=b.getVideoTracks()[0]||null,m=b.getAudioTracks()[0]||null}catch(b){throw a.onError(b),b}if(!p){const b=new X(M.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(b),b.throw(w)}if(!m&&"enable"===r){p&&p.stop();const b=new X(M.SHARE_AUDIO_NOT_ALLOWED);return a.onError(b),b.throw(w)}n.optimizationMode||(n.optimizationMode="detail"),n.optimizationMode&&(sO(h,p,n,n.encoderConfig&&VD(n.encoderConfig)||void 0),n.encoderConfig&&"string"!=typeof n.encoderConfig&&(n.encoderConfig.bitrateMin=n.encoderConfig.bitrateMax));const E=new ze(p,n.encoderConfig?VD(n.encoderConfig):{},n.scalabiltyMode?uE(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,h,[Ot.SCREEN_TRACK]);if(l&&E.startMonitorStats(),!m)return a.onSuccess(E.getTrackId()),w.info("create screen video track success","video:",E.getTrackId()),E;const v=new mt(m,void 0,Fe(8,"track-scr-a-"),!1,!0);return a.onSuccess([E.getTrackId(),v.getTrackId()]),w.info("create screen video track success","video:",E.getTrackId(),"audio:",v.getTrackId()),[E,v]});return function(){return s.apply(this,arguments)}}(),createMicrophoneAndCameraTracks:function(){var s=x(function*(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=Se.reportApiInvoke(null,{tag:Jt.TRACER,name:Nn.CREATE_MIC_AND_CAM_TRACKS,options:[n,r]}),l="720p_auto"===r.encoderConfig,d=IE(r),h=gC(n),p=Fe(8,"track-mic-"),m=Fe(8,"track-cam-");let _=null,E=null;w.info("start create camera video track(".concat(m,") and microphone audio track(").concat(p,") with config, audio: ").concat(JSON.stringify(n),", video: ").concat(JSON.stringify(r)));try{const T=yield Zo({audio:h,video:d},"".concat(p,"-").concat(m));_=T.getAudioTracks()[0],E=T.getVideoTracks()[0]}catch(T){throw a.onError(T),T}if(!_||!E){const T=new X(M.UNEXPECTED_ERROR,"can not find tracks in media stream");return a.onError(T),T.throw(w)}r.optimizationMode&&sO(m,E,r,Ma(r.encoderConfig));const v=new Td(_,n,h,p),b=new wd(E,r,d,r.scalabiltyMode?uE(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,m);return l&&b.startMonitorStats(),a.onSuccess([v.getTrackId(),b.getTrackId()]),w.info("create camera video track(".concat(m,") and microphone audio track(").concat(p,") success")),[v,b]});return function(){return s.apply(this,arguments)}}(),createMicrophoneAudioTrack:function(){var s=x(function*(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=Se.reportApiInvoke(null,{tag:Jt.TRACER,name:Nn.CREATE_MIC_AUDIO_TRACK,options:[n]}),a=gC(n),l=Fe(8,"track-mic-");let d=null;w.info("start create microphone audio track with config",JSON.stringify(n),"trackId",l);try{d=(yield Zo({audio:a},l)).getAudioTracks()[0]||null}catch(p){throw r.onError(p),p}if(!d){const p=new X(M.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(p),p.throw(w)}const h=new Td(d,n,a,l);return r.onSuccess(h.getTrackId()),w.info("create microphone audio track success, trackId:",l),h});return function(){return s.apply(this,arguments)}}(),createCustomAudioTrack:function(s){const n=Se.reportApiInvoke(null,{tag:Jt.TRACER,name:Nn.CREATE_CUSTOM_AUDIO_TRACK,options:[s]}),r=new mt(s.mediaStreamTrack,s.encoderConfig?Ss(s.encoderConfig):{},Fe(8,"track-cus-"),!1,!0);return w.info("create custom audio track success with config",s,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:function(){var s=x(function*(n){var r;const{cacheOnlineFile:a,encoderConfig:l}=n;let{source:d}=n;const h={source:d instanceof AudioBuffer?"AudioBuffer":d instanceof File?null!==(r=File.name)&&void 0!==r?r:"File":d,cacheOnlineFile:a,encoderConfig:l},p=Se.reportApiInvoke(null,{tag:Jt.TRACER,name:Nn.CREATE_BUFFER_AUDIO_TRACK,options:[h]});if(j("DISABLE_WEBAUDIO"))throw new X(M.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const m=Fe(8,"track-buf-");w.info("start create buffer source audio track with config",JSON.stringify(h),"trackId",m);const _=d;if(!(d instanceof AudioBuffer))try{d=yield function nO(s,n){return RE.apply(this,arguments)}(d,a)}catch(b){return p.onError(b),b.throw(w)}const E=new eO(d),v=new yl(_,E,l?Ss(l):{},m);return w.info("create buffer source audio track success, trackId:",m),p.onSuccess(v.getTrackId()),v});return function(r){return s.apply(this,arguments)}}(),setAppType:function(s){if(w.debug("setAppType: ".concat(s)),!(Number.isInteger(s)&&s>=0))throw w.debug("Invalid appType"),new W(M.INVALID_PARAMS,"invalid app type",s);At("APP_TYPE",Math.floor(s))},setLogLevel:function(s){w.setLogLevel(s)},enableLogUpload:function(){j("USE_NEW_LOG")?At("UPLOAD_LOG",!0):w.enableLogUpload()},disableLogUpload:function(){j("USE_NEW_LOG")?At("UPLOAD_LOG",!1):w.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new Jf},checkAudioTrackIsActive:function(){var s=x(function*(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const a=Se.reportApiInvoke(null,{tag:Jt.TRACER,name:Nn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(n instanceof mt||n instanceof Co)){const _=new W(M.INVALID_TRACK,"the parameter is not a audio track");return a.onError(_),_.throw()}r&&r<1e3&&(r=1e3);const l=n instanceof mt?n.getTrackLabel():"remote_track",d=n.getVolumeLevel();let h=d,p=d;const m=Date.now();return new z(_=>{const E=setInterval(()=>{const v=n.getVolumeLevel();h=v>h?v:h,p=v<p?v:p;const b=h-p>1e-4,T=Date.now()-m;if(b||T>r){clearInterval(E);const O=b,P={duration:T,deviceLabel:l,maxVolumeLevel:h,result:O};w.info("[track-".concat(n.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(P))),a.onSuccess(P),_(O)}},200)})});return function(r){return s.apply(this,arguments)}}(),checkVideoTrackIsActive:function(){var s=x(function*(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const a=Se.reportApiInvoke(null,{tag:Jt.TRACER,name:Nn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(n instanceof ze||n instanceof Cs)){const b=new W(M.INVALID_TRACK,"the parameter is not a video track");return a.onError(b),b.throw()}r&&r<1e3&&(r=1e3);const l=n instanceof ze?n.getTrackLabel():"remote_track",d=n.getMediaStreamTrack(!0),h=document.createElement("video");h.style.width="1px",h.style.height="1px",h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.controls=!1,(Ki()||xg())&&(h.style.opacity="0.01",h.style.position="fixed",h.style.left="0",h.style.top="0",document.body.appendChild(h)),h.srcObject=new MediaStream([d]),h.play();const p=document.createElement("canvas");p.width=160,p.height=120;let m=0,_=0;try{const b=Date.now();m=yield function(T,O,P,D){let L,V=0,U=null;return new z((J,se)=>{setTimeout(()=>{L&&(L(),J(V))},O),L=vE(()=>{!function q(){V>4&&L&&(L(),J(V));const Q=P.getContext("2d");if(!Q){const me=new W(M.UNEXPECTED_ERROR,"can not get canvas 2d context.");return w.error(me.toString()),void se(me)}Q.drawImage(T,0,0,160,120);const $=Q.getImageData(0,0,P.width,P.height),Y=Math.floor($.data.length/3);if(U){for(let me=0;me<Y;me+=3)if($.data[me]!==U[me])return V+=1,void(U=$.data);U=$.data}else U=$.data}()},30)})}(h,r,p),_=Date.now()-b}catch(b){throw a.onError(b),b}x2===Ne.SAFARI&&(h.pause(),h.remove()),h.srcObject=null;const E=m>4,v={duration:_,changedPicNum:m,deviceLabel:l,result:E};return w.info("[track-".concat(n.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(v))),a.onSuccess(v),E});return function(r){return s.apply(this,arguments)}}(),setArea:In,audioElementPlayCenter:Qr,processExternalMediaAEC:function(s){jN.processExternalMediaAEC(s)},registerExtensions:function(s){s.forEach(n=>{const r=n;r.__registered__=!0,r.logger.hookLog=w.extLog,r.reporter.hookApiInvoke=Se.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(a=>{r.parameters[a]=j(a)})})},ChannelMediaRelayError:fl,ChannelMediaRelayEvent:$s,ChannelMediaRelayState:Ji,RemoteStreamFallbackType:pE,RemoteStreamType:hE,ConnectionDisconnectedReason:Ye,AudienceLatencyLevelType:wA,AREAS:st});return Object.defineProperties(Gn,{onAudioAutoplayFailed:{get:()=>So.onAudioAutoplayFailed,set:s=>{So.onAudioAutoplayFailed=s}},onAutoplayFailed:{get:()=>So.onAutoplayFailed,set:s=>{So.onAutoplayFailed=s}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Gn._onSecurityPolicyViolation,set(s){Gn._onSecurityPolicyViolation=s,WN(s)}},__CLIENT_LIST__:{get:()=>j("SHOW_GLOBAL_CLIENT_LIST")?hc:[]}}),es.on(xa.CAMERA_DEVICE_CHANGED,s=>{w.info("camera device changed",JSON.stringify(s)),Gn.onCameraChanged&&Gn.onCameraChanged(s),Gn.safeEmit(Lt.CAMERA_CHANGED,s)}),es.on(xa.RECORDING_DEVICE_CHANGED,s=>{w.info("microphone device changed",JSON.stringify(s)),Gn.onMicrophoneChanged&&Gn.onMicrophoneChanged(s),Gn.safeEmit(Lt.MICROPHONE_CHANGED,s)}),es.on(xa.PLAYOUT_DEVICE_CHANGED,s=>{w.debug("playout device changed",JSON.stringify(s)),Gn.onPlaybackDeviceChanged&&Gn.onPlaybackDeviceChanged(s),Gn.safeEmit(Lt.PLAYBACK_DEVICE_CHANGED,s)}),Qr.onAutoplayFailed=()=>{w.info("detect audio element autoplay failed"),So.onAudioAutoplayFailed&&So.onAudioAutoplayFailed()},vt.on("autoplay-failed",()=>{w.info("detect webaudio autoplay failed"),So.onAudioAutoplayFailed&&So.onAudioAutoplayFailed(),Gn.safeEmit(Lt.AUTOPLAY_FAILED)}),on.on(lc.NETWORK_STATE_CHANGE,(s,n)=>{w.info("[network-indicator] network state changed, ".concat(n," => ").concat(s))}),window&&(window.__ARTC__=Gn),Gn}()},156:Ac=>{function Sm(x,Dc,da,ua,Dn,xo,Oc){try{var Nc=x[xo](Oc),Br=Nc.value}catch(Pc){return void da(Pc)}Nc.done?Dc(Br):Promise.resolve(Br).then(ua,Dn)}Ac.exports=function Cm(x){return function(){var Dc=this,da=arguments;return new Promise(function(ua,Dn){var xo=x.apply(Dc,da);function Oc(Br){Sm(xo,ua,Dn,Oc,Nc,"next",Br)}function Nc(Br){Sm(xo,ua,Dn,Oc,Nc,"throw",Br)}Oc(void 0)})}},Ac.exports.__esModule=!0,Ac.exports.default=Ac.exports}},Ac=>{Ac(Ac.s=6)}]);