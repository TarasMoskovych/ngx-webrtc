(self.webpackChunkngx_webrtc=self.webpackChunkngx_webrtc||[]).push([[179],{315:(id,Mg,xg)=>{"use strict";let Rt=null,As=1;const Yo=Symbol("SIGNAL");function An(e){const n=Rt;return Rt=e,n}function BI(e){if((!Gp(e)||e.dirty)&&(e.dirty||e.lastCleanEpoch!==As)){if(!e.producerMustRecompute(e)&&!zb(e))return e.dirty=!1,void(e.lastCleanEpoch=As);e.producerRecomputeValue(e),e.dirty=!1,e.lastCleanEpoch=As}}function zb(e){cc(e);for(let n=0;n<e.producerNode.length;n++){const t=e.producerNode[n],o=e.producerLastReadVersion[n];if(o!==t.version||(BI(t),o!==t.version))return!0}return!1}function Lg(e,n){if(function Fg(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}(e),cc(e),1===e.liveConsumerNode.length)for(let o=0;o<e.producerNode.length;o++)Lg(e.producerNode[o],e.producerIndexOfThis[o]);const t=e.liveConsumerNode.length-1;if(e.liveConsumerNode[n]=e.liveConsumerNode[t],e.liveConsumerIndexOfThis[n]=e.liveConsumerIndexOfThis[t],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,n<e.liveConsumerNode.length){const o=e.liveConsumerIndexOfThis[n],c=e.liveConsumerNode[n];cc(c),c.producerIndexOfThis[o]=n}}function Gp(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function cc(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}let zp=null;function dn(e){return"function"==typeof e}function Xb(e){const t=e(o=>{Error.call(o),o.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const fl=Xb(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((o,c)=>`${c+1}) ${o.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function Bg(e,n){if(e){const t=e.indexOf(n);0<=t&&e.splice(t,1)}}class Ki{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const u of t)u.remove(this);else t.remove(this);const{initialTeardown:o}=this;if(dn(o))try{o()}catch(u){n=u instanceof fl?u.errors:[u]}const{_finalizers:c}=this;if(c){this._finalizers=null;for(const u of c)try{WI(u)}catch(f){n=n??[],f instanceof fl?n=[...n,...f.errors]:n.push(f)}}if(n)throw new fl(n)}}add(n){var t;if(n&&n!==this)if(this.closed)WI(n);else{if(n instanceof Ki){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&Bg(t,n)}remove(n){const{_finalizers:t}=this;t&&Bg(t,n),n instanceof Ki&&n._removeParent(this)}}Ki.EMPTY=(()=>{const e=new Ki;return e.closed=!0,e})();const rd=Ki.EMPTY;function Jb(e){return e instanceof Ki||e&&"closed"in e&&dn(e.remove)&&dn(e.add)&&dn(e.unsubscribe)}function WI(e){dn(e)?e():e.unsubscribe()}const ur={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Os={setTimeout(e,n,...t){const{delegate:o}=Os;return o?.setTimeout?o.setTimeout(e,n,...t):setTimeout(e,n,...t)},clearTimeout(e){const{delegate:n}=Os;return(n?.clearTimeout||clearTimeout)(e)},delegate:void 0};function jg(e){Os.setTimeout(()=>{const{onUnhandledError:n}=ur;if(!n)throw e;n(e)})}function Gu(){}const QM=dc("C",void 0,void 0);function dc(e,n,t){return{kind:e,value:n,error:t}}let od=null;function Wu(e){if(ur.useDeprecatedSynchronousErrorHandling){const n=!od;if(n&&(od={errorThrown:!1,error:null}),e(),n){const{errorThrown:t,error:o}=od;if(od=null,t)throw o}}else e()}class Hg extends Ki{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Jb(n)&&n.add(this)):this.destination=YI}static create(n,t,o){return new zu(n,t,o)}next(n){this.isStopped?sd(function vo(e){return dc("N",e,void 0)}(n),this):this._next(n)}error(n){this.isStopped?sd(function zI(e){return dc("E",void 0,e)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?sd(QM,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const qI=Function.prototype.bind;function Gg(e,n){return qI.call(e,n)}class ml{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(o){Wg(o)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(o){Wg(o)}else Wg(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){Wg(t)}}}class zu extends Hg{constructor(n,t,o){let c;if(super(),dn(n)||!n)c={next:n??void 0,error:t??void 0,complete:o??void 0};else{let u;this&&ur.useDeprecatedNextContext?(u=Object.create(n),u.unsubscribe=()=>this.unsubscribe(),c={next:n.next&&Gg(n.next,u),error:n.error&&Gg(n.error,u),complete:n.complete&&Gg(n.complete,u)}):c=n}this.destination=new ml(c)}}function Wg(e){ur.useDeprecatedSynchronousErrorHandling?function KI(e){ur.useDeprecatedSynchronousErrorHandling&&od&&(od.errorThrown=!0,od.error=e)}(e):jg(e)}function sd(e,n){const{onStoppedNotification:t}=ur;t&&Os.setTimeout(()=>t(e,n))}const YI={closed:!0,next:Gu,error:function ZM(e){throw e},complete:Gu},Qb="function"==typeof Symbol&&Symbol.observable||"@@observable";function ad(e){return e}function $I(e){return 0===e.length?ad:1===e.length?e[0]:function(t){return e.reduce((o,c)=>c(o),t)}}let Wn=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const o=new e;return o.source=this,o.operator=t,o}subscribe(t,o,c){const u=function tx(e){return e&&e instanceof Hg||function Ku(e){return e&&dn(e.next)&&dn(e.error)&&dn(e.complete)}(e)&&Jb(e)}(t)?t:new zu(t,o,c);return Wu(()=>{const{operator:f,source:g}=this;u.add(f?f.call(u,g):g?this._subscribe(u):this._trySubscribe(u))}),u}_trySubscribe(t){try{return this._subscribe(t)}catch(o){t.error(o)}}forEach(t,o){return new(o=XI(o))((c,u)=>{const f=new zu({next:g=>{try{t(g)}catch(E){u(E),f.unsubscribe()}},error:u,complete:c});this.subscribe(f)})}_subscribe(t){var o;return null===(o=this.source)||void 0===o?void 0:o.subscribe(t)}[Qb](){return this}pipe(...t){return $I(t)(this)}toPromise(t){return new(t=XI(t))((o,c)=>{let u;this.subscribe(f=>u=f,f=>c(f),()=>o(u))})}}return e.create=n=>new e(n),e})();function XI(e){var n;return null!==(n=e??ur.Promise)&&void 0!==n?n:Promise}const nx=Xb(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let en=(()=>{class e extends Wn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const o=new $o(this,this);return o.operator=t,o}_throwIfClosed(){if(this.closed)throw new nx}next(t){Wu(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const o of this.currentObservers)o.next(t)}})}error(t){Wu(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:o}=this;for(;o.length;)o.shift().error(t)}})}complete(){Wu(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:o,isStopped:c,observers:u}=this;return o||c?rd:(this.currentObservers=null,u.push(t),new Ki(()=>{this.currentObservers=null,Bg(u,t)}))}_checkFinalizedStatuses(t){const{hasError:o,thrownError:c,isStopped:u}=this;o?t.error(c):u&&t.complete()}asObservable(){const t=new Wn;return t.source=this,t}}return e.create=(n,t)=>new $o(n,t),e})();class $o extends en{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,o;null===(o=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===o||o.call(t,n)}error(n){var t,o;null===(o=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===o||o.call(t,n)}complete(){var n,t;null===(t=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===t||t.call(n)}_subscribe(n){var t,o;return null!==(o=null===(t=this.source)||void 0===t?void 0:t.subscribe(n))&&void 0!==o?o:rd}}class oo extends en{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){const{hasError:n,thrownError:t,_value:o}=this;if(n)throw t;return this._throwIfClosed(),o}next(n){super.next(this._value=n)}}function JI(e){return dn(e?.lift)}function fi(e){return n=>{if(JI(n))return n.lift(function(t){try{return e(t,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function Jn(e,n,t,o,c){return new Zb(e,n,t,o,c)}class Zb extends Hg{constructor(n,t,o,c,u,f){super(n),this.onFinalize=u,this.shouldUnsubscribe=f,this._next=t?function(g){try{t(g)}catch(E){n.error(E)}}:super._next,this._error=c?function(g){try{c(g)}catch(E){n.error(E)}finally{this.unsubscribe()}}:super._error,this._complete=o?function(){try{o()}catch(g){n.error(g)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function Yt(e,n){return fi((t,o)=>{let c=0;t.subscribe(Jn(o,u=>{o.next(e.call(n,u,c++))}))})}const ey="https://g.co/ng/security#xss";class he extends Error{constructor(n,t){super(function qu(e,n){return`NG0${Math.abs(e)}${n?": "+n:""}`}(n,t)),this.code=n}}function Dn(e){for(let n in e)if(e[n]===Dn)return n;throw Error("Could not find renamed property on target object.")}function rx(e,n){for(const t in n)n.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function $t(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map($t).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const n=e.toString();if(null==n)return""+n;const t=n.indexOf("\n");return-1===t?n:n.substring(0,t)}function ty(e,n){return null==e||""===e?null===n?"":n:null==n||""===n?e:e+" "+n}const ox=Dn({__forward_ref__:Dn});function Ln(e){return e.__forward_ref__=Ln,e.toString=function(){return $t(this())},e}function nt(e){return zg(e)?e():e}function zg(e){return"function"==typeof e&&e.hasOwnProperty(ox)&&e.__forward_ref__===Ln}function Kg(e){return e&&!!e.\u0275providers}const Kp=Dn({\u0275cmp:Dn}),ny=Dn({\u0275dir:Dn}),iy=Dn({\u0275pipe:Dn}),El=Dn({\u0275mod:Dn}),$s=Dn({\u0275fac:Dn}),qp=Dn({__NG_ELEMENT_ID__:Dn}),li=Dn({__NG_ENV_ID__:Dn});function yt(e){return"string"==typeof e?e:null==e?"":String(e)}function ry(e,n){throw new he(-201,!1)}function bo(e,n){null==e&&function ct(e,n,t,o){throw new Error(`ASSERTION ERROR: ${e}`+(null==o?"":` [Expected=> ${t} ${o} ${n} <=Actual]`))}(n,e,null,"!=")}function Pe(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Qn(e){return{providers:e.providers||[],imports:e.imports||[]}}function Yg(e){return rw(e,Xg)||rw(e,Yu)}function rw(e,n){return e.hasOwnProperty(n)?e[n]:null}function $g(e){return e&&(e.hasOwnProperty(sy)||e.hasOwnProperty(Ns))?e[sy]:null}const Xg=Dn({\u0275prov:Dn}),sy=Dn({\u0275inj:Dn}),Yu=Dn({ngInjectableDef:Dn}),Ns=Dn({ngInjectorDef:Dn});var Vt=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Vt||{});let ay;function sw(){return ay}function yo(e){const n=ay;return ay=e,n}function Ps(e,n,t){const o=Yg(e);return o&&"root"==o.providedIn?void 0===o.value?o.value=o.factory():o.value:t&Vt.Optional?null:void 0!==n?n:void ry()}const yn=globalThis;class De{constructor(n,t){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Pe({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Jp={},hy="__NG_DI_FLAG__",Jg="ngTempTokenPath",$u=/\n/gm,bl="__source";let yl;function Bt(e){const n=yl;return yl=e,n}function Ex(e,n=Vt.Default){if(void 0===yl)throw new he(-203,!1);return null===yl?Ps(e,void 0,n):yl.get(e,n&Vt.Optional?null:void 0,n)}function be(e,n=Vt.Default){return(sw()||Ex)(nt(e),n)}function Te(e,n=Vt.Default){return be(e,Qg(n))}function Qg(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function py(e){const n=[];for(let t=0;t<e.length;t++){const o=nt(e[t]);if(Array.isArray(o)){if(0===o.length)throw new he(900,!1);let c,u=Vt.Default;for(let f=0;f<o.length;f++){const g=o[f],E=dw(g);"number"==typeof E?-1===E?c=g.token:u|=E:c=g}n.push(be(c,u))}else n.push(be(o))}return n}function Qp(e,n){return e[hy]=n,e.prototype[hy]=n,e}function dw(e){return e[hy]}function lc(e){return{toString:e}.toString()}var Ta=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(Ta||{}),Xs=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(Xs||{});const Ia={},un=[];var Xe=function(e){return e[e.None=0]="None",e[e.SignalBased=1]="SignalBased",e[e.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",e}(Xe||{});function Zg(e,n,t){let o=e.length;for(;;){const c=e.indexOf(n,t);if(-1===c)return c;if(0===c||e.charCodeAt(c-1)<=32){const u=n.length;if(c+u===o||e.charCodeAt(c+u)<=32)return c}t=c+1}}function fy(e,n,t){let o=0;for(;o<t.length;){const c=t[o];if("number"==typeof c){if(0!==c)break;o++;const u=t[o++],f=t[o++],g=t[o++];e.setAttribute(n,f,g,u)}else{const u=c,f=t[++o];uc(u)?e.setProperty(n,u,f):e.setAttribute(n,u,f),o++}}return o}function lw(e){return 3===e||4===e||6===e}function uc(e){return 64===e.charCodeAt(0)}function Zp(e,n){if(null!==n&&0!==n.length)if(null===e||0===e.length)e=n.slice();else{let t=-1;for(let o=0;o<n.length;o++){const c=n[o];"number"==typeof c?t=c:0===t||uw(e,t,c,null,-1===t||2===t?n[++o]:null)}}return e}function uw(e,n,t,o,c){let u=0,f=e.length;if(-1===n)f=-1;else for(;u<e.length;){const g=e[u++];if("number"==typeof g){if(g===n){f=-1;break}if(g>n){f=u-1;break}}}for(;u<e.length;){const g=e[u];if("number"==typeof g)break;if(g===t){if(null===o)return void(null!==c&&(e[u+1]=c));if(o===e[u+1])return void(e[u+2]=c)}u++,null!==o&&u++,null!==c&&u++}-1!==f&&(e.splice(f,0,n),u=f+1),e.splice(u++,0,t),null!==o&&e.splice(u++,0,o),null!==c&&e.splice(u++,0,c)}const hw="ng-template";function yx(e,n,t){let o=0,c=!0;for(;o<e.length;){let u=e[o++];if("string"==typeof u&&c){const f=e[o++];if(t&&"class"===u&&-1!==Zg(f.toLowerCase(),n,0))return!0}else{if(1===u){for(;o<e.length&&"string"==typeof(u=e[o++]);)if(u.toLowerCase()===n)return!0;return!1}"number"==typeof u&&(c=!1)}}return!1}function pw(e){return 4===e.type&&e.value!==hw}function Cx(e,n,t){return n===(4!==e.type||t?e.value:hw)}function fw(e,n,t){let o=4;const c=e.attrs||[],u=function Tx(e){for(let n=0;n<e.length;n++)if(lw(e[n]))return n;return e.length}(c);let f=!1;for(let g=0;g<n.length;g++){const E=n[g];if("number"!=typeof E){if(!f)if(4&o){if(o=2|1&o,""!==E&&!Cx(e,E,t)||""===E&&1===n.length){if(Jo(o))return!1;f=!0}}else{const C=8&o?E:n[++g];if(8&o&&null!==e.attrs){if(!yx(e.attrs,C,t)){if(Jo(o))return!1;f=!0}continue}const P=Sx(8&o?"class":E,c,pw(e),t);if(-1===P){if(Jo(o))return!1;f=!0;continue}if(""!==C){let B;B=P>u?"":c[P+1].toLowerCase();const G=8&o?B:null;if(G&&-1!==Zg(G,C,0)||2&o&&C!==B){if(Jo(o))return!1;f=!0}}}}else{if(!f&&!Jo(o)&&!Jo(E))return!1;if(f&&Jo(E))continue;f=!1,o=E|1&o}}return Jo(o)||f}function Jo(e){return 0==(1&e)}function Sx(e,n,t,o){if(null===n)return-1;let c=0;if(o||!t){let u=!1;for(;c<n.length;){const f=n[c];if(f===e)return c;if(3===f||6===f)u=!0;else{if(1===f||2===f){let g=n[++c];for(;"string"==typeof g;)g=n[++c];continue}if(4===f)break;if(0===f){c+=4;continue}}c+=u?1:2}return-1}return function Ix(e,n){let t=e.indexOf(4);if(t>-1)for(t++;t<e.length;){const o=e[t];if("number"==typeof o)return-1;if(o===n)return t;t++}return-1}(n,e)}function mw(e,n,t=!1){for(let o=0;o<n.length;o++)if(fw(e,n[o],t))return!0;return!1}function wx(e,n){e:for(let t=0;t<n.length;t++){const o=n[t];if(e.length===o.length){for(let c=0;c<e.length;c++)if(e[c]!==o[c])continue e;return!0}}return!1}function dd(e,n){return e?":not("+n.trim()+")":n}function Rx(e){let n=e[0],t=1,o=2,c="",u=!1;for(;t<e.length;){let f=e[t];if("string"==typeof f)if(2&o){const g=e[++t];c+="["+f+(g.length>0?'="'+g+'"':"")+"]"}else 8&o?c+="."+f:4&o&&(c+=" "+f);else""!==c&&!Jo(f)&&(n+=dd(u,c),c=""),o=f,u=u||!Jo(o);t++}return""!==c&&(n+=dd(u,c)),n}function Br(e){return lc(()=>{const n=t_(e),t={...n,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===Ta.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||Xs.Emulated,styles:e.styles||un,_:null,schemas:e.schemas||null,tView:null,id:""};ye(t);const o=e.dependencies;return t.directiveDefs=ef(o,!1),t.pipeDefs=ef(o,!0),t.id=function n_(e){let n=0;const t=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const c of t)n=Math.imul(31,n)+c.charCodeAt(0)<<0;return n+=2147483648,"c"+n}(t),t})}function Dx(e){return Lt(e)||qi(e)}function Ox(e){return null!==e}function ui(e){return lc(()=>({type:e.type,bootstrap:e.bootstrap||un,declarations:e.declarations||un,imports:e.imports||un,exports:e.exports||un,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function my(e,n){if(null==e)return Ia;const t={};for(const o in e)if(e.hasOwnProperty(o)){const c=e[o];let u,f,g=Xe.None;Array.isArray(c)?(g=c[0],u=c[1],f=c[2]??u):(u=c,f=c),n?(t[u]=g!==Xe.None?[o,g]:o,n[u]=f):t[u]=o}return t}function Ye(e){return lc(()=>{const n=t_(e);return ye(n),n})}function Co(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function Lt(e){return e[Kp]||null}function qi(e){return e[ny]||null}function Rr(e){return e[iy]||null}function hr(e,n){const t=e[El]||null;if(!t&&!0===n)throw new Error(`Type ${$t(e)} does not have '\u0275mod' property.`);return t}function t_(e){const n={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:e.inputs||Ia,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||un,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:my(e.inputs,n),outputs:my(e.outputs),debugInfo:null}}function ye(e){e.features?.forEach(n=>n(e))}function ef(e,n){if(!e)return null;const t=n?Rr:Dx;return()=>("function"==typeof e?e():e).map(o=>t(o)).filter(Ox)}const Cn=0,Ne=1,et=2,Ai=3,Qo=4,Ar=5,Ms=6,ud=7,zn=8,jr=9,wa=10,Ct=11,Xu=12,gy=13,Cl=14,mi=15,Ju=16,Sl=17,xs=18,Qu=19,_y=20,pc=21,tf=22,fc=23,gt=25,i_=1,Js=7,Tl=9,Di=10;var r_=function(e){return e[e.None=0]="None",e[e.HasTransplantedViews=2]="HasTransplantedViews",e}(r_||{});function Dr(e){return Array.isArray(e)&&"object"==typeof e[i_]}function Or(e){return Array.isArray(e)&&!0===e[i_]}function o_(e){return 0!=(4&e.flags)}function hd(e){return e.componentOffset>-1}function rf(e){return 1==(1&e.flags)}function ks(e){return!!e.template}function s_(e){return 0!=(512&e[et])}function Il(e,n){return e.hasOwnProperty($s)?e[$s]:null}class Ty{constructor(n,t,o){this.previousValue=n,this.currentValue=t,this.firstChange=o}isFirstChange(){return this.firstChange}}function Iw(e,n,t,o){null!==n?n.applyValueToInputSignal(n,o):e[t]=o}function So(){return ww}function ww(e){return e.type.prototype.ngOnChanges&&(e.setInput=Rw),xx}function xx(){const e=d_(this),n=e?.current;if(n){const t=e.previous;if(t===Ia)e.previous=n;else for(let o in n)t[o]=n[o];e.current=null,this.ngOnChanges(n)}}function Rw(e,n,t,o,c){const u=this.declaredInputs[o],f=d_(e)||function kx(e,n){return e[Aw]=n}(e,{previous:Ia,current:null}),g=f.current||(f.current={}),E=f.previous,C=E[u];g[u]=new Ty(C&&C.currentValue,t,E===Ia),Iw(e,n,c,t)}So.ngInherit=!0;const Aw="__ngSimpleChanges__";function d_(e){return e[Aw]||null}const Ra=function(e,n,t){},Iy="svg";let Ow=!1;function On(e){for(;Array.isArray(e);)e=e[Cn];return e}function cf(e,n){return On(n[e])}function so(e,n){return On(n[e.index])}function eh(e,n){return e.data[n]}function wl(e,n){return e[n]}function To(e,n){const t=n[e];return Dr(t)?t:t[Cn]}function wy(e){return 128==(128&e[et])}function Qs(e,n){return null==n?null:e[n]}function Pw(e){e[Sl]=0}function Mw(e){1024&e[et]||(e[et]|=1024,wy(e)&&lf(e))}function kw(e){return 9216&e[et]||e[fc]?.dirty}function Ry(e){kw(e)?lf(e):64&e[et]&&(function Nw(){return Ow}()?(e[et]|=1024,lf(e)):e[wa].changeDetectionScheduler?.notify())}function lf(e){e[wa].changeDetectionScheduler?.notify();let n=Rl(e);for(;null!==n&&!(8192&n[et])&&(n[et]|=8192,wy(n));)n=Rl(n)}function u_(e,n){if(256==(256&e[et]))throw new he(911,!1);null===e[pc]&&(e[pc]=[]),e[pc].push(n)}function Rl(e){const n=e[Ai];return Or(n)?n[Ai]:n}const dt={lFrame:ky(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Uw(){return dt.bindingsEnabled}function Al(){return null!==dt.skipHydrationRootTNode}function fe(){return dt.lFrame.lView}function Kt(){return dt.lFrame.tView}function Aa(e){return dt.lFrame.contextLView=e,e[zn]}function Zs(e){return dt.lFrame.contextLView=null,e}function Nn(){let e=p_();for(;null!==e&&64===e.type;)e=e.parent;return e}function p_(){return dt.lFrame.currentTNode}function Da(e,n){const t=dt.lFrame;t.currentTNode=e,t.isParent=n}function hf(){return dt.lFrame.isParent}function Ny(){dt.lFrame.isParent=!1}function ao(){const e=dt.lFrame;let n=e.bindingRootIndex;return-1===n&&(n=e.bindingRootIndex=e.tView.bindingStartIndex),n}function ea(){return dt.lFrame.bindingIndex++}function gc(e){const n=dt.lFrame,t=n.bindingIndex;return n.bindingIndex=n.bindingIndex+e,t}function zx(e,n){const t=dt.lFrame;t.bindingIndex=t.bindingRootIndex=e,f_(n)}function f_(e){dt.lFrame.currentDirectiveIndex=e}function jw(){return dt.lFrame.currentQueryIndex}function My(e){dt.lFrame.currentQueryIndex=e}function xy(e){const n=e[Ne];return 2===n.type?n.declTNode:1===n.type?e[Ar]:null}function m_(e,n,t){if(t&Vt.SkipSelf){let c=n,u=e;for(;!(c=c.parent,null!==c||t&Vt.Host||(c=xy(u),null===c||(u=u[Cl],10&c.type))););if(null===c)return!1;n=c,e=u}const o=dt.lFrame=__();return o.currentTNode=n,o.lView=e,!0}function g_(e){const n=__(),t=e[Ne];dt.lFrame=n,n.currentTNode=t.firstChild,n.lView=e,n.tView=t,n.contextLView=e,n.bindingIndex=t.bindingStartIndex,n.inI18n=!1}function __(){const e=dt.lFrame,n=null===e?null:e.child;return null===n?ky(e):n}function ky(e){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=n),n}function Ly(){const e=dt.lFrame;return dt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const mf=Ly;function th(){const e=Ly();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Hr(){return dt.lFrame.selectedIndex}function Dl(e){dt.lFrame.selectedIndex=e}function Zn(){const e=dt.lFrame;return eh(e.tView,e.selectedIndex)}function Zo(){dt.lFrame.currentNamespace=Iy}function _c(){!function Yx(){dt.lFrame.currentNamespace=null}()}let Fy=!0;function v_(){return Fy}function pd(e){Fy=e}function b_(e,n){for(let t=n.directiveStart,o=n.directiveEnd;t<o;t++){const u=e.data[t].type.prototype,{ngAfterContentInit:f,ngAfterContentChecked:g,ngAfterViewInit:E,ngAfterViewChecked:C,ngOnDestroy:R}=u;f&&(e.contentHooks??=[]).push(-t,f),g&&((e.contentHooks??=[]).push(t,g),(e.contentCheckHooks??=[]).push(t,g)),E&&(e.viewHooks??=[]).push(-t,E),C&&((e.viewHooks??=[]).push(t,C),(e.viewCheckHooks??=[]).push(t,C)),null!=R&&(e.destroyHooks??=[]).push(t,R)}}function gf(e,n,t){nh(e,n,3,t)}function Ol(e,n,t,o){(3&e[et])===t&&nh(e,n,t,o)}function Uy(e,n){let t=e[et];(3&t)===n&&(t&=16383,t+=1,e[et]=t)}function nh(e,n,t,o){const u=o??-1,f=n.length-1;let g=0;for(let E=void 0!==o?65535&e[Sl]:0;E<f;E++)if("number"==typeof n[E+1]){if(g=n[E],null!=o&&g>=o)break}else n[E]<0&&(e[Sl]+=65536),(g<u||-1==u)&&(zw(e,t,n,E),e[Sl]=(4294901760&e[Sl])+E+2),E++}function Ww(e,n){Ra(4,e,n);const t=An(null);try{n.call(e)}finally{An(t),Ra(5,e,n)}}function zw(e,n,t,o){const c=t[o]<0,u=t[o+1],g=e[c?-t[o]:t[o]];c?e[et]>>14<e[Sl]>>16&&(3&e[et])===n&&(e[et]+=16384,Ww(g,u)):Ww(g,u)}const ta=-1;class _f{constructor(n,t,o){this.factory=n,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=o}}function gi(e){return e!==ta}function Ef(e){return 32767&e}function vf(e,n){let t=function Xx(e){return e>>16}(e),o=n;for(;t>0;)o=o[Cl],t--;return o}let Vy=!0;function bf(e){const n=Vy;return Vy=e,n}const qw=255,Yw=5;let Jx=0;const Oa={};function S_(e,n){const t=Pl(e,n);if(-1!==t)return t;const o=n[Ne];o.firstCreatePass&&(e.injectorIndex=n.length,T_(o.data,e),T_(n,null),T_(o.blueprint,null));const c=I_(e,n),u=e.injectorIndex;if(gi(c)){const f=Ef(c),g=vf(c,n),E=g[Ne].data;for(let C=0;C<8;C++)n[u+C]=g[f+C]|E[f+C]}return n[u+8]=c,u}function T_(e,n){e.push(0,0,0,0,0,0,0,0,n)}function Pl(e,n){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===n[e.injectorIndex+8]?-1:e.injectorIndex}function I_(e,n){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let t=0,o=null,c=n;for(;null!==c;){if(o=Zw(c),null===o)return ta;if(t++,c=c[Cl],-1!==o.injectorIndex)return o.injectorIndex|t<<16}return ta}function w_(e,n,t){!function Qx(e,n,t){let o;"string"==typeof t?o=t.charCodeAt(0)||0:t.hasOwnProperty(qp)&&(o=t[qp]),null==o&&(o=t[qp]=Jx++);const c=o&qw;n.data[e+(c>>Yw)]|=1<<c}(e,n,t)}function By(e,n,t){if(t&Vt.Optional||void 0!==e)return e;ry()}function $w(e,n,t,o){if(t&Vt.Optional&&void 0===o&&(o=null),!(t&(Vt.Self|Vt.Host))){const c=e[jr],u=yo(void 0);try{return c?c.get(n,o,t&Vt.Optional):Ps(n,o,t&Vt.Optional)}finally{yo(u)}}return By(o,0,t)}function Xw(e,n,t,o=Vt.Default,c){if(null!==e){if(2048&n[et]&&!(o&Vt.Self)){const f=function t1(e,n,t,o,c){let u=e,f=n;for(;null!==u&&null!==f&&2048&f[et]&&!(512&f[et]);){const g=R_(u,f,t,o|Vt.Self,Oa);if(g!==Oa)return g;let E=u.parent;if(!E){const C=f[_y];if(C){const R=C.get(t,Oa,o);if(R!==Oa)return R}E=Zw(f),f=f[Cl]}u=E}return c}(e,n,t,o,Oa);if(f!==Oa)return f}const u=R_(e,n,t,o,Oa);if(u!==Oa)return u}return $w(n,t,o,c)}function R_(e,n,t,o,c){const u=function Jw(e){if("string"==typeof e)return e.charCodeAt(0)||0;const n=e.hasOwnProperty(qp)?e[qp]:void 0;return"number"==typeof n?n>=0?n&qw:e1:n}(t);if("function"==typeof u){if(!m_(n,e,o))return o&Vt.Host?By(c,0,o):$w(n,t,o,c);try{let f;if(f=u(o),null!=f||o&Vt.Optional)return f;ry()}finally{mf()}}else if("number"==typeof u){let f=null,g=Pl(e,n),E=ta,C=o&Vt.Host?n[mi][Ar]:null;for((-1===g||o&Vt.SkipSelf)&&(E=-1===g?I_(e,n):n[g+8],E!==ta&&Qw(o,!1)?(f=n[Ne],g=Ef(E),n=vf(E,n)):g=-1);-1!==g;){const R=n[Ne];if(D_(u,g,R.data)){const P=jy(g,n,t,f,o,C);if(P!==Oa)return P}E=n[g+8],E!==ta&&Qw(o,n[Ne].data[g+8]===C)&&D_(u,g,n)?(f=R,g=Ef(E),n=vf(E,n)):g=-1}}return c}function jy(e,n,t,o,c,u){const f=n[Ne],g=f.data[e+8],R=A_(g,f,t,null==o?hd(g)&&Vy:o!=f&&0!=(3&g.type),c&Vt.Host&&u===g);return null!==R?Ml(n,f,R,g):Oa}function A_(e,n,t,o,c){const u=e.providerIndexes,f=n.data,g=1048575&u,E=e.directiveStart,R=u>>20,B=c?g+R:e.directiveEnd;for(let G=o?g:g+R;G<B;G++){const Y=f[G];if(G<E&&t===Y||G>=E&&Y.type===t)return G}if(c){const G=f[E];if(G&&ks(G)&&G.type===t)return E}return null}function Ml(e,n,t,o){let c=e[t];const u=n.data;if(function y_(e){return e instanceof _f}(c)){const f=c;f.resolving&&function cx(e,n){const t=n?`. Dependency path: ${n.join(" > ")} > ${e}`:"";throw new he(-200,`Circular dependency in DI detected for ${e}${t}`)}(function ln(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():yt(e)}(u[t]));const g=bf(f.canSeeViewProviders);f.resolving=!0;const C=f.injectImpl?yo(f.injectImpl):null;m_(e,o,Vt.Default);try{c=e[t]=f.factory(void 0,u,e,o),n.firstCreatePass&&t>=o.directiveStart&&function Gw(e,n,t){const{ngOnChanges:o,ngOnInit:c,ngDoCheck:u}=n.type.prototype;if(o){const f=ww(n);(t.preOrderHooks??=[]).push(e,f),(t.preOrderCheckHooks??=[]).push(e,f)}c&&(t.preOrderHooks??=[]).push(0-e,c),u&&((t.preOrderHooks??=[]).push(e,u),(t.preOrderCheckHooks??=[]).push(e,u))}(t,u[t],n)}finally{null!==C&&yo(C),bf(g),f.resolving=!1,mf()}}return c}function D_(e,n,t){return!!(t[n+(e>>Yw)]&1<<e)}function Qw(e,n){return!(e&Vt.Self||e&Vt.Host&&n)}class Oi{constructor(n,t){this._tNode=n,this._lView=t}get(n,t,o){return Xw(this._tNode,this._lView,n,Qg(o),t)}}function e1(){return new Oi(Nn(),fe())}function Yi(e){return lc(()=>{const n=e.prototype.constructor,t=n[$s]||Hy(n),o=Object.prototype;let c=Object.getPrototypeOf(e.prototype).constructor;for(;c&&c!==o;){const u=c[$s]||Hy(c);if(u&&u!==t)return u;c=Object.getPrototypeOf(c)}return u=>new u})}function Hy(e){return zg(e)?()=>{const n=Hy(nt(e));return n&&n()}:Il(e)}function Zw(e){const n=e[Ne],t=n.type;return 2===t?n.declTNode:1===t?e[Ar]:null}const rh="__parameters__";function oh(e,n,t){return lc(()=>{const o=function yf(e){return function(...t){if(e){const o=e(...t);for(const c in o)this[c]=o[c]}}}(n);function c(...u){if(this instanceof c)return o.apply(this,u),this;const f=new c(...u);return g.annotation=f,g;function g(E,C,R){const P=E.hasOwnProperty(rh)?E[rh]:Object.defineProperty(E,rh,{value:[]})[rh];for(;P.length<=R;)P.push(null);return(P[R]=P[R]||[]).push(f),E}}return t&&(c.prototype=Object.create(t.prototype)),c.prototype.ngMetadataName=e,c.annotationCls=c,c})}function xl(e,n){e.forEach(t=>Array.isArray(t)?xl(t,n):n(t))}function nR(e,n,t){n>=e.length?e.push(t):e.splice(n,0,t)}function Tf(e,n){return n>=e.length-1?e.pop():e.splice(n,1)[0]}function ts(e,n,t){let o=dh(e,n);return o>=0?e[1|o]=t:(o=~o,function Ky(e,n,t,o){let c=e.length;if(c==n)e.push(t,o);else if(1===c)e.push(o,e[0]),e[0]=t;else{for(c--,e.push(e[c-1],e[c]);c>n;)e[c]=e[c-2],c--;e[n]=t,e[n+1]=o}}(e,o,n,t)),o}function qy(e,n){const t=dh(e,n);if(t>=0)return e[1|t]}function dh(e,n){return function rR(e,n,t){let o=0,c=e.length>>t;for(;c!==o;){const u=o+(c-o>>1),f=e[u<<t];if(n===f)return u<<t;f>n?c=u:o=u+1}return~(c<<t)}(e,n,1)}const Ll=Qp(oh("Optional"),8),lh=Qp(oh("SkipSelf"),4),md=new De(""),uR=new De("",-1),Jy=new De("");class L_{get(n,t=Jp){if(t===Jp){const o=new Error(`NullInjectorError: No provider for ${$t(n)}!`);throw o.name="NullInjectorError",o}return t}}function hR(...e){return{\u0275providers:pR(0,e),\u0275fromNgModule:!0}}function pR(e,...n){const t=[],o=new Set;let c;const u=f=>{t.push(f)};return xl(n,f=>{const g=f;U_(g,u,[],o)&&(c||=[],c.push(g))}),void 0!==c&&F_(c,u),t}function F_(e,n){for(let t=0;t<e.length;t++){const{ngModule:o,providers:c}=e[t];Zy(c,u=>{n(u,o)})}}function U_(e,n,t,o){if(!(e=nt(e)))return!1;let c=null,u=$g(e);const f=!u&&Lt(e);if(u||f){if(f&&!f.standalone)return!1;c=e}else{const E=e.ngModule;if(u=$g(E),!u)return!1;c=E}const g=o.has(c);if(f){if(g)return!1;if(o.add(c),f.dependencies){const E="function"==typeof f.dependencies?f.dependencies():f.dependencies;for(const C of E)U_(C,n,t,o)}}else{if(!u)return!1;{if(null!=u.imports&&!g){let C;o.add(c);try{xl(u.imports,R=>{U_(R,n,t,o)&&(C||=[],C.push(R))})}finally{}void 0!==C&&F_(C,n)}if(!g){const C=Il(c)||(()=>new c);n({provide:c,useFactory:C,deps:un},c),n({provide:Jy,useValue:c,multi:!0},c),n({provide:md,useValue:()=>be(c),multi:!0},c)}const E=u.providers;if(null!=E&&!g){const C=e;Zy(E,R=>{n(R,C)})}}}return c!==e&&void 0!==e.providers}function Zy(e,n){for(let t of e)Kg(t)&&(t=t.\u0275providers),Array.isArray(t)?Zy(t,n):n(t)}const d1=Dn({provide:String,useValue:Dn});function eC(e){return null!==e&&"object"==typeof e&&d1 in e}function gd(e){return"function"==typeof e}const nC=new De(""),Df={},l1={};let V_;function B_(){return void 0===V_&&(V_=new L_),V_}class ns{}class Ul extends ns{get destroyed(){return this._destroyed}constructor(n,t,o,c){super(),this.parent=t,this.source=o,this.scopes=c,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,oC(n,f=>this.processProvider(f)),this.records.set(uR,Vl(void 0,this)),c.has("environment")&&this.records.set(ns,Vl(void 0,this));const u=this.records.get(nC);null!=u&&"string"==typeof u.value&&this.scopes.add(u.value),this.injectorDefTypes=new Set(this.get(Jy,un,Vt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();const n=this._onDestroyHooks;this._onDestroyHooks=[];for(const t of n)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();const t=Bt(this),o=yo(void 0);try{return n()}finally{Bt(t),yo(o)}}get(n,t=Jp,o=Vt.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(li))return n[li](this);o=Qg(o);const u=Bt(this),f=yo(void 0);try{if(!(o&Vt.SkipSelf)){let E=this.records.get(n);if(void 0===E){const C=function h1(e){return"function"==typeof e||"object"==typeof e&&e instanceof De}(n)&&Yg(n);E=C&&this.injectableDefInScope(C)?Vl(iC(n),Df):null,this.records.set(n,E)}if(null!=E)return this.hydrate(n,E)}return(o&Vt.Self?B_():this.parent).get(n,t=o&Vt.Optional&&t===Jp?null:t)}catch(g){if("NullInjectorError"===g.name){if((g[Jg]=g[Jg]||[]).unshift($t(n)),u)throw g;return function vx(e,n,t,o){const c=e[Jg];throw n[bl]&&c.unshift(n[bl]),e.message=function bx(e,n,t,o=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let c=$t(n);if(Array.isArray(n))c=n.map($t).join(" -> ");else if("object"==typeof n){let u=[];for(let f in n)if(n.hasOwnProperty(f)){let g=n[f];u.push(f+":"+("string"==typeof g?JSON.stringify(g):$t(g)))}c=`{${u.join(", ")}}`}return`${t}${o?"("+o+")":""}[${c}]: ${e.replace($u,"\n  ")}`}("\n"+e.message,c,t,o),e.ngTokenPath=c,e[Jg]=null,e}(g,n,"R3InjectorError",this.source)}throw g}finally{yo(f),Bt(u)}}resolveInjectorInitializers(){const n=Bt(this),t=yo(void 0);try{const c=this.get(md,un,Vt.Self);for(const u of c)u()}finally{Bt(n),yo(t)}}toString(){const n=[],t=this.records;for(const o of t.keys())n.push($t(o));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new he(205,!1)}processProvider(n){let t=gd(n=nt(n))?n:nt(n&&n.provide);const o=function gR(e){return eC(e)?Vl(void 0,e.useValue):Vl(rC(e),Df)}(n);if(!gd(n)&&!0===n.multi){let c=this.records.get(t);c||(c=Vl(void 0,Df,!0),c.factory=()=>py(c.multi),this.records.set(t,c)),t=n,c.multi.push(n)}this.records.set(t,o)}hydrate(n,t){return t.value===Df&&(t.value=l1,t.value=t.factory()),"object"==typeof t.value&&t.value&&function u1(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(n){if(!n.providedIn)return!1;const t=nt(n.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(n){const t=this._onDestroyHooks.indexOf(n);-1!==t&&this._onDestroyHooks.splice(t,1)}}function iC(e){const n=Yg(e),t=null!==n?n.factory:Il(e);if(null!==t)return t;if(e instanceof De)throw new he(204,!1);if(e instanceof Function)return function Of(e){if(e.length>0)throw new he(204,!1);const t=function ow(e){return e&&(e[Xg]||e[Yu])||null}(e);return null!==t?()=>t.factory(e):()=>new e}(e);throw new he(204,!1)}function rC(e,n,t){let o;if(gd(e)){const c=nt(e);return Il(c)||iC(c)}if(eC(e))o=()=>nt(e.useValue);else if(function tC(e){return!(!e||!e.useFactory)}(e))o=()=>e.useFactory(...py(e.deps||[]));else if(function fR(e){return!(!e||!e.useExisting)}(e))o=()=>be(nt(e.useExisting));else{const c=nt(e&&(e.useClass||e.provide));if(!function _R(e){return!!e.deps}(e))return Il(c)||iC(c);o=()=>new c(...py(e.deps))}return o}function Vl(e,n,t=!1){return{factory:e,value:n,multi:t?[]:void 0}}function oC(e,n){for(const t of e)Array.isArray(t)?oC(t,n):t&&Kg(t)?oC(t.\u0275providers,n):n(t)}function Ro(e,n){e instanceof Ul&&e.assertNotDestroyed();const o=Bt(e),c=yo(void 0);try{return n()}finally{Bt(o),yo(c)}}function yR(e,n=null,t=null,o){const c=CR(e,n,t,o);return c.resolveInjectorInitializers(),c}function CR(e,n=null,t=null,o,c=new Set){const u=[t||un,hR(e)];return o=o||("object"==typeof e?void 0:$t(e)),new Ul(u,n||B_(),o||null,c)}let dC,pr=(()=>{class e{static#e=this.THROW_IF_NOT_FOUND=Jp;static#t=this.NULL=new L_;static create(t,o){if(Array.isArray(t))return yR({name:""},o,t,"");{const c=t.name??"";return yR({name:c},t.parent,t.providers,c)}}static#n=this.\u0275prov=Pe({token:e,providedIn:"any",factory:()=>be(uR)});static#i=this.__NG_ELEMENT_ID__=-1}return e})();const Nf=new De("",{providedIn:"root",factory:()=>wR}),wR="ng",RR=new De(""),Pa=new De("",{providedIn:"platform",factory:()=>"unknown"}),bc=new De(""),lC=new De("",{providedIn:"root",factory:()=>function Na(){if(void 0!==dC)return dC;if(typeof document<"u")return document;throw new he(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});function uo(e){return e instanceof Function?e():e}function z_(e){return 128==(128&e.flags)}var Ma=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(Ma||{});const kR=/^>|^->|<!--|-->|--!>|<!-$/g,K_=/(<|>)/g,LR="\u200b$1\u200b";const q_=new Map;let UR=0;const bC="__ngContext__";function Gr(e,n){Dr(n)?(e[bC]=n[Qu],function VR(e){q_.set(e[Qu],e)}(n)):e[bC]=n}let X_;function CC(e,n){return X_(e,n)}function bd(e,n,t,o,c){if(null!=o){let u,f=!1;Or(o)?u=o:Dr(o)&&(f=!0,o=o[Cn]);const g=On(o);0===e&&null!==t?null==c?nE(n,t,g):Ls(n,t,g,c||null,!0):1===e&&null!==t?Ls(n,t,g,c||null,!0):2===e?function oE(e,n,t){const o=iE(e,n);o&&function M1(e,n,t,o){e.removeChild(n,t,o)}(e,o,n,t)}(n,g,f):3===e&&n.destroyNode(g),null!=u&&function k1(e,n,t,o,c){const u=t[Js];u!==On(t)&&bd(n,e,o,u,c);for(let g=Di;g<t.length;g++){const E=t[g];sE(E[Ne],E,e,n,o,u)}}(n,e,u,t,c)}}function Q_(e,n){return e.createComment(function FR(e){return e.replace(kR,n=>n.replace(K_,LR))}(n))}function Z_(e,n,t){return e.createElement(n,t)}function $R(e,n){sE(e,n,n[Ct],2,null,null)}function SC(e,n){const t=e[Tl],o=t.indexOf(n);t.splice(o,1)}function xf(e,n){if(e.length<=Di)return;const t=Di+n,o=e[t];if(o){const c=o[Ju];null!==c&&c!==e&&SC(c,o),n>0&&(e[t-1][Qo]=o[Qo]);const u=Tf(e,Di+n);!function YR(e,n){$R(e,n),n[Cn]=null,n[Ar]=null}(o[Ne],o);const f=u[xs];null!==f&&f.detachView(u[Ne]),o[Ai]=null,o[Qo]=null,o[et]&=-129}return o}function kf(e,n){if(!(256&n[et])){const t=n[Ct];t.destroyNode&&sE(e,n,t,3,null,null),function N1(e){let n=e[Xu];if(!n)return Lf(e[Ne],e);for(;n;){let t=null;if(Dr(n))t=n[Xu];else{const o=n[Di];o&&(t=o)}if(!t){for(;n&&!n[Qo]&&n!==e;)Dr(n)&&Lf(n[Ne],n),n=n[Ai];null===n&&(n=e),Dr(n)&&Lf(n[Ne],n),t=n&&n[Qo]}n=t}}(n)}}function Lf(e,n){if(!(256&n[et])){n[et]&=-129,n[et]|=256,n[fc]&&function jI(e){if(cc(e),Gp(e))for(let n=0;n<e.producerNode.length;n++)Lg(e.producerNode[n],e.producerIndexOfThis[n]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}(n[fc]),function P1(e,n){let t;if(null!=e&&null!=(t=e.destroyHooks))for(let o=0;o<t.length;o+=2){const c=n[t[o]];if(!(c instanceof _f)){const u=t[o+1];if(Array.isArray(u))for(let f=0;f<u.length;f+=2){const g=c[u[f]],E=u[f+1];Ra(4,g,E);try{E.call(g)}finally{Ra(5,g,E)}}else{Ra(4,c,u);try{u.call(c)}finally{Ra(5,c,u)}}}}}(e,n),function JR(e,n){const t=e.cleanup,o=n[ud];if(null!==t)for(let u=0;u<t.length-1;u+=2)if("string"==typeof t[u]){const f=t[u+3];f>=0?o[f]():o[-f].unsubscribe(),u+=2}else t[u].call(o[t[u+1]]);null!==o&&(n[ud]=null);const c=n[pc];if(null!==c){n[pc]=null;for(let u=0;u<c.length;u++)(0,c[u])()}}(e,n),1===n[Ne].type&&n[Ct].destroy();const t=n[Ju];if(null!==t&&Or(n[Ai])){t!==n[Ai]&&SC(t,n);const o=n[xs];null!==o&&o.detachView(e)}!function w1(e){q_.delete(e[Qu])}(n)}}function tE(e,n,t){return function TC(e,n,t){let o=n;for(;null!==o&&40&o.type;)o=(n=o).parent;if(null===o)return t[Cn];{const{componentOffset:c}=o;if(c>-1){const{encapsulation:u}=e.data[o.directiveStart+c];if(u===Xs.None||u===Xs.Emulated)return null}return so(o,t)}}(e,n.parent,t)}function Ls(e,n,t,o,c){e.insertBefore(n,t,o,c)}function nE(e,n,t){e.appendChild(n,t)}function QR(e,n,t,o,c){null!==o?Ls(e,n,t,o,c):nE(e,n,t)}function iE(e,n){return e.parentNode(n)}function eA(e,n,t){return tA(e,n,t)}let wC,tA=function IC(e,n,t){return 40&e.type?so(e,t):null};function rE(e,n,t,o){const c=tE(e,o,n),u=n[Ct],g=eA(o.parent||n[Ar],o,n);if(null!=c)if(Array.isArray(t))for(let E=0;E<t.length;E++)QR(u,c,t[E],g,!1);else QR(u,c,t,g,!1);void 0!==wC&&wC(u,o,n,t,c)}function _h(e,n){if(null!==n){const t=n.type;if(3&t)return so(n,e);if(4&t)return DC(-1,e[n.index]);if(8&t){const o=n.child;if(null!==o)return _h(e,o);{const c=e[n.index];return Or(c)?DC(-1,c):On(c)}}if(32&t)return CC(n,e)()||On(e[n.index]);{const o=AC(e,n);return null!==o?Array.isArray(o)?o[0]:_h(Rl(e[mi]),o):_h(e,n.next)}}return null}function AC(e,n){return null!==n?e[mi][Ar].projection[n.projection]:null}function DC(e,n){const t=Di+e+1;if(t<n.length){const o=n[t],c=o[Ne].firstChild;if(null!==c)return _h(o,c)}return n[Js]}function jl(e,n,t,o,c,u,f){for(;null!=t;){const g=o[t.index],E=t.type;if(f&&0===n&&(g&&Gr(On(g),o),t.flags|=2),32!=(32&t.flags))if(8&E)jl(e,n,t.child,o,c,u,!1),bd(n,e,c,g,u);else if(32&E){const C=CC(t,o);let R;for(;R=C();)bd(n,e,c,R,u);bd(n,e,c,g,u)}else 16&E?S(e,n,o,t,c,u):bd(n,e,c,g,u);t=f?t.projectionNext:t.next}}function sE(e,n,t,o,c,u){jl(t,o,e.firstChild,n,c,u,!1)}function S(e,n,t,o,c,u){const f=t[mi],E=f[Ar].projection[o.projection];if(Array.isArray(E))for(let C=0;C<E.length;C++)bd(n,e,c,E[C],u);else{let C=E;const R=f[Ai];z_(o)&&(C.flags|=128),jl(e,n,C,R,c,u,!0)}}function nA(e,n,t){""===t?e.removeAttribute(n,"class"):e.setAttribute(n,"class",t)}function iA(e,n,t){const{mergedAttrs:o,classes:c,styles:u}=t;null!==o&&fy(e,n,o),null!==c&&nA(e,n,c),null!==u&&function F1(e,n,t){e.setAttribute(n,"style",t)}(e,n,u)}class aE{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${ey})`}}function yd(e){return e instanceof aE?e.changingThisBreaksApplicationSecurity:e}const pA=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Ch=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(Ch||{});function LC(e){const n=function Sh(){const e=fe();return e&&e[wa].sanitizer}();return n?n.sanitize(Ch.URL,e)||"":function bh(e,n){const t=function W1(e){return e instanceof aE&&e.getTypeName()||null}(e);if(null!=t&&t!==n){if("ResourceURL"===t&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${t} (see ${ey})`)}return t===n}(e,"URL")?yd(e):function cE(e){return(e=String(e)).match(pA)?e:"unsafe:"+e}(yt(e))}class FC{}let IA=()=>null;function WC(e,n,t=!1){return IA(e,n,t)}class fk{}class RA{}class gE{resolveComponentFactory(n){throw function mk(e){const n=Error(`No component factory found for ${$t(e)}.`);return n.ngComponent=e,n}(n)}}let Dh=(()=>{class e{static#e=this.NULL=new gE}return e})();function Oh(){return Cd(Nn(),fe())}function Cd(e,n){return new tn(so(e,n))}let tn=(()=>{class e{constructor(t){this.nativeElement=t}static#e=this.__NG_ELEMENT_ID__=Oh}return e})();function Nh(e){return e instanceof tn?e.nativeElement:e}class _E{}let Fs=(()=>{class e{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function Hf(){const e=fe(),t=To(Nn().index,e);return(Dr(t)?t:e)[Ct]}()}return e})(),gk=(()=>{class e{static#e=this.\u0275prov=Pe({token:e,providedIn:"root",factory:()=>null})}return e})();const YC={};function DA(e){const n=An(null);try{return e()}finally{An(n)}}function EE(e){return!!function $C(e){return null!==e&&("function"==typeof e||"object"==typeof e)}(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}class NA{constructor(){}supports(n){return EE(n)}create(n){return new yk(n)}}const PA=(e,n)=>n;class yk{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||PA}forEachItem(n){let t;for(t=this._itHead;null!==t;t=t._next)n(t)}forEachOperation(n){let t=this._itHead,o=this._removalsHead,c=0,u=null;for(;t||o;){const f=!o||t&&t.currentIndex<kA(o,c,u)?t:o,g=kA(f,c,u),E=f.currentIndex;if(f===o)c--,o=o._nextRemoved;else if(t=t._next,null==f.previousIndex)c++;else{u||(u=[]);const C=g-c,R=E-c;if(C!=R){for(let B=0;B<C;B++){const G=B<u.length?u[B]:u[B]=0,Y=G+B;R<=Y&&Y<C&&(u[B]=G+1)}u[f.previousIndex]=R-C}}g!==E&&n(f,g,E)}}forEachPreviousItem(n){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)n(t)}forEachAddedItem(n){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)n(t)}forEachMovedItem(n){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)n(t)}forEachRemovedItem(n){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)n(t)}forEachIdentityChange(n){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)n(t)}diff(n){if(null==n&&(n=[]),!EE(n))throw new he(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let c,u,f,t=this._itHead,o=!1;if(Array.isArray(n)){this.length=n.length;for(let g=0;g<this.length;g++)u=n[g],f=this._trackByFn(g,u),null!==t&&Object.is(t.trackById,f)?(o&&(t=this._verifyReinsertion(t,u,f,g)),Object.is(t.item,u)||this._addIdentityChange(t,u)):(t=this._mismatch(t,u,f,g),o=!0),t=t._next}else c=0,function bk(e,n){if(Array.isArray(e))for(let t=0;t<e.length;t++)n(e[t]);else{const t=e[Symbol.iterator]();let o;for(;!(o=t.next()).done;)n(o.value)}}(n,g=>{f=this._trackByFn(c,g),null!==t&&Object.is(t.trackById,f)?(o&&(t=this._verifyReinsertion(t,g,f,c)),Object.is(t.item,g)||this._addIdentityChange(t,g)):(t=this._mismatch(t,g,f,c),o=!0),t=t._next,c++}),this.length=c;return this._truncate(t),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,t,o,c){let u;return null===n?u=this._itTail:(u=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(o,null))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._reinsertAfter(n,u,c)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(o,c))?(Object.is(n.item,t)||this._addIdentityChange(n,t),this._moveAfter(n,u,c)):n=this._addAfter(new MA(t,o),u,c),n}_verifyReinsertion(n,t,o,c){let u=null===this._unlinkedRecords?null:this._unlinkedRecords.get(o,null);return null!==u?n=this._reinsertAfter(u,n._prev,c):n.currentIndex!=c&&(n.currentIndex=c,this._addToMoves(n,c)),n}_truncate(n){for(;null!==n;){const t=n._next;this._addToRemovals(this._unlink(n)),n=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,t,o){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const c=n._prevRemoved,u=n._nextRemoved;return null===c?this._removalsHead=u:c._nextRemoved=u,null===u?this._removalsTail=c:u._prevRemoved=c,this._insertAfter(n,t,o),this._addToMoves(n,o),n}_moveAfter(n,t,o){return this._unlink(n),this._insertAfter(n,t,o),this._addToMoves(n,o),n}_addAfter(n,t,o){return this._insertAfter(n,t,o),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,t,o){const c=null===t?this._itHead:t._next;return n._next=c,n._prev=t,null===c?this._itTail=n:c._prev=n,null===t?this._itHead=n:t._next=n,null===this._linkedRecords&&(this._linkedRecords=new xA),this._linkedRecords.put(n),n.currentIndex=o,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const t=n._prev,o=n._next;return null===t?this._itHead=o:t._next=o,null===o?this._itTail=t:o._prev=t,n}_addToMoves(n,t){return n.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new xA),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,t){return n.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class MA{constructor(n,t){this.item=n,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class is{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,t){let o;for(o=this._head;null!==o;o=o._nextDup)if((null===t||t<=o.currentIndex)&&Object.is(o.trackById,n))return o;return null}remove(n){const t=n._prevDup,o=n._nextDup;return null===t?this._head=o:t._nextDup=o,null===o?this._tail=t:o._prevDup=t,null===this._head}}class xA{constructor(){this.map=new Map}put(n){const t=n.trackById;let o=this.map.get(t);o||(o=new is,this.map.set(t,o)),o.add(n)}get(n,t){const c=this.map.get(n);return c?c.get(n,t):null}remove(n){const t=n.trackById;return this.map.get(t).remove(n)&&this.map.delete(t),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function kA(e,n,t){const o=e.previousIndex;if(null===o)return o;let c=0;return t&&o<t.length&&(c=t[o]),o+n+c}function JC(){return new QC([new NA])}let QC=(()=>{class e{static#e=this.\u0275prov=Pe({token:e,providedIn:"root",factory:JC});constructor(t){this.factories=t}static create(t,o){if(null!=o){const c=o.factories.slice();t=t.concat(c)}return new e(t)}static extend(t){return{provide:e,useFactory:o=>e.create(t,o||JC()),deps:[[e,new lh,new Ll]]}}find(t){const o=this.factories.find(c=>c.supports(t));if(null!=o)return o;throw new he(901,!1)}}return e})();function Gl(e,n,t,o,c=!1){for(;null!==t;){const u=n[t.index];null!==u&&o.push(On(u)),Or(u)&&bE(u,o);const f=t.type;if(8&f)Gl(e,n,t.child,o);else if(32&f){const g=CC(t,n);let E;for(;E=g();)o.push(E)}else if(16&f){const g=AC(n,t);if(Array.isArray(g))o.push(...g);else{const E=Rl(n[mi]);Gl(E[Ne],E,g,o,!0)}}t=c?t.projectionNext:t.next}return o}function bE(e,n){for(let t=Di;t<e.length;t++){const o=e[t],c=o[Ne].firstChild;null!==c&&Gl(o[Ne],o,c,n)}e[Js]!==e[Cn]&&n.push(e[Js])}let UA=[];const wk={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{},consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{lf(e.lView)},consumerOnSignalRead(){this.lView[fc]=this}};function tS(e){return CE(e[Xu])}function yE(e){return CE(e[Qo])}function CE(e){for(;null!==e&&!Or(e);)e=e[Qo];return e}function SE(e){return e.ngOriginalError}class xa{constructor(){this._console=console}handleError(n){const t=this._findOriginalError(n);this._console.error("ERROR",n),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(n){let t=n&&SE(n);for(;t&&SE(t);)t=SE(t);return t||null}}const Wl=new De("",{providedIn:"root",factory:()=>Te(xa).handleError.bind(void 0)}),IE=new De("",{providedIn:"root",factory:()=>!1}),_t={};function Qe(e=1){iS(Kt(),fe(),Hr()+e,!1)}function iS(e,n,t,o){if(!o)if(3==(3&n[et])){const u=e.preOrderCheckHooks;null!==u&&gf(n,u,t)}else{const u=e.preOrderHooks;null!==u&&Ol(n,u,0,t)}Dl(t)}function ae(e,n=Vt.Default){const t=fe();return null===t?be(e,n):Xw(Nn(),t,nt(e),n)}function Mh(){throw new Error("invalid")}function rS(e,n,t,o,c,u){const f=An(null);try{let g=null;c&Xe.SignalBased&&(g=n[o][Yo]),null!==g&&void 0!==g.transformFn&&(u=g.transformFn(u)),c&Xe.HasDecoratorInputTransform&&(u=e.inputTransforms[o].call(n,u)),null!==e.setInput?e.setInput(n,g,u,t,o):Iw(n,g,o,u)}finally{An(f)}}function zl(e,n,t,o,c,u,f,g,E,C,R){const P=n.blueprint.slice();return P[Cn]=c,P[et]=204|o,(null!==C||e&&2048&e[et])&&(P[et]|=2048),Pw(P),P[Ai]=P[Cl]=e,P[zn]=t,P[wa]=f||e&&e[wa],P[Ct]=g||e&&e[Ct],P[jr]=E||e&&e[jr]||null,P[Ar]=u,P[Qu]=function I1(){return UR++}(),P[Ms]=R,P[_y]=C,P[mi]=2==n.type?e[mi]:P,P}function yc(e,n,t,o,c){let u=e.data[n];if(null===u)u=function sS(e,n,t,o,c){const u=p_(),f=hf(),E=e.data[n]=function Lk(e,n,t,o,c,u){let f=n?n.injectorIndex:-1,g=0;return Al()&&(g|=128),{type:t,index:o,insertBeforeIndex:null,injectorIndex:f,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:g,providerIndexes:0,value:c,attrs:u,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,f?u:u&&u.parent,t,n,o,c);return null===e.firstChild&&(e.firstChild=E),null!==u&&(f?null==u.child&&null!==E.parent&&(u.child=E):null===u.next&&(u.next=E,E.prev=u)),E}(e,n,t,o,c),function Bw(){return dt.lFrame.inI18n}()&&(u.flags|=32);else if(64&u.type){u.type=t,u.value=o,u.attrs=c;const f=function uf(){const e=dt.lFrame,n=e.currentTNode;return e.isParent?n:n.parent}();u.injectorIndex=null===f?-1:f.injectorIndex}return Da(u,!0),u}function ka(e,n,t,o){if(0===t)return-1;const c=n.length;for(let u=0;u<t;u++)n.push(o),e.blueprint.push(o),e.data.push(null);return c}function Td(e,n,t,o,c){const u=Hr(),f=2&o;try{Dl(-1),f&&n.length>gt&&iS(e,n,gt,!1),Ra(f?2:0,c),t(o,c)}finally{Dl(u),Ra(f?3:1,c)}}function wE(e,n,t){if(o_(n)){const o=An(null);try{const u=n.directiveEnd;for(let f=n.directiveStart;f<u;f++){const g=e.data[f];g.contentQueries&&g.contentQueries(1,t[f],f)}}finally{An(o)}}}function aS(e,n,t){Uw()&&(function Id(e,n,t,o){const c=t.directiveStart,u=t.directiveEnd;hd(t)&&function zk(e,n,t){const o=so(n,e),c=xh(t);let f=16;t.signals?f=4096:t.onPush&&(f=64);const g=Lh(e,zl(e,c,null,f,o,n,null,e[wa].rendererFactory.createRenderer(o,t),null,null,null));e[n.index]=g}(n,t,e.data[c+t.componentOffset]),e.firstCreatePass||S_(t,n),Gr(o,n);const f=t.initialInputs;for(let g=c;g<u;g++){const E=e.data[g],C=Ml(n,e,g,t);Gr(C,n),null!==f&&Kk(0,g-c,C,E,0,f),ks(E)&&(To(t.index,n)[zn]=Ml(n,e,g,t))}}(e,n,t,so(t,n)),64==(64&t.flags)&&kh(e,n,t))}function cS(e,n,t=so){const o=n.localNames;if(null!==o){let c=n.index+1;for(let u=0;u<o.length;u+=2){const f=o[u+1],g=-1===f?t(n,e):e[f];e[c++]=g}}}function xh(e){const n=e.tView;return null===n||n.incompleteFirstPass?e.tView=dS(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):n}function dS(e,n,t,o,c,u,f,g,E,C,R){const P=gt+o,B=P+c,G=function Pk(e,n){const t=[];for(let o=0;o<n;o++)t.push(o<e?null:_t);return t}(P,B),Y="function"==typeof C?C():C;return G[Ne]={type:e,blueprint:G,template:t,queries:null,viewQuery:g,declTNode:n,data:G.slice().fill(null,P),bindingStartIndex:P,expandoStartIndex:B,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof u?u():u,pipeRegistry:"function"==typeof f?f():f,firstChild:null,schemas:E,consts:Y,incompleteFirstPass:!1,ssrId:R}}let zA=()=>null;function uS(e,n,t,o,c){for(let u in n){if(!n.hasOwnProperty(u))continue;const f=n[u];if(void 0===f)continue;o??={};let g,E=Xe.None;Array.isArray(f)?(g=f[0],E=f[1]):g=f;let C=u;if(null!==c){if(!c.hasOwnProperty(u))continue;C=c[u]}0===e?hS(o,t,C,g,E):hS(o,t,C,g)}return o}function hS(e,n,t,o,c){let u;e.hasOwnProperty(t)?(u=e[t]).push(n,o):u=e[t]=[n,o],void 0!==c&&u.push(c)}function Ni(e,n,t,o,c,u,f,g){const E=so(n,t);let R,C=n.inputs;!g&&null!=C&&(R=C[o])?(ES(e,t,R,o,c),hd(n)&&function qA(e,n){const t=To(n,e);16&t[et]||(t[et]|=64)}(t,n.index)):3&n.type&&(o=function Wf(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(o),c=null!=f?f(c,n.value||"",o):c,u.setProperty(E,o,c))}function zf(e,n,t,o){if(Uw()){const c=null===o?null:{"":-1},u=function jk(e,n){const t=e.directiveRegistry;let o=null,c=null;if(t)for(let u=0;u<t.length;u++){const f=t[u];if(mw(n,f.selectors,!1))if(o||(o=[]),ks(f))if(null!==f.findHostDirectiveDefs){const g=[];c=c||new Map,f.findHostDirectiveDefs(f,g,c),o.unshift(...g,f),fS(e,n,g.length)}else o.unshift(f),fS(e,n,0);else c=c||new Map,f.findHostDirectiveDefs?.(f,o,c),o.push(f)}return null===o?null:[o,c]}(e,t);let f,g;null===u?f=g=null:[f,g]=u,null!==f&&pS(e,n,t,f,c,g),c&&function Hk(e,n,t){if(n){const o=e.localNames=[];for(let c=0;c<n.length;c+=2){const u=t[n[c+1]];if(null==u)throw new he(-301,!1);o.push(n[c],u)}}}(t,o,c)}t.mergedAttrs=Zp(t.mergedAttrs,t.attrs)}function pS(e,n,t,o,c,u){for(let C=0;C<o.length;C++)w_(S_(t,n),e,o[C].type);!function Gk(e,n,t){e.flags|=1,e.directiveStart=n,e.directiveEnd=n+t,e.providerIndexes=n}(t,e.data.length,o.length);for(let C=0;C<o.length;C++){const R=o[C];R.providersResolver&&R.providersResolver(R)}let f=!1,g=!1,E=ka(e,n,o.length,null);for(let C=0;C<o.length;C++){const R=o[C];t.mergedAttrs=Zp(t.mergedAttrs,R.hostAttrs),Wk(e,t,n,E,R),mS(E,R,c),null!==R.contentQueries&&(t.flags|=4),(null!==R.hostBindings||null!==R.hostAttrs||0!==R.hostVars)&&(t.flags|=64);const P=R.type.prototype;!f&&(P.ngOnChanges||P.ngOnInit||P.ngDoCheck)&&((e.preOrderHooks??=[]).push(t.index),f=!0),!g&&(P.ngOnChanges||P.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(t.index),g=!0),E++}!function Fk(e,n,t){const c=n.directiveEnd,u=e.data,f=n.attrs,g=[];let E=null,C=null;for(let R=n.directiveStart;R<c;R++){const P=u[R],B=t?t.get(P):null,Y=B?B.outputs:null;E=uS(0,P.inputs,R,E,B?B.inputs:null),C=uS(1,P.outputs,R,C,Y);const J=null===E||null===f||pw(n)?null:qk(E,R,f);g.push(J)}null!==E&&(E.hasOwnProperty("class")&&(n.flags|=8),E.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=g,n.inputs=E,n.outputs=C}(e,t,u)}function kh(e,n,t){const o=t.directiveStart,c=t.directiveEnd,u=t.index,f=function Kx(){return dt.lFrame.currentDirectiveIndex}();try{Dl(u);for(let g=o;g<c;g++){const E=e.data[g],C=n[g];f_(g),(null!==E.hostBindings||0!==E.hostVars||null!==E.hostAttrs)&&Bk(E,C)}}finally{Dl(-1),f_(f)}}function Bk(e,n){null!==e.hostBindings&&e.hostBindings(1,n)}function fS(e,n,t){n.componentOffset=t,(e.components??=[]).push(n.index)}function mS(e,n,t){if(t){if(n.exportAs)for(let o=0;o<n.exportAs.length;o++)t[n.exportAs[o]]=e;ks(n)&&(t[""]=e)}}function Wk(e,n,t,o,c){e.data[o]=c;const u=c.factory||(c.factory=Il(c.type)),f=new _f(u,ks(c),ae);e.blueprint[o]=f,t[o]=f,function Vk(e,n,t,o,c){const u=c.hostBindings;if(u){let f=e.hostBindingOpCodes;null===f&&(f=e.hostBindingOpCodes=[]);const g=~n.index;(function RE(e){let n=e.length;for(;n>0;){const t=e[--n];if("number"==typeof t&&t<0)return t}return 0})(f)!=g&&f.push(g),f.push(t,o,u)}}(e,n,o,ka(e,t,c.hostVars,_t),c)}function ra(e,n,t,o,c,u){const f=so(e,n);!function Kf(e,n,t,o,c,u,f){if(null==u)e.removeAttribute(n,c,t);else{const g=null==f?yt(u):f(u,o||"",c);e.setAttribute(n,c,g,t)}}(n[Ct],f,u,e.value,t,o,c)}function Kk(e,n,t,o,c,u){const f=u[n];if(null!==f)for(let g=0;g<f.length;)rS(o,t,f[g++],f[g++],f[g++],f[g++])}function qk(e,n,t){let o=null,c=0;for(;c<t.length;){const u=t[c];if(0!==u)if(5!==u){if("number"==typeof u)break;if(e.hasOwnProperty(u)){null===o&&(o=[]);const f=e[u];for(let g=0;g<f.length;g+=3)if(f[g]===n){o.push(u,f[g+1],f[g+2],t[c+1]);break}}c+=2}else c+=2;else c+=4}return o}function YA(e,n,t,o){return[e,!0,0,n,null,o,null,t,null,null]}function gS(e,n){const t=e.contentQueries;if(null!==t){const o=An(null);try{for(let c=0;c<t.length;c+=2){const f=t[c+1];if(-1!==f){const g=e.data[f];My(t[c]),g.contentQueries(2,n[f],f)}}}finally{An(o)}}}function Lh(e,n){return e[Xu]?e[gy][Qo]=n:e[Xu]=n,e[gy]=n,n}function AE(e,n,t){My(0);const o=An(null);try{n(e,t)}finally{An(o)}}function qf(e){return e[ud]||(e[ud]=[])}function _S(e){return e.cleanup||(e.cleanup=[])}function Fh(e,n){const t=e[jr],o=t?t.get(xa,null):null;o&&o.handleError(n)}function ES(e,n,t,o,c){for(let u=0;u<t.length;){const f=t[u++],g=t[u++],E=t[u++];rS(e.data[f],n[f],o,g,E,c)}}function vS(e,n,t,o){const c=n[et];if(256==(256&c))return;n[wa].inlineEffectRunner?.flush(),g_(n);let f=null,g=null;(function bS(e){return 2!==e.type})(e)&&(g=function ZC(e){return e[fc]??function Ik(e){const n=UA.pop()??Object.create(wk);return n.lView=e,n}(e)}(n),f=function kg(e){return e&&(e.nextProducerIndex=0),An(e)}(g));try{Pw(n),function pf(e){return dt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==t&&Td(e,n,t,2,o);const E=3==(3&c);if(E){const P=e.preOrderCheckHooks;null!==P&&gf(n,P,null)}else{const P=e.preOrderHooks;null!==P&&Ol(n,P,0,null),Uy(n,0)}if(function $k(e){for(let n=tS(e);null!==n;n=yE(n)){if(!(n[et]&r_.HasTransplantedViews))continue;const t=n[Tl];for(let o=0;o<t.length;o++){Mw(t[o])}}}(n),QA(n,0),null!==e.contentQueries&&gS(e,n),E){const P=e.contentCheckHooks;null!==P&&gf(n,P)}else{const P=e.contentHooks;null!==P&&Ol(n,P,1),Uy(n,1)}!function oS(e,n){const t=e.hostBindingOpCodes;if(null!==t)try{for(let o=0;o<t.length;o++){const c=t[o];if(c<0)Dl(~c);else{const u=c,f=t[++o],g=t[++o];zx(f,u),g(2,n[u])}}}finally{Dl(-1)}}(e,n);const C=e.components;null!==C&&CS(n,C,0);const R=e.viewQuery;if(null!==R&&AE(2,R,o),E){const P=e.viewCheckHooks;null!==P&&gf(n,P)}else{const P=e.viewHooks;null!==P&&Ol(n,P,2),Uy(n,2)}if(!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),n[tf]){for(const P of n[tf])P();n[tf]=null}n[et]&=-73}catch(E){throw lf(n),E}finally{null!==g&&(function Wb(e,n){if(An(n),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(Gp(e))for(let t=e.nextProducerIndex;t<e.producerNode.length;t++)Lg(e.producerNode[t],e.producerIndexOfThis[t]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}(g,f),function VA(e){e.lView[fc]!==e&&(e.lView=null,UA.push(e))}(g)),th()}}function QA(e,n){for(let t=tS(e);null!==t;t=yE(t))for(let o=Di;o<t.length;o++)yS(t[o],n)}function ZA(e,n,t){yS(To(n,e),t)}function yS(e,n){wy(e)&&DE(e,n)}function DE(e,n){const o=e[Ne],c=e[et],u=e[fc];let f=!!(0===n&&16&c);if(f||=!!(64&c&&0===n),f||=!!(1024&c),f||=!(!u?.dirty||!zb(u)),u&&(u.dirty=!1),e[et]&=-9217,f)vS(o,e,o.template,e[zn]);else if(8192&c){QA(e,1);const g=o.components;null!==g&&CS(e,g,1)}}function CS(e,n,t){for(let o=0;o<n.length;o++)ZA(e,n[o],t)}function Uh(e){for(e[wa].changeDetectionScheduler?.notify();e;){e[et]|=64;const n=Rl(e);if(s_(e)&&!n)return e;e=n}return null}class Xf{get rootNodes(){const n=this._lView,t=n[Ne];return Gl(t,n,t.firstChild,[])}constructor(n,t,o=!0){this._lView=n,this._cdRefInjectingView=t,this.notifyErrorHandler=o,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[zn]}set context(n){this._lView[zn]=n}get destroyed(){return 256==(256&this._lView[et])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[Ai];if(Or(n)){const t=n[8],o=t?t.indexOf(this):-1;o>-1&&(xf(n,o),Tf(t,o))}this._attachedToViewContainer=!1}kf(this._lView[Ne],this._lView)}onDestroy(n){u_(this._lView,n)}markForCheck(){Uh(this._cdRefInjectingView||this._lView)}detach(){this._lView[et]&=-129}reattach(){Ry(this._lView),this._lView[et]|=128}detectChanges(){this._lView[et]|=1024,function $f(e,n=!0){const t=e[wa],o=t.rendererFactory;o.begin?.();try{!function XA(e){DE(e,0);let n=0;for(;kw(e);){if(100===n)throw new he(103,!1);n++,DE(e,1)}}(e)}catch(u){throw n&&Fh(e,u),u}finally{o.end?.(),t.inlineEffectRunner?.flush()}}(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new he(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,$R(this._lView[Ne],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new he(902,!1);this._appRef=n,Ry(this._lView)}}let Us=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=Xk}return e})();function Xk(e){return function Vh(e,n,t){if(hd(e)&&!t){const o=To(e.index,n);return new Xf(o,o)}return 47&e.type?new Xf(n[mi],n):null}(Nn(),fe(),16==(16&e))}let OE=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=Zk;static#t=this.__NG_ENV_ID__=t=>t}return e})();class eD extends OE{constructor(n){super(),this._lView=n}onDestroy(n){return u_(this._lView,n),()=>function Ay(e,n){if(null===e[pc])return;const t=e[pc].indexOf(n);-1!==t&&e[pc].splice(t,1)}(this._lView,n)}}function Zk(){return new eD(fe())}const tD=new Set;function Kl(e){tD.has(e)||(tD.add(e),performance?.mark?.("mark_feature_usage",{detail:{feature:e}}))}function TS(e){return n=>{setTimeout(e,void 0,n)}}const pn=class rL extends en{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,t,o){let c=n,u=t||(()=>null),f=o;if(n&&"object"==typeof n){const E=n;c=E.next?.bind(E),u=E.error?.bind(E),f=E.complete?.bind(E)}this.__isAsync&&(u=TS(u),c&&(c=TS(c)),f&&(f=TS(f)));const g=super.subscribe({next:c,error:u,complete:f});return n instanceof Ki&&n.add(g),g}};function nD(...e){}class it{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:o=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new pn(!1),this.onMicrotaskEmpty=new pn(!1),this.onStable=new pn(!1),this.onError=new pn(!1),typeof Zone>"u")throw new he(908,!1);Zone.assertZonePatched();const c=this;c._nesting=0,c._outer=c._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(c._inner=c._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(c._inner=c._inner.fork(Zone.longStackTraceZoneSpec)),c.shouldCoalesceEventChangeDetection=!o&&t,c.shouldCoalesceRunChangeDetection=o,c.lastRequestAnimationFrameId=-1,c.nativeRequestAnimationFrame=function oL(){const e="function"==typeof yn.requestAnimationFrame;let n=yn[e?"requestAnimationFrame":"setTimeout"],t=yn[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&n&&t){const o=n[Zone.__symbol__("OriginalDelegate")];o&&(n=o);const c=t[Zone.__symbol__("OriginalDelegate")];c&&(t=c)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function cL(e){const n=()=>{!function aL(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(yn,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,PE(e),e.isCheckStableRunning=!0,IS(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),PE(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,o,c,u,f,g)=>{if(function dL(e){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0].data?.__ignore_ng_zone__}(g))return t.invokeTask(c,u,f,g);try{return iD(e),t.invokeTask(c,u,f,g)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===u.type||e.shouldCoalesceRunChangeDetection)&&n(),rD(e)}},onInvoke:(t,o,c,u,f,g,E)=>{try{return iD(e),t.invoke(c,u,f,g,E)}finally{e.shouldCoalesceRunChangeDetection&&n(),rD(e)}},onHasTask:(t,o,c,u)=>{t.hasTask(c,u),o===c&&("microTask"==u.change?(e._hasPendingMicrotasks=u.microTask,PE(e),IS(e)):"macroTask"==u.change&&(e.hasPendingMacrotasks=u.macroTask))},onHandleError:(t,o,c,u)=>(t.handleError(c,u),e.runOutsideAngular(()=>e.onError.emit(u)),!1)})}(c)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!it.isInAngularZone())throw new he(909,!1)}static assertNotInAngularZone(){if(it.isInAngularZone())throw new he(909,!1)}run(n,t,o){return this._inner.run(n,t,o)}runTask(n,t,o,c){const u=this._inner,f=u.scheduleEventTask("NgZoneEvent: "+c,n,sL,nD,nD);try{return u.runTask(f,t,o)}finally{u.cancelTask(f)}}runGuarded(n,t,o){return this._inner.runGuarded(n,t,o)}runOutsideAngular(n){return this._outer.run(n)}}const sL={};function IS(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function PE(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function iD(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function rD(e){e._nesting--,IS(e)}class oD{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new pn,this.onMicrotaskEmpty=new pn,this.onStable=new pn,this.onError=new pn}run(n,t,o){return n.apply(t,o)}runGuarded(n,t,o){return n.apply(t,o)}runOutsideAngular(n){return n()}runTask(n,t,o,c){return n.apply(t,o)}}var ql=function(e){return e[e.EarlyRead=0]="EarlyRead",e[e.Write=1]="Write",e[e.MixedReadWrite=2]="MixedReadWrite",e[e.Read=3]="Read",e}(ql||{});const sD={destroy(){}};function cD(e,n){!n&&function hh(e){if(!sw()&&!function _x(){return yl}())throw new he(-203,!1)}();const t=n?.injector??Te(pr);if(!function Ed(e){return"browser"===(e??Te(pr)).get(Pa)}(t))return sD;Kl("NgAfterNextRender");const o=t.get(Jf),c=o.handler??=new lD,u=n?.phase??ql.MixedReadWrite,f=()=>{c.unregister(E),g()},g=t.get(OE).onDestroy(f),E=new dD(t,u,()=>{f(),e()});return c.register(E),{destroy:f}}class dD{constructor(n,t,o){this.phase=t,this.callbackFn=o,this.zone=n.get(it),this.errorHandler=n.get(xa,null,{optional:!0})}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(n){this.errorHandler?.handleError(n)}}}class lD{constructor(){this.executingCallbacks=!1,this.buckets={[ql.EarlyRead]:new Set,[ql.Write]:new Set,[ql.MixedReadWrite]:new Set,[ql.Read]:new Set},this.deferredCallbacks=new Set}register(n){(this.executingCallbacks?this.deferredCallbacks:this.buckets[n.phase]).add(n)}unregister(n){this.buckets[n.phase].delete(n),this.deferredCallbacks.delete(n)}execute(){let n=!1;this.executingCallbacks=!0;for(const t of Object.values(this.buckets))for(const o of t)n=!0,o.invoke();this.executingCallbacks=!1;for(const t of this.deferredCallbacks)this.buckets[t.phase].add(t);return this.deferredCallbacks.clear(),n}destroy(){for(const n of Object.values(this.buckets))n.clear();this.deferredCallbacks.clear()}}let Jf=(()=>{class e{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){const t=[...this.internalCallbacks];this.internalCallbacks.length=0;for(const c of t)c();return!!this.handler?.execute()||t.length>0}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}static#e=this.\u0275prov=Pe({token:e,providedIn:"root",factory:()=>new e})}return e})();function hL(e,n){const t=To(n,e),o=t[Ne];!function pL(e,n){for(let t=n.length;t<e.blueprint.length;t++)n.push(e.blueprint[t])}(o,t);const c=t[Cn];null!==c&&null===t[Ms]&&(t[Ms]=WC(c,t[jr])),wS(o,t,t[zn])}function wS(e,n,t){g_(n);try{const o=e.viewQuery;null!==o&&AE(1,o,t);const c=e.template;null!==c&&Td(e,n,c,1,t),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&gS(e,n),e.staticViewQueries&&AE(2,e.viewQuery,t);const u=e.components;null!==u&&function fL(e,n){for(let t=0;t<n.length;t++)hL(e,n[t])}(n,u)}catch(o){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),o}finally{n[et]&=-5,th()}}function Qf(e,n,t){let o=t?e.styles:null,c=t?e.classes:null,u=0;if(null!==n)for(let f=0;f<n.length;f++){const g=n[f];"number"==typeof g?u=g:1==u?c=ty(c,g):2==u&&(o=ty(o,g+": "+n[++f]+";"))}t?e.styles=o:e.stylesWithoutHost=o,t?e.classes=c:e.classesWithoutHost=c}class uD extends Dh{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const t=Lt(n);return new Zf(t,this.ngModule)}}function ME(e){const n=[];for(const t in e){if(!e.hasOwnProperty(t))continue;const o=e[t];void 0!==o&&n.push({propName:Array.isArray(o)?o[0]:o,templateName:t})}return n}class gL{constructor(n,t){this.injector=n,this.parentInjector=t}get(n,t,o){o=Qg(o);const c=this.injector.get(n,YC,o);return c!==YC||t===YC?c:this.parentInjector.get(n,t,o)}}class Zf extends RA{get inputs(){const n=this.componentDef,t=n.inputTransforms,o=ME(n.inputs);if(null!==t)for(const c of o)t.hasOwnProperty(c.propName)&&(c.transform=t[c.propName]);return o}get outputs(){return ME(this.componentDef.outputs)}constructor(n,t){super(),this.componentDef=n,this.ngModule=t,this.componentType=n.type,this.selector=function Ax(e){return e.map(Rx).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!t}create(n,t,o,c){let u=(c=c||this.ngModule)instanceof ns?c:c?.injector;u&&null!==this.componentDef.getStandaloneInjector&&(u=this.componentDef.getStandaloneInjector(u)||u);const f=u?new gL(n,u):n,g=f.get(_E,null);if(null===g)throw new he(407,!1);const P={rendererFactory:g,sanitizer:f.get(gk,null),inlineEffectRunner:null,afterRenderEventManager:f.get(Jf,null),changeDetectionScheduler:f.get(FC,null)},B=g.createRenderer(null,this.componentDef),G=this.componentDef.selectors[0][0]||"div",Y=o?function Mk(e,n,t,o){const u=o.get(IE,!1)||t===Xs.ShadowDom,f=e.selectRootElement(n,u);return function xk(e){zA(e)}(f),f}(B,o,this.componentDef.encapsulation,f):Z_(B,G,function mL(e){const n=e.toLowerCase();return"svg"===n?Iy:"math"===n?"math":null}(G));let J=512;this.componentDef.signals?J|=4096:this.componentDef.onPush||(J|=16);let le=null;null!==Y&&(le=WC(Y,f,!0));const ge=dS(0,null,null,1,0,null,null,null,null,null,null),de=zl(null,ge,null,J,null,null,P,B,f,null,le);let Le,He;g_(de);try{const ft=this.componentDef;let kn,Ir=null;ft.findHostDirectiveDefs?(kn=[],Ir=new Map,ft.findHostDirectiveDefs(ft,kn,Ir),kn.push(ft)):kn=[ft];const Ko=function hD(e,n){const t=e[Ne],o=gt;return e[o]=n,yc(t,o,2,"#host",null)}(de,Y),Vu=function EL(e,n,t,o,c,u,f){const g=c[Ne];!function pD(e,n,t,o){for(const c of e)n.mergedAttrs=Zp(n.mergedAttrs,c.hostAttrs);null!==n.mergedAttrs&&(Qf(n,n.mergedAttrs,!0),null!==t&&iA(o,t,n))}(o,e,n,f);let E=null;null!==n&&(E=WC(n,c[jr]));const C=u.rendererFactory.createRenderer(n,t);let R=16;t.signals?R=4096:t.onPush&&(R=64);const P=zl(c,xh(t),null,R,c[e.index],e,u,C,null,null,E);return g.firstCreatePass&&fS(g,e,o.length-1),Lh(c,P),c[e.index]=P}(Ko,Y,ft,kn,de,P,B);He=eh(ge,gt),Y&&function vL(e,n,t,o){if(o)fy(e,t,["ng-version","17.1.2"]);else{const{attrs:c,classes:u}=function hc(e){const n=[],t=[];let o=1,c=2;for(;o<e.length;){let u=e[o];if("string"==typeof u)2===c?""!==u&&n.push(u,e[++o]):8===c&&t.push(u);else{if(!Jo(c))break;c=u}o++}return{attrs:n,classes:t}}(n.selectors[0]);c&&fy(e,t,c),u&&u.length>0&&nA(e,t,u.join(" "))}}(B,ft,Y,o),void 0!==t&&function em(e,n,t){const o=e.projection=[];for(let c=0;c<n.length;c++){const u=t[c];o.push(null!=u?Array.from(u):null)}}(He,this.ngContentSelectors,t),Le=function X(e,n,t,o,c,u){const f=Nn(),g=c[Ne],E=so(f,c);pS(g,c,f,t,null,o);for(let R=0;R<t.length;R++)Gr(Ml(c,g,f.directiveStart+R,f),c);kh(g,c,f),E&&Gr(E,c);const C=Ml(c,g,f.directiveStart+f.componentOffset,f);if(e[zn]=c[zn]=C,null!==u)for(const R of u)R(C,n);return wE(g,f,e),C}(Vu,ft,kn,Ir,de,[xE]),wS(ge,de,null)}finally{th()}return new _L(this.componentType,Le,Cd(He,de),de,He)}}class _L extends fk{constructor(n,t,o,c,u){super(),this.location=o,this._rootLView=c,this._tNode=u,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new Xf(c,void 0,!1),this.componentType=n}setInput(n,t){const o=this._tNode.inputs;let c;if(null!==o&&(c=o[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),t))return;const u=this._rootLView;ES(u[Ne],u,c,n,t),this.previousInputValues.set(n,t),Uh(To(this._tNode.index,u))}}get injector(){return new Oi(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function xE(){const e=Nn();b_(fe()[Ne],e)}function Nt(e){let n=function tm(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),t=!0;const o=[e];for(;n;){let c;if(ks(e))c=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new he(903,!1);c=n.\u0275dir}if(c){if(t){o.push(c);const f=e;f.inputs=jh(e.inputs),f.inputTransforms=jh(e.inputTransforms),f.declaredInputs=jh(e.declaredInputs),f.outputs=jh(e.outputs);const g=c.hostBindings;g&&AS(e,g);const E=c.viewQuery,C=c.contentQueries;if(E&&RS(e,E),C&&Sc(e,C),ei(e,c),rx(e.outputs,c.outputs),ks(c)&&c.data.animation){const R=e.data;R.animation=(R.animation||[]).concat(c.data.animation)}}const u=c.features;if(u)for(let f=0;f<u.length;f++){const g=u[f];g&&g.ngInherit&&g(e),g===Nt&&(t=!1)}}n=Object.getPrototypeOf(n)}!function Et(e){let n=0,t=null;for(let o=e.length-1;o>=0;o--){const c=e[o];c.hostVars=n+=c.hostVars,c.hostAttrs=Zp(c.hostAttrs,t=Zp(t,c.hostAttrs))}}(o)}function ei(e,n){for(const t in n.inputs){if(!n.inputs.hasOwnProperty(t)||e.inputs.hasOwnProperty(t))continue;const o=n.inputs[t];if(void 0!==o&&(e.inputs[t]=o,e.declaredInputs[t]=n.declaredInputs[t],null!==n.inputTransforms)){const c=Array.isArray(o)?o[0]:o;if(!n.inputTransforms.hasOwnProperty(c))continue;e.inputTransforms??={},e.inputTransforms[c]=n.inputTransforms[c]}}}function jh(e){return e===Ia?{}:e===un?[]:e}function RS(e,n){const t=e.viewQuery;e.viewQuery=t?(o,c)=>{n(o,c),t(o,c)}:n}function Sc(e,n){const t=e.contentQueries;e.contentQueries=t?(o,c,u)=>{n(o,c,u),t(o,c,u)}:n}function AS(e,n){const t=e.hostBindings;e.hostBindings=t?(o,c)=>{n(o,c),t(o,c)}:n}function Pi(e){const n=e.inputConfig,t={};for(const o in n)if(n.hasOwnProperty(o)){const c=n[o];Array.isArray(c)&&c[3]&&(t[o]=c[3])}e.inputTransforms=t}let Xi=()=>null;function oa(e,n){return Xi(e,n)}function Kh(e,n,t,o){const c=n.tView,g=zl(e,c,t,4096&e[et]?4096:16,null,n,null,null,null,o?.injector??null,o?.dehydratedView??null);g[Ju]=e[n.index];const C=e[xs];return null!==C&&(g[xs]=C.createEmbeddedView(c)),wS(c,g,t),g}function rn(e,n){return!n||null===n.firstChild||z_(e)}function Tt(e,n,t,o=!0){const c=n[Ne];if(function eE(e,n,t,o){const c=Di+o,u=t.length;o>0&&(t[c-1][Qo]=n),o<u-Di?(n[Qo]=t[c],nR(t,Di+o,n)):(t.push(n),n[Qo]=null),n[Ai]=t;const f=n[Ju];null!==f&&t!==f&&function XR(e,n){const t=e[Tl];n[mi]!==n[Ai][Ai][mi]&&(e[et]|=r_.HasTransplantedViews),null===t?e[Tl]=[n]:t.push(n)}(f,n);const g=n[xs];null!==g&&g.insertView(e),Ry(n),n[et]|=128}(c,n,e,t),o){const f=DC(t,e),g=n[Ct],E=iE(g,e[Js]);null!==E&&function O1(e,n,t,o,c,u){o[Cn]=c,o[Ar]=n,sE(e,o,t,1,c,u)}(c,e[Ar],g,n,E,f)}const u=n[Ms];null!==u&&null!==u.firstChild&&(u.firstChild=null)}let mr=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=Fn}return e})();function Fn(){return am(Nn(),fe())}const RD=mr,Rd=class extends RD{constructor(n,t,o){super(),this._lContainer=n,this._hostTNode=t,this._hostLView=o}get element(){return Cd(this._hostTNode,this._hostLView)}get injector(){return new Oi(this._hostTNode,this._hostLView)}get parentInjector(){const n=I_(this._hostTNode,this._hostLView);if(gi(n)){const t=vf(n,this._hostLView),o=Ef(n);return new Oi(t[Ne].data[o+8],t)}return new Oi(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const t=sm(this._lContainer);return null!==t&&t[n]||null}get length(){return this._lContainer.length-Di}createEmbeddedView(n,t,o){let c,u;"number"==typeof o?c=o:null!=o&&(c=o.index,u=o.injector);const f=oa(this._lContainer,n.ssrId),g=n.createEmbeddedViewImpl(t||{},u,f);return this.insertImpl(g,c,rn(this._hostTNode,f)),g}createComponent(n,t,o,c,u){const f=n&&!function ch(e){return"function"==typeof e}(n);let g;if(f)g=t;else{const Y=t||{};g=Y.index,o=Y.injector,c=Y.projectableNodes,u=Y.environmentInjector||Y.ngModuleRef}const E=f?n:new Zf(Lt(n)),C=o||this.parentInjector;if(!u&&null==E.ngModule){const J=(f?C:this.parentInjector).get(ns,null);J&&(u=J)}const R=Lt(E.componentType??{}),P=oa(this._lContainer,R?.id??null),G=E.create(C,c,P?.firstChild??null,u);return this.insertImpl(G.hostView,g,rn(this._hostTNode,P)),G}insert(n,t){return this.insertImpl(n,t,!0)}insertImpl(n,t,o){const c=n._lView;if(function Ux(e){return Or(e[Ai])}(c)){const g=this.indexOf(n);if(-1!==g)this.detach(g);else{const E=c[Ai],C=new Rd(E,E[Ar],E[Ai]);C.detach(C.indexOf(n))}}const u=this._adjustIndex(t),f=this._lContainer;return Tt(f,c,u,o),n.attachToViewContainerRef(),nR(Ad(f),u,n),n}move(n,t){return this.insert(n,t)}indexOf(n){const t=sm(this._lContainer);return null!==t?t.indexOf(n):-1}remove(n){const t=this._adjustIndex(n,-1),o=xf(this._lContainer,t);o&&(Tf(Ad(this._lContainer),t),kf(o[Ne],o))}detach(n){const t=this._adjustIndex(n,-1),o=xf(this._lContainer,t);return o&&null!=Tf(Ad(this._lContainer),t)?new Xf(o):null}_adjustIndex(n,t=0){return n??this.length+t}};function sm(e){return e[8]}function Ad(e){return e[8]||(e[8]=[])}function am(e,n){let t;const o=n[e.index];return Or(o)?t=o:(t=YA(o,n,null,e),n[e.index]=t,Lh(n,t)),Dd(t,n,e,o),new Rd(t,e,n)}let Dd=function cm(e,n,t,o){if(e[Js])return;let c;c=8&t.type?On(o):function Ft(e,n){const t=e[Ct],o=t.createComment(""),c=so(n,e);return Ls(t,iE(t,c),o,function ZR(e,n){return e.nextSibling(n)}(t,c),!1),o}(n,t),e[Js]=c},BE=()=>!1;function Ua(e,n,t){return e[n]=t}function Ke(e,n,t){return!Object.is(e[n],t)&&(e[n]=t,!0)}function Ac(e,n,t,o){const c=Ke(e,n,t);return Ke(e,n+1,o)||c}function Tn(e,n,t,o,c,u,f,g){const E=fe(),C=Kt(),R=e+gt,P=C.firstCreatePass?function DD(e,n,t,o,c,u,f,g,E){const C=n.consts,R=yc(n,e,4,f||null,Qs(C,g));zf(n,t,R,Qs(C,E)),b_(n,R);const P=R.tView=dS(2,R,o,c,u,n.directiveRegistry,n.pipeRegistry,null,n.schemas,C,null);return null!==n.queries&&(n.queries.template(n,R),P.queries=n.queries.embeddedTView(R)),R}(R,C,E,n,t,o,c,u,f):C.data[R];Da(P,!1);const B=jE(C,E,P,e);v_()&&rE(C,E,B,P),Gr(B,E);const G=YA(B,E,B,P);return E[R]=G,Lh(E,G),function qh(e,n,t){return BE(e,n,t)}(G,P,E),rf(P)&&aS(C,E,P),null!=f&&cS(E,P,g),Tn}let jE=function OD(e,n,t,o){return pd(!0),n[Ct].createComment("")};function Ji(e,n,t,o){const c=fe();return Ke(c,ea(),n)&&(Kt(),ra(Zn(),c,e,n,t,o)),Ji}function fm(e,n){return e<<17|n<<2}function Nc(e){return e>>17&32767}function ev(e){return 2|e}function tu(e){return(131068&e)>>2}function Ba(e,n){return-131069&e|n<<2}function tv(e){return 1|e}function JS(e,n,t,o){const c=e[t+1],u=null===n;let f=o?Nc(c):tu(c),g=!1;for(;0!==f&&(!1===g||u);){const C=e[f+1];mO(e[f],n)&&(g=!0,e[f+1]=o?tv(C):ev(C)),f=o?Nc(C):tu(C)}g&&(e[t+1]=o?ev(c):tv(c))}function mO(e,n){return null===e||null==n||(Array.isArray(e)?e[1]:e)===n||!(!Array.isArray(e)||"string"!=typeof n)&&dh(e,n)>=0}const or={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function QS(e){return e.substring(or.key,or.keyEnd)}function ZS(e,n){const t=or.textEnd;return t===n?-1:(n=or.keyEnd=function rp(e,n,t){for(;n<t&&e.charCodeAt(n)>32;)n++;return n}(e,or.key=n,t),sa(e,n,t))}function sa(e,n,t){for(;n<t&&e.charCodeAt(n)<=32;)n++;return n}function Ze(e,n,t){const o=fe();return Ke(o,ea(),n)&&Ni(Kt(),Zn(),o,e,n,o[Ct],t,!1),Ze}function rv(e,n,t,o,c){const f=c?"class":"style";ES(e,t,n.inputs[f],f,o)}function ov(e,n,t){return cs(e,n,t,!1),ov}function Ht(e,n){return cs(e,n,null,!0),Ht}function mm(e){!function aa(e,n,t,o){const c=Kt(),u=gc(2);c.firstUpdatePass&&Do(c,null,u,o);const f=fe();if(t!==_t&&Ke(f,u,t)){const g=c.data[Hr()];if(CO(g,o)&&!nT(c,u)){let E=o?g.classesWithoutHost:g.stylesWithoutHost;null!==E&&(t=ty(E,t||"")),rv(c,g,f,t,o)}else!function qe(e,n,t,o,c,u,f,g){c===_t&&(c=un);let E=0,C=0,R=0<c.length?c[0]:null,P=0<u.length?u[0]:null;for(;null!==R||null!==P;){const B=E<c.length?c[E+1]:void 0,G=C<u.length?u[C+1]:void 0;let J,Y=null;R===P?(E+=2,C+=2,B!==G&&(Y=P,J=G)):null===P||null!==R&&R<P?(E+=2,Y=R):(C+=2,Y=P,J=G),null!==Y&&yO(e,n,t,o,Y,J,f,g),R=E<c.length?c[E]:null,P=C<u.length?u[C]:null}}(c,g,f,f[Ct],f[u+1],f[u+1]=function kd(e,n,t){if(null==t||""===t)return un;const o=[],c=yd(t);if(Array.isArray(c))for(let u=0;u<c.length;u++)e(o,c[u],!0);else if("object"==typeof c)for(const u in c)c.hasOwnProperty(u)&&e(o,u,c[u]);else"string"==typeof c&&n(o,c);return o}(e,n,t),o,u)}}(Re,ja,e,!0)}function ja(e,n){for(let t=function gO(e){return function eT(e){or.key=0,or.keyEnd=0,or.value=0,or.valueEnd=0,or.textEnd=e.length}(e),ZS(e,sa(e,0,or.textEnd))}(n);t>=0;t=ZS(n,t))ts(e,QS(n),!0)}function cs(e,n,t,o){const c=fe(),u=Kt(),f=gc(2);u.firstUpdatePass&&Do(u,e,f,o),n!==_t&&Ke(c,f,n)&&yO(u,u.data[Hr()],c,c[Ct],e,c[f+1]=function sv(e,n){return null==e||""===e||("string"==typeof n?e+=n:"object"==typeof e&&(e=$t(yd(e)))),e}(n,t),o,f)}function nT(e,n){return n>=e.expandoStartIndex}function Do(e,n,t,o){const c=e.data;if(null===c[t+1]){const u=c[Hr()],f=nT(e,t);CO(u,o)&&null===n&&!f&&(n=!1),n=function iT(e,n,t,o){const c=function Py(e){const n=dt.lFrame.currentDirectiveIndex;return-1===n?null:e[n]}(e);let u=o?n.residualClasses:n.residualStyles;if(null===c)0===(o?n.classBindings:n.styleBindings)&&(t=V(t=It(null,e,n,t,o),n.attrs,o),u=null);else{const f=n.directiveStylingLast;if(-1===f||e[f]!==c)if(t=It(c,e,n,t,o),null===u){let E=function Pc(e,n,t){const o=t?n.classBindings:n.styleBindings;if(0!==tu(o))return e[Nc(o)]}(e,n,o);void 0!==E&&Array.isArray(E)&&(E=It(null,e,n,E[1],o),E=V(E,n.attrs,o),function rT(e,n,t,o){e[Nc(t?n.classBindings:n.styleBindings)]=o}(e,n,o,E))}else u=function _r(e,n,t){let o;const c=n.directiveEnd;for(let u=1+n.directiveStylingLast;u<c;u++)o=V(o,e[u].hostAttrs,t);return V(o,n.attrs,t)}(e,n,o)}return void 0!==u&&(o?n.residualClasses=u:n.residualStyles=u),t}(c,u,n,o),function pO(e,n,t,o,c,u){let f=u?n.classBindings:n.styleBindings,g=Nc(f),E=tu(f);e[o]=t;let R,C=!1;if(Array.isArray(t)?(R=t[1],(null===R||dh(t,R)>0)&&(C=!0)):R=t,c)if(0!==E){const B=Nc(e[g+1]);e[o+1]=fm(B,g),0!==B&&(e[B+1]=Ba(e[B+1],o)),e[g+1]=function hO(e,n){return 131071&e|n<<17}(e[g+1],o)}else e[o+1]=fm(g,0),0!==g&&(e[g+1]=Ba(e[g+1],o)),g=o;else e[o+1]=fm(E,0),0===g?g=o:e[E+1]=Ba(e[E+1],o),E=o;C&&(e[o+1]=ev(e[o+1])),JS(e,R,o,!0),JS(e,R,o,!1),function fO(e,n,t,o,c){const u=c?e.residualClasses:e.residualStyles;null!=u&&"string"==typeof n&&dh(u,n)>=0&&(t[o+1]=tv(t[o+1]))}(n,R,e,o,u),f=fm(g,E),u?n.classBindings=f:n.styleBindings=f}(c,u,n,t,f,o)}}function It(e,n,t,o,c){let u=null;const f=t.directiveEnd;let g=t.directiveStylingLast;for(-1===g?g=t.directiveStart:g++;g<f&&(u=n[g],o=V(o,u.hostAttrs,c),u!==e);)g++;return null!==e&&(t.directiveStylingLast=g),o}function V(e,n,t){const o=t?1:2;let c=-1;if(null!==n)for(let u=0;u<n.length;u++){const f=n[u];"number"==typeof f?c=f:c===o&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),ts(e,f,!!t||n[++u]))}return void 0===e?null:e}function Re(e,n,t){const o=String(n);""!==o&&!o.includes(" ")&&ts(e,o,t)}function yO(e,n,t,o,c,u,f,g){if(!(3&n.type))return;const E=e.data,C=E[g+1],R=function XS(e){return 1==(1&e)}(C)?Mc(E,n,t,c,tu(C),f):void 0;gm(R)||(gm(u)||function os(e){return 2==(2&e)}(C)&&(u=Mc(E,null,t,c,g,f)),function L1(e,n,t,o,c){if(n)c?e.addClass(t,o):e.removeClass(t,o);else{let u=-1===o.indexOf("-")?void 0:Ma.DashCase;null==c?e.removeStyle(t,o,u):("string"==typeof c&&c.endsWith("!important")&&(c=c.slice(0,-10),u|=Ma.Important),e.setStyle(t,o,c,u))}}(o,f,cf(Hr(),t),c,u))}function Mc(e,n,t,o,c,u){const f=null===n;let g;for(;c>0;){const E=e[c],C=Array.isArray(E),R=C?E[1]:E,P=null===R;let B=t[c+1];B===_t&&(B=P?un:void 0);let G=P?qy(B,o):R===o?B:void 0;if(C&&!gm(G)&&(G=qy(E,o)),gm(G)&&(g=G,f))return g;const Y=e[c+1];c=f?Nc(Y):tu(Y)}if(null!==n){let E=u?n.residualClasses:n.residualStyles;null!=E&&(g=qy(E,o))}return g}function gm(e){return void 0!==e}function CO(e,n){return 0!=(e.flags&(n?8:16))}function we(e,n,t){Kl("NgControlFlow");const o=fe(),c=ea(),u=function vr(e,n){return e[n]}(o,gt+e);if(Ke(o,c,n)){const g=An(null);try{if(function Pr(e,n){const t=xf(e,n);return void 0!==t&&kf(t[Ne],t),t}(u,0),-1!==n){const E=function zr(e,n){return eh(e,n)}(o[Ne],gt+n),C=oa(u,E.tView.ssrId);Tt(u,Kh(o,E,t,{dehydratedView:C}),0,rn(E,C))}}finally{An(g)}}else{const g=function MS(e,n){const t=Di+n;if(t<e.length)return e[t]}(u,0);void 0!==g&&(g[zn]=t)}}function oe(e,n,t,o){const c=fe(),u=Kt(),f=gt+e,g=c[Ct],E=u.firstCreatePass?function Qi(e,n,t,o,c,u){const f=n.consts,E=yc(n,e,2,o,Qs(f,c));return zf(n,t,E,Qs(f,u)),null!==E.attrs&&Qf(E,E.attrs,!1),null!==E.mergedAttrs&&Qf(E,E.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,E),E}(f,u,c,n,t,o):u.data[f],C=Ae(u,c,E,g,n,e);c[f]=C;const R=rf(E);return Da(E,!0),iA(g,C,E),32!=(32&E.flags)&&v_()&&rE(u,c,C,E),0===function Fw(){return dt.lFrame.elementDepthCount}()&&Gr(C,c),function Bx(){dt.lFrame.elementDepthCount++}(),R&&(aS(u,c,E),wE(u,E,c)),null!==o&&cS(c,E),oe}function Ee(){let e=Nn();hf()?Ny():(e=e.parent,Da(e,!1));const n=e;(function Hx(e){return dt.skipHydrationRootTNode===e})(n)&&function Oy(){dt.skipHydrationRootTNode=null}(),function jx(){dt.lFrame.elementDepthCount--}();const t=Kt();return t.firstCreatePass&&(b_(t,e),o_(e)&&t.queries.elementEnd(e)),null!=n.classesWithoutHost&&function Kw(e){return 0!=(8&e.flags)}(n)&&rv(t,n,fe(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function $x(e){return 0!=(16&e.flags)}(n)&&rv(t,n,fe(),n.stylesWithoutHost,!1),Ee}function ce(e,n,t,o){return oe(e,n,t,o),Ee(),ce}let Ae=(e,n,t,o,c,u)=>(pd(!0),Z_(o,c,function Hw(){return dt.lFrame.currentNamespace}()));function vi(e,n,t){const o=fe(),c=Kt(),u=e+gt,f=c.firstCreatePass?function AO(e,n,t,o,c){const u=n.consts,f=Qs(u,o),g=yc(n,e,8,"ng-container",f);return null!==f&&Qf(g,f,!0),zf(n,t,g,Qs(u,c)),null!==n.queries&&n.queries.elementStart(n,g),g}(u,c,o,n,t):c.data[u];Da(f,!0);const g=kc(c,o,f,e);return o[u]=g,v_()&&rE(c,o,g,f),Gr(g,o),rf(f)&&(aS(c,o,f),wE(c,f,o)),null!=t&&cS(o,f),vi}function Me(){let e=Nn();const n=Kt();return hf()?Ny():(e=e.parent,Da(e,!1)),n.firstCreatePass&&(b_(n,e),o_(e)&&n.queries.elementEnd(e)),Me}let kc=(e,n,t,o)=>(pd(!0),Q_(n[Ct],""));function ap(){return fe()}function vm(e,n,t){const o=fe();return Ke(o,ea(),n)&&Ni(Kt(),Zn(),o,e,n,o[Ct],t,!0),vm}const da="en-US";let sr=da;function lp(e){return!!e&&"function"==typeof e.then}function gv(e){return!!e&&"function"==typeof e.subscribe}function gn(e,n,t,o){const c=fe(),u=Kt(),f=Nn();return function Vc(e,n,t,o,c,u,f){const g=rf(o),C=e.firstCreatePass&&_S(e),R=n[zn],P=qf(n);let B=!0;if(3&o.type||f){const J=so(o,n),le=f?f(J):J,ge=P.length,de=f?He=>f(On(He[o.index])):o.index;let Le=null;if(!f&&g&&(Le=function vT(e,n,t,o){const c=e.cleanup;if(null!=c)for(let u=0;u<c.length-1;u+=2){const f=c[u];if(f===t&&c[u+1]===o){const g=n[ud],E=c[u+2];return g.length>E?g[E]:null}"string"==typeof f&&(u+=2)}return null}(e,n,c,o.index)),null!==Le)(Le.__ngLastListenerFn__||Le).__ngNextListenerFn__=u,Le.__ngLastListenerFn__=u,B=!1;else{u=zO(o,n,R,u,!1);const He=t.listen(le,c,u);P.push(u,He),C&&C.push(c,de,ge,ge+1)}}else u=zO(o,n,R,u,!1);const G=o.outputs;let Y;if(B&&null!==G&&(Y=G[c])){const J=Y.length;if(J)for(let le=0;le<J;le+=2){const ft=n[Y[le]][Y[le+1]].subscribe(u),kn=P.length;P.push(u,ft),C&&C.push(c,o.index,kn,-(kn+1))}}}(u,c,c[Ct],f,e,n,o),gn}function bT(e,n,t,o){try{return Ra(6,n,t),!1!==t(o)}catch(c){return Fh(e,c),!1}finally{Ra(7,n,t)}}function zO(e,n,t,o,c){return function u(f){if(f===Function)return o;Uh(e.componentOffset>-1?To(e.index,n):n);let E=bT(n,t,o,f),C=u.__ngNextListenerFn__;for(;C;)E=bT(n,t,C,f)&&E,C=C.__ngNextListenerFn__;return c&&!1===E&&f.preventDefault(),E}}function _n(e=1){return function E_(e){return(dt.lFrame.contextLView=function xw(e,n){for(;e>0;)n=n[Cl],e--;return n}(e,dt.lFrame.contextLView))[zn]}(e)}function KO(e,n){let t=null;const o=function e_(e){const n=e.attrs;if(null!=n){const t=n.indexOf(5);if(!(1&t))return n[t+1]}return null}(e);for(let c=0;c<n.length;c++){const u=n[c];if("*"!==u){if(null===o?mw(e,u,!0):wx(o,u))return c}else t=c}return t}function Mo(e){const n=fe()[mi][Ar];if(!n.projection){const o=n.projection=function If(e,n){const t=[];for(let o=0;o<e;o++)t.push(n);return t}(e?e.length:1,null),c=o.slice();let u=n.child;for(;null!==u;){const f=e?KO(u,e):0;null!==f&&(c[f]?c[f].projectionNext=u:o[f]=u,c[f]=u),u=u.next}}}function xi(e,n=0,t){const o=fe(),c=Kt(),u=yc(c,gt+e,16,null,t||null);null===u.projection&&(u.projection=n),Ny(),(!o[Ms]||Al())&&32!=(32&u.flags)&&function x1(e,n,t){S(n[Ct],0,n,t,tE(e,t,n),eA(t.parent||n[Ar],t,n))}(c,o,u)}function JL(){return this._results[Symbol.iterator]()}class up{static#e=Symbol.iterator;get changes(){return this._changes??=new pn}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;const t=up.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=JL)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,t){return this._results.reduce(n,t)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,t){this.dirty=!1;const o=function lo(e){return e.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function r1(e,n,t){if(e.length!==n.length)return!1;for(let o=0;o<e.length;o++){let c=e[o],u=n[o];if(t&&(c=t(c),u=t(u)),u!==c)return!1}return!0}(this._results,o,t))&&(this._results=o,this.length=o.length,this.last=o[this.length-1],this.first=o[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}}let js=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=YO}return e})();const ST=js,QL=class extends ST{constructor(n,t,o){super(),this._declarationLView=n,this._declarationTContainer=t,this.elementRef=o}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,t){return this.createEmbeddedViewImpl(n,t)}createEmbeddedViewImpl(n,t,o){const c=Kh(this._declarationLView,this._declarationTContainer,n,{injector:t,dehydratedView:o});return new Xf(c)}};function YO(){return hp(Nn(),fe())}function hp(e,n){return 4&e.type?new QL(n,e,Cd(e,n)):null}class yv{constructor(n){this.queryList=n,this.matches=null}clone(){return new yv(this.queryList)}setDirty(){this.queryList.setDirty()}}class Om{constructor(n=[]){this.queries=n}createEmbeddedView(n){const t=n.queries;if(null!==t){const o=null!==n.contentQueries?n.contentQueries[0]:t.length,c=[];for(let u=0;u<o;u++){const f=t.getByIndex(u);c.push(this.queries[f.indexInDeclarationView].clone())}return new Om(c)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let t=0;t<this.queries.length;t++)null!==Tv(n,t).matches&&this.queries[t].setDirty()}}class Cv{constructor(n,t,o=null){this.predicate=n,this.flags=t,this.read=o}}class TT{constructor(n=[]){this.queries=n}elementStart(n,t){for(let o=0;o<this.queries.length;o++)this.queries[o].elementStart(n,t)}elementEnd(n){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(n)}embeddedTView(n){let t=null;for(let o=0;o<this.length;o++){const c=null!==t?t.length:0,u=this.getByIndex(o).embeddedTView(n,c);u&&(u.indexInDeclarationView=o,null!==t?t.push(u):t=[u])}return null!==t?new TT(t):null}template(n,t){for(let o=0;o<this.queries.length;o++)this.queries[o].template(n,t)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class Nm{constructor(n,t=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(n,t){this.isApplyingToNode(t)&&this.matchTNode(n,t)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,t){this.elementStart(n,t)}embeddedTView(n,t){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,t),new Nm(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let o=n.parent;for(;null!==o&&8&o.type&&o.index!==t;)o=o.parent;return t===(null!==o?o.index:-1)}return this._appliesToNextNode}matchTNode(n,t){const o=this.metadata.predicate;if(Array.isArray(o))for(let c=0;c<o.length;c++){const u=o[c];this.matchTNodeWithReadOption(n,t,$O(t,u)),this.matchTNodeWithReadOption(n,t,A_(t,n,u,!1,!1))}else o===js?4&t.type&&this.matchTNodeWithReadOption(n,t,-1):this.matchTNodeWithReadOption(n,t,A_(t,n,o,!1,!1))}matchTNodeWithReadOption(n,t,o){if(null!==o){const c=this.metadata.read;if(null!==c)if(c===tn||c===mr||c===js&&4&t.type)this.addMatch(t.index,-2);else{const u=A_(t,n,c,!1,!1);null!==u&&this.addMatch(t.index,u)}else this.addMatch(t.index,o)}}addMatch(n,t){null===this.matches?this.matches=[n,t]:this.matches.push(n,t)}}function $O(e,n){const t=e.localNames;if(null!==t)for(let o=0;o<t.length;o+=2)if(t[o]===n)return t[o+1];return null}function JO(e,n,t,o){return-1===t?function XO(e,n){return 11&e.type?Cd(e,n):4&e.type?hp(e,n):null}(n,e):-2===t?function QO(e,n,t){return t===tn?Cd(n,e):t===js?hp(n,e):t===mr?am(n,e):void 0}(e,n,o):Ml(e,e[Ne],t,n)}function ZO(e,n,t,o){const c=n[xs].queries[o];if(null===c.matches){const u=e.data,f=t.matches,g=[];for(let E=0;E<f.length;E+=2){const C=f[E];g.push(C<0?null:JO(n,u[C],f[E+1],t.metadata.read))}c.matches=g}return c.matches}function Sv(e,n,t,o){const c=e.queries.getByIndex(t),u=c.matches;if(null!==u){const f=ZO(e,n,c,t);for(let g=0;g<u.length;g+=2){const E=u[g];if(E>0)o.push(f[g/2]);else{const C=u[g+1],R=n[-E];for(let P=Di;P<R.length;P++){const B=R[P];B[Ju]===B[Ai]&&Sv(B[Ne],B,C,o)}if(null!==R[Tl]){const P=R[Tl];for(let B=0;B<P.length;B++){const G=P[B];Sv(G[Ne],G,C,o)}}}}}return o}function ou(e,n,t){const o=new up(4==(4&t));(function KA(e,n,t,o){const c=qf(n);c.push(t),e.firstCreatePass&&_S(e).push(o,c.length-1)})(e,n,o,o.destroy),null===n[xs]&&(n[xs]=new Om),n[xs].queries.push(new yv(o))}function su(e,n,t){null===e.queries&&(e.queries=new TT),e.queries.track(new Nm(n,t))}function Tv(e,n){return e.queries.getByIndex(n)}function ua(e,n,t,o){const c=Kt();if(c.firstCreatePass){const u=Nn();su(c,new Cv(n,t,o),u.index),function Pm(e,n){const t=e.contentQueries||(e.contentQueries=[]);n!==(t.length?t[t.length-1]:-1)&&t.push(e.queries.length-1,n)}(c,e),2==(2&t)&&(c.staticContentQueries=!0)}ou(c,fe(),t)}function ha(e,n,t){const o=Kt();o.firstCreatePass&&(su(o,new Cv(e,n,t),-1),2==(2&n)&&(o.staticViewQueries=!0)),ou(o,fe(),n)}function Zi(e){const n=fe(),t=Kt(),o=jw();My(o+1);const c=Tv(t,o);if(e.dirty&&function Fx(e){return 4==(4&e[et])}(n)===(2==(2&c.metadata.flags))){if(null===c.matches)e.reset([]);else{const u=c.crossesNgTemplate?Sv(t,n,o,[]):ZO(t,n,c,o);e.reset(u,Nh),e.notifyOnChanges()}return!0}return!1}function ar(){return function ZL(e,n){return e[xs].queries[n].queryList}(fe(),jw())}function Mm(e){return wl(function Wx(){return dt.lFrame.contextLView}(),gt+e)}function br(e,n=""){const t=fe(),o=Kt(),c=e+gt,u=o.firstCreatePass?yc(o,c,1,n,null):o.data[c],f=iN(o,t,u,n,e);t[c]=f,v_()&&rE(o,t,f,u),Da(u,!1)}let iN=(e,n,t,o,c)=>(pd(!0),function J_(e,n){return e.createText(n)}(n[Ct],o));function cu(e){return xo("",e,""),cu}function xo(e,n,t){const o=fe(),c=function np(e,n,t,o){return Ke(e,ea(),t)?n+yt(t)+o:_t}(o,e,n,t);return c!==_t&&function Cc(e,n,t){const o=cf(n,e);!function qR(e,n,t){e.setValue(n,t)}(e[Ct],o,t)}(o,Hr(),c),xo}function Lm(e,n,t,o,c){if(e=nt(e),Array.isArray(e))for(let u=0;u<e.length;u++)Lm(e[u],n,t,o,c);else{const u=Kt(),f=fe(),g=Nn();let E=gd(e)?e:nt(e.provide);const C=rC(e),R=1048575&g.providerIndexes,P=g.directiveStart,B=g.providerIndexes>>20;if(gd(e)||!e.multi){const G=new _f(C,c,ae),Y=Ga(E,n,c?R:R+B,P);-1===Y?(w_(S_(g,f),u,E),Fm(u,e,n.length),n.push(E),g.directiveStart++,g.directiveEnd++,c&&(g.providerIndexes+=1048576),t.push(G),f.push(G)):(t[Y]=G,f[Y]=G)}else{const G=Ga(E,n,R+B,P),Y=Ga(E,n,R,R+B),le=Y>=0&&t[Y];if(c&&!le||!c&&!(G>=0&&t[G])){w_(S_(g,f),u,E);const ge=function xT(e,n,t,o,c){const u=new _f(e,t,ae);return u.multi=[],u.index=n,u.componentProviders=0,lu(u,c,o&&!t),u}(c?qr:uu,t.length,c,o,C);!c&&le&&(t[Y].providerFactory=ge),Fm(u,e,n.length,0),n.push(E),g.directiveStart++,g.directiveEnd++,c&&(g.providerIndexes+=1048576),t.push(ge),f.push(ge)}else Fm(u,e,G>-1?G:Y,lu(t[c?Y:G],C,!c&&o));!c&&o&&le&&t[Y].componentProviders++}}}function Fm(e,n,t,o){const c=gd(n),u=function mR(e){return!!e.useClass}(n);if(c||u){const E=(u?nt(n.useClass):n).prototype.ngOnDestroy;if(E){const C=e.destroyHooks||(e.destroyHooks=[]);if(!c&&n.multi){const R=C.indexOf(t);-1===R?C.push(t,[o,E]):C[R+1].push(o,E)}else C.push(t,E)}}}function lu(e,n,t){return t&&e.componentProviders++,e.multi.push(n)-1}function Ga(e,n,t,o){for(let c=t;c<o;c++)if(n[c]===e)return c;return-1}function uu(e,n,t,o){return pp(this.multi,[])}function qr(e,n,t,o){const c=this.multi;let u;if(this.providerFactory){const f=this.providerFactory.componentProviders,g=Ml(t,t[Ne],this.providerFactory.index,o);u=g.slice(0,f),pp(c,u);for(let E=f;E<g.length;E++)u.push(g[E])}else u=[],pp(c,u);return u}function pp(e,n){for(let t=0;t<e.length;t++)n.push((0,e[t])());return n}function wn(e,n=[]){return t=>{t.providersResolver=(o,c)=>function Bd(e,n,t){const o=Kt();if(o.firstCreatePass){const c=ks(e);Lm(t,o.data,o.blueprint,c,!0),Lm(n,o.data,o.blueprint,c,!1)}}(o,c?c(e):e,n)}}class jd{}class oN{}class yr extends jd{constructor(n,t,o){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new uD(this);const c=hr(n);this._bootstrapComponents=uo(c.bootstrap),this._r3Injector=CR(n,t,[{provide:jd,useValue:this},{provide:Dh,useValue:this.componentFactoryResolver},...o],$t(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class Bc extends oN{constructor(n){super(),this.moduleType=n}create(n){return new yr(this.moduleType,n,[])}}class Vi extends jd{constructor(n){super(),this.componentFactoryResolver=new uD(this),this.instance=null;const t=new Ul([...n.providers,{provide:jd,useValue:this},{provide:Dh,useValue:this.componentFactoryResolver}],n.parent||B_(),n.debugName,new Set(["environment"]));this.injector=t,n.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function Um(e,n,t=null){return new Vi({providers:e,parent:n,debugName:t,runEnvironmentInitializers:!0}).injector}let fp=(()=>{class e{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const o=pR(0,t.type),c=o.length>0?Um([o],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,c)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=Pe({token:e,providedIn:"environment",factory:()=>new e(be(ns))})}return e})();function Hc(e){Kl("NgStandalone"),e.getStandaloneInjector=n=>n.get(fp).getOrCreateStandaloneInjector(e)}function pu(e,n,t,o,c,u,f){return function En(e,n,t,o,c,u,f,g,E){const C=n+t;return function rs(e,n,t,o,c,u){const f=Ac(e,n,t,o);return Ac(e,n+2,c,u)||f}(e,C,c,u,f,g)?Ua(e,C+4,E?o.call(E,c,u,f,g):o(c,u,f,g)):gp(e,C+4)}(fe(),ao(),e,n,t,o,c,u,f)}function gp(e,n){const t=e[n];return t===_t?void 0:t}function fu(e,n){const t=Kt();let o;const c=e+gt;t.firstCreatePass?(o=function fN(e,n){if(n)for(let t=n.length-1;t>=0;t--){const o=n[t];if(e===o.name)return o}}(n,t.pipeRegistry),t.data[c]=o,o.onDestroy&&(t.destroyHooks??=[]).push(c,o.onDestroy)):o=t.data[c];const u=o.factory||(o.factory=Il(o.type)),g=yo(ae);try{const E=bf(!1),C=u();return bf(E),function IT(e,n,t,o){t>=e.data.length&&(e.data[t]=null,e.blueprint[t]=null),n[t]=o}(t,fe(),c,C),C}finally{yo(g)}}function mu(e,n,t){const o=e+gt,c=fe(),u=wl(c,o);return function gu(e,n){return e[Ne].data[n].pure}(c,o)?function WT(e,n,t,o,c,u){const f=n+t;return Ke(e,f,c)?Ua(e,f+1,u?o.call(u,c):o(c)):gp(e,f+1)}(c,ao(),n,u.transform,t,u):u.transform(t)}function Ov(e,n){return hp(e,n)}let a0=(()=>{class e{log(t){console.log(t)}warn(t){console.warn(t)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();class yN{constructor(n,t){this.ngModuleFactory=n,this.componentFactories=t}}let kv=(()=>{class e{compileModuleSync(t){return new Bc(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const o=this.compileModuleSync(t),u=uo(hr(t).declarations).reduce((f,g)=>{const E=Lt(g);return E&&f.push(new Zf(E)),f},[]);return new yN(o,u)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Ym=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new oo(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const DN=new De(""),Eu=new De("");let h0,Jm=(()=>{class e{constructor(t,o,c){this._ngZone=t,this.registry=o,this._pendingCount=0,this._isZoneStable=!0,this._callbacks=[],this.taskTrackingZone=null,h0||(function L2(e){h0=e}(c),c.addToWindow(o)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{it.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb()}});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(o=>!o.updateCb||!o.updateCb(t)||(clearTimeout(o.timeoutId),!1))}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,o,c){let u=-1;o&&o>0&&(u=setTimeout(()=>{this._callbacks=this._callbacks.filter(f=>f.timeoutId!==u),t()},o)),this._callbacks.push({doneCb:t,timeoutId:u,updateCb:c})}whenStable(t,o,c){if(c&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,o,c),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,o,c){return[]}static#e=this.\u0275fac=function(o){return new(o||e)(be(it),be(u0),be(Eu))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})(),u0=(()=>{class e{constructor(){this._applications=new Map}registerApplication(t,o){this._applications.set(t,o)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,o=!0){return h0?.findTestabilityInTree(this,t,o)??null}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const p0=new De("");let zc=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,o)=>{this.resolve=t,this.reject=o}),this.appInits=Te(p0,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const c of this.appInits){const u=c();if(lp(u))t.push(u);else if(gv(u)){const f=new Promise((g,E)=>{u.subscribe({complete:g,error:E})});t.push(f)}}const o=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{o()}).catch(c=>{this.reject(c)}),0===t.length&&o(),this.initialized=!0}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Gs=new De("");function ON(e,n){return Array.isArray(n)?n.reduce(ON,e):{...e,...n}}let Yr=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Te(Wl),this.afterRenderEffectManager=Te(Jf),this.componentTypes=[],this.components=[],this.isStable=Te(Ym).hasPendingTasks.pipe(Yt(t=>!t)),this._injector=Te(ns)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,o){const c=t instanceof RA;if(!this._injector.get(zc).done)throw!c&&function ld(e){const n=Lt(e)||qi(e)||Rr(e);return null!==n&&n.standalone}(t),new he(405,!1);let f;f=c?t:this._injector.get(Dh).resolveComponentFactory(t),this.componentTypes.push(f.componentType);const g=function vu(e){return e.isBoundToModule}(f)?void 0:this._injector.get(jd),C=f.create(pr.NULL,[],o||f.selector,g),R=C.location.nativeElement,P=C.injector.get(DN,null);return P?.registerApplication(R),C.onDestroy(()=>{this.detachView(C.hostView),$r(this.components,C),P?.unregisterApplication(R)}),this._loadComponent(C),C}tick(){if(this._runningTick)throw new he(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this.internalErrorHandler(t)}finally{try{this.afterRenderEffectManager.execute()}catch(t){this.internalErrorHandler(t)}this._runningTick=!1}}attachView(t){const o=t;this._views.push(o),o.attachToAppRef(this)}detachView(t){const o=t;$r(this._views,o),o.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const o=this._injector.get(Gs,[]);[...this._bootstrapListeners,...o].forEach(c=>c(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>$r(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new he(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function $r(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}let f0=(()=>{class e{constructor(){this.zone=Te(it),this.applicationRef=Te(Yr)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function NN(){const e=Te(it),n=Te(xa);return t=>e.runOutsideAngular(()=>n.handleError(t))}let Ka=(()=>{class e{constructor(){this.subscription=new Ki,this.initialized=!1,this.zone=Te(it),this.pendingTasks=Te(Ym)}initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{it.assertNotInAngularZone(),queueMicrotask(()=>{null!==t&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{it.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const qa=new De("",{providedIn:"root",factory:()=>Te(qa,Vt.Optional|Vt.SkipSelf)||function Zm(){return typeof $localize<"u"&&$localize.locale||da}()}),g0=new De("");let MN=(()=>{class e{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,o){const c=function lL(e="zone.js",n){return"noop"===e?new oD:"zone.js"===e?new it(n):e}(o?.ngZone,function yu(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:o?.ngZoneEventCoalescing,runCoalescing:o?.ngZoneRunCoalescing}));return c.run(()=>{const u=function jc(e,n,t){return new yr(e,n,t)}(t.moduleType,this.injector,function bu(e){return[{provide:it,useFactory:e},{provide:md,multi:!0,useFactory:()=>{const n=Te(f0,{optional:!0});return()=>n.initialize()}},{provide:md,multi:!0,useFactory:()=>{const n=Te(Ka);return()=>{n.initialize()}}},{provide:Wl,useFactory:NN}]}(()=>c)),f=u.injector.get(xa,null);return c.runOutsideAngular(()=>{const g=c.onError.subscribe({next:E=>{f.handleError(E)}});u.onDestroy(()=>{$r(this._modules,u),g.unsubscribe()})}),function Kc(e,n,t){try{const o=t();return lp(o)?o.catch(c=>{throw n.runOutsideAngular(()=>e.handleError(c)),c}):o}catch(o){throw n.runOutsideAngular(()=>e.handleError(o)),o}}(f,c,()=>{const g=u.injector.get(zc);return g.runInitializers(),g.donePromise.then(()=>(function Fc(e){bo(e,"Expected localeId to be defined"),"string"==typeof e&&(sr=e.toLowerCase().replace(/_/g,"-"))}(u.injector.get(qa,da)||da),this._moduleDoBootstrap(u),u))})})}bootstrapModule(t,o=[]){const c=ON({},o);return function Tp(e,n,t){const o=new Bc(t);return Promise.resolve(o)}(0,0,t).then(u=>this.bootstrapModuleFactory(u,c))}_moduleDoBootstrap(t){const o=t.injector.get(Yr);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(c=>o.bootstrap(c));else{if(!t.instance.ngDoBootstrap)throw new he(-403,!1);t.instance.ngDoBootstrap(o)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new he(404,!1);this._modules.slice().forEach(o=>o.destroy()),this._destroyListeners.forEach(o=>o());const t=this._injector.get(g0,null);t&&(t.forEach(o=>o()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(o){return new(o||e)(be(pr))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),Ws=null;const xN=new De("");function _0(e,n,t=[]){const o=`Platform: ${n}`,c=new De(o);return(u=[])=>{let f=Uv();if(!f||f.injector.get(xN,!1)){const g=[...t,...u,{provide:c,useValue:!0}];e?e(g):function Fv(e){if(Ws&&!Ws.get(xN,!1))throw new he(400,!1);(function wp(){!function qb(e){zp=e}(()=>{throw new he(600,!1)})})(),Ws=e;const n=e.get(MN);(function kN(e){e.get(RR,null)?.forEach(t=>t())})(e)}(function Rp(e=[],n){return pr.create({name:n,providers:[{provide:nC,useValue:"platform"},{provide:g0,useValue:new Set([()=>Ws=null])},...e]})}(g,o))}return function tg(e){const n=Uv();if(!n)throw new he(401,!1);return n}()}}function Uv(){return Ws?.get(MN)??null}const BN=_0(null,"core",[]);let K2=(()=>{class e{constructor(t){}static#e=this.\u0275fac=function(o){return new(o||e)(be(Yr))};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({})}return e})();function fo(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}let Qv=null;function Yc(){return Qv}class EF{}const sn=new De("");let $c=(()=>{class e{historyGo(t){throw new Error("")}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:()=>Te(vF),providedIn:"platform"})}return e})();const cP=new De("");let vF=(()=>{class e extends $c{constructor(){super(),this._doc=Te(sn),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Yc().getBaseHref(this._doc)}onPopState(t){const o=Yc().getGlobalEventTarget(this._doc,"window");return o.addEventListener("popstate",t,!1),()=>o.removeEventListener("popstate",t)}onHashChange(t){const o=Yc().getGlobalEventTarget(this._doc,"window");return o.addEventListener("hashchange",t,!1),()=>o.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,o,c){this._history.pushState(t,o,c)}replaceState(t,o,c){this._history.replaceState(t,o,c)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:()=>new e,providedIn:"platform"})}return e})();function Op(e,n){if(0==e.length)return n;if(0==n.length)return e;let t=0;return e.endsWith("/")&&t++,n.startsWith("/")&&t++,2==t?e+n.substring(1):1==t?e+n:e+"/"+n}function D0(e){const n=e.match(/#|\?|$/),t=n&&n.index||e.length;return e.slice(0,t-("/"===e[t-1]?1:0))+e.slice(t)}function $a(e){return e&&"?"!==e[0]?"?"+e:e}let ga=(()=>{class e{historyGo(t){throw new Error("")}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:()=>Te(Zv),providedIn:"root"})}return e})();const Ks=new De("");let Zv=(()=>{class e extends ga{constructor(t,o){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=o??this._platformLocation.getBaseHrefFromDOM()??Te(sn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return Op(this._baseHref,t)}path(t=!1){const o=this._platformLocation.pathname+$a(this._platformLocation.search),c=this._platformLocation.hash;return c&&t?`${o}${c}`:o}pushState(t,o,c,u){const f=this.prepareExternalUrl(c+$a(u));this._platformLocation.pushState(t,o,f)}replaceState(t,o,c,u){const f=this.prepareExternalUrl(c+$a(u));this._platformLocation.replaceState(t,o,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(o){return new(o||e)(be($c),be(Ks,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),dP=(()=>{class e extends ga{constructor(t,o){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=o&&(this._baseHref=o)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){const o=this._platformLocation.hash??"#";return o.length>0?o.substring(1):o}prepareExternalUrl(t){const o=Op(this._baseHref,t);return o.length>0?"#"+o:o}pushState(t,o,c,u){let f=this.prepareExternalUrl(c+$a(u));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.pushState(t,o,f)}replaceState(t,o,c,u){let f=this.prepareExternalUrl(c+$a(u));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.replaceState(t,o,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(o){return new(o||e)(be($c),be(Ks,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})(),Hi=(()=>{class e{constructor(t){this._subject=new pn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const o=this._locationStrategy.getBaseHref();this._basePath=function O0(e){if(new RegExp("^(https?:)?//").test(e)){const[,t]=e.split(/\/\/[^\/]+/);return t}return e}(D0(og(o))),this._locationStrategy.onPopState(c=>{this._subject.emit({url:this.path(!0),pop:!0,state:c.state,type:c.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,o=""){return this.path()==this.normalize(t+$a(o))}normalize(t){return e.stripTrailingSlash(function eb(e,n){if(!e||!n.startsWith(e))return n;const t=n.substring(e.length);return""===t||["/",";","?","#"].includes(t[0])?t:n}(this._basePath,og(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,o="",c=null){this._locationStrategy.pushState(c,"",t,o),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+$a(o)),c)}replaceState(t,o="",c=null){this._locationStrategy.replaceState(c,"",t,o),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+$a(o)),c)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(o=>{this._notifyUrlChangeListeners(o.url,o.state)}),()=>{const o=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(o,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",o){this._urlChangeListeners.forEach(c=>c(t,o))}subscribe(t,o,c){return this._subject.subscribe({next:t,error:o,complete:c})}static#e=this.normalizeQueryParams=$a;static#t=this.joinWithSlash=Op;static#n=this.stripTrailingSlash=D0;static#i=this.\u0275fac=function(o){return new(o||e)(be(ga))};static#r=this.\u0275prov=Pe({token:e,factory:()=>function Xd(){return new Hi(be(ga))}(),providedIn:"root"})}return e})();function og(e){return e.replace(/\/index.html$/,"")}const ai=/\s+/,Wi=[];let F0=(()=>{class e{constructor(t,o){this._ngEl=t,this._renderer=o,this.initialClasses=Wi,this.stateMap=new Map}set klass(t){this.initialClasses=null!=t?t.trim().split(ai):Wi}set ngClass(t){this.rawClass="string"==typeof t?t.trim().split(ai):t}ngDoCheck(){for(const o of this.initialClasses)this._updateState(o,!0);const t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(const o of t)this._updateState(o,!0);else if(null!=t)for(const o of Object.keys(t))this._updateState(o,!!t[o]);this._applyStateDiff()}_updateState(t,o){const c=this.stateMap.get(t);void 0!==c?(c.enabled!==o&&(c.changed=!0,c.enabled=o),c.touched=!0):this.stateMap.set(t,{enabled:o,changed:!0,touched:!0})}_applyStateDiff(){for(const t of this.stateMap){const o=t[0],c=t[1];c.changed?(this._toggleClass(o,c.enabled),c.changed=!1):c.touched||(c.enabled&&this._toggleClass(o,!1),this.stateMap.delete(o)),c.touched=!1}}_toggleClass(t,o){(t=t.trim()).length>0&&t.split(ai).forEach(c=>{o?this._renderer.addClass(this._ngEl.nativeElement,c):this._renderer.removeClass(this._ngEl.nativeElement,c)})}static#e=this.\u0275fac=function(o){return new(o||e)(ae(tn),ae(Fs))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","ngClass",""]],inputs:{klass:[Xe.None,"class","klass"],ngClass:"ngClass"},standalone:!0})}return e})();class wF{constructor(n,t,o,c){this.$implicit=n,this.ngForOf=t,this.index=o,this.count=c}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let TP=(()=>{class e{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,o,c){this._viewContainer=t,this._template=o,this._differs=c,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const o=this._viewContainer;t.forEachOperation((c,u,f)=>{if(null==c.previousIndex)o.createEmbeddedView(this._template,new wF(c.item,this._ngForOf,-1,-1),null===f?void 0:f);else if(null==f)o.remove(null===u?void 0:u);else if(null!==u){const g=o.get(u);o.move(g,f),U0(g,c)}});for(let c=0,u=o.length;c<u;c++){const g=o.get(c).context;g.index=c,g.count=u,g.ngForOf=this._ngForOf}t.forEachIdentityChange(c=>{U0(o.get(c.currentIndex),c)})}static ngTemplateContextGuard(t,o){return!0}static#e=this.\u0275fac=function(o){return new(o||e)(ae(mr),ae(js),ae(QC))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return e})();function U0(e,n){e.context.$implicit=n.item}let Ou=(()=>{class e{constructor(t,o){this._viewContainer=t,this._context=new Zr,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=o}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){Nu("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){Nu("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,o){return!0}static#e=this.\u0275fac=function(o){return new(o||e)(ae(mr),ae(js))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return e})();class Zr{constructor(){this.$implicit=null,this.ngIf=null}}function Nu(e,n){if(n&&!n.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${$t(n)}'.`)}let H0=(()=>{class e{constructor(t){this._viewContainerRef=t,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(t){if(this._shouldRecreateView(t)){const o=this._viewContainerRef;if(this._viewRef&&o.remove(o.indexOf(this._viewRef)),!this.ngTemplateOutlet)return void(this._viewRef=null);const c=this._createContextForwardProxy();this._viewRef=o.createEmbeddedView(this.ngTemplateOutlet,c,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(t){return!!t.ngTemplateOutlet||!!t.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(t,o,c)=>!!this.ngTemplateOutletContext&&Reflect.set(this.ngTemplateOutletContext,o,c),get:(t,o,c)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,o,c)}})}static#e=this.\u0275fac=function(o){return new(o||e)(ae(mr))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[So]})}return e})();class G0{createSubscription(n,t){return DA(()=>n.subscribe({next:t,error:o=>{throw o}}))}dispose(n){DA(()=>n.unsubscribe())}}class Qa{createSubscription(n,t){return n.then(t,o=>{throw o})}dispose(n){}}const wt=new Qa,nl=new G0;let hb=(()=>{class e{constructor(t){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=t}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(t){return this._obj?t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue:(t&&this._subscribe(t),this._latestValue)}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,o=>this._updateLatestValue(t,o))}_selectStrategy(t){if(lp(t))return wt;if(gv(t))return nl;throw function Ts(e,n){return new he(2100,!1)}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,o){t===this._obj&&(this._latestValue=o,this._ref.markForCheck())}static#e=this.\u0275fac=function(o){return new(o||e)(ae(Us,16))};static#t=this.\u0275pipe=Co({name:"async",type:e,pure:!1,standalone:!0})}return e})(),Pu=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({})}return e})();const K0="browser";function xP(e){return e===K0}function kP(e){return"server"===e}let UF=(()=>{class e{static#e=this.\u0275prov=Pe({token:e,providedIn:"root",factory:()=>xP(Te(Pa))?new LP(Te(sn),window):new FP})}return e})();class LP{constructor(n,t){this.document=n,this.window=t,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(n){this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){const t=function Y0(e,n){const t=e.getElementById(n)||e.getElementsByName(n)[0];if(t)return t;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const o=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let c=o.currentNode;for(;c;){const u=c.shadowRoot;if(u){const f=u.getElementById(n)||u.querySelector(`[name="${n}"]`);if(f)return f}c=o.nextNode()}}return null}(this.document,n);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(n){this.window.history.scrollRestoration=n}scrollToElement(n){const t=n.getBoundingClientRect(),o=t.left+this.window.pageXOffset,c=t.top+this.window.pageYOffset,u=this.offset();this.window.scrollTo(o-u[0],c-u[1])}}class FP{setOffset(n){}getScrollPosition(){return[0,0]}scrollToPosition(n){}scrollToAnchor(n){}setHistoryScrollRestoration(n){}}class xp extends EF{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class hn extends xp{static makeCurrent(){!function _F(e){Qv??=e}(new hn)}onAndCancel(n,t,o){return n.addEventListener(t,o),()=>{n.removeEventListener(t,o)}}dispatchEvent(n,t){n.dispatchEvent(t)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,t){return(t=t||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,t){return"window"===t?window:"document"===t?n:"body"===t?n.body:null}getBaseHref(n){const t=function zt(){return vn=vn||document.querySelector("base"),vn?vn.getAttribute("href"):null}();return null==t?null:function _o(e){return new URL(e,document.baseURI).pathname}(t)}resetBaseElement(){vn=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return function lb(e,n){n=encodeURIComponent(n);for(const t of e.split(";")){const o=t.indexOf("="),[c,u]=-1==o?[t,""]:[t.slice(0,o),t.slice(o+1)];if(c.trim()===n)return decodeURIComponent(u)}return null}(document.cookie,n)}}let vn=null,Rn=(()=>{class e{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();const at=new De("");let Fr=(()=>{class e{constructor(t,o){this._zone=o,this._eventNameToPlugin=new Map,t.forEach(c=>{c.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,o,c){return this._findPluginFor(o).addEventListener(t,o,c)}getZone(){return this._zone}_findPluginFor(t){let o=this._eventNameToPlugin.get(t);if(o)return o;if(o=this._plugins.find(u=>u.supports(t)),!o)throw new he(5101,!1);return this._eventNameToPlugin.set(t,o),o}static#e=this.\u0275fac=function(o){return new(o||e)(be(at),be(it))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();class Jc{constructor(n){this._doc=n}}const ws="ng-app-id";let eI=(()=>{class e{constructor(t,o,c,u={}){this.doc=t,this.appId=o,this.nonce=c,this.platformId=u,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=kP(u),this.resetHostNodes()}addStyles(t){for(const o of t)1===this.changeUsageCount(o,1)&&this.onStyleAdded(o)}removeStyles(t){for(const o of t)this.changeUsageCount(o,-1)<=0&&this.onStyleRemoved(o)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(o=>o.remove()),t.clear());for(const o of this.getAllStyles())this.onStyleRemoved(o);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const o of this.getAllStyles())this.addStyleToHost(t,o)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const o of this.hostNodes)this.addStyleToHost(o,t)}onStyleRemoved(t){const o=this.styleRef;o.get(t)?.elements?.forEach(c=>c.remove()),o.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${ws}="${this.appId}"]`);if(t?.length){const o=new Map;return t.forEach(c=>{null!=c.textContent&&o.set(c.textContent,c)}),o}return null}changeUsageCount(t,o){const c=this.styleRef;if(c.has(t)){const u=c.get(t);return u.usage+=o,u.usage}return c.set(t,{usage:o,elements:[]}),o}getStyleElement(t,o){const c=this.styleNodesInDOM,u=c?.get(o);if(u?.parentNode===t)return c.delete(o),u.removeAttribute(ws),u;{const f=this.doc.createElement("style");return this.nonce&&f.setAttribute("nonce",this.nonce),f.textContent=o,this.platformIsServer&&f.setAttribute(ws,this.appId),t.appendChild(f),f}}addStyleToHost(t,o){const c=this.getStyleElement(t,o),u=this.styleRef,f=u.get(o)?.elements;f?f.push(c):u.set(o,{elements:[c],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}static#e=this.\u0275fac=function(o){return new(o||e)(be(sn),be(Nf),be(lC,8),be(Pa))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();const WF={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},zF=/%COMP%/g,SH=new De("",{providedIn:"root",factory:()=>!0});function AB(e,n){return n.map(t=>t.replace(zF,e))}let KF=(()=>{class e{constructor(t,o,c,u,f,g,E,C=null){this.eventManager=t,this.sharedStylesHost=o,this.appId=c,this.removeStylesOnCompDestroy=u,this.doc=f,this.platformId=g,this.ngZone=E,this.nonce=C,this.rendererByCompId=new Map,this.platformIsServer=kP(g),this.defaultRenderer=new qF(t,f,E,this.platformIsServer)}createRenderer(t,o){if(!t||!o)return this.defaultRenderer;this.platformIsServer&&o.encapsulation===Xs.ShadowDom&&(o={...o,encapsulation:Xs.Emulated});const c=this.getOrCreateRenderer(t,o);return c instanceof OB?c.applyToHost(t):c instanceof YF&&c.applyStyles(),c}getOrCreateRenderer(t,o){const c=this.rendererByCompId;let u=c.get(o.id);if(!u){const f=this.doc,g=this.ngZone,E=this.eventManager,C=this.sharedStylesHost,R=this.removeStylesOnCompDestroy,P=this.platformIsServer;switch(o.encapsulation){case Xs.Emulated:u=new OB(E,C,o,this.appId,R,f,g,P);break;case Xs.ShadowDom:return new RH(E,C,t,o,f,g,this.nonce,P);default:u=new YF(E,C,o,R,f,g,P)}c.set(o.id,u)}return u}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(o){return new(o||e)(be(Fr),be(eI),be(Nf),be(SH),be(sn),be(Pa),be(it),be(lC))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();class qF{constructor(n,t,o,c){this.eventManager=n,this.doc=t,this.ngZone=o,this.platformIsServer=c,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(n,t){return t?this.doc.createElementNS(WF[t]||t,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,t){(DB(n)?n.content:n).appendChild(t)}insertBefore(n,t,o){n&&(DB(n)?n.content:n).insertBefore(t,o)}removeChild(n,t){n&&n.removeChild(t)}selectRootElement(n,t){let o="string"==typeof n?this.doc.querySelector(n):n;if(!o)throw new he(-5104,!1);return t||(o.textContent=""),o}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,t,o,c){if(c){t=c+":"+t;const u=WF[c];u?n.setAttributeNS(u,t,o):n.setAttribute(t,o)}else n.setAttribute(t,o)}removeAttribute(n,t,o){if(o){const c=WF[o];c?n.removeAttributeNS(c,t):n.removeAttribute(`${o}:${t}`)}else n.removeAttribute(t)}addClass(n,t){n.classList.add(t)}removeClass(n,t){n.classList.remove(t)}setStyle(n,t,o,c){c&(Ma.DashCase|Ma.Important)?n.style.setProperty(t,o,c&Ma.Important?"important":""):n.style[t]=o}removeStyle(n,t,o){o&Ma.DashCase?n.style.removeProperty(t):n.style[t]=""}setProperty(n,t,o){null!=n&&(n[t]=o)}setValue(n,t){n.nodeValue=t}listen(n,t,o){if("string"==typeof n&&!(n=Yc().getGlobalEventTarget(this.doc,n)))throw new Error(`Unsupported event target ${n} for event ${t}`);return this.eventManager.addEventListener(n,t,this.decoratePreventDefault(o))}decoratePreventDefault(n){return t=>{if("__ngUnwrap__"===t)return n;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>n(t)):n(t))&&t.preventDefault()}}}function DB(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class RH extends qF{constructor(n,t,o,c,u,f,g,E){super(n,u,f,E),this.sharedStylesHost=t,this.hostEl=o,this.shadowRoot=o.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const C=AB(c.id,c.styles);for(const R of C){const P=document.createElement("style");g&&P.setAttribute("nonce",g),P.textContent=R,this.shadowRoot.appendChild(P)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,t){return super.appendChild(this.nodeOrShadowRoot(n),t)}insertBefore(n,t,o){return super.insertBefore(this.nodeOrShadowRoot(n),t,o)}removeChild(n,t){return super.removeChild(this.nodeOrShadowRoot(n),t)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class YF extends qF{constructor(n,t,o,c,u,f,g,E){super(n,u,f,g),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=c,this.styles=E?AB(E,o.styles):o.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class OB extends YF{constructor(n,t,o,c,u,f,g,E){const C=c+"-"+o.id;super(n,t,o,u,f,g,E,C),this.contentAttr=function TH(e){return"_ngcontent-%COMP%".replace(zF,e)}(C),this.hostAttr=function IH(e){return"_nghost-%COMP%".replace(zF,e)}(C)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,t){const o=super.createElement(n,t);return super.setAttribute(o,this.contentAttr,""),o}}let AH=(()=>{class e extends Jc{constructor(t){super(t)}supports(t){return!0}addEventListener(t,o,c){return t.addEventListener(o,c,!1),()=>this.removeEventListener(t,o,c)}removeEventListener(t,o,c){return t.removeEventListener(o,c)}static#e=this.\u0275fac=function(o){return new(o||e)(be(sn))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();const NB=["alt","control","meta","shift"],DH={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},OH={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let NH=(()=>{class e extends Jc{constructor(t){super(t)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,o,c){const u=e.parseEventName(o),f=e.eventCallback(u.fullKey,c,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Yc().onAndCancel(t,u.domEventName,f))}static parseEventName(t){const o=t.toLowerCase().split("."),c=o.shift();if(0===o.length||"keydown"!==c&&"keyup"!==c)return null;const u=e._normalizeKey(o.pop());let f="",g=o.indexOf("code");if(g>-1&&(o.splice(g,1),f="code."),NB.forEach(C=>{const R=o.indexOf(C);R>-1&&(o.splice(R,1),f+=C+".")}),f+=u,0!=o.length||0===u.length)return null;const E={};return E.domEventName=c,E.fullKey=f,E}static matchEventFullKeyCode(t,o){let c=DH[t.key]||t.key,u="";return o.indexOf("code.")>-1&&(c=t.code,u="code."),!(null==c||!c)&&(c=c.toLowerCase()," "===c?c="space":"."===c&&(c="dot"),NB.forEach(f=>{f!==c&&(0,OH[f])(t)&&(u+=f+".")}),u+=c,u===o)}static eventCallback(t,o,c){return u=>{e.matchEventFullKeyCode(u,t)&&c.runGuarded(()=>o(u))}}static _normalizeKey(t){return"esc"===t?"escape":t}static#e=this.\u0275fac=function(o){return new(o||e)(be(sn))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();const kH=_0(BN,"browser",[{provide:Pa,useValue:K0},{provide:RR,useValue:function PH(){hn.makeCurrent()},multi:!0},{provide:sn,useFactory:function xH(){return function ph(e){dC=e}(document),document},deps:[]}]),LH=new De(""),xB=[{provide:Eu,useClass:class ec{addToWindow(n){yn.getAngularTestability=(o,c=!0)=>{const u=n.findTestabilityInTree(o,c);if(null==u)throw new he(5103,!1);return u},yn.getAllAngularTestabilities=()=>n.getAllTestabilities(),yn.getAllAngularRootElements=()=>n.getAllRootElements(),yn.frameworkStabilizers||(yn.frameworkStabilizers=[]),yn.frameworkStabilizers.push(o=>{const c=yn.getAllAngularTestabilities();let u=c.length;const f=function(){u--,0==u&&o()};c.forEach(g=>{g.whenStable(f)})})}findTestabilityInTree(n,t,o){return null==t?null:n.getTestability(t)??(o?Yc().isShadowRoot(t)?this.findTestabilityInTree(n,t.host,!0):this.findTestabilityInTree(n,t.parentElement,!0):null)}},deps:[]},{provide:DN,useClass:Jm,deps:[it,u0,Eu]},{provide:Jm,useClass:Jm,deps:[it,u0,Eu]}],kB=[{provide:nC,useValue:"root"},{provide:xa,useFactory:function MH(){return new xa},deps:[]},{provide:at,useClass:AH,multi:!0,deps:[sn,it,Pa]},{provide:at,useClass:NH,multi:!0,deps:[sn]},KF,eI,Fr,{provide:_E,useExisting:KF},{provide:class UP{},useClass:Rn,deps:[]},[]];let LB=(()=>{class e{constructor(t){}static withServerTransition(t){return{ngModule:e,providers:[{provide:Nf,useValue:t.appId}]}}static#e=this.\u0275fac=function(o){return new(o||e)(be(LH,12))};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({providers:[...kB,...xB],imports:[Pu,K2]})}return e})(),FH=(()=>{class e{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static#e=this.\u0275fac=function(o){return new(o||e)(be(sn))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function kp(e){return this instanceof kp?(this.v=e,this):new kp(e)}function GB(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function QF(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(u){t[u]=e[u]&&function(f){return new Promise(function(g,E){!function c(u,f,g,E){Promise.resolve(E).then(function(C){u({value:C,done:g})},f)}(g,E,(f=e[u](f)).done,f.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const ZF=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function WB(e){return dn(e?.then)}function zB(e){return dn(e[Qb])}function KB(e){return Symbol.asyncIterator&&dn(e?.[Symbol.asyncIterator])}function qB(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const YB=function c8(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function $B(e){return dn(e?.[YB])}function XB(e){return function HB(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,o=t.apply(e,n||[]),u=[];return c={},f("next"),f("throw"),f("return"),c[Symbol.asyncIterator]=function(){return this},c;function f(B){o[B]&&(c[B]=function(G){return new Promise(function(Y,J){u.push([B,G,Y,J])>1||g(B,G)})})}function g(B,G){try{!function E(B){B.value instanceof kp?Promise.resolve(B.value.v).then(C,R):P(u[0][2],B)}(o[B](G))}catch(Y){P(u[0][3],Y)}}function C(B){g("next",B)}function R(B){g("throw",B)}function P(B,G){B(G),u.shift(),u.length&&g(u[0][0],u[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:o,done:c}=yield kp(t.read());if(c)return yield kp(void 0);yield yield kp(o)}}finally{t.releaseLock()}})}function JB(e){return dn(e?.getReader)}function Wo(e){if(e instanceof Wn)return e;if(null!=e){if(zB(e))return function d8(e){return new Wn(n=>{const t=e[Qb]();if(dn(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(ZF(e))return function l8(e){return new Wn(n=>{for(let t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}(e);if(WB(e))return function u8(e){return new Wn(n=>{e.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,jg)})}(e);if(KB(e))return QB(e);if($B(e))return function h8(e){return new Wn(n=>{for(const t of e)if(n.next(t),n.closed)return;n.complete()})}(e);if(JB(e))return function p8(e){return QB(XB(e))}(e)}throw qB(e)}function QB(e){return new Wn(n=>{(function f8(e,n){var t,o,c,u;return function BB(e,n,t,o){return new(t||(t=Promise))(function(u,f){function g(R){try{C(o.next(R))}catch(P){f(P)}}function E(R){try{C(o.throw(R))}catch(P){f(P)}}function C(R){R.done?u(R.value):function c(u){return u instanceof t?u:new t(function(f){f(u)})}(R.value).then(g,E)}C((o=o.apply(e,n||[])).next())})}(this,void 0,void 0,function*(){try{for(t=GB(e);!(o=yield t.next()).done;)if(n.next(o.value),n.closed)return}catch(f){c={error:f}}finally{try{o&&!o.done&&(u=t.return)&&(yield u.call(t))}finally{if(c)throw c.error}}n.complete()})})(e,n).catch(t=>n.error(t))})}function xu(e,n,t,o=0,c=!1){const u=n.schedule(function(){t(),c?e.add(this.schedule(null,o)):this.unsubscribe()},o);if(e.add(u),!c)return u}function ZB(e,n=0){return fi((t,o)=>{t.subscribe(Jn(o,c=>xu(o,e,()=>o.next(c),n),()=>xu(o,e,()=>o.complete(),n),c=>xu(o,e,()=>o.error(c),n)))})}function ej(e,n=0){return fi((t,o)=>{o.add(e.schedule(()=>t.subscribe(o),n))})}function tj(e,n){if(!e)throw new Error("Iterable cannot be null");return new Wn(t=>{xu(t,n,()=>{const o=e[Symbol.asyncIterator]();xu(t,n,()=>{o.next().then(c=>{c.done?t.complete():t.next(c.value)})},0,!0)})})}function Ur(e,n){return n?function b8(e,n){if(null!=e){if(zB(e))return function m8(e,n){return Wo(e).pipe(ej(n),ZB(n))}(e,n);if(ZF(e))return function _8(e,n){return new Wn(t=>{let o=0;return n.schedule(function(){o===e.length?t.complete():(t.next(e[o++]),t.closed||this.schedule())})})}(e,n);if(WB(e))return function g8(e,n){return Wo(e).pipe(ej(n),ZB(n))}(e,n);if(KB(e))return tj(e,n);if($B(e))return function E8(e,n){return new Wn(t=>{let o;return xu(t,n,()=>{o=e[YB](),xu(t,n,()=>{let c,u;try{({value:c,done:u}=o.next())}catch(f){return void t.error(f)}u?t.complete():t.next(c)},0,!0)}),()=>dn(o?.return)&&o.return()})}(e,n);if(JB(e))return function v8(e,n){return tj(XB(e),n)}(e,n)}throw qB(e)}(e,n):Wo(e)}const{isArray:y8}=Array,{getPrototypeOf:C8,prototype:S8,keys:T8}=Object;function nj(e){if(1===e.length){const n=e[0];if(y8(n))return{args:n,keys:null};if(function I8(e){return e&&"object"==typeof e&&C8(e)===S8}(n)){const t=T8(n);return{args:t.map(o=>n[o]),keys:t}}}return{args:e,keys:null}}function ij(e){return e&&dn(e.schedule)}function eU(e){return e[e.length-1]}function rj(e){return dn(eU(e))?e.pop():void 0}function nI(e){return ij(eU(e))?e.pop():void 0}const{isArray:R8}=Array;function tU(e){return Yt(n=>function A8(e,n){return R8(n)?e(...n):e(n)}(e,n))}function oj(e,n){return e.reduce((t,o,c)=>(t[o]=n[c],t),{})}let sj=(()=>{class e{constructor(t,o){this._renderer=t,this._elementRef=o,this.onChange=c=>{},this.onTouched=()=>{}}setProperty(t,o){this._renderer.setProperty(this._elementRef.nativeElement,t,o)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(Fs),ae(tn))};static#t=this.\u0275dir=Ye({type:e})}return e})(),vg=(()=>{class e extends sj{static#e=this.\u0275fac=(()=>{let t;return function(c){return(t||(t=Yi(e)))(c||e)}})();static#t=this.\u0275dir=Ye({type:e,features:[Nt]})}return e})();const Qc=new De(""),N8={provide:Qc,useExisting:Ln(()=>zP),multi:!0},M8=new De("");let zP=(()=>{class e extends sj{constructor(t,o,c){super(t,o),this._compositionMode=c,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function P8(){const e=Yc()?Yc().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(Fs),ae(tn),ae(M8,8))};static#t=this.\u0275dir=Ye({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(o,c){1&o&&gn("input",function(f){return c._handleInput(f.target.value)})("blur",function(){return c.onTouched()})("compositionstart",function(){return c._compositionStart()})("compositionend",function(f){return c._compositionEnd(f.target.value)})},features:[wn([N8]),Nt]})}return e})();function Lp(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}function cj(e){return null!=e&&"number"==typeof e.length}const to=new De(""),Fp=new De(""),x8=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class dj{static min(n){return function lj(e){return n=>{if(Lp(n.value)||Lp(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t<e?{min:{min:e,actual:n.value}}:null}}(n)}static max(n){return function uj(e){return n=>{if(Lp(n.value)||Lp(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t>e?{max:{max:e,actual:n.value}}:null}}(n)}static required(n){return function hj(e){return Lp(e.value)?{required:!0}:null}(n)}static requiredTrue(n){return function pj(e){return!0===e.value?null:{required:!0}}(n)}static email(n){return function fj(e){return Lp(e.value)||x8.test(e.value)?null:{email:!0}}(n)}static minLength(n){return function mj(e){return n=>Lp(n.value)||!cj(n.value)?null:n.value.length<e?{minlength:{requiredLength:e,actualLength:n.value.length}}:null}(n)}static maxLength(n){return function gj(e){return n=>cj(n.value)&&n.value.length>e?{maxlength:{requiredLength:e,actualLength:n.value.length}}:null}(n)}static pattern(n){return function _j(e){if(!e)return KP;let n,t;return"string"==typeof e?(t="","^"!==e.charAt(0)&&(t+="^"),t+=e,"$"!==e.charAt(e.length-1)&&(t+="$"),n=new RegExp(t)):(t=e.toString(),n=e),o=>{if(Lp(o.value))return null;const c=o.value;return n.test(c)?null:{pattern:{requiredPattern:t,actualValue:c}}}}(n)}static nullValidator(n){return null}static compose(n){return Sj(n)}static composeAsync(n){return Tj(n)}}function KP(e){return null}function Ej(e){return null!=e}function vj(e){return lp(e)?Ur(e):e}function bj(e){let n={};return e.forEach(t=>{n=null!=t?{...n,...t}:n}),0===Object.keys(n).length?null:n}function yj(e,n){return n.map(t=>t(e))}function Cj(e){return e.map(n=>function k8(e){return!e.validate}(n)?n:t=>n.validate(t))}function Sj(e){if(!e)return null;const n=e.filter(Ej);return 0==n.length?null:function(t){return bj(yj(t,n))}}function nU(e){return null!=e?Sj(Cj(e)):null}function Tj(e){if(!e)return null;const n=e.filter(Ej);return 0==n.length?null:function(t){return function D8(...e){const n=rj(e),{args:t,keys:o}=nj(e),c=new Wn(u=>{const{length:f}=t;if(!f)return void u.complete();const g=new Array(f);let E=f,C=f;for(let R=0;R<f;R++){let P=!1;Wo(t[R]).subscribe(Jn(u,B=>{P||(P=!0,C--),g[R]=B},()=>E--,void 0,()=>{(!E||!P)&&(C||u.next(o?oj(o,g):g),u.complete())}))}});return n?c.pipe(tU(n)):c}(yj(t,n).map(vj)).pipe(Yt(bj))}}function iU(e){return null!=e?Tj(Cj(e)):null}function Ij(e,n){return null===e?[n]:Array.isArray(e)?[...e,n]:[e,n]}function wj(e){return e._rawValidators}function Rj(e){return e._rawAsyncValidators}function rU(e){return e?Array.isArray(e)?e:[e]:[]}function qP(e,n){return Array.isArray(e)?e.includes(n):e===n}function Aj(e,n){const t=rU(n);return rU(e).forEach(c=>{qP(t,c)||t.push(c)}),t}function Dj(e,n){return rU(n).filter(t=>!qP(e,t))}class Oj{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=nU(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=iU(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,t){return!!this.control&&this.control.hasError(n,t)}getError(n,t){return this.control?this.control.getError(n,t):null}}class Rs extends Oj{get formDirective(){return null}get path(){return null}}class ku extends Oj{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Nj{constructor(n){this._cd=n}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let Pj=(()=>{class e extends Nj{constructor(t){super(t)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(ku,2))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(o,c){2&o&&Ht("ng-untouched",c.isUntouched)("ng-touched",c.isTouched)("ng-pristine",c.isPristine)("ng-dirty",c.isDirty)("ng-valid",c.isValid)("ng-invalid",c.isInvalid)("ng-pending",c.isPending)},features:[Nt]})}return e})(),Mj=(()=>{class e extends Nj{constructor(t){super(t)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(Rs,10))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(o,c){2&o&&Ht("ng-untouched",c.isUntouched)("ng-touched",c.isTouched)("ng-pristine",c.isPristine)("ng-dirty",c.isDirty)("ng-valid",c.isValid)("ng-invalid",c.isInvalid)("ng-pending",c.isPending)("ng-submitted",c.isSubmitted)},features:[Nt]})}return e})();const iI="VALID",$P="INVALID",gb="PENDING",rI="DISABLED";function aU(e){return(XP(e)?e.validators:e)||null}function cU(e,n){return(XP(n)?n.asyncValidators:e)||null}function XP(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function kj(e,n,t){const o=e.controls;if(!(n?Object.keys(o):o).length)throw new he(1e3,"");if(!o[t])throw new he(1001,"")}function Lj(e,n,t){e._forEachChild((o,c)=>{if(void 0===t[c])throw new he(1002,"")})}class JP{constructor(n,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(n),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get valid(){return this.status===iI}get invalid(){return this.status===$P}get pending(){return this.status==gb}get disabled(){return this.status===rI}get enabled(){return this.status!==rI}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(Aj(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(Aj(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(Dj(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(Dj(n,this._rawAsyncValidators))}hasValidator(n){return qP(this._rawValidators,n)}hasAsyncValidator(n){return qP(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){this.touched=!0,this._parent&&!n.onlySelf&&this._parent.markAsTouched(n)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(n=>n.markAllAsTouched())}markAsUntouched(n={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}markAsDirty(n={}){this.pristine=!1,this._parent&&!n.onlySelf&&this._parent.markAsDirty(n)}markAsPristine(n={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}markAsPending(n={}){this.status=gb,!1!==n.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!n.onlySelf&&this._parent.markAsPending(n)}disable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=rI,this.errors=null,this._forEachChild(o=>{o.disable({...n,onlySelf:!0})}),this._updateValue(),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...n,skipPristineCheck:t}),this._onDisabledChange.forEach(o=>o(!0))}enable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=iI,this._forEachChild(o=>{o.enable({...n,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors({...n,skipPristineCheck:t}),this._onDisabledChange.forEach(o=>o(!1))}_updateAncestors(n){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===iI||this.status===gb)&&this._runAsyncValidator(n.emitEvent)),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(n)}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?rI:iI}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n){if(this.asyncValidator){this.status=gb,this._hasOwnPendingAsyncValidator=!0;const t=vj(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(o=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(o,{emitEvent:n})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(n,t={}){this.errors=n,this._updateControlsErrors(!1!==t.emitEvent)}get(n){let t=n;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((o,c)=>o&&o._find(c),this)}getError(n,t){const o=t?this.get(t):this;return o&&o.errors?o.errors[n]:null}hasError(n,t){return!!this.getError(n,t)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(n)}_initObservables(){this.valueChanges=new pn,this.statusChanges=new pn}_calculateStatus(){return this._allControlsDisabled()?rI:this.errors?$P:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(gb)?gb:this._anyControlsHaveStatus($P)?$P:iI}_anyControlsHaveStatus(n){return this._anyControls(t=>t.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n={}){this.pristine=!this._anyControlsDirty(),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}_updateTouched(n={}){this.touched=this._anyControlsTouched(),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){XP(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=function V8(e){return Array.isArray(e)?nU(e):e||null}(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=function B8(e){return Array.isArray(e)?iU(e):e||null}(this._rawAsyncValidators)}}class oI extends JP{constructor(n,t,o){super(aU(t),cU(o,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,t){return this.controls[n]?this.controls[n]:(this.controls[n]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(n,t,o={}){this.registerControl(n,t),this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}removeControl(n,t={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(n,t,o={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],t&&this.registerControl(n,t),this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,t={}){Lj(this,0,n),Object.keys(n).forEach(o=>{kj(this,!0,o),this.controls[o].setValue(n[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(Object.keys(n).forEach(o=>{const c=this.controls[o];c&&c.patchValue(n[o],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n={},t={}){this._forEachChild((o,c)=>{o.reset(n?n[c]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(n,t,o)=>(n[o]=t.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(t,o)=>!!o._syncPendingControls()||t);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(t=>{const o=this.controls[t];o&&n(o,t)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const[t,o]of Object.entries(this.controls))if(this.contains(t)&&n(o))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,o,c)=>((o.enabled||this.disabled)&&(t[c]=o.value),t))}_reduceChildren(n,t){let o=n;return this._forEachChild((c,u)=>{o=t(o,c,u)}),o}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}}class Fj extends oI{}const _b=new De("CallSetDisabledState",{providedIn:"root",factory:()=>QP}),QP="always";function sI(e,n,t=QP){dU(e,n),n.valueAccessor.writeValue(e.value),(e.disabled||"always"===t)&&n.valueAccessor.setDisabledState?.(e.disabled),function H8(e,n){n.valueAccessor.registerOnChange(t=>{e._pendingValue=t,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&Uj(e,n)})}(e,n),function W8(e,n){const t=(o,c)=>{n.valueAccessor.writeValue(o),c&&n.viewToModelUpdate(o)};e.registerOnChange(t),n._registerOnDestroy(()=>{e._unregisterOnChange(t)})}(e,n),function G8(e,n){n.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&Uj(e,n),"submit"!==e.updateOn&&e.markAsTouched()})}(e,n),function j8(e,n){if(n.valueAccessor.setDisabledState){const t=o=>{n.valueAccessor.setDisabledState(o)};e.registerOnDisabledChange(t),n._registerOnDestroy(()=>{e._unregisterOnDisabledChange(t)})}}(e,n)}function eM(e,n,t=!0){const o=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(o),n.valueAccessor.registerOnTouched(o)),nM(e,n),e&&(n._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function tM(e,n){e.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(n)})}function dU(e,n){const t=wj(e);null!==n.validator?e.setValidators(Ij(t,n.validator)):"function"==typeof t&&e.setValidators([t]);const o=Rj(e);null!==n.asyncValidator?e.setAsyncValidators(Ij(o,n.asyncValidator)):"function"==typeof o&&e.setAsyncValidators([o]);const c=()=>e.updateValueAndValidity();tM(n._rawValidators,c),tM(n._rawAsyncValidators,c)}function nM(e,n){let t=!1;if(null!==e){if(null!==n.validator){const c=wj(e);if(Array.isArray(c)&&c.length>0){const u=c.filter(f=>f!==n.validator);u.length!==c.length&&(t=!0,e.setValidators(u))}}if(null!==n.asyncValidator){const c=Rj(e);if(Array.isArray(c)&&c.length>0){const u=c.filter(f=>f!==n.asyncValidator);u.length!==c.length&&(t=!0,e.setAsyncValidators(u))}}}const o=()=>{};return tM(n._rawValidators,o),tM(n._rawAsyncValidators,o),t}function Uj(e,n){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function Vj(e,n){dU(e,n)}function Bj(e,n){e._syncPendingControls(),n.forEach(t=>{const o=t.control;"submit"===o.updateOn&&o._pendingChange&&(t.viewToModelUpdate(o._pendingValue),o._pendingChange=!1)})}const $8={provide:Rs,useExisting:Ln(()=>iM)},aI=Promise.resolve();let iM=(()=>{class e extends Rs{constructor(t,o,c){super(),this.callSetDisabledState=c,this.submitted=!1,this._directives=new Set,this.ngSubmit=new pn,this.form=new oI({},nU(t),iU(o))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){aI.then(()=>{const o=this._findContainer(t.path);t.control=o.registerControl(t.name,t.control),sI(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){aI.then(()=>{const o=this._findContainer(t.path);o&&o.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){aI.then(()=>{const o=this._findContainer(t.path),c=new oI({});Vj(c,t),o.registerControl(t.name,c),c.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){aI.then(()=>{const o=this._findContainer(t.path);o&&o.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,o){aI.then(()=>{this.form.get(t.path).setValue(o)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submitted=!0,Bj(this.form,this._directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static#e=this.\u0275fac=function(o){return new(o||e)(ae(to,10),ae(Fp,10),ae(_b,8))};static#t=this.\u0275dir=Ye({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(o,c){1&o&&gn("submit",function(f){return c.onSubmit(f)})("reset",function(){return c.onReset()})},inputs:{options:[Xe.None,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[wn([$8]),Nt]})}return e})();function jj(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}function Hj(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const cI=class extends JP{constructor(n=null,t,o){super(aU(t),cU(o,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),XP(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=Hj(n)?n.value:n)}setValue(n,t={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(o=>o(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(n,t={}){this.setValue(n,t)}reset(n=this.defaultValue,t={}){this._applyFormState(n),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){jj(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){jj(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){Hj(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}};Promise.resolve();let qj=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ye({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}return e})();const pU=new De(""),rG={provide:Rs,useExisting:Ln(()=>dI)};let dI=(()=>{class e extends Rs{constructor(t,o,c){super(),this.callSetDisabledState=c,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new pn,this._setValidators(t),this._setAsyncValidators(o)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(nM(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const o=this.form.get(t.path);return sI(o,t,this.callSetDisabledState),o.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),o}getControl(t){return this.form.get(t.path)}removeControl(t){eM(t.control||null,t,!1),function Y8(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,o){this.form.get(t.path).setValue(o)}onSubmit(t){return this.submitted=!0,Bj(this.form,this.directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{const o=t.control,c=this.form.get(t.path);o!==c&&(eM(o||null,t),(e=>e instanceof cI)(c)&&(sI(c,t,this.callSetDisabledState),t.control=c))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const o=this.form.get(t.path);Vj(o,t),o.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const o=this.form.get(t.path);o&&function z8(e,n){return nM(e,n)}(o,t)&&o.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){dU(this.form,this),this._oldForm&&nM(this._oldForm,this)}_checkFormPresent(){}static#e=this.\u0275fac=function(o){return new(o||e)(ae(to,10),ae(Fp,10),ae(_b,8))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","formGroup",""]],hostBindings:function(o,c){1&o&&gn("submit",function(f){return c.onSubmit(f)})("reset",function(){return c.onReset()})},inputs:{form:[Xe.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[wn([rG]),Nt,So]})}return e})();const aG={provide:ku,useExisting:Ln(()=>gU)};let gU=(()=>{class e extends ku{set isDisabled(t){}static#e=this._ngModelWarningSentOnce=!1;constructor(t,o,c,u,f){super(),this._ngModelWarningConfig=f,this._added=!1,this.name=null,this.update=new pn,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(o),this._setAsyncValidators(c),this.valueAccessor=function hU(e,n){if(!n)return null;let t,o,c;return Array.isArray(n),n.forEach(u=>{u.constructor===zP?t=u:function q8(e){return Object.getPrototypeOf(e.constructor)===vg}(u)?o=u:c=u}),c||o||t||null}(0,u)}ngOnChanges(t){this._added||this._setUpControl(),function uU(e,n){if(!e.hasOwnProperty("model"))return!1;const t=e.model;return!!t.isFirstChange()||!Object.is(n,t.currentValue)}(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return function ZP(e,n){return[...n.path,e]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static#t=this.\u0275fac=function(o){return new(o||e)(ae(Rs,13),ae(to,10),ae(Fp,10),ae(Qc,10),ae(pU,8))};static#n=this.\u0275dir=Ye({type:e,selectors:[["","formControlName",""]],inputs:{name:[Xe.None,"formControlName","name"],isDisabled:[Xe.None,"disabled","isDisabled"],model:[Xe.None,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[wn([aG]),Nt,So]})}return e})(),CG=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({})}return e})();class d4 extends JP{constructor(n,t,o){super(aU(t),cU(o,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(n){return this.controls[this._adjustIndex(n)]}push(n,t={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(n,t,o={}){this.controls.splice(n,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:o.emitEvent})}removeAt(n,t={}){let o=this._adjustIndex(n);o<0&&(o=0),this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),this.controls.splice(o,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(n,t,o={}){let c=this._adjustIndex(n);c<0&&(c=0),this.controls[c]&&this.controls[c]._registerOnCollectionChange(()=>{}),this.controls.splice(c,1),t&&(this.controls.splice(c,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:o.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,t={}){Lj(this,0,n),n.forEach((o,c)=>{kj(this,!1,c),this.at(c).setValue(o,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(n.forEach((o,c)=>{this.at(c)&&this.at(c).patchValue(o,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n=[],t={}){this._forEachChild((o,c)=>{o.reset(n[c],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((t,o)=>!!o._syncPendingControls()||t,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((t,o)=>{n(t,o)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(t=>t.enabled&&n(t))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(const n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}}function l4(e){return!!e&&(void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn)}let yU,SG=(()=>{class e{constructor(){this.useNonNullable=!1}get nonNullable(){const t=new e;return t.useNonNullable=!0,t}group(t,o=null){const c=this._reduceControls(t);let u={};return l4(o)?u=o:null!==o&&(u.validators=o.validator,u.asyncValidators=o.asyncValidator),new oI(c,u)}record(t,o=null){const c=this._reduceControls(t);return new Fj(c,o)}control(t,o,c){let u={};return this.useNonNullable?(l4(o)?u=o:(u.validators=o,u.asyncValidators=c),new cI(t,{...u,nonNullable:!0})):new cI(t,o,c)}array(t,o,c){const u=t.map(f=>this._createControl(f));return new d4(u,o,c)}_reduceControls(t){const o={};return Object.keys(t).forEach(c=>{o[c]=this._createControl(t[c])}),o}_createControl(t){return t instanceof cI||t instanceof JP?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),TG=(()=>{class e extends SG{group(t,o=null){return super.group(t,o)}control(t,o,c){return super.control(t,o,c)}array(t,o,c){return super.array(t,o,c)}static#e=this.\u0275fac=(()=>{let t;return function(c){return(t||(t=Yi(e)))(c||e)}})();static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),IG=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:pU,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:_b,useValue:t.callSetDisabledState??QP}]}}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({imports:[CG]})}return e})();try{yU=typeof Intl<"u"&&Intl.v8BreakIterator}catch{yU=!1}let Eb,Eo=(()=>{class e{constructor(t){this._platformId=t,this.isBrowser=this._platformId?xP(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!yU)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}static#e=this.\u0275fac=function(o){return new(o||e)(be(Pa))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const u4=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function h4(){if(Eb)return Eb;if("object"!=typeof document||!document)return Eb=new Set(u4),Eb;let e=document.createElement("input");return Eb=new Set(u4.filter(n=>(e.setAttribute("type",n),e.type===n))),Eb}let lI,yg,CU;function vb(e){return function wG(){if(null==lI&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>lI=!0}))}finally{lI=lI||!1}return lI}()?e:!!e.capture}function RG(){if(null==yg){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return yg=!1,yg;if("scrollBehavior"in document.documentElement.style)yg=!0;else{const e=Element.prototype.scrollTo;yg=!!e&&!/\{\s*\[native code\]\s*\}/.test(e.toString())}}return yg}function Up(e){return e.composedPath?e.composedPath()[0]:e.target}function SU(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function pt(...e){return Ur(e,nI(e))}function Ea(e,n){return fi((t,o)=>{let c=0;t.subscribe(Jn(o,u=>e.call(n,u,c++)&&o.next(u)))})}function p4(e){return Ea((n,t)=>e<=t)}function UG(e,n){return e===n}function zo(e){return fi((n,t)=>{Wo(e).subscribe(Jn(t,()=>t.complete(),Gu)),!t.closed&&n.subscribe(t)})}let VG=(()=>{class e{create(t){return typeof MutationObserver>"u"?null:new MutationObserver(t)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),f4=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({providers:[VG]})}return e})();function bb(e){return null!=e&&"false"!=`${e}`}function m4(e,n=0){return function BG(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}(e)?Number(e):n}function oM(e){return Array.isArray(e)?e:[e]}function Tr(e){return null==e?"":"string"==typeof e?e:`${e}px`}function Vp(e){return e instanceof tn?e.nativeElement:e}function sM(...e){const n=nI(e),t=rj(e),{args:o,keys:c}=nj(e);if(0===o.length)return Ur([],n);const u=new Wn(function jG(e,n,t=ad){return o=>{g4(n,()=>{const{length:c}=e,u=new Array(c);let f=c,g=c;for(let E=0;E<c;E++)g4(n,()=>{const C=Ur(e[E],n);let R=!1;C.subscribe(Jn(o,P=>{u[E]=P,R||(R=!0,g--),g||o.next(t(u.slice()))},()=>{--f||o.complete()}))},o)},o)}}(o,n,c?f=>oj(c,f):ad));return t?u.pipe(tU(t)):u}function g4(e,n,t){e?xu(t,e,n):n()}function no(e,n,t=1/0){return dn(n)?no((o,c)=>Yt((u,f)=>n(o,u,c,f))(Wo(e(o,c))),t):("number"==typeof n&&(t=n),fi((o,c)=>function HG(e,n,t,o,c,u,f,g){const E=[];let C=0,R=0,P=!1;const B=()=>{P&&!E.length&&!C&&n.complete()},G=J=>C<o?Y(J):E.push(J),Y=J=>{u&&n.next(J),C++;let le=!1;Wo(t(J,R++)).subscribe(Jn(n,ge=>{c?.(ge),u?G(ge):n.next(ge)},()=>{le=!0},void 0,()=>{if(le)try{for(C--;E.length&&C<o;){const ge=E.shift();f?xu(n,f,()=>Y(ge)):Y(ge)}B()}catch(ge){n.error(ge)}}))};return e.subscribe(Jn(n,G,()=>{P=!0,B()})),()=>{g?.()}}(o,c,e,t)))}function yb(e=1/0){return no(ad,e)}function hI(...e){return function GG(){return yb(1)}()(Ur(e,nI(e)))}const Zc=new Wn(e=>e.complete());function Vr(e){return e<=0?()=>Zc:fi((n,t)=>{let o=0;n.subscribe(Jn(t,c=>{++o<=e&&(t.next(c),e<=o&&t.complete())}))})}class zG extends Ki{constructor(n,t){super()}schedule(n,t=0){return this}}const aM={setInterval(e,n,...t){const{delegate:o}=aM;return o?.setInterval?o.setInterval(e,n,...t):setInterval(e,n,...t)},clearInterval(e){const{delegate:n}=aM;return(n?.clearInterval||clearInterval)(e)},delegate:void 0};class TU extends zG{constructor(n,t){super(n,t),this.scheduler=n,this.work=t,this.pending=!1}schedule(n,t=0){var o;if(this.closed)return this;this.state=n;const c=this.id,u=this.scheduler;return null!=c&&(this.id=this.recycleAsyncId(u,c,t)),this.pending=!0,this.delay=t,this.id=null!==(o=this.id)&&void 0!==o?o:this.requestAsyncId(u,this.id,t),this}requestAsyncId(n,t,o=0){return aM.setInterval(n.flush.bind(n,this),o)}recycleAsyncId(n,t,o=0){if(null!=o&&this.delay===o&&!1===this.pending)return t;null!=t&&aM.clearInterval(t)}execute(n,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const o=this._execute(n,t);if(o)return o;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,t){let c,o=!1;try{this.work(n)}catch(u){o=!0,c=u||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),c}unsubscribe(){if(!this.closed){const{id:n,scheduler:t}=this,{actions:o}=t;this.work=this.state=this.scheduler=null,this.pending=!1,Bg(o,this),null!=n&&(this.id=this.recycleAsyncId(t,n,null)),this.delay=null,super.unsubscribe()}}}const IU={now:()=>(IU.delegate||Date).now(),delegate:void 0};class pI{constructor(n,t=pI.now){this.schedulerActionCtor=n,this.now=t}schedule(n,t=0,o){return new this.schedulerActionCtor(this,n).schedule(o,t)}}pI.now=IU.now;class wU extends pI{constructor(n,t=pI.now){super(n,t),this.actions=[],this._active=!1}flush(n){const{actions:t}=this;if(this._active)return void t.push(n);let o;this._active=!0;do{if(o=n.execute(n.state,n.delay))break}while(n=t.shift());if(this._active=!1,o){for(;n=t.shift();)n.unsubscribe();throw o}}}const fI=new wU(TU),KG=fI;function _4(...e){const n=nI(e);return fi((t,o)=>{(n?hI(e,t,n):hI(e,t)).subscribe(o)})}const E4=new Set;let Cg,YG=(()=>{class e{constructor(t,o){this._platform=t,this._nonce=o,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):XG}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&function $G(e,n){if(!E4.has(e))try{Cg||(Cg=document.createElement("style"),n&&(Cg.nonce=n),Cg.setAttribute("type","text/css"),document.head.appendChild(Cg)),Cg.sheet&&(Cg.sheet.insertRule(`@media ${e} {body{ }}`,0),E4.add(e))}catch(t){console.error(t)}}(t,this._nonce),this._matchMedia(t)}static#e=this.\u0275fac=function(o){return new(o||e)(be(Eo),be(lC,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function XG(e){return{matches:"all"===e||""===e,media:e,addListener:()=>{},removeListener:()=>{}}}let JG=(()=>{class e{constructor(t,o){this._mediaMatcher=t,this._zone=o,this._queries=new Map,this._destroySubject=new en}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return v4(oM(t)).some(c=>this._registerQuery(c).mql.matches)}observe(t){let u=sM(v4(oM(t)).map(f=>this._registerQuery(f).observable));return u=hI(u.pipe(Vr(1)),u.pipe(p4(1),function qG(e,n=fI){return fi((t,o)=>{let c=null,u=null,f=null;const g=()=>{if(c){c.unsubscribe(),c=null;const C=u;u=null,o.next(C)}};function E(){const C=f+e,R=n.now();if(R<C)return c=this.schedule(void 0,C-R),void o.add(c);g()}t.subscribe(Jn(o,C=>{u=C,f=n.now(),c||(c=n.schedule(E,e),o.add(c))},()=>{g(),o.complete()},void 0,()=>{u=c=null}))})}(0))),u.pipe(Yt(f=>{const g={matches:!1,breakpoints:{}};return f.forEach(({matches:E,query:C})=>{g.matches=g.matches||E,g.breakpoints[C]=E}),g}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const o=this._mediaMatcher.matchMedia(t),u={observable:new Wn(f=>{const g=E=>this._zone.run(()=>f.next(E));return o.addListener(g),()=>{o.removeListener(g)}}).pipe(_4(o),Yt(({matches:f})=>({query:t,matches:f})),zo(this._destroySubject)),mql:o};return this._queries.set(t,u),u}static#e=this.\u0275fac=function(o){return new(o||e)(be(YG),be(it))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function v4(e){return e.map(n=>n.split(",")).reduce((n,t)=>n.concat(t)).map(n=>n.trim())}function cM(e,n){return e.getAttribute(n)?.match(/\S+/g)??[]}const y4="cdk-describedby-message",dM="cdk-describedby-host";let RU=0,eW=(()=>{class e{constructor(t,o){this._platform=o,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+RU++,this._document=t,this._id=Te(Nf)+"-"+RU++}describe(t,o,c){if(!this._canBeDescribed(t,o))return;const u=AU(o,c);"string"!=typeof o?(C4(o,this._id),this._messageRegistry.set(u,{messageElement:o,referenceCount:0})):this._messageRegistry.has(u)||this._createMessageElement(o,c),this._isElementDescribedByMessage(t,u)||this._addMessageReference(t,u)}removeDescription(t,o,c){if(!o||!this._isElementNode(t))return;const u=AU(o,c);if(this._isElementDescribedByMessage(t,u)&&this._removeMessageReference(t,u),"string"==typeof o){const f=this._messageRegistry.get(u);f&&0===f.referenceCount&&this._deleteMessageElement(u)}0===this._messagesContainer?.childNodes.length&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){const t=this._document.querySelectorAll(`[${dM}="${this._id}"]`);for(let o=0;o<t.length;o++)this._removeCdkDescribedByReferenceIds(t[o]),t[o].removeAttribute(dM);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(t,o){const c=this._document.createElement("div");C4(c,this._id),c.textContent=t,o&&c.setAttribute("role",o),this._createMessagesContainer(),this._messagesContainer.appendChild(c),this._messageRegistry.set(AU(t,o),{messageElement:c,referenceCount:0})}_deleteMessageElement(t){this._messageRegistry.get(t)?.messageElement?.remove(),this._messageRegistry.delete(t)}_createMessagesContainer(){if(this._messagesContainer)return;const t="cdk-describedby-message-container",o=this._document.querySelectorAll(`.${t}[platform="server"]`);for(let u=0;u<o.length;u++)o[u].remove();const c=this._document.createElement("div");c.style.visibility="hidden",c.classList.add(t),c.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&c.setAttribute("platform","server"),this._document.body.appendChild(c),this._messagesContainer=c}_removeCdkDescribedByReferenceIds(t){const o=cM(t,"aria-describedby").filter(c=>0!=c.indexOf(y4));t.setAttribute("aria-describedby",o.join(" "))}_addMessageReference(t,o){const c=this._messageRegistry.get(o);(function QG(e,n,t){const o=cM(e,n);t=t.trim(),!o.some(c=>c.trim()===t)&&(o.push(t),e.setAttribute(n,o.join(" ")))})(t,"aria-describedby",c.messageElement.id),t.setAttribute(dM,this._id),c.referenceCount++}_removeMessageReference(t,o){const c=this._messageRegistry.get(o);c.referenceCount--,function ZG(e,n,t){const o=cM(e,n);t=t.trim();const c=o.filter(u=>u!==t);c.length?e.setAttribute(n,c.join(" ")):e.removeAttribute(n)}(t,"aria-describedby",c.messageElement.id),t.removeAttribute(dM)}_isElementDescribedByMessage(t,o){const c=cM(t,"aria-describedby"),u=this._messageRegistry.get(o),f=u&&u.messageElement.id;return!!f&&-1!=c.indexOf(f)}_canBeDescribed(t,o){if(!this._isElementNode(t))return!1;if(o&&"object"==typeof o)return!0;const c=null==o?"":`${o}`.trim(),u=t.getAttribute("aria-label");return!(!c||u&&u.trim()===c)}_isElementNode(t){return t.nodeType===this._document.ELEMENT_NODE}static#e=this.\u0275fac=function(o){return new(o||e)(be(sn),be(Eo))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function AU(e,n){return"string"==typeof e?`${n||""}/${e}`:e}function C4(e,n){e.id||(e.id=`${y4}-${n}-${RU++}`)}function T4(e){return 0===e.buttons||0===e.detail}function I4(e){const n=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!(!n||-1!==n.identifier||null!=n.radiusX&&1!==n.radiusX||null!=n.radiusY&&1!==n.radiusY)}const sW=new De("cdk-input-modality-detector-options"),aW={ignoreKeys:[18,17,224,91,16]},Cb=vb({passive:!0,capture:!0});let cW=(()=>{class e{get mostRecentModality(){return this._modality.value}constructor(t,o,c,u){this._platform=t,this._mostRecentTarget=null,this._modality=new oo(null),this._lastTouchMs=0,this._onKeydown=f=>{this._options?.ignoreKeys?.some(g=>g===f.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Up(f))},this._onMousedown=f=>{Date.now()-this._lastTouchMs<650||(this._modality.next(T4(f)?"keyboard":"mouse"),this._mostRecentTarget=Up(f))},this._onTouchstart=f=>{I4(f)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Up(f))},this._options={...aW,...u},this.modalityDetected=this._modality.pipe(p4(1)),this.modalityChanged=this.modalityDetected.pipe(function FG(e,n=ad){return e=e??UG,fi((t,o)=>{let c,u=!0;t.subscribe(Jn(o,f=>{const g=n(f);(u||!e(c,g))&&(u=!1,c=g,o.next(f))}))})}()),t.isBrowser&&o.runOutsideAngular(()=>{c.addEventListener("keydown",this._onKeydown,Cb),c.addEventListener("mousedown",this._onMousedown,Cb),c.addEventListener("touchstart",this._onTouchstart,Cb)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Cb),document.removeEventListener("mousedown",this._onMousedown,Cb),document.removeEventListener("touchstart",this._onTouchstart,Cb))}static#e=this.\u0275fac=function(o){return new(o||e)(be(Eo),be(it),be(sn),be(sW,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var lM=function(e){return e[e.IMMEDIATE=0]="IMMEDIATE",e[e.EVENTUAL=1]="EVENTUAL",e}(lM||{});const lW=new De("cdk-focus-monitor-default-options"),uM=vb({passive:!0,capture:!0});let DU=(()=>{class e{constructor(t,o,c,u,f){this._ngZone=t,this._platform=o,this._inputModalityDetector=c,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new en,this._rootNodeFocusAndBlurListener=g=>{for(let C=Up(g);C;C=C.parentElement)"focus"===g.type?this._onFocus(g,C):this._onBlur(g,C)},this._document=u,this._detectionMode=f?.detectionMode||lM.IMMEDIATE}monitor(t,o=!1){const c=Vp(t);if(!this._platform.isBrowser||1!==c.nodeType)return pt();const u=function DG(e){if(function AG(){if(null==CU){const e=typeof document<"u"?document.head:null;CU=!(!e||!e.createShadowRoot&&!e.attachShadow)}return CU}()){const n=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&n instanceof ShadowRoot)return n}return null}(c)||this._getDocument(),f=this._elementInfo.get(c);if(f)return o&&(f.checkChildren=!0),f.subject;const g={checkChildren:o,subject:new en,rootNode:u};return this._elementInfo.set(c,g),this._registerGlobalListeners(g),g.subject}stopMonitoring(t){const o=Vp(t),c=this._elementInfo.get(o);c&&(c.subject.complete(),this._setClasses(o),this._elementInfo.delete(o),this._removeGlobalListeners(c))}focusVia(t,o,c){const u=Vp(t);u===this._getDocument().activeElement?this._getClosestElementsInfo(u).forEach(([g,E])=>this._originChanged(g,o,E)):(this._setOrigin(o),"function"==typeof u.focus&&u.focus(c))}ngOnDestroy(){this._elementInfo.forEach((t,o)=>this.stopMonitoring(o))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(t){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(t)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:t&&this._isLastInteractionFromInputLabel(t)?"mouse":"program"}_shouldBeAttributedToTouch(t){return this._detectionMode===lM.EVENTUAL||!!t?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(t,o){t.classList.toggle("cdk-focused",!!o),t.classList.toggle("cdk-touch-focused","touch"===o),t.classList.toggle("cdk-keyboard-focused","keyboard"===o),t.classList.toggle("cdk-mouse-focused","mouse"===o),t.classList.toggle("cdk-program-focused","program"===o)}_setOrigin(t,o=!1){this._ngZone.runOutsideAngular(()=>{this._origin=t,this._originFromTouchInteraction="touch"===t&&o,this._detectionMode===lM.IMMEDIATE&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(t,o){const c=this._elementInfo.get(o),u=Up(t);!c||!c.checkChildren&&o!==u||this._originChanged(o,this._getFocusOrigin(u),c)}_onBlur(t,o){const c=this._elementInfo.get(o);!c||c.checkChildren&&t.relatedTarget instanceof Node&&o.contains(t.relatedTarget)||(this._setClasses(o),this._emitOrigin(c,null))}_emitOrigin(t,o){t.subject.observers.length&&this._ngZone.run(()=>t.subject.next(o))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;const o=t.rootNode,c=this._rootNodeFocusListenerCount.get(o)||0;c||this._ngZone.runOutsideAngular(()=>{o.addEventListener("focus",this._rootNodeFocusAndBlurListener,uM),o.addEventListener("blur",this._rootNodeFocusAndBlurListener,uM)}),this._rootNodeFocusListenerCount.set(o,c+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(zo(this._stopInputModalityDetector)).subscribe(u=>{this._setOrigin(u,!0)}))}_removeGlobalListeners(t){const o=t.rootNode;if(this._rootNodeFocusListenerCount.has(o)){const c=this._rootNodeFocusListenerCount.get(o);c>1?this._rootNodeFocusListenerCount.set(o,c-1):(o.removeEventListener("focus",this._rootNodeFocusAndBlurListener,uM),o.removeEventListener("blur",this._rootNodeFocusAndBlurListener,uM),this._rootNodeFocusListenerCount.delete(o))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(t,o,c){this._setClasses(t,o),this._emitOrigin(c,o),this._lastFocusOrigin=o}_getClosestElementsInfo(t){const o=[];return this._elementInfo.forEach((c,u)=>{(u===t||c.checkChildren&&u.contains(t))&&o.push([u,c])}),o}_isLastInteractionFromInputLabel(t){const{_mostRecentTarget:o,mostRecentModality:c}=this._inputModalityDetector;if("mouse"!==c||!o||o===t||"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName||t.disabled)return!1;const u=t.labels;if(u)for(let f=0;f<u.length;f++)if(u[f].contains(o))return!0;return!1}static#e=this.\u0275fac=function(o){return new(o||e)(be(it),be(Eo),be(cW),be(sn,8),be(lW,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Sg=function(e){return e[e.NONE=0]="NONE",e[e.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",e[e.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",e}(Sg||{});const R4="cdk-high-contrast-black-on-white",A4="cdk-high-contrast-white-on-black",OU="cdk-high-contrast-active";let D4=(()=>{class e{constructor(t,o){this._platform=t,this._document=o,this._breakpointSubscription=Te(JG).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return Sg.NONE;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const o=this._document.defaultView||window,c=o&&o.getComputedStyle?o.getComputedStyle(t):null,u=(c&&c.backgroundColor||"").replace(/ /g,"");switch(t.remove(),u){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return Sg.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return Sg.BLACK_ON_WHITE}return Sg.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(OU,R4,A4),this._hasCheckedHighContrastMode=!0;const o=this.getHighContrastMode();o===Sg.BLACK_ON_WHITE?t.add(OU,R4):o===Sg.WHITE_ON_BLACK&&t.add(OU,A4)}}static#e=this.\u0275fac=function(o){return new(o||e)(be(Eo),be(sn))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),uW=(()=>{class e{constructor(t){t._applyBodyHighContrastModeCssClasses()}static#e=this.\u0275fac=function(o){return new(o||e)(be(D4))};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({imports:[f4]})}return e})();const hW=new De("cdk-dir-doc",{providedIn:"root",factory:function pW(){return Te(sn)}}),fW=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let NU=(()=>{class e{constructor(t){this.value="ltr",this.change=new pn,t&&(this.value=function mW(e){const n=e?.toLowerCase()||"";return"auto"===n&&typeof navigator<"u"&&navigator?.language?fW.test(navigator.language)?"rtl":"ltr":"rtl"===n?"rtl":"ltr"}((t.body?t.body.dir:null)||(t.documentElement?t.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}static#e=this.\u0275fac=function(o){return new(o||e)(be(hW,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),mI=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({})}return e})();const gW=["mat-internal-form-field",""],_W=["*"],vW=new De("mat-sanity-checks",{providedIn:"root",factory:function EW(){return!0}});let tc=(()=>{class e{constructor(t,o,c){this._sanityChecks=o,this._document=c,this._hasDoneGlobalChecks=!1,t._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!SU()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}static#e=this.\u0275fac=function(o){return new(o||e)(be(D4),be(vW,8),be(sn))};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({imports:[mI,mI]})}return e})();class P4{constructor(n,t,o,c,u){this._defaultMatcher=n,this.ngControl=t,this._parentFormGroup=o,this._parentForm=c,this._stateChanges=u,this.errorState=!1}updateErrorState(){const n=this.errorState,t=this._parentFormGroup||this._parentForm,o=this.matcher||this._defaultMatcher,c=this.ngControl?this.ngControl.control:null,u=o?.isErrorState(c,t)??!1;u!==n&&(this.errorState=u,this._stateChanges.next())}}let IW=(()=>{class e{isErrorState(t,o){return!!(t&&t.invalid&&(t.touched||o&&o.submitted))}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var nc=function(e){return e[e.FADING_IN=0]="FADING_IN",e[e.VISIBLE=1]="VISIBLE",e[e.FADING_OUT=2]="FADING_OUT",e[e.HIDDEN=3]="HIDDEN",e}(nc||{});class wW{constructor(n,t,o,c=!1){this._renderer=n,this.element=t,this.config=o,this._animationForciblyDisabledThroughCss=c,this.state=nc.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}}const M4=vb({passive:!0,capture:!0});class RW{constructor(){this._events=new Map,this._delegateEventHandler=n=>{const t=Up(n);t&&this._events.get(n.type)?.forEach((o,c)=>{(c===t||c.contains(t))&&o.forEach(u=>u.handleEvent(n))})}}addHandler(n,t,o,c){const u=this._events.get(t);if(u){const f=u.get(o);f?f.add(c):u.set(o,new Set([c]))}else this._events.set(t,new Map([[o,new Set([c])]])),n.runOutsideAngular(()=>{document.addEventListener(t,this._delegateEventHandler,M4)})}removeHandler(n,t,o){const c=this._events.get(n);if(!c)return;const u=c.get(t);u&&(u.delete(o),0===u.size&&c.delete(t),0===c.size&&(this._events.delete(n),document.removeEventListener(n,this._delegateEventHandler,M4)))}}const x4={enterDuration:225,exitDuration:150},k4=vb({passive:!0,capture:!0}),L4=["mousedown","touchstart"],F4=["mouseup","mouseleave","touchend","touchcancel"];class hM{static#e=this._eventManager=new RW;constructor(n,t,o,c){this._target=n,this._ngZone=t,this._platform=c,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,c.isBrowser&&(this._containerElement=Vp(o))}fadeInRipple(n,t,o={}){const c=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),u={...x4,...o.animation};o.centered&&(n=c.left+c.width/2,t=c.top+c.height/2);const f=o.radius||function DW(e,n,t){const o=Math.max(Math.abs(e-t.left),Math.abs(e-t.right)),c=Math.max(Math.abs(n-t.top),Math.abs(n-t.bottom));return Math.sqrt(o*o+c*c)}(n,t,c),g=n-c.left,E=t-c.top,C=u.enterDuration,R=document.createElement("div");R.classList.add("mat-ripple-element"),R.style.left=g-f+"px",R.style.top=E-f+"px",R.style.height=2*f+"px",R.style.width=2*f+"px",null!=o.color&&(R.style.backgroundColor=o.color),R.style.transitionDuration=`${C}ms`,this._containerElement.appendChild(R);const P=window.getComputedStyle(R),G=P.transitionDuration,Y="none"===P.transitionProperty||"0s"===G||"0s, 0s"===G||0===c.width&&0===c.height,J=new wW(this,R,o,Y);R.style.transform="scale3d(1, 1, 1)",J.state=nc.FADING_IN,o.persistent||(this._mostRecentTransientRipple=J);let le=null;return!Y&&(C||u.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const ge=()=>this._finishRippleTransition(J),de=()=>this._destroyRipple(J);R.addEventListener("transitionend",ge),R.addEventListener("transitioncancel",de),le={onTransitionEnd:ge,onTransitionCancel:de}}),this._activeRipples.set(J,le),(Y||!C)&&this._finishRippleTransition(J),J}fadeOutRipple(n){if(n.state===nc.FADING_OUT||n.state===nc.HIDDEN)return;const t=n.element,o={...x4,...n.config.animation};t.style.transitionDuration=`${o.exitDuration}ms`,t.style.opacity="0",n.state=nc.FADING_OUT,(n._animationForciblyDisabledThroughCss||!o.exitDuration)&&this._finishRippleTransition(n)}fadeOutAll(){this._getActiveRipples().forEach(n=>n.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(n=>{n.config.persistent||n.fadeOut()})}setupTriggerEvents(n){const t=Vp(n);!this._platform.isBrowser||!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,L4.forEach(o=>{hM._eventManager.addHandler(this._ngZone,o,t,this)}))}handleEvent(n){"mousedown"===n.type?this._onMousedown(n):"touchstart"===n.type?this._onTouchStart(n):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{F4.forEach(t=>{this._triggerElement.addEventListener(t,this,k4)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(n){n.state===nc.FADING_IN?this._startFadeOutTransition(n):n.state===nc.FADING_OUT&&this._destroyRipple(n)}_startFadeOutTransition(n){const t=n===this._mostRecentTransientRipple,{persistent:o}=n.config;n.state=nc.VISIBLE,!o&&(!t||!this._isPointerDown)&&n.fadeOut()}_destroyRipple(n){const t=this._activeRipples.get(n)??null;this._activeRipples.delete(n),this._activeRipples.size||(this._containerRect=null),n===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),n.state=nc.HIDDEN,null!==t&&(n.element.removeEventListener("transitionend",t.onTransitionEnd),n.element.removeEventListener("transitioncancel",t.onTransitionCancel)),n.element.remove()}_onMousedown(n){const t=T4(n),o=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!t&&!o&&(this._isPointerDown=!0,this.fadeInRipple(n.clientX,n.clientY,this._target.rippleConfig))}_onTouchStart(n){if(!this._target.rippleDisabled&&!I4(n)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const t=n.changedTouches;if(t)for(let o=0;o<t.length;o++)this.fadeInRipple(t[o].clientX,t[o].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(n=>{!n.config.persistent&&(n.state===nc.VISIBLE||n.config.terminateOnPointerUp&&n.state===nc.FADING_IN)&&n.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const n=this._triggerElement;n&&(L4.forEach(t=>hM._eventManager.removeHandler(t,n,this)),this._pointerUpEventsRegistered&&F4.forEach(t=>n.removeEventListener(t,this,k4)))}}const U4=new De("mat-ripple-global-options");let V4=(()=>{class e{get disabled(){return this._disabled}set disabled(t){t&&this.fadeOutAllNonPersistent(),this._disabled=t,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(t){this._trigger=t,this._setupTriggerEventsIfEnabled()}constructor(t,o,c,u,f){this._elementRef=t,this._animationMode=f,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=u||{},this._rippleRenderer=new hM(this,o,t,c)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(t,o=0,c){return"number"==typeof t?this._rippleRenderer.fadeInRipple(t,o,{...this.rippleConfig,...c}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...t})}static#e=this.\u0275fac=function(o){return new(o||e)(ae(tn),ae(it),ae(Eo),ae(U4,8),ae(bc,8))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(o,c){2&o&&Ht("mat-ripple-unbounded",c.unbounded)},inputs:{color:[Xe.None,"matRippleColor","color"],unbounded:[Xe.None,"matRippleUnbounded","unbounded"],centered:[Xe.None,"matRippleCentered","centered"],radius:[Xe.None,"matRippleRadius","radius"],animation:[Xe.None,"matRippleAnimation","animation"],disabled:[Xe.None,"matRippleDisabled","disabled"],trigger:[Xe.None,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0})}return e})(),OW=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({imports:[tc,tc]})}return e})();const B4={capture:!0},j4=["focus","click","mouseenter","touchstart"],PU="mat-ripple-loader-uninitialized",MU="mat-ripple-loader-class-name",H4="mat-ripple-loader-centered",pM="mat-ripple-loader-disabled";let NW=(()=>{class e{constructor(){this._document=Te(sn,{optional:!0}),this._animationMode=Te(bc,{optional:!0}),this._globalRippleOptions=Te(U4,{optional:!0}),this._platform=Te(Eo),this._ngZone=Te(it),this._hosts=new Map,this._onInteraction=t=>{if(!(t.target instanceof HTMLElement))return;const c=t.target.closest(`[${PU}]`);c&&this._createRipple(c)},this._ngZone.runOutsideAngular(()=>{for(const t of j4)this._document?.addEventListener(t,this._onInteraction,B4)})}ngOnDestroy(){const t=this._hosts.keys();for(const o of t)this.destroyRipple(o);for(const o of j4)this._document?.removeEventListener(o,this._onInteraction,B4)}configureRipple(t,o){t.setAttribute(PU,""),(o.className||!t.hasAttribute(MU))&&t.setAttribute(MU,o.className||""),o.centered&&t.setAttribute(H4,""),o.disabled&&t.setAttribute(pM,"")}getRipple(t){return this._hosts.get(t)||this._createRipple(t)}setDisabled(t,o){const c=this._hosts.get(t);c?c.disabled=o:o?t.setAttribute(pM,""):t.removeAttribute(pM)}_createRipple(t){if(!this._document)return;const o=this._hosts.get(t);if(o)return o;t.querySelector(".mat-ripple")?.remove();const c=this._document.createElement("span");c.classList.add("mat-ripple",t.getAttribute(MU)),t.append(c);const u=new V4(new tn(c),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return u._isInitialized=!0,u.trigger=t,u.centered=t.hasAttribute(H4),u.disabled=t.hasAttribute(pM),this.attachRipple(t,u),u}attachRipple(t,o){t.removeAttribute(PU),this._hosts.set(t,o)}destroyRipple(t){const o=this._hosts.get(t);o&&(o.ngOnDestroy(),this._hosts.delete(t))}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),PW=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Br({type:e,selectors:[["div","mat-internal-form-field",""]],hostAttrs:[1,"mdc-form-field","mat-internal-form-field"],hostVars:2,hostBindings:function(o,c){2&o&&Ht("mdc-form-field--align-end","before"===c.labelPosition)},inputs:{labelPosition:"labelPosition"},standalone:!0,features:[Hc],attrs:gW,ngContentSelectors:_W,decls:1,vars:0,template:function(o,c){1&o&&(Mo(),xi(0))},styles:[".mdc-form-field{display:inline-flex;align-items:center;vertical-align:middle}.mdc-form-field[hidden]{display:none}.mdc-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{margin-left:auto;margin-right:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{padding-left:0;padding-right:4px}.mdc-form-field--nowrap>label{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{margin-left:0;margin-right:auto}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{padding-left:4px;padding-right:0}.mdc-form-field--space-between{justify-content:space-between}.mdc-form-field--space-between>label{margin:0}[dir=rtl] .mdc-form-field--space-between>label,.mdc-form-field--space-between>label[dir=rtl]{margin:0}.mdc-form-field{font-family:var(--mdc-form-field-label-text-font);line-height:var(--mdc-form-field-label-text-line-height);font-size:var(--mdc-form-field-label-text-size);font-weight:var(--mdc-form-field-label-text-weight);letter-spacing:var(--mdc-form-field-label-text-tracking);color:var(--mdc-form-field-label-text-color)}.mat-internal-form-field{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}"],encapsulation:2,changeDetection:0})}return e})();const MW=["mat-button",""],xW=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],kW=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"],LW=new De("MAT_BUTTON_CONFIG"),FW=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}];let UW=(()=>{class e{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(t){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,t)}get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=t,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(t){this._disabled=t,this._updateRippleDisabled()}constructor(t,o,c,u){this._elementRef=t,this._platform=o,this._ngZone=c,this._animationMode=u,this._focusMonitor=Te(DU),this._rippleLoader=Te(NW),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;const f=Te(LW,{optional:!0}),g=t.nativeElement,E=g.classList;this.disabledInteractive=f?.disabledInteractive??!1,this._rippleLoader?.configureRipple(g,{className:"mat-mdc-button-ripple"});for(const{attribute:C,mdcClasses:R}of FW)g.hasAttribute(C)&&E.add(...R)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(t="program",o){t?this._focusMonitor.focusVia(this._elementRef.nativeElement,t,o):this._elementRef.nativeElement.focus(o)}_getAriaDisabled(){return null!=this.ariaDisabled?this.ariaDisabled:!(!this.disabled||!this.disabledInteractive)||null}_getDisabledAttribute(){return!(this.disabledInteractive||!this.disabled)||null}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}static#e=this.\u0275fac=function(o){Mh()};static#t=this.\u0275dir=Ye({type:e,inputs:{color:"color",disableRipple:[Xe.HasDecoratorInputTransform,"disableRipple","disableRipple",fo],disabled:[Xe.HasDecoratorInputTransform,"disabled","disabled",fo],ariaDisabled:[Xe.HasDecoratorInputTransform,"aria-disabled","ariaDisabled",fo],disabledInteractive:[Xe.HasDecoratorInputTransform,"disabledInteractive","disabledInteractive",fo]},features:[Pi]})}return e})(),VW=(()=>{class e extends UW{constructor(t,o,c,u){super(t,o,c,u)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(tn),ae(Eo),ae(it),ae(bc,8))};static#t=this.\u0275cmp=Br({type:e,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(o,c){2&o&&(Ji("disabled",c._getDisabledAttribute())("aria-disabled",c._getAriaDisabled()),mm(c.color?"mat-"+c.color:""),Ht("mat-mdc-button-disabled",c.disabled)("mat-mdc-button-disabled-interactive",c.disabledInteractive)("_mat-animation-noopable","NoopAnimations"===c._animationMode)("mat-unthemed",!c.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Nt,Hc],attrs:MW,ngContentSelectors:kW,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(o,c){1&o&&(Mo(xW),ce(0,"span",0),xi(1),oe(2,"span",1),xi(3,1),Ee(),xi(4,2),ce(5,"span",2)(6,"span",3)),2&o&&Ht("mdc-button__ripple",!c._isFab)("mdc-fab__ripple",c._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px);display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{font-family:var(--mdc-text-button-label-text-font);font-size:var(--mdc-text-button-label-text-size);letter-spacing:var(--mdc-text-button-label-text-tracking);font-weight:var(--mdc-text-button-label-text-weight);text-transform:var(--mdc-text-button-label-text-transform);height:var(--mdc-text-button-container-height);border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color)}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color)}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity)}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity)}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity)}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{font-family:var(--mdc-filled-button-label-text-font);font-size:var(--mdc-filled-button-label-text-size);letter-spacing:var(--mdc-filled-button-label-text-tracking);font-weight:var(--mdc-filled-button-label-text-weight);text-transform:var(--mdc-filled-button-label-text-transform);height:var(--mdc-filled-button-container-height);border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color)}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color)}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity)}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity)}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity)}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{font-family:var(--mdc-protected-button-label-text-font);font-size:var(--mdc-protected-button-label-text-size);letter-spacing:var(--mdc-protected-button-label-text-tracking);font-weight:var(--mdc-protected-button-label-text-weight);text-transform:var(--mdc-protected-button-label-text-transform);height:var(--mdc-protected-button-container-height);border-radius:var(--mdc-protected-button-container-shape);box-shadow:var(--mdc-protected-button-container-elevation-shadow)}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color)}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color)}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color)}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity)}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity)}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity)}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow)}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow)}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow)}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow)}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{font-family:var(--mdc-outlined-button-label-text-font);font-size:var(--mdc-outlined-button-label-text-size);letter-spacing:var(--mdc-outlined-button-label-text-tracking);font-weight:var(--mdc-outlined-button-label-text-weight);text-transform:var(--mdc-outlined-button-label-text-transform);height:var(--mdc-outlined-button-container-height);border-radius:var(--mdc-outlined-button-container-shape);padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color)}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape)}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color)}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width))}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color)}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity)}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity)}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity)}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button-base{text-decoration:none}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button .mat-mdc-button-touch-target,.mat-mdc-unelevated-button .mat-mdc-button-touch-target,.mat-mdc-raised-button .mat-mdc-button-touch-target,.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}[dir=rtl] .mat-mdc-button>.mat-icon,.mat-mdc-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}.mat-mdc-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon,.mat-mdc-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:0;margin-right:8px}.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem;margin-left:-4px;margin-right:8px}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:0}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon,[dir=rtl] .mat-mdc-raised-button>.mat-icon,[dir=rtl] .mat-mdc-outlined-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon[dir=rtl],.mat-mdc-raised-button>.mat-icon[dir=rtl],.mat-mdc-outlined-button>.mat-icon[dir=rtl]{margin-left:8px;margin-right:-4px}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon,.mat-mdc-raised-button .mdc-button__label+.mat-icon,.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-left:8px;margin-right:-4px}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon,[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon,.mat-mdc-unelevated-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-raised-button .mdc-button__label+.mat-icon[dir=rtl],.mat-mdc-outlined-button .mdc-button__label+.mat-icon[dir=rtl]{margin-left:-4px;margin-right:8px}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0})}return e})(),jW=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({imports:[tc,OW,tc]})}return e})();const G4=vb({passive:!0});let HW=(()=>{class e{constructor(t,o){this._platform=t,this._ngZone=o,this._monitoredElements=new Map}monitor(t){if(!this._platform.isBrowser)return Zc;const o=Vp(t),c=this._monitoredElements.get(o);if(c)return c.subject;const u=new en,f="cdk-text-field-autofilled",g=E=>{"cdk-text-field-autofill-start"!==E.animationName||o.classList.contains(f)?"cdk-text-field-autofill-end"===E.animationName&&o.classList.contains(f)&&(o.classList.remove(f),this._ngZone.run(()=>u.next({target:E.target,isAutofilled:!1}))):(o.classList.add(f),this._ngZone.run(()=>u.next({target:E.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{o.addEventListener("animationstart",g,G4),o.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(o,{subject:u,unlisten:()=>{o.removeEventListener("animationstart",g,G4)}}),u}stopMonitoring(t){const o=Vp(t),c=this._monitoredElements.get(o);c&&(c.unlisten(),c.subject.complete(),o.classList.remove("cdk-text-field-autofill-monitored"),o.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(o))}ngOnDestroy(){this._monitoredElements.forEach((t,o)=>this.stopMonitoring(o))}static#e=this.\u0275fac=function(o){return new(o||e)(be(Eo),be(it))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),GW=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({})}return e})();function W4(...e){const n=nI(e),t=function w8(e,n){return"number"==typeof eU(e)?e.pop():n}(e,1/0),o=e;return o.length?1===o.length?Wo(o[0]):yb(t)(Ur(o,n)):Zc}class WW extends en{constructor(n=1/0,t=1/0,o=IU){super(),this._bufferSize=n,this._windowTime=t,this._timestampProvider=o,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,n),this._windowTime=Math.max(1,t)}next(n){const{isStopped:t,_buffer:o,_infiniteTimeWindow:c,_timestampProvider:u,_windowTime:f}=this;t||(o.push(n),!c&&o.push(u.now()+f)),this._trimBuffer(),super.next(n)}_subscribe(n){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(n),{_infiniteTimeWindow:o,_buffer:c}=this,u=c.slice();for(let f=0;f<u.length&&!n.closed;f+=o?1:2)n.next(u[f]);return this._checkFinalizedStatuses(n),t}_trimBuffer(){const{_bufferSize:n,_timestampProvider:t,_buffer:o,_infiniteTimeWindow:c}=this,u=(c?1:2)*n;if(n<1/0&&u<o.length&&o.splice(0,o.length-u),!c){const f=t.now();let g=0;for(let E=1;E<o.length&&o[E]<=f;E+=2)g=E;g&&o.splice(0,g+1)}}}function xU(e,n,...t){if(!0===n)return void e();if(!1===n)return;const o=new zu({next:()=>{o.unsubscribe(),e()}});return Wo(n(...t)).subscribe(o)}class qW{constructor(n){this._box=n,this._destroyed=new en,this._resizeSubject=new en,this._elementObservables=new Map,typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(t=>this._resizeSubject.next(t)))}observe(n){return this._elementObservables.has(n)||this._elementObservables.set(n,new Wn(t=>{const o=this._resizeSubject.subscribe(t);return this._resizeObserver?.observe(n,{box:this._box}),()=>{this._resizeObserver?.unobserve(n),o.unsubscribe(),this._elementObservables.delete(n)}}).pipe(Ea(t=>t.some(o=>o.target===n)),function KW(e,n,t){let o,c=!1;return e&&"object"==typeof e?({bufferSize:o=1/0,windowTime:n=1/0,refCount:c=!1,scheduler:t}=e):o=e??1/0,function zW(e={}){const{connector:n=(()=>new en),resetOnError:t=!0,resetOnComplete:o=!0,resetOnRefCountZero:c=!0}=e;return u=>{let f,g,E,C=0,R=!1,P=!1;const B=()=>{g?.unsubscribe(),g=void 0},G=()=>{B(),f=E=void 0,R=P=!1},Y=()=>{const J=f;G(),J?.unsubscribe()};return fi((J,le)=>{C++,!P&&!R&&B();const ge=E=E??n();le.add(()=>{C--,0===C&&!P&&!R&&(g=xU(Y,c))}),ge.subscribe(le),!f&&C>0&&(f=new zu({next:de=>ge.next(de),error:de=>{P=!0,B(),g=xU(G,t,de),ge.error(de)},complete:()=>{R=!0,B(),g=xU(G,o),ge.complete()}}),Wo(J).subscribe(f))})(u)}}({connector:()=>new WW(o,n,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:c})}({bufferSize:1,refCount:!0}),zo(this._destroyed))),this._elementObservables.get(n)}destroy(){this._destroyed.next(),this._destroyed.complete(),this._resizeSubject.complete(),this._elementObservables.clear()}}let YW=(()=>{class e{constructor(){this._observers=new Map,this._ngZone=Te(it)}ngOnDestroy(){for(const[,t]of this._observers)t.destroy();this._observers.clear()}observe(t,o){const c=o?.box||"content-box";return this._observers.has(c)||this._observers.set(c,new qW(c)),this._observers.get(c).observe(t)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var bt=function(e){return e[e.State=0]="State",e[e.Transition=1]="Transition",e[e.Sequence=2]="Sequence",e[e.Group=3]="Group",e[e.Animate=4]="Animate",e[e.Keyframes=5]="Keyframes",e[e.Style=6]="Style",e[e.Trigger=7]="Trigger",e[e.Reference=8]="Reference",e[e.AnimateChild=9]="AnimateChild",e[e.AnimateRef=10]="AnimateRef",e[e.Query=11]="Query",e[e.Stagger=12]="Stagger",e}(bt||{});const Lu="*";function kU(e,n){return{type:bt.Trigger,name:e,definitions:n,options:{}}}function _I(e,n=null){return{type:bt.Animate,styles:n,timings:e}}function sl(e){return{type:bt.Style,styles:e,offset:null}}function LU(e,n,t){return{type:bt.State,name:e,styles:n,options:t}}function EI(e,n,t=null){return{type:bt.Transition,expr:e,animation:n,options:t}}class vI{constructor(n=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=n+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}onStart(n){this._originalOnStartFns.push(n),this._onStartFns.push(n)}onDone(n){this._originalOnDoneFns.push(n),this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(n=>n()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(n){this._position=this.totalTime?n*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(n){const t="start"==n?this._onStartFns:this._onDoneFns;t.forEach(o=>o()),t.length=0}}class z4{constructor(n){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=n;let t=0,o=0,c=0;const u=this.players.length;0==u?queueMicrotask(()=>this._onFinish()):this.players.forEach(f=>{f.onDone(()=>{++t==u&&this._onFinish()}),f.onDestroy(()=>{++o==u&&this._onDestroy()}),f.onStart(()=>{++c==u&&this._onStart()})}),this.totalTime=this.players.reduce((f,g)=>Math.max(f,g.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}init(){this.players.forEach(n=>n.init())}onStart(n){this._onStartFns.push(n)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(n=>n()),this._onStartFns=[])}onDone(n){this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(n=>n.play())}pause(){this.players.forEach(n=>n.pause())}restart(){this.players.forEach(n=>n.restart())}finish(){this._onFinish(),this.players.forEach(n=>n.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(n=>n.destroy()),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}reset(){this.players.forEach(n=>n.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(n){const t=n*this.totalTime;this.players.forEach(o=>{const c=o.totalTime?Math.min(1,t/o.totalTime):1;o.setPosition(c)})}getPosition(){const n=this.players.reduce((t,o)=>null===t||o.totalTime>t.totalTime?o:t,null);return null!=n?n.getPosition():0}beforeDestroy(){this.players.forEach(n=>{n.beforeDestroy&&n.beforeDestroy()})}triggerCallback(n){const t="start"==n?this._onStartFns:this._onDoneFns;t.forEach(o=>o()),t.length=0}}const ZW=["notch"],e9=["matFormFieldNotchedOutline",""],t9=["*"],n9=["textField"],i9=["iconPrefixContainer"],r9=["textPrefixContainer"];function o9(e,n){1&e&&ce(0,"span",16)}function s9(e,n){if(1&e&&(oe(0,"label",14),xi(1,1),Tn(2,o9,1,0,"span",15),Ee()),2&e){const t=_n(2);Ze("floating",t._shouldLabelFloat())("monitorResize",t._hasOutline())("id",t._labelId),Ji("for",t._control.id),Qe(2),we(2,!t.hideRequiredMarker&&t._control.required?2:-1)}}function a9(e,n){1&e&&Tn(0,s9,3,5,"label",14),2&e&&we(0,_n()._hasFloatingLabel()?0:-1)}function c9(e,n){1&e&&ce(0,"div",17)}function d9(e,n){}function l9(e,n){1&e&&Tn(0,d9,0,0,"ng-template",9),2&e&&(_n(2),Ze("ngTemplateOutlet",Mm(1)))}function u9(e,n){if(1&e&&(oe(0,"div",5),Tn(1,l9,1,1,null,9),Ee()),2&e){const t=_n();Ze("matFormFieldNotchedOutlineOpen",t._shouldLabelFloat()),Qe(),we(1,t._forceDisplayInfixLabel()?-1:1)}}function h9(e,n){1&e&&(oe(0,"div",18,19),xi(2,2),Ee())}function p9(e,n){1&e&&(oe(0,"div",20,21),xi(2,3),Ee())}function f9(e,n){}function m9(e,n){1&e&&Tn(0,f9,0,0,"ng-template",9),2&e&&(_n(),Ze("ngTemplateOutlet",Mm(1)))}function g9(e,n){1&e&&(oe(0,"div",22),xi(1,4),Ee())}function _9(e,n){1&e&&(oe(0,"div",23),xi(1,5),Ee())}function E9(e,n){1&e&&ce(0,"div",12)}function v9(e,n){1&e&&(oe(0,"div",24),xi(1,6),Ee()),2&e&&Ze("@transitionMessages",_n()._subscriptAnimationState)}function b9(e,n){if(1&e&&(oe(0,"mat-hint",26),br(1),Ee()),2&e){const t=_n(2);Ze("id",t._hintLabelId),Qe(),cu(t.hintLabel)}}function y9(e,n){if(1&e&&(oe(0,"div",25),Tn(1,b9,2,2,"mat-hint",26),xi(2,7),ce(3,"div",27),xi(4,8),Ee()),2&e){const t=_n();Ze("@transitionMessages",t._subscriptAnimationState),Qe(),we(1,t.hintLabel?1:-1)}}const C9=["*",[["mat-label"]],[["","matPrefix",""],["","matIconPrefix",""]],[["","matTextPrefix",""]],[["","matTextSuffix",""]],[["","matSuffix",""],["","matIconSuffix",""]],[["mat-error"],["","matError",""]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],S9=["*","mat-label","[matPrefix], [matIconPrefix]","[matTextPrefix]","[matTextSuffix]","[matSuffix], [matIconSuffix]","mat-error, [matError]","mat-hint:not([align='end'])","mat-hint[align='end']"];let UU=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ye({type:e,selectors:[["mat-label"]],standalone:!0})}return e})();const T9=new De("MatError");let I9=0,K4=(()=>{class e{constructor(){this.align="start",this.id="mat-mdc-hint-"+I9++}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ye({type:e,selectors:[["mat-hint"]],hostAttrs:[1,"mat-mdc-form-field-hint","mat-mdc-form-field-bottom-align"],hostVars:4,hostBindings:function(o,c){2&o&&(vm("id",c.id),Ji("align",null),Ht("mat-mdc-form-field-hint-end","end"===c.align))},inputs:{align:"align",id:"id"},standalone:!0})}return e})();const w9=new De("MatPrefix"),R9=new De("MatSuffix"),q4=new De("FloatingLabelParent");let Y4=(()=>{class e{get floating(){return this._floating}set floating(t){this._floating=t,this.monitorResize&&this._handleResize()}get monitorResize(){return this._monitorResize}set monitorResize(t){this._monitorResize=t,this._monitorResize?this._subscribeToResize():this._resizeSubscription.unsubscribe()}constructor(t){this._elementRef=t,this._floating=!1,this._monitorResize=!1,this._resizeObserver=Te(YW),this._ngZone=Te(it),this._parent=Te(q4),this._resizeSubscription=new Ki}ngOnDestroy(){this._resizeSubscription.unsubscribe()}getWidth(){return function A9(e){if(null!==e.offsetParent)return e.scrollWidth;const t=e.cloneNode(!0);t.style.setProperty("position","absolute"),t.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(t);const o=t.scrollWidth;return t.remove(),o}(this._elementRef.nativeElement)}get element(){return this._elementRef.nativeElement}_handleResize(){setTimeout(()=>this._parent._handleLabelResized())}_subscribeToResize(){this._resizeSubscription.unsubscribe(),this._ngZone.runOutsideAngular(()=>{this._resizeSubscription=this._resizeObserver.observe(this._elementRef.nativeElement,{box:"border-box"}).subscribe(()=>this._handleResize())})}static#e=this.\u0275fac=function(o){return new(o||e)(ae(tn))};static#t=this.\u0275dir=Ye({type:e,selectors:[["label","matFormFieldFloatingLabel",""]],hostAttrs:[1,"mdc-floating-label","mat-mdc-floating-label"],hostVars:2,hostBindings:function(o,c){2&o&&Ht("mdc-floating-label--float-above",c.floating)},inputs:{floating:"floating",monitorResize:"monitorResize"},standalone:!0})}return e})();const $4="mdc-line-ripple--active",fM="mdc-line-ripple--deactivating";let X4=(()=>{class e{constructor(t,o){this._elementRef=t,this._handleTransitionEnd=c=>{const u=this._elementRef.nativeElement.classList,f=u.contains(fM);"opacity"===c.propertyName&&f&&u.remove($4,fM)},o.runOutsideAngular(()=>{t.nativeElement.addEventListener("transitionend",this._handleTransitionEnd)})}activate(){const t=this._elementRef.nativeElement.classList;t.remove(fM),t.add($4)}deactivate(){this._elementRef.nativeElement.classList.add(fM)}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._handleTransitionEnd)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(tn),ae(it))};static#t=this.\u0275dir=Ye({type:e,selectors:[["div","matFormFieldLineRipple",""]],hostAttrs:[1,"mdc-line-ripple"],standalone:!0})}return e})(),J4=(()=>{class e{constructor(t,o){this._elementRef=t,this._ngZone=o,this.open=!1}ngAfterViewInit(){const t=this._elementRef.nativeElement.querySelector(".mdc-floating-label");t?(this._elementRef.nativeElement.classList.add("mdc-notched-outline--upgraded"),"function"==typeof requestAnimationFrame&&(t.style.transitionDuration="0s",this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>t.style.transitionDuration="")}))):this._elementRef.nativeElement.classList.add("mdc-notched-outline--no-label")}_setNotchWidth(t){this._notch.nativeElement.style.width=this.open&&t?`calc(${t}px * var(--mat-mdc-form-field-floating-label-scale, 0.75) + 9px)`:""}static#e=this.\u0275fac=function(o){return new(o||e)(ae(tn),ae(it))};static#t=this.\u0275cmp=Br({type:e,selectors:[["div","matFormFieldNotchedOutline",""]],viewQuery:function(o,c){if(1&o&&ha(ZW,5),2&o){let u;Zi(u=ar())&&(c._notch=u.first)}},hostAttrs:[1,"mdc-notched-outline"],hostVars:2,hostBindings:function(o,c){2&o&&Ht("mdc-notched-outline--notched",c.open)},inputs:{open:[Xe.None,"matFormFieldNotchedOutlineOpen","open"]},standalone:!0,features:[Hc],attrs:e9,ngContentSelectors:t9,decls:5,vars:0,consts:[[1,"mdc-notched-outline__leading"],[1,"mdc-notched-outline__notch"],["notch",""],[1,"mdc-notched-outline__trailing"]],template:function(o,c){1&o&&(Mo(),ce(0,"div",0),oe(1,"div",1,2),xi(3),Ee(),ce(4,"div",3))},encapsulation:2,changeDetection:0})}return e})();const D9={transitionMessages:kU("transitionMessages",[LU("enter",sl({opacity:1,transform:"translateY(0%)"})),EI("void => enter",[sl({opacity:0,transform:"translateY(-5px)"}),_I("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])};let Q4=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ye({type:e})}return e})();const Z4=new De("MatFormField"),O9=new De("MAT_FORM_FIELD_DEFAULT_OPTIONS");let e5=0,M9=(()=>{class e{get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(t){this._hideRequiredMarker=bb(t)}get floatLabel(){return this._floatLabel||this._defaults?.floatLabel||"auto"}set floatLabel(t){t!==this._floatLabel&&(this._floatLabel=t,this._changeDetectorRef.markForCheck())}get appearance(){return this._appearance}set appearance(t){const o=this._appearance;this._appearance=t||this._defaults?.appearance||"fill","outline"===this._appearance&&this._appearance!==o&&(this._needsOutlineLabelOffsetUpdateOnStable=!0)}get subscriptSizing(){return this._subscriptSizing||this._defaults?.subscriptSizing||"fixed"}set subscriptSizing(t){this._subscriptSizing=t||this._defaults?.subscriptSizing||"fixed"}get hintLabel(){return this._hintLabel}set hintLabel(t){this._hintLabel=t,this._processHints()}get _control(){return this._explicitFormFieldControl||this._formFieldControl}set _control(t){this._explicitFormFieldControl=t}constructor(t,o,c,u,f,g,E,C){this._elementRef=t,this._changeDetectorRef=o,this._ngZone=c,this._dir=u,this._platform=f,this._defaults=g,this._animationMode=E,this._hideRequiredMarker=!1,this.color="primary",this._appearance="fill",this._subscriptSizing=null,this._hintLabel="",this._hasIconPrefix=!1,this._hasTextPrefix=!1,this._hasIconSuffix=!1,this._hasTextSuffix=!1,this._labelId="mat-mdc-form-field-label-"+e5++,this._hintLabelId="mat-mdc-hint-"+e5++,this._subscriptAnimationState="",this._destroyed=new en,this._isFocused=null,this._needsOutlineLabelOffsetUpdateOnStable=!1,g&&(g.appearance&&(this.appearance=g.appearance),this._hideRequiredMarker=!!g?.hideRequiredMarker,g.color&&(this.color=g.color))}ngAfterViewInit(){this._updateFocusState(),this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngAfterContentInit(){this._assertFormFieldControl(),this._initializeControl(),this._initializeSubscript(),this._initializePrefixAndSuffix(),this._initializeOutlineLabelOffsetSubscriptions()}ngAfterContentChecked(){this._assertFormFieldControl()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._textField||this._elementRef}_animateAndLockLabel(){this._hasFloatingLabel()&&(this.floatLabel="always")}_initializeControl(){const t=this._control;t.controlType&&this._elementRef.nativeElement.classList.add(`mat-mdc-form-field-type-${t.controlType}`),t.stateChanges.subscribe(()=>{this._updateFocusState(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),t.ngControl&&t.ngControl.valueChanges&&t.ngControl.valueChanges.pipe(zo(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck())}_checkPrefixAndSuffixTypes(){this._hasIconPrefix=!!this._prefixChildren.find(t=>!t._isText),this._hasTextPrefix=!!this._prefixChildren.find(t=>t._isText),this._hasIconSuffix=!!this._suffixChildren.find(t=>!t._isText),this._hasTextSuffix=!!this._suffixChildren.find(t=>t._isText)}_initializePrefixAndSuffix(){this._checkPrefixAndSuffixTypes(),W4(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._checkPrefixAndSuffixTypes(),this._changeDetectorRef.markForCheck()})}_initializeSubscript(){this._hintChildren.changes.subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._validateHints(),this._syncDescribedByIds()}_assertFormFieldControl(){}_updateFocusState(){this._control.focused&&!this._isFocused?(this._isFocused=!0,this._lineRipple?.activate()):!this._control.focused&&(this._isFocused||null===this._isFocused)&&(this._isFocused=!1,this._lineRipple?.deactivate()),this._textField?.nativeElement.classList.toggle("mdc-text-field--focused",this._control.focused)}_initializeOutlineLabelOffsetSubscriptions(){this._prefixChildren.changes.subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(zo(this._destroyed)).subscribe(()=>{this._needsOutlineLabelOffsetUpdateOnStable&&(this._needsOutlineLabelOffsetUpdateOnStable=!1,this._updateOutlineLabelOffset())})}),this._dir.change.pipe(zo(this._destroyed)).subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0)}_shouldAlwaysFloat(){return"always"===this.floatLabel}_hasOutline(){return"outline"===this.appearance}_forceDisplayInfixLabel(){return!this._platform.isBrowser&&this._prefixChildren.length&&!this._shouldLabelFloat()}_hasFloatingLabel(){return!!this._labelChildNonStatic||!!this._labelChildStatic}_shouldLabelFloat(){return this._control.shouldLabelFloat||this._shouldAlwaysFloat()}_shouldForward(t){const o=this._control?this._control.ngControl:null;return o&&o[t]}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_handleLabelResized(){this._refreshOutlineNotchWidth()}_refreshOutlineNotchWidth(){this._hasOutline()&&this._floatingLabel&&this._shouldLabelFloat()?this._notchedOutline?._setNotchWidth(this._floatingLabel.getWidth()):this._notchedOutline?._setNotchWidth(0)}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){}_syncDescribedByIds(){if(this._control){let t=[];if(this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&t.push(...this._control.userAriaDescribedBy.split(" ")),"hint"===this._getDisplayedMessages()){const o=this._hintChildren?this._hintChildren.find(u=>"start"===u.align):null,c=this._hintChildren?this._hintChildren.find(u=>"end"===u.align):null;o?t.push(o.id):this._hintLabel&&t.push(this._hintLabelId),c&&t.push(c.id)}else this._errorChildren&&t.push(...this._errorChildren.map(o=>o.id));this._control.setDescribedByIds(t)}}_updateOutlineLabelOffset(){if(!this._platform.isBrowser||!this._hasOutline()||!this._floatingLabel)return;const t=this._floatingLabel.element;if(!this._iconPrefixContainer&&!this._textPrefixContainer)return void(t.style.transform="");if(!this._isAttachedToDom())return void(this._needsOutlineLabelOffsetUpdateOnStable=!0);const o=this._iconPrefixContainer?.nativeElement,c=this._textPrefixContainer?.nativeElement,u=o?.getBoundingClientRect().width??0,f=c?.getBoundingClientRect().width??0;t.style.transform=`var(\n        --mat-mdc-form-field-label-transform,\n        translateY(-50%) translateX(calc(${"rtl"===this._dir.value?"-1":"1"} * (${u+f}px + var(--mat-mdc-form-field-label-offset-x, 0px))))\n    )`}_isAttachedToDom(){const t=this._elementRef.nativeElement;if(t.getRootNode){const o=t.getRootNode();return o&&o!==t}return document.documentElement.contains(t)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(tn),ae(Us),ae(it),ae(NU),ae(Eo),ae(O9,8),ae(bc,8),ae(sn))};static#t=this.\u0275cmp=Br({type:e,selectors:[["mat-form-field"]],contentQueries:function(o,c,u){if(1&o&&(ua(u,UU,5),ua(u,UU,7),ua(u,Q4,5),ua(u,w9,5),ua(u,R9,5),ua(u,T9,5),ua(u,K4,5)),2&o){let f;Zi(f=ar())&&(c._labelChildNonStatic=f.first),Zi(f=ar())&&(c._labelChildStatic=f.first),Zi(f=ar())&&(c._formFieldControl=f.first),Zi(f=ar())&&(c._prefixChildren=f),Zi(f=ar())&&(c._suffixChildren=f),Zi(f=ar())&&(c._errorChildren=f),Zi(f=ar())&&(c._hintChildren=f)}},viewQuery:function(o,c){if(1&o&&(ha(n9,5),ha(i9,5),ha(r9,5),ha(Y4,5),ha(J4,5),ha(X4,5)),2&o){let u;Zi(u=ar())&&(c._textField=u.first),Zi(u=ar())&&(c._iconPrefixContainer=u.first),Zi(u=ar())&&(c._textPrefixContainer=u.first),Zi(u=ar())&&(c._floatingLabel=u.first),Zi(u=ar())&&(c._notchedOutline=u.first),Zi(u=ar())&&(c._lineRipple=u.first)}},hostAttrs:[1,"mat-mdc-form-field"],hostVars:42,hostBindings:function(o,c){2&o&&Ht("mat-mdc-form-field-label-always-float",c._shouldAlwaysFloat())("mat-mdc-form-field-has-icon-prefix",c._hasIconPrefix)("mat-mdc-form-field-has-icon-suffix",c._hasIconSuffix)("mat-form-field-invalid",c._control.errorState)("mat-form-field-disabled",c._control.disabled)("mat-form-field-autofilled",c._control.autofilled)("mat-form-field-no-animations","NoopAnimations"===c._animationMode)("mat-form-field-appearance-fill","fill"==c.appearance)("mat-form-field-appearance-outline","outline"==c.appearance)("mat-form-field-hide-placeholder",c._hasFloatingLabel()&&!c._shouldLabelFloat())("mat-focused",c._control.focused)("mat-primary","accent"!==c.color&&"warn"!==c.color)("mat-accent","accent"===c.color)("mat-warn","warn"===c.color)("ng-untouched",c._shouldForward("untouched"))("ng-touched",c._shouldForward("touched"))("ng-pristine",c._shouldForward("pristine"))("ng-dirty",c._shouldForward("dirty"))("ng-valid",c._shouldForward("valid"))("ng-invalid",c._shouldForward("invalid"))("ng-pending",c._shouldForward("pending"))},inputs:{hideRequiredMarker:"hideRequiredMarker",color:"color",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",hintLabel:"hintLabel"},exportAs:["matFormField"],standalone:!0,features:[wn([{provide:Z4,useExisting:e},{provide:q4,useExisting:e}]),Hc],ngContentSelectors:S9,decls:18,vars:21,consts:[["labelTemplate",""],[1,"mat-mdc-text-field-wrapper","mdc-text-field",3,"click"],["textField",""],["class","mat-mdc-form-field-focus-overlay"],[1,"mat-mdc-form-field-flex"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen"],["class","mat-mdc-form-field-icon-prefix"],["class","mat-mdc-form-field-text-prefix"],[1,"mat-mdc-form-field-infix"],[3,"ngTemplateOutlet"],["class","mat-mdc-form-field-text-suffix"],["class","mat-mdc-form-field-icon-suffix"],["matFormFieldLineRipple",""],[1,"mat-mdc-form-field-subscript-wrapper","mat-mdc-form-field-bottom-align"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id"],["aria-hidden","true","class","mat-mdc-form-field-required-marker mdc-floating-label--required"],["aria-hidden","true",1,"mat-mdc-form-field-required-marker","mdc-floating-label--required"],[1,"mat-mdc-form-field-focus-overlay"],[1,"mat-mdc-form-field-icon-prefix"],["iconPrefixContainer",""],[1,"mat-mdc-form-field-text-prefix"],["textPrefixContainer",""],[1,"mat-mdc-form-field-text-suffix"],[1,"mat-mdc-form-field-icon-suffix"],[1,"mat-mdc-form-field-error-wrapper"],[1,"mat-mdc-form-field-hint-wrapper"],[3,"id"],[1,"mat-mdc-form-field-hint-spacer"]],template:function(o,c){if(1&o&&(Mo(C9),Tn(0,a9,1,1,"ng-template",null,0,Ov),oe(2,"div",1,2),gn("click",function(f){return c._control.onContainerClick(f)}),Tn(4,c9,1,0,"div",3),oe(5,"div",4),Tn(6,u9,2,2,"div",5)(7,h9,3,0,"div",6)(8,p9,3,0,"div",7),oe(9,"div",8),Tn(10,m9,1,1,null,9),xi(11),Ee(),Tn(12,g9,2,0,"div",10)(13,_9,2,0,"div",11),Ee(),Tn(14,E9,1,0,"div",12),Ee(),oe(15,"div",13),Tn(16,v9,2,1)(17,y9,5,2),Ee()),2&o){let u;Qe(2),Ht("mdc-text-field--filled",!c._hasOutline())("mdc-text-field--outlined",c._hasOutline())("mdc-text-field--no-label",!c._hasFloatingLabel())("mdc-text-field--disabled",c._control.disabled)("mdc-text-field--invalid",c._control.errorState),Qe(2),we(4,c._hasOutline()||c._control.disabled?-1:4),Qe(2),we(6,c._hasOutline()?6:-1),Qe(),we(7,c._hasIconPrefix?7:-1),Qe(),we(8,c._hasTextPrefix?8:-1),Qe(2),we(10,!c._hasOutline()||c._forceDisplayInfixLabel()?10:-1),Qe(2),we(12,c._hasTextSuffix?12:-1),Qe(),we(13,c._hasIconSuffix?13:-1),Qe(),we(14,c._hasOutline()?-1:14),Qe(),Ht("mat-mdc-form-field-subscript-dynamic-size","dynamic"===c.subscriptSizing),Qe(),we(16,"error"===(u=c._getDisplayedMessages())?16:"hint"===u?17:-1)}},dependencies:[Y4,J4,H0,X4,K4],styles:['.mdc-text-field{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:0;border-bottom-left-radius:0;display:inline-flex;align-items:baseline;padding:0 16px;position:relative;box-sizing:border-box;overflow:hidden;will-change:opacity,transform,color}.mdc-text-field .mdc-floating-label{top:50%;transform:translateY(-50%);pointer-events:none}.mdc-text-field__input{height:28px;width:100%;min-width:0;border:none;border-radius:0;background:none;appearance:none;padding:0}.mdc-text-field__input::-ms-clear{display:none}.mdc-text-field__input::-webkit-calendar-picker-indicator{display:none}.mdc-text-field__input:focus{outline:none}.mdc-text-field__input:invalid{box-shadow:none}@media all{.mdc-text-field__input::placeholder{opacity:0}}@media all{.mdc-text-field__input:-ms-input-placeholder{opacity:0}}@media all{.mdc-text-field--no-label .mdc-text-field__input::placeholder,.mdc-text-field--focused .mdc-text-field__input::placeholder{opacity:1}}@media all{.mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{opacity:1}}.mdc-text-field__affix{height:28px;opacity:0;white-space:nowrap}.mdc-text-field--label-floating .mdc-text-field__affix,.mdc-text-field--no-label .mdc-text-field__affix{opacity:1}@supports(-webkit-hyphens: none){.mdc-text-field--outlined .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field__affix--prefix,.mdc-text-field__affix--prefix[dir=rtl]{padding-left:2px;padding-right:0}.mdc-text-field--end-aligned .mdc-text-field__affix--prefix{padding-left:0;padding-right:12px}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--end-aligned .mdc-text-field__affix--prefix[dir=rtl]{padding-left:12px;padding-right:0}.mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field__affix--suffix,.mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:12px}.mdc-text-field--end-aligned .mdc-text-field__affix--suffix{padding-left:2px;padding-right:0}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--end-aligned .mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:2px}.mdc-text-field--filled{height:56px}.mdc-text-field--filled::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}.mdc-text-field--filled .mdc-floating-label{left:16px;right:initial}[dir=rtl] .mdc-text-field--filled .mdc-floating-label,.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:16px}.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{height:100%}.mdc-text-field--filled.mdc-text-field--no-label .mdc-floating-label{display:none}.mdc-text-field--filled.mdc-text-field--no-label::before{display:none}@supports(-webkit-hyphens: none){.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field--outlined{height:56px;overflow:visible}.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) scale(1)}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) scale(0.75)}.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--outlined .mdc-text-field__input{height:100%}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px,var(--mdc-shape-small, 4px))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px,var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px,var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px,var(--mdc-shape-small, 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px,var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:1px}.mdc-text-field--outlined .mdc-floating-label{left:4px;right:initial}[dir=rtl] .mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:4px}.mdc-text-field--outlined .mdc-text-field__input{display:flex;border:none !important;background-color:rgba(0,0,0,0)}.mdc-text-field--outlined .mdc-notched-outline{z-index:1}.mdc-text-field--textarea{flex-direction:column;align-items:center;width:auto;height:auto;padding:0}.mdc-text-field--textarea .mdc-floating-label{top:19px}.mdc-text-field--textarea .mdc-floating-label:not(.mdc-floating-label--float-above){transform:none}.mdc-text-field--textarea .mdc-text-field__input{flex-grow:1;height:auto;min-height:1.5rem;overflow-x:hidden;overflow-y:auto;box-sizing:border-box;resize:none;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--filled::before{display:none}.mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-10.25px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--filled .mdc-text-field__input{margin-top:23px;margin-bottom:9px}.mdc-text-field--textarea.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-27.25px) scale(1)}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-24.75px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label{top:18px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field__input{margin-bottom:2px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter{align-self:flex-end;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::after{display:inline-block;width:0;height:16px;content:"";vertical-align:-16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::before{display:none}.mdc-text-field__resizer{align-self:stretch;display:inline-flex;flex-direction:column;flex-grow:1;max-height:100%;max-width:100%;min-height:56px;min-width:fit-content;min-width:-moz-available;min-width:-webkit-fill-available;overflow:hidden;resize:both}.mdc-text-field--filled .mdc-text-field__resizer{transform:translateY(-1px)}.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateY(1px)}.mdc-text-field--outlined .mdc-text-field__resizer{transform:translateX(-1px) translateY(-1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer,.mdc-text-field--outlined .mdc-text-field__resizer[dir=rtl]{transform:translateX(1px) translateY(-1px)}.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateX(1px) translateY(1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input[dir=rtl],.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter[dir=rtl]{transform:translateX(-1px) translateY(1px)}.mdc-text-field--with-leading-icon{padding-left:0;padding-right:16px}[dir=rtl] .mdc-text-field--with-leading-icon,.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:16px;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 48px);left:48px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:48px}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 64px/0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label{left:36px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:36px}.mdc-text-field--with-leading-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) translateX(-32px) scale(1)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-37.25px) translateX(32px) scale(1)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) translateX(-32px) scale(0.75)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl],.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-34.75px) translateX(32px) scale(0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--with-trailing-icon{padding-left:16px;padding-right:0}[dir=rtl] .mdc-text-field--with-trailing-icon,.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0;padding-right:16px}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 64px)}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 64px/0.75)}.mdc-text-field--with-trailing-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 96px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 96px/0.75)}.mdc-text-field-helper-line{display:flex;justify-content:space-between;box-sizing:border-box}.mdc-text-field+.mdc-text-field-helper-line{padding-right:16px;padding-left:16px}.mdc-form-field>.mdc-text-field+label{align-self:flex-start}.mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--focused .mdc-notched-outline__trailing{border-width:2px}.mdc-text-field--focused+.mdc-text-field-helper-line .mdc-text-field-helper-text:not(.mdc-text-field-helper-text--validation-msg){opacity:1}.mdc-text-field--focused.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:2px}.mdc-text-field--focused.mdc-text-field--outlined.mdc-text-field--textarea .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--invalid+.mdc-text-field-helper-line .mdc-text-field-helper-text--validation-msg{opacity:1}.mdc-text-field--disabled{pointer-events:none}@media screen and (forced-colors: active){.mdc-text-field--disabled .mdc-text-field__input{background-color:Window}.mdc-text-field--disabled .mdc-floating-label{z-index:1}}.mdc-text-field--disabled .mdc-floating-label{cursor:default}.mdc-text-field--disabled.mdc-text-field--filled .mdc-text-field__ripple{display:none}.mdc-text-field--disabled .mdc-text-field__input{pointer-events:auto}.mdc-text-field--end-aligned .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--end-aligned .mdc-text-field__input[dir=rtl]{text-align:left}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix{direction:ltr}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--leading,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--leading{order:1}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{order:2}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input{order:3}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{order:4}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--trailing,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--trailing{order:5}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--prefix{padding-right:12px}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--suffix{padding-left:2px}.mdc-floating-label{position:absolute;left:0;-webkit-transform-origin:left top;transform-origin:left top;line-height:1.15rem;text-align:left;text-overflow:ellipsis;white-space:nowrap;cursor:text;overflow:hidden;will-change:transform}[dir=rtl] .mdc-floating-label,.mdc-floating-label[dir=rtl]{right:0;left:auto;-webkit-transform-origin:right top;transform-origin:right top;text-align:right}.mdc-floating-label--float-above{cursor:auto}.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:1px;margin-right:0px;content:"*"}[dir=rtl] .mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after,.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)[dir=rtl]::after{margin-left:0;margin-right:1px}.mdc-notched-outline{display:flex;position:absolute;top:0;right:0;left:0;box-sizing:border-box;width:100%;max-width:100%;height:100%;text-align:left;pointer-events:none}[dir=rtl] .mdc-notched-outline,.mdc-notched-outline[dir=rtl]{text-align:right}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{box-sizing:border-box;height:100%;pointer-events:none}.mdc-notched-outline__trailing{flex-grow:1}.mdc-notched-outline__notch{flex:0 0 auto;width:auto}.mdc-notched-outline .mdc-floating-label{display:inline-block;position:relative;max-width:100%}.mdc-notched-outline .mdc-floating-label--float-above{text-overflow:clip}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:133.3333333333%}.mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:0;padding-right:8px;border-top:none}[dir=rtl] .mdc-notched-outline--notched .mdc-notched-outline__notch,.mdc-notched-outline--notched .mdc-notched-outline__notch[dir=rtl]{padding-left:8px;padding-right:0}.mdc-notched-outline--no-label .mdc-notched-outline__notch{display:none}.mdc-line-ripple::before,.mdc-line-ripple::after{position:absolute;bottom:0;left:0;width:100%;border-bottom-style:solid;content:""}.mdc-line-ripple::before{z-index:1}.mdc-line-ripple::after{transform:scaleX(0);opacity:0;z-index:2}.mdc-line-ripple--active::after{transform:scaleX(1);opacity:1}.mdc-line-ripple--deactivating::after{opacity:0}.mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{border-top:1px solid;border-bottom:1px solid}.mdc-notched-outline__leading{border-left:1px solid;border-right:none;width:12px}[dir=rtl] .mdc-notched-outline__leading,.mdc-notched-outline__leading[dir=rtl]{border-left:none;border-right:1px solid}.mdc-notched-outline__trailing{border-left:none;border-right:1px solid}[dir=rtl] .mdc-notched-outline__trailing,.mdc-notched-outline__trailing[dir=rtl]{border-left:1px solid;border-right:none}.mdc-notched-outline__notch{max-width:calc(100% - 12px*2)}.mdc-line-ripple::before{border-bottom-width:1px}.mdc-line-ripple::after{border-bottom-width:2px}.mdc-text-field--filled{border-top-left-radius:var(--mdc-filled-text-field-container-shape);border-top-right-radius:var(--mdc-filled-text-field-container-shape);border-bottom-right-radius:0;border-bottom-left-radius:0}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-caret-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-error-caret-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-filled-text-field-input-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-filled-text-field-disabled-input-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-focus-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-hover-label-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-disabled-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-focus-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-hover-label-text-color)}.mdc-text-field--filled .mdc-floating-label{font-family:var(--mdc-filled-text-field-label-text-font);font-size:var(--mdc-filled-text-field-label-text-size);font-weight:var(--mdc-filled-text-field-label-text-weight);letter-spacing:var(--mdc-filled-text-field-label-text-tracking)}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}.mdc-text-field--filled:not(.mdc-text-field--disabled){background-color:var(--mdc-filled-text-field-container-color)}.mdc-text-field--filled.mdc-text-field--disabled{background-color:var(--mdc-filled-text-field-disabled-container-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-hover-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-focus-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-disabled-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-hover-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-error-focus-active-indicator-color)}.mdc-text-field--filled .mdc-line-ripple::before{border-bottom-width:var(--mdc-filled-text-field-active-indicator-height)}.mdc-text-field--filled .mdc-line-ripple::after{border-bottom-width:var(--mdc-filled-text-field-focus-active-indicator-height)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-caret-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-error-caret-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-outlined-text-field-input-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-outlined-text-field-disabled-input-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-focus-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-hover-label-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-disabled-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-focus-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-hover-label-text-color)}.mdc-text-field--outlined .mdc-floating-label{font-family:var(--mdc-outlined-text-field-label-text-font);font-size:var(--mdc-outlined-text-field-label-text-size);font-weight:var(--mdc-outlined-text-field-label-text-weight);letter-spacing:var(--mdc-outlined-text-field-label-text-tracking)}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(.75*var(--mdc-outlined-text-field-label-text-size))}.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mdc-outlined-text-field-label-text-size)}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px,var(--mdc-outlined-text-field-container-shape))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px,var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-hover-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-focus-outline-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-disabled-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-hover-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-focus-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-outline-width)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-focus-outline-width)}.mat-mdc-form-field-textarea-control{vertical-align:middle;resize:vertical;box-sizing:border-box;height:auto;margin:0;padding:0;border:none;overflow:auto}.mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:inherit;letter-spacing:inherit;text-decoration:inherit;text-transform:inherit;border:none}.mat-mdc-form-field .mat-mdc-floating-label.mdc-floating-label{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;line-height:normal;pointer-events:all}.mat-mdc-form-field:not(.mat-form-field-disabled) .mat-mdc-floating-label.mdc-floating-label{cursor:inherit}.mdc-text-field--no-label:not(.mdc-text-field--textarea) .mat-mdc-form-field-input-control.mdc-text-field__input,.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control{height:auto}.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control.mdc-text-field__input[type=color]{height:23px}.mat-mdc-text-field-wrapper{height:auto;flex:auto}.mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-left:0;--mat-mdc-form-field-label-offset-x: -16px}.mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-right:0}[dir=rtl] .mat-mdc-text-field-wrapper{padding-left:16px;padding-right:16px}[dir=rtl] .mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-left:0}[dir=rtl] .mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-right:0}.mat-form-field-disabled .mdc-text-field__input::placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-moz-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-webkit-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input:-ms-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-mdc-form-field-label-always-float .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms;opacity:1}.mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-floating-label{left:auto;right:auto}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-text-field__input{display:inline-block}.mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field .mdc-notched-outline__notch{padding-top:0}.mat-mdc-text-field-wrapper::before{content:none}.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:1px solid rgba(0,0,0,0)}[dir=rtl] .mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:none;border-right:1px solid rgba(0,0,0,0)}.mat-mdc-form-field-infix{min-height:var(--mat-form-field-container-height);padding-top:var(--mat-form-field-filled-with-label-container-padding-top);padding-bottom:var(--mat-form-field-filled-with-label-container-padding-bottom)}.mdc-text-field--outlined .mat-mdc-form-field-infix,.mdc-text-field--no-label .mat-mdc-form-field-infix{padding-top:var(--mat-form-field-container-vertical-padding);padding-bottom:var(--mat-form-field-container-vertical-padding)}.mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-floating-label{top:calc(var(--mat-form-field-container-height)/2)}.mdc-text-field--filled .mat-mdc-floating-label{display:var(--mat-form-field-filled-label-display, block)}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{--mat-mdc-form-field-label-transform: translateY(calc(calc(6.75px + var(--mat-form-field-container-height) / 2) * -1)) scale(var(--mat-mdc-form-field-floating-label-scale, 0.75));transform:var(--mat-mdc-form-field-label-transform)}.mat-mdc-form-field-subscript-wrapper{box-sizing:border-box;width:100%;position:relative}.mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-error-wrapper{position:absolute;top:0;left:0;right:0;padding:0 16px}.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-error-wrapper{position:static}.mat-mdc-form-field-bottom-align::before{content:"";display:inline-block;height:16px}.mat-mdc-form-field-bottom-align.mat-mdc-form-field-subscript-dynamic-size::before{content:unset}.mat-mdc-form-field-hint-end{order:1}.mat-mdc-form-field-hint-wrapper{display:flex}.mat-mdc-form-field-hint-spacer{flex:1 0 1em}.mat-mdc-form-field-error{display:block;color:var(--mat-form-field-error-text-color)}.mat-mdc-form-field-subscript-wrapper,.mat-mdc-form-field-bottom-align::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-subscript-text-font);line-height:var(--mat-form-field-subscript-text-line-height);font-size:var(--mat-form-field-subscript-text-size);letter-spacing:var(--mat-form-field-subscript-text-tracking);font-weight:var(--mat-form-field-subscript-text-weight)}.mat-mdc-form-field-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;opacity:0;pointer-events:none;background-color:var(--mat-form-field-state-layer-color)}.mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-hover-state-layer-opacity)}.mat-mdc-form-field.mat-focused .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-focus-state-layer-opacity)}select.mat-mdc-form-field-input-control{-moz-appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box}select.mat-mdc-form-field-input-control:not(:disabled){cursor:pointer}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option{color:var(--mat-form-field-select-option-text-color)}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option:disabled{color:var(--mat-form-field-select-disabled-option-text-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;right:0;top:50%;margin-top:-2.5px;pointer-events:none;color:var(--mat-form-field-enabled-select-arrow-color)}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{right:auto;left:0}.mat-mdc-form-field-type-mat-native-select.mat-focused .mat-mdc-form-field-infix::after{color:var(--mat-form-field-focus-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select.mat-form-field-disabled .mat-mdc-form-field-infix::after{color:var(--mat-form-field-disabled-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:15px}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:0;padding-left:15px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-mdc-text-field-wrapper{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-mdc-text-field-wrapper{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-mdc-text-field-wrapper{outline:dashed 3px}.cdk-high-contrast-active .mat-mdc-form-field.mat-focused .mdc-notched-outline{border:dashed 3px}.mat-mdc-form-field-input-control[type=date],.mat-mdc-form-field-input-control[type=datetime],.mat-mdc-form-field-input-control[type=datetime-local],.mat-mdc-form-field-input-control[type=month],.mat-mdc-form-field-input-control[type=week],.mat-mdc-form-field-input-control[type=time]{line-height:1}.mat-mdc-form-field-input-control::-webkit-datetime-edit{line-height:1;padding:0;margin-bottom:-2px}.mat-mdc-form-field{--mat-mdc-form-field-floating-label-scale: 0.75;display:inline-flex;flex-direction:column;min-width:0;text-align:left;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-container-text-font);line-height:var(--mat-form-field-container-text-line-height);font-size:var(--mat-form-field-container-text-size);letter-spacing:var(--mat-form-field-container-text-tracking);font-weight:var(--mat-form-field-container-text-weight)}[dir=rtl] .mat-mdc-form-field{text-align:right}.mat-mdc-form-field .mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(var(--mat-form-field-outlined-label-text-populated-size)*var(--mat-mdc-form-field-floating-label-scale))}.mat-mdc-form-field .mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mat-form-field-outlined-label-text-populated-size)}.mat-mdc-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-mdc-text-field-wrapper{width:100%}.mat-mdc-form-field-icon-prefix,.mat-mdc-form-field-icon-suffix{align-self:center;line-height:0;pointer-events:auto;position:relative;z-index:1}.mat-mdc-form-field-icon-prefix>.mat-icon,.mat-mdc-form-field-icon-suffix>.mat-icon{padding:12px;box-sizing:content-box}.mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-leading-icon-color)}.mat-form-field-disabled .mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-disabled-leading-icon-color)}.mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-trailing-icon-color)}.mat-form-field-disabled .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-disabled-trailing-icon-color)}.mat-form-field-invalid .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-trailing-icon-color)}.mat-form-field-invalid:not(.mat-focused):not(.mat-form-field-disabled) .mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-hover-trailing-icon-color)}.mat-form-field-invalid.mat-focused .mat-mdc-text-field-wrapper .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-focus-trailing-icon-color)}.mat-mdc-form-field-icon-prefix,[dir=rtl] .mat-mdc-form-field-icon-suffix{padding:0 4px 0 0}.mat-mdc-form-field-icon-suffix,[dir=rtl] .mat-mdc-form-field-icon-prefix{padding:0 0 0 4px}.mat-mdc-form-field-subscript-wrapper .mat-icon,.mat-mdc-form-field label .mat-icon{width:1em;height:1em;font-size:inherit}.mat-mdc-form-field-infix{flex:auto;min-width:0;width:180px;position:relative;box-sizing:border-box}.mat-mdc-form-field .mdc-notched-outline__notch{margin-left:-1px;-webkit-clip-path:inset(-9em -999em -9em 1px);clip-path:inset(-9em -999em -9em 1px)}[dir=rtl] .mat-mdc-form-field .mdc-notched-outline__notch{margin-left:0;margin-right:-1px;-webkit-clip-path:inset(-9em 1px -9em -999em);clip-path:inset(-9em 1px -9em -999em)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition-delay:40ms;transition-duration:110ms}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__affix{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled.mdc-ripple-upgraded--background-focused .mdc-text-field__ripple::before,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled:not(.mdc-ripple-upgraded):focus .mdc-text-field__ripple::before{transition-duration:75ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea{transition:none}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-filled 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-filled{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon{0%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}[dir=rtl] .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined[dir=rtl] .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon-rtl{0%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-floating-label{transition:transform 150ms cubic-bezier(0.4, 0, 0.2, 1),color 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-standard 250ms 1}@keyframes mdc-floating-label-shake-float-above-standard{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-line-ripple::after{transition:transform 180ms cubic-bezier(0.4, 0, 0.2, 1),opacity 180ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-notched-outline .mdc-floating-label{max-width:calc(100% + 1px)}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:calc(133.3333333333% + 1px)}'],encapsulation:2,data:{animation:[D9.transitionMessages]},changeDetection:0})}return e})(),r5=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({imports:[tc,Pu,f4,tc]})}return e})();const x9=new De("MAT_INPUT_VALUE_ACCESSOR"),k9=["button","checkbox","file","hidden","image","radio","range","reset","submit"];let L9=0,F9=(()=>{class e{get disabled(){return this._disabled}set disabled(t){this._disabled=bb(t),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(t){this._id=t||this._uid}get required(){return this._required??this.ngControl?.control?.hasValidator(dj.required)??!1}set required(t){this._required=bb(t)}get type(){return this._type}set type(t){this._type=t||"text",this._validateType(),!this._isTextarea&&h4().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(t){this._errorStateTracker.matcher=t}get value(){return this._inputValueAccessor.value}set value(t){t!==this.value&&(this._inputValueAccessor.value=t,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(t){this._readonly=bb(t)}get errorState(){return this._errorStateTracker.errorState}set errorState(t){this._errorStateTracker.errorState=t}constructor(t,o,c,u,f,g,E,C,R,P){this._elementRef=t,this._platform=o,this.ngControl=c,this._autofillMonitor=C,this._formField=P,this._uid="mat-input-"+L9++,this.focused=!1,this.stateChanges=new en,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(Y=>h4().has(Y)),this._iOSKeyupListener=Y=>{const J=Y.target;!J.value&&0===J.selectionStart&&0===J.selectionEnd&&(J.setSelectionRange(1,1),J.setSelectionRange(0,0))};const B=this._elementRef.nativeElement,G=B.nodeName.toLowerCase();this._inputValueAccessor=E||B,this._previousNativeValue=this.value,this.id=this.id,o.IOS&&R.runOutsideAngular(()=>{t.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._errorStateTracker=new P4(g,c,f,u,this.stateChanges),this._isServer=!this._platform.isBrowser,this._isNativeSelect="select"===G,this._isTextarea="textarea"===G,this._isInFormField=!!P,this._isNativeSelect&&(this.controlType=B.multiple?"mat-native-select-multiple":"mat-native-select")}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(t=>{this.autofilled=t.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngDoCheck(){this.ngControl&&(this.updateErrorState(),null!==this.ngControl.disabled&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(t){this._elementRef.nativeElement.focus(t)}updateErrorState(){this._errorStateTracker.updateErrorState()}_focusChanged(t){t!==this.focused&&(this.focused=t,this.stateChanges.next())}_onInput(){}_dirtyCheckNativeValue(){const t=this._elementRef.nativeElement.value;this._previousNativeValue!==t&&(this._previousNativeValue=t,this.stateChanges.next())}_dirtyCheckPlaceholder(){const t=this._getPlaceholder();if(t!==this._previousPlaceholder){const o=this._elementRef.nativeElement;this._previousPlaceholder=t,t?o.setAttribute("placeholder",t):o.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){k9.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let t=this._elementRef.nativeElement.validity;return t&&t.badInput}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}get shouldLabelFloat(){if(this._isNativeSelect){const t=this._elementRef.nativeElement,o=t.options[0];return this.focused||t.multiple||!this.empty||!!(t.selectedIndex>-1&&o&&o.label)}return this.focused||!this.empty}setDescribedByIds(t){t.length?this._elementRef.nativeElement.setAttribute("aria-describedby",t.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){const t=this._elementRef.nativeElement;return this._isNativeSelect&&(t.multiple||t.size>1)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(tn),ae(Eo),ae(ku,10),ae(iM,8),ae(dI,8),ae(IW),ae(x9,10),ae(HW),ae(it),ae(Z4,8))};static#t=this.\u0275dir=Ye({type:e,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:18,hostBindings:function(o,c){1&o&&gn("focus",function(){return c._focusChanged(!0)})("blur",function(){return c._focusChanged(!1)})("input",function(){return c._onInput()}),2&o&&(vm("id",c.id)("disabled",c.disabled)("required",c.required),Ji("name",c.name||null)("readonly",c.readonly&&!c._isNativeSelect||null)("aria-invalid",c.empty&&c.required?null:c.errorState)("aria-required",c.required)("id",c.id),Ht("mat-input-server",c._isServer)("mat-mdc-form-field-textarea-control",c._isInFormField&&c._isTextarea)("mat-mdc-form-field-input-control",c._isInFormField)("mdc-text-field__input",c._isInFormField)("mat-mdc-native-select-inline",c._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:[Xe.None,"aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["matInput"],standalone:!0,features:[wn([{provide:Q4,useExisting:e}]),So]})}return e})(),U9=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({imports:[tc,r5,r5,GW,tc]})}return e})();const V9=["switch"];function B9(e,n){1&e&&(oe(0,"div",12),Zo(),oe(1,"svg",13),ce(2,"path",14),Ee(),oe(3,"svg",15),ce(4,"path",16),Ee()())}const j9=["*"],H9=new De("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1})}),G9={provide:Qc,useExisting:Ln(()=>VU),multi:!0};class o5{constructor(n,t){this.source=n,this.checked=t}}let W9=0,VU=(()=>{class e{_createChangeEvent(t){return new o5(this,t)}get buttonId(){return`${this.id||this._uniqueId}-button`}focus(){this._switchElement.nativeElement.focus()}get checked(){return this._checked}set checked(t){this._checked=t,this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(t,o,c,u,f,g){this._elementRef=t,this._focusMonitor=o,this._changeDetectorRef=c,this.defaults=f,this._onChange=E=>{},this._onTouched=()=>{},this._validatorOnChange=()=>{},this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.disabled=!1,this.disableRipple=!1,this.tabIndex=0,this.change=new pn,this.toggleChange=new pn,this.tabIndex=parseInt(u)||0,this.color=f.color||"accent",this._noopAnimations="NoopAnimations"===g,this.id=this._uniqueId="mat-mdc-slide-toggle-"+ ++W9,this.hideIcon=f.hideIcon??!1,this._labelId=this._uniqueId+"-label"}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{"keyboard"===t||"program"===t?(this._focused=!0,this._changeDetectorRef.markForCheck()):t||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnChanges(t){t.required&&this._validatorOnChange()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(t){this.checked=!!t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}validate(t){return this.required&&!0!==t.value?{required:!0}:null}registerOnValidatorChange(t){this._validatorOnChange=t}setDisabledState(t){this.disabled=t,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}_handleClick(){this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new o5(this,this.checked)))}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}static#e=this.\u0275fac=function(o){return new(o||e)(ae(tn),ae(DU),ae(Us),function ih(e){return function Zx(e,n){if("class"===n)return e.classes;if("style"===n)return e.styles;const t=e.attrs;if(t){const o=t.length;let c=0;for(;c<o;){const u=t[c];if(lw(u))break;if(0===u)c+=2;else if("number"==typeof u)for(c++;c<o&&"string"==typeof t[c];)c++;else{if(u===n)return t[c+1];c+=2}}}return null}(Nn(),e)}("tabindex"),ae(H9),ae(bc,8))};static#t=this.\u0275cmp=Br({type:e,selectors:[["mat-slide-toggle"]],viewQuery:function(o,c){if(1&o&&ha(V9,5),2&o){let u;Zi(u=ar())&&(c._switchElement=u.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:13,hostBindings:function(o,c){2&o&&(vm("id",c.id),Ji("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),mm(c.color?"mat-"+c.color:""),Ht("mat-mdc-slide-toggle-focused",c._focused)("mat-mdc-slide-toggle-checked",c.checked)("_mat-animation-noopable",c._noopAnimations))},inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:[Xe.None,"aria-label","ariaLabel"],ariaLabelledby:[Xe.None,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[Xe.None,"aria-describedby","ariaDescribedby"],required:[Xe.HasDecoratorInputTransform,"required","required",fo],color:"color",disabled:[Xe.HasDecoratorInputTransform,"disabled","disabled",fo],disableRipple:[Xe.HasDecoratorInputTransform,"disableRipple","disableRipple",fo],tabIndex:[Xe.HasDecoratorInputTransform,"tabIndex","tabIndex",t=>null==t?0:function oP(e,n=NaN){return isNaN(parseFloat(e))||isNaN(Number(e))?n:Number(e)}(t)],checked:[Xe.HasDecoratorInputTransform,"checked","checked",fo],hideIcon:[Xe.HasDecoratorInputTransform,"hideIcon","hideIcon",fo]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],standalone:!0,features:[wn([G9,{provide:to,useExisting:e,multi:!0}]),Pi,So,Hc],ngContentSelectors:j9,decls:13,vars:24,consts:[["mat-internal-form-field","",3,"labelPosition"],["role","switch","type","button",1,"mdc-switch",3,"tabIndex","disabled","click"],["switch",""],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],["class","mdc-switch__icons"],[1,"mdc-label",3,"for","click"],[1,"mdc-switch__icons"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(o,c){if(1&o&&(Mo(),oe(0,"div",0)(1,"button",1,2),gn("click",function(){return c._handleClick()}),ce(3,"div",3),oe(4,"div",4)(5,"div",5)(6,"div",6),ce(7,"div",7),Ee(),oe(8,"div",8),ce(9,"div",9),Ee(),Tn(10,B9,5,0,"div",10),Ee()()(),oe(11,"label",11),gn("click",function(f){return f.stopPropagation()}),xi(12),Ee()()),2&o){const u=Mm(2);Ze("labelPosition",c.labelPosition),Qe(),Ht("mdc-switch--selected",c.checked)("mdc-switch--unselected",!c.checked)("mdc-switch--checked",c.checked)("mdc-switch--disabled",c.disabled),Ze("tabIndex",c.disabled?-1:c.tabIndex)("disabled",c.disabled),Ji("id",c.buttonId)("name",c.name)("aria-label",c.ariaLabel)("aria-labelledby",c._getAriaLabelledBy())("aria-describedby",c.ariaDescribedby)("aria-required",c.required||null)("aria-checked",c.checked),Qe(8),Ze("matRippleTrigger",u)("matRippleDisabled",c.disableRipple||c.disabled)("matRippleCentered",!0),Qe(),we(10,c.hideIcon?-1:10),Qe(),Ze("for",c.buttonId),Ji("id",c._labelId)}},dependencies:[V4,PW],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1);background-color:var(--mdc-elevation-overlay-color)}.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative}.mdc-switch[hidden]{display:none}.mdc-switch:disabled{cursor:default;pointer-events:none}.mdc-switch__track{overflow:hidden;position:relative;width:100%}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%}@media screen and (forced-colors: active){.mdc-switch__track::before,.mdc-switch__track::after{border-color:currentColor}}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(-100%)}[dir=rtl] .mdc-switch__track::after,.mdc-switch__track[dir=rtl]::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track[dir=rtl]::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0)}[dir=rtl] .mdc-switch__handle-track,.mdc-switch__handle-track[dir=rtl]{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track,.mdc-switch--selected .mdc-switch__handle-track[dir=rtl]{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto}[dir=rtl] .mdc-switch__handle,.mdc-switch__handle[dir=rtl]{left:auto;right:0}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}@media screen and (forced-colors: active){.mdc-switch__handle::before,.mdc-switch__handle::after{border-color:currentColor}}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-elevation-overlay{bottom:0;left:0;right:0;top:0}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1}.mdc-switch:disabled .mdc-switch__ripple{display:none}.mdc-switch__icons{height:100%;position:relative;width:100%;z-index:1}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle .mdc-switch--disabled+label{color:var(--mdc-switch-disabled-label-text-color)}.mdc-switch{width:var(--mdc-switch-track-width)}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color)}.mdc-switch.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color)}.mdc-switch .mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation)}.mdc-switch .mdc-switch__focus-ring-wrapper,.mdc-switch .mdc-switch__handle{height:var(--mdc-switch-handle-height)}.mdc-switch:disabled .mdc-switch__handle::after{opacity:var(--mdc-switch-disabled-handle-opacity)}.mdc-switch .mdc-switch__handle{border-radius:var(--mdc-switch-handle-shape)}.mdc-switch .mdc-switch__handle{width:var(--mdc-switch-handle-width)}.mdc-switch .mdc-switch__handle-track{width:calc(100% - var(--mdc-switch-handle-width))}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__icon{fill:var(--mdc-switch-selected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__icon{fill:var(--mdc-switch-unselected-icon-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity)}.mdc-switch.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size);height:var(--mdc-switch-selected-icon-size)}.mdc-switch.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size);height:var(--mdc-switch-unselected-icon-size)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-hover-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-focus-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-pressed-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-hover-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-focus-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-pressed-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-selected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-selected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-unselected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-unselected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch .mdc-switch__ripple{height:var(--mdc-switch-state-layer-size);width:var(--mdc-switch-state-layer-size)}.mdc-switch .mdc-switch__track{height:var(--mdc-switch-track-height)}.mdc-switch:disabled .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity)}.mdc-switch:enabled .mdc-switch__track::after{background:var(--mdc-switch-selected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color)}.mdc-switch:enabled .mdc-switch__track::before{background:var(--mdc-switch-unselected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color)}.mdc-switch .mdc-switch__track{border-radius:var(--mdc-switch-track-shape)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mat-mdc-slide-toggle{display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle .mdc-switch__ripple::after{content:"";opacity:0}.mat-mdc-slide-toggle .mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:opacity 75ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-mdc-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-elevation-overlay,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}'],encapsulation:2,changeDetection:0})}return e})(),q9=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({imports:[VU,tc,tc]})}return e})();const Y9=["addListener","removeListener"],$9=["addEventListener","removeEventListener"],X9=["on","off"];function BU(e,n,t,o){if(dn(t)&&(o=t,t=void 0),o)return BU(e,n,t).pipe(tU(o));const[c,u]=function Z9(e){return dn(e.addEventListener)&&dn(e.removeEventListener)}(e)?$9.map(f=>g=>e[f](n,g,t)):function J9(e){return dn(e.addListener)&&dn(e.removeListener)}(e)?Y9.map(s5(e,n)):function Q9(e){return dn(e.on)&&dn(e.off)}(e)?X9.map(s5(e,n)):[];if(!c&&ZF(e))return no(f=>BU(f,n,t))(Wo(e));if(!c)throw new TypeError("Invalid event target");return new Wn(f=>{const g=(...E)=>f.next(1<E.length?E:E[0]);return c(g),()=>u(g)})}function s5(e,n){return t=>o=>e[t](n,o)}const bI={schedule(e){let n=requestAnimationFrame,t=cancelAnimationFrame;const{delegate:o}=bI;o&&(n=o.requestAnimationFrame,t=o.cancelAnimationFrame);const c=n(u=>{t=void 0,e(u)});return new Ki(()=>t?.(c))},requestAnimationFrame(...e){const{delegate:n}=bI;return(n?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:n}=bI;return(n?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0};new class tz extends wU{flush(n){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:o}=this;let c;n=n||o.shift();do{if(c=n.execute(n.state,n.delay))break}while((n=o[0])&&n.id===t&&o.shift());if(this._active=!1,c){for(;(n=o[0])&&n.id===t&&o.shift();)n.unsubscribe();throw c}}}(class ez extends TU{constructor(n,t){super(n,t),this.scheduler=n,this.work=t}requestAsyncId(n,t,o=0){return null!==o&&o>0?super.requestAsyncId(n,t,o):(n.actions.push(this),n._scheduled||(n._scheduled=bI.requestAnimationFrame(()=>n.flush(void 0))))}recycleAsyncId(n,t,o=0){var c;if(null!=o?o>0:this.delay>0)return super.recycleAsyncId(n,t,o);const{actions:u}=n;null!=t&&(null===(c=u[u.length-1])||void 0===c?void 0:c.id)!==t&&(bI.cancelAnimationFrame(t),n._scheduled=void 0)}});let jU,iz=1;const mM={};function a5(e){return e in mM&&(delete mM[e],!0)}const rz={setImmediate(e){const n=iz++;return mM[n]=!0,jU||(jU=Promise.resolve()),jU.then(()=>a5(n)&&e()),n},clearImmediate(e){a5(e)}},{setImmediate:oz,clearImmediate:sz}=rz,gM={setImmediate(...e){const{delegate:n}=gM;return(n?.setImmediate||oz)(...e)},clearImmediate(e){const{delegate:n}=gM;return(n?.clearImmediate||sz)(e)},delegate:void 0};new class cz extends wU{flush(n){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:o}=this;let c;n=n||o.shift();do{if(c=n.execute(n.state,n.delay))break}while((n=o[0])&&n.id===t&&o.shift());if(this._active=!1,c){for(;(n=o[0])&&n.id===t&&o.shift();)n.unsubscribe();throw c}}}(class az extends TU{constructor(n,t){super(n,t),this.scheduler=n,this.work=t}requestAsyncId(n,t,o=0){return null!==o&&o>0?super.requestAsyncId(n,t,o):(n.actions.push(this),n._scheduled||(n._scheduled=gM.setImmediate(n.flush.bind(n,void 0))))}recycleAsyncId(n,t,o=0){var c;if(null!=o?o>0:this.delay>0)return super.recycleAsyncId(n,t,o);const{actions:u}=n;null!=t&&(null===(c=u[u.length-1])||void 0===c?void 0:c.id)!==t&&(gM.clearImmediate(t),n._scheduled===t&&(n._scheduled=void 0))}});function _M(e=0,n,t=KG){let o=-1;return null!=n&&(ij(n)?t=n:o=n),new Wn(c=>{let u=function uz(e){return e instanceof Date&&!isNaN(e)}(e)?+e-t.now():e;u<0&&(u=0);let f=0;return t.schedule(function(){c.closed||(c.next(f++),0<=o?this.schedule(void 0,o):c.complete())},u)})}function c5(e,n=fI){return function lz(e){return fi((n,t)=>{let o=!1,c=null,u=null,f=!1;const g=()=>{if(u?.unsubscribe(),u=null,o){o=!1;const C=c;c=null,t.next(C)}f&&t.complete()},E=()=>{u=null,f&&t.complete()};n.subscribe(Jn(t,C=>{o=!0,c=C,u||Wo(e(C)).subscribe(u=Jn(t,g,E))},()=>{f=!0,(!o||!u||u.closed)&&t.complete()}))})}(()=>_M(e,n))}let d5=(()=>{class e{constructor(t,o,c){this._ngZone=t,this._platform=o,this._scrolled=new en,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=c}register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){const o=this.scrollContainers.get(t);o&&(o.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=20){return this._platform.isBrowser?new Wn(o=>{this._globalSubscription||this._addGlobalListener();const c=t>0?this._scrolled.pipe(c5(t)).subscribe(o):this._scrolled.subscribe(o);return this._scrolledCount++,()=>{c.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):pt()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((t,o)=>this.deregister(o)),this._scrolled.complete()}ancestorScrolled(t,o){const c=this.getAncestorScrollContainers(t);return this.scrolled(o).pipe(Ea(u=>!u||c.indexOf(u)>-1))}getAncestorScrollContainers(t){const o=[];return this.scrollContainers.forEach((c,u)=>{this._scrollableContainsElement(u,t)&&o.push(u)}),o}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(t,o){let c=Vp(o),u=t.getElementRef().nativeElement;do{if(c==u)return!0}while(c=c.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>BU(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}static#e=this.\u0275fac=function(o){return new(o||e)(be(it),be(Eo),be(sn,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),l5=(()=>{class e{constructor(t,o,c){this._platform=t,this._change=new en,this._changeListener=u=>{this._change.next(u)},this._document=c,o.runOutsideAngular(()=>{if(t.isBrowser){const u=this._getWindow();u.addEventListener("resize",this._changeListener),u.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const t=this._getWindow();t.removeEventListener("resize",this._changeListener),t.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){const t=this.getViewportScrollPosition(),{width:o,height:c}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+c,right:t.left+o,height:c,width:o}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const t=this._document,o=this._getWindow(),c=t.documentElement,u=c.getBoundingClientRect();return{top:-u.top||t.body.scrollTop||o.scrollY||c.scrollTop||0,left:-u.left||t.body.scrollLeft||o.scrollX||c.scrollLeft||0}}change(t=20){return t>0?this._change.pipe(c5(t)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const t=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:t.innerWidth,height:t.innerHeight}:{width:0,height:0}}static#e=this.\u0275fac=function(o){return new(o||e)(be(Eo),be(it),be(sn,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),HU=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({})}return e})(),u5=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({imports:[mI,HU,mI,HU]})}return e})();class GU{attach(n){return this._attachedHost=n,n.attach(this)}detach(){let n=this._attachedHost;null!=n&&(this._attachedHost=null,n.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(n){this._attachedHost=n}}class h5 extends GU{constructor(n,t,o,c,u){super(),this.component=n,this.viewContainerRef=t,this.injector=o,this.componentFactoryResolver=c,this.projectableNodes=u}}class fz extends GU{constructor(n,t,o,c){super(),this.templateRef=n,this.viewContainerRef=t,this.context=o,this.injector=c}get origin(){return this.templateRef.elementRef}attach(n,t=this.context){return this.context=t,super.attach(n)}detach(){return this.context=void 0,super.detach()}}class mz extends GU{constructor(n){super(),this.element=n instanceof tn?n.nativeElement:n}}class gz{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(n){return n instanceof h5?(this._attachedPortal=n,this.attachComponentPortal(n)):n instanceof fz?(this._attachedPortal=n,this.attachTemplatePortal(n)):this.attachDomPortal&&n instanceof mz?(this._attachedPortal=n,this.attachDomPortal(n)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(n){this._disposeFn=n}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class _z extends gz{constructor(n,t,o,c,u){super(),this.outletElement=n,this._componentFactoryResolver=t,this._appRef=o,this._defaultInjector=c,this.attachDomPortal=f=>{const g=f.element,E=this._document.createComment("dom-portal");g.parentNode.insertBefore(E,g),this.outletElement.appendChild(g),this._attachedPortal=f,super.setDisposeFn(()=>{E.parentNode&&E.parentNode.replaceChild(g,E)})},this._document=u}attachComponentPortal(n){const o=(n.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(n.component);let c;return n.viewContainerRef?(c=n.viewContainerRef.createComponent(o,n.viewContainerRef.length,n.injector||n.viewContainerRef.injector,n.projectableNodes||void 0),this.setDisposeFn(()=>c.destroy())):(c=o.create(n.injector||this._defaultInjector||pr.NULL),this._appRef.attachView(c.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(c.hostView),c.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(c)),this._attachedPortal=n,c}attachTemplatePortal(n){let t=n.viewContainerRef,o=t.createEmbeddedView(n.templateRef,n.context,{injector:n.injector});return o.rootNodes.forEach(c=>this.outletElement.appendChild(c)),o.detectChanges(),this.setDisposeFn(()=>{let c=t.indexOf(o);-1!==c&&t.remove(c)}),this._attachedPortal=n,o}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(n){return n.hostView.rootNodes[0]}}let Ez=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({})}return e})();const p5=RG();class vz{constructor(n,t){this._viewportRuler=n,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=t}attach(){}enable(){if(this._canBeEnabled()){const n=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=n.style.left||"",this._previousHTMLStyles.top=n.style.top||"",n.style.left=Tr(-this._previousScrollPosition.left),n.style.top=Tr(-this._previousScrollPosition.top),n.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const n=this._document.documentElement,o=n.style,c=this._document.body.style,u=o.scrollBehavior||"",f=c.scrollBehavior||"";this._isEnabled=!1,o.left=this._previousHTMLStyles.left,o.top=this._previousHTMLStyles.top,n.classList.remove("cdk-global-scrollblock"),p5&&(o.scrollBehavior=c.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),p5&&(o.scrollBehavior=u,c.scrollBehavior=f)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const t=this._document.body,o=this._viewportRuler.getViewportSize();return t.scrollHeight>o.height||t.scrollWidth>o.width}}class bz{constructor(n,t,o,c){this._scrollDispatcher=n,this._ngZone=t,this._viewportRuler=o,this._config=c,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(n){this._overlayRef=n}enable(){if(this._scrollSubscription)return;const n=this._scrollDispatcher.scrolled(0).pipe(Ea(t=>!t||!this._overlayRef.overlayElement.contains(t.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=n.subscribe(()=>{const t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=n.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class f5{enable(){}disable(){}attach(){}}function WU(e,n){return n.some(t=>e.bottom<t.top||e.top>t.bottom||e.right<t.left||e.left>t.right)}function m5(e,n){return n.some(t=>e.top<t.top||e.bottom>t.bottom||e.left<t.left||e.right>t.right)}class yz{constructor(n,t,o,c){this._scrollDispatcher=n,this._viewportRuler=t,this._ngZone=o,this._config=c,this._scrollSubscription=null}attach(n){this._overlayRef=n}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:o,height:c}=this._viewportRuler.getViewportSize();WU(t,[{width:o,height:c,bottom:c,right:o,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let Cz=(()=>{class e{constructor(t,o,c,u){this._scrollDispatcher=t,this._viewportRuler=o,this._ngZone=c,this.noop=()=>new f5,this.close=f=>new bz(this._scrollDispatcher,this._ngZone,this._viewportRuler,f),this.block=()=>new vz(this._viewportRuler,this._document),this.reposition=f=>new yz(this._scrollDispatcher,this._viewportRuler,this._ngZone,f),this._document=u}static#e=this.\u0275fac=function(o){return new(o||e)(be(d5),be(l5),be(it),be(sn))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class Sz{constructor(n){if(this.scrollStrategy=new f5,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,n){const t=Object.keys(n);for(const o of t)void 0!==n[o]&&(this[o]=n[o])}}}class Tz{constructor(n,t){this.connectionPair=n,this.scrollableViewProperties=t}}let g5=(()=>{class e{constructor(t){this._attachedOverlays=[],this._document=t}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){const o=this._attachedOverlays.indexOf(t);o>-1&&this._attachedOverlays.splice(o,1),0===this._attachedOverlays.length&&this.detach()}static#e=this.\u0275fac=function(o){return new(o||e)(be(sn))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Iz=(()=>{class e extends g5{constructor(t,o){super(t),this._ngZone=o,this._keydownListener=c=>{const u=this._attachedOverlays;for(let f=u.length-1;f>-1;f--)if(u[f]._keydownEvents.observers.length>0){const g=u[f]._keydownEvents;this._ngZone?this._ngZone.run(()=>g.next(c)):g.next(c);break}}}add(t){super.add(t),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}static#e=this.\u0275fac=function(o){return new(o||e)(be(sn),be(it,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),wz=(()=>{class e extends g5{constructor(t,o,c){super(t),this._platform=o,this._ngZone=c,this._cursorStyleIsSet=!1,this._pointerDownListener=u=>{this._pointerDownEventTarget=Up(u)},this._clickListener=u=>{const f=Up(u),g="click"===u.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:f;this._pointerDownEventTarget=null;const E=this._attachedOverlays.slice();for(let C=E.length-1;C>-1;C--){const R=E[C];if(R._outsidePointerEvents.observers.length<1||!R.hasAttached())continue;if(R.overlayElement.contains(f)||R.overlayElement.contains(g))break;const P=R._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>P.next(u)):P.next(u)}}}add(t){if(super.add(t),!this._isAttached){const o=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(o)):this._addEventListeners(o),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=o.style.cursor,o.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const t=this._document.body;t.removeEventListener("pointerdown",this._pointerDownListener,!0),t.removeEventListener("click",this._clickListener,!0),t.removeEventListener("auxclick",this._clickListener,!0),t.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(t.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(t){t.addEventListener("pointerdown",this._pointerDownListener,!0),t.addEventListener("click",this._clickListener,!0),t.addEventListener("auxclick",this._clickListener,!0),t.addEventListener("contextmenu",this._clickListener,!0)}static#e=this.\u0275fac=function(o){return new(o||e)(be(sn),be(Eo),be(it,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),_5=(()=>{class e{constructor(t,o){this._platform=o,this._document=t}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t="cdk-overlay-container";if(this._platform.isBrowser||SU()){const c=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let u=0;u<c.length;u++)c[u].remove()}const o=this._document.createElement("div");o.classList.add(t),SU()?o.setAttribute("platform","test"):this._platform.isBrowser||o.setAttribute("platform","server"),this._document.body.appendChild(o),this._containerElement=o}static#e=this.\u0275fac=function(o){return new(o||e)(be(sn),be(Eo))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class Rz{constructor(n,t,o,c,u,f,g,E,C,R=!1){this._portalOutlet=n,this._host=t,this._pane=o,this._config=c,this._ngZone=u,this._keyboardDispatcher=f,this._document=g,this._location=E,this._outsideClickDispatcher=C,this._animationsDisabled=R,this._backdropElement=null,this._backdropClick=new en,this._attachments=new en,this._detachments=new en,this._locationChanges=Ki.EMPTY,this._backdropClickHandler=P=>this._backdropClick.next(P),this._backdropTransitionendHandler=P=>{this._disposeBackdrop(P.target)},this._keydownEvents=new en,this._outsidePointerEvents=new en,c.scrollStrategy&&(this._scrollStrategy=c.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=c.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(n){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const t=this._portalOutlet.attach(n);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Vr(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof t?.onDestroy&&t.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const n=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),n}dispose(){const n=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,n&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(n){n!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=n,this.hasAttached()&&(n.attach(this),this.updatePosition()))}updateSize(n){this._config={...this._config,...n},this._updateElementSize()}setDirection(n){this._config={...this._config,direction:n},this._updateElementDirection()}addPanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!0)}removePanelClass(n){this._pane&&this._toggleClasses(this._pane,n,!1)}getDirection(){const n=this._config.direction;return n?"string"==typeof n?n:n.value:"ltr"}updateScrollStrategy(n){n!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=n,this.hasAttached()&&(n.attach(this),n.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const n=this._pane.style;n.width=Tr(this._config.width),n.height=Tr(this._config.height),n.minWidth=Tr(this._config.minWidth),n.minHeight=Tr(this._config.minHeight),n.maxWidth=Tr(this._config.maxWidth),n.maxHeight=Tr(this._config.maxHeight)}_togglePointerEvents(n){this._pane.style.pointerEvents=n?"":"none"}_attachBackdrop(){const n="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(n)})}):this._backdropElement.classList.add(n)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const n=this._backdropElement;if(n){if(this._animationsDisabled)return void this._disposeBackdrop(n);n.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{n.addEventListener("transitionend",this._backdropTransitionendHandler)}),n.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(n)},500))}}_toggleClasses(n,t,o){const c=oM(t||[]).filter(u=>!!u);c.length&&(o?n.classList.add(...c):n.classList.remove(...c))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const n=this._ngZone.onStable.pipe(zo(W4(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),n.unsubscribe())})})}_disposeScrollStrategy(){const n=this._scrollStrategy;n&&(n.disable(),n.detach&&n.detach())}_disposeBackdrop(n){n&&(n.removeEventListener("click",this._backdropClickHandler),n.removeEventListener("transitionend",this._backdropTransitionendHandler),n.remove(),this._backdropElement===n&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const E5="cdk-overlay-connected-position-bounding-box",Az=/([A-Za-z%]+)$/;class Dz{get positions(){return this._preferredPositions}constructor(n,t,o,c,u){this._viewportRuler=t,this._document=o,this._platform=c,this._overlayContainer=u,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new en,this._resizeSubscription=Ki.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(n)}attach(n){this._validatePositions(),n.hostElement.classList.add(E5),this._overlayRef=n,this._boundingBox=n.hostElement,this._pane=n.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const n=this._originRect,t=this._overlayRect,o=this._viewportRect,c=this._containerRect,u=[];let f;for(let g of this._preferredPositions){let E=this._getOriginPoint(n,c,g),C=this._getOverlayPoint(E,t,g),R=this._getOverlayFit(C,t,o,g);if(R.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(g,E);this._canFitWithFlexibleDimensions(R,C,o)?u.push({position:g,origin:E,overlayRect:t,boundingBoxRect:this._calculateBoundingBoxRect(E,g)}):(!f||f.overlayFit.visibleArea<R.visibleArea)&&(f={overlayFit:R,overlayPoint:C,originPoint:E,position:g,overlayRect:t})}if(u.length){let g=null,E=-1;for(const C of u){const R=C.boundingBoxRect.width*C.boundingBoxRect.height*(C.position.weight||1);R>E&&(E=R,g=C)}return this._isPushed=!1,void this._applyPosition(g.position,g.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(f.position,f.originPoint);this._applyPosition(f.position,f.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Tg(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(E5),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const n=this._lastPosition;if(n){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._getOriginPoint(this._originRect,this._containerRect,n);this._applyPosition(n,t)}else this.apply()}withScrollableContainers(n){return this._scrollables=n,this}withPositions(n){return this._preferredPositions=n,-1===n.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(n){return this._viewportMargin=n,this}withFlexibleDimensions(n=!0){return this._hasFlexibleDimensions=n,this}withGrowAfterOpen(n=!0){return this._growAfterOpen=n,this}withPush(n=!0){return this._canPush=n,this}withLockedPosition(n=!0){return this._positionLocked=n,this}setOrigin(n){return this._origin=n,this}withDefaultOffsetX(n){return this._offsetX=n,this}withDefaultOffsetY(n){return this._offsetY=n,this}withTransformOriginOn(n){return this._transformOriginSelector=n,this}_getOriginPoint(n,t,o){let c,u;if("center"==o.originX)c=n.left+n.width/2;else{const f=this._isRtl()?n.right:n.left,g=this._isRtl()?n.left:n.right;c="start"==o.originX?f:g}return t.left<0&&(c-=t.left),u="center"==o.originY?n.top+n.height/2:"top"==o.originY?n.top:n.bottom,t.top<0&&(u-=t.top),{x:c,y:u}}_getOverlayPoint(n,t,o){let c,u;return c="center"==o.overlayX?-t.width/2:"start"===o.overlayX?this._isRtl()?-t.width:0:this._isRtl()?0:-t.width,u="center"==o.overlayY?-t.height/2:"top"==o.overlayY?0:-t.height,{x:n.x+c,y:n.y+u}}_getOverlayFit(n,t,o,c){const u=b5(t);let{x:f,y:g}=n,E=this._getOffset(c,"x"),C=this._getOffset(c,"y");E&&(f+=E),C&&(g+=C);let B=0-g,G=g+u.height-o.height,Y=this._subtractOverflows(u.width,0-f,f+u.width-o.width),J=this._subtractOverflows(u.height,B,G),le=Y*J;return{visibleArea:le,isCompletelyWithinViewport:u.width*u.height===le,fitsInViewportVertically:J===u.height,fitsInViewportHorizontally:Y==u.width}}_canFitWithFlexibleDimensions(n,t,o){if(this._hasFlexibleDimensions){const c=o.bottom-t.y,u=o.right-t.x,f=v5(this._overlayRef.getConfig().minHeight),g=v5(this._overlayRef.getConfig().minWidth);return(n.fitsInViewportVertically||null!=f&&f<=c)&&(n.fitsInViewportHorizontally||null!=g&&g<=u)}return!1}_pushOverlayOnScreen(n,t,o){if(this._previousPushAmount&&this._positionLocked)return{x:n.x+this._previousPushAmount.x,y:n.y+this._previousPushAmount.y};const c=b5(t),u=this._viewportRect,f=Math.max(n.x+c.width-u.width,0),g=Math.max(n.y+c.height-u.height,0),E=Math.max(u.top-o.top-n.y,0),C=Math.max(u.left-o.left-n.x,0);let R=0,P=0;return R=c.width<=u.width?C||-f:n.x<this._viewportMargin?u.left-o.left-n.x:0,P=c.height<=u.height?E||-g:n.y<this._viewportMargin?u.top-o.top-n.y:0,this._previousPushAmount={x:R,y:P},{x:n.x+R,y:n.y+P}}_applyPosition(n,t){if(this._setTransformOrigin(n),this._setOverlayElementStyles(t,n),this._setBoundingBoxStyles(t,n),n.panelClass&&this._addPanelClasses(n.panelClass),this._lastPosition=n,this._positionChanges.observers.length){const o=this._getScrollVisibility(),c=new Tz(n,o);this._positionChanges.next(c)}this._isInitialRender=!1}_setTransformOrigin(n){if(!this._transformOriginSelector)return;const t=this._boundingBox.querySelectorAll(this._transformOriginSelector);let o,c=n.overlayY;o="center"===n.overlayX?"center":this._isRtl()?"start"===n.overlayX?"right":"left":"start"===n.overlayX?"left":"right";for(let u=0;u<t.length;u++)t[u].style.transformOrigin=`${o} ${c}`}_calculateBoundingBoxRect(n,t){const o=this._viewportRect,c=this._isRtl();let u,f,g,R,P,B;if("top"===t.overlayY)f=n.y,u=o.height-f+this._viewportMargin;else if("bottom"===t.overlayY)g=o.height-n.y+2*this._viewportMargin,u=o.height-g+this._viewportMargin;else{const G=Math.min(o.bottom-n.y+o.top,n.y),Y=this._lastBoundingBoxSize.height;u=2*G,f=n.y-G,u>Y&&!this._isInitialRender&&!this._growAfterOpen&&(f=n.y-Y/2)}if("end"===t.overlayX&&!c||"start"===t.overlayX&&c)B=o.width-n.x+this._viewportMargin,R=n.x-this._viewportMargin;else if("start"===t.overlayX&&!c||"end"===t.overlayX&&c)P=n.x,R=o.right-n.x;else{const G=Math.min(o.right-n.x+o.left,n.x),Y=this._lastBoundingBoxSize.width;R=2*G,P=n.x-G,R>Y&&!this._isInitialRender&&!this._growAfterOpen&&(P=n.x-Y/2)}return{top:f,left:P,bottom:g,right:B,width:R,height:u}}_setBoundingBoxStyles(n,t){const o=this._calculateBoundingBoxRect(n,t);!this._isInitialRender&&!this._growAfterOpen&&(o.height=Math.min(o.height,this._lastBoundingBoxSize.height),o.width=Math.min(o.width,this._lastBoundingBoxSize.width));const c={};if(this._hasExactPosition())c.top=c.left="0",c.bottom=c.right=c.maxHeight=c.maxWidth="",c.width=c.height="100%";else{const u=this._overlayRef.getConfig().maxHeight,f=this._overlayRef.getConfig().maxWidth;c.height=Tr(o.height),c.top=Tr(o.top),c.bottom=Tr(o.bottom),c.width=Tr(o.width),c.left=Tr(o.left),c.right=Tr(o.right),c.alignItems="center"===t.overlayX?"center":"end"===t.overlayX?"flex-end":"flex-start",c.justifyContent="center"===t.overlayY?"center":"bottom"===t.overlayY?"flex-end":"flex-start",u&&(c.maxHeight=Tr(u)),f&&(c.maxWidth=Tr(f))}this._lastBoundingBoxSize=o,Tg(this._boundingBox.style,c)}_resetBoundingBoxStyles(){Tg(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Tg(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(n,t){const o={},c=this._hasExactPosition(),u=this._hasFlexibleDimensions,f=this._overlayRef.getConfig();if(c){const R=this._viewportRuler.getViewportScrollPosition();Tg(o,this._getExactOverlayY(t,n,R)),Tg(o,this._getExactOverlayX(t,n,R))}else o.position="static";let g="",E=this._getOffset(t,"x"),C=this._getOffset(t,"y");E&&(g+=`translateX(${E}px) `),C&&(g+=`translateY(${C}px)`),o.transform=g.trim(),f.maxHeight&&(c?o.maxHeight=Tr(f.maxHeight):u&&(o.maxHeight="")),f.maxWidth&&(c?o.maxWidth=Tr(f.maxWidth):u&&(o.maxWidth="")),Tg(this._pane.style,o)}_getExactOverlayY(n,t,o){let c={top:"",bottom:""},u=this._getOverlayPoint(t,this._overlayRect,n);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,o)),"bottom"===n.overlayY?c.bottom=this._document.documentElement.clientHeight-(u.y+this._overlayRect.height)+"px":c.top=Tr(u.y),c}_getExactOverlayX(n,t,o){let f,c={left:"",right:""},u=this._getOverlayPoint(t,this._overlayRect,n);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,o)),f=this._isRtl()?"end"===n.overlayX?"left":"right":"end"===n.overlayX?"right":"left","right"===f?c.right=this._document.documentElement.clientWidth-(u.x+this._overlayRect.width)+"px":c.left=Tr(u.x),c}_getScrollVisibility(){const n=this._getOriginRect(),t=this._pane.getBoundingClientRect(),o=this._scrollables.map(c=>c.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:m5(n,o),isOriginOutsideView:WU(n,o),isOverlayClipped:m5(t,o),isOverlayOutsideView:WU(t,o)}}_subtractOverflows(n,...t){return t.reduce((o,c)=>o-Math.max(c,0),n)}_getNarrowedViewportRect(){const n=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,o=this._viewportRuler.getViewportScrollPosition();return{top:o.top+this._viewportMargin,left:o.left+this._viewportMargin,right:o.left+n-this._viewportMargin,bottom:o.top+t-this._viewportMargin,width:n-2*this._viewportMargin,height:t-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(n,t){return"x"===t?null==n.offsetX?this._offsetX:n.offsetX:null==n.offsetY?this._offsetY:n.offsetY}_validatePositions(){}_addPanelClasses(n){this._pane&&oM(n).forEach(t=>{""!==t&&-1===this._appliedPanelClasses.indexOf(t)&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(n=>{this._pane.classList.remove(n)}),this._appliedPanelClasses=[])}_getOriginRect(){const n=this._origin;if(n instanceof tn)return n.nativeElement.getBoundingClientRect();if(n instanceof Element)return n.getBoundingClientRect();const t=n.width||0,o=n.height||0;return{top:n.y,bottom:n.y+o,left:n.x,right:n.x+t,height:o,width:t}}}function Tg(e,n){for(let t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e}function v5(e){if("number"!=typeof e&&null!=e){const[n,t]=e.split(Az);return t&&"px"!==t?null:parseFloat(n)}return e||null}function b5(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}const y5="cdk-global-overlay-wrapper";class Oz{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(n){const t=n.getConfig();this._overlayRef=n,this._width&&!t.width&&n.updateSize({width:this._width}),this._height&&!t.height&&n.updateSize({height:this._height}),n.hostElement.classList.add(y5),this._isDisposed=!1}top(n=""){return this._bottomOffset="",this._topOffset=n,this._alignItems="flex-start",this}left(n=""){return this._xOffset=n,this._xPosition="left",this}bottom(n=""){return this._topOffset="",this._bottomOffset=n,this._alignItems="flex-end",this}right(n=""){return this._xOffset=n,this._xPosition="right",this}start(n=""){return this._xOffset=n,this._xPosition="start",this}end(n=""){return this._xOffset=n,this._xPosition="end",this}width(n=""){return this._overlayRef?this._overlayRef.updateSize({width:n}):this._width=n,this}height(n=""){return this._overlayRef?this._overlayRef.updateSize({height:n}):this._height=n,this}centerHorizontally(n=""){return this.left(n),this._xPosition="center",this}centerVertically(n=""){return this.top(n),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const n=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,o=this._overlayRef.getConfig(),{width:c,height:u,maxWidth:f,maxHeight:g}=o,E=!("100%"!==c&&"100vw"!==c||f&&"100%"!==f&&"100vw"!==f),C=!("100%"!==u&&"100vh"!==u||g&&"100%"!==g&&"100vh"!==g),R=this._xPosition,P=this._xOffset,B="rtl"===this._overlayRef.getConfig().direction;let G="",Y="",J="";E?J="flex-start":"center"===R?(J="center",B?Y=P:G=P):B?"left"===R||"end"===R?(J="flex-end",G=P):("right"===R||"start"===R)&&(J="flex-start",Y=P):"left"===R||"start"===R?(J="flex-start",G=P):("right"===R||"end"===R)&&(J="flex-end",Y=P),n.position=this._cssPosition,n.marginLeft=E?"0":G,n.marginTop=C?"0":this._topOffset,n.marginBottom=this._bottomOffset,n.marginRight=E?"0":Y,t.justifyContent=J,t.alignItems=C?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const n=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,o=t.style;t.classList.remove(y5),o.justifyContent=o.alignItems=n.marginTop=n.marginBottom=n.marginLeft=n.marginRight=n.position="",this._overlayRef=null,this._isDisposed=!0}}let Nz=(()=>{class e{constructor(t,o,c,u){this._viewportRuler=t,this._document=o,this._platform=c,this._overlayContainer=u}global(){return new Oz}flexibleConnectedTo(t){return new Dz(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static#e=this.\u0275fac=function(o){return new(o||e)(be(l5),be(sn),be(Eo),be(_5))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Pz=0,Sb=(()=>{class e{constructor(t,o,c,u,f,g,E,C,R,P,B,G){this.scrollStrategies=t,this._overlayContainer=o,this._componentFactoryResolver=c,this._positionBuilder=u,this._keyboardDispatcher=f,this._injector=g,this._ngZone=E,this._document=C,this._directionality=R,this._location=P,this._outsideClickDispatcher=B,this._animationsModuleType=G}create(t){const o=this._createHostElement(),c=this._createPaneElement(o),u=this._createPortalOutlet(c),f=new Sz(t);return f.direction=f.direction||this._directionality.value,new Rz(u,o,c,f,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(t){const o=this._document.createElement("div");return o.id="cdk-overlay-"+Pz++,o.classList.add("cdk-overlay-pane"),t.appendChild(o),o}_createHostElement(){const t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(Yr)),new _z(t,this._componentFactoryResolver,this._appRef,this._injector,this._document)}static#e=this.\u0275fac=function(o){return new(o||e)(be(Cz),be(_5),be(Dh),be(Nz),be(Iz),be(pr),be(it),be(sn),be(NU),be(Hi),be(wz),be(bc,8))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const kz={provide:new De("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{const e=Te(Sb);return()=>e.scrollStrategies.reposition()}}),deps:[Sb],useFactory:function xz(e){return()=>e.scrollStrategies.reposition()}};let Lz=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({providers:[Sb,kz],imports:[mI,Ez,u5,u5]})}return e})();const Fz=["tooltip"],S5=new De("mat-tooltip-scroll-strategy",{providedIn:"root",factory:()=>{const e=Te(Sb);return()=>e.scrollStrategies.reposition({scrollThrottle:20})}}),Vz={provide:S5,deps:[Sb],useFactory:function Uz(e){return()=>e.scrollStrategies.reposition({scrollThrottle:20})}},jz=new De("mat-tooltip-default-options",{providedIn:"root",factory:function Bz(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}}),T5="tooltip-panel",I5=vb({passive:!0});let qz=(()=>{class e{get position(){return this._position}set position(t){t!==this._position&&(this._position=t,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(t){this._positionAtOrigin=bb(t),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(t){this._disabled=bb(t),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(t){this._showDelay=m4(t)}get hideDelay(){return this._hideDelay}set hideDelay(t){this._hideDelay=m4(t),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(t){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=null!=t?String(t).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(t){this._tooltipClass=t,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}constructor(t,o,c,u,f,g,E,C,R,P,B,G){this._overlay=t,this._elementRef=o,this._scrollDispatcher=c,this._viewContainerRef=u,this._ngZone=f,this._platform=g,this._ariaDescriber=E,this._focusMonitor=C,this._dir=P,this._defaultOptions=B,this._position="below",this._positionAtOrigin=!1,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._tooltipComponent=Yz,this._viewportMargin=8,this._cssClassPrefix="mat-mdc",this.touchGestures="auto",this._message="",this._passiveListeners=[],this._destroyed=new en,this._scrollStrategy=R,this._document=G,B&&(this._showDelay=B.showDelay,this._hideDelay=B.hideDelay,B.position&&(this.position=B.position),B.positionAtOrigin&&(this.positionAtOrigin=B.positionAtOrigin),B.touchGestures&&(this.touchGestures=B.touchGestures)),P.change.pipe(zo(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)}),this._viewportMargin=8}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(zo(this._destroyed)).subscribe(t=>{t?"keyboard"===t&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const t=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([o,c])=>{t.removeEventListener(o,c,I5)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(t,this.message,"tooltip"),this._focusMonitor.stopMonitoring(t)}show(t=this.showDelay,o){if(this.disabled||!this.message||this._isTooltipVisible())return void this._tooltipInstance?._cancelPendingAnimations();const c=this._createOverlay(o);this._detach(),this._portal=this._portal||new h5(this._tooltipComponent,this._viewContainerRef);const u=this._tooltipInstance=c.attach(this._portal).instance;u._triggerElement=this._elementRef.nativeElement,u._mouseLeaveHideDelay=this._hideDelay,u.afterHidden().pipe(zo(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),u.show(t)}hide(t=this.hideDelay){const o=this._tooltipInstance;o&&(o.isVisible()?o.hide(t):(o._cancelPendingAnimations(),this._detach()))}toggle(t){this._isTooltipVisible()?this.hide():this.show(void 0,t)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(t){if(this._overlayRef){const u=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!t)&&u._origin instanceof tn)return this._overlayRef;this._detach()}const o=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),c=this._overlay.position().flexibleConnectedTo(this.positionAtOrigin&&t||this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(o);return c.positionChanges.pipe(zo(this._destroyed)).subscribe(u=>{this._updateCurrentPositionClass(u.connectionPair),this._tooltipInstance&&u.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:c,panelClass:`${this._cssClassPrefix}-${T5}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(zo(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(zo(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(zo(this._destroyed)).subscribe(u=>{this._isTooltipVisible()&&27===u.keyCode&&!function LG(e,...n){return n.length?n.some(t=>e[t]):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}(u)&&(u.preventDefault(),u.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(t){const o=t.getConfig().positionStrategy,c=this._getOrigin(),u=this._getOverlayPosition();o.withPositions([this._addOffset({...c.main,...u.main}),this._addOffset({...c.fallback,...u.fallback})])}_addOffset(t){const c=!this._dir||"ltr"==this._dir.value;return"top"===t.originY?t.offsetY=-8:"bottom"===t.originY?t.offsetY=8:"start"===t.originX?t.offsetX=c?-8:8:"end"===t.originX&&(t.offsetX=c?8:-8),t}_getOrigin(){const t=!this._dir||"ltr"==this._dir.value,o=this.position;let c;"above"==o||"below"==o?c={originX:"center",originY:"above"==o?"top":"bottom"}:"before"==o||"left"==o&&t||"right"==o&&!t?c={originX:"start",originY:"center"}:("after"==o||"right"==o&&t||"left"==o&&!t)&&(c={originX:"end",originY:"center"});const{x:u,y:f}=this._invertPosition(c.originX,c.originY);return{main:c,fallback:{originX:u,originY:f}}}_getOverlayPosition(){const t=!this._dir||"ltr"==this._dir.value,o=this.position;let c;"above"==o?c={overlayX:"center",overlayY:"bottom"}:"below"==o?c={overlayX:"center",overlayY:"top"}:"before"==o||"left"==o&&t||"right"==o&&!t?c={overlayX:"end",overlayY:"center"}:("after"==o||"right"==o&&t||"left"==o&&!t)&&(c={overlayX:"start",overlayY:"center"});const{x:u,y:f}=this._invertPosition(c.overlayX,c.overlayY);return{main:c,fallback:{overlayX:u,overlayY:f}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(Vr(1),zo(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(t){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=t,this._tooltipInstance._markForCheck())}_invertPosition(t,o){return"above"===this.position||"below"===this.position?"top"===o?o="bottom":"bottom"===o&&(o="top"):"end"===t?t="start":"start"===t&&(t="end"),{x:t,y:o}}_updateCurrentPositionClass(t){const{overlayY:o,originX:c,originY:u}=t;let f;if(f="center"===o?this._dir&&"rtl"===this._dir.value?"end"===c?"left":"right":"start"===c?"left":"right":"bottom"===o&&"top"===u?"above":"below",f!==this._currentPosition){const g=this._overlayRef;if(g){const E=`${this._cssClassPrefix}-${T5}-`;g.removePanelClass(E+this._currentPosition),g.addPanelClass(E+f)}this._currentPosition=f}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",t=>{let o;this._setupPointerExitEventsIfNeeded(),void 0!==t.x&&void 0!==t.y&&(o=t),this.show(void 0,o)}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",t=>{const o=t.targetTouches?.[0],c=o?{x:o.clientX,y:o.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(void 0,c),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const t=[];if(this._platformSupportsMouseEvents())t.push(["mouseleave",o=>{const c=o.relatedTarget;(!c||!this._overlayRef?.overlayElement.contains(c))&&this.hide()}],["wheel",o=>this._wheelListener(o)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const o=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};t.push(["touchend",o],["touchcancel",o])}this._addListeners(t),this._passiveListeners.push(...t)}_addListeners(t){t.forEach(([o,c])=>{this._elementRef.nativeElement.addEventListener(o,c,I5)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(t){if(this._isTooltipVisible()){const o=this._document.elementFromPoint(t.clientX,t.clientY),c=this._elementRef.nativeElement;o!==c&&!c.contains(o)&&this.hide()}}_disableNativeGesturesIfNecessary(){const t=this.touchGestures;if("off"!==t){const o=this._elementRef.nativeElement,c=o.style;("on"===t||"INPUT"!==o.nodeName&&"TEXTAREA"!==o.nodeName)&&(c.userSelect=c.msUserSelect=c.webkitUserSelect=c.MozUserSelect="none"),("on"===t||!o.draggable)&&(c.webkitUserDrag="none"),c.touchAction="none",c.webkitTapHighlightColor="transparent"}}static#e=this.\u0275fac=function(o){return new(o||e)(ae(Sb),ae(tn),ae(d5),ae(mr),ae(it),ae(Eo),ae(eW),ae(DU),ae(S5),ae(NU),ae(jz,8),ae(sn))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],hostVars:2,hostBindings:function(o,c){2&o&&Ht("mat-mdc-tooltip-disabled",c.disabled)},inputs:{position:[Xe.None,"matTooltipPosition","position"],positionAtOrigin:[Xe.None,"matTooltipPositionAtOrigin","positionAtOrigin"],disabled:[Xe.None,"matTooltipDisabled","disabled"],showDelay:[Xe.None,"matTooltipShowDelay","showDelay"],hideDelay:[Xe.None,"matTooltipHideDelay","hideDelay"],touchGestures:[Xe.None,"matTooltipTouchGestures","touchGestures"],message:[Xe.None,"matTooltip","message"],tooltipClass:[Xe.None,"matTooltipClass","tooltipClass"]},exportAs:["matTooltip"],standalone:!0})}return e})(),Yz=(()=>{class e{constructor(t,o,c){this._changeDetectorRef=t,this._elementRef=o,this._isMultiline=!1,this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new en,this._showAnimation="mat-mdc-tooltip-show",this._hideAnimation="mat-mdc-tooltip-hide",this._animationsDisabled="NoopAnimations"===c}show(t){null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},t)}hide(t){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},t)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:t}){(!t||!this._triggerElement.contains(t))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){const t=this._elementRef.nativeElement.getBoundingClientRect();return t.height>24&&t.width>=200}_handleAnimationEnd({animationName:t}){(t===this._showAnimation||t===this._hideAnimation)&&this._finalizeAnimation(t===this._showAnimation)}_cancelPendingAnimations(){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(t){t?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(t){const o=this._tooltip.nativeElement,c=this._showAnimation,u=this._hideAnimation;if(o.classList.remove(t?u:c),o.classList.add(t?c:u),this._isVisible=t,t&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const f=getComputedStyle(o);("0s"===f.getPropertyValue("animation-duration")||"none"===f.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}t&&this._onShow(),this._animationsDisabled&&(o.classList.add("_mat-animation-noopable"),this._finalizeAnimation(t))}static#e=this.\u0275fac=function(o){return new(o||e)(ae(Us),ae(tn),ae(bc,8))};static#t=this.\u0275cmp=Br({type:e,selectors:[["mat-tooltip-component"]],viewQuery:function(o,c){if(1&o&&ha(Fz,7),2&o){let u;Zi(u=ar())&&(c._tooltip=u.first)}},hostAttrs:["aria-hidden","true"],hostVars:2,hostBindings:function(o,c){1&o&&gn("mouseleave",function(f){return c._handleMouseLeave(f)}),2&o&&ov("zoom",c.isVisible()?1:null)},standalone:!0,features:[Hc],decls:4,vars:4,consts:[[1,"mdc-tooltip","mdc-tooltip--shown","mat-mdc-tooltip",3,"ngClass","animationend"],["tooltip",""],[1,"mdc-tooltip__surface","mdc-tooltip__surface-animation"]],template:function(o,c){1&o&&(oe(0,"div",0,1),gn("animationend",function(f){return c._handleAnimationEnd(f)}),oe(2,"div",2),br(3),Ee()()),2&o&&(Ht("mdc-tooltip--multiline",c._isMultiline),Ze("ngClass",c.tooltipClass),Qe(3),cu(c.message))},dependencies:[F0],styles:['.mdc-tooltip__surface{word-break:break-all;word-break:var(--mdc-tooltip-word-break, normal);overflow-wrap:anywhere}.mdc-tooltip--showing-transition .mdc-tooltip__surface-animation{transition:opacity 150ms 0ms cubic-bezier(0, 0, 0.2, 1),transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-tooltip--hide-transition .mdc-tooltip__surface-animation{transition:opacity 75ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-tooltip{position:fixed;display:none;z-index:9}.mdc-tooltip-wrapper--rich{position:relative}.mdc-tooltip--shown,.mdc-tooltip--showing,.mdc-tooltip--hide{display:inline-flex}.mdc-tooltip--shown.mdc-tooltip--rich,.mdc-tooltip--showing.mdc-tooltip--rich,.mdc-tooltip--hide.mdc-tooltip--rich{display:inline-block;left:-320px;position:absolute}.mdc-tooltip__surface{line-height:16px;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center}.mdc-tooltip__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-tooltip__surface::before{border-color:CanvasText}}.mdc-tooltip--rich .mdc-tooltip__surface{align-items:flex-start;display:flex;flex-direction:column;min-height:24px;min-width:40px;max-width:320px;position:relative}.mdc-tooltip--multiline .mdc-tooltip__surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mdc-tooltip__surface,.mdc-tooltip--multiline .mdc-tooltip__surface[dir=rtl]{text-align:right}.mdc-tooltip__surface .mdc-tooltip__title{margin:0 8px}.mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(200px - 2*8px);margin:8px;text-align:left}[dir=rtl] .mdc-tooltip__surface .mdc-tooltip__content,.mdc-tooltip__surface .mdc-tooltip__content[dir=rtl]{text-align:right}.mdc-tooltip--rich .mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(320px - 2*8px);align-self:stretch}.mdc-tooltip__surface .mdc-tooltip__content-link{text-decoration:none}.mdc-tooltip--rich-actions,.mdc-tooltip__content,.mdc-tooltip__title{z-index:1}.mdc-tooltip__surface-animation{opacity:0;transform:scale(0.8);will-change:transform,opacity}.mdc-tooltip--shown .mdc-tooltip__surface-animation{transform:scale(1);opacity:1}.mdc-tooltip--hide .mdc-tooltip__surface-animation{transform:scale(1)}.mdc-tooltip__caret-surface-top,.mdc-tooltip__caret-surface-bottom{position:absolute;height:24px;width:24px;transform:rotate(35deg) skewY(20deg) scaleX(0.9396926208)}.mdc-tooltip__caret-surface-top .mdc-elevation-overlay,.mdc-tooltip__caret-surface-bottom .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-tooltip__caret-surface-bottom{box-shadow:0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12);outline:1px solid rgba(0,0,0,0);z-index:-1}@media screen and (forced-colors: active){.mdc-tooltip__caret-surface-bottom{outline-color:CanvasText}}.mat-mdc-tooltip .mdc-tooltip__surface{background-color:var(--mdc-plain-tooltip-container-color)}.mat-mdc-tooltip .mdc-tooltip__surface{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__caret-surface-top,.mat-mdc-tooltip .mdc-tooltip__caret-surface-bottom{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__surface{color:var(--mdc-plain-tooltip-supporting-text-color)}.mat-mdc-tooltip .mdc-tooltip__surface{font-family:var(--mdc-plain-tooltip-supporting-text-font);line-height:var(--mdc-plain-tooltip-supporting-text-line-height);font-size:var(--mdc-plain-tooltip-supporting-text-size);font-weight:var(--mdc-plain-tooltip-supporting-text-weight);letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking)}.mat-mdc-tooltip{position:relative;transform:scale(0)}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-panel.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}'],encapsulation:2,changeDetection:0})}return e})(),$z=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({providers:[Vz],imports:[uW,Pu,Lz,tc,tc,HU]})}return e})();function w5(e){return new he(3e3,!1)}function Bp(e){switch(e.length){case 0:return new vI;case 1:return e[0];default:return new z4(e)}}function R5(e,n,t=new Map,o=new Map){const c=[],u=[];let f=-1,g=null;if(n.forEach(E=>{const C=E.get("offset"),R=C==f,P=R&&g||new Map;E.forEach((B,G)=>{let Y=G,J=B;if("offset"!==G)switch(Y=e.normalizePropertyName(Y,c),J){case"!":J=t.get(G);break;case Lu:J=o.get(G);break;default:J=e.normalizeStyleValue(G,Y,J,c)}P.set(Y,J)}),R||u.push(P),g=P,f=C}),c.length)throw function E7(e){return new he(3502,!1)}();return u}function zU(e,n,t,o){switch(n){case"start":e.onStart(()=>o(t&&KU(t,"start",e)));break;case"done":e.onDone(()=>o(t&&KU(t,"done",e)));break;case"destroy":e.onDestroy(()=>o(t&&KU(t,"destroy",e)))}}function KU(e,n,t){const u=qU(e.element,e.triggerName,e.fromState,e.toState,n||e.phaseName,t.totalTime??e.totalTime,!!t.disabled),f=e._data;return null!=f&&(u._data=f),u}function qU(e,n,t,o,c="",u=0,f){return{element:e,triggerName:n,fromState:t,toState:o,phaseName:c,totalTime:u,disabled:!!f}}function va(e,n,t){let o=e.get(n);return o||e.set(n,o=t),o}function A5(e){const n=e.indexOf(":");return[e.substring(1,n),e.slice(n+1)]}const O7=typeof document>"u"?null:document.documentElement;function YU(e){const n=e.parentNode||e.host||null;return n===O7?null:n}let Ig=null,D5=!1;function O5(e,n){for(;n;){if(n===e)return!0;n=YU(n)}return!1}function N5(e,n,t){if(t)return Array.from(e.querySelectorAll(n));const o=e.querySelector(n);return o?[o]:[]}let $U=(()=>{class e{validateStyleProperty(t){return function P7(e){Ig||(Ig=function M7(){return typeof document<"u"?document.body:null}()||{},D5=!!Ig.style&&"WebkitAppearance"in Ig.style);let n=!0;return Ig.style&&!function N7(e){return"ebkit"==e.substring(1,6)}(e)&&(n=e in Ig.style,!n&&D5&&(n="Webkit"+e.charAt(0).toUpperCase()+e.slice(1)in Ig.style)),n}(t)}matchesElement(t,o){return!1}containsElement(t,o){return O5(t,o)}getParentElement(t){return YU(t)}query(t,o,c){return N5(t,o,c)}computeStyle(t,o,c){return c||""}animate(t,o,c,u,f,g=[],E){return new vI(c,u)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();class XU{static#e=this.NOOP=new $U}class JU{}const k7=1e3,QU="ng-enter",EM="ng-leave",vM="ng-trigger",bM=".ng-trigger",M5="ng-animating",ZU=".ng-animating";function Fu(e){if("number"==typeof e)return e;const n=e.match(/^(-?[\.\d]+)(m?s)/);return!n||n.length<2?0:eV(parseFloat(n[1]),n[2])}function eV(e,n){return"s"===n?e*k7:e}function yM(e,n,t){return e.hasOwnProperty("duration")?e:function F7(e,n,t){let c,u=0,f="";if("string"==typeof e){const g=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===g)return n.push(w5()),{duration:0,delay:0,easing:""};c=eV(parseFloat(g[1]),g[2]);const E=g[3];null!=E&&(u=eV(parseFloat(E),g[4]));const C=g[5];C&&(f=C)}else c=e;if(!t){let g=!1,E=n.length;c<0&&(n.push(function Xz(){return new he(3100,!1)}()),g=!0),u<0&&(n.push(function Jz(){return new he(3101,!1)}()),g=!0),g&&n.splice(E,0,w5())}return{duration:c,delay:u,easing:f}}(e,n,t)}function al(e,n,t){n.forEach((o,c)=>{const u=nV(c);t&&!t.has(c)&&t.set(c,e.style[u]),e.style[u]=o})}function wg(e,n){n.forEach((t,o)=>{const c=nV(o);e.style[c]=""})}function yI(e){return Array.isArray(e)?1==e.length?e[0]:function $W(e,n=null){return{type:bt.Sequence,steps:e,options:n}}(e):e}const tV=new RegExp("{{\\s*(.+?)\\s*}}","g");function k5(e){let n=[];if("string"==typeof e){let t;for(;t=tV.exec(e);)n.push(t[1]);tV.lastIndex=0}return n}function CI(e,n,t){const o=`${e}`,c=o.replace(tV,(u,f)=>{let g=n[f];return null==g&&(t.push(function Zz(e){return new he(3003,!1)}()),g=""),g.toString()});return c==o?e:c}const B7=/-+([a-z0-9])/g;function nV(e){return e.replace(B7,(...n)=>n[1].toUpperCase())}function ba(e,n,t){switch(n.type){case bt.Trigger:return e.visitTrigger(n,t);case bt.State:return e.visitState(n,t);case bt.Transition:return e.visitTransition(n,t);case bt.Sequence:return e.visitSequence(n,t);case bt.Group:return e.visitGroup(n,t);case bt.Animate:return e.visitAnimate(n,t);case bt.Keyframes:return e.visitKeyframes(n,t);case bt.Style:return e.visitStyle(n,t);case bt.Reference:return e.visitReference(n,t);case bt.AnimateChild:return e.visitAnimateChild(n,t);case bt.AnimateRef:return e.visitAnimateRef(n,t);case bt.Query:return e.visitQuery(n,t);case bt.Stagger:return e.visitStagger(n,t);default:throw function e7(e){return new he(3004,!1)}()}}function iV(e,n){return window.getComputedStyle(e)[n]}const G7=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class L5 extends JU{normalizePropertyName(n,t){return nV(n)}normalizeStyleValue(n,t,o,c){let u="";const f=o.toString().trim();if(G7.has(t)&&0!==o&&"0"!==o)if("number"==typeof o)u="px";else{const g=o.match(/^[+-]?[\d\.]+([a-z]*)$/);g&&0==g[1].length&&c.push(function t7(e,n){return new he(3005,!1)}())}return f+u}}const CM="*";const SM=new Set(["true","1"]),TM=new Set(["false","0"]);function F5(e,n){const t=SM.has(e)||TM.has(e),o=SM.has(n)||TM.has(n);return(c,u)=>{let f=e==CM||e==c,g=n==CM||n==u;return!f&&t&&"boolean"==typeof c&&(f=c?SM.has(e):TM.has(e)),!g&&o&&"boolean"==typeof u&&(g=u?SM.has(n):TM.has(n)),f&&g}}const q7=new RegExp("s*:selfs*,?","g");function rV(e,n,t,o){return new Y7(e).build(n,t,o)}class Y7{constructor(n){this._driver=n}build(n,t,o){const c=new J7(t);return this._resetContextStyleTimingState(c),ba(this,yI(n),c)}_resetContextStyleTimingState(n){n.currentQuerySelector="",n.collectedStyles=new Map,n.collectedStyles.set("",new Map),n.currentTime=0}visitTrigger(n,t){let o=t.queryCount=0,c=t.depCount=0;const u=[],f=[];return"@"==n.name.charAt(0)&&t.errors.push(function n7(){return new he(3006,!1)}()),n.definitions.forEach(g=>{if(this._resetContextStyleTimingState(t),g.type==bt.State){const E=g,C=E.name;C.toString().split(/\s*,\s*/).forEach(R=>{E.name=R,u.push(this.visitState(E,t))}),E.name=C}else if(g.type==bt.Transition){const E=this.visitTransition(g,t);o+=E.queryCount,c+=E.depCount,f.push(E)}else t.errors.push(function i7(){return new he(3007,!1)}())}),{type:bt.Trigger,name:n.name,states:u,transitions:f,queryCount:o,depCount:c,options:null}}visitState(n,t){const o=this.visitStyle(n.styles,t),c=n.options&&n.options.params||null;if(o.containsDynamicStyles){const u=new Set,f=c||{};o.styles.forEach(g=>{g instanceof Map&&g.forEach(E=>{k5(E).forEach(C=>{f.hasOwnProperty(C)||u.add(C)})})}),u.size&&t.errors.push(function r7(e,n){return new he(3008,!1)}(0,u.values()))}return{type:bt.State,name:n.name,style:o,options:c?{params:c}:null}}visitTransition(n,t){t.queryCount=0,t.depCount=0;const o=ba(this,yI(n.animation),t),c=function W7(e,n){const t=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(o=>function z7(e,n,t){if(":"==e[0]){const E=function K7(e,n){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,o)=>parseFloat(o)>parseFloat(t);case":decrement":return(t,o)=>parseFloat(o)<parseFloat(t);default:return n.push(function f7(e){return new he(3016,!1)}()),"* => *"}}(e,t);if("function"==typeof E)return void n.push(E);e=E}const o=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==o||o.length<4)return t.push(function p7(e){return new he(3015,!1)}()),n;const c=o[1],u=o[2],f=o[3];n.push(F5(c,f)),"<"==u[0]&&(c!=CM||f!=CM)&&n.push(F5(f,c))}(o,t,n)):t.push(e),t}(n.expr,t.errors);return{type:bt.Transition,matchers:c,animation:o,queryCount:t.queryCount,depCount:t.depCount,options:Rg(n.options)}}visitSequence(n,t){return{type:bt.Sequence,steps:n.steps.map(o=>ba(this,o,t)),options:Rg(n.options)}}visitGroup(n,t){const o=t.currentTime;let c=0;const u=n.steps.map(f=>{t.currentTime=o;const g=ba(this,f,t);return c=Math.max(c,t.currentTime),g});return t.currentTime=c,{type:bt.Group,steps:u,options:Rg(n.options)}}visitAnimate(n,t){const o=function Z7(e,n){if(e.hasOwnProperty("duration"))return e;if("number"==typeof e)return oV(yM(e,n).duration,0,"");const t=e;if(t.split(/\s+/).some(u=>"{"==u.charAt(0)&&"{"==u.charAt(1))){const u=oV(0,0,"");return u.dynamic=!0,u.strValue=t,u}const c=yM(t,n);return oV(c.duration,c.delay,c.easing)}(n.timings,t.errors);t.currentAnimateTimings=o;let c,u=n.styles?n.styles:sl({});if(u.type==bt.Keyframes)c=this.visitKeyframes(u,t);else{let f=n.styles,g=!1;if(!f){g=!0;const C={};o.easing&&(C.easing=o.easing),f=sl(C)}t.currentTime+=o.duration+o.delay;const E=this.visitStyle(f,t);E.isEmptyStep=g,c=E}return t.currentAnimateTimings=null,{type:bt.Animate,timings:o,style:c,options:null}}visitStyle(n,t){const o=this._makeStyleAst(n,t);return this._validateStyleAst(o,t),o}_makeStyleAst(n,t){const o=[],c=Array.isArray(n.styles)?n.styles:[n.styles];for(let g of c)"string"==typeof g?g===Lu?o.push(g):t.errors.push(new he(3002,!1)):o.push(new Map(Object.entries(g)));let u=!1,f=null;return o.forEach(g=>{if(g instanceof Map&&(g.has("easing")&&(f=g.get("easing"),g.delete("easing")),!u))for(let E of g.values())if(E.toString().indexOf("{{")>=0){u=!0;break}}),{type:bt.Style,styles:o,easing:f,offset:n.offset,containsDynamicStyles:u,options:null}}_validateStyleAst(n,t){const o=t.currentAnimateTimings;let c=t.currentTime,u=t.currentTime;o&&u>0&&(u-=o.duration+o.delay),n.styles.forEach(f=>{"string"!=typeof f&&f.forEach((g,E)=>{const C=t.collectedStyles.get(t.currentQuerySelector),R=C.get(E);let P=!0;R&&(u!=c&&u>=R.startTime&&c<=R.endTime&&(t.errors.push(function s7(e,n,t,o,c){return new he(3010,!1)}()),P=!1),u=R.startTime),P&&C.set(E,{startTime:u,endTime:c}),t.options&&function V7(e,n,t){const o=n.params||{},c=k5(e);c.length&&c.forEach(u=>{o.hasOwnProperty(u)||t.push(function Qz(e){return new he(3001,!1)}())})}(g,t.options,t.errors)})})}visitKeyframes(n,t){const o={type:bt.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function a7(){return new he(3011,!1)}()),o;let u=0;const f=[];let g=!1,E=!1,C=0;const R=n.steps.map(ge=>{const de=this._makeStyleAst(ge,t);let Le=null!=de.offset?de.offset:function Q7(e){if("string"==typeof e)return null;let n=null;if(Array.isArray(e))e.forEach(t=>{if(t instanceof Map&&t.has("offset")){const o=t;n=parseFloat(o.get("offset")),o.delete("offset")}});else if(e instanceof Map&&e.has("offset")){const t=e;n=parseFloat(t.get("offset")),t.delete("offset")}return n}(de.styles),He=0;return null!=Le&&(u++,He=de.offset=Le),E=E||He<0||He>1,g=g||He<C,C=He,f.push(He),de});E&&t.errors.push(function c7(){return new he(3012,!1)}()),g&&t.errors.push(function d7(){return new he(3200,!1)}());const P=n.steps.length;let B=0;u>0&&u<P?t.errors.push(function l7(){return new he(3202,!1)}()):0==u&&(B=1/(P-1));const G=P-1,Y=t.currentTime,J=t.currentAnimateTimings,le=J.duration;return R.forEach((ge,de)=>{const Le=B>0?de==G?1:B*de:f[de],He=Le*le;t.currentTime=Y+J.delay+He,J.duration=He,this._validateStyleAst(ge,t),ge.offset=Le,o.styles.push(ge)}),o}visitReference(n,t){return{type:bt.Reference,animation:ba(this,yI(n.animation),t),options:Rg(n.options)}}visitAnimateChild(n,t){return t.depCount++,{type:bt.AnimateChild,options:Rg(n.options)}}visitAnimateRef(n,t){return{type:bt.AnimateRef,animation:this.visitReference(n.animation,t),options:Rg(n.options)}}visitQuery(n,t){const o=t.currentQuerySelector,c=n.options||{};t.queryCount++,t.currentQuery=n;const[u,f]=function $7(e){const n=!!e.split(/\s*,\s*/).find(t=>":self"==t);return n&&(e=e.replace(q7,"")),e=e.replace(/@\*/g,bM).replace(/@\w+/g,t=>bM+"-"+t.slice(1)).replace(/:animating/g,ZU),[e,n]}(n.selector);t.currentQuerySelector=o.length?o+" "+u:u,va(t.collectedStyles,t.currentQuerySelector,new Map);const g=ba(this,yI(n.animation),t);return t.currentQuery=null,t.currentQuerySelector=o,{type:bt.Query,selector:u,limit:c.limit||0,optional:!!c.optional,includeSelf:f,animation:g,originalSelector:n.selector,options:Rg(n.options)}}visitStagger(n,t){t.currentQuery||t.errors.push(function u7(){return new he(3013,!1)}());const o="full"===n.timings?{duration:0,delay:0,easing:"full"}:yM(n.timings,t.errors,!0);return{type:bt.Stagger,animation:ba(this,yI(n.animation),t),timings:o,options:null}}}class J7{constructor(n){this.errors=n,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function Rg(e){return e?(e={...e}).params&&(e.params=function X7(e){return e?{...e}:null}(e.params)):e={},e}function oV(e,n,t){return{duration:e,delay:n,easing:t}}function sV(e,n,t,o,c,u,f=null,g=!1){return{type:1,element:e,keyframes:n,preStyleProps:t,postStyleProps:o,duration:c,delay:u,totalTime:c+u,easing:f,subTimeline:g}}class IM{constructor(){this._map=new Map}get(n){return this._map.get(n)||[]}append(n,t){let o=this._map.get(n);o||this._map.set(n,o=[]),o.push(...t)}has(n){return this._map.has(n)}clear(){this._map.clear()}}const nK=new RegExp(":enter","g"),rK=new RegExp(":leave","g");function aV(e,n,t,o,c,u=new Map,f=new Map,g,E,C=[]){return(new oK).buildKeyframes(e,n,t,o,c,u,f,g,E,C)}class oK{buildKeyframes(n,t,o,c,u,f,g,E,C,R=[]){C=C||new IM;const P=new cV(n,t,C,c,u,R,[]);P.options=E;const B=E.delay?Fu(E.delay):0;P.currentTimeline.delayNextStep(B),P.currentTimeline.setStyles([f],null,P.errors,E),ba(this,o,P);const G=P.timelines.filter(Y=>Y.containsAnimation());if(G.length&&g.size){let Y;for(let J=G.length-1;J>=0;J--){const le=G[J];if(le.element===t){Y=le;break}}Y&&!Y.allowOnlyTimelineStyles()&&Y.setStyles([g],null,P.errors,E)}return G.length?G.map(Y=>Y.buildKeyframes()):[sV(t,[],[],[],0,B,"",!1)]}visitTrigger(n,t){}visitState(n,t){}visitTransition(n,t){}visitAnimateChild(n,t){const o=t.subInstructions.get(t.element);if(o){const c=t.createSubContext(n.options),u=t.currentTimeline.currentTime,f=this._visitSubInstructions(o,c,c.options);u!=f&&t.transformIntoNewTimeline(f)}t.previousNode=n}visitAnimateRef(n,t){const o=t.createSubContext(n.options);o.transformIntoNewTimeline(),this._applyAnimationRefDelays([n.options,n.animation.options],t,o),this.visitReference(n.animation,o),t.transformIntoNewTimeline(o.currentTimeline.currentTime),t.previousNode=n}_applyAnimationRefDelays(n,t,o){for(const c of n){const u=c?.delay;if(u){const f="number"==typeof u?u:Fu(CI(u,c?.params??{},t.errors));o.delayNextStep(f)}}}_visitSubInstructions(n,t,o){let u=t.currentTimeline.currentTime;const f=null!=o.duration?Fu(o.duration):null,g=null!=o.delay?Fu(o.delay):null;return 0!==f&&n.forEach(E=>{const C=t.appendInstructionToTimeline(E,f,g);u=Math.max(u,C.duration+C.delay)}),u}visitReference(n,t){t.updateOptions(n.options,!0),ba(this,n.animation,t),t.previousNode=n}visitSequence(n,t){const o=t.subContextCount;let c=t;const u=n.options;if(u&&(u.params||u.delay)&&(c=t.createSubContext(u),c.transformIntoNewTimeline(),null!=u.delay)){c.previousNode.type==bt.Style&&(c.currentTimeline.snapshotCurrentStyles(),c.previousNode=wM);const f=Fu(u.delay);c.delayNextStep(f)}n.steps.length&&(n.steps.forEach(f=>ba(this,f,c)),c.currentTimeline.applyStylesToKeyframe(),c.subContextCount>o&&c.transformIntoNewTimeline()),t.previousNode=n}visitGroup(n,t){const o=[];let c=t.currentTimeline.currentTime;const u=n.options&&n.options.delay?Fu(n.options.delay):0;n.steps.forEach(f=>{const g=t.createSubContext(n.options);u&&g.delayNextStep(u),ba(this,f,g),c=Math.max(c,g.currentTimeline.currentTime),o.push(g.currentTimeline)}),o.forEach(f=>t.currentTimeline.mergeTimelineCollectedStyles(f)),t.transformIntoNewTimeline(c),t.previousNode=n}_visitTiming(n,t){if(n.dynamic){const o=n.strValue;return yM(t.params?CI(o,t.params,t.errors):o,t.errors)}return{duration:n.duration,delay:n.delay,easing:n.easing}}visitAnimate(n,t){const o=t.currentAnimateTimings=this._visitTiming(n.timings,t),c=t.currentTimeline;o.delay&&(t.incrementTime(o.delay),c.snapshotCurrentStyles());const u=n.style;u.type==bt.Keyframes?this.visitKeyframes(u,t):(t.incrementTime(o.duration),this.visitStyle(u,t),c.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=n}visitStyle(n,t){const o=t.currentTimeline,c=t.currentAnimateTimings;!c&&o.hasCurrentStyleProperties()&&o.forwardFrame();const u=c&&c.easing||n.easing;n.isEmptyStep?o.applyEmptyStep(u):o.setStyles(n.styles,u,t.errors,t.options),t.previousNode=n}visitKeyframes(n,t){const o=t.currentAnimateTimings,c=t.currentTimeline.duration,u=o.duration,g=t.createSubContext().currentTimeline;g.easing=o.easing,n.styles.forEach(E=>{g.forwardTime((E.offset||0)*u),g.setStyles(E.styles,E.easing,t.errors,t.options),g.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(g),t.transformIntoNewTimeline(c+u),t.previousNode=n}visitQuery(n,t){const o=t.currentTimeline.currentTime,c=n.options||{},u=c.delay?Fu(c.delay):0;u&&(t.previousNode.type===bt.Style||0==o&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=wM);let f=o;const g=t.invokeQuery(n.selector,n.originalSelector,n.limit,n.includeSelf,!!c.optional,t.errors);t.currentQueryTotal=g.length;let E=null;g.forEach((C,R)=>{t.currentQueryIndex=R;const P=t.createSubContext(n.options,C);u&&P.delayNextStep(u),C===t.element&&(E=P.currentTimeline),ba(this,n.animation,P),P.currentTimeline.applyStylesToKeyframe(),f=Math.max(f,P.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(f),E&&(t.currentTimeline.mergeTimelineCollectedStyles(E),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=n}visitStagger(n,t){const o=t.parentContext,c=t.currentTimeline,u=n.timings,f=Math.abs(u.duration),g=f*(t.currentQueryTotal-1);let E=f*t.currentQueryIndex;switch(u.duration<0?"reverse":u.easing){case"reverse":E=g-E;break;case"full":E=o.currentStaggerTime}const R=t.currentTimeline;E&&R.delayNextStep(E);const P=R.currentTime;ba(this,n.animation,t),t.previousNode=n,o.currentStaggerTime=c.currentTime-P+(c.startTime-o.currentTimeline.startTime)}}const wM={};class cV{constructor(n,t,o,c,u,f,g,E){this._driver=n,this.element=t,this.subInstructions=o,this._enterClassName=c,this._leaveClassName=u,this.errors=f,this.timelines=g,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=wM,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=E||new RM(this._driver,t,0),g.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(n,t){if(!n)return;const o=n;let c=this.options;null!=o.duration&&(c.duration=Fu(o.duration)),null!=o.delay&&(c.delay=Fu(o.delay));const u=o.params;if(u){let f=c.params;f||(f=this.options.params={}),Object.keys(u).forEach(g=>{(!t||!f.hasOwnProperty(g))&&(f[g]=CI(u[g],f,this.errors))})}}_copyOptions(){const n={};if(this.options){const t=this.options.params;if(t){const o=n.params={};Object.keys(t).forEach(c=>{o[c]=t[c]})}}return n}createSubContext(n=null,t,o){const c=t||this.element,u=new cV(this._driver,c,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(c,o||0));return u.previousNode=this.previousNode,u.currentAnimateTimings=this.currentAnimateTimings,u.options=this._copyOptions(),u.updateOptions(n),u.currentQueryIndex=this.currentQueryIndex,u.currentQueryTotal=this.currentQueryTotal,u.parentContext=this,this.subContextCount++,u}transformIntoNewTimeline(n){return this.previousNode=wM,this.currentTimeline=this.currentTimeline.fork(this.element,n),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(n,t,o){const c={duration:t??n.duration,delay:this.currentTimeline.currentTime+(o??0)+n.delay,easing:""},u=new sK(this._driver,n.element,n.keyframes,n.preStyleProps,n.postStyleProps,c,n.stretchStartingKeyframe);return this.timelines.push(u),c}incrementTime(n){this.currentTimeline.forwardTime(this.currentTimeline.duration+n)}delayNextStep(n){n>0&&this.currentTimeline.delayNextStep(n)}invokeQuery(n,t,o,c,u,f){let g=[];if(c&&g.push(this.element),n.length>0){n=(n=n.replace(nK,"."+this._enterClassName)).replace(rK,"."+this._leaveClassName);let C=this._driver.query(this.element,n,1!=o);0!==o&&(C=o<0?C.slice(C.length+o,C.length):C.slice(0,o)),g.push(...C)}return!u&&0==g.length&&f.push(function h7(e){return new he(3014,!1)}()),g}}class RM{constructor(n,t,o,c){this._driver=n,this.element=t,this.startTime=o,this._elementTimelineStylesLookup=c,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(n){const t=1===this._keyframes.size&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+n),t&&this.snapshotCurrentStyles()):this.startTime+=n}fork(n,t){return this.applyStylesToKeyframe(),new RM(this._driver,n,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(n){this.applyStylesToKeyframe(),this.duration=n,this._loadKeyframe()}_updateStyle(n,t){this._localTimelineStyles.set(n,t),this._globalTimelineStyles.set(n,t),this._styleSummary.set(n,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(n){n&&this._previousKeyframe.set("easing",n);for(let[t,o]of this._globalTimelineStyles)this._backFill.set(t,o||Lu),this._currentKeyframe.set(t,Lu);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(n,t,o,c){t&&this._previousKeyframe.set("easing",t);const u=c&&c.params||{},f=function aK(e,n){const t=new Map;let o;return e.forEach(c=>{if("*"===c){o??=n.keys();for(let u of o)t.set(u,Lu)}else for(let[u,f]of c)t.set(u,f)}),t}(n,this._globalTimelineStyles);for(let[g,E]of f){const C=CI(E,u,o);this._pendingStyles.set(g,C),this._localTimelineStyles.has(g)||this._backFill.set(g,this._globalTimelineStyles.get(g)??Lu),this._updateStyle(g,C)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((n,t)=>{this._currentKeyframe.set(t,n)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((n,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,n)}))}snapshotCurrentStyles(){for(let[n,t]of this._localTimelineStyles)this._pendingStyles.set(n,t),this._updateStyle(n,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const n=[];for(let t in this._currentKeyframe)n.push(t);return n}mergeTimelineCollectedStyles(n){n._styleSummary.forEach((t,o)=>{const c=this._styleSummary.get(o);(!c||t.time>c.time)&&this._updateStyle(o,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();const n=new Set,t=new Set,o=1===this._keyframes.size&&0===this.duration;let c=[];this._keyframes.forEach((g,E)=>{const C=new Map([...this._backFill,...g]);C.forEach((R,P)=>{"!"===R?n.add(P):R===Lu&&t.add(P)}),o||C.set("offset",E/this.duration),c.push(C)});const u=[...n.values()],f=[...t.values()];if(o){const g=c[0],E=new Map(g);g.set("offset",0),E.set("offset",1),c=[g,E]}return sV(this.element,c,u,f,this.duration,this.startTime,this.easing,!1)}}class sK extends RM{constructor(n,t,o,c,u,f,g=!1){super(n,t,f.delay),this.keyframes=o,this.preStyleProps=c,this.postStyleProps=u,this._stretchStartingKeyframe=g,this.timings={duration:f.duration,delay:f.delay,easing:f.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let n=this.keyframes,{delay:t,duration:o,easing:c}=this.timings;if(this._stretchStartingKeyframe&&t){const u=[],f=o+t,g=t/f,E=new Map(n[0]);E.set("offset",0),u.push(E);const C=new Map(n[0]);C.set("offset",B5(g)),u.push(C);const R=n.length-1;for(let P=1;P<=R;P++){let B=new Map(n[P]);const G=B.get("offset");B.set("offset",B5((t+G*o)/f)),u.push(B)}o=f,t=0,c="",n=u}return sV(this.element,n,this.preStyleProps,this.postStyleProps,o,t,c,!0)}}function B5(e,n=3){const t=Math.pow(10,n-1);return Math.round(e*t)/t}function j5(e,n,t,o,c,u,f,g,E,C,R,P,B){return{type:0,element:e,triggerName:n,isRemovalTransition:c,fromState:t,fromStyles:u,toState:o,toStyles:f,timelines:g,queriedElements:E,preStyleProps:C,postStyleProps:R,totalTime:P,errors:B}}const dV={};class H5{constructor(n,t,o){this._triggerName=n,this.ast=t,this._stateStyles=o}match(n,t,o,c){return function cK(e,n,t,o,c){return e.some(u=>u(n,t,o,c))}(this.ast.matchers,n,t,o,c)}buildStyles(n,t,o){let c=this._stateStyles.get("*");return void 0!==n&&(c=this._stateStyles.get(n?.toString())||c),c?c.buildStyles(t,o):new Map}build(n,t,o,c,u,f,g,E,C,R){const P=[],B=this.ast.options&&this.ast.options.params||dV,Y=this.buildStyles(o,g&&g.params||dV,P),J=E&&E.params||dV,le=this.buildStyles(c,J,P),ge=new Set,de=new Map,Le=new Map,He="void"===c,ft={params:G5(J,B),delay:this.ast.options?.delay},kn=R?[]:aV(n,t,this.ast.animation,u,f,Y,le,ft,C,P);let Ir=0;return kn.forEach(Ko=>{Ir=Math.max(Ko.duration+Ko.delay,Ir)}),P.length?j5(t,this._triggerName,o,c,He,Y,le,[],[],de,Le,Ir,P):(kn.forEach(Ko=>{const Vu=Ko.element,Ub=va(de,Vu,new Set);Ko.preStyleProps.forEach(Ng=>Ub.add(Ng));const fH=va(Le,Vu,new Set);Ko.postStyleProps.forEach(Ng=>fH.add(Ng)),Vu!==t&&ge.add(Vu)}),j5(t,this._triggerName,o,c,He,Y,le,kn,[...ge.values()],de,Le,Ir))}}function G5(e,n){const t={...n};return Object.entries(e).forEach(([o,c])=>{null!=c&&(t[o]=c)}),t}class dK{constructor(n,t,o){this.styles=n,this.defaultParams=t,this.normalizer=o}buildStyles(n,t){const o=new Map,c=G5(n,this.defaultParams);return this.styles.styles.forEach(u=>{"string"!=typeof u&&u.forEach((f,g)=>{f&&(f=CI(f,c,t));const E=this.normalizer.normalizePropertyName(g,t);f=this.normalizer.normalizeStyleValue(g,E,f,t),o.set(g,f)})}),o}}class uK{constructor(n,t,o){this.name=n,this.ast=t,this._normalizer=o,this.transitionFactories=[],this.states=new Map,t.states.forEach(c=>{this.states.set(c.name,new dK(c.style,c.options&&c.options.params||{},o))}),W5(this.states,"true","1"),W5(this.states,"false","0"),t.transitions.forEach(c=>{this.transitionFactories.push(new H5(n,c,this.states))}),this.fallbackTransition=function hK(e,n,t){return new H5(e,{type:bt.Transition,animation:{type:bt.Sequence,steps:[],options:null},matchers:[(f,g)=>!0],options:null,queryCount:0,depCount:0},n)}(n,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(n,t,o,c){return this.transitionFactories.find(f=>f.match(n,t,o,c))||null}matchStyles(n,t,o){return this.fallbackTransition.buildStyles(n,t,o)}}function W5(e,n,t){e.has(n)?e.has(t)||e.set(t,e.get(n)):e.has(t)&&e.set(n,e.get(t))}const pK=new IM;class fK{constructor(n,t,o){this.bodyNode=n,this._driver=t,this._normalizer=o,this._animations=new Map,this._playersById=new Map,this.players=[]}register(n,t){const o=[],u=rV(this._driver,t,o,[]);if(o.length)throw function v7(e){return new he(3503,!1)}();this._animations.set(n,u)}_buildPlayer(n,t,o){const c=n.element,u=R5(this._normalizer,n.keyframes,t,o);return this._driver.animate(c,u,n.duration,n.delay,n.easing,[],!0)}create(n,t,o={}){const c=[],u=this._animations.get(n);let f;const g=new Map;if(u?(f=aV(this._driver,t,u,QU,EM,new Map,new Map,o,pK,c),f.forEach(R=>{const P=va(g,R.element,new Map);R.postStyleProps.forEach(B=>P.set(B,null))})):(c.push(function b7(){return new he(3300,!1)}()),f=[]),c.length)throw function y7(e){return new he(3504,!1)}();g.forEach((R,P)=>{R.forEach((B,G)=>{R.set(G,this._driver.computeStyle(P,G,Lu))})});const C=Bp(f.map(R=>{const P=g.get(R.element);return this._buildPlayer(R,new Map,P)}));return this._playersById.set(n,C),C.onDestroy(()=>this.destroy(n)),this.players.push(C),C}destroy(n){const t=this._getPlayer(n);t.destroy(),this._playersById.delete(n);const o=this.players.indexOf(t);o>=0&&this.players.splice(o,1)}_getPlayer(n){const t=this._playersById.get(n);if(!t)throw function C7(e){return new he(3301,!1)}();return t}listen(n,t,o,c){const u=qU(t,"","","");return zU(this._getPlayer(n),o,u,c),()=>{}}command(n,t,o,c){if("register"==o)return void this.register(n,c[0]);if("create"==o)return void this.create(n,t,c[0]||{});const u=this._getPlayer(n);switch(o){case"play":u.play();break;case"pause":u.pause();break;case"reset":u.reset();break;case"restart":u.restart();break;case"finish":u.finish();break;case"init":u.init();break;case"setPosition":u.setPosition(parseFloat(c[0]));break;case"destroy":this.destroy(n)}}}const z5="ng-animate-queued",lV="ng-animate-disabled",vK=[],K5={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},bK={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},ed="__ng_removed";class uV{get params(){return this.options.params}constructor(n,t=""){this.namespaceId=t;const o=n&&n.hasOwnProperty("value");if(this.value=function TK(e){return e??null}(o?n.value:n),o){const{value:u,...f}=n;this.options=f}else this.options={};this.options.params||(this.options.params={})}absorbOptions(n){const t=n.params;if(t){const o=this.options.params;Object.keys(t).forEach(c=>{null==o[c]&&(o[c]=t[c])})}}}const SI="void",hV=new uV(SI);class yK{constructor(n,t,o){this.id=n,this.hostElement=t,this._engine=o,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+n,ic(t,this._hostClassName)}listen(n,t,o,c){if(!this._triggers.has(t))throw function S7(e,n){return new he(3302,!1)}();if(null==o||0==o.length)throw function T7(e){return new he(3303,!1)}();if(!function IK(e){return"start"==e||"done"==e}(o))throw function I7(e,n){return new he(3400,!1)}();const u=va(this._elementListeners,n,[]),f={name:t,phase:o,callback:c};u.push(f);const g=va(this._engine.statesByElement,n,new Map);return g.has(t)||(ic(n,vM),ic(n,vM+"-"+t),g.set(t,hV)),()=>{this._engine.afterFlush(()=>{const E=u.indexOf(f);E>=0&&u.splice(E,1),this._triggers.has(t)||g.delete(t)})}}register(n,t){return!this._triggers.has(n)&&(this._triggers.set(n,t),!0)}_getTrigger(n){const t=this._triggers.get(n);if(!t)throw function w7(e){return new he(3401,!1)}();return t}trigger(n,t,o,c=!0){const u=this._getTrigger(t),f=new pV(this.id,t,n);let g=this._engine.statesByElement.get(n);g||(ic(n,vM),ic(n,vM+"-"+t),this._engine.statesByElement.set(n,g=new Map));let E=g.get(t);const C=new uV(o,this.id);if(!(o&&o.hasOwnProperty("value"))&&E&&C.absorbOptions(E.options),g.set(t,C),E||(E=hV),C.value!==SI&&E.value===C.value){if(!function AK(e,n){const t=Object.keys(e),o=Object.keys(n);if(t.length!=o.length)return!1;for(let c=0;c<t.length;c++){const u=t[c];if(!n.hasOwnProperty(u)||e[u]!==n[u])return!1}return!0}(E.params,C.params)){const J=[],le=u.matchStyles(E.value,E.params,J),ge=u.matchStyles(C.value,C.params,J);J.length?this._engine.reportError(J):this._engine.afterFlush(()=>{wg(n,le),al(n,ge)})}return}const B=va(this._engine.playersByElement,n,[]);B.forEach(J=>{J.namespaceId==this.id&&J.triggerName==t&&J.queued&&J.destroy()});let G=u.matchTransition(E.value,C.value,n,C.params),Y=!1;if(!G){if(!c)return;G=u.fallbackTransition,Y=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:n,triggerName:t,transition:G,fromState:E,toState:C,player:f,isFallbackTransition:Y}),Y||(ic(n,z5),f.onStart(()=>{Tb(n,z5)})),f.onDone(()=>{let J=this.players.indexOf(f);J>=0&&this.players.splice(J,1);const le=this._engine.playersByElement.get(n);if(le){let ge=le.indexOf(f);ge>=0&&le.splice(ge,1)}}),this.players.push(f),B.push(f),f}deregister(n){this._triggers.delete(n),this._engine.statesByElement.forEach(t=>t.delete(n)),this._elementListeners.forEach((t,o)=>{this._elementListeners.set(o,t.filter(c=>c.name!=n))})}clearElementCache(n){this._engine.statesByElement.delete(n),this._elementListeners.delete(n);const t=this._engine.playersByElement.get(n);t&&(t.forEach(o=>o.destroy()),this._engine.playersByElement.delete(n))}_signalRemovalForInnerTriggers(n,t){const o=this._engine.driver.query(n,bM,!0);o.forEach(c=>{if(c[ed])return;const u=this._engine.fetchNamespacesByElement(c);u.size?u.forEach(f=>f.triggerLeaveAnimation(c,t,!1,!0)):this.clearElementCache(c)}),this._engine.afterFlushAnimationsDone(()=>o.forEach(c=>this.clearElementCache(c)))}triggerLeaveAnimation(n,t,o,c){const u=this._engine.statesByElement.get(n),f=new Map;if(u){const g=[];if(u.forEach((E,C)=>{if(f.set(C,E.value),this._triggers.has(C)){const R=this.trigger(n,C,SI,c);R&&g.push(R)}}),g.length)return this._engine.markElementAsRemoved(this.id,n,!0,t,f),o&&Bp(g).onDone(()=>this._engine.processLeaveNode(n)),!0}return!1}prepareLeaveAnimationListeners(n){const t=this._elementListeners.get(n),o=this._engine.statesByElement.get(n);if(t&&o){const c=new Set;t.forEach(u=>{const f=u.name;if(c.has(f))return;c.add(f);const E=this._triggers.get(f).fallbackTransition,C=o.get(f)||hV,R=new uV(SI),P=new pV(this.id,f,n);this._engine.totalQueuedPlayers++,this._queue.push({element:n,triggerName:f,transition:E,fromState:C,toState:R,player:P,isFallbackTransition:!0})})}}removeNode(n,t){const o=this._engine;if(n.childElementCount&&this._signalRemovalForInnerTriggers(n,t),this.triggerLeaveAnimation(n,t,!0))return;let c=!1;if(o.totalAnimations){const u=o.players.length?o.playersByQueriedElement.get(n):[];if(u&&u.length)c=!0;else{let f=n;for(;f=f.parentNode;)if(o.statesByElement.get(f)){c=!0;break}}}if(this.prepareLeaveAnimationListeners(n),c)o.markElementAsRemoved(this.id,n,!1,t);else{const u=n[ed];(!u||u===K5)&&(o.afterFlush(()=>this.clearElementCache(n)),o.destroyInnerAnimations(n),o._onRemovalComplete(n,t))}}insertNode(n,t){ic(n,this._hostClassName)}drainQueuedTransitions(n){const t=[];return this._queue.forEach(o=>{const c=o.player;if(c.destroyed)return;const u=o.element,f=this._elementListeners.get(u);f&&f.forEach(g=>{if(g.name==o.triggerName){const E=qU(u,o.triggerName,o.fromState.value,o.toState.value);E._data=n,zU(o.player,g.phase,E,g.callback)}}),c.markedForDestroy?this._engine.afterFlush(()=>{c.destroy()}):t.push(o)}),this._queue=[],t.sort((o,c)=>{const u=o.transition.ast.depCount,f=c.transition.ast.depCount;return 0==u||0==f?u-f:this._engine.driver.containsElement(o.element,c.element)?1:-1})}destroy(n){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,n)}}class CK{_onRemovalComplete(n,t){this.onRemovalComplete(n,t)}constructor(n,t,o,c){this.bodyNode=n,this.driver=t,this._normalizer=o,this.scheduler=c,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(u,f)=>{}}get queuedPlayers(){const n=[];return this._namespaceList.forEach(t=>{t.players.forEach(o=>{o.queued&&n.push(o)})}),n}createNamespace(n,t){const o=new yK(n,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(o,t):(this.newHostElements.set(t,o),this.collectEnterElement(t)),this._namespaceLookup[n]=o}_balanceNamespaceList(n,t){const o=this._namespaceList,c=this.namespacesByHostElement;if(o.length-1>=0){let f=!1,g=this.driver.getParentElement(t);for(;g;){const E=c.get(g);if(E){const C=o.indexOf(E);o.splice(C+1,0,n),f=!0;break}g=this.driver.getParentElement(g)}f||o.unshift(n)}else o.push(n);return c.set(t,n),n}register(n,t){let o=this._namespaceLookup[n];return o||(o=this.createNamespace(n,t)),o}registerTrigger(n,t,o){let c=this._namespaceLookup[n];c&&c.register(t,o)&&this.totalAnimations++}destroy(n,t){n&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const o=this._fetchNamespace(n);this.namespacesByHostElement.delete(o.hostElement);const c=this._namespaceList.indexOf(o);c>=0&&this._namespaceList.splice(c,1),o.destroy(t),delete this._namespaceLookup[n]}))}_fetchNamespace(n){return this._namespaceLookup[n]}fetchNamespacesByElement(n){const t=new Set,o=this.statesByElement.get(n);if(o)for(let c of o.values())if(c.namespaceId){const u=this._fetchNamespace(c.namespaceId);u&&t.add(u)}return t}trigger(n,t,o,c){if(AM(t)){const u=this._fetchNamespace(n);if(u)return u.trigger(t,o,c),!0}return!1}insertNode(n,t,o,c){if(!AM(t))return;const u=t[ed];if(u&&u.setForRemoval){u.setForRemoval=!1,u.setForMove=!0;const f=this.collectedLeaveElements.indexOf(t);f>=0&&this.collectedLeaveElements.splice(f,1)}if(n){const f=this._fetchNamespace(n);f&&f.insertNode(t,o)}c&&this.collectEnterElement(t)}collectEnterElement(n){this.collectedEnterElements.push(n)}markElementAsDisabled(n,t){t?this.disabledNodes.has(n)||(this.disabledNodes.add(n),ic(n,lV)):this.disabledNodes.has(n)&&(this.disabledNodes.delete(n),Tb(n,lV))}removeNode(n,t,o){if(AM(t)){this.scheduler?.notify();const c=n?this._fetchNamespace(n):null;c?c.removeNode(t,o):this.markElementAsRemoved(n,t,!1,o);const u=this.namespacesByHostElement.get(t);u&&u.id!==n&&u.removeNode(t,o)}else this._onRemovalComplete(t,o)}markElementAsRemoved(n,t,o,c,u){this.collectedLeaveElements.push(t),t[ed]={namespaceId:n,setForRemoval:c,hasAnimation:o,removedBeforeQueried:!1,previousTriggersValues:u}}listen(n,t,o,c,u){return AM(t)?this._fetchNamespace(n).listen(t,o,c,u):()=>{}}_buildInstruction(n,t,o,c,u){return n.transition.build(this.driver,n.element,n.fromState.value,n.toState.value,o,c,n.fromState.options,n.toState.options,t,u)}destroyInnerAnimations(n){let t=this.driver.query(n,bM,!0);t.forEach(o=>this.destroyActiveAnimationsForElement(o)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(n,ZU,!0),t.forEach(o=>this.finishActiveQueriedAnimationOnElement(o)))}destroyActiveAnimationsForElement(n){const t=this.playersByElement.get(n);t&&t.forEach(o=>{o.queued?o.markedForDestroy=!0:o.destroy()})}finishActiveQueriedAnimationOnElement(n){const t=this.playersByQueriedElement.get(n);t&&t.forEach(o=>o.finish())}whenRenderingDone(){return new Promise(n=>{if(this.players.length)return Bp(this.players).onDone(()=>n());n()})}processLeaveNode(n){const t=n[ed];if(t&&t.setForRemoval){if(n[ed]=K5,t.namespaceId){this.destroyInnerAnimations(n);const o=this._fetchNamespace(t.namespaceId);o&&o.clearElementCache(n)}this._onRemovalComplete(n,t.setForRemoval)}n.classList?.contains(lV)&&this.markElementAsDisabled(n,!1),this.driver.query(n,".ng-animate-disabled",!0).forEach(o=>{this.markElementAsDisabled(o,!1)})}flush(n=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((o,c)=>this._balanceNamespaceList(o,c)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let o=0;o<this.collectedEnterElements.length;o++)ic(this.collectedEnterElements[o],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const o=[];try{t=this._flushAnimations(o,n)}finally{for(let c=0;c<o.length;c++)o[c]()}}else for(let o=0;o<this.collectedLeaveElements.length;o++)this.processLeaveNode(this.collectedLeaveElements[o]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(o=>o()),this._flushFns=[],this._whenQuietFns.length){const o=this._whenQuietFns;this._whenQuietFns=[],t.length?Bp(t).onDone(()=>{o.forEach(c=>c())}):o.forEach(c=>c())}}reportError(n){throw function R7(e){return new he(3402,!1)}()}_flushAnimations(n,t){const o=new IM,c=[],u=new Map,f=[],g=new Map,E=new Map,C=new Map,R=new Set;this.disabledNodes.forEach(We=>{R.add(We);const ot=this.driver.query(We,".ng-animate-queued",!0);for(let mt=0;mt<ot.length;mt++)R.add(ot[mt])});const P=this.bodyNode,B=Array.from(this.statesByElement.keys()),G=$5(B,this.collectedEnterElements),Y=new Map;let J=0;G.forEach((We,ot)=>{const mt=QU+J++;Y.set(ot,mt),We.forEach(bn=>ic(bn,mt))});const le=[],ge=new Set,de=new Set;for(let We=0;We<this.collectedLeaveElements.length;We++){const ot=this.collectedLeaveElements[We],mt=ot[ed];mt&&mt.setForRemoval&&(le.push(ot),ge.add(ot),mt.hasAnimation?this.driver.query(ot,".ng-star-inserted",!0).forEach(bn=>ge.add(bn)):de.add(ot))}const Le=new Map,He=$5(B,Array.from(ge));He.forEach((We,ot)=>{const mt=EM+J++;Le.set(ot,mt),We.forEach(bn=>ic(bn,mt))}),n.push(()=>{G.forEach((We,ot)=>{const mt=Y.get(ot);We.forEach(bn=>Tb(bn,mt))}),He.forEach((We,ot)=>{const mt=Le.get(ot);We.forEach(bn=>Tb(bn,mt))}),le.forEach(We=>{this.processLeaveNode(We)})});const ft=[],kn=[];for(let We=this._namespaceList.length-1;We>=0;We--)this._namespaceList[We].drainQueuedTransitions(t).forEach(mt=>{const bn=mt.player,ro=mt.element;if(ft.push(bn),this.collectedEnterElements.length){const qo=ro[ed];if(qo&&qo.setForMove){if(qo.previousTriggersValues&&qo.previousTriggersValues.has(mt.triggerName)){const Pg=qo.previousTriggersValues.get(mt.triggerName),oc=this.statesByElement.get(mt.element);if(oc&&oc.has(mt.triggerName)){const YM=oc.get(mt.triggerName);YM.value=Pg,oc.set(mt.triggerName,YM)}}return void bn.destroy()}}const hl=!P||!this.driver.containsElement(P,ro),Ca=Le.get(ro),Hp=Y.get(ro),zi=this._buildInstruction(mt,o,Hp,Ca,hl);if(zi.errors&&zi.errors.length)return void kn.push(zi);if(hl)return bn.onStart(()=>wg(ro,zi.fromStyles)),bn.onDestroy(()=>al(ro,zi.toStyles)),void c.push(bn);if(mt.isFallbackTransition)return bn.onStart(()=>wg(ro,zi.fromStyles)),bn.onDestroy(()=>al(ro,zi.toStyles)),void c.push(bn);const _H=[];zi.timelines.forEach(qo=>{qo.stretchStartingKeyframe=!0,this.disabledNodes.has(qo.element)||_H.push(qo)}),zi.timelines=_H,o.append(ro,zi.timelines),f.push({instruction:zi,player:bn,element:ro}),zi.queriedElements.forEach(qo=>va(g,qo,[]).push(bn)),zi.preStyleProps.forEach((qo,Pg)=>{if(qo.size){let oc=E.get(Pg);oc||E.set(Pg,oc=new Set),qo.forEach((YM,YV)=>oc.add(YV))}}),zi.postStyleProps.forEach((qo,Pg)=>{let oc=C.get(Pg);oc||C.set(Pg,oc=new Set),qo.forEach((YM,YV)=>oc.add(YV))})});if(kn.length){const We=[];kn.forEach(ot=>{We.push(function A7(e,n){return new he(3505,!1)}())}),ft.forEach(ot=>ot.destroy()),this.reportError(We)}const Ir=new Map,Ko=new Map;f.forEach(We=>{const ot=We.element;o.has(ot)&&(Ko.set(ot,ot),this._beforeAnimationBuild(We.player.namespaceId,We.instruction,Ir))}),c.forEach(We=>{const ot=We.element;this._getPreviousPlayers(ot,!1,We.namespaceId,We.triggerName,null).forEach(bn=>{va(Ir,ot,[]).push(bn),bn.destroy()})});const Vu=le.filter(We=>J5(We,E,C)),Ub=new Map;Y5(Ub,this.driver,de,C,Lu).forEach(We=>{J5(We,E,C)&&Vu.push(We)});const Ng=new Map;G.forEach((We,ot)=>{Y5(Ng,this.driver,new Set(We),E,"!")}),Vu.forEach(We=>{const ot=Ub.get(We),mt=Ng.get(We);Ub.set(We,new Map([...ot?.entries()??[],...mt?.entries()??[]]))});const qV=[],mH=[],gH={};f.forEach(We=>{const{element:ot,player:mt,instruction:bn}=We;if(o.has(ot)){if(R.has(ot))return mt.onDestroy(()=>al(ot,bn.toStyles)),mt.disabled=!0,mt.overrideTotalTime(bn.totalTime),void c.push(mt);let ro=gH;if(Ko.size>1){let Ca=ot;const Hp=[];for(;Ca=Ca.parentNode;){const zi=Ko.get(Ca);if(zi){ro=zi;break}Hp.push(Ca)}Hp.forEach(zi=>Ko.set(zi,ro))}const hl=this._buildAnimation(mt.namespaceId,bn,Ir,u,Ng,Ub);if(mt.setRealPlayer(hl),ro===gH)qV.push(mt);else{const Ca=this.playersByElement.get(ro);Ca&&Ca.length&&(mt.parentPlayer=Bp(Ca)),c.push(mt)}}else wg(ot,bn.fromStyles),mt.onDestroy(()=>al(ot,bn.toStyles)),mH.push(mt),R.has(ot)&&c.push(mt)}),mH.forEach(We=>{const ot=u.get(We.element);if(ot&&ot.length){const mt=Bp(ot);We.setRealPlayer(mt)}}),c.forEach(We=>{We.parentPlayer?We.syncPlayerEvents(We.parentPlayer):We.destroy()});for(let We=0;We<le.length;We++){const ot=le[We],mt=ot[ed];if(Tb(ot,EM),mt&&mt.hasAnimation)continue;let bn=[];if(g.size){let hl=g.get(ot);hl&&hl.length&&bn.push(...hl);let Ca=this.driver.query(ot,ZU,!0);for(let Hp=0;Hp<Ca.length;Hp++){let zi=g.get(Ca[Hp]);zi&&zi.length&&bn.push(...zi)}}const ro=bn.filter(hl=>!hl.destroyed);ro.length?wK(this,ot,ro):this.processLeaveNode(ot)}return le.length=0,qV.forEach(We=>{this.players.push(We),We.onDone(()=>{We.destroy();const ot=this.players.indexOf(We);this.players.splice(ot,1)}),We.play()}),qV}afterFlush(n){this._flushFns.push(n)}afterFlushAnimationsDone(n){this._whenQuietFns.push(n)}_getPreviousPlayers(n,t,o,c,u){let f=[];if(t){const g=this.playersByQueriedElement.get(n);g&&(f=g)}else{const g=this.playersByElement.get(n);if(g){const E=!u||u==SI;g.forEach(C=>{C.queued||!E&&C.triggerName!=c||f.push(C)})}}return(o||c)&&(f=f.filter(g=>!(o&&o!=g.namespaceId||c&&c!=g.triggerName))),f}_beforeAnimationBuild(n,t,o){const u=t.element,f=t.isRemovalTransition?void 0:n,g=t.isRemovalTransition?void 0:t.triggerName;for(const E of t.timelines){const C=E.element,R=C!==u,P=va(o,C,[]);this._getPreviousPlayers(C,R,f,g,t.toState).forEach(G=>{const Y=G.getRealPlayer();Y.beforeDestroy&&Y.beforeDestroy(),G.destroy(),P.push(G)})}wg(u,t.fromStyles)}_buildAnimation(n,t,o,c,u,f){const g=t.triggerName,E=t.element,C=[],R=new Set,P=new Set,B=t.timelines.map(Y=>{const J=Y.element;R.add(J);const le=J[ed];if(le&&le.removedBeforeQueried)return new vI(Y.duration,Y.delay);const ge=J!==E,de=function RK(e){const n=[];return X5(e,n),n}((o.get(J)||vK).map(Ir=>Ir.getRealPlayer())).filter(Ir=>!!Ir.element&&Ir.element===J),Le=u.get(J),He=f.get(J),ft=R5(this._normalizer,Y.keyframes,Le,He),kn=this._buildPlayer(Y,ft,de);if(Y.subTimeline&&c&&P.add(J),ge){const Ir=new pV(n,g,J);Ir.setRealPlayer(kn),C.push(Ir)}return kn});C.forEach(Y=>{va(this.playersByQueriedElement,Y.element,[]).push(Y),Y.onDone(()=>function SK(e,n,t){let o=e.get(n);if(o){if(o.length){const c=o.indexOf(t);o.splice(c,1)}0==o.length&&e.delete(n)}return o}(this.playersByQueriedElement,Y.element,Y))}),R.forEach(Y=>ic(Y,M5));const G=Bp(B);return G.onDestroy(()=>{R.forEach(Y=>Tb(Y,M5)),al(E,t.toStyles)}),P.forEach(Y=>{va(c,Y,[]).push(G)}),G}_buildPlayer(n,t,o){return t.length>0?this.driver.animate(n.element,t,n.duration,n.delay,n.easing,o):new vI(n.duration,n.delay)}}class pV{constructor(n,t,o){this.namespaceId=n,this.triggerName=t,this.element=o,this._player=new vI,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(n){this._containsRealPlayer||(this._player=n,this._queuedCallbacks.forEach((t,o)=>{t.forEach(c=>zU(n,o,void 0,c))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(n.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(n){this.totalTime=n}syncPlayerEvents(n){const t=this._player;t.triggerCallback&&n.onStart(()=>t.triggerCallback("start")),n.onDone(()=>this.finish()),n.onDestroy(()=>this.destroy())}_queueEvent(n,t){va(this._queuedCallbacks,n,[]).push(t)}onDone(n){this.queued&&this._queueEvent("done",n),this._player.onDone(n)}onStart(n){this.queued&&this._queueEvent("start",n),this._player.onStart(n)}onDestroy(n){this.queued&&this._queueEvent("destroy",n),this._player.onDestroy(n)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(n){this.queued||this._player.setPosition(n)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(n){const t=this._player;t.triggerCallback&&t.triggerCallback(n)}}function AM(e){return e&&1===e.nodeType}function q5(e,n){const t=e.style.display;return e.style.display=n??"none",t}function Y5(e,n,t,o,c){const u=[];t.forEach(E=>u.push(q5(E)));const f=[];o.forEach((E,C)=>{const R=new Map;E.forEach(P=>{const B=n.computeStyle(C,P,c);R.set(P,B),(!B||0==B.length)&&(C[ed]=bK,f.push(C))}),e.set(C,R)});let g=0;return t.forEach(E=>q5(E,u[g++])),f}function $5(e,n){const t=new Map;if(e.forEach(g=>t.set(g,[])),0==n.length)return t;const c=new Set(n),u=new Map;function f(g){if(!g)return 1;let E=u.get(g);if(E)return E;const C=g.parentNode;return E=t.has(C)?C:c.has(C)?1:f(C),u.set(g,E),E}return n.forEach(g=>{const E=f(g);1!==E&&t.get(E).push(g)}),t}function ic(e,n){e.classList?.add(n)}function Tb(e,n){e.classList?.remove(n)}function wK(e,n,t){Bp(t).onDone(()=>e.processLeaveNode(n))}function X5(e,n){for(let t=0;t<e.length;t++){const o=e[t];o instanceof z4?X5(o.players,n):n.push(o)}}function J5(e,n,t){const o=t.get(e);if(!o)return!1;let c=n.get(e);return c?o.forEach(u=>c.add(u)):n.set(e,o),t.delete(e),!0}class TI{constructor(n,t,o,c){this._driver=t,this._normalizer=o,this._triggerCache={},this.onRemovalComplete=(u,f)=>{},this._transitionEngine=new CK(n.body,t,o,c),this._timelineEngine=new fK(n.body,t,o),this._transitionEngine.onRemovalComplete=(u,f)=>this.onRemovalComplete(u,f)}registerTrigger(n,t,o,c,u){const f=n+"-"+c;let g=this._triggerCache[f];if(!g){const E=[],R=rV(this._driver,u,E,[]);if(E.length)throw function _7(e,n){return new he(3404,!1)}();g=function lK(e,n,t){return new uK(e,n,t)}(c,R,this._normalizer),this._triggerCache[f]=g}this._transitionEngine.registerTrigger(t,c,g)}register(n,t){this._transitionEngine.register(n,t)}destroy(n,t){this._transitionEngine.destroy(n,t)}onInsert(n,t,o,c){this._transitionEngine.insertNode(n,t,o,c)}onRemove(n,t,o){this._transitionEngine.removeNode(n,t,o)}disableAnimations(n,t){this._transitionEngine.markElementAsDisabled(n,t)}process(n,t,o,c){if("@"==o.charAt(0)){const[u,f]=A5(o);this._timelineEngine.command(u,t,f,c)}else this._transitionEngine.trigger(n,t,o,c)}listen(n,t,o,c,u){if("@"==o.charAt(0)){const[f,g]=A5(o);return this._timelineEngine.listen(f,t,g,u)}return this._transitionEngine.listen(n,t,o,c,u)}flush(n=-1){this._transitionEngine.flush(n)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(n){this._transitionEngine.afterFlushAnimationsDone(n)}}class II{static#e=this.initialStylesByElement=new WeakMap;constructor(n,t,o){this._element=n,this._startStyles=t,this._endStyles=o,this._state=0;let c=II.initialStylesByElement.get(n);c||II.initialStylesByElement.set(n,c=new Map),this._initialStyles=c}start(){this._state<1&&(this._startStyles&&al(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(al(this._element,this._initialStyles),this._endStyles&&(al(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(II.initialStylesByElement.delete(this._element),this._startStyles&&(wg(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(wg(this._element,this._endStyles),this._endStyles=null),al(this._element,this._initialStyles),this._state=3)}}function fV(e){let n=null;return e.forEach((t,o)=>{(function OK(e){return"display"===e||"position"===e})(o)&&(n=n||new Map,n.set(o,t))}),n}class Q5{constructor(n,t,o,c){this.element=n,this.keyframes=t,this.options=o,this._specialStyles=c,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=o.duration,this._delay=o.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(n=>n()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const n=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,n,this.options),this._finalKeyframe=n.length?n[n.length-1]:new Map;const t=()=>this._onFinish();this.domPlayer.addEventListener("finish",t),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",t)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(n){const t=[];return n.forEach(o=>{t.push(Object.fromEntries(o))}),t}_triggerWebAnimation(n,t,o){return n.animate(this._convertKeyframesToObject(t),o)}onStart(n){this._originalOnStartFns.push(n),this._onStartFns.push(n)}onDone(n){this._originalOnDoneFns.push(n),this._onDoneFns.push(n)}onDestroy(n){this._onDestroyFns.push(n)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(n=>n()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(n=>n()),this._onDestroyFns=[])}setPosition(n){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=n*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const n=new Map;this.hasStarted()&&this._finalKeyframe.forEach((o,c)=>{"offset"!==c&&n.set(c,this._finished?o:iV(this.element,c))}),this.currentSnapshot=n}triggerCallback(n){const t="start"===n?this._onStartFns:this._onDoneFns;t.forEach(o=>o()),t.length=0}}class Z5{validateStyleProperty(n){return!0}validateAnimatableStyleProperty(n){return!0}matchesElement(n,t){return!1}containsElement(n,t){return O5(n,t)}getParentElement(n){return YU(n)}query(n,t,o){return N5(n,t,o)}computeStyle(n,t,o){return iV(n,t)}animate(n,t,o,c,u,f=[]){const E={duration:o,delay:c,fill:0==c?"both":"forwards"};u&&(E.easing=u);const C=new Map,R=f.filter(G=>G instanceof Q5);(function j7(e,n){return 0===e||0===n})(o,c)&&R.forEach(G=>{G.currentSnapshot.forEach((Y,J)=>C.set(J,Y))});let P=function U7(e){return e.length?e[0]instanceof Map?e:e.map(n=>new Map(Object.entries(n))):[]}(t).map(G=>new Map(G));P=function H7(e,n,t){if(t.size&&n.length){let o=n[0],c=[];if(t.forEach((u,f)=>{o.has(f)||c.push(f),o.set(f,u)}),c.length)for(let u=1;u<n.length;u++){let f=n[u];c.forEach(g=>f.set(g,iV(e,g)))}}return n}(n,P,C);const B=function DK(e,n){let t=null,o=null;return Array.isArray(n)&&n.length?(t=fV(n[0]),n.length>1&&(o=fV(n[n.length-1]))):n instanceof Map&&(t=fV(n)),t||o?new II(e,t,o):null}(n,P);return new Q5(n,P,E,B)}}const e6="@.disabled";class t6{constructor(n,t,o,c){this.namespaceId=n,this.delegate=t,this.engine=o,this._onDestroy=c,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(n){this.delegate.destroyNode?.(n)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(n,t){return this.delegate.createElement(n,t)}createComment(n){return this.delegate.createComment(n)}createText(n){return this.delegate.createText(n)}appendChild(n,t){this.delegate.appendChild(n,t),this.engine.onInsert(this.namespaceId,t,n,!1)}insertBefore(n,t,o,c=!0){this.delegate.insertBefore(n,t,o),this.engine.onInsert(this.namespaceId,t,n,c)}removeChild(n,t,o){this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(n,t){return this.delegate.selectRootElement(n,t)}parentNode(n){return this.delegate.parentNode(n)}nextSibling(n){return this.delegate.nextSibling(n)}setAttribute(n,t,o,c){this.delegate.setAttribute(n,t,o,c)}removeAttribute(n,t,o){this.delegate.removeAttribute(n,t,o)}addClass(n,t){this.delegate.addClass(n,t)}removeClass(n,t){this.delegate.removeClass(n,t)}setStyle(n,t,o,c){this.delegate.setStyle(n,t,o,c)}removeStyle(n,t,o){this.delegate.removeStyle(n,t,o)}setProperty(n,t,o){"@"==t.charAt(0)&&t==e6?this.disableAnimations(n,!!o):this.delegate.setProperty(n,t,o)}setValue(n,t){this.delegate.setValue(n,t)}listen(n,t,o){return this.delegate.listen(n,t,o)}disableAnimations(n,t){this.engine.disableAnimations(n,t)}}class NK extends t6{constructor(n,t,o,c,u){super(t,o,c,u),this.factory=n,this.namespaceId=t}setProperty(n,t,o){"@"==t.charAt(0)?"."==t.charAt(1)&&t==e6?this.disableAnimations(n,o=void 0===o||!!o):this.engine.process(this.namespaceId,n,t.slice(1),o):this.delegate.setProperty(n,t,o)}listen(n,t,o){if("@"==t.charAt(0)){const c=function PK(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(n);let u=t.slice(1),f="";return"@"!=u.charAt(0)&&([u,f]=function MK(e){const n=e.indexOf(".");return[e.substring(0,n),e.slice(n+1)]}(u)),this.engine.listen(this.namespaceId,c,u,f,g=>{this.factory.scheduleListenerCallback(g._data||-1,o,g)})}return this.delegate.listen(n,t,o)}}class xK{constructor(n,t,o){this.delegate=n,this.engine=t,this._zone=o,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,t.onRemovalComplete=(c,u)=>{const f=u?.parentNode(c);f&&u.removeChild(f,c)}}createRenderer(n,t){const c=this.delegate.createRenderer(n,t);if(!n||!t?.data?.animation){const C=this._rendererCache;let R=C.get(c);return R||(R=new t6("",c,this.engine,()=>C.delete(c)),C.set(c,R)),R}const u=t.id,f=t.id+"-"+this._currentId;this._currentId++,this.engine.register(f,n);const g=C=>{Array.isArray(C)?C.forEach(g):this.engine.registerTrigger(u,f,n,C.name,C)};return t.data.animation.forEach(g),new NK(this,f,c,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(n,t,o){if(n>=0&&n<this._microtaskId)return void this._zone.run(()=>t(o));const c=this._animationCallbacksBuffer;0==c.length&&queueMicrotask(()=>{this._zone.run(()=>{c.forEach(u=>{const[f,g]=u;f(g)}),this._animationCallbacksBuffer=[]})}),c.push([t,o])}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}const n6=[{provide:JU,useFactory:function LK(){return new L5}},{provide:TI,useClass:(()=>{class e extends TI{constructor(t,o,c){super(t,o,c,Te(FC,{optional:!0}))}ngOnDestroy(){this.flush()}static#e=this.\u0275fac=function(o){return new(o||e)(be(sn),be(XU),be(JU))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})()},{provide:_E,useFactory:function FK(e,n,t){return new xK(e,n,t)},deps:[KF,TI,it]}],mV=[{provide:XU,useFactory:()=>new Z5},{provide:bc,useValue:"BrowserAnimations"},...n6],i6=[{provide:XU,useClass:$U},{provide:bc,useValue:"NoopAnimations"},...n6];let UK=(()=>{class e{static withConfig(t){return{ngModule:e,providers:t.disableAnimations?i6:mV}}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({providers:mV,imports:[LB]})}return e})();const OM=Xb(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function r6(e){return new Wn(n=>{Wo(e()).subscribe(n)})}function NM(e,n){const t=dn(e)?e:()=>e,o=c=>c.error(t());return new Wn(n?c=>n.schedule(o,0,c):o)}function gV(){return fi((e,n)=>{let t=null;e._refCount++;const o=Jn(n,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(t=null);const c=e._connection,u=t;t=null,c&&(!u||c===u)&&c.unsubscribe(),n.unsubscribe()});e.subscribe(o),o.closed||(t=e.connect())})}class o6 extends Wn{constructor(n,t){super(),this.source=n,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,JI(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Ki;const t=this.getSubject();n.add(this.source.subscribe(Jn(t,void 0,()=>{this._teardown(),t.complete()},o=>{this._teardown(),t.error(o)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Ki.EMPTY)}return n}refCount(){return gV()(this)}}function td(e,n){return fi((t,o)=>{let c=null,u=0,f=!1;const g=()=>f&&!c&&o.complete();t.subscribe(Jn(o,E=>{c?.unsubscribe();let C=0;const R=u++;Wo(e(E,R)).subscribe(c=Jn(o,P=>o.next(n?n(E,P,R,C++):P),()=>{c=null,g()}))},()=>{f=!0,g()}))})}function PM(e){return fi((n,t)=>{let o=!1;n.subscribe(Jn(t,c=>{o=!0,t.next(c)},()=>{o||t.next(e),t.complete()}))})}function s6(e=BK){return fi((n,t)=>{let o=!1;n.subscribe(Jn(t,c=>{o=!0,t.next(c)},()=>o?t.complete():t.error(e())))})}function BK(){return new OM}function Ag(e,n){const t=arguments.length>=2;return o=>o.pipe(e?Ea((c,u)=>e(c,u,o)):ad,Vr(1),t?PM(n):s6(()=>new OM))}function wI(e,n){return dn(n)?no(e,n,1):no(e,1)}function io(e,n,t){const o=dn(e)||n||t?{next:e,error:n,complete:t}:e;return o?fi((c,u)=>{var f;null===(f=o.subscribe)||void 0===f||f.call(o);let g=!0;c.subscribe(Jn(u,E=>{var C;null===(C=o.next)||void 0===C||C.call(o,E),u.next(E)},()=>{var E;g=!1,null===(E=o.complete)||void 0===E||E.call(o),u.complete()},E=>{var C;g=!1,null===(C=o.error)||void 0===C||C.call(o,E),u.error(E)},()=>{var E,C;g&&(null===(E=o.unsubscribe)||void 0===E||E.call(o)),null===(C=o.finalize)||void 0===C||C.call(o)}))}):ad}function Ib(e){return fi((n,t)=>{let u,o=null,c=!1;o=n.subscribe(Jn(t,void 0,void 0,f=>{u=Wo(e(f,Ib(e)(n))),o?(o.unsubscribe(),o=null,u.subscribe(t)):c=!0})),c&&(o.unsubscribe(),o=null,u.subscribe(t))})}function _V(e){return e<=0?()=>Zc:fi((n,t)=>{let o=[];n.subscribe(Jn(t,c=>{o.push(c),e<o.length&&o.shift()},()=>{for(const c of o)t.next(c);t.complete()},void 0,()=>{o=null}))})}function a6(e){return Yt(()=>e)}function EV(e){return fi((n,t)=>{try{n.subscribe(t)}finally{t.add(e)}})}const Ut="primary",RI=Symbol("RouteTitle");class WK{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t[0]:t}return null}getAll(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function wb(e){return new WK(e)}function zK(e,n,t){const o=t.path.split("/");if(o.length>e.length||"full"===t.pathMatch&&(n.hasChildren()||o.length<e.length))return null;const c={};for(let u=0;u<o.length;u++){const f=o[u],g=e[u];if(f.startsWith(":"))c[f.substring(1)]=g;else if(f!==g.path)return null}return{consumed:e.slice(0,o.length),posParams:c}}function cl(e,n){const t=e?vV(e):void 0,o=n?vV(n):void 0;if(!t||!o||t.length!=o.length)return!1;let c;for(let u=0;u<t.length;u++)if(c=t[u],!c6(e[c],n[c]))return!1;return!0}function vV(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function c6(e,n){if(Array.isArray(e)&&Array.isArray(n)){if(e.length!==n.length)return!1;const t=[...e].sort(),o=[...n].sort();return t.every((c,u)=>o[u]===c)}return e===n}function d6(e){return e.length>0?e[e.length-1]:null}function jp(e){return function VK(e){return!!e&&(e instanceof Wn||dn(e.lift)&&dn(e.subscribe))}(e)?e:lp(e)?Ur(Promise.resolve(e)):pt(e)}const qK={exact:function h6(e,n,t){if(!Dg(e.segments,n.segments)||!MM(e.segments,n.segments,t)||e.numberOfChildren!==n.numberOfChildren)return!1;for(const o in n.children)if(!e.children[o]||!h6(e.children[o],n.children[o],t))return!1;return!0},subset:p6},l6={exact:function YK(e,n){return cl(e,n)},subset:function $K(e,n){return Object.keys(n).length<=Object.keys(e).length&&Object.keys(n).every(t=>c6(e[t],n[t]))},ignored:()=>!0};function u6(e,n,t){return qK[t.paths](e.root,n.root,t.matrixParams)&&l6[t.queryParams](e.queryParams,n.queryParams)&&!("exact"===t.fragment&&e.fragment!==n.fragment)}function p6(e,n,t){return f6(e,n,n.segments,t)}function f6(e,n,t,o){if(e.segments.length>t.length){const c=e.segments.slice(0,t.length);return!(!Dg(c,t)||n.hasChildren()||!MM(c,t,o))}if(e.segments.length===t.length){if(!Dg(e.segments,t)||!MM(e.segments,t,o))return!1;for(const c in n.children)if(!e.children[c]||!p6(e.children[c],n.children[c],o))return!1;return!0}{const c=t.slice(0,e.segments.length),u=t.slice(e.segments.length);return!!(Dg(e.segments,c)&&MM(e.segments,c,o)&&e.children[Ut])&&f6(e.children[Ut],n,u,o)}}function MM(e,n,t){return n.every((o,c)=>l6[t](e[c].parameters,o.parameters))}class Rb{constructor(n=new di([],{}),t={},o=null){this.root=n,this.queryParams=t,this.fragment=o}get queryParamMap(){return this._queryParamMap??=wb(this.queryParams),this._queryParamMap}toString(){return QK.serialize(this)}}class di{constructor(n,t){this.segments=n,this.children=t,this.parent=null,Object.values(t).forEach(o=>o.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return xM(this)}}class AI{constructor(n,t){this.path=n,this.parameters=t}get parameterMap(){return this._parameterMap??=wb(this.parameters),this._parameterMap}toString(){return _6(this)}}function Dg(e,n){return e.length===n.length&&e.every((t,o)=>t.path===n[o].path)}let Ab=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:()=>new bV,providedIn:"root"})}return e})();class bV{parse(n){const t=new dq(n);return new Rb(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(n){const t=`/${DI(n.root,!0)}`,o=function tq(e){const n=Object.entries(e).map(([t,o])=>Array.isArray(o)?o.map(c=>`${kM(t)}=${kM(c)}`).join("&"):`${kM(t)}=${kM(o)}`).filter(t=>t);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${t}${o}${"string"==typeof n.fragment?`#${function ZK(e){return encodeURI(e)}(n.fragment)}`:""}`}}const QK=new bV;function xM(e){return e.segments.map(n=>_6(n)).join("/")}function DI(e,n){if(!e.hasChildren())return xM(e);if(n){const t=e.children[Ut]?DI(e.children[Ut],!1):"",o=[];return Object.entries(e.children).forEach(([c,u])=>{c!==Ut&&o.push(`${c}:${DI(u,!1)}`)}),o.length>0?`${t}(${o.join("//")})`:t}{const t=function JK(e,n){let t=[];return Object.entries(e.children).forEach(([o,c])=>{o===Ut&&(t=t.concat(n(c,o)))}),Object.entries(e.children).forEach(([o,c])=>{o!==Ut&&(t=t.concat(n(c,o)))}),t}(e,(o,c)=>c===Ut?[DI(e.children[Ut],!1)]:[`${c}:${DI(o,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[Ut]?`${xM(e)}/${t[0]}`:`${xM(e)}/(${t.join("//")})`}}function m6(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function kM(e){return m6(e).replace(/%3B/gi,";")}function yV(e){return m6(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function LM(e){return decodeURIComponent(e)}function g6(e){return LM(e.replace(/\+/g,"%20"))}function _6(e){return`${yV(e.path)}${function eq(e){return Object.entries(e).map(([n,t])=>`;${yV(n)}=${yV(t)}`).join("")}(e.parameters)}`}const nq=/^[^\/()?;#]+/;function CV(e){const n=e.match(nq);return n?n[0]:""}const iq=/^[^\/()?;=#]+/,oq=/^[^=?&#]+/,aq=/^[^&#]+/;class dq{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new di([],{}):new di([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let o={};return this.peekStartsWith("(")&&(o=this.parseParens(!1)),(n.length>0||Object.keys(t).length>0)&&(o[Ut]=new di(n,t)),o}parseSegment(){const n=CV(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new he(4009,!1);return this.capture(n),new AI(LM(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const t=function rq(e){const n=e.match(iq);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let o="";if(this.consumeOptional("=")){const c=CV(this.remaining);c&&(o=c,this.capture(o))}n[LM(t)]=LM(o)}parseQueryParam(n){const t=function sq(e){const n=e.match(oq);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let o="";if(this.consumeOptional("=")){const f=function cq(e){const n=e.match(aq);return n?n[0]:""}(this.remaining);f&&(o=f,this.capture(o))}const c=g6(t),u=g6(o);if(n.hasOwnProperty(c)){let f=n[c];Array.isArray(f)||(f=[f],n[c]=f),f.push(u)}else n[c]=u}parseParens(n){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const o=CV(this.remaining),c=this.remaining[o.length];if("/"!==c&&")"!==c&&";"!==c)throw new he(4010,!1);let u;o.indexOf(":")>-1?(u=o.slice(0,o.indexOf(":")),this.capture(u),this.capture(":")):n&&(u=Ut);const f=this.parseChildren();t[u]=1===Object.keys(f).length?f[Ut]:new di([],f),this.consumeOptional("//")}return t}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new he(4011,!1)}}function E6(e){return e.segments.length>0?new di([],{[Ut]:e}):e}function v6(e){const n={};for(const[o,c]of Object.entries(e.children)){const u=v6(c);if(o===Ut&&0===u.segments.length&&u.hasChildren())for(const[f,g]of Object.entries(u.children))n[f]=g;else(u.segments.length>0||u.hasChildren())&&(n[o]=u)}return function lq(e){if(1===e.numberOfChildren&&e.children[Ut]){const n=e.children[Ut];return new di(e.segments.concat(n.segments),n.children)}return e}(new di(e.segments,n))}function Db(e){return e instanceof Rb}function b6(e){let n;const c=E6(function t(u){const f={};for(const E of u.children){const C=t(E);f[E.outlet]=C}const g=new di(u.url,f);return u===e&&(n=g),g}(e.root));return n??c}function y6(e,n,t,o){let c=e;for(;c.parent;)c=c.parent;if(0===n.length)return SV(c,c,c,t,o);const u=function hq(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new S6(!0,0,e);let n=0,t=!1;const o=e.reduce((c,u,f)=>{if("object"==typeof u&&null!=u){if(u.outlets){const g={};return Object.entries(u.outlets).forEach(([E,C])=>{g[E]="string"==typeof C?C.split("/"):C}),[...c,{outlets:g}]}if(u.segmentPath)return[...c,u.segmentPath]}return"string"!=typeof u?[...c,u]:0===f?(u.split("/").forEach((g,E)=>{0==E&&"."===g||(0==E&&""===g?t=!0:".."===g?n++:""!=g&&c.push(g))}),c):[...c,u]},[]);return new S6(t,n,o)}(n);if(u.toRoot())return SV(c,c,new di([],{}),t,o);const f=function pq(e,n,t){if(e.isAbsolute)return new UM(n,!0,0);if(!t)return new UM(n,!1,NaN);if(null===t.parent)return new UM(t,!0,0);const o=FM(e.commands[0])?0:1;return function fq(e,n,t){let o=e,c=n,u=t;for(;u>c;){if(u-=c,o=o.parent,!o)throw new he(4005,!1);c=o.segments.length}return new UM(o,!1,c-u)}(t,t.segments.length-1+o,e.numberOfDoubleDots)}(u,c,e),g=f.processChildren?NI(f.segmentGroup,f.index,u.commands):T6(f.segmentGroup,f.index,u.commands);return SV(c,f.segmentGroup,g,t,o)}function FM(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function OI(e){return"object"==typeof e&&null!=e&&e.outlets}function SV(e,n,t,o,c){let f,u={};o&&Object.entries(o).forEach(([E,C])=>{u[E]=Array.isArray(C)?C.map(R=>`${R}`):`${C}`}),f=e===n?t:C6(e,n,t);const g=E6(v6(f));return new Rb(g,u,c)}function C6(e,n,t){const o={};return Object.entries(e.children).forEach(([c,u])=>{o[c]=u===n?t:C6(u,n,t)}),new di(e.segments,o)}class S6{constructor(n,t,o){if(this.isAbsolute=n,this.numberOfDoubleDots=t,this.commands=o,n&&o.length>0&&FM(o[0]))throw new he(4003,!1);const c=o.find(OI);if(c&&c!==d6(o))throw new he(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class UM{constructor(n,t,o){this.segmentGroup=n,this.processChildren=t,this.index=o}}function T6(e,n,t){if(e??=new di([],{}),0===e.segments.length&&e.hasChildren())return NI(e,n,t);const o=function gq(e,n,t){let o=0,c=n;const u={match:!1,pathIndex:0,commandIndex:0};for(;c<e.segments.length;){if(o>=t.length)return u;const f=e.segments[c],g=t[o];if(OI(g))break;const E=`${g}`,C=o<t.length-1?t[o+1]:null;if(c>0&&void 0===E)break;if(E&&C&&"object"==typeof C&&void 0===C.outlets){if(!w6(E,C,f))return u;o+=2}else{if(!w6(E,{},f))return u;o++}c++}return{match:!0,pathIndex:c,commandIndex:o}}(e,n,t),c=t.slice(o.commandIndex);if(o.match&&o.pathIndex<e.segments.length){const u=new di(e.segments.slice(0,o.pathIndex),{});return u.children[Ut]=new di(e.segments.slice(o.pathIndex),e.children),NI(u,0,c)}return o.match&&0===c.length?new di(e.segments,{}):o.match&&!e.hasChildren()?TV(e,n,t):o.match?NI(e,0,c):TV(e,n,t)}function NI(e,n,t){if(0===t.length)return new di(e.segments,{});{const o=function mq(e){return OI(e[0])?e[0].outlets:{[Ut]:e}}(t),c={};if(Object.keys(o).some(u=>u!==Ut)&&e.children[Ut]&&1===e.numberOfChildren&&0===e.children[Ut].segments.length){const u=NI(e.children[Ut],n,t);return new di(e.segments,u.children)}return Object.entries(o).forEach(([u,f])=>{"string"==typeof f&&(f=[f]),null!==f&&(c[u]=T6(e.children[u],n,f))}),Object.entries(e.children).forEach(([u,f])=>{void 0===o[u]&&(c[u]=f)}),new di(e.segments,c)}}function TV(e,n,t){const o=e.segments.slice(0,n);let c=0;for(;c<t.length;){const u=t[c];if(OI(u)){const E=_q(u.outlets);return new di(o,E)}if(0===c&&FM(t[0])){o.push(new AI(e.segments[n].path,I6(t[0]))),c++;continue}const f=OI(u)?u.outlets[Ut]:`${u}`,g=c<t.length-1?t[c+1]:null;f&&g&&FM(g)?(o.push(new AI(f,I6(g))),c+=2):(o.push(new AI(f,{})),c++)}return new di(o,{})}function _q(e){const n={};return Object.entries(e).forEach(([t,o])=>{"string"==typeof o&&(o=[o]),null!==o&&(n[t]=TV(new di([],{}),0,o))}),n}function I6(e){const n={};return Object.entries(e).forEach(([t,o])=>n[t]=`${o}`),n}function w6(e,n,t){return e==t.path&&cl(n,t.parameters)}const PI="imperative";var an=function(e){return e[e.NavigationStart=0]="NavigationStart",e[e.NavigationEnd=1]="NavigationEnd",e[e.NavigationCancel=2]="NavigationCancel",e[e.NavigationError=3]="NavigationError",e[e.RoutesRecognized=4]="RoutesRecognized",e[e.ResolveStart=5]="ResolveStart",e[e.ResolveEnd=6]="ResolveEnd",e[e.GuardsCheckStart=7]="GuardsCheckStart",e[e.GuardsCheckEnd=8]="GuardsCheckEnd",e[e.RouteConfigLoadStart=9]="RouteConfigLoadStart",e[e.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",e[e.ChildActivationStart=11]="ChildActivationStart",e[e.ChildActivationEnd=12]="ChildActivationEnd",e[e.ActivationStart=13]="ActivationStart",e[e.ActivationEnd=14]="ActivationEnd",e[e.Scroll=15]="Scroll",e[e.NavigationSkipped=16]="NavigationSkipped",e}(an||{});class dl{constructor(n,t){this.id=n,this.url=t}}class VM extends dl{constructor(n,t,o="imperative",c=null){super(n,t),this.type=an.NavigationStart,this.navigationTrigger=o,this.restoredState=c}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Uu extends dl{constructor(n,t,o){super(n,t),this.urlAfterRedirects=o,this.type=an.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var rc=function(e){return e[e.Redirect=0]="Redirect",e[e.SupersededByNewNavigation=1]="SupersededByNewNavigation",e[e.NoDataFromResolver=2]="NoDataFromResolver",e[e.GuardRejected=3]="GuardRejected",e}(rc||{}),BM=function(e){return e[e.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",e[e.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",e}(BM||{});class Ob extends dl{constructor(n,t,o,c){super(n,t),this.reason=o,this.code=c,this.type=an.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Nb extends dl{constructor(n,t,o,c){super(n,t),this.reason=o,this.code=c,this.type=an.NavigationSkipped}}class jM extends dl{constructor(n,t,o,c){super(n,t),this.error=o,this.target=c,this.type=an.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class R6 extends dl{constructor(n,t,o,c){super(n,t),this.urlAfterRedirects=o,this.state=c,this.type=an.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Eq extends dl{constructor(n,t,o,c){super(n,t),this.urlAfterRedirects=o,this.state=c,this.type=an.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class vq extends dl{constructor(n,t,o,c,u){super(n,t),this.urlAfterRedirects=o,this.state=c,this.shouldActivate=u,this.type=an.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class bq extends dl{constructor(n,t,o,c){super(n,t),this.urlAfterRedirects=o,this.state=c,this.type=an.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class yq extends dl{constructor(n,t,o,c){super(n,t),this.urlAfterRedirects=o,this.state=c,this.type=an.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Cq{constructor(n){this.route=n,this.type=an.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Sq{constructor(n){this.route=n,this.type=an.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Tq{constructor(n){this.snapshot=n,this.type=an.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Iq{constructor(n){this.snapshot=n,this.type=an.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class wq{constructor(n){this.snapshot=n,this.type=an.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Rq{constructor(n){this.snapshot=n,this.type=an.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class A6{constructor(n,t,o){this.routerEvent=n,this.position=t,this.anchor=o,this.type=an.Scroll}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class IV{}class wV{constructor(n){this.url=n}}class Aq{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new MI,this.attachRef=null}}let MI=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(t,o){const c=this.getOrCreateContext(t);c.outlet=o,this.contexts.set(t,c)}onChildOutletDestroyed(t){const o=this.getContext(t);o&&(o.outlet=null,o.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let o=this.getContext(t);return o||(o=new Aq,this.contexts.set(t,o)),o}getContext(t){return this.contexts.get(t)||null}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class D6{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const t=this.pathFromRoot(n);return t.length>1?t[t.length-2]:null}children(n){const t=RV(n,this._root);return t?t.children.map(o=>o.value):[]}firstChild(n){const t=RV(n,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(n){const t=AV(n,this._root);return t.length<2?[]:t[t.length-2].children.map(c=>c.value).filter(c=>c!==n)}pathFromRoot(n){return AV(n,this._root).map(t=>t.value)}}function RV(e,n){if(e===n.value)return n;for(const t of n.children){const o=RV(e,t);if(o)return o}return null}function AV(e,n){if(e===n.value)return[n];for(const t of n.children){const o=AV(e,t);if(o.length)return o.unshift(n),o}return[]}class nd{constructor(n,t){this.value=n,this.children=t}toString(){return`TreeNode(${this.value})`}}function Pb(e){const n={};return e&&e.children.forEach(t=>n[t.value.outlet]=t),n}class O6 extends D6{constructor(n,t){super(n),this.snapshot=t,NV(this,n)}toString(){return this.snapshot.toString()}}function N6(e){const n=function Dq(e){const u=new OV([],{},{},"",{},Ut,e,null,{});return new P6("",new nd(u,[]))}(e),t=new oo([new AI("",{})]),o=new oo({}),c=new oo({}),u=new oo({}),f=new oo(""),g=new Og(t,o,u,f,c,Ut,e,n.root);return g.snapshot=n.root,new O6(new nd(g,[]),n)}class Og{constructor(n,t,o,c,u,f,g,E){this.urlSubject=n,this.paramsSubject=t,this.queryParamsSubject=o,this.fragmentSubject=c,this.dataSubject=u,this.outlet=f,this.component=g,this._futureSnapshot=E,this.title=this.dataSubject?.pipe(Yt(C=>C[RI]))??pt(void 0),this.url=n,this.params=t,this.queryParams=o,this.fragment=c,this.data=u}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Yt(n=>wb(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Yt(n=>wb(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function DV(e,n,t="emptyOnly"){let o;const{routeConfig:c}=e;return o=null===n||"always"!==t&&""!==c?.path&&(n.component||n.routeConfig?.loadComponent)?{params:{...e.params},data:{...e.data},resolve:{...e.data,...e._resolvedData??{}}}:{params:{...n.params,...e.params},data:{...n.data,...e.data},resolve:{...e.data,...n.data,...c?.data,...e._resolvedData}},c&&x6(c)&&(o.resolve[RI]=c.title),o}class OV{get title(){return this.data?.[RI]}constructor(n,t,o,c,u,f,g,E,C){this.url=n,this.params=t,this.queryParams=o,this.fragment=c,this.data=u,this.outlet=f,this.component=g,this.routeConfig=E,this._resolve=C}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=wb(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=wb(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(o=>o.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class P6 extends D6{constructor(n,t){super(t),this.url=n,NV(this,t)}toString(){return M6(this._root)}}function NV(e,n){n.value._routerState=e,n.children.forEach(t=>NV(e,t))}function M6(e){const n=e.children.length>0?` { ${e.children.map(M6).join(", ")} } `:"";return`${e.value}${n}`}function PV(e){if(e.snapshot){const n=e.snapshot,t=e._futureSnapshot;e.snapshot=t,cl(n.queryParams,t.queryParams)||e.queryParamsSubject.next(t.queryParams),n.fragment!==t.fragment&&e.fragmentSubject.next(t.fragment),cl(n.params,t.params)||e.paramsSubject.next(t.params),function KK(e,n){if(e.length!==n.length)return!1;for(let t=0;t<e.length;++t)if(!cl(e[t],n[t]))return!1;return!0}(n.url,t.url)||e.urlSubject.next(t.url),cl(n.data,t.data)||e.dataSubject.next(t.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function MV(e,n){const t=cl(e.params,n.params)&&function XK(e,n){return Dg(e,n)&&e.every((t,o)=>cl(t.parameters,n[o].parameters))}(e.url,n.url);return t&&!(!e.parent!=!n.parent)&&(!e.parent||MV(e.parent,n.parent))}function x6(e){return"string"==typeof e.title||null===e.title}let xV=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=Ut,this.activateEvents=new pn,this.deactivateEvents=new pn,this.attachEvents=new pn,this.detachEvents=new pn,this.parentContexts=Te(MI),this.location=Te(mr),this.changeDetector=Te(Us),this.environmentInjector=Te(ns),this.inputBinder=Te(HM,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){const{firstChange:o,previousValue:c}=t.name;if(o)return;this.isTrackedInParentContexts(c)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(c)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new he(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new he(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new he(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,o){this.activated=t,this._activatedRoute=o,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,o){if(this.isActivated)throw new he(4013,!1);this._activatedRoute=t;const c=this.location,f=t.snapshot.component,g=this.parentContexts.getOrCreateContext(this.name).children,E=new Oq(t,g,c.injector);this.activated=c.createComponent(f,{index:c.length,injector:E,environmentInjector:o??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275dir=Ye({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[So]})}return e})();class Oq{constructor(n,t,o){this.route=n,this.childContexts=t,this.parent=o}get(n,t){return n===Og?this.route:n===MI?this.childContexts:this.parent.get(n,t)}}const HM=new De("");let k6=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){const{activatedRoute:o}=t,c=sM([o.queryParams,o.params,o.data]).pipe(td(([u,f,g],E)=>(g={...u,...f,...g},0===E?pt(g):Promise.resolve(g)))).subscribe(u=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==o||null===o.component)return void this.unsubscribeFromRouteData(t);const f=function aP(e){const n=Lt(e);if(!n)return null;const t=new Zf(n);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}(o.component);if(f)for(const{templateName:g}of f.inputs)t.activatedComponentRef.setInput(g,u[g]);else this.unsubscribeFromRouteData(t)});this.outletDataSubscriptions.set(t,c)}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();function xI(e,n,t){if(t&&e.shouldReuseRoute(n.value,t.value.snapshot)){const o=t.value;o._futureSnapshot=n.value;const c=function Pq(e,n,t){return n.children.map(o=>{for(const c of t.children)if(e.shouldReuseRoute(o.value,c.value.snapshot))return xI(e,o,c);return xI(e,o)})}(e,n,t);return new nd(o,c)}{if(e.shouldAttach(n.value)){const u=e.retrieve(n.value);if(null!==u){const f=u.route;return f.value._futureSnapshot=n.value,f.children=n.children.map(g=>xI(e,g)),f}}const o=function Mq(e){return new Og(new oo(e.url),new oo(e.params),new oo(e.queryParams),new oo(e.fragment),new oo(e.data),e.outlet,e.component,e)}(n.value),c=n.children.map(u=>xI(e,u));return new nd(o,c)}}const L6="ngNavigationCancelingError";function F6(e,n){const{redirectTo:t,navigationBehaviorOptions:o}=Db(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,c=U6(!1,rc.Redirect);return c.url=t,c.navigationBehaviorOptions=o,c}function U6(e,n){const t=new Error(`NavigationCancelingError: ${e||""}`);return t[L6]=!0,t.cancellationCode=n,t}function V6(e){return!!e&&e[L6]}let B6=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Br({type:e,selectors:[["ng-component"]],standalone:!0,features:[Hc],decls:1,vars:0,template:function(o,c){1&o&&ce(0,"router-outlet")},dependencies:[xV],encapsulation:2})}return e})();function kV(e){const n=e.children&&e.children.map(kV),t=n?{...e,children:n}:{...e};return!t.component&&!t.loadComponent&&(n||t.loadChildren)&&t.outlet&&t.outlet!==Ut&&(t.component=B6),t}function ll(e){return e.outlet||Ut}function kI(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let n=e.parent;n;n=n.parent){const t=n.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class jq{constructor(n,t,o,c,u){this.routeReuseStrategy=n,this.futureState=t,this.currState=o,this.forwardEvent=c,this.inputBindingEnabled=u}activate(n){const t=this.futureState._root,o=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,o,n),PV(this.futureState.root),this.activateChildRoutes(t,o,n)}deactivateChildRoutes(n,t,o){const c=Pb(t);n.children.forEach(u=>{const f=u.value.outlet;this.deactivateRoutes(u,c[f],o),delete c[f]}),Object.values(c).forEach(u=>{this.deactivateRouteAndItsChildren(u,o)})}deactivateRoutes(n,t,o){const c=n.value,u=t?t.value:null;if(c===u)if(c.component){const f=o.getContext(c.outlet);f&&this.deactivateChildRoutes(n,t,f.children)}else this.deactivateChildRoutes(n,t,o);else u&&this.deactivateRouteAndItsChildren(t,o)}deactivateRouteAndItsChildren(n,t){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,t):this.deactivateRouteAndOutlet(n,t)}detachAndStoreRouteSubtree(n,t){const o=t.getContext(n.value.outlet),c=o&&n.value.component?o.children:t,u=Pb(n);for(const f of Object.values(u))this.deactivateRouteAndItsChildren(f,c);if(o&&o.outlet){const f=o.outlet.detach(),g=o.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:f,route:n,contexts:g})}}deactivateRouteAndOutlet(n,t){const o=t.getContext(n.value.outlet),c=o&&n.value.component?o.children:t,u=Pb(n);for(const f of Object.values(u))this.deactivateRouteAndItsChildren(f,c);o&&(o.outlet&&(o.outlet.deactivate(),o.children.onOutletDeactivated()),o.attachRef=null,o.route=null)}activateChildRoutes(n,t,o){const c=Pb(t);n.children.forEach(u=>{this.activateRoutes(u,c[u.value.outlet],o),this.forwardEvent(new Rq(u.value.snapshot))}),n.children.length&&this.forwardEvent(new Iq(n.value.snapshot))}activateRoutes(n,t,o){const c=n.value,u=t?t.value:null;if(PV(c),c===u)if(c.component){const f=o.getOrCreateContext(c.outlet);this.activateChildRoutes(n,t,f.children)}else this.activateChildRoutes(n,t,o);else if(c.component){const f=o.getOrCreateContext(c.outlet);if(this.routeReuseStrategy.shouldAttach(c.snapshot)){const g=this.routeReuseStrategy.retrieve(c.snapshot);this.routeReuseStrategy.store(c.snapshot,null),f.children.onOutletReAttached(g.contexts),f.attachRef=g.componentRef,f.route=g.route.value,f.outlet&&f.outlet.attach(g.componentRef,g.route.value),PV(g.route.value),this.activateChildRoutes(n,null,f.children)}else{const g=kI(c.snapshot);f.attachRef=null,f.route=c,f.injector=g,f.outlet&&f.outlet.activateWith(c,f.injector),this.activateChildRoutes(n,null,f.children)}}else this.activateChildRoutes(n,null,o)}}class j6{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class GM{constructor(n,t){this.component=n,this.route=t}}function Hq(e,n,t){const o=e._root;return LI(o,n?n._root:null,t,[o.value])}function Mb(e,n){const t=Symbol(),o=n.get(e,t);return o===t?"function"!=typeof e||function fx(e){return null!==Yg(e)}(e)?n.get(e):e:o}function LI(e,n,t,o,c={canDeactivateChecks:[],canActivateChecks:[]}){const u=Pb(n);return e.children.forEach(f=>{(function Wq(e,n,t,o,c={canDeactivateChecks:[],canActivateChecks:[]}){const u=e.value,f=n?n.value:null,g=t?t.getContext(e.value.outlet):null;if(f&&u.routeConfig===f.routeConfig){const E=function zq(e,n,t){if("function"==typeof t)return t(e,n);switch(t){case"pathParamsChange":return!Dg(e.url,n.url);case"pathParamsOrQueryParamsChange":return!Dg(e.url,n.url)||!cl(e.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!MV(e,n)||!cl(e.queryParams,n.queryParams);default:return!MV(e,n)}}(f,u,u.routeConfig.runGuardsAndResolvers);E?c.canActivateChecks.push(new j6(o)):(u.data=f.data,u._resolvedData=f._resolvedData),LI(e,n,u.component?g?g.children:null:t,o,c),E&&g&&g.outlet&&g.outlet.isActivated&&c.canDeactivateChecks.push(new GM(g.outlet.component,f))}else f&&FI(n,g,c),c.canActivateChecks.push(new j6(o)),LI(e,null,u.component?g?g.children:null:t,o,c)})(f,u[f.value.outlet],t,o.concat([f.value]),c),delete u[f.value.outlet]}),Object.entries(u).forEach(([f,g])=>FI(g,t.getContext(f),c)),c}function FI(e,n,t){const o=Pb(e),c=e.value;Object.entries(o).forEach(([u,f])=>{FI(f,c.component?n?n.children.getContext(u):null:n,t)}),t.canDeactivateChecks.push(new GM(c.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,c))}function UI(e){return"function"==typeof e}function H6(e){return e instanceof OM||"EmptyError"===e?.name}const WM=Symbol("INITIAL_VALUE");function xb(){return td(e=>sM(e.map(n=>n.pipe(Vr(1),_4(WM)))).pipe(Yt(n=>{for(const t of n)if(!0!==t){if(t===WM)return WM;if(!1===t||t instanceof Rb)return t}return!0}),Ea(n=>n!==WM),Vr(1)))}function G6(e){return function ex(...e){return $I(e)}(io(n=>{if(Db(n))throw F6(0,n)}),Yt(n=>!0===n))}class LV{constructor(n){this.segmentGroup=n||null}}class FV extends Error{constructor(n){super(),this.urlTree=n}}function kb(e){return NM(new LV(e))}class lY{constructor(n,t){this.urlSerializer=n,this.urlTree=t}lineralizeSegments(n,t){let o=[],c=t.root;for(;;){if(o=o.concat(c.segments),0===c.numberOfChildren)return pt(o);if(c.numberOfChildren>1||!c.children[Ut])return NM(new he(4e3,!1));c=c.children[Ut]}}applyRedirectCommands(n,t,o){const c=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),n,o);if(t.startsWith("/"))throw new FV(c);return c}applyRedirectCreateUrlTree(n,t,o,c){const u=this.createSegmentGroup(n,t.root,o,c);return new Rb(u,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(n,t){const o={};return Object.entries(n).forEach(([c,u])=>{if("string"==typeof u&&u.startsWith(":")){const g=u.substring(1);o[c]=t[g]}else o[c]=u}),o}createSegmentGroup(n,t,o,c){const u=this.createSegments(n,t.segments,o,c);let f={};return Object.entries(t.children).forEach(([g,E])=>{f[g]=this.createSegmentGroup(n,E,o,c)}),new di(u,f)}createSegments(n,t,o,c){return t.map(u=>u.path.startsWith(":")?this.findPosParam(n,u,c):this.findOrReturn(u,o))}findPosParam(n,t,o){const c=o[t.path.substring(1)];if(!c)throw new he(4001,!1);return c}findOrReturn(n,t){let o=0;for(const c of t){if(c.path===n.path)return t.splice(o),c;o++}return n}}const UV={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function uY(e,n,t,o,c){const u=VV(e,n,t);return u.matched?(o=function kq(e,n){return e.providers&&!e._injector&&(e._injector=Um(e.providers,n,`Route: ${e.path}`)),e._injector??n}(n,o),function aY(e,n,t,o){const c=n.canMatch;return c&&0!==c.length?pt(c.map(f=>{const g=Mb(f,e);return jp(function Jq(e){return e&&UI(e.canMatch)}(g)?g.canMatch(n,t):Ro(e,()=>g(n,t)))})).pipe(xb(),G6()):pt(!0)}(o,n,t).pipe(Yt(f=>!0===f?u:{...UV}))):pt(u)}function VV(e,n,t){if("**"===n.path)return function hY(e){return{matched:!0,parameters:e.length>0?d6(e).parameters:{},consumedSegments:e,remainingSegments:[],positionalParamSegments:{}}}(t);if(""===n.path)return"full"===n.pathMatch&&(e.hasChildren()||t.length>0)?{...UV}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const c=(n.matcher||zK)(t,e,n);if(!c)return{...UV};const u={};Object.entries(c.posParams??{}).forEach(([g,E])=>{u[g]=E.path});const f=c.consumed.length>0?{...u,...c.consumed[c.consumed.length-1].parameters}:u;return{matched:!0,consumedSegments:c.consumed,remainingSegments:t.slice(c.consumed.length),parameters:f,positionalParamSegments:c.posParams??{}}}function W6(e,n,t,o){return t.length>0&&function mY(e,n,t){return t.some(o=>zM(e,n,o)&&ll(o)!==Ut)}(e,t,o)?{segmentGroup:new di(n,fY(o,new di(t,e.children))),slicedSegments:[]}:0===t.length&&function gY(e,n,t){return t.some(o=>zM(e,n,o))}(e,t,o)?{segmentGroup:new di(e.segments,pY(e,t,o,e.children)),slicedSegments:t}:{segmentGroup:new di(e.segments,e.children),slicedSegments:t}}function pY(e,n,t,o){const c={};for(const u of t)if(zM(e,n,u)&&!o[ll(u)]){const f=new di([],{});c[ll(u)]=f}return{...o,...c}}function fY(e,n){const t={};t[Ut]=n;for(const o of e)if(""===o.path&&ll(o)!==Ut){const c=new di([],{});t[ll(o)]=c}return t}function zM(e,n,t){return(!(e.hasChildren()||n.length>0)||"full"!==t.pathMatch)&&""===t.path}class vY{}class CY{constructor(n,t,o,c,u,f,g){this.injector=n,this.configLoader=t,this.rootComponentType=o,this.config=c,this.urlTree=u,this.paramsInheritanceStrategy=f,this.urlSerializer=g,this.applyRedirects=new lY(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(n){return new he(4002,`'${n.segmentGroup}'`)}recognize(){const n=W6(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(Yt(t=>{const o=new OV([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Ut,this.rootComponentType,null,{}),c=new nd(o,t),u=new P6("",c),f=function uq(e,n,t=null,o=null){return y6(b6(e),n,t,o)}(o,[],this.urlTree.queryParams,this.urlTree.fragment);return f.queryParams=this.urlTree.queryParams,u.url=this.urlSerializer.serialize(f),this.inheritParamsAndData(u._root,null),{state:u,tree:f}}))}match(n){return this.processSegmentGroup(this.injector,this.config,n,Ut).pipe(Ib(o=>{if(o instanceof FV)return this.urlTree=o.urlTree,this.match(o.urlTree.root);throw o instanceof LV?this.noMatchError(o):o}))}inheritParamsAndData(n,t){const o=n.value,c=DV(o,t,this.paramsInheritanceStrategy);o.params=Object.freeze(c.params),o.data=Object.freeze(c.data),n.children.forEach(u=>this.inheritParamsAndData(u,o))}processSegmentGroup(n,t,o,c){return 0===o.segments.length&&o.hasChildren()?this.processChildren(n,t,o):this.processSegment(n,t,o,o.segments,c,!0).pipe(Yt(u=>u instanceof nd?[u]:[]))}processChildren(n,t,o){const c=[];for(const u of Object.keys(o.children))"primary"===u?c.unshift(u):c.push(u);return Ur(c).pipe(wI(u=>{const f=o.children[u],g=function Vq(e,n){const t=e.filter(o=>ll(o)===n);return t.push(...e.filter(o=>ll(o)!==n)),t}(t,u);return this.processSegmentGroup(n,g,f,u)}),function HK(e,n){return fi(function jK(e,n,t,o,c){return(u,f)=>{let g=t,E=n,C=0;u.subscribe(Jn(f,R=>{const P=C++;E=g?e(E,R,P):(g=!0,R),o&&f.next(E)},c&&(()=>{g&&f.next(E),f.complete()})))}}(e,n,arguments.length>=2,!0))}((u,f)=>(u.push(...f),u)),PM(null),function GK(e,n){const t=arguments.length>=2;return o=>o.pipe(e?Ea((c,u)=>e(c,u,o)):ad,_V(1),t?PM(n):s6(()=>new OM))}(),no(u=>{if(null===u)return kb(o);const f=z6(u);return function SY(e){e.sort((n,t)=>n.value.outlet===Ut?-1:t.value.outlet===Ut?1:n.value.outlet.localeCompare(t.value.outlet))}(f),pt(f)}))}processSegment(n,t,o,c,u,f){return Ur(t).pipe(wI(g=>this.processSegmentAgainstRoute(g._injector??n,t,g,o,c,u,f).pipe(Ib(E=>{if(E instanceof LV)return pt(null);throw E}))),Ag(g=>!!g),Ib(g=>{if(H6(g))return function EY(e,n,t){return 0===n.length&&!e.children[t]}(o,c,u)?pt(new vY):kb(o);throw g}))}processSegmentAgainstRoute(n,t,o,c,u,f,g){return function _Y(e,n,t,o){return!!(ll(e)===o||o!==Ut&&zM(n,t,e))&&VV(n,e,t).matched}(o,c,u,f)?void 0===o.redirectTo?this.matchSegmentAgainstRoute(n,c,o,u,f):this.allowRedirects&&g?this.expandSegmentAgainstRouteUsingRedirect(n,c,t,o,u,f):kb(c):kb(c)}expandSegmentAgainstRouteUsingRedirect(n,t,o,c,u,f){const{matched:g,consumedSegments:E,positionalParamSegments:C,remainingSegments:R}=VV(t,c,u);if(!g)return kb(t);c.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const P=this.applyRedirects.applyRedirectCommands(E,c.redirectTo,C);return this.applyRedirects.lineralizeSegments(c,P).pipe(no(B=>this.processSegment(n,o,t,B.concat(R),f,!1)))}matchSegmentAgainstRoute(n,t,o,c,u){const f=uY(t,o,c,n);return"**"===o.path&&(t.children={}),f.pipe(td(g=>g.matched?this.getChildConfig(n=o._injector??n,o,c).pipe(td(({routes:E})=>{const C=o._loadedInjector??n,{consumedSegments:R,remainingSegments:P,parameters:B}=g,G=new OV(R,B,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,function IY(e){return e.data||{}}(o),ll(o),o.component??o._loadedComponent??null,o,function wY(e){return e.resolve||{}}(o)),{segmentGroup:Y,slicedSegments:J}=W6(t,R,P,E);if(0===J.length&&Y.hasChildren())return this.processChildren(C,E,Y).pipe(Yt(ge=>null===ge?null:new nd(G,ge)));if(0===E.length&&0===J.length)return pt(new nd(G,[]));const le=ll(o)===u;return this.processSegment(C,E,Y,J,le?Ut:u,!0).pipe(Yt(ge=>new nd(G,ge instanceof nd?[ge]:[])))})):kb(t)))}getChildConfig(n,t,o){return t.children?pt({routes:t.children,injector:n}):t.loadChildren?void 0!==t._loadedRoutes?pt({routes:t._loadedRoutes,injector:t._loadedInjector}):function sY(e,n,t,o){const c=n.canLoad;return void 0===c||0===c.length?pt(!0):pt(c.map(f=>{const g=Mb(f,e);return jp(function qq(e){return e&&UI(e.canLoad)}(g)?g.canLoad(n,t):Ro(e,()=>g(n,t)))})).pipe(xb(),G6())}(n,t,o).pipe(no(c=>c?this.configLoader.loadChildren(n,t).pipe(io(u=>{t._loadedRoutes=u.routes,t._loadedInjector=u.injector})):function dY(e){return NM(U6(!1,rc.GuardRejected))}())):pt({routes:[],injector:n})}}function TY(e){const n=e.value.routeConfig;return n&&""===n.path}function z6(e){const n=[],t=new Set;for(const o of e){if(!TY(o)){n.push(o);continue}const c=n.find(u=>o.value.routeConfig===u.value.routeConfig);void 0!==c?(c.children.push(...o.children),t.add(c)):n.push(o)}for(const o of t){const c=z6(o.children);n.push(new nd(o.value,c))}return n.filter(o=>!t.has(o))}function K6(e){const n=e.children.map(t=>K6(t)).flat();return[e,...n]}function BV(e){return td(n=>{const t=e(n);return t?Ur(t).pipe(Yt(()=>n)):pt(n)})}let q6=(()=>{class e{buildTitle(t){let o,c=t.root;for(;void 0!==c;)o=this.getResolvedTitleForRoute(c)??o,c=c.children.find(u=>u.outlet===Ut);return o}getResolvedTitleForRoute(t){return t.data[RI]}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:()=>Te(PY),providedIn:"root"})}return e})(),PY=(()=>{class e extends q6{constructor(t){super(),this.title=t}updateTitle(t){const o=this.buildTitle(t);void 0!==o&&this.title.setTitle(o)}static#e=this.\u0275fac=function(o){return new(o||e)(be(FH))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Lb=new De("",{providedIn:"root",factory:()=>({})}),Fb=new De("");let jV=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Te(kv)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return pt(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const o=jp(t.loadComponent()).pipe(Yt(Y6),io(u=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=u}),EV(()=>{this.componentLoaders.delete(t)})),c=new o6(o,()=>new en).pipe(gV());return this.componentLoaders.set(t,c),c}loadChildren(t,o){if(this.childrenLoaders.get(o))return this.childrenLoaders.get(o);if(o._loadedRoutes)return pt({routes:o._loadedRoutes,injector:o._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(o);const u=function MY(e,n,t,o){return jp(e.loadChildren()).pipe(Yt(Y6),no(c=>c instanceof oN||Array.isArray(c)?pt(c):Ur(n.compileModuleAsync(c))),Yt(c=>{o&&o(e);let u,f,g=!1;return Array.isArray(c)?(f=c,!0):(u=c.create(t).injector,f=u.get(Fb,[],{optional:!0,self:!0}).flat()),{routes:f.map(kV),injector:u}}))}(o,this.compiler,t,this.onLoadEndListener).pipe(EV(()=>{this.childrenLoaders.delete(o)})),f=new o6(u,()=>new en).pipe(gV());return this.childrenLoaders.set(o,f),f}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function Y6(e){return function xY(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let HV=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:()=>Te(kY),providedIn:"root"})}return e})(),kY=(()=>{class e{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,o){return t}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const $6=new De(""),X6=new De("");function LY(e,n,t){const o=e.get(X6),c=e.get(sn);return e.get(it).runOutsideAngular(()=>{if(!c.startViewTransition||o.skipNextTransition)return o.skipNextTransition=!1,Promise.resolve();let u;const f=new Promise(C=>{u=C}),g=c.startViewTransition(()=>(u(),function FY(e){return new Promise(n=>{cD(n,{injector:e})})}(e))),{onViewTransitionCreated:E}=o;return E&&Ro(e,()=>E({transition:g,from:n,to:t})),f})}let KM=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new en,this.transitionAbortSubject=new en,this.configLoader=Te(jV),this.environmentInjector=Te(ns),this.urlSerializer=Te(Ab),this.rootContexts=Te(MI),this.location=Te(Hi),this.inputBindingEnabled=null!==Te(HM,{optional:!0}),this.titleStrategy=Te(q6),this.options=Te(Lb,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=Te(HV),this.createViewTransition=Te($6,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>pt(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=c=>this.events.next(new Sq(c)),this.configLoader.onLoadStartListener=c=>this.events.next(new Cq(c))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const o=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:o})}setupNavigations(t,o,c){return this.transitions=new oo({id:0,currentUrlTree:o,currentRawUrl:o,extractedUrl:this.urlHandlingStrategy.extract(o),urlAfterRedirects:this.urlHandlingStrategy.extract(o),rawUrl:o,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:PI,restoredState:null,currentSnapshot:c.snapshot,targetSnapshot:null,currentRouterState:c,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Ea(u=>0!==u.id),Yt(u=>({...u,extractedUrl:this.urlHandlingStrategy.extract(u.rawUrl)})),td(u=>{this.currentTransition=u;let f=!1,g=!1;return pt(u).pipe(io(E=>{this.currentNavigation={id:E.id,initialUrl:E.rawUrl,extractedUrl:E.extractedUrl,trigger:E.source,extras:E.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),td(E=>{const C=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!C&&"reload"!==(E.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const P="";return this.events.next(new Nb(E.id,this.urlSerializer.serialize(E.rawUrl),P,BM.IgnoredSameUrlNavigation)),E.resolve(null),Zc}if(this.urlHandlingStrategy.shouldProcessUrl(E.rawUrl))return pt(E).pipe(td(P=>{const B=this.transitions?.getValue();return this.events.next(new VM(P.id,this.urlSerializer.serialize(P.extractedUrl),P.source,P.restoredState)),B!==this.transitions?.getValue()?Zc:Promise.resolve(P)}),function RY(e,n,t,o,c,u){return no(f=>function bY(e,n,t,o,c,u,f="emptyOnly"){return new CY(e,n,t,o,c,f,u).recognize()}(e,n,t,o,f.extractedUrl,c,u).pipe(Yt(({state:g,tree:E})=>({...f,targetSnapshot:g,urlAfterRedirects:E}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),io(P=>{u.targetSnapshot=P.targetSnapshot,u.urlAfterRedirects=P.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:P.urlAfterRedirects};const B=new R6(P.id,this.urlSerializer.serialize(P.extractedUrl),this.urlSerializer.serialize(P.urlAfterRedirects),P.targetSnapshot);this.events.next(B)}));if(C&&this.urlHandlingStrategy.shouldProcessUrl(E.currentRawUrl)){const{id:P,extractedUrl:B,source:G,restoredState:Y,extras:J}=E,le=new VM(P,this.urlSerializer.serialize(B),G,Y);this.events.next(le);const ge=N6(this.rootComponentType).snapshot;return this.currentTransition=u={...E,targetSnapshot:ge,urlAfterRedirects:B,extras:{...J,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=B,pt(u)}{const P="";return this.events.next(new Nb(E.id,this.urlSerializer.serialize(E.extractedUrl),P,BM.IgnoredByUrlHandlingStrategy)),E.resolve(null),Zc}}),io(E=>{const C=new Eq(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(C)}),Yt(E=>(this.currentTransition=u={...E,guards:Hq(E.targetSnapshot,E.currentSnapshot,this.rootContexts)},u)),function Qq(e,n){return no(t=>{const{targetSnapshot:o,currentSnapshot:c,guards:{canActivateChecks:u,canDeactivateChecks:f}}=t;return 0===f.length&&0===u.length?pt({...t,guardsResult:!0}):function Zq(e,n,t,o){return Ur(e).pipe(no(c=>function oY(e,n,t,o,c){const u=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return u&&0!==u.length?pt(u.map(g=>{const E=kI(n)??c,C=Mb(g,E);return jp(function Xq(e){return e&&UI(e.canDeactivate)}(C)?C.canDeactivate(e,n,t,o):Ro(E,()=>C(e,n,t,o))).pipe(Ag())})).pipe(xb()):pt(!0)}(c.component,c.route,t,n,o)),Ag(c=>!0!==c,!0))}(f,o,c,e).pipe(no(g=>g&&function Kq(e){return"boolean"==typeof e}(g)?function eY(e,n,t,o){return Ur(n).pipe(wI(c=>hI(function nY(e,n){return null!==e&&n&&n(new Tq(e)),pt(!0)}(c.route.parent,o),function tY(e,n){return null!==e&&n&&n(new wq(e)),pt(!0)}(c.route,o),function rY(e,n,t){const o=n[n.length-1],u=n.slice(0,n.length-1).reverse().map(f=>function Gq(e){const n=e.routeConfig?e.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:e,guards:n}:null}(f)).filter(f=>null!==f).map(f=>r6(()=>pt(f.guards.map(E=>{const C=kI(f.node)??t,R=Mb(E,C);return jp(function $q(e){return e&&UI(e.canActivateChild)}(R)?R.canActivateChild(o,e):Ro(C,()=>R(o,e))).pipe(Ag())})).pipe(xb())));return pt(u).pipe(xb())}(e,c.path,t),function iY(e,n,t){const o=n.routeConfig?n.routeConfig.canActivate:null;if(!o||0===o.length)return pt(!0);const c=o.map(u=>r6(()=>{const f=kI(n)??t,g=Mb(u,f);return jp(function Yq(e){return e&&UI(e.canActivate)}(g)?g.canActivate(n,e):Ro(f,()=>g(n,e))).pipe(Ag())}));return pt(c).pipe(xb())}(e,c.route,t))),Ag(c=>!0!==c,!0))}(o,u,e,n):pt(g)),Yt(g=>({...t,guardsResult:g})))})}(this.environmentInjector,E=>this.events.next(E)),io(E=>{if(u.guardsResult=E.guardsResult,Db(E.guardsResult))throw F6(0,E.guardsResult);const C=new vq(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot,!!E.guardsResult);this.events.next(C)}),Ea(E=>!!E.guardsResult||(this.cancelNavigationTransition(E,"",rc.GuardRejected),!1)),BV(E=>{if(E.guards.canActivateChecks.length)return pt(E).pipe(io(C=>{const R=new bq(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(C.urlAfterRedirects),C.targetSnapshot);this.events.next(R)}),td(C=>{let R=!1;return pt(C).pipe(function AY(e,n){return no(t=>{const{targetSnapshot:o,guards:{canActivateChecks:c}}=t;if(!c.length)return pt(t);const u=new Set(c.map(E=>E.route)),f=new Set;for(const E of u)if(!f.has(E))for(const C of K6(E))f.add(C);let g=0;return Ur(f).pipe(wI(E=>u.has(E)?function DY(e,n,t,o){const c=e.routeConfig,u=e._resolve;return void 0!==c?.title&&!x6(c)&&(u[RI]=c.title),function OY(e,n,t,o){const c=vV(e);if(0===c.length)return pt({});const u={};return Ur(c).pipe(no(f=>function NY(e,n,t,o){const c=kI(n)??o,u=Mb(e,c);return jp(u.resolve?u.resolve(n,t):Ro(c,()=>u(n,t)))}(e[f],n,t,o).pipe(Ag(),io(g=>{u[f]=g}))),_V(1),a6(u),Ib(f=>H6(f)?Zc:NM(f)))}(u,e,n,o).pipe(Yt(f=>(e._resolvedData=f,e.data=DV(e,e.parent,t).resolve,null)))}(E,o,e,n):(E.data=DV(E,E.parent,e).resolve,pt(void 0))),io(()=>g++),_V(1),no(E=>g===f.size?pt(t):Zc))})}(this.paramsInheritanceStrategy,this.environmentInjector),io({next:()=>R=!0,complete:()=>{R||this.cancelNavigationTransition(C,"",rc.NoDataFromResolver)}}))}),io(C=>{const R=new yq(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(C.urlAfterRedirects),C.targetSnapshot);this.events.next(R)}))}),BV(E=>{const C=R=>{const P=[];R.routeConfig?.loadComponent&&!R.routeConfig._loadedComponent&&P.push(this.configLoader.loadComponent(R.routeConfig).pipe(io(B=>{R.component=B}),Yt(()=>{})));for(const B of R.children)P.push(...C(B));return P};return sM(C(E.targetSnapshot.root)).pipe(PM(null),Vr(1))}),BV(()=>this.afterPreactivation()),td(()=>{const{currentSnapshot:E,targetSnapshot:C}=u,R=this.createViewTransition?.(this.environmentInjector,E.root,C.root);return R?Ur(R).pipe(Yt(()=>u)):pt(u)}),Yt(E=>{const C=function Nq(e,n,t){const o=xI(e,n._root,t?t._root:void 0);return new O6(o,n)}(t.routeReuseStrategy,E.targetSnapshot,E.currentRouterState);return this.currentTransition=u={...E,targetRouterState:C},this.currentNavigation.targetRouterState=C,u}),io(()=>{this.events.next(new IV)}),((e,n,t,o)=>Yt(c=>(new jq(n,c.targetRouterState,c.currentRouterState,t,o).activate(e),c)))(this.rootContexts,t.routeReuseStrategy,E=>this.events.next(E),this.inputBindingEnabled),Vr(1),io({next:E=>{f=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Uu(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects))),this.titleStrategy?.updateTitle(E.targetRouterState.snapshot),E.resolve(!0)},complete:()=>{f=!0}}),zo(this.transitionAbortSubject.pipe(io(E=>{throw E}))),EV(()=>{!f&&!g&&this.cancelNavigationTransition(u,"",rc.SupersededByNewNavigation),this.currentNavigation?.id===u.id&&(this.currentNavigation=null)}),Ib(E=>{if(g=!0,V6(E))this.events.next(new Ob(u.id,this.urlSerializer.serialize(u.extractedUrl),E.message,E.cancellationCode)),function xq(e){return V6(e)&&Db(e.url)}(E)?this.events.next(new wV(E.url)):u.resolve(!1);else{this.events.next(new jM(u.id,this.urlSerializer.serialize(u.extractedUrl),E,u.targetSnapshot??void 0));try{u.resolve(t.errorHandler(E))}catch(C){this.options.resolveNavigationPromiseOnError?u.resolve(!1):u.reject(C)}}return Zc}))}))}cancelNavigationTransition(t,o,c){const u=new Ob(t.id,this.urlSerializer.serialize(t.extractedUrl),o,c);this.events.next(u),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function UY(e){return e!==PI}let VY=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:()=>Te(jY),providedIn:"root"})}return e})();class BY{shouldDetach(n){return!1}store(n,t){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,t){return n.routeConfig===t.routeConfig}}let jY=(()=>{class e extends BY{static#e=this.\u0275fac=(()=>{let t;return function(c){return(t||(t=Yi(e)))(c||e)}})();static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),J6=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:()=>Te(HY),providedIn:"root"})}return e})(),HY=(()=>{class e extends J6{constructor(){super(...arguments),this.location=Te(Hi),this.urlSerializer=Te(Ab),this.options=Te(Lb,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=Te(HV),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Rb,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=N6(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(o=>{"popstate"===o.type&&t(o.url,o.state)})}handleRouterEvent(t,o){if(t instanceof VM)this.stateMemento=this.createStateMemento();else if(t instanceof Nb)this.rawUrlTree=o.initialUrl;else if(t instanceof R6){if("eager"===this.urlUpdateStrategy&&!o.extras.skipLocationChange){const c=this.urlHandlingStrategy.merge(o.finalUrl,o.initialUrl);this.setBrowserUrl(c,o)}}else t instanceof IV?(this.currentUrlTree=o.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(o.finalUrl,o.initialUrl),this.routerState=o.targetRouterState,"deferred"===this.urlUpdateStrategy&&(o.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,o))):t instanceof Ob&&(t.code===rc.GuardRejected||t.code===rc.NoDataFromResolver)?this.restoreHistory(o):t instanceof jM?this.restoreHistory(o,!0):t instanceof Uu&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,o){const c=this.urlSerializer.serialize(t);if(this.location.isCurrentPathEqualTo(c)||o.extras.replaceUrl){const f={...o.extras.state,...this.generateNgRouterState(o.id,this.browserPageId)};this.location.replaceState(c,"",f)}else{const u={...o.extras.state,...this.generateNgRouterState(o.id,this.browserPageId+1)};this.location.go(c,"",u)}}restoreHistory(t,o=!1){if("computed"===this.canceledNavigationResolution){const u=this.currentPageId-this.browserPageId;0!==u?this.location.historyGo(u):this.currentUrlTree===t.finalUrl&&0===u&&(this.resetState(t),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(o&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,o){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:o}:{navigationId:t}}static#e=this.\u0275fac=(()=>{let t;return function(c){return(t||(t=Yi(e)))(c||e)}})();static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var VI=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(VI||{});function Q6(e,n){e.events.pipe(Ea(t=>t instanceof Uu||t instanceof Ob||t instanceof jM||t instanceof Nb),Yt(t=>t instanceof Uu||t instanceof Nb?VI.COMPLETE:t instanceof Ob&&(t.code===rc.Redirect||t.code===rc.SupersededByNewNavigation)?VI.REDIRECTING:VI.FAILED),Ea(t=>t!==VI.REDIRECTING),Vr(1)).subscribe(()=>{n()})}function GY(e){throw e}const WY={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},zY={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ya=(()=>{class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=Te(a0),this.stateManager=Te(J6),this.options=Te(Lb,{optional:!0})||{},this.pendingTasks=Te(Ym),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=Te(KM),this.urlSerializer=Te(Ab),this.location=Te(Hi),this.urlHandlingStrategy=Te(HV),this._events=new en,this.errorHandler=this.options.errorHandler||GY,this.navigated=!1,this.routeReuseStrategy=Te(VY),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=Te(Fb,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!Te(HM,{optional:!0}),this.eventsSubscription=new Ki,this.isNgZoneEnabled=Te(it)instanceof it&&it.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const t=this.navigationTransitions.events.subscribe(o=>{try{const c=this.navigationTransitions.currentTransition,u=this.navigationTransitions.currentNavigation;if(null!==c&&null!==u)if(this.stateManager.handleRouterEvent(o,u),o instanceof Ob&&o.code!==rc.Redirect&&o.code!==rc.SupersededByNewNavigation)this.navigated=!0;else if(o instanceof Uu)this.navigated=!0;else if(o instanceof wV){const f=this.urlHandlingStrategy.merge(o.url,c.currentRawUrl),g={info:c.extras.info,skipLocationChange:c.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||UY(c.source)};this.scheduleNavigation(f,PI,null,g,{resolve:c.resolve,reject:c.reject,promise:c.promise})}(function qY(e){return!(e instanceof IV||e instanceof wV)})(o)&&this._events.next(o)}catch(c){this.navigationTransitions.transitionAbortSubject.next(c)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),PI,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,o)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(t,"popstate",o)},0)})}navigateToSyncWithBrowser(t,o,c){const u={replaceUrl:!0},f=c?.navigationId?c:null;if(c){const E={...c};delete E.navigationId,delete E.\u0275routerPageId,0!==Object.keys(E).length&&(u.state=E)}const g=this.parseUrl(t);this.scheduleNavigation(g,o,f,u)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(kV),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,o={}){const{relativeTo:c,queryParams:u,fragment:f,queryParamsHandling:g,preserveFragment:E}=o,C=E?this.currentUrlTree.fragment:f;let P,R=null;switch(g){case"merge":R={...this.currentUrlTree.queryParams,...u};break;case"preserve":R=this.currentUrlTree.queryParams;break;default:R=u||null}null!==R&&(R=this.removeEmptyProps(R));try{P=b6(c?c.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||!t[0].startsWith("/"))&&(t=[]),P=this.currentUrlTree.root}return y6(P,t,R,C??null)}navigateByUrl(t,o={skipLocationChange:!1}){const c=Db(t)?t:this.parseUrl(t),u=this.urlHandlingStrategy.merge(c,this.rawUrlTree);return this.scheduleNavigation(u,PI,null,o)}navigate(t,o={skipLocationChange:!1}){return function KY(e){for(let n=0;n<e.length;n++)if(null==e[n])throw new he(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,o),o)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,o){let c;if(c=!0===o?{...WY}:!1===o?{...zY}:o,Db(t))return u6(this.currentUrlTree,t,c);const u=this.parseUrl(t);return u6(this.currentUrlTree,u,c)}removeEmptyProps(t){return Object.entries(t).reduce((o,[c,u])=>(null!=u&&(o[c]=u),o),{})}scheduleNavigation(t,o,c,u,f){if(this.disposed)return Promise.resolve(!1);let g,E,C;f?(g=f.resolve,E=f.reject,C=f.promise):C=new Promise((P,B)=>{g=P,E=B});const R=this.pendingTasks.add();return Q6(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(R))}),this.navigationTransitions.handleNavigationRequest({source:o,restoredState:c,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:u,resolve:g,reject:E,promise:C,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),C.catch(P=>Promise.reject(P))}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class Z6{}let XY=(()=>{class e{constructor(t,o,c,u,f){this.router=t,this.injector=c,this.preloadingStrategy=u,this.loader=f}setUpPreloading(){this.subscription=this.router.events.pipe(Ea(t=>t instanceof Uu),wI(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,o){const c=[];for(const u of o){u.providers&&!u._injector&&(u._injector=Um(u.providers,t,`Route: ${u.path}`));const f=u._injector??t,g=u._loadedInjector??f;(u.loadChildren&&!u._loadedRoutes&&void 0===u.canLoad||u.loadComponent&&!u._loadedComponent)&&c.push(this.preloadConfig(f,u)),(u.children||u._loadedRoutes)&&c.push(this.processRoutes(g,u.children??u._loadedRoutes))}return Ur(c).pipe(yb())}preloadConfig(t,o){return this.preloadingStrategy.preload(o,()=>{let c;c=o.loadChildren&&void 0===o.canLoad?this.loader.loadChildren(t,o):pt(null);const u=c.pipe(no(f=>null===f?pt(void 0):(o._loadedRoutes=f.routes,o._loadedInjector=f.injector,this.processRoutes(f.injector??t,f.routes))));return o.loadComponent&&!o._loadedComponent?Ur([u,this.loader.loadComponent(o)]).pipe(yb()):u})}static#e=this.\u0275fac=function(o){return new(o||e)(be(ya),be(kv),be(ns),be(Z6),be(jV))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const WV=new De("");let eH=(()=>{class e{constructor(t,o,c,u,f={}){this.urlSerializer=t,this.transitions=o,this.viewportScroller=c,this.zone=u,this.options=f,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},f.scrollPositionRestoration||="disabled",f.anchorScrolling||="disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof VM?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Uu?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof Nb&&t.code===BM.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof A6&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,o){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new A6(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,o))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(o){Mh()};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac})}return e})();function ul(e,n){return{\u0275kind:e,\u0275providers:n}}function nH(){const e=Te(pr);return n=>{const t=e.get(Yr);if(n!==t.components[0])return;const o=e.get(ya),c=e.get(iH);1===e.get(zV)&&o.initialNavigation(),e.get(rH,null,Vt.Optional)?.setUpPreloading(),e.get(WV,null,Vt.Optional)?.init(),o.resetRootComponentType(t.componentTypes[0]),c.closed||(c.next(),c.complete(),c.unsubscribe())}}const iH=new De("",{factory:()=>new en}),zV=new De("",{providedIn:"root",factory:()=>1}),rH=new De("");function e$(e){return ul(0,[{provide:rH,useExisting:XY},{provide:Z6,useExisting:e}])}function n$(e){return ul(9,[{provide:$6,useValue:LY},{provide:X6,useValue:{skipNextTransition:!!e?.skipInitialTransition,...e}}])}const oH=new De("ROUTER_FORROOT_GUARD"),i$=[Hi,{provide:Ab,useClass:bV},ya,MI,{provide:Og,useFactory:function tH(e){return e.routerState.root},deps:[ya]},jV,[]];let r$=(()=>{class e{constructor(t){}static forRoot(t,o){return{ngModule:e,providers:[i$,[],{provide:Fb,multi:!0,useValue:t},{provide:oH,useFactory:c$,deps:[[ya,new Ll,new lh]]},{provide:Lb,useValue:o||{}},o?.useHash?{provide:ga,useClass:dP}:{provide:ga,useClass:Zv},{provide:WV,useFactory:()=>{const e=Te(UF),n=Te(it),t=Te(Lb),o=Te(KM),c=Te(Ab);return t.scrollOffset&&e.setOffset(t.scrollOffset),new eH(c,o,e,n,t)}},o?.preloadingStrategy?e$(o.preloadingStrategy).\u0275providers:[],o?.initialNavigation?d$(o):[],o?.bindToComponentInputs?ul(8,[k6,{provide:HM,useExisting:k6}]).\u0275providers:[],o?.enableViewTransitions?n$().\u0275providers:[],[{provide:sH,useFactory:nH},{provide:Gs,multi:!0,useExisting:sH}]]}}static forChild(t){return{ngModule:e,providers:[{provide:Fb,multi:!0,useValue:t}]}}static#e=this.\u0275fac=function(o){return new(o||e)(be(oH,8))};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({})}return e})();function c$(e){return"guarded"}function d$(e){return["disabled"===e.initialNavigation?ul(3,[{provide:p0,multi:!0,useFactory:()=>{const n=Te(ya);return()=>{n.setUpLocationChangeListener()}}},{provide:zV,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?ul(2,[{provide:zV,useValue:0},{provide:p0,multi:!0,deps:[pr],useFactory:n=>{const t=n.get(cP,Promise.resolve());return()=>t.then(()=>new Promise(o=>{const c=n.get(ya),u=n.get(iH);Q6(c,()=>{o(!0)}),n.get(KM).afterPreactivation=()=>(o(!0),u.closed?pt(void 0):u),c.initialNavigation()}))}}]).\u0275providers:[]]}const sH=new De(""),aH_configs={AppID:"fee9eb8f5bb44a6893ec96fd5e993a31"};let u$=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Br({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(o,c){1&o&&ce(0,"router-outlet")},dependencies:[xV],changeDetection:0})}return e})();function KV(e=0,n=fI){return e<0&&(e=0),_M(e,e,n)}function cH(e,n){return n?t=>hI(n.pipe(Vr(1),function h$(){return fi((e,n)=>{e.subscribe(Jn(n,Gu))})}()),t.pipe(cH(e))):no((t,o)=>Wo(e(t,o)).pipe(Vr(1),a6(t)))}var f$=xg(291);function m$(e,n){if(1&e){const t=ap();oe(0,"div",1)(1,"button",2),gn("click",function(){return Aa(t),Zs(_n().onToggleFullScreen())}),oe(2,"div",3),Zo(),oe(3,"svg",4)(4,"g",26)(5,"g",6)(6,"g",7)(7,"g",11),ce(8,"path",27)(9,"path",28)(10,"path",29)(11,"path",30),Ee()()()(),oe(12,"g",31)(13,"g",6)(14,"g",32)(15,"g",7),ce(16,"path",33)(17,"path",34)(18,"path",35)(19,"path",36),Ee()()()()()(),_c(),oe(20,"p"),br(21),Ee()()()}if(2&e){const t=_n();Qe(),Ht("controls__button--active",t.fullScreenEnabled),Qe(3),Ht("controls__icon--shown",!t.fullScreenEnabled),Qe(8),Ht("controls__icon--shown",t.fullScreenEnabled),Qe(9),cu(t.fullScreenEnabled?"Exit fullscreen":"Fullscreen")}}function g$(e,n){if(1&e){const t=ap();oe(0,"div",1)(1,"button",37),gn("click",function(){return Aa(t),Zs(_n().onToggleSmallScreen())}),oe(2,"div",3),Zo(),oe(3,"svg",4)(4,"g",38),ce(5,"path",39),Ee(),oe(6,"defs")(7,"filter",40),ce(8,"feFlood",41)(9,"feColorMatrix",42)(10,"feOffset",43)(11,"feGaussianBlur",44)(12,"feComposite",45)(13,"feColorMatrix",46)(14,"feBlend",47)(15,"feBlend",48),Ee()()()(),_c(),oe(16,"p"),br(17,"Minimize"),Ee()()()}if(2&e){const t=_n();Qe(),Ht("controls__button--active",t.smallScreenEnabled)}}function _$(e,n){if(1&e&&(oe(0,"div",8),br(1),Ee()),2&e){const t=_n();Qe(),cu(t.text)}}const E$=(e,n,t,o)=>({"spinner--connected":e,"spinner--ended":n,"spinner--small":t,"spinner--error":o});function v$(e,n){if(1&e&&(vi(0),br(1),Me()),2&e){const t=_n(2);Qe(),xo(" Calling to ",t.data.user.name," ")}}function b$(e,n){1&e&&br(0),2&e&&xo(" ",_n(2).data.user.name," is calling ")}function y$(e,n){if(1&e){const t=ap();vi(0),oe(1,"button",11),gn("click",function(){return Aa(t),Zs(_n(2).onAcceptCall())}),Ee(),Me()}}function C$(e,n){if(1&e){const t=ap();oe(0,"div",1)(1,"div",2)(2,"div",3),ce(3,"img",4),Ee(),oe(4,"p",5),Tn(5,v$,2,1,"ng-container",6)(6,b$,1,1,"ng-template",null,7,Ov),Ee()(),oe(8,"div",8),Tn(9,y$,2,0,"ng-container",9),oe(10,"span")(11,"button",10),gn("click",function(){return Aa(t),Zs(_n().onDeclineCall())}),Ee()()()()}if(2&e){const t=Mm(7),o=_n();Ht("video-call--full-screen",o.fullScreen),Ze("@fade",void 0),Qe(3),Ze("src",o.data.user.photoURL,LC),Qe(2),Ze("ngIf",o.data.outcome)("ngIfElse",t),Qe(4),Ze("ngIf",!o.data.outcome)}}function S$(e,n){if(1&e&&ce(0,"ngx-spinner",15),2&e){const t=_n().ngIf,o=_n(2);Ze("error",t.error)("text",t.statusText)("connected",t.connected)("ended",t.ended)("small",o.smallScreenEnabled)}}function T$(e,n){1&e&&ce(0,"ngx-timer",16),2&e&&Ze("started",_n().ngIf.started)}function I$(e,n){if(1&e&&(ce(0,"div",17),fu(1,"async")),2&e){const t=n.$implicit;Ht("hidden",!1===mu(1,3,_n(3).remoteStreamVideoToggle$)),Ze("id",t)}}function w$(e,n){if(1&e){const t=ap();Zo(),_c(),oe(0,"ngx-controls",18),gn("toggleCamera",function(c){return Aa(t),Zs(_n(3).onToggleCamera(c))})("toggleMicrophone",function(c){return Aa(t),Zs(_n(3).onToggleMicrophone(c))})("toggleFullScreen",function(c){return Aa(t),Zs(_n(3).onToggleFullScreen(c))})("toggleSmallScreen",function(c){return Aa(t),Zs(_n(3).onToggleSmallScreen(c))})("endCall",function(){return Aa(t),Zs(_n(3).onEndCall())}),Ee()}if(2&e){const t=_n(3);Ze("cameraEnabled",t.cameraEnabled)("microphoneEnabled",t.microphoneEnabled)("fullScreenEnabled",t.fullScreenEnabled)("smallScreenEnabled",t.smallScreenEnabled)("displaySmallScreen",t.displaySmallScreen)}}function R$(e,n){if(1&e&&(oe(0,"div",2),Tn(1,S$,1,5,"ngx-spinner",3)(2,T$,1,1,"ngx-timer",4),ce(3,"div",5),Tn(4,I$,2,5,"div",6),oe(5,"div",7),Zo(),oe(6,"svg",8)(7,"g",9),ce(8,"path",10)(9,"path",11),Ee(),oe(10,"defs")(11,"clipPath",12),ce(12,"rect",13),Ee()()()(),Tn(13,w$,1,5,"ngx-controls",14),Ee()),2&e){const t=n.ngIf,o=_n(2);Qe(),Ze("ngIf",t.loading),Qe(),Ze("ngIf",t.started),Qe(),Ht("hidden",!o.cameraEnabled||o.smallScreenEnabled),Ze("id",o.localContainerId),Qe(),Ze("ngForOf",o.remoteCalls),Qe(9),Ze("ngIf",t.connected&&!t.ended)}}function A$(e,n){if(1&e&&(oe(0,"div"),Tn(1,R$,14,7,"div",1),fu(2,"async"),Ee()),2&e){const t=_n();Ze("@fade",void 0)("@.disabled",!t.animate),Qe(),Ze("ngIf",mu(2,3,t.streamState$))}}const qM_HIDDEN={opacity:0,"margin-top":"100%"},qM_SHOWN={opacity:1,"margin-top":0},dH=kU("fade",[EI(":enter",[sl(qM_HIDDEN),_I("250ms ease-in-out",sl(qM_SHOWN))]),EI(":leave",[sl(qM_SHOWN),_I("250ms ease-in-out",sl(qM_HIDDEN))])]);class lH{constructor(n){this.cdr=n,this.afterClosed=new en,this.shown=!0}closeDialog(n){this.onAfterClosed(n)}onAfterClosed(n){this.shown=!1,this.cdr.markForCheck(),this.afterClosed.next(n)}}let D$=(()=>{class e{constructor(){this.cameraEnabled=!0,this.microphoneEnabled=!0,this.fullScreenEnabled=!1,this.smallScreenEnabled=!1,this.displaySmallScreen=!1,this.toggleCamera=new pn,this.toggleMicrophone=new pn,this.toggleFullScreen=new pn,this.toggleSmallScreen=new pn,this.endCall=new pn}onToggleCamera(){this.toggleCamera.emit(this.cameraEnabled)}onToggleMicrophone(){this.toggleMicrophone.emit(this.microphoneEnabled)}onToggleFullScreen(){this.toggleFullScreen.emit(this.fullScreenEnabled)}onToggleSmallScreen(){this.toggleSmallScreen.emit(this.smallScreenEnabled)}onEndCall(){this.endCall.emit()}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Br({type:e,selectors:[["ngx-controls"]],inputs:{cameraEnabled:"cameraEnabled",microphoneEnabled:"microphoneEnabled",fullScreenEnabled:"fullScreenEnabled",smallScreenEnabled:"smallScreenEnabled",displaySmallScreen:"displaySmallScreen"},outputs:{toggleCamera:"toggleCamera",toggleMicrophone:"toggleMicrophone",toggleFullScreen:"toggleFullScreen",toggleSmallScreen:"toggleSmallScreen",endCall:"endCall"},decls:43,vars:16,consts:[[1,"controls"],[1,"controls__item"],[1,"controls__button",3,"click"],[1,"controls__icon-wrapper"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","video-camera",1,"controls__icon"],["id","Group"],["id","Group_2"],["id","Vector","d","M63.4134 16.2294C63.0454 15.9814 62.5787 15.928 62.1707 16.096L50.6668 20.6986V20C50.6668 16.3226 47.6748 13.3334 44.0001 13.3334H6.66663C2.992 13.3334 0 16.3226 0 20V44C0 47.6774 2.992 50.6666 6.66663 50.6666H44C47.6746 50.6666 50.6666 47.6772 50.6666 44V43.3014L62.1706 47.904C62.5812 48.072 63.048 48.0186 63.4132 47.7706C63.7786 47.5226 63.9999 47.1093 63.9999 46.6666V17.3334C64 16.8906 63.7786 16.4774 63.4134 16.2294Z","fill","white"],["id","no-camera",1,"controls__icon"],["id","Vector","d","M44.0002 13.3325H6.66735C2.99276 13.3325 0.000793457 16.3218 0.000793457 19.999V43.9988C0.000793457 47.6761 2.99276 50.6654 6.66735 50.6654H7.67797L44.9176 13.4257C44.6162 13.3832 44.315 13.3325 44.0002 13.3325Z","fill","white"],["id","Group_3"],["id","Group_4"],["id","Vector_2","d","M63.4134 16.2285C63.0454 15.9805 62.5788 15.9271 62.1708 16.0951L50.6669 20.6977V19.9991C50.6669 18.6417 50.2535 17.3831 49.5549 16.3297L63.608 2.2766C64.128 1.75661 64.128 0.911242 63.608 0.391247C63.088 -0.128748 62.2426 -0.128748 61.7226 0.391247L0.389996 61.724C-0.129999 62.244 -0.129999 63.0894 0.389996 63.6094C0.651369 63.868 0.992615 63.9988 1.33399 63.9988C1.67536 63.9988 2.01661 63.8681 2.27798 63.6094L15.2192 50.6655H44.0003C47.6749 50.6655 50.6669 47.6762 50.6669 43.9989V43.3003L62.1708 47.9029C62.5814 48.0709 63.0481 48.0175 63.4134 47.7695C63.7788 47.5215 64 47.1082 64 46.6655V17.3325C64 16.8898 63.7788 16.4765 63.4134 16.2285Z","fill","white"],["id","microphone",1,"controls__icon"],["id","Vector"],["fill-rule","evenodd","clip-rule","evenodd","d","M44.3474 12.1407L44.3468 17.2309V33.8672C44.3468 40.6024 38.9004 46.0823 32.206 46.0823C27.8366 46.0787 23.8059 43.7286 21.6503 39.9279L20.4131 36.8161C20.1824 35.875 20.0659 34.9098 20.0659 33.941V12.1407C20.0659 5.43551 25.5014 0 32.2066 0C38.9118 0 44.3474 5.43551 44.3474 12.1407Z","fill","white"],["fill-rule","evenodd","clip-rule","evenodd","d","M15.0971 33.7512C15.0947 36.1345 15.5932 38.4912 16.5596 40.6697L18.1223 43.4553C22.3699 49.6259 30.1387 52.3143 37.292 50.089C44.4453 47.8638 49.318 41.2426 49.3156 33.7518C49.3156 32.9026 50.0039 32.2143 50.8532 32.2143C51.7018 32.2143 52.3907 32.9026 52.3907 33.7518C52.4051 44.4499 44.0585 53.2951 33.3778 53.9017V60.9246H39.8098C40.6584 60.9246 41.3473 61.6135 41.3473 62.4622C41.3473 63.3114 40.6584 63.9997 39.8098 63.9997H24.6029C23.7537 63.9997 23.0654 63.3114 23.0654 62.4622C23.0654 61.6135 23.7537 60.9246 24.6029 60.9246H30.3033V53.847C25.6228 53.4212 21.2413 51.3623 17.926 48.0313C17.1926 47.298 16.5163 46.51 15.9031 45.6739L14.2418 42.9874C12.7757 40.1297 12.0148 36.9633 12.022 33.7512C12.022 32.902 12.7103 32.2137 13.5595 32.2137C14.4088 32.2137 15.0971 32.902 15.0971 33.7512Z","fill","white"],["id","no-microphone",1,"controls__icon"],["id","Vector","d","M52.9733 4.25592L44.3474 12.8813V12.1407C44.3474 5.43551 38.9118 0 32.2066 0C25.5014 0 20.0659 5.43551 20.0659 12.1407V33.941C20.0659 34.9098 20.1824 35.875 20.4131 36.8161L16.5596 40.6697C15.5932 38.4912 15.0947 36.1345 15.0971 33.7512C15.0971 32.902 14.4088 32.2137 13.5595 32.2137C12.7103 32.2137 12.022 32.902 12.022 33.7512C12.0148 36.9633 12.7757 40.1297 14.2418 42.9874L8.81411 48.4151C8.4117 48.8007 8.24954 49.3731 8.39008 49.9124C8.53002 50.4518 8.95105 50.8728 9.4898 51.0133C10.0291 51.1539 10.6021 50.9917 10.9877 50.5899L15.9031 45.6739C16.5163 46.51 17.1926 47.298 17.926 48.0313C21.2413 51.3623 25.6228 53.4212 30.3033 53.847V60.9246H24.6029C23.7537 60.9246 23.0654 61.6135 23.0654 62.4622C23.0654 63.3114 23.7537 63.9997 24.6029 63.9997H39.8098C40.6584 63.9997 41.3473 63.3114 41.3473 62.4622C41.3473 61.6135 40.6584 60.9246 39.8098 60.9246H33.3778V53.9017C44.0585 53.2951 52.4051 44.4499 52.3907 33.7518C52.3907 32.9026 51.7018 32.2143 50.8532 32.2143C50.0039 32.2143 49.3156 32.9026 49.3156 33.7518C49.318 41.2426 44.4453 47.8638 37.292 50.089C30.1387 52.3143 22.3699 49.6259 18.1224 43.4553L21.6503 39.9279C23.8059 43.7286 27.8366 46.0787 32.206 46.0823C38.9004 46.0823 44.3468 40.6024 44.3468 33.8672V17.2309L55.1475 6.43072C55.7481 5.83071 55.7481 4.85713 55.1475 4.25652C54.5469 3.65591 53.5733 3.65591 52.9733 4.25652V4.25592Z","fill","white"],["class","controls__item",4,"ngIf"],[1,"controls__button","controls__button--danger",3,"click"],["id","phone"],["id","Vector","d","M51.7097 13.2478C51.2458 12.7839 50.4959 12.7839 50.032 13.2478L1.38351 61.8963C0.919568 62.3602 0.919568 63.1101 1.38351 63.574C1.61488 63.8054 1.91864 63.9217 2.2224 63.9217C2.52615 63.9217 2.82991 63.8054 3.06129 63.574L51.7097 14.9256C52.1737 14.4628 52.1737 13.7117 51.7097 13.2478Z","fill","white"],["id","Vector_2","d","M16.9605 42.9635L26.1159 33.8081L21.3365 29.0287C18.91 26.6022 18.6869 24.3679 20.5878 21.5629C20.8535 21.1951 22.5444 19.6941 23.992 18.4839C24.9151 17.9333 25.5487 17.1181 25.8264 16.1155C26.1954 14.783 25.9225 13.2156 25.0516 11.6885C24.8463 11.3373 19.9625 3.06229 15.4583 0.680892C14.6171 0.235937 13.6714 0.0010004 12.721 0.0010004C11.1571 0.0010004 9.68576 0.610886 8.58109 1.71556L5.57082 4.72702C-3.21082 13.5098 -1.58525 24.419 10.2719 36.2749L16.9605 42.9635Z","fill","white"],["id","Vector_3","d","M63.313 48.5357C60.9304 44.0328 52.6566 39.1478 52.2923 38.9342C51.2304 38.329 50.1209 38.0099 49.0839 38.0099C47.5402 38.0099 46.2753 38.717 45.51 40.0033C44.2986 41.452 42.7964 43.1429 42.4345 43.4051C39.6129 45.3154 37.4071 45.1007 34.9652 42.6588L31.148 38.8416L21.9926 47.997L27.7189 53.7233C34.5356 60.5412 41.0367 63.9976 47.0371 63.9976C47.0383 63.9976 47.0383 63.9976 47.0383 63.9976C51.4534 63.9976 55.5672 62.1217 59.2669 58.4232L62.2771 55.413C64.1068 53.5845 64.5233 50.821 63.313 48.5357Z","fill","white"],["id","fullscreen",1,"controls__icon"],["id","Vector","d","M57.8018 53.4382L44.3964 40.0328L40.0328 44.3964L53.4382 57.8018H43.0205V64H64V43.0205H57.8018V53.4382Z","fill","white"],["id","Vector_2","d","M44.3964 23.9803L57.8018 10.5618V20.9795H64V0H43.0205V6.1982H53.4382L40.0328 19.6036L44.3964 23.9803Z","fill","white"],["id","Vector_3","d","M19.6036 40.0328L6.1982 53.4382V43.0205H0V64H20.9795V57.8018H10.5618L23.9803 44.3964L19.6036 40.0328Z","fill","white"],["id","Vector_4","d","M20.9795 6.1982V0H0V20.9795H6.1982V10.5618L19.6036 23.9803L23.9803 19.6036L10.5618 6.1982H20.9795Z","fill","white"],["id","exit-full-screen",1,"controls__icon"],["id","fullscreen_x5F_exit"],["id","Vector","d","M49.172 54.828L58.344 64L64 58.344L54.828 49.172L64 40H40V64L49.172 54.828Z","fill","white"],["id","Vector_2","d","M0 24H24V0L14.828 9.172L5.75 0.086L0.094 5.742L9.172 14.828L0 24Z","fill","white"],["id","Vector_3","d","M0 58.344L5.656 64L14.828 54.828L24 64V40H0L9.172 49.172L0 58.344Z","fill","white"],["id","Vector_4","d","M40 24H64L54.828 14.828L63.922 5.742L58.266 0.086L49.172 9.172L40 0V24Z","fill","white"],[1,"controls__button","controls__button--rotate",3,"click"],["filter","url(#filter0_d_0_4)"],["d","M-4.81762e-07 34.7678V57.0215C-4.81762e-07 60.8696 3.13284 64 6.98275 64H57.016C60.8672 64 64 60.8696 64 57.0215V7.05508C64 3.20697 60.8672 0.0757321 57.016 0.0757321H34.6959C35.8972 1.3077 36.6961 2.93443 36.871 4.74067H57.0168C58.2942 4.74067 59.3335 5.77899 59.3335 7.05508V57.0216C59.3335 58.2969 58.2942 59.3352 57.0168 59.3352H6.98342C5.7062 59.3352 4.66761 58.2969 4.66761 57.0216V36.9389C2.90982 36.7703 1.27948 36.0149 -4.81762e-07 34.7678ZM10.7807 30.6654H26.0384L1.34093 5.97437C-0.02533 4.60686 -0.02533 2.39174 1.34093 1.02583C2.70813 -0.341677 4.92462 -0.341677 6.29089 1.02423L30.9883 25.7159V10.4614C30.9883 8.52907 32.5556 6.96139 34.4888 6.96139C35.4553 6.96139 36.3305 7.35214 36.9642 7.98612C37.5976 8.62116 37.9897 9.49543 37.9897 10.4613V34.1643C37.9897 36.0966 36.4228 37.6635 34.4896 37.6635H10.7807C8.84705 37.6635 7.28056 36.0974 7.28056 34.1643C7.28056 32.2312 8.84705 30.6654 10.7807 30.6654Z","fill","white"],["id","filter0_d_0_4","x","-4","y","0","width","72","height","72","filterUnits","userSpaceOnUse","color-interpolation-filters","sRGB"],["flood-opacity","0","result","BackgroundImageFix"],["in","SourceAlpha","type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0","result","hardAlpha"],["dy","4"],["stdDeviation","2"],["in2","hardAlpha","operator","out"],["type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"],["mode","normal","in2","BackgroundImageFix","result","effect1_dropShadow_0_4"],["mode","normal","in","SourceGraphic","in2","effect1_dropShadow_0_4","result","shape"]],template:function(o,c){1&o&&(oe(0,"div",0)(1,"div",1)(2,"button",2),gn("click",function(){return c.onToggleCamera()}),oe(3,"div",3),Zo(),oe(4,"svg",4)(5,"g",5)(6,"g",6)(7,"g",7),ce(8,"path",8),Ee()()(),oe(9,"g",9)(10,"g",6)(11,"g",7),ce(12,"path",10),Ee()(),oe(13,"g",11)(14,"g",12),ce(15,"path",13),Ee()()()()(),_c(),oe(16,"p"),br(17,"Camera"),Ee()()(),oe(18,"div",1)(19,"button",2),gn("click",function(){return c.onToggleMicrophone()}),oe(20,"div",3),Zo(),oe(21,"svg",4)(22,"g",14)(23,"g",15),ce(24,"path",16)(25,"path",17),Ee()(),oe(26,"g",18),ce(27,"path",19),Ee()()(),_c(),oe(28,"p"),br(29,"Mic"),Ee()()(),Tn(30,m$,22,7,"div",20)(31,g$,18,2,"div",20),oe(32,"div",1)(33,"button",21),gn("click",function(){return c.onEndCall()}),oe(34,"div",3),Zo(),oe(35,"svg",4)(36,"g",22)(37,"g",6),ce(38,"path",23)(39,"path",24)(40,"path",25),Ee()()()(),_c(),oe(41,"p"),br(42,"End"),Ee()()()()),2&o&&(Ht("controls--small",c.smallScreenEnabled),Qe(2),Ht("controls__button--active",c.cameraEnabled),Qe(3),Ht("controls__icon--shown",c.cameraEnabled),Qe(4),Ht("controls__icon--shown",!c.cameraEnabled),Qe(10),Ht("controls__button--active",c.microphoneEnabled),Qe(3),Ht("controls__icon--shown",c.microphoneEnabled),Qe(4),Ht("controls__icon--shown",!c.microphoneEnabled),Qe(4),Ze("ngIf",!c.smallScreenEnabled),Qe(),Ze("ngIf",c.displaySmallScreen))},dependencies:[Ou],styles:["[_nghost-%COMP%]{transition:.3s}.controls[_ngcontent-%COMP%]{background:#0000004d;bottom:0;display:flex;justify-content:center;padding:15px 0;position:absolute;left:0;width:100%}.controls--small[_ngcontent-%COMP%]{border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding:5px 0}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{height:32px;width:32px}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:16px;width:16px}.controls--small[_ngcontent-%COMP%]   .controls__item[_ngcontent-%COMP%]{margin:0}.controls--small[_ngcontent-%COMP%]   .controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:none}.controls__item[_ngcontent-%COMP%]{margin:0 5px;text-align:center}.controls__button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer}.controls__button[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#101316}.controls__button--active[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#0b73c9}.controls__button--active[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#158ef2}.controls__button--active.controls__button--rotate[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transform:translate(-50%,-50%) rotate(-180deg)}.controls__button--danger[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#d73b3d}.controls__button--danger[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#e06567}.controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;margin:8px 0 0}.controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#313a42;border-radius:50%;box-shadow:0 3px 8px #00000080;margin:auto;position:relative;height:60px;width:60px;transition:.3s}.controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%) rotate(0);height:32px;width:32px;transition:.3s}.controls__icon[_ngcontent-%COMP%]{opacity:0;transition:.3s}.controls__icon--shown[_ngcontent-%COMP%]{opacity:1}"],changeDetection:0})}return e})(),O$=(()=>{class e{constructor(){this.error=!1,this.connected=!0,this.ended=!1,this.small=!1}get color(){return this.ended?"#aaa":this.error?"#d73b3d":this.connected?"#37D425":"#1195E6"}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Br({type:e,selectors:[["ngx-spinner"]],inputs:{text:"text",error:"error",connected:"connected",ended:"ended",small:"small"},decls:8,vars:9,consts:[[1,"spinner",3,"ngClass"],[1,"spinner__wrapper"],[1,"spinner__icon"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 32 32","fill","none"],["d","M5.25 5.5C3.45507 5.5 2 6.95508 2 8.75V19.25C2 21.0449 3.45507 22.5 5.25 22.5H14.75C16.5449 22.5 18 21.0449 18 19.25V8.75C18 6.95507 16.5449 5.5 14.75 5.5H5.25Z"],["d","M23.1232 20.6431L19.5 17.0935V10.9989L23.1121 7.3706C23.8988 6.58044 25.248 7.13753 25.248 8.25251V19.7502C25.248 20.8577 23.9143 21.4181 23.1232 20.6431Z"],[1,"spinner__cirle"],["class","spinner__text",4,"ngIf"],[1,"spinner__text"]],template:function(o,c){1&o&&(oe(0,"div",0)(1,"div",1)(2,"div",2),Zo(),oe(3,"svg",3),ce(4,"path",4)(5,"path",5),Ee()(),_c(),ce(6,"div",6),Tn(7,_$,2,1,"div",7),Ee()()),2&o&&(Ze("ngClass",pu(4,E$,c.connected,c.ended,c.small,c.error)),Qe(4),Ji("fill",c.color),Qe(),Ji("fill",c.color),Qe(2),Ze("ngIf",!c.small))},dependencies:[F0,Ou],styles:[".spinner[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;position:relative;transition:.3s}.spinner--connected[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#37d425}.spinner--ended[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:transparent}.spinner--error[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#d73b3d}.spinner--small[_ngcontent-%COMP%]{border-radius:10px;height:200px}.spinner--small[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-width:4px;height:80px;width:80px}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]{top:26px;transform:translate(-35%)}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.spinner__wrapper[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}.spinner__cirle[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 2s linear infinite;border:5px solid #1195E6;border-radius:50%;border-top-color:transparent;height:160px;margin:auto;width:160px;transition:.3s}.spinner__icon[_ngcontent-%COMP%]{left:50%;position:absolute;top:52px;transform:translate(-40%);transition:.3s}.spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px;transition:.3s}.spinner__text[_ngcontent-%COMP%]{color:#fff;font-size:1.3em;margin-top:25px;text-align:center}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"],changeDetection:0})}return e})(),N$=(()=>{class e{constructor(){this.started=Date.now()}ngOnInit(){this.time$=_M(0,1e3).pipe(Yt(()=>this.format(Date.now()-this.started)))}format(t){const o=Math.floor(t/1e3%60).toString().padStart(2,"0"),c=Math.floor(t/6e4%60).toString().padStart(2,"0");return[Math.floor(t/36e5%24).toString().padStart(2,"0"),c,o].join(":")}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275cmp=Br({type:e,selectors:[["ngx-timer"]],inputs:{started:"started"},decls:4,vars:3,consts:[[1,"timer"]],template:function(o,c){1&o&&(oe(0,"div",0)(1,"span"),br(2),fu(3,"async"),Ee()()),2&o&&(Qe(2),cu(mu(3,1,c.time$)))},dependencies:[hb],styles:[".timer[_ngcontent-%COMP%]{color:#fff;position:relative;text-align:center;z-index:1}.timer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#0000004d;border-radius:5px;padding:5px 10px}"],changeDetection:0})}return e})(),P$=(()=>{class e extends lH{constructor(t){super(t),this.fullScreen=!1}ngOnInit(){this.play(`assets/${this.data.outcome?"outcome":"income"}.mp3`)}ngOnDestroy(){this.stop()}onAcceptCall(){this.fullScreen=!0,this.cdr.markForCheck(),this.afterClosed.next(this.data)}onDeclineCall(){this.play("assets/cancel.mp3"),setTimeout(()=>this.closeDialog(null),200)}play(t,o=!0){this.audio&&this.stop(),this.audio=new Audio(t),this.audio.loop=o,this.audio.load(),this.audio.play()}stop(){this.audio.pause(),this.audio.remove()}static#e=this.\u0275fac=function(o){return new(o||e)(ae(Us))};static#t=this.\u0275cmp=Br({type:e,selectors:[["ngx-video-call"]],inputs:{data:"data"},features:[Nt],decls:1,vars:1,consts:[["class","video-call",3,"video-call--full-screen",4,"ngIf"],[1,"video-call"],[1,"video-call-user"],[1,"video-call-user__block","video-call-user__block--animated"],["alt","",1,"video-call-user__img",3,"src"],[1,"video-call-user__title"],[4,"ngIf","ngIfElse"],["income",""],[1,"video-call__actions"],[4,"ngIf"],["aria-label","Decline",1,"video-call__button","video-call__button--decline",3,"click"],["aria-label","Accept",1,"video-call__button","video-call__button--accept",3,"click"]],template:function(o,c){1&o&&Tn(0,C$,12,7,"div",0),2&o&&Ze("ngIf",c.shown&&c.data)},dependencies:[Ou],styles:['[_nghost-%COMP%]{display:block;height:100vh;position:relative}.video-call[_ngcontent-%COMP%]{background-image:linear-gradient(#3f51b5,#313a42);background-size:cover;border-radius:10px;box-shadow:0 5px 10px #0000001a;display:flex;flex-direction:column;height:100%;justify-content:flex-end;left:50%;max-height:400px;max-width:400px;position:absolute;top:50%;transform:translate(-50%,-50%);width:100%;z-index:5;transition:.3s}.video-call--full-screen[_ngcontent-%COMP%]{background-image:linear-gradient(#22292f);border-radius:0;max-height:100%;max-width:100%}.video-call-user[_ngcontent-%COMP%]{left:50%;position:absolute;text-align:center;top:50%;transform:translate(-50%,-55%);z-index:1}.video-call-user__block[_ngcontent-%COMP%]{background:#fff;border-radius:50%;border:solid 5px #fff;height:180px;margin:0 auto;transform:scale(1);width:180px}.video-call-user__block--animated[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_play 2s ease infinite;backface-visibility:hidden}.video-call-user__img[_ngcontent-%COMP%]{border-radius:50%;height:100%;left:0;object-fit:cover;position:absolute;top:0;width:100%}.video-call-user__title[_ngcontent-%COMP%]{color:#fff;font-size:1.2em;font-weight:700;margin:15px 0 0}.video-call__actions[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:10px 0}.video-call__button[_ngcontent-%COMP%]{border-radius:50%;box-shadow:0 0 #3f51b500,0 .05em .1em #0003;border:0;cursor:pointer;display:block;font-size:40px;height:1em;margin:0 5px;position:relative;transform:translateZ(0) scale(1);width:1em;transition:.3s}.video-call__button[_ngcontent-%COMP%]:before, .video-call__button[_ngcontent-%COMP%]:after{content:"";position:absolute}.video-call__button[_ngcontent-%COMP%]:before{background-color:#ffffff1a;border-radius:50%;height:1em;left:0;opacity:1;top:0;transform:translateZ(0) scale(0);width:1em}.video-call__button[_ngcontent-%COMP%]:after{background-position:50% 50%;background-repeat:no-repeat;background-size:cover;background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTYuNiAxMC44YzEuNCAyLjggMy44IDUuMSA2LjYgNi42bDIuMi0yLjJjLjMtLjMuNy0uNCAxLS4yIDEuMS40IDIuMy42IDMuNi42LjUgMCAxIC40IDEgMVYyMGMwIC41LS41IDEtMSAxLTkuNCAwLTE3LTcuNi0xNy0xNyAwLS42LjQtMSAxLTFoMy41Yy41IDAgMSAuNCAxIDEgMCAxLjIuMiAyLjUuNiAzLjYuMS40IDAgLjctLjIgMWwtMi4zIDIuMnoiIGZpbGw9IiNmZmZmZmYiLz48L3N2Zz4=);height:.5em;left:.25em;top:.25em;transform:translateZ(0);width:.5em;transition:.3s}.video-call__button--accept[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_phone-outer 3s infinite;background-color:#3f51b5}.video-call__button--accept[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_phone-inner 3s infinite}.video-call__button--accept[_ngcontent-%COMP%]:after{animation:_ngcontent-%COMP%_phone-icon 3s infinite}.video-call__button--decline[_ngcontent-%COMP%]{background-color:#d73b3d}.video-call__button--decline[_ngcontent-%COMP%]:hover{background-color:#ce2a2c}.video-call__button--decline[_ngcontent-%COMP%]:after{top:.28em;transform:translateZ(0) rotate(135deg)}@keyframes _ngcontent-%COMP%_play{0%{transform:scale(1)}15%{box-shadow:0 0 0 5px #9b9da466}25%{box-shadow:0 0 0 10px #9b9da466,0 0 0 20px #9b9da433}25%{box-shadow:0 0 0 15px #9b9da466,0 0 0 30px #9b9da433}}@keyframes _ngcontent-%COMP%_phone-outer{0%{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}33.3333%{box-shadow:0 0 #3f51b51a,0 .05em .1em #00000080;transform:translateZ(0) scale(1.1)}66.6666%{box-shadow:0 0 0 .5em #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}to{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}}@keyframes _ngcontent-%COMP%_phone-inner{0%{opacity:1;transform:translateZ(0) scale(0)}33.3333%{opacity:1;transform:translateZ(0) scale(.9)}66.6666%{opacity:0;transform:translateZ(0) scale(0)}to{opacity:0;transform:translateZ(0) scale(0)}}@keyframes _ngcontent-%COMP%_phone-icon{0%{transform:translateZ(0)}2%{transform:translate3d(.01em,0,0)}4%{transform:translate3d(-.01em,0,0)}6%{transform:translate3d(.01em,0,0)}8%{transform:translate3d(-.01em,0,0)}10%{transform:translate3d(.01em,0,0)}12%{transform:translate3d(-.01em,0,0)}14%{transform:translate3d(.01em,0,0)}16%{transform:translate3d(-.01em,0,0)}18%{transform:translate3d(.01em,0,0)}20%{transform:translate3d(-.01em,0,0)}22%{transform:translate3d(.01em,0,0)}24%{transform:translate3d(-.01em,0,0)}26%{transform:translate3d(.01em,0,0)}28%{transform:translate3d(-.01em,0,0)}30%{transform:translate3d(.01em,0,0)}32%{transform:translate3d(-.01em,0,0)}34%{transform:translate3d(.01em,0,0)}36%{transform:translate3d(-.01em,0,0)}38%{transform:translate3d(.01em,0,0)}40%{transform:translate3d(-.01em,0,0)}42%{transform:translate3d(.01em,0,0)}44%{transform:translate3d(-.01em,0,0)}46%{transform:translateZ(0)}}'],data:{animation:[dH]},changeDetection:0})}return e})(),M$=(()=>{class e{constructor(t,o,c,u){this.document=t,this.componentFactoryResolver=o,this.appRef=c,this.injector=u,this.wrapperSelector="ngx-webrtc-wrapper"}open(t,o={}){return this.appendComponent(t,o)}appendComponent(t,o){const c=this.componentFactoryResolver.resolveComponentFactory(t).create(this.injector),{instance:u}=c;Object.keys(o).forEach(g=>u[g]=o[g]),this.appRef.attachView(c.hostView);const f=c.hostView.rootNodes[0];return this.getContainer().append(f),u.afterClosed.pipe(Vr(1),function p$(e,n=fI){const t=_M(e,n);return cH(()=>t)}(250)).subscribe(()=>{this.appRef.detachView(c.hostView),c.destroy()}),u}getContainer(){let t=this.document.querySelector(`.${this.wrapperSelector}`);return t||(t=this.document.createElement("div"),t.setAttribute("class",this.wrapperSelector),t.setAttribute("style","position: fixed; top: 0; width: 100%; z-index: 1;"),this.document.body.appendChild(t)),t}static#e=this.\u0275fac=function(o){return new(o||e)(be(sn),be(Dh),be(Yr),be(pr))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const uH={connected:!1,loading:!0,statusText:"Initializing",started:null,ended:!1,error:!1},x$={mode:"rtc",codec:"h264"};let hH=(()=>{class e{constructor(t){this.config=t,this.agoraRTC=f$,this.streamState=new oo(uH),this.remoteStreamVideoToggle=new oo(!0),this.callEnd=new en,this.localContainerId="local-video",this.remoteCalls=[],this.remoteStreamVideoToggle$=this.remoteStreamVideoToggle.asObservable(),this.streamState$=this.streamState.asObservable(),this.agoraRTC.checkSystemRequirements()||this.handleError(new Error("Web RTC is not supported in this browser"))}init(t,o,c=!1){return this.uid=t,this.agoraRTC.setLogLevel(c?0:4),this.client=this.agoraRTC.createClient(x$),this.assignClientHandlers(),this.initLocalStream().then(()=>{this.client.join(this.config.AppID,o,null,this.uid).then(()=>{this.localTracks.videoTrack.play(this.localContainerId),this.client.publish(Object.values(this.localTracks)),this.streamState.next({...this.streamState.value,connected:!0,statusText:"Waiting others to join"})}).catch(u=>this.handleError(u))}),this.callEnd.asObservable()}deinit(){this.streamState.next(uH)}endCall(){this.client.leave().then(()=>{this.stopLocalStream(),this.streamState.next({...this.streamState.value,started:null,loading:!0,statusText:"",ended:!0}),this.remoteCalls=[],KV(500).pipe(Vr(1)).subscribe(()=>this.callEnd.next())})}toggleVideo(t){this.localTracks&&this.localTracks.videoTrack.setMuted(t)}toggleAudio(t){this.localTracks&&this.localTracks.audioTrack.setMuted(t)}toggleFullScreen(t){t?document.exitFullscreen():document.documentElement.requestFullscreen()}isVideoEnabled(){return!!this.localTracks&&!this.localTracks.videoTrack.muted}isAudioEnabled(){return!!this.localTracks&&!this.localTracks.audioTrack.muted}assignClientHandlers(){this.client.on("user-joined",t=>{this.streamState.next({...this.streamState.value,started:Date.now(),loading:!1}),this.remoteCalls.length||this.remoteCalls.push(this.getRemoteId(t))}),this.client.on("user-published",(t,o)=>{const c=this.getRemoteId(t);this.client.subscribe(t,o).then(u=>{this.remoteCalls.includes(c)&&u.play(c)})}),this.client.on("user-info-updated",(t,o)=>{"mute-video"===o&&this.remoteStreamVideoToggle.next(!1),"unmute-video"===o&&this.remoteStreamVideoToggle.next(!0)}),this.client.on("user-left",()=>{this.endCall()})}initLocalStream(){return Promise.all([this.agoraRTC.createCameraVideoTrack(),this.agoraRTC.createMicrophoneAudioTrack()]).then(([t,o])=>{this.localTracks={audioTrack:o,videoTrack:t}}).catch(t=>{this.handleError(t)})}getRemoteId(t){return`remote_call-${t.uid}`}handleError(t){throw this.streamState.next({...this.streamState.value,statusText:t.message,error:!0}),this.stopLocalStream(),KV(5e3).pipe(Vr(1)).subscribe(()=>this.callEnd.next()),new Error(t.message)}stopLocalStream(){this.localTracks&&Object.values(this.localTracks).forEach(t=>{t.stop(),t.close()})}static#e=this.\u0275fac=function(o){return new(o||e)(be("AgoraConfig"))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),k$=(()=>{class e{onEnter(){this.subscription.unsubscribe(),this.setStyle(1)}onLeave(){this.hide()}constructor(t,o){this.renderer=t,this.el=o,this.subscription=new Ki,this.delay=5e3}ngOnInit(){this.hide()}hide(){this.subscription.unsubscribe(),this.subscription=KV(this.delay).pipe(Vr(1)).subscribe(()=>this.setStyle(0))}setStyle(t){this.renderer.setStyle(this.el.nativeElement,"opacity",t)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(Fs),ae(tn))};static#t=this.\u0275dir=Ye({type:e,selectors:[["","ngxToggle",""]],hostBindings:function(o,c){1&o&&gn("mouseenter",function(){return c.onEnter()})("mouseleave",function(){return c.onLeave()})}})}return e})(),pH=(()=>{class e extends lH{constructor(t,o){super(o),this.webRtcService=t,this.animate=!0,this.displaySmallScreen=!1,this.debug=!1,this.callEnd=new pn,this.smallScreenEnabled=!1,this.active=!1,this.streamState$=this.webRtcService.streamState$,this.remoteStreamVideoToggle$=this.webRtcService.remoteStreamVideoToggle$}ngOnInit(){this.webRtcService.init(this.uid,this.channel,this.debug).pipe(Vr(1)).subscribe(()=>{this.active=this.smallScreenEnabled,this.callEnd.emit(),this.closeDialog(!0)})}ngOnDestroy(){this.webRtcService.deinit()}get localContainerId(){return this.webRtcService.localContainerId}get remoteCalls(){return this.webRtcService.remoteCalls}get cameraEnabled(){return this.webRtcService.isVideoEnabled()}get microphoneEnabled(){return this.webRtcService.isAudioEnabled()}get fullScreenEnabled(){return!!document.fullscreenElement}onToggleCamera(t){this.webRtcService.toggleVideo(t)}onToggleMicrophone(t){this.webRtcService.toggleAudio(t)}onToggleFullScreen(t){this.webRtcService.toggleFullScreen(t)}onToggleSmallScreen(t){this.smallScreenEnabled=!t,this.active=!0}onEndCall(){this.webRtcService.endCall()}static#e=this.\u0275fac=function(o){return new(o||e)(ae(hH),ae(Us))};static#t=this.\u0275cmp=Br({type:e,selectors:[["ngx-webrtc"]],hostVars:4,hostBindings:function(o,c){2&o&&Ht("small-screen",c.smallScreenEnabled)("active",c.active)},inputs:{uid:"uid",channel:"channel",animate:"animate",displaySmallScreen:"displaySmallScreen",debug:"debug"},outputs:{callEnd:"callEnd"},features:[Nt],decls:1,vars:1,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[1,"container"],[3,"error","text","connected","ended","small",4,"ngIf"],[3,"started",4,"ngIf"],[1,"container__local",3,"id"],["class","container__remote",3,"id","hidden",4,"ngFor","ngForOf"],[1,"container__user-icon"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","user","clip-path","url(#clip0)"],["id","Vector","d","M31.5439 30.829C35.7793 30.829 39.4468 29.3099 42.4434 26.3129C45.4399 23.3163 46.959 19.6498 46.959 15.414C46.959 11.1796 45.4399 7.51267 42.4429 4.51512C39.4458 1.51904 35.7788 0 31.5439 0C27.3081 0 23.6416 1.51904 20.645 4.51561C17.6484 7.51218 16.1289 11.1792 16.1289 15.414C16.1289 19.6498 17.6484 23.3168 20.6455 26.3134C23.6426 29.3095 27.3096 30.829 31.5439 30.829V30.829Z","fill","#0B73C9"],["id","Vector_2","d","M58.5161 49.2127C58.4297 47.9656 58.2549 46.6053 57.9976 45.1688C57.7378 43.7215 57.4033 42.3533 57.0029 41.1029C56.5894 39.8104 56.0269 38.534 55.3315 37.3109C54.6099 36.0414 53.7622 34.9359 52.811 34.0262C51.8164 33.0746 50.5986 32.3094 49.1904 31.7513C47.7871 31.1962 46.2319 30.9149 44.5684 30.9149C43.915 30.9149 43.2832 31.183 42.063 31.9774C41.312 32.4672 40.4336 33.0336 39.4531 33.66C38.6147 34.1942 37.479 34.6947 36.0762 35.1478C34.7075 35.5907 33.3179 35.8153 31.9463 35.8153C30.5747 35.8153 29.1855 35.5907 27.8154 35.1478C26.4141 34.6952 25.2783 34.1947 24.4409 33.6605C23.4697 33.0399 22.5908 32.4735 21.8286 31.9769C20.6099 31.1825 19.9775 30.9144 19.3242 30.9144C17.6602 30.9144 16.1055 31.1962 14.7026 31.7518C13.2954 32.309 12.0771 33.0741 11.0815 34.0267C10.1309 34.9369 9.28271 36.0419 8.56201 37.3109C7.86719 38.534 7.30469 39.8099 6.89062 41.1034C6.49072 42.3538 6.15625 43.7215 5.89648 45.1688C5.63916 46.6033 5.46436 47.9642 5.37793 49.2142C5.29297 50.4388 5.25 51.7098 5.25 52.9934C5.25 56.3343 6.31201 59.0388 8.40625 61.0335C10.4746 63.0017 13.2114 64.0002 16.5396 64.0002H47.356C50.6841 64.0002 53.4199 63.0022 55.4888 61.0335C57.5835 59.0403 58.6455 56.3352 58.6455 52.993C58.645 51.7034 58.6016 50.4314 58.5161 49.2127V49.2127Z","fill","#0B73C9"],["id","clip0"],["width","64","height","64","fill","#0B73C9"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall",4,"ngIf"],[3,"error","text","connected","ended","small"],[3,"started"],[1,"container__remote",3,"id"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall"]],template:function(o,c){1&o&&Tn(0,A$,3,5,"div",0),2&o&&Ze("ngIf",c.shown)},dependencies:[TP,Ou,D$,N$,O$,k$,hb],styles:["ngx-timer[_ngcontent-%COMP%]{display:block;padding-top:25px}[_nghost-%COMP%]{bottom:0;max-width:100%;right:0;width:100%;transition:.3s}.active[_nghost-%COMP%]{position:fixed}.small-screen[_nghost-%COMP%]{max-width:210px}.small-screen[_nghost-%COMP%]   ngx-timer[_ngcontent-%COMP%]{padding-top:10px}.small-screen[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{border-radius:10px;box-shadow:#00000059 0 5px 15px;height:200px;max-width:200px;margin-right:10px;margin-bottom:10px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]{border-radius:10px;height:200px;width:200px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]    >div{border-radius:10px}.small-screen[_nghost-%COMP%]   .container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.container[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;max-width:100%;margin-left:auto;overflow:hidden;position:relative;transition:.3s}.container__local[_ngcontent-%COMP%]{border-radius:5px;height:20vh;opacity:1;overflow:hidden;position:absolute;right:1rem;top:1rem;width:20vw;z-index:1;transition:.3s}.container__local.hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden}.container__local[_ngcontent-%COMP%]:not(:empty){box-shadow:0 3px 8px #00000080}.container__remote[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;left:0;position:absolute;top:0;width:100vw;transition:.3s}.container__remote[_ngcontent-%COMP%]    >div{transition:.3s}.container__remote.hidden[_ngcontent-%COMP%]{display:none}.container__remote.hidden[_ngcontent-%COMP%] + .container__user-icon[_ngcontent-%COMP%]{display:block}.container__remote[_ngcontent-%COMP%]:empty{display:none}.container__user-icon[_ngcontent-%COMP%]{background:#0000004d;border-radius:50%;box-shadow:0 3px 8px #00000080;display:none;left:50%;padding:20px;position:absolute;top:50%;transform:translate(-50%,-50%)}.container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px}@media screen and (max-width: 769px){ngx-controls[_ngcontent-%COMP%]{opacity:1!important}}"],data:{animation:[dH]},changeDetection:0})}return e})(),L$=(()=>{class e{constructor(t){this.dialog=t}open(t){const o=new en,c=this.dialog.open(P$,{data:t});return c.afterClosed.asObservable().pipe(td(u=>u?.channel?this.dialog.open(pH,{uid:u.uid,channel:u.channel,debug:!!u.debug,displaySmallScreen:!0}).afterClosed.asObservable():pt(!1)),Vr(1),io(()=>o.next(!0))).subscribe(),{acceptCall:c.onAcceptCall.bind(c),close:c.closeDialog.bind(c),afterConfirmation:()=>c.afterClosed.asObservable().pipe(Vr(1)),afterCallEnd:()=>o.asObservable().pipe(Vr(1))}}static#e=this.\u0275fac=function(o){return new(o||e)(be(M$))};static#t=this.\u0275prov=Pe({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),F$=(()=>{class e{static forRoot(t){return{ngModule:e,providers:[hH,{provide:"AgoraConfig",useValue:t}]}}static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e});static#n=this.\u0275inj=Qn({imports:[Pu]})}return e})();const U$=[{path:"",component:(()=>{class e{constructor(t,o,c,u,f){this.formBuilder=t,this.router=o,this.localStorage=c,this.videoCallDialogService=u,this.cdr=f,this.sessionKey="ngx-webrtc:channelId",this.outcome=!1}get channelId(){return this.localStorage.getItem(this.sessionKey)||"test-channel-ngx-webrtc"}get tooltipText(){return this.outcome?"Outcome":"Income"}ngOnInit(){this.form=this.formBuilder.group({channelId:[this.channelId,dj.required]})}onSubmit(){this.saveChannel(),this.router.navigate(["conference"],{queryParams:{...this.form.value}})}onModalOpen(){this.saveChannel(),this.dialog=this.videoCallDialogService.open({uid:String(Math.floor(100*Math.random())),channel:this.channelId,outcome:this.outcome,user:{name:"Test User",photoURL:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTvDtoEwuV9E2kHqNDi6MnBzXlefn8TfyrwgQ&usqp=CAU"},debug:!0});const t=setTimeout(()=>this.dialog?.close(),7e3);this.dialog.afterConfirmation().pipe(Ea(o=>!!o),io(()=>clearTimeout(t))).subscribe(),this.dialog.afterCallEnd().subscribe(()=>{clearTimeout(t),this.dialog=null,this.cdr.markForCheck()})}saveChannel(){const{channelId:t}=this.form.value;this.localStorage.setItem(this.sessionKey,t)}static#e=this.\u0275fac=function(o){return new(o||e)(ae(TG),ae(ya),ae(Storage),ae(L$),ae(Us))};static#t=this.\u0275cmp=Br({type:e,selectors:[["app-home"]],decls:25,vars:8,consts:[[1,"home"],[1,"home__welcome"],[1,"home__form",3,"formGroup","ngSubmit"],[1,"home__wrapper","home__wrapper--center"],["src","assets/user.svg","alt","User",1,"user"],[1,"home__title"],["appearance","outline",1,"home__wrapper"],["matInput","","placeholder","Channel id","formControlName","channelId"],[1,"home__wrapper","home__wrapper--center","home__wrapper--buttons"],["mat-flat-button","","color","primary",1,"home__btn",3,"disabled"],["mat-raised-button","","type","button",1,"home__btn",3,"disabled","click"],[3,"checked","disabled","matTooltip","change","click"],[1,"home__footer"],["href","https://www.npmjs.com/package/ngx-webrtc-lib","target","_blank"],["viewBox","0 0 27.23 27.23"],["width","27.23","height","27.23","rx","2"],["fill","#fff","points","5.8 21.75 13.66 21.75 13.67 9.98 17.59 9.98 17.58 21.76 21.51 21.76 21.52 6.06 5.82 6.04 5.8 21.75"],["href","https://github.com/TarasMoskovych/ngx-webrtc","target","_blank"],["aria-hidden","true","role","img","viewBox","0 0 16 16","width","50","height","50",1,""],["fill-rule","evenodd","d","M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"]],template:function(o,c){1&o&&(oe(0,"div",0)(1,"div",1)(2,"form",2),gn("ngSubmit",function(){return!c.dialog&&c.onSubmit()}),oe(3,"div",3),ce(4,"img",4),Ee(),oe(5,"h1",5),br(6," Welcome "),Ee(),oe(7,"mat-form-field",6)(8,"mat-label"),br(9,"Channel Id"),Ee(),ce(10,"input",7),Ee(),oe(11,"div",8)(12,"button",9),br(13,"Start / Join call"),Ee(),oe(14,"button",10),gn("click",function(){return!c.dialog&&c.onModalOpen()}),br(15,"Open Call Dialog "),oe(16,"mat-slide-toggle",11),gn("change",function(f){return c.outcome=f.checked})("click",function(f){return f.stopPropagation()}),Ee()()()(),oe(17,"div",12)(18,"a",13),Zo(),oe(19,"svg",14),ce(20,"rect",15)(21,"polygon",16),Ee()(),_c(),oe(22,"a",17),Zo(),oe(23,"svg",18),ce(24,"path",19),Ee()()()()()),2&o&&(Qe(2),Ze("formGroup",c.form),Qe(5),Ht("mat-focused",c.form.valid),Qe(5),Ze("disabled",c.form.invalid||!!c.dialog),Qe(2),Ze("disabled",c.form.invalid||!!c.dialog),Qe(2),Ze("checked",c.outcome)("disabled",!!c.dialog)("matTooltip",c.tooltipText))},dependencies:[qj,zP,Pj,Mj,dI,gU,F9,M9,UU,VW,qz,VU],styles:[".home[_ngcontent-%COMP%]{align-items:center;background-color:#f2f2f2;display:flex;flex-wrap:wrap;justify-content:center;min-height:100vh;width:100%}.home__welcome[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 5px 10px #0000001a;overflow:hidden;padding:10px 35px;width:390px}.home__welcome[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{height:150px}.home__title[_ngcontent-%COMP%]{color:#333;display:block;font-size:30px;font-weight:500;margin:10px 0 60px;text-align:center}.home__wrapper[_ngcontent-%COMP%]{width:100%}.home__wrapper--center[_ngcontent-%COMP%]{text-align:center}.home__wrapper--buttons[_ngcontent-%COMP%]{align-items:center;display:flex}.home__btn[_ngcontent-%COMP%]{letter-spacing:normal}.home__btn[_ngcontent-%COMP%]:first-of-type{margin-right:5px}.home__btn[_ngcontent-%COMP%]:last-of-type{margin-left:5px}.home__footer[_ngcontent-%COMP%]{margin-top:30px;text-align:center}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:#333;cursor:pointer;height:24px;margin:0 5px;width:24px;transition:.3s}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]:hover{fill:#aaa}"],changeDetection:0})}return e})()},{path:"conference",component:(()=>{class e{constructor(t,o){this.route=t,this.router=o,this.uid=String(Math.floor(100*Math.random()))}ngOnInit(){this.channel=this.route.snapshot.queryParams.channelId||"test-channel"}onCallEnd(){this.router.navigateByUrl("/")}static#e=this.\u0275fac=function(o){return new(o||e)(ae(Og),ae(ya))};static#t=this.\u0275cmp=Br({type:e,selectors:[["app-conference"]],decls:1,vars:4,consts:[[3,"animate","channel","debug","uid","callEnd"]],template:function(o,c){1&o&&(oe(0,"ngx-webrtc",0),gn("callEnd",function(){return c.onCallEnd()}),Ee()),2&o&&Ze("animate",!1)("channel",c.channel)("debug",!0)("uid",c.uid)},dependencies:[pH],changeDetection:0})}return e})()},{path:"**",redirectTo:""}];let V$=(()=>{class e{static#e=this.\u0275fac=function(o){return new(o||e)};static#t=this.\u0275mod=ui({type:e,bootstrap:[u$]});static#n=this.\u0275inj=Qn({providers:[{provide:Storage,useValue:window.localStorage}],imports:[LB,UK,F$.forRoot(aH_configs),IG,r$.forRoot(U$),U9,jW,$z,q9]})}return e})();kH().bootstrapModule(V$).catch(e=>console.error(e))},291:function(id,Mg,xg){var L=xg(156).default;id.exports=function(){"use strict";var Ys=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Rt(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var cn=function(s){try{return!!s()}catch{return!0}},As=!cn(function(){var s=function(){}.bind();return"function"!=typeof s||s.hasOwnProperty("prototype")}),Yo=As,An=Function.prototype,sc=An.call,Bb=Yo&&An.bind.bind(sc,sc),Ri=Yo?Bb:function(s){return function(){return sc.apply(s,arguments)}},Ds=Ri({}.isPrototypeOf),ju=function(s){return s&&s.Math==Math&&s},lr=ju("object"==typeof globalThis&&globalThis)||ju("object"==typeof window&&window)||ju("object"==typeof self&&self)||ju("object"==typeof Ys&&Ys)||function(){return this}()||Ys||Function("return this")(),jb=Function.prototype,Hb=jb.apply,Gb=jb.call,kg="object"==typeof Reflect&&Reflect.apply||(As?Gb.bind(Hb):function(){return Gb.apply(Hb,arguments)}),Wb=Ri,zb=Wb({}.toString),jI=Wb("".slice),ac=function(s){return jI(zb(s),8,-1)},Lg=ac,Gp=Ri,cc=function(s){if("Function"===Lg(s))return Gp(s)},Fg="object"==typeof document&&document.all,Kb={all:Fg,IS_HTMLDDA:void 0===Fg&&void 0!==Fg},$V=Kb.all,nr=Kb.IS_HTMLDDA?function(s){return"function"==typeof s||s===$V}:function(s){return"function"==typeof s},Wp={},Sa=!cn(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),zp=Function.prototype.call,wr=As?zp.bind(zp):function(){return zp.apply(zp,arguments)},qb={},Ug={}.propertyIsEnumerable,$M=Object.getOwnPropertyDescriptor,JV=$M&&!Ug.call({1:2},1);qb.f=JV?function(s){var i=$M(this,s);return!!i&&i.enumerable}:Ug;var pl,Vg,Hu=function(s,i){return{enumerable:!(1&s),configurable:!(2&s),writable:!(4&s),value:i}},XM=cn,JM=ac,HI=Object,GI=Ri("".split),Yb=XM(function(){return!HI("z").propertyIsEnumerable(0)})?function(s){return"String"==JM(s)?GI(s,""):HI(s)}:HI,$b=function(s){return null==s},dn=$b,Xb=TypeError,fl=function(s){if(dn(s))throw Xb("Can't call method on "+s);return s},Bg=Yb,Ki=fl,rd=function(s){return Bg(Ki(s))},Jb=nr,WI=Kb.all,ur=Kb.IS_HTMLDDA?function(s){return"object"==typeof s?null!==s:Jb(s)||s===WI}:function(s){return"object"==typeof s?null!==s:Jb(s)},Os={},jg=Os,Gu=lr,QM=nr,zI=function(s){return QM(s)?s:void 0},vo=function(s,i){return arguments.length<2?zI(jg[s])||zI(Gu[s]):jg[s]&&jg[s][i]||Gu[s]&&Gu[s][i]},dc=typeof navigator<"u"&&String(navigator.userAgent)||"",Wu=dc,KI=lr.process,Hg=lr.Deno,qI=KI&&KI.versions||Hg&&Hg.version,Gg=qI&&qI.v8;Gg&&(Vg=(pl=Gg.split("."))[0]>0&&pl[0]<4?1:+(pl[0]+pl[1])),!Vg&&Wu&&(!(pl=Wu.match(/Edge\/(\d+)/))||pl[1]>=74)&&(pl=Wu.match(/Chrome\/(\d+)/))&&(Vg=+pl[1]);var ml=Vg,zu=ml,ZM=lr.String,sd=!!Object.getOwnPropertySymbols&&!cn(function(){var s=Symbol();return!ZM(s)||!(Object(s)instanceof Symbol)||!Symbol.sham&&zu&&zu<41}),YI=sd&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Qb=vo,ad=nr,ex=Ds,$I=Object,Wn=YI?function(s){return"symbol"==typeof s}:function(s){var i=Qb("Symbol");return ad(i)&&ex(i.prototype,$I(s))},XI=String,Ku=function(s){try{return XI(s)}catch{return"Object"}},tx=nr,nx=Ku,en=TypeError,$o=function(s){if(tx(s))return s;throw en(nx(s)+" is not a function")},oo=$o,JI=$b,fi=function(s,i){var r=s[i];return JI(r)?void 0:oo(r)},Jn=wr,Zb=nr,Yt=ur,QV=TypeError,ey={exports:{}},he=lr,qu=Object.defineProperty,ZI="__core-js_shared__",ew=lr[ZI]||function(s,i){try{qu(he,s,{value:i,configurable:!0,writable:!0})}catch{he[s]=i}return i}(ZI,{}),ix=ew;(ey.exports=function(s,i){return ix[s]||(ix[s]=void 0!==i?i:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var gl=ey.exports,ZV=fl,e3=Object,_l=function(s){return e3(ZV(s))},Dn=_l,rx=Ri({}.hasOwnProperty),$t=Object.hasOwn||function(s,i){return rx(Dn(s),i)},ty=Ri,t3=0,ox=Math.random(),Ln=ty(1..toString),nt=function(s){return"Symbol("+(void 0===s?"":s)+")_"+Ln(++t3+ox,36)},Kg=$t,Kp=nt,ny=sd,iy=YI,El=lr.Symbol,$s=gl("wks"),qp=iy?El.for||El:El&&El.withoutSetter||Kp,li=function(s){return Kg($s,s)||($s[s]=ny&&Kg(El,s)?El[s]:qp("Symbol."+s)),$s[s]},yt=wr,ln=ur,sx=Wn,ax=fi,n3=TypeError,dx=li("toPrimitive"),ry=function(s,i){if(!ln(s)||sx(s))return s;var r,a=ax(s,dx);if(a){if(void 0===i&&(i="default"),r=yt(a,s,i),!ln(r)||sx(r))return r;throw n3("Can't convert object to primitive value")}return void 0===i&&(i="number"),function(s,i){var r,a;if("string"===i&&Zb(r=s.toString)&&!Yt(a=Jn(r,s))||Zb(r=s.valueOf)&&!Yt(a=Jn(r,s))||"string"!==i&&Zb(r=s.toString)&&!Yt(a=Jn(r,s)))return a;throw QV("Can't convert object to primitive value")}(s,i)},Xo=Wn,oy=function(s){var i=ry(s,"string");return Xo(i)?i:i+""},tw=ur,nw=lr.document,cd=tw(nw)&&tw(nw.createElement),iw=function(s){return cd?nw.createElement(s):{}},i3=iw,lx=!Sa&&!cn(function(){return 7!=Object.defineProperty(i3("div"),"a",{get:function(){return 7}}).a}),ux=wr,o3=qb,hx=Hu,s3=rd,bo=oy,ct=$t,a3=lx,px=Object.getOwnPropertyDescriptor;Wp.f=Sa?px:function(s,i){if(s=s3(s),i=bo(i),a3)try{return px(s,i)}catch{}if(ct(s,i))return hx(!ux(o3.f,s,i),s[i])};var c3=cn,d3=nr,Pe=/#|\.prototype\./,qg=function(s,i){var r=Yg[Qn(s)];return r==rw||r!=fx&&(d3(i)?c3(i):!!i)},Qn=qg.normalize=function(s){return String(s).replace(Pe,".").toLowerCase()},Yg=qg.data={},fx=qg.NATIVE="N",rw=qg.POLYFILL="P",ow=qg,$g=$o,Xg=As,sy=cc(cc.bind),Yu=function(s,i){return $g(s),void 0===i?s:Xg?sy(s,i):function(){return s.apply(i,arguments)}},Ns={},Vt=Sa&&cn(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),ay=ur,sw=String,yo=TypeError,Ps=function(s){if(ay(s))return s;throw yo(sw(s)+" is not an object")},yn=lx,cy=Ps,De=oy,dy=TypeError,Yp=Object.defineProperty,aw=Object.getOwnPropertyDescriptor,$p="enumerable",ly="configurable",Xp="writable";Ns.f=Sa?Vt?function(s,i,r){if(cy(s),i=De(i),cy(r),"function"==typeof s&&"prototype"===i&&"value"in r&&Xp in r&&!r[Xp]){var a=aw(s,i);a&&a[Xp]&&(s[i]=r.value,r={configurable:ly in r?r[ly]:a[ly],enumerable:$p in r?r[$p]:a[$p],writable:!1})}return Yp(s,i,r)}:Yp:function(s,i,r){if(cy(s),i=De(i),cy(r),yn)try{return Yp(s,i,r)}catch{}if("get"in r||"set"in r)throw dy("Accessors not supported");return"value"in r&&(s[i]=r.value),s};var h3=Ns,p3=Hu,vl=Sa?function(s,i,r){return h3.f(s,i,p3(1,r))}:function(s,i,r){return s[i]=r,s},uy=lr,f3=kg,Jp=cc,hy=nr,Jg=Wp.f,mx=ow,$u=Os,gx=Yu,bl=vl,yl=$t,_x=function(s){var i=function(r,a,d){if(this instanceof i){switch(arguments.length){case 0:return new s;case 1:return new s(r);case 2:return new s(r,a)}return new s(r,a,d)}return f3(s,this,arguments)};return i.prototype=s.prototype,i},Bt=function(s,i){var r,a,d,l,h,p,m,_,v,b=s.target,y=s.global,T=s.stat,M=s.proto,O=y?uy:T?uy[b]:(uy[b]||{}).prototype,D=y?$u:$u[b]||bl($u,b,{})[b],x=D.prototype;for(l in i)a=!(r=mx(y?l:b+(T?".":"#")+l,s.forced))&&O&&yl(O,l),p=D[l],a&&(m=s.dontCallGetSet?(v=Jg(O,l))&&v.value:O[l]),h=a&&m?m:i[l],a&&typeof p==typeof h||(_=s.bind&&a?gx(h,uy):s.wrap&&a?_x(h):M&&hy(h)?Jp(h):h,(s.sham||h&&h.sham||p&&p.sham)&&bl(_,"sham",!0),bl(D,l,_),M&&(yl($u,d=b+"Prototype")||bl($u,d,{}),bl($u[d],l,h),s.real&&x&&(r||!x[l])&&bl(x,l,h)))},Ex=Math.ceil,be=Math.floor,cw=Math.trunc||function(s){var i=+s;return(i>0?be:Ex)(i)},Te=function(s){var i=+s;return i!=i||0===i?0:cw(i)},Qg=Te,py=Math.max,Qp=Math.min,dw=function(s,i){var r=Qg(s);return r<0?py(r+i,0):Qp(r,i)},vx=Te,bx=Math.min,Ta=function(s){return function(s){return s>0?bx(vx(s),9007199254740991):0}(s.length)},Xs=rd,Ia=dw,un=Ta,Xe=function(s){return function(i,r,a){var d,l=Xs(i),h=un(l),p=Ia(a,h);if(s&&r!=r){for(;h>p;)if((d=l[p++])!=d)return!0}else for(;h>p;p++)if((s||p in l)&&l[p]===r)return s||p||0;return!s&&-1}},Zg={includes:Xe(!0),indexOf:Xe(!1)},fy=Zg.includes;Bt({target:"Array",proto:!0,forced:cn(function(){return!Array(1).includes()})},{includes:function(s){return fy(this,s,arguments.length>1?arguments[1]:void 0)}});var lw=Os,uc=function(s){return lw[s+"Prototype"]},Zp=uc("Array").includes,uw=ur,hw=ac,yx=li("match"),Cx=TypeError,fw={};fw[li("toStringTag")]="z";var Jo="[object z]"===String(fw),Sx=Jo,mw=nr,e_=ac,Tx=li("toStringTag"),Ix=Object,wx="Arguments"==e_(function(){return arguments}()),dd=Sx?e_:function(s){var i,r,a;return void 0===s?"Undefined":null===s?"Null":"string"==typeof(r=function(d,l){try{return d[l]}catch{}}(i=Ix(s),Tx))?r:wx?e_(i):"Object"==(a=e_(i))&&mw(i.callee)?"Arguments":a},Rx=dd,Ax=String,hc=function(s){if("Symbol"===Rx(s))throw TypeError("Cannot convert a Symbol value to a string");return Ax(s)},Br=li("match"),Dx=Bt,Ox=function(s){if(function(s){var i;return uw(s)&&(void 0!==(i=s[yx])?!!i:"RegExp"==hw(s))}(s))throw Cx("The method doesn't accept regular expressions");return s},ui=fl,my=hc,Co=Ri("".indexOf);Dx({target:"String",proto:!0,forced:!function(s){var i=/./;try{"/./"[s](i)}catch{try{return i[Br]=!1,"/./"[s](i)}catch{}}return!1}("includes")},{includes:function(s){return!!~Co(my(ui(this)),my(Ox(s)),arguments.length>1?arguments[1]:void 0)}});var Lt=uc("String").includes,qi=Ds,Rr=Zp,ld=Lt,hr=Array.prototype,t_=String.prototype,ye=Rt(function(s){var i=s.includes;return s===hr||qi(hr,s)&&i===hr.includes?Rr:"string"==typeof s||s===t_||qi(t_,s)&&i===t_.includes?ld:i});let ef=!0,gw=!0;function n_(s,i,r){const a=s.match(i);return a&&a.length>=r&&parseInt(a[r],10)}function Cn(s,i,r){if(!s.RTCPeerConnection)return;const a=s.RTCPeerConnection.prototype,d=a.addEventListener;a.addEventListener=function(h,p){if(h!==i)return d.apply(this,arguments);const m=_=>{const v=r(_);v&&(p.handleEvent?p.handleEvent(v):p(v))};return this._eventMap=this._eventMap||{},this._eventMap[i]||(this._eventMap[i]=new Map),this._eventMap[i].set(p,m),d.apply(this,[h,m])};const l=a.removeEventListener;a.removeEventListener=function(h,p){if(h!==i||!this._eventMap||!this._eventMap[i])return l.apply(this,arguments);if(!this._eventMap[i].has(p))return l.apply(this,arguments);const m=this._eventMap[i].get(p);return this._eventMap[i].delete(p),0===this._eventMap[i].size&&delete this._eventMap[i],0===Object.keys(this._eventMap).length&&delete this._eventMap,l.apply(this,[h,m])},Object.defineProperty(a,"on"+i,{get(){return this["_on"+i]},set(h){this["_on"+i]&&(this.removeEventListener(i,this["_on"+i]),delete this["_on"+i]),h&&this.addEventListener(i,this["_on"+i]=h)},enumerable:!0,configurable:!0})}function Ne(s){return"boolean"!=typeof s?new Error("Argument type: "+typeof s+". Please use a boolean."):(ef=s,s?"adapter.js logging disabled":"adapter.js logging enabled")}function et(s){return"boolean"!=typeof s?new Error("Argument type: "+typeof s+". Please use a boolean."):(gw=!s,"adapter.js deprecation warnings "+(s?"disabled":"enabled"))}function Ai(){if("object"==typeof window){if(ef)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Qo(s,i){gw&&console.warn(s+" is deprecated, please use "+i+" instead.")}function Ar(s){return"[object Object]"===Object.prototype.toString.call(s)}function Ms(s){return Ar(s)?Object.keys(s).reduce(function(i,r){const a=Ar(s[r]),d=a?Ms(s[r]):s[r],l=a&&!Object.keys(d).length;return void 0===d||l?i:Object.assign(i,{[r]:d})},{}):s}function ud(s,i,r){i&&!r.has(i.id)&&(r.set(i.id,i),Object.keys(i).forEach(a=>{a.endsWith("Id")?ud(s,s.get(i[a]),r):a.endsWith("Ids")&&i[a].forEach(d=>{ud(s,s.get(d),r)})}))}function zn(s,i,r){const a=r?"outbound-rtp":"inbound-rtp",d=new Map;if(null===i)return d;const l=[];return s.forEach(h=>{"track"===h.type&&h.trackIdentifier===i.id&&l.push(h)}),l.forEach(h=>{s.forEach(p=>{p.type===a&&p.trackId===h.id&&ud(s,p,d)})}),d}const jr=Ai;function wa(s,i){const r=s&&s.navigator;if(!r.mediaDevices)return;const a=function(h){if("object"!=typeof h||h.mandatory||h.optional)return h;const p={};return Object.keys(h).forEach(m=>{if("require"===m||"advanced"===m||"mediaSource"===m)return;const _="object"==typeof h[m]?h[m]:{ideal:h[m]};void 0!==_.exact&&"number"==typeof _.exact&&(_.min=_.max=_.exact);const v=function(b,y){return b?b+y.charAt(0).toUpperCase()+y.slice(1):"deviceId"===y?"sourceId":y};if(void 0!==_.ideal){p.optional=p.optional||[];let b={};"number"==typeof _.ideal?(b[v("min",m)]=_.ideal,p.optional.push(b),b={},b[v("max",m)]=_.ideal,p.optional.push(b)):(b[v("",m)]=_.ideal,p.optional.push(b))}void 0!==_.exact&&"number"!=typeof _.exact?(p.mandatory=p.mandatory||{},p.mandatory[v("",m)]=_.exact):["min","max"].forEach(b=>{void 0!==_[b]&&(p.mandatory=p.mandatory||{},p.mandatory[v(b,m)]=_[b])})}),h.advanced&&(p.optional=(p.optional||[]).concat(h.advanced)),p},d=function(h,p){if(i.version>=61)return p(h);if((h=JSON.parse(JSON.stringify(h)))&&"object"==typeof h.audio){const m=function(_,v,b){v in _&&!(b in _)&&(_[b]=_[v],delete _[v])};m((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),m(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&"object"==typeof h.video){let m=h.video.facingMode;m=m&&("object"==typeof m?m:{ideal:m});const _=i.version<66;if(m&&("user"===m.exact||"environment"===m.exact||"user"===m.ideal||"environment"===m.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||_)){let v;if(delete h.video.facingMode,"environment"===m.exact||"environment"===m.ideal?v=["back","rear"]:"user"!==m.exact&&"user"!==m.ideal||(v=["front"]),v)return r.mediaDevices.enumerateDevices().then(b=>{let y=(b=b.filter(T=>"videoinput"===T.kind)).find(T=>v.some(M=>T.label.toLowerCase().includes(M)));return!y&&b.length&&v.includes("back")&&(y=b[b.length-1]),y&&(h.video.deviceId=m.exact?{exact:y.deviceId}:{ideal:y.deviceId}),h.video=a(h.video),jr("chrome: "+JSON.stringify(h)),p(h)})}h.video=a(h.video)}return jr("chrome: "+JSON.stringify(h)),p(h)},l=function(h){return i.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(h,p,m){d(h,_=>{r.webkitGetUserMedia(_,p,v=>{m&&m(l(v))})})}.bind(r),r.mediaDevices.getUserMedia){const h=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(p){return d(p,m=>h(m).then(_=>{if(m.audio&&!_.getAudioTracks().length||m.video&&!_.getVideoTracks().length)throw _.getTracks().forEach(v=>{v.stop()}),new DOMException("","NotFoundError");return _},_=>Promise.reject(l(_))))}}}function Ct(s){s.MediaStream=s.MediaStream||s.webkitMediaStream}function Xu(s){if("object"==typeof s&&s.RTCPeerConnection&&!("ontrack"in s.RTCPeerConnection.prototype)){Object.defineProperty(s.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const i=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",a=>{let d;d=s.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.track.id):{track:a.track};const l=new Event("track");l.track=a.track,l.receiver=d,l.transceiver={receiver:d},l.streams=[r.stream],this.dispatchEvent(l)}),r.stream.getTracks().forEach(a=>{let d;d=s.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.id):{track:a};const l=new Event("track");l.track=a,l.receiver=d,l.transceiver={receiver:d},l.streams=[r.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),i.apply(this,arguments)}}else Cn(s,"track",i=>(i.transceiver||Object.defineProperty(i,"transceiver",{value:{receiver:i.receiver}}),i))}function gy(s){if("object"==typeof s&&s.RTCPeerConnection&&!("getSenders"in s.RTCPeerConnection.prototype)&&"createDTMFSender"in s.RTCPeerConnection.prototype){const i=function(d,l){return{track:l,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===l.kind?d.createDTMFSender(l):null),this._dtmf},_pc:d}};if(!s.RTCPeerConnection.prototype.getSenders){s.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const d=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(h,p){let m=d.apply(this,arguments);return m||(m=i(this,h),this._senders.push(m)),m};const l=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(h){l.apply(this,arguments);const p=this._senders.indexOf(h);-1!==p&&this._senders.splice(p,1)}}const r=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(d){this._senders=this._senders||[],r.apply(this,[d]),d.getTracks().forEach(l=>{this._senders.push(i(this,l))})};const a=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(d){this._senders=this._senders||[],a.apply(this,[d]),d.getTracks().forEach(l=>{const h=this._senders.find(p=>p.track===l);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if("object"==typeof s&&s.RTCPeerConnection&&"getSenders"in s.RTCPeerConnection.prototype&&"createDTMFSender"in s.RTCPeerConnection.prototype&&s.RTCRtpSender&&!("dtmf"in s.RTCRtpSender.prototype)){const i=s.RTCPeerConnection.prototype.getSenders;s.RTCPeerConnection.prototype.getSenders=function(){const r=i.apply(this,[]);return r.forEach(a=>a._pc=this),r},Object.defineProperty(s.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function Cl(s){if(!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[r,a,d]=arguments;if(arguments.length>0&&"function"==typeof r)return i.apply(this,arguments);if(0===i.length&&(0===arguments.length||"function"!=typeof r))return i.apply(this,[]);const l=function(p){const m={};return p.result().forEach(_=>{const v={id:_.id,timestamp:_.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[_.type]||_.type};_.names().forEach(b=>{v[b]=_.stat(b)}),m[v.id]=v}),m},h=function(p){return new Map(Object.keys(p).map(m=>[m,p[m]]))};return arguments.length>=2?i.apply(this,[function(m){a(h(l(m)))},r]):new Promise((p,m)=>{i.apply(this,[function(_){p(h(l(_)))},m])}).then(a,d)}}function mi(s){if(!("object"==typeof s&&s.RTCPeerConnection&&s.RTCRtpSender&&s.RTCRtpReceiver))return;if(!("getStats"in s.RTCRtpSender.prototype)){const r=s.RTCPeerConnection.prototype.getSenders;r&&(s.RTCPeerConnection.prototype.getSenders=function(){const d=r.apply(this,[]);return d.forEach(l=>l._pc=this),d});const a=s.RTCPeerConnection.prototype.addTrack;a&&(s.RTCPeerConnection.prototype.addTrack=function(){const d=a.apply(this,arguments);return d._pc=this,d}),s.RTCRtpSender.prototype.getStats=function(){const d=this;return this._pc.getStats().then(l=>zn(l,d.track,!0))}}if(!("getStats"in s.RTCRtpReceiver.prototype)){const r=s.RTCPeerConnection.prototype.getReceivers;r&&(s.RTCPeerConnection.prototype.getReceivers=function(){const a=r.apply(this,[]);return a.forEach(d=>d._pc=this),a}),Cn(s,"track",a=>(a.receiver._pc=a.srcElement,a)),s.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(d=>zn(d,a.track,!1))}}if(!("getStats"in s.RTCRtpSender.prototype)||!("getStats"in s.RTCRtpReceiver.prototype))return;const i=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof s.MediaStreamTrack){const r=arguments[0];let a,d,l;return this.getSenders().forEach(h=>{h.track===r&&(a?l=!0:a=h)}),this.getReceivers().forEach(h=>(h.track===r&&(d?l=!0:d=h),h.track===r)),l||a&&d?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():d?d.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}function Ju(s){s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};const i=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addTrack=function(l,h){if(!h)return i.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=i.apply(this,arguments);return this._shimmedLocalStreams[h.id]?-1===this._shimmedLocalStreams[h.id].indexOf(p)&&this._shimmedLocalStreams[h.id].push(p):this._shimmedLocalStreams[h.id]=[h,p],p};const r=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(m=>{if(this.getSenders().find(_=>_.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();r.apply(this,arguments);const p=this.getSenders().filter(m=>-1===h.indexOf(m));this._shimmedLocalStreams[l.id]=[l].concat(p)};const a=s.RTCPeerConnection.prototype.removeStream;s.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],a.apply(this,arguments)};const d=s.RTCPeerConnection.prototype.removeTrack;s.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const p=this._shimmedLocalStreams[h].indexOf(l);-1!==p&&this._shimmedLocalStreams[h].splice(p,1),1===this._shimmedLocalStreams[h].length&&delete this._shimmedLocalStreams[h]}),d.apply(this,arguments)}}function Sl(s,i){if(!s.RTCPeerConnection)return;if(s.RTCPeerConnection.prototype.addTrack&&i.version>=65)return Ju(s);const r=s.RTCPeerConnection.prototype.getLocalStreams;s.RTCPeerConnection.prototype.getLocalStreams=function(){const m=r.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(_=>this._reverseStreams[_.id])};const a=s.RTCPeerConnection.prototype.addStream;s.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(_=>{if(this.getSenders().find(v=>v.track===_))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const _=new s.MediaStream(m.getTracks());this._streams[m.id]=_,this._reverseStreams[_.id]=m,m=_}a.apply(this,[m])};const d=s.RTCPeerConnection.prototype.removeStream;function l(m,_){let v=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(b=>{const y=m._reverseStreams[b];v=v.replace(new RegExp(m._streams[y.id].id,"g"),y.id)}),new RTCSessionDescription({type:_.type,sdp:v})}s.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},s.RTCPeerConnection.prototype.addTrack=function(m,_){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const v=[].slice.call(arguments,1);if(1!==v.length||!v[0].getTracks().find(y=>y===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(y=>y.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const b=this._streams[_.id];if(b)b.addTrack(m),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const y=new s.MediaStream([m]);this._streams[_.id]=y,this._reverseStreams[y.id]=_,this.addStream(y)}return this.getSenders().find(y=>y.track===m)},["createOffer","createAnswer"].forEach(function(m){const _=s.RTCPeerConnection.prototype[m],v={[m](){const b=arguments;return arguments.length&&"function"==typeof arguments[0]?_.apply(this,[y=>{const T=l(this,y);b[0].apply(null,[T])},y=>{b[1]&&b[1].apply(null,y)},arguments[2]]):_.apply(this,arguments).then(y=>l(this,y))}};s.RTCPeerConnection.prototype[m]=v[m]});const h=s.RTCPeerConnection.prototype.setLocalDescription;s.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,_){let v=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(b=>{const y=m._reverseStreams[b],T=m._streams[y.id];v=v.replace(new RegExp(y.id,"g"),T.id)}),new RTCSessionDescription({type:_.type,sdp:v})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const p=Object.getOwnPropertyDescriptor(s.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(s.RTCPeerConnection.prototype,"localDescription",{get(){const m=p.get.apply(this);return""===m.type?m:l(this,m)}}),s.RTCPeerConnection.prototype.removeTrack=function(m){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let _;this._streams=this._streams||{},Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(b=>m.track===b)&&(_=this._streams[v])}),_&&(1===_.getTracks().length?this.removeStream(this._reverseStreams[_.id]):_.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function xs(s,i){!s.RTCPeerConnection&&s.webkitRTCPeerConnection&&(s.RTCPeerConnection=s.webkitRTCPeerConnection),s.RTCPeerConnection&&i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const a=s.RTCPeerConnection.prototype[r],d={[r](){return arguments[0]=new("addIceCandidate"===r?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};s.RTCPeerConnection.prototype[r]=d[r]})}function Qu(s,i){Cn(s,"negotiationneeded",r=>{const a=r.target;if(!(i.version<72||a.getConfiguration&&"plan-b"===a.getConfiguration().sdpSemantics)||"stable"===a.signalingState)return r})}var _y=Object.freeze({__proto__:null,fixNegotiationNeeded:Qu,shimAddTrackRemoveTrack:Sl,shimAddTrackRemoveTrackWithNative:Ju,shimGetDisplayMedia:function(s,i){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&("function"==typeof i?s.navigator.mediaDevices.getDisplayMedia=function(r){return i(r).then(a=>{const d=r.video&&r.video.width,l=r.video&&r.video.height;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:r.video&&r.video.frameRate||3}},d&&(r.video.mandatory.maxWidth=d),l&&(r.video.mandatory.maxHeight=l),s.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:gy,shimGetStats:Cl,shimGetUserMedia:wa,shimMediaStream:Ct,shimOnTrack:Xu,shimPeerConnection:xs,shimSenderReceiverGetStats:mi});function pc(s,i){const r=s&&s.navigator,a=s&&s.MediaStreamTrack;if(r.getUserMedia=function(d,l,h){Qo("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(d).then(l,h)},!(i.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const d=function(h,p,m){p in h&&!(m in h)&&(h[m]=h[p],delete h[p])},l=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(h){return"object"==typeof h&&"object"==typeof h.audio&&(h=JSON.parse(JSON.stringify(h)),d(h.audio,"autoGainControl","mozAutoGainControl"),d(h.audio,"noiseSuppression","mozNoiseSuppression")),l(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const p=h.apply(this,arguments);return d(p,"mozAutoGainControl","autoGainControl"),d(p,"mozNoiseSuppression","noiseSuppression"),p}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(p){return"audio"===this.kind&&"object"==typeof p&&(p=JSON.parse(JSON.stringify(p)),d(p,"autoGainControl","mozAutoGainControl"),d(p,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[p])}}}}function tf(s){"object"==typeof s&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function fc(s,i){if("object"!=typeof s||!s.RTCPeerConnection&&!s.mozRTCPeerConnection)return;!s.RTCPeerConnection&&s.mozRTCPeerConnection&&(s.RTCPeerConnection=s.mozRTCPeerConnection),i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(d){const l=s.RTCPeerConnection.prototype[d],h={[d](){return arguments[0]=new("addIceCandidate"===d?s.RTCIceCandidate:s.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};s.RTCPeerConnection.prototype[d]=h[d]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=s.RTCPeerConnection.prototype.getStats;s.RTCPeerConnection.prototype.getStats=function(){const[d,l,h]=arguments;return a.apply(this,[d||null]).then(p=>{if(i.version<53&&!l)try{p.forEach(m=>{m.type=r[m.type]||m.type})}catch(m){if("TypeError"!==m.name)throw m;p.forEach((_,v)=>{p.set(v,Object.assign({},_,{type:r[_.type]||_.type}))})}return p}).then(l,h)}}function gt(s){if("object"!=typeof s||!s.RTCPeerConnection||!s.RTCRtpSender||s.RTCRtpSender&&"getStats"in s.RTCRtpSender.prototype)return;const i=s.RTCPeerConnection.prototype.getSenders;i&&(s.RTCPeerConnection.prototype.getSenders=function(){const a=i.apply(this,[]);return a.forEach(d=>d._pc=this),a});const r=s.RTCPeerConnection.prototype.addTrack;r&&(s.RTCPeerConnection.prototype.addTrack=function(){const a=r.apply(this,arguments);return a._pc=this,a}),s.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function i_(s){if("object"!=typeof s||!s.RTCPeerConnection||!s.RTCRtpSender||s.RTCRtpSender&&"getStats"in s.RTCRtpReceiver.prototype)return;const i=s.RTCPeerConnection.prototype.getReceivers;i&&(s.RTCPeerConnection.prototype.getReceivers=function(){const r=i.apply(this,[]);return r.forEach(a=>a._pc=this),r}),Cn(s,"track",r=>(r.receiver._pc=r.srcElement,r)),s.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Zu(s){s.RTCPeerConnection&&!("removeStream"in s.RTCPeerConnection.prototype)&&(s.RTCPeerConnection.prototype.removeStream=function(i){Qo("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&i.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Js(s){s.DataChannel&&!s.RTCDataChannel&&(s.RTCDataChannel=s.DataChannel)}function nf(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.addTransceiver;i&&(s.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;void 0===r&&(r=[]),r=[...r];const a=r.length>0;a&&r.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const d=i.apply(this,arguments);if(a){const{sender:l}=d,h=l.getParameters();(!("encodings"in h)||1===h.encodings.length&&0===Object.keys(h.encodings[0]).length)&&(h.encodings=r,l.sendEncodings=r,this.setParametersPromises.push(l.setParameters(h).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return d})}function Tl(s){if("object"!=typeof s||!s.RTCRtpSender)return;const i=s.RTCRtpSender.prototype.getParameters;i&&(s.RTCRtpSender.prototype.getParameters=function(){const r=i.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Di(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}function r_(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype.createAnswer;s.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}var Dr=Object.freeze({__proto__:null,shimAddTransceiver:nf,shimCreateAnswer:r_,shimCreateOffer:Di,shimGetDisplayMedia:function(s,i){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||s.navigator.mediaDevices&&(s.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return!0===r.video?r.video={mediaSource:i}:r.video.mediaSource=i,s.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:Tl,shimGetUserMedia:pc,shimOnTrack:tf,shimPeerConnection:fc,shimRTCDataChannel:Js,shimReceiverGetStats:i_,shimRemoveStream:Zu,shimSenderGetStats:gt});function Or(s){if("object"==typeof s&&s.RTCPeerConnection){if("getLocalStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in s.RTCPeerConnection.prototype)){const i=s.RTCPeerConnection.prototype.addTrack;s.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(a=>i.call(this,a,r)),r.getVideoTracks().forEach(a=>i.call(this,a,r))},s.RTCPeerConnection.prototype.addTrack=function(r,...a){return a&&a.forEach(d=>{this._localStreams?this._localStreams.includes(d)||this._localStreams.push(d):this._localStreams=[d]}),i.apply(this,arguments)}}"removeStream"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(i);if(-1===r)return;this._localStreams.splice(r,1);const a=i.getTracks();this.getSenders().forEach(d=>{a.includes(d.track)&&this.removeTrack(d)})})}}function o_(s){if("object"==typeof s&&s.RTCPeerConnection&&("getRemoteStreams"in s.RTCPeerConnection.prototype||(s.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in s.RTCPeerConnection.prototype))){Object.defineProperty(s.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(d=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(d))return;this._remoteStreams.push(d);const l=new Event("addstream");l.stream=d,this.dispatchEvent(l)})})}});const i=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(d=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(d)>=0)return;r._remoteStreams.push(d);const l=new Event("addstream");l.stream=d,r.dispatchEvent(l)})}),i.apply(r,arguments)}}}function hd(s){if("object"!=typeof s||!s.RTCPeerConnection)return;const i=s.RTCPeerConnection.prototype,r=i.createOffer,a=i.createAnswer,d=i.setLocalDescription,l=i.setRemoteDescription,h=i.addIceCandidate;i.createOffer=function(m,_){const b=r.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return _?(b.then(m,_),Promise.resolve()):b},i.createAnswer=function(m,_){const b=a.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return _?(b.then(m,_),Promise.resolve()):b};let p=function(m,_,v){const b=d.apply(this,[m]);return v?(b.then(_,v),Promise.resolve()):b};i.setLocalDescription=p,p=function(m,_,v){const b=l.apply(this,[m]);return v?(b.then(_,v),Promise.resolve()):b},i.setRemoteDescription=p,p=function(m,_,v){const b=h.apply(this,[m]);return v?(b.then(_,v),Promise.resolve()):b},i.addIceCandidate=p}function rf(s){const i=s&&s.navigator;if(i.mediaDevices&&i.mediaDevices.getUserMedia){const r=i.mediaDevices,a=r.getUserMedia.bind(r);i.mediaDevices.getUserMedia=d=>a(ks(d))}!i.getUserMedia&&i.mediaDevices&&i.mediaDevices.getUserMedia&&(i.getUserMedia=function(r,a,d){i.mediaDevices.getUserMedia(r).then(a,d)}.bind(i))}function ks(s){return s&&void 0!==s.video?Object.assign({},s,{video:Ms(s.video)}):s}function s_(s){if(!s.RTCPeerConnection)return;const i=s.RTCPeerConnection;s.RTCPeerConnection=function(r,a){if(r&&r.iceServers){const d=[];for(let l=0;l<r.iceServers.length;l++){let h=r.iceServers[l];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(Qo("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,d.push(h)):d.push(r.iceServers[l])}r.iceServers=d}return new i(r,a)},s.RTCPeerConnection.prototype=i.prototype,"generateCertificate"in i&&Object.defineProperty(s.RTCPeerConnection,"generateCertificate",{get:()=>i.generateCertificate})}function _w(s){"object"==typeof s&&s.RTCTrackEvent&&"receiver"in s.RTCTrackEvent.prototype&&!("transceiver"in s.RTCTrackEvent.prototype)&&Object.defineProperty(s.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ew(s){const i=s.RTCPeerConnection.prototype.createOffer;s.RTCPeerConnection.prototype.createOffer=function(r){if(r){void 0!==r.offerToReceiveAudio&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const a=this.getTransceivers().find(l=>"audio"===l.receiver.track.kind);!1===r.offerToReceiveAudio&&a?"sendrecv"===a.direction?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":"recvonly"===a.direction&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):!0!==r.offerToReceiveAudio||a||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==r.offerToReceiveVideo&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const d=this.getTransceivers().find(l=>"video"===l.receiver.track.kind);!1===r.offerToReceiveVideo&&d?"sendrecv"===d.direction?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":"recvonly"===d.direction&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):!0!==r.offerToReceiveVideo||d||this.addTransceiver("video",{direction:"recvonly"})}return i.apply(this,arguments)}}function a_(s){"object"!=typeof s||s.AudioContext||(s.AudioContext=s.webkitAudioContext)}var Ey=Object.freeze({__proto__:null,shimAudioContext:a_,shimCallbacksAPI:hd,shimConstraints:ks,shimCreateOfferLegacy:Ew,shimGetUserMedia:rf,shimLocalStreamsAPI:Or,shimRTCIceServerUrls:s_,shimRemoteStreamsAPI:o_,shimTrackEventTransceiver:_w}),vw={exports:{}};!function(s){const i={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};i.localCName=i.generateIdentifier(),i.splitLines=function(r){return r.trim().split("\n").map(a=>a.trim())},i.splitSections=function(r){return r.split("\nm=").map((a,d)=>(d>0?"m="+a:a).trim()+"\r\n")},i.getDescription=function(r){const a=i.splitSections(r);return a&&a[0]},i.getMediaSections=function(r){const a=i.splitSections(r);return a.shift(),a},i.matchPrefix=function(r,a){return i.splitLines(r).filter(d=>0===d.indexOf(a))},i.parseCandidate=function(r){let a;a=0===r.indexOf("a=candidate:")?r.substring(12).split(" "):r.substring(10).split(" ");const d={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let l=8;l<a.length;l+=2)switch(a[l]){case"raddr":d.relatedAddress=a[l+1];break;case"rport":d.relatedPort=parseInt(a[l+1],10);break;case"tcptype":d.tcpType=a[l+1];break;case"ufrag":d.ufrag=a[l+1],d.usernameFragment=a[l+1];break;default:void 0===d[a[l]]&&(d[a[l]]=a[l+1])}return d},i.writeCandidate=function(r){const a=[];a.push(r.foundation);const d=r.component;a.push("rtp"===d?1:"rtcp"===d?2:d),a.push(r.protocol.toUpperCase()),a.push(r.priority),a.push(r.address||r.ip),a.push(r.port);const l=r.type;return a.push("typ"),a.push(l),"host"!==l&&r.relatedAddress&&r.relatedPort&&(a.push("raddr"),a.push(r.relatedAddress),a.push("rport"),a.push(r.relatedPort)),r.tcpType&&"tcp"===r.protocol.toLowerCase()&&(a.push("tcptype"),a.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(a.push("ufrag"),a.push(r.usernameFragment||r.ufrag)),"candidate:"+a.join(" ")},i.parseIceOptions=function(r){return r.substring(14).split(" ")},i.parseRtpMap=function(r){let a=r.substring(9).split(" ");const d={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),d.name=a[0],d.clockRate=parseInt(a[1],10),d.channels=3===a.length?parseInt(a[2],10):1,d.numChannels=d.channels,d},i.writeRtpMap=function(r){let a=r.payloadType;void 0!==r.preferredPayloadType&&(a=r.preferredPayloadType);const d=r.channels||r.numChannels||1;return"a=rtpmap:"+a+" "+r.name+"/"+r.clockRate+(1!==d?"/"+d:"")+"\r\n"},i.parseExtmap=function(r){const a=r.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},i.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&"sendrecv"!==r.direction?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+"\r\n"},i.parseFmtp=function(r){const a={};let d;const l=r.substring(r.indexOf(" ")+1).split(";");for(let h=0;h<l.length;h++)d=l[h].trim().split("="),a[d[0].trim()]=d[1];return a},i.writeFmtp=function(r){let a="",d=r.payloadType;if(void 0!==r.preferredPayloadType&&(d=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const l=[];Object.keys(r.parameters).forEach(h=>{l.push(void 0!==r.parameters[h]?h+"="+r.parameters[h]:h)}),a+="a=fmtp:"+d+" "+l.join(";")+"\r\n"}return a},i.parseRtcpFb=function(r){const a=r.substring(r.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},i.writeRtcpFb=function(r){let a="",d=r.payloadType;return void 0!==r.preferredPayloadType&&(d=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(l=>{a+="a=rtcp-fb:"+d+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+"\r\n"}),a},i.parseSsrcMedia=function(r){const a=r.indexOf(" "),d={ssrc:parseInt(r.substring(7,a),10)},l=r.indexOf(":",a);return l>-1?(d.attribute=r.substring(a+1,l),d.value=r.substring(l+1)):d.attribute=r.substring(a+1),d},i.parseSsrcGroup=function(r){const a=r.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(d=>parseInt(d,10))}},i.getMid=function(r){const a=i.matchPrefix(r,"a=mid:")[0];if(a)return a.substring(6)},i.parseFingerprint=function(r){const a=r.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},i.getDtlsParameters=function(r,a){return{role:"auto",fingerprints:i.matchPrefix(r+a,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(r,a){let d="a=setup:"+a+"\r\n";return r.fingerprints.forEach(l=>{d+="a=fingerprint:"+l.algorithm+" "+l.value+"\r\n"}),d},i.parseCryptoLine=function(r){const a=r.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},i.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+("object"==typeof r.keyParams?i.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+"\r\n"},i.parseCryptoKeyParams=function(r){if(0!==r.indexOf("inline:"))return null;const a=r.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},i.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},i.getCryptoParameters=function(r,a){return i.matchPrefix(r+a,"a=crypto:").map(i.parseCryptoLine)},i.getIceParameters=function(r,a){const d=i.matchPrefix(r+a,"a=ice-ufrag:")[0],l=i.matchPrefix(r+a,"a=ice-pwd:")[0];return d&&l?{usernameFragment:d.substring(12),password:l.substring(10)}:null},i.writeIceParameters=function(r){let a="a=ice-ufrag:"+r.usernameFragment+"\r\na=ice-pwd:"+r.password+"\r\n";return r.iceLite&&(a+="a=ice-lite\r\n"),a},i.parseRtpParameters=function(r){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},d=i.splitLines(r)[0].split(" ");a.profile=d[2];for(let h=3;h<d.length;h++){const p=d[h],m=i.matchPrefix(r,"a=rtpmap:"+p+" ")[0];if(m){const _=i.parseRtpMap(m),v=i.matchPrefix(r,"a=fmtp:"+p+" ");switch(_.parameters=v.length?i.parseFmtp(v[0]):{},_.rtcpFeedback=i.matchPrefix(r,"a=rtcp-fb:"+p+" ").map(i.parseRtcpFb),a.codecs.push(_),_.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(_.name.toUpperCase())}}}i.matchPrefix(r,"a=extmap:").forEach(h=>{a.headerExtensions.push(i.parseExtmap(h))});const l=i.matchPrefix(r,"a=rtcp-fb:* ").map(i.parseRtcpFb);return a.codecs.forEach(h=>{l.forEach(p=>{h.rtcpFeedback.find(m=>m.type===p.type&&m.parameter===p.parameter)||h.rtcpFeedback.push(p)})}),a},i.writeRtpDescription=function(r,a){let d="";d+="m="+r+" ",d+=a.codecs.length>0?"9":"0",d+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",d+=a.codecs.map(h=>void 0!==h.preferredPayloadType?h.preferredPayloadType:h.payloadType).join(" ")+"\r\n",d+="c=IN IP4 0.0.0.0\r\n",d+="a=rtcp:9 IN IP4 0.0.0.0\r\n",a.codecs.forEach(h=>{d+=i.writeRtpMap(h),d+=i.writeFmtp(h),d+=i.writeRtcpFb(h)});let l=0;return a.codecs.forEach(h=>{h.maxptime>l&&(l=h.maxptime)}),l>0&&(d+="a=maxptime:"+l+"\r\n"),a.headerExtensions&&a.headerExtensions.forEach(h=>{d+=i.writeExtmap(h)}),d},i.parseRtpEncodingParameters=function(r){const a=[],d=i.parseRtpParameters(r),l=-1!==d.fecMechanisms.indexOf("RED"),h=-1!==d.fecMechanisms.indexOf("ULPFEC"),p=i.matchPrefix(r,"a=ssrc:").map(y=>i.parseSsrcMedia(y)).filter(y=>"cname"===y.attribute),m=p.length>0&&p[0].ssrc;let _;const v=i.matchPrefix(r,"a=ssrc-group:FID").map(y=>y.substring(17).split(" ").map(T=>parseInt(T,10)));v.length>0&&v[0].length>1&&v[0][0]===m&&(_=v[0][1]),d.codecs.forEach(y=>{if("RTX"===y.name.toUpperCase()&&y.parameters.apt){let T={ssrc:m,codecPayloadType:parseInt(y.parameters.apt,10)};m&&_&&(T.rtx={ssrc:_}),a.push(T),l&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:m,mechanism:h?"red+ulpfec":"red"},a.push(T))}}),0===a.length&&m&&a.push({ssrc:m});let b=i.matchPrefix(r,"b=");return b.length&&(b=0===b[0].indexOf("b=TIAS:")?parseInt(b[0].substring(7),10):0===b[0].indexOf("b=AS:")?1e3*parseInt(b[0].substring(5),10)*.95-16e3:void 0,a.forEach(y=>{y.maxBitrate=b})),a},i.parseRtcpParameters=function(r){const a={},d=i.matchPrefix(r,"a=ssrc:").map(p=>i.parseSsrcMedia(p)).filter(p=>"cname"===p.attribute)[0];d&&(a.cname=d.value,a.ssrc=d.ssrc);const l=i.matchPrefix(r,"a=rtcp-rsize");a.reducedSize=l.length>0,a.compound=0===l.length;const h=i.matchPrefix(r,"a=rtcp-mux");return a.mux=h.length>0,a},i.writeRtcpParameters=function(r){let a="";return r.reducedSize&&(a+="a=rtcp-rsize\r\n"),r.mux&&(a+="a=rtcp-mux\r\n"),void 0!==r.ssrc&&r.cname&&(a+="a=ssrc:"+r.ssrc+" cname:"+r.cname+"\r\n"),a},i.parseMsid=function(r){let a;const d=i.matchPrefix(r,"a=msid:");if(1===d.length)return a=d[0].substring(7).split(" "),{stream:a[0],track:a[1]};const l=i.matchPrefix(r,"a=ssrc:").map(h=>i.parseSsrcMedia(h)).filter(h=>"msid"===h.attribute);return l.length>0?(a=l[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},i.parseSctpDescription=function(r){const a=i.parseMLine(r),d=i.matchPrefix(r,"a=max-message-size:");let l;d.length>0&&(l=parseInt(d[0].substring(19),10)),isNaN(l)&&(l=65536);const h=i.matchPrefix(r,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:l};const p=i.matchPrefix(r,"a=sctpmap:");if(p.length>0){const m=p[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:l}}},i.writeSctpDescription=function(r,a){let d=[];return d="DTLS/SCTP"!==r.protocol?["m="+r.kind+" 9 "+r.protocol+" "+a.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+a.port+"\r\n"]:["m="+r.kind+" 9 "+r.protocol+" "+a.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+a.port+" "+a.protocol+" 65535\r\n"],void 0!==a.maxMessageSize&&d.push("a=max-message-size:"+a.maxMessageSize+"\r\n"),d.join("")},i.generateSessionId=function(){return Math.random().toString().substr(2,22)},i.writeSessionBoilerplate=function(r,a,d){let l;const h=void 0!==a?a:2;return l=r||i.generateSessionId(),"v=0\r\no="+(d||"thisisadapterortc")+" "+l+" "+h+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.getDirection=function(r,a){const d=i.splitLines(r);for(let l=0;l<d.length;l++)switch(d[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return d[l].substring(2)}return a?i.getDirection(a):"sendrecv"},i.getKind=function(r){return i.splitLines(r)[0].split(" ")[0].substring(2)},i.isRejected=function(r){return"0"===r.split(" ",2)[1]},i.parseMLine=function(r){const a=i.splitLines(r)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},i.parseOLine=function(r){const a=i.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},i.isValidSDP=function(r){if("string"!=typeof r||0===r.length)return!1;const a=i.splitLines(r);for(let d=0;d<a.length;d++)if(a[d].length<2||"="!==a[d].charAt(1))return!1;return!0},s.exports=i}(vw);var c_=vw.exports,sf=Rt(c_),m3=function Bu(s,i){return i.forEach(function(r){r&&"string"!=typeof r&&!Array.isArray(r)&&Object.keys(r).forEach(function(a){if("default"!==a&&!(a in s)){var d=Object.getOwnPropertyDescriptor(r,a);Object.defineProperty(s,a,d.get?d:{enumerable:!0,get:function(){return r[a]}})}})}),Object.freeze(s)}({__proto__:null,default:sf},[c_]);function vy(s){if(!s.RTCIceCandidate||s.RTCIceCandidate&&"foundation"in s.RTCIceCandidate.prototype)return;const i=s.RTCIceCandidate;s.RTCIceCandidate=function(r){if("object"==typeof r&&r.candidate&&0===r.candidate.indexOf("a=")&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const a=new i(r),d=sf.parseCandidate(r.candidate),l=Object.assign(a,d);return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new i(r)},s.RTCIceCandidate.prototype=i.prototype,Cn(s,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new s.RTCIceCandidate(r.candidate),writable:"false"}),r))}function bw(s){!s.RTCIceCandidate||s.RTCIceCandidate&&"relayProtocol"in s.RTCIceCandidate.prototype||Cn(s,"icecandidate",i=>{if(i.candidate){const r=sf.parseCandidate(i.candidate.candidate);"relay"===r.type&&(i.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return i})}function by(s,i){if(!s.RTCPeerConnection)return;"sctp"in s.RTCPeerConnection.prototype||Object.defineProperty(s.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const h=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===i.browser&&i.version>=76){const{sdpSemantics:p}=this.getConfiguration();"plan-b"===p&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(p){if(!p||!p.sdp)return!1;const m=sf.splitSections(p.sdp);return m.shift(),m.some(_=>{const v=sf.parseMLine(_);return v&&"application"===v.kind&&-1!==v.protocol.indexOf("SCTP")})}(arguments[0])){const p=function(p){const m=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===m||m.length<2)return-1;const _=parseInt(m[1],10);return _!=_?-1:_}(arguments[0]),m=function(p){let m=65536;return"firefox"===i.browser&&(m=i.version<57?-1===p?16384:2147483637:i.version<60?57===i.version?65535:65536:2147483637),m}(p),_=function(p,m){let _=65536;"firefox"===i.browser&&57===i.version&&(_=65535);const v=sf.matchPrefix(p.sdp,"a=max-message-size:");return v.length>0?_=parseInt(v[0].substr(19),10):"firefox"===i.browser&&-1!==m&&(_=2147483637),_}(arguments[0],p);let v;v=0===m&&0===_?Number.POSITIVE_INFINITY:0===m||0===_?Math.max(m,_):Math.min(m,_);const b={};Object.defineProperty(b,"maxMessageSize",{get:()=>v}),this._sctp=b}return h.apply(this,arguments)}}function yy(s){if(!s.RTCPeerConnection||!("createDataChannel"in s.RTCPeerConnection.prototype))return;function i(a,d){const l=a.send;a.send=function(){const h=arguments[0];if("open"===a.readyState&&d.sctp&&(h.length||h.size||h.byteLength)>d.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+d.sctp.maxMessageSize+" bytes)");return l.apply(a,arguments)}}const r=s.RTCPeerConnection.prototype.createDataChannel;s.RTCPeerConnection.prototype.createDataChannel=function(){const a=r.apply(this,arguments);return i(a,this),a},Cn(s,"datachannel",a=>(i(a.channel,a.target),a))}function yw(s){if(!s.RTCPeerConnection||"connectionState"in s.RTCPeerConnection.prototype)return;const i=s.RTCPeerConnection.prototype;Object.defineProperty(i,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(i,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const a=i[r];i[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=d=>{const l=d.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;const h=new Event("connectionstatechange",d);l.dispatchEvent(h)}return d},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function Cw(s,i){if(!s.RTCPeerConnection||"chrome"===i.browser&&i.version>=71||"safari"===i.browser&&i.version>=605)return;const r=s.RTCPeerConnection.prototype.setRemoteDescription;s.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&-1!==a.sdp.indexOf("\na=extmap-allow-mixed")){const d=a.sdp.split("\n").filter(l=>"a=extmap-allow-mixed"!==l.trim()).join("\n");s.RTCSessionDescription&&a instanceof s.RTCSessionDescription?arguments[0]=new s.RTCSessionDescription({type:a.type,sdp:d}):a.sdp=d}return r.apply(this,arguments)}}function Cy(s,i){if(!s.RTCPeerConnection||!s.RTCPeerConnection.prototype)return;const r=s.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(s.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===i.browser&&i.version<78||"firefox"===i.browser&&i.version<68||"safari"===i.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Sy(s,i){if(!s.RTCPeerConnection||!s.RTCPeerConnection.prototype)return;const r=s.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(s.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if("object"!=typeof a||a.type&&a.sdp)return r.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||"offer"!==a.type&&"answer"!==a.type?r.apply(this,[a]):("offer"===a.type?this.createOffer:this.createAnswer).apply(this).then(d=>r.apply(this,[d]))})}var g3=Object.freeze({__proto__:null,removeExtmapAllowMixed:Cw,shimAddIceCandidateNullOrEmpty:Cy,shimConnectionState:yw,shimMaxMessageSize:by,shimParameterlessSetLocalDescription:Sy,shimRTCIceCandidate:vy,shimRTCIceCandidateRelayProtocol:bw,shimSendThrowTypeError:yy});!function({window:s}={},i={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=Ai,a=function(l){const h={browser:null,version:null};if(void 0===l||!l.navigator)return h.browser="Not a browser.",h;const{navigator:p}=l;if(p.mozGetUserMedia)h.browser="firefox",h.version=n_(p.userAgent,/Firefox\/(\d+)\./,1);else if(p.webkitGetUserMedia||!1===l.isSecureContext&&l.webkitRTCPeerConnection)h.browser="chrome",h.version=n_(p.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!l.RTCPeerConnection||!p.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=n_(p.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=l.RTCRtpTransceiver&&"currentDirection"in l.RTCRtpTransceiver.prototype}return h}(s),d={browserDetails:a,commonShim:g3,extractVersion:n_,disableLog:Ne,disableWarnings:et,sdp:m3};switch(a.browser){case"chrome":if(!_y||!xs||!i.shimChrome)return r("Chrome shim is not included in this adapter release."),d;if(null===a.version)return r("Chrome shim can not determine version, not shimming."),d;r("adapter.js shimming chrome."),d.browserShim=_y,Cy(s,a),Sy(s),wa(s,a),Ct(s),xs(s,a),Xu(s),Sl(s,a),gy(s),Cl(s),mi(s),Qu(s,a),vy(s),bw(s),yw(s),by(s,a),yy(s),Cw(s,a);break;case"firefox":if(!Dr||!fc||!i.shimFirefox)return r("Firefox shim is not included in this adapter release."),d;r("adapter.js shimming firefox."),d.browserShim=Dr,Cy(s,a),Sy(s),pc(s,a),fc(s,a),tf(s),Zu(s),gt(s),i_(s),Js(s),nf(s),Tl(s),Di(s),r_(s),vy(s),yw(s),by(s,a),yy(s);break;case"safari":if(!Ey||!i.shimSafari)return r("Safari shim is not included in this adapter release."),d;r("adapter.js shimming safari."),d.browserShim=Ey,Cy(s,a),Sy(s),s_(s),Ew(s),hd(s),Or(s),o_(s),_w(s),rf(s),a_(s),vy(s),bw(s),by(s,a),yy(s),Cw(s,a);break;default:r("Unsupported browser!")}}({window:typeof window>"u"?void 0:window});var Nx={exports:{}},Px=Ns.f;Bt({target:"Object",stat:!0,forced:Object.defineProperty!==Px,sham:!Sa},{defineProperty:Px});var Mx=Os.Object,_3=Nx.exports=function(s,i,r){return Mx.defineProperty(s,i,r)};Mx.defineProperty.sham&&(_3.sham=!0);var E3=Rt(Nx.exports),Il=ac,Ty=Array.isArray||function(s){return"Array"==Il(s)},Iw=TypeError,So=oy,ww=Ns,xx=Hu,Rw=function(s,i,r){var a=So(i);a in s?ww.f(s,a,xx(0,r)):s[a]=r},Aw=nr,d_=ew,kx=Ri(Function.toString);Aw(d_.inspectSource)||(d_.inspectSource=function(s){return kx(s)});var l_=d_.inspectSource,Lx=Ri,Ra=cn,Iy=nr,Dw=dd,Ow=l_,Nw=function(){},v3=[],On=vo("Reflect","construct"),af=/^\s*(?:class|function)\b/,cf=Lx(af.exec),so=!af.exec(Nw),df=function(s){if(!Iy(s))return!1;try{return On(Nw,v3,s),!0}catch{return!1}},eh=function(s){if(!Iy(s))return!1;switch(Dw(s)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return so||!!cf(af,Ow(s))}catch{return!0}};eh.sham=!0;var wl=!On||Ra(function(){var s;return df(df.call)||!df(Object)||!df(function(){s=!0})||s})?eh:df,To=Ty,Fx=wl,wy=ur,Ux=li("species"),Qs=Array,Mw=function(s,i){return new(function(s){var i;return To(s)&&(Fx(i=s.constructor)&&(i===Qs||To(i.prototype))||wy(i)&&null===(i=i[Ux]))&&(i=void 0),void 0===i?Qs:i}(s))(0===i?0:i)},xw=cn,kw=ml,Ry=li("species"),lf=Bt,u_=cn,Ay=Ty,Rl=ur,dt=_l,Lw=Ta,Vx=function(s){if(s>9007199254740991)throw Iw("Maximum allowed index exceeded");return s},Fw=Rw,Bx=Mw,Uw=ml,Al=li("isConcatSpreadable"),Hx=Uw>=51||!u_(function(){var s=[];return s[Al]=!1,s.concat()[0]!==s}),Gx=function(s){if(!Rl(s))return!1;var i=s[Al];return void 0!==i?!!i:Ay(s)};lf({target:"Array",proto:!0,arity:1,forced:!Hx||!function(s){return kw>=51||!xw(function(){var i=[];return(i.constructor={})[Ry]=function(){return{foo:1}},1!==i[s](Boolean).foo})}("concat")},{concat:function(s){var i,r,a,d,l,h=dt(this),p=Bx(h,0),m=0;for(i=-1,a=arguments.length;i<a;i++)if(Gx(l=-1===i?h:arguments[i]))for(d=Lw(l),Vx(m+d),r=0;r<d;r++,m++)r in l&&Fw(p,m,l[r]);else Vx(m+1),Fw(p,m++,l);return p.length=m,p}});var Dy={},h_={},Oy=$t,fe=rd,Kt=Zg.indexOf,Aa=h_,Zs=Ri([].push),Nn=function(s,i){var r,a=fe(s),d=0,l=[];for(r in a)!Oy(Aa,r)&&Oy(a,r)&&Zs(l,r);for(;i.length>d;)Oy(a,r=i[d++])&&(~Kt(l,r)||Zs(l,r));return l},p_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],uf=Nn,Da=p_,hf=Object.keys||function(s){return uf(s,Da)},b3=Ns,Vw=Ps,ao=rd,mc=hf;Dy.f=Sa&&!Vt?Object.defineProperties:function(s,i){Vw(s);for(var r,a=ao(i),d=mc(i),l=d.length,h=0;l>h;)b3.f(s,r=d[h++],a[r]);return s};var pf,ea=vo("document","documentElement"),gc=nt,Bw=gl("keys"),ff=function(s){return Bw[s]||(Bw[s]=gc(s))},zx=Ps,Kx=Dy,f_=p_,Py=h_,jw=ea,My=iw,xy="prototype",m_="script",g_=ff("IE_PROTO"),__=function(){},ky=function(s){return"<script>"+s+"</"+m_+">"},Ly=function(s){s.write(ky("")),s.close();var i=s.parentWindow.Object;return s=null,i},mf=function(){try{pf=new ActiveXObject("htmlfile")}catch{}var s,i;mf=typeof document<"u"?document.domain&&pf?Ly(pf):("javascript:",(i=My("iframe")).style.display="none",jw.appendChild(i),i.src=String("javascript:"),(s=i.contentWindow.document).open(),s.write(ky("document.F=Object")),s.close(),s.F):Ly(pf);for(var a=f_.length;a--;)delete mf[xy][f_[a]];return mf()};Py[g_]=!0;var th=Object.create||function(s,i){var r;return null!==s?(__[xy]=zx(s),r=new __,__[xy]=null,r[g_]=s):r=mf(),void 0===i?r:Kx.f(r,i)},E_={},Hr=Nn,Dl=p_.concat("length","prototype");E_.f=Object.getOwnPropertyNames||function(s){return Hr(s,Dl)};var Zn={},Zo=dw,qx=Ta,_c=Rw,Yx=Array,Hw=Math.max,Fy=function(s,i,r){for(var a=qx(s),d=Zo(i,a),l=Zo(void 0===r?a:r,a),h=Yx(Hw(l-d,0)),p=0;d<l;d++,p++)_c(h,p,s[d]);return h.length=p,h},v_=ac,pd=rd,Gw=E_.f,b_=Fy,gf="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Zn.f=function(s){return gf&&"Window"==v_(s)?function(i){try{return Gw(i)}catch{return b_(gf)}}(s):Gw(pd(s))};var Ol={};Ol.f=Object.getOwnPropertySymbols;var Uy=vl,nh=function(s,i,r,a){return a&&a.enumerable?s[i]=r:Uy(s,i,r),s},Ww=Ns,zw=function(s,i,r){return Ww.f(s,i,r)},ta={};ta.f=li;var y_,Nl,C_,Kw=Os,$x=$t,y3=ta,C3=Ns.f,gi=function(s){var i=Kw.Symbol||(Kw.Symbol={});$x(i,s)||C3(i,s,{value:y3.f(s)})},Ef=wr,Xx=vo,vf=li,Vy=nh,bf=function(){var s=Xx("Symbol"),i=s&&s.prototype,r=i&&i.valueOf,a=vf("toPrimitive");i&&!i[a]&&Vy(i,a,function(d){return Ef(r,this)},{arity:1})},S3=dd,Yw=Jo,Jx=Ns.f,Oa=vl,Qx=$t,S_=Jo?{}.toString:function(){return"[object "+S3(this)+"]"},T_=li("toStringTag"),Pl=function(s,i,r,a){if(s){var d=r?s:s.prototype;Qx(d,T_)||Jx(d,T_,{configurable:!0,value:i}),a&&!Yw&&Oa(d,"toString",S_)}},w_=lr.WeakMap,Zx=nr(w_)&&/native code/.test(String(w_)),$w=ur,Xw=vl,R_=$t,A_=ff,Ml=h_,Jw="Object already initialized",D_=lr.TypeError;if(Zx||ew.state){var co=ew.state||(ew.state=new(0,lr.WeakMap));co.get=co.get,co.has=co.has,co.set=co.set,y_=function(s,i){if(co.has(s))throw D_(Jw);return i.facade=s,co.set(s,i),i},Nl=function(s){return co.get(s)||{}},C_=function(s){return co.has(s)}}else{var na=A_("state");Ml[na]=!0,y_=function(s,i){if(R_(s,na))throw D_(Jw);return i.facade=s,Xw(s,na,i),i},Nl=function(s){return R_(s,na)?s[na]:{}},C_=function(s){return R_(s,na)}}var Oi={set:y_,get:Nl,has:C_,enforce:function(s){return C_(s)?Nl(s):y_(s,{})},getterFor:function(s){return function(i){var r;if(!$w(i)||(r=Nl(i)).type!==s)throw D_("Incompatible receiver, "+s+" required");return r}}},e1=Yu,Yi=Yb,Hy=_l,t1=Ta,Zw=Mw,ih=Ri([].push),es=function(s){var i=1==s,r=2==s,a=3==s,d=4==s,l=6==s,h=7==s,p=5==s||l;return function(m,_,v,b){for(var y,T,M=Hy(m),O=Yi(M),D=e1(_,v),x=t1(O),F=0,j=b||Zw,q=i?j(m,x):r||h?j(m,0):void 0;x>F;F++)if((p||F in O)&&(T=D(y=O[F],F,M),s))if(i)q[F]=T;else if(T)switch(s){case 3:return!0;case 5:return y;case 6:return F;case 2:ih(q,y)}else switch(s){case 4:return!1;case 7:ih(q,y)}return l?-1:a||d?d:q}},rh={forEach:es(0),map:es(1),filter:es(2),some:es(3),every:es(4),find:es(5),findIndex:es(6),filterReject:es(7)},Ec=Bt,O_=lr,yf=wr,oh=Ri,Cf=Sa,sh=sd,T3=cn,Nr=$t,I3=Ds,eR=Ps,Gy=rd,tR=oy,ah=hc,Wy=Hu,Sf=th,$i=hf,n1=E_,ch=Zn,r1=Ol,lo=Wp,xl=Ns,nR=Dy,Tf=qb,If=nh,zy=zw,iR=gl,Ky=h_,o1=nt,ts=li,qy=ta,dh=gi,w3=bf,rR=Pl,oR=Oi,N_=rh.forEach,Io=ff("hidden"),P_="Symbol",wf="prototype",s1=oR.set,M_=oR.getterFor(P_),wo=Object[wf],kl=O_.Symbol,Ll=kl&&kl[wf],a1=O_.TypeError,lh=O_.QObject,sR=lo.f,fd=xl.f,x_=ch.f,k_=Tf.f,Yy=oh([].push),vc=iR("symbols"),Rf=iR("op-symbols"),uh=iR("wks"),Fl=!lh||!lh[wf]||!lh[wf].findChild,$y=Cf&&T3(function(){return 7!=Sf(fd({},"a",{get:function(){return fd(this,"a",{value:7}).a}})).a})?function(s,i,r){var a=sR(wo,i);a&&delete wo[i],fd(s,i,r),a&&s!==wo&&fd(wo,i,a)}:fd,aR=function(s,i){var r=vc[s]=Sf(Ll);return s1(r,{type:P_,tag:s,description:i}),Cf||(r.description=i),r},Af=function(s,i,r){s===wo&&Af(Rf,i,r),eR(s);var a=tR(i);return eR(r),Nr(vc,a)?(r.enumerable?(Nr(s,Io)&&s[Io][a]&&(s[Io][a]=!1),r=Sf(r,{enumerable:Wy(0,!1)})):(Nr(s,Io)||fd(s,Io,Wy(1,{})),s[Io][a]=!0),$y(s,a,r)):fd(s,a,r)},Xy=function(s,i){eR(s);var r=Gy(i),a=$i(r).concat(lR(r));return N_(a,function(d){Cf&&!yf(c1,r,d)||Af(s,d,r[d])}),s},c1=function(s){var i=tR(s),r=yf(k_,this,i);return!(this===wo&&Nr(vc,i)&&!Nr(Rf,i))&&(!(r||!Nr(this,i)||!Nr(vc,i)||Nr(this,Io)&&this[Io][i])||r)},cR=function(s,i){var r=Gy(s),a=tR(i);if(r!==wo||!Nr(vc,a)||Nr(Rf,a)){var d=sR(r,a);return!d||!Nr(vc,a)||Nr(r,Io)&&r[Io][a]||(d.enumerable=!0),d}},dR=function(s){var i=x_(Gy(s)),r=[];return N_(i,function(a){Nr(vc,a)||Nr(Ky,a)||Yy(r,a)}),r},lR=function(s){var i=s===wo,r=x_(i?Rf:Gy(s)),a=[];return N_(r,function(d){!Nr(vc,d)||i&&!Nr(wo,d)||Yy(a,vc[d])}),a};sh||(kl=function(){if(I3(Ll,this))throw a1("Symbol is not a constructor");var s=arguments.length&&void 0!==arguments[0]?ah(arguments[0]):void 0,i=o1(s),r=function(a){this===wo&&yf(r,Rf,a),Nr(this,Io)&&Nr(this[Io],i)&&(this[Io][i]=!1),$y(this,i,Wy(1,a))};return Cf&&Fl&&$y(wo,i,{configurable:!0,set:r}),aR(i,s)},If(Ll=kl[wf],"toString",function(){return M_(this).tag}),If(kl,"withoutSetter",function(s){return aR(o1(s),s)}),Tf.f=c1,xl.f=Af,nR.f=Xy,lo.f=cR,n1.f=ch.f=dR,r1.f=lR,qy.f=function(s){return aR(ts(s),s)},Cf&&zy(Ll,"description",{configurable:!0,get:function(){return M_(this).description}})),Ec({global:!0,constructor:!0,wrap:!0,forced:!sh,sham:!sh},{Symbol:kl}),N_($i(uh),function(s){dh(s)}),Ec({target:P_,stat:!0,forced:!sh},{useSetter:function(){Fl=!0},useSimple:function(){Fl=!1}}),Ec({target:"Object",stat:!0,forced:!sh,sham:!Cf},{create:function(s,i){return void 0===i?Sf(s):Xy(Sf(s),i)},defineProperty:Af,defineProperties:Xy,getOwnPropertyDescriptor:cR}),Ec({target:"Object",stat:!0,forced:!sh},{getOwnPropertyNames:dR}),w3(),rR(kl,P_),Ky[Io]=!0;var md=sd&&!!Symbol.for&&!!Symbol.keyFor,uR=Bt,Jy=vo,L_=$t,Qy=hc,hR=gl,pR=md,F_=hR("string-to-symbol-registry"),U_=hR("symbol-to-string-registry");uR({target:"Symbol",stat:!0,forced:!pR},{for:function(s){var i=Qy(s);if(L_(F_,i))return F_[i];var r=Jy("Symbol")(i);return F_[i]=r,U_[r]=i,r}});var R3=Bt,Zy=$t,d1=Wn,eC=Ku,fR=md,tC=gl("symbol-to-string-registry");R3({target:"Symbol",stat:!0,forced:!fR},{keyFor:function(s){if(!d1(s))throw TypeError(eC(s)+" is not a symbol");if(Zy(tC,s))return tC[s]}});var gd=Ri([].slice),mR=Ty,nC=nr,Df=ac,l1=hc,V_=Ri([].push),B_=Bt,ns=vo,Ul=kg,iC=wr,Of=Ri,gR=cn,rC=nr,Vl=Wn,_R=gd,h1=sd,oC=String,Ro=ns("JSON","stringify"),hh=Of(/./.exec),sC=Of("".charAt),p1=Of("".charCodeAt),f1=Of("".replace),ER=Of(1..toString),m1=/[\uD800-\uDFFF]/g,aC=/^[\uD800-\uDBFF]$/,vR=/^[\uDC00-\uDFFF]$/,bR=!h1||gR(function(){var s=ns("Symbol")();return"[null]"!=Ro([s])||"{}"!=Ro({a:s})||"{}"!=Ro(Object(s))}),g1=gR(function(){return'"\\udf06\\ud834"'!==Ro("\udf06\ud834")||'"\\udead"'!==Ro("\udead")}),yR=function(s,i){var r=_R(arguments),a=function(s){if(nC(s))return s;if(mR(s)){for(var i=s.length,r=[],a=0;a<i;a++){var d=s[a];"string"==typeof d?V_(r,d):"number"!=typeof d&&"Number"!=Df(d)&&"String"!=Df(d)||V_(r,l1(d))}var l=r.length,h=!0;return function(p,m){if(h)return h=!1,m;if(mR(this))return m;for(var _=0;_<l;_++)if(r[_]===p)return m}}}(i);if(rC(a)||void 0!==s&&!Vl(s))return r[1]=function(d,l){if(rC(a)&&(l=iC(a,this,oC(d),l)),!Vl(l))return l},Ul(Ro,null,r)},CR=function(s,i,r){var a=sC(r,i-1),d=sC(r,i+1);return hh(aC,s)&&!hh(vR,d)||hh(vR,s)&&!hh(aC,a)?"\\u"+ER(p1(s,0),16):s};Ro&&B_({target:"JSON",stat:!0,arity:3,forced:bR||g1},{stringify:function(s,i,r){var a=_R(arguments),d=Ul(bR?yR:Ro,null,a);return g1&&"string"==typeof d?f1(d,m1,CR):d}});var pr=Ol,cC=_l;Bt({target:"Object",stat:!0,forced:!sd||cn(function(){pr.f(1)})},{getOwnPropertySymbols:function(s){var i=pr.f;return i?i(cC(s)):[]}}),gi("asyncIterator"),gi("hasInstance"),gi("isConcatSpreadable"),gi("iterator"),gi("match"),gi("matchAll"),gi("replace"),gi("search"),gi("species"),gi("split");var _d=bf;gi("toPrimitive"),_d();var j_=vo,SR=Pl;gi("toStringTag"),SR(j_("Symbol"),"Symbol"),gi("unscopables"),Pl(lr.JSON,"JSON",!0);var ia,TR,IR,dC=Os.Symbol,ph={},Na=Sa,wR=Function.prototype,RR=Na&&Object.getOwnPropertyDescriptor,Pa=$t(wR,"name"),_1={EXISTS:Pa,PROPER:Pa&&"something"===function(){}.name,CONFIGURABLE:Pa&&(!Na||Na&&RR(wR,"name").configurable)},bc=!cn(function(){function s(){}return s.prototype.constructor=null,Object.getPrototypeOf(new s)!==s.prototype}),lC=$t,E1=nr,v1=_l,b1=bc,AR=ff("IE_PROTO"),H_=Object,fh=H_.prototype,uo=b1?H_.getPrototypeOf:function(s){var i=v1(s);if(lC(i,AR))return i[AR];var r=i.constructor;return E1(r)&&i instanceof r?r.prototype:i instanceof H_?fh:null},Ed=cn,uC=nr,DR=ur,vd=th,mh=uo,A3=nh,gh=li("iterator"),hC=!1;[].keys&&("next"in(IR=[].keys())?(TR=mh(mh(IR)))!==Object.prototype&&(ia=TR):hC=!0);var y1=!DR(ia)||Ed(function(){var s={};return ia[gh].call(s)!==s});uC((ia=y1?{}:vd(ia))[gh])||A3(ia,gh,function(){return this});var pC={IteratorPrototype:ia,BUGGY_SAFARI_ITERATORS:hC},D3=pC.IteratorPrototype,OR=th,O3=Hu,C1=Pl,S1=ph,fC=function(){return this},N3=Ri,P3=$o,mC=nr,M3=String,x3=TypeError,L3=Ps,T1=Object.setPrototypeOf||("__proto__"in{}?function(){var s,i=!1,r={};try{(s=function(s,i,r){try{return N3(P3(Object.getOwnPropertyDescriptor(s,i)[r]))}catch{}}(Object.prototype,"__proto__","set"))(r,[]),i=r instanceof Array}catch{}return function(a,d){return L3(a),function(s){if("object"==typeof s||mC(s))return s;throw x3("Can't set "+M3(s)+" as a prototype")}(d),i?s(a,d):a.__proto__=d,a}}():void 0),G_=Bt,W_=wr,PR=uo,Pf=Pl,MR=nh,_C=ph,z_=_1.PROPER,Bl=pC.BUGGY_SAFARI_ITERATORS,Ma=li("iterator"),K_="values",LR="entries",FR=function(){return this},q_=function(s,i,r,a,d,l,h){!function(s,i,r,a){var d=i+" Iterator";s.prototype=OR(D3,{next:O3(+!a,r)}),C1(s,d,!1,!0),S1[d]=fC}(r,i,a);var p,m,_,v=function(x){if(x===d&&O)return O;if(!Bl&&x in T)return T[x];switch(x){case"keys":case K_:case LR:return function(){return new r(this,x)}}return function(){return new r(this)}},b=i+" Iterator",y=!1,T=s.prototype,M=T[Ma]||T["@@iterator"]||d&&T[d],O=!Bl&&M||v(d),D="Array"==i&&T.entries||M;if(D&&(p=PR(D.call(new s)))!==Object.prototype&&p.next&&(Pf(p,b,!0,!0),_C[b]=FR),z_&&d==K_&&M&&M.name!==K_&&(y=!0,O=function(){return W_(M,this)}),d)if(m={values:v(K_),keys:l?O:v("keys"),entries:v(LR)},h)for(_ in m)(Bl||y||!(_ in T))&&MR(T,_,m[_]);else G_({target:i,proto:!0,forced:Bl||y},m);return h&&T[Ma]!==O&&MR(T,Ma,O,{name:d}),_C[i]=O,m},UR=function(s,i){return{value:s,done:i}},I1=rd,VR=ph,w1=q_,BR=UR,ho="Array Iterator",vC=Oi.set,jR=Oi.getterFor(ho);w1(Array,"Array",function(s,i){vC(this,{type:ho,target:I1(s),index:0,kind:i})},function(){var s=jR(this),i=s.target,r=s.kind,a=s.index++;return!i||a>=i.length?(s.target=void 0,BR(void 0,!0)):BR("keys"==r?a:"values"==r?i[a]:[a,i[a]],!1)},"values"),VR.Arguments=VR.Array;var Gr=lr,Mf=dd,HR=vl,yC=ph,GR=li("toStringTag");for(var Y_ in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var WR=Gr[Y_],$_=WR&&WR.prototype;$_&&Mf($_)!==GR&&HR($_,GR,Y_),yC[Y_]=yC.Array}var R1=dC,A1=Ns.f,KR=li("metadata"),X_=Function.prototype;void 0===X_[KR]&&A1(X_,KR,{value:null}),gi("dispose"),gi("metadata");var CC=R1;gi("asyncDispose");var D1=Ri,bd=vo("Symbol"),J_=bd.keyFor,qR=D1(bd.prototype.valueOf),Q_=bd.isRegisteredSymbol||function(s){try{return void 0!==J_(qR(s))}catch{return!1}};Bt({target:"Symbol",stat:!0},{isRegisteredSymbol:Q_});for(var Z_=gl,YR=vo,O1=Ri,$R=Wn,N1=li,eE=YR("Symbol"),XR=eE.isWellKnownSymbol,SC=YR("Object","getOwnPropertyNames"),xf=O1(eE.prototype.valueOf),kf=Z_("wks"),Lf=0,JR=SC(eE),P1=JR.length;Lf<P1;Lf++)try{var tE=JR[Lf];$R(eE[tE])&&N1(tE)}catch{}var TC=function(s){if(XR&&XR(s))return!0;try{for(var i=xf(s),r=0,a=SC(kf),d=a.length;r<d;r++)if(kf[a[r]]==i)return!0}catch{}return!1};Bt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:TC}),gi("matcher"),gi("observable"),Bt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:Q_}),Bt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:TC}),gi("metadataKey"),gi("patternMatch"),gi("replaceAll");var Ls=Rt(CC),nE=Ri,QR=Te,M1=hc,U3=fl,iE=nE("".charAt),ZR=nE("".charCodeAt),eA=nE("".slice),IC=function(s){return function(i,r){var a,d,l=M1(U3(i)),h=QR(r),p=l.length;return h<0||h>=p?s?"":void 0:(a=ZR(l,h))<55296||a>56319||h+1===p||(d=ZR(l,h+1))<56320||d>57343?s?iE(l,h):a:s?eA(l,h,h+2):d-56320+(a-55296<<10)+65536}},tA=(IC(!1),IC(!0)),wC=hc,rE=q_,_h=UR,AC="String Iterator",DC=Oi.set,oE=Oi.getterFor(AC);rE(String,"String",function(s){DC(this,{type:AC,string:wC(s),index:0})},function(){var s,i=oE(this),r=i.string,a=i.index;return a>=r.length?_h(void 0,!0):(s=tA(r,a),i.index+=s.length,_h(s,!1))});var OC=Rt(ta.f("iterator"));function jl(s){return(jl="function"==typeof Ls&&"symbol"==typeof OC?function(i){return typeof i}:function(i){return i&&"function"==typeof Ls&&i.constructor===Ls&&i!==Ls.prototype?"symbol":typeof i})(s)}var sE=Rt(ta.f("toPrimitive"));function S(s,i,r){return(i=function x1(s){var i=function(r,a){if("object"!==jl(r)||null===r)return r;var d=r[sE];if(void 0!==d){var l=d.call(r,"string");if("object"!==jl(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}(s);return"symbol"===jl(i)?i:String(i)}(i))in s?E3(s,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[i]=r,s}var k1=uc("Array").keys,L1=dd,F1=$t,nA=Ds,iA=k1,Eh=Array.prototype,NC={DOMTokenList:!0,NodeList:!0},ir=Rt(function(s){var i=s.keys;return s===Eh||nA(Eh,s)&&i===Eh.keys||F1(NC,L1(s))?iA:i}),rA=Ku,U1=TypeError,V1=Fy,B1=Math.floor,vh=function(s,i){var r=s.length,a=B1(r/2);return r<8?PC(s,i):oA(s,vh(V1(s,0,a),i),vh(V1(s,a),i),i)},PC=function(s,i){for(var r,a,d=s.length,l=1;l<d;){for(a=l,r=s[l];a&&i(s[a-1],r)>0;)s[a]=s[--a];a!==l++&&(s[a]=r)}return s},oA=function(s,i,r,a){for(var d=i.length,l=r.length,h=0,p=0;h<d||p<l;)s[h+p]=h<d&&p<l?a(i[h],r[p])<=0?i[h++]:r[p++]:h<d?i[h++]:r[p++];return s},sA=vh,aA=cn,aE=function(s,i){var r=[][s];return!!r&&aA(function(){r.call(null,i||function(){return 1},1)})},cA=dc.match(/firefox\/(\d+)/i),j1=!!cA&&+cA[1],H1=/MSIE|Trident/.test(dc),dA=dc.match(/AppleWebKit\/(\d+)\./),yd=Bt,bh=Ri,W1=$o,V3=_l,z1=Ta,B3=function(s,i){if(!delete s[i])throw U1("Cannot delete property "+rA(i)+" of "+rA(s))},K1=hc,lA=cn,uA=sA,q1=aE,hA=j1,Y1=H1,pA=ml,cE=!!dA&&+dA[1],Wr=[],yh=bh(Wr.sort),fA=bh(Wr.push),mA=lA(function(){Wr.sort(void 0)}),gA=lA(function(){Wr.sort(null)}),j3=q1("sort"),$1=!lA(function(){if(pA)return pA<70;if(!(hA&&hA>3)){if(Y1)return!0;if(cE)return cE<603;var s,i,r,a,d="";for(s=65;s<76;s++){switch(i=String.fromCharCode(s),s){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(a=0;a<47;a++)Wr.push({k:i+a,v:r})}for(Wr.sort(function(l,h){return h.v-l.v}),a=0;a<Wr.length;a++)i=Wr[a].k.charAt(0),d.charAt(d.length-1)!==i&&(d+=i);return"DGBEFHACIJK"!==d}});yd({target:"Array",proto:!0,forced:mA||!gA||!j3||!$1},{sort:function(s){void 0!==s&&W1(s);var i=V3(this);if($1)return void 0===s?yh(i):yh(i,s);var r,a,d=[],l=z1(i);for(a=0;a<l;a++)a in i&&fA(d,i[a]);for(uA(d,function(h){return function(p,m){return void 0===m?-1:void 0===p?1:void 0!==h?+h(p,m)||0:K1(p)>K1(m)?1:-1}}(s)),r=z1(d),a=0;a<r;)i[a]=d[a++];for(;a<l;)B3(i,a++);return i}});var H3=uc("Array").sort,MC=Ds,xC=H3,_A=Array.prototype,dE=Rt(function(s){var i=s.sort;return s===_A||MC(_A,s)&&i===_A.sort?xC:i}),EA=vo,X1=E_,J1=Ol,Q1=Ps,Z1=Ri([].concat),vA=EA("Reflect","ownKeys")||function(s){var i=X1.f(Q1(s)),r=J1.f;return r?Z1(i,r(s)):i},Ff=$t,ek=vA,kC=Wp,tk=Ns,Ch=ur,nk=vl,bA=Error,LC=Ri("".replace),yA=String(bA("zxcasd").stack),CA=/\n\s*at [^:]*:[^\n]*/,ik=CA.test(yA),rk=Hu,ok=!cn(function(){var s=Error("a");return!("stack"in s)||(Object.defineProperty(s,"stack",rk(1,7)),7!==s.stack)}),SA=vl,W3=ok,Sh=Error.captureStackTrace,FC=ph,z3=li("iterator"),K3=Array.prototype,lE=dd,TA=fi,UC=$b,VC=ph,Th=li("iterator"),uE=function(s){if(!UC(s))return TA(s,Th)||TA(s,"@@iterator")||VC[lE(s)]},BC=wr,Uf=$o,hE=Ps,Ih=Ku,jC=uE,HC=TypeError,pE=wr,sk=Ps,GC=fi,Vf=Yu,ak=wr,IA=Ps,ck=Ku,WC=Ta,zC=Ds,uk=uE,Hl=function(s,i,r){var a,d;sk(s);try{if(!(a=GC(s,"return"))){if("throw"===i)throw r;return r}a=pE(a,s)}catch(l){d=!0,a=l}if("throw"===i)throw r;if(d)throw a;return sk(a),r},wA=TypeError,wh=function(s,i){this.stopped=s,this.result=i},KC=wh.prototype,fE=function(s,i,r){var a,d,l,h,p,m,_,b=!(!r||!r.AS_ENTRIES),y=!(!r||!r.IS_RECORD),T=!(!r||!r.IS_ITERATOR),M=!(!r||!r.INTERRUPTED),O=Vf(i,r&&r.that),D=function(F){return a&&Hl(a,"normal",F),new wh(!0,F)},x=function(F){return b?(IA(F),M?O(F[0],F[1],D):O(F[0],F[1])):M?O(F,D):O(F)};if(y)a=s.iterator;else if(T)a=s;else{if(!(d=uk(s)))throw wA(ck(s)+" is not iterable");if(function(s){return void 0!==s&&(FC.Array===s||K3[z3]===s)}(d)){for(l=0,h=WC(s);h>l;l++)if((p=x(s[l]))&&zC(KC,p))return p;return new wh(!1)}a=function(s,i){var r=arguments.length<2?jC(s):i;if(Uf(r))return hE(BC(r,s));throw HC(Ih(s)+" is not iterable")}(s,d)}for(m=y?s.next:a.next;!(_=ak(m,a)).done;){try{p=x(_.value)}catch(F){Hl(a,"throw",F)}if("object"==typeof p&&p&&zC(KC,p))return p}return new wh(!1)},q3=hc,Bf=Bt,hk=Ds,mE=uo,Rh=T1,qC=th,jf=vl,Ah=Hu,RA=function(s,i,r,a){W3&&(Sh?Sh(s,i):SA(s,"stack",function(s,i){if(ik&&"string"==typeof s&&!bA.prepareStackTrace)for(;i--;)s=LC(s,CA,"");return s}(r,a)))},mk=fE,Y3=li("toStringTag"),gE=Error,Dh=[].push,Oh=function(s,i){var r,a=hk(Cd,this);Rh?r=Rh(gE(),a?mE(this):Cd):(r=a?this:qC(Cd),jf(r,Y3,"Error")),void 0!==i&&jf(r,"message",function(s,i){return void 0===s?arguments.length<2?"":i:q3(s)}(i)),RA(r,Oh,r.stack,1),arguments.length>2&&function(s,i){Ch(i)&&"cause"in i&&nk(s,"cause",i.cause)}(r,arguments[2]);var d=[];return mk(s,Dh,{that:d}),jf(r,"errors",d),r};Rh?Rh(Oh,gE):function(s,i,r){for(var a=ek(i),d=tk.f,l=kC.f,h=0;h<a.length;h++){var p=a[h];Ff(s,p)||r&&Ff(r,p)||d(s,p,l(i,p))}}(Oh,gE,{name:!0});var Cd=Oh.prototype=qC(gE.prototype,{constructor:Ah(1,Oh),message:Ah(1,""),name:Ah(1,"AggregateError")});Bf({global:!0,constructor:!0,arity:2},{AggregateError:Oh});var tn,Nh,_E,Fs,Hf=typeof process<"u"&&"process"==ac(process),gk=vo,YC=zw,_k=Sa,Ek=li("species"),$3=Ds,vk=TypeError,DA=wl,X3=Ku,EE=TypeError,OA=Ps,$C=$b,NA=li("species"),PA=function(s,i){var r,a=OA(s).constructor;return void 0===a||$C(r=OA(a)[NA])?i:function(s){if(DA(s))return s;throw EE(X3(s)+" is not a constructor")}(r)},yk=TypeError,MA=/(?:ipad|iphone|ipod).*applewebkit/i.test(dc),is=lr,xA=kg,kA=Yu,XC=nr,Ck=$t,LA=cn,JC=ea,QC=gd,Sk=iw,vE=MA,Tk=Hf,Gl=is.setImmediate,bE=is.clearImmediate,UA=is.process,ZC=is.Dispatch,Ik=is.Function,VA=is.MessageChannel,wk=is.String,eS=0,Gf={},tS="onreadystatechange";LA(function(){tn=is.location});var yE=function(s){if(Ck(Gf,s)){var i=Gf[s];delete Gf[s],i()}},CE=function(s){return function(){yE(s)}},nS=function(s){yE(s.data)},Rk=function(s){is.postMessage(wk(s),tn.protocol+"//"+tn.host)};Gl&&bE||(Gl=function(s){!function(s,i){if(s<i)throw yk("Not enough arguments")}(arguments.length,1);var i=XC(s)?s:Ik(s),r=QC(arguments,1);return Gf[++eS]=function(){xA(i,void 0,r)},Nh(eS),eS},bE=function(s){delete Gf[s]},Tk?Nh=function(s){UA.nextTick(CE(s))}:ZC&&ZC.now?Nh=function(s){ZC.now(CE(s))}:VA&&!vE?(Fs=(_E=new VA).port2,_E.port1.onmessage=nS,Nh=kA(Fs.postMessage,Fs)):is.addEventListener&&XC(is.postMessage)&&!is.importScripts&&tn&&"file:"!==tn.protocol&&!LA(Rk)?(Nh=Rk,is.addEventListener("message",nS,!1)):Nh=tS in Sk("script")?function(s){JC.appendChild(Sk("script"))[tS]=function(){JC.removeChild(this),yE(s)}}:function(s){setTimeout(CE(s),0)});var SE={set:Gl,clear:bE},xa=function(){this.head=null,this.tail=null};xa.prototype={add:function(s){var i={item:s,next:null},r=this.tail;r?r.next=i:this.head=i,this.tail=i},get:function(){var s=this.head;if(s)return null===(this.head=s.next)&&(this.tail=null),s.item}};var Wl,Ph,TE,IE,BA,jA=xa,Ak=/ipad|iphone|ipod/i.test(dc)&&typeof Pebble<"u",Dk=/web0s(?!.*chrome)/i.test(dc),Sd=lr,Ok=Yu,HA=SE.set,J3=jA,GA=MA,WA=Ak,Q3=Dk,_t=Hf,Qe=Sd.MutationObserver||Sd.WebKitMutationObserver,iS=Sd.document,ae=Sd.process,Mh=Sd.Promise,rS=(0,Wp.f)(Sd,"queueMicrotask"),oS=rS&&rS.value;if(!oS){var zl=new J3,yc=function(){var s,i;for(_t&&(s=ae.domain)&&s.exit();i=zl.get();)try{i()}catch(r){throw zl.head&&Wl(),r}s&&s.enter()};GA||_t||Q3||!Qe||!iS?!WA&&Mh&&Mh.resolve?((IE=Mh.resolve(void 0)).constructor=Mh,BA=Ok(IE.then,IE),Wl=function(){BA(yc)}):_t?Wl=function(){ae.nextTick(yc)}:(HA=Ok(HA,Sd),Wl=function(){HA(yc)}):(Ph=!0,TE=iS.createTextNode(""),new Qe(yc).observe(TE,{characterData:!0}),Wl=function(){TE.data=Ph=!Ph}),oS=function(s){zl.head||Wl(),zl.add(s)}}var sS=oS,ka=function(s){try{return{error:!1,value:s()}}catch(i){return{error:!0,value:i}}},Td=lr.Promise,wE="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,aS=!wE&&!Hf&&"object"==typeof window&&"object"==typeof document,cS=lr,xh=Td,dS=nr,Pk=ow,Mk=l_,zA=aS,kk=wE,lS=ml,KA=xh&&xh.prototype,Lk=li("species"),uS=!1,hS=dS(cS.PromiseRejectionEvent),Wf={CONSTRUCTOR:Pk("Promise",function(){var s=Mk(xh),i=s!==String(xh);if(!i&&66===lS||!KA.catch||!KA.finally)return!0;if(!lS||lS<51||!/native code/.test(s)){var r=new xh(function(d){d(1)}),a=function(d){d(function(){},function(){})};if((r.constructor={})[Lk]=a,!(uS=r.then(function(){})instanceof a))return!0}return!i&&(zA||kk)&&!hS}),REJECTION_EVENT:hS,SUBCLASSING:uS},Ni={},qA=$o,Uk=TypeError,Z3=function(s){var i,r;this.promise=new s(function(a,d){if(void 0!==i||void 0!==r)throw Uk("Bad Promise constructor");i=a,r=d}),this.resolve=qA(i),this.reject=qA(r)};Ni.f=function(s){return new Z3(s)};var zf,pS,Vk=Bt,RE=Hf,Id=lr,kh=wr,Bk=nh,jk=Pl,Hk=$o,mS=nr,Gk=ur,zk=PA,ra=SE.set,Kf=sS,qk=ka,YA=jA,gS=Oi,Lh=Td,Yk=Ni,qf="Promise",_S=Wf.CONSTRUCTOR,$A=Wf.REJECTION_EVENT,Fh=gS.getterFor(qf),ES=gS.set,Yf=Lh,$f=Lh&&Lh.prototype,XA=Id.TypeError,JA=Id.document,vS=Id.process,bS=Yk.f,QA=bS,$k=!!(JA&&JA.createEvent&&Id.dispatchEvent),ZA="unhandledrejection",yS=function(s){var i;return!(!Gk(s)||!mS(i=s.then))&&i},DE=function(s,i){var r,a,d,l=i.value,h=1==i.state,p=h?s.ok:s.fail,m=s.resolve,_=s.reject,v=s.domain;try{p?(h||(2===i.rejection&&Xk(i),i.rejection=1),!0===p?r=l:(v&&v.enter(),r=p(l),v&&(v.exit(),d=!0)),r===s.promise?_(XA("Promise-chain cycle")):(a=yS(r))?kh(a,r,m,_):m(r)):_(l)}catch(b){v&&!d&&v.exit(),_(b)}},CS=function(s,i){s.notified||(s.notified=!0,Kf(function(){for(var r,a=s.reactions;r=a.get();)DE(r,s);s.notified=!1,i&&!s.rejection&&Xf(s)}))},Uh=function(s,i,r){var a,d;$k?((a=JA.createEvent("Event")).promise=i,a.reason=r,a.initEvent(s,!1,!0),Id.dispatchEvent(a)):a={promise:i,reason:r},!$A&&(d=Id["on"+s])?d(a):s===ZA&&function(s,i){try{1==arguments.length?console.error(s):console.error(s,i)}catch{}}("Unhandled promise rejection",r)},Xf=function(s){kh(ra,Id,function(){var i,r=s.facade,a=s.value;if(Us(s)&&(i=qk(function(){RE?vS.emit("unhandledRejection",a,r):Uh(ZA,r,a)}),s.rejection=RE||Us(s)?2:1,i.error))throw i.value})},Us=function(s){return 1!==s.rejection&&!s.parent},Xk=function(s){kh(ra,Id,function(){var i=s.facade;RE?vS.emit("rejectionHandled",i):Uh("rejectionhandled",i,s.value)})},Vh=function(s,i,r){return function(a){s(i,a,r)}},Bh=function(s,i,r){s.done||(s.done=!0,r&&(s=r),s.value=i,s.state=2,CS(s,!0))},SS=function(s,i,r){if(!s.done){s.done=!0,r&&(s=r);try{if(s.facade===i)throw XA("Promise can't be resolved itself");var a=yS(i);a?Kf(function(){var d={done:!1};try{kh(a,i,Vh(SS,d,s),Vh(Bh,d,s))}catch(l){Bh(d,l,s)}}):(s.value=i,s.state=1,CS(s,!1))}catch(d){Bh({done:!1},d,s)}}};_S&&($f=(Yf=function(s){(function(s,i){if($3(i,s))return s;throw vk("Incorrect invocation")})(this,$f),Hk(s),kh(zf,this);var i=Fh(this);try{s(Vh(SS,i),Vh(Bh,i))}catch(r){Bh(i,r)}}).prototype,(zf=function(s){ES(this,{type:qf,done:!1,notified:!1,parent:!1,reactions:new YA,rejection:!1,state:0,value:void 0})}).prototype=Bk($f,"then",function(s,i){var r=Fh(this),a=bS(zk(this,Yf));return r.parent=!0,a.ok=!mS(s)||s,a.fail=mS(i)&&i,a.domain=RE?vS.domain:void 0,0==r.state?r.reactions.add(a):Kf(function(){DE(a,r)}),a.promise}),pS=function(){var s=new zf,i=Fh(s);this.promise=s,this.resolve=Vh(SS,i),this.reject=Vh(Bh,i)},Yk.f=bS=function(s){return s===Yf||void 0===s?new pS(s):QA(s)}),Vk({global:!0,constructor:!0,wrap:!0,forced:_S},{Promise:Yf}),jk(Yf,qf,!1,!0),function(s){var i=gk(s);_k&&i&&!i[Ek]&&YC(i,Ek,{configurable:!0,get:function(){return this}})}(qf);var Jk=li("iterator"),Qk=!1;try{var OE=0,eD={next:function(){return{done:!!OE++}},return:function(){Qk=!0}};eD[Jk]=function(){return this},Array.from(eD,function(){throw 2})}catch{}var Zk=Td,NE=Wf.CONSTRUCTOR||!function(s,i){if(!i&&!Qk)return!1;var r=!1;try{var a={};a[Jk]=function(){return{next:function(){return{done:r=!0}}}},s(a)}catch{}return r}(function(s){Zk.all(s).then(void 0,function(){})}),eL=wr,tL=$o,nL=Ni,iL=ka,tD=fE;Bt({target:"Promise",stat:!0,forced:NE},{all:function(s){var i=this,r=nL.f(i),a=r.resolve,d=r.reject,l=iL(function(){var h=tL(i.resolve),p=[],m=0,_=1;tD(s,function(v){var b=m++,y=!1;_++,eL(h,i,v).then(function(T){y||(y=!0,p[b]=T,--_||a(p))},d)}),--_||a(p)});return l.error&&d(l.value),r.promise}}),Bt({target:"Promise",proto:!0,forced:Wf.CONSTRUCTOR,real:!0},{catch:function(s){return this.then(void 0,s)}});var TS=wr,pn=$o,nD=Ni,oL=ka,tB=fE;Bt({target:"Promise",stat:!0,forced:NE},{race:function(s){var i=this,r=nD.f(i),a=r.reject,d=oL(function(){var l=pn(i.resolve);tB(s,function(h){TS(l,i,h).then(r.resolve,a)})});return d.error&&a(d.value),r.promise}});var it=wr,sL=Ni;Bt({target:"Promise",stat:!0,forced:Wf.CONSTRUCTOR},{reject:function(s){var i=sL.f(this);return it(i.reject,void 0,s),i.promise}});var IS=Ps,aL=ur,cL=Ni,PE=function(s,i){if(IS(s),aL(i)&&i.constructor===s)return i;var r=cL.f(s);return(0,r.resolve)(i),r.promise},iD=Bt,rD=Td,oD=Wf.CONSTRUCTOR,dL=PE,lL=vo("Promise"),ql=!oD;iD({target:"Promise",stat:!0,forced:!0},{resolve:function(s){return dL(ql&&this===lL?rD:this,s)}});var sD=wr,aD=$o,uL=Ni,cD=ka,dD=fE;Bt({target:"Promise",stat:!0,forced:NE},{allSettled:function(s){var i=this,r=uL.f(i),a=r.resolve,d=r.reject,l=cD(function(){var h=aD(i.resolve),p=[],m=0,_=1;dD(s,function(v){var b=m++,y=!1;_++,sD(h,i,v).then(function(T){y||(y=!0,p[b]={status:"fulfilled",value:T},--_||a(p))},function(T){y||(y=!0,p[b]={status:"rejected",reason:T},--_||a(p))})}),--_||a(p)});return l.error&&d(l.value),r.promise}});var lD=wr,Jf=$o,hL=vo,pL=Ni,wS=ka,fL=fE,Qf="No one promise resolved";Bt({target:"Promise",stat:!0,forced:NE},{any:function(s){var i=this,r=hL("AggregateError"),a=pL.f(i),d=a.resolve,l=a.reject,h=wS(function(){var p=Jf(i.resolve),m=[],_=0,v=1,b=!1;fL(s,function(y){var T=_++,M=!1;v++,lD(p,i,y).then(function(O){M||b||(b=!0,d(O))},function(O){M||b||(M=!0,m[T]=O,--v||l(new r(m,Qf)))})}),--v||l(new r(m,Qf))});return h.error&&l(h.value),a.promise}});var gL=vo,Zf=nr,_L=PA,hD=PE,EL=Td&&Td.prototype;Bt({target:"Promise",proto:!0,real:!0,forced:!!Td&&cn(function(){EL.finally.call({then:function(){}},function(){})})},{finally:function(s){var i=_L(this,gL("Promise")),r=Zf(s);return this.then(r?function(a){return hD(i,s()).then(function(){return a})}:s,r?function(a){return hD(i,s()).then(function(){throw a})}:s)}});var pD=Os.Promise,X=Rt(pD);const vL=()=>{};function em(){const s={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:vL};return s.promise=new X((i,r)=>{s.resolve=a=>{s.isFinished||(s.isResolved=!0,s.isFinished=!0,i(a),s.value=a)},s.reject=a=>{s.isFinished||(s.isRejected=!0,s.isFinished=!0,r(a))}}),s}const xE=new Map,tm=new Map,Nt=new Map;var ei,Et,s;(s=ei||(ei={})).WIN_10="Windows 10",s.WIN_81="Windows 8.1",s.WIN_8="Windows 8",s.WIN_7="Windows 7",s.WIN_VISTA="Windows Vista",s.WIN_SERVER_2003="Windows Server 2003",s.WIN_XP="Windows XP",s.WIN_2000="Windows 2000",s.ANDROID="Android",s.HARMONY_OS="HarmonyOS",s.OPEN_BSD="Open BSD",s.SUN_OS="Sun OS",s.LINUX="Linux",s.IOS="iOS",s.MAC_OS="Mac OS",s.CHROMIUM_OS="Chromium OS",s.QNX="QNX",s.UNIX="UNIX",s.BEOS="BeOS",s.OS_2="OS/2",s.SEARCH_BOT="Search Bot",function(s){s.CHROME="Chrome",s.SAFARI="Safari",s.EDGE="Edge",s.FIREFOX="Firefox",s.OPERA="OPR",s.QQ="QQBrowser",s.WECHAT="MicroMessenger"}(Et||(Et={}));var jh={exports:{}};!function(s,i){!function(r,a){var d="function",l="undefined",h="object",p="string",m="major",_="model",v="name",b="type",y="vendor",T="version",M="architecture",O="console",D="mobile",x="tablet",F="smarttv",j="wearable",q="embedded",te="Amazon",K="Apple",Q="ASUS",$="BlackBerry",z="Browser",_e="Chrome",me="Firefox",Fe="Google",Zt="Microsoft",Fi="Motorola",ie="Opera",ue="Samsung",ke="Sony",ht="Xiaomi",pe="Zebra",w="Facebook",U="Chromium OS",H="Mac OS",se=function(hn){for(var vn={},zt=0;zt<hn.length;zt++)vn[hn[zt].toUpperCase()]=hn[zt];return vn},Ue=function(hn,vn){return typeof hn===p&&-1!==Wt(vn).indexOf(Wt(hn))},Wt=function(hn){return hn.toLowerCase()},tr=function(hn,vn){if(typeof hn===p)return hn=hn.replace(/^\s\s*/,""),typeof vn===l?hn:hn.substring(0,350)},Go=function(hn,vn){for(var zt,_o,ec,Rn,at,Fr,Jc=0;Jc<vn.length&&!at;){var ws=vn[Jc],eI=vn[Jc+1];for(zt=_o=0;zt<ws.length&&!at&&ws[zt];)if(at=ws[zt++].exec(hn))for(ec=0;ec<eI.length;ec++)Fr=at[++_o],typeof(Rn=eI[ec])===h&&Rn.length>0?2===Rn.length?this[Rn[0]]=typeof Rn[1]==d?Rn[1].call(this,Fr):Rn[1]:3===Rn.length?this[Rn[0]]=typeof Rn[1]!==d||Rn[1].exec&&Rn[1].test?Fr?Fr.replace(Rn[1],Rn[2]):a:Fr?Rn[1].call(this,Fr,Rn[2]):a:4===Rn.length&&(this[Rn[0]]=Fr?Rn[3].call(this,Fr.replace(Rn[1],Rn[2])):a):this[Rn]=Fr||a;Jc+=2}},ol=function(hn,vn){for(var zt in vn)if(typeof vn[zt]===h&&vn[zt].length>0){for(var _o=0;_o<vn[zt].length;_o++)if(Ue(vn[zt][_o],hn))return"?"===zt?a:zt}else if(Ue(vn[zt],hn))return"?"===zt?a:zt;return hn},Q0={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Z0={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[T,[v,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[T,[v,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[v,T],[/opios[\/ ]+([\w\.]+)/i],[T,[v,ie+" Mini"]],[/\bopr\/([\w\.]+)/i],[T,[v,ie]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[v,T],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[T,[v,"UC"+z]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[T,[v,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[T,[v,"WeChat"]],[/konqueror\/([\w\.]+)/i],[T,[v,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[T,[v,"IE"]],[/yabrowser\/([\w\.]+)/i],[T,[v,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[v,/(.+)/,"$1 Secure "+z],T],[/\bfocus\/([\w\.]+)/i],[T,[v,me+" Focus"]],[/\bopt\/([\w\.]+)/i],[T,[v,ie+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[T,[v,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[T,[v,"Dolphin"]],[/coast\/([\w\.]+)/i],[T,[v,ie+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[T,[v,"MIUI "+z]],[/fxios\/([-\w\.]+)/i],[T,[v,me]],[/\bqihu|(qi?ho?o?|360)browser/i],[[v,"360 "+z]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[v,/(.+)/,"$1 "+z],T],[/(comodo_dragon)\/([\w\.]+)/i],[[v,/_/g," "],T],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[v,T],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[v],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[v,w],T],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[v,T],[/\bgsa\/([\w\.]+) .*safari\//i],[T,[v,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[T,[v,_e+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[v,_e+" WebView"],T],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[T,[v,"Android "+z]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[v,T],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[T,[v,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[T,v],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[v,[T,ol,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[v,T],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[v,"Netscape"],T],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[T,[v,me+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[v,T],[/(cobalt)\/([\w\.]+)/i],[v,[T,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[M,"amd64"]],[/(ia32(?=;))/i],[[M,Wt]],[/((?:i[346]|x)86)[;\)]/i],[[M,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[M,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[M,"armhf"]],[/windows (ce|mobile); ppc;/i],[[M,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[M,/ower/,"",Wt]],[/(sun4\w)[;\)]/i],[[M,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[M,Wt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[_,[y,ue],[b,x]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[_,[y,ue],[b,D]],[/\((ip(?:hone|od)[\w ]*);/i],[_,[y,K],[b,D]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[_,[y,K],[b,x]],[/(macintosh);/i],[_,[y,K]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[_,[y,"Sharp"],[b,D]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[_,[y,"Huawei"],[b,x]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[_,[y,"Huawei"],[b,D]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[_,/_/g," "],[y,ht],[b,D]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[_,/_/g," "],[y,ht],[b,x]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[_,[y,"OPPO"],[b,D]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[_,[y,"Vivo"],[b,D]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[_,[y,"Realme"],[b,D]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[_,[y,Fi],[b,D]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[_,[y,Fi],[b,x]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[_,[y,"LG"],[b,x]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[_,[y,"LG"],[b,D]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[_,[y,"Lenovo"],[b,x]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[_,/_/g," "],[y,"Nokia"],[b,D]],[/(pixel c)\b/i],[_,[y,Fe],[b,x]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[_,[y,Fe],[b,D]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[_,[y,ke],[b,D]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[_,"Xperia Tablet"],[y,ke],[b,x]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[_,[y,"OnePlus"],[b,D]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[_,[y,te],[b,x]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[_,/(.+)/g,"Fire Phone $1"],[y,te],[b,D]],[/(playbook);[-\w\),; ]+(rim)/i],[_,y,[b,x]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[_,[y,$],[b,D]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[_,[y,Q],[b,x]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[_,[y,Q],[b,D]],[/(nexus 9)/i],[_,[y,"HTC"],[b,x]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[y,[_,/_/g," "],[b,D]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[_,[y,"Acer"],[b,x]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[_,[y,"Meizu"],[b,D]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[y,_,[b,D]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[y,_,[b,x]],[/(surface duo)/i],[_,[y,Zt],[b,x]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[_,[y,"Fairphone"],[b,D]],[/(u304aa)/i],[_,[y,"AT&T"],[b,D]],[/\bsie-(\w*)/i],[_,[y,"Siemens"],[b,D]],[/\b(rct\w+) b/i],[_,[y,"RCA"],[b,x]],[/\b(venue[\d ]{2,7}) b/i],[_,[y,"Dell"],[b,x]],[/\b(q(?:mv|ta)\w+) b/i],[_,[y,"Verizon"],[b,x]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[_,[y,"Barnes & Noble"],[b,x]],[/\b(tm\d{3}\w+) b/i],[_,[y,"NuVision"],[b,x]],[/\b(k88) b/i],[_,[y,"ZTE"],[b,x]],[/\b(nx\d{3}j) b/i],[_,[y,"ZTE"],[b,D]],[/\b(gen\d{3}) b.+49h/i],[_,[y,"Swiss"],[b,D]],[/\b(zur\d{3}) b/i],[_,[y,"Swiss"],[b,x]],[/\b((zeki)?tb.*\b) b/i],[_,[y,"Zeki"],[b,x]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[y,"Dragon Touch"],_,[b,x]],[/\b(ns-?\w{0,9}) b/i],[_,[y,"Insignia"],[b,x]],[/\b((nxa|next)-?\w{0,9}) b/i],[_,[y,"NextBook"],[b,x]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[y,"Voice"],_,[b,D]],[/\b(lvtel\-)?(v1[12]) b/i],[[y,"LvTel"],_,[b,D]],[/\b(ph-1) /i],[_,[y,"Essential"],[b,D]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[_,[y,"Envizen"],[b,x]],[/\b(trio[-\w\. ]+) b/i],[_,[y,"MachSpeed"],[b,x]],[/\btu_(1491) b/i],[_,[y,"Rotor"],[b,x]],[/(shield[\w ]+) b/i],[_,[y,"Nvidia"],[b,x]],[/(sprint) (\w+)/i],[y,_,[b,D]],[/(kin\.[onetw]{3})/i],[[_,/\./g," "],[y,Zt],[b,D]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[_,[y,pe],[b,x]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[_,[y,pe],[b,D]],[/smart-tv.+(samsung)/i],[y,[b,F]],[/hbbtv.+maple;(\d+)/i],[[_,/^/,"SmartTV"],[y,ue],[b,F]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[y,"LG"],[b,F]],[/(apple) ?tv/i],[y,[_,K+" TV"],[b,F]],[/crkey/i],[[_,_e+"cast"],[y,Fe],[b,F]],[/droid.+aft(\w)( bui|\))/i],[_,[y,te],[b,F]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[_,[y,"Sharp"],[b,F]],[/(bravia[\w ]+)( bui|\))/i],[_,[y,ke],[b,F]],[/(mitv-\w{5}) bui/i],[_,[y,ht],[b,F]],[/Hbbtv.*(technisat) (.*);/i],[y,_,[b,F]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[y,tr],[_,tr],[b,F]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[b,F]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[y,_,[b,O]],[/droid.+; (shield) bui/i],[_,[y,"Nvidia"],[b,O]],[/(playstation [345portablevi]+)/i],[_,[y,ke],[b,O]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[_,[y,Zt],[b,O]],[/((pebble))app/i],[y,_,[b,j]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[_,[y,K],[b,j]],[/droid.+; (glass) \d/i],[_,[y,Fe],[b,j]],[/droid.+; (wt63?0{2,3})\)/i],[_,[y,pe],[b,j]],[/(quest( 2| pro)?)/i],[_,[y,w],[b,j]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[y,[b,q]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[_,[b,D]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[_,[b,x]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[b,x]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[b,D]],[/(android[-\w\. ]{0,9});.+buil/i],[_,[y,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[T,[v,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[T,[v,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[v,T],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[T,v]],os:[[/microsoft (windows) (vista|xp)/i],[v,T],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[v,[T,ol,Q0]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[v,"Windows"],[T,ol,Q0]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[T,/_/g,"."],[v,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[v,H],[T,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[T,v],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[v,T],[/\(bb(10);/i],[T,[v,$]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[T,[v,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[T,[v,me+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[T,[v,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[T,[v,"watchOS"]],[/crkey\/([\d\.]+)/i],[T,[v,_e+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[v,U],T],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[v,T],[/(sunos) ?([\w\.\d]*)/i],[[v,"Solaris"],T],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[v,T]]},eo=function(hn,vn){if(typeof hn===h&&(vn=hn,hn=a),!(this instanceof eo))return new eo(hn,vn).getResult();var zt=typeof r!==l&&r.navigator?r.navigator:a,_o=hn||(zt&&zt.userAgent?zt.userAgent:""),ec=zt&&zt.userAgentData?zt.userAgentData:a,Rn=vn?function(at,Fr){var Jc={};for(var ws in at)Jc[ws]=Fr[ws]&&Fr[ws].length%2==0?Fr[ws].concat(at[ws]):at[ws];return Jc}(Z0,vn):Z0;return this.getBrowser=function(){var Fr,at={};return at[v]=a,at[T]=a,Go.call(at,_o,Rn.browser),at[m]=typeof(Fr=at[T])===p?Fr.replace(/[^\d\.]/g,"").split(".")[0]:a,zt&&zt.brave&&typeof zt.brave.isBrave==d&&(at[v]="Brave"),at},this.getCPU=function(){var at={};return at[M]=a,Go.call(at,_o,Rn.cpu),at},this.getDevice=function(){var at={};return at[y]=a,at[_]=a,at[b]=a,Go.call(at,_o,Rn.device),!at[b]&&ec&&ec.mobile&&(at[b]=D),"Macintosh"==at[_]&&zt&&typeof zt.standalone!==l&&zt.maxTouchPoints&&zt.maxTouchPoints>2&&(at[_]="iPad",at[b]=x),at},this.getEngine=function(){var at={};return at[v]=a,at[T]=a,Go.call(at,_o,Rn.engine),at},this.getOS=function(){var at={};return at[v]=a,at[T]=a,Go.call(at,_o,Rn.os),!at[v]&&ec&&"Unknown"!=ec.platform&&(at[v]=ec.platform.replace(/chrome os/i,U).replace(/macos/i,H)),at},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return _o},this.setUA=function(at){return _o=typeof at===p&&at.length>350?tr(at,350):at,this},this.setUA(_o),this};eo.VERSION="0.7.34",eo.BROWSER=se([v,T,m]),eo.CPU=se([M]),eo.DEVICE=se([_,y,b,O,D,F,x,j,q]),eo.ENGINE=eo.OS=se([v,T]),s.exports&&(i=s.exports=eo),i.UAParser=eo;var Mu=typeof r!==l&&(r.jQuery||r.Zepto);if(Mu&&!Mu.ua){var xp=new eo;Mu.ua=xp.getResult(),Mu.ua.get=function(){return xp.getUA()},Mu.ua.set=function(hn){xp.setUA(hn);var vn=xp.getResult();for(var zt in vn)Mu.ua[zt]=vn[zt]}}}("object"==typeof window?window:Ys)}(jh,jh.exports);const RS=new(Rt(jh.exports));let Sc=RS.getResult(),AS=null;function lt(s){if(!AS){s&&RS.setUA(s),Sc=RS.getResult();const i=function(l){if("Blink"===l.engine.name&&"WeChat"!==l.browser.name)return Et.CHROME;switch(l.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Et.CHROME;case"Safari":case"Mobile Safari":return Et.SAFARI;case"Edge":return Et.EDGE;case"Firefox":return Et.FIREFOX;case"QQBrowser":return Et.QQ;case"Opera":return Et.OPERA;case"WeChat":return Et.WECHAT;default:return l.browser.name||""}}(Sc),r=function(l){let h;return h="Blink"===l.engine.name?l.engine.version||"":l.browser.version||"",h.split(".")[0]}(Sc),a="Windows"===(l=Sc).os.name?l.os.version?l.os.name+" "+l.os.version:l.os.name:l.os.name||"",d=Sc.os.version;if(!(i&&r&&a&&d))return{name:i,version:r,os:a,osVersion:d};AS={name:i,version:r,os:a,osVersion:d}}var l;return AS}function kE(){return lt().os}function fD(){const s=lt();return"".concat(s.os," ").concat(s.osVersion)}function LE(){const s=lt();return!!("WebKit"===Sc.engine.name&&s.os===ei.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&s.name!==Et.SAFARI||Pi()&&s.name!==Et.SAFARI)}function nm(){return lt().name===Et.CHROME}function fr(){return lt().name===Et.SAFARI}function Pt(){return lt().name===Et.FIREFOX}function Pi(){return lt().os===ei.IOS}function im(s){const i=lt();return!(i.name!==Et.CHROME||!i.osVersion)&&Number(i.version)>=s}function _D(s){const i=lt();return!(i.name!==Et.EDGE||!i.osVersion)&&Number(i.version)>=s}function bL(s){const i=lt();return!(i.name!==Et.OPERA||!i.osVersion)&&Number(i.version)>=s}function yL(){const s=lt();return!(s.name!==Et.CHROME||!s.osVersion)&&Number(s.version)<=90}function ED(){const s=lt();if(s.os!==ei.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return Number(i[0])<14||14===Number(i[0])&&Number(i[1])<=6}function Hh(){const s=lt();if(s.os!==ei.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return 15===Number(i[0])}function vD(){const s=lt();if(s.os!==ei.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return 16===Number(i[0])}function bD(){const s=lt();if(s.os!==ei.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return 15===Number(i[0])&&Number(i[1])>=1}function Tc(){return fr()&&navigator.maxTouchPoints>0}function yD(){return lt().name===Et.WECHAT}function CD(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function wd(){const s=lt();return s.name!==Et.EDGE&&s.name!==Et.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Gh(){return kE()===ei.ANDROID}function Ic(){const s=lt();return Gh()&&(s.name===Et.CHROME||s.name===Et.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}var k;!function(s){s.UNEXPECTED_ERROR="UNEXPECTED_ERROR",s.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",s.TIMEOUT="TIMEOUT",s.INVALID_PARAMS="INVALID_PARAMS",s.NOT_READABLE="NOT_READABLE",s.NOT_SUPPORTED="NOT_SUPPORTED",s.INVALID_OPERATION="INVALID_OPERATION",s.OPERATION_ABORTED="OPERATION_ABORTED",s.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",s.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",s.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",s.DATACHANNEL_FAILED="DATACHANNEL_FAILED",s.NETWORK_ERROR="NETWORK_ERROR",s.NETWORK_TIMEOUT="NETWORK_TIMEOUT",s.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",s.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",s.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",s.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",s.ELECTRON_IS_NULL="ELECTRON_IS_NULL",s.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",s.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",s.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",s.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",s.PERMISSION_DENIED="PERMISSION_DENIED",s.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",s.TRACK_IS_DISABLED="TRACK_IS_DISABLED",s.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",s.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",s.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",s.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",s.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",s.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",s.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",s.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",s.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",s.UID_CONFLICT="UID_CONFLICT",s.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",s.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",s.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",s.INVALID_TRACK="INVALID_TRACK",s.SENDER_NOT_FOUND="SENDER_NOT_FOUND",s.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",s.SET_ANSWER_FAILED="SET_ANSWER_FAILED",s.ICE_FAILED="ICE_FAILED",s.PC_CLOSED="PC_CLOSED",s.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",s.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",s.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",s.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",s.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",s.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",s.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",s.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",s.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",s.INVALID_REMOTE_USER="INVALID_REMOTE_USER",s.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",s.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",s.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",s.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",s.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",s.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",s.WS_ABORT="WS_ABORT",s.WS_DISCONNECT="WS_DISCONNECT",s.WS_ERR="WS_ERR",s.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",s.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",s.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",s.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",s.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",s.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",s.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",s.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",s.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",s.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",s.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",s.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",s.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",s.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",s.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",s.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",s.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",s.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",s.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",s.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",s.INVALID_PLUGIN="INVALID_PLUGIN",s.DISCONNECT_P2P="DISCONNECT_P2P",s.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",s.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",s.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",s.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",s.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",s.PROHIBITED_OPERATION="PROHIBITED_OPERATION",s.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",s.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED"}(k||(k={}));let ee=class extends Error{constructor(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(i),S(this,"code",void 0),S(this,"message",void 0),S(this,"data",void 0),S(this,"name","AgoraRTCException"),this.code=s,this.message="AgoraRTCError ".concat(this.code,": ").concat(i),this.data=r}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",i=arguments.length>1?arguments[1]:void 0;return"error"===s&&(i||console).error(this.toString()),"warning"===s&&(i||console).warn(this.toString()),this}throw(s){throw this.print("error",s),this}};function wc(s,i){if("boolean"!=typeof s)throw new ee(k.INVALID_PARAMS,"Invalid ".concat(i,": The value is of the boolean type."))}function Sn(s,i,r){if(!ye(r).call(r,s))throw new ee(k.INVALID_PARAMS,"".concat(i," can only be set as ").concat(JSON.stringify(r)))}function At(s,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(s<r||s>a||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&("number"!=typeof(d=s)||d%1!=0))throw new ee(k.INVALID_PARAMS,"invalid ".concat(i,": the value range is [").concat(r,", ").concat(a,"]. integer only"));var d}function DS(s,i){if("number"!=typeof s){if(!(s.min||s.max||s.ideal||s.exact))throw new ee(k.INVALID_PARAMS,"".concat(i," is not a valid ConstrainLong"));void 0!==s.min&&At(s.min,"".concat(i,".min"),0,1/0),void 0!==s.max&&At(s.max,"".concat(i,".max"),1,1/0),void 0!==s.exact&&At(s.exact,"".concat(i,".exact"),1,1/0),void 0!==s.ideal&&At(s.ideal,"".concat(i,".ideal"),1,1/0)}else At(s,i,1,1/0)}function hi(s,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,d=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==s)throw new ee(k.INVALID_PARAMS,"".concat(i||"param"," cannot be empty"));if(!OS(s,r,a,d))throw new ee(k.INVALID_PARAMS,"Invalid ".concat(i||"string param",": Length of the string: [").concat(r,",").concat(a,"].").concat(d?" ASCII characters only.":""))}function La(s,i){if(!Array.isArray(s))throw new ee(k.INVALID_PARAMS,"".concat(i," should be an array"))}function nn(s){return null==s}function OS(s){return"string"==typeof s&&s.length<=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:255)&&s.length>=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)&&(!(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])||function(d){if("string"!=typeof d)return!1;for(let l=0;l<d.length;l+=1){const h=d.charCodeAt(l);if(h<0||h>255)return!1}return!0}(s))}function rm(s,i,r){if("getBigUint64"in DataView.prototype)return s.getBigUint64(i,r);const a=s.getUint32(i,r),d=s.getUint32(i+4,r),l=+!!r,h=+!r;return BigInt(a*h+d*l)<<BigInt(32)|BigInt(a*l+d*h)}function SD(s,i,r,a){if("setBigUint64"in DataView.prototype)return s.setBigUint64(i,r,a);const d=Number(r>>BigInt(32)),l=Number(r&BigInt(4294967295));a?(s.setUint32(i+4,d,a),s.setUint32(i,l,a)):(s.setUint32(i,d,a),s.setUint32(i+4,l,a))}var Wh,FE;(function(s){s.COVERED="COVERED",s.POSITION="POSITION",s.SIZE="SIZE",s.STYLE="STYLE"})(Wh||(Wh={})),function(s){s.UNMOUNTED="UNMOUNTED",s.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(FE||(FE={}));const TD=new class{constructor(){S(this,"_clientSize",null),S(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),S(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),S(this,"getStyle",s=>window.getComputedStyle(s,null)),S(this,"checkCssVisibleProperty",s=>{var i;let r=!0;const a=this.getStyle(s),{display:d,visibility:l,opacity:h,filter:p}=a;return("none"===d||ye(i=["hidden","collapse"]).call(i,l)||Number(h)<.1)&&(r=!1),!!r&&(p&&p.split(" ").filter(m=>{var _;const v=m.split("(")[0];return ye(_=["brightness","blur","opacity"]).call(_,v)}).map(m=>{const[_,v]=m.split(/\(|\)/);return[_,Number(v.match(/^[0-9\.]+/))]}).forEach(m=>{const[_,v]=m;switch(_){case"brightness":(v<.1||v>3)&&(r=!1);break;case"blur":v>3&&(r=!1);break;case"opacity":v<.1&&(r=!1)}}),r)}),S(this,"checkPropertyUpToAllParentNodes",(s,i)=>{let r=!0,a=!0;let l=s;for(;l&&a;)i(l)||(r=!1,a=!1),l=l.parentElement,l||(a=!1);return r}),S(this,"checkActualCssVisibleIncludeInherit",s=>this.checkPropertyUpToAllParentNodes(s,this.checkCssVisibleProperty)),S(this,"getSizeAboutClient",s=>{const{width:i,height:r,left:a,right:d,top:l,bottom:h}=s.getBoundingClientRect(),p=this.getClientWidth(),m=this.getClientHeight();return{width:i,height:r,left:a,right:d,top:l,bottom:h,clientWidth:p,clientHeight:m,clientMin:Math.min(p,m)}}),S(this,"checkActualSize",()=>{const{width:s,height:i,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(s,i,r)}),S(this,"elementFromPoint",(s,i)=>document.elementFromPoint?document.elementFromPoint(s,i):null),S(this,"checkCoverForAPoint",(s,i,r)=>{const a=this.elementFromPoint(s,i);return null!==a&&a!==r}),S(this,"getPointPositionList",()=>{const{width:s,height:i,left:r,top:a}=this._clientSize,d=s/6,l=i/6,h=[],p=10**6;for(let m=0;m<5;m++)for(let _=0;_<5;_++)h.push({x:(r*p+(0===m?.1:4===m?(d*m*p-1e5)/p:d*m)*p)/p,y:(a*p+(0===_?.1:4===_?(l*_*p-1e5)/p:l*_)*p)/p});return[...h]}),S(this,"checkElementCover",s=>this.getPointPositionList().map(i=>this.checkCoverForAPoint(i.x,i.y,s)).filter(i=>!!i).length>6),S(this,"checkSizeIsVisible",(s,i,r)=>(s>50||r/s<=10)&&(i>50||r/i<=10)),S(this,"checkSizeOfPartInClient",()=>{const{left:s,right:i,top:r,bottom:a,clientHeight:d,clientWidth:l,clientMin:h}=this._clientSize;let p,m,_,v;if(s<0)p=0;else{if(!(s<l))return!1;p=s}if(i<0)return!1;if(m=i<l?i:l,r<0)_=0;else{if(!(r<d))return!1;_=r}return!(a<0)&&(v=a<d?a:d,this.checkSizeIsVisible(m-p,v-_,h))}),S(this,"returnHiddenResult",s=>(this._clientSize=null,{visible:!1,reason:s})),S(this,"checkOneElementVisible",s=>{if(s instanceof HTMLElement){if(this.checkElementIsMountedOnDom(s)){if(this.checkActualCssVisibleIncludeInherit(s)){if(this._clientSize=this.getSizeAboutClient(s),this.checkElementCover(s))return this.returnHiddenResult(Wh.COVERED);{const i=this.checkActualSize(),r=this.checkSizeOfPartInClient();return i&&!r?this.returnHiddenResult(Wh.POSITION):i?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Wh.SIZE)}}return this.returnHiddenResult(Wh.STYLE)}return this.returnHiddenResult(FE.UNMOUNTED)}return this.returnHiddenResult(FE.INVALID_HTML_ELEMENT)}),S(this,"checkElementIsMountedOnDom",s=>this.checkPropertyUpToAllParentNodes(s,i=>"HTML"!==i.nodeName.toUpperCase()?null!==i.parentElement:!!document.documentElement))}};function NS(s){return(new TextEncoder).encode(s)}const UE=function(s,i){const r=new Uint8Array(s.byteLength+i.byteLength);return r.set(new Uint8Array(s),0),r.set(new Uint8Array(i),s.byteLength),r},om=function(){var s=L(function*(i){const r=function(h){const p=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),m=new Uint8Array(new ArrayBuffer(p.length));for(let _=0;_<p.length;_+=1)m[_]=p.charCodeAt(_);return m}(),a=yield window.crypto.subtle.importKey("spki",r,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),d=NS(i),l=yield window.crypto.subtle.encrypt({name:"RSA-OAEP"},a,d);return function(h){let p="";for(let m=0;m<h.length;m+=1)p+=String.fromCharCode(h[m]);return window.btoa(p)}(new Uint8Array(l))});return function(r){return s.apply(this,arguments)}}(),zh=function(){var s=L(function*(i){return function(r,a){let d="";return new Uint8Array(r).forEach(l=>{d+=l.toString(16).padStart(2,"0")}),d}(yield crypto.subtle.digest("SHA-256",NS(i)))});return function(r){return s.apply(this,arguments)}}();class jt{constructor(){S(this,"_events",{}),S(this,"addListener",this.on)}getListeners(i){return this._events[i]?this._events[i].map(r=>r.listener):[]}on(i,r){this._events[i]||(this._events[i]=[]);const a=this._events[i];-1===this._indexOfListener(a,r)&&a.push({listener:r,once:!1})}once(i,r){this._events[i]||(this._events[i]=[]);const a=this._events[i];-1===this._indexOfListener(a,r)&&a.push({listener:r,once:!0})}off(i,r){if(!this._events[i])return;const a=this._events[i],d=this._indexOfListener(a,r);-1!==d&&a.splice(d,1),0===this._events[i].length&&delete this._events[i]}removeAllListeners(i){i?delete this._events[i]:this._events={}}emit(i){this._events[i]||(this._events[i]=[]);const r=this._events[i].map(h=>h);for(var a=arguments.length,d=new Array(a>1?a-1:0),l=1;l<a;l++)d[l-1]=arguments[l];for(let h=0;h<r.length;h+=1){const p=r[h];p.once&&this.off(i,p.listener),p.listener.apply(this,d||[])}}safeEmit(i){for(var r=arguments.length,a=new Array(r>1?r-1:0),d=1;d<r;d++)a[d-1]=arguments[d];[...this._events[i]||[]].forEach(l=>{l.once&&this.off(i,l.listener);try{l.listener.apply(this,a)}catch(h){console.error("safeEmit event:".concat(i," error ").concat(h?.toString()))}})}_indexOfListener(i,r){let a=i.length;for(;a--;)if(i[a].listener===r)return a;return-1}}let VE=null;function ID(){if(VE)return VE;if(window.electron)return VE=window.electron;if(!window.require)return null;try{return VE=window.require("electron"),VE}catch{return null}}var Kn,qt,PS,ze,$e,_i,Xi,Rc;function wD(s){return At(s.timeout,"config.timeout",0,1e5),At(s.timeoutFactor,"config.timeoutFactor",0,100,!1),At(s.maxRetryCount,"config.maxRetryConfig",0,1/0),At(s.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function oa(s){if(!Array.isArray(s)||s.length<1)return!1;try{s.forEach(i=>{if(!i.urls)throw Error()})}catch{return!1}return!0}function Kh(s){return hi(s.turnServerURL,"turnServerURL"),hi(s.username,"username"),hi(s.password,"password"),s.udpport&&At(s.udpport,"udpport",1,99999,!0),s.forceturn&&wc(s.forceturn,"forceturn"),s.security&&wc(s.security,"security"),s.tcpport&&At(s.tcpport,"tcpport",1,99999,!0),!0}function MS(s){return void 0!==s.level&&Sn(s.level,"level",[1,2,3]),void 0!==s.delay&&At(s.delay,"delay",0,3e3,!0),!0}function rn(s,i){for(var r=arguments.length,a=new Array(r>2?r-2:0),d=2;d<r;d++)a[d-2]=arguments[d];return 0===s.getListeners(i).length?X.reject(new ee(k.UNEXPECTED_ERROR,"can not emit promise")):new X((l,h)=>{s.emit(i,...a,l,h)})}function Tt(s,i){if(0===s.getListeners(i).length)return X.resolve();for(var r=arguments.length,a=new Array(r>2?r-2:0),d=2;d<r;d++)a[d-2]=arguments[d];return rn(s,i,...a)}function Pr(s,i){if(0===s.getListeners(i).length)return null;for(var r=arguments.length,a=new Array(r>2?r-2:0),d=2;d<r;d++)a[d-2]=arguments[d];return mr(s,i,...a)}function mr(s,i){let r=null,a=null;for(var d=arguments.length,l=new Array(d>2?d-2:0),h=2;h<d;h++)l[h-2]=arguments[h];if(s.emit(i,...l,p=>{r=p},p=>{a=p}),null!==a)throw a;if(null===r)throw new ee(k.UNEXPECTED_ERROR,"handler is not sync");return r}(function(s){s.CREATE_CLIENT="createClient",s.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",s.SET_AREA="setArea",s.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",s.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",s.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",s.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",s.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",s.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",s.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",s.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",s.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",s.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",s.START_PROXY_SERVER="Client.startProxyServer",s.STOP_PROXY_SERVER="Client.stopProxyServer",s.SET_PROXY_SERVER="Client.setProxyServer",s.SET_TURN_SERVER="Client.setTurnServer",s.SET_CLIENT_ROLE="Client.setClientRole",s.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",s.ENABLE_DUAL_STREAM="Client.enableDualStream",s.DISABLE_DUAL_STREAM="Client.disableDualStream",s.JOIN="Client.join",s.LEAVE="Client.leave",s.PUBLISH="Client.publish",s.UNPUBLISH="Client.unpublish",s.SUBSCRIBE="Client.subscribe",s.MASS_SUBSCRIBE="Client.massSubscribe",s.MASS_UNSUBSCRIBE="Client.massUnsubscribe",s.UNSUBSCRIBE="Client.unsubscribe",s.RENEW_TOKEN="Client.renewToken",s.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",s.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",s.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",s.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",s.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",s.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",s.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",s.DATACHANNEL_FAILBACK="Client._datachannelFailback",s.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",s.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",s.START_LIVE_STREAMING="Client.startLiveStreaming",s.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",s.STOP_LIVE_STREAMING="Client.stopLiveStreaming",s.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",s.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",s.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",s.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",s.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",s.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",s.SET_CONFIG_DISTRIBUTE="_configDistribute",s.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",s.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",s.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",s.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",s.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",s.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",s.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",s.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",s.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",s.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",s.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",s.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",s.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",s.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",s.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",s.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",s.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",s.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",s.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",s.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",s.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",s.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",s.STREAM_TYPE_CHANGE="streamTypeChange",s.CONNECTION_STATE_CHANGE="connectionStateChange",s.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",s.IMAGE_MODERATION_UPLOAD="imageModerationUpload"})(Kn||(Kn={})),function(s){s.TRACER="tracer"}(qt||(qt={})),function(s){s[s.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",s[s.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",s[s.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(PS||(PS={})),function(s){s.LEAVE="LEAVE",s.NETWORK_ERROR="NETWORK_ERROR",s.SERVER_ERROR="SERVER_ERROR",s.UID_BANNED="UID_BANNED",s.IP_BANNED="IP_BANNED",s.CHANNEL_BANNED="CHANNEL_BANNED",s.FALLBACK="FALLBACK",s.LICENSE_MISSING="LICENSE_MISSING",s.LICENSE_EXPIRED="LICENSE_EXPIRED",s.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",s.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",s.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",s.LICENSE_ILLEGAL="LICENSE_ILLEGAL",s.TOKEN_EXPIRE="TOKEN_EXPIRE"}(ze||(ze={})),function(s){s.CONNECTION_STATE_CHANGE="connection-state-change",s.MEDIA_RECONNECT_START="media-reconnect-start",s.MEDIA_RECONNECT_END="media-reconnect-end",s.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",s.USER_JOINED="user-joined",s.USER_LEAVED="user-left",s.USER_PUBLISHED="user-published",s.USER_UNPUBLISHED="user-unpublished",s.USER_INFO_UPDATED="user-info-updated",s.CLIENT_BANNED="client-banned",s.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",s.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",s.VOLUME_INDICATOR="volume-indicator",s.CRYPT_ERROR="crypt-error",s.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",s.NETWORK_QUALITY="network-quality",s.STREAM_TYPE_CHANGED="stream-type-changed",s.STREAM_FALLBACK="stream-fallback",s.RECEIVE_METADATA="receive-metadata",s.STREAM_MESSAGE="stream-message",s.LIVE_STREAMING_ERROR="live-streaming-error",s.LIVE_STREAMING_WARNING="live-streaming-warning",s.INJECT_STREAM_STATUS="stream-inject-status",s.EXCEPTION="exception",s.ERROR="error",s.P2P_LOST="p2p_lost",s.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",s.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",s.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",s.PUBLISHED_USER_LIST="published-user-list",s.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",s.CONTENT_INSPECT_ERROR="content-inspect-error",s.CONTENT_INSPECT_RESULT="content-inspect-result",s.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}($e||($e={})),function(s){s.NETWORK_ERROR="NETWORK_ERROR",s.SERVER_ERROR="SERVER_ERROR",s.MULTI_IP="MULTI_IP",s.TIMEOUT="TIMEOUT",s.OFFLINE="OFFLINE",s.LEAVE="LEAVE",s.P2P_FAILED="P2P_FAILED",s.FALLBACK="FALLBACK"}(_i||(_i={})),function(s){s.ONLINE="ONLINE",s.OFFLINE="OFFLINE"}(Xi||(Xi={})),function(s){s.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",s.ONLINE="ONLINE",s.OFFLINE="OFFLINE"}(Rc||(Rc={}));const Fn=new class extends jt{set networkState(s){this.emit(Rc.NETWORK_STATE_CHANGE,s,this._networkState),s===Xi.ONLINE?this.emit(Rc.ONLINE):s===Xi.OFFLINE&&(this.onlineWaiter=new X(i=>{this.once(Rc.ONLINE,()=>{this.onlineWaiter=void 0,i(Xi.ONLINE)})}),this.emit(Rc.OFFLINE)),this._networkState=s}get networkState(){return this._networkState}get isOnline(){return this._networkState===Xi.ONLINE}constructor(){super(),S(this,"_moduleName","network-indicator"),S(this,"_networkState",Xi.ONLINE),S(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Xi.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Xi.OFFLINE})}};function RD(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Rd(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?RD(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):RD(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function sm(s,i){const r=s.indexOf(i);-1!==r&&s.splice(r,1)}function Ad(s){const i=[];return s.forEach(r=>{-1===i.indexOf(r)&&i.push(r)}),i}function am(s){void 0!==X?X.resolve().then(s):setTimeout(s,0)}function Ft(s){return JSON.parse(JSON.stringify(s))}function Dd(s){try{return Ft(s)}catch{return s}}const BE={};function qh(s,i){BE[i]||(BE[i]=!0,s())}function cm(s){const i=window.atob(s),r=new Uint8Array(new ArrayBuffer(i.length));for(let a=0;a<i.length;a+=1)r[a]=i.charCodeAt(a);return r}function Yh(s){let i="";for(let r=0;r<s.length;r+=1)i+=String.fromCharCode(s[r]);return window.btoa(i)}function Fa(s){return window.TextEncoder?(new TextEncoder).encode(s).length:s.length}function AD(s){let i=0;return/DingTalk/i.test(navigator.userAgent)&&s.realFormData&&(s=s.realFormData),s.forEach(r=>{i+="string"==typeof r?Fa(r):r.size}),i+138}function Ua(s){const i=new ee(k.TIMEOUT,"timeout");return new X((r,a)=>{window.setTimeout(()=>a(i),s)})}function Un(s){return new X(i=>{window.setTimeout(i,s)})}function Ke(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,i=arguments.length>1?arguments[1]:void 0;const r=Math.random().toString(16).substr(2,s).toLowerCase();return r.length===s?"".concat(i).concat(r):"".concat(i).concat(r)+Ke(s-r.length,"")}function Ac(){return Ke(32,"").toUpperCase()}const Yl=()=>{},rs=new class{constructor(){S(this,"fnMap",new Map)}throttleByKey(s,i,r,a){for(var d=arguments.length,l=new Array(d>4?d-4:0),h=4;h<d;h++)l[h-4]=arguments[h];if(this.fnMap.has(i)){const p=this.fnMap.get(i);if(p.threshold!==r){p.fn(...p.args),clearTimeout(p.timer);const m=window.setTimeout(()=>{const _=this.fnMap.get(i);_&&_.fn(..._.args),this.fnMap.delete(i)},r);this.fnMap.set(i,{fn:s,threshold:r,timer:m,args:l,skipFn:a})}else p.skipFn&&p.skipFn(...p.args),this.fnMap.set(i,Rd(Rd({},p),{},{fn:s,args:l,skipFn:a}))}else{const p=window.setTimeout(()=>{const m=this.fnMap.get(i);m&&m.fn(...m.args),this.fnMap.delete(i)},r);this.fnMap.set(i,{fn:s,threshold:r,timer:p,args:l,skipFn:a})}}},DD=rs.throttleByKey.bind(rs);function Tn(s){return"object"==typeof s&&null!==s&&!(s instanceof RegExp)}function jE(s,i){if(!Tn(s)||!Tn(i)||Array.isArray(s)&&!Array.isArray(i)||!Array.isArray(s)&&Array.isArray(i))return i;if(Array.isArray(i)&&Array.isArray(s)){const r=[...s];for(let a=0;a<i.length;a++)r[a]=jE(s[a],i[a]);return r}{const r=Rd({},s);for(const a in i)Object.prototype.hasOwnProperty.call(i,a)&&(r[a]=Object.prototype.hasOwnProperty.call(s,a)?jE(s[a],i[a]):i[a]);return r}}let OD=1,HE=console;class Ei{static setLogger(i){HE=i}constructor(i){S(this,"lockingPromise",X.resolve()),S(this,"locks",0),S(this,"name",""),S(this,"lockId",void 0),this.lockId=OD++,i&&(this.name=i),HE.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(i){let r;this.locks+=1,HE.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof i?i:""));const a=new X(l=>{r=()=>{this.locks-=1,HE.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof i?i:"")),l()}}),d=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>a),d}}function ti(s,i){return function(r,a,d){const l=d.value;if("function"!=typeof l)throw new Error("Cannot use mutex on object property.");return d.value=L(function*(){const h=this[i];if(!h)throw new Error("mutex property key ".concat(i," doesn't exist on ").concat(s));const p=yield h.lock("From ".concat(s,".").concat(a));try{for(var m=arguments.length,_=new Array(m),v=0;v<m;v++)_[v]=arguments[v];return yield l.apply(this,_)}finally{p()}}),d}}const Pn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function GE(s,i){const r=Math.floor(i.timeout*Math.pow(i.timeoutFactor,s));return Math.min(i.maxRetryTimeout,r)}function In(s,i,r,a){const d=Object.assign({},Pn,a);let l=d.timeout;const h=function(){var _=L(function*(){var v;yield(v=l,new X(b=>{window.setTimeout(b,v)})),l*=d.timeoutFactor,l=Math.min(d.maxRetryTimeout,l)});return function(){return _.apply(this,arguments)}}();let p=!1;const m=new X(function(){var _=L(function*(v,b){i=i||(()=>!1),r=r||(()=>!0);for(let y=0;y<d.maxRetryCount;y+=1){if(p)return b(new ee(k.OPERATION_ABORTED));try{const T=yield s();if(!i(T,y)||y+1===d.maxRetryCount)return v(T);yield h()}catch(T){if(!r(T,y)||y+1===d.maxRetryCount)return b(T);yield h()}}});return function(v,b){return _.apply(this,arguments)}}());return m.cancel=()=>p=!0,m}var dm=$o,$h=_l,WE=Yb,lm=Ta,zE=TypeError,xS=function(s){return function(i,r,a,d){dm(r);var l=$h(i),h=WE(l),p=lm(l),m=s?p-1:0,_=s?-1:1;if(a<2)for(;;){if(m in h){d=h[m],m+=_;break}if(m+=_,s?m<0:p<=m)throw zE("Reduce of empty array with no initial value")}for(;s?m>=0:p>m;m+=_)m in h&&(d=r(d,h[m],m,l));return d}},ND=[xS(!1),xS(!0)][0];Bt({target:"Array",proto:!0,forced:!Hf&&ml>79&&ml<83||!aE("reduce")},{reduce:function(s){var i=arguments.length;return ND(this,s,i,i>1?arguments[1]:void 0)}});var PD=uc("Array").reduce,KE=Ds,kS=PD,qE=Array.prototype,Va=Rt(function(s){var i=s.reduce;return s===qE||KE(qE,s)&&i===qE.reduce?kS:i});let Dc=class{constructor(s){S(this,"input",[]),S(this,"size",void 0),this.size=s}add(s){this.input.push(s),this.input.length>this.size&&this.input.splice(0,1)}mean(){var s;return 0===this.input.length?0:Va(s=this.input).call(s,(i,r)=>i+r)/this.input.length}};var LS,Ao={exports:{}},MD=function(s,i){return function(){for(var r=new Array(arguments.length),a=0;a<r.length;a++)r[a]=arguments[a];return s.apply(i,r)}},CL=MD,um=Object.prototype.toString,YE=(LS=Object.create(null),function(s){var i=um.call(s);return LS[i]||(LS[i]=i.slice(8,-1).toLowerCase())});function Od(s){return s=s.toLowerCase(),function(i){return YE(i)===s}}function FS(s){return Array.isArray(s)}function US(s){return void 0===s}var xD=Od("ArrayBuffer");function hm(s){return null!==s&&"object"==typeof s}function Xh(s){if("object"!==YE(s))return!1;var i=Object.getPrototypeOf(s);return null===i||i===Object.prototype}var VS=Od("Date"),Jh=Od("File"),kD=Od("Blob"),LD=Od("FileList");function Nd(s){return"[object Function]"===um.call(s)}var BS=Od("URLSearchParams");function pm(s,i){if(null!=s)if("object"!=typeof s&&(s=[s]),FS(s))for(var r=0,a=s.length;r<a;r++)i.call(null,s[r],r,s);else for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&i.call(null,s[d],d,s)}var $E,FD=($E=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(s){return $E&&s instanceof $E}),gr={isArray:FS,isArrayBuffer:xD,isBuffer:function(s){return null!==s&&!US(s)&&null!==s.constructor&&!US(s.constructor)&&"function"==typeof s.constructor.isBuffer&&s.constructor.isBuffer(s)},isFormData:function(s){var i="[object FormData]";return s&&("function"==typeof FormData&&s instanceof FormData||um.call(s)===i||Nd(s.toString)&&s.toString()===i)},isArrayBufferView:function(s){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(s):s&&s.buffer&&xD(s.buffer)},isString:function(s){return"string"==typeof s},isNumber:function(s){return"number"==typeof s},isObject:hm,isPlainObject:Xh,isUndefined:US,isDate:VS,isFile:Jh,isBlob:kD,isFunction:Nd,isStream:function(s){return hm(s)&&Nd(s.pipe)},isURLSearchParams:BS,isStandardBrowserEnv:function(){return(typeof navigator>"u"||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&typeof window<"u"&&typeof document<"u"},forEach:pm,merge:function s(){var i={};function r(l,h){i[h]=Xh(i[h])&&Xh(l)?s(i[h],l):Xh(l)?s({},l):FS(l)?l.slice():l}for(var a=0,d=arguments.length;a<d;a++)pm(arguments[a],r);return i},extend:function(s,i,r){return pm(i,function(a,d){s[d]=r&&"function"==typeof a?CL(a,r):a}),s},trim:function(s){return s.trim?s.trim():s.replace(/^\s+|\s+$/g,"")},stripBOM:function(s){return 65279===s.charCodeAt(0)&&(s=s.slice(1)),s},inherits:function(s,i,r,a){s.prototype=Object.create(i.prototype,a),s.prototype.constructor=s,r&&Object.assign(s.prototype,r)},toFlatObject:function(s,i,r){var a,d,l,h={};i=i||{};do{for(d=(a=Object.getOwnPropertyNames(s)).length;d-- >0;)h[l=a[d]]||(i[l]=s[l],h[l]=!0);s=Object.getPrototypeOf(s)}while(s&&(!r||r(s,i))&&s!==Object.prototype);return i},kindOf:YE,kindOfTest:Od,endsWith:function(s,i,r){s=String(s),(void 0===r||r>s.length)&&(r=s.length);var a=s.indexOf(i,r-=i.length);return-1!==a&&a===r},toArray:function(s){if(!s)return null;var i=s.length;if(US(i))return null;for(var r=new Array(i);i-- >0;)r[i]=s[i];return r},isTypedArray:FD,isFileList:LD},Qh=gr;function UD(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var $l=function(s,i,r){if(!i)return s;var a;if(r)a=r(i);else if(Qh.isURLSearchParams(i))a=i.toString();else{var d=[];Qh.forEach(i,function(h,p){null!=h&&(Qh.isArray(h)?p+="[]":h=[h],Qh.forEach(h,function(m){Qh.isDate(m)?m=m.toISOString():Qh.isObject(m)&&(m=JSON.stringify(m)),d.push(UD(p)+"="+UD(m))}))}),a=d.join("&")}if(a){var l=s.indexOf("#");-1!==l&&(s=s.slice(0,l)),s+=(-1===s.indexOf("?")?"?":"&")+a}return s},VD=gr;function XE(){this.handlers=[]}XE.prototype.use=function(s,i,r){return this.handlers.push({fulfilled:s,rejected:i,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},XE.prototype.eject=function(s){this.handlers[s]&&(this.handlers[s]=null)},XE.prototype.forEach=function(s){VD.forEach(this.handlers,function(i){null!==i&&s(i)})};var BD,jD,HD=XE,GD=gr;function Zh(){if(jD)return BD;jD=1;var s=gr;function i(d,l,h,p,m){Error.call(this),this.message=d,this.name="AxiosError",l&&(this.code=l),h&&(this.config=h),p&&(this.request=p),m&&(this.response=m)}s.inherits(i,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var r=i.prototype,a={};return["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(d){a[d]={value:d}}),Object.defineProperties(i,a),Object.defineProperty(r,"isAxiosError",{value:!0}),i.from=function(d,l,h,p,m,_){var v=Object.create(r);return s.toFlatObject(d,v,function(b){return b!==Error.prototype}),i.call(v,d.message,l,h,p,m),v.name=d.name,_&&Object.assign(v,_),v},BD=i}var WD,zD,jS,JE,HS,KD,qD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function YD(){if(zD)return WD;zD=1;var s=gr;return WD=function(i,r){r=r||new FormData;var a=[];function d(l){return null===l?"":s.isDate(l)?l.toISOString():s.isArrayBuffer(l)||s.isTypedArray(l)?"function"==typeof Blob?new Blob([l]):Buffer.from(l):l}return function l(h,p){if(s.isPlainObject(h)||s.isArray(h)){if(-1!==a.indexOf(h))throw Error("Circular reference detected in "+p);a.push(h),s.forEach(h,function(m,_){if(!s.isUndefined(m)){var v,b=p?p+"."+_:_;if(m&&!p&&"object"==typeof m)if(s.endsWith(_,"{}"))m=JSON.stringify(m);else if(s.endsWith(_,"[]")&&(v=s.toArray(m)))return void v.forEach(function(y){!s.isUndefined(y)&&r.append(b,d(y))});l(m,b)}}),a.pop()}else r.append(p,d(h))}(i),r}}var GS,$D,XD,JD,QD,ZD,eO,tO,WS,nO,zS,KS,rO=function(s,i){return s&&!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(i)?function(s,i){return i?s.replace(/\/+$/,"")+"/"+i.replace(/^\/+/,""):s}(s,i):i};function Md(){if(ZD)return QD;ZD=1;var s=Zh();function i(r){s.call(this,r??"canceled",s.ERR_CANCELED),this.name="CanceledError"}return gr.inherits(i,s,{__CANCEL__:!0}),QD=i}var rr=gr,Xl=function(s,i){GD.forEach(s,function(r,a){a!==i&&a.toUpperCase()===i.toUpperCase()&&(s[i]=r,delete s[a])})},Ji=Zh(),tp=qD,np=YD(),ip={"Content-Type":"application/x-www-form-urlencoded"};function Jl(s,i){!rr.isUndefined(s)&&rr.isUndefined(s["Content-Type"])&&(s["Content-Type"]=i)}var Ql,Oc={transitional:tp,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&"[object process]"===Object.prototype.toString.call(process))&&(Ql=function ep(){if(nO)return WS;nO=1;var s=gr,i=function SL(){if(JE)return jS;JE=1;var s=Zh();return jS=function(i,r,a){var d=a.config.validateStatus;a.status&&d&&!d(a.status)?r(new s("Request failed with status code "+a.status,[s.ERR_BAD_REQUEST,s.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a)):i(a)}}(),r=function TL(){if(KD)return HS;KD=1;var s=gr;return HS=s.isStandardBrowserEnv()?{write:function(i,r,a,d,l,h){var p=[];p.push(i+"="+encodeURIComponent(r)),s.isNumber(a)&&p.push("expires="+new Date(a).toGMTString()),s.isString(d)&&p.push("path="+d),s.isString(l)&&p.push("domain="+l),!0===h&&p.push("secure"),document.cookie=p.join("; ")},read:function(i){var r=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove:function(i){this.write(i,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}}(),a=$l,d=rO,l=function oO(){if($D)return GS;$D=1;var s=gr,i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return GS=function(r){var a,d,l,h={};return r&&s.forEach(r.split("\n"),function(p){if(l=p.indexOf(":"),a=s.trim(p.substr(0,l)).toLowerCase(),d=s.trim(p.substr(l+1)),a){if(h[a]&&i.indexOf(a)>=0)return;h[a]="set-cookie"===a?(h[a]?h[a]:[]).concat([d]):h[a]?h[a]+", "+d:d}}),h}}(),h=function sO(){if(JD)return XD;JD=1;var s=gr;return XD=s.isStandardBrowserEnv()?function(){var i,r=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");function d(l){var h=l;return r&&(a.setAttribute("href",h),h=a.href),a.setAttribute("href",h),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:"/"===a.pathname.charAt(0)?a.pathname:"/"+a.pathname}}return i=d(window.location.href),function(l){var h=s.isString(l)?d(l):l;return h.protocol===i.protocol&&h.host===i.host}}():function(){return!0}}(),p=qD,m=Zh(),_=Md(),v=function qS(){return tO||(tO=1,eO=function(s){var i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return i&&i[1]||""}),eO}();return WS=function(b){return new Promise(function(y,T){var M,O=b.data,D=b.headers,x=b.responseType;function F(){b.cancelToken&&b.cancelToken.unsubscribe(M),b.signal&&b.signal.removeEventListener("abort",M)}s.isFormData(O)&&s.isStandardBrowserEnv()&&delete D["Content-Type"];var j=new XMLHttpRequest;if(b.auth){var q=b.auth.username||"",te=b.auth.password?unescape(encodeURIComponent(b.auth.password)):"";D.Authorization="Basic "+btoa(q+":"+te)}var K=d(b.baseURL,b.url);function Q(){if(j){var _e="getAllResponseHeaders"in j?l(j.getAllResponseHeaders()):null;i(function(Fe){y(Fe),F()},function(Fe){T(Fe),F()},{data:x&&"text"!==x&&"json"!==x?j.response:j.responseText,status:j.status,statusText:j.statusText,headers:_e,config:b,request:j}),j=null}}if(j.open(b.method.toUpperCase(),a(K,b.params,b.paramsSerializer),!0),j.timeout=b.timeout,"onloadend"in j?j.onloadend=Q:j.onreadystatechange=function(){j&&4===j.readyState&&(0!==j.status||j.responseURL&&0===j.responseURL.indexOf("file:"))&&setTimeout(Q)},j.onabort=function(){j&&(T(new m("Request aborted",m.ECONNABORTED,b,j)),j=null)},j.onerror=function(){T(new m("Network Error",m.ERR_NETWORK,b,j,j)),j=null},j.ontimeout=function(){var _e=b.timeout?"timeout of "+b.timeout+"ms exceeded":"timeout exceeded";b.timeoutErrorMessage&&(_e=b.timeoutErrorMessage),T(new m(_e,(b.transitional||p).clarifyTimeoutError?m.ETIMEDOUT:m.ECONNABORTED,b,j)),j=null},s.isStandardBrowserEnv()){var $=(b.withCredentials||h(K))&&b.xsrfCookieName?r.read(b.xsrfCookieName):void 0;$&&(D[b.xsrfHeaderName]=$)}"setRequestHeader"in j&&s.forEach(D,function(_e,me){void 0===O&&"content-type"===me.toLowerCase()?delete D[me]:j.setRequestHeader(me,_e)}),s.isUndefined(b.withCredentials)||(j.withCredentials=!!b.withCredentials),x&&"json"!==x&&(j.responseType=b.responseType),"function"==typeof b.onDownloadProgress&&j.addEventListener("progress",b.onDownloadProgress),"function"==typeof b.onUploadProgress&&j.upload&&j.upload.addEventListener("progress",b.onUploadProgress),(b.cancelToken||b.signal)&&(M=function(_e){j&&(T(!_e||_e&&_e.type?new _:_e),j.abort(),j=null)},b.cancelToken&&b.cancelToken.subscribe(M),b.signal&&(b.signal.aborted?M():b.signal.addEventListener("abort",M))),O||(O=null);var z=v(K);z&&-1===["http","https","file"].indexOf(z)?T(new m("Unsupported protocol "+z+":",m.ERR_BAD_REQUEST,b)):j.send(O)})}}()),Ql),transformRequest:[function(s,i){if(Xl(i,"Accept"),Xl(i,"Content-Type"),rr.isFormData(s)||rr.isArrayBuffer(s)||rr.isBuffer(s)||rr.isStream(s)||rr.isFile(s)||rr.isBlob(s))return s;if(rr.isArrayBufferView(s))return s.buffer;if(rr.isURLSearchParams(s))return Jl(i,"application/x-www-form-urlencoded;charset=utf-8"),s.toString();var r,a=rr.isObject(s),d=i&&i["Content-Type"];if((r=rr.isFileList(s))||a&&"multipart/form-data"===d){var l=this.env&&this.env.FormData;return np(r?{"files[]":s}:s,l&&new l)}return a||"application/json"===d?(Jl(i,"application/json"),function(h,p,m){if(rr.isString(h))try{return(0,JSON.parse)(h),rr.trim(h)}catch(_){if("SyntaxError"!==_.name)throw _}return(0,JSON.stringify)(h)}(s)):s}],transformResponse:[function(s){var i=this.transitional||Oc.transitional,d=!(i&&i.silentJSONParsing)&&"json"===this.responseType;if(d||i&&i.forcedJSONParsing&&rr.isString(s)&&s.length)try{return JSON.parse(s)}catch(l){if(d)throw"SyntaxError"===l.name?Ji.from(l,Ji.ERR_BAD_RESPONSE,this,null,this.response):l}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:KS?zS:(KS=1,zS=null)},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};rr.forEach(["delete","get","head"],function(s){Oc.headers[s]={}}),rr.forEach(["post","put","patch"],function(s){Oc.headers[s]=rr.merge(ip)});var Zl,eu,xd=Oc,aO=gr,cO=xd;function YS(){return eu?Zl:(eu=1,Zl=function(s){return!(!s||!s.__CANCEL__)})}var $S=gr,QE=function(s,i,r){var a=this||cO;return aO.forEach(r,function(d){s=d.call(a,s,i)}),s},dO=YS(),lO=xd,uO=Md();function ZE(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new uO}var fm,Nc,os=gr,hO=function(s,i){i=i||{};var r={};function a(_,v){return os.isPlainObject(_)&&os.isPlainObject(v)?os.merge(_,v):os.isPlainObject(v)?os.merge({},v):os.isArray(v)?v.slice():v}function d(_){return os.isUndefined(i[_])?os.isUndefined(s[_])?void 0:a(void 0,s[_]):a(s[_],i[_])}function l(_){if(!os.isUndefined(i[_]))return a(void 0,i[_])}function h(_){return os.isUndefined(i[_])?os.isUndefined(s[_])?void 0:a(void 0,s[_]):a(void 0,i[_])}function p(_){return _ in i?a(s[_],i[_]):_ in s?a(void 0,s[_]):void 0}var m={url:l,method:l,data:l,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:p};return os.forEach(Object.keys(s).concat(Object.keys(i)),function(_){var v=m[_]||d,b=v(_);os.isUndefined(b)&&v!==p||(r[_]=b)}),r};function ev(){return Nc?fm:(Nc=1,fm={version:"0.27.2"})}var tu=ev().version,Ba=Zh(),XS={};["object","boolean","number","function","string","symbol"].forEach(function(s,i){XS[s]=function(r){return typeof r===s||"a"+(i<1?"n ":" ")+s}});var tv={};XS.transitional=function(s,i,r){function a(d,l){return"[Axios v"+tu+"] Transitional option '"+d+"'"+l+(r?". "+r:"")}return function(d,l,h){if(!1===s)throw new Ba(a(l," has been removed"+(i?" in "+i:"")),Ba.ERR_DEPRECATED);return i&&!tv[l]&&(tv[l]=!0,console.warn(a(l," has been deprecated since v"+i+" and will be removed in the near future"))),!s||s(d,l,h)}};var IL,wL,pO,fO,JS,mO,QS=gr,RL=$l,gO=HD,ZS=function(s){return ZE(s),s.headers=s.headers||{},s.data=QE.call(s,s.data,s.headers,s.transformRequest),s.headers=$S.merge(s.headers.common||{},s.headers[s.method]||{},s.headers),$S.forEach(["delete","get","head","post","put","patch","common"],function(i){delete s.headers[i]}),(s.adapter||lO.adapter)(s).then(function(i){return ZE(s),i.data=QE.call(s,i.data,i.headers,s.transformResponse),i},function(i){return dO(i)||(ZE(s),i&&i.response&&(i.response.data=QE.call(s,i.response.data,i.response.headers,s.transformResponse))),Promise.reject(i)})},nv=hO,_O=rO,eT={assertOptions:function(s,i,r){if("object"!=typeof s)throw new Ba("options must be an object",Ba.ERR_BAD_OPTION_VALUE);for(var a=Object.keys(s),d=a.length;d-- >0;){var l=a[d],h=i[l];if(h){var p=s[l],m=void 0===p||h(p,l,s);if(!0!==m)throw new Ba("option "+l+" must be "+m,Ba.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new Ba("Unknown option "+l,Ba.ERR_BAD_OPTION)}},validators:XS},sa=eT.validators;function rp(s){this.defaults=s,this.interceptors={request:new gO,response:new gO}}rp.prototype.request=function(s,i){"string"==typeof s?(i=i||{}).url=s:i=s||{},i.method=(i=nv(this.defaults,i)).method?i.method.toLowerCase():this.defaults.method?this.defaults.method.toLowerCase():"get";var r=i.transitional;void 0!==r&&eT.assertOptions(r,{silentJSONParsing:sa.transitional(sa.boolean),forcedJSONParsing:sa.transitional(sa.boolean),clarifyTimeoutError:sa.transitional(sa.boolean)},!1);var a=[],d=!0;this.interceptors.request.forEach(function(b){"function"==typeof b.runWhen&&!1===b.runWhen(i)||(d=d&&b.synchronous,a.unshift(b.fulfilled,b.rejected))});var l,h=[];if(this.interceptors.response.forEach(function(b){h.push(b.fulfilled,b.rejected)}),!d){var p=[ZS,void 0];for(Array.prototype.unshift.apply(p,a),p=p.concat(h),l=Promise.resolve(i);p.length;)l=l.then(p.shift(),p.shift());return l}for(var m=i;a.length;){var _=a.shift(),v=a.shift();try{m=_(m)}catch(b){v(b);break}}try{l=ZS(m)}catch(b){return Promise.reject(b)}for(;h.length;)l=l.then(h.shift(),h.shift());return l},rp.prototype.getUri=function(s){s=nv(this.defaults,s);var i=_O(s.baseURL,s.url);return RL(i,s.params,s.paramsSerializer)},QS.forEach(["delete","get","head","options"],function(s){rp.prototype[s]=function(i,r){return this.request(nv(r||{},{method:s,url:i,data:(r||{}).data}))}}),QS.forEach(["post","put","patch"],function(s){function i(r){return function(a,d,l){return this.request(nv(l||{},{method:s,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:d}))}}rp.prototype[s]=i(),rp.prototype[s+"Form"]=i(!0)});var EO=gr,vO=MD,iv=rp,bO=hO,ss=function s(i){var r=new iv(i),a=vO(iv.prototype.request,r);return EO.extend(a,iv.prototype,r),EO.extend(a,r),a.create=function(d){return s(bO(i,d))},a}(xd);ss.Axios=iv,ss.CanceledError=Md(),ss.CancelToken=function(){if(wL)return IL;wL=1;var s=Md();function i(r){if("function"!=typeof r)throw new TypeError("executor must be a function.");var a;this.promise=new Promise(function(l){a=l});var d=this;this.promise.then(function(l){if(d._listeners){var h,p=d._listeners.length;for(h=0;h<p;h++)d._listeners[h](l);d._listeners=null}}),this.promise.then=function(l){var h,p=new Promise(function(m){d.subscribe(m),h=m}).then(l);return p.cancel=function(){d.unsubscribe(h)},p},r(function(l){d.reason||(d.reason=new s(l),a(d.reason))})}return i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.prototype.subscribe=function(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]},i.prototype.unsubscribe=function(r){if(this._listeners){var a=this._listeners.indexOf(r);-1!==a&&this._listeners.splice(a,1)}},i.source=function(){var r;return{token:new i(function(a){r=a}),cancel:r}},IL=i}(),ss.isCancel=YS(),ss.VERSION=ev().version,ss.toFormData=YD(),ss.AxiosError=Zh(),ss.Cancel=ss.CanceledError,ss.all=function(s){return Promise.all(s)},ss.spread=fO?pO:(fO=1,pO=function(s){return function(i){return s.apply(null,i)}}),ss.isAxiosError=function(){if(mO)return JS;mO=1;var s=gr;return JS=function(i){return s.isObject(i)&&!0===i.isAxiosError}}(),Ao.exports=ss,Ao.exports.default=ss;var Ze=Rt(Ao.exports);function rv(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function ov(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?rv(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):rv(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}let Ht,as=0,tT=0;function mm(s,i,r,a){return new X((d,l)=>{i.responseType=i.responseType||"json",i.data&&!r?(i.data=JSON.stringify(i.data),as+=Fa(i.data)):r&&(i.data.size?as+=i.data.size:i.data instanceof FormData?as+=AD(i.data):as+=Fa(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=s,Ze.request(i).then(h=>{"string"==typeof h.data?tT+=Fa(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?tT+=h.data.byteLength:tT+=Fa(JSON.stringify(h.data)),a&&d({data:h.data,headers:h.headers}),d(h.data)}).catch(h=>{Ze.isCancel(h)?l(new ee(k.OPERATION_ABORTED,"cancel token canceled")):l("ECONNABORTED"===h.code?new ee(k.NETWORK_TIMEOUT,h.message):h.response?new ee(k.NETWORK_RESPONSE_ERROR,h.response.status):new ee(k.NETWORK_ERROR,h.message))})})}function ja(s,i){return cs.apply(this,arguments)}function cs(){return cs=L(function*(s,i){const r=new Blob([i.data],{type:"buffer"});return yield mm(s,ov(ov({},i),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}),cs.apply(this,arguments)}const nT=()=>void 0!==window.isSecureContext,Do=function(s){if(s.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return s;const i=s.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(i&&i[1]&&i[2]){const d=i[2];return"".concat(i[1],".").concat(d)}const r=s.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(r&&r[1]&&r[2]){const d=r[2];return"".concat(r[1],".").concat(100*(Number(d)+1))}return"4.0.0.999"}("4.20.0"),iT=function(){try{return!0===JSON.parse("true")}catch{return!0}}();var Pc;!function(s){s.Default="default",s.Auto="auto",s.Relay="relay",s.SdRtn="sd-rtn"}(Pc||(Pc={}));const rT="v4.20.0-0-g334e514b-dirty(12/8/2023, 3:48:29 PM)",_r={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:100,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,USE_XR:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],PLUGIN_INFO:[]};function It(s,i,r){var a,d;ye(a=Object.keys(_r)).call(a,s)&&(!r&&ye(d=Object.keys(kd)).call(d,s)||(_r[s]=i))}function V(s){return _r[s]}const kd={};function oT(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Re(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?oT(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):oT(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}var qe,Mc,gm;!function(s){s.SET_SESSION_ID="SET_SESSION_ID",s.SET_P2P_ID="SET_P2P_id",s.SET_DC_ID="SET_DC_id",s.SET_UID="SET_UID",s.SET_INT_UID="SET_INT_UID",s.SET_PUB_ID="SET_PUB_ID",s.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",s.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",s.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",s.AVOID_JOIN_START="AVOID_JOIN_START",s.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",s.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",s.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",s.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",s.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",s.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",s.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",s.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",s.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",s.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",s.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",s.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",s.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",s.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",s.RESET_KEY_METRICS="RESET_KEY_METRICS",s.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",s.SET_USE_P2P="SET_USE_P2P",s.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE"}(qe||(qe={}));class yO{constructor(i,r,a,d){S(this,"state",void 0),this.state={codec:i,audioCodec:r,mode:a,clientId:d,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1,p2pTransport:Pc.Default}}dispatch(i){this.state=function(r,a){switch(a.type){case qe.SET_SESSION_ID:return Re(Re({},r),{},{sessionId:a.sessionId});case qe.SET_P2P_ID:return Re(Re({},r),{},{p2pId:a.p2pId});case qe.SET_UID:return Re(Re({},r),{},{uid:a.uid});case qe.SET_INT_UID:return Re(Re({},r),{},{intUid:a.intUid});case qe.SET_PUB_ID:return Re(Re({},r),{},{pubId:a.pubId});case qe.KEY_METRIC_CLIENT_CREATED:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{clientCreated:a.metric})});case qe.KEY_METRIC_JOIN_START:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{joinStart:a.metric})});case qe.AVOID_JOIN_START:return Re(Re({},r),{},{avoidJoinStart:a.avoidJoinStart});case qe.KEY_METRIC_JOIN_END:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{joinEnd:a.metric})});case qe.KEY_METRIC_REQUEST_AP_START:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{requestAPStart:a.metric})});case qe.KEY_METRIC_REQUEST_AP_END:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{requestAPEnd:a.metric})});case qe.KEY_METRIC_JOIN_GATEWAY_START:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{joinGatewayStart:a.metric})});case qe.KEY_METRIC_JOIN_GATEWAY_END:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{joinGatewayEnd:a.metric})});case qe.KEY_METRIC_PEER_CONNECTION_START:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{peerConnectionStart:a.metric})});case qe.KEY_METRIC_PEER_CONNECTION_END:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{peerConnectionEnd:a.metric})});case qe.KEY_METRIC_DESCRIPTION_START:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{descriptionStart:a.metric})});case qe.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{signalChannelOpen:a.metric})});case qe.KEY_METRIC_ICE_CONNECTION_END:return Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{iceConnectionEnd:a.metric})});case qe.KEY_METRIC_PUBLISH:{const d=r.keyMetrics.publish,l=d.findIndex(h=>h.trackId===a.metric.trackId);return-1!==l?(d[l]=Re(Re({},d[l]),a.metric),Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{publish:[...d]})})):Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{publish:[...r.keyMetrics.publish,a.metric]})})}case qe.KEY_METRIC_SUBSCRIBE:{const d=r.keyMetrics.subscribe,l=d.findIndex(h=>h.userId===a.metric.userId&&h.type===a.metric.type);return-1!==l?(d[l]=Re(Re({},d[l]),a.metric),Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{subscribe:[...d]})})):Re(Re({},r),{},{keyMetrics:Re(Re({},r.keyMetrics),{},{subscribe:[...r.keyMetrics.subscribe,a.metric]})})}case qe.SET_CLOUD_PROXY_SERVER_MODE:return r.cloudProxyServerMode=a.mode,r;case qe.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof a.index?r.joinChannelServiceRecords=[...r.joinChannelServiceRecords,a.record]:(r.joinChannelServiceRecords[a.index]=Re(Re({},r.joinChannelServiceRecords[a.index]),a.record),r.joinChannelServiceRecords=[...r.joinChannelServiceRecords]),r;case qe.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return r.joinChannelServiceRecords=[],r;case qe.RESET_KEY_METRICS:return r.keyMetrics={publish:[],subscribe:[]},r;case qe.SET_USE_DATACHANNEL:return Re(Re({},r),{},{useDataChannel:a.val});case qe.SET_USE_P2P:return Re(Re({},r),{},{useP2P:a.val});case qe.SET_TRANSPORT_TYPE:return Re(Re({},r),{},{p2pTransport:a.val});default:return r}}(this.state,i)}set sessionId(i){this.dispatch({type:qe.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}set codec(i){this.state.codec=i}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:qe.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:qe.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:qe.SET_UID,uid:i})}get uid(){return this.state.uid}set intUid(i){this.dispatch({type:qe.SET_INT_UID,intUid:i})}get intUid(){return this.state.intUid}set pubId(i){this.dispatch({type:qe.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:qe.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(i){this.dispatch({type:qe.SET_USE_DATACHANNEL,val:i})}get useDataChannel(){return this.state.useDataChannel}set useP2P(i){this.dispatch({type:qe.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}set p2pTransport(i){this.dispatch({type:qe.SET_TRANSPORT_TYPE,val:i})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:qe.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:qe.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:qe.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:qe.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:qe.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:qe.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:qe.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:qe.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:qe.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:qe.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:qe.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:qe.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,r,a,d){this.dispatch({type:qe.KEY_METRIC_PUBLISH,metric:Re(Re({trackId:i,type:r},a&&{publishStart:a}),d&&{publishEnd:d})})}subscribe(i,r,a,d,l,h,p){this.dispatch({type:qe.KEY_METRIC_SUBSCRIBE,metric:Re(Re(Re(Re(Re({userId:i,type:r},a&&{subscribeStart:a}),d&&{subscribeEnd:d}),l&&{firstFrame:l}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(i,r,a,d){i.forEach(l=>{this.dispatch({type:qe.KEY_METRIC_SUBSCRIBE,metric:Re(Re(Re({userId:l.userId,type:l.type},r&&{subscribeStart:r}),a&&{subscribeEnd:a}),d&&{firstFrame:d})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,r){"gateway"===i.service&&Array.isArray(i.urls)&&(i.urls=i.urls.map(a=>a.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof r?(this.dispatch({type:qe.RECORD_JOIN_CHANNEL_SERVICE,record:Re(Re({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(r<0||r>=this.state.joinChannelServiceRecords.length||this.dispatch({type:qe.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:r}),r)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:qe.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:qe.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(i){this.dispatch({type:qe.AVOID_JOIN_START,avoidJoinStart:i})}}(function(s){s.h264="h264",s.h265="h265",s.vp8="vp8",s.vp9="vp9",s.av1="av1"})(Mc||(Mc={})),function(s){s.opus="opus",s.pcma="pcma",s.pcmu="pcmu",s.g722="g722"}(gm||(gm={}));const sv=new class extends jt{reportLogUploadError(s){this.emit("REPORT_LOG_UPLOAD",s)}};class CO{constructor(i){S(this,"logger",void 0),S(this,"prefixLists",[]),this.logger=i}debug(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];this.logger.debug(...this.prefixLists,...r)}info(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];this.logger.info(...this.prefixLists,...r)}warning(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];this.logger.warning(...this.prefixLists,...r)}error(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];this.logger.error(...this.prefixLists,...r)}prefix(i){return this.prefixLists.push(i),this}popPrefix(){return this.prefixLists.pop(),this}}function sT(){const s=new Date;return s.toTimeString().split(" ")[0]+":"+s.getMilliseconds()}function SO(){const s=new Date,i=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return i?i?.[0]+":"+s.getUTCMilliseconds():s.toTimeString().split(" ")[0]+":"+s.getMilliseconds()}const ds={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},av=Date.now(),_m=s=>{for(const i in ds)if(Object.prototype.hasOwnProperty.call(ds,i)&&ds[i]===s)return i;return"DEFAULT"},I=new class{constructor(){S(this,"proxyServerURL",void 0),S(this,"logLevel",ds.DEBUG),S(this,"uploadState","collecting"),S(this,"uploadLogWaitingList",[]),S(this,"uploadLogUploadingList",[]),S(this,"uploadErrorCount",0),S(this,"currentLogID",0),S(this,"url",void 0),S(this,"extLog",(s,i)=>{this.appendLogToWaitingList(s,...i)})}debug(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[ds.DEBUG].concat(i);this.log.apply(this,a)}info(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[ds.INFO].concat(i);this.log.apply(this,a)}warning(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[ds.WARNING].concat(i);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[ds.ERROR].concat(i);this.log.apply(this,a)}upload(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];const a=[ds.DEBUG].concat(i);this.uploadLog.apply(this,a)}setLogLevel(s){s=Math.min(Math.max(0,s),4),this.logLevel=s}enableLogUpload(){It("UPLOAD_LOG",!0)}disableLogUpload(){It("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(s){this.proxyServerURL=s}prefix(s){return new CO(this).prefix(s)}log(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];if(Date.now()-av<100)return void setTimeout(()=>{this.log(...i)},Date.now()-av);const a=Math.max(0,Math.min(4,i[0]));if(i[0]=sT()+" Agora-SDK [".concat(_m(a),"]:"),this.appendLogToWaitingList(a,...i),a<this.logLevel)return;const d=sT()+" %cAgora-SDK [".concat(_m(a),"]:");let l=[];if(!V("USE_NEW_LOG"))switch(a){case ds.DEBUG:l=[d,"color: #64B5F6;"].concat(i.slice(1)),console.log.apply(console,l);break;case ds.INFO:l=[d,"color: #1E88E5; font-weight: bold;"].concat(i.slice(1)),console.log.apply(console,l);break;case ds.WARNING:l=[d,"color: #FB8C00; font-weight: bold;"].concat(i.slice(1)),console.warn.apply(console,l);break;case ds.ERROR:l=[d,"color: #B00020; font-weight: bold;"].concat(i.slice(1)),console.error.apply(console,l)}}uploadLog(){for(var s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];if(Date.now()-av<100)return void setTimeout(()=>{this.uploadLog(...i)},Date.now()-av);const a=Math.max(0,Math.min(4,i[0]));i[0]=sT()+" Agora-SDK [".concat(_m(a),"]:"),this.appendLogToWaitingList(a,...i)}appendLogToWaitingList(s){if(!V("UPLOAD_LOG"))return;for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];Array.isArray(r[0])?r[0][0]=SO()+" Agora-SDK [".concat(_m(s),"]:"):r[0]=SO()+" Agora-SDK [".concat(_m(s),"]:");let d="";r.forEach(l=>{"object"==typeof l&&(l=JSON.stringify(l)),d+="".concat(l," ")}),this.uploadLogWaitingList.push({payload_str:d,log_level:s,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}uploadLogs(){var s=this;return L(function*(){const i=s.uploadLogUploadingList,r={sdk_version:Do,process_id:V("PROCESS_ID"),payload:JSON.stringify(i)};return In(L(function*(){const a=yield Ze.post(s.url||(s.proxyServerURL?"https://".concat(s.proxyServerURL,"/ls/?h=").concat(V("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(V("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if("OK"!==a.data){const d=new Error("unexpected upload log response");throw d.response=a,d}}),()=>(s.uploadLogUploadingList=[],!1),a=>(sv.reportLogUploadError(a.response?{status:a.response.status,data:a.response.data,headers:a.response.headers,message:a.message}:a.request?{status:a.request.status,message:a.message}:{status:-1,message:a.message}),!0),{timeout:V("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:V("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})})()}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,V("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_INTERVAL"))}).catch(s=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var TO,IO;function AL(s){return hi(s.reportId,"params.reportId",0,100,!1),hi(s.category,"params.category",0,100,!1),hi(s.event,"params.event",0,100,!1),hi(s.label,"params.label",0,100,!1),At(s.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(function(s){s.FREE="free",s.UPLOADING="uploading"})(TO||(TO={})),function(s){s[s.MISC=0]="MISC",s[s.INTERNAL_EVENT=1]="INTERNAL_EVENT",s[s.PUBLIC_EVENT=2]="PUBLIC_EVENT",s[s.WEB_EVENT=3]="WEB_EVENT",s[s.INTERNAL_API=4]="INTERNAL_API",s[s.WEB_API=5]="WEB_API",s[s.PUBLIC_API=6]="PUBLIC_API"}(IO||(IO={}));const DL={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var ni,Gt,wO,cv;function aT(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Ve(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?aT(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):aT(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}(function(s){s.PUBLISH="publish",s.SUBSCRIBE="subscribe",s.WS_COMPRESSOR_INIT="ws_compressor_init",s.SESSION_INIT="session_init",s.JOIN_CHOOSE_SERVER="join_choose_server",s.REQ_USER_ACCOUNT="req_user_account",s.JOIN_GATEWAY="join_gateway",s.REJOIN_GATEWAY="rejoin_gateway",s.STREAM_SWITCH="stream_switch",s.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",s.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",s.FIRST_VIDEO_RECEIVED="first_video_received",s.FIRST_AUDIO_RECEIVED="first_audio_received",s.FIRST_VIDEO_DECODE="first_video_decode",s.FIRST_AUDIO_DECODE="first_audio_decode",s.ON_ADD_AUDIO_STREAM="on_add_audio_stream",s.ON_ADD_VIDEO_STREAM="on_add_video_stream",s.ON_UPDATE_STREAM="on_update_stream",s.ON_REMOVE_STREAM="on_remove_stream",s.USER_ANALYTICS="req_user_analytics",s.PC_STATS="pc_stats",s.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities"})(ni||(ni={})),function(s){s.SESSION="io.agora.pb.Wrtc.Session",s.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",s.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",s.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",s.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",s.PUBLISH="io.agora.pb.Wrtc.Publish",s.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",s.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",s.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",s.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",s.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",s.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",s.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",s.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",s.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",s.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",s.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",s.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",s.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",s.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",s.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",s.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",s.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",s.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",s.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",s.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",s.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",s.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",s.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",s.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",s.PC_STATS="io.agora.pb.Wrtc.PCStats",s.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities"}(Gt||(Gt={})),function(s){s[s.WORKER_EVENT=156]="WORKER_EVENT",s[s.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(wO||(wO={})),function(s){s[s.SESSION=26]="SESSION",s[s.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",s[s.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",s[s.JOIN_GATEWAY=28]="JOIN_GATEWAY",s[s.PUBLISH=30]="PUBLISH",s[s.SUBSCRIBE=29]="SUBSCRIBE",s[s.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",s[s.STREAM_SWITCH=32]="STREAM_SWITCH",s[s.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",s[s.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",s[s.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",s[s.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",s[s.API_INVOKE=41]="API_INVOKE",s[s.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",s[s.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",s[s.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",s[s.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",s[s.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",s[s.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",s[s.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",s[s.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",s[s.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",s[s.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",s[s.WORKER_EVENT=156]="WORKER_EVENT",s[s.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",s[s.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",s[s.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",s[s.USER_ANALYTICS=1e4]="USER_ANALYTICS",s[s.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(cv||(cv={}));class op{constructor(){var i=this;S(this,"baseInfoMap",new Map),S(this,"proxyServer",void 0),S(this,"eventUploadTimer",void 0),S(this,"setSessionIdTimer",void 0),S(this,"url",void 0),S(this,"backupUrl",void 0),S(this,"_appId",void 0),S(this,"keyEventUploadPendingItems",[]),S(this,"normalEventUploadPendingItems",[]),S(this,"apiInvokeUploadPendingItems",[]),S(this,"apiInvokeCount",0),S(this,"ltsList",[]),S(this,"lastSendNormalEventTime",Date.now()),S(this,"customReportCounterTimer",void 0),S(this,"customReportCount",0),S(this,"extApiInvoke",function(){var r=L(function*(a){for(const d of a){const l=Ve(Ve({},d),{},{sid:null,invokeId:++i.apiInvokeCount,tag:qt.TRACER});i.sendApiInvoke(l)}});return function(a){return r.apply(this,arguments)}}()),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),V("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),V("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(i){return this.baseInfoMap.get(i)}adjustSessionStartTime(i){if(!this.baseInfoMap.has(i)&&!this.baseInfoMap.get(i))return void I.error("adjust session ".concat(i," start time, sid is not exist or info is undefined"));const r=this.baseInfoMap.get(i),a=Date.now(),d=r.startTime;r.startTime=a,I.debug("rewrite session ".concat(i," startTime: ").concat(a," , ").concat(a-d,"ms")),this.baseInfoMap.set(i,r)}setAppId(i){this._appId=i}reportApiInvoke(i,r,a){r.timeout=r.timeout||6e4,r.reportResult=void 0===r.reportResult||r.reportResult;const d=Date.now();this.apiInvokeCount+=1;const l=this.apiInvokeCount,h=()=>({tag:r.tag,invokeId:l,sid:i,name:r.name,apiInvokeTime:d,options:r.options,states:r.states||null}),p=!!V("SHOW_REPORT_INVOKER_LOG");p&&I.info("".concat(r.name," start"),r.options);let m=!1;Un(r.timeout).then(()=>{m||(this.sendApiInvoke(Ve(Ve({},h()),{},{error:k.API_INVOKE_TIMEOUT,success:!1})),I.debug("".concat(r.name," timeout")))});const _=new ee(k.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:v=>{const b=()=>{if(m)throw _;return m=!0,this.sendApiInvoke(Ve(Ve({},h()),{},{success:!0},r.reportResult&&{result:v})),p&&I.info("".concat(r.name," onSuccess")),v};return a?DD(b,r.name+"Success",a,()=>m=!0):b()},onError:v=>{const b=()=>{if(m)throw v;m=!0,this.sendApiInvoke(Ve(Ve({},h()),{},{success:!1,error:v})),p&&I.info("".concat(r.name," onFailure"),v.toString())};return a?DD(b,r.name+"Error",a,()=>m=!0):b()}}}sessionInit(i,r){if(this.baseInfoMap.has(i))return;const a=Date.now(),d=this.createBaseInfo(i,a);d.cname=r.cname;const l=Object.assign({},{willUploadConsoleLog:V("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:iT?"global":"oversea",areas:V("AREAS")&&V("AREAS").join(",")},r.extend),{stringUid:h,channelProfile:p,channelMode:m,isABTestSuccess:_,lsid:v,clientRole:b}=r,y=Date.now(),T=Ve(Ve({},d),{},{eventType:ni.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,build:rT,lts:y,elapse:y-a,extend:JSON.stringify(l),mode:r.mode,process:V("PROCESS_ID"),appType:V("APP_TYPE"),success:!0,version:Do,stringUid:h,channelProfile:p,channelMode:m,isABTestSuccess:_,lsid:v,clientType:20,clientRole:b,serviceId:V("PROCESS_ID"),extensionID:V("PLUGIN_INFO").join(",")||""});this.send({type:Gt.SESSION,data:T},!0)}joinChooseServer(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve({},d),{},{eventType:ni.JOIN_CHOOSE_SERVER,lts:l,eventElapse:l-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:l-a.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3});this.send({type:Gt.JOIN_CHOOSE_SERVER,data:h},!0)}reqUserAccount(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve({},d),{},{eventType:ni.REQ_USER_ACCOUNT,lts:l,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:l-a.startTime,eventElapse:l-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Gt.REQ_USER_ACCOUNT,data:h},!0)}joinGateway(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info;r.vid&&(d.vid=r.vid),d.uid=r.uid,d.cid=r.cid;const l=Date.now(),{firstSuccess:h,avoidJoinStartTime:p,isProxy:m,addr:_}=r,v=l-(h&&p?p:a.startTime),b=Ve(Ve({},d),{},{eventType:ni.JOIN_GATEWAY,lts:l,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,elapse:v,eventElapse:l-r.lts,firstSuccess:h,signalChannel:r.signalChannel}),y=b.success?1:0;if(r.succ&&(a.lastJoinSuccessTime=l),h)this.send({type:Gt.JOIN_GATEWAY,data:b},!0);else{let T;if(_)if(m){const O=_.match(/h=(\d{1,3}-){3}\d{1,3}/g),D=_.match(/p=[0-9]{1,6}/g);T={isSuccess:y,gatewayIp:O&&O.length?O[0].split("=")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split("=")[1]:"",isProxy:m?1:0}}else{const O=_.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),D=_.match(/(:|p=)[0-9]{1,6}/g);T={isSuccess:y,gatewayIp:O&&O.length?O[0].split("//")[1].replace(/-/g,"."):"",port:D&&D.length?D[0].split(/:|p=/g)[1]:"",isProxy:m?1:0}}else T={isSuccess:y,gatewayIp:"",port:"",isProxy:m?1:0};delete b.success,delete b.eventType,delete b.firstSuccess,b.vid=Number(b.vid);const M=Object.assign({},b,T,{eventType:ni.REJOIN_GATEWAY});this.send({type:Gt.RE_JOIN_GATEWAY,data:M},!0)}}joinChannelTimeout(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=Date.now(),l=Ve(Ve({},a.info),{},{lts:d,timeout:r,elapse:d-a.startTime});this.send({type:Gt.JOIN_CHANNEL_TIMEOUT,data:l},!0)}publish(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve({},d),{},{eventType:ni.PUBLISH,lts:l,eventElapse:r.eventElapse,elapse:l-a.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Gt.PUBLISH,data:h},!0)}subscribe(i,r,a){const d=this.baseInfoMap.get(i);if(!d)return;const l=d.info,h=Date.now(),p=Ve(Ve({},l),{},{eventType:ni.SUBSCRIBE,lts:h,eventElapse:r.eventElapse,elapse:h-d.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid},a&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof r.peerid?p.peerSuid=r.peerid:p.peer=r.peerid,this.send({type:Gt.SUBSCRIBE,data:p},!0)}wsCompressorInit(i){var r;const a=[...ir(r=this.baseInfoMap).call(r)],l=this.baseInfoMap.get(a.length?a[0]:"UnableToGetSid");if(!l)return;const h=l.info,p=Date.now(),m=Ve(Ve({},h),{},{eventType:ni.WS_COMPRESSOR_INIT,lts:p,eventElapse:i.eventElapse,elapse:p-l.startTime,status:i.status?1:2});this.send({type:Gt.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(i,r,a,d){const l=this.baseInfoMap.get(i);if(!l)return;const h=l.info,p=Date.now(),m=Ve(Ve(Ve({},h),d),{},{elapse:p-l.startTime,eventType:r,lts:p,firstDecodeFrame:Math.max(p-l.startTime,0),apEnd:Math.max(d.apEnd-l.startTime,0),apStart:Math.max(d.apStart-l.startTime,0),joinGwEnd:Math.max(d.joinGwEnd-l.startTime,0),joinGwStart:Math.max(d.joinGwStart-l.startTime,0),pcEnd:Math.max(d.pcEnd-l.startTime,0),pcStart:Math.max(d.pcStart-l.startTime,0),subscriberEnd:Math.max(d.subscriberEnd-l.startTime,0),subscriberStart:Math.max(d.subscriberStart-l.startTime,0),videoAddNotify:Math.max(d.videoAddNotify-l.startTime,0)});this.send({type:a,data:m},!0)}firstRemoteFrame(i,r,a,d){const l=this.baseInfoMap.get(i);if(!l)return;const h=l.info,p=Date.now(),m=Ve(Ve(Ve({},h),d),{},{elapse:p-l.startTime,eventType:r,lts:p});this.send({type:a,data:m},!0)}pcStats(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve(Ve({},d),r),{},{vid:void 0===d.vid?0:Number(d.vid),elapse:l-a.startTime,eventType:ni.PC_STATS,lts:l});this.send({type:Gt.PC_STATS,data:h},!0)}updateRemoteRTPCapabilities(i,r){if(i){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve(Ve({},d),r),{},{vid:void 0===d.vid?0:Number(d.vid),eventType:ni.UPDATE_REMOTE_RTPCAPABILITIES,lts:l});this.send({type:Gt.UPDATE_REMOTE_RTPCAPABILITIES,data:h},!0)}}onGatewayStream(i,r,a,d){const l=this.baseInfoMap.get(i);if(!l)return;const h=l.info,p=Date.now(),m=Ve(Ve(Ve({},h),d),{},{eventType:r,lts:p});this.send({type:a,data:m},!0)}streamSwitch(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve({},d),{},{eventType:ni.STREAM_SWITCH,lts:l,isDual:r.isdual,elapse:l-a.startTime,success:r.succ});this.send({type:Gt.STREAM_SWITCH,data:h},!0)}requestProxyAppCenter(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve({},d),{},{eventType:ni.REQUEST_PROXY_APPCENTER,lts:l,eventElapse:l-r.lts,elapse:l-a.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Gt.REQUEST_PROXY_APPCENTER,data:h},!0)}requestProxyWorkerManager(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve({},d),{},{eventType:ni.REQUEST_PROXY_WORKER_MANAGER,lts:l,eventElapse:l-r.lts,elapse:l-a.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Gt.REQUEST_PROXY_WORKER_MANAGER,data:h},!0)}setProxyServer(i){this.proxyServer=i,I.debug(i?"reportProxyServerurl: ".concat(i):"disable reportProxyServerurl: ".concat(i))}peerPublishStatus(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve({},d),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:l,elapse:l-a.startTime,joinChannelSuccessElapse:l-(a.lastJoinSuccessTime||l),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Gt.PEER_PUBLISH_STATUS,data:h},!0)}workerEvent(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now();(function(p,m,_){const v=p[m];if(!v||"string"!=typeof v)return[p];p[m]="";const b=Fa(JSON.stringify(p));let y=0;const T=[];let M=0;for(let O=0;O<v.length;O++)M+=v.charCodeAt(O)<=127?1:3,M<=1300-b||(T[T.length]=Rd(Rd({},p),{},{[m]:v.substring(y,O)}),y=O,M=v.charCodeAt(O)<=127?1:3);return y!==v.length-1&&(T[T.length]=Rd(Rd({},p),{},{[m]:v.substring(y)})),T})(Ve(Ve(Ve({},d),r),{},{elapse:l-a.startTime,lts:l,productType:"WebRTC"}),"payload").forEach(p=>this.send({type:Gt.WORKER_EVENT,data:p},!0))}apworkerEvent(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve(Ve({},d),r),{},{elapse:l-a.startTime,lts:l});this.send({type:Gt.AP_WORKER_EVENT,data:h},!0)}joinWebProxyAP(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve(Ve({},d),r),{},{elapse:l-a.startTime,lts:l,extend:r.extend||void 0});this.send({type:Gt.JOIN_WEB_PROXY_AP,data:h},!0)}WebSocketQuit(i,r){const a=this.baseInfoMap.get(i);if(!a)return;const d=a.info,l=Date.now(),h=Ve(Ve(Ve({},d),r),{},{elapse:l-a.startTime,lts:l});this.send({type:Gt.WEBSOCKET_QUIT,data:h},!0)}sendCustomReportMessage(i,r){var a=this;return L(function*(){if(a.customReportCount+=r.length,a.customReportCount>V("CUSTOM_REPORT_LIMIT"))throw new ee(k.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);a.customReportCounterTimer||(a.customReportCounterTimer=window.setInterval(()=>{a.customReportCount=0},5e3));const d=Date.now(),l=r.map(h=>({type:Gt.USER_ANALYTICS,data:Ve(Ve({sid:i},h),{},{lts:d})}));try{V("NEW_REPORT_SERVER")?yield a.postDataToStatsCollector2(l):yield a.postDataToStatsCollector(l)}catch(h){throw I.error("send custom report message failed",h.toString()),new ee(k.CUSTOM_REPORT_SEND_FAILED,h.message)}})()}sendApiInvoke(i){const r=V("NOT_REPORT_EVENT");if(i.tag&&ye(r)&&ye(r).call(r,i.tag))return!1;if(null===i.sid)return this.apiInvokeUploadPendingItems.push(i),!1;const a=this.baseInfoMap.get(i.sid);if(!a)return this.apiInvokeUploadPendingItems.push(i),!1;const{cname:d,uid:l,cid:h}=a.info;let p;if(i.lts=i.lts||Date.now(),i.error)if(i.error instanceof ee){const{code:_,message:v}=i.error;p=_||v||i.error.toString()}else p=i.error.toString();const m={invokeId:i.invokeId,sid:i.sid,cname:d,cid:h,uid:l,lts:i.lts,success:i.success,elapse:i.lts-a.startTime,execElapse:i.lts-i.apiInvokeTime,apiName:i.name,options:i.options?JSON.stringify(i.options):void 0,execStates:i.states?JSON.stringify(i.states):void 0,execResult:i.result?JSON.stringify(i.result):void 0,errorCode:i.error?p:void 0,errorMsg:i.error?JSON.stringify(i.error):void 0};return this.send({type:Gt.API_INVOKE,data:m},!1),!0}appendSessionId(){op.__CLIENT_LIST__.forEach(i=>{if(i._sessionId){const r=this.apiInvokeUploadPendingItems.length;for(let a=0;a<r;a++){const d=this.apiInvokeUploadPendingItems.shift();d&&(d.sid=i._sessionId,this.sendApiInvoke(Object.assign({},d)))}}})}send(i,r){if(r)return this.keyEventUploadPendingItems.push(i),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(i),this.normalEventUploadPendingItems.length>V("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(i,r){const a=[],d=[];for(;i.length;){const h=i.shift();a.length<20?a.push(h):d.push(h)}i.push(...d);for(const h of[...a]){var l;-1!==this.ltsList.indexOf(h.data.lts)?(h.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(h.data.lts)):(this.ltsList.push(h.data.lts),dE(l=this.ltsList).call(l,(p,m)=>p-m))}return r||(this.lastSendNormalEventTime=Date.now()),V("ENABLE_EVENT_REPORT")&&a.length&&(V("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(a):this.postDataToStatsCollector(a)).catch((h=>p=>{V("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(h):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(h),this.normalEventUploadPendingItems.length>V("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-V("NORMAL_EVENT_QUEUE_CAPACITY")),I.warning("report: drop normal events"))))})(a)),i}postDataToStatsCollector2(i){var r=this;return L(function*(){Fn.networkState===Xi.OFFLINE&&(yield X.race([Fn.onlineWaiter,Un(2*Pn.maxRetryTimeout)]));const a=h=>{let p=new Uint8Array;return h.forEach(m=>{const _=NS(JSON.stringify(m.data)),v=new ArrayBuffer(5),b=(T=>{let M=0;return Object.entries(Gt).forEach(O=>{let[D,x]=O;x===T.type&&(M=EventNameToID[D])}),M})(m),y=new DataView(v);y.setUint16(0,_.byteLength,!0),y.setUint8(2,255&b),y.setUint8(3,b>>>8&255),y.setUint8(4,b>>>16&255),p=UE(p,new Uint8Array(v)),p=UE(p,_)}),p},d="event";let l=r.proxyServer?"https://".concat(r.proxyServer,"/rs/?h=").concat(V("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(d):"https://".concat(V("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(d);for(let h=0;h<2;h+=1){1===h&&(l=r.proxyServer?"https://".concat(r.proxyServer,"/rs/?h=").concat(V("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(d):"https://".concat(V("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(d));try{yield mm(l,{timeout:1e4,data:a(i),headers:Ve(Ve({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},r._appId&&{appid:r._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(p){if(1===h)throw p;continue}return}})()}postDataToStatsCollector(i){var r=arguments,a=this;return L(function*(){let d=r.length>1&&void 0!==r[1]&&r[1];const l={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:i.map(m=>JSON.stringify(m)),vid:(m=>{const _=m&&m.data.sid&&a.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(i[0])};Fn.networkState===Xi.OFFLINE&&(yield X.race([Fn.onlineWaiter,Un(2*Pn.maxRetryTimeout)]));const h=d?"/events/proto-raws":"/events/messages";let p=a.url||(a.proxyServer?"https://".concat(a.proxyServer,"/rs/?h=").concat(V("EVENT_REPORT_DOMAIN"),"&p=").concat(V("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(V("EVENT_REPORT_DOMAIN"),":").concat(V("STATS_COLLECTOR_PORT")).concat(h));for(let m=0;m<2;m+=1){1===m&&(p=a.backupUrl||(a.proxyServer?"https://".concat(a.proxyServer,"/rs/?h=").concat(V("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(V("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(V("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(V("STATS_COLLECTOR_PORT")).concat(h)));try{d?yield ja(p,{timeout:1e4,data:l}):yield mm(p,{timeout:1e4,data:l})}catch(_){if(1===m)throw _;continue}return}})()}createBaseInfo(i,r){const a=Object.assign({},DL);return a.sid=i,this.baseInfoMap.set(i,{info:a,startTime:r}),a}reportResourceTiming(i,r){const a=performance.getEntriesByName(i),d=a[a.length-1];d&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:d,tag:qt.TRACER}).onSuccess()}}function we(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(i,r,a){const d=a.value;if("function"==typeof d){const l=s.className||i.__className__||("AgoraRTCClient"===i.constructor.name?"Client":i.constructor.name);a.value=function(){for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];let _=p;if(s.argsMap)try{_=s.argsMap(this,...p)}catch(b){I.warning(b),_=[]}try{JSON.stringify(_)}catch{I.warning("arguments for method ".concat(l,".").concat(String(r)," not serializable for apiInvoke.")),_=[]}const v=(s.report||Ie).reportApiInvoke(this._sessionId||null,{name:"".concat(l,".").concat(String(r)),options:_,tag:qt.TRACER,reportResult:s.reportResult},s.throttleTime);try{const b=d.apply(this,p);return b instanceof X?b.then(y=>(v.onSuccess(s.reportResult&&y),y)).catch(y=>{throw v.onError(y),y}):(v.onSuccess(s.reportResult&&b),b)}catch(b){throw v.onError(b),b}}}return a}}S(op,"__CLIENT_LIST__",[]);const Ie=new op;sv.on("REPORT_LOG_UPLOAD",s=>{s.networkState=Fn.networkState,Ie.reportApiInvoke(null,{name:"logUploadError",options:s,tag:qt.TRACER})});const OL=["CHINA","GLOBAL"],Er=function(){const s="us".concat("erna","me"),i="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");const a=r.join(""),d=[];for(let p=0;p<6;p++)d.push("1");const l=d.join(""),h={};return h[s]=a,h[i]=l,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Er,iT||(_r.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],_r.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],_r.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],_r.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],_r.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],_r.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],_r.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",_r.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",_r.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",_r.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",_r.AREAS=["NORTH_AMERICA","OVERSEA"]);const RO=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Ld=[];function nu(s,i){return!!i&&Ld.some(r=>r.uid===s&&r.channelName===i)}op.__CLIENT_LIST__=Ld;var cT,vr,sp,Em,zr,Qi,oe,Ee,ce,Ae,xc,xe,AO,vi,Me,qn,kc,NL=uc("Array").values,PL=dd,ap=$t,vm=Ds,DO=NL,Lc=Array.prototype,ML={DOMTokenList:!0,NodeList:!0},ca=Rt(function(s){var i=s.values;return s===Lc||vm(Lc,s)&&i===Lc.values||ap(ML,PL(s))?DO:i});function ne(s,i,r,a){var d,l=arguments.length,h=l<3?i:null===a?a=Object.getOwnPropertyDescriptor(i,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(s,i,r,a);else for(var p=s.length-1;p>=0;p--)(d=s[p])&&(h=(l<3?d(h):l>3?d(i,r,h):d(i,r))||h);return l>3&&h&&Object.defineProperty(i,r,h),h}function N(s,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(s,i)}(function(s){s.L1T1="L1T1",s.L1T2="L1T2",s.L1T3="L1T3",s.L2T1_KEY="L2T1_KEY",s.L2T2_KEY="L2T2_KEY",s.L2T3_KEY="L2T3_KEY",s.L3T1_KEY="L3T1_KEY",s.L3T2_KEY="L3T2_KEY",s.L3T3_KEY="L3T3_KEY"})(cT||(cT={})),function(s){s.CERTIFICATE="certificate",s.CODEC="codec",s.CANDIDATE_PAIR="candidate-pair",s.LOCAL_CANDIDATE="local-candidate",s.REMOTE_CANDIDATE="remote-candidate",s.INBOUND="inbound-rtp",s.TRACK="track",s.OUTBOUND="outbound-rtp",s.PC="peer-connection",s.REMOTE_INBOUND="remote-inbound-rtp",s.REMOTE_OUTBOUND="remote-outbound-rtp",s.TRANSPORT="transport",s.CSRC="csrc",s.DATA_CHANNEL="data-channel",s.STREAM="stream",s.SENDER="sender",s.RECEIVER="receiver"}(vr||(vr={})),function(s){s[s.ACCESS_POINT=101]="ACCESS_POINT",s[s.UNILBS=201]="UNILBS",s[s.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(sp||(sp={})),function(s){s[s.IIIEGAL_APPID=1]="IIIEGAL_APPID",s[s.IIIEGAL_UID=2]="IIIEGAL_UID",s[s.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(Em||(Em={})),function(s){s[s.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",s[s.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",s[s.INTERNAL_ERROR=8]="INTERNAL_ERROR",s[s.NO_AUTHORIZED=9]="NO_AUTHORIZED",s[s.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",s[s.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",s[s.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",s[s.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",s[s.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",s[s.USER_OVERLOAD=16]="USER_OVERLOAD",s[s.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",s[s.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(zr||(zr={})),function(s){s[s.NO_FLAG_SET=100]="NO_FLAG_SET",s[s.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",s[s.INVALID_FALG_SET=102]="INVALID_FALG_SET",s[s.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",s[s.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",s[s.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",s[s.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",s[s.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",s[s.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",s[s.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",s[s.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",s[s.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",s[s.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",s[s.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",s[s.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",s[s.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",s[s.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",s[s.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",s[s.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(Qi||(Qi={})),function(s){s[s.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",s[s.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",s[s.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",s[s.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",s[s.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",s[s.K_TICKET_INVALID=7]="K_TICKET_INVALID",s[s.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",s[s.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",s[s.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",s[s.K_UID_BANNED=14]="K_UID_BANNED",s[s.K_IP_BANNED=15]="K_IP_BANNED",s[s.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",s[s.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",s[s.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",s[s.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",s[s.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",s[s.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",s[s.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",s[s.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",s[s.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",s[s.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",s[s.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",s[s.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",s[s.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",s[s.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",s[s.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",s[s.ERR_INVALID_UID=117]="ERR_INVALID_UID",s[s.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",s[s.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",s[s.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",s[s.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",s[s.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",s[s.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",s[s.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",s[s.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",s[s.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",s[s.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",s[s.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",s[s.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",s[s.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",s[s.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",s[s.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",s[s.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",s[s.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",s[s.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",s[s.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",s[s.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",s[s.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",s[s.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",s[s.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",s[s.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",s[s.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",s[s.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",s[s.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",s[s.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",s[s.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",s[s.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",s[s.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",s[s.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",s[s.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",s[s.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",s[s.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",s[s.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",s[s.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(oe||(oe={})),function(s){s.CONNECTING="connecting",s.CONNECTED="connected",s.RECONNECTING="reconnecting",s.CLOSED="closed"}(Ee||(Ee={})),function(s){s.WS_CONNECTED="ws_connected",s.WS_RECONNECTING="ws_reconnecting",s.WS_CLOSED="ws_closed",s.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",s.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",s.ON_BINARY_DATA="on_binary_data",s.REQUEST_RECOVER="request_recover",s.REQUEST_JOIN_INFO="request_join_info",s.REQUEST_REJOIN_INFO="req_rejoin_info",s.IS_P2P_DISCONNECTED="is_p2p_dis",s.DISCONNECT_P2P="dis_p2p",s.ABORT_P2P_EXECUTION="abort_p2p_execution",s.NEED_RENEW_SESSION="need-sid",s.REPORT_JOIN_GATEWAY="report_join_gateway",s.REQUEST_TIMEOUT="request_timeout",s.REQUEST_SUCCESS="request_success",s.JOIN_RESPONSE="join_response",s.DATACHANNEL_PRECONNECT="datachannel_preconnect",s.DATACHANNEL_CONNECTING="datachannel_connecting",s.DATACHANNEL_FAILBACK="datachannel_failback",s.P2P_CONNECTION="p2p_connection",s.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",s.P2P_SUBSCRIBE="p2p_subscribe",s.P2P_UNSUBSCRIBE="p2p_unsubscribe",s.P2P_EXCHANGE_SDP="p2p_exchange_sdp",s.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",s.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream"}(ce||(ce={})),function(s){s.PING="ping",s.PING_BACK="ping_back",s.JOIN="join_v3",s.REJOIN="rejoin_v3",s.LEAVE="leave",s.SET_CLIENT_ROLE="set_client_role",s.PUBLISH="publish",s.PUBLISH_DATASTREAM="publish_datastream",s.UNPUBLISH="unpublish",s.UNPUBLISH_DATASTREAM="unpublish_datastream",s.SUBSCRIBE="subscribe",s.PRE_SUBSCRIBE="pre_subscribe",s.SUBSCRIBE_DATASTREAM="subscribe_datastream",s.SUBSCRIBE_STREAMS="subscribe_streams",s.UNSUBSCRIBE="unsubscribe",s.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",s.UNSUBSCRIBE_STREAMS="unsubscribe_streams",s.SUBSCRIBE_CHANGE="subscribe_change",s.TRAFFIC_STATS="traffic_stats",s.RENEW_TOKEN="renew_token",s.SWITCH_VIDEO_STREAM="switch_video_stream",s.DEFAULT_VIDEO_STREAM="default_video_stream",s.SET_FALLBACK_OPTION="set_fallback_option",s.GATEWAY_INFO="gateway_info",s.CONTROL="control",s.SEND_METADATA="send_metadata",s.DATA_STREAM="data_stream",s.PICK_SVC_LAYER="pick_svc_layer",s.RESTART_ICE="restart_ice",s.CONNECT_PC="connect_pc",s.SET_VIDEO_PROFILE="set_video_profile",s.SET_PARAMETER="set_parameter",s.SET_RTM2_FLAG="set_rtm2_flag"}(Ae||(Ae={})),function(s){s.WRTC_STATS="wrtc_stats",s.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",s.DENOISER_STATS="denoiser_stats",s.EXTENSION_USAGE_STATS="extension_usage_stats"}(xc||(xc={})),function(s){s.ON_USER_ONLINE="on_user_online",s.ON_USER_OFFLINE="on_user_offline",s.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",s.ON_PUBLISH_STREAM="on_publish_stream",s.ON_UPLINK_STATS="on_uplink_stats",s.ON_P2P_LOST="on_p2p_lost",s.ON_REMOVE_STREAM="on_remove_stream",s.ON_ADD_AUDIO_STREAM="on_add_audio_stream",s.ON_ADD_VIDEO_STREAM="on_add_video_stream",s.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",s.ON_USER_BANNED="on_user_banned",s.ON_USER_LICENSE_BANNED="on_user_license_banned",s.ON_NOTIFICATION="on_notification",s.ON_CRYPT_ERROR="on_crypt_error",s.MUTE_AUDIO="mute_audio",s.MUTE_VIDEO="mute_video",s.UNMUTE_AUDIO="unmute_audio",s.UNMUTE_VIDEO="unmute_video",s.ON_P2P_OK="on_p2p_ok",s.RECEIVE_METADATA="receive_metadata",s.ON_DATA_STREAM="on_data_stream",s.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",s.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",s.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",s.ENABLE_LOCAL_VIDEO="enable_local_video",s.DISABLE_LOCAL_VIDEO="disable_local_video",s.ENABLE_LOCAL_AUDIO="enable_local_audio",s.DISABLE_LOCAL_AUDIO="disable_local_audio",s.ON_PUBLISHED_USER_LIST="on_published_user_list"}(xe||(xe={})),function(s){s.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",s.NEED_ANSWER="NEED_ANSWER",s.NEED_RENEGOTIATE="NEED_RENEGOTIATE",s.P2P_LOST="P2P_LOST",s.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",s.NEED_UNPUB="NEED_UNPUB",s.NEED_UNSUB="NEED_UNSUB",s.NEED_UPLOAD="NEED_UPLOAD",s.NEED_CONTROL="NEED_CONTROL",s.START_RECONNECT="START_RECONNECT",s.END_RECONNECT="END_RECONNECT",s.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(AO||(AO={})),function(s){s.SEND_ONLY="SEND_ONLY",s.RECEIVE_ONLY="RECEIVE_ONLY"}(vi||(vi={})),function(s){s.CONNECTED="websocket:connected",s.RECONNECTING="websocket:reconnecting",s.WILL_RECONNECT="websocket:will_reconnect",s.CLOSED="websocket:closed",s.FAILED="websocket:failed",s.ON_MESSAGE="websocket:on_message",s.REQUEST_NEW_URLS="websocket:request_new_urls",s.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",s.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(Me||(Me={}));class W extends ee{constructor(i){super(i,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),S(this,"name","AgoraRTCException")}print(){return super.print(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",I)}throw(){super.throw(I)}}function OO(s){if("string"!=typeof s||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(s))throw I.error("Invalid Channel Name ".concat(s)),new W(k.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function dv(s){if(!("number"==typeof(i=s)&&Math.floor(i)===i&&0<=i&&i<=4294967295||OS(s,1,255)))throw new W(k.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var i;"string"==typeof s&&I.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}(function(s){s.TRANSCODE="mix_streaming",s.RAW="raw_streaming",s.INJECT="inject_streaming"})(qn||(qn={})),function(s){s[s.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",s[s.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",s[s.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",s[s.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",s[s.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",s[s.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",s[s.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",s[s.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",s[s.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",s[s.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",s[s.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(kc||(kc={}));const NO={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},PO={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Vn(s,i){hi(s.url,"".concat(i,".url"),1,1e3,!1),nn(s.x)||At(s.x,"".concat(i,".x"),0,1e4),nn(s.y)||At(s.y,"".concat(i,".y"),0,1e4),nn(s.width)||At(s.width,"".concat(i,".width"),0,1e4),nn(s.height)||At(s.height,"".concat(i,".height"),0,1e4),nn(s.zOrder)||At(s.zOrder,"".concat(i,".zOrder"),0,255),nn(s.alpha)||At(s.alpha,"".concat(i,".alpha"),0,1,!1)}const xL={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},kL={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var Vs,da,Mn,bm,Si,bi,sr,Fc,ut,on,Fd,Bn,ym,st;function MO(s){if(!s.channelName)throw new W(k.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof s.uid)throw new W(k.INVALID_PARAMS,"invalid uid in info, uid must be a number");return s.token&&hi(s.token,"info.token",1,2047),dv(s.uid),OO(s.channelName),!0}(function(s){s.WARNING="@live_uap-warning",s.ERROR="@line_uap-error",s.PUBLISH_STREAM_STATUS="@live_uap-publish-status",s.INJECT_STREAM_STATUS="@live_uap-inject-status",s.WORKER_STATUS="@live_uap-worker-status",s.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(Vs||(Vs={})),function(s){s.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(da||(da={})),function(s){s[s.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",s[s.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",s[s.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",s[s.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",s[s.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",s[s.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",s[s.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",s[s.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",s[s.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",s[s.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",s[s.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",s[s.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",s[s.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",s[s.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",s[s.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",s[s.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",s[s.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",s[s.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",s[s.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Mn||(Mn={})),function(s){s.CONNECT_FAILED="connect failed",s.CONNECT_TIMEOUT="connect timeout",s.WS_DISCONNECTED="websocket disconnected",s.REQUEST_TIMEOUT="request timeout",s.REQUEST_FAILED="request failed",s.WAIT_STATUS_TIMEOUT="wait status timeout",s.WAIT_STATUS_ERROR="wait status error",s.BAD_STATE="bad state",s.WS_ABORT="ws abort",s.AP_REQUEST_TIMEOUT="AP request timeout",s.AP_JSON_PARSE_ERROR="AP json parse error",s.AP_REQUEST_ERROR="AP request error",s.AP_REQUEST_ABORT="AP request abort"}(bm||(bm={})),function(s){s[s.SetSdkProfile=0]="SetSdkProfile",s[s.SetSourceChannel=1]="SetSourceChannel",s[s.SetSourceUserId=2]="SetSourceUserId",s[s.SetDestChannel=3]="SetDestChannel",s[s.StartPacketTransfer=4]="StartPacketTransfer",s[s.StopPacketTransfer=5]="StopPacketTransfer",s[s.UpdateDestChannel=6]="UpdateDestChannel",s[s.Reconnect=7]="Reconnect",s[s.SetVideoProfile=8]="SetVideoProfile"}(Si||(Si={})),function(s){s.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",s.NETWORK_CONNECTED="NETWORK_CONNECTED",s.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",s.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",s.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",s.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",s.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",s.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",s.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",s.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(bi||(bi={})),function(s){s.RELAY_STATE_IDLE="RELAY_STATE_IDLE",s.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",s.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",s.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(sr||(sr={})),function(s){s.RELAY_OK="RELAY_OK",s.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",s.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",s.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(Fc||(Fc={})),function(s){s.High="high",s.Low="low",s.Audio="audio",s.Screen="screen",s.ScreenLow="screen_low"}(ut||(ut={})),function(s){s.DISCONNECT="disconnect",s.CONNECTION_STATE_CHANGE="connection-state-change",s.NETWORK_QUALITY="network-quality",s.STREAM_TYPE_CHANGE="stream-type-change",s.IS_P2P_DISCONNECTED="is-p2p-dis",s.DISCONNECT_P2P="dis-p2p",s.REQUEST_NEW_GATEWAY_LIST="req-gate-url",s.NEED_RENEW_SESSION="need-sid",s.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",s.JOIN_RESPONSE="join-response",s.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",s.RESET_CONNECTION_EVENTS="reset-connection-events",s.DATACHANNEL_PRECONNECT="datachannel_preconnect",s.DATACHANNEL_FAILBACK="datachannel_failback",s.RESET_SIGNAL="reset-signal"}(on||(on={})),function(s){s.P2P_DISCONNECTED="P2P_DISCONNECTED",s.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",s.TIMEOUT="TIMEOUT",s.UNKNOWN_REASON="UNKNOWN_REASON"}(Fd||(Fd={})),function(s){s[s.Nothing=0]="Nothing",s[s.Audio=1]="Audio",s[s.LwoVideo=2]="LwoVideo",s[s.Video=4]="Video",s[s.Data=8]="Data",s[s.DataStream0=256]="DataStream0",s[s.DataStream1=512]="DataStream1",s[s.DataStream2=1024]="DataStream2",s[s.DataStream3=2048]="DataStream3",s[s.DataStream4=4096]="DataStream4",s[s.DataStream5=8192]="DataStream5",s[s.DataStream6=16384]="DataStream6",s[s.DataStream7=32768]="DataStream7"}(Bn||(Bn={})),function(s){s[s.websocket=0]="websocket",s[s.datachannel=1]="datachannel"}(ym||(ym={})),function(s){s.CHINA="CHINA",s.ASIA="ASIA",s.NORTH_AMERICA="NORTH_AMERICA",s.EUROPE="EUROPE",s.JAPAN="JAPAN",s.INDIA="INDIA",s.KOREA="KOREA",s.HKMC="HKMC",s.US="US",s.OCEANIA="OCEANIA",s.SOUTH_AMERICA="SOUTH_AMERICA",s.AFRICA="AFRICA",s.OVERSEA="OVERSEA",s.GLOBAL="GLOBAL",s.EXTENSIONS="EXTENSIONS"}(st||(st={}));const xO=[st.AFRICA,st.ASIA,st.CHINA,st.EUROPE,st.GLOBAL,st.INDIA,st.JAPAN,st.NORTH_AMERICA,st.OCEANIA,st.OVERSEA,st.SOUTH_AMERICA];var Yn;!function(s){s.CHINA="CN",s.ASIA="AS",s.NORTH_AMERICA="NA",s.EUROPE="EU",s.JAPAN="JP",s.INDIA="IN",s.KOREA="KR",s.HKMC="HK",s.US="US",s.OCEANIA="OC",s.SOUTH_AMERICA="SA",s.AFRICA="AF",s.OVERSEA="OVERSEA",s.GLOBAL="GLOBAL",s.EXTENSIONS="GLOBAL"}(Yn||(Yn={}));const lv={CHINA:{},ASIA:{CODE:Yn.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Yn.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Yn.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Yn.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Yn.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Yn.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Yn.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Yn.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Yn.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Yn.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Yn.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Yn.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Yn.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};var Cm,kO,Ce,Mi,Bs,re,Dt,Oe,cp,Oo,No,ii,la,fn,ls,LO,Kr,us,Ud,mn,iu,Uc,LL,uv;iT&&(lv.CHINA={CODE:Yn.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(s){s.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(Cm||(Cm={}));class Sm extends jt{constructor(i,r){super(),S(this,"onICEConnectionStateChange",void 0),S(this,"onConnectionStateChange",void 0),S(this,"onDTLSTransportStateChange",void 0),S(this,"onDTLSTransportError",void 0),S(this,"onICETransportStateChange",void 0),S(this,"onFirstAudioReceived",void 0),S(this,"onFirstVideoReceived",void 0),S(this,"onFirstAudioDecoded",void 0),S(this,"onFirstVideoDecoded",void 0),S(this,"onFirstVideoDecodedTimeout",void 0),S(this,"onSelectedLocalCandidateChanged",void 0),S(this,"onSelectedRemoteCandidateChanged",void 0)}}class hv extends Sm{constructor(i,r){super(i,r)}}(function(s){s.SEND="sendonly",s.RECV="recvonly",s.SENDRECV="sendrecv",s.INACTIVE="inactive"})(kO||(kO={})),function(s){s.VIDEO="video",s.AUDIO="audio"}(Ce||(Ce={})),function(s){s[s.UDP=0]="UDP",s[s.TCP=1]="TCP",s[s.RELAY=2]="RELAY"}(Mi||(Mi={})),function(s){s[s.FIRST_CONNECTION=0]="FIRST_CONNECTION",s[s.TCP_RESTART=1]="TCP_RESTART",s[s.RELAY_RESTART=2]="RELAY_RESTART",s[s.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",s[s.OLD_RESTART=11]="OLD_RESTART",s[s.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(Bs||(Bs={})),function(s){s.LocalVideoTrack="videoTrack",s.LocalAudioTrack="audioTrack",s.LocalVideoLowTrack="videoLowTrack"}(re||(re={})),function(s){s.New="new",s.Connected="connected",s.Reconnecting="reconnecting",s.Disconnected="disconnected"}(Dt||(Dt={})),function(s){s.StateChange="stateChange",s.IceConnectionStateChange="iceConnectionStateChange",s.RequestMuteLocal="requestMuteLocal",s.RequestUnmuteLocal="requestUnmuteLocal",s.RequestRePublish="requestRePublish",s.RequestRePublishDataChannel="requestRePublishDataChannel",s.RequestReSubscribe="requestReSubscribe",s.RequestUploadStats="requestUploadStats",s.RequestUpload="requestUpload",s.MediaReconnectStart="MediaReconnectStart",s.MediaReconnectEnd="MediaReconnectEnd",s.NeedSignalRTT="NeedSignalRTT",s.RequestRestartICE="RequestRestartIce",s.PeerConnectionStateChange="PeerConnectionStateChange",s.RequestReconnect="RequestReconnect",s.RequestReconnectPC="RequestReconnectPC",s.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",s.P2PLost="P2PLost",s.UpdateVideoEncoder="UpdateVideoEncoder",s.ConnectionTypeChange="ConnectionTypeChange",s.RequestLowStreamParameter="RequestLowStreamParameter",s.QueryClientConnectionState="QueryClientConnectionState",s.LocalCandidate="LocalCandidate",s.RequestP2PMuteLocal="requestP2PMuteLocal",s.RequestP2PUnPublish="RequestP2PUnPublish",s.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",s.RequestP2PMuteRemote="RequestP2PMuteRemote",s.RequestP2PRestartICE="RequestP2PRestartICE"}(Oe||(Oe={})),function(s){s.MUTE_LOCAL_VIDEO="mute_local_video",s.MUTE_LOCAL_AUDIO="mute_local_audio",s.UNMUTE_LOCAL_VIDEO="unmute_local_video",s.UNMUTE_LOCAL_AUDIO="unmute_local_audio",s.MUTE_REMOTE_VIDEO="mute_remote_video",s.MUTE_REMOTE_AUDIO="mute_remote_audio",s.UNMUTE_REMOTE_VIDEO="unmute_remote_video",s.UNMUTE_REMOTE_AUDIO="unmute_remote_audio"}(cp||(cp={})),function(s){s.CONNECTING="CONNECTING",s.RECONNECTING="RECONNECTING",s.CONNECTED="CONNECTED",s.CLOSED="CLOSED"}(Oo||(Oo={})),function(s){s[s.CONNECT_AP=0]="CONNECT_AP",s[s.AP_CONNECTED=1]="AP_CONNECTED",s[s.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",s[s.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",s[s.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",s[s.CONNECT_WORKER=5]="CONNECT_WORKER",s[s.WORKER_CONNECTED=6]="WORKER_CONNECTED",s[s.CLOSED=7]="CLOSED"}(No||(No={})),function(s){s.CONNECTION_STATE_CHANGE="connection-state-change",s.STATE_CHANGE="state-change",s.INSPECT_RESULT="inspect-result",s.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",s.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(ii||(ii={})),function(s){s.NETWORK_ERROR="NETWORK_ERROR",s.SERVER_ERROR="SERVER_ERROR",s.MULTI_IP="MULTI_IP",s.TIMEOUT="TIMEOUT",s.OFFLINE="OFFLINE",s.LEAVE="LEAVE",s.P2P_FAILED="P2P_FAILED",s.FALLBACK="FALLBACK"}(la||(la={})),function(s){s.CONNECTED="transmitter:connected",s.RECONNECTING="transmitter:reconnecting",s.WILL_RECONNECT="transmitter:will_reconnect",s.CLOSED="transmitter:closed",s.FAILED="transmitter:failed",s.ON_MESSAGE="transmitter:on_message",s.REQUEST_NEW_URLS="transmitter:request_new_urls",s.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",s.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",s.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",s.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",s.FAILBACK="transmitter:failback"}(fn||(fn={})),function(s){s.CAMERA_CHANGED="camera-changed",s.MICROPHONE_CHANGED="microphone-changed",s.PLAYBACK_DEVICE_CHANGED="playback-device-changed",s.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",s.AUTOPLAY_FAILED="autoplay-failed",s.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",s.SECURITY_POLICY_VIOLATION="security-policy-violation"}(ls||(ls={})),function(s){s[s.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",s[s.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",s[s.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",s[s.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",s[s.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",s[s.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",s[s.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",s[s.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",s[s.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",s[s.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",s[s.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",s[s.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",s[s.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",s[s.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",s[s.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",s[s.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",s[s.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",s[s.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",s[s.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",s[s.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(LO||(LO={})),function(s){s.CONNECTING="CONNECTING",s.RECONNECTING="RECONNECTING",s.CONNECTED="CONNECTED",s.CLOSED="CLOSED"}(Kr||(Kr={})),function(s){s.CONNECTION_STATE_CHANGE="connection-state-change",s.STATE_CHANGE="state-change",s.INSPECT_RESULT="inspect-result",s.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",s.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(us||(us={})),function(s){s[s.CONNECT_AP=0]="CONNECT_AP",s[s.AP_CONNECTED=1]="AP_CONNECTED",s[s.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",s[s.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",s[s.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",s[s.CONNECT_WORKER=5]="CONNECT_WORKER",s[s.WORKER_CONNECTED=6]="WORKER_CONNECTED",s[s.CLOSED=7]="CLOSED"}(Ud||(Ud={})),function(s){s.CALL="call",s.CANDIDATE="candidate",s.PUBLISH="publish",s.UNPUBLISH="unpublish",s.CONTROL="control",s.RESTART_ICE="restart_ice",s.ACK="ack",s.RESPONSE="response",s.JOIN="join",s.CHECK="check"}(mn||(mn={})),function(s){s.ABORT="abort"}(iu||(iu={})),function(s){s.MUTE_LOCAL_AUDIO="mute_local_audio",s.MUTE_LOCAL_VIDEO="mute_local_video",s.UNMUTE_LOCAL_AUDIO="unmute_local_audio",s.UNMUTE_LOCAL_VIDEO="unmute_local_video"}(Uc||(Uc={})),function(s){s[s.SUCCESS=1]="SUCCESS",s[s.FAILED=0]="FAILED"}(LL||(LL={})),function(s){s.P2P_TOKEN_TIMEOUT="p2p_token_timeout",s.P2P_TOKEN_CHANGED="p2p_token_changed"}(uv||(uv={}));const FL={[sp.ACCESS_POINT]:{[Qi.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Qi.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Qi.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Qi.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Qi.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Qi.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Qi.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Qi.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Qi.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Qi.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Qi.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Qi.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Qi.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Qi.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Qi.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Qi.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Qi.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Qi.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[sp.UNILBS]:{[zr.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[zr.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[zr.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[zr.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[zr.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[zr.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[zr.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[zr.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[zr.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[zr.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[zr.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[zr.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[sp.STRING_UID_ALLOCATOR]:{[Em.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Em.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Em.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Tm(s){const i=FL[Math.floor(s/1e4)];if(!i)return{desc:"unkonw error",retry:!1};const r=i[s%1e4];if(!r){if(Math.floor(s/1e4)===sp.ACCESS_POINT){const a=s%1e4;if("1"===a.toString()[0])return{desc:s.toString(),retry:!1};if("2"===a.toString()[0])return{desc:s.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return r}const Im={[oe.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[oe.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[oe.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[oe.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[oe.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[oe.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[oe.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[oe.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[oe.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[oe.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[oe.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[oe.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[oe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[oe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[oe.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[oe.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[oe.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[oe.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[oe.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[oe.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[oe.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[oe.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[oe.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[oe.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[oe.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[oe.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[oe.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[oe.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[oe.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[oe.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[oe.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[oe.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[oe.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[oe.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[oe.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[oe.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[oe.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[oe.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[oe.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[oe.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[oe.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[oe.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[oe.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[oe.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[oe.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[oe.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[oe.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[oe.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[oe.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[oe.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[oe.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[oe.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[oe.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[oe.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[oe.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[oe.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[oe.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[oe.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[oe.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[oe.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[oe.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[oe.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[oe.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function ru(s){return Im[s]||{desc:"UNKNOW_ERROR_".concat(s),action:"failed"}}function FO(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function dT(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?FO(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):FO(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function UO(s){return s.every(i=>i.readyState===WebSocket.CLOSED||i.readyState===WebSocket.CLOSING)}function UL(s,i){if("string"==typeof s)return s;const{proxy:r,host:a,port:d}=s;if(i){const l=V("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===l?"wss://".concat(a,"/ws/?p=").concat(Number(d)+150):"wss://".concat(a,":").concat(l,"/ws/?p=").concat(Number(d)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(a,"&p=").concat(d):"wss://".concat(a,":").concat(d)}const VL=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,VO=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,BL=/wss:\/\/(.+):([0-9]+)\/?/,jL=/wss:\/\/(.[^\/]+)\/?/;let wm=0;class HL{constructor(i,r){S(this,"id",0),S(this,"store",void 0),S(this,"recordIndex",void 0),S(this,"websockets",[]),S(this,"try443PortDuration",2e3),S(this,"forceCloseWSDuration",5e3),S(this,"try443PortTimeout",null),S(this,"forceCloseTimeout",null),S(this,"isTry443PortFailed",!1),S(this,"isNormalPortFailed",!1),S(this,"useDoubleDomain",!1),S(this,"useProxy",!1),S(this,"startTime",Date.now()),this.id=++wm,this.try443PortDuration=V("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=i||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach(i=>{i.onopen=null,i.onclose=null,i.onmessage=null,i.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var i;const r=Date.now()-this.startTime;for(var a=arguments.length,d=new Array(a),l=0;l<a;l++)d[l]=arguments[l];I.debug("[choose-best-ws ".concat(null===(i=this.store)||void 0===i?void 0:i.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...d)}createWebSocket(i,r,a){this.logger("createWebSocket:",i,{isTry443Port:r,hasTimeoutDetection:a});const d=V("GATEWAY_DOMAINS"),l=Date.now(),h=[],p=d.find(v=>{var b;return ye(b=i.host).call(b,v)});p||(this.useDoubleDomain=!1);const m=[];if(this.useDoubleDomain)d.forEach(v=>{m.push(UL(dT(dT({},i),{},{host:i.host.replace(p,v)}),r))});else{const v=dT({},i);if(r&&p){const b=d.find(y=>y!==p);b&&(v.host=v.host.replace(p,b))}m.push(UL(v,r))}try{m.forEach(v=>{const b=new WebSocket(v);b.binaryType="arraybuffer",h.push(b),this.logger("ws is connecting:",b.url)})}catch(v){if(this.logger("ws create failed"),h.forEach(b=>b.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(i,r,a);if(!r&&443!==Number(i.port))return this.createWebSocket(i,!0,a);throw new W(k.WS_ERR,"init websocket failed! Error: ".concat(v.toString()))}const _=em();return this.store&&this.store.recordJoinChannelService({urls:h.map(v=>v.url),service:"gateway"},this.recordIndex),h.forEach(v=>{v.onopen=()=>{this.logger("onopen: ws ".concat(v.url," open cost ").concat(Date.now()-l,"ms")),this.websockets.forEach(b=>{b!==v&&(b.onopen=null,b.onclose=null,b.onmessage=null,b.close(),this.logger("close backup websocket: ".concat(b.url)))}),this.websockets.length=0,_.resolve(v)},v.onclose=b=>{this.logger("onclose: ws ".concat(v.url," closed cost ").concat(Date.now()-l,"ms state: ").concat(v.readyState)),r?this.isTry443PortFailed=UO(h):this.isNormalPortFailed=UO(h),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(r&&this.isTry443PortFailed||!r&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(b.reason)),_.reject({code:b.code,reason:Fd.A_ROUND_WS_FAILED}))},v.onmessage=b=>this.logger("".concat(v.url," onmessage: ").concat(b.data))}),this.websockets.push(...h),a||(()=>{const v=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",_.isResolved),this.websockets.forEach(b=>b.readyState!==WebSocket.OPEN&&b.close())};if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(v,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",_.isResolved),_.isResolved)return v();lt().os===ei.MAC_OS&&Pt()&&v(),this.createWebSocket(i,!0,!0).then(b=>_.resolve(b)).catch(b=>{this.isNormalPortFailed&&_.reject(b),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(v,this.forceCloseWSDuration)},this.try443PortDuration)})(),_.promise}chooseBestWebsocket(i,r,a,d){return this.useDoubleDomain=!!r,"string"==typeof i&&(i=function(l){let h,p,m;return[,h,p,m]=l.match(VL)||[],h||([,p,m]=l.match(VO)||[]),p&&m||([,p,m]=l.match(BL)||[]),p&&m||([,p]=l.match(jL)||[]),p||I.warning("un-destructible url: ",l),{proxy:h,host:p,port:m||"443"}}(i)),this.recordIndex=d,this.useProxy=!!i.proxy,a&&this.useProxy&&(I.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(i,!!a,!1).finally(()=>this.clearTimeout())}}function lT(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}class BO extends jt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){var r;ye(r=["tryNext","recover"]).call(r,i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,"reconnecting"===this._state?this.emit(Me.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Me.CONNECTED):"closed"===this._state?this.emit(Me.CLOSED):"failed"===this._state&&this.emit(Me.FAILED))}resetReconnectCount(i){I.debug("websocket reset reconnect count, reason: "+i),this.reconnectCount=0}constructor(i,r){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),S(this,"connectionID",0),S(this,"currentURLIndex",0),S(this,"urls",[]),S(this,"_reconnectMode","tryNext"),S(this,"reconnectReason",void 0),S(this,"_initMutex",new Ei("websocket")),S(this,"name",void 0),S(this,"_state","closed"),S(this,"reconnectInterrupter",void 0),S(this,"websocket",void 0),S(this,"retryConfig",void 0),S(this,"reconnectCount",0),S(this,"forceCloseTimeout",5e3),S(this,"onlineReconnectListener",void 0),S(this,"useCompress",void 0),S(this,"tryDoubleDomain",!1),S(this,"use443PortOnly",!1),S(this,"wsInflateLength",0),S(this,"wsDeflateLength",0),S(this,"closeEstablishingWs",()=>{}),S(this,"store",void 0),S(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=i,this.retryConfig=function(b){for(var y=1;y<arguments.length;y++){var T=null!=arguments[y]?arguments[y]:{};y%2?lT(Object(T),!0).forEach(function(M){S(b,M,T[M])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(T)):lT(Object(T)).forEach(function(M){Object.defineProperty(b,M,Object.getOwnPropertyDescriptor(T,M))})}return b}({},r),this.useCompress=a,this.tryDoubleDomain=d,this.use443PortOnly=l;const{timeout:p,timeoutFactor:m}=r,_=Math.max(300,Math.floor(3*p/5)),v=Math.max(1.2,Math.floor(8*m)/10);Xi.ONLINE&&(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=v),Fn.on(Rc.NETWORK_STATE_CHANGE,(b,y)=>{b!==y&&(this.resetReconnectCount("network state change: ".concat(y," -> ").concat(b)),b===Xi.ONLINE?(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=v):(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}init(i){var r=arguments,a=this;return L(function*(){let d=r.length>1&&void 0!==r[1]?r[1]:5e3;const l=yield a._initMutex.lock();a.forceCloseTimeout=d,a.urls=i,a.state="connecting";try{const h=em();a.createWebSocketConnection(a.urls[a.currentURLIndex]).then(h.resolve).catch(h.reject),a.once(Me.CLOSED,()=>{h.reject(new ee(k.WS_DISCONNECT))}),a.once(Me.CONNECTED,h.resolve),yield h.promise}catch{}finally{l()}})()}close(i,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;r?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0}this.state=i?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(i,r){if(!this.websocket)return void I.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==i&&(this.reconnectMode=i),I.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:r})}sendMessage(i){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ee(k.WS_ABORT,"websocket is not ready");try{r||(i=JSON.stringify(i)),this.websocket.send(i)}catch(a){throw new ee(k.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(i){this.wsDeflateLength=this.wsDeflateLength+i.originLength,this.wsInflateLength=this.wsInflateLength+i.compressedLength}getWsInflateData(){const i=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:i,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}createWebSocketConnection(i){var r=this;return L(function*(){var a;const d=em();r.connectionID+=1,r.joinGatewayRecordIndex=void 0;const l=b=>{var y;null===(y=r.store)||void 0===y||y.signalChannelOpen(),I.debug("[".concat(r.name,"] websocket opened:"),b),r.reconnectMode="retry",r.state="connected",r.resetReconnectCount("opened"),d.resolve()},h=function(){var b=L(function*(y){var T;if(I.debug("[".concat(r.name,"] websocket close ").concat(null===(T=r.websocket)||void 0===T?void 0:T.url,", code: ").concat(y.code,", reason: ").concat(y.reason,", current mode: ").concat(r.reconnectMode)),r.reconnectCount>=r.retryConfig.maxRetryCount)d.reject(new ee(k.WS_DISCONNECT,"websocket close: ".concat(y.code))),r.close();else{"connected"===r.state&&(r.reconnectReason=y.reason,r.state="reconnecting");const M=Pr(r,Me.WILL_RECONNECT,r.reconnectMode,y.reason)||r.reconnectMode,O=yield r.reconnectWithAction(M);if("closed"===r.state)return void I.debug("[".concat(r.connectionID,"] ws is closed, no need to reconnect"));if(!O)return d.reject(new ee(k.WS_DISCONNECT,"websocket reconnect failed: ".concat(y.code))),r.close(!0);d.resolve()}});return function(T){return b.apply(this,arguments)}}(),p=b=>{r.emit(Me.ON_MESSAGE,b)},m=b=>{I.warn("[".concat(r.connectionID,"] ws open error ").concat(b))};r.websocket&&(r.websocket.onclose=null,r.websocket.close()),V("GATEWAY_WSS_ADDRESS")&&r.name.startsWith("gateway")&&(i=V("GATEWAY_WSS_ADDRESS")),I.debug("[".concat(r.name,"] start connect, url:"),i);const _=null===(a=r.store)||void 0===a?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;const b=yield r.chooseBestWebsocketConnection(i);r.websocket=b,l&&l(r.websocket.url),r.websocket.onclose=h,r.websocket.onmessage=p,r.websocket.onerror=m,null===(v=r.store)||void 0===v||v.recordJoinChannelService({endTs:Date.now(),status:"success"},_),r.joinGatewayRecordIndex=_}catch(b){const y="closed"===r.state,T=b instanceof ee,M=T&&b.code===k.WS_ABORT,O=T&&b.code===k.WS_ERR,D=T?b.message:b&&(b.reason||b.toString());I.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(D)),r.store&&r.store.recordJoinChannelService({endTs:Date.now(),status:M?"aborted":"error",errors:[b]},_),y||O?(d.reject(y?new ee(k.WS_DISCONNECT,"websocket is closed: ".concat(D)):new ee(k.WS_ERR,"init websocket failed: ".concat(D))),O&&I.error("[".concat(r.name,"] init websocket failed: ").concat(D))):h&&h(b)}return d.promise})()}reconnectWithAction(i){var r=arguments,a=this;return L(function*(){let d=!(r.length>1&&void 0!==r[1])||r[1];if(a.reconnectCount>=a.retryConfig.maxRetryCount||0===a.urls.length||"closed"===a.state)return!1;I.warning("[choose-best-ws] action: =>",i),a.onlineReconnectListener||Fn.isOnline||!Fn.onlineWaiter||(a.onlineReconnectListener=Fn.onlineWaiter.then(()=>{a.onlineReconnectListener=void 0}));let l=!0;if(a.reconnectInterrupter=()=>l=!1,d){const m=GE(a.reconnectCount,a.retryConfig);I.debug("[".concat(a.name,"] wait ").concat(m,"ms to reconnect websocket, mode: ").concat(i)),yield X.race([Un(m),a.onlineReconnectListener||new X(()=>{})])}if("closed"===a._state||!l)return!1;a.reconnectCount+=1;const h=function(){var m=L(function*(_,v){a.emit(Me.RECONNECT_CREATE_CONNECTION,v),yield a.createWebSocketConnection(_)});return function(v,b){return m.apply(this,arguments)}}();try{if("retry"===i)a.emit(Me.RECONNECT_WAITTING_FINISH,i),yield h(a.urls[a.currentURLIndex],i);else if("tryNext"===i){if(a.currentURLIndex+=1,a.currentURLIndex>=a.urls.length)return a.reconnectWithAction("recover",!1);I.debug("[".concat(a.name,"] websocket url length: ").concat(a.urls.length," current index: ").concat(a.currentURLIndex)),a.emit(Me.RECONNECT_WAITTING_FINISH,i),yield h(a.urls[a.currentURLIndex],i)}else"recover"===i&&(I.debug("[".concat(a.name,"] request new urls")),a.resetReconnectCount("recover mode"),a.emit(Me.RECONNECT_WAITTING_FINISH,i),a.urls=yield rn(a,Me.REQUEST_NEW_URLS),a.currentURLIndex=0,yield h(a.urls[a.currentURLIndex],i))}catch(m){var p;I.error("[".concat(a.name,"] reconnect failed ").concat(m&&m.toString()));const _=null==m||null===(p=m.data)||void 0===p?void 0:p.desc;return Array.isArray(_)&&ye(_).call(_,"dynamic key expired")?(a.emit(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):a.reconnectWithAction(i,d)}return!0})()}}class dp extends BO{constructor(i,r){super(i,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(i,r){var a=this;return L(function*(){const d=em(),l=new HL(a.forceCloseTimeout,a.store);a.closeEstablishingWs=()=>{I.debug("[choose-best-ws] close establishing websockets"),l.closeAllWebsockets(),d.reject(new ee(k.WS_ABORT,"choose best websocket aborted"))};const h=V("GATEWAY_DOMAINS");return I.debug("[choose-best-ws] currentDomain: ",i,", domains: ",h,"total: ".concat(a.urls.length),"current: ".concat(a.currentURLIndex+1)),l.chooseBestWebsocket(i,a.tryDoubleDomain,a.use443PortOnly,r).then(d.resolve).catch(d.reject),d.promise.finally(()=>{a.closeEstablishingWs=void 0})})()}}class Rm extends BO{constructor(i,r){super(i,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(i,r){var a=this;return L(function*(){return new X((d,l)=>{let h=!1;const p=[];a.closeEstablishingWs=()=>{I.debug("[choose-best-ws] close establishing websockets"),p.forEach(O=>{O.onclose=null,O.onopen=null,O.onmessage=null,O.close()}),l(new ee(k.WS_ABORT,"choose best websocket aborted"))};const m=V("GATEWAY_DOMAINS");let _;const v=i.indexOf("?h="),b=m.find(O=>-1!==v?ye(i).call(i,O,v):ye(i).call(i,O));I.debug("[choose-best-ws] currentDomain: ",b,", domains: ",m);let y=!a.tryDoubleDomain||!b;if(!y&&b){var T;const O=Date.now();try{m.forEach(D=>{const x=-1===v?i.replace(b,D):i.substr(0,v)+i.substr(v).replace(b,D),F=new WebSocket(x);F.binaryType="arraybuffer",p.push(F),I.debug("[choose-best-ws] ws is connecting:",F.url)})}catch{for(I.debug("[choose-best-ws] ws create failed, fallback to single url"),p.forEach(x=>x.close());p.length;)p.pop();y=!0}null===(T=a.store)||void 0===T||T.recordJoinChannelService({urls:p.map(D=>D.url),service:"gateway"},r),p.forEach(D=>{D.onopen=()=>{if(h)return;const x=Date.now()-O;I.debug("[choose-best-ws] ws open cost ".concat(x,"ms")),p.filter(F=>F!==D).forEach(F=>{I.debug("[choose-best-ws]close backup websocket: ".concat(F.url)),F.close()}),h=!0,d(D)},D.onclose=x=>{_=x,!h&&(p.find(F=>!(F.readyState===WebSocket.CLOSED||F.readyState===WebSocket.CLOSING))||(I.debug("[choose-best-ws] all websocket is closed"),h=!0,l(_)))},D.onmessage=x=>{I.debug("[choose-best-ws]".concat(D.url," onmessage: ").concat(x.data))}}),Un(a.forceCloseTimeout).then(()=>{p.forEach(D=>{D.readyState!==WebSocket.OPEN&&D.close()})})}if(y){var M;let O;I.debug("[choose-best-ws] use single url: ",i),null===(M=a.store)||void 0===M||M.recordJoinChannelService({urls:[i],service:"gateway"},r);try{O=new WebSocket(i),p.push(O),O.binaryType="arraybuffer"}catch(D){const x=new ee(k.WS_ERR,"init websocket failed! Error: ".concat(D.toString()));return I.error("[".concat(a.name,"]").concat(x)),void l(x)}O.onopen=()=>{d(O)},O.onclose=D=>{l(D)},O.onmessage=D=>{I.debug("[choose-best-ws]".concat(O.url," onmessage: ").concat(D.data))},Un(a.forceCloseTimeout).then(()=>{O&&O.readyState!==WebSocket.OPEN&&O.close()})}}).then(d=>(a.closeEstablishingWs=void 0,d)).catch(d=>{throw a.closeEstablishingWs=void 0,d})})()}}class uT extends jt{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===Ee.CONNECTED?this.emit(ce.WS_CONNECTED):i===Ee.RECONNECTING?this.emit(ce.WS_RECONNECTING,this._websocketReconnectReason):i===Ee.CLOSED&&this.emit(ce.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(i,r){super(),S(this,"_disconnectedReason",void 0),S(this,"_websocketReconnectReason",void 0),S(this,"_connectionState",Ee.CLOSED),S(this,"reconnectToken",void 0),S(this,"websocket",void 0),S(this,"openConnectionTime",void 0),S(this,"clientId",void 0),S(this,"lastMsgTime",Date.now()),S(this,"uploadCache",[]),S(this,"uploadCacheInterval",void 0),S(this,"rttRolling",new Dc(5)),S(this,"pingpongTimer",void 0),S(this,"wsInflateDataTimer",void 0),S(this,"pingpongTimeoutCount",0),S(this,"joinResponse",void 0),S(this,"multiIpOption",void 0),S(this,"initError",void 0),S(this,"spec",void 0),S(this,"store",void 0),S(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(ce.ON_BINARY_DATA,a.data);const d=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(d,"_id")){const l="res-@".concat(d._id);this.emit(l,d._result,d._message)}else if(Object.prototype.hasOwnProperty.call(d,"_type")){if(this.emit(d._type,d._message),d._type===xe.ON_NOTIFICATION&&this.handleNotification(d._message),d._type===xe.ON_USER_BANNED)switch(d._message.error_code){case 14:this.close(ze.UID_BANNED);break;case 15:this.close(ze.IP_BANNED);break;case 16:this.close(ze.CHANNEL_BANNED)}if(d._type===xe.ON_USER_LICENSE_BANNED)switch(d._message.error_code){case oe.ERR_LICENSE_MISSING:this.close(ze.LICENSE_MISSING);break;case oe.ERR_LICENSE_EXPIRED:this.close(ze.LICENSE_EXPIRED);break;case oe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(ze.LICENSE_MINUTES_EXCEEDED);break;case oe.ERR_LICENSE_PERIOD_INVALID:this.close(ze.LICENSE_PERIOD_INVALID);break;case oe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(ze.LICENSE_MULTIPLE_SDK_SERVICE);break;case oe.ERR_LICENSE_ILLEGAL:this.close(ze.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=r,this.websocket=new dp("gateway-".concat(this.clientId),this.spec.retryConfig,!0,V("JOIN_GATEWAY_USE_DUAL_DOMAIN"),V("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ee.CONNECTED&&this.reconnect("retry",_i.OFFLINE)})}request(i,r,a,d){var l=this;return L(function*(){const h=Ke(6,""),p={_id:h,_type:i,_message:r},m=l.websocket.connectionID,_=()=>new X((O,D)=>{if(l.connectionState===Ee.CONNECTED)return O();const x=()=>{l.off(ce.WS_CLOSED,F),O()},F=()=>{l.off(ce.WS_CONNECTED,x),D(new W(k.WS_ABORT))};l.once(ce.WS_CONNECTED,x),l.once(ce.WS_CLOSED,F),i!==Ae.PUBLISH&&i!==Ae.SUBSCRIBE&&i!==Ae.UNSUBSCRIBE&&i!==Ae.UNPUBLISH&&i!==Ae.CONTROL&&i!==Ae.RESTART_ICE||l.once(ce.DISCONNECT_P2P,()=>{D(new W(k.DISCONNECT_P2P))}),i!==Ae.PUBLISH&&i!==Ae.RESTART_ICE||l.once(ce.ABORT_P2P_EXECUTION,()=>{D(new W(k.DISCONNECT_P2P))})});if(l.connectionState!==Ee.CONNECTING&&l.connectionState!==Ee.RECONNECTING||i===Ae.JOIN||i===Ae.REJOIN||(yield _()),l.websocket.sendMessage(p,!0),d)return;const v=new X((O,D)=>{let x=!1;const F=(q,te)=>{x=!0,O({isSuccess:"success"===q,message:te||{}}),l.off(ce.WS_CLOSED,j),l.off(ce.WS_RECONNECTING,j),l.emit(ce.REQUEST_SUCCESS,i,r)};l.once("res-@".concat(h),F);const j=()=>{D(new W(k.WS_ABORT,"type: ".concat(i))),l.off(ce.WS_CLOSED,j),l.off(ce.WS_RECONNECTING,j),l.off("res-@".concat(h),F)};l.once(ce.WS_CLOSED,j),l.once(ce.WS_RECONNECTING,j),Un(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{l.websocket.connectionID!==m||x||(I.warning("[".concat(l.clientId,"] ws request timeout, type: ").concat(i)),l.emit(ce.REQUEST_TIMEOUT,i,r))})});let b=null;try{b=yield v}catch(O){if(l.connectionState===Ee.CLOSED||i===Ae.LEAVE)throw new W(k.WS_ABORT);return!l.spec.forceWaitGatewayResponse||a?O.throw():i===Ae.JOIN||i===Ae.REJOIN?null:(yield _(),yield l.request(i,r))}if(b.isSuccess)return b.message;const y=Number(b.message.error_code||b.message.code),T=ru(y),M=new W(k.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(b.message.error_str),{code:y,data:b.message});return"success"===T.action?b.message:(I.warning("[".concat(l.clientId,"] [").concat(l.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(y,", message: ").concat(T.desc,", action: ").concat(T.action)),y===oe.ERR_TOO_MANY_BROADCASTERS?((i===Ae.JOIN||i===Ae.REJOIN)&&(l.initError=M,l.close()),M.throw()):"failed"===T.action?M.throw():"quit"===T.action?(l.initError=M,l.close(),M.throw()):(y===oe.ERR_JOIN_BY_MULTI_IP?(l.multiIpOption=b.message.option,I.warning("[".concat(l.clientId,"] detect multi ip, recover")),l.reconnect("recover",_i.MULTI_IP)):l.reconnect(T.action,_i.SERVER_ERROR),i===Ae.JOIN||i===Ae.REJOIN?null:yield l.request(i,r)))})()}waitMessage(i,r){return new X(a=>{const d=l=>{(!r||r(l))&&(this.off(i,d),a(l))};this.on(i,d)})}uploadWRTCStats(i){if(!this.store.sessionId)return void I.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:i};this.upload(xc.WRTC_STATS,r)}upload(i,r){const a={_type:i,_message:r};try{this.websocket.sendMessage(a)}catch{const l=V("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ee.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},V("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,r){this.websocket.sendMessage({_type:i,_message:r})}init(i,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new X((a,d)=>{this.once(ce.WS_CONNECTED,()=>a(this.joinResponse)),this.once(ce.WS_CLOSED,()=>d(this.initError||new W(k.WS_ABORT))),this.connectionState=Ee.CONNECTING,this.websocket.init(i).catch(d),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||ze.LEAVE,this.connectionState=Ee.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),i===ze.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new dp("gateway-".concat(this.clientId),this.spec.retryConfig,!0,V("JOIN_GATEWAY_USE_DUAL_DOMAIN"),V("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}join(){var i=this;return L(function*(){if(!i.joinResponse){i.emit(ce.ABORT_P2P_EXECUTION);const r=yield rn(i,ce.REQUEST_JOIN_INFO),a=yield i.request(Ae.JOIN,r);if(!a)return i.emit(ce.REPORT_JOIN_GATEWAY,Fd.TIMEOUT,i.url||""),!1;i.joinResponse=a,i.emit(ce.JOIN_RESPONSE,i.joinResponse),i.reconnectToken=i.joinResponse.rejoin_token}return i.connectionState=Ee.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),!0})()}rejoin(){var i=this;return L(function*(){if(!i.reconnectToken)throw new W(k.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=mr(i,ce.REQUEST_REJOIN_INFO);r.token=i.reconnectToken;const a=yield i.request(Ae.REJOIN,r);return!!a&&(i.connectionState=Ee.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),a.peers&&a.peers.forEach(d=>{i.emit(xe.ON_USER_ONLINE,{uid:d.uid}),d.audio&&i.emit(xe.ON_ADD_AUDIO_STREAM,{uid:d.uid,uint_id:d.uint_id,audio:!0,ssrcId:d.audio_ssrc}),d.video&&i.emit(xe.ON_ADD_VIDEO_STREAM,{uid:d.uid,uint_id:d.uint_id,video:!0,ssrcId:d.video_ssrc}),i.emit(d.audio_mute?xe.MUTE_AUDIO:xe.UNMUTE_AUDIO,{uid:d.uid}),i.emit(d.video_mute?xe.MUTE_VIDEO:xe.UNMUTE_VIDEO,{uid:d.uid}),i.emit(d.audio_enable_local?xe.ENABLE_LOCAL_AUDIO:xe.DISABLE_LOCAL_AUDIO,{uid:d.uid}),i.emit(d.video_enable_local?xe.ENABLE_LOCAL_VIDEO:xe.DISABLE_LOCAL_VIDEO,{uid:d.uid}),d.audio||d.video||i.emit(xe.ON_REMOVE_STREAM,{uid:d.uid,uint_id:d.uint_id})}),!0)})()}reconnect(i,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,r)}handleNotification(i){I.debug("[".concat(this.clientId,"] receive notification: "),i);const r=ru(i.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close(ze.UID_BANNED),void this.close()):void this.reconnect(r.action,_i.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=V("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=i&&(I.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>V("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",_i.TIMEOUT):this.request(Ae.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),V("REPORT_STATS")&&this.send(Ae.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:i,wsDeflateLength:r}=this.websocket.getWsInflateData();0!==i&&0!==r&&this.upload(xc.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:i})}handleWebsocketEvents(){this.websocket.on(Me.RECONNECT_WAITTING_FINISH,i=>{this.emit(ce.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(Me.RECONNECT_CREATE_CONNECTION,i=>{this.emit(ce.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(Me.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Me.CLOSED,()=>{this.connectionState=Ee.CLOSED}),this.websocket.on(Me.FAILED,()=>{this._disconnectedReason=ze.NETWORK_ERROR,this.connectionState=Ee.CLOSED}),this.websocket.on(Me.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState=this.connectionState===Ee.CONNECTED?Ee.RECONNECTING:Ee.CONNECTING}),this.websocket.on(Me.WILL_RECONNECT,(i,r,a)=>{const d=mr(this,ce.IS_P2P_DISCONNECTED),l=d||"retry"!==i;d&&"retry"===i&&(I.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),i="tryNext",r=Fd.P2P_DISCONNECTED),l&&(I.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(i)),this.emit(ce.REPORT_JOIN_GATEWAY,r||Fd.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ce.NEED_RENEW_SESSION),this.emit(ce.DISCONNECT_P2P)),a(i)}),this.websocket.on(Me.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{I.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",_i.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(ce.REPORT_JOIN_GATEWAY,i.message||i.code||Fd.UNKNOWN_REASON,this.url||""),i instanceof W&&i.code===k.UNEXPECTED_RESPONSE&&i.data.code===oe.ERR_NO_AUTHORIZED)return I.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",_i.SERVER_ERROR);I.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",_i.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(Me.REQUEST_NEW_URLS,(i,r)=>{rn(this,ce.REQUEST_RECOVER,this.multiIpOption).then(i).catch(r)}),this.websocket.on(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var jO="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",hT=fl,GL=hc,pv=jO,pT=Ri("".replace),WL=RegExp("^["+pv+"]+"),zL=RegExp("(^|[^"+pv+"])["+pv+"]+$"),fT=function(s){return function(i){var r=GL(hT(i));return 1&s&&(r=pT(r,WL,"")),2&s&&(r=pT(r,zL,"$1")),r}},mT={start:fT(1),end:fT(2),trim:fT(3)},KL=_1.PROPER,HO=cn,GO=jO,qL=mT.trim;Bt({target:"String",proto:!0,forced:function(s){return HO(function(){return!!GO[s]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[s]()||KL&&GO[s].name!==s})}("trim")},{trim:function(){return qL(this)}});var yi,hs,YL=uc("String").trim,$L=Ds,XL=YL,gT=String.prototype,fv=Rt(function(s){var i=s.trim;return"string"==typeof s||s===gT||$L(gT,s)&&i===gT.trim?XL:i});function _T(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function mv(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?_T(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):_T(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function Vd(s){return s.match(/^[\.\:\d]+$/)?"".concat(s.replace(/[^\d]/g,"-"),".").concat(V("TURN_DOMAIN")):(I.info("Unidentified as ip: ".concat(s,", use as host")),s)}function ET(s,i){s.addresses||(s.addresses=[]);const r=function(l,h){if(V("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return l.map(_=>{let{ip:v,port:b}=_;return{address:"".concat(v,":").concat(b)}});const p=V("GATEWAY_DOMAINS");let m=p[1]&&ye(h).call(h,p[1])?1:0;return l.map(_=>{let{domain_prefix:v,port:b,ip:y}=_;if(v)return{address:"".concat(v,".").concat(p[m++%p.length],":").concat(b)};const T=/^[\.\:\d]+$/.test(y),M=T?"".concat(y.replace(/[^\d]/g,"-"),".").concat(p[m++%p.length],":").concat(b):"".concat(y,":").concat(b);return T||I.info("Unidentified as ip: ".concat(y,", use as host")),{ip:y,port:b,address:M}})}(s.addresses,i),a=Array.isArray(s.detail)&&s.detail[18];if(a&&"string"==typeof a){const l=a.split(";");for(let h=0;h<l.length;h++){var d;const p=fv(d=l[h]).call(d);r[h]&&p&&(r[h].ip6=p)}}return{gatewayAddrs:r,uid:s.uid,cid:s.cid,cert:s.cert,vid:s.detail&&s.detail[8],uni_lbs_ip:s.detail&&s.detail[1],res:s,csIp:s.detail&&s.detail[502]}}function Po(s){return"number"==typeof s?s:s.exact||s.ideal||s.max||s.min||0}function WO(s){const i=s._encoderConfig;if(!i)return{};const r={resolution:i.width&&i.height?"".concat(Po(i.width),"x").concat(Po(i.height)):void 0,maxVideoBW:i.bitrateMax,minVideoBW:i.bitrateMin};return"number"==typeof i.frameRate?(r.maxFrameRate=i.frameRate,r.minFrameRate=i.frameRate):i.frameRate&&(r.maxFrameRate=i.frameRate.max||i.frameRate.ideal||i.frameRate.exact||i.frameRate.min,r.minFrameRate=i.frameRate.min||i.frameRate.ideal||i.frameRate.exact||i.frameRate.max),r}function lp(s){return s>=0&&s<.17?1:s>=.17&&s<.36?2:s>=.36&&s<.59?3:s>=.59&&s<=1?4:s>1?5:0}function gv(s,i){let r,a,d;switch(i){case yi.CHOOSE_SERVER:a=4096,d="choose server";break;case yi.CLOUD_PROXY:a=1048576,d="proxy";break;case yi.CLOUD_PROXY_5:a=4194304,d="proxy5";break;case yi.CLOUD_PROXY_FALLBACK:a=4194310,d="proxy fallback";break;default:throw new W(k.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:s.detail&&s.detail[502],retry:!1})}if(s.response_body.forEach(l=>{l.buffer&&l.buffer.flag===a&&(r={code:l.buffer.code,addresses:(l.buffer.edges_services||[]).map(h=>mv(mv({},h),{},{ticket:l.buffer.cert})),server_ts:s.enter_ts,uid:l.buffer.uid,cid:l.buffer.cid,cname:l.buffer.cname,detail:mv(mv({},l.buffer.detail),s.detail),flag:l.buffer.flag,opid:s.opid,cert:l.buffer.cert})}),!r)throw new W(k.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(d," from multi unilbs response"),{csIp:s.detail&&s.detail[502]});return r}function gn(s,i){return _v.apply(this,arguments)}function _v(){return _v=L(function*(s,i){return yield X.all(s.addresses.map(function(){var r=L(function*(a){return{address:Vd(a.ip),tcpport:a.port,udpport:a.port,username:i&&V("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?i.toString():Er.username,password:i&&V("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?yield zh(i.toString()):Er.password}});return function(a){return r.apply(this,arguments)}}()))}),_v.apply(this,arguments)}function vT(s,i){const r=i._videoHeight||i.getMediaStreamTrack(!0).getSettings().height;return r?Math.max(r/Po(s.height),1):(I.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Vc(s){let{candidateType:i,relayProtocol:r,type:a,address:d,port:l,protocol:h}=s;return"local-candidate"===a?{candidateType:i,relayProtocol:r,protocol:h}:{candidateType:i,relayProtocol:r,address:d,port:l,protocol:h}}function bT(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}!function(s){s[s.CHOOSE_SERVER=11]="CHOOSE_SERVER",s[s.CLOUD_PROXY=18]="CLOUD_PROXY",s[s.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",s[s.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"}(yi||(yi={}));class zO extends jt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){var r;ye(r=["tryNext","recover"]).call(r,i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,"reconnecting"===this._state?this.emit(fn.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(fn.CONNECTED):"closed"===this._state?this.emit(fn.CLOSED):"failed"===this._state&&this.emit(fn.FAILED))}constructor(i,r,a,d){super(),S(this,"connectionID",0),S(this,"currentURLIndex",0),S(this,"reconnectReason",void 0),S(this,"_reconnectMode","tryNext"),S(this,"_name",void 0),S(this,"_state","closed"),S(this,"_retryConfig",void 0),S(this,"_reconnectCount",0),S(this,"_forceCloseTimeout",5e3),S(this,"_onlineReconnectListener",void 0),S(this,"_closeEstablishingTransmitter",()=>{}),S(this,"_store",void 0),S(this,"_joinChannelServiceRecordIndex",void 0),S(this,"_useCompress",void 0),S(this,"_inflateLength",0),S(this,"_deflateLength",0),this._store=d,this._name=i,this._retryConfig=function(l){for(var h=1;h<arguments.length;h++){var p=null!=arguments[h]?arguments[h]:{};h%2?bT(Object(p),!0).forEach(function(m){S(l,m,p[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(p)):bT(Object(p)).forEach(function(m){Object.defineProperty(l,m,Object.getOwnPropertyDescriptor(p,m))})}return l}({},r),this._useCompress=a}resetReconnectCount(i){I.debug("".concat(this._name," reset reconnect count, reason: ").concat(i)),this._reconnectCount=0}close(i,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const a=this._transmitter;r?setTimeout(()=>a.close(),500):a.close(),this._transmitter=void 0}this.state=i?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(i,r){if(!this._transmitter)return void I.warning("[".concat(this._name,"] can not reconnect, no websocket"));var a;void 0!==i&&(this.reconnectMode=i),I.debug("[".concat(this._name,"] reconnect is triggered initiative")),"number"==typeof this._joinChannelServiceRecordIndex&&(null===(a=this._store)||void 0===a||a.recordJoinChannelService({status:"error",errors:[new Error(r)]},this._joinChannelServiceRecordIndex));const d=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),d&&d.bind(this._transmitter)({code:9999,reason:r})}getInflateData(){const i=this._inflateLength,r=this._deflateLength;return this.clearInflateData(),{inflateLength:i,deflateLength:r}}setInflateData(i){this._deflateLength=this._deflateLength+i.originLength,this._inflateLength=this._inflateLength+i.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}!function(s){s[s.Default=0]="Default",s[s.Ack=1]="Ack"}(hs||(hs={}));class _n{constructor(i,r,a){S(this,"version",1),S(this,"initialRTO",void 0),S(this,"maxBatchAckCount",void 0),S(this,"maxRTO",void 0),S(this,"initialRTT",void 0),S(this,"ID",void 0),S(this,"rtt",void 0),S(this,"packetNumber",1),S(this,"rtoRatioMap",new Map),S(this,"timeoutMap",new Map),S(this,"unorderedPacketQueue",[]),S(this,"batchAckPacketQueue",[]),S(this,"lastOrderedPacketNumber",0),S(this,"batchAckTimer",void 0),S(this,"sendImpl",void 0),S(this,"receiveImpl",void 0),this.sendImpl=i,this.receiveImpl=r,this.ID=Ke(7,"transmitter-"),this.initialRTO=void 0!==a?.initialRTO?a.initialRTO:V("TRANSMITTER_INITIAL_RTO"),this.initialRTT=void 0!==a?.initialRTT?a.initialRTT:V("TRANSMITTER_INITIAL_RTT"),this.rtt=void 0!==a?.initialRTT?a.initialRTT:V("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=void 0!==a?.maxBatchAckCount?a.maxBatchAckCount:V("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=void 0!==a?.maxRTO?a.maxRTO:V("TRANSMITTER_MAX_RTO")}packetize(i,r){return{type:hs.Default,version:this.version,packetNumber:r,payload:i}}serialize(i){switch(i.type){case hs.Default:{let r;r="string"==typeof i.payload?(new TextEncoder).encode(i.payload):i.payload;const a=new ArrayBuffer(r.length+15),d=new DataView(a);return d.setUint16(0,i.version),d.setUint8(2,i.type),d.setUint32(3,i.packetNumber),SD(d,7,BigInt(i.sendTs)),new Uint8Array(d.buffer).set(r,15),a}case hs.Ack:{const r=new ArrayBuffer(16),a=new DataView(r);return a.setUint16(0,i.version),a.setUint8(2,i.type),a.setUint32(3,i.maxAckPacketNumber),a.setUint8(7,i.shift),SD(a,8,BigInt(i.ackSendTs)),r}}}deserialize(i){const r=new DataView(i),a=r.getUint16(0),d=r.getUint8(2);switch(d){case hs.Default:{const l=r.getUint32(3),h=rm(r,7),p=i.slice(15),m=(new TextDecoder).decode(p);return{version:a,type:d,packetNumber:l,sendTs:Number(h),payload:m}}case hs.Ack:{const l=r.getUint32(3),h=r.getUint8(7),p=rm(r,8);return{version:a,type:d,maxAckPacketNumber:l,shift:h,ackSendTs:Number(p)}}default:throw I.error("[".concat(this.ID,"] Unrecognized packet type ").concat(d)),new Error("Unrecognized packet type ".concat(d))}}sendMessage(i){const r=this.packetize(i,this.packetNumber);this.packetNumber=4294967295===this.packetNumber?1:this.packetNumber+1;const a=this.calculateRTO(r),d=window.setTimeout(()=>{this.resendMessage(r)},a);this.timeoutMap.set(r.packetNumber,d),this.sendPacket(r)}onData(i){const r=this.deserialize(i);r.type===hs.Default?this.ack(r):r.type===hs.Ack&&(this.updateRTT(r,Math.round(performance.now())),this.clearRTO(r))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(i=>{let[r,a]=i;window.clearTimeout(a)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,void 0!==this.batchAckTimer&&window.clearTimeout(this.batchAckTimer)}resendMessage(i){const r=this.calculateRTO(i),a=window.setTimeout(()=>{this.resendMessage(i)},r);this.timeoutMap.set(i.packetNumber,a),this.sendPacket(i)}calculateRTO(i){const r=this.rtoRatioMap.get(i.packetNumber);if(void 0===r)return this.rtoRatioMap.set(i.packetNumber,1),this.initialRTO;{const a=9*this.rtt/8*r;return this.rtoRatioMap.set(i.packetNumber,r+1),a>this.maxRTO?this.maxRTO:a}}updateRTT(i,r){this.rtt=this.rtt*(7/8)+(r-i.ackSendTs-this.rtt)/8}ack(i){if(i.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(i):(this.batchAckPacketQueue.push(i),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(i.payload);;){const r=this.unorderedPacketQueue[0];if(!r){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(r.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else i.packetNumber<=this.lastOrderedPacketNumber?this.sendPacket({ackSendTs:i.sendTs,maxAckPacketNumber:i.packetNumber,shift:0,type:hs.Ack,version:this.version}):i.packetNumber>this.lastOrderedPacketNumber&&(this.unorderedPacketQueue[i.packetNumber-this.lastOrderedPacketNumber-2]=i,this.sendPacket({ackSendTs:i.sendTs,maxAckPacketNumber:i.packetNumber,shift:0,type:hs.Ack,version:this.version}))}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0,this.sendPacket({ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:hs.Ack,version:this.version}),this.batchAckPacketQueue=[]}sendPacket(i){i.type===hs.Default&&(i.sendTs=Math.round(performance.now()));const r=this.serialize(i);this.sendImpl(r)}clearRTO(i){for(let r=i.maxAckPacketNumber-i.shift;r<=i.maxAckPacketNumber;r++){const a=this.timeoutMap.get(r);void 0!==a&&window.clearTimeout(a),this.timeoutMap.delete(r),this.rtoRatioMap.delete(r)}}}class KO extends zO{constructor(i,r){super(i,r,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0),S(this,"_initMutex",void 0),S(this,"_reconnectInterrupter",void 0),S(this,"_url",void 0),S(this,"_transmitter",void 0),S(this,"_addresses",void 0),S(this,"_reliableTransmission",void 0),this._initMutex=new Ei("datachannel");const{timeout:a,timeoutFactor:d}=r,l=Math.max(300,Math.floor(3*a/5)),h=Math.max(1.2,Math.floor(8*d)/10);Xi.ONLINE&&(this._retryConfig.timeout=l,this._retryConfig.timeoutFactor=h),Fn.on(Rc.NETWORK_STATE_CHANGE,(p,m)=>{p!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(p)),p===Xi.ONLINE?(this._retryConfig.timeout=l,this._retryConfig.timeoutFactor=h):(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=d))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}init(i){var r=arguments,a=this;return L(function*(){a._forceCloseTimeout=r.length>1&&void 0!==r[1]?r[1]:5e3;return a._initMutex.lock().then(h=>new X((p,m)=>{((h,p)=>{a._addresses=i,a.currentURLIndex=a._addresses.findIndex(_=>_.fingerprint||V("FINGERPRINT"));const m=a._addresses[a.currentURLIndex];a.state="connecting",a.createTransmitterConnection(m).then(h).catch(p),a.once(fn.CLOSED,()=>p(new W(k.WS_DISCONNECT))),a.once(fn.CONNECTED,()=>h())})(p,m)}).then(()=>{h()}).catch(()=>{h()}))})()}sendMessage(i){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new W(k.WS_ABORT,"datachannel is not ready");try{r||(i=JSON.stringify(i)),this._reliableTransmission.sendMessage(i)}catch(a){throw new W(k.WS_ERR,"send datachannel signal message error"+a.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(i){const r=JSON.stringify(i);return{compressed:r,compressedLength:r.length,origin:i}}sendMessageWithUint8Array(i){return{compressed:i,compressedLength:i.byteLength,origin:i}}createTransmitterConnection(i){var r=this;return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(i.ip,":").concat(i.port),new X((a,d)=>{var l;const h=()=>{I.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a()},p=function(){var b=L(function*(y){var T;if(null===(T=r._closeEstablishingTransmitter)||void 0===T||T.call(r),I.debug("[".concat(r._name,"] datachannel close ").concat(r._url,", code: ").concat(y.code,", reason: ").concat(y.reason,", current mode: ").concat(r.reconnectMode)),r._reconnectCount<r._retryConfig.maxRetryCount){"connected"===r.state&&(r.reconnectReason=y.reason,r.state="reconnecting");const M=Pr(r,fn.WILL_RECONNECT,r.reconnectMode)||r.reconnectMode,O=yield r.reconnectWithAction(M);if("closed"===r.state)return void I.debug("[".concat(r.connectionID,"] dc is closed, no need to reconnect"));if(!O)return d(new W(k.WS_DISCONNECT,"datachannel reconnect failed: ".concat(y.code))),void r.close(!0);a()}else d(new W(k.WS_DISCONNECT,"datachannel close: ".concat(y.code))),r.close()});return function(T){return b.apply(this,arguments)}}(),m=b=>{var y;null===(y=this._reliableTransmission)||void 0===y||y.onData(b.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),I.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(i)));const _=null===(l=this._store)||void 0===l?void 0:l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),v=Date.now();rn(this,fn.TO_CONNECT_DATACHANNEL,i).then(b=>{var y,T;if(!b)throw new Error("transmissonInfo not exist yet");const{transmitter:M,close:O}=b;this._transmitter=M,null===(y=this._store)||void 0===y||y.signalChannelOpen();const D=Date.now()-v;I.debug("[choose dc] dc open cost ".concat(D,"ms")),this._reliableTransmission=new _n(x=>{var F;this._transmitter&&"open"===this._transmitter.readyState&&(null===(F=this._transmitter)||void 0===F||F.send(x))},x=>{"string"==typeof x&&this.emit(fn.ON_MESSAGE,x)}),this._closeEstablishingTransmitter=()=>{var x;null===(x=this._reliableTransmission)||void 0===x||x.close(),this._reliableTransmission=void 0,O()},h&&h(),M.onclose=p,M.onmessage=m,null===(T=this._store)||void 0===T||T.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this._joinChannelServiceRecordIndex=_}).catch(b=>{var y;if(null===(y=this._store)||void 0===y||y.recordJoinChannelService({endTs:Date.now(),status:b instanceof W&&b.code===k.WS_ABORT?"aborted":"error",errors:[b]},_),"closed"!==this.state){if(b instanceof W&&b.code===k.WS_ERR){const T=new W(k.WS_ERR,"init datachannel failed! Error: ".concat(b.toString()));return I.error("[".concat(this._name,"]").concat(T)),void d(T)}p&&p(b)}else d(new W(k.WS_DISCONNECT,"datachannel is closed: ".concat(b.toString())))})})}reconnectWithAction(i){var r=arguments,a=this;return L(function*(){let d=!(r.length>1&&void 0!==r[1])||r[1];if(a._reconnectCount>=a._retryConfig.maxRetryCount||!a._addresses||"closed"===a.state)return!1;a._onlineReconnectListener||Fn.networkState!==Xi.OFFLINE||(a._onlineReconnectListener=Fn.onlineWaiter&&Fn.onlineWaiter.then(()=>{a._onlineReconnectListener=void 0}));let l=!0;if(a._reconnectInterrupter=()=>{l=!1},d){const _=GE(a._reconnectCount,a._retryConfig);I.debug("[".concat(a._name,"] wait ").concat(_,"ms to reconnect datachannel, mode: ").concat(i)),yield X.race([Un(_),a._onlineReconnectListener||new X(()=>{})])}if("closed"===a.state||!l)return!1;a._reconnectCount+=1;const h=function(){var _=L(function*(v,b){a.emit(fn.RECONNECT_CREATE_CONNECTION,b),yield a.createTransmitterConnection(v)});return function(b,y){return _.apply(this,arguments)}}();try{if("retry"===i){const _=a._addresses[a.currentURLIndex];a.emit(fn.RECONNECT_WAITTING_FINISH,i),yield h(_,i)}else if("tryNext"===i){a.currentURLIndex+=1;for(let v=a.currentURLIndex;v<a._addresses.length;v++){if(a._addresses[v].fingerprint||V("FINGERPRINT")){a.currentURLIndex=v;break}a.currentURLIndex+=1}if(a.currentURLIndex>=a._addresses.length)return I.debug("[".concat(a._name,"] the available addresses are exhausted, change to recover")),yield a.reconnectWithAction("recover",!1);I.debug("[".concat(a._name,"] datachannel url length: ").concat(a._addresses.length," current index: ").concat(a.currentURLIndex));const _=a._addresses[a.currentURLIndex];a.emit(fn.RECONNECT_WAITTING_FINISH,i),yield h(_,i)}else"recover"===i&&(I.debug("[".concat(a._name,"] start to failback to websocket")),a.resetReconnectCount("recover mode"),a.emit(fn.RECONNECT_WAITTING_FINISH,i),a.emit(fn.FAILBACK));return!0}catch(_){var p,m;return I.error("[".concat(a._name,"] reconnect failed"),_.toString()),null!=_&&null!==(p=_.data)&&void 0!==p&&p.desc&&Array.isArray(_.data.desc)&&_.data.desc.length&&ye(m=_.data.desc).call(m,"dynamic key expired")?(a.emit(fn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):yield a.reconnectWithAction(i,d)}})()}}class Mo extends jt{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===Ee.CONNECTED?this.emit(ce.WS_CONNECTED):i===Ee.RECONNECTING?this.emit(ce.WS_RECONNECTING,this._websocketReconnectReason):i===Ee.CLOSED&&this.emit(ce.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(i,r){super(),S(this,"_disconnectedReason",void 0),S(this,"_websocketReconnectReason",void 0),S(this,"_connectionState",Ee.CLOSED),S(this,"reconnectToken",void 0),S(this,"websocket",void 0),S(this,"openConnectionTime",void 0),S(this,"clientId",void 0),S(this,"lastMsgTime",Date.now()),S(this,"uploadCache",[]),S(this,"uploadCacheInterval",void 0),S(this,"rttRolling",new Dc(5)),S(this,"pingpongTimer",void 0),S(this,"inflateDataTimer",void 0),S(this,"pingpongTimeoutCount",0),S(this,"joinResponse",void 0),S(this,"multiIpOption",void 0),S(this,"initError",void 0),S(this,"spec",void 0),S(this,"store",void 0),S(this,"onWebsocketMessage",a=>{if(a instanceof ArrayBuffer)return void this.emit(ce.ON_BINARY_DATA,a);const d=JSON.parse(a);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(d,"_id")){const l="res-@".concat(d._id);this.emit(l,d._result,d._message)}else if(Object.prototype.hasOwnProperty.call(d,"_type")&&(this.emit(d._type,d._message),d._type===xe.ON_NOTIFICATION&&this.handleNotification(d._message),d._type===xe.ON_USER_BANNED))switch(d._message.error_code){case 14:this.close(ze.UID_BANNED);break;case 15:this.close(ze.IP_BANNED);break;case 16:this.close(ze.CHANNEL_BANNED)}}),this.clientId=i.clientId,this.spec=i,this.store=r,this.websocket=new KO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ee.CONNECTED&&this.reconnect("retry",la.OFFLINE)})}request(i,r,a,d){var l=this;return L(function*(){const h=Ke(6,""),p={_id:h,_type:i,_message:r},m=l.websocket.connectionID,_=()=>new X((O,D)=>{if(l.connectionState===Ee.CONNECTED)return O();const x=()=>{l.off(ce.WS_CLOSED,F),O()},F=()=>{l.off(ce.WS_CONNECTED,x),D(new W(k.WS_ABORT))};l.once(ce.WS_CONNECTED,x),l.once(ce.WS_CLOSED,F),i!==Ae.PUBLISH&&i!==Ae.SUBSCRIBE&&i!==Ae.UNSUBSCRIBE&&i!==Ae.UNPUBLISH&&i!==Ae.CONTROL&&i!==Ae.RESTART_ICE||l.once(ce.DISCONNECT_P2P,()=>{D(new W(k.DISCONNECT_P2P))}),i!==Ae.PUBLISH&&i!==Ae.RESTART_ICE||l.once(ce.ABORT_P2P_EXECUTION,()=>{D(new W(k.DISCONNECT_P2P))})});if(l.connectionState!==Ee.CONNECTING&&l.connectionState!==Ee.RECONNECTING||i===Ae.JOIN||i===Ae.REJOIN||(yield _()),i===Ae.LEAVE&&(l.websocket.unbindDcCloseEventListener(),d=!0),l.websocket.sendMessage(p,!0,!1),d)return;const v=new X((O,D)=>{let x=!1;const F=(q,te)=>{x=!0,O({isSuccess:"success"===q,message:te||{}}),l.off(ce.WS_CLOSED,j),l.off(ce.WS_RECONNECTING,j),l.emit(ce.REQUEST_SUCCESS,i,r)};l.once("res-@".concat(h),F);const j=()=>{D(new W(k.WS_ABORT,"type: ".concat(i))),l.off(ce.WS_CLOSED,j),l.off(ce.WS_RECONNECTING,j),l.off("res-@".concat(h),F)};l.once(ce.WS_CLOSED,j),l.once(ce.WS_RECONNECTING,j),Un(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{l.websocket.connectionID!==m||x||(I.warning("dc request timeout, type: ".concat(i)),l.emit(ce.REQUEST_TIMEOUT,i,r))})});let b=null;try{b=yield v}catch(O){if(l.connectionState===Ee.CLOSED||i===Ae.LEAVE)throw new W(k.WS_ABORT);return!l.spec.forceWaitGatewayResponse||a?O.throw():i===Ae.JOIN||i===Ae.REJOIN?null:(yield _(),yield l.request(i,r))}if(b.isSuccess)return b.message;const y=Number(b.message.error_code||b.message.code),T=ru(y),M=new W(k.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(b.message.error_str),{code:y,data:b.message});return"success"===T.action?b.message:(I.warning("[".concat(l.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(y,", message: ").concat(T.desc,", action: ").concat(T.action)),y===oe.ERR_TOO_MANY_BROADCASTERS?((i===Ae.JOIN||i===Ae.REJOIN)&&(l.initError=M,l.close()),M.throw()):"failed"===T.action?M.throw():"quit"===T.action?(l.initError=M,l.close(),M.throw()):(y===oe.ERR_JOIN_BY_MULTI_IP?(l.multiIpOption=b.message.option,I.warning("[".concat(l.clientId,"] detect multi ip, recover")),l.reconnect("recover",la.MULTI_IP)):l.reconnect(T.action,la.SERVER_ERROR),i===Ae.JOIN||i===Ae.REJOIN?null:yield l.request(i,r)))})()}waitMessage(i,r){return new X(a=>{const d=l=>{(!r||r(l))&&(this.off(i,d),a(l))};this.on(i,d)})}uploadWRTCStats(i){if(!this.store.sessionId)return void I.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:i};this.upload(xc.WRTC_STATS,r)}upload(i,r){const a={_type:i,_message:r};try{this.websocket.sendMessage(a)}catch{const l=V("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ee.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},V("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,r){this.websocket.sendMessage({_type:i,_message:r})}init(i,r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new X((a,d)=>{this.once(ce.WS_CONNECTED,()=>a(this.joinResponse)),this.once(ce.WS_CLOSED,()=>d(this.initError||new W(k.WS_ABORT))),this.connectionState=Ee.CONNECTING,this.websocket.init(i).catch(d),this.websocket.once(fn.FAILBACK,()=>{void 0===this.openConnectionTime&&d(new W(k.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{r&&void 0===this.openConnectionTime&&(I.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),d(new W(k.INIT_DATACHANNEL_TIMEOUT)))},V("DC_JOIN_WITH_FAILBACK"))})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||ze.LEAVE,this.connectionState=Ee.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),i===ze.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new KO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}join(){var i=this;return L(function*(){if(!i.joinResponse){i.emit(ce.ABORT_P2P_EXECUTION);const r=yield rn(i,ce.DATACHANNEL_CONNECTING),a=yield i.request(Ae.JOIN,r);if(!a)return i.emit(ce.REPORT_JOIN_GATEWAY,k.TIMEOUT,i.url||""),!1;i.joinResponse=a,i.emit(ce.JOIN_RESPONSE,i.joinResponse),i.reconnectToken=i.joinResponse.rejoin_token}return i.connectionState=Ee.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),!0})()}rejoin(){var i=this;return L(function*(){if(!i.reconnectToken)throw new W(k.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=mr(i,ce.REQUEST_REJOIN_INFO);r.token=i.reconnectToken;const a=yield i.request(Ae.REJOIN,r);return!!a&&(i.connectionState=Ee.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),a.peers&&a.peers.forEach(d=>{i.emit(xe.ON_USER_ONLINE,{uid:d.uid}),d.audio&&i.emit(xe.ON_ADD_AUDIO_STREAM,{uid:d.uid,uint_id:d.uint_id,audio:!0,ssrcId:d.audio_ssrc}),d.video&&i.emit(xe.ON_ADD_VIDEO_STREAM,{uid:d.uid,uint_id:d.uint_id,video:!0,ssrcId:d.video_ssrc}),i.emit(d.audio_mute?xe.MUTE_AUDIO:xe.UNMUTE_AUDIO,{uid:d.uid}),i.emit(d.video_mute?xe.MUTE_VIDEO:xe.UNMUTE_VIDEO,{uid:d.uid}),i.emit(d.audio_enable_local?xe.ENABLE_LOCAL_AUDIO:xe.DISABLE_LOCAL_AUDIO,{uid:d.uid}),i.emit(d.video_enable_local?xe.ENABLE_LOCAL_VIDEO:xe.DISABLE_LOCAL_VIDEO,{uid:d.uid}),d.audio||d.video||i.emit(xe.ON_REMOVE_STREAM,{uid:d.uid,uint_id:d.uint_id})}),!0)})()}reconnect(i,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,r)}handleNotification(i){I.debug("[".concat(this.clientId,"] receive notification: "),i);const r=ru(i.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close(ze.UID_BANNED),void this.close()):void this.reconnect(r.action,la.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=V("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=i&&(I.warning("PINGPONG Timeout. Last Socket Message: ".concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>V("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",la.TIMEOUT):this.request(Ae.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),V("REPORT_STATS")&&this.send(Ae.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleInflateData(){const{inflateLength:i,deflateLength:r}=this.websocket.getInflateData();0!==i&&0!==r&&this.upload(xc.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:i})}handleWebsocketEvents(){var i=this;this.websocket.on(fn.RECONNECT_WAITTING_FINISH,r=>{this.emit(ce.WS_RECONNECT_WAITTING_FINISH,r)}),this.websocket.on(fn.RECONNECT_CREATE_CONNECTION,r=>{this.emit(ce.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(fn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(fn.CLOSED,()=>{this.connectionState=Ee.CLOSED}),this.websocket.on(fn.FAILED,()=>{this._disconnectedReason=ze.NETWORK_ERROR,this.connectionState=Ee.CLOSED}),this.websocket.on(fn.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState=this.connectionState===Ee.CONNECTED?Ee.RECONNECTING:Ee.CONNECTING}),this.websocket.on(fn.WILL_RECONNECT,(r,a)=>{if(mr(this,ce.IS_P2P_DISCONNECTED)&&"retry"===r)return I.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(ce.NEED_RENEW_SESSION),this.emit(ce.DISCONNECT_P2P),a("tryNext");"retry"!==r&&(I.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0,this.emit(ce.NEED_RENEW_SESSION),this.emit(ce.DISCONNECT_P2P)),a(r)}),this.websocket.on(fn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{I.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",la.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(ce.REPORT_JOIN_GATEWAY,r.message||r.code,this.url||""),r instanceof W&&r.code===k.UNEXPECTED_RESPONSE&&r.data.code===oe.ERR_NO_AUTHORIZED)return I.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",la.SERVER_ERROR);I.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",la.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(fn.REQUEST_NEW_URLS,(r,a)=>{rn(this,ce.REQUEST_RECOVER,this.multiIpOption).then(r).catch(a)}),this.websocket.on(fn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(fn.TO_CONNECT_DATACHANNEL,function(){var r=L(function*(a,d,l){return rn(i,ce.DATACHANNEL_PRECONNECT,a).then(d).catch(l)});return function(a,d,l){return r.apply(this,arguments)}}()),this.websocket.on(fn.FAILBACK,()=>{void 0!==this.openConnectionTime&&this.emit(ce.DATACHANNEL_FAILBACK)})}}class xi extends jt{constructor(i,r){super(),S(this,"signal",void 0),S(this,"token",void 0),S(this,"tokenTimeout",void 0),S(this,"tokenInterval",void 0),S(this,"_sequence",0),S(this,"userMap",new Map),S(this,"encoder",new TextEncoder),this.signal=i,this.token=r;const a=()=>{this.signal.connectionState===Ee.CONNECTED&&this.check(),this.tokenInterval=0===this.userMap.size?window.setTimeout(a,1e3):window.setTimeout(a,3*V("P2P_TOKEN_INTERVAL"))};a()}send(i,r,a,d,l){var h=this;return L(function*(){var p,m,_;if(0===h.userMap.size)return;const v=Array.from(ca(p=h.userMap).call(p))[0].token;"string"!=typeof r&&(r=JSON.stringify(r)),d=null!==(m=d)&&void 0!==m?m:Ke(6,""),l=null!==(_=l)&&void 0!==_?_:h._sequence++;const b={_id:d,_type:i,_seq:l,_message:r,token:"".concat(h.token,"_").concat(v)};V("SHOW_P2P_LOG")&&I.debug("send message",b,"noNeedResponse : ".concat(a)),h.splitMessage(JSON.stringify(b)).forEach(T=>{h.signal.request(Ae.DATA_STREAM,{payload:Yh(h.encoder.encode(T))})});const y=new X((T,M)=>{const O=window.setTimeout(()=>{h.off("res-@".concat(d,"_ack"),D),h.off("res-@".concat(d),F),h.off(iu.ABORT,x),I.debug("[external-signal] request timeout, type: ".concat(i,", requestId: ").concat(d)),M(new ee(0===h.userMap.size?k.INVALID_REMOTE_USER:k.TIMEOUT))},V("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),D=()=>{O&&window.clearTimeout(O),h.off(iu.ABORT,x),a&&T()},x=()=>{O&&window.clearTimeout(O),h.off("res-@".concat(d,"_ack"),D),h.off("res-@".concat(d),F),M(new ee(k.EXTERNAL_SIGNAL_ABORT,"type: ".concat(i,", requestId: ").concat(d)))};h.once(iu.ABORT,x),h.once("res-@".concat(d,"_ack"),D);const F=(q,te)=>{j=!0,O&&window.clearTimeout(O),h.off("res-@".concat(d,"_ack"),D),h.off(iu.ABORT,x),"success"===q?T(te):M(new ee(k.P2P_MESSAGE_FAILED,"request ".concat(i," failed, requestId: ").concat(d)))};let j=!1;a||(h.once("res-@".concat(d),F),Un(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{j||I.warning("external_signal request timeout, type: ".concat(i,", requestId: ").concat(d,", ").concat(b))}))});try{return yield y}catch(T){if(T.code===k.TIMEOUT)return yield h.send(i,r,a,d,l);throw T}})()}onMessage(i){var r;const{_uid:a}=i;let d,l=this.userMap.get(a);if(l)d=l.splitMessageMap;else{if(this.userMap.size>0||!("_type"in i)||i._type!==mn.CHECK)return;const{token:_}=i;d=new Map,l={uid:a,isStart:!0,token:_,splitMessageMap:d,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,l),this.signal.emit(xe.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in i&&"total"in i){var h;const{id:_,total:v}=i,b=null!==(h=d.get(_))&&void 0!==h?h:[];if(b.push(i),d.has(_)||d.set(_,b),b.length!==v)return;{const y=dE(b).call(b,(T,M)=>T.index-M.index).map(T=>T.payload).join("");d.delete(_),(i=JSON.parse(y))._uid=a}}const{_type:p,token:m}=i;if(ye(r=[mn.ACK,mn.CHECK]).call(r,p))return p===mn.CHECK&&this.handleCheckToken(l,m),void this.receiveMessage(i);m==="".concat(l.token,"_").concat(this.token)?this.handleReceivedMessage(i):I.debug('Receive unexpected message", '.concat(m,", cur_token: ").concat(l.token,"_").concat(this.token),i)}check(){const i={_id:Ke(6,""),token:this.token,_type:mn.CHECK};V("SHOW_P2P_LOG")&&I.debug("send message",i),this.signal.request(Ae.DATA_STREAM,{payload:Yh(this.encoder.encode(JSON.stringify(i)))})}ack(i){const r={_id:i,_type:mn.ACK,token:this.token};V("SHOW_P2P_LOG")&&I.debug("send message",r),this.signal.request(Ae.DATA_STREAM,{payload:Yh(this.encoder.encode(JSON.stringify(r)))})}response(i,r,a){this.send(mn.RESPONSE,JSON.stringify({success:!a,message:r}),!0,i)}handleReceivedMessage(i){const r=()=>{this.userMap.forEach(_=>{const{receivedMessagesMap:v,nextExpectedSequenceNumber:b}=_;for(;v.has(b);){const y=v.get(b);v.delete(b),this.receiveMessage(y),_.nextExpectedSequenceNumber++}})};if(!i)return void r();const{_uid:a,_seq:d}=i,l=this.userMap.get(a),{receivedMessagesMap:h,isStart:p,nextExpectedSequenceNumber:m}=l;if(d<m)return this.ack(i._id),void I.debug("[external-signal] receive old message, seq: ".concat(d,", ").concat(i._message));h.set(d,i),p&&d===m&&(this.receiveMessage(i),h.delete(m),l.nextExpectedSequenceNumber++,r())}receiveMessage(i){const{_id:r,_type:a,_message:d,_uid:l}=i;if(V("SHOW_P2P_LOG")&&I.debug("receive message",i),r){let h;switch(i._type!==mn.ACK&&(d&&(h=JSON.parse(d)),this.ack(i._id)),i._type){case mn.CANDIDATE:case mn.CONTROL:this.signal.emit(a,h,l);break;case mn.PUBLISH:case mn.UNPUBLISH:case mn.RESTART_ICE:case mn.CALL:h.uid=l,rn(this.signal,a,h).then(p=>{this.response(i._id,p)}).catch(()=>{this.response(i._id,void 0,!0)});break;case mn.ACK:this.getListeners("res-@".concat(r,"_ack")).length>0&&this.emit("res-@".concat(r,"_ack"));break;case mn.RESPONSE:{const{success:p,message:m}=h;this.emit("res-@".concat(r),p?"success":"failed",m);break}}}}splitMessage(i){if(i.length<xi.MAX_MESSAGE_SIZE)return[i];const r=[],{remoteToken:a}=JSON.parse(i),d=Ke(6,"");let l=0,h=800;const p=Math.ceil(i.length/h);for(;i.length>0;){l++;const m={id:d,index:l,total:p,payload:i.slice(0,h),token:"".concat(this.token,"_").concat(a)};JSON.stringify(m).length>xi.MAX_MESSAGE_SIZE?h-=50:(r.push(m),i=i.slice(h))}return r.map(m=>JSON.stringify(m))}handleCheckToken(i,r){return i.token!==r?(I.debug("token changed, from ".concat(i.token," to ").concat(r)),this.reset(i.uid,r),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{I.debug("token timeout, ".concat(r)),this.reset(i.uid)},V("MAX_P2P_TIMEOUT")),!0)}handleUserOnline(){var i=this;return L(function*(){const r=yield rn(i.signal,mn.CALL,void 0),a=yield i.send(mn.CALL,r);i.signal.emit(ce.P2P_CONNECTION,a,!0)})()}reset(i,r){var a=this;return L(function*(){const d=a.userMap.get(i);d&&(a.emit(iu.ABORT),a.signal.emit(xe.ON_USER_OFFLINE,{uid:d.uid,reason:uv.P2P_TOKEN_CHANGED}),a._sequence=0,a.userMap.clear(),r||(I.debug("change local token from ".concat(r," to ").concat(r)),a.token=Ke(6,"")))})()}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(iu.ABORT)}}S(xi,"MAX_SIZE",1),S(xi,"MAX_MESSAGE_SIZE",1024);class yT extends jt{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===Ee.CONNECTED?this.emit(ce.WS_CONNECTED):i===Ee.RECONNECTING?this.emit(ce.WS_RECONNECTING,this._websocketReconnectReason):i===Ee.CLOSED&&this.emit(ce.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(i,r){super(),S(this,"_disconnectedReason",void 0),S(this,"_websocketReconnectReason",void 0),S(this,"_connectionState",Ee.CLOSED),S(this,"reconnectToken",void 0),S(this,"p2pToken",void 0),S(this,"websocket",void 0),S(this,"openConnectionTime",void 0),S(this,"clientId",void 0),S(this,"lastMsgTime",Date.now()),S(this,"uploadCache",[]),S(this,"uploadCacheInterval",void 0),S(this,"rttRolling",new Dc(5)),S(this,"pingpongTimer",void 0),S(this,"pingpongTimeoutCount",0),S(this,"joinResponse",void 0),S(this,"multiIpOption",void 0),S(this,"initError",void 0),S(this,"spec",void 0),S(this,"store",void 0),S(this,"_external_signal",void 0),S(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(ce.ON_BINARY_DATA,a.data);const d=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(d,"_id")){const l="res-@".concat(d._id);this.emit(l,d._result,d._message)}else if(Object.prototype.hasOwnProperty.call(d,"_type")){switch(d._type){case xe.ON_DATA_STREAM:return void this.handleDataStream(d._message);case xe.MUTE_AUDIO:case xe.MUTE_VIDEO:case xe.ON_P2P_LOST:case xe.ON_USER_ONLINE:return;case xe.ON_USER_OFFLINE:const{uid:l}=d._message;return I.debug("[".concat(this.clientId,"] user-offline uid: ").concat(l)),void this._external_signal.reset(l)}if(this.emit(d._type,d._message),d._type===xe.ON_NOTIFICATION&&this.handleNotification(d._message),d._type===xe.ON_USER_BANNED)switch(d._message.error_code){case 14:this.close(ze.UID_BANNED);break;case 15:this.close(ze.IP_BANNED);break;case 16:this.close(ze.CHANNEL_BANNED)}if(d._type===xe.ON_USER_LICENSE_BANNED)switch(d._message.error_code){case oe.ERR_LICENSE_MISSING:this.close(ze.LICENSE_MISSING);break;case oe.ERR_LICENSE_EXPIRED:this.close(ze.LICENSE_EXPIRED);break;case oe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(ze.LICENSE_MINUTES_EXCEEDED);break;case oe.ERR_LICENSE_PERIOD_INVALID:this.close(ze.LICENSE_PERIOD_INVALID);break;case oe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(ze.LICENSE_MULTIPLE_SDK_SERVICE);break;case oe.ERR_LICENSE_ILLEGAL:this.close(ze.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=r,this.websocket=new dp("gateway-".concat(this.clientId),this.spec.retryConfig,!0,V("JOIN_GATEWAY_USE_DUAL_DOMAIN"),V("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ee.CONNECTED&&this.reconnect("retry",_i.OFFLINE)}),this.p2pToken=Ke(6,""),this._external_signal=new xi(this,this.p2pToken)}request(i,r,a,d){var l=this;return L(function*(){const h=Ke(6,""),p={_id:h,_type:i,_message:r},m=l.websocket.connectionID,_=()=>new X((O,D)=>{if(l.connectionState===Ee.CONNECTED)return O();const x=()=>{l.off(ce.WS_CLOSED,F),O()},F=()=>{l.off(ce.WS_CONNECTED,x),D(new ee(k.WS_ABORT))};l.once(ce.WS_CONNECTED,x),l.once(ce.WS_CLOSED,F)});if(l.connectionState!==Ee.CONNECTING&&l.connectionState!==Ee.RECONNECTING||i===Ae.JOIN||i===Ae.REJOIN||(yield _()),l.websocket.sendMessage(p,!0),d)return;const v=new X((O,D)=>{let x=!1;const F=(q,te)=>{x=!0,O({isSuccess:"success"===q,message:te||{}}),l.off(ce.WS_CLOSED,j),l.off(ce.WS_RECONNECTING,j),l.emit(ce.REQUEST_SUCCESS,i,r)};l.once("res-@".concat(h),F);const j=()=>{D(new ee(k.WS_ABORT,"type: ".concat(i))),l.off(ce.WS_CLOSED,j),l.off(ce.WS_RECONNECTING,j),l.off("res-@".concat(h),F)};l.once(ce.WS_CLOSED,j),l.once(ce.WS_RECONNECTING,j),Un(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{l.websocket.connectionID!==m||x||(I.warning("[".concat(l.clientId,"] ws request timeout, type: ").concat(i)),l.emit(ce.REQUEST_TIMEOUT,i,r))})});let b=null;try{b=yield v}catch(O){if(l.connectionState===Ee.CLOSED||i===Ae.LEAVE)throw new ee(k.WS_ABORT);return!l.spec.forceWaitGatewayResponse||a?O.throw():i===Ae.JOIN||i===Ae.REJOIN?null:(yield _(),yield l.request(i,r))}if(b.isSuccess)return b.message;const y=Number(b.message.error_code||b.message.code),T=ru(y),M=new ee(k.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(b.message.error_str),{code:y,data:b.message});return"success"===T.action?b.message:(I.warning("[".concat(l.clientId,"] [").concat(l.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(y,", message: ").concat(T.desc,", action: ").concat(T.action)),y===oe.ERR_TOO_MANY_BROADCASTERS?((i===Ae.JOIN||i===Ae.REJOIN)&&(l.initError=M,l.close()),M.throw()):"failed"===T.action?M.throw():"quit"===T.action?(l.initError=M,l.close(),M.throw()):(y===oe.ERR_JOIN_BY_MULTI_IP?(l.multiIpOption=b.message.option,I.warning("[".concat(l.clientId,"] detect multi ip, recover")),l.reconnect("recover",_i.MULTI_IP)):l.reconnect(T.action,_i.SERVER_ERROR),i===Ae.JOIN||i===Ae.REJOIN?null:yield l.request(i,r)))})()}waitMessage(i,r){return new X(a=>{const d=l=>{(!r||r(l))&&(this.off(i,d),a(l))};this.on(i,d)})}uploadWRTCStats(i){if(!this.store.sessionId)return void I.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:i};this.upload(xc.WRTC_STATS,r)}upload(i,r){const a={_type:i,_message:r};try{this.websocket.sendMessage(a)}catch{const l=V("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ee.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},V("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,r){this.websocket.sendMessage({_type:i,_message:r})}sendExtensionMessage(i,r,a){var d=this;return L(function*(){return yield d._external_signal.send(i,r,a)})()}init(i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new X((r,a)=>{this.once(ce.WS_CONNECTED,()=>r(this.joinResponse)),this.once(ce.WS_CLOSED,()=>a(this.initError||new ee(k.WS_ABORT))),this.connectionState=Ee.CONNECTING,this.websocket.init(i).catch(a)})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=i||ze.LEAVE,this.connectionState=Ee.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),i===ze.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new dp("gateway-".concat(this.clientId),this.spec.retryConfig,!0,V("JOIN_GATEWAY_USE_DUAL_DOMAIN"),V("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents()),this.p2pToken=Ke(6,""),this._external_signal.clear(),this._external_signal=new xi(this,this.p2pToken)}join(){var i=this;return L(function*(){if(!i.joinResponse){i.emit(ce.ABORT_P2P_EXECUTION);const r=yield rn(i,ce.REQUEST_JOIN_INFO),a=yield i.request(Ae.JOIN,r);if(!a)return i.emit(ce.REPORT_JOIN_GATEWAY,k.TIMEOUT,i.url||""),!1;i.joinResponse=a,i.emit(ce.JOIN_RESPONSE,i.joinResponse),i.reconnectToken=i.joinResponse.rejoin_token}return i.connectionState=Ee.CONNECTED,i.pingpongTimer&&window.clearInterval(i.pingpongTimer),i.pingpongTimer=window.setInterval(i.handlePingPong.bind(i),3e3),!0})()}reconnect(i,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,r)}handleDataStream(i){try{var r;const a=cm(i.payload),d=(new TextDecoder).decode(a),l=JSON.parse(d);"total"in l&&"id"in l||ye(r=Object.values(mn)).call(r,l._type)?(l._uid=i.uid,this._external_signal.onMessage(l)):this.emit(xe.ON_DATA_STREAM,i)}catch{this.emit(xe.ON_DATA_STREAM,i)}}handleNotification(i){I.debug("[".concat(this.clientId,"] receive notification: "),i);const r=ru(i.code);if("success"!==r.action){if("failed"!==r.action)return"quit"===r.action?("ERR_REPEAT_JOIN_CHANNEL"===r.desc&&this.close(ze.UID_BANNED),void this.close()):void this.reconnect(r.action,_i.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=V("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=i&&(I.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>V("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",_i.TIMEOUT):this.request(Ae.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-r;this.rttRolling.add(a),V("REPORT_STATS")&&this.send(Ae.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWebsocketEvents(){this.websocket.on(Me.RECONNECT_WAITTING_FINISH,i=>{this.emit(ce.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(Me.RECONNECT_CREATE_CONNECTION,i=>{this.emit(ce.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(Me.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Me.CLOSED,()=>{this.connectionState=Ee.CLOSED}),this.websocket.on(Me.FAILED,()=>{this._disconnectedReason=ze.NETWORK_ERROR,this.connectionState=Ee.CLOSED}),this.websocket.on(Me.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState=this.connectionState===Ee.CONNECTED?Ee.RECONNECTING:Ee.CONNECTING}),this.websocket.on(Me.WILL_RECONNECT,(i,r,a)=>{"retry"!==i?(I.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(i)),this.reconnectToken=void 0,this.emit(ce.NEED_RENEW_SESSION)):I.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(i)}),this.websocket.on(Me.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(i=>{if(this.emit(ce.REPORT_JOIN_GATEWAY,i.message||i.code,this.url||""),i instanceof ee&&i.code===k.UNEXPECTED_RESPONSE&&i.data.code===oe.ERR_NO_AUTHORIZED)return I.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",_i.SERVER_ERROR);I.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",_i.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(Me.REQUEST_NEW_URLS,(i,r)=>{rn(this,ce.REQUEST_RECOVER,this.multiIpOption).then(i).catch(r)}),this.websocket.on(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function Ev(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function ps(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?Ev(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Ev(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}const vv=new Map;class qO extends jt{get state(){return this._state}set state(i){if(i===this._state)return;const r=this._state;this._state=i,"DISCONNECTED"===i&&this._disconnectedReason?this.emit(on.CONNECTION_STATE_CHANGE,i,r,this._disconnectedReason):this.emit(on.CONNECTION_STATE_CHANGE,i,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(i){I.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(i)),this._joinGatewayStartTime=i}constructor(i,r){super(),S(this,"store",void 0),S(this,"joinInfo",void 0),S(this,"key",void 0),S(this,"ntpOffset",0),S(this,"signal",void 0),S(this,"role",void 0),S(this,"inChannelInfo",{joinAt:null,duration:0}),S(this,"spec",void 0),S(this,"_state","DISCONNECTED"),S(this,"_statsCollector",void 0),S(this,"_disconnectedReason",void 0),S(this,"isSignalRecover",!1),S(this,"hasChangeBGPAddress",!1),S(this,"trafficStatsInterval",void 0),S(this,"networkQualityInterval",void 0),S(this,"_joinGatewayStartTime",0),S(this,"_signalTimeout",!1),S(this,"_clientRoleOptions",void 0),S(this,"_isProactiveJoin",!1),this.store=i,this.spec=r,this.signal=this.store.useP2P?new yT(ps(ps({},r),{},{retryConfig:r.websocketRetryConfig}),i):this.store.useDataChannel?new Mo(ps(ps({},r),{},{retryConfig:r.websocketRetryConfig}),i):new uT(ps(ps({},r),{},{retryConfig:r.websocketRetryConfig}),i),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}join(i,r,a){var d=this;return L(function*(){if(d.signal instanceof Mo){let _=!1;"disabled"!==i.cloudProxyServer?(I.debug("[".concat(d.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(i.cloudProxyServer,")")),_=!0):"".concat(i.apResponse.cid,"_").concat(i.apResponse.cert).length>255||"".concat(i.apResponse.cid,"_").concat(i.apResponse.cert).length<22?(I.debug("[".concat(d.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),_=!0):i.apResponse.addresses.some(v=>v.fingerprint)||V("FINGERPRINT")||(I.debug("[".concat(d.store.clientId,"] Dc is not supported, because fingerprint does not exist")),_=!0),_&&d.resetSignal()}d.store.joinGatewayStart(),"disabled"!==i.cloudProxyServer&&(d.hasChangeBGPAddress=!0);const l=Date.now();let h=vv.get(i.cname);if(h||(h=new Map,vv.set(i.cname,h)),d._isProactiveJoin=!0,h.has(i.uid)){const _=new W(k.UID_CONFLICT);throw Ie.joinGateway(i.sid,{lts:l,succ:!1,ec:_.message,addr:null,uid:i.uid,cid:i.cid,firstSuccess:d._isProactiveJoin,avoidJoinStartTime:d.store.avoidJoinStart,isProxy:!!i.proxyServer,signalChannel:d.signal instanceof Mo?"1":"0"}),d._isProactiveJoin=!1,_}h.set(i.uid,!0),d.joinInfo=i,d.key=r;let p=0;d.joinGatewayStartTime=l;const m=i.proxyServer;try{let _;if(I.debug("[".concat(d.store.clientId,"] use ").concat(d.signal instanceof Mo?"datachannel":"websocket"," join uid ").concat(p)),d.signal instanceof Mo)_=yield d.signal.init(i.apResponse.addresses,a);else{const v=i.gatewayAddrs.map(b=>{let{address:y}=b;const[T,M]=y.split(":"),O={host:T,port:M};return i.proxyServer&&(O.proxy=i.proxyServer),O});_=yield d.signal.init(v,a)}p=_.uid,I.debug("[".concat(d.store.clientId,"] ").concat(d.signal instanceof Mo?"datachannel":"websocket"," join uid ").concat(p," cost ").concat(Date.now()-d.joinGatewayStartTime))}catch(_){throw _&&_.code===k.INIT_WEBSOCKET_TIMEOUT?(I.warning("[".concat(d.store.clientId,"] User join failed"),_.toString()),_):_&&_.code===k.INIT_DATACHANNEL_TIMEOUT?(I.warning("[".concat(d.store.clientId,"] User join datachannel failed"),_.toString()),d.resetSignal(),_):(I.error("[".concat(d.store.clientId,"] User join failed"),_.toString()),Ie.joinGateway(i.sid,{lts:l,succ:!1,ec:_.message,addr:d.signal.url,uid:i.uid,cid:i.cid,firstSuccess:d._isProactiveJoin,avoidJoinStartTime:d.store.avoidJoinStart,isProxy:!!m,signalChannel:d.signal instanceof Mo?"1":"0"}),d._isProactiveJoin=!1,h.delete(i.uid),d.signal.close(),_)}return d.state="CONNECTED",d.inChannelInfo.joinAt=Date.now(),I.debug("[".concat(d.store.clientId,"] Connected to gateway server")),d.trafficStatsInterval=window.setInterval(()=>{d.updateTrafficStats().catch(_=>{I.warning("[".concat(d.store.clientId,"] get traffic stats error"),_.toString())})},3e3),d.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?d.emit(on.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):d.emit(on.NETWORK_QUALITY,d._signalTimeout?{downlinkNetworkQuality:5,uplinkNetworkQuality:5}:"CONNECTED"===d.state&&d._statsCollector.trafficStats?{uplinkNetworkQuality:lp(d._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:lp(d._statsCollector.trafficStats.B_dnq)}:{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),d.store.joinGatewayEnd(),p})()}leave(){var i=arguments,r=this;return L(function*(){let a=i.length>0&&void 0!==i[0]&&i[0],d=i.length>1?i[1]:void 0;if("DISCONNECTED"!==r.state){d!==ze.FALLBACK&&(r.state="DISCONNECTING");try{a||r.signal.connectionState!==Ee.CONNECTED||(yield(l=r.signal.request(Ae.LEAVE,void 0,!0),3e3,X.race([l,Ua(3e3)])))}catch(l){I.warning("[".concat(r.store.clientId,"] leave request failed, ignore"),l)}r.signal.close(d),d!==ze.FALLBACK&&(r.state="DISCONNECTED"),r.reset()}var l})()}publish(i,r,a){var d=this;return L(function*(){if("CONNECTED"!==d.state&&"RECONNECTING"!==d.state)throw new W(k.INVALID_OPERATION,"can not publish when connection state is ".concat(d.state));const l={state:"offer",p2p_id:d.store.p2pId,ortc:r,mode:d.spec.mode,extend:V("PUB_EXTEND"),twcc:!!V("PUBLISH_TWCC"),rtx:!!V("USE_PUB_RTX")};try{return(yield d.signal.request(Ae.PUBLISH,l,!0))._message}catch(h){if(a&&h.data&&h.data.code===oe.ERR_PUBLISH_REQUEST_INVALID)return I.warning("[".concat(d.store.clientId,"] receive publish error code, retry"),h.toString()),yield d.tryUnpubBeforeRepub(i,r),d.publish(i,r,!1);throw h}})()}publishDataChannel(i,r,a){var d=this;return L(function*(){var l;if("CONNECTED"!==d.state&&"RECONNECTING"!==d.state)throw new W(k.INVALID_OPERATION,"can not publish when connection state is ".concat(d.state));const h={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:null!==(l=r.maxRetransmits)&&void 0!==l?l:10,channel_id:r.channelId,metadata:r.metadata};try{yield d.signal.request(Ae.PUBLISH_DATASTREAM,h,!0)}catch(p){if(a&&p.data&&p.data.code===oe.ERR_PUBLISH_REQUEST_INVALID)return I.warning("[".concat(d.store.clientId,"] receive publish datachannels error code, retry"),p.toString()),yield d.tryUnpubDataChannelBeforeRepub(i,r),d.publishDataChannel(i,r,!1);throw p}})()}unpublish(i,r){var a=this;return L(function*(){try{if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new W(k.INVALID_OPERATION,"can not publish when connection state is ".concat(a.state));yield a.signal.request(Ae.UNPUBLISH,{stream_id:r,ortc:i},!0)}catch(d){I.warning("[".concat(a.store.clientId,"] unpublish warning: "),d)}})()}unpublishDataChannel(i){var r=this;return L(function*(){try{if("CONNECTED"!==r.state&&"RECONNECTING"!==r.state)throw new W(k.INVALID_OPERATION,"can not publish when connection state is ".concat(r.state));yield X.all(i.map(a=>r.signal.request(Ae.UNPUBLISH_DATASTREAM,{channel_id:a},!0)))}catch(a){I.warning("unpublish datachannels warning: ",a)}})()}presubscribe(i,r,a){var d=this;return L(function*(){if("CONNECTED"!==d.state&&"RECONNECTING"!==d.state)throw new W(k.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(d.state));const l={stream_id:i,stream_type:r,mode:d.spec.mode,codec:d.spec.codec,p2p_id:d.store.p2pId,twcc:!!V("SUBSCRIBE_TWCC"),rtx:!!V("USE_SUB_RTX")||void 0,extend:V("SUB_EXTEND"),svc:Array.isArray(V("SVC"))&&0!==V("SVC").length?V("SVC"):void 0};try{return yield d.signal.request(Ae.PRE_SUBSCRIBE,l,!0)}catch(h){if(a&&h.data&&h.data.code===oe.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(d.store.clientId,"] pre-subscribe error, retry"),h.toString()),d.presubscribe(i,r,!1);throw h}})()}subscribe(i,r,a){var d=this;return L(function*(){if("CONNECTED"!==d.state&&"RECONNECTING"!==d.state)throw new W(k.INVALID_OPERATION,"can not subscribe when connection state is ".concat(d.state));const l={stream_id:i,stream_type:r.stream_type,mode:d.spec.mode,codec:d.spec.codec,p2p_id:d.store.p2pId,twcc:!!V("SUBSCRIBE_TWCC"),rtx:!!V("USE_SUB_RTX"),extend:V("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(V("SVC"))&&0!==V("SVC").length?V("SVC"):void 0};try{return(yield d.signal.request(Ae.SUBSCRIBE,l,!0))._message}catch(h){if(a&&h.data&&h.data.code===oe.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(d.store.clientId,"] receiver subscribe error code, retry"),h.toString()),yield d.tryUnsubBeforeResub(i,r),yield d.subscribe(i,r,!1);throw h}})()}subscribeDataChannel(i,r,a){var d=this;return L(function*(){if("CONNECTED"!==d.state&&"RECONNECTING"!==d.state)throw new W(k.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(d.state));const l={uid:i,stream_id:r.id,channel_id:r.datachannelId};try{return void(yield d.signal.request(Ae.SUBSCRIBE_DATASTREAM,l,!0))}catch(h){if(a&&h.data&&h.data.code===oe.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(d.store.clientId,"] receiver subscribe datachannel error code, retry"),h.toString()),yield d.tryUnsubDataChannelBeforeResub(i,r),yield d.subscribeDataChannel(i,r,!1);throw h}})()}subscribeAll(i,r){var a=this;return L(function*(){if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new W(k.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(a.state));const d={p2p_id:a.store.p2pId,users:i,dtx:!1,rtx:!!V("USE_SUB_RTX")};try{return yield a.signal.request(Ae.SUBSCRIBE_STREAMS,d,!0)}catch(l){if(r&&l.data&&l.data.code===oe.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(a.store.clientId,"] receiver massSubscribe error code, retry"),l.toString()),yield a.tryMassUnsubBeforeResub(i),yield a.subscribeAll(i,!1);throw l}})()}setVideoProfile(i){var r=this;return L(function*(){const a=function(d){if(!(d.bitrateMax&&d.bitrateMin&&d.frameRate&&d.height&&d.width))return;let l=d.frameRate,h=d.width,p=d.height,m=!0;return"number"!=typeof l&&(l=l.exact||l.ideal||l.max||l.min||0,l||(m=!1)),"number"!=typeof h&&(h=h.exact||h.ideal||h.max||h.min||0,h||(m=!1)),"number"!=typeof p&&(p=p.exact||p.ideal||p.max||p.min||0,l||(m=!1)),m?{stream_type:0,width:h,height:p,fps:l,start_bps:1e3*d.bitrateMax,min_bps:1e3*d.bitrateMin,target_bps:1e3*d.bitrateMax}:void 0}(i);if(a)return r.signal.request(Ae.SET_VIDEO_PROFILE,a);I.debug("[".concat(r.store.clientId,"] encoder config is not complete, do not report to gateway"))})()}unsubscribe(i,r){var a=this;return L(function*(){try{yield a.signal.request(Ae.UNSUBSCRIBE,{p2p_id:a.store.p2pId,ortc:i,stream_id:r},!0)}catch(d){I.warning("[".concat(a.store.clientId,"] unsubscribe warning: "),d)}})()}unsubscribeDataChannel(i,r){var a=this;return L(function*(){try{if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new W(k.INVALID_OPERATION,"can not publish when connection state is ".concat(a.state));yield X.all(i.map(d=>a.signal.request(Ae.UNSUBSCRIBE_DATASTREAM,{stream_id:d,uid:r},!0)))}catch(d){I.warning("unsubscribeDataChannel warning: ",d)}})()}massUnsubscribe(i){var r=this;return L(function*(){try{yield r.signal.request(Ae.UNSUBSCRIBE_STREAMS,i,!0)}catch(a){I.warning("[".concat(r.store.clientId,"] massUnsubscribeAll warning: "),a)}})()}reconnectPC(i){var r=this;return L(function*(){const{iceParameters:a,dtlsParameters:d,rtpCapabilities:l}=i;return{gatewayEstablishParams:yield r.signal.request(Ae.CONNECT_PC,{p2p_id:r.store.p2pId,stream_id:r.store.uid,ortc:{iceParameters:a,dtlsParameters:d,rtpCapabilities:l}},!0),gatewayAddress:r.getCurrentGatewayAddress()}})()}getGatewayInfo(){return this.signal.request(Ae.GATEWAY_INFO)}renewToken(i){var r=this;return L(function*(){yield r.signal.request(Ae.RENEW_TOKEN,i),r.key=i.token})()}setClientRole(i,r){var a=this;return L(function*(){if(r&&(a._clientRoleOptions=Object.assign({},r)),"CONNECTED"!==a.state)return void(a.role=i);let d,l=0;"audience"===i?a._clientRoleOptions&&a._clientRoleOptions.delay?(d=a._clientRoleOptions.delay,l=1):l=a._clientRoleOptions&&a._clientRoleOptions.level?a._clientRoleOptions.level:2:l=0,yield a.signal.request(Ae.SET_CLIENT_ROLE,{role:i,level:l,delay:d,client_ts:Date.now()}),a.role=i})()}setRemoteVideoStreamType(i,r){var a=this;return L(function*(){yield a.signal.request(Ae.SWITCH_VIDEO_STREAM,{stream_id:i,stream_type:r})})()}setDefaultRemoteVideoStreamType(i){var r=this;return L(function*(){yield r.signal.request(Ae.DEFAULT_VIDEO_STREAM,{stream_type:i})})()}setStreamFallbackOption(i,r){var a=this;return L(function*(){yield a.signal.request(Ae.SET_FALLBACK_OPTION,{stream_id:i,fallback_type:r})})()}pickSVCLayer(i,r){var a=this;return L(function*(){yield a.signal.request(Ae.PICK_SVC_LAYER,{stream_id:i,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})})()}setRTM2Flag(i){var r=this;return L(function*(){yield r.signal.request(Ae.SET_RTM2_FLAG,{rtm2_flag:i})})()}sendExtensionMessage(i,r,a){var d=this;return L(function*(){if(d.signal instanceof yT)return d.signal.sendExtensionMessage(i,r,a)})()}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),ps({},this.inChannelInfo)}getGatewayVersion(){var i=this;return L(function*(){return(yield i.signal.request(Ae.GATEWAY_INFO)).version})()}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const i=vv.get(this.joinInfo.cname);i&&i.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const i=function(r){let a;return a=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:Er.username,password:Er.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],i&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(ps(ps({},Er),{},{turnServerURL:i.turnServerURL,tcpport:i.tcpport,udpport:i.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}updateTrafficStats(){var i=this;return L(function*(){if("CONNECTED"!==i.state)return;const r=yield i.signal.request(Ae.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),null!=r.ntp_offset&&(i.ntpOffset=r.ntp_offset),r.peer_delay.forEach(a=>{const d=i._statsCollector.trafficStats&&i._statsCollector.trafficStats.peer_delay.find(l=>l.peer_uid===a.peer_uid);d&&d.B_st!==a.B_st&&am(()=>{i.emit(on.STREAM_TYPE_CHANGE,a.peer_uid,a.B_st)})}),i._statsCollector.updateTrafficStats(r)})()}getJoinMessage(i){if(!this.joinInfo||!this.key)throw new W(k.UNEXPECTED_ERROR,"can not generate join message, no join info");const r=Object.assign({},this.joinInfo.apResponse);let a=V("REPORT_APP_SCENARIO");if("string"!=typeof a)try{a=JSON.stringify(a)}catch{a=void 0}a&&a.length>128&&(a=void 0);const d=ps({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Do,browser:navigator.userAgent,process_id:V("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:V("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:a,attributes:{userAttributes:{enablePublishedUserList:V("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:V("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof V("SUBSCRIBE_AUDIO_FILTER_TOPN")?V("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof V("ENABLE_PUBLISH_AUDIO_FILTER")?V("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof V("ENABLE_USER_LICENSE_CHECK")?V("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===V("USE_PUB_RTX")||!0===V("USE_SUB_RTX")||void 0,disableFEC:V("DISABLE_FEC"),enableNTPReport:!!V("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!V("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:"boolean"==typeof V("ENABLE_DATASTREAM_2")?V("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!V("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:"boolean"==typeof V("USE_XR")?V("USE_XR"):void 0}},join_ts:this.joinGatewayStartTime},i);return this.joinInfo.stringUid&&(d.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(d.aes_mode=this.joinInfo.aesmode,V("ENCRYPT_AES")?(d.aes_secret=this.joinInfo.aespassword,d.aes_encrypt=!0):d.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(d.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(d.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),void 0!==this.joinInfo.defaultVideoStream&&(d.default_video_stream=this.joinInfo.defaultVideoStream),d}getRejoinMessage(){if(!this.joinInfo)throw new W(k.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){var i=this;this.signal.on(ce.WS_RECONNECT_WAITTING_FINISH,r=>{var a;ye(a=["tryNext","recover"]).call(a,r)&&this.joinInfo&&Ie.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(ce.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ce.WS_RECONNECTING,r=>{this.joinInfo&&Ie.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||_i.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Ie.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ce.WS_CLOSED,r=>{let a;switch(r){case ze.LEAVE:a=_i.LEAVE;break;case ze.UID_BANNED:case ze.IP_BANNED:case ze.CHANNEL_BANNED:case ze.SERVER_ERROR:a=_i.SERVER_ERROR;break;case ze.FALLBACK:a=_i.FALLBACK;break;case ze.LICENSE_MISSING:case ze.LICENSE_EXPIRED:case ze.LICENSE_MINUTES_EXCEEDED:case ze.LICENSE_PERIOD_INVALID:case ze.LICENSE_MULTIPLE_SDK_SERVICE:case ze.LICENSE_ILLEGAL:case ze.TOKEN_EXPIRE:a=r;break;default:a=_i.NETWORK_ERROR}I.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(a||"undefined -> "+_i.NETWORK_ERROR)),this.joinInfo&&Ie.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===ze.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:a}),this._disconnectedReason=r,r!==ze.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ce.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(I.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),Ie.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Mo?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void I.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));It("EVENT_REPORT_DOMAIN",r[1]),It("EVENT_REPORT_BACKUP_DOMAIN",r[1]),It("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}),this.signal.on(xe.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(ce.REQUEST_RECOVER,(r,a,d)=>{if(!this.joinInfo)return d(new W(k.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,rn(this,on.REQUEST_NEW_GATEWAY_LIST).then(a).catch(d)}),this.signal.on(ce.REQUEST_JOIN_INFO,function(){var r=L(function*(a){var d;if(i.updateTurnConfigFromSignal(),i.store.useP2P)return void a(i.getJoinMessage({ortc:{}}));const{iceParameters:l,dtlsParameters:h,rtpCapabilities:p}=yield rn(i,on.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(d=i.joinInfo)||void 0===d?void 0:d.turnServer});a(i.getJoinMessage({ortc:{iceParameters:l,dtlsParameters:h,rtpCapabilities:p,version:"2"}}))});return function(a){return r.apply(this,arguments)}}()),this.signal.on(ce.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(ce.REPORT_JOIN_GATEWAY,(r,a)=>{this.joinInfo&&(Ie.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,addr:a,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Mo?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(ce.IS_P2P_DISCONNECTED,r=>{r(mr(this,on.IS_P2P_DISCONNECTED))}),this.signal.on(ce.DISCONNECT_P2P,()=>{this.emit(on.DISCONNECT_P2P)}),this.signal.on(ce.NEED_RENEW_SESSION,()=>{this.emit(on.NEED_RENEW_SESSION)}),this.signal.on(ce.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ce.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ce.JOIN_RESPONSE,r=>{const a=this.getCurrentGatewayAddress();this.emit(on.JOIN_RESPONSE,r,a)}),this.signal.on(ce.DATACHANNEL_PRECONNECT,function(){var r=L(function*(a,d,l){i.updateTurnConfigFromSignal();const h=i.getCurrentGatewayAddress();return rn(i,on.DATACHANNEL_PRECONNECT,a,h).then(d).catch(l)});return function(a,d,l){return r.apply(this,arguments)}}()),this.signal.on(ce.DATACHANNEL_CONNECTING,function(){var r=L(function*(a){const{iceParameters:d,dtlsParameters:l,rtpCapabilities:h}=yield rn(i,on.REQUEST_DC_CONNECTION_PARAMS);a(i.getJoinMessage({ortc:{iceParameters:d,dtlsParameters:l,rtpCapabilities:h,version:"2"}}))});return function(a){return r.apply(this,arguments)}}()),this.signal.on(ce.DATACHANNEL_FAILBACK,()=>{I.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(on.DATACHANNEL_FAILBACK)})}tryUnsubBeforeResub(i,r){var a=this;return L(function*(){try{yield a.signal.request(Ae.UNSUBSCRIBE,{p2p_id:a.store.p2pId,stream_id:i,ortc:[r]},!0)}catch(d){throw I.warning("[".concat(a.store.clientId,"] tryUnsubBeforeResub warning"),d),d}})()}tryUnsubDataChannelBeforeResub(i,r){var a=this;return L(function*(){try{yield a.signal.request(Ae.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(d){throw I.warning("unsubscribe datachannel warning",d),d}})()}tryUnpubBeforeRepub(i,r){var a=this;return L(function*(){try{yield a.signal.request(Ae.UNPUBLISH,{stream_id:i,ortc:r},!0)}catch(d){throw I.warning("[".concat(a.store.clientId,"] tryUnpubBeforeRepub warning: "),d),d}})()}tryUnpubDataChannelBeforeRepub(i,r){var a=this;return L(function*(){try{yield a.signal.request(Ae.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(d){throw I.warning("unpublish datastream warning: ",d),d}})()}tryMassUnsubBeforeResub(i){var r=this;return L(function*(){const a={users:i.map(d=>({stream_id:d.stream_id,stream_type:d.stream_type}))};try{yield r.signal.request(Ae.UNSUBSCRIBE_STREAMS,a,!0)}catch(d){throw I.warning("[".concat(r.store.clientId,"] tryMassUnsubBeforeResub warning"),d),d}})()}muteLocal(i,r){var a=this;return L(function*(){const d={action:i.find(l=>l.stream_type===ut.Audio)?"mute_local_audio":"mute_local_video",p2p_id:a.store.p2pId,ortc:i,stream_id:r};try{yield a.signal.request(Ae.CONTROL,d,!0,!0)}catch(l){throw I.warning("[".concat(a.store.clientId,"] gateway muteLocal warning: "),l),l}})()}unmuteLocal(i,r){var a=this;return L(function*(){const d={action:i.find(l=>l.stream_type===ut.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:a.store.p2pId,ortc:i,stream_id:r};try{yield a.signal.request(Ae.CONTROL,d,!0,!0)}catch(l){throw I.warning("[".concat(a.store.clientId,"] gateway unmuteLocal warning: "),l),l}})()}muteRemote(i,r){var a=this;return L(function*(){const d={action:i===Ce.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:a.store.p2pId,stream_id:r};try{yield a.signal.request(Ae.CONTROL,d,!0,!0)}catch(l){throw I.warning("[".concat(a.store.clientId,"] gateway muteRemote warning: "),l),l}})()}unmuteRemote(i,r){var a=this;return L(function*(){const d={action:i===Ce.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:a.store.p2pId,stream_id:r};try{yield a.signal.request(Ae.CONTROL,d,!0,!0)}catch(l){throw I.warning("[".concat(a.store.clientId,"] gateway unmuteRemote warning: "),l),l}})()}uploadWRTCStats(i){this.signal.uploadWRTCStats(i)}upload(i,r){this.signal.upload(i,r)}getSignalRTT(){return this.signal.rtt}restartICE(i){var r=this;return L(function*(){const a={p2p_id:r.store.p2pId,stream_id:r.store.uid,ortc:i};try{return yield r.signal.request(Ae.RESTART_ICE,a,!0)}catch(d){throw I.warning("[".concat(r.store.clientId,"] P2PChannel.restartICE warning: "),d),d}})()}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,_i.P2P_FAILED)}getCurrentGatewayAddress(){var i;if(!V("GATEWAY_WSS_ADDRESS"))return null!==(i=this.joinInfo)&&void 0!==i&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}setPublishAudioFilterEnabled(i){var r=this;return L(function*(){yield r.signal.request(Ae.SET_PARAMETER,{enablePublishAudioFilter:i})})()}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(ze.FALLBACK)),this.store.useDataChannel=!1,this.signal=new uT(ps(ps({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(on.RESET_SIGNAL,ym.websocket)}}let Am=0,bv=0;function Ha(s,i,r,a){return new X((d,l)=>{i.timeout=i.timeout||V("HTTP_CONNECT_TIMEOUT"),i.responseType=i.responseType||"json",i.data&&!r?(i.data=JSON.stringify(i.data),Am+=Fa(i.data)):r&&(i.data.size?Am+=i.data.size:i.data instanceof FormData?Am+=AD(i.data):Am+=Fa(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=s,Ze.request(i).then(h=>{"string"==typeof h.data?bv+=Fa(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?bv+=h.data.byteLength:bv+=Fa(JSON.stringify(h.data)),a&&d({data:h.data,headers:h.headers}),d(h.data)}).catch(h=>{Ze.isCancel(h)?l(new W(k.OPERATION_ABORTED,"cancel token canceled")):l("ECONNABORTED"===h.code?new W(k.NETWORK_TIMEOUT,h.message):h.response?new W(k.NETWORK_RESPONSE_ERROR,h.response.status):new W(k.NETWORK_ERROR,h.message))})})}!function(){var s;function i(ie){var ue=0;return function(){return ue<ie.length?{done:!1,value:ie[ue++]}:{done:!0}}}var a,r="function"==typeof Object.defineProperties?Object.defineProperty:function(ie,ue,Se){return ie==Array.prototype||ie==Object.prototype||(ie[ue]=Se.value),ie},d=function(ie){ie=["object"==typeof globalThis&&globalThis,ie,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Ys&&Ys];for(var ue=0;ue<ie.length;++ue){var Se=ie[ue];if(Se&&Se.Math==Math)return Se}throw Error("Cannot find global object")}(this);function l(ie,ue){if(ue)e:{var Se=d;ie=ie.split(".");for(var ke=0;ke<ie.length-1;ke++){var ht=ie[ke];if(!(ht in Se))break e;Se=Se[ht]}(ue=ue(ke=Se[ie=ie[ie.length-1]]))!=ke&&null!=ue&&r(Se,ie,{configurable:!0,writable:!0,value:ue})}}function h(ie){return(ie={next:ie})[Symbol.iterator]=function(){return this},ie}function p(ie){var ue=typeof Symbol<"u"&&Symbol.iterator&&ie[Symbol.iterator];return ue?ue.call(ie):{next:i(ie)}}if(l("Symbol",function(ie){function ue(ht,pe){this.A=ht,r(this,"description",{configurable:!0,writable:!0,value:pe})}if(ie)return ie;ue.prototype.toString=function(){return this.A};var Se="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ke=0;return function ht(pe){if(this instanceof ht)throw new TypeError("Symbol is not a constructor");return new ue(Se+(pe||"")+"_"+ke++,pe)}}),l("Symbol.iterator",function(ie){if(ie)return ie;ie=Symbol("Symbol.iterator");for(var ue="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Se=0;Se<ue.length;Se++){var ke=d[ue[Se]];"function"==typeof ke&&"function"!=typeof ke.prototype[ie]&&r(ke.prototype,ie,{configurable:!0,writable:!0,value:function(){return h(i(this))}})}return ie}),"function"==typeof Object.setPrototypeOf)a=Object.setPrototypeOf;else{var m;e:{var _={};try{_.__proto__={a:!0},m=_.a;break e}catch{}m=!1}a=m?function(ie,ue){if(ie.__proto__=ue,ie.__proto__!==ue)throw new TypeError(ie+" is not extensible");return ie}:null}var v=a;function b(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function y(ie){if(ie.m)throw new TypeError("Generator is already running");ie.m=!0}function T(ie,ue){return ie.h=3,{value:ue}}function M(ie){this.g=new b,this.G=ie}function O(ie,ue,Se,ke){try{var ht=ue.call(ie.g.j,Se);if(!(ht instanceof Object))throw new TypeError("Iterator result "+ht+" is not an object");if(!ht.done)return ie.g.m=!1,ht;var pe=ht.value}catch(w){return ie.g.j=null,ie.g.s(w),D(ie)}return ie.g.j=null,ke.call(ie.g,pe),D(ie)}function D(ie){for(;ie.g.h;)try{var ue=ie.G(ie.g);if(ue)return ie.g.m=!1,{value:ue.value,done:!1}}catch(Se){ie.g.v=void 0,ie.g.s(Se)}if(ie.g.m=!1,ie.g.l){if(ue=ie.g.l,ie.g.l=null,ue.F)throw ue.D;return{value:ue.return,done:!0}}return{value:void 0,done:!0}}function x(ie){this.next=function(ue){return ie.o(ue)},this.throw=function(ue){return ie.s(ue)},this.return=function(ue){return function(Se,ke){y(Se.g);var ht=Se.g.j;return ht?O(Se,"return"in ht?ht.return:function(pe){return{value:pe,done:!0}},ke,Se.g.return):(Se.g.return(ke),D(Se))}(ie,ue)},this[Symbol.iterator]=function(){return this}}function F(ie,ue){return ue=new x(new M(ue)),v&&ie.prototype&&v(ue,ie.prototype),ue}if(b.prototype.o=function(ie){this.v=ie},b.prototype.s=function(ie){this.l={D:ie,F:!0},this.h=this.C||this.u},b.prototype.return=function(ie){this.l={return:ie},this.h=this.u},M.prototype.o=function(ie){return y(this.g),this.g.j?O(this,this.g.j.next,ie,this.g.o):(this.g.o(ie),D(this))},M.prototype.s=function(ie){return y(this.g),this.g.j?O(this,this.g.j.throw,ie,this.g.o):(this.g.s(ie),D(this))},l("Array.prototype.entries",function(ie){return ie||function(){return function(ue,Se){ue instanceof String&&(ue+="");var ke=0,ht=!1,pe={next:function(){if(!ht&&ke<ue.length){var w=ke++;return{value:Se(w,ue[w]),done:!1}}return ht=!0,{done:!0,value:void 0}}};return pe[Symbol.iterator]=function(){return pe},pe}(this,function(ue,Se){return[ue,Se]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var j=function(ie,ue){for(var Se=0;Se<ie.length;Se++)ue(ie[Se])},q=function(ie){return ie.replace(/\r?\n|\r/g,"\r\n")},te=function(ie,ue,Se){return ue instanceof Blob?(ue.name===(Se=void 0!==Se?Se+"":"string"==typeof ue.name?ue.name:"blob")&&"[object Blob]"!==Object.prototype.toString.call(ue)||(ue=new File([ue],Se)),[String(ie),ue]):[String(ie),String(ue)]},K=function(ie,ue){if(ie.length<ue)throw new TypeError(ue+" argument required, but only "+ie.length+" present.")},Q="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,$=Q.FormData,z=Q.XMLHttpRequest&&Q.XMLHttpRequest.prototype.send,_e=Q.Request&&Q.fetch,me=Q.navigator&&Q.navigator.sendBeacon,Fe=Q.Element&&Q.Element.prototype,rt=Q.Symbol&&Symbol.toStringTag;rt&&(Blob.prototype[rt]||(Blob.prototype[rt]="Blob"),"File"in Q&&!File.prototype[rt]&&(File.prototype[rt]="File"));try{new File([],"")}catch{Q.File=function(ue,Se,ke){return ue=new Blob(ue,ke||{}),Object.defineProperties(ue,{name:{value:Se},lastModified:{value:+(ke&&void 0!==ke.lastModified?new Date(ke.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),rt&&Object.defineProperty(ue,rt,{value:"File"}),ue}}var ci=function(ie){return ie.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Zt=function(ie){this.i=[];var ue=this;ie&&j(ie.elements,function(Se){if(Se.name&&!Se.disabled&&"submit"!==Se.type&&"button"!==Se.type&&!Se.matches("form fieldset[disabled] *"))if("file"===Se.type){var ke=Se.files&&Se.files.length?Se.files:[new File([],"",{type:"application/octet-stream"})];j(ke,function(ht){ue.append(Se.name,ht)})}else"select-multiple"===Se.type||"select-one"===Se.type?j(Se.options,function(ht){!ht.disabled&&ht.selected&&ue.append(Se.name,ht.value)}):"checkbox"===Se.type||"radio"===Se.type?Se.checked&&ue.append(Se.name,Se.value):(ke="textarea"===Se.type?q(Se.value):Se.value,ue.append(Se.name,ke))})};if((s=Zt.prototype).append=function(ie,ue,Se){K(arguments,2),this.i.push(te(ie,ue,Se))},s.delete=function(ie){K(arguments,1);var ue=[];ie=String(ie),j(this.i,function(Se){Se[0]!==ie&&ue.push(Se)}),this.i=ue},s.entries=function ie(){var ue,Se=this;return F(ie,function(ke){if(1==ke.h&&(ue=0),3!=ke.h)return ue<Se.i.length?ke=T(ke,Se.i[ue]):(ke.h=0,ke=void 0),ke;ue++,ke.h=2})},s.forEach=function(ie,ue){K(arguments,1);for(var Se=p(this),ke=Se.next();!ke.done;ke=Se.next()){var ht=p(ke.value);ke=ht.next().value,ht=ht.next().value,ie.call(ue,ht,ke,this)}},s.get=function(ie){K(arguments,1);var ue=this.i;ie=String(ie);for(var Se=0;Se<ue.length;Se++)if(ue[Se][0]===ie)return ue[Se][1];return null},s.getAll=function(ie){K(arguments,1);var ue=[];return ie=String(ie),j(this.i,function(Se){Se[0]===ie&&ue.push(Se[1])}),ue},s.has=function(ie){K(arguments,1),ie=String(ie);for(var ue=0;ue<this.i.length;ue++)if(this.i[ue][0]===ie)return!0;return!1},s.keys=function ie(){var ue,Se,pe=this;return F(ie,function(w){if(1==w.h&&(ue=p(pe),Se=ue.next()),3!=w.h)return Se.done?void(w.h=0):T(w,p(Se.value).next().value);Se=ue.next(),w.h=2})},s.set=function(ie,ue,Se){K(arguments,2),ie=String(ie);var ke=[],ht=te(ie,ue,Se),pe=!0;j(this.i,function(w){w[0]===ie?pe&&(pe=!ke.push(ht)):ke.push(w)}),pe&&ke.push(ht),this.i=ke},s.values=function ie(){var ue,Se,ht,pe=this;return F(ie,function(w){if(1==w.h&&(ue=p(pe),Se=ue.next()),3!=w.h)return Se.done?void(w.h=0):((ht=p(Se.value)).next(),T(w,ht.next().value));Se=ue.next(),w.h=2})},Zt.prototype._asNative=function(){for(var ie=new $,ue=p(this),Se=ue.next();!Se.done;Se=ue.next()){var ke=p(Se.value);Se=ke.next().value,ke=ke.next().value,ie.append(Se,ke)}return ie},Zt.prototype._blob=function(){var ie="----formdata-polyfill-"+Math.random(),ue=[],Se="--"+ie+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(ke,ht){return"string"==typeof ke?ue.push(Se+ci(q(ht))+'"\r\n\r\n'+q(ke)+"\r\n"):ue.push(Se+ci(q(ht))+'"; filename="'+ci(ke.name)+'"\r\nContent-Type: '+(ke.type||"application/octet-stream")+"\r\n\r\n",ke,"\r\n")}),ue.push("--"+ie+"--"),new Blob(ue,{type:"multipart/form-data; boundary="+ie})},Zt.prototype[Symbol.iterator]=function(){return this.entries()},Zt.prototype.toString=function(){return"[object FormData]"},Fe&&!Fe.matches&&(Fe.matches=Fe.matchesSelector||Fe.mozMatchesSelector||Fe.msMatchesSelector||Fe.oMatchesSelector||Fe.webkitMatchesSelector||function(ie){for(var ue=(ie=(this.document||this.ownerDocument).querySelectorAll(ie)).length;0<=--ue&&ie.item(ue)!==this;);return-1<ue}),rt&&(Zt.prototype[rt]="FormData"),z){var Fi=Q.XMLHttpRequest.prototype.setRequestHeader;Q.XMLHttpRequest.prototype.setRequestHeader=function(ie,ue){Fi.call(this,ie,ue),"content-type"===ie.toLowerCase()&&(this.B=!0)},Q.XMLHttpRequest.prototype.send=function(ie){ie instanceof Zt?(ie=ie._blob(),this.B||this.setRequestHeader("Content-Type",ie.type),z.call(this,ie)):z.call(this,ie)}}_e&&(Q.fetch=function(ie,ue){return ue&&ue.body&&ue.body instanceof Zt&&(ue.body=ue.body._blob()),_e.call(this,ie,ue)}),me&&(Q.navigator.sendBeacon=function(ie,ue){return ue instanceof Zt&&(ue=ue._asNative()),me.call(this,ie,ue)}),Q.FormData=Zt}}();const Dm=()=>{const s=V("AREAS");return 0===s.length&&s.push(st.GLOBAL),Va(s).call(s,(i,r,a)=>{const d=CT(r);return d?0===a?d:"".concat(i,",").concat(d):i},"")},CT=s=>s===st.OVERSEA?"".concat(Yn.ASIA,",").concat(Yn.EUROPE,",").concat(Yn.AFRICA,",").concat(Yn.NORTH_AMERICA,",").concat(Yn.SOUTH_AMERICA,",").concat(Yn.OCEANIA):Yn[s],JL=s=>{const i={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return s.map(r=>{const a=lv[r],d=Object.keys(a);d&&d.map(l=>{"CODE"!==l&&(i[l]=i[l].concat(a[l]))})}),i},up={GLOBAL:{ASIA:[st.CHINA,st.JAPAN,st.INDIA,st.KOREA,st.HKMC],EUROPE:[],NORTH_AMERICA:[st.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},js=Object.keys(up[st.GLOBAL]),ST=[st.CHINA,st.NORTH_AMERICA,st.EUROPE,st.ASIA,st.JAPAN,st.INDIA,st.OCEANIA,st.SOUTH_AMERICA,st.AFRICA,st.KOREA,st.HKMC,st.US],QL=function(s,i){let r=[];if(ye(s).call(s,st.GLOBAL)){const l=[st.GLOBAL,st.OVERSEA],h=Object.keys(lv);if(i===st.GLOBAL)throw new W(k.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(i===st.CHINA)r=[st.OVERSEA];else if(d=i,ye(js).call(js,d)){const p=up[st.GLOBAL][i]||[],m=[...l,i,...p];r=h.filter(_=>!ye(m).call(m,_))}else if(function(p){let m=!1;return js.forEach(_=>{var v;ye(v=up[st.GLOBAL][_]).call(v,p)&&(m=!0)}),m}(i)){const p=function(_){let v;return js.forEach(b=>{var y;ye(y=up[st.GLOBAL][b]).call(y,_)&&(v=b)}),v}(i),m=[...l,p,i];r=h.filter(_=>!ye(m).call(m,_))}else r=s;r=function(p){const m=[];return ST.forEach(_=>{ye(p).call(p,_)&&m.push(_)}),m.concat(p.filter(_=>!ye(ST).call(ST,_)))}(r)}else r=s;var d;return r};function YO(s){var i,r;if(!s&&ye(i=V("AREAS")).call(i,st.EXTENSIONS))return I.debug("update area from ap : reset"),void hp(OL,!0);if(!ye(r=V("AREAS")).call(r,st.GLOBAL)||!s)return;let a=lv.EXTENSIONS;a&&(a={CODE:CT(st.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(s,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(s,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(s,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(s,".agora.io"),"cds-ap-web-2-".concat(s,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(s,".agora.io"),"sua-ap-web-2-".concat(s,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(s,".agora.io"),"uap-ap-web-2-".concat(s,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(s,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(s,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(s,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(s,".agora.io")]},I.debug("update area from ap success: ".concat(s,",config is "),a),It("AREAS",[st.EXTENSIONS],!0),Object.keys(a).map(d=>{It(d,"LOG_UPLOAD_SERVER"===d||"EVENT_REPORT_DOMAIN"===d||"EVENT_REPORT_BACKUP_DOMAIN"===d||"PROXY_SERVER_TYPE3"===d?a[d][0]:a[d])}))}function hp(s){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=Ie.reportApiInvoke(null,{name:Kn.SET_AREA,options:s,tag:qt.TRACER});try{let a=[];if("string"==typeof s&&(a=[s]),Array.isArray(s)&&(s.forEach(l=>{if(!ye(xO).call(xO,l))throw new W(k.INVALID_PARAMS,"invalid area code")}),a=s),"[object Object]"===Object.prototype.toString.call(s)){const{areaCode:l,excludedArea:h}=s;if(!l)throw new W(k.INVALID_PARAMS,"area code is needed");let p=l;"string"==typeof l&&(p=[l]),a=h?QL(p,h):p}if(!i){if(kd.AREAS){const l=new W(k.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(l),void I.warning("setArea is prohibited because of config-distribute")}if(ye(a).call(a,st.GLOBAL)&&V("AREAS")===st.EXTENSIONS){const l=new W(k.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(l),void I.warning("setArea is prohibited because of ap extensions")}}It("AREAS",a,i);const d=JL(a);Object.keys(d).map(l=>{It(l,"LOG_UPLOAD_SERVER"===l||"EVENT_REPORT_DOMAIN"===l||"EVENT_REPORT_BACKUP_DOMAIN"===l||"PROXY_SERVER_TYPE3"===l?d[l][0]:d[l])}),I.debug("set area success:",a.join(","))}catch(a){throw r.onError(a),a}r.onSuccess()}function yv(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Om(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?yv(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):yv(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}let Cv=1;let Nm=1;function $O(s,i,r,a){let{url:d,areaCode:l}=s;const h=Date.now();let p;const[m,_]=Sv(i,l,[yi.CHOOSE_SERVER]);let v=Fn.networkState;return In(L(function*(){v&&Fn.networkState===Xi.OFFLINE&&Fn.onlineWaiter&&(yield X.race([Fn.onlineWaiter,Un(a&&a.maxRetryTimeout||Pn.maxRetryTimeout)])),v=Fn.networkState;const{data:b,headers:y}=yield Ha(d,{data:m,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p="1"===y.http3?1:-1,Ie.reportResourceTiming(d,i.sid),JO(b,d,i,h,[yi.CHOOSE_SERVER],p);const T=gv(b,yi.CHOOSE_SERVER);return QO(T),ET(T,d)}),b=>(b&&Ie.joinChooseServer(i.sid,{lts:h,succ:!0,csAddr:d,opid:_,serverList:b.gatewayAddrs.map(y=>y.address),ec:null,cid:b.cid.toString(),uid:b.uid.toString(),csIp:b.csIp,unilbsServerIds:[yi.CHOOSE_SERVER].toString(),isHttp3:p}),!1),b=>b.code!==k.OPERATION_ABORTED&&(b.code===k.CAN_NOT_GET_GATEWAY_SERVER?b.data.retry:(Ie.joinChooseServer(i.sid,{lts:h,succ:!1,csAddr:d,serverList:null,opid:_,ec:b.code,csIp:b.data&&b.data.csIp,unilbsServerIds:[yi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:v}),isHttp3:p}),I.warning("[".concat(i.clientId,"] Choose server network error, retry"),b),!0)),a)}function XO(s,i,r,a){let d,{url:l,areaCode:h,serviceIds:p}=s;const m=Date.now(),[_,v]=Sv(i,h,p);let b;return In(L(function*(){b&&Fn.networkState===Xi.OFFLINE&&Fn.onlineWaiter&&(yield X.race([Fn.onlineWaiter,Un(a&&a.maxRetryTimeout||Pn.maxRetryTimeout)])),b=Fn.networkState;const{data:y,headers:T}=yield Ha(l,{data:_,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);d="1"===T.http3?1:-1,Ie.reportResourceTiming(l,i.sid),JO(y,l,i,m,p,d);const M=gv(y,yi.CHOOSE_SERVER),O=gv(y,"proxy5"===i.cloudProxyServer?yi.CLOUD_PROXY_5:"proxy3"===i.cloudProxyServer||"proxy4"===i.cloudProxyServer?yi.CLOUD_PROXY:yi.CLOUD_PROXY_FALLBACK);return QO(M),{gatewayInfo:ET(M,l),proxyInfo:O,url:l}}),y=>(y.gatewayInfo&&Ie.joinChooseServer(i.sid,{lts:m,succ:!0,csAddr:l,serverList:y.gatewayInfo.gatewayAddrs.map(T=>T.address),ec:null,opid:v,cid:y.gatewayInfo.cid.toString(),uid:y.gatewayInfo.uid.toString(),csIp:y.gatewayInfo.csIp,unilbsServerIds:p.toString(),isHttp3:d}),y.proxyInfo&&Ie.joinWebProxyAP(i.sid,{lts:m,sucess:1,apServerAddr:l,turnServerAddrList:y.proxyInfo.addresses.map(T=>T.ip).join(","),errorCode:null,eventType:i.cloudProxyServer,unilbsServerIds:p.toString()}),!1),y=>y.code!==k.OPERATION_ABORTED&&(y.code===k.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(Ie.joinWebProxyAP(i.sid,{lts:m,sucess:0,apServerAddr:l,turnServerAddrList:null,errorCode:y.code,eventType:i.cloudProxyServer,unilbsServerIds:p.toString(),extend:JSON.stringify({networkState:b})}),I.warning("[".concat(i.clientId,"] multi unilbs network error, retry"),y),!0)),a)}const JO=(s,i,r,a,d,l)=>{const h=[],p=m=>{4096===m.flag?Ie.joinChooseServer(r.sid,{lts:a,succ:!1,csAddr:i,opid:s.opid,serverList:null,ec:m.error.message,csIp:m.error.data&&m.error.data.csIp,unilbsServerIds:d.toString(),isHttp3:l}):1048576!==m.flag&&4194304!==m.flag&&4194310!==m.flag||Ie.joinWebProxyAP(r.sid,{lts:a,sucess:0,apServerAddr:i,turnServerAddrList:null,errorCode:m.error.code,eventType:r.cloudProxyServer,unilbsServerIds:d.toString()})};if(s.response_body.forEach(m=>{const _=m.buffer.code;if(23===m.uri&&0===_&&!m.buffer.edges_services)if(4194310===m.buffer.flag)I.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),m.buffer.edges_services=[];else{const v={error:new W(k.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:s.detail[502]}),flag:m.buffer.flag};h.push(v),p(v)}if(0!==_){const v=Tm(_),b={error:new W(k.CAN_NOT_GET_GATEWAY_SERVER,v.desc,{desc:v.desc,retry:v.retry,csIp:s.detail[502]}),flag:m.buffer.flag};4194310===m.buffer.flag?I.warning(b.error.toString()):h.push(b),p(b)}}),h.length)throw I.warning("[".concat(r.clientId,"] multi unilbs ").concat(i," failed, ").concat(h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message,", retry: ").concat(m.error.data.retry)).join(" | "))),new W(k.CAN_NOT_GET_GATEWAY_SERVER,h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message)).join(" | "),{retry:!!h.find(m=>m.error.data.retry),csIp:s.detail[502],desc:[...new Set(h.map(m=>{var _;return null==m||null===(_=m.error)||void 0===_||null===(_=_.data)||void 0===_?void 0:_.desc}).filter(m=>!!m))]})},QO=s=>{var i,r,a,d;if(s.addresses&&0===s.addresses.length&&0===s.code)throw new W(k.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:s.detail&&s.detail[502]});if(V("AP_AREA")&&(null!==(a=s.detail)&&void 0!==a&&a[23]&&"string"==typeof(null===(d=s.detail)||void 0===d?void 0:d[23])?YO(s.detail[23].toLowerCase()):YO()),null!==(i=s.detail)&&void 0!==i&&i[19]&&"string"==typeof(null===(r=s.detail)||void 0===r?void 0:r[19])){const h=s.detail[19],p=h?.split(";");for(let m=0;m<p.length;m++){var l;const _=fv(l=p[m]).call(l);s.addresses[m]&&p&&(s.addresses[m].fingerprint=_)}}if(V("GATEWAY_ADDRESS")&&V("GATEWAY_ADDRESS").length>0){I.debug("assign gateway address to",V("GATEWAY_ADDRESS"));const h=V("GATEWAY_ADDRESS").map(p=>{var m,_;const v=null!==(m=null===(_=s.addresses.find(b=>b.ip===p.ip&&b.port===p.port))||void 0===_?void 0:_.fingerprint)&&void 0!==m?m:"";return{ip:p.ip,port:p.port,ticket:s.addresses[0]&&s.addresses[0].ticket,fingerprint:v}});s.addresses=h}},ZO=(s,i)=>{if(s.response_body&&s.response_body.length){const r=s.response_body[0];if(0!==r.buffer.code){const a=Tm(r.buffer.code);throw new W(k.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return r.buffer.ticket}throw I.debug("update ticket request received ap response without response body:",i),new W(k.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Sv=(s,i,r)=>{const a=Math.floor(1e12*Math.random()),d={appid:s.appId,client_ts:Date.now(),opid:a,sid:s.sid,request_bodies:[{uri:22,buffer:{cname:s.cname,detail:Om({6:s.stringUid,11:i,12:V("USE_NEW_TOKEN")?"1":void 0,22:i},s.apRTM?{26:"RTM2"}:{}),key:s.token,service_ids:r,uid:s.uid||0}}]};d.request_bodies.forEach(h=>{s.multiIP&&s.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[s.multiIP.uni_lbs_ip],vos_ip:[s.multiIP.gateway_ip]}))});const l=new FormData;return l.append("request",JSON.stringify(d)),[l,a]},ZL=(s,i)=>{const r=Math.floor(1e12*Math.random()),a={appid:s.appId,client_ts:Date.now(),opid:r,sid:s.sid,request_bodies:[{uri:28,buffer:{cname:s.cname,detail:{1:"",6:s.stringUid,12:"1"},token:s.token,service_ids:i,uid:s.uid||0,edges_services:s.apResponse.addresses.map(l=>({ip:l.ip,port:l.port}))}}]},d=new FormData;return d.append("request",JSON.stringify(a)),[d,r]};let ou=0;function su(s){return X.all(s.map(i=>i.then(r=>{throw r},r=>r))).then(i=>{throw i},i=>i)}const Pm=function(){var s=L(function*(i){let{fragementLength:r,referenceList:a,asyncMapHandler:d,allFailedhandler:l,promisesCollector:h}=i,p=0;const m=r;let _,v=0;const b=function(){var y=L(function*(){const T=(()=>{const M=p*m;return a.slice(M,M+m).map(d)})();h&&h.push(...T);try{_=yield su(T)}catch(M){if(v+=m,p++,!(v>=a.length))return void(yield b());l(M)}T.forEach(M=>M.cancel())});return function(){return y.apply(this,arguments)}}();return yield b(),_});return function(r){return s.apply(this,arguments)}}();function Tv(s,i,r,a){return ua.apply(this,arguments)}function ua(){return ua=L(function*(s,i,r,a){return{gatewayInfo:yield(l=L(function*(h,p,m,_){let v=null;const b=[],y=function(){var M=L(function*(){const O=V("WEBCS_DOMAIN").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(F=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(F+"/api/v2/transpond/webrtc?v=2"):"https://".concat(F,"/api/v2/transpond/webrtc?v=2"),areaCode:Dm()})),D=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(F=>F.url)}),x=yield Pm({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:F=>(I.debug("[".concat(h.clientId,"] Connect to choose_server:"),F.url),$O(F,h,p,m)),allFailedhandler:F=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:F},D),F[0]},promisesCollector:b});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},D),x});return function(){return M.apply(this,arguments)}}(),T=function(){var M=L(function*(){if(yield Un(1e3),null!==v)return v;const O=V("WEBCS_DOMAIN_BACKUP_LIST").map(F=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(F+"/api/v2/transpond/webrtc?v=2"):"https://".concat(F,"/api/v2/transpond/webrtc?v=2"),areaCode:Dm()})),D=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(F=>F.url)}),x=yield Pm({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:F=>(I.debug("[".concat(h.clientId,"] Connect to backup choose_server:"),F.url),$O(F,h,p,m)),allFailedhandler:F=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:F},D),F[0]},promisesCollector:b});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},D),x});return function(){return M.apply(this,arguments)}}();try{return v=yield su([y(),T()]),b.length&&b.forEach(M=>M.cancel&&"function"==typeof M.cancel&&M.cancel()),v}catch(M){throw M[0]}}),function(h,p,m,_){return l.apply(this,arguments)})(s,i,r,a)};var l}),ua.apply(this,arguments)}function ha(s,i,r,a,d){return Zi.apply(this,arguments)}function Zi(){return Zi=L(function*(s,i,r,a,d){const l=s.cloudProxyServer;if("disabled"===l){if(!a)return;if(s.useLocalAccessPoint)return yield Tv(s,i,r,d);if(V("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:y,proxyInfo:T}=yield eN(s,i,r,d);if(s.turnServer&&"auto"!==s.turnServer.mode)return{gatewayInfo:y};const M=T.map(O=>({turnServerURL:O.address,tcpport:O.tcpport||Er.tcpport,udpport:O.udpport||Er.udpport,username:O.username||Er.username,password:O.password||Er.password,forceturn:!1,security:!0}));if(d.useP2P){var h;const O=null!==(h=s.uid)&&void 0!==h?h:y.uid,D="glb:".concat(O.toString()),x=yield zh(D),F=T.map(j=>({turnServerURL:j.address,tcpport:j.tcpport||Er.tcpport,udpport:j.udpport||Er.udpport,username:D,password:x,forceturn:!1,security:!0}));M.push(...F)}return s.turnServer={mode:"manual",servers:M},{gatewayInfo:y}}return yield Tv(s,i,r,d)}const{proxyInfo:p,gatewayInfo:m}=yield eN(s,i,r,d),_={gatewayInfo:m},v=p.map(y=>({turnServerURL:y.address,tcpport:"proxy3"===l?void 0:y.tcpport?y.tcpport:Er.tcpport,udpport:"proxy4"===l?void 0:y.udpport?y.udpport:Er.udpport,username:y.username||Er.username,password:y.password||Er.password,forceturn:"proxy4"!==l,security:"proxy5"===l}));if(d.useP2P){var b;const y=null!==(b=s.uid)&&void 0!==b?b:m.uid,T="glb:".concat(y.toString()),M=yield zh(T),O=p.map(D=>({turnServerURL:D.address,tcpport:"proxy3"===l?void 0:D.tcpport||Er.tcpport,udpport:"proxy4"===l?void 0:D.udpport||Er.udpport,username:T,password:M,forceturn:"proxy4"!==l,security:"proxy5"===l}));v.push(...O)}return s.turnServer={mode:"manual",servers:v},I.debug("[".concat(s.clientId,"] set proxy server: ").concat(s.proxyServer,", mode: ").concat(l)),_}),Zi.apply(this,arguments)}function ar(s,i,r,a,d){return IT.apply(this,arguments)}function IT(){return IT=L(function*(s,i,r,a,d){let h=[];h=V("ACCOUNT_REGISTER").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(i.proxyServer?m=>"https://".concat(i.proxyServer,"/ap/?url=").concat(m+"/api/v1"):m=>"https://".concat(m,"/api/v1"));const p=d?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const m=yield(_=L(function*(v,b,y,T,M){const O=Date.now(),D={sid:y.sid,opid:10,appid:y.appId,string_uid:b};let x=v[0];const F=yield In(()=>Ha(x+"".concat(-1===x.indexOf("?")?"?":"&","action=stringuid"),{data:D,cancelToken:T,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(j,q)=>{if(0===j.code){if(j.uid<=0||j.uid>=Math.pow(2,32))throw I.error("Invalid Uint Uid ".concat(b," => ").concat(j.uid),j),Ie.reqUserAccount(D.sid,{lts:O,success:!1,serverAddr:x,stringUid:D.string_uid,uid:j.uid,errorCode:k.INVALID_UINT_UID_FROM_STRING_UID,extend:D}),new W(k.INVALID_UINT_UID_FROM_STRING_UID);return Ie.reqUserAccount(D.sid,{lts:O,success:!0,serverAddr:x,stringUid:D.string_uid,uid:j.uid,errorCode:null,extend:D}),!1}const te=Tm(j.code);return te.retry&&(x=v[(q+1)%v.length]),Ie.reqUserAccount(D.sid,{lts:O,success:!1,serverAddr:x,stringUid:D.string_uid,uid:j.uid,errorCode:te.desc,extend:D}),te.retry},(j,q)=>j.code!==k.OPERATION_ABORTED&&(Ie.reqUserAccount(D.sid,{lts:O,success:!1,serverAddr:x,stringUid:D.string_uid,uid:null,errorCode:j.code,extend:D}),x=v[(q+1)%v.length],!0),M);if(0!==F.code){const j=Tm(F.code);throw new W(k.UNEXPECTED_RESPONSE,j.desc)}return F}),function(v,b,y,T,M){return _.apply(this,arguments)})(h,s,i,r,a);return d?.recordJoinChannelService({status:"success",endTs:Date.now()},p),m.uid}catch(m){throw d?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},p),m}var _}),IT.apply(this,arguments)}function wT(){return wT=L(function*(s,i,r){const a=V("CDS_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(p=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(p+"/api/v1"):"https://".concat(p,"/api/v1?action=config")).map(p=>function(m,_,v,b){const y=lt(),T={flag:64,cipher_method:0,features:{device:y.name,system:y.os,system_general:navigator.userAgent,vendor:_.appId,version:Do,cname:_.cname,sid:_.sid,session_id:_.sid,detail:"",proxyServer:_.proxyServer}};return In(()=>Ha(m,{data:T,timeout:1e3,cancelToken:v,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,M=>M.code!==k.OPERATION_ABORTED,b)}(p,s,i,r));let d=null,l=null,h={};try{d=yield su(a)}catch(p){if(p.code===k.OPERATION_ABORTED)throw p;l=p}if(a.forEach(p=>p.cancel()),Ie.reportApiInvoke(s.sid,{name:Kn.REQUEST_CONFIG_DISTRIBUTE,options:{error:l,res:d}}).onSuccess(),d&&d.test_tags)try{h=function(p){if(!p.test_tags)return{};const m=p.test_tags,_=Object.keys(m),v={};return _.forEach(b=>{var y;const T=fv(y=b.slice(4)).call(y),M=JSON.parse(m[b])[1];v[T]=M}),v}(d)}catch{}return h}),wT.apply(this,arguments)}function eN(s,i,r,a){return RT.apply(this,arguments)}function RT(){return RT=L(function*(s,i,r,a){const d=V("PROXY_SERVER_TYPE3"),l=(T,M,O)=>{let D=O||d;return Array.isArray(D)&&(D=M%2==0?d[1]:d[0]),"https://".concat(D,"/ap/?url=").concat(T)};let h=null;const p=[],m=function(){var T=L(function*(){const M=V("WEBCS_DOMAIN").slice(0,V("AJAX_REQUEST_CONCURRENT")).map((x,F)=>{let j;return j="disabled"===s.cloudProxyServer&&s.proxyServer?l("".concat(x,"/api/v2/transpond/webrtc?v=2"),F,s.proxyServer):"disabled"===s.cloudProxyServer||"fallback"===s.cloudProxyServer?"https://".concat(x,"/api/v2/transpond/webrtc?v=2"):l("".concat(x,"/api/v2/transpond/webrtc?v=2"),F),{url:j,areaCode:Dm(),serviceIds:[yi.CHOOSE_SERVER,"proxy5"===s.cloudProxyServer?yi.CLOUD_PROXY_5:"proxy3"===s.cloudProxyServer||"proxy4"===s.cloudProxyServer?yi.CLOUD_PROXY:yi.CLOUD_PROXY_FALLBACK]}}),O=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:M.map(x=>x.url)}),D=yield Pm({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:M,asyncMapHandler:x=>(I.debug("[".concat(s.clientId,"] Connect to choose_server:"),x.url),XO(x,s,i,r)),allFailedhandler:x=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:x},O),x[0]},promisesCollector:p});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},O),D});return function(){return T.apply(this,arguments)}}(),_=function(){var T=L(function*(){if(yield Un(1e3),null!==h)return h;const M=V("WEBCS_DOMAIN_BACKUP_LIST").map((x,F)=>{let j;return j="disabled"===s.cloudProxyServer&&s.proxyServer?l("".concat(x,"/api/v2/transpond/webrtc?v=2"),F,s.proxyServer):"disabled"===s.cloudProxyServer||"fallback"===s.cloudProxyServer?"https://".concat(x,"/api/v2/transpond/webrtc?v=2"):l("".concat(x,"/api/v2/transpond/webrtc?v=2"),F),{url:j,areaCode:Dm(),serviceIds:[yi.CHOOSE_SERVER,"proxy5"===s.cloudProxyServer?yi.CLOUD_PROXY_5:"proxy3"===s.cloudProxyServer||"proxy4"===s.cloudProxyServer?yi.CLOUD_PROXY:yi.CLOUD_PROXY_FALLBACK]}}),O=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:M.map(x=>x.url)}),D=yield Pm({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:M,asyncMapHandler:x=>(I.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),x.url),XO(x,s,i,r)),allFailedhandler:x=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:x},O),x[0]},promisesCollector:p});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},O),D});return function(){return T.apply(this,arguments)}}();let v,b,y;try{({gatewayInfo:v,proxyInfo:b,url:y}=yield su([m(),_()]))}catch(T){throw T[0]}if(p.length&&p.forEach(T=>T.cancel&&"function"==typeof T.cancel&&T.cancel()),!v||!b)throw new W(k.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(s.apUrl=y,"disabled"!==s.cloudProxyServer&&Array.isArray(d)&&y){const T=/^https?:\/\/(.+?)(\/.*)?$/.exec(y)[1];ye(d).call(d,T)&&(s.proxyServer=T,I.setProxyServer(T),Ie.setProxyServer(T))}return h={gatewayInfo:v,proxyInfo:yield gn(b,v.uid)},h}),RT.apply(this,arguments)}function tN(s,i,r,a){return AT.apply(this,arguments)}function AT(){return AT=L(function*(s,i,r,a){const d=V("UAP_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(l=>i.proxyServer?"https://".concat(i.proxyServer,"/ap/?url=").concat(l+"/api/v1?action=uap"):"https://".concat(l,"/api/v1?action=uap"));return yield function TT(s,i,r,a,d){Cv+=1;const l={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:Cv,requestId:Cv,version:Do,cname:r.cname},h={service_name:i,json_body:JSON.stringify(l)};let p,m,_=s[0];return In(L(function*(){p=Date.now();const v=yield Ha(_,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-p,0!==v.code){const T=new W(k.UNEXPECTED_RESPONSE,"live streaming ap error, code"+v.code,{retry:!0,responseTime:m});throw I.error(T.toString()),T}const b=JSON.parse(v.json_body);if(200!==b.code){const T=new W(k.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(b.code,", reason: ").concat(b.reason),{code:b.code,responseTime:m});throw I.error(T.toString()),T}if(!b.servers||0===b.servers.length){const T=new W(k.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:b.code,responseTime:m});throw I.error(T.toString()),T}const y=(M=i,{addressList:(T=b).servers.map(O=>"wss://".concat(O.address.replace(/\./g,"-"),".").concat(V("WORKER_DOMAIN"),":").concat(O.wss,"?serviceName=").concat(encodeURIComponent(M))),workerToken:T.workerToken,vid:T.vid});var T,M;return V("LIVE_STREAMING_ADDRESS")&&(y.addressList=V("LIVE_STREAMING_ADDRESS")instanceof Array?V("LIVE_STREAMING_ADDRESS"):[V("LIVE_STREAMING_ADDRESS")]),Om(Om({},y),{},{responseTime:m})}),(v,b)=>(Ie.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:i,responseDetail:JSON.stringify(v.addressList),firstSuccess:0===b,responseTime:m,serverIp:s[b%s.length]}),!1),(v,b)=>(Ie.apworkerEvent(r.sid,{success:!1,sc:v.data&&v.data.code||200,serviceName:i,responseTime:m,serverIp:s[b%s.length]}),!!(v.code!==k.OPERATION_ABORTED&&v.code!==k.UNEXPECTED_RESPONSE||v.data&&v.data.retry)&&(_=s[(b+1)%s.length],!0)),d)}(d,s,i,r,a)}),AT.apply(this,arguments)}function DT(){return DT=L(function*(s,i,r){const a=V("UAP_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(d=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap")).map(d=>function(l,h,p,m){const _={command:"convergeAllocateEdge",sid:h.sid,appId:h.appId,token:h.token,ts:Date.now(),version:Do,cname:h.cname,uid:h.uid.toString(),requestId:Nm,seq:Nm};Nm+=1;const v={service_name:"tele_channel",json_body:JSON.stringify(_)};return In(L(function*(){const b=yield Ha(l,{data:v,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==b.code){const T=new W(k.UNEXPECTED_RESPONSE,"cross channel ap error, code"+b.code,{retry:!0});throw I.error(T.toString()),T}const y=JSON.parse(b.json_body);if(200!==y.code){const T=new W(k.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(y.code,", reason: ").concat(y.reason));throw I.error(T.toString()),T}if(!y.servers||0===y.servers.length){const T=new W(k.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw I.error(T.toString()),T}return{vid:y.vid,workerToken:y.workerToken,addressList:(V("CHANNEL_MEDIA_RELAY_SERVERS")||y.servers).map(T=>"wss://".concat(T.address.replace(/\./g,"-"),".").concat(V("WORKER_DOMAIN"),":").concat(T.wss))}}),void 0,b=>!!(b.code!==k.OPERATION_ABORTED&&b.code!==k.UNEXPECTED_RESPONSE||b.data&&b.data.retry),m)}(d,s,i,r));try{const d=yield su(a);return a.forEach(l=>l.cancel()),d}catch(d){throw d[0]}}),DT.apply(this,arguments)}function OT(){return OT=L(function*(s,i,r){let a=null;const d=[],l=function(){var h=L(function*(p){const m=V(p?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return p&&(yield Un(1e3),null!==a)?a:yield Pm({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(I.debug("[".concat(s.clientId,"] update ticket, Connect to ").concat(p?"backup":""," choose_server:"),_),function(v,b,y,T){const[M]=ZL(b,[yi.CHOOSE_SERVER]);let O=Fn.networkState;return In(L(function*(){O&&Fn.networkState===Xi.OFFLINE&&Fn.onlineWaiter&&(yield X.race([Fn.onlineWaiter,Un(T&&T.maxRetryTimeout||Pn.maxRetryTimeout)])),O=Fn.networkState;const D=yield Ha(v,{data:M,cancelToken:y,headers:{"Content-Type":"multipart/form-data;"}},!0);return ZO(D,v)}),()=>!1,D=>D.code!==k.OPERATION_ABORTED&&(D.code===k.UPDATE_TICKET_FAILED?D.data.retry:(I.warning("[".concat(b.clientId,"] update ticket network error, retry"),D),!0)),T)}(_,s,i,r)),allFailedhandler:_=>{throw _[0]},promisesCollector:d})});return function(m){return h.apply(this,arguments)}}();try{return a=yield su([l(!1),l(!0)]),d.length&&d.forEach(h=>h.cancel&&"function"==typeof h.cancel&&h.cancel()),a}catch(h){throw h[0]}}),OT.apply(this,arguments)}function NT(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function PT(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?NT(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):NT(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class nN extends jt{get isSuccess(){return!!this.configs}constructor(){super(),S(this,"configs",void 0),S(this,"joinInfo",void 0),S(this,"cancelToken",void 0),S(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),S(this,"interval",void 0),S(this,"mutex",new Ei("config-distribute")),S(this,"mutableParamsRead",!1)}startGetConfigDistribute(i,r){this.joinInfo=i,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),V("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},V("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}awaitConfigDistributeComplete(){var i=this;return L(function*(){i.mutex.isLocked&&(yield i.mutex.lock())()})()}updateConfigDistribute(){var i=this;return L(function*(){if(i.mutableParamsRead||(i.mutableParamsRead=!0,Ie.reportApiInvoke(null,{options:void 0,name:Kn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:qt.TRACER}).onSuccess(JSON.stringify(kd))),!i.joinInfo||!i.cancelToken||!i.retryConfig)return void I.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const a=yield i.mutex.lock();try{r=yield function Mm(s,i,r){return wT.apply(this,arguments)}(i.joinInfo,i.cancelToken,i.retryConfig),I.debug("[config-distribute] get config distribute",JSON.stringify(r)),r.limit_bitrate&&i.handleBitrateLimit(r.limit_bitrate),i.cacheGlobalParameterConfig(r),i.configs=r}catch(d){const l=new W(k.NETWORK_RESPONSE_ERROR,d);I.warning("[config-distribute] ".concat(l.toString()))}finally{a()}})()}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(i){var r;(r=i)&&r.uplink&&r.id&&void 0!==r.uplink.max_bitrate&&void 0!==r.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==i.id&&this.emit(Cm.UPDATE_BITRATE_LIMIT,i):this.emit(Cm.UPDATE_BITRATE_LIMIT,i))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&PT({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(i){var r;const a=dE(r=Object.keys(i).filter(l=>/^webrtc_ng_global_parameter/.test(l))).call(r);for(let l=0;l<a.length;l++)for(let h=a.length-1;h>l;h--){const p=a[h];if("number"==typeof i[p].__priority){const _=a[h-1];if("number"==typeof i[_].__priority){if(!(i[p].__priority>i[_].__priority))continue;{const v=p;a[h]=a[h-1],a[h-1]=v}}else{const v=p;a[h]=a[h-1],a[h-1]=v}}}const d={};a.forEach(l=>{const h=i[l],p=h.__expires;Object.keys(h).forEach(m=>{"__priority"===m||"__expires"===m||Object.prototype.hasOwnProperty.call(d,m)||(d[m]=PT({value:h[m]},p&&{expires:p}))})});try{!function(p){try{const m=Date.now();Object.keys(p).forEach(_=>{switch(_){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":if(Object.prototype.hasOwnProperty.call(_r,_)){const{value:v,expires:b}=p[_];if(b&&b<=m)return;kd[_]=v,_r[_]=v,I.debug("Update global parameters from config distribute",_,v)}}})}catch(m){I.error("Error update config immediately: ".concat(p),m.message)}}(d);const l=JSON.stringify(d),h=window.btoa(l);window.localStorage.setItem("websdk_ng_global_parameter",h),I.debug("Caching global parameters ".concat(l))}catch(l){I.error("Error caching global parameters:",l.message)}}}const Ui={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1};function Ot(){return Ui}var ri;function au(s,i,r){return{sampleRate:s,stereo:i,bitrate:r}}function tt(s,i,r,a,d){return{width:s,height:i,frameRate:r,bitrateMin:a,bitrateMax:d}}function fs(s,i,r,a,d){return{width:{max:s},height:{max:i},frameRate:r,bitrateMin:a,bitrateMax:d}}function br(s,i){return{numSpatialLayers:s,numTemporalLayers:i}}!function(s){s.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",s.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",s.IOS_INTERRUPTION_START="ios-interruption-start",s.IOS_INTERRUPTION_END="ios-interruption-end",s.STATE_CHANGE="state-change"}(ri||(ri={}));const iN={"90p":tt(160,90),"90p_1":tt(160,90),"120p":tt(160,120,15,30,65),"120p_1":tt(160,120,15,30,65),"120p_3":tt(120,120,15,30,50),"120p_4":tt(212,120),"180p":tt(320,180,15,30,140),"180p_1":tt(320,180,15,30,140),"180p_3":tt(180,180,15,30,100),"180p_4":tt(240,180,15,30,120),"240p":tt(320,240,15,40,200),"240p_1":tt(320,240,15,40,200),"240p_3":tt(240,240,15,40,140),"240p_4":tt(424,240,15,40,220),"360p":tt(640,360,15,80,400),"360p_1":tt(640,360,15,80,400),"360p_3":tt(360,360,15,80,260),"360p_4":tt(640,360,30,80,600),"360p_6":tt(360,360,30,80,400),"360p_7":tt(480,360,15,80,320),"360p_8":tt(480,360,30,80,490),"360p_9":tt(640,360,15,80,800),"360p_10":tt(640,360,24,80,800),"360p_11":tt(640,360,24,80,1e3),"480p":tt(640,480,15,100,500),"480p_1":tt(640,480,15,100,500),"480p_2":tt(640,480,30,100,1e3),"480p_3":tt(480,480,15,100,400),"480p_4":tt(640,480,30,100,750),"480p_6":tt(480,480,30,100,600),"480p_8":tt(848,480,15,100,610),"480p_9":tt(848,480,30,100,930),"480p_10":tt(640,480,10,100,400),"720p":tt(1280,720,15,120,1130),"720p_auto":tt(1280,720,30,900,3e3),"720p_1":tt(1280,720,15,120,1130),"720p_2":tt(1280,720,30,120,2e3),"720p_3":tt(1280,720,30,120,1710),"720p_5":tt(960,720,15,120,910),"720p_6":tt(960,720,30,120,1380),"1080p":tt(1920,1080,15,120,2080),"1080p_1":tt(1920,1080,15,120,2080),"1080p_2":tt(1920,1080,30,120,3e3),"1080p_3":tt(1920,1080,30,120,3150),"1080p_5":tt(1920,1080,60,120,4780),"1440p":tt(2560,1440,30,120,4850),"1440p_1":tt(2560,1440,30,120,4850),"1440p_2":tt(2560,1440,60,120,7350),"4k":tt(3840,2160,30,120,8910),"4k_1":tt(3840,2160,30,120,8910),"4k_3":tt(3840,2160,60,120,13500)},Iv=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],n2={"480p":fs(640,480,5),"480p_1":fs(640,480,5),"480p_2":fs(640,480,30),"480p_3":fs(640,480,15),"720p":fs(1280,720,5),"720p_auto":tt(1280,720,30,900,3e3),"720p_1":fs(1280,720,5),"720p_2":fs(1280,720,30),"720p_3":fs(1280,720,15),"1080p":fs(1920,1080,5),"1080p_1":fs(1920,1080,5),"1080p_2":fs(1920,1080,30),"1080p_3":fs(1920,1080,15)},cu={"1SL1TL":br(1,1),"3SL3TL":br(3,3),"2SL3TL":br(2,3)};function xo(s){return s||(s="480p_1"),"string"==typeof s?Object.assign({},iN[s]):s}function wv(s){return"string"==typeof s?Object.assign({},n2[s]):s}function xm(s){return"string"==typeof s?Object.assign({},cu[s]):s}const rN={speech_low_quality:au(16e3,!1),speech_standard:au(32e3,!1,18),music_standard:au(48e3,!1),standard_stereo:au(48e3,!0,56),high_quality:au(48e3,!1,128),high_quality_stereo:au(48e3,!0,192)};function km(s){return"string"==typeof s?Object.assign({},rN[s]):s}const du=[];function MT(s){return Sn(s,"mediaSource",["screen","window","application"]),!0}var ve,kt,Bd,Lm,Fm,lu,Ga,uu,qr,pp;(function(s){s.NEED_RENEGOTIATE="@need_renegotiate",s.NEED_REPLACE_TRACK="@need_replace_track",s.NEED_CLOSE="@need_close",s.NEED_ENABLE_TRACK="@need_enable_track",s.NEED_DISABLE_TRACK="@need_disable_track",s.NEED_SESSION_ID="@need_sid",s.SET_OPTIMIZATION_MODE="@set_optimization_mode",s.GET_STATS="@get_stats",s.GET_RTC_STATS="@get_rtc_stats",s.GET_LOW_VIDEO_TRACK="@get_low_video_track",s.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",s.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",s.NEED_MUTE_TRACK="@need_mute_track",s.NEED_UNMUTE_TRACK="@need_unmute_track"})(ve||(ve={})),function(s){s.SCREEN_TRACK="screen_track",s.CUSTOM_TRACK="custome_track",s.LOW_STREAM="low_stream"}(kt||(kt={})),function(s){s[s.HIGH_STREAM=0]="HIGH_STREAM",s[s.LOW_STREAM=1]="LOW_STREAM"}(Bd||(Bd={})),function(s){s[s.HIGH_STREAM=0]="HIGH_STREAM",s[s.LOW_STREAM=1]="LOW_STREAM"}(Lm||(Lm={})),function(s){s[s.DISABLE=0]="DISABLE",s[s.LOW_STREAM=1]="LOW_STREAM",s[s.AUDIO_ONLY=2]="AUDIO_ONLY"}(Fm||(Fm={})),function(s){s.TRANSCEIVER_UPDATED="transceiver-updated"}(lu||(lu={})),function(s){s.SOURCE_STATE_CHANGE="source-state-change",s.TRACK_ENDED="track-ended",s.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",s.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",s.CLOSED="closed"}(Ga||(Ga={})),function(s){s.FIRST_FRAME_DECODED="first-frame-decoded",s.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(uu||(uu={})),function(s){s.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",s.RECEIVE_TRACK_BUFFER="receive_track_buffer",s.ON_AUDIO_BUFFER="on_audio_buffer",s.UPDATE_SOURCE="update_source"}(qr||(qr={})),function(s){s.UPDATE_TRACK_SOURCE="update-track-source"}(pp||(pp={}));const xT={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},wn={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},jd={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},oN={uplinkNetworkQuality:0,downlinkNetworkQuality:0},sN={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var cr,yr,Bc,jc,Vi;(function(s){s.ON_TRACK="on_track",s.ON_NODE="on_node"})(cr||(cr={})),function(s){s.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",s.REQUEST_CONSTRAINTS="request_constraints"}(yr||(yr={})),function(s){s.IDLE="IDLE",s.INITING="INITING",s.INITEND="INITEND"}(Bc||(Bc={})),function(s){s.STATE_CHANGE="state_change",s.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",s.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",s.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(jc||(jc={})),function(s){s.NONE="none",s.INIT="init",s.CANPLAY="canplay",s.PLAYING="playing",s.PAUSED="paused",s.SUSPEND="suspend",s.STALLED="stalled",s.WAITING="waiting",s.ERROR="error",s.DESTROYED="destroyed",s.ABORT="abort",s.ENDED="ended",s.EMPTIED="emptied",s.LOADEDDATA="loadeddata"}(Vi||(Vi={}));const Um={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};var fp;!function(s){s.OPEN="open",s.MESSAGE="message",s.CLOSE="close",s.CLOSING="closing",s.ERROR="error"}(fp||(fp={}));class Hc extends jt{constructor(i,r){super(),S(this,"_ID",void 0),S(this,"_rtpTransceiver",void 0),S(this,"_lowRtpTransceiver",void 0),S(this,"_hints",[]),S(this,"_isClosed",!1),S(this,"_originMediaStreamTrack",void 0),S(this,"_mediaStreamTrack",void 0),S(this,"_external",{}),this._ID=r||Ke(8,"track-"),this._originMediaStreamTrack=i,this._mediaStreamTrack=i,ye(du).call(du,this)||du.push(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(i){if(!i){Ie.reportApiInvoke(null,{name:Kn.GET_MEDIA_STREAM_TRACK,options:[],tag:qt.TRACER}).onSuccess(this._mediaStreamTrack&&"string"==typeof this._mediaStreamTrack.label?this._mediaStreamTrack.label:"")}return this._mediaStreamTrack}getRTCRtpTransceiver(i){return i===Bd.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(i){const r=du.indexOf(i);-1!==r&&du.splice(r,1)}(this),this.emit(Ga.CLOSED)}_updateRtpTransceiver(i,r){if(r===Bd.LOW_STREAM){if(this._lowRtpTransceiver===i)return;this._lowRtpTransceiver=i}else{if(this._rtpTransceiver===i)return;this._rtpTransceiver=i}this.emit(lu.TRANSCEIVER_UPDATED,i,r)}}class Bi extends Hc{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}constructor(i,r){super(i,r),S(this,"_enabled",!0),S(this,"_muted",!1),S(this,"_isExternalTrack",!1),S(this,"_isClosed",!1),S(this,"_enabledMutex",void 0),S(this,"processor",void 0),S(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Ei("".concat(this.getTrackId())),i.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var i,r;return null!==(i=null===(r=this._originMediaStreamTrack)||void 0===r?void 0:r.label)&&void 0!==i?i:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,I.debug("[".concat(this.getTrackId(),"] close")),this.emit(ve.NEED_CLOSE),super.close())}_updateOriginMediaStreamTrack(i,r){var a=arguments,d=this;return L(function*(){d._isExternalTrack=a.length>2&&void 0!==a[2]&&a[2],i!==d._originMediaStreamTrack&&(d._originMediaStreamTrack&&(d._originMediaStreamTrack.removeEventListener("ended",d._handleTrackEnded),r&&d._originMediaStreamTrack.stop()),i.addEventListener("ended",d._handleTrackEnded),d._originMediaStreamTrack=i,d._muted&&(d._originMediaStreamTrack.enabled=!1),d._mediaStreamTrack=d._originMediaStreamTrack,d._updatePlayerSource(),yield Tt(d,ve.NEED_REPLACE_TRACK,d),d.processor&&d.processor.updateInput({track:d._originMediaStreamTrack,context:d.processorContext}))})()}_getDefaultPlayerConfig(){return{}}onTrackEnded(){I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ga.TRACK_ENDED)}stateCheck(i,r){if(I.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(i,": ").concat(r,"]")),wc(r,i),this._enabled&&this._muted&&"enabled"===i&&!1===r)throw new ee(k.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",I);if(!this._enabled&&!this._muted&&"muted"===i&&!0===r)throw new ee(k.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",I)}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function aN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}const Vm=window.AudioContext||window.webkitAudioContext;let po=null;const St=new class extends jt{constructor(){var s;super(...arguments),s=this,S(this,"prevState",void 0),S(this,"curState",void 0),S(this,"currentTime",void 0),S(this,"currentTimeStuckAt",void 0),S(this,"interruptDetectorTrack",void 0),S(this,"onLocalAudioTrackMute",()=>{I.info("ios15-interruption-start"),this.emit(ri.IOS_15_16_INTERRUPTION_START)}),S(this,"onLocalAudioTrackUnmute",L(function*(){I.info("ios15-interruption-end"),"running"!==s.curState||s.duringInterruption?I.info("ios15-interruption-end-canceled"):(po&&(yield po.suspend()),s.emit(ri.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(s){I.debug("webaudio bindInterruptDetectorTrack ".concat(s.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=s,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(s){I.debug("webaudio unbindInterruptDetectorTrack ".concat(s.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===s&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function hu(){if(!po){if(function cN(){if(!Vm)return void I.error("your browser is not support web audio");I.info("create audio context");const s=function(i){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?aN(Object(a),!0).forEach(function(d){S(i,d,a[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):aN(Object(a)).forEach(function(d){Object.defineProperty(i,d,Object.getOwnPropertyDescriptor(a,d))})}return i}({},V("WEBAUDIO_INIT_OPTIONS"));var i;I.debug("audio context init option:",JSON.stringify(s)),po=new Vm(s),St.curState=po.state,po.onstatechange=()=>{St.prevState=St.curState,St.curState=po?po.state:void 0;const{prevState:i,curState:r}=St,a="running"===r,d="interrupted"===r,l="running"===i,h="suspended"===i,p="interrupted"===i,m=lt().osVersion;(Pi()||Tc())&&l&&d&&(I.info("ios".concat(m,"-interruption-start")),St.emit(ri.IOS_INTERRUPTION_START)),(Pi()||Tc())&&(h||p)&&a&&(I.info("ios".concat(m,"-interruption-end")),St.emit(ri.IOS_INTERRUPTION_END)),i!==r&&St.emit(ri.STATE_CHANGE,r,i)},setInterval(()=>{var i;const r=null===(i=po)||void 0===i?void 0:i.currentTime;St.currentTime!==r?(St.currentTimeStuckAt&&(I.debug("AudioContext current time resume at ".concat(r)),St.currentTimeStuckAt=void 0),St.currentTime=r):(r!==St.currentTimeStuckAt&&(Ie.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:qt.TRACER}).onSuccess(),I.warning("AudioContext current time stuck at ".concat(r))),St.currentTimeStuckAt=r)},5e3),(i=L(function*(r){const a=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let d,l=!1,h=!1,p=!1;function m(x){"running"===r.state?_(!1):Pi()||Tc()?"suspended"===r.state&&(_(!0),x&&r.resume().then(b,b)):"closed"!==r.state&&(_(!0),x&&r.resume().then(b,b))}function _(x){if(l!==x){l=x;for(let F=0,j=a;F<j.length;F+=1){const q=j[F];x?window.addEventListener(q,y,{capture:!0,passive:!0}):window.removeEventListener(q,y,{capture:!0,passive:!0})}}}function b(){m(!1)}function y(){m(!0)}function T(x){if(!p)if(d.paused)if(x){let F;M(!1),p=!0;try{F=d.play(),F?F.then(O,O):(d.addEventListener("playing",O),d.addEventListener("abort",O),d.addEventListener("error",O))}catch{O()}}else M(!0);else M(!1)}function M(x){if(h!==x){h=x;for(let F=0,j=a;F<j.length;F++){const q=j[F];x?window.addEventListener(q,D,{capture:!0,passive:!0}):window.removeEventListener(q,D,{capture:!0,passive:!0})}}}function O(){d.removeEventListener("playing",O),d.removeEventListener("abort",O),d.removeEventListener("error",O),p=!1,T(!1)}function D(){T(!0)}if(Pi()){const x=r.createMediaStreamDestination(),F=document.createElement("div");F.innerHTML="<audio x-webkit-airplay='deny'></audio>",d=F.children.item(0),d.controls=!1,d.disableRemotePlayback=!0,d.preload="auto",d.srcObject=x.stream,T(!0)}St.on(ri.STATE_CHANGE,function v(){m(!0)}),m(!1)}),function(r){return i.apply(this,arguments)})(po)}(),!po)throw new ee(k.NOT_SUPPORTED,"can not create audio context");return po}return po}function kT(){return!!po}function Hd(s){if(function(){if(null!==LT)return LT;const a=hu(),d=a.createBufferSource(),l=a.createGain(),h=a.createGain();d.connect(l),d.connect(h),d.disconnect(l);let p=!1;try{d.disconnect(l)}catch{p=!0}return d.disconnect(),LT=p,p}())return;const i=s.connect,r=s.disconnect;s.connect=(a,d,l)=>{var h;return s._inputNodes||(s._inputNodes=[]),ye(h=s._inputNodes).call(h,a)||(a instanceof AudioNode?(s._inputNodes.push(a),i.call(s,a,d,l)):i.call(s,a,d)),s},s.disconnect=(a,d,l)=>{r.call(s),a?sm(s._inputNodes,a):s._inputNodes=[];for(const h of s._inputNodes)i.call(s,h)}}let LT=null;function FT(s,i){let r=!1;const a=1/i;if(V("DISABLE_WEBAUDIO")){const d=window.setInterval(()=>{r?window.clearInterval(d):s(performance.now()/1e3)},1e3*a)}else{const d=hu();let l=d.createGain();l.gain.value=0,l.connect(d.destination);const h=()=>{if(r)return void(l=null);const p=d.createOscillator();p.onended=h,p.connect(l),p.start(0),p.stop(d.currentTime+a),s(d.currentTime)};h()}return()=>{r=!0}}class dN{constructor(){S(this,"context",void 0),S(this,"analyserNode",void 0),S(this,"sourceNode",void 0),this.context=hu(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(i){if(i!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=i,i?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Pi()||Tc()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode))return 0;const i=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(i);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let d=0;d<i.length;++d)i[d]=a[d]/128-1}const r=Va(i).call(i,(a,d)=>a+d*d,0)/i.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var i,r;null===(i=this.sourceNode)||void 0===i||i.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(r=this.sourceNode)||void 0===r||r.connect(this.analyserNode)}catch{I.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class lN extends jt{get processSourceNode(){return this.sourceNode}set processedNode(i){var r;if(!this.isDestroyed&&this._processedNode!==i){try{var a;null===(a=this.sourceNode)||void 0===a||a.disconnect(this.outputNode)}catch{}null===(r=this._processedNode)||void 0===r||r.disconnect(),this._processedNode=i,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),S(this,"outputNode",void 0),S(this,"outputTrack",void 0),S(this,"isPlayed",!1),S(this,"context",void 0),S(this,"audioBufferNode",void 0),S(this,"destNode",void 0),S(this,"audioOutputLevel",0),S(this,"volumeLevelAnalyser",void 0),S(this,"_processedNode",void 0),S(this,"playNode",void 0),S(this,"isDestroyed",!1),S(this,"onNoAudioInput",void 0),S(this,"isNoAudioInput",!1),S(this,"_noAudioInputCount",0),this.context=hu(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Hd(this.outputNode),this.volumeLevelAnalyser=new dN}startGetAudioBuffer(i){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(i),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(qr.ON_AUDIO_BUFFER,function(a){for(let d=0;d<a.outputBuffer.numberOfChannels;d+=1){const l=a.outputBuffer.getChannelData(d);for(let h=0;h<l.length;h+=1)l[h]=0}return a.inputBuffer}(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ot().webAudioMediaStreamDest)throw new ee(k.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(i){"running"!==this.context.state&&am(()=>{St.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=i||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}checkHasAudioInput(){var i=arguments,r=this;return L(function*(){let a=i.length>0&&void 0!==i[0]?i[0]:0;if(a>5)return r.isNoAudioInput=!0,r.onNoAudioInput&&r.onNoAudioInput(),!1;Pi()||Tc()?"suspended"===r.context.state&&r.context.resume():"running"!==r.context.state&&r.context.resume();const d=r.volumeLevelAnalyser.getAnalyserNode();let l;d.getFloatTimeDomainData?(l=new Float32Array(d.fftSize),d.getFloatTimeDomainData(l)):(l=new Uint8Array(d.fftSize),d.getByteTimeDomainData(l));let h=!1;for(let p=0;p<l.length;p++)0!==l[p]&&(h=!0);return h?(r.isNoAudioInput=!1,!0):(yield Un(200),(yield r.checkHasAudioInput(a?a+1:1))&&h)})()}getAudioVolume(){return this.outputNode.gain.value}setVolume(i){this.outputNode.gain.setValueAtTime(i,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var i,r;null===(i=this.processedNode)||void 0===i||i.disconnect(),null===(r=this.sourceNode)||void 0===r||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var i;this.processedNode?null===(i=this.processedNode)||void 0===i||i.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class Rv extends lN{get isFreeze(){return!1}constructor(i,r,a){var d,l;if(super(),d=this,S(this,"sourceNode",void 0),S(this,"track",void 0),S(this,"clonedTrack",void 0),S(this,"audioElement",void 0),S(this,"isCurrentTrackCloned",!1),S(this,"isRemoteTrack",!1),S(this,"originVolumeLevelAnalyser",void 0),S(this,"rebuildWebAudio",L(function*(){if(I.debug("ready to rebuild web audio, state:",d.context.state),d.isNoAudioInput&&(yield d.checkHasAudioInput()),!d.isNoAudioInput||d.isDestroyed)return document.body.removeEventListener("click",d.rebuildWebAudio,!0),void I.debug("rebuild web audio success, current volume status",d.getAccurateVolumeLevel());d.context.resume().then(()=>I.info("resume success")),I.debug("rebuild web audio because of ios 12 bugs"),d.disconnect();const m=d.track;d.track=d.track.clone(),d.isCurrentTrackCloned?m.stop():d.isCurrentTrackCloned=!0;const _=new MediaStream([d.track]);d.sourceNode=d.context.createMediaStreamSource(_),Hd(d.sourceNode),d.volumeLevelAnalyser.rebuildAnalyser();const v=d.outputNode.gain.value;d.outputNode=d.context.createGain(),d.outputNode.gain.setValueAtTime(v,d.context.currentTime),Hd(d.outputNode),d.emit(qr.UPDATE_SOURCE),d.connect(),d.audioElement.srcObject=_,d.isPlayed&&d.play(d.playNode),d.checkHasAudioInput()})),"audio"!==i.kind)throw new ee(k.UNEXPECTED_ERROR);this.track=i;const h=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(h),Hd(this.sourceNode),a){const m=a.clone();m.enabled=!0,this.clonedTrack=m,I.debug("create an unmuted track ".concat(m.id," from the original track ").concat(a.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));Hd(_),this.originVolumeLevelAnalyser=new dN,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=h;const p=lt();r&&p.os===ei.IOS&&Number(null===(l=p.osVersion)||void 0===l?void 0:l.split(".")[0])<15&&(St.on(ri.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(i){this.sourceNode.disconnect(),this.track=i,this.isCurrentTrackCloned=!1;const r=new MediaStream([i]);this.sourceNode=this.context.createMediaStreamSource(r),Hd(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(qr.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var i;this.audioElement.srcObject=null,this.audioElement.remove(),St.off("state-change",this.rebuildWebAudio),null===(i=this.originVolumeLevelAnalyser)||void 0===i||i.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(i){return this.context.createMediaStreamSource(new MediaStream([i]))}updateOriginTrack(i){const r=i.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),I.debug("create an unmuted track ".concat(r.id," from the original track ").concat(i.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([r]));Hd(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}function r2(s,i,r){return Av.apply(this,arguments)}function Av(){return Av=L(function*(s,i,r){const a=(l,h)=>l?"number"!=typeof l?l.max||l.exact||l.ideal||l.min||h:l:h,d={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxHeight:a(i.height,1080),maxWidth:a(i.width,1920)}}};return i.frameRate&&"number"!=typeof i.frameRate?(d.video.mandatory.maxFrameRate=i.frameRate.max,d.video.mandatory.minFrameRate=i.frameRate.min):"number"==typeof i.frameRate&&(d.video.mandatory.maxFrameRate=i.frameRate),yield navigator.mediaDevices.getUserMedia(d)}),Av.apply(this,arguments)}function UT(){return UT=L(function*(s,i){const r=yield s2(s.mediaSource),{sourceId:a,audio:d}=yield function(l){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new X((p,m)=>{const _=document.createElement("div");_.innerText="share screen",_.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const v=document.createElement("div");v.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const b=document.createElement("div");b.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",b.setAttribute("style","height: 12%;");const y=document.createElement("div");y.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const T=document.createElement("div");T.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const M=document.createElement("button");M.innerHTML="cancel",M.setAttribute("style","width: 85px;"),M.onclick=()=>{document.body.removeChild(x);const F=new Error("NotAllowedError");F.name="NotAllowedError",m(F)};let O=h;const D=document.createElement("div");if(h){const F=document.createElement("input");F.setAttribute("type","checkbox");const j=document.createElement("span");F.setAttribute("style","margin-right: 6px;"),j.innerText="Share audio",F.checked=O,F.onchange=()=>{O=F.checked},D.appendChild(F),D.appendChild(j)}T.appendChild(D),T.appendChild(M),v.appendChild(b),v.appendChild(y),v.appendChild(T);const x=document.createElement("div");x.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),x.appendChild(_),x.appendChild(v),document.body.appendChild(x),l.map(F=>{if(F.id){const j=document.createElement("div");j.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let q=F.thumbnail;try{const{width:te}=q.getSize();te>1920&&(q=q.resize({width:1920}))}catch(te){throw te&&te.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),te}j.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+q.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+F.name.replace(/[\u00A0-\u9999<>\&]/g,function(te){return"&#"+te.charCodeAt(0)+";"})+"</span>",j.onclick=()=>{document.body.removeChild(x),p({sourceId:F.id,audio:O})},y.appendChild(j)}})})}(r,i);return yield r2(a,s,d)}),UT.apply(this,arguments)}function s2(s){return VT.apply(this,arguments)}function VT(){return VT=L(function*(s){let i=["window","screen"];"application"!==s&&"window"!==s||(i=["window"]),"screen"===s&&(i=["screen"]);const r=ID();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new ee(k.ELECTRON_IS_NULL);let a=null;try{var d;a=(null===(d=r.desktopCapturer)||void 0===d?void 0:d.getSources({types:i}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:i})}catch{a=null}a&&a.then||(a=new X((l,h)=>{r.desktopCapturer.getSources({types:i},(p,m)=>{p?h(p):l(m)})}));try{return yield a}catch(l){throw new ee(k.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,l.toString())}}),VT.apply(this,arguments)}function BT(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}const mp=new Ei("safari");let a2=!1,c2=!1;function ko(s,i){return jT.apply(this,arguments)}function jT(){return jT=L(function*(s,i){let r=0,a=null;for(;r<2;)try{a=yield d2(s,i,r>0);break}catch(d){if(d instanceof ee)throw I.error("[".concat(i,"] ").concat(d.toString())),d;const l=Dv(d.name||d.code||d,d.message);if(l.code===k.MEDIA_OPTION_INVALID){I.debug("[".concat(i,"] detect media option invalid, retry")),r+=1,yield Un(500);continue}throw I.error("[".concat(i,"] ").concat(l.toString())),l}if(!a)throw new ee(k.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}),jT.apply(this,arguments)}function d2(s,i,r){return HT.apply(this,arguments)}function HT(){return HT=L(function*(s,i,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ee(k.NOT_SUPPORTED,"can not find getUserMedia");r&&(s.video&&(delete s.video.width,delete s.video.height),s.screen&&(delete s.screen.width,delete s.screen.height));const a=Ot(),d=new MediaStream;if(s.audioSource&&d.addTrack(s.audioSource),s.videoSource&&d.addTrack(s.videoSource),!s.audio&&!s.video&&!s.screen)return I.debug("Using Video Source/ Audio Source"),d;if(s.screen)if(ID())pu(d,s.screen.sourceId?yield r2(s.screen.sourceId,s.screen,s.screenAudio):yield function o2(s,i){return UT.apply(this,arguments)}(s.screen,s.screenAudio));else if(nm()&&s.screen.extensionId&&s.screen.mandatory){if(!a.getStreamFromExtension)throw new ee(k.NOT_SUPPORTED,"This browser does not support screen sharing");I.debug("[".concat(i,'] Screen access on chrome stable, looking for extension"'));const y=yield(h=s.screen.extensionId,p=i,new X((T,M)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},O=>{if(!O||!O.streamId)return I.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),O),void M(new ee(k.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));T(O.streamId)})}catch(O){I.error("[".concat(p,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),O.toString()),M(new ee(k.CHROME_PLUGIN_NOT_INSTALL))}}));s.screen.mandatory.chromeMediaSourceId=y,pu(d,yield navigator.mediaDevices.getUserMedia({video:{mandatory:s.screen.mandatory}}))}else if(a.getDisplayMedia){var l;s.screen.mediaSource&&MT(s.screen.mediaSource);const y={width:s.screen.width,height:s.screen.height,frameRate:s.screen.frameRate,displaySurface:null!==(l=s.screen.displaySurface)&&void 0!==l?l:"screen"===s.screen.mediaSource?"monitor":s.screen.mediaSource},{selfBrowserSurface:T,surfaceSwitching:M,systemAudio:O}=s.screen,D={selfBrowserSurface:T,surfaceSwitching:M,systemAudio:O};!T&&delete D.selfBrowserSurface,!M&&delete D.surfaceSwitching,!O&&delete D.systemAudio,I.debug("[".concat(i,"] getDisplayMedia:"),JSON.stringify({video:y,audio:!!s.screenAudio,controls:D}));const x=yield navigator.mediaDevices.getDisplayMedia(function(F){for(var j=1;j<arguments.length;j++){var q=null!=arguments[j]?arguments[j]:{};j%2?BT(Object(q),!0).forEach(function(te){S(F,te,q[te])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(q)):BT(Object(q)).forEach(function(te){Object.defineProperty(F,te,Object.getOwnPropertyDescriptor(q,te))})}return F}({video:y,audio:!!s.screenAudio},D));pu(d,x)}else{if(!Pt())throw I.error("[".concat(i,"] This browser does not support screenSharing")),new ee(k.NOT_SUPPORTED,"This browser does not support screen sharing");{s.screen.mediaSource&&MT(s.screen.mediaSource);const y={video:{mediaSource:s.screen.mediaSource,width:s.screen.width,height:s.screen.height,frameRate:s.screen.frameRate}};I.debug("[".concat(i,"] getUserMedia: ").concat(JSON.stringify(y))),pu(d,yield navigator.mediaDevices.getUserMedia(y))}}var h,p;if(!s.video&&!s.audio)return d;let m={video:s.video,audio:s.audio},_=V("MEDIA_DEVICE_CONSTRAINTS");if(_)try{"string"==typeof _&&(_=JSON.parse(_)),m=jE(m,_)}catch{}I.debug("[".concat(i,"] GetUserMedia"),JSON.stringify(m)),lt();let v,b=null;(fr()||Pi()||LE())&&(b=yield mp.lock());try{v=yield navigator.mediaDevices.getUserMedia(m)}catch(y){throw b&&b(),y}return m.audio&&(a2=!0),m.video&&(c2=!0),pu(d,v),b&&b(),d}),HT.apply(this,arguments)}function Dv(s,i){switch(s){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ee(k.MEDIA_OPTION_INVALID,"".concat(s,": ").concat(i));case"NotFoundError":case"DevicesNotFoundError":return new ee(k.DEVICE_NOT_FOUND,"".concat(s,": ").concat(i));case"NotSupportedError":return new ee(k.NOT_SUPPORTED,"".concat(s,": ").concat(i));case"NotReadableError":return new ee(k.NOT_READABLE,"".concat(s,": ").concat(i));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ee(k.PERMISSION_DENIED,"".concat(s,": ").concat(i));case"ConstraintNotSatisfiedError":return new ee(k.CONSTRAINT_NOT_SATISFIED,"".concat(s,": ").concat(i));default:return I.error("getUserMedia unexpected error",s),new ee(k.UNEXPECTED_ERROR,"".concat(s,": ").concat(i))}}function pu(s,i){const r=s.getVideoTracks()[0],a=s.getAudioTracks()[0],d=i.getVideoTracks()[0],l=i.getAudioTracks()[0];l&&(a&&s.removeTrack(a),s.addTrack(l)),d&&(r&&s.removeTrack(r),s.addTrack(d))}const Lo=new class extends jt{get state(){return this._state}set state(s){s!==this._state&&(this.emit(jc.STATE_CHANGE,s),this._state=s)}constructor(){super(),S(this,"_state",Bc.IDLE),S(this,"isAccessMicrophonePermission",!1),S(this,"isAccessCameraPermission",!1),S(this,"lastAccessMicrophonePermission",!1),S(this,"lastAccessCameraPermission",!1),S(this,"checkdeviceMatched",!1),S(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(V("ENUMERATE_DEVICES_INTERVAL")||(Gh()||kE()===ei.HARMONY_OS)&&wd())&&this.updateDevicesInfo()},V("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(s=>I.error(s.toString()))}enumerateDevices(s,i){var r=arguments,a=this;return L(function*(){let d=r.length>2&&void 0!==r[2]&&r[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ee(k.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const l=yield navigator.mediaDevices.enumerateDevices(),h=a.checkMediaDeviceInfoIsOk(l);let p=!a.isAccessMicrophonePermission&&s,m=!a.isAccessCameraPermission&&i;h.audio&&(p=!1),h.video&&(m=!1);let _=null,v=null,b=null;if(!d&&(p||m)){if(mp.isLocked&&(I.debug("[device manager] wait GUM lock"),(yield mp.lock())(),I.debug("[device manager] GUM unlock")),a2&&(p=!1,a.isAccessMicrophonePermission=!0),c2&&(m=!1,a.isAccessCameraPermission=!0),I.debug("[device manager] check media device permissions",s,i,p,m),p&&m){try{b=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(y){const T=Dv(y.name||y.code||y,y.message);if(T.code===k.PERMISSION_DENIED)throw T;I.warning("getUserMedia failed in getDevices",T)}a.isAccessCameraPermission=!0,a.isAccessMicrophonePermission=!0}else if(p){try{_=yield navigator.mediaDevices.getUserMedia({audio:s})}catch(y){const T=Dv(y.name||y.code||y,y.message);if(T.code===k.PERMISSION_DENIED)throw T;I.warning("getUserMedia failed in getDevices",T)}a.isAccessMicrophonePermission=!0}else if(m){try{v=yield navigator.mediaDevices.getUserMedia({video:i})}catch(y){const T=Dv(y.name||y.code||y,y.message);if(T.code===k.PERMISSION_DENIED)throw T;I.warning("getUserMedia failed in getDevices",T)}a.isAccessCameraPermission=!0}I.debug("[device manager] mic permission",s,"cam permission",i)}try{const y=yield navigator.mediaDevices.enumerateDevices();return _&&_.getTracks().forEach(T=>T.stop()),v&&v.getTracks().forEach(T=>T.stop()),b&&b.getTracks().forEach(T=>T.stop()),_=null,v=null,b=null,y}catch(y){return _&&_.getTracks().forEach(T=>T.stop()),v&&v.getTracks().forEach(T=>T.stop()),b&&b.getTracks().forEach(T=>T.stop()),_=null,v=null,b=null,new ee(k.ENUMERATE_DEVICES_FAILED,y.toString()).throw()}})()}getRecordingDevices(){var s=arguments,i=this;return L(function*(){let r=s.length>0&&void 0!==s[0]&&s[0];return(yield i.enumerateDevices(!0,!1,r)).filter(a=>"audioinput"===a.kind)})()}getCamerasDevices(){var s=arguments,i=this;return L(function*(){let r=s.length>0&&void 0!==s[0]&&s[0];return(yield i.enumerateDevices(!1,!0,r)).filter(a=>"videoinput"===a.kind)})()}getSpeakers(){var s=arguments,i=this;return L(function*(){let r=s.length>0&&void 0!==s[0]&&s[0];return(yield i.enumerateDevices(!0,!1,r)).filter(a=>"audiooutput"===a.kind)})()}searchDeviceIdByName(s){let i=null;return this.deviceInfoMap.forEach(r=>{r.device.label===s&&(i=r.device.deviceId)}),i}getDeviceById(s){var i=this;return L(function*(){const r=(yield i.enumerateDevices(!0,!0,!0)).find(a=>a.deviceId===s);if(!r)throw new ee(k.DEVICE_NOT_FOUND,"deviceId: ".concat(s));return r})()}init(){var s=this;return L(function*(){s.state=Bc.INITING;try{yield s.updateDevicesInfo(),s.state=Bc.INITEND}catch(i){throw I.warning("Device Detection functionality cannot start properly.",i.toString()),s.state=Bc.IDLE,!("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)&&new ee(k.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),i}})()}updateDevicesInfo(){var s=this;return L(function*(){const i=yield s.enumerateDevices(!0,!0,!0),r=Date.now(),a=[];if(i[0]&&i[0].label&&!1===s.checkdeviceMatched){s.checkdeviceMatched=!0;const l=i.find(p=>"audioinput"===p.kind&&"default"===p.deviceId),h=i.find(p=>"audiooutput"===p.kind&&"default"===p.deviceId);l&&h?h.groupId===l.groupId?I.debug("[device-check] default input ".concat(l.label," and output ").concat(h.label," is the same group")):I.warning("[device-check] default input ".concat(l.label," and output ").concat(h.label," is not the same group")):I.debug("[device-check] default input or output not found")}const d=s.checkMediaDeviceInfoIsOk(i);if(i.forEach(l=>{if(!l.deviceId)return;const h=s.deviceInfoMap.get("".concat(l.kind,"_").concat(l.deviceId));if("ACTIVE"!==(h?h.state:"INACTIVE")){const p={initAt:r,updateAt:r,device:l,state:"ACTIVE"};s.deviceInfoMap.set("".concat(l.kind,"_").concat(l.deviceId),p),a.push(p)}h&&(h.updateAt=r)}),s.deviceInfoMap.forEach((l,h)=>{"ACTIVE"===l.state&&l.updateAt!==r&&(l.state="INACTIVE",a.push(l))}),s.state!==Bc.INITEND)return d.audio&&(s.lastAccessMicrophonePermission=!0,s.isAccessMicrophonePermission=!0),void(d.video&&(s.lastAccessCameraPermission=!0,s.isAccessCameraPermission=!0));a.forEach(l=>{switch(l.device.kind){case"audioinput":s.lastAccessMicrophonePermission&&s.isAccessMicrophonePermission&&s.emit(jc.RECORDING_DEVICE_CHANGED,l);break;case"videoinput":s.lastAccessCameraPermission&&s.isAccessCameraPermission&&s.emit(jc.CAMERA_DEVICE_CHANGED,l);break;case"audiooutput":s.lastAccessMicrophonePermission&&s.isAccessMicrophonePermission&&s.emit(jc.PLAYOUT_DEVICE_CHANGED,l)}}),d.audio&&(s.lastAccessMicrophonePermission=!0,s.isAccessMicrophonePermission=!0),d.video&&(s.lastAccessCameraPermission=!0,s.isAccessCameraPermission=!0)})()}checkMediaDeviceInfoIsOk(s){const i=s.filter(d=>"audioinput"===d.kind),r=s.filter(d=>"videoinput"===d.kind),a={audio:!1,video:!1};for(const d of i)if(d.label&&d.deviceId){a.audio=!0;break}for(const d of r)if(d.label&&d.deviceId){a.video=!0;break}return a}};let GT=!1;const Fo=new class extends jt{constructor(){super(...arguments),S(this,"onAutoplayFailed",void 0),S(this,"onAudioAutoplayFailed",void 0)}};function uN(){if(lt(),!GT){const s=i=>{i.preventDefault(),GT=!1,Ic()?document.body.removeEventListener("click",s,!0):(document.body.removeEventListener("touchstart",s,!0),document.body.removeEventListener("mousedown",s,!0))};GT=!0,Ic()?document.body.addEventListener("click",s,!0):(document.body.addEventListener("touchstart",s,!0),document.body.addEventListener("mousedown",s,!0)),I.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Fo.onAutoplayFailed?Fo.onAutoplayFailed():I.warning(Fo.onAudioAutoplayFailed?"AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .":"We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),Fo.emit("autoplay-failed")}}function hN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function gp(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?hN(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):hN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function WT(s,i,r,a){if(!s)return;const d=Ie.getBaseInfoBySessionId(s);if(!d)return;const l=d.info,h=Date.now(),p=gp(gp({},l),{},{vid:void 0===l.vid?0:Number(l.vid),lts:h,elapse:h-d.startTime,cbRegistered:Fo.onAutoplayFailed||Fo.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:i,trackId:a,extend:void 0});Ie.send({type:Gt.AUTOPLAY_FAILED,data:p},!0)}const pN=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Mr=new class{constructor(){S(this,"onAutoplayFailed",void 0),S(this,"elementMap",new Map),S(this,"elementStateMap",new Map),S(this,"elementsNeedToResume",[]),S(this,"sinkIdMap",new Map),S(this,"autoResumeAfterInterruption",s=>{Array.from(this.elementMap.entries()).forEach(i=>{let[r,a]=i;const d=this.elementStateMap.get(r),l=a.srcObject.getAudioTracks()[0],h=l&&l.readyState;if(I.debug("resume after interrupted, ele: ".concat(d," audio: ").concat(h," ").concat(s)),"live"===h){if(s)return a.pause(),void a.play();if("running"===St.curState)return Hh()?(a.pause(),void a.play()):void(d&&"paused"===d&&a.play())}})}),S(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(s=>{let[i,r]=s;const a=r.srcObject.getAudioTracks()[0];a&&"live"===a.readyState&&(I.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),St.on(ri.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),St.on(ri.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),St.on(ri.STATE_CHANGE,()=>{Pi()&&"suspended"===St.prevState&&"running"===St.curState&&this.autoResumeAfterInterruption()})}setSinkID(s,i){var r=this;return L(function*(){const a=r.elementMap.get(s);if(r.sinkIdMap.set(s,i),a)try{yield a.setSinkId(i)}catch(d){throw new ee(k.PERMISSION_DENIED,"can not set sink id: "+d.toString())}})()}play(s,i,r,a){if(this.elementMap.has(i))return;const d=document.createElement("audio");d.autoplay=!0,d.srcObject=new MediaStream([s]),this.bindAudioElementEvents(i,d),this.elementMap.set(i,d),this.elementStateMap.set(i,Vi.INIT),this.setVolume(i,r);const l=this.sinkIdMap.get(i);if(l)try{d.setSinkId(l).catch(p=>{I.warning("[".concat(i,"] set sink id failed"),p.toString())})}catch(p){I.warning("[".concat(i,"] set sink id failed"),p.toString())}const h=d.play();h&&h.then&&h.catch(p=>{a&&WT(a,"audio",p.message,i),I.warning("audio element play warning",p.toString()),this.elementMap.has(i)&&"NotAllowedError"===p.name&&(I.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(d),am(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),uN()}))})}updateTrack(s,i){const r=this.elementMap.get(s);r&&(r.srcObject=new MediaStream([i]))}isPlaying(s){return this.elementMap.has(s)&&"playing"===this.elementStateMap.get(s)}setVolume(s,i){const r=this.elementMap.get(s);r&&(i=Math.max(0,Math.min(100,i)),r.volume=i/100)}stop(s){const i=this.elementMap.get(s);if(this.sinkIdMap.delete(s),!i)return;const r=this.elementsNeedToResume.indexOf(i);this.elementsNeedToResume.splice(r,1),i.srcObject=null,i.remove(),this.elementMap.delete(s),this.elementStateMap.delete(s)}bindAudioElementEvents(s,i){pN.forEach(r=>{i.addEventListener(r,a=>{const d=this.elementStateMap.get(s),l="pause"===a.type?"paused":a.type;if(I.debug("[".concat(s,"] audio-element-status change ").concat(d," => ").concat(l)),"error"===a.type){const h=i?.error;h&&I.error("[".concat(s,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(s,l)})})}getPlayerState(s){return this.elementStateMap.get(s)||"uninit"}autoResumeAudioElement(){const s=()=>{this.elementsNeedToResume.forEach(i=>{i.play().then(r=>{I.debug("Auto resume audio element success")}).catch(r=>{I.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new X(i=>{document.body?i():window.addEventListener("load",()=>i())}).then(()=>{Ic()?document.body.addEventListener("click",s,!0):(document.body.addEventListener("touchstart",s,!0),document.body.addEventListener("mousedown",s,!0))})}};function En(){return function(s,i,r){const a=r.value;return"function"==typeof a&&(r.value=function(){this._isClosed&&new ee(k.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",I);for(var d=arguments.length,l=new Array(d),h=0;h<d;h++)l[h]=arguments[h];const p=a.apply(this,l);return p instanceof X?new X((m,_)=>{p.then(m).catch(_)}):p}),r}}function zT(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function fu(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?zT(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):zT(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class fN extends jt{constructor(i){super(),S(this,"name","VideoProcessorDestination"),S(this,"ID","0"),S(this,"_source",void 0),S(this,"videoContext",void 0),S(this,"inputTrack",void 0),this.videoContext=i}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ee(k.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ee(k.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(i){if(i.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");i.track&&i.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=i.track,this.emit(cr.ON_TRACK,i.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(cr.ON_TRACK,void 0)}}class l2 extends jt{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,r){super(),S(this,"constraintsMap",new Map),S(this,"statsRegistry",[]),S(this,"usageRegistry",[]),S(this,"trackId",void 0),S(this,"direction",void 0),S(this,"_chained",!1),this.trackId=i,this.direction=r}getConstraints(){var i=this;return L(function*(){return yield rn(i,yr.REQUEST_CONSTRAINTS)})()}requestApplyConstraints(i,r){var a=this;return L(function*(){var d;return I.info("processor ".concat(r.name," requestApplyConstraints for ").concat(a.trackId)),i&&a.constraintsMap.set(r,i),Tt(a,yr.REQUEST_UPDATE_CONSTRAINTS,Array.from(ca(d=a.constraintsMap).call(d)))})()}requestRevertConstraints(i){var r=this;return L(function*(){var a;if(r.constraintsMap.has(i))return I.info("processor ".concat(i.name," requestRevertConstraints for ").concat(r.trackId)),r.constraintsMap.delete(i),Tt(r,yr.REQUEST_UPDATE_CONSTRAINTS,Array.from(ca(a=r.constraintsMap).call(a)))})()}registerStats(i,r,a){this.statsRegistry.find(d=>d.processorID===i.ID&&d.processorName===i.name&&d.type===r)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:r,cb:a})}unregisterStats(i,r){const a=this.statsRegistry.findIndex(d=>d.processorID===i.ID&&d.processorName===i.name&&d.type===r);-1!==a&&this.statsRegistry.splice(a,1)}gatherStats(){const i=[];for(const{processorID:r,processorName:a,type:d,cb:l}of this.statsRegistry)try{const h=l();i.push({processorID:r,processorName:a,type:d,stats:h})}catch(h){I.error(new ee(k.UNEXPECTED_ERROR,h.message))}return i}registerUsage(i,r){this.usageRegistry.find(a=>a.processorID===i.ID&&a.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:r})}unregisterUsage(i){const r=this.usageRegistry.findIndex(a=>a.processorID===i.ID&&a.processorName===i.name);-1!==r&&this.usageRegistry.splice(r,1)}gatherUsage(){var i=this;return L(function*(){const r=[];if(!i.chained)return[];for(const{cb:a}of i.usageRegistry)try{let d=a();d instanceof X&&(d=yield d),r.push(fu(fu({},d),{},{direction:i.direction}))}catch(d){I.error("gather extension usage error",d)}return r})()}getDirection(){return this.direction}}class KT extends jt{constructor(i){super(),S(this,"name","AudioProcessorDestination"),S(this,"ID","0"),S(this,"inputTrack",void 0),S(this,"inputNode",void 0),S(this,"audioProcessorContext",void 0),S(this,"_source",void 0),this.audioProcessorContext=i}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ee(k.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ee(k.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(cr.ON_TRACK,void 0),this.emit(cr.ON_NODE,void 0)}updateInput(i){if(i.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");i.track&&this.inputTrack!==i.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=i.track,this.emit(cr.ON_TRACK,this.inputTrack)),i.node&&this.inputNode!==i.node&&(this.audioProcessorContext.chained=!0,this.inputNode=i.node,this.emit(cr.ON_NODE,this.inputNode))}}class mu extends jt{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,r,a){super(),S(this,"constraintsMap",new Map),S(this,"statsRegistry",[]),S(this,"audioContext",void 0),S(this,"trackId",void 0),S(this,"direction",void 0),S(this,"usageRegistry",[]),S(this,"_chained",!1),this.audioContext=i,this.trackId=r,this.direction=a}getConstraints(){var i=this;return L(function*(){return rn(i,yr.REQUEST_CONSTRAINTS)})()}getAudioContext(){return this.audioContext}requestApplyConstraints(i,r){var a=this;return L(function*(){var d;return I.info("processor ".concat(r.name," requestApplyConstraints for ").concat(a.trackId)),i&&a.constraintsMap.set(r,i),Tt(a,yr.REQUEST_UPDATE_CONSTRAINTS,Array.from(ca(d=a.constraintsMap).call(d)))})()}requestRevertConstraints(i){var r=this;return L(function*(){var a;if(r.constraintsMap.has(i))return r.constraintsMap.delete(i),Tt(r,yr.REQUEST_UPDATE_CONSTRAINTS,Array.from(ca(a=r.constraintsMap).call(a)))})()}registerStats(i,r,a){this.statsRegistry.find(d=>d.processorID===i.ID&&d.processorName===i.name&&d.type===r)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:r,cb:a})}unregisterStats(i,r){const a=this.statsRegistry.findIndex(d=>d.processorID===i.ID&&d.processorName===i.name&&d.type===r);-1!==a&&this.statsRegistry.splice(a,1)}gatherStats(){const i=[];for(const{processorID:r,processorName:a,type:d,cb:l}of this.statsRegistry)try{const h=l();i.push({processorID:r,processorName:a,type:d,stats:h})}catch(h){I.error(new ee(k.UNEXPECTED_ERROR,h.message))}return i}registerUsage(i,r){this.usageRegistry.find(a=>a.processorID===i.ID&&a.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:r})}unregisterUsage(i){const r=this.usageRegistry.findIndex(a=>a.processorID===i.ID&&a.processorName===i.name);-1!==r&&this.usageRegistry.splice(r,1)}gatherUsage(){var i=this;return L(function*(){const r=[];if(!i.chained)return[];for(const{cb:a}of i.usageRegistry)try{let d=a();d instanceof X&&(d=yield d),r.push(fu(fu({},d),{},{direction:i.direction}))}catch(d){I.error("gather extension usage error",d)}return r})()}getDirection(){return this.direction}}class qT extends jt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),S(this,"context",void 0),S(this,"processSourceNode",void 0),S(this,"outputTrack",void 0),S(this,"processedNode",void 0),S(this,"clonedTrack",void 0),S(this,"outputNode",void 0),this.outputNode=new u2}setVolume(){}createOutputTrack(){throw new ee(k.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class u2{disconnect(){}connect(){}}let _p=null;class h2{constructor(){S(this,"state","open"),S(this,"trigger",void 0),S(this,"tasks",[]),I.debug("[macro-task-queue] is created."),this.trigger=window.setTimeout(()=>{this.state="closed",I.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(i=>i.key),"]")),this.trigger=void 0,this.tasks.forEach(i=>{let{func:r}=i;return r()}),this.tasks.length=0,I.debug("[macro-task-queue] is closed.")})}enqueue(i,r){"closed"!==this.state&&(this.tasks.push({key:i,func:r}),I.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof i?i:"")))}runTask(i){if("closed"===this.state)return;const r=this.tasks.findIndex(a=>a.key===i);if(-1!==r){const a=this.tasks.splice(r,1);I.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof i?i:"")),a[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,I.debug("[macro-task-queue] is closed."))}}function gu(s){return function(i,r,a){var d;const l=null!==(d=a.value)&&void 0!==d?d:a.get,h=function(){_p&&"open"===_p.state&&_p.runTask(s);for(var p=arguments.length,m=new Array(p),_=0;_<p;_++)m[_]=arguments[_];return l?.apply(this,...m)};return a.value?a.value=h:a.get=h,a}}function Ov(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function YT(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?Ov(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Ov(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class vt extends Bi{get _source(){return this._trackSource}set _source(i){this._trackSource=i}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}get processorDestination(){return this._processorDestination}set processorDestination(i){this._processorDestination=i}get isPlaying(){return this._useAudioElement?Mr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(i,r,a,d,l){super(i,a),S(this,"trackMediaType","audio"),S(this,"_encoderConfig",void 0),S(this,"_trackSource",void 0),S(this,"_enabled",!0),S(this,"_volume",100),S(this,"_useAudioElement",!1),S(this,"_bypassWebAudio",!1),S(this,"processor",void 0),S(this,"_processorContext",void 0),S(this,"_processorDestination",void 0),S(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!d;const h=()=>{this.processorContext=new mu(this._source.context,this.getTrackId(),"local"),this.processorDestination=new KT(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(qr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},p=l&&fr()&&!kT();V("DISABLE_WEBAUDIO")?(this._source=new qT,this._useAudioElement=!0,this._bypassWebAudio=!0):p?this._source=new qT:(this._source=new Rv(i,!1,this._getOriginVolumeLevel?i:void 0),V("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),h(),!V("DISABLE_WEBAUDIO")&&p&&(_p||(_p=new h2),_p).enqueue("INIT_WEBAUDIO",()=>{this._source=new Rv(i,!1,this._getOriginVolumeLevel?i:void 0),V("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),h(),this.emit(pp.UPDATE_TRACK_SOURCE)})}setVolume(i){At(i,"volume",0,1e3),this._volume=i,this._source.setVolume(i/100),this._useAudioElement&&Mr.setVolume(this.getTrackId(),i);try{if(this._bypassWebAudio)return void I.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,Tt(this,ve.NEED_REPLACE_TRACK,this).then(()=>{I.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(a=>{I.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),a)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}setPlaybackDevice(i){var r=this;return L(function*(){if(!r._useAudioElement||!nm()&&V("RESTRICTION_SET_PLAYBACK_DEVICE"))throw new ee(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield Mr.setSinkID(r.getTrackId(),i)})()}setEnabled(i,r,a){var d=this;return L(function*(){return d._setEnabled(i,r,a)})()}_setEnabled(i,r,a){var d=this;return L(function*(){if(!a){if(i===d._enabled)return;d.stateCheck("enabled",i)}if(I.info("[".concat(d.getTrackId(),"] start setEnabled"),i),i){d._originMediaStreamTrack.enabled=!0;try{a||(d._enabled=!0),yield Tt(d,ve.NEED_ENABLE_TRACK,d),I.info("[".concat(d.getTrackId(),"] setEnabled to ").concat(i," success"))}catch(l){throw a||(d._enabled=!1),I.error("[".concat(d.getTrackId(),"] setEnabled to true error"),l.toString()),l}}else{d._originMediaStreamTrack.enabled=!1,a||(d._enabled=!1);try{yield Tt(d,ve.NEED_DISABLE_TRACK,d)}catch(l){throw a||(d._enabled=!0),I.error("[".concat(d.getTrackId(),"] setEnabled to false error"),l.toString()),l}}})()}setMuted(i){var r=this;return L(function*(){i!==r._muted&&(r.stateCheck("muted",i),r._muted=i,r._originMediaStreamTrack.enabled=!i,I.debug("[".concat(r.getTrackId(),"] start set muted: ").concat(i)),i?yield Tt(r,ve.NEED_MUTE_TRACK,r):yield Tt(r,ve.NEED_UNMUTE_TRACK,r))})()}getStats(){return qh(()=>{I.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Pr(this,ve.GET_STATS)||YT({},xT)}setAudioFrameCallback(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!i)return this._source.removeAllListeners(qr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(qr.ON_AUDIO_BUFFER),this._source.on(qr.ON_AUDIO_BUFFER,a=>i(a))}play(){I.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(I.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Mr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){I.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Mr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];I.debug("[".concat(this.getTrackId(),"] update player source track")),i&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Mr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}_updateOriginMediaStreamTrack(i,r){var a=this;return L(function*(){a._originMediaStreamTrack!==i&&(a._originMediaStreamTrack&&(a._originMediaStreamTrack.removeEventListener("ended",a._handleTrackEnded),r&&a._originMediaStreamTrack.stop()),i.addEventListener("ended",a._handleTrackEnded),a._originMediaStreamTrack=i,a._muted&&(a._originMediaStreamTrack.enabled=!1),a.processor&&a.processor.updateInput({track:i,context:a.processorContext}),a._mediaStreamTrack!==a._source.outputTrack?(a._mediaStreamTrack=a._originMediaStreamTrack,a._updatePlayerSource(),yield Tt(a,ve.NEED_REPLACE_TRACK,a)):a._source.updateTrack(a._originMediaStreamTrack),a._getOriginVolumeLevel&&a._source.updateOriginTrack(i))})()}renewMediaStreamTrack(i){return X.resolve(void 0)}pipe(i){if(this._bypassWebAudio)throw new ee(k.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===i)return i;if(i._source)throw new ee(k.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),i}unpipe(){var i;if(!this.processor)return;const r=this.processor;null===(i=this._source.processSourceNode)||void 0===i||i.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){var i=this;this.processorDestination.on(cr.ON_TRACK,function(){var r=L(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource(!1),i._source.processedNode=i._source.createMediaStreamSourceNode(a),yield Tt(i,ve.NEED_REPLACE_TRACK,i)):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource(),yield Tt(i,ve.NEED_REPLACE_TRACK,i))});return function(a){return r.apply(this,arguments)}}()),this.processorDestination.on(cr.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(cr.ON_TRACK),this.processorDestination.removeAllListeners(cr.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(yr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(yr.REQUEST_CONSTRAINTS)}}ne([gu("INIT_WEBAUDIO"),N("design:type",Object),N("design:paramtypes",[Object])],vt.prototype,"_source",null),ne([gu("INIT_WEBAUDIO"),N("design:type",mu),N("design:paramtypes",[mu])],vt.prototype,"processorContext",null),ne([gu("INIT_WEBAUDIO"),N("design:type",KT),N("design:paramtypes",[KT])],vt.prototype,"processorDestination",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i],throttleTime:300}),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],vt.prototype,"setVolume",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i]}),En(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],vt.prototype,"setPlaybackDevice",null),ne([ti("LocalAudioTrack","_enabledMutex"),we({argsMap:(s,i)=>[s.getTrackId(),i]}),En(),N("design:type",Function),N("design:paramtypes",[Boolean,Object,Boolean]),N("design:returntype",X)],vt.prototype,"setEnabled",null),ne([ti("LocalAudioTrack","_enabledMutex"),we({argsMap:(s,i)=>[s.getTrackId(),i]}),En(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",X)],vt.prototype,"setMuted",null),ne([En(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Object)],vt.prototype,"getStats",null),ne([En(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",void 0)],vt.prototype,"setAudioFrameCallback",null),ne([we({argsMap:s=>[s.getTrackId()]}),En(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],vt.prototype,"play",null),ne([we({argsMap:s=>[s.getTrackId()]}),En(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],vt.prototype,"stop",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],vt.prototype,"close",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],vt.prototype,"pipe",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],vt.prototype,"unpipe",null);class ji extends vt{get __className__(){return"MicrophoneAudioTrack"}constructor(i,r,a,d){super(i,r.encoderConfig?km(r.encoderConfig):{},d,V("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),S(this,"_config",void 0),S(this,"_deviceName","default"),S(this,"_constraints",void 0),S(this,"_originalConstraints",void 0),S(this,"_enabled",!0),this._config=r,this._constraints=a,this._originalConstraints=a,this._deviceName=i.label,"boolean"==typeof r.bypassWebAudio&&(this._bypassWebAudio=r.bypassWebAudio),(Hh()||vD())&&St.bindInterruptDetectorTrack(this),this.on(pp.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),kT()&&this.bindProcessorContextEvents()}setDevice(i){var r=this;return L(function*(){if(I.info("[".concat(r.getTrackId(),"] start set device to ").concat(i)),r._enabled)try{const a=yield Lo.getDeviceById(i),d={};d.audio=YT({},r._constraints),d.audio.deviceId={exact:i},r._originMediaStreamTrack.stop();let l=null;try{l=yield ko(d,r.getTrackId())}catch(h){throw I.error("[".concat(r.getTrackId(),"] setDevice failed"),h.toString()),l=yield ko({audio:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!1),h}yield r._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!1),r._deviceName=a.label,r._config.microphoneId=i,r._constraints.deviceId={exact:i}}catch(a){throw I.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}else try{const a=yield Lo.getDeviceById(i);r._deviceName=a.label,r._config.microphoneId=i,r._constraints.deviceId={exact:i}}catch(a){throw I.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}I.info("[".concat(r.getTrackId(),"] set device to ").concat(i," success"))})()}setEnabled(i,r,a){var d=()=>super._setEnabled,l=this;return L(function*(){if(r)return I.debug("[".concat(l.getTrackId(),"] setEnabled false (do not close microphone)")),yield d().call(l,i);if(!a){if(i===l._enabled)return;l.stateCheck("enabled",i)}if(I.info("[".concat(l.getTrackId(),"] start setEnabled"),i),!i){var h;l._originMediaStreamTrack.onended=null,l._originMediaStreamTrack.stop(),null===(h=l._source.clonedTrack)||void 0===h||h.stop(),a||(l._enabled=!1);try{yield Tt(l,ve.NEED_DISABLE_TRACK,l)}catch(_){throw I.error("[".concat(l.getTrackId(),"] setEnabled false failed"),_.toString()),_}return}const p=YT({},l._constraints),m=Lo.searchDeviceIdByName(l._deviceName);m&&!p.deviceId&&(p.deviceId=m);try{a||(l._enabled=!0);const _=yield ko({audio:l._constraints},l.getTrackId());yield l._updateOriginMediaStreamTrack(_.getAudioTracks()[0],!1),yield Tt(l,ve.NEED_ENABLE_TRACK,l)}catch(_){throw a||(l._enabled=!1),I.error("[".concat(l.getTrackId(),"] setEnabled true failed"),_.toString()),_}I.info("[".concat(l.getTrackId(),"] setEnabled success"))})()}close(){super.close(),(Hh()||vD())&&St.unbindInterruptDetectorTrack(this)}onTrackEnded(){var i=this;if((Pi()||Tc())&&this._enabled&&!this._isClosed&&St.duringInterruption){const r=function(){var a=L(function*(){St.off(ri.IOS_INTERRUPTION_END,r),i._enabled&&!i._isClosed&&(I.debug("[".concat(i.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),yield i.setEnabled(!1),yield i.setEnabled(!0))});return function(){return a.apply(this,arguments)}}();St.on(ri.IOS_INTERRUPTION_END,r)}else I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ga.TRACK_ENDED)}renewMediaStreamTrack(i){var r=this;return L(function*(){const a=i||r._constraints,d=Lo.searchDeviceIdByName(r._deviceName);if(d&&!a.deviceId&&(a.deviceId=d),r._constraints=a,r._enabled){r._originMediaStreamTrack.stop();const l=yield ko({audio:r._constraints},r.getTrackId());yield r._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!0)}})()}bindProcessorContextEvents(){var i=this;this.processorContext.on(yr.REQUEST_UPDATE_CONSTRAINTS,function(){var r=L(function*(a,d,l){try{const h=Object.assign({},i._originalConstraints,...a);yield i.renewMediaStreamTrack(h),d()}catch(h){l(h)}});return function(a,d,l){return r.apply(this,arguments)}}()),this.processorContext.on(yr.REQUEST_CONSTRAINTS,function(){var r=L(function*(a){a(i._originMediaStreamTrack.getSettings())});return function(a){return r.apply(this,arguments)}}())}}ne([we({argsMap:(s,i)=>[s.getTrackId(),i]}),En(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],ji.prototype,"setDevice",null),ne([ti("MicrophoneAudioTrack","_enabledMutex"),we({argsMap:(s,i,r)=>[s.getTrackId(),i,r]}),En(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean,Boolean]),N("design:returntype",X)],ji.prototype,"setEnabled",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ji.prototype,"close",null);class ms extends vt{get __className__(){return"BufferSourceAudioTrack"}constructor(i,r,a,d){super(r.createOutputTrack(),a,d),S(this,"source",void 0),S(this,"_bufferSource",void 0),this.source=i,this._bufferSource=r,this._bufferSource.on(qr.AUDIO_SOURCE_STATE_CHANGE,l=>{this.safeEmit(Ga.SOURCE_STATE_CHANGE,l)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(i){i&&this._bufferSource.updateOptions(i),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(i){this._bufferSource.seekAudioBuffer(i)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(i){At(i,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(i)}}ne([we({argsMap:(s,i)=>[s.getTrackId(),i,s.duration]}),En(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],ms.prototype,"startProcessAudioBuffer",null),ne([we({argsMap:s=>[s.getTrackId()]}),En(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ms.prototype,"pauseProcessAudioBuffer",null),ne([we({argsMap:s=>[s.getTrackId()]}),En(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],ms.prototype,"seekAudioBuffer",null),ne([we({argsMap:s=>[s.getTrackId()]}),En(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ms.prototype,"resumeProcessAudioBuffer",null),ne([we({argsMap:s=>[s.getTrackId()]}),En(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ms.prototype,"stopProcessAudioBuffer",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ms.prototype,"close",null),ne([we({argsMap:s=>[s.getTrackId()]}),En(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],ms.prototype,"setAudioBufferPlaybackSpeed",null);class jn extends vt{get __className__(){return"MixingAudioTrack"}get isActive(){for(const i of this.trackList)if(i._enabled&&!i._isClosed&&!i.muted)return!0;return!1}constructor(){const i=hu().createMediaStreamDestination();super(i.stream.getAudioTracks()[0],void 0,Ke(8,"track-mix-")),S(this,"trackList",void 0),S(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=i,this.trackList=[]}hasAudioTrack(i){return-1!==this.trackList.indexOf(i)}addAudioTrack(i){-1===this.trackList.indexOf(i)?(I.debug("add ".concat(i.getTrackId()," to mixing track")),i._source.outputNode.connect(this.destNode),this.trackList.push(i),this.updateEncoderConfig()):I.debug("track ".concat(i.getTrackId()," is already added"))}removeAudioTrack(i){if(-1!==this.trackList.indexOf(i)){I.debug("remove ".concat(i.getTrackId()," from mixing track"));try{i._source.outputNode.disconnect(this.destNode)}catch{}sm(this.trackList,i),this.updateEncoderConfig()}}updateEncoderConfig(){const i={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(i.bitrate||0)&&(i.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(i.sampleRate||0)&&(i.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(i.sampleSize||0)&&(i.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(i.stereo=!0))}),this._encoderConfig=i}_updateRtpTransceiver(i){this._rtpTransceiver!==i&&(this._rtpTransceiver=i,this.trackList.forEach(r=>{r instanceof jn?r.emit(lu.TRANSCEIVER_UPDATED,i):r._updateRtpTransceiver(i)}))}}function Nv(s){const i={};s.facingMode&&(i.facingMode=s.facingMode),s.cameraId&&(i.deviceId={exact:s.cameraId});const r=xo(s.encoderConfig);return null!=r.width&&(i.width=r.width),null!=r.height&&(i.height=r.height),!CD()&&r.frameRate&&(i.frameRate=r.frameRate),lt().name===Et.EDGE&&"object"==typeof i.frameRate&&(i.frameRate.max=60),Pt()&&(i.frameRate={ideal:30,max:30}),i}function p2(s){const i={};if(CD()||(void 0!==s.AGC&&(i.autoGainControl=s.AGC),void 0!==s.AEC&&(i.echoCancellation=s.AEC),void 0!==s.ANS&&(i.noiseSuppression=s.ANS,nm()&&s.ANS&&(i.googHighpassFilter=s.ANS))),s.encoderConfig){const r=km(s.encoderConfig);i.channelCount=r.stereo?2:1,i.sampleRate=r.sampleRate,i.sampleSize=r.sampleSize}return s.microphoneId&&(i.deviceId={exact:s.microphoneId}),Gh()&&(i.sampleRate=void 0),i}class nB extends lN{set currentState(i){i!==this._currentState&&(this._currentState=i,this.safeEmit(qr.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),S(this,"audioBuffer",void 0),S(this,"sourceNode",void 0),S(this,"startPlayTime",0),S(this,"startPlayOffset",0),S(this,"pausePlayTime",0),S(this,"options",void 0),S(this,"currentLoopCount",0),S(this,"currentPlaybackSpeed",100),S(this,"_currentState","stopped"),this.audioBuffer=i,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:(this.playbackSpeed/100*(this.context.currentTime-this.startPlayTime)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(i){"stopped"===this.currentState?(this.options=i,this.startPlayOffset=this.options.startPlayTime||0):I.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(i){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=i,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=i))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(i){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=i/100),this.currentPlaybackSpeed=i}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const i=this.context.createBufferSource();return i.buffer=this.audioBuffer,i.loop=!!this.options.loop,i.connect(this.outputNode),i.playbackRate.value=this.currentPlaybackSpeed/100,i}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Ep=new Map;function Bm(){return Bm=L(function*(s,i){let r=null;if("string"==typeof s){const d=Ep.get(s);if(d)return I.debug("use cached audio resource: ",s),d;try{r=(yield In(()=>Ze.get(s,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(l){throw new ee(k.FETCH_AUDIO_FILE_FAILED,l.toString())}}else r=yield new X((l,h)=>{const p=new FileReader;p.onload=m=>{m.target?l(m.target.result):h(new ee(k.READ_LOCAL_AUDIO_FILE_ERROR))},p.onerror=()=>{h(new ee(k.READ_LOCAL_AUDIO_FILE_ERROR))},p.readAsArrayBuffer(s)});const a=yield function(d){const l=hu();return new X((h,p)=>{l.decodeAudioData(d,m=>{h(m)},m=>{p(new ee(k.DECODE_AUDIO_FILE_FAILED,m.toString()))})})}(r);return"string"==typeof s&&i&&Ep.set(s,a),a}),Bm.apply(this,arguments)}const $T=s=>{const i=document.createElement("canvas");return i.width=2,i.height=2,new X((r,a)=>{i.toBlob(function(){var d=L(function*(l){if(i.remove(),l){const h=yield XT(l);r({buffer:h,width:i.width,height:i.height})}else a(new ee(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(l){return d.apply(this,arguments)}}(),s,1)})},XT=function(){var s=L(function*(i){const r=yield i.arrayBuffer();return new Uint8Array(r)});return function(r){return s.apply(this,arguments)}}(),Gc=new class extends jt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),S(this,"_lastHiddenTime",0),S(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),I.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function mN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function gN(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?mN(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):mN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class jm{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(i){i!==this._videoElementStatus&&(I.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(i)),this._videoElementStatus=i)}constructor(i){S(this,"trackId",void 0),S(this,"config",void 0),S(this,"onFirstVideoFrameDecoded",void 0),S(this,"freezeTimeCounterList",[]),S(this,"renderFreezeAccTime",0),S(this,"isKeepLastFrame",!1),S(this,"timeUpdatedCount",0),S(this,"freezeTime",0),S(this,"playbackTime",0),S(this,"lastTimeUpdatedTime",0),S(this,"autoplayFailed",!1),S(this,"videoTrack",void 0),S(this,"videoElement",void 0),S(this,"cacheVideoElement",void 0),S(this,"videoElementCheckInterval",void 0),S(this,"_videoElementStatus",Vi.NONE),S(this,"isGettingVideoDimensions",!1),S(this,"startGetVideoDimensions",()=>{const r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return I.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()}),S(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===St.curState&&(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(fD())),bD()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),S(this,"handleVideoEvents",r=>{switch(r.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Vi.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Vi.CANPLAY;break;case"stalled":this.videoElementStatus=Vi.STALLED;break;case"suspend":this.videoElementStatus=Vi.SUSPEND;break;case"pause":this.videoElementStatus=Vi.PAUSED,Pi()||Tc()||fr()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Vi.WAITING;break;case"abort":this.videoElementStatus=Vi.ABORT;break;case"ended":this.videoElementStatus=Vi.ENDED;break;case"emptied":this.videoElementStatus=Vi.EMPTIED;break;case"error":{this.videoElementStatus=Vi.ERROR;const a=this.videoElement.error;a&&I.error("[".concat(this.trackId,"] media error, code: ").concat(a.code,", message: ").concat(a.message));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const d=a-this.lastTimeUpdatedTime,l=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,Gc.lastVisibleTime<Gc.lastHiddenTime||l<Gc.lastHiddenTime||l<Gc.lastVisibleTime)return;for(d>V("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=d),this.playbackTime+=d;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),S(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(fD())),bD()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=i.trackId,this.config=i,this.videoElement=i.element instanceof HTMLVideoElement?i.element:document.createElement("video"),St.on(ri.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),St.on(ri.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var i;return null!==(i=this.videoElement.parentElement)&&void 0!==i?i:void 0}updateConfig(i){this.config=i,this.trackId=i.trackId,i.element!==this.videoElement&&(this.destroy(),this.videoElement=i.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.initVideoElement())}play(i){const r=this.videoElement.play();r&&r.catch&&r.catch(d=>{i&&WT(i,"video",d.message,this.trackId),"NotAllowedError"===d.name?(I.warning("detected video element autoplay failed",d),this.autoplayFailed=!0,this.handleAutoPlayFailed()):I.warning("[".concat(this.trackId,"] play warning: "),d)});const a=lt();if(("Safari"===a.name&&15===Number(a.version)||Hh())&&r&&r.then){const d=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(d).catch(d)}}getCurrentFrame(){const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const r=i.getContext("2d");if(!r)return I.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,i.width,i.height);const a=r.getImageData(0,0,i.width,i.height);return i.remove(),a}getCurrentFrameToUint8Array(i){var r=arguments,a=this;return L(function*(){let d=r.length>1&&void 0!==r[1]?r[1]:1;const l=document.createElement("canvas");l.width=a.videoElement.videoWidth,l.height=a.videoElement.videoHeight;const h=l.getContext("2d");return h?(h.drawImage(a.videoElement,0,0,l.width,l.height),new X((p,m)=>{l.toBlob(function(){var _=L(function*(v){if(l.remove(),v){const b=yield XT(v);p({buffer:b,width:l.width,height:l.height})}else m(new ee(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(v){return _.apply(this,arguments)}}(),i,d<0?.1:d>1?1:d)})):yield $T(i)})()}destroy(){St.off(ri.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),St.off(ri.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=Vi.INIT,!this.videoElementCheckInterval&&(JT.forEach(l=>{this.videoElement.addEventListener(l,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{var l;(l=this.videoElement)!==document.body&&document.body.contains(l)||(this.videoElementStatus=Vi.DESTROYED)},1e3),V("ENABLE_VIDEO_FRAME_CALLBACK"))){var i,r;let l;const h=(p,m)=>{if(this.videoElementStatus===Vi.PLAYING){if(l){const b=m.presentationTime-l.presentationTime;b>V("VIDEO_FREEZE_DURATION")&&Gc.lastVisibleTime>=Gc.lastHiddenTime&&l.timestamp>Gc.lastVisibleTime&&l.timestamp>Gc.lastHiddenTime&&(this.renderFreezeAccTime+=b)}l=gN(gN({},m),{},{timestamp:p})}var _,v;V("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(_=(v=this.videoElement).requestVideoFrameCallback)||void 0===_||_.call(v,h))};null===(i=(r=this.videoElement).requestVideoFrameCallback)||void 0===i||i.call(r,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Gh()&&(this.videoElement.poster="noposter");const a=lt();"Safari"===a.name&&15===Number(a.version)||Hh()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.videoElement.style.objectFit=this.config.fit?this.config.fit:"cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Pt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Pt()&&this.videoElement.load());const d=this.videoElement.play();void 0!==d&&d.catch(l=>{I.debug("[".concat(this.trackId,"] playback interrupted"),l.toString())})}resetVideoElement(){JT.forEach(i=>{this.videoElement&&this.videoElement.removeEventListener(i,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Vi.NONE}handleAutoPlayFailed(){const i=r=>{r.preventDefault(),this.videoElement.play().then(()=>{I.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{I.error(a)}),this.autoplayFailed=!1,Ic()?document.body.removeEventListener("click",i,!0):(document.body.removeEventListener("touchstart",i,!0),document.body.removeEventListener("mousedown",i,!0))};Ic()?document.body.addEventListener("click",i,!0):(document.body.addEventListener("touchstart",i,!0),document.body.addEventListener("mousedown",i,!0)),uN()}}const JT=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class _N extends jm{constructor(i){super(i),S(this,"container",void 0),S(this,"slot",void 0),this.slot=i.element,this.updateConfig(i)}updateConfig(i){this.config=i,this.trackId=i.trackId;const r=i.element;r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.createElements())}play(i){var r;null!==(r=this.container)&&void 0!==r&&r.contains(this.videoElement)&&super.play(i)}getCurrentFrame(){var i;return null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}getCurrentFrameToUint8Array(i){var r=arguments,a=()=>super.getCurrentFrameToUint8Array,d=this;return L(function*(){var l;let h=r.length>1&&void 0!==r[1]?r[1]:1;return null!==(l=d.container)&&void 0!==l&&l.contains(d.videoElement)?yield a().call(d,i,h):yield $T(i)})()}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",V("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var i;!this.container||null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var i;if(null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var i;null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function Hm(s){return new X((i,r)=>{let a=!1;const d=document.createElement("video");d.setAttribute("autoplay",""),d.setAttribute("muted",""),d.muted=!0,d.autoplay=!0,d.setAttribute("playsinline",""),d.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(d);const l=Pi()?"canplay":"playing";d.addEventListener(l,()=>{const h=d.videoWidth,p=d.videoHeight;!h&&Pt()||(a=!0,d.srcObject=null,d.remove(),i([h,p]))}),d.srcObject=new MediaStream([s]),d.play().catch(Yl),setTimeout(()=>{a||(d.srcObject=null,d.remove(),i([d.videoWidth,d.videoHeight]))},4e3)})}const QT=function(){var s=L(function*(i,r,a){const d=function(p){const m=[];for(let _=0;_<p.length;_+=2)m.push(parseInt(p.slice(_,_+2),16));return Uint8Array.from(m)}(function(p){const m="0123456789abcdef";function _(_e){let me,Fe="";for(me=0;me<=3;me++)Fe+=m.charAt(_e>>8*me+4&15)+m.charAt(_e>>8*me&15);return Fe}function v(_e,me){const Fe=(65535&_e)+(65535&me);return(_e>>16)+(me>>16)+(Fe>>16)<<16|65535&Fe}function b(_e,me,Fe,rt,ci,Zt){return v((Fi=v(v(me,_e),v(rt,Zt)))<<(ie=ci)|Fi>>>32-ie,Fe);var Fi,ie}function y(_e,me,Fe,rt,ci,Zt,Fi){return b(me&Fe|~me&rt,_e,me,ci,Zt,Fi)}function T(_e,me,Fe,rt,ci,Zt,Fi){return b(me&rt|Fe&~rt,_e,me,ci,Zt,Fi)}function M(_e,me,Fe,rt,ci,Zt,Fi){return b(me^Fe^rt,_e,me,ci,Zt,Fi)}function O(_e,me,Fe,rt,ci,Zt,Fi){return b(Fe^(me|~rt),_e,me,ci,Zt,Fi)}const D=function(_e){let me;const Fe=1+(_e.length+8>>6),rt=new Array(16*Fe);for(me=0;me<16*Fe;me++)rt[me]=0;for(me=0;me<_e.length;me++)rt[me>>2]|=_e.charCodeAt(me)<<me%4*8;return rt[me>>2]|=128<<me%4*8,rt[16*Fe-2]=8*_e.length,rt}(p);let x,F,j,q,te,K=1732584193,Q=-271733879,$=-1732584194,z=271733878;for(x=0;x<D.length;x+=16)F=K,j=Q,q=$,te=z,K=y(K,Q,$,z,D[x+0],7,-680876936),z=y(z,K,Q,$,D[x+1],12,-389564586),$=y($,z,K,Q,D[x+2],17,606105819),Q=y(Q,$,z,K,D[x+3],22,-1044525330),K=y(K,Q,$,z,D[x+4],7,-176418897),z=y(z,K,Q,$,D[x+5],12,1200080426),$=y($,z,K,Q,D[x+6],17,-1473231341),Q=y(Q,$,z,K,D[x+7],22,-45705983),K=y(K,Q,$,z,D[x+8],7,1770035416),z=y(z,K,Q,$,D[x+9],12,-1958414417),$=y($,z,K,Q,D[x+10],17,-42063),Q=y(Q,$,z,K,D[x+11],22,-1990404162),K=y(K,Q,$,z,D[x+12],7,1804603682),z=y(z,K,Q,$,D[x+13],12,-40341101),$=y($,z,K,Q,D[x+14],17,-1502002290),Q=y(Q,$,z,K,D[x+15],22,1236535329),K=T(K,Q,$,z,D[x+1],5,-165796510),z=T(z,K,Q,$,D[x+6],9,-1069501632),$=T($,z,K,Q,D[x+11],14,643717713),Q=T(Q,$,z,K,D[x+0],20,-373897302),K=T(K,Q,$,z,D[x+5],5,-701558691),z=T(z,K,Q,$,D[x+10],9,38016083),$=T($,z,K,Q,D[x+15],14,-660478335),Q=T(Q,$,z,K,D[x+4],20,-405537848),K=T(K,Q,$,z,D[x+9],5,568446438),z=T(z,K,Q,$,D[x+14],9,-1019803690),$=T($,z,K,Q,D[x+3],14,-187363961),Q=T(Q,$,z,K,D[x+8],20,1163531501),K=T(K,Q,$,z,D[x+13],5,-1444681467),z=T(z,K,Q,$,D[x+2],9,-51403784),$=T($,z,K,Q,D[x+7],14,1735328473),Q=T(Q,$,z,K,D[x+12],20,-1926607734),K=M(K,Q,$,z,D[x+5],4,-378558),z=M(z,K,Q,$,D[x+8],11,-2022574463),$=M($,z,K,Q,D[x+11],16,1839030562),Q=M(Q,$,z,K,D[x+14],23,-35309556),K=M(K,Q,$,z,D[x+1],4,-1530992060),z=M(z,K,Q,$,D[x+4],11,1272893353),$=M($,z,K,Q,D[x+7],16,-155497632),Q=M(Q,$,z,K,D[x+10],23,-1094730640),K=M(K,Q,$,z,D[x+13],4,681279174),z=M(z,K,Q,$,D[x+0],11,-358537222),$=M($,z,K,Q,D[x+3],16,-722521979),Q=M(Q,$,z,K,D[x+6],23,76029189),K=M(K,Q,$,z,D[x+9],4,-640364487),z=M(z,K,Q,$,D[x+12],11,-421815835),$=M($,z,K,Q,D[x+15],16,530742520),Q=M(Q,$,z,K,D[x+2],23,-995338651),K=O(K,Q,$,z,D[x+0],6,-198630844),z=O(z,K,Q,$,D[x+7],10,1126891415),$=O($,z,K,Q,D[x+14],15,-1416354905),Q=O(Q,$,z,K,D[x+5],21,-57434055),K=O(K,Q,$,z,D[x+12],6,1700485571),z=O(z,K,Q,$,D[x+3],10,-1894986606),$=O($,z,K,Q,D[x+10],15,-1051523),Q=O(Q,$,z,K,D[x+1],21,-2054922799),K=O(K,Q,$,z,D[x+8],6,1873313359),z=O(z,K,Q,$,D[x+15],10,-30611744),$=O($,z,K,Q,D[x+6],15,-1560198380),Q=O(Q,$,z,K,D[x+13],21,1309151649),K=O(K,Q,$,z,D[x+4],6,-145523070),z=O(z,K,Q,$,D[x+11],10,-1120210379),$=O($,z,K,Q,D[x+2],15,718787259),Q=O(Q,$,z,K,D[x+9],21,-343485551),K=v(K,F),Q=v(Q,j),$=v($,q),z=v(z,te);return _(K)+_(Q)+_($)+_(z)}(""+r+a)).slice(0,16),l=d.slice(0,12),h=yield window.crypto.subtle.importKey("raw",d,"AES-GCM",!0,["encrypt"]);return new Uint8Array(yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},h,i))});return function(r,a,d){return s.apply(this,arguments)}}(),m2=function(){var s=L(function*(i,r,a){return yield QT(i.buffer,r,a)});return function(r,a,d){return s.apply(this,arguments)}}();function ZT(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Uo(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?ZT(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):ZT(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class je extends Bi{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Vi.PLAYING)}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}get __className__(){return"LocalVideoTrack"}constructor(i,r,a,d,l,h){if(super(i,l),S(this,"trackMediaType","video"),S(this,"_player",void 0),S(this,"isUseScaleResolutionDownBy",!1),S(this,"_videoVisibleTimer",null),S(this,"_statsTimer",null),S(this,"_previousVideoVisibleStatus",void 0),S(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),S(this,"_encoderConfig",void 0),S(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),S(this,"_optimizationMode",void 0),S(this,"_videoHeight",void 0),S(this,"_videoWidth",void 0),S(this,"_forceBitrateLimit",void 0),S(this,"_enabled",!0),S(this,"processorDestination",void 0),S(this,"_processorContext",void 0),fr()){const{width:p,height:m}=i.getSettings();this._videoWidth=p,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=r,this._scalabilityMode=a,this._optimizationMode=d,this._hints=h||[],-1===this._hints.indexOf(kt.SCREEN_TRACK))this.updateBitrateFromProfile();else if(function(p,m,_){const v=lt();return!(v.name!==p||!v.osVersion)&&115===Number(v.version)}(Et.CHROME)&&-1!==kE().indexOf("Windows")){const p=function(m,_){if("VideoFrame"in window&&"TransformStream"in window&&Ot().supportWebRTCInsertableStream){const v=new MediaStreamTrackProcessor(m),b=new MediaStreamTrackGenerator({kind:"video"});let y,T,M=Date.now();const O=()=>{D&&(clearInterval(D),D=void 0),y&&(y.close(),y=void 0),m.stop(),T=void 0,b.removeEventListener("ended",O)};let D=window.setInterval(()=>{if(T&&y&&Date.now()-M>1e3)try{"live"===b.readyState?T.enqueue(y.clone()):O()}catch{O()}},1e3);const x=new TransformStream({transform:(F,j)=>{"live"===b.readyState?(T=j,M=Date.now(),void 0===y?(y=F,j.enqueue(F.clone())):(j.enqueue(y),y=F)):F.close()}});return b.addEventListener("ended",O),v.readable.pipeThrough(x).pipeTo(b.writable),b}}(i);p&&(I.info("local screen video track begin to inject frame"),this._mediaStreamTrack=p)}r&&-1!==this._hints.indexOf(kt.CUSTOM_TRACK)&&this.setEncoderConfiguration(r),this.processorContext=new l2(this.getTrackId(),"local"),this.processorDestination=new fN(this.processorContext),this.bindProcessorDestinationEvents()}play(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof i){const d=document.getElementById(i);d?i=d:(I.warning("[".concat(this.getTrackId(),'] can not find "#').concat(i,'" element, use document.body')),i=document.body)}I.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const a=Uo(Uo(Uo({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:i});this._player?this._player.updateConfig(a):(this._player=i instanceof HTMLVideoElement?new jm(a):new _N(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const d=this.getVideoElementVisibleStatus();this.safeEmit(Ga.VIDEO_ELEMENT_VISIBLE_STATUS,d)}catch{}},V("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,I.debug("[".concat(this.getTrackId(),"] stop video playback")))}setEnabled(i,r){var a=this;return L(function*(){if(!r){if(i===a._enabled)return;a.stateCheck("enabled",i)}if(I.info("[".concat(a.getTrackId(),"] start setEnabled"),i),!i){a._originMediaStreamTrack.enabled=!1;try{yield Tt(a,ve.NEED_DISABLE_TRACK,a)}catch(d){throw I.error("[".concat(a.getTrackId(),"] setEnabled to false error"),d.toString()),d}return r||(a._enabled=!1),void I.info("[".concat(a.getTrackId(),"] setEnabled to false success"))}a._originMediaStreamTrack.enabled=!0;try{yield Tt(a,ve.NEED_ENABLE_TRACK,a)}catch(d){throw I.error("[".concat(a.getTrackId(),"] setEnabled to true error"),d.toString()),d}I.info("[".concat(a.getTrackId(),"] setEnabled to true success")),r||(a._enabled=!0)})()}setMuted(i){var r=this;return L(function*(){i!==r._muted&&(r.stateCheck("muted",i),r._muted=i,r._originMediaStreamTrack.enabled=!i,I.debug("[".concat(r.getTrackId(),"] start set muted: ").concat(i)),i?yield Tt(r,ve.NEED_MUTE_TRACK,r):yield Tt(r,ve.NEED_UNMUTE_TRACK,r))})()}setEncoderConfiguration(i,r){var a=this;return L(function*(){if(!a._enabled)throw new ee(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if("720p_auto"===i?a.startMonitorStats():a._statsTimer&&(window.clearInterval(a._statsTimer),a._statsTimer=null),i=xo(i),a._forceBitrateLimit&&(i.bitrateMax=a._forceBitrateLimit.max_bitrate?a._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=a._forceBitrateLimit.min_bitrate?a._forceBitrateLimit.min_bitrate:i.bitrateMin),i.width||i.height||i.frameRate){const d=Nv({encoderConfig:i});(fr()||Pi()||Tc())&&(d.deviceId=void 0),I.debug("[".concat(a.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(i),JSON.stringify(d));try{yield a._originMediaStreamTrack.applyConstraints(d),a.updateMediaStreamTrackResolution()}catch(l){const h=new ee(k.UNEXPECTED_ERROR,l.toString());throw I.error("[".concat(a.getTrackId(),"] applyConstraints error"),h.toString()),h}}a._encoderConfig=i,-1===a._hints.indexOf(kt.SCREEN_TRACK)&&a.updateBitrateFromProfile();try{yield Tt(a,ve.NEED_UPDATE_VIDEO_ENCODER,a)}catch(d){return d.throw(I)}})()}getStats(){return qh(()=>{I.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Pr(this,ve.GET_STATS)||Uo({},wn)}setBeautyEffect(i){return L(function*(){I.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")})()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}getCurrentFrameImage(i){var r=arguments,a=this;return L(function*(){return a._player?a._player.getCurrentFrameToUint8Array(i,r.length>1&&void 0!==r[1]?r[1]:1):yield $T(i)})()}setBitrateLimit(i){var r=this;return L(function*(){if(I.debug("[".concat(r.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(i))),i){r._forceBitrateLimit=i,r._encoderConfig&&(r._encoderConfig.bitrateMax=r._encoderConfig.bitrateMax&&r._encoderConfig.bitrateMax<i.max_bitrate?r._encoderConfig.bitrateMax:i.max_bitrate,r._encoderConfig.bitrateMin=i.min_bitrate);try{yield Tt(r,ve.NEED_UPDATE_VIDEO_ENCODER,r)}catch(a){return a.throw(I)}}})()}setOptimizationMode(i){var r=this;return L(function*(){if("motion"!==i&&"detail"!==i&&"balanced"!==i)return void I.error(k.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const a=r._optimizationMode;try{r._optimizationMode=i,yield Tt(r,ve.SET_OPTIMIZATION_MODE,r)}catch(d){throw r._optimizationMode=a,I.error("[".concat(r.getTrackId(),"] set optimization mode failed"),d.toString()),d}I.info("[".concat(r.getTrackId(),"] set optimization mode success (").concat(i,")"))})()}setScalabiltyMode(i){if(1===i.numSpatialLayers&&1!==i.numTemporalLayers)return I.error(k.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=i,I.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(i,")"))}updateMediaStreamTrackResolution(){Hm(this._originMediaStreamTrack).then(i=>{let[r,a]=i;this._videoHeight=a,this._videoWidth=r}).catch(Yl)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}setSenderConfiguration(i){var r=this;return L(function*(){if(!r._enabled)throw new ee(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");I.debug("[".concat(r.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(i)),i=xo(i),r._forceBitrateLimit&&(i.bitrateMax=r._forceBitrateLimit.max_bitrate?r._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=r._forceBitrateLimit.min_bitrate?r._forceBitrateLimit.min_bitrate:i.bitrateMin),r._encoderConfig=i,-1===r._hints.indexOf(kt.SCREEN_TRACK)&&r.updateBitrateFromProfile();try{yield Tt(r,ve.NEED_UPDATE_VIDEO_ENCODER,r)}catch(a){return a.throw(I)}})()}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:i,height:r,frameRate:a}=this.getMediaStreamTrackSettings();if(!i||!r||!a)return;const[d,l]=function(h,p,m,_){let v;const b=200*Math.pow(m/15,.6)*Math.pow(h*p/640/360,.75),y=b;if("STANDARD_BITRATE"===_)v=4*b;else{if("COMPATIABLE_BITRATE"!==_)return;v=2*b}return[Math.floor(v),Math.floor(y)]}(i,r,a,V("BITRATE_ADAPTER_TYPE"))||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=d,I.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(i,", h: ").concat(r,", fps: ").concat(a,"] => [brMax: ").concat(d,", brMin: ").concat(l,"]")))}getVideoElementVisibleStatus(){try{var i,r;const a=null==this||null===(i=this._player)||void 0===i?void 0:i.getContainerElement(),d={track:this,element:null==this||null===(r=this._player)||void 0===r?void 0:r.getVideoElement(),slot:a?.parentElement},{element:l,slot:h}=d;if(this.isPlaying&&l instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=TD.checkOneElementVisible(l),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;Ie.reportApiInvoke(null,{tag:qt.TRACER,name:Kn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(m.visible?"Video is visible":"Invisible because of ".concat(m.reason))}return m}return}catch(a){throw new ee(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}renewMediaStreamTrack(i){return L(function*(){})()}pipe(i){if(this.processor===i)return i;if(i._source)throw new ee(k.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),i}unpipe(){if(!this.processor)return;const i=this.processor;this.processor._source=void 0,this.processor=void 0,i.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(i){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this._encoderConfig;i&&(a=Uo(Uo({},a),xo(i))),a=Dd(a);const d=Ke(8,"track-video-cloned-"),l=new je(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,Dd(this._scalabilityMode),this._optimizationMode,d,Dd(this._hints));return i&&a&&l.setEncoderConfiguration(a),I.debug("clone video track from ".concat(this.getTrackId()," to ").concat(d,", clone ").concat(r)),l}replaceTrack(i,r){var a=this;return L(function*(){if(!(i instanceof MediaStreamTrack))throw new ee(k.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==i.kind)throw new ee(k.INVALID_PARAMS,"track should be a video MediaStreamTrack");yield a._updateOriginMediaStreamTrack(i,r,!0),a.updateMediaStreamTrackResolution()})()}startMonitorStats(){if(!fr()&&!Pi())return;this._statsTimer&&window.clearInterval(this._statsTimer);let i=2,r=Iv[i],a=-1,d=Date.now();const l=h=>{h>2||h<0||(d=Date.now(),r=Iv[h],this.setSenderConfiguration(r))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval(()=>{const h=this.getStats(),p=Pr(this,ve.GET_RTC_STATS);if(h.sendPackets>0&&p){-1===a&&(a=Date.now());const m=Date.now();if(m-a<1e3||m-d<V("PROFILE_SWITCH_INTERVAL"))return;const _=h.sendFrameRate,b=.9*r.frameRate;"number"==typeof _&&_>0&&_<.6*r.frameRate?i>0&&(i--,l(i),I.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(_,", switchProfile to ").concat(i))):p.OutgoingAvailableBandwidth<r.bitrateMin?i>0&&(i--,l(i),I.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(p.OutgoingAvailableBandwidth,", bitrateMin ").concat(r.bitrateMin,", switchProfile to ").concat(i))):"number"==typeof _&&_>b&&i<Iv.length-1&&p.OutgoingAvailableBandwidth>1.2*Iv[i+1].bitrateMin&&(i++,l(i),I.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(_,", OutgoingAvailableBandwidth ").concat(p.OutgoingAvailableBandwidth,", switchProfile to ").concat(i)))}},V("CHECK_LOCAL_STATS_INTERVAL"))}bindProcessorDestinationEvents(){var i=this;this.processorDestination.on(cr.ON_TRACK,function(){var r=L(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource(),yield Tt(i,ve.NEED_REPLACE_TRACK,i)):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource(),yield Tt(i,ve.NEED_REPLACE_TRACK,i))});return function(a){return r.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(cr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(yr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(yr.REQUEST_CONSTRAINTS)}}ne([we({argsMap:(s,i,r)=>[s.getTrackId(),"string"==typeof i?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),En(),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",void 0)],je.prototype,"play",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],je.prototype,"stop",null),ne([ti("LocalVideoTrack","_enabledMutex"),we({argsMap:(s,i)=>[s.getTrackId(),i]}),En(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean]),N("design:returntype",X)],je.prototype,"setEnabled",null),ne([ti("LocalVideoTrack","_enabledMutex"),we({argsMap:(s,i)=>[s.getTrackId(),i]}),En(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",X)],je.prototype,"setMuted",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i]}),En(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",X)],je.prototype,"setEncoderConfiguration",null),ne([En(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Object)],je.prototype,"getStats",null),ne([we({argsMap:(s,i,r)=>[s.getTrackId(),i,r]}),En(),N("design:type",Function),N("design:paramtypes",[Boolean,Object]),N("design:returntype",X)],je.prototype,"setBeautyEffect",null),ne([En(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",ImageData)],je.prototype,"getCurrentFrameData",null),ne([En(),N("design:type",Function),N("design:paramtypes",[String,Number]),N("design:returntype",X)],je.prototype,"getCurrentFrameImage",null),ne([En(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],je.prototype,"setBitrateLimit",null),ne([En(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],je.prototype,"setOptimizationMode",null),ne([En(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],je.prototype,"setScalabiltyMode",null),ne([En(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],je.prototype,"updateMediaStreamTrackResolution",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],je.prototype,"pipe",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],je.prototype,"unpipe",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],je.prototype,"close",null),ne([we({argsMap:(s,i,r)=>[s.getTrackId(),i.label,r]}),N("design:type",Function),N("design:paramtypes",[MediaStreamTrack,Boolean]),N("design:returntype",X)],je.prototype,"replaceTrack",null),ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],je.prototype,"startMonitorStats",null);class gs extends je{get __className__(){return"CameraVideoTrack"}constructor(i,r,a,d,l,h){var p;super(i,xo(r.encoderConfig),d,l,h),p=this,S(this,"_config",void 0),S(this,"_originalConstraints",void 0),S(this,"_constraints",void 0),S(this,"_enabled",!0),S(this,"_deviceName","default"),S(this,"tryResumeVideoForIOS15_16WeChat",L(function*(){(Hh()||vD())&&!function(){const m=lt();if(m.os!==ei.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return 15===Number(_[0])&&Number(_[1])>=2}()&&yD()&&p._enabled&&!p._isClosed&&(I.debug("[".concat(p.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),yield p.renewMediaStreamTrack())})),this._config=r,this._originalConstraints=a,this._constraints=a,this._deviceName=i.label,this._encoderConfig=xo(this._config.encoderConfig),St.on(ri.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),St.on(ri.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}setDevice(i){var r=this;return L(function*(){return"string"==typeof i?r._setDeviceById(i):i.deviceId?r._setDeviceById(i.deviceId):i.facingMode?r._setDeviceByFacingModel(i.facingMode):void 0})()}_setDeviceById(i){var r=this;return L(function*(){if(I.info("[".concat(r.getTrackId(),"] set device to ").concat(i)),r._enabled)try{const a=yield Lo.getDeviceById(i),d={};d.video=Uo({},r._constraints),d.video.deviceId={exact:i},d.video.facingMode=void 0,r._originMediaStreamTrack.stop();let l=null;try{l=yield ko(d,r.getTrackId())}catch(h){throw I.error("[".concat(r.getTrackId(),"] setDevice failed"),h.toString()),l=yield ko({video:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),h}yield r._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),r.updateMediaStreamTrackResolution(),r._deviceName=a.label,r._config.cameraId=i,r._constraints.deviceId={exact:i}}catch(a){throw I.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}else try{const a=yield Lo.getDeviceById(i);r._deviceName=a.label,r._config.cameraId=i,r._constraints.deviceId={exact:i}}catch(a){throw I.error("[".concat(r.getTrackId(),"] setDevice error"),a.toString()),a}I.info("[".concat(r.getTrackId(),"] setDevice success"))})()}_setDeviceByFacingModel(i){var r=this;return L(function*(){I.info("[".concat(r.getTrackId(),"] set facingMode ").concat(i));const a={video:Uo(Uo({},r._constraints),{},{deviceId:void 0,facingMode:{exact:i}})};if(r._enabled){r._originMediaStreamTrack.stop();let d=null;try{d=yield ko(a,r.getTrackId())}catch(l){throw I.error("[".concat(r.getTrackId(),"] setDeviceByFacingModel failed"),l.toString()),d=yield ko({video:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),l}yield r._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),r.updateMediaStreamTrackResolution()}r._deviceName="",r._config.facingMode=i,r._config.cameraId=void 0,r._constraints=Uo({},a.video),I.info("[".concat(r.getTrackId(),"] setDeviceByFacingModel success"))})()}setEnabled(i,r){var a=this;return L(function*(){if(!r){if(i===a._enabled)return;a.stateCheck("enabled",i)}if(I.info("[".concat(a.getTrackId(),"] start setEnabled"),i),i){try{if(a.isExternalTrack)a._originMediaStreamTrack.enabled=!0;else{const d=yield ko({video:a._constraints},a.getTrackId());yield a._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1)}yield Tt(a,ve.NEED_ENABLE_TRACK,a)}catch(d){throw I.error("[".concat(a.getTrackId(),"] setEnabled true error"),d.toString()),d}a.updateMediaStreamTrackResolution(),I.info("[".concat(a.getTrackId(),"] setEnabled to true success")),r||(a._enabled=!0)}else{a.isExternalTrack?a._originMediaStreamTrack.enabled=!1:(a._originMediaStreamTrack.onended=null,a._originMediaStreamTrack.stop()),r||(a._enabled=!1);try{yield Tt(a,ve.NEED_DISABLE_TRACK,a)}catch(d){throw I.error("[".concat(a.getTrackId(),"] setEnabled to false error"),d.toString()),d}I.info("[".concat(a.getTrackId(),"] setEnabled to false success"))}})()}setEncoderConfiguration(i,r){var a=this;return L(function*(){if(!a._enabled)throw new ee(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");"720p_auto"===i?a.startMonitorStats():a._statsTimer&&(window.clearInterval(a._statsTimer),a._statsTimer=null),i=xo(i),a._forceBitrateLimit&&(i.bitrateMax=a._forceBitrateLimit.max_bitrate?a._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=a._forceBitrateLimit.min_bitrate?a._forceBitrateLimit.min_bitrate:i.bitrateMin);const d=Ft(a._config);d.encoderConfig=i;const l=Nv(d);(fr()||Pi()||Tc())&&(l.deviceId=void 0),I.debug("[".concat(a.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(i),JSON.stringify(l));try{yield a._originMediaStreamTrack.applyConstraints(l),a.updateMediaStreamTrackResolution()}catch(h){const p=new ee(k.UNEXPECTED_ERROR,h.toString());throw I.error("[".concat(a.getTrackId(),"] applyConstraints error"),p.toString()),p}a._config=d,a._constraints=l,a._originalConstraints=l,a._encoderConfig=i,-1===a._hints.indexOf(kt.SCREEN_TRACK)&&a.updateBitrateFromProfile();try{yield Tt(a,ve.NEED_UPDATE_VIDEO_ENCODER,a)}catch(h){return h.throw(I)}})()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){var i=this;if((Pi()||Tc())&&this._enabled&&!this._isClosed&&St.duringInterruption){const r=function(){var a=L(function*(){St.off(ri.IOS_INTERRUPTION_END,r),i._enabled&&!i._isClosed&&(I.debug("[".concat(i.getTrackId(),"] try capture camera media device for interrupted iOS device.")),yield i.setEnabled(!1),yield i.setEnabled(!0))});return function(){return a.apply(this,arguments)}}();St.on(ri.IOS_INTERRUPTION_END,r)}else I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ga.TRACK_ENDED)}renewMediaStreamTrack(i){var r=this;return L(function*(){const a=i||r._constraints,d=Lo.searchDeviceIdByName(r._deviceName);if(d&&!a.deviceId&&(a.deviceId={exact:d}),r._enabled){const l=yield ko({video:a},r.getTrackId());r._constraints=a,yield r._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!0),r.updateMediaStreamTrackResolution()}})()}close(){super.close(),St.off(ri.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),St.off(ri.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(i){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this._encoderConfig;i&&(a=Uo(Uo({},a),xo(i))),a=Dd(a);const d=Ke(8,"track-cam-cloned-"),l=new gs(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,Dd(Uo(Uo({},this._config),{},{encoderConfig:a})),Dd(this._constraints),Dd(this._scalabilityMode),this._optimizationMode,d);return i&&a&&l.setEncoderConfiguration(a),I.debug("clone track from ".concat(this.getTrackId()," to ").concat(d,", clone ").concat(r)),l}bindProcessorContextEvents(){var i=this;this.processorContext.on(yr.REQUEST_UPDATE_CONSTRAINTS,function(){var r=L(function*(a,d,l){try{const h=Object.assign({},i._originalConstraints,...a);yield i.renewMediaStreamTrack(h),d()}catch(h){l(h)}});return function(a,d,l){return r.apply(this,arguments)}}()),this.processorContext.on(yr.REQUEST_CONSTRAINTS,function(){var r=L(function*(a){a(i._originMediaStreamTrack.getSettings())});return function(a){return r.apply(this,arguments)}}())}}function EN(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Gm(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?EN(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):EN(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function Wm(s,i,r,a){r.optimizationMode&&(a&&a.width&&a.height?(r.encoderConfig=Gm(Gm({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),"motion"!==r.optimizationMode&&"detail"!==r.optimizationMode||(i.contentHint=r.optimizationMode,i.contentHint===r.optimizationMode?I.debug("[".concat(s,"] set content hint to"),r.optimizationMode):I.debug("[".concat(s,"] set content hint failed")))):I.warning("[".concat(s,"] can not apply optimization mode bitrate config, no encoderConfig")))}function g2(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Pv(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?g2(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):g2(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}ne([we({argsMap:(s,i)=>[s.getTrackId(),i]}),En(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],gs.prototype,"setDevice",null),ne([ti("CameraVideoTrack","_enabledMutex"),we({argsMap:(s,i)=>[s.getTrackId(),i]}),En(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean]),N("design:returntype",X)],gs.prototype,"setEnabled",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i]}),En(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",X)],gs.prototype,"setEncoderConfiguration",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],gs.prototype,"close",null);class vN extends Hc{getUserId(){return this._userId}constructor(i,r,a,d){super(i,"track-".concat(i.kind,"-").concat(r,"-").concat(d.clientId,"_").concat(Ke(5,""))),S(this,"_userId",void 0),S(this,"_uintId",void 0),S(this,"_isDestroyed",!1),S(this,"store",void 0),S(this,"processor",void 0),this._userId=r,this._uintId=a,this.store=d}_updateOriginMediaStreamTrack(i){this._originMediaStreamTrack=i,this._mediaStreamTrack=i,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,I.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}class Wa extends vN{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Vi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(i,r,a,d){super(i,r,a,d),S(this,"_videoVisibleTimer",null),S(this,"_previousVideoVisibleStatus",void 0),S(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),S(this,"trackMediaType","video"),S(this,"_videoWidth",void 0),S(this,"_videoHeight",void 0),S(this,"_player",void 0),S(this,"processorDestination",void 0),S(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new l2(this.getTrackId(),"remote"),this.processorDestination=new fN(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return qh(()=>{I.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Pr(this,ve.GET_STATS)||Pv({},sN)}play(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof i){const d=document.getElementById(i);d?i=d:(I.warning("[".concat(this.getTrackId(),'] can not find "#').concat(i,'" element, use document.body')),i=document.body)}I.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const a=Pv(Pv({fit:"cover"},r),{},{trackId:this.getTrackId(),element:i});this._player?this._player.updateConfig(a):(this._player=i instanceof HTMLVideoElement?new jm(a):new _N(a),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(uu.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const d=this.getVideoElementVisibleStatus();this.safeEmit(uu.VIDEO_ELEMENT_VISIBLE_STATUS,d)}catch{}},V("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,I.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Hm(this._originMediaStreamTrack).then(i=>{let[r,a]=i;this._videoHeight=a,this._videoWidth=r}).catch(Yl)}_updatePlayerSource(){I.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var i,r;const a=null==this||null===(i=this._player)||void 0===i?void 0:i.getContainerElement(),d={track:this,element:null==this||null===(r=this._player)||void 0===r?void 0:r.getVideoElement(),slot:a?.parentElement},{element:l,slot:h}=d;if(this.isPlaying&&l instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=TD.checkOneElementVisible(l),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;Ie.reportApiInvoke(null,{tag:qt.TRACER,name:Kn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(m.visible?"Video is visible":"Invisible because of ".concat(m.reason))}return m}return}catch(a){throw new ee(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}pipe(i){if(this.processor===i)return i;if(i._source)throw new ee(k.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),i}unpipe(){if(!this.processor)return;const i=this.processor;this.processor._source=void 0,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(){var i=this;this.processorDestination.on(cr.ON_TRACK,function(){var r=L(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource()):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource())});return function(a){return r.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(cr.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}ne([we({argsMap:(s,i,r)=>[s.getTrackId(),"string"==typeof i?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",void 0)],Wa.prototype,"play",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Wa.prototype,"stop",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],Wa.prototype,"pipe",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Wa.prototype,"unpipe",null);class _s extends vN{get isPlaying(){return this._useAudioElement?Mr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(i,r,a,d){super(i,r,a,d),S(this,"trackMediaType","audio"),S(this,"_source",void 0),S(this,"_useAudioElement",!0),S(this,"_volume",100),S(this,"processorContext",void 0),S(this,"processorDestination",void 0),S(this,"_played",!1),S(this,"_bypassWebAudio",!1),V("DISABLE_WEBAUDIO")?(this._source=new qT,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Rv(i,!0),V("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(qr.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(uu.FIRST_FRAME_DECODED)}),this.processorContext=new mu(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new KT(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(qr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!i)return this._source.removeAllListeners(qr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(qr.ON_AUDIO_BUFFER),this._source.on(qr.ON_AUDIO_BUFFER,a=>i(a))}setVolume(i){this._volume=i,this._useAudioElement?Mr.setVolume(this.getTrackId(),i):this._source.setVolume(i/100)}setPlaybackDevice(i){var r=this;return L(function*(){if(!r._useAudioElement||!nm()&&V("RESTRICTION_SET_PLAYBACK_DEVICE"))throw new ee(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield Mr.setSinkID(r.getTrackId(),i)})()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return qh(()=>{I.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Pr(this,ve.GET_STATS)||Pv({},jd)}play(){I.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(I.debug("[".concat(this.getTrackId(),"] use audio element to play")),Mr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){I.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Mr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];I.debug("[".concat(this.getTrackId(),"] update player source track")),i&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Mr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(i){if(this._bypassWebAudio)throw new ee(k.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===i)return i;if(i._source)throw new ee(k.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),i}unpipe(){var i;if(this._bypassWebAudio)throw new ee(k.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;null===(i=this._source.processSourceNode)||void 0===i||i.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){var i=this;this.processorDestination.on(cr.ON_TRACK,function(){var r=L(function*(a){a?a!==i._mediaStreamTrack&&(i._mediaStreamTrack=a,i._updatePlayerSource(!1),i._source.processedNode=i._source.createMediaStreamSourceNode(a)):i._mediaStreamTrack!==i._originMediaStreamTrack&&(i._mediaStreamTrack=i._originMediaStreamTrack,i._updatePlayerSource())});return function(a){return r.apply(this,arguments)}}()),this.processorDestination.on(cr.ON_NODE,r=>{this._source.processedNode=r;const a=!r;this._useAudioElement!==a&&(this._played?(this.stop(),this._useAudioElement=a,this.play()):this._useAudioElement=a)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(cr.ON_TRACK),this.processorDestination.removeAllListeners(cr.ON_NODE)}}function _u(s){let i=s.length;for(;--i>=0;)s[i]=0}ne([we({argsMap:(s,i)=>[s.getTrackId(),i],throttleTime:300}),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],_s.prototype,"setVolume",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i]}),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],_s.prototype,"setPlaybackDevice",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],_s.prototype,"play",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],_s.prototype,"stop",null),ne([we({argsMap:(s,i)=>[s.getTrackId(),i.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],_s.prototype,"pipe",null),ne([we({argsMap:s=>[s.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],_s.prototype,"unpipe",null);const n0=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Km=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),_2=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),r0=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),za=new Array(576);_u(za);const bp=new Array(60);_u(bp);const yp=new Array(512);_u(yp);const qm=new Array(256);_u(qm);const o0=new Array(29);_u(o0);const s0=new Array(30);function Mv(s,i,r,a,d){this.static_tree=s,this.extra_bits=i,this.extra_base=r,this.elems=a,this.max_length=d,this.has_stree=s&&s.length}let E2,v2,b2;function bN(s,i){this.dyn_tree=s,this.max_code=0,this.stat_desc=i}_u(s0);const y2=s=>s<256?yp[s]:yp[256+(s>>>7)],xv=(s,i)=>{s.pending_buf[s.pending++]=255&i,s.pending_buf[s.pending++]=i>>>8&255},Es=(s,i,r)=>{s.bi_valid>16-r?(s.bi_buf|=i<<s.bi_valid&65535,xv(s,s.bi_buf),s.bi_buf=i>>16-s.bi_valid,s.bi_valid+=r-16):(s.bi_buf|=i<<s.bi_valid&65535,s.bi_valid+=r)},Wc=(s,i,r)=>{Es(s,r[2*i],r[2*i+1])},Gd=(s,i)=>{let r=0;do{r|=1&s,s>>>=1,r<<=1}while(--i>0);return r>>>1},C2=(s,i,r)=>{const a=new Array(16);let d,l,h=0;for(d=1;d<=15;d++)h=h+r[d-1]<<1,a[d]=h;for(l=0;l<=i;l++){let p=s[2*l+1];0!==p&&(s[2*l]=Gd(a[p]++,p))}},S2=s=>{let i;for(i=0;i<286;i++)s.dyn_ltree[2*i]=0;for(i=0;i<30;i++)s.dyn_dtree[2*i]=0;for(i=0;i<19;i++)s.bl_tree[2*i]=0;s.dyn_ltree[512]=1,s.opt_len=s.static_len=0,s.sym_next=s.matches=0},a0=s=>{s.bi_valid>8?xv(s,s.bi_buf):s.bi_valid>0&&(s.pending_buf[s.pending++]=s.bi_buf),s.bi_buf=0,s.bi_valid=0},yN=(s,i,r,a)=>{const d=2*i,l=2*r;return s[d]<s[l]||s[d]===s[l]&&a[i]<=a[r]},kv=(s,i,r)=>{const a=s.heap[r];let d=r<<1;for(;d<=s.heap_len&&(d<s.heap_len&&yN(i,s.heap[d+1],s.heap[d],s.depth)&&d++,!yN(i,a,s.heap[d],s.depth));)s.heap[r]=s.heap[d],r=d,d<<=1;s.heap[r]=a},CN=(s,i,r)=>{let a,d,l,h,p=0;if(0!==s.sym_next)do{a=255&s.pending_buf[s.sym_buf+p++],a+=(255&s.pending_buf[s.sym_buf+p++])<<8,d=s.pending_buf[s.sym_buf+p++],0===a?Wc(s,d,i):(l=qm[d],Wc(s,l+256+1,i),h=n0[l],0!==h&&(d-=o0[l],Es(s,d,h)),a--,l=y2(a),Wc(s,l,r),h=Km[l],0!==h&&(a-=s0[l],Es(s,a,h)))}while(p<s.sym_next);Wc(s,256,i)},SN=(s,i)=>{const r=i.dyn_tree,a=i.stat_desc.static_tree,d=i.stat_desc.has_stree,l=i.stat_desc.elems;let h,p,m,_=-1;for(s.heap_len=0,s.heap_max=573,h=0;h<l;h++)0!==r[2*h]?(s.heap[++s.heap_len]=_=h,s.depth[h]=0):r[2*h+1]=0;for(;s.heap_len<2;)m=s.heap[++s.heap_len]=_<2?++_:0,r[2*m]=1,s.depth[m]=0,s.opt_len--,d&&(s.static_len-=a[2*m+1]);for(i.max_code=_,h=s.heap_len>>1;h>=1;h--)kv(s,r,h);m=l;do{h=s.heap[1],s.heap[1]=s.heap[s.heap_len--],kv(s,r,1),p=s.heap[1],s.heap[--s.heap_max]=h,s.heap[--s.heap_max]=p,r[2*m]=r[2*h]+r[2*p],s.depth[m]=(s.depth[h]>=s.depth[p]?s.depth[h]:s.depth[p])+1,r[2*h+1]=r[2*p+1]=m,s.heap[1]=m++,kv(s,r,1)}while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1],((v,b)=>{const y=b.dyn_tree,T=b.max_code,M=b.stat_desc.static_tree,O=b.stat_desc.has_stree,D=b.stat_desc.extra_bits,x=b.stat_desc.extra_base,F=b.stat_desc.max_length;let j,q,te,K,Q,$,z=0;for(K=0;K<=15;K++)v.bl_count[K]=0;for(y[2*v.heap[v.heap_max]+1]=0,j=v.heap_max+1;j<573;j++)q=v.heap[j],K=y[2*y[2*q+1]+1]+1,K>F&&(K=F,z++),y[2*q+1]=K,q>T||(v.bl_count[K]++,Q=0,q>=x&&(Q=D[q-x]),$=y[2*q],v.opt_len+=$*(K+Q),O&&(v.static_len+=$*(M[2*q+1]+Q)));if(0!==z){do{for(K=F-1;0===v.bl_count[K];)K--;v.bl_count[K]--,v.bl_count[K+1]+=2,v.bl_count[F]--,z-=2}while(z>0);for(K=F;0!==K;K--)for(q=v.bl_count[K];0!==q;)te=v.heap[--j],te>T||(y[2*te+1]!==K&&(v.opt_len+=(K-y[2*te+1])*y[2*te],y[2*te+1]=K),q--)}})(s,i),C2(r,_,s.bl_count)},Ym=(s,i,r)=>{let a,d,l=-1,h=i[1],p=0,m=7,_=4;for(0===h&&(m=138,_=3),i[2*(r+1)+1]=65535,a=0;a<=r;a++)d=h,h=i[2*(a+1)+1],++p<m&&d===h||(p<_?s.bl_tree[2*d]+=p:0!==d?(d!==l&&s.bl_tree[2*d]++,s.bl_tree[32]++):p<=10?s.bl_tree[34]++:s.bl_tree[36]++,p=0,l=d,0===h?(m=138,_=3):d===h?(m=6,_=3):(m=7,_=4))},TN=(s,i,r)=>{let a,d,l=-1,h=i[1],p=0,m=7,_=4;for(0===h&&(m=138,_=3),a=0;a<=r;a++)if(d=h,h=i[2*(a+1)+1],!(++p<m&&d===h)){if(p<_)do{Wc(s,d,s.bl_tree)}while(0!=--p);else 0!==d?(d!==l&&(Wc(s,d,s.bl_tree),p--),Wc(s,16,s.bl_tree),Es(s,p-3,2)):p<=10?(Wc(s,17,s.bl_tree),Es(s,p-3,3)):(Wc(s,18,s.bl_tree),Es(s,p-11,7));p=0,l=d,0===h?(m=138,_=3):d===h?(m=6,_=3):(m=7,_=4)}};let Cp=!1;const $m=(s,i,r,a)=>{Es(s,0+(a?1:0),3),a0(s),xv(s,r),xv(s,~r),r&&s.pending_buf.set(s.window.subarray(i,i+r),s.pending),s.pending+=r};var R2={_tr_init:s=>{Cp||((()=>{let i,r,a,d,l;const h=new Array(16);for(a=0,d=0;d<28;d++)for(o0[d]=a,i=0;i<1<<n0[d];i++)qm[a++]=d;for(qm[a-1]=d,l=0,d=0;d<16;d++)for(s0[d]=l,i=0;i<1<<Km[d];i++)yp[l++]=d;for(l>>=7;d<30;d++)for(s0[d]=l<<7,i=0;i<1<<Km[d]-7;i++)yp[256+l++]=d;for(r=0;r<=15;r++)h[r]=0;for(i=0;i<=143;)za[2*i+1]=8,i++,h[8]++;for(;i<=255;)za[2*i+1]=9,i++,h[9]++;for(;i<=279;)za[2*i+1]=7,i++,h[7]++;for(;i<=287;)za[2*i+1]=8,i++,h[8]++;for(C2(za,287,h),i=0;i<30;i++)bp[2*i+1]=5,bp[2*i]=Gd(i,5);E2=new Mv(za,n0,257,286,15),v2=new Mv(bp,Km,0,30,15),b2=new Mv(new Array(0),_2,0,19,7)})(),Cp=!0),s.l_desc=new bN(s.dyn_ltree,E2),s.d_desc=new bN(s.dyn_dtree,v2),s.bl_desc=new bN(s.bl_tree,b2),s.bi_buf=0,s.bi_valid=0,S2(s)},_tr_stored_block:$m,_tr_flush_block:(s,i,r,a)=>{let d,l,h=0;s.level>0?(2===s.strm.data_type&&(s.strm.data_type=(p=>{let m,_=4093624447;for(m=0;m<=31;m++,_>>>=1)if(1&_&&0!==p.dyn_ltree[2*m])return 0;if(0!==p.dyn_ltree[18]||0!==p.dyn_ltree[20]||0!==p.dyn_ltree[26])return 1;for(m=32;m<256;m++)if(0!==p.dyn_ltree[2*m])return 1;return 0})(s)),SN(s,s.l_desc),SN(s,s.d_desc),h=(p=>{let m;for(Ym(p,p.dyn_ltree,p.l_desc.max_code),Ym(p,p.dyn_dtree,p.d_desc.max_code),SN(p,p.bl_desc),m=18;m>=3&&0===p.bl_tree[2*r0[m]+1];m--);return p.opt_len+=3*(m+1)+5+5+4,m})(s),d=s.opt_len+3+7>>>3,l=s.static_len+3+7>>>3,l<=d&&(d=l)):d=l=r+5,r+4<=d&&-1!==i?$m(s,i,r,a):4===s.strategy||l===d?(Es(s,2+(a?1:0),3),CN(s,za,bp)):(Es(s,4+(a?1:0),3),((p,m,_,v)=>{let b;for(Es(p,m-257,5),Es(p,_-1,5),Es(p,v-4,4),b=0;b<v;b++)Es(p,p.bl_tree[2*r0[b]+1],3);TN(p,p.dyn_ltree,m-1),TN(p,p.dyn_dtree,_-1)})(s,s.l_desc.max_code+1,s.d_desc.max_code+1,h+1),CN(s,s.dyn_ltree,s.dyn_dtree)),S2(s),a&&a0(s)},_tr_tally:(s,i,r)=>(s.pending_buf[s.sym_buf+s.sym_next++]=i,s.pending_buf[s.sym_buf+s.sym_next++]=i>>8,s.pending_buf[s.sym_buf+s.sym_next++]=r,0===i?s.dyn_ltree[2*r]++:(s.matches++,i--,s.dyn_ltree[2*(qm[r]+256+1)]++,s.dyn_dtree[2*y2(i)]++),s.sym_next===s.sym_end),_tr_align:s=>{var i;Es(s,2,3),Wc(s,256,za),16===(i=s).bi_valid?(xv(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=255&i.bi_buf,i.bi_buf>>=8,i.bi_valid-=8)}},Xm=(s,i,r,a)=>{let d=65535&s|0,l=s>>>16&65535|0,h=0;for(;0!==r;){h=r>2e3?2e3:r,r-=h;do{d=d+i[a++]|0,l=l+d|0}while(--h);d%=65521,l%=65521}return d|l<<16|0};const A2=new Uint32Array((()=>{let s,i=[];for(var r=0;r<256;r++){s=r;for(var a=0;a<8;a++)s=1&s?3988292384^s>>>1:s>>>1;i[r]=s}return i})());var Cr=(s,i,r,a)=>{const d=A2,l=a+r;s^=-1;for(let h=a;h<l;h++)s=s>>>8^d[255&(s^i[h])];return-1^s},Wd={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Sp={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:D2,_tr_stored_block:c0,_tr_flush_block:O2,_tr_tally:zd,_tr_align:N2}=R2,{Z_NO_FLUSH:Kd,Z_PARTIAL_FLUSH:P2,Z_FULL_FLUSH:M2,Z_FINISH:Hs,Z_BLOCK:IN,Z_OK:xr,Z_STREAM_END:wN,Z_STREAM_ERROR:pa,Z_DATA_ERROR:d0,Z_BUF_ERROR:l0,Z_DEFAULT_COMPRESSION:x2,Z_FILTERED:RN,Z_HUFFMAN_ONLY:Lv,Z_RLE:AN,Z_FIXED:iB,Z_DEFAULT_STRATEGY:k2,Z_UNKNOWN:DN,Z_DEFLATED:Eu}=Sp,Gs=262,vu=(s,i)=>(s.msg=Wd[i],i),F2=s=>2*s-(s>4?9:0),Kc=s=>{let i=s.length;for(;--i>=0;)s[i]=0},ON=s=>{let i,r,a,d=s.w_size;i=s.hash_size,a=i;do{r=s.head[--a],s.head[a]=r>=d?r-d:0}while(--i);i=d,a=i;do{r=s.prev[--a],s.prev[a]=r>=d?r-d:0}while(--i)};let Yr=(s,i,r)=>(i<<s.hash_shift^r)&s.hash_mask;const $r=s=>{const i=s.state;let r=i.pending;r>s.avail_out&&(r=s.avail_out),0!==r&&(s.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+r),s.next_out),s.next_out+=r,i.pending_out+=r,s.total_out+=r,s.avail_out-=r,i.pending-=r,0===i.pending&&(i.pending_out=0))},Vo=(s,i)=>{O2(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,i),s.block_start=s.strstart,$r(s.strm)},Xt=(s,i)=>{s.pending_buf[s.pending++]=i},Qm=(s,i)=>{s.pending_buf[s.pending++]=i>>>8&255,s.pending_buf[s.pending++]=255&i},f0=(s,i,r,a)=>{let d=s.avail_in;return d>a&&(d=a),0===d?0:(s.avail_in-=d,i.set(s.input.subarray(s.next_in,s.next_in+d),r),1===s.state.wrap?s.adler=Xm(s.adler,i,d,r):2===s.state.wrap&&(s.adler=Cr(s.adler,i,d,r)),s.next_in+=d,s.total_in+=d,d)},U2=(s,i)=>{let r,a,d=s.max_chain_length,l=s.strstart,h=s.prev_length,p=s.nice_match;const m=s.strstart>s.w_size-Gs?s.strstart-(s.w_size-Gs):0,_=s.window,v=s.w_mask,b=s.prev,y=s.strstart+258;let T=_[l+h-1],M=_[l+h];s.prev_length>=s.good_match&&(d>>=2),p>s.lookahead&&(p=s.lookahead);do{if(r=i,_[r+h]===M&&_[r+h-1]===T&&_[r]===_[l]&&_[++r]===_[l+1]){l+=2,r++;do{}while(_[++l]===_[++r]&&_[++l]===_[++r]&&_[++l]===_[++r]&&_[++l]===_[++r]&&_[++l]===_[++r]&&_[++l]===_[++r]&&_[++l]===_[++r]&&_[++l]===_[++r]&&l<y);if(a=258-(y-l),l=y-258,a>h){if(s.match_start=i,h=a,a>=p)break;T=_[l+h-1],M=_[l+h]}}}while((i=b[i&v])>m&&0!=--d);return h<=s.lookahead?h:s.lookahead},bu=s=>{const i=s.w_size;let r,a,d;do{if(a=s.window_size-s.lookahead-s.strstart,s.strstart>=i+(i-Gs)&&(s.window.set(s.window.subarray(i,i+i-a),0),s.match_start-=i,s.strstart-=i,s.block_start-=i,s.insert>s.strstart&&(s.insert=s.strstart),ON(s),a+=i),0===s.strm.avail_in)break;if(r=f0(s.strm,s.window,s.strstart+s.lookahead,a),s.lookahead+=r,s.lookahead+s.insert>=3)for(d=s.strstart-s.insert,s.ins_h=s.window[d],s.ins_h=Yr(s,s.ins_h,s.window[d+1]);s.insert&&(s.ins_h=Yr(s,s.ins_h,s.window[d+3-1]),s.prev[d&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=d,d++,s.insert--,!(s.lookahead+s.insert<3)););}while(s.lookahead<Gs&&0!==s.strm.avail_in)},NN=(s,i)=>{let r,a,d,l=s.pending_buf_size-5>s.w_size?s.w_size:s.pending_buf_size-5,h=0,p=s.strm.avail_in;do{if(r=65535,d=s.bi_valid+42>>3,s.strm.avail_out<d||(d=s.strm.avail_out-d,a=s.strstart-s.block_start,r>a+s.strm.avail_in&&(r=a+s.strm.avail_in),r>d&&(r=d),r<l&&(0===r&&i!==Hs||i===Kd||r!==a+s.strm.avail_in)))break;h=i===Hs&&r===a+s.strm.avail_in?1:0,c0(s,0,0,h),s.pending_buf[s.pending-4]=r,s.pending_buf[s.pending-3]=r>>8,s.pending_buf[s.pending-2]=~r,s.pending_buf[s.pending-1]=~r>>8,$r(s.strm),a&&(a>r&&(a=r),s.strm.output.set(s.window.subarray(s.block_start,s.block_start+a),s.strm.next_out),s.strm.next_out+=a,s.strm.avail_out-=a,s.strm.total_out+=a,s.block_start+=a,r-=a),r&&(f0(s.strm,s.strm.output,s.strm.next_out,r),s.strm.next_out+=r,s.strm.avail_out-=r,s.strm.total_out+=r)}while(0===h);return p-=s.strm.avail_in,p&&(p>=s.w_size?(s.matches=2,s.window.set(s.strm.input.subarray(s.strm.next_in-s.w_size,s.strm.next_in),0),s.strstart=s.w_size,s.insert=s.strstart):(s.window_size-s.strstart<=p&&(s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,s.insert>s.strstart&&(s.insert=s.strstart)),s.window.set(s.strm.input.subarray(s.strm.next_in-p,s.strm.next_in),s.strstart),s.strstart+=p,s.insert+=p>s.w_size-s.insert?s.w_size-s.insert:p),s.block_start=s.strstart),s.high_water<s.strstart&&(s.high_water=s.strstart),h?4:i!==Kd&&i!==Hs&&0===s.strm.avail_in&&s.strstart===s.block_start?2:(d=s.window_size-s.strstart,s.strm.avail_in>d&&s.block_start>=s.w_size&&(s.block_start-=s.w_size,s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,d+=s.w_size,s.insert>s.strstart&&(s.insert=s.strstart)),d>s.strm.avail_in&&(d=s.strm.avail_in),d&&(f0(s.strm,s.window,s.strstart,d),s.strstart+=d,s.insert+=d>s.w_size-s.insert?s.w_size-s.insert:d),s.high_water<s.strstart&&(s.high_water=s.strstart),d=s.bi_valid+42>>3,d=s.pending_buf_size-d>65535?65535:s.pending_buf_size-d,l=d>s.w_size?s.w_size:d,a=s.strstart-s.block_start,(a>=l||(a||i===Hs)&&i!==Kd&&0===s.strm.avail_in&&a<=d)&&(r=a>d?d:a,h=i===Hs&&0===s.strm.avail_in&&r===a?1:0,c0(s,s.block_start,r,h),s.block_start+=r,$r(s.strm)),h?3:1)},m0=(s,i)=>{let r,a;for(;;){if(s.lookahead<Gs){if(bu(s),s.lookahead<Gs&&i===Kd)return 1;if(0===s.lookahead)break}if(r=0,s.lookahead>=3&&(s.ins_h=Yr(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),0!==r&&s.strstart-r<=s.w_size-Gs&&(s.match_length=U2(s,r)),s.match_length>=3)if(a=zd(s,s.strstart-s.match_start,s.match_length-3),s.lookahead-=s.match_length,s.match_length<=s.max_lazy_match&&s.lookahead>=3){s.match_length--;do{s.strstart++,s.ins_h=Yr(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart}while(0!=--s.match_length);s.strstart++}else s.strstart+=s.match_length,s.match_length=0,s.ins_h=s.window[s.strstart],s.ins_h=Yr(s,s.ins_h,s.window[s.strstart+1]);else a=zd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++;if(a&&(Vo(s,!1),0===s.strm.avail_out))return 1}return s.insert=s.strstart<2?s.strstart:2,i===Hs?(Vo(s,!0),0===s.strm.avail_out?3:4):s.sym_next&&(Vo(s,!1),0===s.strm.avail_out)?1:2},yu=(s,i)=>{let r,a,d;for(;;){if(s.lookahead<Gs){if(bu(s),s.lookahead<Gs&&i===Kd)return 1;if(0===s.lookahead)break}if(r=0,s.lookahead>=3&&(s.ins_h=Yr(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),s.prev_length=s.match_length,s.prev_match=s.match_start,s.match_length=2,0!==r&&s.prev_length<s.max_lazy_match&&s.strstart-r<=s.w_size-Gs&&(s.match_length=U2(s,r),s.match_length<=5&&(s.strategy===RN||3===s.match_length&&s.strstart-s.match_start>4096)&&(s.match_length=2)),s.prev_length>=3&&s.match_length<=s.prev_length){d=s.strstart+s.lookahead-3,a=zd(s,s.strstart-1-s.prev_match,s.prev_length-3),s.lookahead-=s.prev_length-1,s.prev_length-=2;do{++s.strstart<=d&&(s.ins_h=Yr(s,s.ins_h,s.window[s.strstart+3-1]),r=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart)}while(0!=--s.prev_length);if(s.match_available=0,s.match_length=2,s.strstart++,a&&(Vo(s,!1),0===s.strm.avail_out))return 1}else if(s.match_available){if(a=zd(s,0,s.window[s.strstart-1]),a&&Vo(s,!1),s.strstart++,s.lookahead--,0===s.strm.avail_out)return 1}else s.match_available=1,s.strstart++,s.lookahead--}return s.match_available&&(a=zd(s,0,s.window[s.strstart-1]),s.match_available=0),s.insert=s.strstart<2?s.strstart:2,i===Hs?(Vo(s,!0),0===s.strm.avail_out?3:4):s.sym_next&&(Vo(s,!1),0===s.strm.avail_out)?1:2};function Ka(s,i,r,a,d){this.good_length=s,this.max_lazy=i,this.nice_length=r,this.max_chain=a,this.func=d}const Zm=[new Ka(0,0,0,0,NN),new Ka(4,4,8,4,m0),new Ka(4,5,16,8,m0),new Ka(4,6,32,32,m0),new Ka(4,4,16,16,yu),new Ka(8,16,32,32,yu),new Ka(8,16,128,128,yu),new Ka(8,32,128,256,yu),new Ka(32,128,258,1024,yu),new Ka(32,258,258,4096,yu)];function qa(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Eu,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Kc(this.dyn_ltree),Kc(this.dyn_dtree),Kc(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Kc(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Kc(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const eg=s=>{if(!s)return 1;const i=s.state;return!i||i.strm!==s||42!==i.status&&57!==i.status&&69!==i.status&&73!==i.status&&91!==i.status&&103!==i.status&&113!==i.status&&666!==i.status?1:0},V2=s=>{if(eg(s))return vu(s,pa);s.total_in=s.total_out=0,s.data_type=DN;const i=s.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=2===i.wrap?57:i.wrap?42:113,s.adler=2===i.wrap?0:1,i.last_flush=-2,D2(i),xr},B2=s=>{const i=V2(s);var r;return i===xr&&((r=s.state).window_size=2*r.w_size,Kc(r.head),r.max_lazy_match=Zm[r.level].max_lazy,r.good_match=Zm[r.level].good_length,r.nice_match=Zm[r.level].nice_length,r.max_chain_length=Zm[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),i},PN=(s,i,r,a,d,l)=>{if(!s)return pa;let h=1;if(i===x2&&(i=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),d<1||d>9||r!==Eu||a<8||a>15||i<0||i>9||l<0||l>iB||8===a&&1!==h)return vu(s,pa);8===a&&(a=9);const p=new qa;return s.state=p,p.strm=s,p.status=42,p.wrap=h,p.gzhead=null,p.w_bits=a,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=d+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<d+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.sym_buf=p.lit_bufsize,p.sym_end=3*(p.lit_bufsize-1),p.level=i,p.strategy=l,p.method=r,B2(s)};var Ws={deflateInit:(s,i)=>PN(s,i,Eu,15,8,k2),deflateInit2:PN,deflateReset:B2,deflateResetKeep:V2,deflateSetHeader:(s,i)=>eg(s)||2!==s.state.wrap?pa:(s.state.gzhead=i,xr),deflate:(s,i)=>{if(eg(s)||i>IN||i<0)return s?vu(s,pa):pa;const r=s.state;if(!s.output||0!==s.avail_in&&!s.input||666===r.status&&i!==Hs)return vu(s,0===s.avail_out?l0:pa);const a=r.last_flush;if(r.last_flush=i,0!==r.pending){if($r(s),0===s.avail_out)return r.last_flush=-1,xr}else if(0===s.avail_in&&F2(i)<=F2(a)&&i!==Hs)return vu(s,l0);if(666===r.status&&0!==s.avail_in)return vu(s,l0);if(42===r.status&&0===r.wrap&&(r.status=113),42===r.status){let d=Eu+(r.w_bits-8<<4)<<8,l=-1;if(l=r.strategy>=Lv||r.level<2?0:r.level<6?1:6===r.level?2:3,d|=l<<6,0!==r.strstart&&(d|=32),d+=31-d%31,Qm(r,d),0!==r.strstart&&(Qm(r,s.adler>>>16),Qm(r,65535&s.adler)),s.adler=1,r.status=113,$r(s),0!==r.pending)return r.last_flush=-1,xr}if(57===r.status)if(s.adler=0,Xt(r,31),Xt(r,139),Xt(r,8),r.gzhead)Xt(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Xt(r,255&r.gzhead.time),Xt(r,r.gzhead.time>>8&255),Xt(r,r.gzhead.time>>16&255),Xt(r,r.gzhead.time>>24&255),Xt(r,9===r.level?2:r.strategy>=Lv||r.level<2?4:0),Xt(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Xt(r,255&r.gzhead.extra.length),Xt(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(s.adler=Cr(s.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(Xt(r,0),Xt(r,0),Xt(r,0),Xt(r,0),Xt(r,0),Xt(r,9===r.level?2:r.strategy>=Lv||r.level<2?4:0),Xt(r,3),r.status=113,$r(s),0!==r.pending)return r.last_flush=-1,xr;if(69===r.status){if(r.gzhead.extra){let d=r.pending,l=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+l>r.pending_buf_size;){let p=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+p),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>d&&(s.adler=Cr(s.adler,r.pending_buf,r.pending-d,d)),r.gzindex+=p,$r(s),0!==r.pending)return r.last_flush=-1,xr;d=0,l-=p}let h=new Uint8Array(r.gzhead.extra);r.pending_buf.set(h.subarray(r.gzindex,r.gzindex+l),r.pending),r.pending+=l,r.gzhead.hcrc&&r.pending>d&&(s.adler=Cr(s.adler,r.pending_buf,r.pending-d,d)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let d,l=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>l&&(s.adler=Cr(s.adler,r.pending_buf,r.pending-l,l)),$r(s),0!==r.pending)return r.last_flush=-1,xr;l=0}d=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Xt(r,d)}while(0!==d);r.gzhead.hcrc&&r.pending>l&&(s.adler=Cr(s.adler,r.pending_buf,r.pending-l,l)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let d,l=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>l&&(s.adler=Cr(s.adler,r.pending_buf,r.pending-l,l)),$r(s),0!==r.pending)return r.last_flush=-1,xr;l=0}d=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Xt(r,d)}while(0!==d);r.gzhead.hcrc&&r.pending>l&&(s.adler=Cr(s.adler,r.pending_buf,r.pending-l,l))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&($r(s),0!==r.pending))return r.last_flush=-1,xr;Xt(r,255&s.adler),Xt(r,s.adler>>8&255),s.adler=0}if(r.status=113,$r(s),0!==r.pending)return r.last_flush=-1,xr}if(0!==s.avail_in||0!==r.lookahead||i!==Kd&&666!==r.status){let d=0===r.level?NN(r,i):r.strategy===Lv?((l,h)=>{let p;for(;;){if(0===l.lookahead&&(bu(l),0===l.lookahead)){if(h===Kd)return 1;break}if(l.match_length=0,p=zd(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,p&&(Vo(l,!1),0===l.strm.avail_out))return 1}return l.insert=0,h===Hs?(Vo(l,!0),0===l.strm.avail_out?3:4):l.sym_next&&(Vo(l,!1),0===l.strm.avail_out)?1:2})(r,i):r.strategy===AN?((l,h)=>{let p,m,_,v;const b=l.window;for(;;){if(l.lookahead<=258){if(bu(l),l.lookahead<=258&&h===Kd)return 1;if(0===l.lookahead)break}if(l.match_length=0,l.lookahead>=3&&l.strstart>0&&(_=l.strstart-1,m=b[_],m===b[++_]&&m===b[++_]&&m===b[++_])){v=l.strstart+258;do{}while(m===b[++_]&&m===b[++_]&&m===b[++_]&&m===b[++_]&&m===b[++_]&&m===b[++_]&&m===b[++_]&&m===b[++_]&&_<v);l.match_length=258-(v-_),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=3?(p=zd(l,1,l.match_length-3),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(p=zd(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),p&&(Vo(l,!1),0===l.strm.avail_out))return 1}return l.insert=0,h===Hs?(Vo(l,!0),0===l.strm.avail_out?3:4):l.sym_next&&(Vo(l,!1),0===l.strm.avail_out)?1:2})(r,i):Zm[r.level].func(r,i);if(3!==d&&4!==d||(r.status=666),1===d||3===d)return 0===s.avail_out&&(r.last_flush=-1),xr;if(2===d&&(i===P2?N2(r):i!==IN&&(c0(r,0,0,!1),i===M2&&(Kc(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),$r(s),0===s.avail_out))return r.last_flush=-1,xr}return i!==Hs?xr:r.wrap<=0?wN:(2===r.wrap?(Xt(r,255&s.adler),Xt(r,s.adler>>8&255),Xt(r,s.adler>>16&255),Xt(r,s.adler>>24&255),Xt(r,255&s.total_in),Xt(r,s.total_in>>8&255),Xt(r,s.total_in>>16&255),Xt(r,s.total_in>>24&255)):(Qm(r,s.adler>>>16),Qm(r,65535&s.adler)),$r(s),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?xr:wN)},deflateEnd:s=>{if(eg(s))return pa;const i=s.state.status;return s.state=null,113===i?vu(s,d0):xr},deflateSetDictionary:(s,i)=>{let r=i.length;if(eg(s))return pa;const a=s.state,d=a.wrap;if(2===d||1===d&&42!==a.status||a.lookahead)return pa;if(1===d&&(s.adler=Xm(s.adler,i,r,0)),a.wrap=0,r>=a.w_size){0===d&&(Kc(a.head),a.strstart=0,a.block_start=0,a.insert=0);let m=new Uint8Array(a.w_size);m.set(i.subarray(r-a.w_size,r),0),i=m,r=a.w_size}const l=s.avail_in,h=s.next_in,p=s.input;for(s.avail_in=r,s.next_in=0,s.input=i,bu(a);a.lookahead>=3;){let m=a.strstart,_=a.lookahead-2;do{a.ins_h=Yr(a,a.ins_h,a.window[m+3-1]),a.prev[m&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=m,m++}while(--_);a.strstart=m,a.lookahead=2,bu(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,s.next_in=h,s.input=p,s.avail_in=l,a.wrap=d,xr},deflateInfo:"pako deflate (from Nodeca project)"};const xN=(s,i)=>Object.prototype.hasOwnProperty.call(s,i);var Fv={assign:function(s){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const r=i.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const a in r)xN(r,a)&&(s[a]=r[a])}}return s},flattenChunks:s=>{let i=0;for(let a=0,d=s.length;a<d;a++)i+=s[a].length;const r=new Uint8Array(i);for(let a=0,d=0,l=s.length;a<l;a++){let h=s[a];r.set(h,d),d+=h.length}return r}};let _0=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{_0=!1}const Rp=new Uint8Array(256);for(let s=0;s<256;s++)Rp[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;Rp[254]=Rp[254]=1;var tg={string2buf:s=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(s);let i,r,a,d,l,h=s.length,p=0;for(d=0;d<h;d++)r=s.charCodeAt(d),55296==(64512&r)&&d+1<h&&(a=s.charCodeAt(d+1),56320==(64512&a)&&(r=65536+(r-55296<<10)+(a-56320),d++)),p+=r<128?1:r<2048?2:r<65536?3:4;for(i=new Uint8Array(p),l=0,d=0;l<p;d++)r=s.charCodeAt(d),55296==(64512&r)&&d+1<h&&(a=s.charCodeAt(d+1),56320==(64512&a)&&(r=65536+(r-55296<<10)+(a-56320),d++)),r<128?i[l++]=r:r<2048?(i[l++]=192|r>>>6,i[l++]=128|63&r):r<65536?(i[l++]=224|r>>>12,i[l++]=128|r>>>6&63,i[l++]=128|63&r):(i[l++]=240|r>>>18,i[l++]=128|r>>>12&63,i[l++]=128|r>>>6&63,i[l++]=128|63&r);return i},buf2string:(s,i)=>{const r=i||s.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(s.subarray(0,i));let a,d;const l=new Array(2*r);for(d=0,a=0;a<r;){let h=s[a++];if(h<128){l[d++]=h;continue}let p=Rp[h];if(p>4)l[d++]=65533,a+=p-1;else{for(h&=2===p?31:3===p?15:7;p>1&&a<r;)h=h<<6|63&s[a++],p--;p>1?l[d++]=65533:h<65536?l[d++]=h:(h-=65536,l[d++]=55296|h>>10&1023,l[d++]=56320|1023&h)}}return((h,p)=>{if(p<65534&&h.subarray&&_0)return String.fromCharCode.apply(null,h.length===p?h:h.subarray(0,p));let m="";for(let _=0;_<p;_++)m+=String.fromCharCode(h[_]);return m})(l,d)},utf8border:(s,i)=>{(i=i||s.length)>s.length&&(i=s.length);let r=i-1;for(;r>=0&&128==(192&s[r]);)r--;return r<0||0===r?i:r+Rp[s[r]]>i?r:i}},Uv=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const j2=Object.prototype.toString,{Z_NO_FLUSH:H2,Z_SYNC_FLUSH:kN,Z_FULL_FLUSH:rB,Z_FINISH:oB,Z_OK:E0,Z_STREAM_END:sB,Z_DEFAULT_COMPRESSION:LN,Z_DEFAULT_STRATEGY:aB,Z_DEFLATED:cB}=Sp;function Vv(s){this.options=Fv.assign({level:LN,method:cB,chunkSize:16384,windowBits:15,memLevel:8,strategy:aB},s||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Uv,this.strm.avail_out=0;let r=Ws.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(r!==E0)throw new Error(Wd[r]);if(i.header&&Ws.deflateSetHeader(this.strm,i.header),i.dictionary){let a;if(a="string"==typeof i.dictionary?tg.string2buf(i.dictionary):"[object ArrayBuffer]"===j2.call(i.dictionary)?new Uint8Array(i.dictionary):i.dictionary,r=Ws.deflateSetDictionary(this.strm,a),r!==E0)throw new Error(Wd[r]);this._dict_set=!0}}function FN(s,i){const r=new Vv(i);if(r.push(s,!0),r.err)throw r.msg||Wd[r.err];return r.result}Vv.prototype.push=function(s,i){const r=this.strm,a=this.options.chunkSize;let d,l;if(this.ended)return!1;for(l=i===~~i?i:!0===i?oB:H2,r.input="string"==typeof s?tg.string2buf(s):"[object ArrayBuffer]"===j2.call(s)?new Uint8Array(s):s,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),(l===kN||l===rB)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(d=Ws.deflate(r,l),d===sB)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),d=Ws.deflateEnd(this.strm),this.onEnd(d),this.ended=!0,d===E0;if(0!==r.avail_out){if(l>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},Vv.prototype.onData=function(s){this.chunks.push(s)},Vv.prototype.onEnd=function(s){s===E0&&(this.result=Fv.flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};var dB={Deflate:Vv,deflate:FN,deflateRaw:function(s,i){return(i=i||{}).raw=!0,FN(s,i)},gzip:function(s,i){return(i=i||{}).gzip=!0,FN(s,i)},constants:Sp};const Bv=16209;var jv=function(s,i){let r,a,d,l,h,p,m,_,v,b,y,T,M,O,D,x,F,j,q,te,K,Q,$,z;const _e=s.state;r=s.next_in,$=s.input,a=r+(s.avail_in-5),d=s.next_out,z=s.output,l=d-(i-s.avail_out),h=d+(s.avail_out-257),p=_e.dmax,m=_e.wsize,_=_e.whave,v=_e.wnext,b=_e.window,y=_e.hold,T=_e.bits,M=_e.lencode,O=_e.distcode,D=(1<<_e.lenbits)-1,x=(1<<_e.distbits)-1;e:do{T<15&&(y+=$[r++]<<T,T+=8,y+=$[r++]<<T,T+=8),F=M[y&D];t:for(;;){if(j=F>>>24,y>>>=j,T-=j,j=F>>>16&255,0===j)z[d++]=65535&F;else{if(!(16&j)){if(!(64&j)){F=M[(65535&F)+(y&(1<<j)-1)];continue t}if(32&j){_e.mode=16191;break e}s.msg="invalid literal/length code",_e.mode=Bv;break e}q=65535&F,j&=15,j&&(T<j&&(y+=$[r++]<<T,T+=8),q+=y&(1<<j)-1,y>>>=j,T-=j),T<15&&(y+=$[r++]<<T,T+=8,y+=$[r++]<<T,T+=8),F=O[y&x];n:for(;;){if(j=F>>>24,y>>>=j,T-=j,j=F>>>16&255,!(16&j)){if(!(64&j)){F=O[(65535&F)+(y&(1<<j)-1)];continue n}s.msg="invalid distance code",_e.mode=Bv;break e}if(te=65535&F,j&=15,T<j&&(y+=$[r++]<<T,T+=8,T<j&&(y+=$[r++]<<T,T+=8)),te+=y&(1<<j)-1,te>p){s.msg="invalid distance too far back",_e.mode=Bv;break e}if(y>>>=j,T-=j,j=d-l,te>j){if(j=te-j,j>_&&_e.sane){s.msg="invalid distance too far back",_e.mode=Bv;break e}if(K=0,Q=b,0===v){if(K+=m-j,j<q){q-=j;do{z[d++]=b[K++]}while(--j);K=d-te,Q=z}}else if(v<j){if(K+=m+v-j,j-=v,j<q){q-=j;do{z[d++]=b[K++]}while(--j);if(K=0,v<q){j=v,q-=j;do{z[d++]=b[K++]}while(--j);K=d-te,Q=z}}}else if(K+=v-j,j<q){q-=j;do{z[d++]=b[K++]}while(--j);K=d-te,Q=z}for(;q>2;)z[d++]=Q[K++],z[d++]=Q[K++],z[d++]=Q[K++],q-=3;q&&(z[d++]=Q[K++],q>1&&(z[d++]=Q[K++]))}else{K=d-te;do{z[d++]=z[K++],z[d++]=z[K++],z[d++]=z[K++],q-=3}while(q>2);q&&(z[d++]=z[K++],q>1&&(z[d++]=z[K++]))}break}}break}}while(r<a&&d<h);q=T>>3,r-=q,T-=q<<3,y&=(1<<T)-1,s.next_in=r,s.next_out=d,s.avail_in=r<a?a-r+5:5-(r-a),s.avail_out=d<h?h-d+257:257-(d-h),_e.hold=y,_e.bits=T};const G2=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),UN=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Cu=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),VN=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Su=(s,i,r,a,d,l,h,p)=>{const m=p.bits;let _,v,b,y,T,M,O=0,D=0,x=0,F=0,j=0,q=0,te=0,K=0,Q=0,$=0,z=null;const _e=new Uint16Array(16),me=new Uint16Array(16);let Fe,rt,ci,Zt=null;for(O=0;O<=15;O++)_e[O]=0;for(D=0;D<a;D++)_e[i[r+D]]++;for(j=m,F=15;F>=1&&0===_e[F];F--);if(j>F&&(j=F),0===F)return d[l++]=20971520,d[l++]=20971520,p.bits=1,0;for(x=1;x<F&&0===_e[x];x++);for(j<x&&(j=x),K=1,O=1;O<=15;O++)if(K<<=1,K-=_e[O],K<0)return-1;if(K>0&&(0===s||1!==F))return-1;for(me[1]=0,O=1;O<15;O++)me[O+1]=me[O]+_e[O];for(D=0;D<a;D++)0!==i[r+D]&&(h[me[i[r+D]]++]=D);if(0===s?(z=Zt=h,M=20):1===s?(z=G2,Zt=UN,M=257):(z=Cu,Zt=VN,M=0),$=0,D=0,O=x,T=l,q=j,te=0,b=-1,Q=1<<j,y=Q-1,1===s&&Q>852||2===s&&Q>592)return 1;for(;;){Fe=O-te,h[D]+1<M?(rt=0,ci=h[D]):h[D]>=M?(rt=Zt[h[D]-M],ci=z[h[D]-M]):(rt=96,ci=0),_=1<<O-te,v=1<<q,x=v;do{v-=_,d[T+($>>te)+v]=Fe<<24|rt<<16|ci|0}while(0!==v);for(_=1<<O-1;$&_;)_>>=1;if(0!==_?($&=_-1,$+=_):$=0,D++,0==--_e[O]){if(O===F)break;O=i[r+h[D]]}if(O>j&&($&y)!==b){for(0===te&&(te=j),T+=x,q=O-te,K=1<<q;q+te<F&&(K-=_e[q+te],!(K<=0));)q++,K<<=1;if(Q+=1<<q,1===s&&Q>852||2===s&&Q>592)return 1;b=$&y,d[b]=j<<24|q<<16|T-l|0}}return 0!==$&&(d[T+$]=O-te<<24|64<<16|0),p.bits=j,0};const{Z_FINISH:Gv,Z_BLOCK:W2,Z_TREES:Ap,Z_OK:qc,Z_STREAM_END:Wv,Z_NEED_DICT:lB,Z_STREAM_ERROR:fa,Z_DATA_ERROR:z2,Z_MEM_ERROR:BN,Z_BUF_ERROR:K2,Z_DEFLATED:q2}=Sp,ki=16180,qd=16190,zs=16191,v0=16199,Kv=16200,Ti=16209,qv=s=>(s>>>24&255)+(s>>>8&65280)+((65280&s)<<8)+((255&s)<<24);function Y2(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Yd=s=>{if(!s)return 1;const i=s.state;return!i||i.strm!==s||i.mode<ki||i.mode>16211?1:0},b0=s=>{if(Yd(s))return fa;const i=s.state;return s.total_in=s.total_out=i.total=0,s.msg="",i.wrap&&(s.adler=1&i.wrap),i.mode=ki,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(852),i.distcode=i.distdyn=new Int32Array(592),i.sane=1,i.back=-1,qc},y0=s=>{if(Yd(s))return fa;const i=s.state;return i.wsize=0,i.whave=0,i.wnext=0,b0(s)},C0=(s,i)=>{let r;if(Yd(s))return fa;const a=s.state;return i<0?(r=0,i=-i):(r=5+(i>>4),i<48&&(i&=15)),i&&(i<8||i>15)?fa:(null!==a.window&&a.wbits!==i&&(a.window=null),a.wrap=r,a.wbits=i,y0(s))},HN=(s,i)=>{if(!s)return fa;const r=new Y2;s.state=r,r.strm=s,r.window=null,r.mode=ki;const a=C0(s,i);return a!==qc&&(s.state=null),a};let S0,Yv,GN=!0;const WN=s=>{if(GN){S0=new Int32Array(512),Yv=new Int32Array(32);let i=0;for(;i<144;)s.lens[i++]=8;for(;i<256;)s.lens[i++]=9;for(;i<280;)s.lens[i++]=7;for(;i<288;)s.lens[i++]=8;for(Su(1,s.lens,0,288,S0,0,s.work,{bits:9}),i=0;i<32;)s.lens[i++]=5;Su(2,s.lens,0,32,Yv,0,s.work,{bits:5}),GN=!1}s.lencode=S0,s.lenbits=9,s.distcode=Yv,s.distbits=5},ng=(s,i,r,a)=>{let d;const l=s.state;return null===l.window&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),a>=l.wsize?(l.window.set(i.subarray(r-l.wsize,r),0),l.wnext=0,l.whave=l.wsize):(d=l.wsize-l.wnext,d>a&&(d=a),l.window.set(i.subarray(r-a,r-a+d),l.wnext),(a-=d)?(l.window.set(i.subarray(r-a,r),0),l.wnext=a,l.whave=l.wsize):(l.wnext+=d,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=d))),0};var Bo={inflateReset:y0,inflateReset2:C0,inflateResetKeep:b0,inflateInit:s=>HN(s,15),inflateInit2:HN,inflate:(s,i)=>{let r,a,d,l,h,p,m,_,v,b,y,T,M,O,D,x,F,j,q,te,K,Q,$=0;const z=new Uint8Array(4);let _e,me;const Fe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Yd(s)||!s.output||!s.input&&0!==s.avail_in)return fa;r=s.state,r.mode===zs&&(r.mode=16192),h=s.next_out,d=s.output,m=s.avail_out,l=s.next_in,a=s.input,p=s.avail_in,_=r.hold,v=r.bits,b=p,y=m,Q=qc;e:for(;;)switch(r.mode){case ki:if(0===r.wrap){r.mode=16192;break}for(;v<16;){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}if(2&r.wrap&&35615===_){0===r.wbits&&(r.wbits=15),r.check=0,z[0]=255&_,z[1]=_>>>8&255,r.check=Cr(r.check,z,2,0),_=0,v=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&_)<<8)+(_>>8))%31){s.msg="incorrect header check",r.mode=Ti;break}if((15&_)!==q2){s.msg="unknown compression method",r.mode=Ti;break}if(_>>>=4,v-=4,K=8+(15&_),0===r.wbits&&(r.wbits=K),K>15||K>r.wbits){s.msg="invalid window size",r.mode=Ti;break}r.dmax=1<<r.wbits,r.flags=0,s.adler=r.check=1,r.mode=512&_?16189:zs,_=0,v=0;break;case 16181:for(;v<16;){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}if(r.flags=_,(255&r.flags)!==q2){s.msg="unknown compression method",r.mode=Ti;break}if(57344&r.flags){s.msg="unknown header flags set",r.mode=Ti;break}r.head&&(r.head.text=_>>8&1),512&r.flags&&4&r.wrap&&(z[0]=255&_,z[1]=_>>>8&255,r.check=Cr(r.check,z,2,0)),_=0,v=0,r.mode=16182;case 16182:for(;v<32;){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}r.head&&(r.head.time=_),512&r.flags&&4&r.wrap&&(z[0]=255&_,z[1]=_>>>8&255,z[2]=_>>>16&255,z[3]=_>>>24&255,r.check=Cr(r.check,z,4,0)),_=0,v=0,r.mode=16183;case 16183:for(;v<16;){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}r.head&&(r.head.xflags=255&_,r.head.os=_>>8),512&r.flags&&4&r.wrap&&(z[0]=255&_,z[1]=_>>>8&255,r.check=Cr(r.check,z,2,0)),_=0,v=0,r.mode=16184;case 16184:if(1024&r.flags){for(;v<16;){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}r.length=_,r.head&&(r.head.extra_len=_),512&r.flags&&4&r.wrap&&(z[0]=255&_,z[1]=_>>>8&255,r.check=Cr(r.check,z,2,0)),_=0,v=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(T=r.length,T>p&&(T=p),T&&(r.head&&(K=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(a.subarray(l,l+T),K)),512&r.flags&&4&r.wrap&&(r.check=Cr(r.check,a,T,l)),p-=T,l+=T,r.length-=T),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===p)break e;T=0;do{K=a[l+T++],r.head&&K&&r.length<65536&&(r.head.name+=String.fromCharCode(K))}while(K&&T<p);if(512&r.flags&&4&r.wrap&&(r.check=Cr(r.check,a,T,l)),p-=T,l+=T,K)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===p)break e;T=0;do{K=a[l+T++],r.head&&K&&r.length<65536&&(r.head.comment+=String.fromCharCode(K))}while(K&&T<p);if(512&r.flags&&4&r.wrap&&(r.check=Cr(r.check,a,T,l)),p-=T,l+=T,K)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;v<16;){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}if(4&r.wrap&&_!==(65535&r.check)){s.msg="header crc mismatch",r.mode=Ti;break}_=0,v=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),s.adler=r.check=0,r.mode=zs;break;case 16189:for(;v<32;){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}s.adler=r.check=qv(_),_=0,v=0,r.mode=qd;case qd:if(0===r.havedict)return s.next_out=h,s.avail_out=m,s.next_in=l,s.avail_in=p,r.hold=_,r.bits=v,lB;s.adler=r.check=1,r.mode=zs;case zs:if(i===W2||i===Ap)break e;case 16192:if(r.last){_>>>=7&v,v-=7&v,r.mode=16206;break}for(;v<3;){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}switch(r.last=1&_,_>>>=1,v-=1,3&_){case 0:r.mode=16193;break;case 1:if(WN(r),r.mode=v0,i===Ap){_>>>=2,v-=2;break e}break;case 2:r.mode=16196;break;case 3:s.msg="invalid block type",r.mode=Ti}_>>>=2,v-=2;break;case 16193:for(_>>>=7&v,v-=7&v;v<32;){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}if((65535&_)!=(_>>>16^65535)){s.msg="invalid stored block lengths",r.mode=Ti;break}if(r.length=65535&_,_=0,v=0,r.mode=16194,i===Ap)break e;case 16194:r.mode=16195;case 16195:if(T=r.length,T){if(T>p&&(T=p),T>m&&(T=m),0===T)break e;d.set(a.subarray(l,l+T),h),p-=T,l+=T,m-=T,h+=T,r.length-=T;break}r.mode=zs;break;case 16196:for(;v<14;){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}if(r.nlen=257+(31&_),_>>>=5,v-=5,r.ndist=1+(31&_),_>>>=5,v-=5,r.ncode=4+(15&_),_>>>=4,v-=4,r.nlen>286||r.ndist>30){s.msg="too many length or distance symbols",r.mode=Ti;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;v<3;){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}r.lens[Fe[r.have++]]=7&_,_>>>=3,v-=3}for(;r.have<19;)r.lens[Fe[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,_e={bits:r.lenbits},Q=Su(0,r.lens,0,19,r.lencode,0,r.work,_e),r.lenbits=_e.bits,Q){s.msg="invalid code lengths set",r.mode=Ti;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;$=r.lencode[_&(1<<r.lenbits)-1],D=$>>>24,x=$>>>16&255,F=65535&$,!(D<=v);){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}if(F<16)_>>>=D,v-=D,r.lens[r.have++]=F;else{if(16===F){for(me=D+2;v<me;){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}if(_>>>=D,v-=D,0===r.have){s.msg="invalid bit length repeat",r.mode=Ti;break}K=r.lens[r.have-1],T=3+(3&_),_>>>=2,v-=2}else if(17===F){for(me=D+3;v<me;){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}_>>>=D,v-=D,K=0,T=3+(7&_),_>>>=3,v-=3}else{for(me=D+7;v<me;){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}_>>>=D,v-=D,K=0,T=11+(127&_),_>>>=7,v-=7}if(r.have+T>r.nlen+r.ndist){s.msg="invalid bit length repeat",r.mode=Ti;break}for(;T--;)r.lens[r.have++]=K}}if(r.mode===Ti)break;if(0===r.lens[256]){s.msg="invalid code -- missing end-of-block",r.mode=Ti;break}if(r.lenbits=9,_e={bits:r.lenbits},Q=Su(1,r.lens,0,r.nlen,r.lencode,0,r.work,_e),r.lenbits=_e.bits,Q){s.msg="invalid literal/lengths set",r.mode=Ti;break}if(r.distbits=6,r.distcode=r.distdyn,_e={bits:r.distbits},Q=Su(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,_e),r.distbits=_e.bits,Q){s.msg="invalid distances set",r.mode=Ti;break}if(r.mode=v0,i===Ap)break e;case v0:r.mode=Kv;case Kv:if(p>=6&&m>=258){s.next_out=h,s.avail_out=m,s.next_in=l,s.avail_in=p,r.hold=_,r.bits=v,jv(s,y),h=s.next_out,d=s.output,m=s.avail_out,l=s.next_in,a=s.input,p=s.avail_in,_=r.hold,v=r.bits,r.mode===zs&&(r.back=-1);break}for(r.back=0;$=r.lencode[_&(1<<r.lenbits)-1],D=$>>>24,x=$>>>16&255,F=65535&$,!(D<=v);){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}if(x&&!(240&x)){for(j=D,q=x,te=F;$=r.lencode[te+((_&(1<<j+q)-1)>>j)],D=$>>>24,x=$>>>16&255,F=65535&$,!(j+D<=v);){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}_>>>=j,v-=j,r.back+=j}if(_>>>=D,v-=D,r.back+=D,r.length=F,0===x){r.mode=16205;break}if(32&x){r.back=-1,r.mode=zs;break}if(64&x){s.msg="invalid literal/length code",r.mode=Ti;break}r.extra=15&x,r.mode=16201;case 16201:if(r.extra){for(me=r.extra;v<me;){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}r.length+=_&(1<<r.extra)-1,_>>>=r.extra,v-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;$=r.distcode[_&(1<<r.distbits)-1],D=$>>>24,x=$>>>16&255,F=65535&$,!(D<=v);){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}if(!(240&x)){for(j=D,q=x,te=F;$=r.distcode[te+((_&(1<<j+q)-1)>>j)],D=$>>>24,x=$>>>16&255,F=65535&$,!(j+D<=v);){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}_>>>=j,v-=j,r.back+=j}if(_>>>=D,v-=D,r.back+=D,64&x){s.msg="invalid distance code",r.mode=Ti;break}r.offset=F,r.extra=15&x,r.mode=16203;case 16203:if(r.extra){for(me=r.extra;v<me;){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}r.offset+=_&(1<<r.extra)-1,_>>>=r.extra,v-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){s.msg="invalid distance too far back",r.mode=Ti;break}r.mode=16204;case 16204:if(0===m)break e;if(T=y-m,r.offset>T){if(T=r.offset-T,T>r.whave&&r.sane){s.msg="invalid distance too far back",r.mode=Ti;break}T>r.wnext?(T-=r.wnext,M=r.wsize-T):M=r.wnext-T,T>r.length&&(T=r.length),O=r.window}else O=d,M=h-r.offset,T=r.length;T>m&&(T=m),m-=T,r.length-=T;do{d[h++]=O[M++]}while(--T);0===r.length&&(r.mode=Kv);break;case 16205:if(0===m)break e;d[h++]=r.length,m--,r.mode=Kv;break;case 16206:if(r.wrap){for(;v<32;){if(0===p)break e;p--,_|=a[l++]<<v,v+=8}if(y-=m,s.total_out+=y,r.total+=y,4&r.wrap&&y&&(s.adler=r.check=r.flags?Cr(r.check,d,y,h-y):Xm(r.check,d,y,h-y)),y=m,4&r.wrap&&(r.flags?_:qv(_))!==r.check){s.msg="incorrect data check",r.mode=Ti;break}_=0,v=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;v<32;){if(0===p)break e;p--,_+=a[l++]<<v,v+=8}if(4&r.wrap&&_!==(4294967295&r.total)){s.msg="incorrect length check",r.mode=Ti;break}_=0,v=0}r.mode=16208;case 16208:Q=Wv;break e;case Ti:Q=z2;break e;case 16210:return BN;default:return fa}return s.next_out=h,s.avail_out=m,s.next_in=l,s.avail_in=p,r.hold=_,r.bits=v,(r.wsize||y!==s.avail_out&&r.mode<Ti&&(r.mode<16206||i!==Gv))&&ng(s,s.output,s.next_out,y-s.avail_out),b-=s.avail_in,y-=s.avail_out,s.total_in+=b,s.total_out+=y,r.total+=y,4&r.wrap&&y&&(s.adler=r.check=r.flags?Cr(r.check,d,y,s.next_out-y):Xm(r.check,d,y,s.next_out-y)),s.data_type=r.bits+(r.last?64:0)+(r.mode===zs?128:0)+(r.mode===v0||16194===r.mode?256:0),(0===b&&0===y||i===Gv)&&Q===qc&&(Q=K2),Q},inflateEnd:s=>{if(Yd(s))return fa;let i=s.state;return i.window&&(i.window=null),s.state=null,qc},inflateGetHeader:(s,i)=>{if(Yd(s))return fa;const r=s.state;return 2&r.wrap?(r.head=i,i.done=!1,qc):fa},inflateSetDictionary:(s,i)=>{const r=i.length;let a,d,l;return Yd(s)?fa:(a=s.state,0!==a.wrap&&a.mode!==qd?fa:a.mode===qd&&(d=1,d=Xm(d,i,r,0),d!==a.check)?z2:(l=ng(s,i,r,r),l?(a.mode=16210,BN):(a.havedict=1,qc)))},inflateInfo:"pako inflate (from Nodeca project)"},zN=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const $2=Object.prototype.toString,{Z_NO_FLUSH:uB,Z_FINISH:hB,Z_OK:rg,Z_STREAM_END:T0,Z_NEED_DICT:KN,Z_STREAM_ERROR:qN,Z_DATA_ERROR:I0,Z_MEM_ERROR:pB}=Sp;function Tu(s){this.options=Fv.assign({chunkSize:65536,windowBits:15,to:""},s||{});const i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,0===i.windowBits&&(i.windowBits=-15)),!(i.windowBits>=0&&i.windowBits<16)||s&&s.windowBits||(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&!(15&i.windowBits)&&(i.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Uv,this.strm.avail_out=0;let r=Bo.inflateInit2(this.strm,i.windowBits);if(r!==rg)throw new Error(Wd[r]);if(this.header=new zN,Bo.inflateGetHeader(this.strm,this.header),i.dictionary&&("string"==typeof i.dictionary?i.dictionary=tg.string2buf(i.dictionary):"[object ArrayBuffer]"===$2.call(i.dictionary)&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(r=Bo.inflateSetDictionary(this.strm,i.dictionary),r!==rg)))throw new Error(Wd[r])}function YN(s,i){const r=new Tu(i);if(r.push(s),r.err)throw r.msg||Wd[r.err];return r.result}Tu.prototype.push=function(s,i){const r=this.strm,a=this.options.chunkSize,d=this.options.dictionary;let l,h,p;if(this.ended)return!1;for(h=i===~~i?i:!0===i?hB:uB,r.input="[object ArrayBuffer]"===$2.call(s)?new Uint8Array(s):s,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(a),r.next_out=0,r.avail_out=a),l=Bo.inflate(r,h),l===KN&&d&&(l=Bo.inflateSetDictionary(r,d),l===rg?l=Bo.inflate(r,h):l===I0&&(l=KN));r.avail_in>0&&l===T0&&r.state.wrap>0&&0!==s[r.next_in];)Bo.inflateReset(r),l=Bo.inflate(r,h);switch(l){case qN:case I0:case KN:case pB:return this.onEnd(l),this.ended=!0,!1}if(p=r.avail_out,r.next_out&&(0===r.avail_out||l===T0))if("string"===this.options.to){let m=tg.utf8border(r.output,r.next_out),_=r.next_out-m,v=tg.buf2string(r.output,m);r.next_out=_,r.avail_out=a-_,_&&r.output.set(r.output.subarray(m,m+_),0),this.onData(v)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(l!==rg||0!==p){if(l===T0)return l=Bo.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},Tu.prototype.onData=function(s){this.chunks.push(s)},Tu.prototype.onEnd=function(s){s===rg&&(this.result="string"===this.options.to?this.chunks.join(""):Fv.flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};var fB={Inflate:Tu,inflate:YN,inflateRaw:function(s,i){return(i=i||{}).raw=!0,YN(s,i)},ungzip:YN,constants:Sp};const{deflate:X2}=dB,{inflate:_B}=fB;var $N,Q2=X2,XN=_B;!function(s){s[s.ONE_BYTE=0]="ONE_BYTE",s[s.TWO_BYTE=1]="TWO_BYTE"}($N||($N={}));class vB{constructor(){S(this,"_sequence",0),S(this,"_startTime",Date.now()),S(this,"isUseOneByte",!0)}get startTime(){const i=Date.now()-this._startTime;return i<Math.pow(2,16)?i:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(i){const r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:i};if(i.byteLength>128){const p=new Uint8Array(4);p.set([1,0,0,0]);const _={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[{id:0,length:4,data:p.buffer}]};r.commonPacketHeader.extension=1,r.extension=_,r.payload=this.compress(i),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;V("SHOW_DATASTREAM2_LOG")&&I.debug("send data header: ".concat(JSON.stringify(r.commonPacketHeader)));const a=new ArrayBuffer(r.commonPacketHeader.length),d=new Uint8Array(a),l=new DataView(a);let h=0;if(l.setUint16(h,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),h+=2,l.setUint32(h,r.commonPacketHeader.sequence,!0),h+=4,l.setUint16(h,r.commonStreamHeader,!0),h+=2,r.extension){const p=this.serializeExtension(r.extension);d.set(new Uint8Array(p),h),h+=p.byteLength}if(d.set(new Uint8Array(r.payload),h),h+=r.payload.byteLength,h!==r.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(i){if(i.byteLength<4)return new ArrayBuffer(0);const r=new DataView(i);let a=0;const d=r.getUint16(a,!0);a+=2;const l={length:16383&d,reserved:(16384&d)>>14,extension:(32768&d)>>15,sequence:r.getUint16(a+2,!0)<<16|r.getUint16(a,!0)};let h,p;if(a+=4,V("SHOW_DATASTREAM2_LOG")&&I.debug("receive data header: ".concat(JSON.stringify(l))),r.getUint16(a,!0),a+=2,l.extension){p=this.deserializeExtension(i.slice(a)),a+=2+p.length,h=i.slice(a);let m=!1;if(p.datas.length>0){const _=p.datas.find(v=>0===v.id);_&&(m=1==(1&new DataView(_.data).getUint32(0,!0)))}h=m?this.decompress(h):h}else h=i.slice(8);return h}serializeExtension(i){const{profile:r,length:a,datas:d}=i,l=new ArrayBuffer(a+2),h=new Uint8Array(l),p=new DataView(l);let m=0;if(p.setUint8(m++,r),p.setUint8(m++,a),d.forEach(_=>{r?(p.setUint8(m++,_.id),p.setUint8(m++,_.length),h.set(new Uint8Array(_.data),m),m+=_.data.byteLength):(p.setUint8(m++,_.id|_.length<<4),h.set(new Uint8Array(_.data),m),m+=_.data.byteLength)}),m!==a+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(a+2));return l}deserializeExtension(i){const r=new DataView(i);let a=0;const d=r.getUint8(a);a++;const l=r.getUint8(a);a++;const h=d===$N.TWO_BYTE,p=[],m=new DataView(i,2);let _=0;for(;_<l;){let v=0,b=0,y=new ArrayBuffer(0);h?(v=m.getUint8(_),_++,b=m.getUint8(_),_++):(v=15&m.getUint8(_),b=m.getUint8(_)>>4,_++),b>0&&(y=m.buffer.slice(_+2,_+2+b),_+=y.byteLength),p.push({id:v,length:b,data:y})}if(_!==l)throw Error("parse error");return{profile:d,length:l,datas:p}}decompress(i){return XN(new Uint8Array(i))}compress(i){return Q2(new Uint8Array(i))}}class JN extends jt{constructor(i,r){super(),S(this,"_version",1),S(this,"_type",3),S(this,"_config",void 0),S(this,"_originDataChannel",void 0),S(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),S(this,"_dataStreamPacketHandler",void 0),S(this,"_datachannelEventMap",new Map),this._config=i,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader(),this._dataStreamPacketHandler=new vB}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return V("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var i,r;return null!==(i=null===(r=this._originDataChannel)||void 0===r?void 0:r.readyState)&&void 0!==i?i:"connecting"}get _originDataChannelId(){var i,r;return null!==(i=null===(r=this._originDataChannel)||void 0===r?void 0:r.id)&&void 0!==i?i:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}_waitTillOpen(){var i=this;return L(function*(){return new X((r,a)=>{if(i._originDataChannel){"open"===i._originDataChannel.readyState&&r();const d=setTimeout(()=>{var l;a(new ee(k.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(l=i._originDataChannel)||void 0===l?void 0:l.id)))},1e4);i._originDataChannel.onopen=()=>{clearTimeout(d),i._originDataChannel&&i._bandDataChannelEvents(i._originDataChannel),r()},i._originDataChannel.onerror=()=>{throw clearTimeout(d),new ee(k.DATACHANNEL_CONNECTION_TIMEOUT)}}else a(new ee(k.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})})()}_updateOriginDataChannel(i){this._originDataChannel=i,this._bandDataChannelEvents(i)}_initPacketHeader(){const i=new DataView(this._dataStreamPacketHeader);i.setUint16(0,this._version),i.setUint8(2,this._type),i.setUint8(3,this._config.id)}_bandDataChannelEvents(i){this._unbindDataChannelEvents(i),[fp.OPEN,fp.CLOSE,fp.ERROR].forEach(r=>{const a=()=>{this.emit(r)};this._datachannelEventMap.set(r,a),i.addEventListener(r,a)})}_unbindDataChannelEvents(i){Array.from(this._datachannelEventMap.entries()).forEach(r=>{let[a,d]=r;i.removeEventListener(a,d)}),this._datachannelEventMap.clear()}}class Z2 extends JN{constructor(i){super(i),S(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=r.data.slice(0,this._dataStreamPacketHeader.byteLength),d=new DataView(a).getUint8(3);if(d!==this.id)return void(V("SHOW_DATASTREAM2_LOG")&&I.debug("invalid datachannel id: ".concat(d," !== ").concat(this.id)));let l=r.data.slice(this._dataStreamPacketHeader.byteLength);l=this._dataStreamPacketHandler.deserialize(l),this.emit(fp.MESSAGE,l)}}_updateOriginDataChannel(i){super._updateOriginDataChannel(i),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class eF extends JN{send(i){if(this._originDataChannel){let r=i;r=this._dataStreamPacketHandler.serialize(i);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}!function(){const s=lt();Ui.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ui.getStreamFromExtension=s.name===Et.CHROME&&Number(s.version)>34,Ui.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const i=new RTCPeerConnection;let r=!1;try{i.addTransceiver("audio"),r=!0}catch{}return i.close(),r}(),Ui.supportMinBitrate=s.name===Et.CHROME||s.name===Et.EDGE,Ui.supportSetRtpSenderParameters=function(){const i=lt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!wd()||!(!fr()&&!LE())||i.name===Et.FIREFOX&&Number(i.version)>=64)}(),s.name===Et.SAFARI&&(Ui.supportDualStream=Number(s.version)>=14),Ui.webAudioMediaStreamDest=function(){const i=lt();return!(i.name===Et.SAFARI&&Number(i.version)<12)}(),Ui.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,Ui.supportWebGL=typeof WebGLRenderingContext<"u",Ui.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,wd()||(Ui.webAudioWithAEC=!0),Ui.supportShareAudio=function(){const i=lt();return(i.os===ei.WIN_10||i.os===ei.WIN_81||i.os===ei.WIN_7||i.os===ei.LINUX||i.os===ei.MAC_OS||i.os===ei.CHROMIUM_OS)&&i.name===Et.CHROME&&Number(i.version)>=74}(),Ui.supportDataChannel=!!(im(76)||function(i){const r=lt();return!(r.name!==Et.FIREFOX||!r.osVersion)&&Number(r.version)>=68}()||function(i){const r=lt();return!(r.name!==Et.SAFARI||!r.osVersion)&&Number(r.version)>=14}()),Ui.supportPCSetConfiguration=function(){const i=window.RTCPeerConnection;return!Pt()&&!!i&&i.prototype.setConfiguration instanceof Function}(),Ui.supportWebRTCEncodedTransform=function(){const i=lt();return"Chrome"===i.name&&Number(i.version)>=86}(),Ui.supportWebRTCInsertableStream=function(){const i=lt();return(i.name===Et.CHROME||i.name===Et.EDGE)&&Number(i.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),am(()=>{Ui.supportDualStreamEncoding=function(){const i=lt();return!!V("DISABLE_WEBAUDIO")||"Safari"===i.name&&Number(i.version)>=14||!!("Chrome"===i.name&&/Windows/i.test(i.os||"")&&Number(i.version)>=100&&V("CHROME_DUAL_STREAM_USE_ENCODING"))}(),I.info("browser compatibility",JSON.stringify(Ui),JSON.stringify(s))})}();class tF extends jt{constructor(){super(...arguments),S(this,"resultStorage",new Map)}setLocalAudioStats(i,r,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",i,this.checkAudioInputLevel(a,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",i,this.checkSendAudioBitrate(a,r))}setLocalVideoStats(i,r,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",i,this.checkSendVideoBitrate(a,r)),this.record("FRAMERATE_INPUT_TOO_LOW",i,this.checkFramerateInput(a,r)),this.record("FRAMERATE_SENT_TOO_LOW",i,this.checkFramerateSent(a))}setRemoteAudioStats(i,r){const a=i.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(r))}setRemoteVideoStats(i,r){const a=i.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(r))}record(i,r,a){if(V("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(i)||this.resultStorage.set(i,{result:[],isPrevNormal:!0});const d=this.resultStorage.get(i);if(d&&(d.result.push(a),d.result.length>=5)){var l;const h=ye(l=d.result).call(l,!0);d.isPrevNormal&&!h&&this.emit("exception",nF[i],i,r),!d.isPrevNormal&&h&&this.emit("exception",nF[i]+2e3,i+"_RECOVER",r),d.isPrevNormal=h,d.result=[]}}checkAudioOutputLevel(i){return!(i.receiveBitrate>0&&0===i.receiveLevel)}checkAudioInputLevel(i,r){return r instanceof jn&&!r.isActive||!!r.muted||0!==i.sendVolumeLevel}checkFramerateInput(i,r){let a=null;r._encoderConfig&&r._encoderConfig.frameRate&&(a=Po(r._encoderConfig.frameRate));const d=i.captureFrameRate;return!a||!d||!(a>10&&d<5||a<10&&a>=5&&d<=1)}checkFramerateSent(i){return!(i.captureFrameRate&&i.sendFrameRate&&i.captureFrameRate>5&&i.sendFrameRate<=1)}checkSendVideoBitrate(i,r){return!!r.muted||0!==i.sendBitrate}checkSendAudioBitrate(i,r){return r instanceof jn&&!r.isActive||!!r.muted||0!==i.sendBitrate}checkVideoDecode(i){return 0===i.receiveBitrate||0!==i.decodeFrameRate}}const nF={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Li=new class{markSubscribeStart(s,i){performance.mark("agora-web-sdk/".concat(s,"/subscribe-").concat(i))}markPublishStart(s,i){performance.mark("agora-web-sdk/".concat(s,"/publish-").concat(i))}measureFromSubscribeStart(s,i){const r=performance.getEntriesByName("agora-web-sdk/".concat(s,"/subscribe-").concat(i));if(r.length>0){const a=r[r.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(s,i){const r=performance.getEntriesByName("agora-web-sdk/".concat(s,"/publish-").concat(i));if(r.length>0){const a=r[r.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function w0(s,i){this.v=s,this.k=i}function Be(s){return new w0(s,0)}var QN=pD,ZN=Ni;Bt({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var s=ZN.f(this);return{promise:s.promise,resolve:s.resolve,reject:s.reject}}});var iF=Ni,eP=ka;Bt({target:"Promise",stat:!0,forced:!0},{try:function(s){var i=iF.f(this),r=eP(s);return(r.error?i.reject:i.resolve)(r.value),i.promise}});var $v=Rt(QN),rF=ta.f("asyncIterator"),oF=Rt(rF);function $d(s){var i,r;function a(l,h){try{var p=s[l](h),m=p.value,_=m instanceof w0;$v.resolve(_?m.v:m).then(function(v){if(_){var b="return"===l?"return":"next";if(!m.k||v.done)return a(b,v);v=s[b](v).value}d(p.done?"return":"normal",v)},function(v){a("throw",v)})}catch(v){d("throw",v)}}function d(l,h){switch(l){case"return":i.resolve({value:h,done:!0});break;case"throw":i.reject(h);break;default:i.resolve({value:h,done:!1})}(i=i.next)?a(i.key,i.arg):r=null}this._invoke=function(l,h){return new $v(function(p,m){var _={key:l,arg:h,resolve:p,reject:m,next:null};r?r=r.next=_:(i=r=_,a(l,h))})},"function"!=typeof s.return&&(this.return=void 0)}function Xr(s){return function(){return new $d(s.apply(this,arguments))}}$d.prototype["function"==typeof Ls&&oF||"@@asyncIterator"]=function(){return this},$d.prototype.next=function(s){return this._invoke("next",s)},$d.prototype.throw=function(s){return this._invoke("throw",s)},$d.prototype.return=function(s){return this._invoke("return",s)};var R0=Rt(Os.Object.getOwnPropertySymbols),sF=Bt,aF=Zg.indexOf,Xv=aE,A0=cc([].indexOf),tP=!!A0&&1/A0([1],1,-0)<0;sF({target:"Array",proto:!0,forced:tP||!Xv("indexOf")},{indexOf:function(s){var i=arguments.length>1?arguments[1]:void 0;return tP?A0(this,s,i)||0:aF(this,s,i)}});var nP=uc("Array").indexOf,bB=Ds,cF=nP,iP=Array.prototype,rP=Rt(function(s){var i=s.indexOf;return s===iP||bB(iP,s)&&i===iP.indexOf?cF:i}),yB=_l,dF=hf;Bt({target:"Object",stat:!0,forced:cn(function(){dF(1)})},{keys:function(s){return dF(yB(s))}});var lF=Rt(Os.Object.keys);var oP={exports:{}};!function(s,i){s.exports=(()=>{var r={8:(l,h,p)=>{p.r(h),p.d(h,{Parser:()=>me,Printer:()=>Fi,parse:()=>ke,print:()=>ht});const m="\n",_="".concat("\r").concat(m),v=" ";let b;function y(pe){return pe>="0"&&pe<="9"}function T(pe){return pe>="!"&&pe<="~"}function M(pe){return T(pe)||pe>="\x80"&&pe<="\xff"}function O(pe){return"!"===pe||pe>="#"&&pe<="'"||pe>="*"&&pe<="+"||pe>="-"&&pe<="."||pe>="0"&&pe<="9"||pe>="A"&&pe<="Z"||pe>="^"&&pe<="~"}function D(pe){return pe>="1"&&pe<="9"}function x(pe){return pe>="A"&&pe<="Z"||pe>="a"&&pe<="z"}function F(pe){return"d"===pe||"h"===pe||"m"===pe||"s"===pe}function j(pe){return pe>"\x01"&&pe<"\t"||pe>"\v"&&pe<"\f"||pe>"\x0e"&&pe<"\xff"}function q(pe){return x(pe)||y(pe)||"+"===pe||"/"===pe}function te(pe){return y(pe)||x(pe)||"+"===pe||"/"===pe||"-"===pe||"_"===pe}function K(pe){return x(pe)||y(pe)||"+"===pe||"/"===pe}function Q(pe,w){var U=Object.keys(pe);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(pe);w&&(H=H.filter(function(se){return Object.getOwnPropertyDescriptor(pe,se).enumerable})),U.push.apply(U,H)}return U}function $(pe){for(var w=1;w<arguments.length;w++){var U=null!=arguments[w]?arguments[w]:{};w%2?Q(Object(U),!0).forEach(function(H){z(pe,H,U[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(pe,Object.getOwnPropertyDescriptors(U)):Q(Object(U)).forEach(function(H){Object.defineProperty(pe,H,Object.getOwnPropertyDescriptor(U,H))})}return pe}function z(pe,w,U){return w in pe?Object.defineProperty(pe,w,{value:U,enumerable:!0,configurable:!0,writable:!0}):pe[w]=U,pe}var pe;(pe=b||(b={})).VERSION="v",pe.ORIGIN="o",pe.SESSION_NAME="s",pe.INFORMATION="i",pe.URI="u",pe.EMAIL="e",pe.PHONE="p",pe.CONNECTION="c",pe.BANDWIDTH="b",pe.TIME="t",pe.REPEAT="r",pe.ZONE_ADJUSTMENTS="z",pe.KEY="k",pe.ATTRIBUTE="a",pe.MEDIA="m";class _e{consumeText(w,U){let H=U;for(;H<w.length;){const se=w[H];if("\0"===se||"\r"===se||se===m)break;H+=1}if(H-U==0)throw new Error("Invalid text, at ".concat(w));return H}consumeUnicastAddress(w,U,H){return this.consumeTill(w,U,v)}consumeOneOrMore(w,U,H){let se=U;for(;H(w[se]);)se++;if(se-U==0)throw new Error("Invalid rule at ".concat(U,"."));return se}consumeSpace(w,U){if(w[U]===v)return U+1;throw new Error("Invalid space at ".concat(U,"."))}consumeIP4Address(w,U){let H=U;for(let se=0;se<4;se++)if(H=this.consumeDecimalUChar(w,H),3!==se){if("."!==w[H])throw new Error("Invalid IP4 address.");H++}return H}consumeDecimalUChar(w,U){let H=U;for(let Ue=0;Ue<3&&y(w[H]);Ue++,H++);if(H-U==0)throw new Error("Invalid decimal uchar.");const se=parseInt(w.slice(U,H));if(se>=0&&se<=255)return H;throw new Error("Invalid decimal uchar")}consumeIP6Address(w,U){let H=this.consumeHexpart(w,U);return":"===w[H]&&(H+=1,H=this.consumeIP4Address(w,H)),H}consumeHexpart(w,U){let H=U;if(":"===w[H]&&":"===w[H+1]){H+=2;try{H=this.consumeHexseq(w,H)}catch{}return H}if(H=this.consumeHexseq(w,H),":"===w[H]&&":"===w[H+1]){H+=2;try{H=this.consumeHexseq(w,H)}catch{}return H}return H}consumeHexseq(w,U){let H=U;for(;H=this.consumeHex4(w,H),":"===w[H]&&":"!==w[H+1];)H+=1;return H}consumeHex4(w,U){let H=0;for(;H<4;H++)if(!((se=w[U+H])>="0"&&se<="9"||se>="a"&&se<="f"||se>="A"&&se<="F")){if(0===H)throw new Error("Invalid hex 4");break}var se;return U+H}consumeFQDN(w,U){let H=U;for(;y(w[H])||x(w[H])||"-"===w[H]||"."===w[H];)H+=1;if(H-U<4)throw new Error("Invalid FQDN");return H}consumeExtnAddr(w,U){return this.consumeOneOrMore(w,U,M)}consumeMulticastAddress(w,U,H){switch(H){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(w,U);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(w,U);default:try{return this.consumeFQDN(w,U)}catch{return this.consumeExtnAddr(w,U)}}}consumeIP6MulticastAddress(w,U){const H=this.consumeHexpart(w,U);return"/"===w[H]?this.consumeInteger(w,H+1):H}consumeIP4MulticastAddress(w,U){let H=U+3;const se=w.slice(U,H),Ue=parseInt(se);if(Ue<224||Ue>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Wt=0;Wt<3;Wt++){if("."!==w[H])throw new Error("Invalid IP4 multicast address.");H+=1,H=this.consumeDecimalUChar(w,H)}return"/"===w[H]&&(H+=1),H=this.consumeTTL(w,H),"/"===w[H]&&(H=this.consumeInteger(w,H)),H}consumeInteger(w,U){if(!D(w[U]))throw new Error("Invalid integer.");for(U+=1;y(w[U]);)U+=1;return U}consumeTTL(w,U){if("0"===w[U])return U+1;if(!D(w[U]))throw new Error("Invalid TTL.");U+=1;for(let H=0;H<2&&y(w[U]);H++)U+=1;return U}consumeToken(w,U){return this.consumeOneOrMore(w,U,O)}consumeTime(w,U){let H=U;if("0"===w[H])return H+1;for(D(w[H])&&(H+=1);y(w[H]);)H++;if(H-U<10)throw new Error("Invalid time");return H}consumeAddress(w,U){return this.consumeTill(w,U,v)}consumeTypedTime(w,U){let H=U;return H=this.consumeOneOrMore(w,H,y),F(w[H])?H+1:H}consumeRepeatInterval(w,U){if(!D(w[U]))throw new Error("Invalid repeat interval");for(U+=1;y(w[U]);)U+=1;return F(w[U])&&(U+=1),U}consumePort(w,U){return this.consumeOneOrMore(w,U,y)}consume(w,U,H){for(let se=0;se<H.length;se++){if(U+se>=w.length)throw new Error("consume exceeding value length");if(w[U+se]!==H[se])throw new Error("consume ".concat(H," failed at ").concat(se))}return U+H.length}consumeTill(w,U,H){let se=U;for(;se<w.length&&("string"!=typeof H||w[se]!==H)&&("function"!=typeof H||!H(w[se]));)se++;return se}}class me extends _e{constructor(){super(),z(this,"records",[]),z(this,"currentLine",0)}parse(w){const U=this.probeEOL(w);this.records=w.split(U).filter(vn=>!!vn.trim()).map(this.parseLine),this.currentLine=0;const H=this.parseVersion(),se=this.parseOrigin(),Ue=this.parseSessionName(),Wt=this.parseInformation(),tr=this.parseUri(),Go=this.parseEmail(),ol=this.parsePhone(),Q0=this.parseConnection(),Z0=this.parseBandWidth(),eo=this.parseTimeFields(),Mu=this.parseKey(),xp=this.parseSessionAttribute(),hn=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:H,origin:se,sessionName:Ue,information:Wt,uri:tr,emails:Go,phones:ol,connection:Q0,bandwidths:Z0,timeFields:eo,key:Mu,attributes:xp,mediaDescriptions:hn}}getCurrentRecord(){const w=this.records[this.currentLine];if(!w)throw new Error("Record doesn't exit.");return w}probeEOL(w){for(let U=0;U<w.length;U++)if(w[U]===m)return"\r"===w[U-1]?_:m;throw new Error("Invalid newline character.")}parseLine(w,U){if(w.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const H=w[0];if("="!==w[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:H,value:w.slice(2),line:U,cur:0}}parseSessionAttribute(){const w=new rt;for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==b.ATTRIBUTE)break;const H={attField:this.extractOneOrMore(U,se=>O(se)&&":"!==se),_cur:0};":"===U.value[U.cur]&&(U.cur+=1,H.attValue=this.extractOneOrMore(U,j)),w.parse(H),this.currentLine++}return w.digest()}parseMediaAttributes(w){const U=new ci(w);for(;this.currentLine<this.records.length;){const H=this.getCurrentRecord();if(H.type!==b.ATTRIBUTE)break;const se={attField:this.extractOneOrMore(H,Ue=>O(Ue)&&":"!==Ue),_cur:0};":"===H.value[H.cur]&&(H.cur+=1,se.attValue=this.extractOneOrMore(H,j)),U.parse(se),this.currentLine++}return U.digest()}parseKey(){const w=this.getCurrentRecord();if(w.type===b.KEY){if("prompt"===w.value||"clear:"===w.value||"base64:"===w.value||"uri:"===w.value)return w.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const w=this.getCurrentRecord();if(w.type===b.ZONE_ADJUSTMENTS){const U=[];for(;;)try{const H=this.extract(w,this.consumeTime);this.consumeSpaceForRecord(w);let se=!1;"-"===w.value[w.cur]&&(se=!0,w.cur+=1);const Ue=this.extract(w,this.consumeTypedTime);U.push({time:H,typedTime:Ue,back:se})}catch{break}if(0===U.length)throw new Error("Invalid zone adjustments");return this.currentLine++,U}return[]}parseRepeat(){const w=[];for(;;){const U=this.getCurrentRecord();if(U.type!==b.REPEAT)break;{const H=this.extract(U,this.consumeRepeatInterval),se=this.parseTypedTime(U);w.push({repeatInterval:H,typedTimes:se}),this.currentLine++}}return w}parseTypedTime(w){const U=[];for(;;)try{this.consumeSpaceForRecord(w),U.push(this.extract(w,this.consumeTypedTime))}catch{break}if(0===U.length)throw new Error("Invalid typed time.");return U}parseTime(){const w=this.getCurrentRecord(),U=this.extract(w,this.consumeTime);this.consumeSpaceForRecord(w);const H=this.extract(w,this.consumeTime);return this.currentLine++,{startTime:U,stopTime:H}}parseBandWidth(){const w=[];for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==b.BANDWIDTH)break;{const H=this.extractOneOrMore(U,O);if(":"!==U.value[U.cur])throw new Error("Invalid bandwidth field.");U.cur++;const se=this.extractOneOrMore(U,y);w.push({bwtype:H,bandwidth:se}),this.currentLine++}}return w}parseVersion(){const w=this.getCurrentRecord();if(w.type!==b.VERSION)throw new Error("first sdp record must be version");const U=w.value.slice(0,this.consumeOneOrMore(w.value,0,y));if(U.length!==w.value.length)throw new Error('invalid proto version, "v='.concat(w.value,'"'));return this.currentLine++,U}parseOrigin(){const w=this.getCurrentRecord();if(w.type!==b.ORIGIN)throw new Error("second line of sdp must be origin");const U=this.extractOneOrMore(w,M);this.consumeSpaceForRecord(w);const H=this.extractOneOrMore(w,y);this.consumeSpaceForRecord(w);const se=this.extractOneOrMore(w,y);this.consumeSpaceForRecord(w);const Ue=this.extractOneOrMore(w,O);this.consumeSpaceForRecord(w);const Wt=this.extractOneOrMore(w,O);this.consumeSpaceForRecord(w);const tr=this.extract(w,this.consumeUnicastAddress);return this.currentLine++,{username:U,sessId:H,sessVersion:se,nettype:Ue,addrtype:Wt,unicastAddress:tr}}parseSessionName(){const w=this.getCurrentRecord();if(w.type===b.SESSION_NAME){const U=this.extract(w,this.consumeText);return this.currentLine++,U}}parseInformation(){const w=this.getCurrentRecord();if(w.type!==b.INFORMATION)return;const U=this.extract(w,this.consumeText);return this.currentLine++,U}parseUri(){const w=this.getCurrentRecord();if(w.type===b.URI)return this.currentLine++,w.value}parseEmail(){const w=[];for(;;){const U=this.getCurrentRecord();if(U.type!==b.EMAIL)break;w.push(U.value),this.currentLine++}return w}parsePhone(){const w=[];for(;;){const U=this.getCurrentRecord();if(U.type!==b.PHONE)break;w.push(U.value),this.currentLine++}return w}parseConnection(){const w=this.getCurrentRecord();if(w.type===b.CONNECTION){const U=this.extractOneOrMore(w,O);this.consumeSpaceForRecord(w);const H=this.extractOneOrMore(w,O);this.consumeSpaceForRecord(w);const se=this.extract(w,this.consumeAddress);return this.currentLine++,{nettype:U,addrtype:H,address:se}}}parseMedia(){const w=this.getCurrentRecord(),U=this.extract(w,this.consumeToken);this.consumeSpaceForRecord(w);let H=this.extract(w,this.consumePort);"/"===w.value[w.cur]&&(w.cur+=1,H+=this.extract(w,this.consumeInteger)),this.consumeSpaceForRecord(w);const se=[];for(se.push(this.extract(w,this.consumeToken));"/"===w.value[w.cur];)w.cur+=1,se.push(this.extract(w,this.consumeToken));if(0===se.length)throw new Error("Invalid proto");const Ue=this.parseFmt(w);return this.currentLine++,{mediaType:U,port:H,protos:se,fmts:Ue}}parseTimeFields(){const w=[];for(;this.getCurrentRecord().type===b.TIME;){const U=this.parseTime(),H=this.parseRepeat(),se=this.parseZone();w.push({time:U,repeats:H,zones:se})}return w}parseMediaDescription(){const w=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===b.MEDIA;){const U=this.parseMedia(),H=this.parseInformation(),se=this.parseConnections(),Ue=this.parseBandWidth(),Wt=this.parseKey(),tr=this.parseMediaAttributes(U);w.push({media:U,information:H,connections:se,bandwidths:Ue,key:Wt,attributes:tr})}return w}parseConnections(){const w=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===b.CONNECTION;)w.push(this.parseConnection());return w}parseFmt(w){const U=[];for(;;)try{this.consumeSpaceForRecord(w),U.push(this.extract(w,this.consumeToken))}catch{break}if(0===U.length)throw new Error("Invalid fmts");return U}extract(w,U,...H){const se=U.call(this,w.value,w.cur,...H),Ue=w.value.slice(w.cur,se);return w.cur=se,Ue}extractOneOrMore(w,U){const H=this.consumeOneOrMore(w.value,w.cur,U),se=w.value.slice(w.cur,H);return w.cur=H,se}consumeSpaceForRecord(w){if(w.value[w.cur]!==v)throw new Error("Invalid space at ".concat(w.cur,"."));w.cur+=1}}class Fe extends _e{constructor(...w){super(...w),z(this,"attributes",void 0),z(this,"digested",!1)}extractOneOrMore(w,U,H){const se=this.consumeOneOrMore(w.attValue,w._cur,U),Ue=w.attValue.slice(w._cur,se),[Wt,tr]=H||[];if("number"==typeof Wt&&Ue.length<Wt)throw new Error("error in length, should be more or equal than ".concat(Wt," characters."));if("number"==typeof tr&&Ue.length>tr)throw new Error("error in length, should be less or equal than ".concat(tr," characters."));return w._cur=se,Ue}consumeAttributeSpace(w){if(w.attValue[w._cur]!==v)throw new Error("Invalid space at ".concat(w._cur,"."));w._cur+=1}extract(w,U,...H){if(!w.attValue)throw new Error("Nothing to extract from attValue.");const se=U.call(this,w.attValue,w._cur,...H),Ue=w.attValue.slice(w._cur,se);return w._cur=se,Ue}atEnd(w){if(!w.attValue)throw new Error;return w._cur>=w.attValue.length}peekChar(w){if(!w.attValue)throw new Error;return w.attValue[w._cur]}peek(w,U){if(!w.attValue)throw new Error;for(let H=0;H<U.length;H++)if(U[H]!==w.attValue[w._cur+H])return!1;return!0}parseIceUfrag(w){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(w,q,[4,256])}parseIcePwd(w){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(w,q,[22,256])}parseIceOptions(w){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const U=[];for(;!this.atEnd(w);){U.push(this.extractOneOrMore(w,q));try{this.consumeAttributeSpace(w)}catch(H){if(this.atEnd(w))break;throw H}}this.attributes.iceOptions=U}parseFingerprint(w){const U=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const H=this.extract(w,this.consumeTill);this.attributes.fingerprints.push({hashFunction:U,fingerprint:H})}parseExtmap(w){const U=this.extractOneOrMore(w,y);let H;"/"===this.peekChar(w)&&(this.extract(w,this.consume,"/"),H=this.extract(w,this.consumeToken)),this.consumeAttributeSpace(w);const se=this.extract(w,this.consumeTill,v),Ue=$($({entry:parseInt(U,10)},H&&{direction:H}),{},{extensionName:se});this.peekChar(w)===v&&(this.consumeAttributeSpace(w),Ue.extensionAttributes=this.extract(w,this.consumeTill)),this.attributes.extmaps.push(Ue)}parseSetup(w){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const U=this.extract(w,this.consumeTill);if("active"!==U&&"passive"!==U&&"actpass"!==U&&"holdconn"!==U)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=U}}class rt extends Fe{constructor(...w){super(...w),z(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(w){if(this.digested)throw new Error("already digested");try{switch(w.attField){case"group":this.parseGroup(w);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(w);break;case"ice-pwd":this.parseIcePwd(w);break;case"ice-options":this.parseIceOptions(w);break;case"fingerprint":this.parseFingerprint(w);break;case"setup":this.parseSetup(w);break;case"tls-id":this.parseTlsId(w);break;case"identity":this.parseIdentity(w);break;case"extmap":this.parseExtmap(w);break;case"msid-semantic":this.parseMsidSemantic(w);break;default:w.ignored=!0,this.attributes.unrecognized.push(w)}}catch(U){throw console.error("parsing session attribute ".concat(w.attField,' error, "a=').concat(w.attField,":").concat(w.attValue,'"')),U}if(!w.ignored&&w.attValue&&!this.atEnd(w))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(w){const U=this.extract(w,this.consumeToken),H=[];for(;!this.atEnd(w)&&this.peekChar(w)===v;)this.consumeAttributeSpace(w),H.push(this.extract(w,this.consumeToken));this.attributes.groups.push({semantic:U,identificationTag:H})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(w){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(w,te)}parseIdentity(w){const U=this.extractOneOrMore(w,K),H=[];for(;!this.atEnd(w)&&this.peekChar(w)===v;){this.consumeAttributeSpace(w);const se=this.extract(w,this.consumeToken);this.extract(w,this.consume,"=");const Ue=this.extractOneOrMore(w,Wt=>Wt!==v&&j(Wt));H.push({name:se,value:Ue})}this.attributes.identities.push({assertionValue:U,extensions:H})}parseMsidSemantic(w){this.peekChar(w)===v&&this.consumeAttributeSpace(w);const U={semantic:this.extract(w,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(w)}catch{break}if("*"===this.peekChar(w)){this.extract(w,this.consume,"*"),U.applyForAll=!0;break}{const H=this.extract(w,this.consumeTill,v);U.identifierList.push(H)}}this.attributes.msidSemantic=U}}class ci extends Fe{constructor(w){super(),z(this,"attributes",void 0),-1!==w.protos.indexOf("RTP")||w.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(w){if(this.digested)throw new Error("already digested");try{switch(w.attField){case"extmap":this.parseExtmap(w);break;case"setup":this.parseSetup(w);break;case"ice-ufrag":this.parseIceUfrag(w);break;case"ice-pwd":this.parseIcePwd(w);break;case"ice-options":this.parseIceOptions(w);break;case"candidate":this.parseCandidate(w);break;case"remote-candidate":this.parseRemoteCandidate(w);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(w);break;case"rtpmap":this.parseRtpmap(w);break;case"ptime":this.parsePtime(w);break;case"maxptime":this.parseMaxPtime(w);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(w);break;case"ssrc":this.parseSSRC(w);break;case"fmtp":this.parseFmtp(w);break;case"rtcp-fb":this.parseRtcpFb(w);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(w);break;case"mid":this.parseMid(w);break;case"msid":this.parseMsid(w);break;case"imageattr":this.parseImageAttr(w);break;case"rid":this.parseRid(w);break;case"simulcast":this.parseSimulcast(w);break;case"sctp-port":this.parseSctpPort(w);break;case"max-message-size":this.parseMaxMessageSize(w);break;case"ssrc-group":this.parseSSRCGroup(w);break;default:w.ignored=!0,this.attributes.unrecognized.push(w)}}catch(U){throw console.error("parsing media attribute ".concat(w.attField,' error, "a=').concat(w.attField,":").concat(w.attValue,'"')),U}if(!w.ignored&&w.attValue&&!this.atEnd(w))throw new Error("attribute parsing error")}parseCandidate(w){const U=this.extractOneOrMore(w,q,[1,32]);this.consumeAttributeSpace(w);const H=this.extractOneOrMore(w,y,[1,5]);this.consumeAttributeSpace(w);const se=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const Ue=this.extractOneOrMore(w,y,[1,10]);this.consumeAttributeSpace(w);const Wt=this.extract(w,this.consumeAddress);this.consumeAttributeSpace(w);const tr=this.extract(w,this.consumePort);this.consumeAttributeSpace(w),this.extract(w,this.consume,"typ"),this.consumeAttributeSpace(w);const Go={foundation:U,componentId:H,transport:se,priority:Ue,connectionAddress:Wt,port:tr,type:this.extract(w,this.consumeToken),extension:{}};for(this.peek(w," raddr")&&(this.extract(w,this.consume," raddr"),this.consumeAttributeSpace(w),Go.relAddr=this.extract(w,this.consumeAddress)),this.peek(w," rport")&&(this.extract(w,this.consume," rport"),this.consumeAttributeSpace(w),Go.relPort=this.extract(w,this.consumePort));this.peekChar(w)===v;){this.consumeAttributeSpace(w);const ol=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w),Go.extension[ol]=this.extractOneOrMore(w,T)}this.attributes.candidates.push(Go)}parseRemoteCandidate(w){const U=[];for(;;){const H=this.extractOneOrMore(w,y,[1,5]);this.consumeAttributeSpace(w);const se=this.extract(w,this.consumeAddress);this.consumeAttributeSpace(w);const Ue=this.extract(w,this.consumePort);U.push({componentId:H,connectionAddress:se,port:Ue});try{this.consumeAttributeSpace(w)}catch{break}}this.attributes.remoteCandidatesList.push(U)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(w){const U=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const H=this.extract(w,this.consumeTill,"/");this.extract(w,this.consume,"/");const se={encodingName:H,clockRate:this.extractOneOrMore(w,y)};this.atEnd(w)||"/"!==this.peekChar(w)||(this.extract(w,this.consume,"/"),se.encodingParameters=parseInt(this.extract(w,this.consumeTill),10));const Ue=this.attributes.payloads.find(Wt=>Wt.payloadType===parseInt(U,10));Ue?Ue.rtpMap=se:this.attributes.payloads.push({payloadType:parseInt(U,10),rtpMap:se,rtcpFeedbacks:[]})}parsePtime(w){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(w,this.consumeTill)}parseMaxPtime(w){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(w,this.consumeTill)}parseDirection(w){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=w.attField}parseSSRC(w){const U=this.extractOneOrMore(w,y);this.consumeAttributeSpace(w);const H=this.extract(w,this.consumeTill,":");let se;":"===this.peekChar(w)&&(this.extract(w,this.consume,":"),se=this.extract(w,this.consumeTill));const Ue=this.attributes.ssrcs.find(Wt=>Wt.ssrcId===parseInt(U,10));Ue?Ue.attributes[H]=se:this.attributes.ssrcs.push({ssrcId:parseInt(U,10),attributes:{[H]:se}})}parseFmtp(w){const U=this.extract(w,this.consumeTill,v);this.consumeAttributeSpace(w);const H=this.extract(w,this.consumeTill),se={};H.split(";").forEach(Wt=>{let[tr,Go]=Wt.split("=");tr=tr.trim();const ol="string"==typeof Go?Go.trim():null;"string"==typeof tr&&tr.length>0&&(se[tr]=ol)});const Ue=this.attributes.payloads.find(Wt=>Wt.payloadType===parseInt(U,10));Ue?Ue.fmtp={parameters:se}:this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[],fmtp:{parameters:se}})}parseFmtParameters(w){const U={},H=this.extract(w,this.consumeTill,"=");w._cur++;const se=this.extract(w,this.consumeTill,";");for(U[H]=se;";"===w.attValue[w._cur];){const Ue=this.extract(w,this.consumeTill,"=");w._cur++;const Wt=this.extract(w,this.consumeTill,";");U[Ue]=Wt}return U}parseRtcpFb(w){let U="";U="*"===this.peekChar(w)?this.extract(w,this.consume,"*"):this.extract(w,this.consumeTill,v),this.consumeAttributeSpace(w);const H=this.extract(w,this.consumeTill,v);let se;if("trr-int"===H)se={type:H,interval:this.extract(w,this.consumeTill)};else{const Ue={type:H};this.peekChar(w)===v&&(this.consumeAttributeSpace(w),Ue.parameter=this.extract(w,this.consumeToken),this.peekChar(w)===v&&(Ue.additional=this.extract(w,this.consumeTill))),se=Ue}if("*"===U)this.attributes.rtcpFeedbackWildcards.push(se);else{const Ue=this.attributes.payloads.find(Wt=>Wt.payloadType===parseInt(U,10));Ue?Ue.rtcpFeedbacks.push(se):this.attributes.payloads.push({payloadType:parseInt(U,10),rtcpFeedbacks:[se]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(w){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const U={port:this.extract(w,this.consumePort)};this.peekChar(w)===v&&(this.consumeAttributeSpace(w),U.netType=this.extractOneOrMore(w,O),this.consumeAttributeSpace(w),U.addressType=this.extractOneOrMore(w,O),this.consumeAttributeSpace(w),U.address=this.extract(w,this.consumeAddress)),this.attributes.rtcp=U}parseMsid(w){const U={id:this.extractOneOrMore(w,O,[1,64])};this.peekChar(w)===v&&(this.consumeAttributeSpace(w),U.appdata=this.extractOneOrMore(w,O,[1,64])),this.attributes.msids.push(U)}parseImageAttr(w){this.attributes.imageattr.push(w.attValue)}parseRid(w){const U=this.extractOneOrMore(w,se=>x(se)||y(se)||"_"===se||"-"===se);this.consumeAttributeSpace(w);const H={id:U,direction:this.extract(w,this.consumeToken),params:[]};if(this.peekChar(w)===v){if(this.consumeAttributeSpace(w),this.peek(w,"pt=")){this.extract(w,this.consume,"pt=");const se=[];for(;;){const Ue=this.extract(w,this.consumeToken);se.push(Ue);try{this.extract(w,this.consume,",")}catch{break}}H.payloads=se,this.peekChar(w)===v&&this.extract(w,this.consume,v)}for(;;){const se=this.extract(w,this.consumeToken);switch(se){case"depend":{const Ue={type:se,rids:this.extract(w,this.consume,"=").split(",")};H.params.push(Ue);break}default:{const Ue={type:se};"="===this.peekChar(w)&&(this.extract(w,this.consume,"="),Ue.val=this.extract(w,this.consumeTill,";")),H.params.push(Ue)}}try{this.extract(w,this.consume,";")}catch{break}}}this.attributes.rids.push(H)}parseSimulcast(w){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=w.attValue,this.extract(w,this.consumeTill)}parseSctpPort(w){this.attributes.sctpPort=this.extractOneOrMore(w,y,[1,5])}parseMaxMessageSize(w){this.attributes.maxMessageSize=this.extractOneOrMore(w,y,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(w){this.attributes.mid=this.extract(w,this.consumeToken)}parseSSRCGroup(w){const U=this.extract(w,this.consumeToken),H=[];for(;;)try{this.consumeAttributeSpace(w);const se=this.extract(w,this.consumeInteger);H.push(parseInt(se,10))}catch{break}this.attributes.ssrcGroups.push({semantic:U,ssrcIds:H})}}function Zt(pe,w,U){return w in pe?Object.defineProperty(pe,w,{value:U,enumerable:!0,configurable:!0,writable:!0}):pe[w]=U,pe}class Fi{constructor(){Zt(this,"eol",_)}print(w,U){let H="";return U&&(this.eol=U),H+=this.printVersion(w.version),H+=this.printOrigin(w.origin),H+=this.printSessionName(w.sessionName),H+=this.printInformation(w.information),H+=this.printUri(w.uri),H+=this.printEmail(w.emails),H+=this.printPhone(w.phones),H+=this.printConnection(w.connection),H+=this.printBandwidth(w.bandwidths),H+=this.printTimeFields(w.timeFields),H+=this.printKey(w.key),H+=this.printSessionAttributes(w.attributes),H+=this.printMediaDescription(w.mediaDescriptions),H}printVersion(w){return"v=".concat(w).concat(this.eol)}printOrigin(w){return"o=".concat(w.username," ").concat(w.sessId," ").concat(w.sessVersion," ").concat(w.nettype," ").concat(w.addrtype," ").concat(w.unicastAddress).concat(this.eol)}printSessionName(w){return w?"s=".concat(w).concat(this.eol):""}printInformation(w){return w?"i=".concat(w).concat(this.eol):""}printUri(w){return w?"u=".concat(w).concat(this.eol):""}printEmail(w){let U="";for(const H of w)U+="e=".concat(H).concat(this.eol);return U}printPhone(w){let U="";for(const H of w)U+="e=".concat(H).concat(this.eol);return U}printConnection(w){return w?"c=".concat(w.nettype," ").concat(w.addrtype," ").concat(w.address).concat(this.eol):""}printBandwidth(w){let U="";for(const H of w)U+="b=".concat(H.bwtype,":").concat(H.bandwidth).concat(this.eol);return U}printTimeFields(w){let U="";for(const H of w){U+="t=".concat(H.time.startTime," ").concat(H.time.startTime).concat(this.eol);for(const se of H.repeats)U+="r=".concat(se.repeatInterval," ").concat(se.typedTimes.join(" ")).concat(this.eol);H.zoneAdjustments&&(U+="z=",U+="z=".concat(H.zoneAdjustments.map(se=>"".concat(se.time," ").concat(se.back?"-":""," ").concat(se.typedTime)).join(" ")).concat(this.eol),U+=this.eol)}return U}printKey(w){return w?"k=".concat(w).concat(this.eol):""}printAttributes(w){let U="";for(const H of w)U+="a=".concat(H.attField).concat(H.attValue?":".concat(H.attValue):"").concat(this.eol);return U}printMediaDescription(w){let U="";for(const H of w)U+=this.printMedia(H.media),U+=this.printInformation(H.information),U+=this.printConnections(H.connections),U+=this.printBandwidth(H.bandwidths),U+=this.printKey(H.key),U+=this.printMediaAttributes(H);return U}printConnections(w){let U="";for(const H of w)U+=this.printConnection(H);return U}printMedia(w){return"m=".concat(w.mediaType," ").concat(w.port," ").concat(w.protos.join("/")," ").concat(w.fmts.join(" ")).concat(this.eol)}printSessionAttributes(w){return new ue(this.eol).print(w)}printMediaAttributes(w){return new Se(this.eol).print(w)}}class ie{constructor(w){Zt(this,"eol",void 0),this.eol=w}printIceUfrag(w){return void 0===w?"":"a=ice-ufrag:".concat(w).concat(this.eol)}printIcePwd(w){return void 0===w?"":"a=ice-pwd:".concat(w).concat(this.eol)}printIceOptions(w){return void 0===w?"":"a=ice-options:".concat(w.join(v)).concat(this.eol)}printFingerprints(w){return w.length>0?w.map(U=>"a=fingerprint:".concat(U.hashFunction).concat(v).concat(U.fingerprint)).join(this.eol)+this.eol:""}printExtmap(w){return w.map(U=>"a=extmap:".concat(U.entry).concat(U.direction?"/".concat(U.direction):"").concat(v).concat(U.extensionName).concat(U.extensionAttributes?"".concat(v).concat(U.extensionAttributes):"").concat(this.eol)).join("")}printSetup(w){return void 0===w?"":"a=setup:".concat(w).concat(this.eol)}printUnrecognized(w){return w.map(U=>"a=".concat(U.attField).concat(U.attValue?":".concat(U.attValue):"").concat(this.eol)).join("")}}class ue extends ie{print(w){let U="";return U+=this.printGroups(w.groups),U+=this.printMsidSemantic(w.msidSemantic),U+=this.printIceLite(w.iceLite),U+=this.printIceUfrag(w.iceUfrag),U+=this.printIcePwd(w.icePwd),U+=this.printIceOptions(w.iceOptions),U+=this.printFingerprints(w.fingerprints),U+=this.printSetup(w.setup),U+=this.printTlsId(w.tlsId),U+=this.printIdentity(w.identities),U+=this.printExtmap(w.extmaps),U+=this.printUnrecognized(w.unrecognized),U}printGroups(w){let U="";return w.length>0&&(U+=w.map(H=>"a=group:".concat(H.semantic).concat(H.identificationTag.map(se=>"".concat(v).concat(se)).join("")).concat(this.eol)).join("")),U}printIceLite(w){return void 0===w?"":"a=ice-lite"+this.eol}printTlsId(w){return w?"a=tls-id:".concat(w).concat(this.eol):""}printIdentity(w){return 0===w.length?"":w.map(U=>"a=identity:".concat(U.assertionValue).concat(U.extensions.map(H=>"".concat(v).concat(H.name).concat(H.value?"=".concat(H.value):"")))).join(this.eol)+this.eol}printMsidSemantic(w){if(!w)return"";let U="a=msid-semantic:".concat(w.semantic);return w.applyForAll?U+="".concat(v,"*"):w.identifierList.length>0&&(U+=w.identifierList.map(H=>"".concat(v).concat(H))),U+this.eol}}class Se extends ie{print(w){const U=w.attributes;let H="";return H+=this.printRTCP(U.rtcp),H+=this.printIceUfrag(U.iceUfrag),H+=this.printIcePwd(U.icePwd),H+=this.printIceOptions(U.iceOptions),H+=this.printCandidates(U.candidates),H+=this.printRemoteCandidatesList(U.remoteCandidatesList),H+=this.printEndOfCandidates(U.endOfCandidates),H+=this.printFingerprints(U.fingerprints),H+=this.printSetup(U.setup),H+=this.printMid(U.mid),H+=this.printExtmap(U.extmaps),H+=this.printRTPRelated(U),H+=this.printPtime(U.ptime),H+=this.printMaxPtime(U.maxPtime),H+=this.printDirection(U.direction),H+=this.printSSRCGroups(U.ssrcGroups),H+=this.printSSRC(U.ssrcs),H+=this.printRTCPMux(U.rtcpMux),H+=this.printRTCPMuxOnly(U.rtcpMuxOnly),H+=this.printRTCPRsize(U.rtcpRsize),H+=this.printMSId(U.msids),H+=this.printImageattr(U.imageattr),H+=this.printRid(U.rids),H+=this.printSimulcast(U.simulcast),H+=this.printSCTPPort(U.sctpPort),H+=this.printMaxMessageSize(U.maxMessageSize),H+=this.printUnrecognized(U.unrecognized),H}printCandidates(w){return w.map(U=>"a=candidate:".concat(U.foundation).concat(v).concat(U.componentId).concat(v).concat(U.transport).concat(v).concat(U.priority).concat(v).concat(U.connectionAddress).concat(v).concat(U.port).concat(v,"typ").concat(v).concat(U.type).concat(U.relAddr?"".concat(v,"raddr").concat(v).concat(U.relAddr):"").concat(U.relPort?"".concat(v,"rport").concat(v).concat(U.relPort):"").concat(Object.keys(U.extension).map(H=>"".concat(v).concat(H).concat(v).concat(U.extension[H])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(w){return w.map(U=>"a=remote-candidates:".concat(U.join(v)).concat(this.eol)).join("")}printEndOfCandidates(w){return void 0===w?"":"a=end-of-candidates"+this.eol}printRTPRelated(w){if(!w.payloads)return"";const U=w.payloads;let H="";H+=w.rtcpFeedbackWildcards.map(se=>this.printRTCPFeedback("*",se)).join("");for(const se of U)H+=this.printRtpMap(se.payloadType,se.rtpMap),H+=this.printFmtp(se.payloadType,se.fmtp),H+=se.rtcpFeedbacks.map(Ue=>this.printRTCPFeedback(se.payloadType,Ue)).join("");return H}printFmtp(w,U){if(!U)return"";const H=Object.keys(U.parameters);return 1===H.length&&null===U.parameters[H[0]]?"a=fmtp:".concat(w).concat(v).concat(H[0]).concat(this.eol):"a=fmtp:".concat(w).concat(v).concat(Object.keys(U.parameters).map(se=>"".concat(se,"=").concat(U.parameters[se])).join(";")).concat(this.eol)}printRtpMap(w,U){return U?"a=rtpmap:".concat(w).concat(v).concat(U.encodingName,"/").concat(U.clockRate).concat(U.encodingParameters?"/".concat(U.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(w,U){let H="a=rtcp-fb:".concat(w).concat(v),se=U;return"trr-int"===se.type?H+="ttr-int".concat(v).concat(se.interval):(H+="".concat(se.type),se.parameter&&(H+="".concat(v).concat(se.parameter),se.additional&&(H+="".concat(v).concat(se.additional)))),H+this.eol}printPtime(w){return void 0===w?"":"a=ptime:".concat(w).concat(this.eol)}printMaxPtime(w){return void 0===w?"":"a=maxptime:".concat(w).concat(this.eol)}printDirection(w){return void 0===w?"":"a=".concat(w).concat(this.eol)}printSSRC(w){return w.map(U=>Object.keys(U.attributes).map(H=>"a=ssrc:".concat(U.ssrcId.toString(10)).concat(v).concat(H).concat(U.attributes[H]?":".concat(U.attributes[H]):"").concat(this.eol)).join("")).join("")}printRTCPMux(w){return void 0===w?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(w){return void 0===w?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(w){return void 0===w?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(w){if(void 0===w)return"";let U="a=rtcp:".concat(w.port);return w.netType&&(U+="".concat(v).concat(w.netType)),w.addressType&&(U+="".concat(v).concat(w.addressType)),w.address&&(U+="".concat(v).concat(w.address)),U+this.eol}printMSId(w){return w.map(U=>"a=msid:".concat(U.id).concat(U.appdata?"".concat(v).concat(U.appdata):"").concat(this.eol)).join("")}printImageattr(w){return w.map(U=>"a=imageattr:".concat(U).concat(this.eol)).join("")}printRid(w){return w.map(U=>{let H="a=rid:".concat(U.id).concat(v).concat(U.direction);return U.payloads&&(H+="".concat(v,"pt=").concat(U.payloads.join(","))),U.params.length>0&&(H+="".concat(v).concat(U.params.map(se=>"depend"===se.type?"depend=".concat(se.rids.join(",")):"".concat(se.type,"=").concat(se.val)).join(";"))),H+this.eol}).join("")}printSimulcast(w){return void 0===w?"":"a=simulcast:".concat(w).concat(this.eol)}printSCTPPort(w){return void 0===w?"":"a=sctp-port:".concat(w).concat(this.eol)}printMaxMessageSize(w){return void 0===w?"":"a=max-message-size:".concat(w).concat(this.eol)}printMid(w){return void 0===w?"":"a=mid:".concat(w).concat(this.eol)}printSSRCGroups(w){return w.map(U=>"a=ssrc-group:".concat(U.semantic).concat(U.ssrcIds.map(H=>"".concat(v).concat(H.toString(10))).join("")).concat(this.eol)).join("")}}function ke(pe){return(new me).parse(pe)}function ht(pe,w){return(new Fi).print(pe,w)}}},a={};function d(l){if(a[l])return a[l].exports;var h=a[l]={exports:{}};return r[l](h,h.exports,d),h.exports}return d.d=(l,h)=>{for(var p in h)d.o(h,p)&&!d.o(l,p)&&Object.defineProperty(l,p,{enumerable:!0,get:h[p]})},d.o=(l,h)=>Object.prototype.hasOwnProperty.call(l,h),d.r=l=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},d(8)})()}(oP);var Jt=oP.exports;function ma(s){if(Array.isArray(s))return s.map(r=>r);if(!uF(s))return s;const i={};for(const r in s){const a=s[r];i[r]=uF(a)||Array.isArray(a)?ma(a):a}return i}function uF(s){return!("object"!=typeof s||Array.isArray(s)||!s)}class sP{constructor(i){S(this,"input",[]),S(this,"size",void 0),this.size=i}add(i){this.input.push(i),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Ya={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Jv={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Ya,remoteCandidate:Ya}},hF={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},pF={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},fF={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},mF={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function aP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function gF(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?aP(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):aP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class Qv{constructor(i,r){var a=this;S(this,"onFirstVideoReceived",void 0),S(this,"onFirstVideoDecoded",void 0),S(this,"onFirstAudioReceived",void 0),S(this,"onFirstVideoDecodedTimeout",void 0),S(this,"onFirstAudioDecoded",void 0),S(this,"onSelectedLocalCandidateChanged",void 0),S(this,"onSelectedRemoteCandidateChanged",void 0),S(this,"videoIsReady",!1),S(this,"videoIsReady2",{}),S(this,"pc",void 0),S(this,"options",void 0),S(this,"intervalTimer",void 0),S(this,"stats",ma(Jv)),S(this,"isFirstVideoReceived",{}),S(this,"isFirstVideoDecoded",{}),S(this,"isFirstAudioReceived",{}),S(this,"isFirstAudioDecoded",{}),S(this,"isFirstVideoDecodedTimeout",{}),S(this,"lossRateWindowStats",[]),this.pc=i,this.options=r,this.intervalTimer=window.setInterval(L(function*(){a.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new X(i=>{i({local:gF({},Ya),remote:gF({},Ya)})})}setVideoIsReady(i){this.videoIsReady=i}setVideoIsReady2(i,r){this.videoIsReady2[i]=r}getVideoIsReady(i){return this.videoIsReady2[i]||!1}setIsFirstAudioDecoded(i){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(i){this.lossRateWindowStats.push(i),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,a=["videoSend","audioSend","videoRecv","audioRecv"];let d=0,l=0,h=0,p=0;for(const m of a)i[m].forEach((_,v)=>{if(!this.lossRateWindowStats[r-1][m][v]||!this.lossRateWindowStats[0][m][v])return;const b=this.lossRateWindowStats[r-1][m][v].packets-this.lossRateWindowStats[0][m][v].packets,y=this.lossRateWindowStats[r-1][m][v].packetsLost-this.lossRateWindowStats[0][m][v].packetsLost;"videoSend"===m||"audioSend"===m?(d+=b,h+=y):(l+=b,p+=y),_.packetLostRate=Number.isNaN(b)||Number.isNaN(b)||b<=0||y<=0?0:y/(b+y)});i.sendPacketLossRate=d<=0||h<=0?0:h/(d+h),i.recvPacketLossRate=l<=0||p<=0?0:p/(l+p)}}function Yc(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function _F(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?Yc(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Yc(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class EF extends Qv{constructor(){super(...arguments),S(this,"_stats",Jv),S(this,"lastDecodeVideoReceiverStats",new Map)}updateStats(){var i=this;return L(function*(){const r=yield i._getStats(),a=i.statsResponsesToObjects(r);i._stats=ma(Jv);const d=a.filter(h=>"ssrc"===h.type);i.processSSRCStats(d);const l=a.find(h=>"VideoBwe"===h.type);l&&i.processBandwidthStats(l),i._stats.timestamp=Date.now(),i.calcLossRate(i._stats),i.stats=i._stats})()}processBandwidthStats(i){this._stats.bitrate={actualEncoded:Number(i.googActualEncBitrate),targetEncoded:Number(i.googTargetEncBitrate),retransmit:Number(i.googRetransmitBitrate),transmit:Number(i.googTransmitBitrate)},this._stats.sendBandwidth=Number(i.googAvailableSendBandwidth)}processSSRCStats(i){i.forEach(r=>{var a;const d=ye(a=r.id).call(a,"send");switch("".concat(r.mediaType,"_").concat(d?"send":"recv")){case"video_send":{const l=ma(pF);l.codec=r.googCodecName,l.adaptionChangeReason="none",r.googCpuLimitedResolution&&(l.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(l.adaptionChangeReason="bandwidth"),l.avgEncodeMs=Number(r.googAvgEncodeMs),l.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},l.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},l.firsCount=Number(r.googFirReceived),l.nacksCount=Number(r.googNacksReceived),l.plisCount=Number(r.googPlisReceived),l.frameCount=Number(r.framesEncoded),l.bytes=Number(r.bytesSent),l.packets=Number(r.packetsSent),l.packetsLost=Number(r.packetsLost),l.ssrc=Number(r.ssrc),l.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(l),this._stats.rtt=l.rttMs;break}case"video_recv":{const l=ma(hF),h=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(l.codec=r.googCodecName,l.targetDelayMs=Number(r.googTargetDelayMs),l.renderDelayMs=Number(r.googRenderDelayMs),l.currentDelayMs=Number(r.googCurrentDelayMs),l.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),l.decodeMs=Number(r.googDecodeMs),l.maxDecodeMs=Number(r.googMaxDecodeMs),l.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},l.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},l.decodeFrameRate=Number(r.googFrameRateDecoded),l.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},l.jitterBufferMs=Number(r.googJitterBufferMs),l.firsCount=Number(r.googFirsSent),l.nacksCount=Number(r.googNacksSent),l.plisCount=Number(r.googPlisSent),l.framesDecodeCount=Number(r.framesDecoded),l.bytes=Number(r.bytesReceived),l.packets=Number(r.packetsReceived),l.packetsLost=Number(r.packetsLost),l.ssrc=Number(r.ssrc),l.packets>0&&!this.isFirstVideoReceived[l.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(l.ssrc),this.isFirstVideoReceived[l.ssrc]=!0),l.framesDecodeCount>0&&!this.isFirstVideoDecoded[l.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(l.ssrc,l.decodedFrame.width,l.decodedFrame.height),this.isFirstVideoDecoded[l.ssrc]=!0),h){const p=h.stats,m=Date.now()-h.lts;l.framesDecodeFreezeTime=p.framesDecodeFreezeTime,l.framesDecodeInterval=p.framesDecodeInterval,l.framesDecodeCount>p.framesDecodeCount&&this.isFirstVideoDecoded[l.ssrc]?(h.lts=Date.now(),l.framesDecodeInterval=m,l.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?l.framesDecodeFreezeTime+=l.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):l.framesDecodeCount<h.stats.framesDecodeCount&&(l.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(l.ssrc,{stats:_F({},l),lts:Date.now()}),this._stats.videoRecv.push(l);break}case"audio_recv":{const l=ma(mF);l.codec=r.googCodecName,l.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,l.decodingCNG=Number(r.googDecodingCNG),l.decodingCTN=Number(r.googDecodingCTN),l.decodingCTSG=Number(r.googDecodingCTSG),l.decodingNormal=Number(r.googDecodingNormal),l.decodingPLC=Number(r.googDecodingPLC),l.decodingPLCCNG=Number(r.googDecodingPLCCNG),l.expandRate=Number(r.googExpandRate),l.accelerateRate=Number(r.googAccelerateRate),l.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),l.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),l.speechExpandRate=Number(r.googSpeechExpandRate),l.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),l.jitterBufferMs=Number(r.googJitterBufferMs),l.jitterMs=Number(r.googJitterReceived),l.bytes=Number(r.bytesReceived),l.packets=Number(r.packetsReceived),l.packetsLost=Number(r.packetsLost),l.ssrc=Number(r.ssrc),l.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),l.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),l.receivedFrames>0&&!this.isFirstAudioReceived[l.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(l.ssrc),this.isFirstAudioReceived[l.ssrc]=!0),l.decodingNormal>0&&!this.isFirstAudioDecoded[l.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(l.ssrc),this.isFirstAudioDecoded[l.ssrc]=!0),this._stats.audioRecv.push(l);break}case"audio_send":{const l=ma(fF);l.codec=r.googCodecName,l.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,l.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),l.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),l.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),l.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),l.bytes=Number(r.bytesSent),l.packets=Number(r.packetsSent),l.packetsLost=Number(r.packetsLost),l.ssrc=Number(r.ssrc),l.rttMs=Number(r.googRtt||0),this._stats.rtt=l.rttMs,this._stats.audioSend.push(l);break}}})}_getStats(){return new X((i,r)=>{this.pc.getStats(i,r)})}statsResponsesToObjects(i){const r=[];return i.result().forEach(a=>{const d={id:a.id,timestamp:a.timestamp.valueOf().toString(),type:a.type};a.names().forEach(l=>{d[l]=a.stat(l)}),r.push(d)}),r}}function sn(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function $c(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?sn(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):sn(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class cP extends Qv{constructor(){super(...arguments),S(this,"_stats",Jv),S(this,"report",void 0),S(this,"lastDecodeVideoReceiverStats",new Map),S(this,"lastVideoFramesRecv",new Map),S(this,"lastVideoFramesSent",new Map),S(this,"lastVideoFramesDecode",new Map),S(this,"lastVideoJBDelay",new Map),S(this,"lastAudioJBDelay",new Map),S(this,"mediaBytesSent",new Map),S(this,"mediaBytesRetransmit",new Map),S(this,"mediaBytesTargetEncode",new Map),S(this,"lastEncoderMs",new Map)}updateStats(){var i=this;return L(function*(){i.report=yield i.pc.getStats(),i._stats=ma(Jv),i.report.forEach(r=>{switch(r.type){case vr.OUTBOUND:case vr.INBOUND:{const a=r.mediaType||r.kind,d=!a&&"frameWidth"in r,l=!a&&!("frameWidth"in r);r.type===vr.OUTBOUND?"audio"===a||l?i.processAudioOutboundStats(r):("video"===a||d)&&i.processVideoOutboundStats(r):r.type===vr.INBOUND&&("audio"===a||l?i.processAudioInboundStats(r):("video"===a||d)&&i.processVideoInboundStats(r));break}case vr.TRANSPORT:{const a=i.report.get(r.selectedCandidatePairId);a&&i.processCandidatePairStats(a);break}case vr.CANDIDATE_PAIR:r.selected&&i.processCandidatePairStats(r)}}),i.updateSendBitrate(),i._stats.timestamp=Date.now(),i.calcLossRate(i._stats),i.stats=i._stats})()}getSelectedCandidatePair(){var i=this;return L(function*(){const r=yield i.pc.getStats(),a={local:$c({},Ya),remote:$c({},Ya)};return r.forEach(d=>{let l;if(d.type===vr.TRANSPORT&&(l=r.get(d.selectedCandidatePairId)),d.type===vr.CANDIDATE_PAIR&&d.selected&&(l=d),l){const h=(p,m)=>{p.type=m.type,p.id=m.id,m.address&&(p.address=m.address),m.candidateType&&(p.candidateType=m.candidateType),m.port&&(p.port=m.port),m.priority&&(p.priority=m.priority),m.protocol&&(p.protocol=m.protocol),m.relayProtocol&&(p.relayProtocol=m.relayProtocol)};if(l.localCandidateId){const p=r.get(l.localCandidateId);p&&h(a.local,p)}if(l.remoteCandidateId){const p=r.get(l.remoteCandidateId);p&&h(a.remote,p)}}}),a})()}processCandidatePairStats(i){if(this._stats.sendBandwidth=i.availableOutgoingBitrate||0,i.currentRoundTripTime&&(this._stats.rtt=1e3*i.currentRoundTripTime),this._stats.videoSend.forEach(r=>{i.currentRoundTripTime&&(r.rttMs=1e3*i.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{i.currentRoundTripTime&&(r.rttMs=1e3*i.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=i.id,i.localCandidateId){const r=this.report.get(i.localCandidateId);r&&this.processCandidateStats(r)}if(i.remoteCandidateId){const r=this.report.get(i.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(i){let r;i.type===vr.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),i.type===vr.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=i.type,r.id=i.id,i.address&&(r.address=i.address),i.candidateType&&(r.candidateType=i.candidateType),i.port&&(r.port=i.port),i.priority&&(r.priority=i.priority),i.protocol&&(r.protocol=i.protocol),i.relayProtocol&&(r.relayProtocol=i.relayProtocol),i.type===vr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged($c({},r),$c({},this.stats.selectedCandidatePair.localCandidate)),i.type===vr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged($c({},r),$c({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(i){let r=this._stats.audioRecv.find(a=>a.ssrc===i.ssrc);r||(r=ma(mF),this._stats.audioRecv.push(r)),r.ssrc=i.ssrc,r.packets=i.packetsReceived,r.packetsLost=i.packetsLost,r.bytes=i.bytesReceived,r.jitterMs=1e3*i.jitter,this.processAudioTrackReceiverStats(i,i.trackId,r),i.codecId&&(r.codec=this.getCodecFromCodecStats(i.codecId)),r.receivedFrames||(r.receivedFrames=i.packetsReceived),r.droppedFrames||(r.droppedFrames=i.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),"number"==typeof i.concealedSamples&&(r.concealedSamples=i.concealedSamples)}processVideoInboundStats(i){let r=this._stats.videoRecv.find(h=>h.ssrc===i.ssrc);r||(r=ma(hF),this._stats.videoRecv.push(r)),r.ssrc=i.ssrc,r.packets=i.packetsReceived,r.packetsLost=i.packetsLost,r.bytes=i.bytesReceived,r.firsCount=i.firCount,r.nacksCount=i.nackCount,r.plisCount=i.pliCount,r.framesDecodeCount=i.framesDecoded,r.totalInterFrameDelay=i.totalInterFrameDelay,r.totalSquaredInterFrameDelay=i.totalSquaredInterFrameDelay;const a=this.lastDecodeVideoReceiverStats.get(r.ssrc),d=this.lastVideoFramesDecode.get(r.ssrc),l=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame?r.decodedFrame.width:0,r.decodedFrame?r.decodedFrame.height:0),this.isFirstVideoDecoded[r.ssrc]=!0),a){const h=a.stats,p=l-a.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&p>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(a.lts=Date.now(),r.framesDecodeInterval=p,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(i.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(i.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),i.framesDecoded&&i.qpSum&&(r.qpSumPerFrame=a.stats.framesDecodeCount>i.framesDecoded?i.qpSum/i.framesDecoded:(i.qpSum-a.qpSum)/(i.framesDecoded-a.stats.framesDecodeCount))}d&&l-d.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-d.count)/((l-d.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:l,rate:r.decodeFrameRate})):d?r.decodeFrameRate=d.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:l,rate:0}),i.totalDecodeTime&&(r.decodeMs=1e3*i.totalDecodeTime),this.processVideoTrackReceiverStats(i,i.trackId,r),i.codecId&&(r.codec=this.getCodecFromCodecStats(i.codecId)),i.framerateMean&&(r.framesRateFirefox=i.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:$c({},r),lts:a?a.lts:Date.now(),qpSum:i.qpSum})}processVideoOutboundStats(i){let r=this._stats.videoSend.find(d=>d.ssrc===i.ssrc);r||(r=ma(pF),this._stats.videoSend.push(r));const a=this.mediaBytesSent.get(i.ssrc);if(a)a.add(i.bytesSent);else{const d=new sP(10);d.add(i.bytesSent),this.mediaBytesSent.set(i.ssrc,d)}if(void 0!==i.retransmittedBytesSent){const d=this.mediaBytesRetransmit.get(i.ssrc);if(d)d.add(i.retransmittedBytesSent);else{const l=new sP(10);l.add(i.retransmittedBytesSent),this.mediaBytesRetransmit.set(i.ssrc,l)}}if(i.totalEncodedBytesTarget){const d=this.mediaBytesTargetEncode.get(i.ssrc);if(d)d.add(i.totalEncodedBytesTarget);else{const l=new sP(10);l.add(i.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(i.ssrc,l)}}if(r.ssrc=i.ssrc,r.bytes=i.bytesSent,r.packets=i.packetsSent,r.firsCount=i.firCount,r.nacksCount=i.nackCount,r.plisCount=i.pliCount,r.frameCount=i.framesEncoded,r.adaptionChangeReason=i.qualityLimitationReason,r.scalabilityMode=i.scalabilityMode,i.totalEncodeTime&&i.framesEncoded){const d=this.lastEncoderMs.get(i.ssrc);r.avgEncodeMs=!d||d.lastFrameCount>i.framesEncoded?1e3*i.totalEncodeTime/i.framesEncoded:1e3*(i.totalEncodeTime-d.lastEncoderTime)/(i.framesEncoded-d.lastFrameCount)}if(i.framesEncoded&&i.qpSum){const d=this.lastEncoderMs.get(i.ssrc);r.qpSumPerFrame=!d||d.lastFrameCount>i.framesEncoded?i.qpSum/i.framesEncoded:(i.qpSum-d.lastQpSum)/(i.framesEncoded-d.lastFrameCount)}if(this.lastEncoderMs.set(i.ssrc,{lastFrameCount:i.framesEncoded,lastEncoderTime:i.totalEncodeTime,lastQpSum:i.qpSum,lts:Date.now()}),i.codecId&&(r.codec=this.getCodecFromCodecStats(i.codecId)),i.mediaSourceId&&this.processVideoMediaSource(i.mediaSourceId,r),this.processVideoTrackSenderStats(i,i.trackId,r),i.remoteId)this.processRemoteInboundStats(i.remoteId,r);else{const d=this.findRemoteStatsId(i.ssrc,vr.REMOTE_INBOUND);d&&this.processRemoteInboundStats(d,r)}}processAudioOutboundStats(i){let r=this._stats.audioSend.find(a=>a.ssrc===i.ssrc);if(r||(r=ma(fF),this._stats.audioSend.push(r)),r.ssrc=i.ssrc,r.packets=i.packetsSent,r.bytes=i.bytesSent,i.mediaSourceId&&this.processAudioMediaSource(i.mediaSourceId,r),i.codecId&&(r.codec=this.getCodecFromCodecStats(i.codecId)),this.processAudioTrackSenderStats(i,i.trackId,r),i.remoteId)this.processRemoteInboundStats(i.remoteId,r);else{const a=this.findRemoteStatsId(i.ssrc,vr.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,r)}}findRemoteStatsId(i,r){var a;const d=Array.from(ca(a=this.report).call(a)).find(l=>l.type===r&&l.ssrc===i);return d?d.id:null}processVideoMediaSource(i,r){const a=this.report.get(i);a&&a.width&&a.height&&a.framesPerSecond&&(r.inputFrame={width:a.width,height:a.height,frameRate:a.framesPerSecond})}processAudioMediaSource(i,r){const a=this.report.get(i);a&&(r.inputLevel=a.audioLevel)}processVideoTrackSenderStats(i,r,a){var d,l,h,p;const m=r?this.report.get(r):void 0,_=null!==(d=m?.framesSent)&&void 0!==d?d:i.framesSent;if("number"!=typeof _)return;let v=null!==(l=m?.frameWidth)&&void 0!==l?l:i.frameWidth,b=null!==(h=m?.frameHeight)&&void 0!==h?h:i.frameHeight,y=null!==(p=m?.framesPerSecond)&&void 0!==p?p:i.framesPerSecond;if("number"==typeof v&&"number"==typeof b||(v=0,b=0),null==y){const T=Date.now(),M=this.lastVideoFramesSent.get(a.ssrc);M&&T-M.lts>=800?(y=Math.round((_-M.count)/((T-M.lts)/1e3)),this.lastVideoFramesSent.set(a.ssrc,{count:_,lts:T,rate:y})):M?y=M.rate:this.lastVideoFramesSent.set(a.ssrc,{count:_,lts:T,rate:0})}a.sentFrame={width:v,height:b,frameRate:Math.max(0,y)}}processVideoTrackReceiverStats(i,r,a){var d,l,h,p,m;const _=r?this.report.get(r):void 0,v=null!==(d=_?.framesReceived)&&void 0!==d?d:i.framesReceived,b=null!==(l=_?.frameWidth)&&void 0!==l?l:i.frameWidth,y=null!==(h=_?.frameHeight)&&void 0!==h?h:i.frameHeight,T=null!==(p=_?.jitterBufferDelay)&&void 0!==p?p:i.jitterBufferDelay,M=null!==(m=_?.jitterBufferEmittedCount)&&void 0!==m?m:i.jitterBufferEmittedCount;if("number"==typeof v){const O=this.lastVideoFramesRecv.get(a.ssrc),D=Date.now();a.framesReceivedCount=v;let x=0;O&&D-O.lts>=800?(x=Math.round((v-O.count)/((D-O.lts)/1e3)),this.lastVideoFramesRecv.set(a.ssrc,{count:v,lts:D,rate:x})):O?x=O.rate:this.lastVideoFramesRecv.set(a.ssrc,{count:v,lts:D,rate:0}),a.receivedFrame={width:b||0,height:y||0,frameRate:x||0},a.decodedFrame={width:b||0,height:y||0,frameRate:a.decodeFrameRate||0},a.outputFrame={width:b||0,height:y||0,frameRate:a.decodeFrameRate||0}}if(T&&M){const O=this.lastVideoJBDelay.get(a.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let D=O.jitterBufferMs;const x=M-O.jitterBufferEmittedCount;x>0&&(D=1e3*(T-O.jitterBufferDelay)/x),a.jitterBufferMs=D,a.currentDelayMs=Math.round(D),this.lastVideoJBDelay.set(a.ssrc,{jitterBufferDelay:T,jitterBufferEmittedCount:M,jitterBufferMs:a.currentDelayMs})}}processAudioTrackSenderStats(i,r,a){var d,l,h,p;const m=r?this.report.get(r):void 0,_=null!==(d=null!==(l=m?.echoReturnLoss)&&void 0!==l?l:i.echoReturnLoss)&&void 0!==d?d:0,v=null!==(h=null!==(p=m?.echoReturnLossEnhancement)&&void 0!==p?p:i.echoReturnLossEnhancement)&&void 0!==h?h:0;a.aecReturnLoss=_,a.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(i,r,a){var d,l,h,p,m,_,v;const b=r?this.report.get(r):void 0,y=null!==(d=b?.removedSamplesForAcceleration)&&void 0!==d?d:i.removedSamplesForAcceleration,T=null!==(l=b?.totalSamplesReceived)&&void 0!==l?l:i.totalSamplesReceived,M=null!==(h=b?.jitterBufferDelay)&&void 0!==h?h:i.jitterBufferDelay,O=null!==(p=b?.jitterBufferEmittedCount)&&void 0!==p?p:i.jitterBufferEmittedCount,D=null!==(m=b?.audioLevel)&&void 0!==m?m:i?.audioLevel,x=null!==(_=b?.totalSamplesDuration)&&void 0!==_?_:i?.totalSamplesDuration,F=null!==(v=b?.concealedSamples)&&void 0!==v?v:i.concealedSamples;if(y&&T&&(a.accelerateRate=y/T),M&&O){const q=this.lastAudioJBDelay.get(a.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let te=q.jitterBufferMs;const K=O-q.jitterBufferEmittedCount;K>0&&(te=1e3*(M-q.jitterBufferDelay)/K),a.jitterBufferMs=Math.round(te),this.lastAudioJBDelay.set(a.ssrc,{jitterBufferDelay:M,jitterBufferEmittedCount:O,jitterBufferMs:a.jitterBufferMs})}a.outputLevel=D;let j=1920;x&&T&&(j=T/x/50,a.receivedFrames=Math.round(T/j)),F&&(a.droppedFrames=Math.round(F/j))}processRemoteInboundStats(i,r){const a=this.report.get(i);a&&(r.packetsLost=a.packetsLost,a.roundTripTime&&(r.rttMs=1e3*a.roundTripTime),a.jitter&&(r.jitterMs=1e3*a.jitter),a.timestamp&&(r.timestamp=a.timestamp))}getCodecFromCodecStats(i){const r=this.report.get(i);if(!r)return"";const a=r.mimeType.match(/\/(.*)$/);return a&&a[1]?a[1]:""}updateSendBitrate(){let i=0,r=null,a=null;this.mediaBytesSent.forEach(l=>{i+=l.diffMean()}),this.mediaBytesRetransmit.forEach(l=>{r=null===r?l.diffMean():r+l.diffMean()}),this.mediaBytesTargetEncode.forEach(l=>{a=null===a?l.diffMean():a+l.diffMean()}),this._stats.bitrate={actualEncoded:8*(null!==r?i-r:i)/(this.options.updateInterval/1e3),transmit:8*i/(this.options.updateInterval/1e3)},null!==r&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),null!==a&&(this._stats.bitrate.targetEncoded=8*a/(this.options.updateInterval/1e3))}}class vF extends Qv{updateStats(){return X.resolve()}}function Op(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const l=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return l?l<76?new EF(s,{updateInterval:i,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:d}):new cP(s,{updateInterval:i,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:d}):window.RTCStatsReport&&s.getStats()instanceof X?new cP(s,{updateInterval:i,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:d}):new vF(s,{updateInterval:i,lossRateInterval:r,freezeRateLimit:a,firstVideoDecodedTimeout:d})}function D0(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function $a(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?D0(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):D0(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function ga(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:d,filterVideoFec:l,filterAudioFec:h,filterAudioCodec:p,filterVideoCodec:m}=i,{useXR:_}=r;let v=[],b=[],y=[],T=[],M=!1,O=!1;if(Jt.parse(s).mediaDescriptions.forEach(x=>{a&&a!==x.attributes.direction||("video"!==x.media.mediaType||M||(b=x.attributes.payloads,T=x.attributes.extmaps,M=!0),"audio"!==x.media.mediaType||O||(v=x.attributes.payloads,y=x.attributes.extmaps,O=!0))}),!T||0===b.length)throw new Error("Cannot get video capabilities from SDP.");if(!y||0===v.length)throw new Error("Cannot get audio capabilities from SDP.");b.forEach(x=>{var F;null!==(F=x.rtpMap)&&void 0!==F&&F.clockRate&&(x.rtpMap.clockRate=parseInt(x.rtpMap.clockRate)),_&&x.rtcpFeedbacks.push({type:"rrtr"})}),v.forEach(x=>{var F;null!==(F=x.rtpMap)&&void 0!==F&&F.clockRate&&(x.rtpMap.clockRate=parseInt(x.rtpMap.clockRate)),_&&x.rtcpFeedbacks.push({type:"rrtr"})}),d&&(v=v.filter(x=>{var F;return"rtx"!==(null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName.toLowerCase())}),b=b.filter(x=>{var F;return"rtx"!==(null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName.toLowerCase())})),l&&(b=b.filter(x=>{var F;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName)||"")})),h&&(v=v.filter(x=>{var F;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName)||"")})),p&&p?.length>0&&(v=v.filter(x=>{var F;return ye(p).call(p,(null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName.toLowerCase())||"")})),m&&m?.length>0&&(b=b.filter(x=>{var F;return ye(m).call(m,(null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName.toLowerCase())||"")}));const D=V("UNSUPPORTED_VIDEO_CODEC");return D&&D.length>0&&(b=b.filter(x=>!(x.rtpMap&&ye(D).call(D,x.rtpMap.encodingName.toLowerCase())))),{audioCodecs:v,videoCodecs:b,audioExtensions:y,videoExtensions:T}}function Ks(s){const i=Jt.parse(s);let r,a;for(const d of i.mediaDescriptions){if(!r){const l=d.attributes.iceUfrag,h=d.attributes.icePwd;if(!l||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:l,icePwd:h}}if(!a){const l=d.attributes.fingerprints;l.length>0&&(a={fingerprints:l})}}if(!a&&i.attributes.fingerprints.length>0&&(a={fingerprints:i.attributes.fingerprints}),!a||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:a}}function Zv(s,i){const r=[],a=s.attributes.ssrcGroups.filter(h=>"FID"===h.semantic),d=s.attributes.ssrcGroups.find(h=>"SIM"===h.semantic),l=s.attributes.ssrcs;if(d)d.ssrcIds.forEach(h=>{var p;const m=null===(p=a.find(_=>_.ssrcIds[0]===h))||void 0===p?void 0:p.ssrcIds[1];r.push({ssrcId:h,rtx:i?m:void 0})});else if(a.length>0)r.push({ssrcId:a[0].ssrcIds[0],rtx:i?a[0].ssrcIds[1]:void 0});else{if(0===l.length)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:l[0].ssrcId})}return r}function dP(s,i){const{cname:r}=s;let a;i&&i.ip&&"number"==typeof i.port?(a=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:i.ip,port:i.port.toString(),type:"host",extension:{}}],I.debug("Using remote candidate from AP ".concat(i.ip,":").concat(i.port)),i.ip6&&(a.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:i.ip6,port:i.port.toString(),type:"host",extension:{}}),I.debug("Using IPV6 remote candidate from AP ".concat(i.ip6,":").concat(i.port)))):a=s.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}}));const d={fingerprints:s.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},l={iceUfrag:s.iceParameters.iceUfrag,icePwd:s.iceParameters.icePwd};let h;switch(s.dtlsParameters.role){case"server":h="passive";break;case"client":h="active";break;case"auto":h="actpass"}return{dtlsParameters:d,iceParameters:l,candidates:a,rtpCapabilities:oi(s.rtpCapabilities),setup:h,cname:r}}function Hi(s,i,r){const a=[],d=[];return s.forEach(l=>{let{ssrcId:h,rtx:p}=l;const m=Ke(8,"track-"),_={ssrcId:h,attributes:$a({label:m,mslabel:r=r||Ke(10,""),msid:"".concat(r," ").concat(m)},i&&{cname:i})};if(a.push(_),void 0!==p){const v={ssrcId:p,attributes:$a({label:m,mslabel:r,msid:"".concat(r," ").concat(m)},i&&{cname:i})};a.push(v),d.push({semantic:"FID",ssrcIds:[h,p]})}}),s.length>1&&d.push({semantic:"SIM",ssrcIds:s.map(l=>{let{ssrcId:h}=l;return h})}),{ssrcs:a,ssrcGroups:d}}function Xd(s,i){i instanceof vt&&s.attributes.payloads.forEach(r=>{var a;const d=null===(a=r.rtpMap)||void 0===a?void 0:a.encodingName.toLowerCase();if(!d||-1===["opus","pcmu","pcma","g722"].indexOf(d))return;r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";const l=i._encoderConfig;l&&"pcmu"!==d&&"pcma"!==d&&"g722"!==d&&(l.bitrate&&!Pt()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*l.bitrate))),l.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(l.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(l.sampleRate)),l.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"))})}function eb(s){const i=s.attributes.unrecognized.findIndex(r=>"x-google-flag"===r.attField&&"conference"===r.attValue);-1!==i&&s.attributes.unrecognized.splice(i,1)}function og(s,i){var r;if(!(i instanceof je&&i._encoderConfig&&-1===i._hints.indexOf(kt.SCREEN_TRACK)))return;const a=i._encoderConfig;Ot().supportMinBitrate&&a.bitrateMin&&s.attributes.payloads.forEach(d=>{var l,h;ye(l=["h264","h265","vp8","vp9","av1"]).call(l,(null===(h=d.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(d.fmtp||(d.fmtp={parameters:{}}),d.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),Ot().supportMinBitrate&&!ye(r=i._hints).call(r,kt.LOW_STREAM)&&a.bitrateMax&&s.attributes.payloads.forEach(d=>{var l,h;ye(l=["h264","h265","vp8","vp9","av1"]).call(l,(null===(h=d.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(d.fmtp||(d.fmtp={parameters:{}}),d.fmtp.parameters["x-google-start-bitrate"]="".concat(V("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function O0(s){if("video"!==s.media.mediaType)return;const i=lt();if(i.name!==Et.SAFARI&&i.os!==ei.IOS)return;const r=s.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));-1!==r&&s.attributes.extmaps.splice(r,1)}function Iu(s,i,r){if(!i)return;let a,d;if("video"===s.media.mediaType?(a=r.videoExtensions,d=r.videoCodecs):(a=r.audioExtensions,d=r.audioCodecs),!0===i.twcc){const l=a.find(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);l&&(s.attributes.extmaps.find(p=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===p.extensionName)||s.attributes.extmaps.push({entry:l.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),(p=d,m=s.attributes.payloads,m.filter(_=>!!p.find(v=>v.payloadType===_.payloadType&&!!v.rtcpFeedbacks.find(b=>"transport-cc"===b.type)))).forEach(p=>{p.rtcpFeedbacks.find(m=>"transport-cc"===m.type)||p.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(!1===i.twcc){const l=s.attributes.extmaps.findIndex(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);-1!==l&&s.attributes.extmaps.splice(l,1),s.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>"transport-cc"===m.type);-1!==p&&h.rtcpFeedbacks.splice(p,1)})}var p,m;if(!0===i.remb){const l=a.find(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);l&&(s.attributes.extmaps.find(p=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===p.extensionName)||s.attributes.extmaps.push({entry:l.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(p,m){return m.filter(_=>!!p.find(v=>v.payloadType===_.payloadType&&!!v.rtcpFeedbacks.find(b=>"goog-remb"===b.type)))}(d,s.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(m=>"goog-remb"===m.type)||p.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(!1===i.remb){const l=s.attributes.extmaps.findIndex(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);-1!==l&&s.attributes.extmaps.splice(l,1),s.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>"goog-remb"===m.type);-1!==p&&h.rtcpFeedbacks.splice(p,1)})}}function Np(s,i,r){if(Pt()||"video"!==s.media.mediaType||!(i instanceof je)||"vp9"!==r&&"vp8"!==r||"vp8"===r&&!V("SIMULCAST")||void 0===i._scalabilityMode||i._scalabilityMode.numSpatialLayers<=1)return;const a="vp8"===r?2:i._scalabilityMode.numSpatialLayers,d=s.attributes.ssrcs[0],l=s.attributes.ssrcGroups.find(p=>"FID"===p.semantic&&p.ssrcIds[0]===d.ssrcId),h={semantic:"SIM",ssrcIds:[d.ssrcId]};for(let p=1;p<a;p++)s.attributes.ssrcs.push({ssrcId:d.ssrcId+p,attributes:Ft(d.attributes)}),h.ssrcIds.push(d.ssrcId+p),l&&(s.attributes.ssrcs.push({ssrcId:l.ssrcIds[1]+p,attributes:Ft(d.attributes)}),s.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[d.ssrcId+p,l.ssrcIds[1]+p]}));s.attributes.ssrcGroups.unshift(h)}function Jd(){return kr.apply(this,arguments)}function kr(){return kr=L(function*(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});const a=(yield r.createOffer()).sdp,{send:d,recv:l,sendrecv:h}=function(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0;const v=ga(_,p,m,"sendonly"),b=ga(_,p,m,"recvonly"),y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},M={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ci(v,b,"videoExtensions",y,T,M),Ci(v,b,"videoCodecs",y,T,M),Ci(v,b,"audioExtensions",y,T,M),Ci(v,b,"audioCodecs",y,T,M),V("RAISE_H264_BASELINE_PRIORITY")){const O=M.videoCodecs.findIndex(D=>{var x,F;return"h264"===(null===(x=D.rtpMap)||void 0===x?void 0:x.encodingName.toLocaleLowerCase())&&"42001f"===(null===(F=D.fmtp)||void 0===F?void 0:F.parameters["profile-level-id"])});if(-1!==O){const D=M.videoCodecs.findIndex(x=>{var F;return"h264"===(null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName.toLocaleLowerCase())});if(D<O){I.debug("raising H264 baseline profile priority");const x=M.videoCodecs[O];M.videoCodecs.splice(O,1),M.videoCodecs.splice(D,0,x)}-1!==D&&(T.videoCodecs=T.videoCodecs.filter(x=>{var F,j;return!("h264"===(null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(j=x.fmtp)||void 0===j?void 0:j.parameters["profile-level-id"]))})),-1!==D&&V("FILTER_SEND_H264_BASELINE")&&(y.videoCodecs=y.videoCodecs.filter(x=>{var F,j;return!("h264"===(null===(F=x.rtpMap)||void 0===F?void 0:F.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(j=x.fmtp)||void 0===j?void 0:j.parameters["profile-level-id"]))}))}}return{send:y,recv:T,sendrecv:M}}(s,i,a);try{r.close()}catch{}return{send:d,recv:l,sendrecv:h}}),kr.apply(this,arguments)}function Hn(){const s={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},i=ga(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ci(s,i,"videoExtensions",r,a,d),Ci(s,i,"videoCodecs",r,a,d),Ci(s,i,"audioExtensions",r,a,d),Ci(s,i,"audioCodecs",r,a,d),V("RAISE_H264_BASELINE_PRIORITY")){const l=d.videoCodecs.findIndex(h=>h.rtpMap&&"h264"===h.rtpMap.encodingName.toLocaleLowerCase()&&h.fmtp&&"42001f"===h.fmtp.parameters["profile-level-id"]);if(-1!==l){const h=d.videoCodecs.findIndex(p=>p.rtpMap&&"h264"===p.rtpMap.encodingName.toLocaleLowerCase());if(h<l){I.debug("raising H264 baseline profile priority");const p=d.videoCodecs[l];d.videoCodecs.splice(l,1),d.videoCodecs.splice(h,0,p)}-1!==h&&(a.videoCodecs=a.videoCodecs.filter(p=>!(p.rtpMap&&"h264"===p.rtpMap.encodingName.toLocaleLowerCase()&&p.fmtp&&"42001f"!==p.fmtp.parameters["profile-level-id"])))}}return{send:r,recv:a,sendrecv:d}}function Ci(s,i,r,a,d,l){if("videoExtensions"===r||"audioExtensions"===r){const h=[];return s[r].forEach(p=>{i[r].some((m,_)=>{if(p.entry===m.entry&&p.extensionName===m.extensionName)return h.push(_),!0})?l[r].push(p):a[r].push(p)}),void i[r].forEach((p,m)=>{-1===h.indexOf(m)&&d[r].push(p)})}if("videoCodecs"===r||"audioCodecs"===r){const h=[];return s[r].forEach(p=>{i[r].some((m,_)=>{if(p.payloadType===m.payloadType&&JSON.stringify(p)===JSON.stringify(m))return h.push(_),!0})?l[r].push(p):a[r].push(p)}),void i[r].forEach((p,m)=>{-1===h.indexOf(m)&&d[r].push(p)})}}function oi(s){const{send:i,recv:r,sendrecv:a}=s;if(!a){if(!i||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:i,recv:r}}let d,l;return i?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...i.audioCodecs,...a.audioCodecs],d.videoCodecs=[...i.videoCodecs,...a.videoCodecs],d.audioExtensions=[...i.audioExtensions,...a.audioExtensions],d.videoExtensions=[...i.videoExtensions,...a.videoExtensions]):d=a,r?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...r.audioCodecs,...a.audioCodecs],l.videoCodecs=[...r.videoCodecs,...a.videoCodecs],l.audioExtensions=[...r.audioExtensions,...a.audioExtensions],l.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):l=a,{send:d,recv:l}}function _a(s){"audio"===s.media.mediaType&&s.attributes.payloads.filter(i=>{var r;return"opus"===(null===(r=i.rtpMap)||void 0===r?void 0:r.encodingName.toLowerCase())}).forEach(i=>{i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"})}function sg(s){s.mediaDescriptions.forEach(i=>{"video"!==i.media.mediaType&&"audio"!==i.media.mediaType||i.attributes.payloads.forEach(r=>{-1===r.rtcpFeedbacks.findIndex(a=>"rrtr"===a.type)&&r.rtcpFeedbacks.push({type:"rrtr"})})})}function wu(s,i,r,a){let d=[];if(s===Ce.VIDEO){if(V("H264_PROFILE_LEVEL_ID")&&"h264"===a&&(d=i.videoCodecs.filter(l=>{var h;return ye(h=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&l&&l.fmtp&&l.fmtp.parameters["profile-level-id"]===V("H264_PROFILE_LEVEL_ID")})),!Array.isArray(d)||0===d.length){let l=[];const h=[],p=[];r.videoCodecs.forEach(m=>{var _,v,b;ye(_=m.rtpMap&&m.rtpMap.encodingName.toLowerCase()||"").call(_,a)&&l.push(m),ye(v=m.rtpMap&&m.rtpMap.encodingName.toLowerCase()||"").call(v,"vp8")&&h.push(m),ye(b=m.rtpMap&&m.rtpMap.encodingName.toLowerCase()||"").call(b,"h264")&&p.push(m)}),0===l.length&&(0!==h.length?(l=h,I.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: vp8"))):0!==p.length&&(l=p,I.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: h264")))),0!==l.length&&(d=i.videoCodecs.filter(m=>l.some(_=>_.payloadType===m.payloadType)))}if(V("USE_PUB_RTX")){const l=d.map(p=>p.payloadType.toString()),h=i.videoCodecs.filter(p=>p.rtpMap&&"rtx"===p.rtpMap.encodingName&&ye(l).call(l,p.fmtp&&p.fmtp.parameters.apt||""));d=[...d,...h]}0===d.length&&(I.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(i.videoCodecs[0].rtpMap&&i.videoCodecs[0].rtpMap.encodingName)),d=i.videoCodecs)}else d=i.audioCodecs.filter(l=>{var h;return ye(h=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(h,a)}),0===d.length&&(I.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),d=i.audioCodecs.filter(l=>{var h;return ye(h=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return d}let lP=class{get localCapabilities(){return Ft(this._localCapabilities)}get rtpCapabilities(){return Ft(this._rtpCapabilities)}get candidates(){return Ft(this._candidates)}get iceParameters(){return Ft(this._iceParameters)}get dtlsParameters(){return Ft(this._dtlsParameters)}constructor(s){S(this,"sessionDesc",void 0),S(this,"_localCapabilities",void 0),S(this,"_rtpCapabilities",void 0),S(this,"_candidates",void 0),S(this,"_iceParameters",void 0),S(this,"_dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname","o/i14u9pJrxRKAsu"),S(this,"firefoxSsrcMidMap",new Map),s=Ft(s);const{remoteIceParameters:i,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:d,localCapabilities:l,direction:h,setup:p,videoCodec:m,audioCodec:_}=s;let v;this.setup=p,v=Jt.parse(h===vi.RECEIVE_ONLY?"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n":"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=d,this._candidates=a,this._iceParameters=i,this._dtlsParameters=r,this._localCapabilities=l;const b=h===vi.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,y=h===vi.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,T=h===vi.RECEIVE_ONLY?d.send.videoCodecs:wu(Ce.VIDEO,b,y,m),M=h===vi.RECEIVE_ONLY?d.send.audioCodecs:wu(Ce.AUDIO,b,y,_);for(const O of v.mediaDescriptions){if(O.attributes.iceUfrag=i.iceUfrag,O.attributes.icePwd=i.icePwd,O.attributes.fingerprints=r.fingerprints,O.attributes.candidates=a,O.attributes.setup=this.setup,"application"===O.media.mediaType&&(O.attributes.sctpPort="5000"),"video"===O.media.mediaType&&(O.media.fmts=T.map(D=>D.payloadType.toString(10)),O.attributes.payloads=T,O.attributes.extmaps=b.videoExtensions,V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:D,ssrcGroups:x}=Hi([{ssrcId:4e4,rtx:V("USE_SUB_RTX")?40001:void 0}],this.cname);O.attributes.ssrcs=D,O.attributes.ssrcGroups=x}if("audio"===O.media.mediaType&&(O.media.fmts=M.map(D=>D.payloadType.toString(10)),O.attributes.payloads=M,O.attributes.extmaps=b.audioExtensions,_a(O),V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:D,ssrcGroups:x}=Hi([{ssrcId:2e4}],this.cname);O.attributes.ssrcs=D,O.attributes.ssrcGroups=x}}this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1}toString(){return Jt.print(this.sessionDesc)}hasMid(s){return Array.isArray(s)?s.every(i=>this.hasMid(i)):this.sessionDesc.mediaDescriptions.some(i=>i.attributes.mid===s)}send(s,i,r,a,d){r=r.replace(/ /g,"-");const{ssrcs:l,ssrcGroups:h}=Hi(i,this.cname,V("SYNC_GROUP")?r:void 0),p=this.findPreloadMediaDesc(l);if(p){if(Pt()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,p.attributes.mid),d&&(d.twcc||d.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(p,d),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(s,l,a);let _;return-1===m?(_=this.createOrRecycleSendMedia(s,l,h,"sendonly",a,d),this.updateBundleMids()):(_=Ft(this.sessionDesc.mediaDescriptions[m]),_.attributes.direction="sendonly",_.attributes.ssrcs=l,_.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(_,d)),Pt()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,_.attributes.mid),{needExchangeSDP:!0,mid:_.attributes.mid}}}stopSending(s){const i=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&-1!==s.indexOf(r.attributes.mid));if(i.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");i.forEach(r=>{r.attributes.ssrcs=[]}),this.updateBundleMids()}receive(s,i,r){const a=[];return s.forEach(d=>{const h=this.findAvailableRecvMediaIndex(d._mediaStreamTrack.kind);let p,m=!1;-1===h?(m=!0,p=this.createOrRecycleRecvMedia(d,[],"recvonly",i,r),this.updateBundleMids()):(p=Ft(this.sessionDesc.mediaDescriptions[h]),p.attributes.direction="recvonly"),a.push({mid:p.attributes.mid,needCreateTransceiver:m})}),a}stopReceiving(s){const i=this.sessionDesc.mediaDescriptions.filter(r=>-1!==s.indexOf(r.attributes.mid));if(i.length!==s.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");i.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(s){const{foundation:i,protocol:r,address:a,port:d,type:l,relatedAddress:h,relatedPort:p,priority:m}=new RTCIceCandidate(s),_={foundation:i??"",componentId:"1",transport:r??"",priority:m?m+"":"",connectionAddress:a??"",port:d?d+"":"",type:l?l+"":"",relAddr:h??"",relPort:p?p+"":"",extension:{}};this.candidates.some(v=>v.priority===_.priority&&v.connectionAddress===_.connectionAddress&&v.port===_.port)||(this._candidates.push(_),this.sessionDesc.mediaDescriptions.forEach(v=>{v.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(s,i,r,a,d){const l=s._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,p=wu(l,h,this.localCapabilities.send,l===Ce.AUDIO?d:a),m=l===Ce.VIDEO?h.videoExtensions:h.audioExtensions,_="".concat(++this.currentMidIndex);let v={media:{mediaType:l,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};v=this.mungRecvMediaDsec(v,s);const b=this.findFirstClosedMedia(l);if(b){const y=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[y]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}muteRemote(s){const i=this.sessionDesc.mediaDescriptions.filter(r=>ye(s).call(s,r.attributes.mid||""));if(i.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(s){const i=this.sessionDesc.mediaDescriptions.filter(r=>ye(s).call(s,r.attributes.mid||""));if(i.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(r=>{r.attributes.direction="recvonly"})}findAvailableMediaIndex(s,i,r){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const d=a.media.mediaType===s&&"0"!==a.media.port&&("sendonly"===a.attributes.direction||"sendrecv"===a.attributes.direction)&&0===a.attributes.ssrcs.length;if(Pt()){if(d){const l=this.firefoxSsrcMidMap.get(i[0].ssrcId);return!(l||"0"!==a.attributes.mid&&"1"!==a.attributes.mid)||!(!l||l!==a.attributes.mid)}return!1}return d&&a.attributes.mid===r})}findAvailableRecvMediaIndex(s){return this.sessionDesc.mediaDescriptions.findIndex(i=>"0"!==i.attributes.mid&&"1"!==i.attributes.mid&&i.media.mediaType===s&&"0"!==i.media.port&&("recvonly"===i.attributes.direction||"sendrecv"===i.attributes.direction))}predictReceivingMids(s){const i=[];for(let r=0;r<s;r++)i.push((this.currentMidIndex+r+1).toString(10));return i}restartICE(s){s=Ft(s),this._iceParameters=s,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=s.iceUfrag,i.attributes.icePwd=s.icePwd})}createOrRecycleSendMedia(s,i,r,a,d,l){const h=this.rtpCapabilities.send,p=s===Ce.VIDEO?h.videoCodecs:h.audioCodecs,m=s===Ce.VIDEO?h.videoExtensions:h.audioExtensions;Pt()&&(d="".concat(++this.currentMidIndex));let _={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:d}};_=this.mungSendMediaDesc(_,l);const v=this.findFirstClosedMedia(s);if(v){const b=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[b]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}mungRecvMediaDsec(s,i,r){const a=Ft(s);return eb(a),Xd(a,i),og(a,i),O0(a),Iu(a,r,this.localCapabilities.send),a}mungSendMediaDesc(s,i){const r=Ft(s);return Iu(r,i,this.localCapabilities.recv),_a(r),r}updateRecvMedia(s,i){const r=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===s);if(-1!==r){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],i);this.sessionDesc.mediaDescriptions[r]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(s=>"0"!==s.media.port).map(s=>s.attributes.mid)}findPreloadMediaDesc(s){return this.sessionDesc.mediaDescriptions.find(i=>{var r;return(null===(r=i.attributes)||void 0===r||null===(r=r.ssrcs[0])||void 0===r?void 0:r.ssrcId)===s[0].ssrcId})}findFirstClosedMedia(s){return this.sessionDesc.mediaDescriptions.find(i=>Pt()?"0"===i.media.port&&i.media.mediaType===s:"0"===i.media.port)}};const bF=["sdp"];function uP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Ru(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?uP(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):uP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}let vs=class Vb extends Sm{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,r;return null!==(i=null===(r=this.peerConnection.getReceivers()[0])||void 0===r||null===(r=r.transport)||void 0===r?void 0:r.state)&&void 0!==i?i:null}get localCodecs(){return[]}set isInRestartIce(i){this._isInRestartIce=i}get isInRestartIce(){return this._isInRestartIce}constructor(i,r,a){super(i,r),S(this,"direction",void 0),S(this,"name",void 0),S(this,"store",void 0),S(this,"spec",void 0),S(this,"peerConnection",void 0),S(this,"initialOffer",void 0),S(this,"transport",void 0),S(this,"statsFilter",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"localCandidateAddress",null),S(this,"useXR",V("USE_XR")),S(this,"filter",{filterRTX:!V("USE_PUB_RTX")&&!V("USE_SUB_RTX"),filterVideoFec:V("FILTER_VIDEO_FEC"),filterAudioFec:V("FILTER_AUDIO_FEC")}),S(this,"extension",{useXR:this.useXR}),S(this,"_isInRestartIce",!1),S(this,"mutex",new Ei("P2PConnection-mutex")),S(this,"onLocalCandidate",void 0),S(this,"remoteSDP",void 0),S(this,"pendingCandidates",[]),S(this,"localCapabilities",void 0),S(this,"isReady",!1),S(this,"restartCnt",0),S(this,"curTurnServerIndex",0),this.store=r,this.spec=i,this.peerConnection=new RTCPeerConnection(Vb.resolvePCConfiguration(i,r.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??vi.SEND_ONLY,this.name=this.direction===vi.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Op(this.peerConnection,V("STATS_UPDATE_INTERVAL"),void 0,Pt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}establish(i){var r=this;return L(function*(){try{const a=yield Jd(r.filter,r.extension);if(r.localCapabilities=oi(a),i){const{sdp:d}=i,l=function fo(s,i){if(null==s)return{};var r,a,d=function(h,p){if(null==h)return{};var m,_,v={},b=lF(h);for(_=0;_<b.length;_++)m=b[_],rP(p).call(p,m)>=0||(v[m]=h[m]);return v}(s,i);if(R0){var l=R0(s);for(a=0;a<l.length;a++)r=l[a],rP(i).call(i,r)>=0||Object.prototype.propertyIsEnumerable.call(s,r)&&(d[r]=s[r])}return d}(i,bF),h=function(){const b={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},y=ga(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},M={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ci(y,b,"videoExtensions",T,M,O),Ci(y,b,"videoCodecs",T,M,O),Ci(y,b,"audioExtensions",T,M,O),Ci(y,b,"audioCodecs",T,M,O),V("RAISE_H264_BASELINE_PRIORITY")){const D=O.videoCodecs.findIndex(x=>x.rtpMap&&"h264"===x.rtpMap.encodingName.toLocaleLowerCase()&&x.fmtp&&"42001f"===x.fmtp.parameters["profile-level-id"]);if(-1!==D){const x=O.videoCodecs.findIndex(F=>F.rtpMap&&"h264"===F.rtpMap.encodingName.toLocaleLowerCase());if(x<D){I.debug("raising H264 baseline profile priority");const F=O.videoCodecs[D];O.videoCodecs.splice(D,1),O.videoCodecs.splice(x,0,F)}-1!==x&&V("FILTER_SEND_H264_BASELINE")&&(T.videoCodecs=T.videoCodecs.filter(F=>!(F.rtpMap&&"h264"===F.rtpMap.encodingName.toLocaleLowerCase()&&F.fmtp&&"42001f"!==F.fmtp.parameters["profile-level-id"])))}}return{send:T,recv:M,sendrecv:O}}(r.filter,r.extension,d);r.remoteSDP=new lP({remoteIceParameters:l.iceParameters,remoteDtlsParameters:l.dtlsParameters,candidates:[],remoteRTPCapabilities:h,localCapabilities:r.localCapabilities,direction:r.direction,setup:"actpass",videoCodec:r.store.codec,audioCodec:r.store.audioCodec}),yield r.setRemoteDescription({type:"offer",sdp:r.remoteSDP.toString()}),r.isReady=!0;const p=yield r.peerConnection.createAnswer();if(!p.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Ks(p.sdp);yield r.peerConnection.setLocalDescription(p);const _=yield Hn(r.filter,r.extension,p.sdp);r.localCapabilities=oi(_);const v=r.peerConnection.getTransceivers()[0];return null!=v&&v.receiver&&v.receiver.transport&&r.tryBindTransportEvents(v.receiver.transport),Ru(Ru({},m),{},{sdp:p.sdp})}{r.peerConnection.addTransceiver("video",{direction:"sendonly"}),r.peerConnection.addTransceiver("audio",{direction:"sendonly"});const d=yield r.peerConnection.createOffer();if(!d.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const l=Ks(d.sdp);return r.initialOffer=d,Ru(Ru({},l),{},{sdp:d.sdp})}}catch(a){throw new ee(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}})()}connect(i){var r=this;return L(function*(){try{if(!r.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");yield r.peerConnection.setLocalDescription(r.initialOffer);const{sdp:a,iceParameters:d,dtlsParameters:l}=i,h=yield Hn(r.filter,r.extension,a);r.remoteSDP=new lP({remoteIceParameters:d,remoteDtlsParameters:l,candidates:[],remoteRTPCapabilities:h,localCapabilities:r.localCapabilities,direction:r.direction,setup:"active",videoCodec:r.store.codec,audioCodec:r.store.audioCodec}),yield r.setRemoteDescription({type:"answer",sdp:r.remoteSDP.toString()});const p=r.peerConnection.getTransceivers()[0];null!=p&&p.sender&&p.sender.transport&&r.tryBindTransportEvents(p.sender.transport)}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(a.toString()))}})()}addRemoteCandidate(i){var r=this;return L(function*(){try{i&&r.pendingCandidates.push(i),r.peerConnection.remoteDescription&&r.isReady&&(r.pendingCandidates.forEach(a=>{r.peerConnection.addIceCandidate(a)}),r.pendingCandidates=[])}catch(a){throw new ee(k.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(a.toString()))}})()}send(i,r,a){var d=this;return Xr(function*(){const l=yield Be(d.mutex.lock("From P2PConnection.send"));try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],p=d.remoteSDP.receive(i,r,a);i.forEach((D,x)=>{if(p[x].needCreateTransceiver){const F=d.peerConnection.addTransceiver(D._mediaStreamTrack,{direction:"sendonly"});h.push(F),D._updateRtpTransceiver(F)}else{const F=d.peerConnection.getTransceivers().find(j=>j.mid===p[x].mid);if(!F)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(p[x].mid));h.push(F),D._updateRtpTransceiver(F)}}),Pt()&&!0===V("SIMULCAST")&&(yield Be(d.applySimulcastForFirefox(h,i)));const m=p.map(D=>D.mid),_=yield Be(d.peerConnection.createOffer()),v=d.mungSendOfferSDP(_.sdp,i,m),b=Jt.parse(v),y=m.map(D=>{const x=b.mediaDescriptions.find(F=>F.attributes.mid===D);if(!x)throw new Error("Cannot extract ssrc from mediaDescription.");return Zv(x,V("USE_PUB_RTX"))}),T=h.map((D,x)=>({localSSRC:y[x],id:m[x]}));yield Be(d.peerConnection.setLocalDescription({type:"offer",sdp:v}));try{yield T}catch(D){const x=d.remoteSDP.toString();throw yield Be(d.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Be(d.peerConnection.setRemoteDescription({type:"answer",sdp:x})),yield Be(d.stopSending(m,!0)),D}yield Be(d.applySimulcastEncodings(h,i)),yield Be(d.applySendEncodings(h,i));const M=d.remoteSDP.toString(),O=d.logSDPExchange(v,"offer","local","send");return O?.(M),yield Be(d.setRemoteDescription({type:"answer",sdp:M})),h.map((D,x)=>({localSSRC:y[x],id:m[x]}))}catch(h){throw h instanceof ee?h:new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{l()}})()}stopSending(i,r){var a=this;return L(function*(){const d=r?void 0:yield a.mutex.lock("From P2PConnection.stopSending");try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const l=a.peerConnection.getTransceivers().filter(_=>-1!==i.indexOf(_.mid));if(l.length!==i.length)throw new Error("Transceivers' length (".concat(l.length,") doesn't match mids' length (").concat(i.length,") when trying to call P2PConnection.stopSending."));l.map(_=>{var v;_.direction="inactive",null===(v=_.stop)||void 0===v||v.call(_)});const h=yield a.peerConnection.createOffer(),p=a.logSDPExchange(h.sdp||"","offer","local","stopSending");yield a.peerConnection.setLocalDescription(h),a.remoteSDP.stopReceiving(i);const m=a.remoteSDP.toString();p?.(m),yield a.setRemoteDescription({type:"answer",sdp:m})}catch(l){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(l.toString()))}finally{d&&d()}})()}receive(i,r,a,d){var l=this;return L(function*(){try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=l.remoteSDP.send(i,r,a,d);if(p){const _=l.remoteSDP.toString(),v=l.logSDPExchange(_,"offer","remote","receive");yield l.setRemoteDescription({type:"offer",sdp:_});const b=yield l.peerConnection.createAnswer(),y=l.mungReceiveAnswerSDP(b.sdp,h,i);v?.(y||""),yield l.peerConnection.setLocalDescription({type:"answer",sdp:y}),I.debug("[".concat(l.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."))}else I.debug("[".concat(l.store.clientId,"] [P2PConnection] receive ").concat(i," no need to exchange SDP."));const m=l.peerConnection.getTransceivers().find(_=>_.mid===h);if(!m||null===m.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(h){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}mockReceive(i,r,a,d){var l=this;return L(function*(){try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=l.remoteSDP.send(i,r,a,d);if(p){const m=l.remoteSDP.toString(),_=l.logSDPExchange(m,"offer","remote","receive");yield l.setRemoteDescription({type:"offer",sdp:m});const v=yield l.peerConnection.createAnswer(),b=l.mungReceiveAnswerSDP(v.sdp,h,i);_?.(b||""),yield l.peerConnection.setLocalDescription({type:"answer",sdp:b}),I.debug("[".concat(l.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."))}else I.debug("[".concat(l.store.clientId,"] [P2PConnection] receive ").concat(i," no need to exchange SDP."))}catch(h){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}stopReceiving(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(i);const a=r.remoteSDP.toString(),d=r.logSDPExchange(a,"offer","remote","stopReceiving");yield r.setRemoteDescription({type:"offer",sdp:a});const l=yield r.peerConnection.createAnswer();d?.(l.sdp||""),yield r.peerConnection.setLocalDescription(l)}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}restartICE(i){var r=this;return L(function*(){try{if(r.store.p2pTransport===Pc.Auto&&(r.store.p2pTransport=Pc.SdRtn,Ot().supportPCSetConfiguration&&r.peerConnection.setConfiguration(Vb.resolvePCConfiguration(r.spec,r.store.p2pTransport))),r.restartCnt>3&&(r.restartCnt=0,Ot().supportPCSetConfiguration&&r.peerConnection.setConfiguration(Vb.resolvePCConfiguration(r.spec,r.store.p2pTransport,++r.curTurnServerIndex))),!i){r.restartCnt++,r.isReady=!1;const a=yield r.peerConnection.createOffer({iceRestart:!0});if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:d}=Ks(a.sdp);return r.store.descriptionStart(),r.direction===vi.SEND_ONLY&&(yield r.peerConnection.setLocalDescription(a)),d}if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(r.remoteSDP.restartICE(i),r.store.descriptionStart(),r.direction===vi.RECEIVE_ONLY){r.restartCnt++,yield r.setRemoteDescription({type:"offer",sdp:r.remoteSDP.toString()});const a=yield r.peerConnection.createAnswer();if(!a.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:d}=Ks(a.sdp);return yield r.peerConnection.setLocalDescription(a),d}yield r.setRemoteDescription({type:"answer",sdp:r.remoteSDP.toString()}),r.isReady=!0}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}close(){var i;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,r){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const d=yield a.peerConnection.createOffer(),l=a.mungSendOfferSDP(d.sdp,[r],[i]);a.remoteSDP.updateRecvMedia(i,r);const h=a.remoteSDP.toString(),p=a.logSDPExchange(l,"offer","local","updateEncoderConfig");yield a.peerConnection.setLocalDescription({type:"offer",sdp:l}),p?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(d){throw new ee(k.EXCHANGE_SDP_FAILED,d.toString())}})()}updateSendParameters(i,r){var a=this;return L(function*(){const d=a.peerConnection.getTransceivers().filter(l=>l.mid===i);1===d.length&&(a.isVP8Simulcast(r)?Pt()||(yield a.applySimulcastEncodings(d,[r])):yield a.applySendEncodings(d,[r]))})()}setStatsRemoteVideoIsReady(i,r){this.statsFilter.setVideoIsReady2(i,r)}replaceTrack(i,r){var a=this;return L(function*(){const d=a.peerConnection.getTransceivers().find(l=>l.mid===r);d&&(yield d.sender.replaceTrack(i._mediaStreamTrack))})()}getSelectedCandidatePair(){var i=this;return L(function*(){const r=i.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const a=r[0].transport.iceTransport,{local:d,remote:l}=a.getSelectedCandidatePair();return{local:Ru(Ru({},Ya),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port}),remote:Ru(Ru({},Ya),{},{candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port})}}return i.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i,r;ye(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)&&(this.isReady=!1),null===(r=this.onICEConnectionStateChange)||void 0===r||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;"connected"===this.peerConnection.connectionState&&(this.restartCnt=0),null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=i=>{var r;i.candidate?(i.candidate.candidate&&(this.localCandidateAddress=i.candidate.address,null===(r=this.onLocalCandidate)||void 0===r||r.call(this,i.candidate.toJSON())),this.localCandidateCount+=1):(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const d={iceServers:[]};var l;return i.iceServers?d.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(oa(i.turnServer.servers)?d.iceServers=i.turnServer.servers:(d.iceServers&&d.iceServers.push(...Vb.turnServerConfigToIceServers(i.turnServer.servers,r,a)),V("USE_TURN_SERVER_OF_GATEWAY")&&d.iceServers&&i.turnServer.serversFromGateway&&d.iceServers.push(...Vb.turnServerConfigToIceServers(i.turnServer.serversFromGateway,r,a)),ye(l=[Pc.Relay,Pc.SdRtn]).call(l,r)&&(d.iceTransportPolicy="relay"),V("FORCE_TURN_TCP")?d.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(d.iceTransportPolicy="relay")}))),V("ENABLE_ENCODED_TRANSFORM")&&Ot().supportWebRTCEncodedTransform&&(d.encodedInsertableStreams=!0),I.debug("P2PConnection p2pTransport is ".concat(r)),d}static turnServerConfigToIceServers(i,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const d=[],l=i.filter(p=>p.tcpport);I.debug("P2PConnection turnServers is ".concat(l,", current index is ").concat(a));const h=l.length>a?l[a]:l[0];switch(r){case Pc.SdRtn:const p=i.filter(_=>{var v;return ye(v=_.username).call(v,"glb:")&&_.turnServerURL==_.turnServerURL}),m=p.length>a?p[a]:p[0];m&&(d.push({username:m.username,credential:m.password,credentialType:"password",urls:"turn:".concat(Vd(m.turnServerURL),":").concat(m.tcpport,"?transport=udp")}),d.push({username:m.username,credential:m.password,credentialType:"password",urls:"turns:".concat(Vd(m.turnServerURL),":").concat(m.tcpport,"?transport=tcp")}));break;case Pc.Relay:h&&(d.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),d.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Vd(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(d.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),d.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Vd(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),d.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return d}tryBindTransportEvents(i){if(i){this.transport=i,i.onstatechange=()=>{var a;null!=i&&i.state&&(null===(a=this.onDTLSTransportStateChange)||void 0===a||a.call(this,i.state))},i.onerror=a=>{var d;null===(d=this.onDTLSTransportError)||void 0===d||d.call(this,"error"in a?a.error:a)};const r=i.iceTransport;r&&(r.onstatechange=()=>{const a=i?.iceTransport.state;var d;a&&(null===(d=this.onICETransportStateChange)||void 0===d||d.call(this,a))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:a,remote:d}=r.getSelectedCandidatePair();I.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(i,r){var a=this;return L(function*(){var d;if(r||(r=a.peerConnection.getSenders().find(b=>b.track===i._mediaStreamTrack)),!r)return I.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(a.isVP8Simulcast(i))return I.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ot().supportSetRtpSenderParameters)return I.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},h={};switch(i._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;default:l.degradationPreference="balanced"}if(i._encoderConfig){var p;const{bitrateMax:b,frameRate:y,scaleResolutionDownBy:T}=i._encoderConfig;b&&(h.maxBitrate=1e3*b),ye(p=i._hints).call(p,kt.LOW_STREAM)&&(y&&(h.maxFramerate=Po(y)),T&&T>=1&&(h.scaleResolutionDownBy=T))}if(V("DSCP_TYPE")&&wd()){var m;const b=V("DSCP_TYPE");ye(m=["very-low","low","medium","high"]).call(m,b)&&(h.networkPriority=b)}const _=r.getParameters(),v=null===(d=_.encodings)||void 0===d?void 0:d[0];Pt()&&!v&&(l.encodings=[h]),v&&Object.assign(v,h),Object.assign(_,l),I.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),yield r.setParameters(_)})()}applySendEncodings(i,r){var a=this;return L(function*(){try{if(!Ot().supportSetRtpSenderParameters||i.length!==r.length)return;for(let d=0;d<i.length;d++){const l=i[d],h=r[d];h instanceof je&&!a.isVP8Simulcast(h)&&(yield a.updateRtpSenderEncodings(h,l.sender))}}catch{I.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(i,r,a){const d=Jt.parse(i);return r.forEach((l,h)=>{const p=a[h],m=d.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(Xd(m,l),Np(m,l,this.store.codec))}),Jt.print(d)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,r,a)=>{var d;null===(d=this.onFirstVideoDecoded)||void 0===d||d.call(this,i,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(i,r){var a=this;return L(function*(){if(i.length===r.length)for(let _=0;_<i.length;_++){var d,l,h,p,m;const v=i[_],b=r[_];if(b instanceof je&&!ye(d=b._hints).call(d,kt.LOW_STREAM)&&null!==(l=b._encoderConfig)&&void 0!==l&&l.bitrateMax&&(null===(h=b._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=b._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=b._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===a.store.codec){const y={},T={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};y.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const M=v.sender.getParameters();yield v.sender.setParameters(Object.assign(M,y))}}})()}applySimulcastEncodings(i,r){var a=this;return L(function*(){if(!Pt()&&i.length===r.length)for(let d=0;d<i.length;d++){const l=r[d];if(l instanceof je&&a.isVP8Simulcast(l)){const h=i[d],p={},m={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=h.sender.getParameters();yield h.sender.setParameters(Object.assign(_,p))}}})()}isVP8Simulcast(i){var r,a,d,l,h;return!!(i instanceof je&&V("SIMULCAST")&&"vp8"===this.store.codec&&!ye(r=i._hints).call(r,kt.LOW_STREAM)&&null!==(a=i._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(d=i._encoderConfig)||void 0===d?void 0:d.bitrateMax)>200&&null!==(l=i._scalabilityMode)&&void 0!==l&&l.numSpatialLayers&&(null===(h=i._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(i,r,a,d){if(V("SDP_LOGGING"))return I.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(r," SDP during P2PConnection.").concat(d,"\n"),i),"offer"===r?l=>{this.logSDPExchange(l,"answer","local"===a?"remote":"local",d)}:void 0}muteLocal(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==i.indexOf(p.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(p=>{p.direction="inactive"});const d=yield r.peerConnection.createOffer(),l=r.logSDPExchange(d.sdp||"","offer","local","muteLocal");yield r.peerConnection.setLocalDescription(d),r.remoteSDP.muteRemote(i);const h=r.remoteSDP.toString();l?.(h),yield r.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==i.indexOf(p.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(function(){var p=L(function*(m){m.direction="sendonly"});return function(m){return p.apply(this,arguments)}}());const d=yield r.peerConnection.createOffer(),l=r.logSDPExchange(d.sdp||"","offer","local","unmuteLocal");yield r.peerConnection.setLocalDescription(d),r.remoteSDP.unmuteRemote(i);const h=r.remoteSDP.toString();l?.(h),yield r.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}getRemoteSSRC(i,r){var a=this;return L(function*(){var d,l;if(r=null!==(d=r)&&void 0!==d?d:null===(l=a.currentRemoteDescription)||void 0===l?void 0:l.sdp){var h;const p=null===(h=Jt.parse(r).mediaDescriptions.find(m=>m.attributes.mid===i))||void 0===h?void 0:h.attributes.ssrcs;return p?.[0].ssrcId}})()}setRemoteDescription(i){var r=this;return L(function*(){var a;yield r.peerConnection.setRemoteDescription(i),ye(a=["connected","completed"]).call(a,r.peerConnection.iceConnectionState)||(r.isReady=!0,r.addRemoteCandidate())})()}mungReceiveAnswerSDP(i,r,a){const d=Jt.parse(i),l=d.mediaDescriptions.find(h=>h.attributes.mid===r);return l&&(a===Ce.AUDIO&&"audio"===l.media.mediaType&&_a(l),this.useXR&&sg(d)),Jt.print(d)}};function mo(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=L(function*(){const d=this.mutex,l=yield d.lock("From P2PConnection.".concat(i));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{l()}}),r}function Pp(s,i){let r=document.createElement("video"),a=document.createElement("canvas");r.setAttribute("style","display:none"),a.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),a.width=Po(i.width),a.height=Po(i.height);const d=Po(i.framerate||15);document.body.append(r),document.body.append(a);let l=s._mediaStreamTrack;r.srcObject=new MediaStream([l]),r.play();const h=a.getContext("2d");if(!h)throw new W(k.UNEXPECTED_ERROR,"can not get canvas context");const p=Ot(),m=a.captureStream(p.supportRequestFrame?0:d).getVideoTracks()[0];m.canvas||(m.canvas=a),a.startCapture=()=>{if(!r)return a.stopCapture&&a.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){const y=a.width*(r.videoHeight/r.videoWidth);Math.abs(y-a.height)>=2&&(I.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(y)),a.height=y)}h.drawImage(r,0,0,a.width,a.height),m.requestFrame&&m.requestFrame(),l!==s._mediaStreamTrack&&(l=s._mediaStreamTrack,r.srcObject=new MediaStream([l]))},a.stopCapture=FT(()=>a.startCapture&&a.startCapture(),d);const _=m.stop;return m.stop=()=>{_.call(m),r&&(r.remove(),r.srcObject=null,r=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),I.debug("clean low stream renderer")},m}var Qd,bs,$n,Au,er,ag,N0,Xc,jo,P0,Ho;ne([mo,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],vs.prototype,"establish",null),ne([mo,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],vs.prototype,"connect",null),ne([mo,N("design:type",Function),N("design:paramtypes",[String,Array,String,String]),N("design:returntype",X)],vs.prototype,"receive",null),ne([mo,N("design:type",Function),N("design:paramtypes",[String,Array,String,String]),N("design:returntype",X)],vs.prototype,"mockReceive",null),ne([mo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],vs.prototype,"stopReceiving",null),ne([mo,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],vs.prototype,"restartICE",null),ne([mo,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],vs.prototype,"close",null),ne([mo,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],vs.prototype,"updateEncoderConfig",null),ne([mo,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],vs.prototype,"updateSendParameters",null),ne([mo,N("design:type",Function),N("design:paramtypes",[Bi,String]),N("design:returntype",X)],vs.prototype,"replaceTrack",null),ne([mo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],vs.prototype,"muteLocal",null),ne([mo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],vs.prototype,"unmuteLocal",null),function(s){s[s.HEIGHT=2033]="HEIGHT",s[s.FRAME_RATE=2034]="FRAME_RATE",s[s.WIDTH=2035]="WIDTH"}(Qd||(Qd={})),function(s){s[s.HEIGHT=2072]="HEIGHT",s[s.FRAME_RATE=2074]="FRAME_RATE",s[s.WIDTH=2076]="WIDTH"}(bs||(bs={})),function(s){s[s.FRAME_RATE=2002]="FRAME_RATE",s[s.WIDTH=2003]="WIDTH",s[s.HEIGHT=2004]="HEIGHT",s[s.PACKAGE_LOST=2005]="PACKAGE_LOST",s[s.AVG_ENCODE=2007]="AVG_ENCODE",s[s.NACKS=2009]="NACKS",s[s.PLIS=2010]="PLIS",s[s.FIRS=2011]="FIRS",s[s.BITRATE=2012]="BITRATE",s[s.PACKAGE_RATE=2031]="PACKAGE_RATE",s[s.ADAPTATION=2032]="ADAPTATION",s[s.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",s[s.BANDWIDTH=2061]="BANDWIDTH",s[s.RETRANSMIT=2062]="RETRANSMIT",s[s.TARGET_ENCODED=2064]="TARGET_ENCODED",s[s.TRANSMIT=2066]="TRANSMIT",s[s.FREEZE=2082]="FREEZE",s[s.DISABLED=2095]="DISABLED",s[s.PLAYER_STATUS=2128]="PLAYER_STATUS",s[s.QP_SUM=2143]="QP_SUM"}($n||($n={})),function(s){s[s.BITRATE=2069]="BITRATE",s[s.PACKAGE_LOST=2070]="PACKAGE_LOST",s[s.PACKAGE_RATE=2071]="PACKAGE_RATE",s[s.HEIGHT=2073]="HEIGHT",s[s.FRAME_RATE=2075]="FRAME_RATE",s[s.WIDTH=2077]="WIDTH"}(Au||(Au={})),function(s){s[s.JITTER=-1]="JITTER",s[s.PACKAGE_LOST=2014]="PACKAGE_LOST",s[s.WIDTH=2018]="WIDTH",s[s.HEIGHT=2019]="HEIGHT",s[s.FRAME_RATE=2020]="FRAME_RATE",s[s.JITTER_BUFFER=2023]="JITTER_BUFFER",s[s.CURRENT_DELAY=2024]="CURRENT_DELAY",s[s.NACKS=2026]="NACKS",s[s.PLIS=2027]="PLIS",s[s.FIRS=2028]="FIRS",s[s.BITRATE=2029]="BITRATE",s[s.PACKAGE_RATE=2078]="PACKAGE_RATE",s[s.FREEZE=2084]="FREEZE",s[s.DISABLED=2101]="DISABLED",s[s.PLAYER_STATUS=2129]="PLAYER_STATUS",s[s.QP_SUM=2144]="QP_SUM",s[s.I_FRAME_DELAY=2149]="I_FRAME_DELAY"}(er||(er={})),function(s){s[s.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",s[s.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",s[s.FREEZE_TIME=2109]="FREEZE_TIME",s[s.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER"}(ag||(ag={})),function(s){s[s.PCM_LEVEL=2104]="PCM_LEVEL"}(N0||(N0={})),function(s){s[s.PACKAGE_LOST=-1]="PACKAGE_LOST",s[s.LEVEL=2038]="LEVEL",s[s.BITRATE=2039]="BITRATE",s[s.PACKAGE_RATE=2040]="PACKAGE_RATE",s[s.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",s[s.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",s[s.FREEZE=2081]="FREEZE",s[s.DISABLED=2096]="DISABLED"}(Xc||(Xc={})),function(s){s[s.BITRATE=2044]="BITRATE",s[s.PACKAGE_LOST=2045]="PACKAGE_LOST",s[s.PACKAGE_RATE=2046]="PACKAGE_RATE",s[s.CURRENT_DELAY=2047]="CURRENT_DELAY",s[s.JITTER_BUFFER=2054]="JITTER_BUFFER",s[s.JITTER=2055]="JITTER",s[s.FREEZE=2083]="FREEZE",s[s.DISABLED=2102]="DISABLED",s[s.PCM_LEVEL=2105]="PCM_LEVEL",s[s.PLAYER_STATUS=2130]="PLAYER_STATUS",s[s.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES"}(jo||(jo={})),function(s){s[s.FREEZE_TIME=-1]="FREEZE_TIME",s[s.LEVEL=2043]="LEVEL"}(P0||(P0={})),function(s){s[s.RTT=2006]="RTT",s[s.CONN_TYPE=801]="CONN_TYPE"}(Ho||(Ho={}));const Zd=1e3;function Ge(s,i,r){null!=r&&Number.isFinite(r)&&(s[i]=Math.round(Math.max(0,r)))}function hP(s){const i={[Ho.CONN_TYPE]:0,[Ho.RTT]:s.rtt};switch(s.selectedCandidatePair.localCandidate.candidateType){case"relay":{const r=s.selectedCandidatePair.localCandidate.relayProtocol;"udp"===r&&(i[Ho.CONN_TYPE]=1),"tcp"===r&&(i[Ho.CONN_TYPE]=3),"tls"===r&&(i[Ho.CONN_TYPE]=4);break}case"srflx":i[Ho.CONN_TYPE]=2}return i}class pP extends jt{constructor(i){super(),S(this,"store",void 0),S(this,"uploadWRTCStatsTimer",void 0),S(this,"uploadOutboundDenoiserStatsTimer",void 0),S(this,"uploadExtStatsTimer",void 0),S(this,"uploadExtUsageStatsTimer",void 0),S(this,"uploadInboundExtStatsTimer",void 0),S(this,"requestStats",void 0),S(this,"requestTransportStats",void 0),S(this,"requestLocalMedia",void 0),S(this,"requestRemoteMedia",void 0),S(this,"requestAllTracks",void 0),S(this,"requestVideoIsReady",void 0),S(this,"requestUploadStats",void 0),S(this,"requestUpload",void 0),S(this,"uploadOutboundStarted",!1),S(this,"uploadInboundStarted",!1),S(this,"uploadTransportStarted",!1),S(this,"uploadExtensionUsageStarted",!1),S(this,"lastRecvStats",void 0),S(this,"lastSendStats",void 0),S(this,"lastFullRecvStats",void 0),S(this,"lastFullSendStats",void 0),S(this,"needUploadRenderFreezeTime",!0),this.store=i}uploadWRTCStats(i){if(!this.requestStats||!this.requestUploadStats)return;let r,a;if(this.uploadTransportStarted&&(r=this.requestStats(),this.store.useP2P&&(a=this.requestStats(!0))),!r&&this.uploadOutboundStarted&&(r=this.requestStats()),!a&&this.uploadInboundStarted&&(a=this.requestStats(!0)),r||a){const d={};if(this.uploadTransportStarted&&r){const l=this.getTransportStats(r,a,i);l&&(d.misc=[l])}if(this.uploadOutboundStarted&&r){const l=this.getOutboundStats(r,i?this.lastSendStats:this.lastFullSendStats,i);l&&(d.outbound=[l])}if(this.uploadInboundStarted&&a){const l=this.getInboundStats(a,i?this.lastRecvStats:this.lastFullRecvStats,i);l&&(d.inbound=l)}this.requestUploadStats(d)}this.lastRecvStats=a,this.lastSendStats=r,i||(this.lastFullRecvStats=a,this.lastFullSendStats=r)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let i=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(3!==i),4==++i&&(i=1)},Zd)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(i,r,a){if(!this.requestStats)return;if(a)return null==i.rtt?void 0:{addition:{[Ho.RTT]:i.rtt,[Ho.CONN_TYPE]:void 0}};const d=hP(i);if(this.store.useP2P){if(r){const l=hP(r);d[Ho.CONN_TYPE]+=l[Ho.CONN_TYPE]<<3}d[Ho.CONN_TYPE]+=110}else d[Ho.CONN_TYPE]+=100;return{addition:d}}getOutboundStats(i,r,a){if(!this.requestUploadStats||!this.requestLocalMedia)return;const d=this.requestLocalMedia();if(!d||0===d.length)return;let l,h,p;return d.forEach(m=>{let[_,{track:v,ssrcs:b}]=m;switch(_){case re.LocalVideoLowTrack:case re.LocalVideoTrack:if(_===re.LocalVideoTrack){const y=function(O,D,x,F,j){const q=D.videoSend.find(z=>z.ssrc===O);if(!q)return;const te={},{sentFrame:K,inputFrame:Q}=q;if(Q&&K&&(te[$n.FREEZE]=function(me,Fe){let rt=!0;return rt=!(me<=5)&&(me<=10?Fe<3:me<=20?Fe<4:Fe<5),rt}(Q.frameRate,K.frameRate)?1:0),Ge(te,$n.QP_SUM,q.qpSumPerFrame),j)return te;switch(K&&(Ge(te,$n.HEIGHT,K.height),Ge(te,$n.WIDTH,K.width),Ge(te,$n.FRAME_RATE,K.frameRate)),te[$n.DISABLED]=F._originMediaStreamTrack&&!F._originMediaStreamTrack.enabled||F._mediaStreamTrack&&!F._mediaStreamTrack.enabled?1:0,q.adaptionChangeReason){case"none":te[$n.ADAPTATION]=0;break;case"cpu":te[$n.ADAPTATION]=1;break;case"bandwidth":te[$n.ADAPTATION]=2;break;case"other":te[$n.ADAPTATION]=3}te[$n.PLAYER_STATUS]=Um[F._player?F._player.videoElementStatus:"uninit"],Ge(te,$n.NACKS,q.nacksCount),Ge(te,$n.PLIS,q.plisCount),Ge(te,$n.FIRS,q.firsCount),Ge(te,$n.AVG_ENCODE,q.avgEncodeMs);const $=x&&x.videoSend.find(z=>z.ssrc===O);if($){let z=j?Zd:3e3;$.timestamp&&q.timestamp&&(z=q.timestamp-$.timestamp),null!=$.packets&&null!=q.packets&&Ge(te,$n.PACKAGE_RATE,1e3*(q.packets-$.packets)/z),null!=q.packetsLost&&null!=$.packetsLost&&Ge(te,$n.PACKAGE_LOST,q.packetsLost-$.packetsLost),null!=$.bytes&&null!=q.bytes&&Ge(te,$n.BITRATE,8*(q.bytes-$.bytes)/z)}return te}(b[0].ssrcId,i,r,v,a),T=a?null:function(O,D,x){const F=D.videoSend.find($=>$.ssrc===O);if(!F)return null;const j={},q=F.inputFrame,K=q&&q.width||x&&x._videoWidth||0,Q=q&&q.frameRate||0;return Ge(j,Qd.HEIGHT,q&&q.height||x&&x._videoHeight||0),Ge(j,Qd.WIDTH,K),Ge(j,Qd.FRAME_RATE,Q),j}(b[0].ssrcId,i,v),M=a?null:function(O){const D={};return Ge(D,$n.RETRANSMIT,O.bitrate.retransmit),Ge(D,$n.TARGET_ENCODED,O.bitrate.targetEncoded),Ge(D,$n.ACTUAL_ENCODED,O.bitrate.actualEncoded),Ge(D,$n.TRANSMIT,O.bitrate.transmit),Ge(D,$n.BANDWIDTH,O.sendBandwidth),D}(i);h=Object.assign({},y,T,M)}else p=a?void 0:function(y,T,M){const O=T.videoSend.find(F=>F.ssrc===y);if(!O)return;const D={},x=O.sentFrame;if(x&&(Ge(D,Au.HEIGHT,x.height),Ge(D,Au.WIDTH,x.width),Ge(D,Au.FRAME_RATE,x.frameRate)),M){const F=M.videoSend.find(j=>j.ssrc===y);if(F){let j=3e3;F.timestamp&&O.timestamp&&(j=O.timestamp-F.timestamp),null!=F.packets&&null!=O.packets&&Ge(D,Au.PACKAGE_RATE,1e3*(O.packets-F.packets)/j),null!=O.packetsLost&&null!=F.packetsLost&&Ge(D,Au.PACKAGE_LOST,O.packetsLost-F.packetsLost),null!=F.bytes&&null!=O.bytes&&Ge(D,Au.BITRATE,8*(O.bytes-F.bytes)/j)}}return D}(b[0].ssrcId,i,r);break;case re.LocalAudioTrack:l=a?void 0:function(y,T,M,O){const D=T.audioSend.find(te=>te.ssrc===y);if(!D)return;const x={};x[Xc.DISABLED]=O._originMediaStreamTrack&&!O._originMediaStreamTrack.enabled||O._mediaStreamTrack&&!O._mediaStreamTrack.enabled?1:0;const F=O._source.getAccurateVolumeLevel();Ge(x,Xc.LEVEL,100*(D.inputLevel??F)),Ge(x,N0.PCM_LEVEL,100*F),Ge(x,Xc.AEC_RETURN_LOSS,D.aecReturnLoss),Ge(x,Xc.AEC_RETURN_LOSS_ENH,D.aecReturnLossEnhancement),x[Xc.FREEZE]=0;const q=M&&M.audioSend.find(te=>te.ssrc===y);if(q){let te=3e3;q.timestamp&&D.timestamp&&(te=D.timestamp-q.timestamp),null!=q.bytes&&null!=D.bytes&&Ge(x,Xc.BITRATE,8*(D.bytes-q.bytes)/te),null!=q.packets&&null!=D.packets&&Ge(x,Xc.PACKAGE_RATE,1e3*(D.packets-q.packets)/te)}return x}(b[0].ssrcId,i,r,v)}}),{high:h,low:p,audio:l}}getInboundStats(i,r,a){if(!this.requestRemoteMedia)return;const d=this.requestRemoteMedia()||[],l=[];return d.forEach(h=>{let[p,m]=h;const _={peer:p.uid};if(m.has(Ce.VIDEO)&&p.videoTrack){const v=p._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(p._videoSSRC)||!1,b=p.videoTrack?function(y,T,M,O,D,x,F){const j=T.videoRecv.find(z=>z.ssrc===y);if(!j)return;const q={},{receivedFrame:te,outputFrame:K,decodeFrameRate:Q}=j,$=M&&M.videoRecv.find(z=>z.ssrc===y);if(q[er.FREEZE]=D&&Cs.isRemoteVideoFreeze(O,j,$)?1:0,Ge(q,ag.FRAME_RATE_DECODE,Q),Ge(q,er.QP_SUM,j.qpSumPerFrame),j.framesRateFirefox&&Ge(q,er.FRAME_RATE,j.framesRateFirefox),te&&Ge(q,er.FRAME_RATE,te.frameRate),$){const z=T.timestamp-M.timestamp||(F?Zd:3e3);null!=j.packetsLost&&null!=$.packetsLost&&Ge(q,er.PACKAGE_LOST,j.packetsLost-$.packetsLost),null!=$.bytes&&null!=j.bytes&&Ge(q,er.BITRATE,8*(j.bytes-$.bytes)/z),null!=$.packets&&null!=j.packets&&Ge(q,er.PACKAGE_RATE,1e3*(j.packets-$.packets)/z)}if(F)return q;if(te?(Ge(q,er.HEIGHT,te.height),Ge(q,er.WIDTH,te.width)):O&&(Ge(q,er.HEIGHT,O._videoHeight||0),Ge(q,er.WIDTH,O._videoWidth||0)),K&&Ge(q,ag.FRAME_RATE_RENDER,K.frameRate),Ge(q,er.JITTER_BUFFER,j.jitterBufferMs),Ge(q,er.CURRENT_DELAY,j.currentDelayMs),Ge(q,er.FIRS,j.firsCount),Ge(q,er.NACKS,j.nacksCount),Ge(q,er.PLIS,j.plisCount),O){q[er.DISABLED]=O._originMediaStreamTrack.enabled&&O._mediaStreamTrack.enabled?0:1;const z=O._player;if(z){const{freezeTimeCounterList:_e,renderFreezeAccTime:me}=z;if(_e&&_e.length>0&&Ge(q,ag.FREEZE_TIME,_e.splice(0,1)[0]),x&&"visible"===Gc.visibility){const Fe=Math.min(6e3,me);z.renderFreezeAccTime=Math.max(0,me-Fe),Ge(q,ag.FREEZE_TIME_RENDER,Fe)}}}if(q[er.PLAYER_STATUS]=Um[O._player?O._player.videoElementStatus:"uninit"],$&&void 0!==j.totalInterFrameDelay&&void 0!==j.totalSquaredInterFrameDelay&&void 0!==$.totalInterFrameDelay&&void 0!==$.totalSquaredInterFrameDelay){const z=j.totalInterFrameDelay-$.totalInterFrameDelay,me=j.framesDecodeCount-$.framesDecodeCount,Fe=z/me*1e3,rt=Math.round(1e3*Math.sqrt((j.totalSquaredInterFrameDelay-$.totalSquaredInterFrameDelay-Math.pow(z,2)/me)/me));!isNaN(rt)&&Fe+rt>Math.max(3*Fe,Fe+150)&&(q[er.I_FRAME_DELAY]=rt)}return q}(p._videoSSRC,i,r,p.videoTrack,!0===v,this.needUploadRenderFreezeTime,a):void 0;b&&(_.video=b)}if(m.has(Ce.AUDIO)&&p.audioTrack){const v=p.audioTrack?function(b,y,T,M,O){const D=y.audioRecv.find(z=>z.ssrc===b);if(!D)return;const x={},F=T&&T.audioRecv.find(z=>z.ssrc===b),{receivedFrames:j,droppedFrames:q}=D;var te;if(Ge(x,jo.JITTER,D.jitterMs),null!=j&&null!=q&&(x[jo.FREEZE]=0===(te=j)||100*q/te>20?1:0),F){const z=y.timestamp-T.timestamp||(O?Zd:3e3);null!=D.packets&&null!=F.packets&&Ge(x,jo.PACKAGE_RATE,1e3*(D.packets-F.packets)/z),null!=F.bytes&&null!=D.bytes&&Ge(x,jo.BITRATE,8*(D.bytes-F.bytes)/z),null!=D.packetsLost&&null!=F.packetsLost&&Ge(x,jo.PACKAGE_LOST,D.packetsLost-F.packetsLost)}if(O)return x;const Q=M._source.getAccurateVolumeLevel();if(Ge(x,P0.LEVEL,100*(D.outputLevel??Q)),Ge(x,jo.PCM_LEVEL,100*Q),M&&(x[jo.DISABLED]=M._originMediaStreamTrack.enabled&&M._mediaStreamTrack.enabled?0:1),Ge(x,jo.JITTER_BUFFER,D.jitterBufferMs),Ge(x,jo.CURRENT_DELAY,D.jitterBufferMs),x[jo.PLAYER_STATUS]=Um[Mr.getPlayerState(M.getTrackId())],F){const z=D.concealedSamples-F.concealedSamples;z>0&&Ge(x,jo.CONCEALED_SAMPLES,z)}return x}(p._audioSSRC,i,r,p.audioTrack,a):void 0;v&&(_.audio=v)}(_.video||_.audio)&&l.push(_)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,l}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const i=(this.requestAllTracks()||[]).find(r=>r instanceof ji);if(i&&i._external.getDenoiserStats){const r=i._external.getDenoiserStats();r&&this.requestUpload(xc.DENOISER_STATS,r)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(i=>{i.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(i=>{let[r,a]=i;a.has(Ce.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach(d=>{this.requestUpload&&this.requestUpload(d.type,d.stats)}),a.has(Ce.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach(d=>{this.requestUpload&&this.requestUpload(d.type,d.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){var i=this;if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(L(function*(){const a=Date.now(),d={connectionInterval:V("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:a};let l=[];const h=i.requestAllTracks&&i.requestAllTracks()||[];for(const v of h)!v.muted&&v.enabled&&(l=l.concat(yield v.getProcessorUsage()));const p=i.requestRemoteMedia&&i.requestRemoteMedia()||[];for(const[v,b]of p)b.has(Ce.VIDEO)&&v.videoTrack&&(l=l.concat(yield v.videoTrack.getProcessorUsage())),b.has(Ce.AUDIO)&&v.audioTrack&&(l=l.concat(yield v.audioTrack.getProcessorUsage()));if(0===l.length)return;d.details=function(v,b){const y={};for(const{id:D,value:x,level:F,direction:j}of v){var T;const q=null!==(T=b.get(D))&&void 0!==T?T:0,te=2===x?q+V("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:q;var M,O;b.set(D,te),y[D]?(2===x&&(y[D].value=x),F>y[D].level&&(y[D].level=F),"remote"===j&&(y[D].remoteUidCount+=1),y[D].totalTs=null!==(M=b.get(D))&&void 0!==M?M:0):y[D]={value:x,level:F,remoteUidCount:"local"===j?0:1,totalTs:null!==(O=b.get(D))&&void 0!==O?O:0}}return Object.keys(y).map(D=>{const{level:x,value:F,totalTs:j}=y[D];return{id:D,level:x,value:F,totalTs:j}})}(l,r);const m=Date.now();i.requestUpload&&i.requestUpload(xc.EXTENSION_USAGE_STATS,{usageStats:d,sendTs:m>a?m:a+1})}),V("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class Ii{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(i,r){S(this,"uid",void 0),S(this,"_uintid",void 0),S(this,"_trust_in_room_",!0),S(this,"_trust_audio_enabled_state_",!0),S(this,"_trust_video_enabled_state_",!0),S(this,"_trust_audio_mute_state_",!0),S(this,"_trust_video_mute_state_",!0),S(this,"_audio_muted_",!1),S(this,"_video_muted_",!1),S(this,"_audio_enabled_",!0),S(this,"_video_enabled_",!0),S(this,"_audio_added_",!1),S(this,"_video_added_",!1),S(this,"_is_pre_created",!1),S(this,"_video_pre_subscribed",!1),S(this,"_audio_pre_subscribed",!1),S(this,"_trust_video_stream_added_state_",!0),S(this,"_trust_audio_stream_added_state_",!0),S(this,"_audioTrack",void 0),S(this,"_videoTrack",void 0),S(this,"_dataChannels",[]),S(this,"_audioSSRC",void 0),S(this,"_videoSSRC",void 0),S(this,"_audioOrtc",void 0),S(this,"_videoOrtc",void 0),S(this,"_cname",void 0),S(this,"_rtxSsrcId",void 0),S(this,"_videoMid",void 0),S(this,"_audioMid",void 0),this.uid=i,this._uintid=r}}var ys;function tb(s,i){var r;let a;switch(i){case re.LocalAudioTrack:a=ut.Audio;break;case re.LocalVideoTrack:a=ye(r=s._hints).call(r,kt.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:a=ut.Low}return a}function fP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function qs(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?fP(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):fP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}!function(s){s.SEND_ONLY="SEND_ONLY",s.RECEIVE_ONLY="RECEIVE_ONLY"}(ys||(ys={}));class Je extends jt{get state(){return this._state}set state(i){const r=this._state;this._state=i,this.emit(Oe.StateChange,r,this._state)}constructor(i,r){var a;super(),a=this,S(this,"store",void 0),S(this,"statsUploader",void 0),S(this,"sendConnection",void 0),S(this,"recvConnection",void 0),S(this,"localTrackMap",new Map),S(this,"remoteUserMap",new Map),S(this,"localDataChannels",[]),S(this,"pendingLocalTracks",[]),S(this,"pendingRemoteTracks",[]),S(this,"statsCollector",void 0),S(this,"dtlsFailedCount",0),S(this,"sendMutex",new Ei("P2PChannel2-send-mutex")),S(this,"recvMutex",new Ei("P2PChannel2-recv-mutex")),S(this,"_state",Dt.Disconnected),S(this,"_restartStates",["disconnected","failed"]),S(this,"reconnectInterval",void 0),S(this,"uploadUnplinkStarted",!1),S(this,"uploadDownlinkStarted",!1),S(this,"uplinkStateUploadInterval",void 0),S(this,"downlinkStatsUploadInterval",void 0),S(this,"handleMuteLocalTrack",function(){var d=L(function*(l,h,p){const m=yield a.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!a.sendConnection||a.state!==Dt.Connected)return void p(new ee(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const b=a.filterTobeMutedTracks(l);if(0===b.length)return void h();const y=b.find(D=>"videoLowTrack"===D[0]);y&&y[1].track._originMediaStreamTrack.stop(),yield a.sendConnection.muteLocal(b.map(D=>{let[,{id:x}]=D;return x}));let T=!1;var _,v;T="video"===l.trackMediaType?!(null===(_=a.localTrackMap.get(re.LocalAudioTrack))||void 0===_||!_.track._muted):void 0===(null===(v=a.localTrackMap.get(re.LocalVideoTrack))||void 0===v?void 0:v.id);const M=a.createMuteMessage(b);yield Tt(a,Oe.RequestMuteLocal,M);const O="video"===l.trackMediaType?Uc.MUTE_LOCAL_VIDEO:Uc.MUTE_LOCAL_AUDIO;yield Tt(a,Oe.RequestP2PMuteLocal,{action:O,message:M,isMuteAll:T}),h()}catch(b){p(b)}finally{m()}});return function(l,h,p){return d.apply(this,arguments)}}()),S(this,"handleUnmuteLocalTrack",function(){var d=L(function*(l,h,p){const m=yield a.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!a.sendConnection||a.state!==Dt.Connected)return void p(new ee(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const _=a.filterTobeUnmutedTracks(l);if(0===_.length)return void h();yield a.sendConnection.unmuteLocal(_.map(y=>{let[,{id:T}]=y;return T}));const v=a.createUnmuteMessage(_),b="video"===l.trackMediaType?Uc.UNMUTE_LOCAL_VIDEO:Uc.UNMUTE_LOCAL_AUDIO;yield Tt(a,Oe.RequestP2PMuteLocal,{action:b,message:v}),h()}catch(_){p(_)}finally{m()}});return function(l,h,p){return d.apply(this,arguments)}}()),S(this,"handleUpdateVideoEncoder",function(){var d=L(function*(l,h,p){const m=yield a.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const _=a.localTrackMap.get(re.LocalVideoTrack);if(!a.sendConnection||!_||_.track!==l||a.state!==Dt.Connected)return void h();const{id:v,track:b}=_;v&&(yield a.sendConnection.updateSendParameters(v,b),yield a.sendConnection.updateEncoderConfig(v,b),a.emit(Oe.UpdateVideoEncoder,b)),h()}catch(_){p(_)}finally{m()}});return function(l,h,p){return d.apply(this,arguments)}}()),S(this,"handleSetOptimizationMode",function(){var d=L(function*(l,h,p){const m=yield a.sendMutex.lock("Locking from P2PChannel2.handleSetOptimizationMode");try{const _=a.localTrackMap.get(re.LocalVideoTrack);if(!a.sendConnection||!_||_.track!==l||a.state!==Dt.Connected)return;const{id:v,track:b}=_;v&&(yield a.sendConnection.updateSendParameters(v,b)),h()}catch(_){p(_)}finally{m()}});return function(l,h,p){return d.apply(this,arguments)}}()),S(this,"handleReplaceTrack",function(){var d=L(function*(l,h,p,m){let _;I.debug("[".concat(a.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(l.getTrackId(),"]")),"boolean"==typeof m&&m||(_=yield a.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var v;const y=Array.from(a.localTrackMap.entries()).find(T=>{let[,{track:M}]=T;return l===M});if(!a.sendConnection||!y||void 0===y[1].id||a.state!==Dt.Connected)return void h();if(yield null===(v=a.sendConnection)||void 0===v?void 0:v.replaceTrack(l,y[1].id),y[0]===re.LocalVideoTrack&&Ot().supportDualStreamEncoding){const T=a.localTrackMap.get(re.LocalVideoLowTrack);if(T){const M=l._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=M,T.track._originMediaStreamTrack=M,yield new X((O,D)=>{a.handleReplaceTrack(T.track,O,D,!0)})}}h()}catch(y){p(y)}finally{var b;null===(b=_)||void 0===b||b()}});return function(l,h,p,m){return d.apply(this,arguments)}}()),S(this,"handleGetLocalVideoStats",d=>{d(this.statsCollector.getLocalVideoTrackStats())}),S(this,"handleGetLocalAudioStats",d=>{d(this.statsCollector.getLocalAudioTrackStats())}),S(this,"handleGetRemoteVideoStats",d=>this.statsCollector.getRemoteVideoTrackStats(d.uid)[d.uid]),S(this,"handleGetRemoteAudioStats",d=>this.statsCollector.getRemoteAudioTrackStats(d.uid)[d.uid]),this.store=i,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new pP(i),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(d=>{d&&("disconnected"!==d.iceConnectionState&&"failed"!==d.iceConnectionState||this.handleDisconnect(d.direction))})},V("ICE_RESTART_INTERVAL"))}startP2PConnection(i,r){return L(function*(){throw new ee(k.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")})()}connect(i,r,a,d,l,h){return L(function*(){throw new ee(k.NOT_SUPPORTED,"p2p mode does not support connect.")})()}startP2P(i,r){var a=this;return L(function*(){let d;try{if(r){a.recvConnection&&(I.warning("[".concat(a.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),a.recvConnection.close(),a.unbindConnectionEvents(a.recvConnection)),d=yield a.recvMutex.lock("From P2PChannel.startP2P"),a.recvConnection=new vs(i,a.store,vi.RECEIVE_ONLY),a.bindConnectionEvents(a.recvConnection);const l=yield a.recvConnection.establish(r);return{iceParameters:l.iceParameters,dtlsParameters:l.dtlsParameters,sdp:l.sdp}}{a.state=Dt.New,a.sendConnection&&(I.warning("[".concat(a.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),a.sendConnection.close(),a.unbindConnectionEvents(a.sendConnection)),d=yield a.sendMutex.lock("From P2PChannel.startP2P"),a.sendConnection=new vs(i,a.store),a.store.peerConnectionStart(),a.bindConnectionEvents(a.sendConnection);const l=yield a.sendConnection.establish();return{iceParameters:l.iceParameters,dtlsParameters:l.dtlsParameters,sdp:l.sdp}}}finally{d&&d()}})()}p2pConnect(i){var r=this;return L(function*(){if(!r.sendConnection)throw new ee(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");r.store.peerConnectionStart(),yield r.sendConnection.connect(i),r.statsUploader.startUploadTransportStats(),r.statsUploader.startUploadExtensionUsageStats(),r.state=Dt.Connected})()}addRemoteCandidate(i,r){var a=this;return L(function*(){if(r===vi.RECEIVE_ONLY){if(!a.sendConnection)throw new ee(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield a.sendConnection.addRemoteCandidate(i)}else{if(!a.recvConnection)throw new ee(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield a.recvConnection.addRemoteCandidate(i)}})()}publish(i,r,a){var d=this;return Xr(function*(){const l=yield Be(d.sendMutex.lock("From P2PChannel.publish"));try{if(!d.sendConnection||d.state!==Dt.Connected){d.throwIfTrackTypeNotMatch(i);const v=i.filter(b=>-1===d.pendingLocalTracks.indexOf(b));return void(d.pendingLocalTracks=d.pendingLocalTracks.concat(v))}d.store.pubId=d.store.pubId+1,Li.markPublishStart(d.store.clientId,d.store.pubId);const h=d.filterTobePublishedTracks(i,r,a);if(0===h.length)return void(yield Be(d.tryToUnmuteAudio(i)));h.forEach(v=>{let{track:b,type:y}=v;const T=Date.now();d.store.publish(b.getTrackId(),y===re.LocalAudioTrack?"audio":"video",T)}),d.bindLocalTrackEvents(h);const p=yield Be(d.sendConnection.send(h.map(v=>{let{track:b}=v;return b}),d.store.codec,d.store.audioCodec)),m=(yield Be(p.next())).value,_=d.createGatewayPublishMessage(h,m);try{yield _}catch(v){throw p.throw(v),v?.code===k.WS_ABORT&&h.forEach(b=>{let{track:y}=b;-1===d.pendingLocalTracks.indexOf(y)&&d.pendingLocalTracks.push(y)}),d.unbindLocalTrackEvents(h),v}yield Be(p.next()),h.forEach(v=>{let{type:b}=v;d.statsCollector.addLocalStats(b)}),d.statsUploader.startUploadOutboundStats(),d.assignLocalTracks(h,m),h.forEach(v=>{let{track:b,type:y}=v;const T=Date.now();d.store.publish(b.getTrackId(),y===re.LocalAudioTrack?"audio":"video",void 0,T)}),d.startUploadUplinkState()}finally{l()}})()}unpublish(i){var r=this;return L(function*(){if(!r.sendConnection||r.state!==Dt.Connected)return void(0===i.length?r.pendingLocalTracks.length=0:r.pendingLocalTracks=r.pendingLocalTracks.filter(h=>!ye(i).call(i,h)));const a=r.filterTobeUnpublishedTracks(i);if(0===a.length)return;const d=a.find(h=>"videoLowTrack"===h[0]);d&&d[1].track.close();const l=r.createGatewayUnpublishMessage(a);if(yield r.sendConnection.stopSending(a.map(h=>{let[,{id:p}]=h;return p})),r.withdrawLocalTracks(a),r.unbindLocalTrackEvents(a.map(h=>{let[p,{track:m}]=h;return{type:p,track:m}})),a.forEach(h=>{let[p]=h;r.statsCollector.removeLocalStats(p)}),0===r.localTrackMap.size&&(r.statsUploader.stopUploadOutboundStats(),r.stopUploadUplinkState()),r.sendConnection&&r.state===Dt.Connected)return d&&d[1].track.close(),l;i.forEach(h=>{const p=r.pendingLocalTracks.indexOf(h);-1!==p&&r.pendingLocalTracks.splice(p,1)})})()}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const i=()=>{const r=[],a=[];Array.from(this.localTrackMap.entries()).forEach(d=>{let[l,{track:h,ssrcs:p}]=d;const m={stream_type:tb(h,l),ssrcs:p};h._muted||!h._enabled?r.push(m):a.push(m)}),r.length>0&&r.forEach(d=>{Tt(this,Oe.RequestMuteLocal,[d])}),a.length>0&&a.forEach(d=>{Tt(this,Oe.RequestUnmuteLocal,[d])})};i(),this.uplinkStateUploadInterval=window.setInterval(()=>{i()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(i){return Xr(function*(){throw new ee(k.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}republish(){var i=this;return L(function*(){i.pendingLocalTracks.length>0&&(I.debug("[".concat(i.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield rn(i,Oe.RequestRePublish,i.pendingLocalTracks),i.emit(Oe.MediaReconnectEnd,i.store.uid),i.pendingLocalTracks=[])})()}unpublishLowStream(){return L(function*(){throw new ee(k.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")})()}subscribe(i,r,a,d){var l=this;return L(function*(){var h;if(!l.recvConnection)throw new ee(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(h=l.remoteUserMap.get(i))&&void 0!==h&&h.has(r))return;const{track:p,mid:m,transceiver:_}=yield l.recvConnection.receive(r,[{ssrcId:a}],String(i.uid),d);r===Ce.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(p):(i._audioTrack=new _s(p,i.uid,i._uintid,l.store),I.info("[".concat(l.store.clientId,"] [").concat(l.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),_&&i._audioTrack._updateRtpTransceiver(_),l.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoSSRC=a,i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(p):(i._videoTrack=new Wa(p,i.uid,i._uintid,l.store),I.info("[".concat(l.store.clientId,"] [").concat(l.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),_&&i._videoTrack._updateRtpTransceiver(_),l.bindRemoteTrackEvents(i,i._videoTrack));const v=l.remoteUserMap.get(i);v?v.set(r,m):l.remoteUserMap.set(i,new Map([[r,m]])),l.statsCollector.addRemoteStats(i.uid),l.statsUploader.startUploadInboundStats(),l.startUploadDownlinkState();const b=l.pendingRemoteTracks.findIndex(y=>{let{user:T,kind:M}=y;return T.uid===i.uid&&r===M});-1!==b&&(l.pendingRemoteTracks.splice(b,1),l.emit(Oe.MediaReconnectEnd,i.uid))})()}mockSubscribe(i,r,a,d){var l=this;return L(function*(){if(!l.recvConnection)throw new ee(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");yield l.recvConnection.mockReceive(r,[{ssrcId:a}],String(i.uid),d)})()}unsubscribe(i,r,a){var d=this;return L(function*(){const l=d.pendingRemoteTracks.filter(p=>{let{user:m,kind:_}=p;return void 0!==r?m.uid===i.uid&&r===_:m.uid===i.uid});if(l.forEach(p=>{const m=d.pendingRemoteTracks.indexOf(p);d.pendingRemoteTracks.splice(m,1)}),d.recvConnection||a||l.forEach(p=>{let{kind:m}=p;var _;if(m===Ce.AUDIO)null===(_=i._audioTrack)||void 0===_||_._destroy(),i._audioTrack=void 0;else if(m===Ce.VIDEO){var v;null===(v=i._videoTrack)||void 0===v||v._destroy(),i._videoTrack=void 0}}),!d.recvConnection)return;const h=d.filterTobeUnSubscribedTracks(i,r);0!==h.length&&(yield d.recvConnection.stopReceiving(h.map(p=>{let[,{id:m}]=p;return m})),d.withdrawRemoteTracks(h),0===d.remoteUserMap.size&&(d.statsUploader.stopUploadInboundStats(),d.stopUploadDownlinkState()),h.forEach(p=>{let[m,{kind:_}]=p;var v,b;if(_===Ce.VIDEO&&m._videoSSRC&&(null===(v=d.recvConnection)||void 0===v||v.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),_===Ce.VIDEO)d.unbindRemoteTrackEvents(m._videoTrack),a||(null===(b=m._videoTrack)||void 0===b||b._destroy(),m._videoTrack=void 0);else if(_===Ce.AUDIO){var y;d.unbindRemoteTrackEvents(m._audioTrack),!a&&(null===(y=m._audioTrack)||void 0===y||y._destroy(),m._audioTrack=void 0)}}),h.forEach(p=>{let[,{kind:m}]=p;Tt(d,Oe.RequestP2PMuteRemote,m)}))})()}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const i=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,a]=r;[Ce.VIDEO,Ce.AUDIO].forEach(d=>{a.has(d)?Tt(this,Oe.RequestP2PUnmuteRemote,d):Tt(this,Oe.RequestP2PMuteRemote,d)})});i(),this.downlinkStatsUploadInterval=window.setInterval(()=>{i()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}massSubscribe(i){return L(function*(){throw new ee(k.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")})()}massSubscribeNoLock(i){return L(function*(){throw new ee(k.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")})()}massUnsubscribe(i){return L(function*(){throw new ee(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")})()}massUnsubscribeNoLock(i){return L(function*(){throw new ee(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")})()}muteRemote(i,r){var a=this;return L(function*(){if(!a.recvConnection)return;const d=a.remoteUserMap.get(i);if(!d)return void I.warning("[".concat(a.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(i.uid,"."));if(!d.get(r))return void I.warning("[".concat(a.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(i.uid," media type ").concat(r,"."));const l=r===Ce.VIDEO?i._videoSSRC:i._audioSSRC;void 0!==l&&a.recvConnection.setStatsRemoteVideoIsReady(l,!1)})()}unmuteRemote(i,r){var a=this;return L(function*(){return a.unmuteRemoteNoLock(i,r)})()}unmuteRemoteNoLock(i,r){var a=this;return L(function*(){if(!a.recvConnection)return;const d=a.remoteUserMap.get(i);d?d.get(r)||I.warning("[".concat(a.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(i.uid," media type ").concat(r,".")):I.warning("[".concat(a.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(i.uid,"."))})()}getAllTracks(i){const r=this.localTrackMap.get(re.LocalAudioTrack);if(r?.track instanceof jn){const a=r.track;return Array.from(this.localTrackMap.entries()).filter(d=>{let[l]=d;return l!==re.LocalAudioTrack}).filter(d=>{let[l]=d;return!(i&&l===re.LocalVideoLowTrack)}).map(d=>{let[,{track:l}]=d;return l}).concat(a.trackList)}return Array.from(this.localTrackMap.entries()).filter(a=>{let[d]=a;return!(i&&d===re.LocalVideoLowTrack)}).map(a=>{let[,{track:d}]=a;return d})}reportPublishEvent(i,r,a,d,l){if(i){const p=this.localTrackMap.get(re.LocalAudioTrack),m=this.localTrackMap.get(d?re.LocalVideoLowTrack:re.LocalVideoTrack);Ie.publish(this.store.sessionId,{eventElapse:Li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:r,audioName:p?.track.getTrackLabel(),videoName:m?.track.getTrackLabel(),screenshare:-1!==m?.track._hints.indexOf(kt.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}else{var h;a||(a=[]);const p=a.find(_=>_ instanceof vt),m=d?null===(h=this.localTrackMap.get(re.LocalVideoTrack))||void 0===h?void 0:h.track:a.find(_=>_ instanceof je);Ie.publish(this.store.sessionId,{eventElapse:Li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:r,audioName:p?.getTrackLabel(),videoName:m?.getTrackLabel(),screenshare:-1!==m?._hints.indexOf(kt.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}}reportSubscribeEvent(i,r,a,d){const l=d===Ce.VIDEO?a._videoSSRC:a._audioSSRC;l&&Ie.subscribe(this.store.sessionId,{succ:i,ec:r,video:d===Ce.VIDEO,audio:d===Ce.AUDIO,peerid:a.uid,subscribeRequestid:d===Ce.VIDEO?a._videoSSRC:a._audioSSRC,p2pid:this.store.p2pId,eventElapse:Li.measureFromSubscribeStart(this.store.clientId,l)})}reset(){I.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Ei("P2PChannel2-send-mutex"),this.sendMutex=new Ei("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const i=this.localTrackMap.get(re.LocalAudioTrack);if(i?.track instanceof jn){if(i.track.trackList.length>0){const r=i.track;i.track.trackList.forEach(a=>{r.removeAudioTrack(a)})}i.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Dt.Disconnected}getStats(i){var r,a;return i?null===(a=this.recvConnection)||void 0===a?void 0:a.getStats():null===(r=this.sendConnection)||void 0===r?void 0:r.getStats()}getRemoteVideoIsReady(i){var r;return(null===(r=this.recvConnection)||void 0===r?void 0:r.getRemoteVideoIsReady(i))||!1}getLocalAudioVolume(){const i=this.localTrackMap.get(re.LocalAudioTrack);if(i)return i.track.getVolumeLevel()}getLocalVideoSize(){const i=this.localTrackMap.get(re.LocalVideoTrack);if(i)return{width:i.track._videoWidth||0,height:i.track._videoHeight||0}}getEncoderConfig(i){const r=this.localTrackMap.get(i);return r&&r.track instanceof je||r&&r.track instanceof vt?r.track._encoderConfig:void 0}getLocalMedia(i){return this.localTrackMap.get(i)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(i,r){if(!i)return this.remoteUserMap.size>0;const a=this.remoteUserMap.get(i);return!!a&&(!r||a.has(r))}hasRemoteMediaWithLock(i,r){var a=this;return L(function*(){if(!i)return a.remoteUserMap.size>0;const d=a.remoteUserMap.get(i);return!!d&&(!r||d.has(r))})()}getRemoteMedia(i){var r;const a=Array.from(ir(r=this.remoteUserMap).call(r)).find(d=>d.uid===i);return a?{audioTrack:a.audioTrack,audioSSRC:a._audioSSRC,videoTrack:a.videoTrack,videoSSRC:a._videoSSRC}:{}}getAudioLevels(){let i=Array.from(this.remoteUserMap.entries()).map(a=>{let[d]=a;return{uid:d.uid,level:d.audioTrack?100*d.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(re.LocalAudioTrack);return r&&i.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),i=dE(i).call(i,(a,d)=>a.level-d.level),i}disconnectForReconnect(){var i=this;return L(function*(){i.sendConnection&&i.recvConnection&&(I.debug("[".concat(i.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),i.state=Dt.Reconnecting,V("KEEP_LAST_FRAME")&&0!==i.remoteUserMap.size&&Array.from(i.remoteUserMap.entries()).forEach(r=>{let[a]=r;var d;a._videoTrack&&a._videoTrack._player&&(null===(d=a._videoTrack._player.getVideoElement())||void 0===d||d.pause(),a._videoTrack._player.isKeepLastFrame=!0,a._videoTrack._originMediaStreamTrack.stop())}),i.sendConnection.close(),i.unbindConnectionEvents(i.sendConnection),i.sendConnection=void 0,i.recvConnection.close(),i.unbindConnectionEvents(i.recvConnection),i.recvConnection=void 0,0!==i.localTrackMap.size&&(Array.from(i.localTrackMap.entries()).forEach(r=>{var a;let[d,{track:l}]=r;switch(d){case re.LocalVideoTrack:ye(a=l._hints).call(a,kt.LOW_STREAM)?l.close():i.pendingLocalTracks.push(l);break;case re.LocalAudioTrack:l instanceof jn?i.pendingLocalTracks=i.pendingLocalTracks.concat(l.trackList):i.pendingLocalTracks.push(l)}}),i.emit(Oe.MediaReconnectStart,i.store.uid)),i.unbindLocalTrackEvents(),i.localTrackMap.clear(),0!==i.remoteUserMap.size&&Array.from(i.remoteUserMap.entries()).forEach(r=>{let[a,d]=r;Array.from(ir(d).call(d)).forEach(l=>{i.setPendingRemoteMedia(a,l)}),i.emit(Oe.MediaReconnectStart,a.uid)}),i.unbindAllRemoteTrackEvents(),i.remoteUserMap.clear(),i.stopUploadUplinkState(),i.stopUploadDownlinkState(),i.statsUploader.stopUploadOutboundStats(),i.statsUploader.stopUploadInboundStats(),i.statsUploader.stopUploadTransportStats(),I.debug("[".concat(i.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))})()}hasPendingRemoteMedia(i,r){for(const a of this.pendingRemoteTracks){const{user:d,kind:l}=a;if((i instanceof Ii?i.uid:i)===d.uid&&r===l)return!0}return!1}setPendingRemoteMedia(i,r){this.hasPendingRemoteMedia(i,r)||this.pendingRemoteTracks.push({user:i,kind:r})}restartICE(i,r){var a=this;return L(function*(){let d,l;if(i===vi.SEND_ONLY){if(!a.sendConnection)throw new ee(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");d=yield a.sendMutex.lock("From P2PChannel.restartICE"),l=a.sendConnection}else{if(!a.recvConnection)throw new ee(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");d=yield a.recvMutex.lock("From P2PChannel.restartICE"),l=a.recvConnection}try{if(r){const h=yield l.restartICE(r);return l.isInRestartIce=!1,h}{const h=yield l.restartICE();if(h){const p=yield rn(a,Oe.RequestP2PRestartICE,{direction:vi.RECEIVE_ONLY,iceParameter:h});yield l.restartICE(p),l.isInRestartIce=!1}}}finally{d()}})()}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const i=this.sendConnection.getStats(),r=this.localTrackMap.get(re.LocalVideoTrack),a=this.localTrackMap.get(re.LocalAudioTrack),d=i.videoSend.find(M=>{var O;return M.ssrc===(null==r||null===(O=r.ssrcs)||void 0===O?void 0:O[0].ssrcId)}),l=i.audioSend.find(M=>{var O;return M.ssrc===(null==a||null===(O=a.ssrcs)||void 0===O?void 0:O[0].ssrcId)});if(!d||!l)return 1;const h=Pr(this,Oe.NeedSignalRTT),p=d?d.rttMs:void 0,m=l?l.rttMs:void 0,_=p&&m?(p+m)/2:p||m,b=100*i.sendPacketLossRate*.7/50+.3*((_&&h?(_+h)/2:_||h)||0)/1500,y=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,T=r?.track;if(T&&T._encoderConfig&&-1===T._hints.indexOf(kt.SCREEN_TRACK)){const M=T._encoderConfig.bitrateMax,O=i.bitrate.actualEncoded;if(M&&O){const D=(1e3*M-O)/(1e3*M);return RO[D<.15?0:D<.3?1:D<.45?2:D<.6?3:4][y]}}return y}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const i=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(a=>{let[d]=a;const l=d._audioSSRC,h=d._videoSSRC,p=i.audioRecv.find(O=>O.ssrc===l),m=i.videoRecv.find(O=>O.ssrc===h);if(!p&&!m)return void(r+=1);const _=Pr(this,Oe.NeedSignalRTT),v=i.rtt,b=(v&&_?(v+_)/2:v||_)||0,y=p?p.jitterMs:void 0,T=i.recvPacketLossRate;let M=.7*T*100/50+.3*b/1500;y&&(M=.6*T*100/50+.2*b/1500+.2*y/400),r+=M<.1?1:M<.17?2:M<.36?3:M<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}muteLocalTrack(i){var r=this;return L(function*(){return new X((a,d)=>{r.handleMuteLocalTrack(i,a,d)})})()}filterTobePublishedTracks(i,r,a){const d=[],l=Ot(),h=this.getAllTracks();i=Ad(i=i.filter(_=>-1===h.indexOf(_)));let p=!1,m=!1;for(const _ of i){if(_ instanceof je&&(this.localTrackMap.has(re.LocalVideoTrack)||p?new ee(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(d.push({track:_,type:re.LocalVideoTrack}),p=!0),r)){const v=this.getLowVideoTrack(_,a);d.push({track:v,type:re.LocalVideoLowTrack})}if(_ instanceof vt){const v=this.localTrackMap.get(re.LocalAudioTrack);if(v){if(!(v.track instanceof jn))throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const b=d.find(y=>{let{type:T}=y;return T===re.LocalAudioTrack});if(!(b.track instanceof jn))throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");b.track.addAudioTrack(_)}else{if(!l.webAudioMediaStreamDest||_ instanceof jn||_._bypassWebAudio)d.push({track:_,type:re.LocalAudioTrack});else{const b=new jn;b.addAudioTrack(_),d.push({track:b,type:re.LocalAudioTrack})}m=!0}}}return d}filterTobeUnpublishedTracks(i){const r=[],a=this.getAllTracks();i=Ad(i=i.filter(d=>-1!==a.indexOf(d)));for(const d of i){if(d instanceof vt){const l=this.localTrackMap.get(re.LocalAudioTrack);if(!l)continue;l.track instanceof jn?(l.track.removeAudioTrack(d),this.unbindLocalAudioTrackEvents(d),0===l.track.trackList.length&&(r.push([re.LocalAudioTrack,l]),l.track.close())):r.push([re.LocalAudioTrack,l])}if(d instanceof je){const l=this.localTrackMap.get(re.LocalVideoTrack);if(!l)continue;r.push([re.LocalVideoTrack,l]);const h=this.localTrackMap.get(re.LocalVideoLowTrack);h&&r.push([re.LocalVideoLowTrack,h])}}return r}bindLocalTrackEvents(i){i.forEach(r=>{let{track:a,type:d}=r;switch(d){case re.LocalVideoTrack:a.addListener(ve.GET_STATS,this.handleGetLocalVideoStats),a.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.addListener(ve.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.addListener(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case re.LocalAudioTrack:this.bindLocalAudioTrackEvents(a)}})}bindLocalAudioTrackEvents(i,r){i instanceof jn?i.trackList.forEach(a=>{a.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(ve.GET_STATS,this.handleGetLocalAudioStats),a.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.addListener(ve.GET_STATS,this.handleGetLocalAudioStats),i.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||i.addListener(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(i){i||(i=Array.from(this.localTrackMap.entries()).map(r=>{let[a,{track:d}]=r;return{track:d,type:a}})),i.forEach(r=>{let{track:a,type:d}=r;switch(d){case re.LocalVideoTrack:a.off(ve.GET_STATS,this.handleGetLocalVideoStats),a.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.off(ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.off(ve.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.off(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case re.LocalAudioTrack:this.unbindLocalAudioTrackEvents(a)}})}unbindLocalAudioTrackEvents(i){i instanceof jn?i.trackList.forEach(r=>{r.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(ve.GET_STATS,this.handleGetLocalAudioStats),r.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.off(ve.GET_STATS,this.handleGetLocalAudioStats),i.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(i,r){r instanceof Wa&&r.addListener(ve.GET_STATS,a=>{a(this.handleGetRemoteVideoStats(i))}),r instanceof _s&&r.addListener(ve.GET_STATS,a=>{a(this.handleGetRemoteAudioStats(i))})}unbindRemoteTrackEvents(i){i&&i.removeAllListeners(ve.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(i=>{let[r,a]=i;a.has(Ce.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),a.has(Ce.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(i,r){return i.map((a,d)=>{var l;let h,{track:p,type:m}=a;switch(m){case re.LocalAudioTrack:h=ut.Audio;break;case re.LocalVideoTrack:h=ye(l=p._hints).call(l,kt.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:h=ut.Low}return{kind:m===re.LocalAudioTrack?Ce.AUDIO:Ce.VIDEO,stream_type:h,mid:r[d].id,ssrcs:r[d].localSSRC,isMuted:p.muted||!p.enabled}})}createGatewayUnpublishMessage(i){return i.map(r=>{var a;let d,[l,{track:h,ssrcs:p,id:m}]=r;switch(l){case re.LocalVideoTrack:d=ye(a=h._hints).call(a,kt.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalAudioTrack:d=ut.Audio;break;case re.LocalVideoLowTrack:d=ut.Low}return{stream_type:d,ssrcs:p,mid:m}})}assignLocalTracks(i,r){i.forEach((a,d)=>{let{track:l,type:h}=a;this.localTrackMap.set(h,{track:l,id:r[d].id,ssrcs:r[d].localSSRC})})}withdrawLocalTracks(i){i.forEach(r=>{let[a]=r;this.localTrackMap.delete(a)})}bindConnectionEvents(i){var r=this;i.onConnectionStateChange=function(){var a=L(function*(d){var l;I.info("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: ").concat(i.name,".onConnectionStateChange(").concat(d,")")),r.emit(Oe.PeerConnectionStateChange,d),"connected"!==d||r.store.keyMetrics.peerConnectionEnd||r.store.peerConnectionEnd(),"connected"===d&&(i.isInRestartIce=!1),ye(l=r._restartStates).call(l,d)&&!i.isInRestartIce&&("disconnected"===d&&(yield Un(800)),"disconnected"!==i.iceConnectionState&&"failed"!==i.iceConnectionState||r.handleDisconnect(i.direction))});return function(d){return a.apply(this,arguments)}}(),i.onICEConnectionStateChange=a=>{"connected"!==a||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(a,")")),Ie.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:a,tag:qt.TRACER}).onSuccess(),this.emit(Oe.IceConnectionStateChange,a)},i.onICETransportStateChange=a=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(a,")"))},i.onDTLSTransportStateChange=a=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(a,")"))},i.onDTLSTransportError=a=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(a,")"))},i.onFirstAudioDecoded=a=>{var d;const l=Array.from(ir(d=this.remoteUserMap).call(d)).find(p=>p._audioSSRC===a);var h;l&&(this.store.subscribe(l.uid,"audio",void 0,void 0,void 0,Date.now()),null===(h=l.audioTrack)||void 0===h||h.emit(uu.FIRST_FRAME_DECODED),Ie.firstRemoteFrame(this.store.sessionId,ni.FIRST_AUDIO_DECODE,Gt.FIRST_AUDIO_DECODE,{peer:l._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId}))},i.onFirstAudioReceived=a=>{var d;const l=Array.from(ir(d=this.remoteUserMap).call(d)).find(h=>h._audioSSRC===a);l&&Ie.firstRemoteFrame(this.store.sessionId,ni.FIRST_AUDIO_RECEIVED,Gt.FIRST_AUDIO_RECEIVED,{peer:l._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},i.onFirstVideoDecoded=(a,d,l)=>{this.reportVideoFirstFrameDecoded(a,d,l)},i.onFirstVideoReceived=a=>{var d;const l=Array.from(ir(d=this.remoteUserMap).call(d)).find(h=>h._videoSSRC===a);l&&Ie.firstRemoteFrame(this.store.sessionId,ni.FIRST_VIDEO_RECEIVED,Gt.FIRST_VIDEO_RECEIVED,{peer:l._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},i.onSelectedLocalCandidateChanged=(a,d)=>{const l="relay"===a.candidateType;"unknown"!==d.candidateType&&l===("relay"===d.candidateType)||this.emit(Oe.ConnectionTypeChange,l),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Vc(d))," -> ").concat(JSON.stringify(Vc(a)),")"))},i.onSelectedRemoteCandidateChanged=(a,d)=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Vc(d))," -> ").concat(JSON.stringify(Vc(a)),")"))},i.onFirstVideoDecodedTimeout=a=>{this.reportVideoFirstFrameDecoded(a,void 0,void 0,!0)},i.onLocalCandidate=a=>{this.emit(Oe.LocalCandidate,{candidate:a,direction:i.direction})}}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0,i.onLocalCandidate=void 0}handleDisconnect(i){var r=this;return L(function*(){const a=i===vi.SEND_ONLY?r.sendConnection:r.recvConnection;a&&!a.isInRestartIce&&(a.isInRestartIce=!0,I.debug("[".concat(r.store.clientId,"] [P2PChannel-").concat(a.name,"] start use restartICE")),i===vi.SEND_ONLY?r.restartICE(i):rn(r,Oe.RequestP2PRestartICE,{direction:vi.SEND_ONLY}))})()}filterTobeMutedTracks(i){const r=[];if(-1===this.getAllTracks().indexOf(i))return r;const a=this.localTrackMap.get(re.LocalAudioTrack);if(i instanceof vt&&a?.track instanceof jn)return a.track.isActive||r.push([re.LocalAudioTrack,a]),r;const d=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:h}]=l;return i===h});if(d&&(r.push(d),d[0]===re.LocalVideoTrack)){const l=this.localTrackMap.get(re.LocalVideoLowTrack);l&&r.push([re.LocalVideoLowTrack,l])}return r}filterTobeUnmutedTracks(i){const r=[],a=this.localTrackMap.get(re.LocalAudioTrack);if(i instanceof vt&&a?.track instanceof jn)return a.track.isActive&&r.push([re.LocalAudioTrack,a]),r;const d=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:h}]=l;return i===h});if(d)if(d[0]===re.LocalVideoTrack){r.push(d);const l=this.localTrackMap.get(re.LocalVideoLowTrack);l&&r.push([re.LocalVideoLowTrack,l])}else r.push(d);return r}createMuteMessage(i){return i.map(r=>{var a;let d,[l,{track:h,ssrcs:p,id:m}]=r;switch(l){case re.LocalAudioTrack:d=ut.Audio;break;case re.LocalVideoTrack:d=ye(a=h._hints).call(a,kt.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:d=ut.Low}return{stream_type:d,ssrcs:p,mid:m}})}createUnmuteMessage(i){return i.map(r=>{var a;let d,[l,{track:h,ssrcs:p,id:m}]=r;switch(l){case re.LocalAudioTrack:d=ut.Audio;break;case re.LocalVideoTrack:d=ye(a=h._hints).call(a,kt.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:d=ut.Low}return{stream_type:d,ssrcs:p,mid:m}})}filterTobeUnSubscribedTracks(i,r){const a=[],d=this.remoteUserMap.get(i);if(!d)return a;if(r){const l=d.get(r);if(!l)return a;a.push([i,{kind:r,id:l}])}else Array.from(d.entries()).forEach(l=>{let[h,p]=l;a.push([i,{kind:h,id:p}])});return a}createUnsubscribeMessage(i){const r=[];return i.forEach(a=>{let[d,{kind:l}]=a;switch(l){case Ce.VIDEO:return void(d._videoSSRC&&r.push({stream_type:Ce.VIDEO,ssrcId:d._videoSSRC}));case Ce.AUDIO:return void(d._audioSSRC&&r.push({stream_type:Ce.AUDIO,ssrcId:d._audioSSRC}))}}),r}withdrawRemoteTracks(i){i.forEach(r=>{let[a,{kind:d}]=r;const l=this.remoteUserMap.get(a);l&&(l.delete(d),0===Array.from(l.entries()).length&&this.remoteUserMap.delete(a))})}updateBitrateLimit(i){var r=this;return L(function*(){const a=r.localTrackMap.get(re.LocalVideoTrack),d=r.localTrackMap.get(re.LocalVideoLowTrack);a&&(yield a.track.setBitrateLimit(i.uplink)),d&&i.low_stream_uplink&&(yield d.track.setBitrateLimit({max_bitrate:i.low_stream_uplink.bitrate,min_bitrate:i.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.sendConnection||!this.recvConnection||"connected"!==this.sendConnection.peerConnectionState&&"connected"!==this.recvConnection.peerConnectionState}tryToUnmuteAudio(i){var r=this;return L(function*(){for(let a=0;a<i.length;a++)if(i[a]instanceof vt){const d=r.filterTobeUnmutedTracks(i[a]);if(0===d.length)continue;const l=r.createUnmuteMessage(d);return void(yield Tt(r,Oe.RequestUnmuteLocal,l))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=i=>this.getStats(i),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(i=>{let[,{ssrcs:r}]=i;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=i=>{var r;return!(null===(r=this.recvConnection)||void 0===r||!r.getRemoteVideoIsReady(i))},this.statsUploader.requestUpload=(i,r)=>this.emit(Oe.RequestUpload,i,r),this.statsUploader.requestUploadStats=i=>this.emit(Oe.RequestUploadStats,i),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var i=this;return L(function*(){i.dtlsFailedCount+=1,yield Un(GE(i.dtlsFailedCount,Pn)),i.emit(Oe.RequestReconnect)})()}reconnectP2P(){return L(function*(){})()}canPublishLowStream(){return this.localTrackMap.has(re.LocalVideoTrack)||this.pendingLocalTracks.some(i=>i instanceof je)}throwIfTrackTypeNotMatch(i){if(i.filter(r=>r instanceof je).length>1)throw new ee(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i.filter(r=>r instanceof vt).length>1&&(i.some(r=>r instanceof vt&&r._bypassWebAudio)||!Ot().webAudioMediaStreamDest))throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of i){if(r instanceof je&&this.pendingLocalTracks.some(a=>a instanceof je))throw new ee(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof vt&&this.pendingLocalTracks.some(a=>a instanceof vt)&&(!Ot().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(a=>a instanceof vt&&a._bypassWebAudio)))throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(i,r){const a=!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ot().supportDualStreamEncoding,d=qs(qs({},{width:160,height:120,framerate:15,bitrate:50}),r);let l;l=a?i._mediaStreamTrack.clone():Pp(i,d);const h=Ke(8,"track-low-"),p=new je(l,qs(qs({},a&&{scaleResolutionDownBy:vT(d,i)}),{},{frameRate:d.framerate,bitrateMax:d.bitrate,bitrateMin:d.bitrate}),void 0,void 0,h);return p.on(lu.TRANSCEIVER_UPDATED,m=>{i._updateRtpTransceiver(m,Bd.LOW_STREAM)}),p._hints.push(kt.LOW_STREAM),i.addListener(ve.NEED_CLOSE,()=>{p.close()}),p}globalLock(){var i=this;return L(function*(){return i.recvMutex.lock("From P2PChannel2.globalLock")})()}reportVideoFirstFrameDecoded(i,r,a,d){var l;const h=Array.from(ir(l=this.remoteUserMap).call(l)).find(p=>p._videoSSRC===i);if(h){d||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const p=this.store.keyMetrics,m=p.subscribe.find(_=>_.userId===h.uid&&"video"===_.type);Ie.firstRemoteVideoDecode(this.store.sessionId,ni.FIRST_VIDEO_DECODE,Gt.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:r,videoheight:a,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId,apEnd:p.requestAPEnd||0,apStart:p.requestAPStart||0,joinGwEnd:p.joinGatewayEnd||0,joinGwStart:p.joinGatewayStart||0,pcEnd:p.peerConnectionEnd||0,pcStart:p.peerConnectionStart||0,subscriberEnd:m?.subscribeEnd||0,subscriberStart:m?.subscribeStart||0,videoAddNotify:m?.streamAdded||0,state:d?1:0})}}remoteMediaSsrcChanged(i,r,a){var d=this;return L(function*(){if(!d.recvConnection)return!1;const l=d.remoteUserMap.get(i);if(!l)return!1;const h=l.get(r);if(!h)return!1;const p=yield d.recvConnection.getRemoteSSRC(h);return void 0!==p&&p!==a})()}resetConnection(i){I.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(i)),this.state===Dt.Connected?(I.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}publishDataChannel(i){return L(function*(){throw new ee(k.NOT_SUPPORTED)})()}unpublishDataChannel(i){return L(function*(){throw new ee(k.NOT_SUPPORTED)})()}subscribeDataChannel(i,r){return L(function*(){throw new ee(k.NOT_SUPPORTED)})()}unsubscribeDataChannel(i,r){return L(function*(){throw new ee(k.NOT_SUPPORTED)})()}hasPendingRemoteDataChannel(i,r){throw new ee(k.NOT_SUPPORTED)}setPendingRemoteDataChannel(i,r){throw new ee(k.NOT_SUPPORTED)}preConnect(i,r,a,d,l,h){return L(function*(){throw new ee(k.NOT_SUPPORTED)})()}getEstablishParams(){throw new ee(k.NOT_SUPPORTED)}reSubscribe(i){return L(function*(){throw new ee(k.NOT_SUPPORTED)})()}updateVideoStreamParameter(i,r){return L(function*(){throw new ee(k.NOT_SUPPORTED)})()}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:a}]=i;r===re.LocalVideoLowTrack?a._updateRtpTransceiver(void 0,Bd.LOW_STREAM):a._updateRtpTransceiver(void 0)})}}function xt(s){return function(i,r,a){const d=i[r];if("function"!=typeof d)throw new Error("Cannot use mutex on object property.");return a.value=L(function*(){for(var l=arguments.length,h=new Array(l),p=0;p<l;p++)h[p]=arguments[p];switch(s){case ys.SEND_ONLY:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(r));try{return yield d.apply(this,h)}finally{m()}}case ys.RECEIVE_ONLY:{const m=yield this.recvMutex.lock("From P2PChannel2.".concat(r));try{return yield d.apply(this,h)}finally{m()}}default:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(r)),_=yield this.recvMutex.lock("From P2PChannel2.".concat(r));try{return yield d.apply(this,h)}finally{m(),_()}}}}),a}}function mP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Xa(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?mP(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):mP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}ne([xt(ys.SEND_ONLY),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],Je.prototype,"p2pConnect",null),ne([xt(ys.SEND_ONLY),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Je.prototype,"unpublish",null),ne([xt(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],Je.prototype,"unpublishLowStream",null),ne([xt(ys.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Ii,String,Number,String]),N("design:returntype",X)],Je.prototype,"subscribe",null),ne([xt(ys.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Ii,String,Number,String]),N("design:returntype",X)],Je.prototype,"mockSubscribe",null),ne([xt(ys.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Ii,String,Boolean]),N("design:returntype",X)],Je.prototype,"unsubscribe",null),ne([xt(ys.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Ii,String]),N("design:returntype",X)],Je.prototype,"muteRemote",null),ne([xt(ys.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Ii,String]),N("design:returntype",X)],Je.prototype,"unmuteRemote",null),ne([xt(ys.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Ii,String]),N("design:returntype",X)],Je.prototype,"hasRemoteMediaWithLock",null),ne([xt(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],Je.prototype,"disconnectForReconnect",null),ne([xt(ys.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[Ii,String,Number]),N("design:returntype",X)],Je.prototype,"remoteMediaSsrcChanged",null);class Cs{constructor(i){S(this,"store",void 0),S(this,"onStatsException",void 0),S(this,"onUploadPublishDuration",void 0),S(this,"onStatsChanged",void 0),S(this,"localStats",new Map),S(this,"remoteStats",new Map),S(this,"updateStatsInterval",void 0),S(this,"trafficStats",void 0),S(this,"trafficStatsPeerList",[]),S(this,"uplinkStats",void 0),S(this,"exceptionMonitor",void 0),S(this,"p2pChannel",void 0),S(this,"scalabilityMode",cT.L1T1),S(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=i,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new tF,this.exceptionMonitor.on("exception",(r,a,d)=>{this.onStatsException&&this.onStatsException(r,a,d)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(re.LocalAudioTrack)||Xa({},xT)}getLocalVideoTrackStats(){return this.localStats.get(re.LocalVideoTrack)||Xa({},wn)}getRemoteAudioTrackStats(i){const r=(l,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===l);return p&&(h.publishDuration=p.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(i){var d;const l=null===(d=this.remoteStats.get(i))||void 0===d?void 0:d.audioStats;l&&(a[i]=r(i,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[h,{audioStats:p}]=l;p&&(a[h]=r(h,p))});return a}getRemoteNetworkQualityStats(i){const r={};if(i){var a;const d=null===(a=this.remoteStats.get(i))||void 0===a?void 0:a.networkStats;d&&(r[i]=d)}else Array.from(this.remoteStats.entries()).forEach(d=>{let[l,{networkStats:h}]=d;h&&(r[l]=h)});return r}getRemoteVideoTrackStats(i){const r=(l,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===l);return p&&(h.publishDuration=p.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(i){var d;const l=null===(d=this.remoteStats.get(i))||void 0===d?void 0:d.videoStats;l&&(a[i]=r(i,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[h,{videoStats:p}]=l;p&&(a[h]=r(h,p))});return a}getRTCStats(){let i=0,r=0,a=0,d=0;const l=this.localStats.get(re.LocalAudioTrack);l&&(i+=l.sendBytes,r+=l.sendBitrate);const h=this.localStats.get(re.LocalVideoTrack);h&&(i+=h.sendBytes,r+=h.sendBitrate);const p=this.localStats.get(re.LocalVideoLowTrack);p&&(i+=p.sendBytes,r+=p.sendBitrate),this.remoteStats.forEach(_=>{let{audioStats:v,videoStats:b}=_;v&&(a+=v.receiveBytes,d+=v.receiveBitrate),b&&(a+=b.receiveBytes,d+=b.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:r,SendBytes:i,RecvBytes:a,RecvBitrate:d,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(i){this.localStats.set(i,void 0)}removeLocalStats(i){i?this.localStats.delete(i):this.localStats.clear()}addRemoteStats(i){this.remoteStats.set(i,{})}removeRemoteStats(i){i?this.remoteStats.delete(i):this.remoteStats.clear()}addP2PChannel(i){this.p2pChannel=i}updateTrafficStats(i){i.peer_delay=i.peer_delay.filter(r=>void 0!==r.B_ppad||void 0!==r.B_ppvd),i.peer_delay.filter(r=>-1===this.trafficStatsPeerList.indexOf(r.peer_uid)).forEach(r=>{var a;const d=null===(a=this.p2pChannel)||void 0===a?void 0:a.getRemoteMedia(r.peer_uid),l=null!=d&&d.videoSSRC?Li.measureFromSubscribeStart(this.store.clientId,d.videoSSRC):0,h=null!=d&&d.audioSSRC?Li.measureFromSubscribeStart(this.store.clientId,d.audioSSRC):0;void 0!==r.B_ppad&&void 0!==r.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,l>h?l:h),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=i}updateUplinkStats(i){this.uplinkStats&&this.uplinkStats.B_fir!==i.B_fir&&I.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(i.B_fir)),this.uplinkStats=i}static isRemoteVideoFreeze(i,r,a){return!!i&&(!!a&&r.framesDecodeFreezeTime>a.framesDecodeFreezeTime||!(!a||r.framesDecodeCount>a.framesDecodeCount))}static isRemoteAudioFreeze(i){return!!i&&i._isFreeze()}isLocalVideoFreeze(i){return!(!i.inputFrame||!i.sentFrame)&&i.inputFrame.frameRate>5&&i.sentFrame.frameRate<3}updateLocalStats(i){Array.from(this.localStats.entries()).forEach(r=>{let[a,d]=r;switch(a){case re.LocalVideoTrack:case re.LocalVideoLowTrack:{const h=d,p=Xa({},wn),m=i.getStats(),_=i.getLocalMedia(a);if(m){const v=m.videoSend.find(b=>b.ssrc===_?.ssrcs[0].ssrcId);if(v){const b=i.getLocalVideoSize(),y=i.getEncoderConfig(re.LocalVideoTrack);"H264"!==v.codec&&"H265"!==v.codec&&"VP8"!==v.codec&&"VP9"!==v.codec&&"AV1X"!==v.codec&&"AV1"!==v.codec||(p.codecType=v.codec),p.sendBytes=v.bytes,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0,v.inputFrame?(p.captureFrameRate=v.inputFrame.frameRate,p.captureResolutionHeight=v.inputFrame.height,p.captureResolutionWidth=v.inputFrame.width):b&&(p.captureResolutionWidth=b.width,p.captureResolutionHeight=b.height),v.sentFrame?(p.sendFrameRate=v.sentFrame.frameRate,p.sendResolutionHeight=v.sentFrame.height,p.sendResolutionWidth=v.sentFrame.width):b&&(p.sendResolutionWidth=b.width,p.sendResolutionHeight=b.height),v.avgEncodeMs&&(p.encodeDelay=v.avgEncodeMs),y&&y.bitrateMax&&(p.targetSendBitrate=1e3*y.bitrateMax),p.sendPackets=v.packets,p.sendPacketsLost=v.packetsLost,p.sendJitterMs=v.jitterMs,p.sendRttMs=v.rttMs,p.totalDuration=h?h.totalDuration+1:1,p.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(v)&&(p.totalFreezeTime+=1),v.scalabilityMode&&this.scalabilityMode!==v.scalabilityMode&&(I.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(v.scalabilityMode)),this.scalabilityMode=v.scalabilityMode)}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var l;this.localStats.set(a,p),(h?.sendResolutionWidth!==p.sendResolutionWidth||h?.sendResolutionHeight!==p.sendResolutionHeight)&&(null===(l=this.onStatsChanged)||void 0===l||l.call(this,"resolution",{width:p.sendResolutionWidth,height:p.sendResolutionHeight})),p&&_&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,_.track,p);break}case re.LocalAudioTrack:{const h=d,p=Xa({},xT),m=i.getStats(),_=i.getLocalMedia(a);if(m){const v=m.audioSend.find(b=>b.ssrc===_?.ssrcs[0].ssrcId);if(v){if("opus"!==v.codec&&"aac"!==v.codec&&"PCMU"!==v.codec&&"PCMA"!==v.codec&&"G722"!==v.codec||(p.codecType=v.codec),v.inputLevel)p.sendVolumeLevel=Math.round(32767*v.inputLevel);else{const b=i.getLocalAudioVolume();b&&(p.sendVolumeLevel=Math.round(32767*b))}p.sendBytes=v.bytes,p.sendPackets=v.packets,p.sendPacketsLost=v.packetsLost,p.sendJitterMs=v.jitterMs,p.sendRttMs=v.rttMs,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0}}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(re.LocalAudioTrack,p),p&&_&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,_.track,p);break}}})}updateRemoteStats(i){Array.from(this.remoteStats.entries()).forEach(r=>{var a,d;let[l,{videoStats:h,audioStats:p,videoPcStats:m}]=r;const _=p,v=h,b=m,y=Xa({},jd),T=Xa({},sN),M=Xa({},oN),{audioTrack:O,videoTrack:D,audioSSRC:x,videoSSRC:F}=i.getRemoteMedia(l);let j;j=i instanceof Je?i.getStats(!0):i.getStats();const q=null===(a=j)||void 0===a?void 0:a.audioRecv.find(Q=>Q.ssrc===x),te=null===(d=j)||void 0===d?void 0:d.videoRecv.find(Q=>Q.ssrc===F),K=this.trafficStats&&this.trafficStats.peer_delay.find(Q=>Q.peer_uid===l);if(q&&("opus"!==q.codec&&"aac"!==q.codec&&"PCMU"!==q.codec&&"PCMA"!==q.codec&&"G722"!==q.codec||(y.codecType=q.codec),q.outputLevel?y.receiveLevel=Math.round(32767*q.outputLevel):O&&(y.receiveLevel=Math.round(32767*O.getVolumeLevel())),y.receiveBytes=q.bytes,y.receivePackets=q.packets,y.receivePacketsLost=q.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost),y.receiveBitrate=_?8*Math.max(0,y.receiveBytes-_.receiveBytes):0,y.totalDuration=_?_.totalDuration+1:1,y.totalFreezeTime=_?_.totalFreezeTime:0,y.freezeRate=y.totalFreezeTime/y.totalDuration,y.receiveDelay=q.jitterBufferMs,y.totalDuration>10&&Cs.isRemoteAudioFreeze(O)&&(y.totalFreezeTime+=1)),te){"H264"!==te.codec&&"H265"!==te.codec&&"VP8"!==te.codec&&"VP9"!==te.codec&&"AV1X"!==te.codec&&"AV1"!==te.codec||(T.codecType=te.codec),T.receiveBytes=te.bytes,T.receiveBitrate=v?8*Math.max(0,T.receiveBytes-v.receiveBytes):0,T.decodeFrameRate=te.decodeFrameRate<0?0:te.decodeFrameRate,T.renderFrameRate=te.decodeFrameRate<0?0:te.decodeFrameRate,te.outputFrame&&(T.renderFrameRate=te.outputFrame.frameRate),te.receivedFrame?(T.receiveFrameRate=te.receivedFrame.frameRate,T.receiveResolutionHeight=te.receivedFrame.height,T.receiveResolutionWidth=te.receivedFrame.width):D&&(T.receiveResolutionHeight=D._videoHeight||0,T.receiveResolutionWidth=D._videoWidth||0),void 0!==te.framesRateFirefox&&(T.receiveFrameRate=Math.round(te.framesRateFirefox)),T.receivePackets=te.packets,T.receivePacketsLost=te.packetsLost,T.packetLossRate=T.receivePacketsLost/(T.receivePackets+T.receivePacketsLost),T.totalDuration=v?v.totalDuration+1:1,T.totalFreezeTime=v?v.totalFreezeTime:0,T.receiveDelay=te.jitterBufferMs||0;const Q=!!F&&i.getRemoteVideoIsReady(F);D&&Q&&Cs.isRemoteVideoFreeze(D,te,b)&&(T.totalFreezeTime+=1),T.freezeRate=T.totalFreezeTime/T.totalDuration}K&&(y.end2EndDelay=K.B_ad,T.end2EndDelay=K.B_vd,y.transportDelay=K.B_ed,T.transportDelay=K.B_ed,y.currentPacketLossRate=K.B_ealr4/100,T.currentPacketLossRate=K.B_evlr4/100,M.uplinkNetworkQuality=K.B_punq?K.B_punq:0,M.downlinkNetworkQuality=K.B_pdnq?K.B_pdnq:0),this.remoteStats.set(l,{audioStats:y,videoStats:T,videoPcStats:te,networkStats:M}),O&&this.exceptionMonitor.setRemoteAudioStats(O,y),D&&this.exceptionMonitor.setRemoteVideoStats(D,T)})}}function cg(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function go(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?cg(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):cg(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class yF extends jt{constructor(i,r,a,d){super(),S(this,"spec",void 0),S(this,"token",void 0),S(this,"websocket",void 0),S(this,"pingpongTimer",void 0),S(this,"reconnectMode","retry"),S(this,"serviceMode",void 0),S(this,"reqId",0),S(this,"commandReqId",0),S(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),S(this,"handleWebSocketMessage",l=>{if(!l.data)return;const h=JSON.parse(l.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):this.serviceMode===qn.INJECT?this.emit(Vs.INJECT_STREAM_STATUS,h):(Ie.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===qn.TRANSCODE?1:2}),this.emit(Vs.PUBLISH_STREAM_STATUS,h))}),this.spec=r,this.token=i,this.serviceMode=d,this.websocket=new Rm("live-streaming",a),this.websocket.on(Me.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Me.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Me.REQUEST_NEW_URLS,(l,h)=>{rn(this,Vs.REQUEST_NEW_ADDRESS).then(l).catch(h)}),this.websocket.on(Me.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(i){return this.websocket.init(i)}request(i,r,a,d){var l=this;return L(function*(){l.reqId+=1,"request"===i&&(l.commandReqId+=1);const h=l.commandReqId,p=l.reqId;if(!p||!l.websocket)throw new W(k.UNEXPECTED_ERROR);const m=go({command:i,sdkVersion:"4.20.0"===Do?"0.0.1":Do,seq:p,requestId:p,allocate:a,cname:l.spec.cname,appId:l.spec.appId,sid:l.spec.sid,uid:l.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if("closed"===l.websocket.state)throw new W(k.WS_DISCONNECT);const _=()=>new X((T,M)=>{l.websocket.once(Me.CLOSED,()=>M(new W(k.WS_ABORT))),l.websocket.once(Me.CONNECTED,T)});"connected"!==l.websocket.state&&(yield _()),m.clientRequest&&(m.clientRequest.workerToken=l.token);const v=new X((T,M)=>{const O=()=>{M(new W(k.WS_ABORT))};l.websocket.once(Me.RECONNECTING,O),l.websocket.once(Me.CLOSED,O),l.once("@".concat(p,"-").concat(l.spec.sid),D=>{T(D)})});d&&Ie.workerEvent(l.spec.sid,go(go({},d),{},{requestId:h,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));const b=Date.now();l.websocket.sendMessage(m);let y=null;try{y=yield v}catch(T){if("closed"===l.websocket.state)throw T;return yield _(),yield l.request(i,r,a)}return d&&Ie.workerEvent(l.spec.sid,go(go({},d),{},{requestId:h,actionType:"response",payload:JSON.stringify(y.serverResponse),serverCode:y.code,success:200===y.code,responseTime:Date.now()-b})),200!==y.code&&l.handleResponseError(y),y})()}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const i="4.20.0"===Do?"0.0.1":Do;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:i,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(i){switch(i.code){case Mn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void I.warning("live stream response already exists stream");case Mn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Mn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Mn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new W(k.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:i.code}).throw();case Mn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===i.serverResponse.command||"UninjectStream"===i.serverResponse.command)return;throw new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Mn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new W(k.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:i.code}).throw();case Mn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const r=new W(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Vs.WARNING,r,i.serverResponse.url)}case Mn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const r=new W(k.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Vs.WARNING,r,i.serverResponse.url)}case Mn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Mn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new W(k.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:i.code}).throw();case Mn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const r=new W(k.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Vs.WARNING,r,i.serverResponse.url)}case Mn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code}).throw();case Mn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Mn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Mn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===i.serverResponse.command||"UninjectStream"===i.serverResponse.command)return;throw new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Mn.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===i.serverResponse.command||"UninjectStream"===i.serverResponse.command)return;if("UpdateTranscoding"===i.serverResponse.command||"ControlStream"===i.serverResponse.command)return new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:i.code}).throw();throw new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Mn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Mn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Mn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Mn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new W(k.LIVE_STREAMING_CDN_ERROR,"",{code:i.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(Yl)},6e3)}}function Gi(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Lr(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?Gi(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Gi(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class si extends jt{constructor(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Pn,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Pn;super(),S(this,"onLiveStreamWarning",void 0),S(this,"onLiveStreamError",void 0),S(this,"onInjectStatusChange",void 0),S(this,"spec",void 0),S(this,"retryTimeout",1e4),S(this,"connection",void 0),S(this,"httpRetryConfig",void 0),S(this,"wsRetryConfig",void 0),S(this,"streamingTasks",new Map),S(this,"isStartingStreamingTask",!1),S(this,"taskMutex",new Ei("live-streaming")),S(this,"cancelToken",Ze.CancelToken.source()),S(this,"transcodingConfig",void 0),S(this,"injectConfig",Lr({},kL)),S(this,"injectLoopTimes",0),S(this,"uapResponse",void 0),S(this,"lastTaskId",1),S(this,"statusError",new Map),this.spec=i,this.httpRetryConfig=a,this.wsRetryConfig=r}setTranscodingConfig(i){var r=this;return L(function*(){const a=Lr(Lr({},xL),i);var p;66!==a.videoCodecProfile&&77!==a.videoCodecProfile&&100!==a.videoCodecProfile&&(I.debug("[".concat(r.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(a.videoCodecProfile," -> 100")),a.videoCodecProfile=100),a.transcodingUsers||(a.transcodingUsers=a.userConfigs),a.transcodingUsers&&(a.transcodingUsers=a.transcodingUsers.map(p=>Lr(Lr(Lr({},NO),p),{},{zOrder:p.zOrder?p.zOrder+1:1}))),nn((p=a).width)||At(p.width,"config.width",0,1e4),nn(p.height)||At(p.height,"config.height",0,1e4),nn(p.videoBitrate)||At(p.videoBitrate,"config.videoBitrate",1,1e6),nn(p.videoFrameRate)||At(p.videoFrameRate,"config.videoFrameRate"),nn(p.lowLatency)||wc(p.lowLatency,"config.lowLatency"),nn(p.audioSampleRate)||Sn(p.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),nn(p.audioBitrate)||At(p.audioBitrate,"config.audioBitrate",1,128),nn(p.audioChannels)||Sn(p.audioChannels,"config.audioChannels",[1,2,3,4,5]),nn(p.videoGop)||At(p.videoGop,"config.videoGop"),nn(p.videoCodecProfile)||Sn(p.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),nn(p.userCount)||At(p.userCount,"config.userCount",0,17),nn(p.backgroundColor)||At(p.backgroundColor,"config.backgroundColor",0,16777215),nn(p.userConfigExtraInfo)||hi(p.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),p.transcodingUsers&&!nn(p.transcodingUsers)&&(La(p.transcodingUsers,"config.transcodingUsers"),p.transcodingUsers.forEach((m,_)=>{dv(m.uid),nn(m.x)||At(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),nn(m.y)||At(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),nn(m.width)||At(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),nn(m.height)||At(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),nn(m.zOrder)||At(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),nn(m.alpha)||At(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),nn(p.watermark)||Vn(p.watermark,"watermark"),nn(p.backgroundImage)||Vn(p.backgroundImage,"backgroundImage"),p.images&&!nn(p.images)&&(La(p.images,"config.images"),p.images.forEach((m,_)=>{Vn(m,"images[".concat(_,"]"))}));const d=[];a.images&&d.push(...a.images.map(p=>Lr(Lr(Lr({},PO),p),{},{zOrder:255}))),a.backgroundImage&&(d.push(Lr(Lr(Lr({},PO),a.backgroundImage),{},{zOrder:0})),delete a.backgroundImage),a.watermark&&(d.push(Lr(Lr(Lr({},PO),a.watermark),{},{zOrder:255})),delete a.watermark),a.images=d,a.transcodingUsers&&(a.userConfigs=a.transcodingUsers.map(p=>Lr({},p)),a.userCount=a.transcodingUsers.length,delete a.transcodingUsers);const l=(a.userConfigs||[]).map(p=>"number"==typeof p.uid?X.resolve(p.uid):ar(p.uid,r.spec,r.cancelToken.token,r.httpRetryConfig));if((yield X.all(l)).forEach((p,m)=>{a.userConfigs&&a.userConfigs[m]&&(a.userConfigs[m].uid=p)}),r.transcodingConfig=a,r.connection)try{var h;const p=yield r.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:r.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(ca(h=r.streamingTasks).call(h)).map(m=>m.taskId).join("#")});I.debug("[".concat(r.spec.clientId,"] update live transcoding config success, code: ").concat(p.code,", config:"),JSON.stringify(r.transcodingConfig))}catch(p){if(!p.data||!p.data.retry)throw p;p.data.changeAddress&&r.connection.tryNextAddress(),r.streamingTasks.forEach(m=>{I.warning("[".concat(r.spec.clientId,"] live streaming receive error"),p.toString(),"try to republish",m.url),r.startLiveStreamingTask(m.url,m.mode,p).then(()=>{I.debug("[".concat(r.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{I.error("[".concat(r.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),r.onLiveStreamError&&r.onLiveStreamError(m.url,_)})})}})()}setInjectStreamConfig(i,r){this.injectConfig=Object.assign({},this.injectConfig,i),this.injectLoopTimes=r}startLiveStreamingTask(i,r,a){var d=this;return L(function*(){var l;if(Array.from(ca(l=d.streamingTasks).call(l)).find(_=>_.mode===qn.INJECT)&&r===qn.INJECT)return new W(k.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!d.transcodingConfig&&r===qn.TRANSCODE)throw new W(k.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let h={command:"PublishStream",ts:Date.now(),url:i,uid:d.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};I.debug("[".concat(d.spec.clientId,"] start live streaming ").concat(i,", mode: ").concat(r));const p=yield d.taskMutex.lock();if(!d.connection&&a)return void p();if(d.streamingTasks.get(i)&&!a)return p(),new W(k.LIVE_STREAMING_TASK_CONFLICT).throw();try{d.connection||(d.connection=yield d.connect(r))}catch(_){throw p(),_}switch(r){case qn.TRANSCODE:h.transcodingConfig=Lr({},d.transcodingConfig);break;case qn.RAW:break;case qn.INJECT:h={cname:d.spec.cname,command:"InjectStream",sid:d.spec.sid,transcodingConfig:d.injectConfig,ts:Date.now(),url:i,loopTimes:d.injectLoopTimes}}d.uapResponse&&d.uapResponse.vid&&(h.vid=d.uapResponse.vid),d.isStartingStreamingTask=!0;const m=d.lastTaskId++;try{const _=new X((b,y)=>{Un(d.retryTimeout).then(()=>{if(a)return y(a);const T=d.statusError.get(i);return T?(d.statusError.delete(i),y(T)):void 0})}),v=yield X.race([d.connection.request("request",{clientRequest:h},!0,{url:i,command:"PublishStream",workerType:r===qn.TRANSCODE?1:2,requestByUser:!a,tid:m.toString()}),_]);d.isStartingStreamingTask=!1,I.debug("[".concat(d.spec.clientId,"] live streaming started, code: ").concat(v.code)),d.streamingTasks.set(i,{clientRequest:h,mode:r,url:i,taskId:m}),p()}catch(_){if(p(),d.isStartingStreamingTask=!1,!_.data||!_.data.retry||a)throw _;return _.data.changeAddress?(d.connection.tryNextAddress(),yield d.startLiveStreamingTask(i,r,_)):yield d.startLiveStreamingTask(i,r,_)}})()}stopLiveStreamingTask(i){return new X((r,a)=>{const d=this.streamingTasks.get(i);if(!d||!this.connection)return new W(k.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const l=d.mode;d.abortTask=()=>{I.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(i),r()},this.connection.request("request",{clientRequest:{command:l===qn.INJECT?"UninjectStream":"UnpublishStream",url:d.url}},!1,{url:i,command:"UnPublishStream",workerType:l===qn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{I.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(i),0===this.streamingTasks.size&&l!==qn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),r(),l===qn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(kc.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,i)}).catch(a)})}controlInjectStream(i,r,a,d){var l=this;return L(function*(){const h=l.streamingTasks.get(i);if(!h||!l.connection||h.mode!==qn.INJECT)throw new W(k.INVALID_OPERATION,"can not find inject stream task to control");return(yield l.connection.request("request",{clientRequest:{command:"ControlStream",url:i,control:r,audioVolume:a,position:d}})).serverResponse})()}resetAllTask(){var i;const r=Array.from(ca(i=this.streamingTasks).call(i));this.terminate();for(const a of r)this.startLiveStreamingTask(a.url,a.mode).catch(d=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,d)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ze.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}connect(i){var r=this;return L(function*(){if(r.connection)throw new W(k.UNEXPECTED_ERROR,"live streaming connection has already connected");const a=yield rn(r,da.REQUEST_WORKER_MANAGER_LIST,i);return r.uapResponse=a,r.connection=new yF(a.workerToken,r.spec,r.wsRetryConfig,i),r.connection.on(Vs.WARNING,(d,l)=>r.onLiveStreamWarning&&r.onLiveStreamWarning(l,d)),r.connection.on(Vs.PUBLISH_STREAM_STATUS,d=>r.handlePublishStreamServer(d)),r.connection.on(Vs.INJECT_STREAM_STATUS,d=>r.handleInjectStreamServerStatus(d)),r.connection.on(Vs.REQUEST_NEW_ADDRESS,(d,l)=>{if(!r.connection)return l(new W(k.UNEXPECTED_ERROR,"can not get new live streaming address list"));rn(r,da.REQUEST_WORKER_MANAGER_LIST,i).then(h=>{r.uapResponse=h,d(h.addressList)}).catch(l)}),yield r.connection.init(a.addressList),r.connection})()}handlePublishStreamServer(i){const r=i.serverStatus&&i.serverStatus.url||"empty_url",a=this.streamingTasks.get(r),d=i.reason;switch(i.code){case Mn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Mn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Mn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Mn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new W(k.LIVE_STREAMING_CDN_ERROR,"",{code:i.code});if(a)return I.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,h);if(!this.isStartingStreamingTask)return;this.statusError.set(r,h)}case Mn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new W(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,d);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,h)}case Mn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Mn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var l;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(ca(l=this.streamingTasks).call(l));for(const p of h)p.abortTask?p.abortTask():(I.warning("[".concat(this.spec.clientId,"] publish stream status code"),i.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code})).then(()=>{I.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(m=>{I.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,m)}));return}}}handleInjectStreamServerStatus(i){const r=Number(i.uid),a=i.serverStatus&&i.serverStatus.url;switch(i.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(kc.INJECT_STREAM_STATUS_START_SUCCESS,r,a));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(kc.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,r,a),void this.streamingTasks.delete(a);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(kc.INJECT_STREAM_STATUS_START_UNAUTHORIZED,r,a),void this.streamingTasks.delete(a);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(kc.INJECT_STREAM_STATUS_BROKEN,r,a),void this.streamingTasks.delete(a);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(kc.INJECT_STREAM_STATUS_START_TIMEOUT,r,a),void this.streamingTasks.delete(a);default:return void I.debug("inject stream server status",i)}}hasUrl(i){return this.streamingTasks.has(i)}}class nb{constructor(){S(this,"destChannelMediaInfos",new Map),S(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(i){MO(i),this.srcChannelMediaInfo=i}addDestChannelInfo(i){MO(i),this.destChannelMediaInfos.set(i.channelName,i)}removeDestChannelInfo(i){OO(i),this.destChannelMediaInfos.delete(i)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function dg(s){if(!(s instanceof nb))return new W(k.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const i=s.getSrcChannelMediaInfo(),r=s.getDestChannelMediaInfo();return i?0===r.size?new W(k.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new W(k.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class CF extends jt{constructor(i,r,a){super(),S(this,"ws",void 0),S(this,"requestId",1),S(this,"heartBeatTimer",void 0),S(this,"joinInfo",void 0),S(this,"clientId",void 0),S(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),S(this,"onClose",d=>{this.emit("close"),this.dispose()}),S(this,"onMessage",d=>{const l=JSON.parse(d.data);if(!l||"serverResponse"!==l.command||!l.requestId)return l&&"serverStatus"===l.command&&l.serverStatus&&l.serverStatus.command?(this.emit("status",l.serverStatus),void this.emit(l.serverStatus.command,l.serverStatus)):void 0;this.emit("req_".concat(l.requestId),l)}),this.joinInfo=i,this.clientId=r,this.ws=new Rm("cross-channel-".concat(this.clientId),a),this.ws.on(Me.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Me.CONNECTED,this.onOpen),this.ws.on(Me.ON_MESSAGE,this.onMessage),this.ws.on(Me.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(i){const r=this.requestId++;return i.requestId=r,i.seq=r,this.ws.sendMessage(i),r}waitStatus(i){return new X((r,a)=>{const d=window.setTimeout(()=>{a(new W(k.TIMEOUT,"wait status timeout, status: ".concat(i)))},5e3);this.once(i,l=>{window.clearTimeout(d),l.state&&0!==l.state?a(new W(k.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(i))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(d),a(new W(k.WS_ABORT))})})}request(i){var r=this;return L(function*(){if("closed"===r.ws.state)throw new W(k.WS_DISCONNECT);"connected"!==r.ws.state&&(yield new X((p,m)=>{r.ws.once(Me.CLOSED,()=>m(new W(k.WS_ABORT))),r.ws.once(Me.CONNECTED,p)}));const d=r.sendMessage(i),l=new X((p,m)=>{const _=()=>{m(new W(k.WS_ABORT))};r.ws.once(Me.RECONNECTING,_),r.ws.once(Me.CLOSED,_),r.once("req_".concat(d),p),Un(3e3).then(()=>{r.removeAllListeners("req_".concat(d)),r.ws.off(Me.RECONNECTING,_),r.ws.off(Me.CLOSED,_),m(new W(k.TIMEOUT,"cross channel ws request timeout"))})}),h=yield l;if(!h||200!==h.code)throw new W(k.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(h)));return h})()}connect(i){var r=this;return L(function*(){r.ws.removeAllListeners(Me.REQUEST_NEW_URLS),r.ws.on(Me.REQUEST_NEW_URLS,a=>{a(i)}),yield r.ws.init(i)})()}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(i){const r=this.requestId++;return i.requestId=r,this.ws.sendMessage(i),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class ib extends jt{set state(i){i!==this._state&&(i!==sr.RELAY_STATE_FAILURE&&(this.errorCode=Fc.RELAY_OK),this.emit("state",i,this.errorCode),this._state=i)}get state(){return this._state}constructor(i,r,a,d,l){var h;super(),h=this,S(this,"joinInfo",void 0),S(this,"sid",void 0),S(this,"clientId",void 0),S(this,"cancelToken",Ze.CancelToken.source()),S(this,"workerToken",void 0),S(this,"requestId",0),S(this,"signal",void 0),S(this,"prevChannelMediaConfig",void 0),S(this,"httpRetryConfig",void 0),S(this,"_resolution",void 0),S(this,"_state",sr.RELAY_STATE_IDLE),S(this,"errorCode",Fc.RELAY_OK),S(this,"onStatus",p=>{I.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(p))),p&&p.command&&("onAudioPacketReceived"===p.command&&this.emit("event",bi.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===p.command&&this.emit("event",bi.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===p.command&&(this.errorCode=Fc.SRC_TOKEN_EXPIRED,this.state=sr.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===p.command&&(this.errorCode=Fc.DEST_TOKEN_EXPIRED,this.state=sr.RELAY_STATE_FAILURE))}),S(this,"onReconnect",L(function*(){I.debug("[".concat(h.clientId,"] ChannelMediaSocket disconnect, reconnecting")),h.emit("event",bi.NETWORK_DISCONNECTED),h.state=sr.RELAY_STATE_IDLE,h.prevChannelMediaConfig&&h.sendStartRelayMessage(h.prevChannelMediaConfig).catch(p=>{h.state!==sr.RELAY_STATE_IDLE&&(I.error("auto restart channel media relay failed",p.toString()),h.errorCode=Fc.SERVER_CONNECTION_LOST,h.state=sr.RELAY_STATE_FAILURE)})})),this.joinInfo=i,this.clientId=r,this.sid=Ac(),this.signal=new CF(this.joinInfo,this.clientId,a),this.httpRetryConfig=d,this._resolution=l}startChannelMediaRelay(i){var r=this;return L(function*(){if(r.state!==sr.RELAY_STATE_IDLE)throw new W(k.INVALID_OPERATION);r.state=sr.RELAY_STATE_CONNECTING,yield r.connect(),I.debug("[".concat(r.clientId,"] startChannelMediaRelay: connect success"));try{yield r.sendStartRelayMessage(i)}catch(a){throw a.data&&a.data.serverResponse&&"SetSourceChannel"===a.data.serverResponse.command?new W(k.CROSS_CHANNEL_FAILED_JOIN_SRC):a.data&&a.data.serverResponse&&"SetDestChannelStatus"===a.serverResponse.command?new W(k.CROSS_CHANNEL_FAILED_JOIN_DEST):a.data&&a.data.serverResponse&&"StartPacketTransfer"===a.serverResponse.command?new W(k.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):a}r.prevChannelMediaConfig=i})()}updateChannelMediaRelay(i){var r=this;return L(function*(){if(r.state!==sr.RELAY_STATE_RUNNING)throw new W(k.INVALID_OPERATION);yield r.sendUpdateMessage(i),r.prevChannelMediaConfig=i})()}setVideoProfile(i){var r=this;return L(function*(){if(r._resolution=i,r.state!==sr.RELAY_STATE_RUNNING)throw new W(k.INVALID_OPERATION);const a=r.genMessage(Si.SetVideoProfile);yield r.signal.request(a),I.debug("[".concat(r.clientId,"] startChannelMediaRelay: setVideoProfile success"))})()}stopChannelMediaRelay(){var i=this;return L(function*(){yield i.sendStopRelayMessage(),I.debug("[".concat(i.clientId,"] stopChannelMediaRelay: send stop message success")),i.state=sr.RELAY_STATE_IDLE,i.dispose()})()}dispose(){I.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ze.CancelToken.source(),this.state=sr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}connect(){var i=this;return L(function*(){const r=yield function e2(s,i,r){return DT.apply(this,arguments)}(i.joinInfo,i.cancelToken.token,i.httpRetryConfig);i.workerToken=r.workerToken,yield i.signal.connect(r.addressList),i.emit("event",bi.NETWORK_CONNECTED),i.signal.on("status",i.onStatus),i.signal.on("reconnecting",i.onReconnect)})()}sendStartRelayMessage(i){var r=this;return L(function*(){const a=r.genMessage(Si.StopPacketTransfer);yield r.signal.request(a),yield r.signal.waitStatus("Normal Quit"),I.debug("[".concat(r.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const d=r.genMessage(Si.SetSdkProfile,i);yield r.signal.request(d),I.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const l=r.genMessage(Si.SetSourceChannel,i);yield r.signal.request(l),yield r.signal.waitStatus("SetSourceChannelStatus"),r.emit("event",bi.PACKET_JOINED_SRC_CHANNEL),I.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const h=r.genMessage(Si.SetSourceUserId,i);yield r.signal.request(h),I.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const p=r.genMessage(Si.SetDestChannel,i);yield r.signal.request(p),yield r.signal.waitStatus("SetDestChannelStatus"),r.emit("event",bi.PACKET_JOINED_DEST_CHANNEL),I.debug("[".concat(r.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=r.genMessage(Si.StartPacketTransfer,i);yield r.signal.request(m),r.emit("event",bi.PACKET_SENT_TO_DEST_CHANNEL),r.state=sr.RELAY_STATE_RUNNING,I.debug("[".concat(r.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),r.setVideoProfile(r._resolution)})()}sendUpdateMessage(i){var r=this;return L(function*(){const a=r.genMessage(Si.UpdateDestChannel,i);yield r.signal.request(a),r.emit("event",bi.PACKET_UPDATE_DEST_CHANNEL),I.debug("[".concat(r.clientId,"] sendUpdateMessage: UpdateDestChannel success"))})()}sendStopRelayMessage(){var i=this;return L(function*(){const r=i.genMessage(Si.StopPacketTransfer);yield i.signal.request(r),I.debug("[".concat(i.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))})()}genMessage(i,r){const a=[],d=[],l=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Do,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.20.0"===h.sdkVersion&&(h.sdkVersion="0.0.1");let p=null,m=null;switch(i){case Si.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Si.SetSourceChannel:if(m=r&&r.getSrcChannelMediaInfo(),!m)throw new W(k.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},h;case Si.SetSourceUserId:if(m=r&&r.getSrcChannelMediaInfo(),!m)throw new W(k.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:m.uid+""},h;case Si.SetDestChannel:if(p=r&&r.getDestChannelMediaInfo(),!p)throw new W(k.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{a.push(_.channelName),d.push(_.uid+""),l.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:a,uid:d,token:l},h;case Si.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Si.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Si.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Si.UpdateDestChannel:if(p=r&&r.getDestChannelMediaInfo(),!p)throw new W(k.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{a.push(_.channelName),d.push(_.uid+""),l.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:d,token:l},h;case Si.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}function rb(s){var i={},r=!1;function a(d,l){return r=!0,{done:!1,value:new w0(l=new $v(function(h){h(s[d](l))}),1)}}return i[void 0!==Ls&&OC||"@@iterator"]=function(){return this},i.next=function(d){return r?(r=!1,d):a("next",d)},"function"==typeof s.throw&&(i.throw=function(d){if(r)throw r=!1,d;return a("throw",d)}),"function"==typeof s.return&&(i.return=function(d){return r?(r=!1,d):a("return",d)}),i}var M0=Rt(rF);function ob(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function lg(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?ob(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):ob(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function sb(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function gP(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?sb(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):sb(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class pi extends hv{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(i=>i.rtpMap&&i.rtpMap.encodingName.toLowerCase()||"").filter(i=>{var r;return ye(r=Object.keys(Mc)).call(r,i)}))]}constructor(i,r){super(i,r),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"remoteSDP",void 0),S(this,"initialOffer",void 0),S(this,"statsFilter",void 0),S(this,"useRTX",!1),S(this,"localCapabilities",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"establishPromise",void 0),S(this,"mutex",new Ei("P2PConnection-mutex")),this.store=r,this.peerConnection=new RTCPeerConnection(pi.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=Op(this.peerConnection,V("STATS_UPDATE_INTERVAL"),void 0,Pt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){var i=this;return L(function*(){try{const r=yield i.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=Ks(r.sdp),d=ga(r.sdp,{filterRTX:!i.useRTX,filterVideoFec:V("FILTER_VIDEO_FEC"),filterAudioFec:V("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return i.localCapabilities=d,i.initialOffer=r,gP(gP({},a),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:d},offerSDP:r.sdp})}catch(r){throw new ee(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}})()}connect(i,r,a,d,l,h){var p=this;return L(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");p.remoteSDP=new class{constructor(_){S(this,"sessionDesc",void 0),S(this,"localCapabilities",void 0),S(this,"rtpCapabilities",void 0),S(this,"candidates",void 0),S(this,"iceParameters",void 0),S(this,"dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname",void 0),_=Ft(_);const{remoteIceParameters:v,remoteDtlsParameters:b,candidates:y,remoteRTPCapabilities:T,remoteSetup:M,localCapabilities:O,sdkCodec:D,cname:x}=_,F=Jt.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=T,this.candidates=y,this.iceParameters=v,this.dtlsParameters=b,this.setup=M,this.localCapabilities=O,this.cname=x;for(let j=0;j<F.mediaDescriptions.length;j++){const q=F.mediaDescriptions[j];if(q.attributes.iceUfrag=v.iceUfrag,q.attributes.icePwd=v.icePwd,q.attributes.fingerprints=b.fingerprints,q.attributes.candidates=y,q.attributes.setup=M,"video"===q.media.mediaType){q.media.fmts=T.videoCodecs.map(K=>K.payloadType.toString(10));let te=T.videoCodecs.filter(K=>{var Q,$;return null===(Q=K.rtpMap)||void 0===Q?void 0:ye($=Q.encodingName.toLowerCase()).call($,D)});0===te.length&&(te=T.videoCodecs),q.attributes.payloads=te,q.attributes.extmaps=T.videoExtensions}"audio"===q.media.mediaType&&(q.media.fmts=T.audioCodecs.map(te=>te.payloadType.toString(10)),q.attributes.payloads=T.audioCodecs,q.attributes.extmaps=T.audioExtensions),F.mediaDescriptions[j]=this.mungMediaDesc(q)}this.sessionDesc=F,this.currentMidIndex=F.mediaDescriptions.length-1}toString(){return Jt.print(this.sessionDesc)}send(_,v,b){const{ssrcs:y,ssrcGroups:T}=Hi(v,this.cname),M=this.sessionDesc.mediaDescriptions.find(x=>_===Ce.VIDEO?"video"===x.media.mediaType:"audio"===x.media.mediaType),O=y[0].attributes.label,D=y[0].attributes.mslabel;return M.attributes.ssrcs=M.attributes.ssrcs.concat(y),M.attributes.ssrcGroups=M.attributes.ssrcGroups.concat(T),{id:O,mslabel:D}}batchSend(_){return _.map(v=>{let{kind:b,ssrcMsg:y}=v;return this.send(b,y,void 0)})}stopSending(_){this.sessionDesc.mediaDescriptions.forEach(v=>{const b=[],y=[],T=[];v.attributes.ssrcs.forEach(M=>{ye(_).call(_,M.attributes.label||"")?T.push(M):b.push(M)}),v.attributes.ssrcGroups.forEach(M=>{var O;ye(O=T.map(D=>D.ssrcId)).call(O,M.ssrcIds[0])||y.push(M)}),v.attributes.ssrcs=b,v.attributes.ssrcGroups=y})}mute(_){const v=this.sessionDesc.mediaDescriptions.find(b=>b.attributes.mid===_);if(!v)throw new Error("mediaDescription not found with ".concat(_," in remote SDP when calling RemoteSDP.mute."));v.attributes.direction="inactive"}unmute(_){const v=this.sessionDesc.mediaDescriptions.find(b=>b.attributes.mid===_);if(!v)throw new Error("mediaDescription not found with ".concat(_," in remote SDP when calling RemoteSDP.unmute."));v.attributes.direction="sendonly"}receive(_,v,b){_.forEach((y,T)=>{const M=y._mediaStreamTrack,O=this.sessionDesc.mediaDescriptions.findIndex(x=>x.attributes.mid===M.kind),D=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[O],y);this.sessionDesc.mediaDescriptions[O]=D})}stopReceiving(_){}updateCandidates(_){_===Mi.TCP?this.candidates.forEach(v=>{-1===this.candidates.findIndex(b=>"tcp"===b.transport&&b.connectionAddress===v.connectionAddress&&b.port===v.port)&&this.candidates.push(lg(lg({},v),{},{foundation:"tcpcandidate",priority:Number(v.priority)-1+"",transport:"tcp",port:Number(v.port)+90+""}))}):this.candidates=this.candidates.filter(v=>"tcp"!==v.transport);for(const v of this.sessionDesc.mediaDescriptions)v.attributes.candidates=this.candidates}restartICE(_){_=Ft(_),this.iceParameters=_,this.sessionDesc.mediaDescriptions.forEach(v=>{v.attributes.iceUfrag=_.iceUfrag,v.attributes.icePwd=_.icePwd})}predictReceivingMids(_){const v=[];for(let b=0;b<_;b++)v.push((this.currentMidIndex+b+1).toString(10));return v}mungRecvMediaDsec(_,v){const b=Ft(_);return Xd(b,v),og(b,v),b}updateRecvMedia(_,v){const b=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===_);if(-1!==b){const y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[b],v);this.sessionDesc.mediaDescriptions[b]=y}}bumpMid(_){this.currentMidIndex+=_}updateTrackLabel(_,v,b){const y=this.sessionDesc.mediaDescriptions.find(M=>_===Ce.VIDEO?"video"===M.attributes.mid:"audio"===M.attributes.mid);if(y){const M=y.attributes.ssrcs.find(O=>O.attributes.label===v);var T;M&&(M.attributes.label=b,null===(T=M.attributes.msid)||void 0===T||T.replace(v,b))}}mungMediaDesc(_){const v=Ft(_);return eb(v),function(b){const y=b.attributes.extmaps.find(T=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===T.extensionName);y&&b.attributes.extmaps.splice(b.attributes.extmaps.indexOf(y),1),b.attributes.payloads.forEach(T=>{const M=T.rtcpFeedbacks.findIndex(O=>"transport-cc"===O.type);-1!==M&&T.rtcpFeedbacks.splice(M,1)})}(v),v}getSSRC(_){for(const v of this.sessionDesc.mediaDescriptions)for(const b of v.attributes.ssrcs)if(b.attributes.label===_)return[b]}}({remoteIceParameters:i,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:d.send,remoteSetup:l,localCapabilities:p.localCapabilities,sdkCodec:p.store.codec,cname:h});const m=p.remoteSDP.toString();yield p.peerConnection.setLocalDescription(p.initialOffer),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}})()}updateRemoteRTPCapabilities(i,r){return L(function*(){throw new ee(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")})()}send(i,r){var a=this;return Xr(function*(){const d=yield Be(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const l=i.map(y=>a.peerConnection.addTrack(y._mediaStreamTrack)),h=yield Be(a.peerConnection.createOffer()),p=Jt.parse(h.sdp),m=i.map(y=>{const T=y._mediaStreamTrack,M=p.mediaDescriptions.find(O=>O.attributes.mid===T.kind);if(!M)throw new Error("Cannot extract ssrc from mediaDescription.");return function(O,D,x){const F=O.attributes.ssrcs.filter(q=>q.attributes.label===D),j=O.attributes.ssrcGroups;if(0===F.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(j&&F.length>1){const q=j.find(te=>-1!==te.ssrcIds.indexOf(F[0].ssrcId));return q?[{ssrcId:q.ssrcIds[0],rtx:x?q.ssrcIds[1]:void 0}]:[{ssrcId:F[0].ssrcId}]}return[{ssrcId:F[0].ssrcId}]}(M,T.id,a.useRTX)});let _;try{_=yield m}catch(y){throw l.forEach(T=>{fr()&&T.replaceTrack(null),a.peerConnection.removeTrack(T)}),y}const v=a.mungSendOfferSDP(h.sdp,i);a.remoteSDP.receive(i,r,_);const b=a.remoteSDP.toString();return yield Be(a.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield Be(a.applySendEncodings(l,i)),yield Be(a.peerConnection.setRemoteDescription({type:"answer",sdp:b})),i.map((y,T)=>({localSSRC:m[T],id:y._mediaStreamTrack.id}))}catch(l){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{d()}})()}stopSending(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=r.peerConnection.getSenders().filter(h=>{var p;return-1!==i.indexOf((null===(p=h.track)||void 0===p?void 0:p.id)||"")});if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");a.map(h=>{fr()&&h.replaceTrack(null),r.peerConnection.removeTrack(h)});const d=yield r.peerConnection.createOffer();yield r.peerConnection.setLocalDescription(d),r.remoteSDP.stopReceiving(i);const l=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}})()}receive(i,r,a,d){var l=this;return L(function*(){try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{id:h,mslabel:p}=l.remoteSDP.send(i,r,d),m=new X((b,y)=>{const T=setTimeout(()=>{y(new Error("Cannot receive track, id: ".concat(h)))},1e4),M=O=>{const D=lt();if(("Safari"===D.name&&11===Number(D.version)||Pi())&&O.track.id!==h&&O.streams[0].id===p){var x;const F=O.streams[0].getTracks()[0];return null===(x=l.remoteSDP)||void 0===x||x.updateTrackLabel(i,h,O.track.id),l.peerConnection.removeEventListener("track",M),clearTimeout(T),void b(F)}if(O.track.id===h)return l.peerConnection.removeEventListener("track",M),clearTimeout(T),void b(O.track)};l.peerConnection.addEventListener("track",M)}),_=l.remoteSDP.toString();yield l.peerConnection.setRemoteDescription({type:"offer",sdp:_});const v=yield l.peerConnection.createAnswer();return yield l.peerConnection.setLocalDescription(v),{track:yield m,id:h}}catch(h){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}stopReceiving(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(i);const a=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield r.peerConnection.createAnswer();yield r.peerConnection.setLocalDescription(d)}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(i){return L(function*(){})()}unmuteRemote(i){return L(function*(){})()}muteLocal(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=r.peerConnection.getSenders().filter(d=>{var l;return-1!==i.indexOf((null===(l=d.track)||void 0===l?void 0:l.id)||"")});if(a.length!==i.length)throw new Error("sender' length doesn't match mids' length.");a.map(d=>{if(fr()&&d.track)d.track.enabled=!1;else{const l=d.getParameters();l.encodings.forEach(h=>h.active=!1),d.setParameters(l)}})}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=r.peerConnection.getSenders().filter(h=>{var p;return-1!==i.indexOf((null===(p=h.track)||void 0===p?void 0:p.id)||"")});if(a.length!==i.length)throw new Error("Senders' length doesn't match mids' length.");a.map(function(){var h=L(function*(p){if(fr()&&p.track)p.track.enabled=!0;else{const m=p.getParameters();m.encodings.forEach(_=>_.active=!0),yield p.setParameters(m)}});return function(p){return h.apply(this,arguments)}}());const d=yield r.peerConnection.createOffer();yield r.peerConnection.setLocalDescription(d);const l=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(i){var r=this;return Xr(function*(){const a=yield Be(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ot().supportPCSetConfiguration){const m=r.peerConnection.getConfiguration(),_=i===Mi.RELAY?"relay":"all";m.iceTransportPolicy!==_&&(I.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(_,"]")),m.iceTransportPolicy=_,r.peerConnection.setConfiguration(m))}else if(i===Mi.RELAY)return;i!==Mi.RELAY&&r.remoteSDP.updateCandidates(i);const d=yield Be(r.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=Ks(d.sdp),{remoteIceParameters:h}=yield l.iceParameters;r.remoteSDP.restartICE(h);const p=r.remoteSDP.toString();yield Be(r.peerConnection.setLocalDescription(d)),yield Be(r.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(d){I.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),d)}finally{a()}})()}close(){var i;this.peerConnection.close(),null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,r){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const d=yield a.peerConnection.createOffer(),l=a.mungSendOfferSDP(d.sdp,[r]);a.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);const h=a.remoteSDP.toString();yield a.peerConnection.setLocalDescription({type:"offer",sdp:l}),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(d){throw new ee(k.EXCHANGE_SDP_FAILED,d.toString())}})()}updateSendParameters(i,r){var a=this;return L(function*(){const d=a.peerConnection.getSenders().filter(l=>{var h;return(null===(h=l.track)||void 0===h?void 0:h.id)===i});1===d.length&&(yield a.applySendEncodings(d,[r]))})()}setStatsRemoteVideoIsReady(i,r){this.statsFilter.setVideoIsReady2(i,r)}replaceTrack(i,r){var a=this;return L(function*(){const d=a.peerConnection.getSenders().find(l=>{var h;return(null===(h=l.track)||void 0===h?void 0:h.id)===r});d&&(yield d.replaceTrack(i._mediaStreamTrack))})()}createDataChannels(i,r){throw new ee(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(i){throw new ee(k.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;null===(i=this.onICEConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},V("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const r={iceServers:[],sdpSemantics:"plan-b"};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(oa(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...pi.turnServerConfigToIceServers(i.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...pi.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}updateRtpSenderEncodings(i,r){var a=this;return L(function*(){var d;if(r||(r=a.peerConnection.getSenders().find(v=>{var b;return(null===(b=v.track)||void 0===b?void 0:b.id)===i._mediaStreamTrack.id})),!r)return I.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(!Ot().supportSetRtpSenderParameters)return I.warn("Browser not support set rtp-sender parameters");const l={},h={};if(i instanceof je)switch(i._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;default:l.degradationPreference="balanced"}if(V("DSCP_TYPE")&&wd()){var p;const v=V("DSCP_TYPE");ye(p=["very-low","low","medium","high"]).call(p,v)&&(h.networkPriority=v)}const m=r.getParameters(),_=null===(d=m.encodings)||void 0===d?void 0:d[0];_&&Object.assign(_,h),Object.assign(m,l),I.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),yield r.setParameters(m)})()}applySendEncodings(i,r){var a=this;return L(function*(){try{if(!Ot().supportSetRtpSenderParameters||i.length!==r.length)return;for(let d=0;d<i.length;d++){const l=i[d],h=r[d];l&&h&&(yield a.updateRtpSenderEncodings(h,l))}}catch{I.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(i,r){const a=Jt.parse(i);return r.forEach((d,l)=>{const h=d._mediaStreamTrack,p=a.mediaDescriptions.find(m=>m.attributes.mid===h.kind);p&&Xd(p,d)}),Jt.print(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,r,a)=>{var d;null===(d=this.onFirstVideoDecoded)||void 0===d||d.call(this,i,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}batchReceive(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const a=r.remoteSDP.batchSend(i).map((h,p)=>{let{id:m,mslabel:_}=h;const{kind:v}=i[p];return new X((b,y)=>{const T=setTimeout(()=>{y(new Error("Cannot receive track, id: ".concat(m)))},1e4),M=O=>{const D=lt();if("Safari"===D.name&&11===Number(D.version)&&O.track.id!==m&&O.streams[0].id===_){var x;const F=O.streams[0].getTracks()[0];return null===(x=r.remoteSDP)||void 0===x||x.updateTrackLabel(v,m,O.track.id),r.peerConnection.removeEventListener("track",M),clearTimeout(T),void b({track:F,id:m})}if(O.track.id===m)return r.peerConnection.removeEventListener("track",M),clearTimeout(T),void b({track:O.track,id:m})};r.peerConnection.addEventListener("track",M)})}),d=r.remoteSDP.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:d});const l=yield r.peerConnection.createAnswer();return yield r.peerConnection.setLocalDescription(l),yield X.all(a)}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}})()}getRemoteSSRC(i){var r=this;return L(function*(){if(!r.remoteSDP)return;const a=r.remoteSDP.getSSRC(i);return a?.[0].ssrcId})()}setConfiguration(i){if(Ot().supportPCSetConfiguration){const r=pi.resolvePCConfiguration(i);this.peerConnection.setConfiguration(r)}}}function Ss(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=L(function*(){const d=this.mutex,l=yield d.lock("Locking from P2PConnection.".concat(i));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{l()}}),r}function _P(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function el(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?_P(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):_P(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}ne([Ss,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",X)],pi.prototype,"connect",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],pi.prototype,"stopSending",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",X)],pi.prototype,"receive",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],pi.prototype,"stopReceiving",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],pi.prototype,"muteRemote",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],pi.prototype,"unmuteRemote",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],pi.prototype,"muteLocal",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],pi.prototype,"unmuteLocal",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],pi.prototype,"close",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],pi.prototype,"updateEncoderConfig",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],pi.prototype,"updateSendParameters",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[Bi,String]),N("design:returntype",X)],pi.prototype,"replaceTrack",null),ne([Ss,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],pi.prototype,"getRemoteSSRC",null);function EP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function Du(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?EP(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):EP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class Qt extends hv{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,r;return null!==(i=null===(r=this.peerConnection.getReceivers()[0])||void 0===r||null===(r=r.transport)||void 0===r?void 0:r.state)&&void 0!==i?i:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(i=>i.rtpMap&&i.rtpMap.encodingName.toLowerCase()||"").filter(i=>{var r;return ye(r=Object.keys(Mc)).call(r,i)}))]}constructor(i,r){super(i,r),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"remoteSDP",void 0),S(this,"initialOffer",void 0),S(this,"transportEventReceiver",void 0),S(this,"statsFilter",void 0),S(this,"useXR",V("USE_XR")),S(this,"localCapabilities",void 0),S(this,"remoteCodecs",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"dataStreamChannelMap",new Map),S(this,"establishPromise",void 0),S(this,"mutex",new Ei("P2PConnection-mutex")),this.store=r,this.peerConnection=new RTCPeerConnection(Qt.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=Op(this.peerConnection,V("STATS_UPDATE_INTERVAL"),void 0,Pt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}updateRemoteRTPCapabilities(i,r){var a=this;return L(function*(){if(a.remoteCodecs=r,a.remoteSDP)if(a.remoteSDP.updateRemoteCodec(i,r,a.store.codec)){const d=yield a.peerConnection.createOffer(),l=a.logSDPExchange(d.sdp||"","offer","local","muteLocal");yield a.peerConnection.setLocalDescription(d);const h=a.remoteSDP.toString();l?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}else I.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else I.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(a.localCodecs,", codecs: ").concat(r))})()}establish(){var i=this;return L(function*(){try{i.peerConnection.addTransceiver("video",{direction:"recvonly"}),i.peerConnection.addTransceiver("audio",{direction:"recvonly"});const r=yield i.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=Ks(r.sdp),d=yield Jd({filterRTX:!V("USE_PUB_RTX")&&!V("USE_SUB_RTX"),filterVideoFec:V("FILTER_VIDEO_FEC"),filterAudioFec:V("FILTER_AUDIO_FEC"),filterVideoCodec:V("FILTER_VIDEO_CODEC")},{useXR:i.useXR});return i.localCapabilities=oi(d),i.initialOffer=r,Du(Du({},a),{},{rtpCapabilities:d,offerSDP:r.sdp})}catch(r){throw new ee(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}})()}connect(i,r,a,d,l,h){var p=this;return L(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");p.remoteSDP=new class{get localCapabilities(){return Ft(this._localCapabilities)}get rtpCapabilities(){return Ft(this._rtpCapabilities)}get candidates(){return Ft(this._candidates)}get iceParameters(){return Ft(this._iceParameters)}get dtlsParameters(){return Ft(this._dtlsParameters)}constructor(M){S(this,"sessionDesc",void 0),S(this,"_localCapabilities",void 0),S(this,"_rtpCapabilities",void 0),S(this,"_candidates",void 0),S(this,"_iceParameters",void 0),S(this,"_dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname",void 0),S(this,"firefoxSsrcMidMap",new Map),M=Ft(M);const{remoteIceParameters:O,remoteDtlsParameters:D,candidates:x,remoteRTPCapabilities:F,remoteSetup:j,localCapabilities:q,cname:te}=M,K=Jt.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=F,this._candidates=x,this._iceParameters=O,this._dtlsParameters=D,this._localCapabilities=q,this.setup=j,this.cname=te;const Q=this.rtpCapabilities.send;for(const $ of K.mediaDescriptions){if($.attributes.iceUfrag=O.iceUfrag,$.attributes.icePwd=O.icePwd,$.attributes.fingerprints=D.fingerprints,$.attributes.candidates=x,$.attributes.setup=j,"video"===$.media.mediaType&&($.media.fmts=Q.videoCodecs.map(z=>z.payloadType.toString(10)),$.attributes.payloads=Q.videoCodecs,$.attributes.extmaps=Q.videoExtensions,V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:z,ssrcGroups:_e}=Hi([{ssrcId:4e4,rtx:V("USE_SUB_RTX")?40001:void 0}],this.cname);$.attributes.ssrcs=z,$.attributes.ssrcGroups=_e}if("audio"===$.media.mediaType&&($.media.fmts=Q.audioCodecs.map(z=>z.payloadType.toString(10)),$.attributes.payloads=Q.audioCodecs,$.attributes.extmaps=Q.audioExtensions,_a($),V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:z,ssrcGroups:_e}=Hi([{ssrcId:2e4}],this.cname);$.attributes.ssrcs=z,$.attributes.ssrcGroups=_e}}this.sessionDesc=K,this.currentMidIndex=K.mediaDescriptions.length-1}preloadRemoteMedia(){const M=V("PRELOAD_MEDIA_COUNT"),O=this.candidates,D=this.dtlsParameters,x=this.iceParameters,F=this.rtpCapabilities.send;for(let j=1;j<M;j++){const q=2*j+2e4,te=2*j+4e4,{ssrcs:K,ssrcGroups:Q}=Hi([{ssrcId:q}],this.cname),{ssrcs:$,ssrcGroups:z}=Hi([{ssrcId:te,rtx:V("USE_SUB_RTX")?te+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:F.videoCodecs.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:x.iceUfrag,icePwd:x.icePwd,unrecognized:[],candidates:O,extmaps:F.videoExtensions,fingerprints:D.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:$,ssrcGroups:z,rtcpFeedbackWildcards:[],payloads:F.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*j)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:F.audioCodecs.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:x.iceUfrag,icePwd:x.icePwd,unrecognized:[],candidates:O,extmaps:F.audioExtensions,fingerprints:D.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:K,ssrcGroups:Q,rtcpFeedbackWildcards:[],payloads:F.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*j+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Jt.print(this.sessionDesc)}send(M,O,D,x){const{ssrcs:F,ssrcGroups:j}=Hi(O,this.cname,V("SYNC_GROUP")?D:void 0),q=this.findPreloadMediaDesc(F);if(q){if(Pt()&&this.firefoxSsrcMidMap.set(F[0].ssrcId,q.attributes.mid),x&&(x.twcc||x.remb)){const te=this.sessionDesc.mediaDescriptions.indexOf(q);return this.sessionDesc.mediaDescriptions[te]=this.mungSendMediaDesc(q,x),{mid:q.attributes.mid,needExchangeSDP:!0}}return{mid:q.attributes.mid,needExchangeSDP:!1}}{const te=this.findAvailableMediaIndex(M,F);let K;return-1===te||1===te&&(fr()||yL())||0===te&&V("USE_SUB_RTX")||ED()?(K=this.createOrRecycleSendMedia(M,F,j,"sendonly",x),this.updateBundleMids()):(K=Ft(this.sessionDesc.mediaDescriptions[te]),K.attributes.direction="sendonly",K.attributes.ssrcs=F,K.attributes.ssrcGroups=j,this.sessionDesc.mediaDescriptions[te]=this.mungSendMediaDesc(K,x)),Pt()&&this.firefoxSsrcMidMap.set(F[0].ssrcId,K.attributes.mid),{mid:K.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:M,needExchangeSDP:O}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:M.attributes.mid,needExchangeSDP:O}}batchSend(M){const O=M.map(F=>{let{kind:j,ssrcMsg:q,mslabel:te}=F;return this.send(j,q,te)}),D=[];let x=!1;return O.forEach(F=>{let{mid:j,needExchangeSDP:q}=F;q&&(x=!0),D.push(j)}),{mids:D,needExchangeSDP:x}}stopSending(M){const O=this.sessionDesc.mediaDescriptions.filter(D=>D.attributes.mid&&-1!==M.indexOf(D.attributes.mid));if(O.length!==M.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");O.forEach(D=>{"0"===D.attributes.mid||Pt()||ED()?D.attributes.ssrcs=[]:(D.attributes.ssrcs=[],D.attributes.direction="inactive",D.media.port="0")}),this.updateBundleMids()}mute(M){const O=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===M);if(!O)throw new Error("mediaDescription not found with ".concat(M," in remote SDP when calling RemoteSDP.mute."));O.attributes.direction="inactive"}unmute(M){const O=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===M);if(!O)throw new Error("mediaDescription not found with ".concat(M," in remote SDP when calling RemoteSDP.unmute."));O.attributes.direction="sendonly"}muteRemote(M){const O=this.sessionDesc.mediaDescriptions.filter(D=>ye(M).call(M,D.attributes.mid||""));if(O.length!==M.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");O.forEach(D=>{D.attributes.direction="inactive"})}unmuteRemote(M){const O=this.sessionDesc.mediaDescriptions.filter(D=>ye(M).call(M,D.attributes.mid||""));if(O.length!==M.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");O.forEach(D=>{D.attributes.direction="recvonly"})}receive(M,O,D,x){M.forEach((F,j)=>{this.createOrRecycleRecvMedia(F,[],"recvonly",O,D,x[j])}),this.updateBundleMids()}stopReceiving(M){const O=this.sessionDesc.mediaDescriptions.filter(D=>-1!==M.indexOf(D.attributes.mid));if(O.length!==M.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");O.forEach(D=>{D.media.port="0",D.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(M){const O=this._candidates.filter(D=>"udp"===D.transport);if(M===Mi.TCP){if(0===O.length)return;if(V("TCP_CANDIDATE_ONLY")){const D=this._candidates.filter(x=>"tcp"===x.transport);O.forEach(x=>{-1===D.findIndex(F=>F.connectionAddress===x.connectionAddress)&&D.push(el(el({},x),{},{foundation:"tcpcandidate",priority:Number(x.priority)-1+"",transport:"tcp",port:Number(x.port)+90+""}))}),this._candidates=D}else{const D=[];O.forEach(x=>{D.push(el(el({},x),{},{foundation:"tcpcandidate",priority:Number(x.priority)-1+"",transport:"tcp",port:Number(x.port)+90+""}))}),this._candidates=[...O,...D]}}else if(M===Mi.RELAY){if(0!==O.length)return;{const D=this._candidates.filter(x=>"tcp"===x.transport);D.forEach(x=>{O.push(el(el({},x),{},{foundation:"udpcandidate",priority:Number(x.priority)+1+"",transport:"udp",port:Number(x.port)-90+""}))}),this._candidates=[...O,...D]}}else 0===O.length?(this._candidates.filter(D=>"tcp"===D.transport).forEach(D=>{O.push(el(el({},D),{},{foundation:"udpcandidate",priority:Number(D.priority)+1+"",transport:"udp",port:Number(D.port)-90+""}))}),this._candidates=O):this._candidates=this._candidates.filter(D=>"tcp"!==D.transport);for(const D of this.sessionDesc.mediaDescriptions)D.attributes.candidates=this.candidates}restartICE(M){M=Ft(M),this._iceParameters=M,this.sessionDesc.mediaDescriptions.forEach(O=>{O.attributes.iceUfrag=M.iceUfrag,O.attributes.icePwd=M.icePwd})}predictReceivingMids(M){const O=[];for(let D=0;D<M;D++)O.push((this.currentMidIndex+D+1).toString(10));return O}findAvailableMediaIndex(M,O){return this.sessionDesc.mediaDescriptions.findIndex(D=>{const x=D.media.mediaType===M&&"0"!==D.media.port&&("sendonly"===D.attributes.direction||"sendrecv"===D.attributes.direction)&&0===D.attributes.ssrcs.length;if(Pt()){if(x){const F=this.firefoxSsrcMidMap.get(O[0].ssrcId);return!(F||"0"!==D.attributes.mid&&"1"!==D.attributes.mid)||!(!F||F!==D.attributes.mid)}return!1}return x})}createOrRecycleDataChannel(){for(const D of this.sessionDesc.mediaDescriptions)if("application"===D.media.mediaType)return{mediaDesc:D,needExchangeSDP:!1};this.currentMidIndex+=1;const M="".concat(this.currentMidIndex),O={media:{mediaType:"application",port:"9",protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(M),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(O),{mediaDesc:O,needExchangeSDP:!0}}createOrRecycleRecvMedia(M,O,D,x,F,j){const q=M._mediaStreamTrack.kind,te=this.rtpCapabilities.recv,K=wu(q,te,this.localCapabilities.send,q===Ce.VIDEO?x:F),Q=q===Ce.VIDEO?te.videoExtensions:te.audioExtensions;this.currentMidIndex+=1;const $="".concat(this.currentMidIndex);let z={media:{mediaType:q,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:K.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Q,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:O,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:K,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:D,rtcpMux:!0,rtcpRsize:!0,mid:"".concat($)}};z=this.mungRecvMediaDsec(z,M,j);const _e=this.findFirstClosedMedia(q);if(_e){const me=this.sessionDesc.mediaDescriptions.indexOf(_e);this.sessionDesc.mediaDescriptions[me]=z}else this.sessionDesc.mediaDescriptions.push(z);return z}updateRemoteCodec(M,O,D){const x=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(z=>z.rtpMap&&z.rtpMap.encodingName.toLowerCase()||"").filter(z=>{var _e;return ye(_e=Object.keys(Mc)).call(_e,z)}))],F=new Set(O);if(x.every(z=>F.has(z)))return I.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(O)),!1;const j=this._rtpCapabilities.recv.videoCodecs.filter(z=>O.some(_e=>{var me;return ye(me=z.rtpMap&&z.rtpMap.encodingName.toLowerCase()||"").call(me,_e)}));if(0===j.length)return I.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(x," codecs: ").concat(O)),!1;const q=[...new Set(j.map(z=>z.rtpMap&&z.rtpMap.encodingName.toLowerCase()||""))];let te;if(I.debug("updateRemoteCodec, from ".concat(x," to ").concat(q)),0===M.length)te=this.sessionDesc.mediaDescriptions.filter(z=>"video"===z.media.mediaType&&"recvonly"===z.attributes.direction);else if(te=this.sessionDesc.mediaDescriptions.filter(z=>z.attributes.mid&&ye(M).call(M,z.attributes.mid)&&"recvonly"===z.attributes.direction),te.length!==M.length)return I.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(M,", codecs: ").concat(O)),!1;this._rtpCapabilities.recv.videoCodecs=j;const $=wu(Ce.VIDEO,this.rtpCapabilities.recv,this.localCapabilities.send,D);return te.forEach(z=>{const _e=$.map(me=>me.payloadType.toString(10));I.debug("updateRemoteCodec mid: ".concat(z.attributes.mid,", from ").concat(z.attributes.payloads," to ").concat($)),z.attributes.payloads=$,z.media.fmts=_e}),!0}createOrRecycleSendMedia(M,O,D,x,F){const j=this.rtpCapabilities.send,q=M===Ce.VIDEO?j.videoCodecs:j.audioCodecs,te=M===Ce.VIDEO?j.videoExtensions:j.audioExtensions;this.currentMidIndex+=1;const K="".concat(this.currentMidIndex);let Q={media:{mediaType:M,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:q.map(z=>z.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:te,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:O,ssrcGroups:D,rtcpFeedbackWildcards:[],payloads:q,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:x,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(K)}};Q=this.mungSendMediaDesc(Q,F);const $=this.findFirstClosedMedia(M);if($){const z=this.sessionDesc.mediaDescriptions.indexOf($);this.sessionDesc.mediaDescriptions[z]=Q}else this.sessionDesc.mediaDescriptions.push(Q);return Q}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(M=>"0"!==M.media.port).map(M=>M.attributes.mid)}mungRecvMediaDsec(M,O,D){const x=Ft(M);return eb(x),Xd(x,O),og(x,O),O0(x),Iu(x,D,this.localCapabilities.send),x}mungSendMediaDesc(M,O){const D=Ft(M);return Iu(D,O,this.localCapabilities.recv),_a(D),D}updateRecvMedia(M,O){const D=this.sessionDesc.mediaDescriptions.findIndex(x=>x.attributes.mid===M);if(-1!==D){const x=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[D],O);this.sessionDesc.mediaDescriptions[D]=x}}bumpMid(M){this.currentMidIndex+=M}findFirstClosedMedia(M){return this.sessionDesc.mediaDescriptions.find(O=>Pt()?"0"===O.media.port&&O.media.mediaType===M:"0"===O.media.port)}findPreloadMediaDesc(M){return this.sessionDesc.mediaDescriptions.find(O=>{var D;return(null===(D=O.attributes)||void 0===D||null===(D=D.ssrcs[0])||void 0===D?void 0:D.ssrcId)===M[0].ssrcId})}getSSRC(M){var O;return null===(O=this.sessionDesc.mediaDescriptions.find(D=>D.attributes.mid===M))||void 0===O?void 0:O.attributes.ssrcs}}({remoteIceParameters:i,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:d,remoteSetup:l,localCapabilities:p.localCapabilities,cname:h}),Array.isArray(p.remoteCodecs)&&p.remoteCodecs.length>0&&p.remoteSDP.updateRemoteCodec([],p.remoteCodecs,p.store.codec);const m=p.remoteSDP.toString(),_=Jt.parse(p.initialOffer.sdp),v=_.mediaDescriptions.find(M=>"audio"===M.media.mediaType);v&&_a(v),p.useXR&&sg(_);const b=Jt.print(_),y=p.logSDPExchange(b||"","offer","local","connect");p.store.descriptionStart(),yield p.peerConnection.setLocalDescription({type:"offer",sdp:b}),y?.(m),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m});const T=p.peerConnection.getTransceivers()[0];if(null!=T&&T.receiver&&p.tryBindTransportEvents(T.receiver),V("PRELOAD_MEDIA_COUNT")>0){p.remoteSDP.preloadRemoteMedia();const M=p.remoteSDP.toString();yield p.peerConnection.setRemoteDescription({type:"offer",sdp:M});const O=yield p.peerConnection.createAnswer();yield p.peerConnection.setLocalDescription(O)}}catch(m){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}})()}send(i,r,a){var d=this;return Xr(function*(){const l=yield Be(d.mutex.lock("From P2PConnection.send"));try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[];i.forEach(O=>{const D=d.peerConnection.addTransceiver(O._mediaStreamTrack,{direction:"sendonly"});h.push(D),O._updateRtpTransceiver(D)}),Pt()&&!0===V("SIMULCAST")&&(yield Be(d.applySimulcastForFirefox(h,i)));const p=yield Be(d.peerConnection.createOffer()),m=d.remoteSDP.predictReceivingMids(i.length),_=d.mungSendOfferSDP(p.sdp,i,m),v=Jt.parse(_),b=m.map(O=>{const D=v.mediaDescriptions.find(x=>x.attributes.mid===O);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return Zv(D,V("USE_PUB_RTX"))});let y;try{y=yield b}catch(O){y=[],d.remoteSDP.receive(i,r,a,y);const D=d.remoteSDP.toString();throw yield Be(d.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Be(d.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield Be(d.stopSending(m,!0)),O}d.remoteSDP.receive(i,r,a,y);const T=d.remoteSDP.toString(),M=d.logSDPExchange(_,"offer","local","send");return yield Be(d.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Be(d.applySimulcastEncodings(h,i)),yield Be(d.applySendEncodings(h,i)),M?.(T),yield Be(d.peerConnection.setRemoteDescription({type:"answer",sdp:T})),h.map((O,D)=>({localSSRC:b[D],id:m[D],transceiver:O}))}catch(h){throw h instanceof ee?h:new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{l()}})()}createDataChannels(i,r){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let d=a.dataStreamChannelMap.get(i);d&&"open"===d.readyState?I.debug("[P2PConnection] Channels are already available and can be reused directly."):(d=a.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:V("DATASTREAM_MAX_RETRANSMITS")}),d.binaryType="arraybuffer",a.dataStreamChannelMap.set(i,d)),r.forEach(h=>{h._updateOriginDataChannel(d)});const{needExchangeSDP:l}=a.remoteSDP.sendDataChannel();if(l){const h=a.remoteSDP.toString();yield a.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=yield a.peerConnection.createAnswer();yield a.peerConnection.setLocalDescription(p),I.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else I.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(d){throw d instanceof ee?d:new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(d.toString()))}})()}stopDataChannels(i){var r=this;return L(function*(){try{const a=r.dataStreamChannelMap.get(i);return a?.close(),void r.dataStreamChannelMap.delete(i)}catch(a){throw a instanceof ee?a:new ee(k.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(a.toString()))}})()}stopSending(i,r){var a=this;return L(function*(){const d=r?void 0:yield a.mutex.lock("From P2PConnection.stopSending");try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const l=a.peerConnection.getTransceivers().filter(_=>-1!==i.indexOf(_.mid));if(l.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");l.map(_=>{var v;_.direction="inactive",null===(v=_.stop)||void 0===v||v.call(_)});const h=yield a.peerConnection.createOffer(),p=a.logSDPExchange(h.sdp||"","offer","local","stopSending");yield a.peerConnection.setLocalDescription(h),a.remoteSDP.stopReceiving(i);const m=a.remoteSDP.toString();p?.(m),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(l){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(l.toString()))}finally{d&&d()}})()}receive(i,r,a,d){var l=this;return L(function*(){try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=l.remoteSDP.send(i,r,a,d);if(p){const _=l.remoteSDP.toString(),v=l.logSDPExchange(_,"offer","remote","receive");yield l.peerConnection.setRemoteDescription({type:"offer",sdp:_});const b=yield l.peerConnection.createAnswer(),y=l.mungReceiveAnswerSDP(b.sdp,h,i);v?.(y||""),yield l.peerConnection.setLocalDescription({type:"answer",sdp:y}),I.debug("[".concat(l.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."))}else I.debug("[".concat(l.store.clientId,"] [P2PConnection] receive ").concat(i," no need to exchange SDP."));const m=l.peerConnection.getTransceivers().find(_=>_.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h,transceiver:m}}catch(h){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:a,needExchangeSDP:d}=r.remoteSDP.batchSend(i);if(d){const l=r.remoteSDP.toString(),h=r.logSDPExchange(l,"offer","remote","receive");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:l});const p=yield r.peerConnection.createAnswer();h?.(p.sdp||""),yield r.peerConnection.setLocalDescription(p),I.debug("[".concat(r.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else I.debug("[".concat(r.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return a.map(l=>{const h=r.peerConnection.getTransceivers().find(p=>p.mid===l);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:l,transceiver:h}})}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}})()}stopReceiving(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(i);const a=r.remoteSDP.toString(),d=r.logSDPExchange(a,"offer","remote","stopReceiving");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=yield r.peerConnection.createAnswer();d?.(l.sdp||""),yield r.peerConnection.setLocalDescription(l)}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(i," before remote SDP created."));r.remoteSDP.mute(i);const a=r.remoteSDP.toString(),d=r.logSDPExchange(a,"offer","remote","muteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=yield r.peerConnection.createAnswer();d?.(l.sdp||""),yield r.peerConnection.setLocalDescription(l)}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(a.toString()))}})()}unmuteRemote(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(i," before remote SDP created."));r.remoteSDP.unmute(i);const a=r.remoteSDP.toString(),d=r.logSDPExchange(a,"offer","remote","unmuteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=yield r.peerConnection.createAnswer();d?.(l.sdp||""),yield r.peerConnection.setLocalDescription(l)}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(a.toString()))}})()}muteLocal(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==i.indexOf(p.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(p=>{p.direction="inactive"});const d=yield r.peerConnection.createOffer(),l=r.logSDPExchange(d.sdp||"","offer","local","muteLocal");yield r.peerConnection.setLocalDescription(d),r.remoteSDP.muteRemote(i);const h=r.remoteSDP.toString();l?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==i.indexOf(p.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(function(){var p=L(function*(m,_){m.direction="sendonly"});return function(m,_){return p.apply(this,arguments)}}());const d=yield r.peerConnection.createOffer(),l=r.logSDPExchange(d.sdp||"","offer","local","unmuteLocal");yield r.peerConnection.setLocalDescription(d),r.remoteSDP.unmuteRemote(i);const h=r.remoteSDP.toString();l?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new ee(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(i){var r=this;return Xr(function*(){const a=yield Be(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ot().supportPCSetConfiguration){const _=r.peerConnection.getConfiguration(),v=i===Mi.RELAY?"relay":"all";_.iceTransportPolicy!==v&&(I.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(v,"]")),_.iceTransportPolicy=v,r.peerConnection.setConfiguration(_))}else if(i===Mi.RELAY)return;r.remoteSDP.updateCandidates(i);const d=yield Be(r.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=Ks(d.sdp),{remoteIceParameters:h}=yield l.iceParameters;r.remoteSDP.restartICE(h);const p=r.remoteSDP.toString(),m=r.logSDPExchange(d.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield Be(r.peerConnection.setLocalDescription(d)),m?.(p),yield Be(r.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(d){I.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),d)}finally{a()}})()}close(){var i;this.peerConnection.close(),null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,r){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const d=yield a.peerConnection.createOffer(),l=a.mungSendOfferSDP(d.sdp,[r],[i]);a.remoteSDP.updateRecvMedia(i,r);const h=a.remoteSDP.toString(),p=a.logSDPExchange(l,"offer","local","updateEncoderConfig");yield a.peerConnection.setLocalDescription({type:"offer",sdp:l}),p?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(d){throw new ee(k.EXCHANGE_SDP_FAILED,d.toString())}})()}updateSendParameters(i,r){var a=this;return L(function*(){const d=a.peerConnection.getTransceivers().filter(l=>l.mid===i);1===d.length&&(a.isVP8Simulcast(r)?Pt()||(yield a.applySimulcastEncodings(d,[r])):yield a.applySendEncodings(d,[r]))})()}setStatsRemoteVideoIsReady(i,r){this.statsFilter.setVideoIsReady2(i,r)}replaceTrack(i,r){var a=this;return L(function*(){const d=a.peerConnection.getTransceivers().find(l=>l.mid===r);d&&(yield d.sender.replaceTrack(i._mediaStreamTrack))})()}getSelectedCandidatePair(){var i=this;return L(function*(){const r=i.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const a=r[0].transport.iceTransport,{local:d,remote:l}=a.getSelectedCandidatePair();return{local:Du(Du({},Ya),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port}),remote:Du(Du({},Ya),{},{candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port})}}return i.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;null===(i=this.onICEConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},V("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const r={iceServers:[]};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(oa(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...Qt.turnServerConfigToIceServers(i.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...Qt.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),V("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),V("ENABLE_ENCODED_TRANSFORM")&&Ot().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Vd(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!V("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}tryBindTransportEvents(i){const r=i.transport;if(r){this.transportEventReceiver=i,r.onstatechange=()=>{var d;null!=r&&r.state&&(null===(d=this.onDTLSTransportStateChange)||void 0===d||d.call(this,r.state))},r.onerror=d=>{var l;null===(l=this.onDTLSTransportError)||void 0===l||l.call(this,"error"in d?d.error:d)};const a=r.iceTransport;a&&(a.onstatechange=()=>{const d=r?.iceTransport.state;var l;d&&(null===(l=this.onICETransportStateChange)||void 0===l||l.call(this,d))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:d,remote:l}=a.getSelectedCandidatePair();I.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol}),", remote ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(i,r){var a=this;return L(function*(){var d;if(r||(r=a.peerConnection.getSenders().find(b=>b.track===i._mediaStreamTrack)),!r)return I.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(a.isVP8Simulcast(i))return I.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ot().supportSetRtpSenderParameters)return I.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const l={},h={};switch(i._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;default:l.degradationPreference="balanced"}if(i._encoderConfig){var p;const{bitrateMax:b,frameRate:y,scaleResolutionDownBy:T}=i._encoderConfig;b&&(h.maxBitrate=1e3*b),(ye(p=i._hints).call(p,kt.LOW_STREAM)||i.isUseScaleResolutionDownBy)&&(y&&(h.maxFramerate=Po(y)),T&&T>=1&&(h.scaleResolutionDownBy=T))}if(V("DSCP_TYPE")&&wd()){var m;const b=V("DSCP_TYPE");ye(m=["very-low","low","medium","high"]).call(m,b)&&(h.networkPriority=b)}const _=r.getParameters(),v=null===(d=_.encodings)||void 0===d?void 0:d[0];Pt()&&!v&&(l.encodings=[h]),v&&Object.assign(v,h),Object.assign(_,l),I.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),yield r.setParameters(_)})()}applySendEncodings(i,r){var a=this;return L(function*(){try{if(!Ot().supportSetRtpSenderParameters||i.length!==r.length)return;for(let d=0;d<i.length;d++){const l=i[d],h=r[d];h instanceof je&&!a.isVP8Simulcast(h)&&(yield a.updateRtpSenderEncodings(h,l.sender))}}catch{I.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(i,r,a){const d=Jt.parse(i);return r.forEach((l,h)=>{const p=a[h],m=d.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(Xd(m,l),Np(m,l,this.store.codec))}),Jt.print(d)}mungReceiveAnswerSDP(i,r,a){const d=Jt.parse(i),l=d.mediaDescriptions.find(h=>h.attributes.mid===r);return l&&(a===Ce.AUDIO&&"audio"===l.media.mediaType&&_a(l),this.useXR&&sg(d)),Jt.print(d)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,r,a)=>{var d;null===(d=this.onFirstVideoDecoded)||void 0===d||d.call(this,i,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(i,r){var a=this;return L(function*(){if(i.length===r.length)for(let _=0;_<i.length;_++){var d,l,h,p,m;const v=i[_],b=r[_];if(b instanceof je&&!ye(d=b._hints).call(d,kt.LOW_STREAM)&&null!==(l=b._encoderConfig)&&void 0!==l&&l.bitrateMax&&(null===(h=b._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=b._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=b._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===a.store.codec){const y={},T={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};y.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const M=v.sender.getParameters();yield v.sender.setParameters(Object.assign(M,y))}}})()}applySimulcastEncodings(i,r){var a=this;return L(function*(){if(!Pt()&&i.length===r.length)for(let d=0;d<i.length;d++){const l=r[d];if(l instanceof je&&a.isVP8Simulcast(l)){const h=i[d],p={},m={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=h.sender.getParameters();yield h.sender.setParameters(Object.assign(_,p))}}})()}isVP8Simulcast(i){var r,a,d,l,h;return!!(i instanceof je&&V("SIMULCAST")&&"vp8"===this.store.codec&&!ye(r=i._hints).call(r,kt.LOW_STREAM)&&null!==(a=i._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(d=i._encoderConfig)||void 0===d?void 0:d.bitrateMax)>200&&null!==(l=i._scalabilityMode)&&void 0!==l&&l.numSpatialLayers&&(null===(h=i._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(i,r,a,d){if(V("SDP_LOGGING"))return I.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(r," SDP during P2PConnection.").concat(d,"\n"),i),"offer"===r?l=>{this.logSDPExchange(l,"answer","local"===a?"remote":"local",d)}:void 0}getRemoteSSRC(i){var r=this;return L(function*(){if(!r.remoteSDP)return;const a=r.remoteSDP.getSSRC(i);return a?.[0].ssrcId})()}setConfiguration(i){if(Ot().supportPCSetConfiguration){const r=Qt.resolvePCConfiguration(i);this.peerConnection.setConfiguration(r)}}}function dr(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=L(function*(){const d=this.mutex,l=yield d.lock("From P2PConnection.".concat(i));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{l()}}),r}function vP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function bP(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?vP(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):vP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}ne([dr,N("design:type",Function),N("design:paramtypes",[Array,Array]),N("design:returntype",X)],Qt.prototype,"updateRemoteRTPCapabilities",null),ne([dr,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",X)],Qt.prototype,"connect",null),ne([dr,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",X)],Qt.prototype,"createDataChannels",null),ne([dr,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",X)],Qt.prototype,"receive",null),ne([dr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Qt.prototype,"batchReceive",null),ne([dr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Qt.prototype,"stopReceiving",null),ne([dr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],Qt.prototype,"muteRemote",null),ne([dr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],Qt.prototype,"unmuteRemote",null),ne([dr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Qt.prototype,"muteLocal",null),ne([dr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Qt.prototype,"unmuteLocal",null),ne([dr,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Qt.prototype,"close",null),ne([dr,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],Qt.prototype,"updateEncoderConfig",null),ne([dr,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],Qt.prototype,"updateSendParameters",null),ne([dr,N("design:type",Function),N("design:paramtypes",[Bi,String]),N("design:returntype",X)],Qt.prototype,"replaceTrack",null),ne([dr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],Qt.prototype,"getRemoteSSRC",null);const ab="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\na=ice-lite\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 127.0.0.1\na=mid:0\n";class SF{get localCapabilities(){return Ft(this._localCapabilities)}get rtpCapabilities(){return Ft(this._rtpCapabilities)}get candidates(){return Ft(this._candidates)}get iceParameters(){return Ft(this._iceParameters)}get dtlsParameters(){return Ft(this._dtlsParameters)}constructor(i){S(this,"sessionDesc",void 0),S(this,"_localCapabilities",void 0),S(this,"_rtpCapabilities",void 0),S(this,"_candidates",void 0),S(this,"_iceParameters",void 0),S(this,"_dtlsParameters",void 0),S(this,"setup",void 0),S(this,"currentMidIndex",void 0),S(this,"cname",void 0),S(this,"firefoxSsrcMidMap",new Map),i=Ft(i);const{remoteIceParameters:r,remoteDtlsParameters:a,candidates:d,remoteRTPCapabilities:l,remoteSetup:h,localCapabilities:p,cname:m}=i,_=Jt.parse(ab);this._rtpCapabilities=l,this._candidates=d,this._iceParameters=r,this._dtlsParameters=a,this._localCapabilities=p,this.setup=h,this.cname=m;const v=this.rtpCapabilities.send;for(const b of _.mediaDescriptions){if(b.attributes.iceUfrag=r.iceUfrag,b.attributes.icePwd=r.icePwd,b.attributes.fingerprints=a.fingerprints,b.attributes.candidates=d,b.attributes.setup=h,"application"===b.media.mediaType&&(b.attributes.sctpPort="5000"),"video"===b.media.mediaType&&(b.media.fmts=v.videoCodecs.map(y=>y.payloadType.toString(10)),b.attributes.payloads=v.videoCodecs,b.attributes.extmaps=v.videoExtensions,V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:y,ssrcGroups:T}=Hi([{ssrcId:4e4,rtx:V("USE_SUB_RTX")?40001:void 0}],this.cname);b.attributes.ssrcs=y,b.attributes.ssrcGroups=T}if("audio"===b.media.mediaType&&(b.media.fmts=v.audioCodecs.map(y=>y.payloadType.toString(10)),b.attributes.payloads=v.audioCodecs,b.attributes.extmaps=v.audioExtensions,_a(b),V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:y,ssrcGroups:T}=Hi([{ssrcId:2e4}],this.cname);b.attributes.ssrcs=y,b.attributes.ssrcGroups=T}}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}updateRemoteRTPCapabilities(i){const r=Jt.parse(ab);this._rtpCapabilities=i;const a=this.rtpCapabilities.send;for(const d of r.mediaDescriptions){if(d.attributes.iceUfrag=this._iceParameters.iceUfrag,d.attributes.icePwd=this._iceParameters.icePwd,d.attributes.fingerprints=this._dtlsParameters.fingerprints,d.attributes.candidates=this._candidates,d.attributes.setup=this.setup,"application"===d.media.mediaType&&(d.attributes.sctpPort="5000"),"video"===d.media.mediaType&&(d.media.fmts=a.videoCodecs.map(l=>l.payloadType.toString(10)),d.attributes.payloads=a.videoCodecs,d.attributes.extmaps=a.videoExtensions,V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:l,ssrcGroups:h}=Hi([{ssrcId:4e4,rtx:V("USE_SUB_RTX")?40001:void 0}],this.cname);d.attributes.ssrcs=l,d.attributes.ssrcGroups=h}if("audio"===d.media.mediaType&&(d.media.fmts=a.audioCodecs.map(l=>l.payloadType.toString(10)),d.attributes.payloads=a.audioCodecs,d.attributes.extmaps=a.audioExtensions,V("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:l,ssrcGroups:h}=Hi([{ssrcId:2e4}],this.cname);d.attributes.ssrcs=l,d.attributes.ssrcGroups=h}}this.sessionDesc=r,this.currentMidIndex=r.mediaDescriptions.length-1}preloadRemoteMedia(i){const r=this.candidates,a=this.dtlsParameters,d=this.iceParameters,l=this.rtpCapabilities.send;for(let h=1;h<i;h++){const p=2*h+2e4,m=2*h+4e4,{ssrcs:_,ssrcGroups:v}=Hi([{ssrcId:p}],this.cname),{ssrcs:b,ssrcGroups:y}=Hi([{ssrcId:m,rtx:V("USE_SUB_RTX")?m+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.videoCodecs.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:d.iceUfrag,icePwd:d.icePwd,unrecognized:[],candidates:r,extmaps:l.videoExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:b,ssrcGroups:y,rtcpFeedbackWildcards:[],payloads:l.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.audioCodecs.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:d.iceUfrag,icePwd:d.icePwd,unrecognized:[],candidates:r,extmaps:l.audioExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:v,rtcpFeedbackWildcards:[],payloads:l.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Jt.print(this.sessionDesc)}send(i,r,a,d){const{ssrcs:l,ssrcGroups:h}=Hi(r,this.cname,V("SYNC_GROUP")?a:void 0),p=this.findPreloadMediaDesc(l);if(p){if(Pt()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,p.attributes.mid),d&&(d.twcc||d.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(p,d),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(i,l);let _;return-1===m||fr()||Pi()||yL()||0===m&&V("USE_SUB_RTX")?(_=this.createOrRecycleSendMedia(i,l,h,"sendonly",d),this.updateBundleMids()):(_=Ft(this.sessionDesc.mediaDescriptions[m]),_.attributes.direction="sendonly",_.attributes.ssrcs=l,_.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(_,d)),Pt()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,_.attributes.mid),{mid:_.attributes.mid,needExchangeSDP:!0}}}batchSend(i){const r=i.map(l=>{let{kind:h,ssrcMsg:p,mslabel:m}=l;return this.send(h,p,m)}),a=[];let d=!1;return r.forEach(l=>{let{mid:h,needExchangeSDP:p}=l;p&&(d=!0),a.push(h)}),{mids:a,needExchangeSDP:d}}stopSending(i){const r=this.sessionDesc.mediaDescriptions.filter(a=>a.attributes.mid&&-1!==i.indexOf(a.attributes.mid));if(r.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(a=>{"0"===a.attributes.mid||Pt()||fr()||Pi()?a.attributes.ssrcs=[]:(a.attributes.ssrcs=[],a.attributes.direction="inactive",a.media.port="0")}),this.updateBundleMids()}mute(i){const r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i);if(!r)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(i){const r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i);if(!r)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}muteRemote(i){const r=this.sessionDesc.mediaDescriptions.filter(a=>ye(i).call(i,a.attributes.mid||""));if(r.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(a=>{a.attributes.direction="inactive"})}unmuteRemote(i){const r=this.sessionDesc.mediaDescriptions.filter(a=>ye(i).call(i,a.attributes.mid||""));if(r.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(a=>{a.attributes.direction="recvonly"})}receive(i,r,a,d){i.forEach((l,h)=>{this.createOrRecycleRecvMedia(l,[],"recvonly",r,a,d[h])}),this.updateBundleMids()}stopReceiving(i){const r=this.sessionDesc.mediaDescriptions.filter(a=>-1!==i.indexOf(a.attributes.mid));if(r.length!==i.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(a=>{a.media.port="0",a.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(i){i===Mi.TCP?this._candidates.forEach(r=>{-1===this._candidates.findIndex(a=>"tcp"===a.transport&&a.connectionAddress===r.connectionAddress&&a.port===r.port)&&this._candidates.push(bP(bP({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}):this._candidates=this._candidates.filter(r=>"tcp"!==r.transport);for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}restartICE(i){i=Ft(i),this._iceParameters=i,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=i.iceUfrag,r.attributes.icePwd=i.icePwd})}predictReceivingMids(i){const r=[];for(let a=0;a<i;a++)r.push((this.currentMidIndex+a+1).toString(10));return r}findAvailableMediaIndex(i,r){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const d=a.media.mediaType===i&&"0"!==a.media.port&&("sendonly"===a.attributes.direction||"sendrecv"===a.attributes.direction)&&0===a.attributes.ssrcs.length;if(Pt()){if(d){const l=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(l||"0"!==a.attributes.mid&&"1"!==a.attributes.mid)||!(!l||l!==a.attributes.mid)}return!1}return d})}createOrRecycleRecvMedia(i,r,a,d,l,h){const p=i._mediaStreamTrack.kind,m=this.rtpCapabilities.recv,_=wu(p,m,this.localCapabilities.send,p===Ce.VIDEO?d:l),v=p===Ce.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;const b="".concat(this.currentMidIndex);let y={media:{mediaType:p,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:_.map(M=>M.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:v,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:_,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(b)}};y=this.mungRecvMediaDsec(y,i,h);const T=this.findFirstClosedMedia(p);if(T){const M=this.sessionDesc.mediaDescriptions.indexOf(T);this.sessionDesc.mediaDescriptions[M]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}updateRemoteCodec(i,r,a){const d=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(y=>y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||"").filter(y=>{var T;return ye(T=Object.keys(Mc)).call(T,y)}))],l=new Set(r);if(d.every(y=>l.has(y)))return I.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(r)),!1;const h=this._rtpCapabilities.recv.videoCodecs.filter(y=>r.some(T=>{var M;return ye(M=y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||"").call(M,T)}));if(0===h.length)return I.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(d," codecs: ").concat(r)),!1;const p=[...new Set(h.map(y=>y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||""))];let m;if(I.debug("updateRemoteCodec, from ".concat(d," to ").concat(p)),0===i.length)m=this.sessionDesc.mediaDescriptions.filter(y=>"video"===y.media.mediaType&&"recvonly"===y.attributes.direction);else if(m=this.sessionDesc.mediaDescriptions.filter(y=>y.attributes.mid&&ye(i).call(i,y.attributes.mid)&&"recvonly"===y.attributes.direction),m.length!==i.length)return I.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(i,", codecs: ").concat(r)),!1;this._rtpCapabilities.recv.videoCodecs=h;const b=wu(Ce.VIDEO,this.rtpCapabilities.recv,this.localCapabilities.send,a);return m.forEach(y=>{const T=b.map(M=>M.payloadType.toString(10));I.debug("updateRemoteCodec mid: ".concat(y.attributes.mid,", from ").concat(y.attributes.payloads," to ").concat(b)),y.attributes.payloads=b,y.media.fmts=T}),!0}createOrRecycleSendMedia(i,r,a,d,l){const h=this.rtpCapabilities.send,p=i===Ce.VIDEO?h.videoCodecs:h.audioCodecs,m=i===Ce.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const _="".concat(this.currentMidIndex);let v={media:{mediaType:i,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:a,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:d,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};v=this.mungSendMediaDesc(v,l);const b=this.findFirstClosedMedia(i);if(b){const y=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[y]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(i=>"0"!==i.media.port).map(i=>i.attributes.mid)}mungRecvMediaDsec(i,r,a){const d=Ft(i);return eb(d),Xd(d,r),og(d,r),O0(d),Iu(d,a,this.localCapabilities.send),d}mungSendMediaDesc(i,r){const a=Ft(i);return Iu(a,r,this.localCapabilities.recv),_a(a),a}updateRecvMedia(i,r){const a=this.sessionDesc.mediaDescriptions.findIndex(d=>d.attributes.mid===i);if(-1!==a){const d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],r);this.sessionDesc.mediaDescriptions[a]=d}}bumpMid(i){this.currentMidIndex+=i}findFirstClosedMedia(i){return this.sessionDesc.mediaDescriptions.find(r=>Pt()?"0"===r.media.port&&r.media.mediaType===i:"0"===r.media.port)}findPreloadMediaDesc(i){return this.sessionDesc.mediaDescriptions.find(r=>{var a;return(null===(a=r.attributes)||void 0===a||null===(a=a.ssrcs[0])||void 0===a?void 0:a.ssrcId)===i[0].ssrcId})}getSSRC(i){var r;return null===(r=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===i))||void 0===r?void 0:r.attributes.ssrcs}}function yP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function cb(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?yP(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):yP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}class wi extends hv{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){let i;return this.localCapabilities&&(i=oi(this.localCapabilities)),[...new Set(i&&i.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var a;return ye(a=Object.keys(Mc)).call(a,r)}))]}constructor(i,r,a){super(i,r),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"remoteSDP",void 0),S(this,"initialOffer",void 0),S(this,"transportEventReceiver",void 0),S(this,"statsFilter",void 0),S(this,"useXR",V("USE_XR")),S(this,"localCapabilities",void 0),S(this,"localCandidateCount",0),S(this,"allCandidatesReceived",!1),S(this,"remoteCodecs",void 0),S(this,"dataStreamChannelMap",new Map),S(this,"establishPromise",void 0),S(this,"mutex",new Ei("NVExtentionsConnection-mutex")),S(this,"rtcMedia",void 0),this.store=r,this.peerConnection=a,this.statsFilter=Op(this.peerConnection,V("STATS_UPDATE_INTERVAL"),void 0,Pt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(i){var r=this;return L(function*(){try{const a=yield r.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const d=Ks(a.sdp),l=yield Jd({filterRTX:!V("USE_PUB_RTX")&&!V("USE_SUB_RTX"),filterVideoFec:V("FILTER_VIDEO_FEC"),filterAudioFec:V("FILTER_AUDIO_FEC"),filterVideoCodec:V("FILTER_VIDEO_CODEC")},{useXR:r.useXR});return r.localCapabilities=l,r.initialOffer=a,cb(cb({},d),{},{rtpCapabilities:l,offerSDP:a.sdp})}catch(a){throw new W(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}})()}connect(i,r,a,d,l,h){var p=this;return L(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");p.remoteSDP=new SF({remoteIceParameters:i,remoteDtlsParameters:r,candidates:a,remoteRTPCapabilities:d,remoteSetup:l,localCapabilities:oi(p.localCapabilities),cname:h});const m=p.remoteSDP.toString(),_=Jt.parse(p.initialOffer.sdp),v=_.mediaDescriptions.find(T=>"audio"===T.media.mediaType);v&&_a(v),p.useXR&&sg(_);const b=Jt.print(_),y=p.logSDPExchange(b||"","offer","local","connect");yield p.peerConnection.setLocalDescription({type:"offer",sdp:b}),y?.(m),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new W(k.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(m.toString()))}})()}updateRemoteRTPCapabilities(i,r){var a=this;return L(function*(){if(a.remoteCodecs=r,a.remoteSDP)if(a.remoteSDP.updateRemoteCodec(i,r,a.store.codec)){const d=yield a.peerConnection.createOffer(),l=a.logSDPExchange(d.sdp||"","offer","local","muteLocal");yield a.peerConnection.setLocalDescription(d);const h=a.remoteSDP.toString();l?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}else I.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else I.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(a.localCodecs,", codecs: ").concat(r))})()}updateRemoteConnect(i){var r=this;return L(function*(){var a,d,l,h;null===(a=r.remoteSDP)||void 0===a||a.updateRemoteRTPCapabilities(i),Array.isArray(r.remoteCodecs)&&r.remoteCodecs.length>0&&(null===(h=r.remoteSDP)||void 0===h||h.updateRemoteCodec([],r.remoteCodecs,r.store.codec)),null===(d=r.remoteSDP)||void 0===d||d.preloadRemoteMedia(2);const p=null===(l=r.remoteSDP)||void 0===l?void 0:l.toString();yield r.peerConnection.setRemoteDescription({type:"offer",sdp:p});const m=yield r.peerConnection.createAnswer();yield r.peerConnection.setLocalDescription(m),I.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")})()}send(i,r,a){var d=this;return Xr(function*(){const l=yield Be(d.mutex.lock("From NVExtentionsConnection.send"));try{if(!d.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const h=[];i.forEach(O=>{const D=d.peerConnection.addTransceiver(O._mediaStreamTrack,{direction:"sendonly"});h.push(D)}),Pt()&&!0===V("SIMULCAST")&&(yield Be(d.applySimulcastForFirefox(h,i)));const p=yield Be(d.peerConnection.createOffer()),m=d.remoteSDP.predictReceivingMids(i.length),_=d.mungSendOfferSDP(p.sdp,i,m),v=Jt.parse(_),b=m.map(O=>{const D=v.mediaDescriptions.find(x=>x.attributes.mid===O);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return Zv(D,V("USE_PUB_RTX"))});let y;try{y=yield b}catch(O){y=[],d.remoteSDP.receive(i,r,a,y);const D=d.remoteSDP.toString();throw yield Be(d.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Be(d.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield Be(d.stopSending(m,!0)),O}d.remoteSDP.receive(i,r,a,y);const T=d.remoteSDP.toString(),M=d.logSDPExchange(_,"offer","local","send");return yield Be(d.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Be(d.applySimulcastEncodings(h,i)),yield Be(d.applySendEncodings(h,i)),M?.(T),yield Be(d.peerConnection.setRemoteDescription({type:"answer",sdp:T})),h.map((O,D)=>({localSSRC:b[D],id:m[D],transceiver:O}))}catch(h){throw h instanceof W?h:new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(h.toString()))}finally{l()}})()}stopSending(i,r){var a=this;return L(function*(){const d=r?void 0:yield a.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const l=a.peerConnection.getTransceivers().filter(_=>-1!==i.indexOf(_.mid));if(l.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");l.map(_=>{var v;_.direction="inactive",null===(v=_.stop)||void 0===v||v.call(_)});const h=yield a.peerConnection.createOffer(),p=a.logSDPExchange(h.sdp||"","offer","local","stopSending");yield a.peerConnection.setLocalDescription(h),a.remoteSDP.stopReceiving(i);const m=a.remoteSDP.toString();p?.(m),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(l){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(l.toString()))}finally{d&&d()}})()}createDataChannels(i,r){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let d=a.dataStreamChannelMap.get(i);return d&&"open"===d.readyState?I.debug("[P2PConnection] Channels are already available and can be reused directly."):(d=a.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:V("DATASTREAM_MAX_RETRANSMITS")}),d.binaryType="arraybuffer",a.dataStreamChannelMap.set(i,d)),void r.forEach(l=>{l._updateOriginDataChannel(d)})}catch(d){throw d instanceof W?d:new W(k.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(d.toString()))}})()}stopDataChannels(i){var r=this;return L(function*(){try{const a=r.dataStreamChannelMap.get(i);return a?.close(),void r.dataStreamChannelMap.delete(i)}catch(a){throw a instanceof W?a:new W(k.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(a.toString()))}})()}receive(i,r,a,d){var l=this;return L(function*(){try{if(!l.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(i," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=l.remoteSDP.send(i,r,a,d);if(p){const _=l.remoteSDP.toString(),v=l.logSDPExchange(_,"offer","remote","receive");yield l.peerConnection.setRemoteDescription({type:"offer",sdp:_});const b=yield l.peerConnection.createAnswer(),y=l.mungReceiveAnswerSDP(b.sdp,h,i);v?.(y||""),yield l.peerConnection.setLocalDescription({type:"answer",sdp:y}),I.debug("[NVExtentionsConnection] receive ".concat(i," by exchanging SDP."))}else I.debug("[NVExtentionsConnection] receive ".concat(i," no need to exchange SDP."));const m=l.peerConnection.getTransceivers().find(_=>_.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h}}catch(h){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:a,needExchangeSDP:d}=r.remoteSDP.batchSend(i);if(d){const l=r.remoteSDP.toString(),h=r.logSDPExchange(l,"offer","remote","receive");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:l});const p=yield r.peerConnection.createAnswer();h?.(p.sdp||""),yield r.peerConnection.setLocalDescription(p),I.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else I.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return a.map(l=>{const h=r.peerConnection.getTransceivers().find(p=>p.mid===l);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:l}})}catch(a){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(a.toString()))}})()}stopReceiving(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");r.remoteSDP.stopSending(i);const a=r.remoteSDP.toString(),d=r.logSDPExchange(a,"offer","remote","stopReceiving");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=yield r.peerConnection.createAnswer();d?.(l.sdp||""),yield r.peerConnection.setLocalDescription(l)}catch(a){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(i," before remote SDP created."));r.remoteSDP.mute(i);const a=r.remoteSDP.toString(),d=r.logSDPExchange(a,"offer","remote","muteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=yield r.peerConnection.createAnswer();d?.(l.sdp||""),yield r.peerConnection.setLocalDescription(l)}catch(a){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(a.toString()))}})()}unmuteRemote(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(i," before remote SDP created."));r.remoteSDP.unmute(i);const a=r.remoteSDP.toString(),d=r.logSDPExchange(a,"offer","remote","unmuteRemote");yield r.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=yield r.peerConnection.createAnswer();d?.(l.sdp||""),yield r.peerConnection.setLocalDescription(l)}catch(a){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(a.toString()))}})()}muteLocal(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==i.indexOf(p.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(p=>{p.direction="inactive"});const d=yield r.peerConnection.createOffer(),l=r.logSDPExchange(d.sdp||"","offer","local","muteLocal");yield r.peerConnection.setLocalDescription(d),r.remoteSDP.muteRemote(i);const h=r.remoteSDP.toString();l?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(i){var r=this;return L(function*(){try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const a=r.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==i.indexOf(p.mid));if(a.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(function(){var p=L(function*(m,_){m.direction="sendonly"});return function(m,_){return p.apply(this,arguments)}}());const d=yield r.peerConnection.createOffer(),l=r.logSDPExchange(d.sdp||"","offer","local","unmuteLocal");yield r.peerConnection.setLocalDescription(d),r.remoteSDP.unmuteRemote(i);const h=r.remoteSDP.toString();l?.(h),yield r.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(i){var r=this;return Xr(function*(){const a=yield Be(r.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ot().supportPCSetConfiguration){const _=r.peerConnection.getConfiguration(),v=i===Mi.RELAY?"relay":"all";_.iceTransportPolicy!==v&&(I.debug("restartICE change iceTransportPolicy from [".concat(_.iceTransportPolicy,"] to [").concat(v,"]")),_.iceTransportPolicy=v,r.peerConnection.setConfiguration(_))}else if(i===Mi.RELAY)return;i!==Mi.RELAY&&r.remoteSDP.updateCandidates(i);const d=yield Be(r.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=Ks(d.sdp),{remoteIceParameters:h}=yield l.iceParameters;r.remoteSDP.restartICE(h);const p=r.remoteSDP.toString(),m=r.logSDPExchange(d.sdp||"","offer","local","restartICE");yield Be(r.peerConnection.setLocalDescription(d)),m?.(p),yield Be(r.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(d){I.warning("restart ICE failed, abort operation",d)}finally{a()}})()}close(){var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}updateEncoderConfig(i,r){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const d=yield a.peerConnection.createOffer(),l=a.mungSendOfferSDP(d.sdp,[r],[i]);a.remoteSDP.updateRecvMedia(i,r);const h=a.remoteSDP.toString(),p=a.logSDPExchange(l,"offer","local","updateEncoderConfig");yield a.peerConnection.setLocalDescription({type:"offer",sdp:l}),p?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(d){throw new W(k.EXCHANGE_SDP_FAILED,d.toString())}})()}updateSendParameters(i,r){var a=this;return L(function*(){const d=a.peerConnection.getTransceivers().filter(l=>l.mid===i);1===d.length&&(a.isVP8Simulcast(r)?Pt()||(yield a.applySimulcastEncodings(d,[r])):yield a.applySendEncodings(d,[r]))})()}setStatsRemoteVideoIsReady(i,r){this.statsFilter.setVideoIsReady2(i,r)}replaceTrack(i,r){var a=this;return L(function*(){const d=a.peerConnection.getTransceivers().find(l=>l.mid===r);d&&(yield d.sender.replaceTrack(i._mediaStreamTrack))})()}getP2PConnectionParams(){var i;if(null===(i=this.peerConnection.currentLocalDescription)||void 0===i||!i.sdp||!this.localCapabilities)throw new Error;return cb(cb({},Ks(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;null===(i=this.onICEConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;null===(i=this.onConnectionStateChange)||void 0===i||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},V("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const r={iceServers:[]};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(oa(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...wi.turnServerConfigToIceServers(i.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...wi.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),V("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Vd(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!V("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}applySendEncodings(i,r){var a=this;return L(function*(){try{if(!Ot().supportSetRtpSenderParameters||i.length!==r.length)return;for(let y=0;y<i.length;y++){const T=i[y],M=r[y];if(M&&M instanceof je){var d,l,h;if(a.isVP8Simulcast(M))continue;const O={},D={};switch(M._optimizationMode){case"motion":O.degradationPreference="maintain-framerate";break;case"detail":O.degradationPreference="maintain-resolution";break;default:O.degradationPreference="balanced"}var p,m,_,v;if(null!==(d=M._encoderConfig)&&void 0!==d&&d.bitrateMax&&(D.maxBitrate=1e3*(null===(p=M._encoderConfig)||void 0===p?void 0:p.bitrateMax)),ye(l=M._hints).call(l,kt.LOW_STREAM)&&(null!==(m=M._encoderConfig)&&void 0!==m&&m.frameRate&&(D.maxFramerate=Po(M._encoderConfig.frameRate)),null!==(_=M._encoderConfig)&&void 0!==_&&_.scaleResolutionDownBy&&(null===(v=M._encoderConfig)||void 0===v?void 0:v.scaleResolutionDownBy)>1&&(D.scaleResolutionDownBy=M._encoderConfig.scaleResolutionDownBy)),V("DSCP_TYPE")&&wd()){var b;const j=V("DSCP_TYPE");ye(b=["very-low","low","medium","high"]).call(b,j)&&(D.networkPriority=j)}const x=T.sender.getParameters(),F=null===(h=x.encodings)||void 0===h?void 0:h[0];Pt()&&!F&&(O.encodings=[D]),F&&Object.assign(F,D),Object.assign(x,O),yield T.sender.setParameters(x)}}}catch{I.debug("Apply RTPSendEncodings failed.")}})()}mungSendOfferSDP(i,r,a){const d=Jt.parse(i);return r.forEach((l,h)=>{const p=a[h],m=d.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(Xd(m,l),Np(m,l,this.store.codec))}),Jt.print(d)}mungReceiveAnswerSDP(i,r,a){const d=Jt.parse(i),l=d.mediaDescriptions.find(h=>h.attributes.mid===r);return l&&a===Ce.AUDIO&&"audio"===l.media.mediaType&&_a(l),this.useXR&&sg(d),Jt.print(d)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var r;null===(r=this.onFirstAudioReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var r;null===(r=this.onFirstVideoReceived)||void 0===r||r.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var r;null===(r=this.onFirstAudioDecoded)||void 0===r||r.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,r,a)=>{var d;null===(d=this.onFirstVideoDecoded)||void 0===d||d.call(this,i,r,a)},this.statsFilter.onSelectedLocalCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,r)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,i,r)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var r;null===(r=this.onFirstVideoDecodedTimeout)||void 0===r||r.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(i,r){var a=this;return L(function*(){if(i.length===r.length)for(let _=0;_<i.length;_++){var d,l,h,p,m;const v=i[_],b=r[_];if(b instanceof je&&!ye(d=b._hints).call(d,kt.LOW_STREAM)&&null!==(l=b._encoderConfig)&&void 0!==l&&l.bitrateMax&&(null===(h=b._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=b._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=b._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===a.store.codec){const y={},T={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};y.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const M=v.sender.getParameters();yield v.sender.setParameters(Object.assign(M,y))}}})()}applySimulcastEncodings(i,r){var a=this;return L(function*(){if(!Pt()&&i.length===r.length)for(let d=0;d<i.length;d++){const l=r[d];if(l instanceof je&&a.isVP8Simulcast(l)){const h=i[d],p={},m={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=h.sender.getParameters();yield h.sender.setParameters(Object.assign(_,p))}}})()}isVP8Simulcast(i){var r,a,d,l,h;return!!(i instanceof je&&V("SIMULCAST")&&"vp8"===this.store.codec&&!ye(r=i._hints).call(r,kt.LOW_STREAM)&&null!==(a=i._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(d=i._encoderConfig)||void 0===d?void 0:d.bitrateMax)>200&&null!==(l=i._scalabilityMode)&&void 0!==l&&l.numSpatialLayers&&(null===(h=i._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(i,r,a,d){if(V("SDP_LOGGING"))return I.upload("exchanging ".concat(a," ").concat(r," SDP during NVExtentionsConnection.").concat(d,"\n"),i),"offer"===r?l=>{this.logSDPExchange(l,"answer","local"===a?"remote":"local",d)}:void 0}getRemoteSSRC(i){var r=this;return L(function*(){if(!r.remoteSDP)return;const a=r.remoteSDP.getSSRC(i);return a?.[0].ssrcId})()}setConfiguration(i){if(Ot().supportPCSetConfiguration){const r=wi.resolvePCConfiguration(i);this.peerConnection.setConfiguration(r)}}}function Jr(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=L(function*(){const d=this.mutex,l=yield d.lock("From NVExtentionsConnection.".concat(i));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{l()}}),r}function CP(s){var i,r,a,d=2;for(typeof Symbol<"u"&&(r=M0,a=Symbol.iterator);d--;){if(r&&null!=(i=s[r]))return i.call(s);if(a&&null!=(i=s[a]))return new db(i.call(s));r="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function db(s){function i(r){if(Object(r)!==r)return X.reject(new TypeError(r+" is not an object."));var a=r.done;return X.resolve(r.value).then(function(d){return{value:d,done:a}})}return(db=function(r){this.s=r,this.n=r.next}).prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(r){var a=this.s.return;return void 0===a?X.resolve({value:r,done:!0}):i(a.apply(this.s,arguments))},throw:function(r){var a=this.s.return;return void 0===a?X.reject(r):i(a.apply(this.s,arguments))}},new db(s)}ne([Jr,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",X)],wi.prototype,"connect",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[Array,Array]),N("design:returntype",X)],wi.prototype,"updateRemoteRTPCapabilities",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],wi.prototype,"updateRemoteConnect",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",X)],wi.prototype,"createDataChannels",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",X)],wi.prototype,"receive",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],wi.prototype,"batchReceive",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],wi.prototype,"stopReceiving",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],wi.prototype,"muteRemote",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],wi.prototype,"unmuteRemote",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],wi.prototype,"muteLocal",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],wi.prototype,"unmuteLocal",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],wi.prototype,"close",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],wi.prototype,"updateEncoderConfig",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],wi.prototype,"updateSendParameters",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[Bi,String]),N("design:returntype",X)],wi.prototype,"replaceTrack",null),ne([Jr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],wi.prototype,"getRemoteSSRC",null);class Gn extends hv{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(i,r){super(i,r),S(this,"store",void 0),S(this,"peerConnection",void 0),S(this,"cname",void 0),S(this,"mutex",new Ei("DataChannelConnection-mutex")),S(this,"dataChannel",void 0),S(this,"_p2pConnection",void 0),S(this,"establishPromise",void 0),S(this,"_nvMedia",void 0),this.store=r,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(Gn.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new wi(i,r,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}establish(){var i=this;return L(function*(){var r;const a=null===(r=i._nvMedia)||void 0===r?void 0:r.getLocalRtpCapabilities();return yield i._p2pConnection.establish(a)})()}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}connect(i,r,a,d,l,h){var p=this;return L(function*(){return p.cname=h,yield p._p2pConnection.connect(i,r,a,d,l,h),yield new X((m,_)=>{const v=setTimeout(()=>{p.closeSignal(),_(new W(k.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(a))))},2e3);p.dataChannel.onopen=()=>{if("open"===p.dataChannel.readyState)return clearTimeout(v),void m()},p.dataChannel.onerror=b=>{p.closeSignal(),_(b)}}),{transmitter:p.dataChannel,close:p.closeSignal.bind(p)}})()}updateRemoteRTPCapabilities(i,r){var a=this;return L(function*(){return a._p2pConnection.updateRemoteRTPCapabilities(i,r)})()}send(i,r,a){var d=this;return Xr(function*(){const l=yield Be(d.mutex.lock("From DataChannelConnection.send"));try{return yield*rb(CP(d._p2pConnection.send(i,r,a)))}finally{l()}})()}stopSending(i,r){var a=this;return L(function*(){return a._p2pConnection.stopSending(i,r)})()}createDataChannels(i,r){var a=this;return L(function*(){return a._p2pConnection.createDataChannels(i,r)})()}stopDataChannels(i){var r=this;return L(function*(){return r._p2pConnection.stopDataChannels(i)})()}receive(i,r,a,d){var l=this;return L(function*(){return l._nvMedia?(I.debug("[DataChannelConnection] receive ".concat(i," by DataChannel.")),yield l._nvMedia.reveiveByRTCMedia(i,r,l.cname)):(I.debug("[DataChannelConnection] receive ".concat(i," by WebRTC.")),yield l._p2pConnection.receive(i,r,a,d))})()}batchReceive(i){var r=this;return L(function*(){return[...yield r._p2pConnection.batchReceive(i)]})()}stopReceiving(i){var r=this;return L(function*(){return yield r._p2pConnection.stopReceiving(i)})()}muteRemote(i){var r=this;return L(function*(){return yield r._p2pConnection.muteRemote(i)})()}unmuteRemote(i){var r=this;return L(function*(){return yield r._p2pConnection.unmuteRemote(i)})()}muteLocal(i){var r=this;return L(function*(){return yield r._p2pConnection.muteLocal(i)})()}unmuteLocal(i){var r=this;return L(function*(){return yield r._p2pConnection.unmuteLocal(i)})()}restartICE(i){var r=this;return Xr(function*(){return yield*rb(CP(r._p2pConnection.restartICE(i)))})()}close(){var i;null===(i=this._nvMedia)||void 0===i||i.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(i){return this._p2pConnection.getRemoteVideoIsReady(i)}updateRemoteConnect(i){var r;null===(r=this._nvMedia)||void 0===r||r.setRemoteRtpCapabilities(i),this._p2pConnection.updateRemoteConnect(i)}updateEncoderConfig(i,r){var a=this;return L(function*(){return yield a._p2pConnection.updateEncoderConfig(i,r)})()}updateSendParameters(i,r){var a=this;return L(function*(){return yield a._p2pConnection.updateSendParameters(i,r)})()}setStatsRemoteVideoIsReady(i,r){this._p2pConnection.setStatsRemoteVideoIsReady(i,r)}replaceTrack(i,r){var a=this;return L(function*(){return yield a._p2pConnection.replaceTrack(i,r)})()}getRemoteSSRC(i){var r=this;return L(function*(){return r._p2pConnection.getRemoteSSRC(i)})()}logSDPExchange(i,r,a,d){if(V("SDP_LOGGING"))return I.upload("exchanging ".concat(a," ").concat(r," SDP during DataChannelConnection.").concat(d,"\n"),i),"offer"===r?l=>{this.logSDPExchange(l,"answer","local"===a?"remote":"local",d)}:void 0}static resolvePCConfiguration(i){const r={iceServers:[]};return i.iceServers?r.iceServers=i.iceServers:i.turnServer&&"off"!==i.turnServer.mode&&(oa(i.turnServer.servers)?r.iceServers=i.turnServer.servers:(r.iceServers&&r.iceServers.push(...Gn.turnServerConfigToIceServers(i.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&i.turnServer.serversFromGateway&&r.iceServers.push(...Gn.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),V("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(i){const r=[];return i.forEach(a=>{a.security?a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Vd(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!V("FORCE_TURN_TCP")&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),r}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=i=>{var r;return null===(r=this.onICEConnectionStateChange)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onConnectionStateChange=i=>{var r;return null===(r=this.onConnectionStateChange)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onDTLSTransportStateChange=i=>{var r;return null===(r=this.onDTLSTransportStateChange)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onDTLSTransportError=i=>{var r;return null===(r=this.onDTLSTransportError)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onICETransportStateChange=i=>{var r;return null===(r=this.onICETransportStateChange)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onFirstAudioReceived=i=>{var r;return null===(r=this.onFirstAudioReceived)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onFirstVideoReceived=i=>{var r;return null===(r=this.onFirstVideoReceived)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onFirstAudioDecoded=i=>{var r;return null===(r=this.onFirstAudioDecoded)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onFirstVideoDecoded=(i,r,a)=>{var d;return null===(d=this.onFirstVideoDecoded)||void 0===d?void 0:d.call(this,i,r,a)},this._p2pConnection.onFirstVideoDecodedTimeout=i=>{var r;return null===(r=this.onFirstVideoDecodedTimeout)||void 0===r?void 0:r.call(this,i)},this._p2pConnection.onSelectedLocalCandidateChanged=(i,r)=>{var a;return null===(a=this.onSelectedLocalCandidateChanged)||void 0===a?void 0:a.call(this,i,r)},this._p2pConnection.onSelectedRemoteCandidateChanged=(i,r)=>{var a;return null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a?void 0:a.call(this,i,r)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0}setConfiguration(i){this._p2pConnection.setConfiguration(i)}}function Qr(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=L(function*(){const d=this.mutex,l=yield d.lock("From DataChannelConnection.".concat(i));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{l()}}),r}function L0(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function tl(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?L0(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):L0(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function TF(s){var i,r,a,d=2;for(typeof Symbol<"u"&&(r=M0,a=Symbol.iterator);d--;){if(r&&null!=(i=s[r]))return i.call(s);if(a&&null!=(i=s[a]))return new lb(i.call(s));r="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function lb(s){function i(r){if(Object(r)!==r)return X.reject(new TypeError(r+" is not an object."));var a=r.done;return X.resolve(r.value).then(function(d){return{value:d,done:a}})}return(lb=function(r){this.s=r,this.n=r.next}).prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(r){var a=this.s.return;return void 0===a?X.resolve({value:r,done:!0}):i(a.apply(this.s,arguments))},throw:function(r){var a=this.s.return;return void 0===a?X.reject(r):i(a.apply(this.s,arguments))}},new lb(s)}ne([Qr,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",X)],Gn.prototype,"connect",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[Array,Array]),N("design:returntype",X)],Gn.prototype,"updateRemoteRTPCapabilities",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",X)],Gn.prototype,"createDataChannels",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",X)],Gn.prototype,"receive",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Gn.prototype,"stopReceiving",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],Gn.prototype,"muteRemote",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],Gn.prototype,"unmuteRemote",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Gn.prototype,"muteLocal",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Gn.prototype,"unmuteLocal",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Gn.prototype,"close",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],Gn.prototype,"updateEncoderConfig",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[String,Bi]),N("design:returntype",X)],Gn.prototype,"updateSendParameters",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[Bi,String]),N("design:returntype",X)],Gn.prototype,"replaceTrack",null),ne([Qr,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],Gn.prototype,"getRemoteSSRC",null);class ai extends jt{get state(){return this._state}set state(i){const r=this._state;this._state=i,this.emit(Oe.StateChange,r,this._state)}constructor(i,r){var a;super(),a=this,S(this,"store",void 0),S(this,"statsUploader",void 0),S(this,"connection",void 0),S(this,"localTrackMap",new Map),S(this,"remoteUserMap",new Map),S(this,"localDataChannels",[]),S(this,"remoteDataChannelMap",new Map),S(this,"pendingLocalTracks",[]),S(this,"pendingRemoteTracks",[]),S(this,"pendingLocalDataChannels",[]),S(this,"pendingRemoteDataChannels",[]),S(this,"statsCollector",void 0),S(this,"isPlanB",!1),S(this,"shouldForwardP2PCreation",void 0),S(this,"iceFailedCount",0),S(this,"dtlsFailedCount",0),S(this,"mutex",new Ei("P2PChannel-mutex")),S(this,"_state",Dt.Disconnected),S(this,"_pcStatsUploadType",V("NEW_ICE_RESTART")?Bs.FIRST_CONNECTION:Bs.OLD_FIRST_CONNECTION),S(this,"_isInRestartIce",!1),S(this,"_isStartRestartIce",!1),S(this,"_restartStates",["disconnected","failed"]),S(this,"_restartTimer",void 0),S(this,"_isFirstConnected",!0),S(this,"handleMuteLocalTrack",function(){var d=L(function*(l,h,p){const m=yield a.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!a.connection||a.state!==Dt.Connected)return void p(new ee(k.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const _=a.filterTobeMutedTracks(l);if(0===_.length)return void h();const v=_.find(y=>"videoLowTrack"===y[0]);v&&v[1].track._originMediaStreamTrack.stop(),yield a.connection.muteLocal(_.map(y=>{let[,{id:T}]=y;return T}));const b=a.createMuteMessage(_);yield Tt(a,Oe.RequestMuteLocal,b),h()}catch(_){p(_)}finally{m()}});return function(l,h,p){return d.apply(this,arguments)}}()),S(this,"handleUnmuteLocalTrack",function(){var d=L(function*(l,h,p){const m=yield a.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!a.connection||a.state!==Dt.Connected)return void p(new ee(k.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const _=a.filterTobeUnmutedTracks(l);if(0===_.length)return void h();const v=_.find(y=>"videoLowTrack"===y[0]);if(v){const y=v[1];if(y.track._originMediaStreamTrack.stop(),!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ot().supportDualStreamEncoding){const T=l._mediaStreamTrack.clone();y.track._mediaStreamTrack=T,y.track._originMediaStreamTrack=T}else{const T=Pp(l,mr(a,Oe.RequestLowStreamParameter));y.track._mediaStreamTrack=T,y.track._originMediaStreamTrack=T}yield new X((T,M)=>{a.handleReplaceTrack(y.track,T,M,!0)})}yield a.connection.unmuteLocal(_.map(y=>{let[,{id:T}]=y;return T}));const b=a.createUnmuteMessage(_);yield Tt(a,Oe.RequestUnmuteLocal,b),h()}catch(_){p(_)}finally{m()}});return function(l,h,p){return d.apply(this,arguments)}}()),S(this,"handleUpdateVideoEncoder",function(){var d=L(function*(l,h,p){const m=yield a.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const _=a.localTrackMap.get(re.LocalVideoTrack);if(!a.connection||!_||_.track!==l||a.state!==Dt.Connected)return void h();const{id:v,track:b}=_;yield a.connection.updateSendParameters(v,b),yield a.connection.updateEncoderConfig(v,b),a.emit(Oe.UpdateVideoEncoder,b),h()}catch(_){p(_)}finally{m()}});return function(l,h,p){return d.apply(this,arguments)}}()),S(this,"handleSetOptimizationMode",function(){var d=L(function*(l,h,p){const m=yield a.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const _=a.localTrackMap.get(re.LocalVideoTrack);if(!a.connection||!_||_.track!==l||a.state!==Dt.Connected)return;const{id:v,track:b}=_;yield a.connection.updateSendParameters(v,b),h()}catch(_){p(_)}finally{m()}});return function(l,h,p){return d.apply(this,arguments)}}()),S(this,"handleReplaceTrack",function(){var d=L(function*(l,h,p,m){let _;I.debug("[".concat(a.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(l.getTrackId(),"]")),"boolean"==typeof m&&m||(_=yield a.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var v;const y=Array.from(a.localTrackMap.entries()).find(T=>{let[,{track:M}]=T;return l===M});if(!a.connection||!y||a.state!==Dt.Connected)return void h();if(yield null===(v=a.connection)||void 0===v?void 0:v.replaceTrack(l,y[1].id),a.isPlanB){const T=y[1];T.id=l._mediaStreamTrack.id,a.localTrackMap.set(y[0],T)}if(y[0]===re.LocalVideoTrack&&!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ot().supportDualStreamEncoding){const T=a.localTrackMap.get(re.LocalVideoLowTrack);if(T){const M=l._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=M,T.track._originMediaStreamTrack=M,yield new X((O,D)=>{a.handleReplaceTrack(T.track,O,D,!0)})}}h()}catch(y){p(y)}finally{var b;null===(b=_)||void 0===b||b()}});return function(l,h,p,m){return d.apply(this,arguments)}}()),S(this,"handleGetRTCStats",d=>{d(this.statsCollector.getRTCStats())}),S(this,"handleGetLocalVideoStats",d=>{d(this.statsCollector.getLocalVideoTrackStats())}),S(this,"handleGetLocalAudioStats",d=>{d(this.statsCollector.getLocalAudioTrackStats())}),S(this,"handleGetRemoteVideoStats",d=>this.statsCollector.getRemoteVideoTrackStats(d.uid)[d.uid]),S(this,"handleGetRemoteAudioStats",d=>this.statsCollector.getRemoteAudioTrackStats(d.uid)[d.uid]),this.store=i,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new pP(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!Ot().supportUnifiedPlan||V("CHROME_FORCE_PLAN_B")&&wd(),this.shouldForwardP2PCreation=V("FORWARD_P2P_CREATION")&&Ot().supportPCSetConfiguration&&function(){const d=kE();return d===ei.ANDROID||d===ei.IOS||d===ei.HARMONY_OS}(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Gn({},this.store):this.isPlanB?new pi({},this.store):new Qt({},this.store),this.bindConnectionEvents(this.connection))}startP2PConnection(i,r){var a=this;return L(function*(){var d;a.state=Dt.New;const l=a.shouldForwardP2PCreation&&"closed"===(null===(d=a.connection)||void 0===d?void 0:d.peerConnectionState);if(a.shouldForwardP2PCreation&&!l||(l&&a.connection&&(I.warning("[".concat(a.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),a.connection.close(),a.unbindConnectionEvents(a.connection)),a.connection=a.store.useDataChannel?new Gn(i,a.store):a.isPlanB?new pi(i,a.store):new Qt(i,a.store),a.bindConnectionEvents(a.connection)),!a.connection)throw new ee(k.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return a._pcStatsUploadType=V("NEW_ICE_RESTART")?Bs.FIRST_CONNECTION:Bs.OLD_FIRST_CONNECTION,a._isFirstConnected=!0,a._isInRestartIce=!1,a._isStartRestartIce=!1,a.connection.setConfiguration(i),a.connection.establishPromise})()}connect(i,r,a,d,l,h){var p=this;return L(function*(){if(!p.connection)throw new ee(k.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");p.connection instanceof Gn?p.connection.updateRemoteConnect(d):(p.store.peerConnectionStart(),yield p.connection.connect(i,r,a,d,l,h),p.statsUploader.startUploadTransportStats(),p.statsUploader.startUploadExtensionUsageStats(),p.state=Dt.Connected)})()}updateRemoteRTPCapabilities(i){const r=Array.from(this.localTrackMap.entries()).filter(l=>{var h;let[p]=l;return ye(h=[re.LocalVideoLowTrack,re.LocalVideoTrack]).call(h,p)}),a=r.map(l=>{let[,{id:h}]=l;return h}),d=r.map(l=>{let[h]=l;return h});if(this.connection instanceof Qt){if(Ie.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(d),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(i)}),!ye(i).call(i,this.store.codec)){const l=["vp8","h264"].find(h=>ye(i).call(i,h));l&&(this.store.codec=l,I.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(l,".")))}this.connection.updateRemoteRTPCapabilities(a,i)}}preConnect(i,r,a,d,l,h){var p=this;return L(function*(){if(!p.connection)throw new ee(k.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");p.store.peerConnectionStart();const m=yield p.connection.connect(i,r,a,d,l,h);return p.statsUploader.startUploadTransportStats(),p.statsUploader.startUploadExtensionUsageStats(),p.state=Dt.Connected,m})()}getEstablishParams(){if(this.connection instanceof Gn)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publishDataChannel(i){var r=this;return L(function*(){if(!r.connection){if(r.state===Dt.Disconnected)throw new ee(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");const d=i.filter(l=>-1!==r.pendingLocalDataChannels.findIndex(h=>h.id===l.id));return void(r.pendingLocalDataChannels=r.pendingLocalDataChannels.concat(d))}const a=r.filterTobePublishedDataChannels(i);0!==a.length&&(a.forEach(d=>{const l=Date.now();r.store.publish(d.id.toString(),"datachannel",l)}),yield r.connection.createDataChannels(r.store.uid,a),a.forEach(d=>{r.localDataChannels.push(d);const l=Date.now();r.store.publish(d.id+"","datachannel",void 0,l)}))})()}publish(i,r,a){var d=this;return Xr(function*(){const l=yield Be(d.mutex.lock("From P2PChannel.publish"));try{if(!d.connection||d.state!==Dt.Connected){if(d.state===Dt.Disconnected)throw new ee(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");d.throwIfTrackTypeNotMatch(i);const p=i.filter(m=>-1===d.pendingLocalTracks.indexOf(m));return void(d.pendingLocalTracks=d.pendingLocalTracks.concat(p))}d.store.pubId=d.store.pubId+1,Li.markPublishStart(d.store.clientId,d.store.pubId);const h=d.filterTobePublishedTracks(i,r,a);if(0===h.length)return void(yield Be(d.tryToUnmuteAudio(i)));yield*rb(TF(d.doPublish(d.connection,h)))}finally{l()}})()}doPublish(i,r){var a=this;return Xr(function*(){r.forEach(v=>{let{track:b,type:y}=v;const T=Date.now();a.store.publish(b.getTrackId(),y===re.LocalAudioTrack?"audio":"video",T)}),a.bindLocalTrackEvents(r);const d=yield Be(i.send(r.map(v=>{let{track:b}=v;return b}),a.store.codec,a.store.audioCodec)),l=(yield Be(d.next())).value,h=a.createGatewayPublishMessage(r,l);let p;try{p=yield h}catch(v){throw d.throw(v),v?.code===k.WS_ABORT&&r.forEach(b=>{let{track:y}=b;-1===a.pendingLocalTracks.indexOf(y)&&a.pendingLocalTracks.push(y)}),a.unbindLocalTrackEvents(r),v}const m=a.mapPubResToRemoteConfig(h,p),_=(yield Be(d.next(m))).value;r.forEach(v=>{let{type:b}=v;a.statsCollector.addLocalStats(b)}),a.assignLocalTracks(r,_),a.statsUploader.startUploadOutboundStats(),r.forEach(v=>{let{track:b,type:y}=v;const T=Date.now();a.store.publish(b.getTrackId(),y===re.LocalAudioTrack?"audio":"video",void 0,T)})})()}updateVideoStreamParameter(i,r){var a=this;return L(function*(){const d=a.localTrackMap.get(r);if(!d)return;if(!(d.track instanceof je))return I.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(a.connection instanceof Qt||a.connection instanceof pi))return I.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:l}=d,h=function(p,m){const _={};return p.height&&p.width&&(_.scaleResolutionDownBy=vT(p,m)),_.maxFramerate=p.framerate?Po(p.framerate):void 0,_.maxBitrate=p.bitrate?1e3*p.bitrate:void 0,_}(i,l);if(l._encoderConfig||(l._encoderConfig={}),r!==re.LocalVideoLowTrack||!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ot().supportDualStreamEncoding)null!=h.scaleResolutionDownBy&&(l._encoderConfig.scaleResolutionDownBy=h.scaleResolutionDownBy);else{const p=l._originMediaStreamTrack;if(!p.canvas)return I.warn("[".concat(l.getTrackId(),"] no canvas on track"));!function(m,_){const v=m.canvas;_.width&&(v.width=Po(_.width)),_.height&&(v.height=Po(_.height)),_.framerate&&(v.stopCapture&&v.stopCapture(),v.stopCapture=FT(()=>{!v.startCapture&&v.stopCapture&&v.stopCapture(),v.startCapture&&v.startCapture()},Po(_.framerate)))}(p,i)}null!=h.maxBitrate&&(l._encoderConfig.bitrateMax=h.maxBitrate/1e3),null!=h.maxFramerate&&(l._encoderConfig.frameRate&&"object"==typeof l._encoderConfig.frameRate?l._encoderConfig.frameRate.max=h.maxFramerate:l._encoderConfig.frameRate={max:h.maxFramerate}),I.debug("[".concat(l.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(l._encoderConfig))),yield a.connection.updateRtpSenderEncodings(l)})()}publishLowStream(i){var r=this;return Xr(function*(){if(!r.connection||r.state!==Dt.Connected)return;const a=yield Be(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const l=r.localTrackMap.get(re.LocalVideoTrack);if(!l)throw new ee(k.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(re.LocalVideoLowTrack))throw new ee(k.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const h=[{track:r.getLowVideoTrack(l.track,i),type:re.LocalVideoLowTrack}];if(yield*rb(TF(r.doPublish(r.connection,h))),l.track.muted||!l.track.enabled){var d;const p=null===(d=r.localTrackMap.get(re.LocalVideoLowTrack))||void 0===d?void 0:d.id;void 0!==p&&(yield Be(r.connection.muteLocal([p])))}}finally{a()}})()}republish(){var i=this;return L(function*(){i.pendingLocalTracks.length>0&&(I.debug("[".concat(i.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield rn(i,Oe.RequestRePublish,i.pendingLocalTracks),i.emit(Oe.MediaReconnectEnd,i.store.uid),i.pendingLocalTracks=[]),i.pendingLocalDataChannels.length>0&&(I.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),yield rn(i,Oe.RequestRePublishDataChannel,i.pendingLocalDataChannels),i.pendingLocalDataChannels=[])})()}reSubscribe(i){var r=this;return L(function*(){for(let a=r.pendingRemoteTracks.length-1;a>=0;a--){const{user:d,kind:l}=r.pendingRemoteTracks[a];(l!==Ce.AUDIO||d._audio_added_&&d._audioSSRC)&&(l!==Ce.VIDEO||d._video_added_&&d._videoSSRC)||r.pendingRemoteTracks.splice(a,1)}if(i)yield rn(r,Oe.RequestReSubscribe,r.pendingRemoteTracks);else for(const{user:a,kind:d}of r.pendingRemoteTracks)yield r.subscribe(a,d,d===Ce.VIDEO?a._videoSSRC:a._audioSSRC);r.pendingRemoteTracks.forEach(a=>{let{user:d}=a;r.emit(Oe.MediaReconnectEnd,d.uid)}),r.pendingRemoteTracks=[]})()}unpublish(i){var r=this;return L(function*(){if(!r.connection||r.state!==Dt.Connected)return void i.forEach(l=>{const h=r.pendingLocalTracks.indexOf(l);-1!==h&&r.pendingLocalTracks.splice(h,1)});const a=r.filterTobeUnpublishedTracks(i);if(0===a.length)return;const d=a.find(l=>"videoLowTrack"===l[0]);return d&&d[1].track.close(),r.doUnpublish(r.connection,a)})()}unpublishDataChannel(i){var r=this;return L(function*(){if(!r.connection||r.state!==Dt.Connected)return void i.forEach(d=>{const l=r.pendingLocalDataChannels.indexOf(d);-1!==l&&r.pendingLocalDataChannels.splice(l,1)});const a=r.filterTobeUnpublishedDataChannels(i);return 0!==a.length?(a.forEach(d=>{const l=r.localDataChannels.indexOf(d);-1!==l&&r.localDataChannels.splice(l,1)}),0===r.localDataChannels.length&&(yield r.connection.stopDataChannels(r.store.uid)),a.map(d=>d.id)):void 0})()}unpublishLowStream(){var i=this;return L(function*(){if(!i.connection||i.state!==Dt.Connected)return;const r=i.localTrackMap.get(re.LocalVideoLowTrack);return r?(r.track.close(),i.doUnpublish(i.connection,[[re.LocalVideoLowTrack,r]])):void 0})()}doUnpublish(i,r){var a=this;return L(function*(){const d=a.createGatewayUnpublishMessage(r);return yield i.stopSending(r.map(l=>{let[,{id:h}]=l;return h})),a.withdrawLocalTracks(r),a.unbindLocalTrackEvents(r.map(l=>{let[h,{track:p}]=l;return{type:h,track:p}})),r.forEach(l=>{let[h]=l;a.statsCollector.removeLocalStats(h)}),0===a.localTrackMap.size&&a.statsUploader.stopUploadOutboundStats(),d})()}subscribeDataChannel(i,r){var a=this;return L(function*(){if(!a.connection||a.state!==Dt.Connected)throw new ee(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const d=r.filter(l=>{var h;return!(null!==(h=a.remoteDataChannelMap.get(i))&&void 0!==h&&h.get(l.id))});if(0!==d.length)return yield a.connection.createDataChannels(i.uid,d),d.forEach(l=>{var h;a.remoteDataChannelMap.has(i)?null===(h=a.remoteDataChannelMap.get(i))||void 0===h||h.set(l.id,l):a.remoteDataChannelMap.set(i,new Map([[l.id,l]]));const p=a.pendingRemoteDataChannels.findIndex(m=>{let{user:_,id:v}=m;return _.uid===i.uid&&v===l.id});-1!==p&&a.pendingRemoteDataChannels.splice(p,1)}),d.map(l=>l.id)})()}subscribe(i,r,a,d,l){var h=this;return L(function*(){var p;if(!h.connection||h.state!==Dt.Connected)throw new ee(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(p=h.remoteUserMap.get(i))&&void 0!==p&&p.has(r))return;let m,_,v;if(l){const T=l.find(O=>{let{stream_type:D}=O;return D===r});if(!T)throw new ee(k.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(i.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const M=yield h.connection.receive(r,T.ssrcs,String(i._uintid),T.attributes);h.connection instanceof Qt&&(v=M.transceiver),m=M.track,_=M.id}else{const T=yield h.connection.receive(r,[{ssrcId:a,rtx:d}],String(i._uintid),void 0);h.connection instanceof Qt&&(v=T.transceiver),m=T.track,_=T.id}r===Ce.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(m):(i._audioTrack=new _s(m,i.uid,i._uintid,h.store),I.info("[".concat(h.store.clientId,"] [").concat(h.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),v&&i._audioTrack._updateRtpTransceiver(v),h.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(m):(i._videoTrack=new Wa(m,i.uid,i._uintid,h.store),I.info("[".concat(h.store.clientId,"] [").concat(h.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),v&&i._videoTrack._updateRtpTransceiver(v),h.bindRemoteTrackEvents(i,i._videoTrack));const b=h.remoteUserMap.get(i);b?b.set(r,_):h.remoteUserMap.set(i,new Map([[r,_]])),h.statsCollector.addRemoteStats(i.uid),h.statsUploader.startUploadInboundStats();const y=h.pendingRemoteTracks.findIndex(T=>{let{user:M,kind:O}=T;return M.uid===i.uid&&r===O});-1!==y&&(h.pendingRemoteTracks.splice(y,1),h.emit(Oe.MediaReconnectEnd,i.uid))})()}massSubscribe(i){var r=this;return L(function*(){return r.massSubscribeNoLock(i)})()}massSubscribeNoLock(i){var r=this;return L(function*(){if(!r.connection||r.state!==Dt.Connected)throw new ee(k.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");i=i.filter(d=>{var l;let{user:h,mediaType:p}=d;return!(null!==(l=r.remoteUserMap.get(h))&&void 0!==l&&l.has(p))});const a=yield r.connection.batchReceive(i.map(d=>{let{user:l,mediaType:h,ssrcId:p,rtxSsrcId:m}=d;return{kind:h,ssrcMsg:[{ssrcId:p,rtx:m}],mslabel:String(l._uintid)}}));i.forEach((d,l)=>{let{user:h,mediaType:p}=d;const{track:m,id:_,transceiver:v}=a[l];p===Ce.AUDIO?(h._audioTrack?h._audioTrack._updateOriginMediaStreamTrack(m):(h._audioTrack=new _s(m,h.uid,h._uintid,r.store),I.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote audio track: ").concat(h._audioTrack.getTrackId()))),v&&h._audioTrack._updateRtpTransceiver(v),r.bindRemoteTrackEvents(h,h._audioTrack)):(h._videoTrack?h._videoTrack._updateOriginMediaStreamTrack(m):(h._videoTrack=new Wa(m,h.uid,h._uintid,r.store),I.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote video track: ").concat(h._videoTrack.getTrackId()))),v&&h._videoTrack._updateRtpTransceiver(v),r.bindRemoteTrackEvents(h,h._videoTrack));const b=r.remoteUserMap.get(h);b?b.set(p,_):r.remoteUserMap.set(h,new Map([[p,_]])),r.statsCollector.addRemoteStats(h.uid),r.statsUploader.startUploadInboundStats();const y=r.pendingRemoteTracks.findIndex(T=>{let{user:M,kind:O}=T;return M.uid===h.uid&&p===O});-1!==y&&(r.pendingRemoteTracks.splice(y,1),r.emit(Oe.MediaReconnectEnd,h.uid))})})()}unsubscribe(i,r,a){var d=this;return L(function*(){const l=d.pendingRemoteTracks.filter(m=>{let{user:_,kind:v}=m;return void 0!==r?_.uid===i.uid&&r===v:_.uid===i.uid});if(l.forEach(m=>{const _=d.pendingRemoteTracks.indexOf(m);d.pendingRemoteTracks.splice(_,1)}),d.connection&&d.state===Dt.Connected||a||l.forEach(m=>{let{kind:_}=m;var v;if(_===Ce.AUDIO)null===(v=i._audioTrack)||void 0===v||v._destroy(),i._audioTrack=void 0;else if(_===Ce.VIDEO){var b;null===(b=i._videoTrack)||void 0===b||b._destroy(),i._videoTrack=void 0}}),!d.connection||d.state!==Dt.Connected)return;const h=d.filterTobeUnSubscribedTracks(i,r);if(0===h.length)return;yield d.connection.stopReceiving(h.map(m=>{let[,{id:_}]=m;return _}));const p=d.createUnsubscribeMessage(h);return d.withdrawRemoteTracks(h),0===d.remoteUserMap.size&&d.statsUploader.stopUploadInboundStats(),h.forEach(m=>{let[_,{kind:v}]=m;var b,y;if(v===Ce.VIDEO&&_._videoSSRC&&(null===(b=d.connection)||void 0===b||b.setStatsRemoteVideoIsReady(_._videoSSRC,!1)),v===Ce.VIDEO)d.unbindRemoteTrackEvents(_._videoTrack),a||(null===(y=_._videoTrack)||void 0===y||y._destroy(),_._videoTrack=void 0);else if(v===Ce.AUDIO){var T;d.unbindRemoteTrackEvents(_._audioTrack),!a&&(null===(T=_._audioTrack)||void 0===T||T._destroy(),_._audioTrack=void 0)}}),p})()}unsubscribeDataChannel(i,r){var a=this;return L(function*(){if(r.forEach(h=>{const p=a.pendingRemoteDataChannels.findIndex(m=>m.id===h.id);-1!==p&&a.pendingRemoteDataChannels.splice(p,1)}),!a.connection)return;const d=a.filterTobeUnSubscribedDataChannels(i,r);if(0===d.length)return;r.forEach(h=>{h._close()});const l=a.remoteDataChannelMap.get(i);return d.forEach(h=>{l&&l.delete(h.id)}),l&&0===l.size&&(a.remoteDataChannelMap.delete(i),yield a.connection.stopDataChannels(i.uid)),d.map(h=>h.id)})()}massUnsubscribe(i){var r=this;return L(function*(){return r.massUnsubscribeNoLock(i)})()}massUnsubscribeNoLock(i){var r=this;return L(function*(){let a=[];for(const{user:h,mediaType:p}of i){const m=r.pendingRemoteTracks.filter(_=>{let{user:v,kind:b}=_;return void 0!==p?v.uid===h.uid&&p===b:v.uid===h.uid});m.forEach(_=>{const v=r.pendingRemoteTracks.indexOf(_);r.pendingRemoteTracks.splice(v,1)}),a=a.concat(m)}if(!r.connection||r.state!==Dt.Connected)return void a.forEach(h=>{let{user:p,kind:m}=h;var _;if(m===Ce.AUDIO)null===(_=p._audioTrack)||void 0===_||_._destroy(),p._audioTrack=void 0;else if(m===Ce.VIDEO){var v;null===(v=p._videoTrack)||void 0===v||v._destroy(),p._videoTrack=void 0}});const d=Va(i).call(i,(h,p)=>{let{user:m,mediaType:_}=p;const v=r.filterTobeUnSubscribedTracks(m,_);return h.concat(v)},[]);if(0===d.length)return;yield r.connection.stopReceiving(d.map(h=>{let[,{id:p}]=h;return p}));const l=r.createUnsubscribeAllMessage(d);return r.withdrawRemoteTracks(d),0===r.remoteUserMap.size&&r.statsUploader.stopUploadInboundStats(),d.forEach(h=>{let[p,{kind:m}]=h;var _,v;if(m===Ce.VIDEO&&p._videoSSRC&&(null===(_=r.connection)||void 0===_||_.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),m===Ce.VIDEO)r.unbindRemoteTrackEvents(p._videoTrack),null===(v=p._videoTrack)||void 0===v||v._destroy(),p._videoTrack=void 0;else if(m===Ce.AUDIO){var b;r.unbindRemoteTrackEvents(p._audioTrack),null===(b=p._audioTrack)||void 0===b||b._destroy(),p._audioTrack=void 0}}),l})()}muteRemote(i,r){var a=this;return L(function*(){if(!a.connection)return;const d=a.remoteUserMap.get(i);if(!d)return void I.warning("[".concat(a.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(i.uid,"."));if(!d.get(r))return void I.warning("[".concat(a.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(i.uid," media type ").concat(r,"."));const l=r===Ce.VIDEO?i._videoSSRC:i._audioSSRC;void 0!==l&&a.connection.setStatsRemoteVideoIsReady(l,!1)})()}unmuteRemote(i,r){var a=this;return L(function*(){return a.unmuteRemoteNoLock(i,r)})()}unmuteRemoteNoLock(i,r){var a=this;return L(function*(){if(!a.connection)return;const d=a.remoteUserMap.get(i);d?d.get(r)||I.warning("[".concat(a.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(i.uid," media type ").concat(r,".")):I.warning("[".concat(a.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(i.uid,"."))})()}getAllTracks(i){const r=this.localTrackMap.get(re.LocalAudioTrack);if(r?.track instanceof jn){const a=r.track;return Array.from(this.localTrackMap.entries()).filter(d=>{let[l]=d;return l!==re.LocalAudioTrack}).filter(d=>{let[l]=d;return!(i&&l===re.LocalVideoLowTrack)}).map(d=>{let[,{track:l}]=d;return l}).concat(a.trackList)}return Array.from(this.localTrackMap.entries()).filter(a=>{let[d]=a;return!(i&&d===re.LocalVideoLowTrack)}).map(a=>{let[,{track:d}]=a;return d})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(i,r,a,d,l){if(i){const p=this.localTrackMap.get(re.LocalAudioTrack),m=this.localTrackMap.get(d?re.LocalVideoLowTrack:re.LocalVideoTrack);Ie.publish(this.store.sessionId,{eventElapse:Li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:r,audioName:p?.track.getTrackLabel(),videoName:m?.track.getTrackLabel(),screenshare:-1!==m?.track._hints.indexOf(kt.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}else{var h;a||(a=[]);const p=a.find(_=>_ instanceof vt),m=d?null===(h=this.localTrackMap.get(re.LocalVideoTrack))||void 0===h?void 0:h.track:a.find(_=>_ instanceof je);Ie.publish(this.store.sessionId,{eventElapse:Li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:r,audioName:p?.getTrackLabel(),videoName:m?.getTrackLabel(),screenshare:-1!==m?._hints.indexOf(kt.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}}reportSubscribeEvent(i,r,a,d){const l=d===Ce.VIDEO?a._videoSSRC:a._audioSSRC;l&&Ie.subscribe(this.store.sessionId,{succ:i,ec:r,video:d===Ce.VIDEO,audio:d===Ce.AUDIO,peerid:a.uid,subscribeRequestid:d===Ce.VIDEO?a._videoSSRC:a._audioSSRC,p2pid:this.store.p2pId,eventElapse:Li.measureFromSubscribeStart(this.store.clientId,l)})}reset(){I.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Ei("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Gn({},this.store):this.isPlanB?new pi({},this.store):new Qt({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const i=this.localTrackMap.get(re.LocalAudioTrack);if(i?.track instanceof jn){if(i.track.trackList.length>0){const r=i.track;i.track.trackList.forEach(a=>{r.removeAudioTrack(a)})}i.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Dt.Disconnected}getStats(){var i;return null===(i=this.connection)||void 0===i?void 0:i.getStats()}getRemoteVideoIsReady(i){var r;return(null===(r=this.connection)||void 0===r?void 0:r.getRemoteVideoIsReady(i))||!1}getLocalAudioVolume(){const i=this.localTrackMap.get(re.LocalAudioTrack);if(i)return i.track.getVolumeLevel()}getLocalVideoSize(){const i=this.localTrackMap.get(re.LocalVideoTrack);if(i)return{width:i.track._videoWidth||0,height:i.track._videoHeight||0}}getEncoderConfig(i){const r=this.localTrackMap.get(i);return r&&r.track instanceof je||r&&r.track instanceof vt?r.track._encoderConfig:void 0}getLocalMedia(i){return this.localTrackMap.get(i)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(i,r){if(!i)return this.remoteUserMap.size>0;const a=this.remoteUserMap.get(i);return!!a&&(!r||a.has(r))}hasRemoteMediaWithLock(i,r){var a=this;return L(function*(){if(!i)return a.remoteUserMap.size>0;const d=a.remoteUserMap.get(i);return!!d&&(!r||d.has(r))})()}getRemoteMedia(i){var r;const a=Array.from(ir(r=this.remoteUserMap).call(r)).find(d=>d.uid===i);return a?{audioTrack:a.audioTrack,audioSSRC:a._audioSSRC,videoTrack:a.videoTrack,videoSSRC:a._videoSSRC}:{}}getAudioLevels(){let i=Array.from(this.remoteUserMap.entries()).map(a=>{let[d]=a;return{uid:d.uid,level:d.audioTrack?100*d.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(re.LocalAudioTrack);return r&&i.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),i=dE(i).call(i,(a,d)=>a.level-d.level),i}disconnectForReconnect(){var i=this;return L(function*(){i.connection&&(I.debug("[".concat(i.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),i.state=Dt.Reconnecting,V("KEEP_LAST_FRAME")&&0!==i.remoteUserMap.size&&Array.from(i.remoteUserMap.entries()).forEach(r=>{let[a]=r;var d;a._videoTrack&&a._videoTrack._player&&(null===(d=a._videoTrack._player.getVideoElement())||void 0===d||d.pause(),a._videoTrack._player.isKeepLastFrame=!0,a._videoTrack._originMediaStreamTrack.stop())}),i.connection.close(),i.unbindConnectionEvents(i.connection),i.connection=void 0,i.shouldForwardP2PCreation&&(i.connection=i.store.useDataChannel?new Gn({},i.store):i.isPlanB?new pi({},i.store):new Qt({},i.store),i.bindConnectionEvents(i.connection)),0!==i.localTrackMap.size&&(Array.from(i.localTrackMap.entries()).forEach(r=>{var a;let[d,{track:l}]=r;switch(d){case re.LocalVideoTrack:ye(a=l._hints).call(a,kt.LOW_STREAM)?l.close():i.pendingLocalTracks.push(l);break;case re.LocalAudioTrack:l instanceof jn?i.pendingLocalTracks=i.pendingLocalTracks.concat(l.trackList):i.pendingLocalTracks.push(l)}}),i.emit(Oe.MediaReconnectStart,i.store.uid)),i.unbindLocalTrackEvents(),i.localTrackMap.clear(),0!==i.remoteUserMap.size&&Array.from(i.remoteUserMap.entries()).forEach(r=>{let[a,d]=r;Array.from(ir(d).call(d)).forEach(l=>{i.setPendingRemoteMedia(a,l)}),i.emit(Oe.MediaReconnectStart,a.uid)}),i.unbindAllRemoteTrackEvents(),i.remoteUserMap.clear(),0!==i.localDataChannels.length&&(i.localDataChannels.forEach(r=>{i.pendingLocalDataChannels.push(r)}),i.localDataChannels.length=0),0!==i.remoteDataChannelMap.size&&(Array.from(i.remoteDataChannelMap.entries()).forEach(r=>{let[a,d]=r;Array.from(ir(d).call(d)).forEach(l=>{i.setPendingRemoteDataChannel(a,l)})}),i.remoteDataChannelMap.clear()),i.statsUploader.stopUploadOutboundStats(),i.statsUploader.stopUploadInboundStats(),i.statsUploader.stopUploadTransportStats(),I.debug("[".concat(i.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))})()}hasPendingRemoteDataChannel(i,r){for(const a of this.pendingRemoteDataChannels){const{user:d,id:l}=a;if((i instanceof Ii?i.uid:i)===d.uid&&l===r)return!0}return!1}setPendingRemoteDataChannel(i,r){this.hasPendingRemoteDataChannel(i,r)||this.pendingRemoteDataChannels.push({user:i,id:r})}hasPendingRemoteMedia(i,r){for(const a of this.pendingRemoteTracks){const{user:d,kind:l}=a;if((i instanceof Ii?i.uid:i)===d.uid&&r===l)return!0}return!1}setPendingRemoteMedia(i,r){this.hasPendingRemoteMedia(i,r)||this.pendingRemoteTracks.push({user:i,kind:r})}restartICE(i){var r=this;return Xr(function*(){if(!r.connection||r.state!==Dt.Connected||r.connection instanceof Gn)return;const a=yield Be(r.mutex.lock("From P2PChannel.restartICE"));let d;try{d=yield Be(r.connection.restartICE(i));const h=yield Be(d.next());if(h.done)return;const p=h.value,m=yield p;switch(r.reportPCDisconnectedOrFailed(i),i){case Mi.TCP:r._pcStatsUploadType=Bs.TCP_RESTART;break;case Mi.RELAY:r._pcStatsUploadType=Bs.RELAY_RESTART;break;default:r._pcStatsUploadType=Bs.OLD_RESTART}r._isInRestartIce=!0,d.next(m)}catch(h){var l;null===(l=d)||void 0===l||l.throw(h)}finally{a()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const i=this.connection.getStats(),r=this.localTrackMap.get(re.LocalVideoTrack),a=this.localTrackMap.get(re.LocalAudioTrack),d=i.videoSend.find(M=>M.ssrc===r?.ssrcs[0].ssrcId),l=i.audioSend.find(M=>M.ssrc===a?.ssrcs[0].ssrcId);if(!d||!l)return 1;const h=Pr(this,Oe.NeedSignalRTT),p=d?d.rttMs:void 0,m=l?l.rttMs:void 0,_=p&&m?(p+m)/2:p||m,b=100*i.sendPacketLossRate*.7/50+.3*((_&&h?(_+h)/2:_||h)||0)/1500,y=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,T=r?.track;if(T&&T._encoderConfig&&-1===T._hints.indexOf(kt.SCREEN_TRACK)){const M=T._encoderConfig.bitrateMax,O=i.bitrate.actualEncoded;if(M&&O){const D=(1e3*M-O)/(1e3*M);return RO[D<.15?0:D<.3?1:D<.45?2:D<.6?3:4][y]}}return y}getDownlinkNetworkQuality(){if(!this.connection)return 0;const i=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(a=>{let[d]=a;const l=d._audioSSRC,h=d._videoSSRC,p=i.audioRecv.find(O=>O.ssrc===l),m=i.videoRecv.find(O=>O.ssrc===h);if(!p&&!m)return void(r+=1);const _=Pr(this,Oe.NeedSignalRTT),v=i.rtt,b=(v&&_?(v+_)/2:v||_)||0,y=p?p.jitterMs:void 0,T=i.recvPacketLossRate;let M=.7*T*100/50+.3*b/1500;y&&(M=.6*T*100/50+.2*b/1500+.2*y/400),r+=M<.1?1:M<.17?2:M<.36?3:M<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}muteLocalTrack(i){var r=this;return L(function*(){return new X((a,d)=>{r.handleMuteLocalTrack(i,a,d)})})()}filterTobePublishedTracks(i,r,a){const d=[],l=Ot(),h=this.getAllTracks();i=Ad(i=i.filter(_=>-1===h.indexOf(_)));let p=!1,m=!1;for(const _ of i){if(_ instanceof je&&(this.localTrackMap.has(re.LocalVideoTrack)||p?new ee(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(d.push({track:_,type:re.LocalVideoTrack}),p=!0),r)){const v=this.getLowVideoTrack(_,a);d.push({track:v,type:re.LocalVideoLowTrack})}if(_ instanceof vt){const v=this.localTrackMap.get(re.LocalAudioTrack);if(v){if(!(v.track instanceof jn))throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const b=d.find(y=>{let{type:T}=y;return T===re.LocalAudioTrack});if(!(b.track instanceof jn))throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");b.track.addAudioTrack(_)}else{if(!l.webAudioMediaStreamDest||_ instanceof jn||_._bypassWebAudio)d.push({track:_,type:re.LocalAudioTrack});else{const b=new jn;b.addAudioTrack(_),d.push({track:b,type:re.LocalAudioTrack})}m=!0}}}return d}filterTobeUnpublishedTracks(i){const r=[],a=this.getAllTracks();i=Ad(i=i.filter(d=>-1!==a.indexOf(d)));for(const d of i){if(d instanceof vt){const l=this.localTrackMap.get(re.LocalAudioTrack);if(!l)continue;l.track instanceof jn?(l.track.removeAudioTrack(d),this.unbindLocalAudioTrackEvents(d),0===l.track.trackList.length&&(r.push([re.LocalAudioTrack,l]),l.track.close())):r.push([re.LocalAudioTrack,l])}if(d instanceof je){const l=this.localTrackMap.get(re.LocalVideoTrack);if(!l)continue;r.push([re.LocalVideoTrack,l]);const h=this.localTrackMap.get(re.LocalVideoLowTrack);h&&r.push([re.LocalVideoLowTrack,h])}}return r}filterTobePublishedDataChannels(i){return(i=Ad(i)).filter(r=>-1===this.localDataChannels.findIndex(a=>a.id===r.id))}filterTobeUnpublishedDataChannels(i){return(i=(i=Ad(i)).filter(r=>-1!==this.localDataChannels.indexOf(r))).filter(r=>r._originDataChannel)}bindLocalTrackEvents(i){i.forEach(r=>{let{track:a,type:d}=r;switch(d){case re.LocalVideoTrack:a.addListener(ve.GET_STATS,this.handleGetLocalVideoStats),a.addListener(ve.GET_RTC_STATS,this.handleGetRTCStats),a.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.addListener(ve.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.addListener(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case re.LocalAudioTrack:this.bindLocalAudioTrackEvents(a)}})}bindLocalAudioTrackEvents(i,r){i instanceof jn?i.trackList.forEach(a=>{a.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(ve.GET_STATS,this.handleGetLocalAudioStats),a.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.addListener(ve.GET_STATS,this.handleGetLocalAudioStats),i.addListener(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||i.addListener(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(i){i||(i=Array.from(this.localTrackMap.entries()).map(r=>{let[a,{track:d}]=r;return{track:d,type:a}})),i.forEach(r=>{let{track:a,type:d}=r;switch(d){case re.LocalVideoTrack:a.off(ve.GET_STATS,this.handleGetLocalVideoStats),a.off(ve.GET_RTC_STATS,this.handleGetRTCStats),a.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.off(ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.off(ve.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.off(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case re.LocalAudioTrack:this.unbindLocalAudioTrackEvents(a)}})}unbindLocalAudioTrackEvents(i){i instanceof jn?i.trackList.forEach(r=>{r.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(ve.GET_STATS,this.handleGetLocalAudioStats),r.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.off(ve.GET_STATS,this.handleGetLocalAudioStats),i.off(ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(i,r){r instanceof Wa&&r.addListener(ve.GET_STATS,a=>{a(this.handleGetRemoteVideoStats(i))}),r instanceof _s&&r.addListener(ve.GET_STATS,a=>{a(this.handleGetRemoteAudioStats(i))})}unbindRemoteTrackEvents(i){i&&i.removeAllListeners(ve.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(i=>{let[r,a]=i;a.has(Ce.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),a.has(Ce.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(i,r){return i.map((a,d)=>{var l;let h,p,{track:m,type:_}=a;switch(_){case re.LocalAudioTrack:h=ut.Audio,p={dtx:m instanceof ji&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case re.LocalVideoTrack:h=ye(l=m._hints).call(l,kt.SCREEN_TRACK)?ut.Screen:ut.High,p=tl(tl({},WO(m)),{},{codec:this.store.codec});break;case re.LocalVideoLowTrack:h=ut.Low,p=tl(tl({},WO(m)),{},{codec:this.store.codec})}return{stream_type:h,attributes:p,ssrcs:r[d]}})}createGatewayUnpublishMessage(i){return i.map(r=>{var a;let d,[l,{track:h,ssrcs:p,id:m}]=r;switch(l){case re.LocalVideoTrack:d=ye(a=h._hints).call(a,kt.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalAudioTrack:d=ut.Audio;break;case re.LocalVideoLowTrack:d=ut.Low}return{stream_type:d,ssrcs:p,mid:m}})}assignLocalTracks(i,r){i.forEach((a,d)=>{let{track:l,type:h}=a;this.localTrackMap.set(h,{track:l,id:r[d].id,ssrcs:r[d].localSSRC})})}withdrawLocalTracks(i){i.forEach(r=>{let[a]=r;this.localTrackMap.delete(a)})}bindConnectionEvents(i){var r=this;i.onConnectionStateChange=function(){var a=L(function*(d){if(I.info("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(d,")")),r.emit(Oe.PeerConnectionStateChange,d),"connected"!==d||r.store.keyMetrics.peerConnectionEnd||r.store.peerConnectionEnd(),"connected"===d&&(r._restartTimer&&(clearTimeout(r._restartTimer),r._restartTimer=void 0),(r._isFirstConnected||r._isInRestartIce)&&r.reportPCStats(Date.now(),!0,r._pcStatsUploadType),r._isInRestartIce=!1,r._isFirstConnected=!1,r._isStartRestartIce=!1),V("NEW_ICE_RESTART")){var l;if(ye(l=r._restartStates).call(l,d)){if(r._isStartRestartIce)return;r._isStartRestartIce=!0;const h=_=>{("disconnected"===i.iceConnectionState||"checking"===i.iceConnectionState||"failed"===i.iceConnectionState)&&(I.debug("[".concat(r.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(_)),"CONNECTED"===Pr(r,Oe.QueryClientConnectionState)&&r.emit(Oe.RequestRestartICE,_))},p=()=>{"disconnected"!==i.iceConnectionState&&"checking"!==i.iceConnectionState&&"failed"!==i.iceConnectionState||(r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),I.debug("[".concat(r.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>r.emit(Oe.P2PLost),0),r.iceFailedCount+=1,r.requestReconnect())},m=V("ICE_RESTART_INTERVAL");return void(r._restartTimer=window.setTimeout(()=>{if(V("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ot().supportPCSetConfiguration)h(Mi.RELAY),r._restartTimer=window.setTimeout(p,m);else if(Pt())h(Mi.UDP),r._restartTimer=window.setTimeout(p,4e3);else{if(h(Mi.TCP),Ot().supportPCSetConfiguration)return void(r._restartTimer=window.setTimeout(()=>{h(Mi.RELAY),r._restartTimer=window.setTimeout(p,m)},m));r._restartTimer=window.setTimeout(p,m)}},800))}}else{if("disconnected"===d&&"disconnected"===i.iceConnectionState)return setTimeout(()=>{"disconnected"===i.iceConnectionState&&V("ICE_RESTART")&&"CONNECTED"===Pr(r,Oe.QueryClientConnectionState)&&r.emit(Oe.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===i.peerConnectionState&&(I.debug("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),r._isInRestartIce=!1,setTimeout(()=>r.emit(Oe.P2PLost),0),r.iceFailedCount+=1,r.requestReconnect())},4e3);"failed"===d&&(I.debug("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection state failed, force reconnect")),r.reportPCDisconnectedOrFailed(),setTimeout(()=>r.emit(Oe.P2PLost),0),r.iceFailedCount+=1,yield r.requestReconnect())}});return function(d){return a.apply(this,arguments)}}(),i.onICEConnectionStateChange=a=>{"connected"!==a||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(a,")")),Ie.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:a,tag:qt.TRACER}).onSuccess(),this.emit(Oe.IceConnectionStateChange,a)},i.onICETransportStateChange=a=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(a,")"))},i.onDTLSTransportStateChange=a=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(a,")"))},i.onDTLSTransportError=a=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(a,")"))},i.onFirstAudioDecoded=a=>{var d;const l=Array.from(ir(d=this.remoteUserMap).call(d)).find(p=>p._audioSSRC===a);var h;l&&(this.store.subscribe(l.uid,"audio",void 0,void 0,void 0,Date.now()),null===(h=l.audioTrack)||void 0===h||h.emit(uu.FIRST_FRAME_DECODED),Ie.firstRemoteFrame(this.store.sessionId,ni.FIRST_AUDIO_DECODE,Gt.FIRST_AUDIO_DECODE,{peer:l._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId}))},i.onFirstAudioReceived=a=>{var d;const l=Array.from(ir(d=this.remoteUserMap).call(d)).find(h=>h._audioSSRC===a);l&&Ie.firstRemoteFrame(this.store.sessionId,ni.FIRST_AUDIO_RECEIVED,Gt.FIRST_AUDIO_RECEIVED,{peer:l._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},i.onFirstVideoDecoded=(a,d,l)=>{this.reportVideoFirstFrameDecoded(a,d,l)},i.onFirstVideoReceived=a=>{var d;const l=Array.from(ir(d=this.remoteUserMap).call(d)).find(h=>h._videoSSRC===a);l&&Ie.firstRemoteFrame(this.store.sessionId,ni.FIRST_VIDEO_RECEIVED,Gt.FIRST_VIDEO_RECEIVED,{peer:l._uintid,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,a),subscribeRequestid:a,p2pid:this.store.p2pId})},i.onSelectedLocalCandidateChanged=(a,d)=>{const l="relay"===a.candidateType;"unknown"!==d.candidateType&&l===("relay"===d.candidateType)||this.emit(Oe.ConnectionTypeChange,l),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Vc(d))," -> ").concat(JSON.stringify(Vc(a)),")"))},i.onSelectedRemoteCandidateChanged=(a,d)=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Vc(d))," -> ").concat(JSON.stringify(Vc(a)),")"))},i.onFirstVideoDecodedTimeout=a=>{this.reportVideoFirstFrameDecoded(a,void 0,void 0,!0)}}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(i){const r=[];if(-1===this.getAllTracks().indexOf(i))return r;const a=this.localTrackMap.get(re.LocalAudioTrack);if(i instanceof vt&&a?.track instanceof jn)return a.track.isActive||r.push([re.LocalAudioTrack,a]),r;const d=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:h}]=l;return i===h});if(d&&(r.push(d),d[0]===re.LocalVideoTrack)){const l=this.localTrackMap.get(re.LocalVideoLowTrack);l&&r.push([re.LocalVideoLowTrack,l])}return r}filterTobeUnmutedTracks(i){const r=[],a=this.localTrackMap.get(re.LocalAudioTrack);if(i instanceof vt&&a?.track instanceof jn)return a.track.isActive&&r.push([re.LocalAudioTrack,a]),r;const d=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:h}]=l;return i===h});if(d)if(d[0]===re.LocalVideoTrack){r.push(d);const l=this.localTrackMap.get(re.LocalVideoLowTrack);l&&r.push([re.LocalVideoLowTrack,l])}else r.push(d);return r}createMuteMessage(i){return i.map(r=>{var a;let d,[l,{track:h,ssrcs:p,id:m}]=r;switch(l){case re.LocalAudioTrack:d=ut.Audio;break;case re.LocalVideoTrack:d=ye(a=h._hints).call(a,kt.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:d=ut.Low}return{stream_type:d,ssrcs:p,mid:m}})}createUnmuteMessage(i){return i.map(r=>{var a;let d,[l,{track:h,ssrcs:p,id:m}]=r;switch(l){case re.LocalAudioTrack:d=ut.Audio;break;case re.LocalVideoTrack:d=ye(a=h._hints).call(a,kt.SCREEN_TRACK)?ut.Screen:ut.High;break;case re.LocalVideoLowTrack:d=ut.Low}return{stream_type:d,ssrcs:p,mid:m}})}filterTobeUnSubscribedTracks(i,r){const a=[],d=this.remoteUserMap.get(i);if(!d)return a;if(r){const l=d.get(r);if(!l)return a;a.push([i,{kind:r,id:l}])}else Array.from(d.entries()).forEach(l=>{let[h,p]=l;a.push([i,{kind:h,id:p}])});return a}filterTobeUnSubscribedDataChannels(i,r){const a=[];return r.forEach(d=>{var l;null!==(l=this.remoteDataChannelMap.get(i))&&void 0!==l&&l.has(d.id)&&a.push(d)}),a}createUnsubscribeMessage(i){const r=[];return i.forEach(a=>{let[d,{kind:l}]=a;switch(l){case Ce.VIDEO:return void(d._videoSSRC&&r.push({stream_type:Ce.VIDEO,ssrcId:d._videoSSRC}));case Ce.AUDIO:return void(d._audioSSRC&&r.push({stream_type:Ce.AUDIO,ssrcId:d._audioSSRC}))}}),r}createUnsubscribeAllMessage(i){const r=new Map;return i.forEach(a=>{let[d,{kind:l}]=a;if(r.has(d)){let h=r.get(d);h|=l===Ce.VIDEO?Bn.Video:Bn.Audio,r.set(d,h)}else r.set(d,l===Ce.VIDEO?Bn.Video:Bn.Audio)}),{users:Array.from(r.entries()).map(a=>{let[d,l]=a;return{stream_id:d.uid,stream_type:l}})}}withdrawRemoteTracks(i){i.forEach(r=>{let[a,{kind:d}]=r;const l=this.remoteUserMap.get(a);l&&(l.delete(d),0===Array.from(l.entries()).length&&this.remoteUserMap.delete(a))})}updateBitrateLimit(i){var r=this;return L(function*(){const a=r.localTrackMap.get(re.LocalVideoTrack),d=r.localTrackMap.get(re.LocalVideoLowTrack);a&&(yield a.track.setBitrateLimit(i.uplink)),d&&i.low_stream_uplink&&(yield d.track.setBitrateLimit({max_bitrate:i.low_stream_uplink.bitrate,min_bitrate:i.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(i,r){return i.map((a,d)=>{var l;let{stream_type:h}=a;return null===(l=r.find(p=>{let{stream_type:m}=p;return h===m}))||void 0===l?void 0:l.attributes})}tryToUnmuteAudio(i){var r=this;return L(function*(){for(let d=0;d<i.length;d++)if(i[d]instanceof vt){var a;const l=r.filterTobeUnmutedTracks(i[d]);if(0===l.length)continue;yield null===(a=r.connection)||void 0===a?void 0:a.unmuteLocal(l.map(p=>{let[,{id:m}]=p;return m}));const h=r.createUnmuteMessage(l);return void(yield Tt(r,Oe.RequestUnmuteLocal,h))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=i=>{var r;return!(null===(r=this.connection)||void 0===r||!r.getRemoteVideoIsReady(i))},this.statsUploader.requestUpload=(i,r)=>this.emit(Oe.RequestUpload,i,r),this.statsUploader.requestUploadStats=i=>this.emit(Oe.RequestUploadStats,i),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var i=this;return L(function*(){i.dtlsFailedCount+=1,yield Un(GE(i.dtlsFailedCount,Pn)),i.emit(Oe.RequestReconnect)})()}reconnectP2P(){var i=this;return L(function*(){const r=Array.from(i.localTrackMap.entries()),a=i.createGatewayUnpublishMessage(r);Array.from(i.remoteUserMap.entries()),a.length>0&&(yield rn(i,Oe.RequestUnpublishForReconnectPC,a)),i.disconnectForReconnect(),i.emit(Oe.RequestReconnectPC)})()}canPublishLowStream(){return this.localTrackMap.has(re.LocalVideoTrack)||this.pendingLocalTracks.some(i=>i instanceof je)}throwIfTrackTypeNotMatch(i){if(i.filter(r=>r instanceof je).length>1)throw new ee(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i.filter(r=>r instanceof vt).length>1&&(i.some(r=>r instanceof vt&&r._bypassWebAudio)||!Ot().webAudioMediaStreamDest))throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of i){if(r instanceof je&&this.pendingLocalTracks.some(a=>a instanceof je))throw new ee(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof vt&&this.pendingLocalTracks.some(a=>a instanceof vt)&&(!Ot().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(a=>a instanceof vt&&a._bypassWebAudio)))throw new ee(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(i,r){const a=!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ot().supportDualStreamEncoding,d=tl(tl({},{width:160,height:120,framerate:15,bitrate:50}),r);let l;l=a?i._mediaStreamTrack.clone():Pp(i,d);const h=Ke(8,"track-low-"),p=new je(l,tl(tl({},a&&{scaleResolutionDownBy:vT(d,i)}),{},{frameRate:d.framerate,bitrateMax:d.bitrate,bitrateMin:d.bitrate}),void 0,void 0,h);return p.on(lu.TRANSCEIVER_UPDATED,m=>{i._updateRtpTransceiver(m,Bd.LOW_STREAM)}),p._hints.push(kt.LOW_STREAM),i.addListener(ve.NEED_CLOSE,()=>{p.close()}),p}globalLock(){var i=this;return L(function*(){return i.mutex.lock("From P2PChannel.globalLock")})()}reportPCStats(i,r,a){var d=arguments,l=this;return L(function*(){let h=d.length>3&&void 0!==d[3]?d[3]:null;if(l.connection&&l.connection instanceof Qt){var p,m,_,v;const b=l.store.keyMetrics.descriptionStart||0,{iceConnectionState:y,dtlsTransportState:T,peerConnectionState:M}=l.connection,{local:O,remote:D}=yield l.connection.getSelectedCandidatePair();Ie.pcStats(l.store.sessionId,{startTime:b,eventElapse:i-b||0,iceconnectionsate:y,dtlsstate:T,connectionstate:M,intSucc:r?1:2,error:h,selectedLocalCandidateProtocol:null!==(p=O?.protocol)&&void 0!==p?p:"",selectedLocalCandidateType:null!==(m=O.candidateType)&&void 0!==m?m:"",selectedLocalCandidateAddress:"".concat(O.address,":").concat(O.port),selectedRemoteCandidateProtocol:null!==(_=D.protocol)&&void 0!==_?_:"",selectedRemoteCandidateType:null!==(v=D.candidateType)&&void 0!==v?v:"",selectedRemoteCandidateAddress:"".concat(D.address,":").concat(D.port),restartCnt:a})}})()}reportVideoFirstFrameDecoded(i,r,a,d){var l;const h=Array.from(ir(l=this.remoteUserMap).call(l)).find(p=>p._videoSSRC===i);if(h){d||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const p=this.store.keyMetrics,m=p.subscribe.find(_=>_.userId===h.uid&&"video"===_.type);Ie.firstRemoteVideoDecode(this.store.sessionId,ni.FIRST_VIDEO_DECODE,Gt.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:r,videoheight:a,subscribeElapse:Li.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId,apEnd:p.requestAPEnd||0,apStart:p.requestAPStart||0,joinGwEnd:p.joinGatewayEnd||0,joinGwStart:p.joinGatewayStart||0,pcEnd:p.peerConnectionEnd||0,pcStart:p.peerConnectionStart||0,subscriberEnd:m?.subscribeEnd||0,subscriberStart:m?.subscribeStart||0,videoAddNotify:m?.streamAdded||0,state:d?1:0})}}remoteMediaSsrcChanged(i,r,a){var d=this;return L(function*(){if(!d.connection)return!1;const l=d.remoteUserMap.get(i);if(!l)return!1;const h=l.get(r);if(!h)return!1;const p=yield d.connection.getRemoteSSRC(h);return void 0!==p&&p!==a})()}resetConnection(i){I.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(i)),this.state===Dt.Connected?(I.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=i===ym.datachannel?new Gn({},this.store):this.isPlanB?new pi({},this.store):new Qt({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:a}]=i;r===re.LocalVideoLowTrack?a._updateRtpTransceiver(void 0,Bd.LOW_STREAM):a._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(i){this.connection&&this.connection instanceof Qt&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this.reportPCStats(Date.now(),!1,this._pcStatsUploadType===Bs.TCP_RESTART&&i===Mi.RELAY?this._pcStatsUploadType:Bs.DISCONNECTED_OR_FAILED)))}}function Wi(s,i,r){const a=s[i];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return r.value=L(function*(){const d=this.mutex,l=yield d.lock("From P2PChannel.".concat(i));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{l()}}),r}function SP(s){let i={};e:for(;!wP(s);){let r=Qa(s);switch(r>>>3){case 0:break e;case 1:i.requestId=j0(s,Qa(s));break;case 2:i.requestType=Qa(s)>>>0;break;case 3:i.scorePorn=Ts(s);break;case 4:i.scoreSexy=Ts(s);break;case 5:i.scoreNeutral=Ts(s);break;case 6:i.requestScene=Qa(s)>>>0;break;case 7:i.scene=Qa(s)>>>0;break;default:U0(s,7&r)}}return i}function wF(s,i){let r=s.service;void 0!==r&&(wt(i,8),wt(i,r));let a=s.vendor;void 0!==a&&(wt(i,16),wt(i,a));let d=s.token;void 0!==d&&(wt(i,26),Ja(i,d));let l=s.callbackUrl;void 0!==l&&(wt(i,34),Ja(i,l))}function TP(s){let i=Qa(s),r=s.limit;return s.limit=s.offset+i,r}function U0(s,i){switch(i){case 0:for(;128&H0(s););break;case 2:B0(s,Qa(s));break;case 5:B0(s,4);break;case 1:B0(s,8);break;default:throw new Error("Unimplemented type: "+i)}}ne([Wi,N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",X)],ai.prototype,"startP2PConnection",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",X)],ai.prototype,"connect",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",void 0)],ai.prototype,"updateRemoteRTPCapabilities",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",X)],ai.prototype,"preConnect",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],ai.prototype,"publishDataChannel",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],ai.prototype,"unpublish",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],ai.prototype,"unpublishDataChannel",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],ai.prototype,"unpublishLowStream",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Ii,Array]),N("design:returntype",X)],ai.prototype,"subscribeDataChannel",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Ii,String,Number,Number,Array]),N("design:returntype",X)],ai.prototype,"subscribe",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],ai.prototype,"massSubscribe",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Ii,String,Boolean]),N("design:returntype",X)],ai.prototype,"unsubscribe",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Ii,Array]),N("design:returntype",X)],ai.prototype,"unsubscribeDataChannel",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],ai.prototype,"massUnsubscribe",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Ii,String]),N("design:returntype",X)],ai.prototype,"muteRemote",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Ii,String]),N("design:returntype",X)],ai.prototype,"unmuteRemote",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Ii,String]),N("design:returntype",X)],ai.prototype,"hasRemoteMediaWithLock",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],ai.prototype,"disconnectForReconnect",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],ai.prototype,"updateBitrateLimit",null),ne([Wi,N("design:type",Function),N("design:paramtypes",[Ii,String,Number]),N("design:returntype",X)],ai.prototype,"remoteMediaSsrcChanged",null);let CB=new Float32Array(1);new Uint8Array(CB.buffer);let Ou=new Float64Array(1),Zr=new Uint8Array(Ou.buffer);function Nu(s){return{low:s|=0,high:s>>31,unsigned:s>=0}}let IP=[];function ub(){const s=IP.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}function V0(s){IP.push(s)}function B0(s,i){if(s.offset+i>s.limit)throw new Error("Skip past limit");s.offset+=i}function wP(s){return s.offset>=s.limit}function fg(s,i){let r=s.bytes,a=s.offset,d=s.limit,l=a+i;if(l>r.length){let h=new Uint8Array(2*l);h.set(r),s.bytes=h}return s.offset=l,l>d&&(s.limit=l),a}function RP(s,i){let r=s.offset;if(r+i>s.limit)throw new Error("Read past limit");return s.offset+=i,r}function j0(s,i){let r=RP(s,i),a=String.fromCharCode,d=s.bytes,l="\ufffd",h="";for(let p=0;p<i;p++){let m,_,v,b,y=d[p+r];128&y?192==(224&y)?p+1>=i?h+=l:(m=d[p+r+1],128!=(192&m)?h+=l:(b=(31&y)<<6|63&m,b<128?h+=l:(h+=a(b),p++))):224==(240&y)?p+2>=i?h+=l:(m=d[p+r+1],_=d[p+r+2],32896!=(49344&(m|_<<8))?h+=l:(b=(15&y)<<12|(63&m)<<6|63&_,b<2048||b>=55296&&b<=57343?h+=l:(h+=a(b),p+=2))):240==(248&y)?p+3>=i?h+=l:(m=d[p+r+1],_=d[p+r+2],v=d[p+r+3],8421504!=(12632256&(m|_<<8|v<<16))?h+=l:(b=(7&y)<<18|(63&m)<<12|(63&_)<<6|63&v,b<65536||b>1114111?h+=l:(b-=65536,h+=a(55296+(b>>10),56320+(1023&b)),p+=3))):h+=l:h+=a(y)}return h}function Ja(s,i){let r=i.length,a=0;for(let h=0;h<r;h++){let p=i.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+i.charCodeAt(++h)-56613888),a+=p<128?1:p<2048?2:p<65536?3:4}wt(s,a);let d=fg(s,a),l=s.bytes;for(let h=0;h<r;h++){let p=i.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+i.charCodeAt(++h)-56613888),p<128?l[d++]=p:(p<2048?l[d++]=p>>6&31|192:(p<65536?l[d++]=p>>12&15|224:(l[d++]=p>>18&7|240,l[d++]=p>>12&63|128),l[d++]=p>>6&63|128),l[d++]=63&p|128)}}function RF(s,i){let r=fg(s,i.limit),a=s.bytes,d=i.bytes;for(let l=0,h=i.limit;l<h;l++)a[l+r]=d[l]}function H0(s){return s.bytes[RP(s,1)]}function AF(s,i){let r=fg(s,1);s.bytes[r]=i}function Ts(s){let i=RP(s,8),r=s.bytes;return Zr[0]=r[i++],Zr[1]=r[i++],Zr[2]=r[i++],Zr[3]=r[i++],Zr[4]=r[i++],Zr[5]=r[i++],Zr[6]=r[i++],Zr[7]=r[i++],Ou[0]}function G0(s,i){let r=fg(s,8),a=s.bytes;Ou[0]=i,a[r++]=Zr[0],a[r++]=Zr[1],a[r++]=Zr[2],a[r++]=Zr[3],a[r++]=Zr[4],a[r++]=Zr[5],a[r++]=Zr[6],a[r++]=Zr[7]}function Qa(s){let i,r=0,a=0;do{i=H0(s),r<32&&(a|=(127&i)<<r),r+=7}while(128&i);return a}function wt(s,i){for(i>>>=0;i>=128;)AF(s,127&i|128),i>>>=7;AF(s,i)}function nl(s,i){let r=i.low>>>0,a=(i.low>>>28|i.high<<4)>>>0,d=i.high>>>24,l=0===d?0===a?r<16384?r<128?1:2:r<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:d<128?9:10,h=fg(s,l),p=s.bytes;switch(l){case 10:p[h+9]=d>>>7&1;case 9:p[h+8]=9!==l?128|d:127&d;case 8:p[h+7]=8!==l?a>>>21|128:a>>>21&127;case 7:p[h+6]=7!==l?a>>>14|128:a>>>14&127;case 6:p[h+5]=6!==l?a>>>7|128:a>>>7&127;case 5:p[h+4]=5!==l?128|a:127&a;case 4:p[h+3]=4!==l?r>>>21|128:r>>>21&127;case 3:p[h+2]=3!==l?r>>>14|128:r>>>14&127;case 2:p[h+1]=2!==l?r>>>7|128:r>>>7&127;case 1:p[h]=1!==l?128|r:127&r}}function hb(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}const DF=new Map([["moderation",1],["supervise",2]]);class pb extends jt{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const r=this._connectionState;this._connectionState=i,this.emit(ii.CONNECTION_STATE_CHANGE,r,i)}get inspectType(){return this._inspectType}set inspectType(i){var r;this._inspectMode=Va(r=i.map(a=>DF.get(a)||0)).call(r,(a,d)=>a+d),this._inspectType=i}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(i){super(),S(this,"name","AgoraRTCVideoContentInspect"),S(this,"_connectionState",Oo.CONNECTING),S(this,"_innerConnectionState",void 0),S(this,"sequence",0),S(this,"inspectStartTime",void 0),S(this,"workerManagerConnection",void 0),S(this,"workerConnection",void 0),S(this,"workerMessageLengthLimit",void 0),S(this,"inspectIntervalMinimum",void 0),S(this,"qualityRatio",void 0),S(this,"_connectInfo",void 0),S(this,"_cancelTokenSource",Ze.CancelToken.source()),S(this,"_retryConfig",void 0),S(this,"wmSequence",0),S(this,"inspectInterval",void 0),S(this,"inspectTimer",null),S(this,"ossFilePrefix",void 0),S(this,"extraInfo",void 0),S(this,"_inspectType",void 0),S(this,"_inspectMode",void 0),S(this,"_quality",1),S(this,"qualityTimer",null),S(this,"_inspectId",void 0),S(this,"_needWorkUrlOnly",!1),S(this,"inspectImage",()=>{if(this.connectionState!==Oo.CONNECTED)throw new W(k.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Oo.CONNECTED?this.requestToInspectImage():I.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Ke(5,"inspect-"),this.workerMessageLengthLimit=V("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=V("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=V("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=i.interval,this.ossFilePrefix=i.ossFilePrefix,this.extraInfo=i.extraInfo,this.inspectType=i.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Rm("worker-manager-"+this._inspectId,Pn),this.on(ii.STATE_CHANGE,(r,a)=>{this._innerConnectionState=r,I.debug("[".concat(this._inspectId,"] Inspect operation :").concat(No[r]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Rm("worker-"+this._inspectId,Pn),this.handleWorkerEvents()}init(i,r){var a=this;return L(function*(){a.emit(ii.STATE_CHANGE,No.CONNECT_AP),a._connectInfo=i;const d=a._cancelTokenSource.token;return a._retryConfig=r,new X((l,h)=>{a.on(ii.CONNECTION_STATE_CHANGE,(p,m)=>{m===Oo.CONNECTED&&l()}),a.requestAP(i,d,r).then(p=>{a.connectWorkerManager(p)}).catch(p=>{h(p)})})})()}requestAP(i,r,a){var d=this;return L(function*(){const l=V("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),h=yield function(m,_,v,b){let{appId:y,areaCode:T,cname:M,sid:O,token:D,uid:x}=_;ou++;const F="image_moderation_api",j={service_name:F,json_body:JSON.stringify({appId:y,areaCode:T,cname:M,command:"allocateEdge",requestId:ou,seq:ou,sid:O,token:D,ts:Date.now(),uid:x+""})};let q,te,K=m[0];return In(L(function*(){q=Date.now();const Q=yield Ha(K,{data:j,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(te=Date.now()-q,0!==Q.code){const me=new W(k.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Q.code,{retry:!0,responseTime:te});throw I.error(me.toString()),me}const $=JSON.parse(Q.json_body);if(200!==$.code){const me=new W(k.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat($.code,", reason: ").concat($.reason),{code:$.code,responseTime:te});throw I.error(me.toString()),me}if(!$.servers||!Array.isArray($.servers)||0===$.servers.length){const me=new W(k.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:$.code,responseTime:te});throw I.error(me.toString()),me}const z=V("VIDEO_INSPECT_WORKER_MANAGER_HOST"),_e=V("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:$.servers.map(me=>{let{address:Fe,wss:rt}=me;if(Fe&&rt)return"wss://".concat(Fe.replace(/\./g,"-"),".").concat(z,":").concat(_e||rt)}).filter(me=>!!me),workerToken:$.workerToken,vid:$.vid,responseTime:te}}),(Q,$)=>(Ie.apworkerEvent(O,{success:!0,sc:200,serviceName:F,responseDetail:JSON.stringify(Q.addressList),firstSuccess:0===$,responseTime:te,serverIp:m[$%m.length]}),!1),(Q,$)=>(Ie.apworkerEvent(O,{success:!1,sc:Q.data&&Q.data.code||200,serviceName:F,responseTime:te,serverIp:m[$%m.length]}),!!(Q.code!==k.OPERATION_ABORTED&&Q.code!==k.UNEXPECTED_RESPONSE||Q.data&&Q.data.retry)&&(K=m[($+1)%m.length],!0)),b)}(l,i,r,a);d.emit(ii.STATE_CHANGE,No.AP_CONNECTED);const{addressList:p}=h;return d.wmSequence++,p})()}connectWorkerManager(i){var r=arguments,a=this;return L(function*(){a._needWorkUrlOnly=r.length>1&&void 0!==r[1]&&r[1],a.emit(ii.STATE_CHANGE,No.CONNECT_WORKER_MANAGER),yield a.workerManagerConnection.init(i,1e4)})()}connectWorker(i){var r=this;return L(function*(){yield r.workerConnection.init([i])})()}handleWorkerManagerEvents(){var i=this;this.workerManagerConnection.on(Me.CONNECTED,L(function*(){i.emit(ii.STATE_CHANGE,No.WORKER_MANAGER_CONNECTED,i.workerManagerConnection.url),i.workerManagerConnection.sendMessage({appId:i._connectInfo.appId,cname:i._connectInfo.cname,uid:i._connectInfo.uid+"",sdkVersion:"4.20.0",sid:i._connectInfo.sid,seq:i.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(Me.CLOSED,()=>{this._innerConnectionState<No.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Me.FAILED,()=>{this._innerConnectionState<No.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Me.RECONNECTING,()=>{this._innerConnectionState<No.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Me.ON_MESSAGE,function(){var r=L(function*(a){i.emit(ii.STATE_CHANGE,No.GET_WORKER_MANAGER_RESPONSE);const d=i.workerManagerConnection.url;i.workerManagerConnection.close();const l=JSON.parse(a.data);if(200!==l.code)throw I.error("[".concat(i._inspectId,"] Unexpected code ").concat(l.code," from worker manager")),new W(k.UNEXPECTED_RESPONSE,"response code of worker is unexpected",l);if(!(l.serverResponse&&l.serverResponse.portWss&&d))throw I.error("[".concat(i._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(l))),new W(k.UNEXPECTED_RESPONSE,"response content of worker is unexpected",l);{const h=V("VIDEO_INSPECT_WORKER_PORT")||l.serverResponse.portWss,p=d.replace(/:\d+\/?$/,":".concat(h));i.emit(ii.STATE_CHANGE,No.CONNECT_WORKER,p),i._needWorkUrlOnly?i.emit(ii.REQUEST_NEW_WORKER_URL,p):yield i.connectWorker(p)}});return function(a){return r.apply(this,arguments)}}()),this.workerManagerConnection.on(Me.WILL_RECONNECT,(r,a,d)=>{d(r)}),this.workerManagerConnection.on(Me.REQUEST_NEW_URLS,(r,a)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(a)})}handleWorkerEvents(){var i=this;this.workerConnection.on(Me.CONNECTED,L(function*(){i.emit(ii.STATE_CHANGE,No.WORKER_CONNECTED,i.workerConnection.url),i.connectionState=Oo.CONNECTED})),this.workerConnection.on(Me.ON_MESSAGE,function(){var r=L(function*(a){if(a.data instanceof ArrayBuffer){const l=function IF(s){return function(r){let a={};e:for(;!wP(r);){let d=Qa(r);switch(d>>>3){case 0:break e;case 1:a.code=Qa(r);break;case 2:a.msg=j0(r,Qa(r));break;case 3:{let l=TP(r);a.data=SP(r),r.limit=l;break}default:U0(r,7&d)}}return a}({bytes:i=s,offset:0,limit:i.length});var i}(new Uint8Array(a.data));if(V("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&I.debug("[".concat(i._inspectId,"] Response message for worker of inspect content "),JSON.stringify(l)),200===l.code){if(Array.isArray(i.inspectType)&&1===i.inspectType.length&&"supervise"===i.inspectType[0])return void i.emit(ii.INSPECT_RESULT,void 0,void 0);if(l.data&&l.data.scorePorn&&l.data.scoreSexy&&l.data.scoreNeutral){var d;const h={porn:l.data.scorePorn,sexy:l.data.scoreSexy,neutral:l.data.scoreNeutral},p=Va(d=Object.keys(h)).call(d,(_,v)=>h[_]>h[v]?_:v,"porn"),m=Object.keys(h).find(_=>_===p);i.emit(ii.INSPECT_RESULT,m)}else i.emit(ii.INSPECT_RESULT,void 0,new W(k.UNEXPECTED_RESPONSE,l.code+"","There is an unexpected data on message"))}else i.emit(ii.INSPECT_RESULT,void 0,new W(k.UNEXPECTED_RESPONSE,l.code+"",l.msg))}else I.error("[".concat(i._inspectId,"] Unexpected message type from worker")),i.emit(ii.INSPECT_RESULT,void 0,new W(k.UNEXPECTED_RESPONSE,"invalid worker message type"))});return function(a){return r.apply(this,arguments)}}()),this.workerConnection.on(Me.CLOSED,()=>{this.connectionState=Oo.CLOSED}),this.workerConnection.on(Me.FAILED,()=>{this.connectionState=Oo.CLOSED}),this.workerConnection.on(Me.RECONNECTING,()=>{this.connectionState=this.connectionState===Oo.CONNECTED?Oo.RECONNECTING:Oo.CONNECTING}),this.workerConnection.on(Me.WILL_RECONNECT,(r,a,d)=>{"recover"===r&&d(r),d("tryNext")}),this.workerConnection.on(Me.REQUEST_NEW_URLS,(r,a)=>{this.workerManagerConnection.close(),this.once(ii.REQUEST_NEW_WORKER_URL,d=>{r([d])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(d=>{this.connectWorkerManager(d,!0)}).catch(d=>{a(d)})})}static intToLong(i){return{low:i|=0,high:i>>31,unsigned:i>=0}}requestToInspectImage(){var i=this;return L(function*(){i.sequence++;const r=Pr(i,ii.CLIENT_LOCAL_VIDEO_TRACK),a={appId:i._connectInfo.appId,cname:i._connectInfo.cname,cid:i._connectInfo.cid,sid:i._connectInfo.sid,uid:i._connectInfo.uid,vid:i._connectInfo.vid};if(r){if(!r.isPlaying)return void i.emit(ii.INSPECT_RESULT,void 0,new W(k.INVALID_OPERATION,"Only the track being played can be inspected"));const d=yield i.generateRequestData(r,a);i.workerConnection.sendMessage(d,!0,!0)}else i.emit(ii.INSPECT_RESULT,void 0,new W(k.INVALID_OPERATION,"Only the track being published can be inspected"))})()}generateRequestData(i,r){var a=this;return L(function*(){let{appId:d,cname:l,cid:h,vid:p,sid:m,uid:_}=r;const v=Date.now(),b=yield i.getCurrentFrameImage("image/jpeg",a.quality),y=yield m2(b,d,l),T=a.sequence+"-"+h+"-"+_+"-"+v+"-"+Ke(12,""),M={appId:d,cid:h,cname:l,deviceId:"",elapse:pb.intToLong(Number(v-a.inspectStartTime)),fileSize:y.byteLength,jpgEncryption:2,height:b.height,width:b.width,jpg:y,networkType:6,osType:7,requestId:T,sdkVersion:"4.20.0",sequence:a.sequence,sid:m,timestamp:pb.intToLong(v),uid:_,vid:p,service:a._inspectMode,callbackData:a.extraInfo,ossFilePrefix:a.ossFilePrefix};void 0===a.extraInfo&&delete M.callbackData,void 0===a.ossFilePrefix&&delete M.ossFilePrefix;const O=function F0(s){let i=ub();return function(r,a){let d=r.appId;void 0!==d&&(wt(a,10),Ja(a,d));let l=r.cid;void 0!==l&&(wt(a,16),wt(a,l));let h=r.cname;void 0!==h&&(wt(a,26),Ja(a,h));let p=r.deviceId;void 0!==p&&(wt(a,34),Ja(a,p));let m=r.elapse;void 0!==m&&(wt(a,40),nl(a,m));let _=r.fileSize;void 0!==_&&(wt(a,48),nl(a,Nu(_)));let v=r.height;void 0!==v&&(wt(a,56),nl(a,Nu(v)));let b=r.jpg;void 0!==b&&(wt(a,66),wt(a,b.length),function(Fi,ie){let ue=fg(Fi,ie.length);Fi.bytes.set(ie,ue)}(a,b));let y=r.networkType;void 0!==y&&(wt(a,72),nl(a,Nu(y)));let T=r.osType;void 0!==T&&(wt(a,80),nl(a,Nu(T)));let M=r.requestId;void 0!==M&&(wt(a,90),Ja(a,M));let O=r.sdkVersion;void 0!==O&&(wt(a,98),Ja(a,O));let D=r.sequence;void 0!==D&&(wt(a,104),nl(a,Nu(D)));let x=r.sid;void 0!==x&&(wt(a,114),Ja(a,x));let F=r.timestamp;void 0!==F&&(wt(a,120),nl(a,F));let j=r.uid;void 0!==j&&(wt(a,128),wt(a,j));let q=r.vid;void 0!==q&&(wt(a,136),wt(a,q));let te=r.width;void 0!==te&&(wt(a,144),nl(a,Nu(te)));let K=r.service;void 0!==K&&(wt(a,152),wt(a,K));let Q=r.callbackData;void 0!==Q&&(wt(a,162),Ja(a,Q));let $=r.jpgEncryption;void 0!==$&&(wt(a,168),wt(a,$));let z=r.requestType;void 0!==z&&(wt(a,176),wt(a,z));let _e=r.scorePorn;void 0!==_e&&(wt(a,185),G0(a,_e));let me=r.scoreSexy;void 0!==me&&(wt(a,193),G0(a,me));let Fe=r.scoreNeutral;void 0!==Fe&&(wt(a,201),G0(a,Fe));let rt=r.scene;void 0!==rt&&(wt(a,208),wt(a,rt));let ci=r.ossFilePrefix;void 0!==ci&&(wt(a,218),Ja(a,ci));let Zt=r.serviceVendor;if(void 0!==Zt)for(let Fi of Zt){wt(a,226);let ie=ub();wF(Fi,ie),wt(a,ie.limit),RF(a,ie),V0(ie)}}(s,i),function(r){let a=r.bytes,d=r.limit;return a.length===d?a:a.subarray(0,d)}(i)}(M);if(O.byteLength<a.workerMessageLengthLimit){if(V("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const D=function(x){for(var F=1;F<arguments.length;F++){var j=null!=arguments[F]?arguments[F]:{};F%2?hb(Object(j),!0).forEach(function(q){S(x,q,j[q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(j)):hb(Object(j)).forEach(function(q){Object.defineProperty(x,q,Object.getOwnPropertyDescriptor(j,q))})}return x}({},M);delete D.jpg,I.debug("[".concat(a._inspectId,"] Request message for worker of inspect content "),JSON.stringify(D))}return O}return a.quality=a.quality*a.qualityRatio,yield a.generateRequestData(i,{appId:d,cname:l,cid:h,vid:p,sid:m,uid:_})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ze.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Oo.CLOSED,this.emit(ii.STATE_CHANGE,No.CLOSED)}}function PF(s,i){switch(i){case 0:for(;128&Is(s););break;case 2:W0(s,mg(s));break;case 5:W0(s,4);break;case 1:W0(s,8);break;default:throw new Error("Unimplemented type: "+i)}}function Mp(s){return{low:s|=0,high:s>>31,unsigned:s>=0}}let MF=[];function W0(s,i){if(s.offset+i>s.limit)throw new Error("Skip past limit");s.offset+=i}function xF(s){return s.offset>=s.limit}function fb(s,i){let r=s.bytes,a=s.offset,d=s.limit,l=a+i;if(l>r.length){let h=new Uint8Array(2*l);h.set(r),s.bytes=h}return s.offset=l,l>d&&(s.limit=l),a}function AP(s,i){let r=s.offset;if(r+i>s.limit)throw new Error("Read past limit");return s.offset+=i,r}function DP(s,i){let r=fb(s,i.length);s.bytes.set(i,r)}function OP(s,i){let r=AP(s,i),a=String.fromCharCode,d=s.bytes,l="\ufffd",h="";for(let p=0;p<i;p++){let m,_,v,b,y=d[p+r];128&y?192==(224&y)?p+1>=i?h+=l:(m=d[p+r+1],128!=(192&m)?h+=l:(b=(31&y)<<6|63&m,b<128?h+=l:(h+=a(b),p++))):224==(240&y)?p+2>=i?h+=l:(m=d[p+r+1],_=d[p+r+2],32896!=(49344&(m|_<<8))?h+=l:(b=(15&y)<<12|(63&m)<<6|63&_,b<2048||b>=55296&&b<=57343?h+=l:(h+=a(b),p+=2))):240==(248&y)?p+3>=i?h+=l:(m=d[p+r+1],_=d[p+r+2],v=d[p+r+3],8421504!=(12632256&(m|_<<8|v<<16))?h+=l:(b=(7&y)<<18|(63&m)<<12|(63&_)<<6|63&v,b<65536||b>1114111?h+=l:(b-=65536,h+=a(55296+(b>>10),56320+(1023&b)),p+=3))):h+=l:h+=a(y)}return h}function il(s,i){let r=i.length,a=0;for(let h=0;h<r;h++){let p=i.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+i.charCodeAt(++h)-56613888),a+=p<128?1:p<2048?2:p<65536?3:4}xn(s,a);let d=fb(s,a),l=s.bytes;for(let h=0;h<r;h++){let p=i.charCodeAt(h);p>=55296&&p<=56319&&h+1<r&&(p=(p<<10)+i.charCodeAt(++h)-56613888),p<128?l[d++]=p:(p<2048?l[d++]=p>>6&31|192:(p<65536?l[d++]=p>>12&15|224:(l[d++]=p>>18&7|240,l[d++]=p>>12&63|128),l[d++]=p>>6&63|128),l[d++]=63&p|128)}}function Is(s){return s.bytes[AP(s,1)]}function NP(s,i){let r=fb(s,1);s.bytes[r]=i}function mg(s){let i,r=0,a=0;do{i=Is(s),r<32&&(a|=(127&i)<<r),r+=7}while(128&i);return a}function xn(s,i){for(i>>>=0;i>=128;)NP(s,127&i|128),i>>>=7;NP(s,i)}function z0(s,i){let r,a=0,d=0,l=0;return r=Is(s),a=127&r,128&r&&(r=Is(s),a|=(127&r)<<7,128&r&&(r=Is(s),a|=(127&r)<<14,128&r&&(r=Is(s),a|=(127&r)<<21,128&r&&(r=Is(s),d=127&r,128&r&&(r=Is(s),d|=(127&r)<<7,128&r&&(r=Is(s),d|=(127&r)<<14,128&r&&(r=Is(s),d|=(127&r)<<21,128&r&&(r=Is(s),l=127&r,128&r&&(r=Is(s),l|=(127&r)<<7))))))))),{low:a|d<<28,high:d>>>4|l<<24,unsigned:i}}function Za(s,i){let r=i.low>>>0,a=(i.low>>>28|i.high<<4)>>>0,d=i.high>>>24,l=0===d?0===a?r<16384?r<128?1:2:r<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:d<128?9:10,h=fb(s,l),p=s.bytes;switch(l){case 10:p[h+9]=d>>>7&1;case 9:p[h+8]=9!==l?128|d:127&d;case 8:p[h+7]=8!==l?a>>>21|128:a>>>21&127;case 7:p[h+6]=7!==l?a>>>14|128:a>>>14&127;case 6:p[h+5]=6!==l?a>>>7|128:a>>>7&127;case 5:p[h+4]=5!==l?128|a:127&a;case 4:p[h+3]=4!==l?r>>>21|128:r>>>21&127;case 3:p[h+2]=3!==l?r>>>14|128:r>>>14&127;case 2:p[h+1]=2!==l?r>>>7|128:r>>>7&127;case 1:p[h]=1!==l?128|r:127&r}}const kF={},LF={},Pu=4294967296,K0=Pu*Pu,PP=K0/2,q0=FF(0,!0),MP=FF(0),xP=gg(0,-2147483648,!1),kP=gg(-1,2147483647,!1),SB=gg(-1,-1,!0);function FF(s,i){let r,a,d;return i?(d=0<=(s>>>=0)&&s<256)&&(a=LF[s],a)?a:(r=gg(s,0,!0),d&&(LF[s]=r),r):(d=-128<=(s|=0)&&s<128)&&(a=kF[s],a)?a:(r=gg(s,s<0?-1:0,!1),d&&(kF[s]=r),r)}function gg(s,i,r){return{low:0|s,high:0|i,unsigned:!!r}}function UF(s,i){if(isNaN(s))return i?q0:MP;if(i){if(s<0)return q0;if(s>=K0)return SB}else{if(s<=-PP)return xP;if(s+1>=PP)return kP}return s<0?i?q0:MP:gg(s%Pu|0,s/Pu|0,i)}function LP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}class Y0 extends jt{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const r=this._connectionState;this._connectionState=i,this.emit(us.CONNECTION_STATE_CHANGE,i,r)}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(i){var r;super(),S(this,"name","AgoraRTCImageModeration"),S(this,"_connectionState",Kr.CONNECTING),S(this,"_sequence",0),S(this,"_moderationStartTime",void 0),S(this,"_workerConnection",void 0),S(this,"_workerMessageLengthLimit",void 0),S(this,"_qualityRatio",void 0),S(this,"_connectInfo",void 0),S(this,"_cancelTokenSource",Ze.CancelToken.source()),S(this,"_retryConfig",void 0),S(this,"_moderationInterval",void 0),S(this,"_moderationTimer",null),S(this,"_moderationMode",1),S(this,"_quality",1),S(this,"_qualityTimer",null),S(this,"_ticket",void 0),S(this,"_moderationIntervalMinimum",void 0),S(this,"_uploadFailedNum",0),S(this,"_uploadNum",0),S(this,"_uploadTimer",null),S(this,"_extraInfo",void 0),S(this,"_vendor",""),S(this,"_encoder",new TextEncoder),S(this,"_moderationId",void 0),S(this,"inspectImage",()=>{if(this.connectionState!==Kr.CONNECTED)throw new W(k.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Kr.CONNECTED?this.requestToInspectImage():I.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Ke(5,"image-moderation-"),this._workerMessageLengthLimit=V("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=V("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(r=i.interval)&&void 0!==r?r:1e3,i.extraInfo&&(this._extraInfo=this._encoder.encode(i.extraInfo)),i.vendor&&(this._vendor=i.vendor),this._qualityRatio=V("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Rm("worker-"+this._moderationId,Pn),this.on(us.STATE_CHANGE,(a,d)=>{I.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Ud[a]," ").concat(d||""))}),this.handleWorkerEvents()}init(i,r){var a=this;return L(function*(){a.emit(us.STATE_CHANGE,Ud.CONNECT_AP),a._connectInfo=i;const d=a._cancelTokenSource.token;return a._retryConfig=r,new X((l,h)=>{a.on(us.CONNECTION_STATE_CHANGE,(p,m)=>{p===Kr.CONNECTED&&l()}),a.requestAP(i,d,r).then(p=>{a.connectWorker(p)}).catch(p=>{h(p)})})})()}updateConfig(i){var r;this._moderationInterval=null!==(r=i.interval)&&void 0!==r?r:1e3,i.extraInfo&&(this._extraInfo=this._encoder.encode(i.extraInfo)),i.vendor&&(this._vendor=i.vendor),I.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(i))),this.connectionState===Kr.CONNECTED&&this.inspectImage()}requestAP(i,r,a){var d=this;return L(function*(){const l=V("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),h=yield function(_,v,b,y){let{appId:T,areaCode:M,cname:O,sid:D,token:x,uid:F}=v;ou++;const j="moderation_plugin",q={service_name:j,json_body:JSON.stringify({appId:T,areaCode:M,cname:O,command:"allocateEdge",requestId:ou,seq:ou,sid:D,appToken:x,ts:Date.now(),uid:F+""})};let te,K,Q=_[0];return In(L(function*(){te=Date.now();const $=yield Ha(Q,{data:q,cancelToken:b,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(K=Date.now()-te,0!==$.code){const me=new W(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+$.code,{retry:!0,responseTime:K});throw I.error(me.toString()),me}const z=JSON.parse($.json_body);if(200!==z.code){const me=new W(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(z.code,", reason: ").concat(z.reason),{code:z.code,responseTime:K});throw I.error(me.toString()),me}if(!z.servers||!Array.isArray(z.servers)||0===z.servers.length){const me=new W(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:z.code,responseTime:K});throw I.error(me.toString()),me}if(!z.servers.some(me=>!!me.wss)){const me=new W(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:z.code,responseTime:K});throw I.error(me.toString()),me}const _e=V("IMAGE_MODERATION_WORKER_HOST");return{addressList:z.servers.map(me=>{let{address:Fe,wss:rt}=me;if(Fe&&rt)return"wss://".concat(Fe.replace(/\./g,"-"),".").concat(_e,":").concat(rt,"/moderation")}).filter(me=>!!me),workerToken:z.workerToken,vid:z.vid,ticket:z.appTicket,responseTime:K}}),($,z)=>(Ie.apworkerEvent(D,{success:!0,sc:200,serviceName:j,responseDetail:JSON.stringify($.addressList),firstSuccess:0===z,responseTime:K,serverIp:_[z%_.length]}),!1),($,z)=>(Ie.apworkerEvent(D,{success:!1,sc:$.data&&$.data.code||200,serviceName:j,responseTime:K,serverIp:_[z%_.length]}),!!($.code!==k.OPERATION_ABORTED&&$.code!==k.UNEXPECTED_RESPONSE||$.data&&$.data.retry)&&(Q=_[(z+1)%_.length],!0)),y)}(l,i,r,a);d.emit(us.STATE_CHANGE,Ud.AP_CONNECTED);const{addressList:p,ticket:m}=h;return d._ticket=m,p})()}connectWorker(i){var r=this;return L(function*(){r.emit(us.STATE_CHANGE,Ud.CONNECT_WORKER),yield r._workerConnection.init(i,1e4)})()}handleWorkerEvents(){var i=this;this._workerConnection.on(Me.CONNECTED,L(function*(){i.emit(us.STATE_CHANGE,Ud.WORKER_CONNECTED,i._workerConnection.url),i.connectionState=Kr.CONNECTED})),this._workerConnection.on(Me.CLOSED,()=>{this.connectionState=Kr.CLOSED}),this._workerConnection.on(Me.FAILED,()=>{this.connectionState=Kr.CLOSED}),this._workerConnection.on(Me.RECONNECTING,()=>{this.connectionState=this.connectionState===Kr.CONNECTED?Kr.RECONNECTING:Kr.CONNECTING}),this._workerConnection.on(Me.ON_MESSAGE,function(){var r=L(function*(a){if(a.data instanceof ArrayBuffer){const d=function NF(s){return function(r){let a={};e:for(;!xF(r);){let d=mg(r);switch(d>>>3){case 0:break e;case 1:a.code=mg(r);break;case 2:a.msg=OP(r,mg(r));break;case 3:a.requestId=OP(r,mg(r));break;case 4:a.timestamp=z0(r,!1);break;default:PF(r,7&d)}}return a}({bytes:i=s,offset:0,limit:i.length});var i}(new Uint8Array(a.data));V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("[".concat(i._moderationId,"] Response message for worker of image moderation "),JSON.stringify(d)),i._uploadNum++,void 0===d.code||0===d.code||(i._uploadFailedNum++,I.error("[".concat(i._moderationId,"] Error response from worke, code is ").concat(d.code,", msg is ").concat(d.msg)),i._uploadTimer||(i._uploadTimer=window.setTimeout(()=>{Ie.reportApiInvoke(i._connectInfo.sid||null,{name:Kn.IMAGE_MODERATION_UPLOAD,options:[i._uploadFailedNum,i._uploadNum,d.code],tag:qt.TRACER}).onError(new W(k.IMAGE_MODERATION_UPLOAD_FAILED,d.msg)),i._uploadTimer=null},V("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else I.error("[".concat(i._moderationId,"] Unexpected message type from worker"))});return function(a){return r.apply(this,arguments)}}()),this._workerConnection.on(Me.WILL_RECONNECT,(r,a,d)=>{"recover"===r&&d(r),d("tryNext")}),this._workerConnection.on(Me.REQUEST_NEW_URLS,(r,a)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(a)})}static intToLong(i){return{low:i|=0,high:i>>31,unsigned:i>=0}}requestToInspectImage(){var i=this;return L(function*(){const r=Pr(i,us.CLIENT_LOCAL_VIDEO_TRACK),a={appId:i._connectInfo.appId,cname:i._connectInfo.cname,cid:i._connectInfo.cid,sid:i._connectInfo.sid,uid:i._connectInfo.uid,vid:i._connectInfo.vid};if(r){if(!r.isPlaying)return void(V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("Only the track being played can be inspected"));i._sequence++;const d=yield i.generateRequestData(r,a);i._workerConnection.sendMessage(d,!0,!0)}else V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("Only the track being published can be inspected")})()}generateRequestData(i,r){var a=this;return L(function*(){let{appId:d,cname:l,cid:h,vid:p,sid:m,uid:_}=r;const v=Date.now(),b=yield i.getCurrentFrameImage("image/jpeg",a.quality),y=yield m2(b,d,l),T=a._sequence+"-"+h+"-"+_+"-"+v+"-"+Ke(12,""),M={appId:d,cid:h,cname:l,deviceId:"",elapse:Y0.intToLong(Number(v-a._moderationStartTime)),fileSize:b.buffer.byteLength,height:b.height,width:b.width,jpg:y,networkType:6,osType:7,requestId:T,sdkVersion:"4.20.0",sequence:a._sequence,sid:m,timestamp:UF(v),uid:_,vid:p,service:a._moderationMode,ticket:a._ticket,callbackData:a._extraInfo,vendorConfigs:a._vendor};void 0===a._extraInfo&&delete M.callbackData;const O=function OF(s){let i=function(){const r=MF.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r,a){let d=r.appId;void 0!==d&&(xn(a,10),il(a,d));let l=r.cid;void 0!==l&&(xn(a,16),xn(a,l));let h=r.cname;void 0!==h&&(xn(a,26),il(a,h));let p=r.deviceId;void 0!==p&&(xn(a,34),il(a,p));let m=r.elapse;void 0!==m&&(xn(a,40),Za(a,m));let _=r.fileSize;void 0!==_&&(xn(a,48),Za(a,Mp(_)));let v=r.height;void 0!==v&&(xn(a,56),Za(a,Mp(v)));let b=r.jpg;void 0!==b&&(xn(a,66),xn(a,b.length),DP(a,b));let y=r.networkType;void 0!==y&&(xn(a,72),Za(a,Mp(y)));let T=r.osType;void 0!==T&&(xn(a,80),Za(a,Mp(T)));let M=r.requestId;void 0!==M&&(xn(a,90),il(a,M));let O=r.sdkVersion;void 0!==O&&(xn(a,98),il(a,O));let D=r.sequence;void 0!==D&&(xn(a,104),Za(a,Mp(D)));let x=r.sid;void 0!==x&&(xn(a,114),il(a,x));let F=r.timestamp;void 0!==F&&(xn(a,120),Za(a,F));let j=r.uid;void 0!==j&&(xn(a,128),xn(a,j));let q=r.vid;void 0!==q&&(xn(a,136),xn(a,q));let te=r.width;void 0!==te&&(xn(a,144),Za(a,Mp(te)));let K=r.service;void 0!==K&&(xn(a,152),xn(a,K));let Q=r.callbackData;void 0!==Q&&(xn(a,162),xn(a,Q.length),DP(a,Q));let $=r.ticket;void 0!==$&&(xn(a,170),il(a,$));let z=r.vendorConfigs;void 0!==z&&(xn(a,178),il(a,z))}(s,i),function(r){let a=r.bytes,d=r.limit;return a.length===d?a:a.subarray(0,d)}(i)}(M);if(O.byteLength<a._workerMessageLengthLimit){if(V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const D=function(x){for(var F=1;F<arguments.length;F++){var j=null!=arguments[F]?arguments[F]:{};F%2?LP(Object(j),!0).forEach(function(q){S(x,q,j[q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(j)):LP(Object(j)).forEach(function(q){Object.defineProperty(x,q,Object.getOwnPropertyDescriptor(j,q))})}return x}({},M);delete D.jpg,I.debug("[".concat(a._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(D))}return O}return a.quality=a.quality*a._qualityRatio,yield a.generateRequestData(i,{appId:d,cname:l,cid:h,vid:p,sid:m,uid:_})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ze.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Kr.CLOSED,this.emit(us.STATE_CHANGE,Ud.CLOSED)}}function FP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function UP(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?FP(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):FP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}const TB=Date.now(),$0=20,VP=new Map,mb=new Map;function BP(s){return X0.apply(this,arguments)}function X0(){return X0=L(function*(s){const i=VP.get(s),r=Array.isArray(i)&&i[i.length-1],a=mb.get(s);if(!r)return void(a.isSyncing=!1);const d={uid:r.uid,payload:cm(r.payload)};0===a.firstRecvTs&&(a.firstRecvTs=r.recvTs,a.firstSendTs=r.sendTs);const l=r.sendTs-a.firstSendTs,h=l-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-l);let p=r.mediaDelay+h;p<=0?(i.pop(),_g(r.context,d),p=0):p=Math.min(p,$0),setTimeout(()=>i.length&&BP(s),p)}),X0.apply(this,arguments)}function _g(s,i){s.safeEmit($e.STREAM_MESSAGE,i.uid,i.payload),s.onStreamMessage&&s.onStreamMessage(i)}const IB=lt().name;function jP(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function rl(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?jP(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):jP(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}Ei.setLogger(I);class Mt extends jt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var i;return(null===(i=this._config)||void 0===i?void 0:i.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(i){var r;let a;if(super(),r=this,S(this,"store",void 0),S(this,"_uid",void 0),S(this,"_channelName",void 0),S(this,"_uintUid",void 0),S(this,"_users",[]),S(this,"_config",void 0),S(this,"_clientId",void 0),S(this,"_appId",void 0),S(this,"_sessionId",null),S(this,"_key",void 0),S(this,"_rtmConfig",{}),S(this,"_joinInfo",void 0),S(this,"_gateway",void 0),S(this,"_statsCollector",void 0),S(this,"_configDistribute",void 0),S(this,"_leaveMutex",new Ei("client-leave")),S(this,"_publishMutex",new Ei("client-publish")),S(this,"_renewTokenMutex",new Ei("client-renewtoken")),S(this,"_subscribeMutex",new Ei("client-subscribe")),S(this,"_encryptionMode","none"),S(this,"_encryptionSecret",null),S(this,"_encryptionSalt",null),S(this,"_proxyServer",void 0),S(this,"_turnServer",{servers:[],mode:"auto"}),S(this,"_cloudProxyServerMode","disabled"),S(this,"_isDualStreamEnabled",!1),S(this,"_defaultStreamFallbackType",void 0),S(this,"_lowStreamParameter",void 0),S(this,"_streamFallbackTypeCacheMap",new Map),S(this,"_remoteStreamTypeCacheMap",new Map),S(this,"_axiosCancelSource",Ze.CancelToken.source()),S(this,"_audioVolumeIndicationInterval",void 0),S(this,"_networkQualityInterval",void 0),S(this,"_userOfflineTimeout",void 0),S(this,"_streamRemovedTimeout",void 0),S(this,"_injectStreamingClient",void 0),S(this,"_liveTranscodeStreamingClient",void 0),S(this,"_liveRawStreamingClient",void 0),S(this,"_channelMediaRelayClient",void 0),S(this,"_networkQualitySensitivity","normal"),S(this,"_p2pChannel",void 0),S(this,"_useLocalAccessPoint",!1),S(this,"_setLocalAPVersion",void 0),S(this,"_joinAndNotLeaveYet",!1),S(this,"_numberOfJoinCount",0),S(this,"_remoteDefaultVideoStreamType",void 0),S(this,"_inspect",void 0),S(this,"_moderation",void 0),S(this,"_license",void 0),S(this,"_pendingPublishedUsers",[]),S(this,"ntpAlignErrorCount",0),S(this,"remoteInboundOffset",0),S(this,"_handleLocalTrackEnable",(d,l,h)=>{this.publish(d,!1).then(l).catch(h)}),S(this,"_handleLocalTrackDisable",(d,l,h)=>{this.unpublish(d).then(l).catch(h)}),S(this,"_handleUserOnline",d=>{if(V("BLOCK_LOCAL_CLIENT")&&nu(d.uid,this.channelName))return void I.debug("[".concat(d.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof d.uid&&I.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const l=this._users.find(h=>h.uid===d.uid);if(l)l._trust_in_room_=!0,l._is_pre_created&&(l._is_pre_created=!1,this.safeEmit($e.USER_JOINED,l));else{const h=new Ii(d.uid,d.uint_id||d.uid);this._users.push(h),I.debug("[".concat(this._clientId,"] user online"),d.uid),this.safeEmit($e.USER_JOINED,h)}}),S(this,"_handleUserOffline",d=>{if(V("BLOCK_LOCAL_CLIENT")&&nu(d.uid,this.channelName))return;const l=this._users.find(h=>h.uid===d.uid);l&&(this._handleRemoveStream(d),this._handleRemoveDataChannels(d),l._audio_pre_subscribed||l._video_pre_subscribed?l._is_pre_created=!0:sm(this._users,l),this._remoteStreamTypeCacheMap.delete(l.uid),this._streamFallbackTypeCacheMap.delete(l.uid),I.debug("[".concat(this._clientId,"] user offline"),d.uid,"reason:",d.reason),this.safeEmit($e.USER_LEAVED,l,d.reason))}),S(this,"_handleAddAudioOrVideoStream",(d,l,h,p,m,_,v)=>{if(V("BLOCK_LOCAL_CLIENT")&&nu(l,this.channelName))return;const b=this._users.find(T=>T.uid===l);if(!b)return void I.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));I.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(d)),this.store.subscribe(b.uid,d,void 0,void 0,void 0,Date.now());const y="audio"===d?b.hasAudio:b.hasVideo;b._uintid||(b._uintid=m||l),"audio"===d?b._trust_audio_stream_added_state_=!0:b._trust_video_stream_added_state_=!0,"audio"===d?(b._audio_added_=!0,void 0!==h&&(b._audioSSRC=h),void 0!==p&&(b._cname=p),_&&(b._audioOrtc=_)):(b._video_added_=!0,void 0!==h&&(b._videoSSRC=h),void 0!==p&&(b._cname=p),void 0!==v&&(b._rtxSsrcId=v),_&&(b._videoOrtc=_)),("audio"===d?b.hasAudio:b.hasVideo)&&!y&&(I.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published ").concat(d)),this.safeEmit($e.USER_PUBLISHED,b,d)),"video"===d?Ie.onGatewayStream(this._sessionId,ni.ON_ADD_VIDEO_STREAM,Gt.ON_ADD_VIDEO_STREAM,{peer:m||l,ssrc:b._videoSSRC}):Ie.onGatewayStream(this._sessionId,ni.ON_ADD_AUDIO_STREAM,Gt.ON_ADD_AUDIO_STREAM,{peer:m||l,ssrc:b._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(b,d,h).then(T=>{if(T&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(d," for user ").concat(b.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof ai))return this._p2pChannel.unsubscribe(b,d,!0).then(()=>this._subscribe(b,d,!0).catch(M=>{I.error("[".concat(this._clientId,"] resubscribe error"),M.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(b,d)&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(d," for user ").concat(b.uid," after reconnect.")),this._subscribe(b,d,!0).catch(T=>{I.error("[".concat(this._clientId,"] resubscribe error"),T.toString())}))}),S(this,"_handleRemoveStream",d=>{if(V("BLOCK_LOCAL_CLIENT")&&nu(d.uid,this.channelName))return;const l=this._users.find(p=>p.uid===d.uid);if(!l)return void I.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));I.debug("[".concat(this._clientId,"] stream removed with uid ").concat(d.uid));let h=()=>{};l.hasAudio&&l.hasVideo?h=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit($e.USER_UNPUBLISHED,l,"audio"),I.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit($e.USER_UNPUBLISHED,l,"video")}:l.hasVideo?h=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit($e.USER_UNPUBLISHED,l,"video")}:l.hasAudio&&(h=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit($e.USER_UNPUBLISHED,l,"audio")}),l._video_pre_subscribed||l._audio_pre_subscribed||(l._trust_audio_stream_added_state_=!0,l._trust_video_stream_added_state_=!0,l._audio_added_=!1,l._video_added_=!1,this._p2pChannel instanceof ai&&this._p2pChannel.unsubscribe(l).then(p=>{if(p)return this._gateway.unsubscribe(p,l.uid)}),l._audioSSRC=void 0,l._videoSSRC=void 0,l._audioOrtc=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),Ie.onGatewayStream(this._sessionId,ni.ON_REMOVE_STREAM,Gt.ON_REMOVE_STREAM,{peer:d.uint_id||d.uid}),h()}),S(this,"_handleSetStreamLocalEnable",(d,l,h)=>{if(V("BLOCK_LOCAL_CLIENT")&&nu(l,this.channelName))return;const p=this._users.find(v=>v.uid===l);if(!p)return void I.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));I.debug("[".concat(this._clientId,"] local ").concat(d," ").concat(h?"enabled":"disabled"," with uid ").concat(l));const m="audio"===d?p.hasAudio:p.hasVideo;if("audio"===d){p._trust_audio_enabled_state_=!0;const v=p._audio_enabled_;if(p._audio_enabled_=h,p._audio_enabled_===v)return;{const b=p._audio_enabled_?"enable-local-audio":"disable-local-audio";I.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(l,", msg: ").concat(b)),this.safeEmit($e.USER_INFO_UPDATED,l,b)}}else{p._trust_video_enabled_state_=!0;const v=p._video_enabled_;if(p._video_enabled_=h,p._video_enabled_===v)return;{const b=p._video_enabled_?"enable-local-video":"disable-local-video";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(b)),this.safeEmit($e.USER_INFO_UPDATED,l,b)}}const _="audio"===d?p.hasAudio:p.hasVideo;return m!==_?!m&&_?(I.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(d)),void this.safeEmit($e.USER_PUBLISHED,p,d)):("video"===d&&p._videoTrack&&p._videoTrack._destroy(),this._p2pChannel.muteRemote(p,d),I.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(d)),void this.safeEmit($e.USER_UNPUBLISHED,p,d)):void 0}),S(this,"_handleMuteStream",(d,l,h)=>{if(V("BLOCK_LOCAL_CLIENT")&&nu(d,this.channelName))return;I.debug("[".concat(this._clientId,"] receive mute message"),d,l,h);const p=this._users.find(v=>v.uid===d);if(!p)return void I.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(d));const m="audio"===l?p.hasAudio:p.hasVideo;if("audio"===l){p._trust_audio_mute_state_=!0;const v=p._audio_muted_;if(p._audio_muted_=h,p._audio_muted_===v)return;{const b=p._audio_muted_?"mute-audio":"unmute-audio";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(b)),this.safeEmit($e.USER_INFO_UPDATED,d,b)}}else{p._trust_video_mute_state_=!0;const v=p._video_muted_;if(p._video_muted_=h,p._video_muted_===v)return;{const b=p._video_muted_?"mute-video":"unmute-video";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(b)),this.safeEmit($e.USER_INFO_UPDATED,d,b)}}const _="audio"===l?p.hasAudio:p.hasVideo;if(m!==_){if(!m&&_)return("audio"===l?p._audioSSRC:p._videoSSRC)?(I.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(l)),void this.safeEmit($e.USER_PUBLISHED,p,l)):void I.warning("[".concat(this._clientId,"] remote user ").concat(d," receive ").concat(l," unmute message  before add stream message, ").concat(l," SSRC doesn't exist yet."));"video"===l&&p._videoTrack&&!p._video_pre_subscribed&&p._videoTrack._destroy(),this._p2pChannel.muteRemote(p,l),I.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(l)),this.safeEmit($e.USER_UNPUBLISHED,p,l)}}),S(this,"_handleP2PLost",function(){var d=L(function*(l){I.debug("[".concat(r._clientId,"] receive p2p lost"),l),parseInt(l.p2pid,10)===r.store.p2pId?yield r._p2pChannel.requestReconnect():I.warning("[".concat(r._clientId,"] P2PLost stream not found"),l)});return function(l){return d.apply(this,arguments)}}()),S(this,"_handleTokenWillExpire",()=>{I.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit($e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),S(this,"_handleBeforeUnload",d=>{"beforeunload"===d.type&&void 0!==d.returnValue&&""!==d.returnValue||(this.leave(),I.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),S(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit($e.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const d={downlinkNetworkQuality:0,uplinkNetworkQuality:0};d.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),d.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit($e.NETWORK_QUALITY,d)}),S(this,"_handleP2PAddAudioOrVideoStream",(d,l,h,p)=>{const m=this._users.find(v=>v.uid===l);if(!m)return void I.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));I.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(d)),this.store.subscribe(m.uid,d,void 0,void 0,void 0,Date.now());const _="audio"===d?m.hasAudio:m.hasVideo;"audio"===d?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,"audio"===d?(m._audio_added_=!0,void 0!==h&&(m._audioSSRC=h),void 0!==p&&(m._audioMid=p)):(m._video_added_=!0,void 0!==h&&(m._videoSSRC=h),void 0!==p&&(m._videoMid=p)),("audio"===d?m.hasAudio:m.hasVideo)&&!_&&(I.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(d)),this.safeEmit($e.USER_PUBLISHED,m,d)),this._p2pChannel.hasPendingRemoteMedia(m,d)&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(d," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,d,!0).catch(v=>{I.error("[".concat(this._clientId,"] resubscribe error"),v.toString())}))}),this._config=i,this._clientId=Ke(5,"client-"),this.store=new yO(i.codec,i.audioCodec,i.mode,this._clientId),this.store.clientCreated(),i.proxyServer&&this.setProxyServer(i.proxyServer,!0),i.turnServer&&this.setTurnServer(i.turnServer,!0),I.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Do," build: ").concat(rT,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),i.clientRoleOptions)try{MS(i.clientRoleOptions),a=Object.assign({},i.clientRoleOptions)}catch(d){I.warning("[".concat(this._clientId,"] ").concat(d.toString()))}this._statsCollector=new Cs(this.store),this._statsCollector.onStatsException=(d,l,h)=>{I.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(d,", msg: ").concat(l,", uid: ").concat(h)),this.safeEmit($e.EXCEPTION,{code:d,msg:l,uid:h})},this._statsCollector.onUploadPublishDuration=(d,l,h,p)=>{const m=this._users.find(_=>_.uid===d);m&&Ie.peerPublishStatus(this._sessionId,{subscribeElapse:p,audioPublishDuration:l,videoPublishDuration:h,peer:m._uintid})},this.store.useDataChannel=Ot().supportDataChannel&&V("SIGNAL_CHANNEL"),this.store.useP2P="p2p"===i.mode,this._gateway=new qO(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:i.websocketRetryConfig||Pn,httpRetryConfig:i.httpRetryConfig||Pn,forceWaitGatewayResponse:void 0===i.forceWaitGatewayResponse||i.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:i.role,clientRoleOptions:a}),this._configDistribute=new nN,this.store.useP2P?(this._p2pChannel=new Je(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new ai(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}joinMeta(i,r,a,d,l){var h=arguments,p=this;return L(function*(){let m=!(h.length>5&&void 0!==h[5])||h[5],_=h.length>6&&void 0!==h[6]&&h[6];It("JOIN_GATEWAY_USE_443PORT_ONLY",m),It("JOIN_GATEWAY_USE_DUAL_DOMAIN",_);const v=p._gateway.signal.websocket;return v instanceof dp&&(v.use443PortOnly=m,v.tryDoubleDomain=_),(b=L(function*(y,T,M){xE.get(y)||xE.set(y,[]),tm.get(y)||tm.set(y,T),Nt.get(y)||Nt.set(y,0);const O=xE.get(y),D=tm.get(y);if(!O||!D)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Nt.get(y)===D){const te=em();O.push(te),yield te.promise}Nt.set(y,Nt.get(y)+1);for(var x=arguments.length,F=new Array(x>3?x-3:0),j=3;j<x;j++)F[j-3]=arguments[j];const q=yield M(...F);return Nt.set(y,Nt.get(y)-1),Nt.get(y)===D-1&&O.length>0&&(O[0].resolve(),O.shift()),0===Nt.get(y)&&(xE.set(y,[]),tm.set(y,0),Nt.set(y,0)),q}),function(y,T,M){return b.apply(this,arguments)})("client.join",V("JOIN_MAX_CONCURRENCY"),p.join.bind(p),i,r,a,d,l);var b})()}join(i,r,a,d,l){var h=this;return L(function*(){const p=++h._numberOfJoinCount;h.store.joinStart(),d&&(h.store.uid=d);const m="HTTPS"===(Ht||Ht||(Ht=(window.location.protocol.split(":")[0]||"").toUpperCase(),Ht)),_=nT()?window.isSecureContext:"Browser Not Support";(!nT()&&!m||!window.isSecureContext)&&I.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");const v=Ac();"DISCONNECTED"===h.connectionState&&(h.store.avoidJoinStart=Math.round(Date.now()),I.debug("[".concat(h._clientId,"] set avoidJoinStart to ").concat(h.store.avoidJoinStart)));const b=Ie.reportApiInvoke(v,{name:Kn.JOIN,options:[i,r,a,d],states:{isHttps:m,isSecureContext:_},tag:qt.TRACER});Ie.setAppId(i);try{if(!a&&null!==a)throw new W(k.INVALID_PARAMS,"Invalid token: ".concat(a,". If you don not use token, set it to null"));a&&hi(a,"token",1,2047),hi(i,"appid",1,2047),OO(r),d&&dv(d),l&&hi(l,"optionalInfo",1,2047)}catch(D){throw b.onError(D),D}if(I.info("[".concat(h._clientId,"] start join channel ").concat(r,", join number: ").concat(p)),h._leaveMutex.isLocked&&(I.debug("[".concat(h._clientId,"] join: waiting leave operation")),(yield h._leaveMutex.lock())(),I.debug("[".concat(h._clientId,"] join: continue"))),h._joinAndNotLeaveYet=!0,"DISCONNECTED"!==h.connectionState){const D=new W(k.INVALID_OPERATION,"[".concat(h._clientId,"] Client already in connecting/connected state"));throw b.onError(D),D}h._sessionId||(h._sessionId=v,h.store.sessionId=h._sessionId),h._gateway.state="CONNECTING";const y=rl(rl({},h._rtmConfig),{},{clientId:h._clientId,appId:i,sid:h._sessionId,cname:r,uid:"string"!=typeof d?d:null,turnServer:h._turnServer,proxyServer:h._proxyServer,token:a||i,cloudProxyServer:h._cloudProxyServerMode,optionalInfo:l,license:h._license,useLocalAccessPoint:h._useLocalAccessPoint},void 0!==h._remoteDefaultVideoStreamType&&{defaultVideoStream:h._remoteDefaultVideoStreamType});if(h._useLocalAccessPoint&&(y.setLocalAPVersion=h._setLocalAPVersion),"string"==typeof d&&(y.stringUid=d,h._uintUid?(y.uid=h._uintUid,h._uintUid=void 0):y.uid=0),"none"!==h._encryptionMode&&h._encryptionSecret){if(y.aesmode=h._encryptionMode,y.aespassword=yield om(h._encryptionSecret),!h._joinAndNotLeaveYet)throw new W(k.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));h._encryptionSalt&&(y.aessalt=h._encryptionSalt)}h._startSession(h._sessionId,{channel:r,appId:i,stringUid:y.stringUid});const T=h._sessionId;setTimeout(()=>{"CONNECTING"===h.connectionState&&T===h._sessionId&&Ie.joinChannelTimeout(h._sessionId,5)},5e3);try{var M;let D;const x=y.cloudProxyServer;if(ye(M=["proxy3","proxy4","proxy5"]).call(M,x)){const K=V("PROXY_SERVER_TYPE3");y.proxyServer=Array.isArray(K)?K[0]:K}if(Ie.setProxyServer(y.proxyServer),I.setProxyServer(y.proxyServer),h.store.requestAPStart(),y.stringUid&&!y.uid){let K;[K,D]=yield X.all([ar(y.stringUid,y,h._axiosCancelSource.token,h._config.httpRetryConfig||Pn,h.store),ha(y,h._axiosCancelSource.token,h._config.httpRetryConfig||Pn,!0,h.store)]),I.debug("[".concat(h._clientId,"] getUserAccount Success ").concat(y.stringUid," => ").concat(K)),y.uid=K,D.gatewayInfo.uid=K,D.gatewayInfo.res.uid=K}else D=yield ha(y,h._axiosCancelSource.token,h._config.httpRetryConfig||Pn,!0,h.store);if(!h._joinAndNotLeaveYet)throw new W(k.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));h.store.requestAPEnd(),setTimeout(()=>{h._configDistribute.startGetConfigDistribute(y,h._axiosCancelSource.token),h._configDistribute.on(Cm.UPDATE_BITRATE_LIMIT,K=>{h._p2pChannel.updateBitrateLimit(K)})},0),h._key=a||i;const F=D.gatewayInfo,j=y.uid?y.uid:F.uid;h._joinInfo=rl(rl({},y),{},{cid:F.cid,uid:j,vid:F.vid,apResponse:F.res,uni_lbs_ip:F.uni_lbs_ip,gatewayAddrs:F.gatewayAddrs}),h.store.intUid=j;const q=yield h._joinGateway();if(!h._joinAndNotLeaveYet)throw new W(k.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));b.onSuccess(q),h._appId=i,h._channelName=y.cname,h._uid=q,h.store.uid=q,setTimeout(()=>{h._networkQualityInterval&&window.clearInterval(h._networkQualityInterval),h._networkQualityInterval=window.setInterval(h._handleUpdateNetworkQuality,2e3),window.addEventListener(fr()?"beforeunload":"pagehide",h._handleBeforeUnload)},0);const te=y.stringUid?"string uid: ".concat(y.stringUid,",uid: ").concat(y.uid):"uid: ".concat(h._uid);return I.info("[".concat(h._clientId,"] Joining channel success: channel: ").concat(r,",").concat(te)),setTimeout(()=>{I.startUpload()},5e3),h.store.joinEnd(),O=h,ye(Ld).call(Ld,O)||Ld.push(O),q}catch(D){const x=Array.isArray(D)?D[0]:D;throw x&&x.code===k.OPERATION_ABORTED?I.warning("[".concat(h._clientId,"] join number: ").concat(p,", Joining channel failed, rollback"),x):I.error("[".concat(h._clientId,"] join number: ").concat(p,", Joining channel failed, rollback"),x),x.code!==k.OPERATION_ABORTED&&h._numberOfJoinCount===p&&(h._gateway.state="DISCONNECTED",h._reset()),b.onError(x),x}var O})()}_joinGateway(){if(!this._joinInfo||!this._key)throw new W(k.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!V("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(i=>i).catch(i=>{if(i.code===k.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,ze.FALLBACK),i;if(i.code===k.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,ze.FALLBACK),i;throw i}).then(i=>{if(i instanceof W){if(i.code===k.INIT_WEBSOCKET_TIMEOUT){if(I.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new W(k.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const r=V("PROXY_SERVER_TYPE3");if(Array.isArray(r))if(this._joinInfo.apUrl){const d=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),l=d.slice(d.length-2).join(".");r.forEach(h=>{this._joinInfo&&ye(h).call(h,l)&&(this._joinInfo.proxyServer=h)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=r[0])}else this._joinInfo.proxyServer=r[0];else this._joinInfo.proxyServer=r;const a=V("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return a&&a[1]&&"443"!==a[1]&&I.setProxyServer(this._joinInfo.proxyServer),"443"!==V("STATS_COLLECTOR_PORT").toString()&&Ie.setProxyServer(this._joinInfo.proxyServer),Ie.reportApiInvoke(this._sessionId,{name:Kn.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:qt.TRACER}).onSuccess(),this.safeEmit($e.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),V("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(d=>{"forceturn"in d&&(d.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(I.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new W(k.INVALID_OPERATION);return Ie.reportApiInvoke(this._sessionId,{name:Kn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:qt.TRACER}).onSuccess(),this._joinGateway()}return i}).then(i=>i)}leave(){var i=this;return L(function*(){I.info("[".concat(i._clientId,"] Leaving channel")),window.removeEventListener(fr()?"beforeunload":"pagehide",i._handleBeforeUnload),i._reset(),function(a){const d=Ld.indexOf(a);-1!==d&&Ld.splice(d,1)}(i);const r=yield i._leaveMutex.lock();if("DISCONNECTED"===i.connectionState)return I.info("[".concat(i._clientId,"] Leaving channel repeated, success")),void r();yield i._gateway.leave("CONNECTED"!==i.connectionState),I.info("[".concat(i._clientId,"] Leaving channel success")),i._joinAndNotLeaveYet=!1,i.store.resetJoinChannelServiceRecords(),r()})()}publish(i){var r=arguments,a=this;return L(function*(){let d=!(r.length>1&&void 0!==r[1])||r[1];if(!Array.isArray(i)){if(!(i instanceof Bi))return a._publishDataChannel(i);i=[i]}if(0===i.length)throw new W(k.INVALID_PARAMS,"param list is empty");const l=i;if("audience"===a._gateway.role)throw new W(k.INVALID_OPERATION,"audience can not publish stream");for(const p of l){if(!(p instanceof Bi))throw new W(k.INVALID_PARAMS,"parameter is not local track");if(!p._enabled&&d)throw new W(k.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(p.getTrackId()))}I.info("[".concat(a._clientId,"] Publishing tracks, id ").concat(l.map(p=>"".concat(p.getTrackId()," "))));const h=yield a._publishMutex.lock();yield a._configDistribute.awaitConfigDistributeComplete(),d&&l.forEach(p=>{const m=a._configDistribute.getBitrateLimit();p instanceof je&&m&&p.setBitrateLimit(m.uplink)});try{yield a._publishHighStream(l),I.info("[".concat(a._clientId,"] Publish success, id ").concat(l.map(p=>"".concat(p.getTrackId()," "))))}catch(p){throw I.error("[".concat(a._clientId,"] publish error"),p.toString()),p}finally{h()}})()}_publishDataChannel(i){var r=this;return L(function*(){At(i.id,"id",0,65535,!0),wc(i.ordered,"ordered"),hi(i.metadata,"metadata",0,512),I.info("[".concat(r._clientId,"] Publishing datachannels, id ").concat(i.id));const a=yield r._publishMutex.lock();try{if(-1!==r._p2pChannel.getAllDataChannels().findIndex(l=>l.id===i.id))throw new W(k.INVALID_PARAMS,"Invalid id: ".concat(i.id,". If you want to republish the datachannel, unpublish first"));if(!r._joinInfo||void 0===r._uid)throw new W(k.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new W(k.INVALID_OPERATION,"can not publish datachannel in ".concat(r.connectionState," state"));if("auto"===r._turnServer.mode&&V("FORCE_TURN")&&!V("TURN_ENABLE_TCP")&&!V("TURN_ENABLE_UDP"))throw new W(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const d=new eF(i);yield r._p2pChannel.publishDataChannel([d]);try{const l={streamId:i.id,ordered:i.ordered,maxRetransmits:V("DATASTREAM_MAX_RETRANSMITS"),metadata:i.metadata,channelId:d._originDataChannelId};yield r._gateway.publishDataChannel(r._uid,l,!0)}catch(l){if(l.code!==k.DISCONNECT_P2P)throw l}return yield d._waitTillOpen(),I.info("[".concat(r._clientId,"] Publish dataChannels success, id ").concat(d.id)),d}catch(d){throw I.error("[".concat(r._clientId,"] publish datachannels error"),d.toString()),d}finally{a()}})()}unpublish(i){var r=this;return L(function*(){if(!r._joinInfo||void 0===r._uid)throw new W(k.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let a=[];if(i)if(Array.isArray(i))a=i;else{if(!(i instanceof Bi))return r._unpublishDataChannel([i]);a=[i]}else r.store.useP2P||(yield r._unpublishDataChannel()),a=r._p2pChannel.getAllTracks(!0);I.info("[".concat(r._clientId,"] Unpublish tracks, tracks ").concat(a.map(l=>"".concat(l.getTrackId()," "))," "));const d=yield r._publishMutex.lock();try{if(r._p2pChannel instanceof Je){const l=yield r._p2pChannel.unpublish(a);l&&(yield r._gateway.sendExtensionMessage(mn.UNPUBLISH,{unpubMsg:l},!0))}else{const l=yield r._p2pChannel.unpublish(a);l&&(yield r._gateway.unpublish(l,r._uid)),I.info("[".concat(r._clientId,"] Unpublish success,tracks ").concat(a.map(h=>"".concat(h.getTrackId()))))}}catch(l){throw I.error("[".concat(r._clientId,"] unpublish error"),l.toString()),l}finally{d&&d()}})()}_unpublishDataChannel(i){var r=this;return L(function*(){void 0!==i&&0!==i.length||(i=r._p2pChannel.getAllDataChannels()),I.info("[".concat(r._clientId,"] Unpublish datachannels, datachannels ").concat(i.map(d=>"".concat(d.id," "))," "));const a=yield r._publishMutex.lock();try{const d=yield r._p2pChannel.unpublishDataChannel(i);d&&(yield r._gateway.unpublishDataChannel(d)),I.info("[".concat(r._clientId,"] Unpublish dataChannel success,dataChannel ").concat(i.map(l=>"".concat(l.id))))}catch(d){throw I.error("[".concat(r._clientId,"] unpublish dataChannel error"),d.toString()),d}finally{a&&a()}})()}subscribe(i,r,a){var d=this;return L(function*(){return"datachannel"===r?d._subscribeDataChannel(i,a):d._subscribe(i,r)})()}presubscribe(i,r){var a=this;return L(function*(){if(Sn(r,"mediaType",["audio","video"]),a._p2pChannel instanceof Je)throw new W(k.INVALID_OPERATION,"can't presub at p2p mode");if(!a._joinInfo)throw new W(k.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==a.connectionState&&"RECONNECTING"!==a.connectionState)throw new W(k.INVALID_OPERATION,"can't presub in ".concat(a.connectionState," state"));const d=r===Ce.AUDIO,l=r===Ce.VIDEO,h=yield a._subscribeMutex.lock();try{const{ssrcId:p,ortc:m,rtxSsrcId:_,cname:v,uint_id:b}=yield a._gateway.presubscribe(i,r,!0);if(null==p)throw new W(k.UNEXPECTED_RESPONSE,"no ssrc id");let y=a._users.find(M=>M.uid===i);y||(y=new Ii(i,b||i),y._is_pre_created=!0,a._users.push(y)),v&&(y._cname=v),y._uintid||(y._uintid=b||i),d&&(y._audioSSRC=p,y._audio_pre_subscribed=!0,m&&(y._audioOrtc=m)),l&&(y._videoSSRC=p,y._video_pre_subscribed=!0,m&&(y._videoOrtc=m),null!=_&&(y._rtxSsrcId=_)),I.info("[".concat(a._clientId,"] presub succeed ssrc: ").concat(p)),yield a._p2pChannel.subscribe(y,r,p,_,m);const T=d?y._audioTrack:y._videoTrack;if(!T)throw new W(k.UNEXPECTED_ERROR,"can not find remote track in user");return d&&(y._trust_audio_stream_added_state_=!0,y._audio_added_=!0),l&&(y._trust_video_stream_added_state_=!0,y._video_added_=!0),T}catch(p){throw I.error("[".concat(a._clientId,"] presub user ").concat(i," error"),p),p}finally{h()}})()}_subscribeDataChannel(i,r){var a=this;return L(function*(){var d;if(At(r,"channelId",0,65535,!0),!a._joinInfo)throw new W(k.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==a.connectionState&&"RECONNECTING"!==a.connectionState)throw new W(k.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(a.connectionState," state"));if(!a._users.find(m=>m===i))throw I.error("[".concat(a._clientId,"] can not subscribe ").concat(i.uid,", this user is not in the channel")),new W(k.INVALID_REMOTE_USER,"user is not in the channel");if(!i.hasAudio&&!i.hasVideo&&0===i._dataChannels.length)throw I.error("[".concat(a._clientId,"] can not subscribe ").concat(i.uid,", user is not published")),new W(k.INVALID_REMOTE_USER,"user is not published");const l=null===(d=i._dataChannels)||void 0===d?void 0:d.find(m=>m.id===r);if(!l)throw I.error("[".concat(a._clientId,"] can not subscribe ").concat(i.uid," with mediaType datachannel, remote datachannel is not published")),new W(k.REMOTE_USER_IS_NOT_PUBLISHED);const h=yield a._subscribeMutex.lock();I.info("[".concat(a._clientId,"] subscribe user ").concat(i.uid,", mediaType: datachannel"));try{const m=yield a._p2pChannel.subscribeDataChannel(i,[l]);if(m&&ye(m).call(m,l.id))try{var p;if(!l._originDataChannelId)throw I.error("[".concat(a._clientId,"] can not subscribe ").concat(i.uid," with mediaType datachannel, cannot get RTCDatachannel")),new W(k.REMOTE_USER_IS_NOT_PUBLISHED);const _={id:l.id,datachannelId:l._originDataChannelId,ordered:l.ordered,maxRetransmits:l.maxRetransmits,metadata:null!==(p=l.metadata)&&void 0!==p?p:""};yield a._gateway.subscribeDataChannel(i.uid,_,!0)}catch(_){if(_?.code!==k.WS_ABORT)throw yield a._p2pChannel.unsubscribeDataChannel(i,[l]),_;yield a._p2pChannel.unsubscribeDataChannel(i,[l]),a._p2pChannel.setPendingRemoteDataChannel(i,l.id)}return yield l._waitTillOpen(),I.info("[".concat(a._clientId,"] subscribe success user ").concat(i.uid,", mediaType: datachannel")),l}finally{h()}})()}_p2pSubscribe(i,r,a){var d=this;return L(function*(){if(Sn(r,"mediaType",["audio","video"]),!d._joinInfo)throw new W(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==d.connectionState&&"RECONNECTING"!==d.connectionState)throw new W(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(d.connectionState," state"));if(!d._users.find(h=>h===i)){const h=new W(k.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(d._clientId,"] can not subscribe ").concat(i.uid,", this user is not in the channel")),h}if(!i.hasAudio&&!i.hasVideo){const h=new W(k.INVALID_REMOTE_USER,"user is not published");throw I.error("[".concat(d._clientId,"] can not subscribe ").concat(i.uid,", user is not published")),h}if(!a&&("audio"===r&&!i.hasAudio||"video"===r&&!i.hasVideo)){const h=new W(k.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(d._clientId,"] can not subscribe ").concat(i.uid," with mediaType ").concat(r,", remote track is not published")),h}const l=yield d._subscribeMutex.lock();I.info("[".concat(d._clientId,"] subscribe user ").concat(i.uid,", mediaType: ").concat(r));try{if(yield d._p2pChannel.hasRemoteMediaWithLock(i,r))yield d._p2pChannel.unmuteRemote(i,r);else try{const p="audio"===r?i._audioSSRC:i._videoSSRC,m="audio"===r?i._audioMid:i._videoMid;d.store.subscribe(i.uid,r,Date.now()),d._p2pChannel instanceof Je&&(yield d._p2pChannel.subscribe(i,r,p,m))}catch(p){throw p}I.info("[".concat(d._clientId,"] subscribe success user ").concat(i.uid,", mediaType: ").concat(r)),d._defaultStreamFallbackType&&d.setStreamFallbackOption(i.uid,d._defaultStreamFallbackType).catch(p=>{I.warning("[".concat(d._clientId,"] auto set fallback failed"),p)});const h="audio"===r?i._audioTrack:i._videoTrack;if(!h)throw new W(k.UNEXPECTED_ERROR,"can not find remote track in user object");return h}catch(h){throw I.error("[".concat(d._clientId,"] subscribe user ").concat(i.uid," error"),h),h}finally{l()}})()}_subscribe(i,r,a){var d=this;return L(function*(){if(d._p2pChannel instanceof Je)return d._p2pSubscribe(i,r);if(Sn(r,"mediaType",["audio","video"]),!d._joinInfo)throw new W(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==d.connectionState&&"RECONNECTING"!==d.connectionState)throw new W(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(d.connectionState," state"));if(!d._users.find(v=>v===i)){const v=new W(k.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(d._clientId,"] can not subscribe ").concat(i.uid,", this user is not in the channel")),v}if(!i.hasAudio&&!i.hasVideo){const v=new W(k.INVALID_REMOTE_USER,"user is not published");throw I.error("[".concat(d._clientId,"] can not subscribe ").concat(i.uid,", user is not published")),v}if(!(a||("audio"!==r||i.hasAudio&&void 0!==i._audioSSRC)&&("video"!==r||i.hasVideo&&void 0!==i._videoSSRC))){const v=new W(k.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(d._clientId,"] can not subscribe ").concat(i.uid," with mediaType ").concat(r,", remote track is not published")),v}let l="audio"===r?i._audioSSRC:i._videoSSRC,h="audio"===r?i._audioOrtc:i._videoOrtc,p="video"===r?i._rtxSsrcId:void 0,m={stream_type:"audio"===r?Ce.AUDIO:Ce.VIDEO,ssrcId:l};const _=yield d._subscribeMutex.lock();I.info("[".concat(d._clientId,"] subscribe user ").concat(i.uid,", mediaType: ").concat(r));try{if(yield d._p2pChannel.hasRemoteMediaWithLock(i,r))yield d._p2pChannel.unmuteRemote(i,r);else try{const b="audio"===r?i._audioSSRC:i._videoSSRC;void 0!==b&&b!==l&&(l=b,h="audio"===r?i._audioOrtc:i._videoOrtc,p="video"===r?i._rtxSsrcId:void 0,m={stream_type:"audio"===r?Ce.AUDIO:Ce.VIDEO,ssrcId:l}),Li.markSubscribeStart(d.store.clientId,l),d.store.subscribe(i.uid,r,Date.now()),yield d._p2pChannel.subscribe(i,r,l,p,h);try{yield d._gateway.subscribe(i.uid,m,!0)}catch(y){if(y?.code!==k.WS_ABORT)throw yield d._p2pChannel.unsubscribe(i,r),y;yield d._p2pChannel.unsubscribe(i,r,!0),d._p2pChannel.setPendingRemoteMedia(i,r)}d.store.subscribe(i.uid,r,void 0,Date.now()),d._p2pChannel.reportSubscribeEvent(!0,null,i,r)}catch(b){throw d._p2pChannel.reportSubscribeEvent(!1,b?.code,i,r),b}I.info("[".concat(d._clientId,"] subscribe success user ").concat(i.uid,", mediaType: ").concat(r)),d._defaultStreamFallbackType&&d.setStreamFallbackOption(i.uid,d._defaultStreamFallbackType).catch(b=>{I.warning("[".concat(d._clientId,"] auto set fallback failed"),b)});const v="audio"===r?i._audioTrack:i._videoTrack;if(!v)throw new W(k.UNEXPECTED_ERROR,"can not find remote track in user object");return v}catch(v){throw I.error("[".concat(d._clientId,"] subscribe user ").concat(i.uid," error"),v),v}finally{_()}})()}massSubscribe(i){var r=this;return L(function*(){if(La(i,"subscribeList"),!r._joinInfo)throw new W(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new W(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(r.connectionState," state"));const a=Date.now(),d=new Map,l=yield r._subscribeMutex.lock();I.info("[".concat(r._clientId,"]start massSubscribe user ").concat(i.map(_=>{let{user:v,mediaType:b}=_;return"user: ".concat(v?.uid,", mediaType: ").concat(b)}).join("; ")));const h=(i=[...i]).map(_=>{let{user:v,mediaType:b}=_;return{user:v,mediaType:b}}),p=yield r._p2pChannel.globalLock();try{var m;for(let v=i.length-1;v>=0;v--){const b=i[v],{user:y,mediaType:T}=b;if(Sn(T,"mediaType",["audio","video"]),!y){const D=new W(k.INVALID_PARAMS,"user property does not exist in subscribeList item");throw I.error("[".concat(r._clientId,"] user property does not exist in subscribeList item")),D}if(!r._users.find(D=>D===y)){const D=new W(k.INVALID_REMOTE_USER,"user is not in the channel");I.error("[".concat(r._clientId,"] can not massSubscribe ").concat(y.uid,", this user is not in the channel")),h[v].error=D,i.splice(v,1);continue}if("audio"===T&&(!y.hasAudio||void 0===y._audioSSRC)||"video"===T&&(!y.hasVideo||void 0===y._videoSSRC)){const D=new W(k.REMOTE_USER_IS_NOT_PUBLISHED);I.error("[".concat(r._clientId,"] can not subscribe ").concat(y.uid," with mediaType ").concat(T,", remote user is not published")),h[v].error=D,i.splice(v,1);continue}const M=Bn.Video|Bn.LwoVideo,O=d.get(y);if(O){if("video"===T?O&M:O&Bn.Audio){i.splice(v,1),I.warning("[".concat(r._clientId,"] repeat massSubscribe user:").concat(y.uid,", mediaType:").concat(T," twice"));continue}d.set(y,O|("video"===T?M:Bn.Audio))}else d.set(y,"video"===T?M:Bn.Audio)}for(let v=i.length-1;v>=0;v--){const b=i[v],{user:y,mediaType:T}=b,M=Bn.Video|Bn.LwoVideo;if(r._p2pChannel.hasRemoteMedia(y,T)){yield r._p2pChannel.unmuteRemoteNoLock(y,T);const O=d.get(y);d.set(y,"video"===T?O^M:O^Bn.Audio),i.splice(v,1)}}r.store.massSubscribe(i.map(v=>({userId:v.user.uid,type:v.mediaType})),a);const _=Va(m=Array.from(d.entries())).call(m,(v,b)=>{let[y,T]=b;if(0===T)return v;const M={stream_id:y.uid,stream_type:T};return T&Bn.Audio&&(M.audio_ssrc=y._audioSSRC),T&Bn.Video&&(M.video_ssrc=y._videoSSRC),v.push(M),v},[]);try{i.length>0&&(yield r._p2pChannel.massSubscribeNoLock(i.map(b=>{let{user:y,mediaType:T}=b;return{user:y,mediaType:T,ssrcId:T===Ce.VIDEO?y._videoSSRC:y._audioSSRC,rtxSsrcId:T===Ce.VIDEO?y._rtxSsrcId:void 0}})));const v=new Map;if(_.length>0){const b=yield r._gateway.subscribeAll(_,!0);(b?.users||[]).forEach(y=>{let{stream_id:T,video_error_code:M,audio_error_code:O,error_code:D}=y;(M||O||D)&&v.set(T,{video_error_code:M,audio_error_code:O,error_code:D})})}if(Array.from(v.entries()).length>0){const b=Array.from(v.entries()).map(y=>{let T,[M,O]=y;return O.error_code||O.video_error_code&&O.audio_error_code?T=void 0:O.video_error_code?T=Ce.VIDEO:O.audio_error_code&&(T=Ce.AUDIO),{user:r.remoteUsers.find(D=>D.uid===M),mediaType:T}});yield r._p2pChannel.massUnsubscribeNoLock(b)}for(const b of h){const y=v.get(b.user.uid);if(y){const T=y.error_code||"audio"===b.mediaType&&y.audio_error_code||"video"===b.mediaType&&y.video_error_code;if(T){const M=ru(T);I.error("user:".concat(b.user.uid," mediaType:").concat(b.mediaType," has massSubscribe error ").concat(M.desc)),b.error=new W(k.SUBSCRIBE_FAILED,"code ".concat(T,": ").concat(M.desc))}}b.error||(b.track="video"===b.mediaType?b.user.videoTrack:b.user.audioTrack)}return r.store.massSubscribe(h.filter(b=>!b.error).map(b=>({userId:b.user.uid,type:b.mediaType})),void 0,Date.now()),h.forEach(b=>{var y;Ie.subscribe(r.store.sessionId,{succ:!!b.error,ec:(null===(y=b.error)||void 0===y?void 0:y.code)||null,video:b.mediaType===Ce.VIDEO,audio:b.mediaType===Ce.AUDIO,peerid:b.user.uid,subscribeRequestid:b.mediaType===Ce.VIDEO?b.user._videoSSRC:b.user._audioSSRC,p2pid:r.store.p2pId,eventElapse:Math.floor(performance.now()-a)},!0)}),I.info("[".concat(r._clientId,"] massSubscribe success ").concat(i.map(b=>{let{user:y,mediaType:T}=b;return"user: ".concat(y?.uid,", mediaType: ").concat(T)}).join("; "))),h}catch(v){throw yield r._p2pChannel.massUnsubscribeNoLock(i),v}}finally{p(),l()}})()}unsubscribe(i,r,a){var d=this;return L(function*(){if(r||d.store.useP2P){if("datachannel"===r)return d._unsubscribeDataChannel(i,a)}else yield d._unsubscribeDataChannel(i,a);if(r&&Sn(r,"mediaType",["audio","video"]),!d._joinInfo)throw new W(k.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!d._users.find(h=>h===i)){const h=new W(k.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(d._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),h}I.info("[".concat(d._clientId,"] unsubscribe uid: ").concat(i.uid,", mediaType: ").concat(r));const l=yield d._subscribeMutex.lock();try{if(d._p2pChannel instanceof Je)yield d._p2pChannel.unsubscribe(i,r);else{const h=yield d._p2pChannel.unsubscribe(i,r);h&&(yield d._gateway.unsubscribe(h,i.uid)),r&&"audio"!==r||(i._audio_pre_subscribed=!1),r&&"video"!==r||(i._video_pre_subscribed=!1),i._is_pre_created&&sm(d._users,i),I.info("[".concat(d._clientId,"] unsubscribe success uid: ").concat(i.uid,", mediaType: ").concat(r))}}catch(h){if(h.code===k.DISCONNECT_P2P)return void I.warning("disconnecting p2p, abort unsubscribe request.");throw I.error("[".concat(d._clientId,"] unsubscribe user ").concat(i.uid," error"),h.toString()),h}finally{l()}})()}_unsubscribeDataChannel(i,r){var a=this;return L(function*(){if(r&&At(r,"id",0,65535,!0),!a._joinInfo)throw new W(k.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!a._users.find(l=>l===i)){const l=new W(k.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(a._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),l}let d;if("number"==typeof r){const l=i._dataChannels.find(h=>h.id===r);l&&(d=[l])}else d=i._dataChannels;if(void 0===d){const l=new W(k.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(a._clientId,"] can not unsubscribe ").concat(i.uid," with channelId ").concat(r,", remote datachannel is not published")),l}I.info("[".concat(a._clientId,"] unsubscribe uid: ").concat(i.uid,", mediaType: datachannel, ids: ").concat(d.map(l=>l.id)));try{const l=yield a._p2pChannel.unsubscribeDataChannel(i,d);l&&(yield a._gateway.unsubscribeDataChannel(l,i.uid)),I.info("[".concat(a._clientId,"] unsubscribe datachannel success uid: ").concat(i.uid,", mediaType: datachannel, ids: ").concat(l))}catch(l){if(l.code===k.DISCONNECT_P2P)return void I.warning("disconnecting p2p, abort unsubscribe request.");throw I.error("[".concat(a._clientId,"] unsubscribe user ").concat(i.uid," error"),l.toString()),l}})()}massUnsubscribe(i){var r=this;return L(function*(){if(La(i,"unsubscribeList"),!r._joinInfo)throw new W(k.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");I.info("[".concat(r._clientId,"] start massUnsubscribe ").concat(i.map(d=>{let{user:l,mediaType:h}=d;return"user: ".concat(l?.uid,", mediaType: ").concat(h,";")}).join())),i=[...i];const a=new Map;for(let d=i.length-1;d>=0;d--){const{user:l,mediaType:h}=i[d];if(!l){const m=new W(k.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw I.error("[".concat(r._clientId,"] user property does not exist in unsubscribeList item")),m}if(Sn(h,"mediaType",["video","audio",void 0]),!r._users.find(m=>m===l)){I.warning("[".concat(r._clientId,"] can not unsubscribe ").concat(l.uid,", user is not in the channel")),i.splice(d,1);continue}const p=Bn.Video|Bn.LwoVideo;if(a.has(l)){const m=a.get(l);let _;switch(h){case"video":_=m&p;break;case"audio":_=m&Bn.Audio;break;default:_=m&(Bn.Audio|p)}if(_){I.warning("[".concat(r._clientId,"] repeat massUnsubscribe user:").concat(l.uid,",mediaType:").concat(h," twice.")),i.splice(d,1);continue}h?"audio"===h?a.set(l,m|Bn.Audio):"video"===h&&a.set(l,m|p):a.set(l,m|Bn.Audio|p)}else h?"audio"===h?a.set(l,Bn.Audio):"video"===h&&a.set(l,p):a.set(l,Bn.Audio|p)}try{const d=yield r._p2pChannel.massUnsubscribe(i);d&&(yield r._gateway.massUnsubscribe(d)),I.info("[".concat(r._clientId,"] massUnsubscribe success ").concat(i.map(l=>{let{user:h,mediaType:p}=l;return"user: ".concat(h?.uid,", mediaType: ").concat(p,";")}).join()))}catch(d){if(d.code===k.DISCONNECT_P2P)return void I.warning("[".concat(r._clientId,"] disconnecting p2p, abort unsubscribe request."));throw I.error("[".concat(r._clientId,"] massUnsubscribe error"),d.toString()),d}})()}setLowStreamParameter(i){var r=this;return L(function*(){(function(d){if(!d)throw new ee(k.INVALID_PARAMS);nn(d.width)||DS(d.width,"streamParameter.width"),nn(d.height)||DS(d.height,"streamParameter.height"),nn(d.framerate)||DS(d.framerate,"streamParameter.framerate"),nn(d.bitrate)||At(d.bitrate,"streamParameter.bitrate")})(i),(!i.width&&i.height||i.width&&!i.height)&&I.warning("[".concat(r._clientId,"] The width and height parameters take effect only when both are set")),I.info("[".concat(r._clientId,"] set low stream parameter to"),JSON.stringify(i));const a=r._configDistribute.getLowStreamConfigDistribute();if(a&&a.bitrate&&i.bitrate&&a.bitrate<i.bitrate&&(i.bitrate=a.bitrate),r._lowStreamParameter=i,r._isDualStreamEnabled)return r._p2pChannel.updateVideoStreamParameter(i,re.LocalVideoLowTrack)})()}enableDualStream(){var i=this;return L(function*(){if(!Ot().supportDualStream)throw Ie.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new W(k.NOT_SUPPORTED,"Your browser is not support dual stream");if(i._isDualStreamEnabled)throw new W(k.INVALID_OPERATION,"Dual stream is already enabled");if(i._p2pChannel.canPublishLowStream())try{yield i._publishLowStream()}catch(r){throw Ie.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),r}i._isDualStreamEnabled=!0,Ie.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),I.info("[".concat(i._clientId,"] enable dual stream"))})()}disableDualStream(){var i=this;return L(function*(){if(i._isDualStreamEnabled){if(!i._joinInfo)throw new W(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(i._p2pChannel.getLocalMedia(re.LocalVideoLowTrack))try{const r=yield i._p2pChannel.unpublishLowStream();r&&(yield i._gateway.unpublish(r,i._joinInfo.stringUid||i._joinInfo.uid))}catch(r){throw Ie.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),r}i._isDualStreamEnabled=!1,Ie.streamSwitch(i._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),I.info("[".concat(i._clientId,"] disable dual stream"))}})()}setClientRole(i,r){var a=this;return L(function*(){if(Sn(i,"role",["audience","host"]),r&&MS(r),"rtc"===a.mode||"p2p"===a.mode)throw I.warning("[".concat(a._clientId,"]").concat(a.mode," mode can not use setClientRole")),new W(k.INVALID_OPERATION,"".concat(a.mode," mode can not use setClientRole"));if(r&&r.level&&"host"===i)throw new W(k.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===i&&a._p2pChannel.hasLocalMedia())throw new W(k.INVALID_OPERATION,"can not set client role to audience when publishing stream");yield a._gateway.setClientRole(i,r),a._config.role=i,I.info("[".concat(a._clientId,"] set client role to ").concat(i,", level: ").concat(r&&r.level))})()}getRemoteInboundOffset(){var i;const r=null===(i=this._p2pChannel.getStats())||void 0===i?void 0:i.audioSend[0];if(!r||!r.timestamp)return 0;const a=r.timestamp-Date.now();return Math.abs(a)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?a:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(i,r){if(hi(i,"proxyServer"),!r){if("DISCONNECTED"!==this.connectionState)throw new W(k.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new W(k.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=i,Ie.setProxyServer(this._proxyServer),I.setProxyServer(this._proxyServer),I.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(i,r){if(Array.isArray(i)||(i=[i]),!r){if("DISCONNECTED"!==this.connectionState)throw new W(k.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new W(k.INVALID_OPERATION,"You have already set the proxy")}if(oa(i))return this._turnServer={servers:i,mode:"original-manual"},void I.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(i.map(a=>a.urls).join(","),"."));i.forEach(a=>Kh(a)),this._turnServer={servers:i,mode:"manual"},I.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(i){if("DISCONNECTED"!==this.connectionState)throw new W(k.INVALID_OPERATION,"you should set license before join channel");if(hi(i,"license",32,32),!/^[A-Za-z\d]+$/.test(i))throw new W(k.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=i,I.info("[".concat(this._clientId,"] set license success"),i)}startProxyServer(i){if("DISCONNECTED"!==this.connectionState)throw new W(k.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new W(k.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let a;switch(void 0===i&&(i=3),i){case 1:case 2:throw new W(k.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:a="proxy3";break;case 4:a="proxy4";break;case 5:a="proxy5";break;default:throw new W(k.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=a,this.store.cloudProxyServerMode=a,I.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new W(k.INVALID_OPERATION,"Stop proxy server after leave channel");Ie.setProxyServer(),I.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",I.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(i){if(!i.accessPoints)throw new W(k.INVALID_PARAMS,"accessPoints is required.");La(i.accessPoints.serverList,"accessPoints.serverList"),hi(i.accessPoints.domain,"accessPoints.domain");const r=(T,M)=>{At(T,M,0,65535,!0)};let a=443;if(i.accessPoints.port&&(r(i.accessPoints.port,"accessPoints.port"),a=i.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new W(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");V("CLOSE_AFB_FOR_LOCAL_AP")&&(It("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),It("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const d=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,l=i.accessPoints.domain,h=i.accessPoints.serverList.map(T=>d.test(T)?"".concat(T.replace(/\./g,"-"),".").concat(l):T),p=h.map(T=>"".concat(T,":").concat(a));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,It("WEBCS_DOMAIN",p),It("WEBCS_DOMAIN_BACKUP_LIST",p),It("GATEWAY_DOMAINS",[l]),i.report&&i.report.hostname&&Array.isArray(i.report.hostname)&&i.report.hostname.length?(La(i.report.hostname,"report.hostname"),It("EVENT_REPORT_DOMAIN",i.report.hostname[0]),It("EVENT_REPORT_BACKUP_DOMAIN",i.report.hostname[1]||i.report.hostname[0])):(It("EVENT_REPORT_DOMAIN",h[0]),It("EVENT_REPORT_BACKUP_DOMAIN",h[1]||h[0]));let m=6443;i.report&&i.report.port&&(r(i.report.port,"report.port"),m=i.report.port),It("STATS_COLLECTOR_PORT",m),It("ENABLE_EVENT_REPORT",!!i.report);let _="";i.log&&i.log.hostname&&Array.isArray(i.log.hostname)&&i.log.hostname.length?(La(i.log.hostname,"log.hostname"),_=i.log.hostname[0]):_=h[0];let v=6444;i.log&&i.log.port&&(r(i.log.port,"log.port"),v=i.log.port),It("LOG_UPLOAD_SERVER","".concat(_,":").concat(v));let b=[];i.cds&&i.cds.hostname&&Array.isArray(i.cds.hostname)&&i.cds.hostname.length?(La(i.cds.hostname,"cds.hostname"),b=i.cds.hostname):b=h;let y=443;i.cds&&i.cds.port&&(r(i.cds.port,"cds.port"),y=i.cds.port),It("CDS_AP",b.map(T=>"".concat(T,":").concat(y))),It("ENABLE_CONFIG_DISTRIBUTE",!!i.cds),I.info("set local access point v2 success")}setLocalAccessPoints(i,r){if(La(i,"serverList"),hi(r,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new W(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const a=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;i=i.map(d=>a.test(d)?"".concat(d.replace(/\./g,"-"),".").concat(r):d),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,It("WEBCS_DOMAIN",i),It("WEBCS_DOMAIN_BACKUP_LIST",i),It("GATEWAY_DOMAINS",[r]),It("EVENT_REPORT_DOMAIN",i[0]),It("EVENT_REPORT_BACKUP_DOMAIN",i[1]||i[0]),It("LOG_UPLOAD_SERVER","".concat(i[0],":6444")),I.info("[".concat(this._clientId,"] set local access point success"))}setRemoteDefaultVideoStreamType(i){var r=this;return L(function*(){if(Sn(i,"streamType",[0,1]),r._remoteDefaultVideoStreamType=i,r._joinInfo)try{yield r._gateway.setDefaultRemoteVideoStreamType(i),r._joinInfo.defaultVideoStream=r._remoteDefaultVideoStreamType}catch(a){throw I.error("[".concat(r._clientId,"] set default remote video stream type error"),a.toString()),a}else I.debug("[".concat(r._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(i))})()}setRemoteVideoStreamType(i,r){var a=this;return L(function*(){Sn(r,"streamType",[0,1]);try{yield a._gateway.setRemoteVideoStreamType(i,r),setTimeout(()=>{const d=a._users.find(l=>l.uid===i);d&&d.videoTrack&&d.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(d){throw I.error("[".concat(a._clientId,"] set remote video stream type error"),d.toString()),d}I.info("[".concat(a._clientId,"] set remote ").concat(i," video stream type to ").concat(r)),a._remoteStreamTypeCacheMap.set(i,r)})()}setStreamFallbackOption(i,r){var a=this;return L(function*(){Sn(r,"fallbackType",[0,1,2]);try{yield a._gateway.setStreamFallbackOption(i,r)}catch(d){throw I.error("[".concat(a._clientId,"] set stream fallback option"),d.toString()),d}I.info("[".concat(a._clientId,"] set remote ").concat(i," stream fallback type to ").concat(r)),a._streamFallbackTypeCacheMap.set(i,r)})()}setEncryptionConfig(i,r,a){Sn(i,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"]),hi(r,"secret");const d=["aes-128-gcm2","aes-256-gcm2"];if(ye(d).call(d,i)){if(!a||!(a instanceof Uint8Array&&32===a.length))throw new W(k.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(a)throw new W(k.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(r)||I.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=i,this._encryptionSecret=r,a&&(this._encryptionSalt=Yh(a))}renewToken(i){var r=this;return L(function*(){if(hi(i,"token",1,2047),!r._key||!r._joinInfo)throw new W(k.INVALID_OPERATION,"renewToken should not be called before user join");const a=r._key;r._key=i,r._joinInfo&&(r._joinInfo.token=i);const d=yield r._renewTokenMutex.lock();try{if(V("USE_NEW_TOKEN")){I.debug("[".concat(r._clientId,"] start renew token with ticket from unilbs"));const l=yield function t2(s,i,r){return OT.apply(this,arguments)}(r._joinInfo,r._axiosCancelSource.token,r._config.httpRetryConfig||Pn);I.debug("[".concat(r._clientId,"] get ticket from unilbs success")),yield r._gateway.renewToken({token:i,ticket:l})}else I.debug("[".concat(r._clientId,"] start renew token without ticket")),yield r._gateway.renewToken({token:i});I.debug("[".concat(r._clientId,"] renewToken success"))}catch(l){throw r._key=a,r._joinInfo.token=a,I.error("[".concat(r._clientId,"] renewToken failed"),l.toString()),l}finally{d()}})()}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?I.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const i=this._p2pChannel.getAudioLevels();this.safeEmit($e.VOLUME_INDICATOR,i)},V("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const i=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return i.Duration=Math.round(r.duration/1e3),i}startLiveStreaming(i,r){var a=this;return L(function*(){if(!r){if("h264"!==a.codec)throw new W(k.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!a._p2pChannel.hasLocalMedia())throw new W(k.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(a._liveRawStreamingClient&&a._liveRawStreamingClient.hasUrl(i)||a._liveTranscodeStreamingClient&&a._liveTranscodeStreamingClient.hasUrl(i))throw new W(k.LIVE_STREAMING_TASK_CONFLICT);const d=r?qn.TRANSCODE:qn.RAW;return a._createLiveStreamingClient(d).startLiveStreamingTask(i,d)})()}setLiveTranscoding(i){return this._createLiveStreamingClient(qn.TRANSCODE).setTranscodingConfig(i)}stopLiveStreaming(i){var r=this;return L(function*(){const a=[r._liveRawStreamingClient,r._liveTranscodeStreamingClient].filter(d=>d&&d.hasUrl(i));if(!a.length)throw new W(k.INVALID_PARAMS,"can not find live streaming url to stop");yield X.all(a.map(d=>d&&d.stopLiveStreamingTask(i)))})()}addInjectStreamUrl(i,r){var a=this;return L(function*(){if(!a._joinInfo)throw new W(k.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const d=a._createLiveStreamingClient(qn.INJECT);d.setInjectStreamConfig(r,0),yield d.startLiveStreamingTask(i,qn.INJECT)})()}removeInjectStreamUrl(){var i=this;return L(function*(){var r;const a=i._createLiveStreamingClient(qn.INJECT),d=Array.from(ca(r=a.streamingTasks).call(r)).find(l=>l.mode===qn.INJECT);if(!i._joinInfo||!d)throw new W(k.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");yield a.stopLiveStreamingTask(d.url)})()}startChannelMediaRelay(i){var r=this;return L(function*(){dg(i),yield r._createChannelMediaRelayClient().startChannelMediaRelay(i)})()}updateChannelMediaRelay(i){var r=this;return L(function*(){dg(i),yield r._createChannelMediaRelayClient().updateChannelMediaRelay(i)})()}stopChannelMediaRelay(){var i=this;return L(function*(){yield i._createChannelMediaRelayClient().stopChannelMediaRelay(),i._statsCollector.onStatsChanged&&(i._statsCollector.onStatsChanged=void 0)})()}sendStreamMessage(i){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new W(k.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof i||i instanceof Uint8Array)&&(i={payload:i}),"string"==typeof i.payload){const a=new TextEncoder;i.payload=a.encode(i.payload)}if(new Blob([i.payload]).size>1024)throw new W(k.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(Ae.DATA_STREAM,{payload:Yh(i.payload),syncWithAudio:i.syncWithAudio,sendTs:Date.now()-TB},!r)}sendMetadata(i){if(!this._joinInfo)throw new W(k.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([i]).size>1024)throw new W(k.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ae.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Yh(i)})}sendCustomReportMessage(i){var r=this;return L(function*(){if(Array.isArray(i)||(i=[i]),i.forEach(AL),!r._joinInfo)throw new W(k.INVALID_OPERATION,"can not send custom report, not joined");yield Ie.sendCustomReportMessage(r._joinInfo.sid,i)})()}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}pickSVCLayer(i,r){var a=this;return L(function*(){Sn(r.spatialLayer,"spatialLayer",[0,1,2,3]),Sn(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{yield a._gateway.pickSVCLayer(i,r)}catch(d){throw I.error("[".concat(a._clientId,"] pick SVC layer failed"),d.toString()),d}})()}setRTMConfig(i){var r=this;return L(function*(){const{apRTM:a=!1,rtmFlag:d}=i;if(wc(a,"apRTM"),At(d,"rtmFlag",0),r._rtmConfig.apRTM=a,r._rtmConfig.rtmFlag=d,I.debug("[".concat(r._clientId,"] setRTMconfig ").concat(JSON.stringify(i)," in ").concat(r.connectionState," state")),("CONNECTED"===r.connectionState||"RECONNECTING"===r.connectionState)&&r._joinInfo)return r._joinInfo.apRTM=a,r._joinInfo.rtmFlag=d,r._gateway.setRTM2Flag(d)})()}_reset(){if(I.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Ze.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._pendingPublishedUsers=[],this._users.forEach(i=>{i._audioTrack&&i._audioTrack._destroy(),i._videoTrack&&i._videoTrack._destroy(),i._dataChannels&&(i._dataChannels.forEach(r=>r._close()),i._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Ei("client-publish"),this._subscribeMutex=new Ei("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(i,r){var a;const d=i||Ac();I.debug(i?"[".concat(this._clientId,"] new Session ").concat(d):"[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(d));const l=i?"":this._sessionId||"";this._sessionId=d,this.store.sessionId=d;const h={lts:(new Date).getTime(),mode:this.mode,stringUid:r?.stringUid||(null===(a=this._joinInfo)||void 0===a?void 0:a.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:l,clientRole:"audience"===this.role?2:1};r?Ie.sessionInit(this._sessionId,rl({cname:r.channel,appid:r.appId},h)):this._joinInfo?Ie.sessionInit(this._sessionId,rl({cname:this._joinInfo.cname,appid:this._joinInfo.appId},h)):this._gateway.joinInfo&&Ie.sessionInit(this._sessionId,rl({cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId},h)),this._joinInfo&&(this._joinInfo.sid=d),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=d)}_publishHighStream(i){var r=this;return L(function*(){if(!r._joinInfo||void 0===r._uid)throw new W(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new W(k.INVALID_OPERATION,"can not publish stream in ".concat(r.connectionState," state"));if("auto"===r._turnServer.mode&&V("FORCE_TURN")&&!V("TURN_ENABLE_TCP")&&!V("TURN_ENABLE_UDP"))throw new W(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");I.debug("[".concat(r._clientId,"] publish high stream"));try{const d=yield r._p2pChannel.publish(i,r._isDualStreamEnabled,r._lowStreamParameter);if(r._p2pChannel instanceof Je){const l=(yield d.next()).value;if(l){try{yield r._gateway.sendExtensionMessage(mn.PUBLISH,l,!0)}catch(h){throw d.throw(h),h}yield d.next()}r._p2pChannel.reportPublishEvent(!0,null)}else{const l=(yield d.next()).value;if(l){var a;let h;try{h=yield r._gateway.publish(r._uid,l,!0)}catch(p){if(p.code!==k.DISCONNECT_P2P)throw d.throw(p),p}yield d.next((null===(a=h)||void 0===a?void 0:a.ortc)||[])}r._p2pChannel.reportPublishEvent(!0,null);for(const h of i)h instanceof je&&h._encoderConfig&&r._gateway.setVideoProfile(h._encoderConfig),!h.muted&&h.enabled||(yield r._p2pChannel.muteLocalTrack(h))}}catch(d){if(r._p2pChannel.reportPublishEvent(!1,d?.code,i),d?.code===k.WS_ABORT)return;throw d}})()}_publishLowStream(){var i=this;return L(function*(){if(!i._joinInfo||void 0===i._uid)throw new W(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==i.connectionState&&"RECONNECTING"!==i.connectionState)throw new W(k.INVALID_OPERATION,"can not publish stream in ".concat(i.connectionState," state"));I.debug("[".concat(i._clientId,"] publish low stream"));const r=i._configDistribute.getLowStreamConfigDistribute();r&&r.bitrate&&(i._lowStreamParameter||(i._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),i._lowStreamParameter&&i._lowStreamParameter.bitrate&&r.bitrate<i._lowStreamParameter.bitrate&&(i._lowStreamParameter.bitrate=r.bitrate));try{const d=yield i._p2pChannel.publishLowStream(i._lowStreamParameter),l=(yield d.next()).value;if(l){var a;let h;try{h=yield i._gateway.publish(i._uid,l,!0)}catch(p){if(p.code!==k.DISCONNECT_P2P)throw d.throw(p),p}d.next((null===(a=h)||void 0===a?void 0:a.ortc)||[]),i._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(d){if(i._p2pChannel.reportPublishEvent(!1,d?.code,void 0,!0),d?.code===k.WS_ABORT)return;throw d}})()}_createLiveStreamingClient(i){if(!this._joinInfo||!this._appId)return new W(k.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r=()=>new si(this._joinInfo,this._config.websocketRetryConfig||Pn,this._config.httpRetryConfig||Pn),a=d=>{d.onLiveStreamError=(l,h)=>{Ie.reportApiInvoke(this._sessionId,{name:Kn.ON_LIVE_STREAM_ERROR,options:[l,h],tag:qt.TRACER}).onSuccess(),this.safeEmit($e.LIVE_STREAMING_ERROR,l,h)},d.onLiveStreamWarning=(l,h)=>{Ie.reportApiInvoke(this._sessionId,{name:Kn.ON_LIVE_STREAM_WARNING,options:[l,h],tag:qt.TRACER}).onSuccess(),this.safeEmit($e.LIVE_STREAMING_WARNING,l,h)},d.on(da.REQUEST_WORKER_MANAGER_LIST,(l,h,p)=>{if(!this._joinInfo)return p(new W(k.INVALID_OPERATION,"can not find join info to get worker manager"));tN(l,this._joinInfo,this._axiosCancelSource.token,Pn).then(h).catch(p)})};switch(i){case qn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=r(),a(this._liveRawStreamingClient)),this._liveRawStreamingClient;case qn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=r(),a(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case qn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=r(),this._injectStreamingClient.on(da.REQUEST_WORKER_MANAGER_LIST,(d,l,h)=>{if(!this._joinInfo)return h(new W(k.INVALID_OPERATION,"can not find join info to get worker manager"));tN(d,this._joinInfo,this._axiosCancelSource.token,Pn).then(l).catch(h)}),this._injectStreamingClient.onInjectStatusChange=(d,l,h)=>{this.safeEmit($e.INJECT_STREAM_STATUS,d,l,h)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new W(k.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:i,sendResolutionHeight:r}=this.getLocalVideoStats();this._channelMediaRelayClient=new ib(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Pn,this._config.httpRetryConfig||Pn,{width:i,height:r}),this._channelMediaRelayClient.on("state",d=>{d===sr.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit($e.CHANNEL_MEDIA_RELAY_STATE,d)}),this._channelMediaRelayClient.on("event",d=>{this.safeEmit($e.CHANNEL_MEDIA_RELAY_EVENT,d)}),this._statsCollector.onStatsChanged=(d,l)=>{var h;"resolution"===d&&(null===(h=this._channelMediaRelayClient)||void 0===h||h.setVideoProfile(l))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(i,r){const{added:a,deleted:d}=i,l=[];Array.isArray(a)&&a.length>0&&a.forEach(h=>{const{uid:p,stream_id:m,ordered:_,max_retrans_times:v,metadata:b}=h,y=this._users.find(T=>T._uintid===p);if(y){if(I.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(p)),ye(l).call(l,y)||l.push(y),y._uintid||(y._uintid=p),-1===y._dataChannels.findIndex(T=>T.id===h.stream_id)){const T={id:m,ordered:!!_,maxRetransmits:v,metadata:b},M=new Z2(T);y._dataChannels.push(M),I.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published datachannel")),r||this.safeEmit($e.USER_PUBLISHED,y,"datachannel",T)}this._p2pChannel.hasPendingRemoteDataChannel(y,h.stream_id)&&(I.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(y.uid," after reconnect.")),this._subscribeDataChannel(y,h.stream_id).catch(T=>{I.error("[".concat(this._clientId,"] resubscribe datachannel error"),T.toString())}))}else I.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))}),r&&(this.safeEmit($e.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(d)&&d.length>0&&d.forEach(h=>{const{uid:p}=h,_=this._users.find(b=>b._uintid===p);if(!_)return void I.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=_._dataChannels.find(b=>b.id===h.stream_id);v&&(I.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(p)),this._p2pChannel.unsubscribeDataChannel(_,[v]).then(b=>{if(_._dataChannels=_._dataChannels.filter(y=>y!==v),b)return this._gateway.unsubscribeDataChannel(b,_.uid)}),I.info("[".concat(this._clientId,"] remote user ").concat(p," unpublished datachannel ,id:").concat(v.id)),this.safeEmit($e.USER_UNPUBLISHED,_,"datachannel",v._config))})}_handleRemoveDataChannels(i){const r=this._users.find(a=>a.uid===i.uid);if(r){if(void 0!==r._dataChannels&&r._dataChannels.length>0){I.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(i.uid));const a=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(d=>{this.safeEmit($e.USER_UNPUBLISHED,r,"datachannel",d._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(d=>{if(d)return this._gateway.unsubscribeDataChannel(d,r.uid)}),a()}}else I.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){var i=this;this._gateway.on(on.DISCONNECT_P2P,L(function*(){yield i._p2pChannel.disconnectForReconnect()})),this._gateway.on(on.CONNECTION_STATE_CHANGE,(r,a,d)=>{var l;if(d===ze.FALLBACK)return;const h=()=>{this.safeEmit($e.CONNECTION_STATE_CHANGE,r,a,d)};if(Ie.reportApiInvoke(this._sessionId||(null===(l=this._gateway.joinInfo)||void 0===l?void 0:l.sid)||null,{name:Kn.CONNECTION_STATE_CHANGE,options:[r,a,d],tag:qt.TRACER}).onSuccess(JSON.stringify({cur:r,prev:a,reason:d})),I.info("[".concat(this._clientId,"] connection state change: ").concat(a," -> ").concat(r)),"DISCONNECTED"===r)return this._reset(),void h();if("RECONNECTING"===r)this._users.forEach(m=>{m._trust_in_room_=!1,m._trust_audio_enabled_state_=!1,m._trust_video_enabled_state_=!1,m._trust_audio_mute_state_=!1,m._trust_video_mute_state_=!1,m._trust_audio_stream_added_state_=!1,m._trust_video_stream_added_state_=!1,m._is_pre_created||(m._audio_pre_subscribed||(m._audioSSRC=void 0,m._audioOrtc=void 0),m._video_pre_subscribed||(m._videoSSRC=void 0,m._videoOrtc=void 0,m._rtxSsrcId=void 0),m._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===r){var p;this._streamFallbackTypeCacheMap.forEach((m,_)=>{this._gateway.setStreamFallbackOption(_,m).catch(v=>{I.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),v)})}),this._remoteStreamTypeCacheMap.forEach((m,_)=>{this._gateway.setRemoteVideoStreamType(_,m).catch(v=>{I.warning("[".concat(this._clientId,"] auto set remote stream type failed"),v)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(p=this._joinInfo)||void 0===p?void 0:p.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{I.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(m=>{I.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(m))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(m=>!m._trust_in_room_).forEach(m=>{I.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(m.uid)),this._handleUserOffline({uid:m.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(m=>{m._trust_audio_mute_state_||(I.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(m.uid)),this._handleMuteStream(m.uid,Ce.AUDIO,!1)),m._trust_video_mute_state_||(I.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(m.uid)),this._handleMuteStream(m.uid,Ce.VIDEO,!1)),m._trust_audio_enabled_state_||(I.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(m.uid)),this._handleSetStreamLocalEnable("audio",m.uid,!0)),m._trust_video_enabled_state_||(I.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(m.uid)),this._handleSetStreamLocalEnable("video",m.uid,!0)),m._trust_video_stream_added_state_||(I.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(m.uid)),this._handleResetAddStream(m,"video")),m._trust_audio_stream_added_state_||(I.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(m.uid)),this._handleResetAddStream(m,"audio")),m._video_added_||m._audio_added_||(I.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(m.uid)),this._handleRemoveStream({uid:m.uid,uint_id:m._uintid}))}))},1e3))}h()}),this._gateway.on(on.REQUEST_NEW_GATEWAY_LIST,(r,a)=>{if(!this._joinInfo)return a(new W(k.UNEXPECTED_ERROR,"can not recover, no join info"));Tv(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Pn,this.store).then(d=>{this._joinInfo&&(this._joinInfo.apResponse=d.gatewayInfo.res,this._joinInfo.gatewayAddrs=d.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=d.gatewayInfo.uni_lbs_ip);const l=[];d.gatewayInfo.gatewayAddrs.forEach(h=>{let{address:p}=h;const[m,_]=p.split(":");l.push(this._joinInfo&&this._joinInfo.proxyServer?{proxy:this._joinInfo.proxyServer,host:m,port:_}:{host:m,port:_})}),r(l)}).catch(a)}),this._gateway.on(on.NETWORK_QUALITY,r=>{"normal"===this._networkQualitySensitivity&&this.safeEmit($e.NETWORK_QUALITY,r)}),this._gateway.on(on.STREAM_TYPE_CHANGE,(r,a)=>{this.safeEmit($e.STREAM_TYPE_CHANGED,r,a),Ie.reportApiInvoke(this._sessionId,{name:Kn.STREAM_TYPE_CHANGE,options:[r,a],tag:qt.TRACER}).onSuccess(JSON.stringify({uid:r,streamType:a}))}),this._gateway.on(on.IS_P2P_DISCONNECTED,r=>{this._p2pChannel.isP2PDisconnected()?r(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?r(!1):r(!0)}),this._gateway.on(on.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(on.REQUEST_P2P_CONNECTION_PARAMS,function(){var r=L(function*(a,d,l){try{d(yield i._p2pChannel.startP2PConnection(a))}catch(h){l(h)}});return function(a,d,l){return r.apply(this,arguments)}}()),this._gateway.on(on.JOIN_RESPONSE,(r,a)=>{if(this.store.useP2P)return;const{dtlsParameters:d,iceParameters:l,candidates:h,rtpCapabilities:p,setup:m,cname:_}=dP(r.ortc,a);this._p2pChannel.connect(l,d,h,p,m,_)}),this._gateway.on(on.REQUEST_DC_CONNECTION_PARAMS,r=>{r(this._p2pChannel.getEstablishParams())}),this._gateway.on(on.RESET_SIGNAL,r=>{this._p2pChannel.resetConnection(r),this._handleGatewaySignalEvents()}),this._gateway.on(on.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(on.DATACHANNEL_PRECONNECT,function(){var r=L(function*(a,d,l,h){var p,m,_,v,b,y;yield i._p2pChannel.startP2PConnection({turnServer:null===(p=i._joinInfo)||void 0===p?void 0:p.turnServer},!0);const T=function(M,O){let D;return O&&O.ip&&"number"==typeof O.port?(D=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:O.ip,port:O.port.toString(),type:"host",extension:{}}],I.debug("Using remote candidate from AP ".concat(O.ip,":").concat(O.port)),O.ip6&&(D.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:O.ip6,port:O.port.toString(),type:"host",extension:{}}),I.debug("Using IPV6 remote candidate from AP ".concat(O.ip6,":").concat(O.port)))):D=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:M.ip,port:M.port.toString(),type:"host",extension:{}}],D}(a,d);return i._p2pChannel.preConnect({iceUfrag:"".concat(null===(m=i._joinInfo)||void 0===m?void 0:m.apResponse.cid,"_").concat(null===(_=i._joinInfo)||void 0===_?void 0:_.apResponse.cert),icePwd:"".concat(null===(v=i._joinInfo)||void 0===v?void 0:v.apResponse.cid,"_").concat(null===(b=i._joinInfo)||void 0===b?void 0:b.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(y=V("FINGERPRINT"))&&void 0!==y?y:a.fingerprint}]},T,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(l).catch(h)});return function(a,d,l,h){return r.apply(this,arguments)}}())}_handleGatewaySignalEvents(){var i=this;this._gateway.signal.on(xe.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(xe.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(xe.ON_ADD_AUDIO_STREAM,r=>this._handleAddAudioOrVideoStream("audio",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc)),this._gateway.signal.on(xe.ON_ADD_VIDEO_STREAM,r=>this._handleAddAudioOrVideoStream("video",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc,r.rtxSsrcId)),this._gateway.signal.on(xe.ON_REMOTE_DATASTREAM_UPDATE,r=>{this._handleUpdateDataChannel(r)}),this._gateway.signal.on(xe.ON_REMOTE_FULL_DATASTREAM_INFO,r=>{this._handleUpdateDataChannel({added:r.datastreams,deleted:[]},!0)}),this._gateway.signal.on(xe.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(xe.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(xe.MUTE_AUDIO,r=>this._handleMuteStream(r.uid,Ce.AUDIO,!0)),this._gateway.signal.on(xe.UNMUTE_AUDIO,r=>this._handleMuteStream(r.uid,Ce.AUDIO,!1)),this._gateway.signal.on(xe.MUTE_VIDEO,r=>this._handleMuteStream(r.uid,Ce.VIDEO,!0)),this._gateway.signal.on(xe.UNMUTE_VIDEO,r=>this._handleMuteStream(r.uid,Ce.VIDEO,!1)),this._gateway.signal.on(xe.RECEIVE_METADATA,r=>{const a=cm(r.metadata);this.safeEmit($e.RECEIVE_METADATA,r.uid,a)}),this._gateway.signal.on(xe.ON_DATA_STREAM,function(){var r=L(function*(a){if(!a)return;let d=0;if(a.ordered||a.syncWithAudio){const l=i._p2pChannel.getStats(),h=i.remoteUsers.find(m=>m.uid===a.uid),p=l?.audioRecv.find(m=>m.ssrc===h?._audioSSRC);d=p?.jitterBufferMs}null==d&&(d=0),function VF(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!s.syncWithAudio)return _g(r,{uid:s.uid,payload:cm(s.payload)});const a="".concat(r.id,"-").concat(s.uid),d=VP.get(a)||[],l=d.findIndex(_=>s.sendTs>=_.sendTs),h=UP(UP({},s),{},{context:r,mediaDelay:i,recvTs:Date.now()});-1===l?d.push(h):d.splice(l,0,h),VP.set(a,d);let p=!1;var m;mb.has(a)?p=!(null===(m=mb.get(a))||void 0===m||!m.isSyncing):mb.set(a,{isSyncing:p,firstRecvTs:0,firstSendTs:0}),p||BP(a)}(a,d,{id:i._clientId,onStreamMessage:"function"==typeof i.onStreamMessage?i.onStreamMessage.bind(i):void 0,safeEmit:i.safeEmit.bind(i)})});return function(a){return r.apply(this,arguments)}}()),this._gateway.signal.on(xe.ON_CRYPT_ERROR,()=>{qh(()=>{I.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit($e.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(xe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{I.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,ze.TOKEN_EXPIRE),this.safeEmit($e.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(xe.ON_STREAM_FALLBACK_UPDATE,r=>{I.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(r.stream_id,", attr: ").concat(r.stream_type)),this.safeEmit($e.STREAM_FALLBACK,r.stream_id,1===r.stream_type?"fallback":"recover")}),this._gateway.signal.on(xe.ON_PUBLISH_STREAM,r=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:r.proxy})),I.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(r))))}),this._gateway.signal.on(xe.ENABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!0)}),this._gateway.signal.on(xe.DISABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!1)}),this._gateway.signal.on(ce.REQUEST_TIMEOUT,(r,a)=>{if(this._joinInfo)switch(r){case Ae.PUBLISH:{if(!a)return;const h=a.ortc;if(h){var d,l;const p=h.some(v=>{let{stream_type:b}=v;return b===ut.Audio}),m=h.some(v=>{let{stream_type:b}=v;return b!==ut.Audio}),_=h.some(v=>{let{stream_type:b}=v;return b===ut.Screen||b===ut.ScreenLow});"offer"===a.state&&Ie.publish(this._joinInfo.sid,{eventElapse:Li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:k.TIMEOUT,audio:p,video:m,p2pid:a.p2p_id,publishRequestid:this.store.pubId,screenshare:_,audioName:p?null===(d=h.find(v=>{let{stream_type:b}=v;return b===ut.Audio}))||void 0===d||null===(d=d.ssrcs[0])||void 0===d?void 0:d.ssrcId.toString():void 0,videoName:m?null===(l=h.find(v=>{let{stream_type:b}=v;return b!==ut.Audio}))||void 0===l||null===(l=l.ssrcs[0])||void 0===l?void 0:l.ssrcId.toString():void 0})}break}case Ae.SUBSCRIBE:a&&Ie.subscribe(this._joinInfo.sid,{succ:!1,ec:k.TIMEOUT,audio:a.stream_type===Ce.AUDIO,video:a.stream_type===Ce.VIDEO,peerid:a.stream_id,subscribeRequestid:a.ssrcId,p2pid:this.store.p2pId,eventElapse:Li.measureFromSubscribeStart(this.store.clientId,a.ssrcId)})}}),this._gateway.signal.on(xe.ON_P2P_OK,r=>{}),this._gateway.signal.on(xe.ON_PUBLISHED_USER_LIST,r=>{if(null==r||!r.users)return;V("BLOCK_LOCAL_CLIENT")&&(r.users=r.users.filter(l=>!nu(l.string_id||l.stream_id,this.channelName)));const a=[],d=[];for(const l of r.users){let h=this._users.find(y=>y._uintid===l.stream_id);h?h._trust_in_room_=!0:(h=new Ii(l.string_id||l.stream_id,l.stream_id),this._users.push(h),0===this.getListeners($e.PUBLISHED_USER_LIST).length&&(I.debug("[".concat(this._clientId,"] user online"),l.stream_id),this.safeEmit($e.USER_JOINED,h)));const p=Bn.Audio&l.stream_type,m=(Bn.Video|Bn.LwoVideo)&l.stream_type,_=0!=(65280&l.stream_type),v=p&&h.hasAudio,b=m&&h.hasVideo;m&&(h._trust_video_stream_added_state_=!0,h._video_added_=!0,h._videoSSRC=l.video_ssrc,h._rtxSsrcId=l.video_rtx),p&&(h._trust_audio_stream_added_state_=!0,h._audio_added_=!0,h._audioSSRC=l.audio_ssrc),p&&!v&&0===this.getListeners($e.PUBLISHED_USER_LIST).length&&(I.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published audio")),this.safeEmit($e.USER_PUBLISHED,h,"audio")),m&&!b&&0===this.getListeners($e.PUBLISHED_USER_LIST).length&&(I.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published video")),this.safeEmit($e.USER_PUBLISHED,h,"video")),(p&&!v||m&&!b||_)&&a.push(h),m&&this._p2pChannel.hasPendingRemoteMedia(h,"video")&&d.push({user:h,mediaType:"video"}),p&&this._p2pChannel.hasPendingRemoteMedia(h,"audio")&&d.push({user:h,mediaType:"audio"})}d.length>0&&(I.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(d.map(l=>"user: ".concat(l.user.uid,", mediaType: ").concat(l.mediaType)).join("; ")," ")),this.massSubscribe(d).catch(l=>{I.error("[".concat(this._clientId,"] mass resubscribe error"),l.toString())})),this.getListeners($e.PUBLISHED_USER_LIST).length>0?V("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=a:(I.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(a.map(l=>l.uid).join(", "))),this.safeEmit($e.PUBLISHED_USER_LIST,a)):I.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(a.map(l=>l.uid).join(", ")))}),this._gateway.signal.on(xe.ON_RTP_CAPABILITY_CHANGE,r=>{const{video_codec:a}=r;this._p2pChannel instanceof ai&&this._p2pChannel.updateRemoteRTPCapabilities(a.map(d=>d.toLowerCase()).filter(d=>{var l;return ye(l=Object.keys(Mc)).call(l,d)}))})}_handleP2PEvents(){var i=this;this._gateway.signal.on(xe.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(mn.PUBLISH,(r,a,d)=>{const{uid:l}=r;r.forEach(h=>{const{kind:p,ssrcs:m,mid:_,isMuted:v}=h;this._handleP2PAddAudioOrVideoStream(p,l,m[0].ssrcId,_);const b=this._users.find(y=>y.uid===l);return b&&this._p2pChannel instanceof Je?this._p2pChannel.mockSubscribe(b,p,m[0].ssrcId,_).then(()=>{a()}).catch(d):a(),this._handleMuteStream(l,p,!!v)})}),this._gateway.signal.on(mn.CALL,function(){var r=L(function*(a,d,l){if(i._p2pChannel instanceof Je)try{var h;d(yield i._p2pChannel.startP2P({turnServer:null===(h=i._joinInfo)||void 0===h?void 0:h.turnServer},a))}catch(p){l(p)}});return function(a,d,l){return r.apply(this,arguments)}}()),this._gateway.signal.on(ce.P2P_CONNECTION,function(){var r=L(function*(a){i._p2pChannel instanceof Je&&(yield i._p2pChannel.p2pConnect(a))});return function(a){return r.apply(this,arguments)}}()),this._gateway.signal.on(mn.UNPUBLISH,function(){var r=L(function*(a,d,l){if(i._p2pChannel instanceof Je){const{unpubMsg:h,uid:p}=a,m=i._users.find(_=>_.uid===p);if(!m)return I.warning("[".concat(i._clientId,"] can not find remote user, ignore mute event, uid: ").concat(p)),void d();try{h.forEach(function(){var _=L(function*(v){let{stream_type:b}=v;const y=b===ut.Audio?Ce.AUDIO:Ce.VIDEO;yield i._p2pChannel.unsubscribe(m,y),i._handleMuteStream(p,y,!0)});return function(v){return _.apply(this,arguments)}}()),d()}catch(_){l(_)}}});return function(a,d,l){return r.apply(this,arguments)}}()),this._gateway.signal.on(mn.CONTROL,function(){var r=L(function*(a,d){const{action:l}=a;switch(l){case Uc.MUTE_LOCAL_VIDEO:i._handleMuteStream(d,Ce.VIDEO,!0);break;case Uc.MUTE_LOCAL_AUDIO:i._handleMuteStream(d,Ce.AUDIO,!0);break;case Uc.UNMUTE_LOCAL_VIDEO:i._handleP2PAddAudioOrVideoStream("video",d),i._handleMuteStream(d,Ce.VIDEO,!1);break;case Uc.UNMUTE_LOCAL_AUDIO:i._handleP2PAddAudioOrVideoStream("audio",d),i._handleMuteStream(d,Ce.AUDIO,!1)}});return function(a,d){return r.apply(this,arguments)}}()),this._gateway.signal.on(mn.RESTART_ICE,function(){var r=L(function*(a,d,l){if(i._p2pChannel instanceof Je)try{const{direction:h,iceParameter:p}=a;h!==vi.SEND_ONLY||p?d(yield i._p2pChannel.restartICE(h,p)):(i._p2pChannel.handleDisconnect(h),d())}catch(h){l(h)}});return function(a,d,l){return r.apply(this,arguments)}}()),this._gateway.signal.on(mn.CANDIDATE,r=>{if(this._p2pChannel instanceof Je){const{candidate:a,direction:d}=r;this._p2pChannel.addRemoteCandidate(a,d)}}),this._p2pChannel.on(Oe.RequestP2PRestartICE,function(){var r=L(function*(a,d,l){try{const{direction:h}=a;d(yield i._gateway.sendExtensionMessage(mn.RESTART_ICE,a,h===vi.SEND_ONLY))}catch(h){l(h)}});return function(a,d,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.LocalCandidate,r=>{this._gateway.sendExtensionMessage(mn.CANDIDATE,JSON.stringify(r),!0)}),this._p2pChannel.on(Oe.RequestP2PMuteLocal,function(){var r=L(function*(a,d,l){try{yield i._gateway.sendExtensionMessage(mn.CONTROL,a,!0),d()}catch(h){l(h)}});return function(a,d,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.RequestP2PUnmuteRemote,function(){var r=L(function*(a,d,l){if(i._joinInfo)try{yield i._gateway.unmuteRemote(a,i._joinInfo.stringUid||i._joinInfo.uid),d()}catch(h){h.code===k.DISCONNECT_P2P?d():l(h)}else d()});return function(a,d,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.RequestP2PMuteRemote,function(){var r=L(function*(a,d,l){if(i._joinInfo)try{yield i._gateway.muteRemote(a,i._joinInfo.stringUid||i._joinInfo.uid),d()}catch(h){h.code===k.DISCONNECT_P2P?d():l(h)}else d()});return function(a,d,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.StateChange,(r,a)=>{a===Dt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){var i=this;this._p2pChannel.on(Oe.RequestMuteLocal,function(){var r=L(function*(a,d,l){if(i._joinInfo)try{yield i._gateway.muteLocal(a,i._joinInfo.stringUid||i._joinInfo.uid),d()}catch(h){h.code===k.DISCONNECT_P2P?d():l(h)}else d()});return function(a,d,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.RequestUnmuteLocal,function(){var r=L(function*(a,d,l){if(i._joinInfo)try{yield i._gateway.unmuteLocal(a,i._joinInfo.stringUid||i._joinInfo.uid),d()}catch(h){h.code===k.DISCONNECT_P2P?d():l(h)}else d()});return function(a,d,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.RequestRePublish,(r,a,d)=>{this.publish(r,!1).then(a).catch(d)}),this._p2pChannel.on(Oe.RequestRePublishDataChannel,(r,a,d)=>{X.all(r.map(function(){var l=L(function*(h){yield i._p2pChannel.publishDataChannel([h]);const p={streamId:h.id,ordered:h.ordered,maxRetransmits:h.maxRetransmits,metadata:h.metadata,channelId:h._originDataChannelId};try{yield i._gateway.publishDataChannel(i._uid,p,!0)}catch(m){if(m.code!==k.DISCONNECT_P2P)throw m}});return function(h){return l.apply(this,arguments)}}())).then(a).catch(d)}),this._p2pChannel.on(Oe.RequestReSubscribe,function(){var r=L(function*(a,d,l){try{for(const{user:h,kind:p}of a)p===Ce.VIDEO?yield i.subscribe(h,"video"):yield i.subscribe(h,"audio");d()}catch(h){l(h)}});return function(a,d,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.RequestUpload,(r,a)=>{this._gateway.upload(r,a)}),this._p2pChannel.on(Oe.RequestUploadStats,r=>{this._gateway.uploadWRTCStats(r)}),this._p2pChannel.on(Oe.MediaReconnectStart,r=>{this.safeEmit($e.MEDIA_RECONNECT_START,r)}),this._p2pChannel.on(Oe.MediaReconnectEnd,r=>{this.safeEmit($e.MEDIA_RECONNECT_END,r)}),this._p2pChannel.on(Oe.NeedSignalRTT,r=>{r(this._gateway.getSignalRTT())}),this._p2pChannel.on(Oe.RequestRestartICE,function(){var r=L(function*(a){if(i._p2pChannel instanceof Je)return;const d=yield i._p2pChannel.restartICE(a),l=yield d.next();if(l.done)return;const h=l.value;let p;try{p=yield i._gateway.restartICE({iceParameters:h})}catch(_){return void d.throw(_)}const{iceParameters:m}=function(_){const v=_.iceParameters;return{iceParameters:{iceUfrag:v.iceUfrag,icePwd:v.icePwd}}}(p);yield d.next({remoteIceParameters:m})});return function(a){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.RequestReconnect,L(function*(){i._gateway.reconnect()})),this._p2pChannel.on(Oe.RequestReconnectPC,L(function*(){var r;const{iceParameters:a,dtlsParameters:d,rtpCapabilities:l}=yield i._p2pChannel.startP2PConnection({turnServer:null===(r=i._joinInfo)||void 0===r?void 0:r.turnServer}),{gatewayEstablishParams:h,gatewayAddress:p}=yield i._gateway.reconnectPC({iceParameters:a,dtlsParameters:d,rtpCapabilities:l}),{dtlsParameters:m,iceParameters:_,candidates:v,rtpCapabilities:b,setup:y,cname:T}=dP(h,p);yield i._p2pChannel.connect(_,m,v,b,y,T),yield i._p2pChannel.republish(),yield i._p2pChannel.reSubscribe()})),this._p2pChannel.on(Oe.RequestUnpublishForReconnectPC,function(){var r=L(function*(a,d,l){i._joinInfo&&void 0!==i._uid?(yield i._gateway.unpublish(a,i._uid),d()):l()});return function(a,d,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(Oe.P2PLost,()=>{this.safeEmit($e.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Oe.UpdateVideoEncoder,r=>{r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig)}),this._p2pChannel.on(Oe.ConnectionTypeChange,r=>{this.safeEmit($e.IS_USING_CLOUD_PROXY,r)}),this._p2pChannel.on(Oe.RequestLowStreamParameter,r=>{r(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Oe.QueryClientConnectionState,r=>{r(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}enableContentInspect(i){var r=this;return L(function*(){if("CONNECTED"!==r.connectionState||!r._joinInfo)throw new W(k.INVALID_OPERATION,"[".concat(r._clientId,"] Client did not join channel"));if(r._inspect)throw new W(k.INVALID_OPERATION,"[".concat(r._clientId,"] Inspect content service already in connecting/connected state"));if(!i)throw new W(k.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig is necessary"));if(!i.inspectType||!Array.isArray(i.inspectType))throw new W(k.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const a=[...new Set(i.inspectType)];a.forEach(d=>{var l;if(!ye(l=["supervise","moderation"]).call(l,d))throw new W(k.INVALID_PARAMS,"[".concat(r._clientId,"] ").concat(d," is not a valid inspect type."))}),i.inspectType=a}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new W(k.INVALID_PARAMS,"[".concat(r._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const a=new pb(i);r._inspect=a,r.handleVideoInspectEvents(r._inspect),yield a.init({appId:r._joinInfo.appId,areaCode:"",cname:r._joinInfo.cname,sid:r._joinInfo.sid,token:r._joinInfo.token,uid:r._joinInfo.uid,cid:r._joinInfo.cid,vid:r._joinInfo.vid?Number(r._joinInfo.vid):0},Pn)}catch(a){throw Array.isArray(a)?a[0]:a}})()}disableContentInspect(){var i=this;return L(function*(){if(!i._inspect)throw new W(k.INVALID_OPERATION,"[".concat(i._clientId,"] inspectVideoContent not started"));try{i._inspect.close(),i._inspect=void 0}catch(r){throw Array.isArray(r)?r[0]:r}})()}setImageModeration(i,r){var a=this;return L(function*(){if(wc(i,"enabled"),i){if(!r)throw new W(k.INVALID_PARAMS,"[".concat(a._clientId,"] config is necessary"));if(At(r.interval,"interval",1e3,1/0),r&&r.extraInfo&&r.extraInfo.length>1024)throw new W(k.INVALID_PARAMS,"[".concat(a._clientId,"] config.extraInfo length cannot exceed 1024 bytes"));if(r&&r.vendor&&r.vendor.length>1024)throw new W(k.INVALID_PARAMS,"[".concat(a._clientId,"] config.vendor length cannot exceed 1024 bytes"));if("CONNECTED"!==a.connectionState||!a._joinInfo)throw new W(k.INVALID_OPERATION,"[".concat(a._clientId,'] can not enable image moderation, not joined"'));try{if(a._moderation)return void a._moderation.updateConfig(r);const d=new Y0(r);a._moderation=d,a.handleImageModerationEvents(a._moderation),yield d.init({appId:a._joinInfo.appId,areaCode:"",cname:a._joinInfo.cname,sid:a._joinInfo.sid,token:a._joinInfo.token,uid:a._joinInfo.uid,cid:a._joinInfo.cid,vid:a._joinInfo.vid?Number(a._joinInfo.vid):0},Pn)}catch(d){throw Array.isArray(d)?d[0]:d}}else{if(!a._moderation)throw new W(k.INVALID_OPERATION,"[".concat(a._clientId,"] image moderation not started"));try{a._moderation.close(),a._moderation.removeAllListeners(),a._moderation=void 0}catch(d){throw Array.isArray(d)?d[0]:d}}})()}setP2PTransport(i){if(Sn(i,"transport",["default","auto","relay","sd-rtn"]),"p2p"!==this.mode)throw new W(k.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=i,I.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(i))}handleImageModerationEvents(i){i.on(us.CONNECTION_STATE_CHANGE,(r,a)=>{if(this.safeEmit($e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,a),r===Kr.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new W(k.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");i.inspectImage()}}),i.on(us.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(a=>"video"===a.trackMediaType)[0])})}handleVideoInspectEvents(i){i.on(ii.CONNECTION_STATE_CHANGE,(r,a)=>{if(this.safeEmit($e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,a),a===Oo.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit($e.CONTENT_INSPECT_ERROR,new W(k.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));i.inspectImage()}}),i.on(ii.INSPECT_RESULT,(r,a)=>{var d;if(a?.code===k.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return I.debug("Stop inspect content because that has left channel"),null==this||null===(d=this._inspect)||void 0===d||d.close(),void(this._inspect=void 0);this.safeEmit($e.CONTENT_INSPECT_RESULT,r,a)}),i.on(ii.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(a=>"video"===a.trackMediaType)[0])})}getJoinChannelServiceRecords(){return I.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}setPublishAudioFilterEnabled(i){var r=this;return L(function*(){wc(i,"enabled"),It("ENABLE_PUBLISH_AUDIO_FILTER",i),r._joinInfo&&(yield r._gateway.setPublishAudioFilterEnabled(i))})()}_handleResetAddStream(i,r){switch(r){case"audio":i._audio_added_=!1,i._trust_audio_stream_added_state_=!0;break;case"video":i._video_added_=!1,i._trust_video_stream_added_state_=!0}}}ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],Mt.prototype,"leave",null),ne([we({argsMap:(s,i)=>{if(!Array.isArray(i)){if(!(i instanceof Bi))return[i];i=[i]}return i.map(r=>r?Object(r).toString():"null")}}),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",X)],Mt.prototype,"publish",null),ne([we({argsMap:(s,i)=>(i||(i=[]),i instanceof eF?[i.getChannelId()]:(Array.isArray(i)||(i=[i]),i.map(r=>r.getTrackId())))}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],Mt.prototype,"unpublish",null),ne([we({argsMap:(s,i,r,a)=>[i.uid,r,a]}),N("design:type",Function),N("design:paramtypes",[Ii,String,Number]),N("design:returntype",X)],Mt.prototype,"subscribe",null),ne([we({argsMap:(s,i,r)=>[i,r]}),N("design:type",Function),N("design:paramtypes",[Object,String]),N("design:returntype",X)],Mt.prototype,"presubscribe",null),ne([we({argsMap:(s,i)=>i.map(r=>{let{user:a,mediaType:d}=r;return[a?.uid,d]})}),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Mt.prototype,"massSubscribe",null),ne([we({argsMap:(s,i,r,a)=>[i.uid,r,a]}),N("design:type",Function),N("design:paramtypes",[Ii,String,Number]),N("design:returntype",X)],Mt.prototype,"unsubscribe",null),ne([we({argsMap:(s,i)=>i.map(r=>{let{user:a,mediaType:d}=r;return{uid:a?.uid,mediaType:d}})}),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",X)],Mt.prototype,"massUnsubscribe",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],Mt.prototype,"setLowStreamParameter",null),ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],Mt.prototype,"enableDualStream",null),ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],Mt.prototype,"disableDualStream",null),ne([we(),N("design:type",Function),N("design:paramtypes",[String,Object]),N("design:returntype",X)],Mt.prototype,"setClientRole",null),ne([we(),N("design:type",Function),N("design:paramtypes",[String,Boolean]),N("design:returntype",void 0)],Mt.prototype,"setProxyServer",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",void 0)],Mt.prototype,"setTurnServer",null),ne([we(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",void 0)],Mt.prototype,"setLicense",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],Mt.prototype,"startProxyServer",null),ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Mt.prototype,"stopProxyServer",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],Mt.prototype,"setLocalAccessPointsV2",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Array,String]),N("design:returntype",void 0)],Mt.prototype,"setLocalAccessPoints",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",X)],Mt.prototype,"setRemoteDefaultVideoStreamType",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",X)],Mt.prototype,"setRemoteVideoStreamType",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",X)],Mt.prototype,"setStreamFallbackOption",null),ne([we({argsMap:(s,i)=>[i]}),N("design:type",Function),N("design:paramtypes",[String,String,Uint8Array]),N("design:returntype",void 0)],Mt.prototype,"setEncryptionConfig",null),ne([we(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],Mt.prototype,"renewToken",null),ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Mt.prototype,"enableAudioVolumeIndicator",null),ne([we(),N("design:type",Function),N("design:paramtypes",[String,Boolean]),N("design:returntype",X)],Mt.prototype,"startLiveStreaming",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],Mt.prototype,"setLiveTranscoding",null),ne([we(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",X)],Mt.prototype,"stopLiveStreaming",null),ne([we(),N("design:type",Function),N("design:paramtypes",[String,Object]),N("design:returntype",X)],Mt.prototype,"addInjectStreamUrl",null),ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],Mt.prototype,"removeInjectStreamUrl",null),ne([we(),N("design:type",Function),N("design:paramtypes",[nb]),N("design:returntype",X)],Mt.prototype,"startChannelMediaRelay",null),ne([we(),N("design:type",Function),N("design:paramtypes",[nb]),N("design:returntype",X)],Mt.prototype,"updateChannelMediaRelay",null),ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],Mt.prototype,"stopChannelMediaRelay",null),ne([we({argsMap:(s,i)=>(Array.isArray(i)||(i=[i]),[JSON.stringify(i)])}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],Mt.prototype,"sendCustomReportMessage",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",X)],Mt.prototype,"pickSVCLayer",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],Mt.prototype,"setRTMConfig",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",X)],Mt.prototype,"enableContentInspect",null),ne([we(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",X)],Mt.prototype,"disableContentInspect",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Boolean,Object]),N("design:returntype",X)],Mt.prototype,"setImageModeration",null),ne([we(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",void 0)],Mt.prototype,"setP2PTransport",null),ne([we({reportResult:!0}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Array)],Mt.prototype,"getJoinChannelServiceRecords",null),ne([we(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",X)],Mt.prototype,"setPublishAudioFilterEnabled",null);class Eg{constructor(i,r){S(this,"id",0),S(this,"element",void 0),S(this,"peerPair",void 0),S(this,"context",void 0),S(this,"audioPlayerElement",void 0),S(this,"audioTrack",void 0),Eg.count+=1,this.id=Eg.count,this.element=i,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=i=>{const r=document.createElement("audio");r.srcObject=new MediaStream([i.track]),r.play(),this.audioPlayerElement=r}}switchSdp(){var i=this;return L(function*(){if(!i.peerPair)return;const r=function(){var d=L(function*(l,h){const p="offer"===h?yield l.createOffer():yield l.createAnswer();return yield l.setLocalDescription(p),"complete"===l.iceGatheringState?l.localDescription:new X(m=>{l.onicegatheringstatechange=()=>{"complete"===l.iceGatheringState&&m(l.localDescription)}})});return function(h,p){return d.apply(this,arguments)}}(),a=function(){var d=L(function*(l,h){return yield l.setRemoteDescription(h)});return function(h,p){return d.apply(this,arguments)}}();try{const d=yield r(i.peerPair[0],"offer");yield a(i.peerPair[1],d);const l=yield r(i.peerPair[1],"answer");yield a(i.peerPair[0],l)}catch(d){throw new W(k.LOCAL_AEC_ERROR,d.toString()).print()}})()}getTracksFromMediaElement(i){var r=this;return L(function*(){if(r.audioTrack)return r.audioTrack;let a;try{i instanceof HTMLVideoElement&&(i.captureStream?i.captureStream():i.mozCaptureStream()),a=r.context.createMediaStreamDestination(),r.context.createMediaElementSource(i).connect(a)}catch(l){throw new W(k.LOCAL_AEC_ERROR,l.toString()).print()}if(!a)throw new W(k.LOCAL_AEC_ERROR,"no dest node when local aec").print();const d=a.stream.getAudioTracks()[0];return r.audioTrack=d,d})()}getElement(){return this.element}startEchoCancellation(){var i=this;return L(function*(){i.context.resume(),i.peerPair&&i.close(),i.initPeers();const r=i.element,a=yield i.getTracksFromMediaElement(r);i.peerPair&&i.peerPair[0].addTrack(a),yield i.switchSdp()})()}close(){I.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(i=>{i.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}S(Eg,"count",0);const jF=window.AudioContext||window.webkitAudioContext;class HP{constructor(){S(this,"units",[]),S(this,"context",void 0)}processExternalMediaAEC(i){if(!this._doesEnvironmentNeedAEC())return I.debug("the system does not need to process local aec"),-1;this.context||(this.context=new jF);let r=this.units.find(a=>a&&a.getElement()===i);return r||(r=new Eg(i,this.context),this.units.push(r)),r.startEchoCancellation(),I.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return lt().name!==Et.SAFARI}}ne([we({report:Ie}),N("design:type",Function),N("design:paramtypes",[HTMLAudioElement]),N("design:returntype",Number)],HP.prototype,"processExternalMediaAEC",null);const wB=new HP;function HF(s,i){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);i&&(a=a.filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable})),r.push.apply(r,a)}return r}function GP(s){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?HF(Object(r),!0).forEach(function(a){S(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):HF(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}const J0=window||document;function WP(s){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!J0)return;const r=Xn._cspEventHandlerPointer;if(r&&i)return void console.error(r,i);const a=d=>{if(!(d&&d.blockedURI&&(Xn.onSecurityPolicyViolation||Xn.getListeners(ls.SECURITY_POLICY_VIOLATION).length>0)))return;const l=d.blockedURI;V("CSP_DETECTED_HOSTNAME_LIST").some(h=>ye(l).call(l,h))&&(Xn.onSecurityPolicyViolation&&"function"==typeof Xn.onSecurityPolicyViolation&&Xn.onSecurityPolicyViolation(d),Xn.getListeners(ls.SECURITY_POLICY_VIOLATION).length>0&&Xn.safeEmit(ls.SECURITY_POLICY_VIOLATION,d))};r&&J0.removeEventListener("securitypolicyviolation",r),(i||s&&"function"==typeof s||Xn.getListeners(ls.SECURITY_POLICY_VIOLATION).length>0)&&J0.addEventListener("securitypolicyviolation",a),Xn._cspEventHandlerPointer=a}It("PROCESS_ID","process-".concat(Ke(8,""),"-").concat(Ke(4,""),"-").concat(Ke(4,""),"-").concat(Ke(4,""),"-").concat(Ke(12,""))),function(){let s;try{s=window.localStorage.getItem("websdk_ng_global_parameter")}catch(i){return void I.error("Error loading sdk config",i.message)}if(s)try{const i=JSON.parse(window.atob(s)),r=Date.now();I.debug("Loading global parameters from cache",i),Object.keys(i).forEach(a=>{if(Object.prototype.hasOwnProperty.call(_r,a)){const{value:d,expires:l}=i[a];if(l&&l<=r)return;kd[a]=d,_r[a]=d}})}catch(i){I.error("Error loading mutableParamsCache: ".concat(s),i.message)}}(),Array.isArray(kd.AREAS)&&kd.AREAS.length>0&&hp(kd.AREAS,!0);const GF=(s,i,r)=>{I.debug("setParameter key:".concat(s,", value:").concat(JSON.stringify(i))),It(s,i,r)},Xn=function(s){const i=new jt,r=s,a={getListeners:i.getListeners.bind(i),on:(d,l)=>(d===ls.SECURITY_POLICY_VIOLATION&&WP(l,!0),i.on.bind(i)(d,l)),addListener:i.addListener.bind(i),once:i.once.bind(i),off:i.off.bind(i),removeAllListeners:i.removeAllListeners.bind(i),emit:i.emit.bind(i),safeEmit:i.safeEmit.bind(i)};return GP(GP({},r),a)}({__TRACK_LIST__:du,VERSION:Do,BUILD:rT,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:GF,getParameter:V,getSupportedCodec:function(){var s=L(function*(){let i={audio:[],video:[]};try{let r=new RTCPeerConnection;r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});const a=(yield r.createOffer()).sdp;if(!a)return i;r.close(),r=null,i=function(d){const l={video:[],audio:[]};return d.match(/ VP8/i)&&l.video.push("VP8"),d.match(/ VP9/i)&&l.video.push("VP9"),d.match(/ AV1/i)&&l.video.push("AV1"),d.match(/ H264/i)&&l.video.push("H264"),d.match(/ H265/i)&&l.video.push("H265"),d.match(/ opus/i)&&l.audio.push("OPUS"),d.match(/ PCMU/i)&&l.audio.push("PCMU"),d.match(/ PCMA/i)&&l.audio.push("PCMA"),d.match(/ G722/i)&&l.audio.push("G722"),l}(a)}catch(r){throw new W(k.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return i});return function(){return s.apply(this,arguments)}}(),checkSystemRequirements:function(){const s=Ie.reportApiInvoke(null,{name:Kn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:qt.TRACER});let i=!1;try{const l=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,p=window.WebSocket;i=!!(l&&h&&p)}catch(l){return I.error("check system requirement failed: ",l),!1}let r=!1;const a=lt();a.name===Et.CHROME&&Number(a.version)>=58&&(!function gD(){return"WebKit"===Sc.engine.name}()||function mD(){const s=lt();if(LE()){if(s.os===ei.MAC_OS)return!0;if(s.os===ei.IOS){const i=Sc.os.version&&Sc.os.version.split(".");if(i&&14===Number(i[0])&&i[1]&&Number(i[1])>=3||i&&Number(i[0])>14)return!0}}return!1}())&&(r=!0),a.name===Et.FIREFOX&&Number(a.version)>=56&&(r=!0),a.name===Et.OPERA&&Number(a.version)>=45&&(r=!0),a.name===Et.SAFARI&&Number(a.version)>=11&&(r=!0),(yD()||lt().name===Et.QQ)&&(r=!0),I.debug("checkSystemRequirements, api:",i,"browser",r);const d=i&&r;return s.onSuccess(d),d},getDevices:function(s){return Lo.enumerateDevices(!0,!0,s)},getMicrophones:function(s){return Lo.getRecordingDevices(s)},getCameras:function(s){return Lo.getCamerasDevices(s)},getElectronScreenSources:s2,getPlaybackDevices:function(s){return Lo.getSpeakers(s)},createClient:function(){var s;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const r=Ie.reportApiInvoke(null,{name:Kn.CREATE_CLIENT,options:[i],tag:qt.TRACER});try{Sn((a=i).codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Sn(a.mode,"config.mode",["rtc","live","p2p"]),void 0!==a.audioCodec&&Sn(a.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==a.proxyServer&&hi(a.proxyServer,"config.proxyServer",1,1e4),void 0!==a.turnServer&&Kh(a.turnServer),void 0!==a.httpRetryConfig&&wD(a.httpRetryConfig),void 0!==a.websocketRetryConfig&&wD(a.websocketRetryConfig)}catch(a){throw r.onError(a),a}var a;return function BF(){return!function(s,i,r){const a=lt();if(a.os!==ei.IOS||!a.osVersion)return!1;const d=a.osVersion.split(".");return Number(d[0])<16}()&&!function(s,i,r){const a=lt();if(a.name!==Et.SAFARI||!a.osVersion)return!1;const d=a.version.split(".");return Number(d[0])<16}()}()||("vp9"===i.codec&&(i.codec="vp8",I.debug("browser not support vp9, force use vp8")),It("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===i.audioCodec&&(i.audioCodec="opus"),r.onSuccess(),new Mt(rl(rl({forceWaitGatewayResponse:!0},i),{},{role:ye(s=["rtc","p2p"]).call(s,i.mode)?"host":i.role||"audience"}))},createCameraVideoTrack:function(){var s=L(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=Ie.reportApiInvoke(null,{tag:qt.TRACER,name:Kn.CREATE_CAM_VIDEO_TRACK,options:[Gm({},i)]}),a=Nv(i),d=Ke(8,"track-cam-");let l=null;const h="720p_auto"===i.encoderConfig;I.info("start create camera video track with config",JSON.stringify(i),"trackId",d);try{l=(yield ko({video:a},d)).getVideoTracks()[0]||null}catch(m){throw r.onError(m),m}if(!l){const m=new ee(k.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(m),m.throw(I)}i.optimizationMode&&Wm(d,l,i,xo(i.encoderConfig));const p=new gs(l,i,a,i.scalabiltyMode?xm(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,d);return h&&p.startMonitorStats(),r.onSuccess(p.getTrackId()),I.info("create camera video success, trackId:",d),p});return function(){return s.apply(this,arguments)}}(),createCustomVideoTrack:function(s){const i=Ie.reportApiInvoke(null,{tag:qt.TRACER,name:Kn.CREATE_CUSTOM_VIDEO_TRACK,options:[s]}),r=new je(s.mediaStreamTrack,{width:s.width,height:s.height,frameRate:s.frameRate,bitrateMax:s.bitrateMax,bitrateMin:s.bitrateMin},s.scalabiltyMode?xm(s.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},s.optimizationMode,Ke(8,"track-cus-"),[kt.CUSTOM_TRACK]);return i.onSuccess(r.getTrackId()),I.info("create custom video track success with config",s,"trackId",r.getTrackId()),r},createScreenVideoTrack:function(){var s=L(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const a=Ie.reportApiInvoke(null,{tag:qt.TRACER,name:Kn.CREATE_SCREEN_VIDEO_TRACK,options:[Gm({},i),r]}),d="720p_auto"===i.encoderConfig;i.encoderConfig?"string"==typeof i.encoderConfig||i.encoderConfig.width&&i.encoderConfig.height||(i.encoderConfig.width={max:1920},i.encoderConfig.height={max:1080}):i.encoderConfig="1080p_2";const l=function(y){const T={};y.screenSourceType&&(T.mediaSource=y.screenSourceType),y.extensionId&&nm()&&(T.extensionId=y.extensionId);const{displaySurface:M,selfBrowserSurface:O,surfaceSwitching:D,systemAudio:x}=y;(im(107)||_D(107)||bL(93))&&(M&&(Sn(M,"displaySurface",["browser","window","monitor"]),T.displaySurface=M),O?(Sn(O,"selfBrowserSurface",["exclude","include"]),T.selfBrowserSurface=O):T.selfBrowserSurface="include",D&&(Sn(D,"surfaceSwitching",["exclude","include"]),T.surfaceSwitching=D)),(im(105)||_D(105)||bL(91))&&x&&(Sn(x,"systemAudio",["exclude","include"]),T.systemAudio=x),y.electronScreenSourceId&&(T.sourceId=y.electronScreenSourceId);const F=y.encoderConfig?wv(y.encoderConfig):null;return T.mandatory={chromeMediaSource:"desktop",maxWidth:F?F.width:void 0,maxHeight:F?F.height:void 0},F&&(F.frameRate&&("number"==typeof F.frameRate?(T.mandatory.maxFrameRate=F.frameRate,T.mandatory.minFrameRate=F.frameRate):(T.mandatory.maxFrameRate=F.frameRate.max||F.frameRate.ideal||F.frameRate.exact||void 0,T.mandatory.minFrameRate=F.frameRate.min||F.frameRate.ideal||F.frameRate.exact||void 0),T.frameRate=F.frameRate),F.width&&(T.width=F.width),F.height&&(T.height=F.height)),T}(i),h=Ke(8,"track-scr-v-");let p=null,m=null;const _=Ot();if(!_.supportShareAudio&&"enable"===r){const y=new ee(k.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return a.onError(y),y.throw(I)}I.info("start create screen video track with config",i,"withAudio",r,"trackId",h);try{const y=yield ko({screen:l,screenAudio:"auto"===r?_.supportShareAudio:"enable"===r},h);p=y.getVideoTracks()[0]||null,m=y.getAudioTracks()[0]||null}catch(y){throw a.onError(y),y}if(!p){const y=new ee(k.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(y),y.throw(I)}if(!m&&"enable"===r){p&&p.stop();const y=new ee(k.SHARE_AUDIO_NOT_ALLOWED);return a.onError(y),y.throw(I)}i.optimizationMode||(i.optimizationMode="detail"),i.optimizationMode&&(Wm(h,p,i,i.encoderConfig&&wv(i.encoderConfig)||void 0),i.encoderConfig&&"string"!=typeof i.encoderConfig&&(i.encoderConfig.bitrateMin=i.encoderConfig.bitrateMax));const v=new je(p,i.encoderConfig?wv(i.encoderConfig):{},i.scalabiltyMode?xm(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,h,[kt.SCREEN_TRACK]);if(d&&v.startMonitorStats(),!m)return a.onSuccess(v.getTrackId()),I.info("create screen video track success","video:",v.getTrackId()),v;const b=new vt(m,void 0,Ke(8,"track-scr-a-"),!1,!0);return a.onSuccess([v.getTrackId(),b.getTrackId()]),I.info("create screen video track success","video:",v.getTrackId(),"audio:",b.getTrackId()),[v,b]});return function(){return s.apply(this,arguments)}}(),createMicrophoneAndCameraTracks:function(){var s=L(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=Ie.reportApiInvoke(null,{tag:qt.TRACER,name:Kn.CREATE_MIC_AND_CAM_TRACKS,options:[i,r]}),d="720p_auto"===r.encoderConfig,l=Nv(r),h=p2(i),p=Ke(8,"track-mic-"),m=Ke(8,"track-cam-");let _=null,v=null;I.info("start create camera video track(".concat(m,") and microphone audio track(").concat(p,") with config, audio: ").concat(JSON.stringify(i),", video: ").concat(JSON.stringify(r)));try{const T=yield ko({audio:h,video:l},"".concat(p,"-").concat(m));_=T.getAudioTracks()[0],v=T.getVideoTracks()[0]}catch(T){throw a.onError(T),T}if(!_||!v){const T=new ee(k.UNEXPECTED_ERROR,"can not find tracks in media stream");return a.onError(T),T.throw(I)}r.optimizationMode&&Wm(m,v,r,xo(r.encoderConfig));const b=new ji(_,i,h,p),y=new gs(v,r,l,r.scalabiltyMode?xm(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,m);return d&&y.startMonitorStats(),a.onSuccess([b.getTrackId(),y.getTrackId()]),I.info("create camera video track(".concat(m,") and microphone audio track(").concat(p,") success")),[b,y]});return function(){return s.apply(this,arguments)}}(),createMicrophoneAudioTrack:function(){var s=L(function*(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=Ie.reportApiInvoke(null,{tag:qt.TRACER,name:Kn.CREATE_MIC_AUDIO_TRACK,options:[i]}),a=p2(i),d=Ke(8,"track-mic-");let l=null;I.info("start create microphone audio track with config",JSON.stringify(i),"trackId",d);try{l=(yield ko({audio:a},d)).getAudioTracks()[0]||null}catch(p){throw r.onError(p),p}if(!l){const p=new ee(k.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(p),p.throw(I)}const h=new ji(l,i,a,d);return r.onSuccess(h.getTrackId()),I.info("create microphone audio track success, trackId:",d),h});return function(){return s.apply(this,arguments)}}(),createCustomAudioTrack:function(s){const i=Ie.reportApiInvoke(null,{tag:qt.TRACER,name:Kn.CREATE_CUSTOM_AUDIO_TRACK,options:[s]}),r=new vt(s.mediaStreamTrack,s.encoderConfig?km(s.encoderConfig):{},Ke(8,"track-cus-"),!1,!0);return I.info("create custom audio track success with config",s,"trackId",r.getTrackId()),i.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:function(){var s=L(function*(i){var r;const{cacheOnlineFile:a,encoderConfig:d}=i;let{source:l}=i;const h={source:l instanceof AudioBuffer?"AudioBuffer":l instanceof File?null!==(r=File.name)&&void 0!==r?r:"File":l,cacheOnlineFile:a,encoderConfig:d},p=Ie.reportApiInvoke(null,{tag:qt.TRACER,name:Kn.CREATE_BUFFER_AUDIO_TRACK,options:[h]});if(V("DISABLE_WEBAUDIO"))throw new ee(k.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const m=Ke(8,"track-buf-");I.info("start create buffer source audio track with config",JSON.stringify(h),"trackId",m);const _=l;if(!(l instanceof AudioBuffer))try{l=yield function f2(s,i){return Bm.apply(this,arguments)}(l,a)}catch(y){return p.onError(y),y.throw(I)}const v=new nB(l),b=new ms(_,v,d?km(d):{},m);return I.info("create buffer source audio track success, trackId:",m),p.onSuccess(b.getTrackId()),b});return function(r){return s.apply(this,arguments)}}(),setAppType:function(s){if(I.debug("setAppType: ".concat(s)),!(Number.isInteger(s)&&s>=0))throw I.debug("Invalid appType"),new W(k.INVALID_PARAMS,"invalid app type",s);It("APP_TYPE",Math.floor(s))},setLogLevel:function(s){I.setLogLevel(s)},enableLogUpload:function(){V("USE_NEW_LOG")?It("UPLOAD_LOG",!0):I.enableLogUpload()},disableLogUpload:function(){V("USE_NEW_LOG")?It("UPLOAD_LOG",!1):I.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new nb},checkAudioTrackIsActive:function(){var s=L(function*(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const a=Ie.reportApiInvoke(null,{tag:qt.TRACER,name:Kn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(i instanceof vt||i instanceof _s)){const _=new W(k.INVALID_TRACK,"the parameter is not a audio track");return a.onError(_),_.throw()}r&&r<1e3&&(r=1e3);const d=i instanceof vt?i.getTrackLabel():"remote_track",l=i.getVolumeLevel();let h=l,p=l;const m=Date.now();return new X(_=>{const v=setInterval(()=>{const b=i.getVolumeLevel();h=b>h?b:h,p=b<p?b:p;const y=h-p>1e-4,T=Date.now()-m;if(y||T>r){clearInterval(v);const M=y,O={duration:T,deviceLabel:d,maxVolumeLevel:h,result:M};I.info("[track-".concat(i.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(O))),a.onSuccess(O),_(M)}},200)})});return function(r){return s.apply(this,arguments)}}(),checkVideoTrackIsActive:function(){var s=L(function*(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const a=Ie.reportApiInvoke(null,{tag:qt.TRACER,name:Kn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(i instanceof je||i instanceof Wa)){const y=new W(k.INVALID_TRACK,"the parameter is not a video track");return a.onError(y),y.throw()}r&&r<1e3&&(r=1e3);const d=i instanceof je?i.getTrackLabel():"remote_track",l=i.getMediaStreamTrack(!0),h=document.createElement("video");h.style.width="1px",h.style.height="1px",h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.controls=!1,(fr()||LE())&&(h.style.opacity="0.01",h.style.position="fixed",h.style.left="0",h.style.top="0",document.body.appendChild(h)),h.srcObject=new MediaStream([l]),h.play();const p=document.createElement("canvas");p.width=160,p.height=120;let m=0,_=0;try{const y=Date.now();m=yield function(T,M,O,D){let x,F=0,j=null;return new X((q,te)=>{setTimeout(()=>{x&&(x(),q(F))},M),x=FT(()=>{!function K(){F>4&&x&&(x(),q(F));const Q=O.getContext("2d");if(!Q){const _e=new W(k.UNEXPECTED_ERROR,"can not get canvas 2d context.");return I.error(_e.toString()),void te(_e)}Q.drawImage(T,0,0,160,120);const $=Q.getImageData(0,0,O.width,O.height),z=Math.floor($.data.length/3);if(j){for(let _e=0;_e<z;_e+=3)if($.data[_e]!==j[_e])return F+=1,void(j=$.data);j=$.data}else j=$.data}()},30)})}(h,r,p),_=Date.now()-y}catch(y){throw a.onError(y),y}IB===Et.SAFARI&&(h.pause(),h.remove()),h.srcObject=null;const v=m>4,b={duration:_,changedPicNum:m,deviceLabel:d,result:v};return I.info("[track-".concat(i.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(b))),a.onSuccess(b),v});return function(r){return s.apply(this,arguments)}}(),setArea:hp,audioElementPlayCenter:Mr,resumeAudioContext:function(){Mr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(s){wB.processExternalMediaAEC(s)},registerExtensions:function(s){const i=V("PLUGIN_INFO")||[];s.forEach(r=>{"name"in r&&!ye(i).call(i,r.name)&&i.push(r.name);const a=r;a.__registered__=!0,a.logger.hookLog=I.extLog,a.reporter.hookApiInvoke=Ie.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach(d=>{a.parameters[d]=V(d)})}),GF("PLUGIN_INFO",i)},ChannelMediaRelayError:Fc,ChannelMediaRelayEvent:bi,ChannelMediaRelayState:sr,RemoteStreamFallbackType:Fm,RemoteStreamType:Lm,ConnectionDisconnectedReason:ze,AudienceLatencyLevelType:PS,AREAS:st});return Object.defineProperties(Xn,{onAudioAutoplayFailed:{get:()=>Fo.onAudioAutoplayFailed,set:s=>{Fo.onAudioAutoplayFailed=s}},onAutoplayFailed:{get:()=>Fo.onAutoplayFailed,set:s=>{Fo.onAutoplayFailed=s}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Xn._onSecurityPolicyViolation,set(s){Xn._onSecurityPolicyViolation=s,WP(s)}},__CLIENT_LIST__:{get:()=>V("SHOW_GLOBAL_CLIENT_LIST")?Ld:[]}}),Lo.on(jc.CAMERA_DEVICE_CHANGED,s=>{I.info("camera device changed",JSON.stringify(s)),Xn.onCameraChanged&&Xn.onCameraChanged(s),Xn.safeEmit(ls.CAMERA_CHANGED,s)}),Lo.on(jc.RECORDING_DEVICE_CHANGED,s=>{I.info("microphone device changed",JSON.stringify(s)),Xn.onMicrophoneChanged&&Xn.onMicrophoneChanged(s),Xn.safeEmit(ls.MICROPHONE_CHANGED,s)}),Lo.on(jc.PLAYOUT_DEVICE_CHANGED,s=>{I.debug("playout device changed",JSON.stringify(s)),Xn.onPlaybackDeviceChanged&&Xn.onPlaybackDeviceChanged(s),Xn.safeEmit(ls.PLAYBACK_DEVICE_CHANGED,s)}),Mr.onAutoplayFailed=()=>{I.info("detect audio element autoplay failed"),Fo.onAudioAutoplayFailed&&Fo.onAudioAutoplayFailed()},St.on("autoplay-failed",()=>{I.info("detect webaudio autoplay failed"),Fo.onAudioAutoplayFailed&&Fo.onAudioAutoplayFailed(),Xn.safeEmit(ls.AUTOPLAY_FAILED)}),St.on(ri.STATE_CHANGE,(s,i)=>{I.info("audio context state changed: ".concat(i," => ").concat(s)),Xn.onAudioContextStateChanged&&Xn.onAudioContextStateChanged(s,i),Xn.safeEmit(ls.AUDIO_CONTEXT_STATE_CHANGED,s,i)}),Fn.on(Rc.NETWORK_STATE_CHANGE,(s,i)=>{I.info("[network-indicator] network state changed, ".concat(i," => ").concat(s))}),window&&(window.__ARTC__=Xn),Xn}()},156:id=>{function Mg(L,Bu,Ys,Rt,cn,As,Yo){try{var An=L[As](Yo),sc=An.value}catch(Bb){return void Ys(Bb)}An.done?Bu(sc):Promise.resolve(sc).then(Rt,cn)}id.exports=function xg(L){return function(){var Bu=this,Ys=arguments;return new Promise(function(Rt,cn){var As=L.apply(Bu,Ys);function Yo(sc){Mg(As,Rt,cn,Yo,An,"next",sc)}function An(sc){Mg(As,Rt,cn,Yo,An,"throw",sc)}Yo(void 0)})}},id.exports.__esModule=!0,id.exports.default=id.exports}},id=>{id(id.s=315)}]);