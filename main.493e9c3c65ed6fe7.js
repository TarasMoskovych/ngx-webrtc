(self.webpackChunkngx_webrtc=self.webpackChunkngx_webrtc||[]).push([[179],{149:(xc,xm,Fm)=>{"use strict";function x(r){return"function"==typeof r}let Fc=!1;const Zi={Promise:void 0,set useDeprecatedSynchronousErrorHandling(r){if(r){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else Fc&&console.log("RxJS: Back to a better error behavior. Thank you. <3");Fc=r},get useDeprecatedSynchronousErrorHandling(){return Fc}};function is(r){setTimeout(()=>{throw r},0)}const rs={closed:!0,next(r){},error(r){if(Zi.useDeprecatedSynchronousErrorHandling)throw r;is(r)},complete(){}},ur=Array.isArray||(r=>r&&"number"==typeof r.length);function Ka(r){return null!==r&&"object"==typeof r}const os=(()=>{function r(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((t,a)=>`${a+1}) ${t.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return r.prototype=Object.create(Error.prototype),r})();class Cn{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:t,_ctorUnsubscribe:a,_unsubscribe:l,_subscriptions:u}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,t instanceof Cn)t.remove(this);else if(null!==t)for(let f=0;f<t.length;++f)t[f].remove(this);if(x(l)){a&&(this._unsubscribe=void 0);try{l.call(this)}catch(f){e=f instanceof os?Iy(f.errors):[f]}}if(ur(u)){let f=-1,g=u.length;for(;++f<g;){const v=u[f];if(Ka(v))try{v.unsubscribe()}catch(b){e=e||[],b instanceof os?e=e.concat(Iy(b.errors)):e.push(b)}}}if(e)throw new os(e)}add(e){let t=e;if(!e)return Cn.EMPTY;switch(typeof e){case"function":t=new Cn(e);case"object":if(t===this||t.closed||"function"!=typeof t.unsubscribe)return t;if(this.closed)return t.unsubscribe(),t;if(!(t instanceof Cn)){const u=t;t=new Cn,t._subscriptions=[u]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}let{_parentOrParents:a}=t;if(null===a)t._parentOrParents=this;else if(a instanceof Cn){if(a===this)return t;t._parentOrParents=[a,this]}else{if(-1!==a.indexOf(this))return t;a.push(this)}const l=this._subscriptions;return null===l?this._subscriptions=[t]:l.push(t),t}remove(e){const t=this._subscriptions;if(t){const a=t.indexOf(e);-1!==a&&t.splice(a,1)}}}var r;function Iy(r){return r.reduce((e,t)=>e.concat(t instanceof os?t.errors:t),[])}Cn.EMPTY=((r=new Cn).closed=!0,r);const Yh="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class bn extends Cn{constructor(e,t,a){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=rs;break;case 1:if(!e){this.destination=rs;break}if("object"==typeof e){e instanceof bn?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new Ry(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new Ry(this,e,t,a)}}[Yh](){return this}static create(e,t,a){const l=new bn(e,t,a);return l.syncErrorThrowable=!1,l}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class Ry extends bn{constructor(e,t,a,l){super(),this._parentSubscriber=e;let u,f=this;x(t)?u=t:t&&(u=t.next,a=t.error,l=t.complete,t!==rs&&(f=Object.create(t),x(f.unsubscribe)&&this.add(f.unsubscribe.bind(f)),f.unsubscribe=this.unsubscribe.bind(this))),this._context=f,this._next=u,this._error=a,this._complete=l}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:t}=this;Zi.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:t}=this,{useDeprecatedSynchronousErrorHandling:a}=Zi;if(this._error)a&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)a?(t.syncErrorValue=e,t.syncErrorThrown=!0):is(e),this.unsubscribe();else{if(this.unsubscribe(),a)throw e;is(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const t=()=>this._complete.call(this._context);Zi.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,t),this.unsubscribe()):(this.__tryOrUnsub(t),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,t){try{e.call(this._context,t)}catch(a){if(this.unsubscribe(),Zi.useDeprecatedSynchronousErrorHandling)throw a;is(a)}}__tryOrSetError(e,t,a){if(!Zi.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,a)}catch(l){return Zi.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=l,e.syncErrorThrown=!0,!0):(is(l),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const ru="function"==typeof Symbol&&Symbol.observable||"@@observable";function $h(r){return r}function wy(r){return 0===r.length?$h:1===r.length?r[0]:function(t){return r.reduce((a,l)=>l(a),t)}}let An=(()=>{class r{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(t){const a=new r;return a.source=this,a.operator=t,a}subscribe(t,a,l){const{operator:u}=this,f=function $T(r,e,t){if(r){if(r instanceof bn)return r;if(r[Yh])return r[Yh]()}return r||e||t?new bn(r,e,t):new bn(rs)}(t,a,l);if(f.add(u?u.call(f,this.source):this.source||Zi.useDeprecatedSynchronousErrorHandling&&!f.syncErrorThrowable?this._subscribe(f):this._trySubscribe(f)),Zi.useDeprecatedSynchronousErrorHandling&&f.syncErrorThrowable&&(f.syncErrorThrowable=!1,f.syncErrorThrown))throw f.syncErrorValue;return f}_trySubscribe(t){try{return this._subscribe(t)}catch(a){Zi.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=a),function YT(r){for(;r;){const{closed:e,destination:t,isStopped:a}=r;if(e||a)return!1;r=t&&t instanceof bn?t:null}return!0}(t)?t.error(a):console.warn(a)}}forEach(t,a){return new(a=Ay(a))((l,u)=>{let f;f=this.subscribe(g=>{try{t(g)}catch(v){u(v),f&&f.unsubscribe()}},u,l)})}_subscribe(t){const{source:a}=this;return a&&a.subscribe(t)}[ru](){return this}pipe(...t){return 0===t.length?this:wy(t)(this)}toPromise(t){return new(t=Ay(t))((a,l)=>{let u;this.subscribe(f=>u=f,f=>l(f),()=>a(u))})}}return r.create=e=>new r(e),r})();function Ay(r){if(r||(r=Zi.Promise||Promise),!r)throw new Error("no Promise impl found");return r}const wl=(()=>{function r(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return r.prototype=Object.create(Error.prototype),r})();class QT extends Cn{constructor(e,t){super(),this.subject=e,this.subscriber=t,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,t=e.observers;if(this.subject=null,!t||0===t.length||e.isStopped||e.closed)return;const a=t.indexOf(this.subscriber);-1!==a&&t.splice(a,1)}}class Dy extends bn{constructor(e){super(e),this.destination=e}}let fn=(()=>{class r extends An{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[Yh](){return new Dy(this)}lift(t){const a=new Um(this,this);return a.operator=t,a}next(t){if(this.closed)throw new wl;if(!this.isStopped){const{observers:a}=this,l=a.length,u=a.slice();for(let f=0;f<l;f++)u[f].next(t)}}error(t){if(this.closed)throw new wl;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:a}=this,l=a.length,u=a.slice();for(let f=0;f<l;f++)u[f].error(t);this.observers.length=0}complete(){if(this.closed)throw new wl;this.isStopped=!0;const{observers:t}=this,a=t.length,l=t.slice();for(let u=0;u<a;u++)l[u].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new wl;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new wl;return this.hasError?(t.error(this.thrownError),Cn.EMPTY):this.isStopped?(t.complete(),Cn.EMPTY):(this.observers.push(t),new QT(this,t))}asObservable(){const t=new An;return t.source=this,t}}return r.create=(e,t)=>new Um(e,t),r})();class Um extends fn{constructor(e,t){super(),this.destination=e,this.source=t}next(e){const{destination:t}=this;t&&t.next&&t.next(e)}error(e){const{destination:t}=this;t&&t.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:t}=this;return t?this.source.subscribe(e):Cn.EMPTY}}function Al(r){return r&&"function"==typeof r.schedule}function xt(r,e){return function(a){if("function"!=typeof r)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return a.lift(new ZT(r,e))}}class ZT{constructor(e,t){this.project=e,this.thisArg=t}call(e,t){return t.subscribe(new e0(e,this.project,this.thisArg))}}class e0 extends bn{constructor(e,t,a){super(e),this.project=t,this.count=0,this.thisArg=a||this}_next(e){let t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(a){return void this.destination.error(a)}this.destination.next(t)}}const Oy=r=>e=>{for(let t=0,a=r.length;t<a&&!e.closed;t++)e.next(r[t]);e.complete()},Xh=function n0(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}(),Ny=r=>r&&"number"==typeof r.length&&"function"!=typeof r;function Py(r){return!!r&&"function"!=typeof r.subscribe&&"function"==typeof r.then}const Vm=r=>{if(r&&"function"==typeof r[ru])return(r=>e=>{const t=r[ru]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)})(r);if(Ny(r))return Oy(r);if(Py(r))return(r=>e=>(r.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,is),e))(r);if(r&&"function"==typeof r[Xh])return(r=>e=>{const t=r[Xh]();for(;;){let a;try{a=t.next()}catch(l){return e.error(l),e}if(a.done){e.complete();break}if(e.next(a.value),e.closed)break}return"function"==typeof t.return&&e.add(()=>{t.return&&t.return()}),e})(r);{const t=`You provided ${Ka(r)?"an invalid object":`'${r}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(t)}};function Bm(r,e){return new An(t=>{const a=new Cn;let l=0;return a.add(e.schedule(function(){l!==r.length?(t.next(r[l++]),t.closed||a.add(this.schedule())):t.complete()})),a})}function Oi(r,e){return e?function hr(r,e){if(null!=r){if(function l0(r){return r&&"function"==typeof r[ru]}(r))return function s0(r,e){return new An(t=>{const a=new Cn;return a.add(e.schedule(()=>{const l=r[ru]();a.add(l.subscribe({next(u){a.add(e.schedule(()=>t.next(u)))},error(u){a.add(e.schedule(()=>t.error(u)))},complete(){a.add(e.schedule(()=>t.complete()))}}))})),a})}(r,e);if(Py(r))return function a0(r,e){return new An(t=>{const a=new Cn;return a.add(e.schedule(()=>r.then(l=>{a.add(e.schedule(()=>{t.next(l),a.add(e.schedule(()=>t.complete()))}))},l=>{a.add(e.schedule(()=>t.error(l)))}))),a})}(r,e);if(Ny(r))return Bm(r,e);if(function ou(r){return r&&"function"==typeof r[Xh]}(r)||"string"==typeof r)return function c0(r,e){if(!r)throw new Error("Iterable cannot be null");return new An(t=>{const a=new Cn;let l;return a.add(()=>{l&&"function"==typeof l.return&&l.return()}),a.add(e.schedule(()=>{l=r[Xh](),a.add(e.schedule(function(){if(t.closed)return;let u,f;try{const g=l.next();u=g.value,f=g.done}catch(g){return void t.error(g)}f?t.complete():(t.next(u),this.schedule())}))})),a})}(r,e)}throw new TypeError((null!==r&&typeof r||r)+" is not observable")}(r,e):r instanceof An?r:new An(Vm(r))}class su extends bn{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class Qh extends bn{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function Dl(r,e){if(e.closed)return;if(r instanceof An)return r.subscribe(e);let t;try{t=Vm(r)(e)}catch(a){e.error(a)}return t}function Wi(r,e,t=Number.POSITIVE_INFINITY){return"function"==typeof e?a=>a.pipe(Wi((l,u)=>Oi(r(l,u)).pipe(xt((f,g)=>e(l,f,u,g))),t)):("number"==typeof e&&(t=e),a=>a.lift(new jm(r,t)))}class jm{constructor(e,t=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=t}call(e,t){return t.subscribe(new ky(e,this.project,this.concurrent))}}class ky extends Qh{constructor(e,t,a=Number.POSITIVE_INFINITY){super(e),this.project=t,this.concurrent=a,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let t;const a=this.index++;try{t=this.project(e,a)}catch(l){return void this.destination.error(l)}this.active++,this._innerSub(t)}_innerSub(e){const t=new su(this),a=this.destination;a.add(t);const l=Dl(e,t);l!==t&&a.add(l)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function qa(r=Number.POSITIVE_INFINITY){return Wi($h,r)}function au(r,e){return e?Bm(r,e):new An(Oy(r))}function Ly(...r){let e=Number.POSITIVE_INFINITY,t=null,a=r[r.length-1];return Al(a)?(t=r.pop(),r.length>1&&"number"==typeof r[r.length-1]&&(e=r.pop())):"number"==typeof a&&(e=r.pop()),null===t&&1===r.length&&r[0]instanceof An?r[0]:qa(e)(au(r,t))}function ti(){return function(e){return e.lift(new Hm(e))}}class Hm{constructor(e){this.connectable=e}call(e,t){const{connectable:a}=this;a._refCount++;const l=new u0(e,a),u=t.subscribe(l);return l.closed||(l.connection=a.connect()),u}}class u0 extends bn{constructor(e,t){super(e),this.connectable=t}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);const{connection:a}=this,l=e._connection;this.connection=null,l&&(!a||l===a)&&l.unsubscribe()}}class Gm extends An{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new Cn,e.add(this.source.subscribe(new wN(this.getSubject(),this))),e.closed&&(this._connection=null,e=Cn.EMPTY)),e}refCount(){return ti()(this)}}const xy=(()=>{const r=Gm.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:r._subscribe},_isComplete:{value:r._isComplete,writable:!0},getSubject:{value:r.getSubject},connect:{value:r.connect},refCount:{value:r.refCount}}})();class wN extends Dy{constructor(e,t){super(e),this.connectable=t}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}class er{constructor(e,t){this.subjectFactory=e,this.selector=t}call(e,t){const{selector:a}=this,l=this.subjectFactory(),u=a(l).subscribe(e);return u.add(t.subscribe(l)),u}}function AN(){return new fn}function Fn(r){for(let e in r)if(r[e]===Fn)return e;throw Error("Could not find renamed property on target object.")}function zm(r,e){for(const t in e)e.hasOwnProperty(t)&&!r.hasOwnProperty(t)&&(r[t]=e[t])}function Dn(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(Dn).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const e=r.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function Km(r,e){return null==r||""===r?null===e?"":e:null==e||""===e?r:r+" "+e}const DN=Fn({__forward_ref__:Fn});function Un(r){return r.__forward_ref__=Un,r.toString=function(){return Dn(this())},r}function $e(r){return Fy(r)?r():r}function Fy(r){return"function"==typeof r&&r.hasOwnProperty(DN)&&r.__forward_ref__===Un}class pe extends Error{constructor(e,t){super(function cu(r,e){return`NG0${Math.abs(r)}${e?": "+e.trim():""}`}(e,t)),this.code=e}}function ut(r){return"string"==typeof r?r:null==r?"":String(r)}function Ym(r,e){throw new pe(-201,!1)}function zr(r,e){null==r&&function an(r,e,t,a){throw new Error(`ASSERTION ERROR: ${r}`+(null==a?"":` [Expected=> ${t} ${a} ${e} <=Actual]`))}(e,r,null,"!=")}function ke(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function Zt(r){return{providers:r.providers||[],imports:r.imports||[]}}function Zh(r){return Po(r,Jm)||Po(r,Kr)}function Po(r,e){return r.hasOwnProperty(e)?r[e]:null}function Xm(r){return r&&(r.hasOwnProperty(Qm)||r.hasOwnProperty(Pl))?r[Qm]:null}const Jm=Fn({\u0275prov:Fn}),Qm=Fn({\u0275inj:Fn}),Kr=Fn({ngInjectableDef:Fn}),Pl=Fn({ngInjectorDef:Fn});var nt=(()=>((nt=nt||{})[nt.Default=0]="Default",nt[nt.Host=1]="Host",nt[nt.Self=2]="Self",nt[nt.SkipSelf=4]="SkipSelf",nt[nt.Optional=8]="Optional",nt))();let ep;function Mo(r){const e=ep;return ep=r,e}function Hy(r,e,t){const a=Zh(r);return a&&"root"==a.providedIn?void 0===a.value?a.value=a.factory():a.value:t&nt.Optional?null:void 0!==e?e:void Ym(Dn(r))}function fo(r){return{toString:r}.toString()}var ss=(()=>((ss=ss||{})[ss.OnPush=0]="OnPush",ss[ss.Default=1]="Default",ss))(),Rr=(()=>(function(r){r[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom"}(Rr||(Rr={})),Rr))();const Hn=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),du={},vn=[],Uc=Fn({\u0275cmp:Fn}),Gy=Fn({\u0275dir:Fn}),Vc=Fn({\u0275pipe:Fn}),f0=Fn({\u0275mod:Fn}),Ya=Fn({\u0275fac:Fn}),tp=Fn({__NG_ELEMENT_ID__:Fn});let as=0;function qr(r){return fo(()=>{const t=!0===r.standalone,a={},l={type:r.type,providersResolver:null,decls:r.decls,vars:r.vars,factory:null,template:r.template||null,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:a,inputs:null,outputs:null,exportAs:r.exportAs||null,onPush:r.changeDetection===ss.OnPush,directiveDefs:null,pipeDefs:null,standalone:t,dependencies:t&&r.dependencies||null,getStandaloneInjector:null,selectors:r.selectors||vn,viewQuery:r.viewQuery||null,features:r.features||null,data:r.data||{},encapsulation:r.encapsulation||Rr.Emulated,id:"c"+as++,styles:r.styles||vn,_:null,setInput:null,schemas:r.schemas||null,tView:null},u=r.dependencies,f=r.features;return l.inputs=m0(r.inputs,a),l.outputs=m0(r.outputs),f&&f.forEach(g=>g(l)),l.directiveDefs=u?()=>("function"==typeof u?u():u).map(Zm).filter(e_):null,l.pipeDefs=u?()=>("function"==typeof u?u():u).map(wr).filter(e_):null,l})}function Zm(r){return Nn(r)||$r(r)}function e_(r){return null!==r}function On(r){return fo(()=>({type:r.type,bootstrap:r.bootstrap||vn,declarations:r.declarations||vn,imports:r.imports||vn,exports:r.exports||vn,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null}))}function m0(r,e){if(null==r)return du;const t={};for(const a in r)if(r.hasOwnProperty(a)){let l=r[a],u=l;Array.isArray(l)&&(u=l[1],l=l[0]),t[l]=a,e&&(e[l]=u)}return t}const Be=qr;function Yr(r){return{type:r.type,name:r.name,factory:null,pure:!1!==r.pure,standalone:!0===r.standalone,onDestroy:r.type.prototype.ngOnDestroy||null}}function Nn(r){return r[Uc]||null}function $r(r){return r[Gy]||null}function wr(r){return r[Vc]||null}function mo(r,e){const t=r[f0]||null;if(!t&&!0===e)throw new Error(`Type ${Dn(r)} does not have '\u0275mod' property.`);return t}function Dr(r){return Array.isArray(r)&&"object"==typeof r[1]}function ws(r){return Array.isArray(r)&&!0===r[1]}function op(r){return 0!=(8&r.flags)}function r_(r){return 2==(2&r.flags)}function sp(r){return 1==(1&r.flags)}function As(r){return null!==r.template}function xN(r){return 0!=(256&r[2])}function Ul(r,e){return r.hasOwnProperty(Ya)?r[Ya]:null}class HN{constructor(e,t,a){this.previousValue=e,this.currentValue=t,this.firstChange=a}isFirstChange(){return this.firstChange}}function Lo(){return cs}function cs(r){return r.type.prototype.ngOnChanges&&(r.setInput=WN),GN}function GN(){const r=ap(this),e=r?.current;if(e){const t=r.previous;if(t===du)r.previous=e;else for(let a in e)t[a]=e[a];r.current=null,this.ngOnChanges(e)}}function WN(r,e,t,a){const l=ap(r)||function S0(r,e){return r[v0]=e}(r,{previous:du,current:null}),u=l.current||(l.current={}),f=l.previous,g=this.declaredInputs[t],v=f[g];u[g]=new HN(v&&v.currentValue,e,f===du),r[a]=e}Lo.ngInherit=!0;const v0="__ngSimpleChanges__";function ap(r){return r[v0]||null}function Wn(r){for(;Array.isArray(r);)r=r[0];return r}function c_(r,e){return Wn(e[r])}function xo(r,e){return Wn(e[r.index])}function Jy(r,e){return r.data[e]}function Os(r,e){return r[e]}function Fo(r,e){const t=e[r];return Dr(t)?t:t[0]}function dp(r){return 64==(64&r[2])}function Wt(r,e){return null==e?null:r[e]}function C0(r){r[18]=0}function Qy(r,e){r[5]+=e;let t=r,a=r[3];for(;null!==a&&(1===e&&1===t[5]||-1===e&&0===t[5]);)a[5]+=e,t=a,a=a[3]}const yt={lFrame:iv(null),bindingsEnabled:!0};function T0(){return yt.bindingsEnabled}function fe(){return yt.lFrame.lView}function en(){return yt.lFrame.tView}function ds(r){return yt.lFrame.contextLView=r,r[8]}function us(r){return yt.lFrame.contextLView=null,r}function Pi(){let r=Zy();for(;null!==r&&64===r.type;)r=r.parent;return r}function Zy(){return yt.lFrame.currentTNode}function ua(r,e){const t=yt.lFrame;t.currentTNode=r,t.isParent=e}function $a(){return yt.lFrame.isParent}function ev(){yt.lFrame.isParent=!1}function Xr(){const r=yt.lFrame;let e=r.bindingRootIndex;return-1===e&&(e=r.bindingRootIndex=r.tView.bindingStartIndex),e}function hu(){return yt.lFrame.bindingIndex++}function ZN(r,e){const t=yt.lFrame;t.bindingIndex=t.bindingRootIndex=r,Ja(e)}function Ja(r){yt.lFrame.currentDirectiveIndex=r}function w0(){return yt.lFrame.currentQueryIndex}function Ns(r){yt.lFrame.currentQueryIndex=r}function tP(r){const e=r[1];return 2===e.type?e.declTNode:1===e.type?r[6]:null}function A0(r,e,t){if(t&nt.SkipSelf){let l=e,u=r;for(;!(l=l.parent,null!==l||t&nt.Host||(l=tP(u),null===l||(u=u[15],10&l.type))););if(null===l)return!1;e=l,r=u}const a=yt.lFrame=D0();return a.currentTNode=e,a.lView=r,!0}function nv(r){const e=D0(),t=r[1];yt.lFrame=e,e.currentTNode=t.firstChild,e.lView=r,e.tView=t,e.contextLView=r,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function D0(){const r=yt.lFrame,e=null===r?null:r.child;return null===e?iv(r):e}function iv(r){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=e),e}function O0(){const r=yt.lFrame;return yt.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const N0=O0;function rv(){const r=O0();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function Jr(){return yt.lFrame.selectedIndex}function pa(r){yt.lFrame.selectedIndex=r}function ni(){const r=yt.lFrame;return Jy(r.tView,r.selectedIndex)}function be(){yt.lFrame.currentNamespace="svg"}function Qa(){!function iP(){yt.lFrame.currentNamespace=null}()}function h_(r,e){for(let t=e.directiveStart,a=e.directiveEnd;t<a;t++){const u=r.data[t].type.prototype,{ngAfterContentInit:f,ngAfterContentChecked:g,ngAfterViewInit:v,ngAfterViewChecked:b,ngOnDestroy:D}=u;f&&(r.contentHooks||(r.contentHooks=[])).push(-t,f),g&&((r.contentHooks||(r.contentHooks=[])).push(t,g),(r.contentCheckHooks||(r.contentCheckHooks=[])).push(t,g)),v&&(r.viewHooks||(r.viewHooks=[])).push(-t,v),b&&((r.viewHooks||(r.viewHooks=[])).push(t,b),(r.viewCheckHooks||(r.viewCheckHooks=[])).push(t,b)),null!=D&&(r.destroyHooks||(r.destroyHooks=[])).push(t,D)}}function p_(r,e,t){x0(r,e,3,t)}function f_(r,e,t,a){(3&r[2])===t&&x0(r,e,t,a)}function hp(r,e){let t=r[2];(3&t)===e&&(t&=2047,t+=1,r[2]=t)}function x0(r,e,t,a){const u=a??-1,f=e.length-1;let g=0;for(let v=void 0!==a?65535&r[18]:0;v<f;v++)if("number"==typeof e[v+1]){if(g=e[v],null!=a&&g>=a)break}else e[v]<0&&(r[18]+=65536),(g<u||-1==u)&&(rP(r,t,e,v),r[18]=(4294901760&r[18])+v+2),v++}function rP(r,e,t,a){const l=t[a]<0,u=t[a+1],g=r[l?-t[a]:t[a]];if(l){if(r[2]>>11<r[18]>>16&&(3&r[2])===e){r[2]+=2048;try{u.call(g)}finally{}}}else try{u.call(g)}finally{}}class pp{constructor(e,t,a){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=a}}function m_(r,e,t){let a=0;for(;a<t.length;){const l=t[a];if("number"==typeof l){if(0!==l)break;a++;const u=t[a++],f=t[a++],g=t[a++];r.setAttribute(e,f,g,u)}else{const u=l,f=t[++a];sv(u)?r.setProperty(e,u,f):r.setAttribute(e,u,f),a++}}return a}function V0(r){return 3===r||4===r||6===r}function sv(r){return 64===r.charCodeAt(0)}function __(r,e){if(null!==e&&0!==e.length)if(null===r||0===r.length)r=e.slice();else{let t=-1;for(let a=0;a<e.length;a++){const l=e[a];"number"==typeof l?t=l:0===t||av(r,t,l,null,-1===t||2===t?e[++a]:null)}}return r}function av(r,e,t,a,l){let u=0,f=r.length;if(-1===e)f=-1;else for(;u<r.length;){const g=r[u++];if("number"==typeof g){if(g===e){f=-1;break}if(g>e){f=u-1;break}}}for(;u<r.length;){const g=r[u];if("number"==typeof g)break;if(g===t){if(null===a)return void(null!==l&&(r[u+1]=l));if(a===r[u+1])return void(r[u+2]=l)}u++,null!==a&&u++,null!==l&&u++}-1!==f&&(r.splice(f,0,e),u=f+1),r.splice(u++,0,t),null!==a&&r.splice(u++,0,a),null!==l&&r.splice(u++,0,l)}function g_(r){return-1!==r}function pu(r){return 32767&r}function fa(r,e){let t=function cP(r){return r>>16}(r),a=e;for(;t>0;)a=a[15],t--;return a}let E_=!0;function fp(r){const e=E_;return E_=r,e}let dP=0;const Ps={};function fu(r,e){const t=lv(r,e);if(-1!==t)return t;const a=e[1];a.firstCreatePass&&(r.injectorIndex=e.length,cv(a.data,r),cv(e,null),cv(a.blueprint,null));const l=y_(r,e),u=r.injectorIndex;if(g_(l)){const f=pu(l),g=fa(l,e),v=g[1].data;for(let b=0;b<8;b++)e[u+b]=g[f+b]|v[f+b]}return e[u+8]=l,u}function cv(r,e){r.push(0,0,0,0,0,0,0,0,e)}function lv(r,e){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===e[r.injectorIndex+8]?-1:r.injectorIndex}function y_(r,e){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let t=0,a=null,l=e;for(;null!==l;){if(a=Y0(l),null===a)return-1;if(t++,l=l[15],-1!==a.injectorIndex)return a.injectorIndex|t<<16}return-1}function v_(r,e,t){!function uP(r,e,t){let a;"string"==typeof t?a=t.charCodeAt(0)||0:t.hasOwnProperty(tp)&&(a=t[tp]),null==a&&(a=t[tp]=dP++);const l=255&a;e.data[r+(l>>5)]|=1<<l}(r,e,t)}function H0(r,e,t){if(t&nt.Optional||void 0!==r)return r;Ym()}function G0(r,e,t,a){if(t&nt.Optional&&void 0===a&&(a=null),0==(t&(nt.Self|nt.Host))){const l=r[9],u=Mo(void 0);try{return l?l.get(e,a,t&nt.Optional):Hy(e,a,t&nt.Optional)}finally{Mo(u)}}return H0(a,0,t)}function W0(r,e,t,a=nt.Default,l){if(null!==r){if(1024&e[2]){const f=function uv(r,e,t,a,l){let u=r,f=e;for(;null!==u&&null!==f&&1024&f[2]&&!(256&f[2]);){const g=z0(u,f,t,a|nt.Self,Ps);if(g!==Ps)return g;let v=u.parent;if(!v){const b=f[21];if(b){const D=b.get(t,Ps,a);if(D!==Ps)return D}v=Y0(f),f=f[15]}u=v}return l}(r,e,t,a,Ps);if(f!==Ps)return f}const u=z0(r,e,t,a,Ps);if(u!==Ps)return u}return G0(e,t,a,l)}function z0(r,e,t,a,l){const u=function pP(r){if("string"==typeof r)return r.charCodeAt(0)||0;const e=r.hasOwnProperty(tp)?r[tp]:void 0;return"number"==typeof e?e>=0?255&e:fP:e}(t);if("function"==typeof u){if(!A0(e,r,a))return a&nt.Host?H0(l,0,a):G0(e,t,a,l);try{const f=u(a);if(null!=f||a&nt.Optional)return f;Ym()}finally{N0()}}else if("number"==typeof u){let f=null,g=lv(r,e),v=-1,b=a&nt.Host?e[16][6]:null;for((-1===g||a&nt.SkipSelf)&&(v=-1===g?y_(r,e):e[g+8],-1!==v&&dv(a,!1)?(f=e[1],g=pu(v),e=fa(v,e)):g=-1);-1!==g;){const D=e[1];if(q0(u,g,D.data)){const L=K0(g,e,t,f,a,b);if(L!==Ps)return L}v=e[g+8],-1!==v&&dv(a,e[1].data[g+8]===b)&&q0(u,g,e)?(f=D,g=pu(v),e=fa(v,e)):g=-1}}return l}function K0(r,e,t,a,l,u){const f=e[1],g=f.data[r+8],D=mp(g,f,t,null==a?r_(g)&&E_:a!=f&&0!=(3&g.type),l&nt.Host&&u===g);return null!==D?_p(e,f,D,g):Ps}function mp(r,e,t,a,l){const u=r.providerIndexes,f=e.data,g=1048575&u,v=r.directiveStart,D=u>>20,j=l?g+D:r.directiveEnd;for(let G=a?g:g+D;G<j;G++){const q=f[G];if(G<v&&t===q||G>=v&&q.type===t)return G}if(l){const G=f[v];if(G&&As(G)&&G.type===t)return v}return null}function _p(r,e,t,a){let l=r[t];const u=e.data;if(function F0(r){return r instanceof pp}(l)){const f=l;f.resolving&&function Ni(r,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${r}`:"";throw new pe(-200,`Circular dependency in DI detected for ${r}${t}`)}(function yn(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():ut(r)}(u[t]));const g=fp(f.canSeeViewProviders);f.resolving=!0;const v=f.injectImpl?Mo(f.injectImpl):null;A0(r,a,nt.Default);try{l=r[t]=f.factory(void 0,u,r,a),e.firstCreatePass&&t>=a.directiveStart&&function L0(r,e,t){const{ngOnChanges:a,ngOnInit:l,ngDoCheck:u}=e.type.prototype;if(a){const f=cs(e);(t.preOrderHooks||(t.preOrderHooks=[])).push(r,f),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(r,f)}l&&(t.preOrderHooks||(t.preOrderHooks=[])).push(0-r,l),u&&((t.preOrderHooks||(t.preOrderHooks=[])).push(r,u),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(r,u))}(t,u[t],e)}finally{null!==v&&Mo(v),fp(g),f.resolving=!1,N0()}}return l}function q0(r,e,t){return!!(t[e+(r>>5)]&1<<r)}function dv(r,e){return!(r&nt.Self||r&nt.Host&&e)}class mu{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,a){return W0(this._tNode,this._lView,e,a,t)}}function fP(){return new mu(Pi(),fe())}function Mi(r){return fo(()=>{const e=r.prototype.constructor,t=e[Ya]||_u(e),a=Object.prototype;let l=Object.getPrototypeOf(r.prototype).constructor;for(;l&&l!==a;){const u=l[Ya]||_u(l);if(u&&u!==t)return u;l=Object.getPrototypeOf(l)}return u=>new u})}function _u(r){return Fy(r)?()=>{const e=_u($e(r));return e&&e()}:Ul(r)}function Y0(r){const e=r[1],t=e.type;return 2===t?e.declTNode:1===t?r[6]:null}function gu(r){return function hP(r,e){if("class"===e)return r.classes;if("style"===e)return r.styles;const t=r.attrs;if(t){const a=t.length;let l=0;for(;l<a;){const u=t[l];if(V0(u))break;if(0===u)l+=2;else if("number"==typeof u)for(l++;l<a&&"string"==typeof t[l];)l++;else{if(u===e)return t[l+1];l+=2}}}return null}(Pi(),r)}const Bl="__parameters__";function yu(r,e,t){return fo(()=>{const a=function hv(r){return function(...t){if(r){const a=r(...t);for(const l in a)this[l]=a[l]}}}(e);function l(...u){if(this instanceof l)return a.apply(this,u),this;const f=new l(...u);return g.annotation=f,g;function g(v,b,D){const L=v.hasOwnProperty(Bl)?v[Bl]:Object.defineProperty(v,Bl,{value:[]})[Bl];for(;L.length<=D;)L.push(null);return(L[D]=L[D]||[]).push(f),v}}return t&&(l.prototype=Object.create(t.prototype)),l.prototype.ngMetadataName=r,l.annotationCls=l,l})}class Ne{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=ke({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Qr(r,e){void 0===e&&(e=r);for(let t=0;t<r.length;t++){let a=r[t];Array.isArray(a)?(e===r&&(e=r.slice(0,t)),Qr(a,e)):e!==r&&e.push(a)}return e}function Ms(r,e){r.forEach(t=>Array.isArray(t)?Ms(t,e):e(t))}function mv(r,e,t){e>=r.length?r.push(t):r.splice(e,0,t)}function Su(r,e){return e>=r.length-1?r.pop():r.splice(e,1)[0]}function Cu(r,e){const t=[];for(let a=0;a<r;a++)t.push(e);return t}function _o(r,e,t){let a=bu(r,e);return a>=0?r[1|a]=t:(a=~a,function T_(r,e,t,a){let l=r.length;if(l==e)r.push(t,a);else if(1===l)r.push(a,r[0]),r[0]=t;else{for(l--,r.push(r[l-1],r[l]);l>e;)r[l]=r[l-2],l--;r[e]=t,r[e+1]=a}}(r,a,e,t)),a}function I_(r,e){const t=bu(r,e);if(t>=0)return r[1|t]}function bu(r,e){return function X0(r,e,t){let a=0,l=r.length>>t;for(;l!==a;){const u=a+(l-a>>1),f=r[u<<t];if(e===f)return u<<t;f>e?l=u:a=u+1}return~(l<<t)}(r,e,1)}const Za={},Ev="__NG_DI_FLAG__",Ep="ngTempTokenPath",bP=/\n/gm,Iu="__source";let Gc;function Gl(r){const e=Gc;return Gc=r,e}function TP(r,e=nt.Default){if(void 0===Gc)throw new pe(-203,!1);return null===Gc?Hy(r,void 0,e):Gc.get(r,e&nt.Optional?null:void 0,e)}function he(r,e=nt.Default){return(function p0(){return ep}()||TP)($e(r),e)}function _t(r,e=nt.Default){return"number"!=typeof e&&(e=0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)),he(r,e)}function yv(r){const e=[];for(let t=0;t<r.length;t++){const a=$e(r[t]);if(Array.isArray(a)){if(0===a.length)throw new pe(900,!1);let l,u=nt.Default;for(let f=0;f<a.length;f++){const g=a[f],v=IP(g);"number"==typeof v?-1===v?l=g.token:u|=v:l=g}e.push(he(l,u))}else e.push(he(a))}return e}function yp(r,e){return r[Ev]=e,r.prototype[Ev]=e,r}function IP(r){return r[Ev]}const vp=yp(yu("Optional"),8),Sp=yp(yu("SkipSelf"),4);var go=(()=>((go=go||{})[go.Important=1]="Important",go[go.DashCase=2]="DashCase",go))();const M_=new Map;let kP=0;const k_="__ngContext__";function Or(r,e){Dr(e)?(r[k_]=e[20],function uI(r){M_.set(r[20],r)}(e)):r[k_]=e}function ec(r,e){return undefined(r,e)}function Nu(r){const e=r[3];return ws(e)?e[3]:e}function Av(r){return ma(r[13])}function U_(r){return ma(r[4])}function ma(r){for(;null!==r&&!ws(r);)r=r[4];return r}function Pu(r,e,t,a,l){if(null!=a){let u,f=!1;ws(a)?u=a:Dr(a)&&(f=!0,a=a[0]);const g=Wn(a);0===r&&null!==t?null==l?AI(e,t,g):ql(e,t,g,l||null,!0):1===r&&null!==t?ql(e,t,g,l||null,!0):2===r?function Yl(r,e,t){const a=Pp(r,e);a&&function VP(r,e,t,a){r.removeChild(e,t,a)}(r,a,e,t)}(e,g,f):3===r&&e.destroyNode(g),null!=u&&function BP(r,e,t,a,l){const u=t[7];u!==Wn(t)&&Pu(e,r,a,u,l);for(let g=10;g<t.length;g++){const v=t[g];ku(v[1],v,r,e,a,u)}}(e,r,u,t,l)}}function Mu(r,e,t){return r.createElement(e,t)}function TI(r,e){const t=r[9],a=t.indexOf(e),l=e[3];512&e[2]&&(e[2]&=-513,Qy(l,-1)),t.splice(a,1)}function Nv(r,e){if(r.length<=10)return;const t=10+e,a=r[t];if(a){const l=a[17];null!==l&&l!==r&&TI(l,a),e>0&&(r[t-1][4]=a[4]);const u=Su(r,10+e);!function Ov(r,e){ku(r,e,e[11],2,null,null),e[0]=null,e[6]=null}(a[1],a);const f=u[19];null!==f&&f.detachView(u[1]),a[3]=null,a[4]=null,a[2]&=-65}return a}function II(r,e){if(!(128&e[2])){const t=e[11];t.destroyNode&&ku(r,e,t,3,null,null),function SI(r){let e=r[13];if(!e)return Pv(r[1],r);for(;e;){let t=null;if(Dr(e))t=e[13];else{const a=e[10];a&&(t=a)}if(!t){for(;e&&!e[4]&&e!==r;)Dr(e)&&Pv(e[1],e),e=e[3];null===e&&(e=r),Dr(e)&&Pv(e[1],e),t=e&&e[4]}e=t}}(e)}}function Pv(r,e){if(!(128&e[2])){e[2]&=-65,e[2]|=128,function UP(r,e){let t;if(null!=r&&null!=(t=r.destroyHooks))for(let a=0;a<t.length;a+=2){const l=e[t[a]];if(!(l instanceof pp)){const u=t[a+1];if(Array.isArray(u))for(let f=0;f<u.length;f+=2){const g=l[u[f]],v=u[f+1];try{v.call(g)}finally{}}else try{u.call(l)}finally{}}}}(r,e),function RI(r,e){const t=r.cleanup,a=e[7];let l=-1;if(null!==t)for(let u=0;u<t.length-1;u+=2)if("string"==typeof t[u]){const f=t[u+1],g="function"==typeof f?f(e):Wn(e[f]),v=a[l=t[u+2]],b=t[u+3];"boolean"==typeof b?g.removeEventListener(t[u],v,b):b>=0?a[l=b]():a[l=-b].unsubscribe(),u+=2}else{const f=a[l=t[u+1]];t[u].call(f)}if(null!==a){for(let u=l+1;u<a.length;u++)(0,a[u])();e[7]=null}}(r,e),1===e[1].type&&e[11].destroy();const t=e[17];if(null!==t&&ws(e[3])){t!==e[3]&&TI(t,e);const a=e[19];null!==a&&a.detachView(r)}!function pI(r){M_.delete(r[20])}(e)}}function j_(r,e,t){return function wI(r,e,t){let a=e;for(;null!==a&&40&a.type;)a=(e=a).parent;if(null===a)return t[0];if(2&a.flags){const l=r.data[a.directiveStart].encapsulation;if(l===Rr.None||l===Rr.Emulated)return null}return xo(a,t)}(r,e.parent,t)}function ql(r,e,t,a,l){r.insertBefore(e,t,a,l)}function AI(r,e,t){r.appendChild(e,t)}function DI(r,e,t,a,l){null!==a?ql(r,e,t,a,l):AI(r,e,t)}function Pp(r,e){return r.parentNode(e)}function Mv(r,e,t){return kv(r,e,t)}let z_,kv=function NI(r,e,t){return 40&r.type?xo(r,t):null};function H_(r,e,t,a){const l=j_(r,a,e),u=e[11],g=Mv(a.parent||e[6],a,e);if(null!=l)if(Array.isArray(t))for(let v=0;v<t.length;v++)DI(u,l,t[v],g,!1);else DI(u,l,t,g,!1)}function Mp(r,e){if(null!==e){const t=e.type;if(3&t)return xo(e,r);if(4&t)return Uv(-1,r[e.index]);if(8&t){const a=e.child;if(null!==a)return Mp(r,a);{const l=r[e.index];return ws(l)?Uv(-1,l):Wn(l)}}if(32&t)return ec(e,r)()||Wn(r[e.index]);{const a=Fv(r,e);return null!==a?Array.isArray(a)?a[0]:Mp(Nu(r[16]),a):Mp(r,e.next)}}return null}function Fv(r,e){return null!==e?r[16][6].projection[e.projection]:null}function Uv(r,e){const t=10+r+1;if(t<e.length){const a=e[t],l=a[1].firstChild;if(null!==l)return Mp(a,l)}return e[7]}function G_(r,e,t,a,l,u,f){for(;null!=t;){const g=a[t.index],v=t.type;if(f&&0===e&&(g&&Or(Wn(g),a),t.flags|=4),64!=(64&t.flags))if(8&v)G_(r,e,t.child,a,l,u,!1),Pu(e,r,l,g,u);else if(32&v){const b=ec(t,a);let D;for(;D=b();)Pu(e,r,l,D,u);Pu(e,r,l,g,u)}else 16&v?Vv(r,e,a,t,l,u):Pu(e,r,l,g,u);t=f?t.projectionNext:t.next}}function ku(r,e,t,a,l,u){G_(t,a,r.firstChild,e,l,u,!1)}function Vv(r,e,t,a,l,u){const f=t[16],v=f[6].projection[a.projection];if(Array.isArray(v))for(let b=0;b<v.length;b++)Pu(e,r,l,v[b],u);else G_(r,e,v,f[3],l,u,!0)}function MI(r,e,t){r.setAttribute(e,"style",t)}function _a(r,e,t){""===t?r.removeAttribute(e,"class"):r.setAttribute(e,"class",t)}class UI{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function Vo(r){return r instanceof UI?r.changingThisBreaksApplicationSecurity:r}const GI=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;var ki=(()=>((ki=ki||{})[ki.NONE=0]="NONE",ki[ki.HTML=1]="HTML",ki[ki.STYLE=2]="STYLE",ki[ki.SCRIPT=3]="SCRIPT",ki[ki.URL=4]="URL",ki[ki.RESOURCE_URL=5]="RESOURCE_URL",ki))();function $_(r){const e=function Lu(){const r=fe();return r&&r[12]}();return e?e.sanitize(ki.URL,r)||"":function Ql(r,e){const t=function KP(r){return r instanceof UI&&r.getTypeName()||null}(r);if(null!=t&&t!==e){if("ResourceURL"===t&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${t} (see https://g.co/ng/security#xss)`)}return t===e}(r,"URL")?Vo(r):function kp(r){return(r=String(r)).match(GI)?r:"unsafe:"+r}(ut(r))}const Wv=new Ne("ENVIRONMENT_INITIALIZER"),XI=new Ne("INJECTOR",-1),xp=new Ne("INJECTOR_DEF_TYPES");class X_{get(e,t=Za){if(t===Za){const a=new Error(`NullInjectorError: No provider for ${Dn(e)}!`);throw a.name="NullInjectorError",a}return t}}function JI(...r){return{\u0275providers:Fp(0,r)}}function Fp(r,...e){const t=[],a=new Set;let l;return Ms(e,u=>{const f=u;Kv(f,t,[],a)&&(l||(l=[]),l.push(f))}),void 0!==l&&zv(l,t),t}function zv(r,e){for(let t=0;t<r.length;t++){const{providers:l}=r[t];Ms(l,u=>{e.push(u)})}}function Kv(r,e,t,a){if(!(r=$e(r)))return!1;let l=null,u=Xm(r);const f=!u&&Nn(r);if(u||f){if(f&&!f.standalone)return!1;l=r}else{const v=r.ngModule;if(u=Xm(v),!u)return!1;l=v}const g=a.has(l);if(f){if(g)return!1;if(a.add(l),f.dependencies){const v="function"==typeof f.dependencies?f.dependencies():f.dependencies;for(const b of v)Kv(b,e,t,a)}}else{if(!u)return!1;{if(null!=u.imports&&!g){let b;a.add(l);try{Ms(u.imports,D=>{Kv(D,e,t,a)&&(b||(b=[]),b.push(D))})}finally{}void 0!==b&&zv(b,e)}if(!g){const b=Ul(l)||(()=>new l);e.push({provide:l,useFactory:b,deps:vn},{provide:xp,useValue:l,multi:!0},{provide:Wv,useValue:()=>he(l),multi:!0})}const v=u.providers;null==v||g||Ms(v,D=>{e.push(D)})}}return l!==r&&void 0!==r.providers}const QI=Fn({provide:String,useValue:Fn});function qv(r){return null!==r&&"object"==typeof r&&QI in r}function ed(r){return"function"==typeof r}const J_=new Ne("Set Injector scope."),Q_={},mM={};let Xv;function Z_(){return void 0===Xv&&(Xv=new X_),Xv}class Wc{}class eR extends Wc{constructor(e,t,a,l){super(),this.parent=t,this.source=a,this.scopes=l,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,tg(e,f=>this.processProvider(f)),this.records.set(XI,zc(void 0,this)),l.has("environment")&&this.records.set(Wc,zc(void 0,this));const u=this.records.get(J_);null!=u&&"string"==typeof u.value&&this.scopes.add(u.value),this.injectorDefTypes=new Set(this.get(xp.multi,vn,nt.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const e of this._ngOnDestroyHooks)e.ngOnDestroy();for(const e of this._onDestroyHooks)e()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(e){this._onDestroyHooks.push(e)}runInContext(e){this.assertNotDestroyed();const t=Gl(this),a=Mo(void 0);try{return e()}finally{Gl(t),Mo(a)}}get(e,t=Za,a=nt.Default){this.assertNotDestroyed();const l=Gl(this),u=Mo(void 0);try{if(!(a&nt.SkipSelf)){let g=this.records.get(e);if(void 0===g){const v=function EM(r){return"function"==typeof r||"object"==typeof r&&r instanceof Ne}(e)&&Zh(e);g=v&&this.injectableDefInScope(v)?zc(eg(e),Q_):null,this.records.set(e,g)}if(null!=g)return this.hydrate(e,g)}return(a&nt.Self?Z_():this.parent).get(e,t=a&nt.Optional&&t===Za?null:t)}catch(f){if("NullInjectorError"===f.name){if((f[Ep]=f[Ep]||[]).unshift(Dn(e)),l)throw f;return function RP(r,e,t,a){const l=r[Ep];throw e[Iu]&&l.unshift(e[Iu]),r.message=function eI(r,e,t,a=null){r=r&&"\n"===r.charAt(0)&&"\u0275"==r.charAt(1)?r.slice(2):r;let l=Dn(e);if(Array.isArray(e))l=e.map(Dn).join(" -> ");else if("object"==typeof e){let u=[];for(let f in e)if(e.hasOwnProperty(f)){let g=e[f];u.push(f+":"+("string"==typeof g?JSON.stringify(g):Dn(g)))}l=`{${u.join(", ")}}`}return`${t}${a?"("+a+")":""}[${l}]: ${r.replace(bP,"\n  ")}`}("\n"+r.message,l,t,a),r.ngTokenPath=l,r[Ep]=null,r}(f,e,"R3InjectorError",this.source)}throw f}finally{Mo(u),Gl(l)}}resolveInjectorInitializers(){const e=Gl(this),t=Mo(void 0);try{const a=this.get(Wv.multi,vn,nt.Self);for(const l of a)l()}finally{Gl(e),Mo(t)}}toString(){const e=[],t=this.records;for(const a of t.keys())e.push(Dn(a));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new pe(205,!1)}processProvider(e){let t=ed(e=$e(e))?e:$e(e&&e.provide);const a=function Jv(r){return qv(r)?zc(void 0,r.useValue):zc(Qv(r),Q_)}(e);if(ed(e)||!0!==e.multi)this.records.get(t);else{let l=this.records.get(t);l||(l=zc(void 0,Q_,!0),l.factory=()=>yv(l.multi),this.records.set(t,l)),t=e,l.multi.push(e)}this.records.set(t,a)}hydrate(e,t){return t.value===Q_&&(t.value=mM,t.value=t.factory()),"object"==typeof t.value&&t.value&&function gM(r){return null!==r&&"object"==typeof r&&"function"==typeof r.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=$e(e.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}}function eg(r){const e=Zh(r),t=null!==e?e.factory:Ul(r);if(null!==t)return t;if(r instanceof Ne)throw new pe(204,!1);if(r instanceof Function)return function tR(r){const e=r.length;if(e>0)throw Cu(e,"?"),new pe(204,!1);const t=function Nl(r){const e=r&&(r[Jm]||r[Kr]);if(e){const t=function jy(r){if(r.hasOwnProperty("name"))return r.name;const e=(""+r).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(r);return console.warn(`DEPRECATED: DI is instantiating a token "${t}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${t}" class.`),e}return null}(r);return null!==t?()=>t.factory(r):()=>new r}(r);throw new pe(204,!1)}function Qv(r,e,t){let a;if(ed(r)){const l=$e(r);return Ul(l)||eg(l)}if(qv(r))a=()=>$e(r.useValue);else if(function $v(r){return!(!r||!r.useFactory)}(r))a=()=>r.useFactory(...yv(r.deps||[]));else if(function Yv(r){return!(!r||!r.useExisting)}(r))a=()=>he($e(r.useExisting));else{const l=$e(r&&(r.useClass||r.provide));if(!function _M(r){return!!r.deps}(r))return Ul(l)||eg(l);a=()=>new l(...yv(r.deps))}return a}function zc(r,e,t=!1){return{factory:r,value:e,multi:t?[]:void 0}}function nR(r){return!!r.\u0275providers}function tg(r,e){for(const t of r)Array.isArray(t)?tg(t,e):nR(t)?tg(t.\u0275providers,e):e(t)}class iR{}class oR{resolveComponentFactory(e){throw function Zv(r){const e=Error(`No component factory found for ${Dn(r)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=r,e}(e)}}let td=(()=>{class r{}return r.NULL=new oR,r})();function sR(){return xu(Pi(),fe())}function xu(r,e){return new ci(xo(r,e))}let ci=(()=>{class r{constructor(t){this.nativeElement=t}}return r.__NG_ELEMENT_ID__=sR,r})();function vM(r){return r instanceof ci?r.nativeElement:r}class Fu{}let Ls=(()=>{class r{}return r.__NG_ELEMENT_ID__=()=>function SM(){const r=fe(),t=Fo(Pi().index,r);return(Dr(t)?t:r)[11]}(),r})(),aR=(()=>{class r{}return r.\u0275prov=ke({token:r,providedIn:"root",factory:()=>null}),r})();class nc{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const cR=new nc("14.3.0"),tS={};function Kc(r){return r.ngOriginalError}class qc{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&Kc(e);for(;t&&Kc(t);)t=Kc(t);return t||null}}function ic(r){return r instanceof Function?r():r}function nS(r,e,t){let a=r.length;for(;;){const l=r.indexOf(e,t);if(-1===l)return l;if(0===l||r.charCodeAt(l-1)<=32){const u=e.length;if(l+u===a||r.charCodeAt(l+u)<=32)return l}t=l+1}}const fR="ng-template";function OM(r,e,t){let a=0;for(;a<r.length;){let l=r[a++];if(t&&"class"===l){if(l=r[a],-1!==nS(l.toLowerCase(),e,0))return!0}else if(1===l){for(;a<r.length&&"string"==typeof(l=r[a++]);)if(l.toLowerCase()===e)return!0;return!1}}return!1}function C(r){return 4===r.type&&r.value!==fR}function NM(r,e,t){return e===(4!==r.type||t?r.value:fR)}function PM(r,e,t){let a=4;const l=r.attrs||[],u=function kM(r){for(let e=0;e<r.length;e++)if(V0(r[e]))return e;return r.length}(l);let f=!1;for(let g=0;g<e.length;g++){const v=e[g];if("number"!=typeof v){if(!f)if(4&a){if(a=2|1&a,""!==v&&!NM(r,v,t)||""===v&&1===e.length){if(xs(a))return!1;f=!0}}else{const b=8&a?v:e[++g];if(8&a&&null!==r.attrs){if(!OM(r.attrs,b,t)){if(xs(a))return!1;f=!0}continue}const L=MM(8&a?"class":v,l,C(r),t);if(-1===L){if(xs(a))return!1;f=!0;continue}if(""!==b){let j;j=L>u?"":l[L+1].toLowerCase();const G=8&a?j:null;if(G&&-1!==nS(G,b,0)||2&a&&b!==j){if(xs(a))return!1;f=!0}}}}else{if(!f&&!xs(a)&&!xs(v))return!1;if(f&&xs(v))continue;f=!1,a=v|1&a}}return xs(a)||f}function xs(r){return 0==(1&r)}function MM(r,e,t,a){if(null===e)return-1;let l=0;if(a||!t){let u=!1;for(;l<e.length;){const f=e[l];if(f===r)return l;if(3===f||6===f)u=!0;else{if(1===f||2===f){let g=e[++l];for(;"string"==typeof g;)g=e[++l];continue}if(4===f)break;if(0===f){l+=4;continue}}l+=u?1:2}return-1}return function Eo(r,e){let t=r.indexOf(4);if(t>-1)for(t++;t<r.length;){const a=r[t];if("number"==typeof a)return-1;if(a===e)return t;t++}return-1}(e,r)}function mR(r,e,t=!1){for(let a=0;a<e.length;a++)if(PM(r,e[a],t))return!0;return!1}function _R(r,e){e:for(let t=0;t<e.length;t++){const a=e[t];if(r.length===a.length){for(let l=0;l<r.length;l++)if(r[l]!==a[l])continue e;return!0}}return!1}function gR(r,e){return r?":not("+e.trim()+")":e}function ER(r){let e=r[0],t=1,a=2,l="",u=!1;for(;t<r.length;){let f=r[t];if("string"==typeof f)if(2&a){const g=r[++t];l+="["+f+(g.length>0?'="'+g+'"':"")+"]"}else 8&a?l+="."+f:4&a&&(l+=" "+f);else""!==l&&!xs(f)&&(e+=gR(u,l),l=""),a=f,u=u||!xs(a);t++}return""!==l&&(e+=gR(u,l)),e}const vt={};function Xe(r){yR(en(),fe(),Jr()+r,!1)}function yR(r,e,t,a){if(!a)if(3==(3&e[2])){const u=r.preOrderCheckHooks;null!==u&&p_(e,u,t)}else{const u=r.preOrderHooks;null!==u&&f_(e,u,0,t)}pa(t)}function TR(r,e=null,t=null,a){const l=IR(r,e,t,a);return l.resolveInjectorInitializers(),l}function IR(r,e=null,t=null,a,l=new Set){const u=[t||vn,JI(r)];return a=a||("object"==typeof r?void 0:Dn(r)),new eR(u,e||Z_(),a||null,l)}let Nr=(()=>{class r{static create(t,a){if(Array.isArray(t))return TR({name:""},a,t,"");{const l=t.name??"";return TR({name:l},t.parent,t.providers,l)}}}return r.THROW_IF_NOT_FOUND=Za,r.NULL=new X_,r.\u0275prov=ke({token:r,providedIn:"any",factory:()=>he(XI)}),r.__NG_ELEMENT_ID__=-1,r})();function se(r,e=nt.Default){const t=fe();return null===t?he(r,e):W0(Pi(),t,$e(r),e)}function Bp(){throw new Error("invalid")}function sg(r,e){return r<<17|e<<2}function Fs(r){return r>>17&32767}function hS(r){return 2|r}function rc(r){return(131068&r)>>2}function pS(r,e){return-131069&r|e<<2}function fS(r){return 1|r}function jR(r,e){const t=r.contentQueries;if(null!==t)for(let a=0;a<t.length;a+=2){const l=t[a],u=t[a+1];if(-1!==u){const f=r.data[u];Ns(l),f.contentQueries(2,e[u],u)}}}function ug(r,e,t,a,l,u,f,g,v,b,D){const L=e.blueprint.slice();return L[0]=l,L[2]=76|a,(null!==D||r&&1024&r[2])&&(L[2]|=1024),C0(L),L[3]=L[15]=r,L[8]=t,L[10]=f||r&&r[10],L[11]=g||r&&r[11],L[12]=v||r&&r[12]||null,L[9]=b||r&&r[9]||null,L[6]=u,L[20]=function dI(){return kP++}(),L[21]=D,L[16]=2==e.type?r[16]:L,L}function ac(r,e,t,a,l){let u=r.data[e];if(null===u)u=function CS(r,e,t,a,l){const u=Zy(),f=$a(),v=r.data[e]=function pk(r,e,t,a,l,u){return{type:t,index:a,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:l,attrs:u,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,f?u:u&&u.parent,t,e,a,l);return null===r.firstChild&&(r.firstChild=v),null!==u&&(f?null==u.child&&null!==v.parent&&(u.child=v):null===u.next&&(u.next=v)),v}(r,e,t,a,l),function u_(){return yt.lFrame.inI18n}()&&(u.flags|=64);else if(64&u.type){u.type=t,u.value=a,u.attrs=l;const f=function up(){const r=yt.lFrame,e=r.currentTNode;return r.isParent?e:e.parent}();u.injectorIndex=null===f?-1:f.injectorIndex}return ua(u,!0),u}function Us(r,e,t,a){if(0===t)return-1;const l=e.length;for(let u=0;u<t;u++)e.push(a),r.blueprint.push(a),r.data.push(null);return l}function jp(r,e,t){nv(e);try{const a=r.viewQuery;null!==a&&$c(1,a,t);const l=r.template;null!==l&&rd(r,e,l,1,t),r.firstCreatePass&&(r.firstCreatePass=!1),r.staticContentQueries&&jR(r,e),r.staticViewQueries&&$c(2,r.viewQuery,t);const u=r.components;null!==u&&function lk(r,e){for(let t=0;t<e.length;t++)DS(r,e[t])}(e,u)}catch(a){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),a}finally{e[2]&=-5,rv()}}function Yc(r,e,t,a){const l=e[2];if(128!=(128&l)){nv(e);try{C0(e),function d_(r){return yt.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==t&&rd(r,e,t,2,a);const f=3==(3&l);if(f){const b=r.preOrderCheckHooks;null!==b&&p_(e,b,null)}else{const b=r.preOrderHooks;null!==b&&f_(e,b,0,null),hp(e,0)}if(function AS(r){for(let e=Av(r);null!==e;e=U_(e)){if(!e[2])continue;const t=e[9];for(let a=0;a<t.length;a++){const l=t[a],u=l[3];0==(512&l[2])&&Qy(u,1),l[2]|=512}}}(e),function Ck(r){for(let e=Av(r);null!==e;e=U_(e))for(let t=10;t<e.length;t++){const a=e[t],l=a[1];dp(a)&&Yc(l,a,l.template,a[8])}}(e),null!==r.contentQueries&&jR(r,e),f){const b=r.contentCheckHooks;null!==b&&p_(e,b)}else{const b=r.contentHooks;null!==b&&f_(e,b,1),hp(e,1)}!function ak(r,e){const t=r.hostBindingOpCodes;if(null!==t)try{for(let a=0;a<t.length;a++){const l=t[a];if(l<0)pa(~l);else{const u=l,f=t[++a],g=t[++a];ZN(f,u),g(2,e[u])}}}finally{pa(-1)}}(r,e);const g=r.components;null!==g&&function ck(r,e){for(let t=0;t<e.length;t++)Wp(r,e[t])}(e,g);const v=r.viewQuery;if(null!==v&&$c(2,v,a),f){const b=r.viewCheckHooks;null!==b&&p_(e,b)}else{const b=r.viewHooks;null!==b&&f_(e,b,2),hp(e,2)}!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),e[2]&=-41,512&e[2]&&(e[2]&=-513,Qy(e[3],-1))}finally{rv()}}}function rd(r,e,t,a,l){const u=Jr(),f=2&a;try{pa(-1),f&&e.length>22&&yR(r,e,22,!1),t(a,l)}finally{pa(u)}}function bS(r,e,t){if(op(e)){const l=e.directiveEnd;for(let u=e.directiveStart;u<l;u++){const f=r.data[u];f.contentQueries&&f.contentQueries(1,t[u],u)}}}function Hp(r,e,t){!T0()||(function Ek(r,e,t,a){const l=t.directiveStart,u=t.directiveEnd;r.firstCreatePass||fu(t,e),Or(a,e);const f=t.initialInputs;for(let g=l;g<u;g++){const v=r.data[g],b=As(v);b&&vk(e,t,v);const D=_p(e,r,g,t);Or(D,e),null!==f&&Sk(0,g-l,D,v,0,f),b&&(Fo(t.index,e)[8]=D)}}(r,e,t,xo(t,e)),128==(128&t.flags)&&function YR(r,e,t){const a=t.directiveStart,l=t.directiveEnd,u=t.index,f=function eP(){return yt.lFrame.currentDirectiveIndex}();try{pa(u);for(let g=a;g<l;g++){const v=r.data[g],b=e[g];Ja(g),(null!==v.hostBindings||0!==v.hostVars||null!==v.hostAttrs)&&$R(v,b)}}finally{pa(-1),Ja(f)}}(r,e,t))}function od(r,e,t=xo){const a=e.localNames;if(null!==a){let l=e.index+1;for(let u=0;u<a.length;u+=2){const f=a[u+1],g=-1===f?t(e,r):r[f];r[l++]=g}}}function HR(r){const e=r.tView;return null===e||e.incompleteFirstPass?r.tView=TS(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts):e}function TS(r,e,t,a,l,u,f,g,v,b){const D=22+a,L=D+l,j=function dk(r,e){const t=[];for(let a=0;a<e;a++)t.push(a<r?null:vt);return t}(D,L),G="function"==typeof b?b():b;return j[1]={type:r,blueprint:j,template:t,queries:null,viewQuery:g,declTNode:e,data:j.slice().fill(null,D),bindingStartIndex:D,expandoStartIndex:L,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof u?u():u,pipeRegistry:"function"==typeof f?f():f,firstChild:null,schemas:v,consts:G,incompleteFirstPass:!1}}function GR(r,e,t,a){const l=mg(e);null===t?l.push(a):(l.push(t),r.firstCreatePass&&_g(r).push(a,l.length-1))}function WR(r,e,t){for(let a in r)if(r.hasOwnProperty(a)){const l=r[a];(t=null===t?{}:t).hasOwnProperty(a)?t[a].push(e,l):t[a]=[e,l]}return t}function zR(r,e){const a=e.directiveEnd,l=r.data,u=e.attrs,f=[];let g=null,v=null;for(let b=e.directiveStart;b<a;b++){const D=l[b],L=D.inputs,j=null===u||C(e)?null:RS(L,u);f.push(j),g=WR(L,b,g),v=WR(D.outputs,b,v)}null!==g&&(g.hasOwnProperty("class")&&(e.flags|=16),g.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=f,e.inputs=g,e.outputs=v}function Bo(r,e,t,a,l,u,f,g){const v=xo(e,t);let D,b=e.inputs;!g&&null!=b&&(D=b[a])?(MS(r,t,D,a,l),r_(e)&&qR(t,e.index)):3&e.type&&(a=function KR(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(a),l=null!=f?f(l,e.value||"",a):l,u.setProperty(v,a,l))}function qR(r,e){const t=Fo(e,r);16&t[2]||(t[2]|=32)}function hg(r,e,t,a){let l=!1;if(T0()){const u=function XR(r,e,t){const a=r.directiveRegistry;let l=null;if(a)for(let u=0;u<a.length;u++){const f=a[u];mR(t,f.selectors,!1)&&(l||(l=[]),v_(fu(t,e),r,f.type),As(f)?(IS(r,t),l.unshift(f)):l.push(f))}return l}(r,e,t),f=null===a?null:{"":-1};if(null!==u){l=!0,QR(t,r.data.length,u.length);for(let D=0;D<u.length;D++){const L=u[D];L.providersResolver&&L.providersResolver(L)}let g=!1,v=!1,b=Us(r,e,u.length,null);for(let D=0;D<u.length;D++){const L=u[D];t.mergedAttrs=__(t.mergedAttrs,L.hostAttrs),ZR(r,t,e,b,L),JR(b,L,f),null!==L.contentQueries&&(t.flags|=8),(null!==L.hostBindings||null!==L.hostAttrs||0!==L.hostVars)&&(t.flags|=128);const j=L.type.prototype;!g&&(j.ngOnChanges||j.ngOnInit||j.ngDoCheck)&&((r.preOrderHooks||(r.preOrderHooks=[])).push(t.index),g=!0),!v&&(j.ngOnChanges||j.ngDoCheck)&&((r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(t.index),v=!0),b++}zR(r,t)}f&&function yk(r,e,t){if(e){const a=r.localNames=[];for(let l=0;l<e.length;l+=2){const u=t[e[l+1]];if(null==u)throw new pe(-301,!1);a.push(e[l],u)}}}(t,a,f)}return t.mergedAttrs=__(t.mergedAttrs,t.attrs),l}function yo(r,e,t,a,l,u){const f=u.hostBindings;if(f){let g=r.hostBindingOpCodes;null===g&&(g=r.hostBindingOpCodes=[]);const v=~e.index;(function gk(r){let e=r.length;for(;e>0;){const t=r[--e];if("number"==typeof t&&t<0)return t}return 0})(g)!=v&&g.push(v),g.push(a,l,f)}}function $R(r,e){null!==r.hostBindings&&r.hostBindings(1,e)}function IS(r,e){e.flags|=2,(r.components||(r.components=[])).push(e.index)}function JR(r,e,t){if(t){if(e.exportAs)for(let a=0;a<e.exportAs.length;a++)t[e.exportAs[a]]=r;As(e)&&(t[""]=r)}}function QR(r,e,t){r.flags|=1,r.directiveStart=e,r.directiveEnd=e+t,r.providerIndexes=e}function ZR(r,e,t,a,l){r.data[a]=l;const u=l.factory||(l.factory=Ul(l.type)),f=new pp(u,As(l),se);r.blueprint[a]=f,t[a]=f,yo(r,e,0,a,Us(r,t,l.hostVars,vt),l)}function vk(r,e,t){const a=xo(e,r),l=HR(t),u=r[10],f=zp(r,ug(r,l,null,t.onPush?32:16,a,e,u,u.createRenderer(a,t),null,null,null));r[e.index]=f}function hs(r,e,t,a,l,u){const f=xo(r,e);!function Gp(r,e,t,a,l,u,f){if(null==u)r.removeAttribute(e,l,t);else{const g=null==f?ut(u):f(u,a||"",l);r.setAttribute(e,l,g,t)}}(e[11],f,u,r.value,t,a,l)}function Sk(r,e,t,a,l,u){const f=u[e];if(null!==f){const g=a.setInput;for(let v=0;v<f.length;){const b=f[v++],D=f[v++],L=f[v++];null!==g?a.setInput(t,L,b,D):t[D]=L}}}function RS(r,e){let t=null,a=0;for(;a<e.length;){const l=e[a];if(0!==l)if(5!==l){if("number"==typeof l)break;r.hasOwnProperty(l)&&(null===t&&(t=[]),t.push(l,r[l],e[a+1])),a+=2}else a+=2;else a+=4}return t}function wS(r,e,t,a){return new Array(r,!0,!1,e,null,0,a,t,null,null)}function Wp(r,e){const t=Fo(e,r);if(dp(t)){const a=t[1];48&t[2]?Yc(a,t,a.template,t[8]):t[5]>0&&pg(t)}}function pg(r){for(let a=Av(r);null!==a;a=U_(a))for(let l=10;l<a.length;l++){const u=a[l];if(dp(u))if(512&u[2]){const f=u[1];Yc(f,u,f.template,u[8])}else u[5]>0&&pg(u)}const t=r[1].components;if(null!==t)for(let a=0;a<t.length;a++){const l=Fo(t[a],r);dp(l)&&l[5]>0&&pg(l)}}function DS(r,e){const t=Fo(e,r),a=t[1];(function OS(r,e){for(let t=e.length;t<r.blueprint.length;t++)e.push(r.blueprint[t])})(a,t),jp(a,t,t[8])}function zp(r,e){return r[13]?r[14][4]=e:r[13]=e,r[14]=e,e}function fg(r){for(;r;){r[2]|=32;const e=Nu(r);if(xN(r)&&!e)return r;r=e}return null}function Kp(r,e,t,a=!0){const l=e[10];l.begin&&l.begin();try{Yc(r,e,r.template,t)}catch(f){throw a&&PS(e,f),f}finally{l.end&&l.end()}}function $c(r,e,t){Ns(0),e(r,t)}function mg(r){return r[7]||(r[7]=[])}function _g(r){return r.cleanup||(r.cleanup=[])}function PS(r,e){const t=r[9],a=t?t.get(qc,null):null;a&&a.handleError(e)}function MS(r,e,t,a,l){for(let u=0;u<t.length;){const f=t[u++],g=t[u++],v=e[f],b=r.data[f];null!==b.setInput?b.setInput(v,l,a,g):v[g]=l}}function ga(r,e,t){let a=t?r.styles:null,l=t?r.classes:null,u=0;if(null!==e)for(let f=0;f<e.length;f++){const g=e[f];"number"==typeof g?u=g:1==u?l=Km(l,g):2==u&&(a=Km(a,g+": "+e[++f]+";"))}t?r.styles=a:r.stylesWithoutHost=a,t?r.classes=l:r.classesWithoutHost=l}function qp(r,e,t,a,l=!1){for(;null!==t;){const u=e[t.index];if(null!==u&&a.push(Wn(u)),ws(u))for(let g=10;g<u.length;g++){const v=u[g],b=v[1].firstChild;null!==b&&qp(v[1],v,b,a)}const f=t.type;if(8&f)qp(r,e,t.child,a);else if(32&f){const g=ec(t,e);let v;for(;v=g();)a.push(v)}else if(16&f){const g=Fv(e,t);if(Array.isArray(g))a.push(...g);else{const v=Nu(e[16]);qp(v[1],v,g,a,!0)}}t=l?t.projectionNext:t.next}return a}class Yp{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return qp(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(ws(e)){const t=e[8],a=t?t.indexOf(this):-1;a>-1&&(Nv(e,a),Su(t,a))}this._attachedToViewContainer=!1}II(this._lView[1],this._lView)}onDestroy(e){GR(this._lView[1],this._lView,null,e)}markForCheck(){fg(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){Kp(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new pe(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function vI(r,e){ku(r,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new pe(902,!1);this._appRef=e}}class kS extends Yp{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;Kp(e[1],e,e[8],!1)}checkNoChanges(){}get context(){return null}}class LS extends td{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=Nn(e);return new sd(t,this.ngModule)}}function tw(r){const e=[];for(let t in r)r.hasOwnProperty(t)&&e.push({propName:r[t],templateName:t});return e}class Ik{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,a){const l=this.injector.get(e,tS,a);return l!==tS||t===tS?l:this.parentInjector.get(e,t,a)}}class sd extends iR{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function LM(r){return r.map(ER).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return tw(this.componentDef.inputs)}get outputs(){return tw(this.componentDef.outputs)}create(e,t,a,l){let u=(l=l||this.ngModule)instanceof Wc?l:l?.injector;u&&null!==this.componentDef.getStandaloneInjector&&(u=this.componentDef.getStandaloneInjector(u)||u);const f=u?new Ik(e,u):e,g=f.get(Fu,null);if(null===g)throw new pe(407,!1);const v=f.get(aR,null),b=g.createRenderer(null,this.componentDef),D=this.componentDef.selectors[0][0]||"div",L=a?function hk(r,e,t){return r.selectRootElement(e,t===Rr.ShadowDom)}(b,a,this.componentDef.encapsulation):Mu(b,D,function Tk(r){const e=r.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(D)),j=this.componentDef.onPush?288:272,G=TS(0,null,null,1,0,null,null,null,null,null),q=ug(null,G,null,j,null,null,g,b,v,f,null);let ie,ce;nv(q);try{const Ce=function rw(r,e,t,a,l,u){const f=t[1];t[22]=r;const v=ac(f,22,2,"#host",null),b=v.mergedAttrs=e.hostAttrs;null!==b&&(ga(v,b,!0),null!==r&&(m_(l,r,b),null!==v.classes&&_a(l,r,v.classes),null!==v.styles&&MI(l,r,v.styles)));const D=a.createRenderer(r,e),L=ug(t,HR(e),null,e.onPush?32:16,t[22],v,a,D,u||null,null,null);return f.firstCreatePass&&(v_(fu(v,t),f,e.type),IS(f,v),QR(v,t.length,1)),zp(t,L),t[22]=L}(L,this.componentDef,q,g,b);if(L)if(a)m_(b,L,["ng-version",cR.full]);else{const{attrs:we,classes:ue}=function rS(r){const e=[],t=[];let a=1,l=2;for(;a<r.length;){let u=r[a];if("string"==typeof u)2===l?""!==u&&e.push(u,r[++a]):8===l&&t.push(u);else{if(!xs(l))break;l=u}a++}return{attrs:e,classes:t}}(this.componentDef.selectors[0]);we&&m_(b,L,we),ue&&ue.length>0&&_a(b,L,ue.join(" "))}if(ce=Jy(G,22),void 0!==t){const we=ce.projection=[];for(let ue=0;ue<this.ngContentSelectors.length;ue++){const Fe=t[ue];we.push(null!=Fe?Array.from(Fe):null)}}ie=function FS(r,e,t,a){const l=t[1],u=function _k(r,e,t){const a=Pi();r.firstCreatePass&&(t.providersResolver&&t.providersResolver(t),ZR(r,a,e,Us(r,e,1,null),t),zR(r,a));const l=_p(e,r,a.directiveStart,a);Or(l,e);const u=xo(a,e);return u&&Or(u,e),l}(l,t,e);if(r[8]=t[8]=u,null!==a)for(const g of a)g(u,e);if(e.contentQueries){const g=Pi();e.contentQueries(1,u,g.directiveStart)}const f=Pi();return!l.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(pa(f.index),yo(t[1],f,0,f.directiveStart,f.directiveEnd,e),$R(e,u)),u}(Ce,this.componentDef,q,[gg]),jp(G,q,null)}finally{rv()}return new iw(this.componentType,ie,xu(ce,q),q,ce)}}class iw extends class yM{}{constructor(e,t,a,l,u){super(),this.location=a,this._rootLView=l,this._tNode=u,this.instance=t,this.hostView=this.changeDetectorRef=new kS(l),this.componentType=e}setInput(e,t){const a=this._tNode.inputs;let l;if(null!==a&&(l=a[e])){const u=this._rootLView;MS(u[1],u,l,e,t),qR(u,this._tNode.index)}}get injector(){return new mu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function gg(){const r=Pi();h_(fe()[1],r)}function Ft(r){let e=function $p(r){return Object.getPrototypeOf(r.prototype).constructor}(r.type),t=!0;const a=[r];for(;e;){let l;if(As(r))l=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new pe(903,!1);l=e.\u0275dir}if(l){if(t){a.push(l);const f=r;f.inputs=lc(r.inputs),f.declaredInputs=lc(r.declaredInputs),f.outputs=lc(r.outputs);const g=l.hostBindings;g&&Ak(r,g);const v=l.viewQuery,b=l.contentQueries;if(v&&ow(r,v),b&&wk(r,b),zm(r.inputs,l.inputs),zm(r.declaredInputs,l.declaredInputs),zm(r.outputs,l.outputs),As(l)&&l.data.animation){const D=r.data;D.animation=(D.animation||[]).concat(l.data.animation)}}const u=l.features;if(u)for(let f=0;f<u.length;f++){const g=u[f];g&&g.ngInherit&&g(r),g===Ft&&(t=!1)}}e=Object.getPrototypeOf(e)}!function ju(r){let e=0,t=null;for(let a=r.length-1;a>=0;a--){const l=r[a];l.hostVars=e+=l.hostVars,l.hostAttrs=__(l.hostAttrs,t=__(t,l.hostAttrs))}}(a)}function lc(r){return r===du?{}:r===vn?[]:r}function ow(r,e){const t=r.viewQuery;r.viewQuery=t?(a,l)=>{e(a,l),t(a,l)}:e}function wk(r,e){const t=r.contentQueries;r.contentQueries=t?(a,l,u)=>{e(a,l,u),t(a,l,u)}:e}function Ak(r,e){const t=r.hostBindings;r.hostBindings=t?(a,l)=>{e(a,l),t(a,l)}:e}let Eg=null;function ad(){if(!Eg){const r=Hn.Symbol;if(r&&r.iterator)Eg=r.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const a=e[t];"entries"!==a&&"size"!==a&&Map.prototype[a]===Map.prototype.entries&&(Eg=a)}}}return Eg}function Jp(r){return!!VS(r)&&(Array.isArray(r)||!(r instanceof Map)&&ad()in r)}function VS(r){return null!==r&&("function"==typeof r||"object"==typeof r)}function Vs(r,e,t){return r[e]=t}function Li(r,e,t){return!Object.is(r[e],t)&&(r[e]=t,!0)}function Pr(r,e,t,a){const l=Li(r,e,t);return Li(r,e+1,a)||l}function tr(r,e,t,a){const l=fe();return Li(l,hu(),e)&&(en(),hs(ni(),l,r,e,t,a)),tr}function zn(r,e,t,a,l,u,f,g){const v=fe(),b=en(),D=r+22,L=b.firstCreatePass?function fw(r,e,t,a,l,u,f,g,v){const b=e.consts,D=ac(e,r,4,f||null,Wt(b,g));hg(e,t,D,Wt(b,v)),h_(e,D);const L=D.tViews=TS(2,D,a,l,u,e.directiveRegistry,e.pipeRegistry,null,e.schemas,b);return null!==e.queries&&(e.queries.template(e,D),L.queries=e.queries.embeddedTView(D)),D}(D,b,v,e,t,a,l,u,f):b.data[D];ua(L,!1);const j=v[11].createComment("");H_(b,v,j,L),Or(j,v),zp(v,v[D]=wS(j,v,j,L)),sp(L)&&Hp(b,v,L),null!=f&&od(v,L,g)}function ef(r){return Os(function QN(){return yt.lFrame.contextLView}(),22+r)}function Ze(r,e,t){const a=fe();return Li(a,hu(),e)&&Bo(en(),ni(),a,r,e,a[11],t,!1),Ze}function Sg(r,e,t,a,l){const f=l?"class":"style";MS(r,t,e.inputs[f],f,a)}function De(r,e,t,a){const l=fe(),u=en(),f=22+r,g=l[11],v=l[f]=Mu(g,e,function k0(){return yt.lFrame.currentNamespace}()),b=u.firstCreatePass?function Pk(r,e,t,a,l,u,f){const g=e.consts,b=ac(e,r,2,l,Wt(g,u));return hg(e,t,b,Wt(g,f)),null!==b.attrs&&ga(b,b.attrs,!1),null!==b.mergedAttrs&&ga(b,b.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,b),b}(f,u,l,0,e,t,a):u.data[f];ua(b,!0);const D=b.mergedAttrs;null!==D&&m_(g,v,D);const L=b.classes;null!==L&&_a(g,v,L);const j=b.styles;return null!==j&&MI(g,v,j),64!=(64&b.flags)&&H_(u,l,v,b),0===function YN(){return yt.lFrame.elementDepthCount}()&&Or(v,l),function $N(){yt.lFrame.elementDepthCount++}(),sp(b)&&(Hp(u,l,b),bS(u,b,l)),null!==a&&od(l,b),De}function Ge(){let r=Pi();$a()?ev():(r=r.parent,ua(r,!1));const e=r;!function b0(){yt.lFrame.elementDepthCount--}();const t=en();return t.firstCreatePass&&(h_(t,r),op(r)&&t.queries.elementEnd(r)),null!=e.classesWithoutHost&&function U0(r){return 0!=(16&r.flags)}(e)&&Sg(t,e,fe(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function sP(r){return 0!=(32&r.flags)}(e)&&Sg(t,e,fe(),e.stylesWithoutHost,!1),Ge}function tn(r,e,t,a){return De(r,e,t,a),Ge(),tn}function uc(r,e,t){const a=fe(),l=en(),u=r+22,f=l.firstCreatePass?function tf(r,e,t,a,l){const u=e.consts,f=Wt(u,a),g=ac(e,r,8,"ng-container",f);return null!==f&&ga(g,f,!0),hg(e,t,g,Wt(u,l)),null!==e.queries&&e.queries.elementStart(e,g),g}(u,l,a,e,t):l.data[u];ua(f,!0);const g=a[u]=a[11].createComment("");return H_(l,a,g,f),Or(g,a),sp(f)&&(Hp(l,a,f),bS(l,f,a)),null!=t&&od(a,f),uc}function Jc(){let r=Pi();const e=en();return $a()?ev():(r=r.parent,ua(r,!1)),e.firstCreatePass&&(h_(e,r),op(r)&&e.queries.elementEnd(r)),Jc}function ya(){return fe()}function ld(r){return!!r&&"function"==typeof r.then}function _w(r){return!!r&&"function"==typeof r.subscribe}const jS=_w;function Xt(r,e,t,a){const l=fe(),u=en(),f=Pi();return function GS(r,e,t,a,l,u,f,g){const v=sp(a),D=r.firstCreatePass&&_g(r),L=e[8],j=mg(e);let G=!0;if(3&a.type||g){const ce=xo(a,e),Ce=g?g(ce):ce,we=j.length,ue=g?Vt=>g(Wn(Vt[a.index])):a.index;let Fe=null;if(!g&&v&&(Fe=function gw(r,e,t,a){const l=r.cleanup;if(null!=l)for(let u=0;u<l.length-1;u+=2){const f=l[u];if(f===t&&l[u+1]===a){const g=e[7],v=l[u+2];return g.length>v?g[v]:null}"string"==typeof f&&(u+=2)}return null}(r,e,l,a.index)),null!==Fe)(Fe.__ngLastListenerFn__||Fe).__ngNextListenerFn__=u,Fe.__ngLastListenerFn__=u,G=!1;else{u=Ew(a,e,L,u,!1);const Vt=t.listen(Ce,l,u);j.push(u,Vt),D&&D.push(l,ue,we,we+1)}}else u=Ew(a,e,L,u,!1);const q=a.outputs;let ie;if(G&&null!==q&&(ie=q[l])){const ce=ie.length;if(ce)for(let Ce=0;Ce<ce;Ce+=2){const pn=e[ie[Ce]][ie[Ce+1]].subscribe(u),Ai=j.length;j.push(u,pn),D&&D.push(l,a.index,Ai,-(Ai+1))}}}(u,l,l[11],f,r,e,0,a),Xt}function WS(r,e,t,a){try{return!1!==t(a)}catch(l){return PS(r,l),!1}}function Ew(r,e,t,a,l){return function u(f){if(f===Function)return a;fg(2&r.flags?Fo(r.index,e):e);let v=WS(e,0,a,f),b=u.__ngNextListenerFn__;for(;b;)v=WS(e,0,b,f)&&v,b=b.__ngNextListenerFn__;return l&&!1===v&&(f.preventDefault(),f.returnValue=!1),v}}function ln(r=1){return function P0(r){return(yt.lFrame.contextLView=function nP(r,e){for(;r>0;)e=e[15],r--;return e}(r,yt.lFrame.contextLView))[8]}(r)}function Mk(r,e){let t=null;const a=function iS(r){const e=r.attrs;if(null!=e){const t=e.indexOf(5);if(0==(1&t))return e[t+1]}return null}(r);for(let l=0;l<e.length;l++){const u=e[l];if("*"!==u){if(null===a?mR(r,u,!0):_R(a,u))return l}else t=l}return t}function hc(r){const e=fe()[16][6];if(!e.projection){const a=e.projection=Cu(r?r.length:1,null),l=a.slice();let u=e.child;for(;null!==u;){const f=r?Mk(u,r):0;null!==f&&(l[f]?l[f].projectionNext=u:a[f]=u,l[f]=u),u=u.next}}}function Mr(r,e=0,t){const a=fe(),l=en(),u=ac(l,22+r,16,null,t||null);null===u.projection&&(u.projection=e),ev(),64!=(64&u.flags)&&function PI(r,e,t){Vv(e[11],0,e,t,j_(r,t,e),Mv(t.parent||e[6],t,e))}(l,a,u)}function Tw(r,e,t,a,l){const u=r[t+1],f=null===e;let g=a?Fs(u):rc(u),v=!1;for(;0!==g&&(!1===v||f);){const D=r[g+1];xk(r[g],e)&&(v=!0,r[g+1]=a?fS(D):hS(D)),g=a?Fs(D):rc(D)}v&&(r[t+1]=a?hS(u):fS(u))}function xk(r,e){return null===r||null==e||(Array.isArray(r)?r[1]:r)===e||!(!Array.isArray(r)||"string"!=typeof e)&&bu(r,e)>=0}function qS(r,e,t){return Bs(r,e,t,!1),qS}function In(r,e){return Bs(r,e,null,!0),In}function Bs(r,e,t,a){const l=fe(),u=en(),f=function Xa(r){const e=yt.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+r,t}(2);u.firstUpdatePass&&function Mw(r,e,t,a){const l=r.data;if(null===l[t+1]){const u=l[Jr()],f=function Pw(r,e){return e>=r.expandoStartIndex}(r,t);(function z(r,e){return 0!=(r.flags&(e?16:32))})(u,a)&&null===e&&!f&&(e=!1),e=function Wk(r,e,t,a){const l=function tv(r){const e=yt.lFrame.currentDirectiveIndex;return-1===e?null:r[e]}(r);let u=a?e.residualClasses:e.residualStyles;if(null===l)0===(a?e.classBindings:e.styleBindings)&&(t=dd(t=YS(null,r,e,t,a),e.attrs,a),u=null);else{const f=e.directiveStylingLast;if(-1===f||r[f]!==l)if(t=YS(l,r,e,t,a),null===u){let v=function zk(r,e,t){const a=t?e.classBindings:e.styleBindings;if(0!==rc(a))return r[Fs(a)]}(r,e,a);void 0!==v&&Array.isArray(v)&&(v=YS(null,r,e,v[1],a),v=dd(v,e.attrs,a),function Kk(r,e,t,a){r[Fs(t?e.classBindings:e.styleBindings)]=a}(r,e,a,v))}else u=function kw(r,e,t){let a;const l=e.directiveEnd;for(let u=1+e.directiveStylingLast;u<l;u++)a=dd(a,r[u].hostAttrs,t);return dd(a,e.attrs,t)}(r,e,a)}return void 0!==u&&(a?e.residualClasses=u:e.residualStyles=u),t}(l,u,e,a),function kk(r,e,t,a,l,u){let f=u?e.classBindings:e.styleBindings,g=Fs(f),v=rc(f);r[a]=t;let D,b=!1;if(Array.isArray(t)){const L=t;D=L[1],(null===D||bu(L,D)>0)&&(b=!0)}else D=t;if(l)if(0!==v){const j=Fs(r[g+1]);r[a+1]=sg(j,g),0!==j&&(r[j+1]=pS(r[j+1],a)),r[g+1]=function XM(r,e){return 131071&r|e<<17}(r[g+1],a)}else r[a+1]=sg(g,0),0!==g&&(r[g+1]=pS(r[g+1],a)),g=a;else r[a+1]=sg(v,0),0===g?g=a:r[v+1]=pS(r[v+1],a),v=a;b&&(r[a+1]=hS(r[a+1])),Tw(r,D,a,!0),Tw(r,D,a,!1),function Lk(r,e,t,a,l){const u=l?r.residualClasses:r.residualStyles;null!=u&&"string"==typeof e&&bu(u,e)>=0&&(t[a+1]=fS(t[a+1]))}(e,D,r,a,u),f=sg(g,v),u?e.classBindings=f:e.styleBindings=f}(l,u,e,t,f,a)}}(u,r,f,a),e!==vt&&Li(l,f,e)&&function xw(r,e,t,a,l,u,f,g){if(!(3&e.type))return;const v=r.data,b=v[g+1];Ig(function kR(r){return 1==(1&r)}(b)?$S(v,e,t,l,rc(b),f):void 0)||(Ig(u)||function uS(r){return 2==(2&r)}(b)&&(u=$S(v,null,t,l,g,f)),function jP(r,e,t,a,l){if(e)l?r.addClass(t,a):r.removeClass(t,a);else{let u=-1===a.indexOf("-")?void 0:go.DashCase;null==l?r.removeStyle(t,a,u):("string"==typeof l&&l.endsWith("!important")&&(l=l.slice(0,-10),u|=go.Important),r.setStyle(t,a,l,u))}}(a,f,c_(Jr(),t),l,u))}(u,u.data[Jr()],l,l[11],r,l[f+1]=function Fw(r,e){return null==r||("string"==typeof e?r+=e:"object"==typeof r&&(r=Dn(Vo(r)))),r}(e,t),a,f)}function YS(r,e,t,a,l){let u=null;const f=t.directiveEnd;let g=t.directiveStylingLast;for(-1===g?g=t.directiveStart:g++;g<f&&(u=e[g],a=dd(a,u.hostAttrs,l),u!==r);)g++;return null!==r&&(t.directiveStylingLast=g),a}function dd(r,e,t){const a=t?1:2;let l=-1;if(null!==e)for(let u=0;u<e.length;u++){const f=e[u];"number"==typeof f?l=f:l===a&&(Array.isArray(r)||(r=void 0===r?[]:["",r]),_o(r,f,!!t||e[++u]))}return void 0===r?null:r}function $S(r,e,t,a,l,u){const f=null===e;let g;for(;l>0;){const v=r[l],b=Array.isArray(v),D=b?v[1]:v,L=null===D;let j=t[l+1];j===vt&&(j=L?vn:void 0);let G=L?I_(j,a):D===a?j:void 0;if(b&&!Ig(G)&&(G=I_(v,a)),Ig(G)&&(g=G,f))return g;const q=r[l+1];l=f?Fs(q):rc(q)}if(null!==e){let v=u?e.residualClasses:e.residualStyles;null!=v&&(g=I_(v,a))}return g}function Ig(r){return void 0!==r}function $i(r,e=""){const t=fe(),a=en(),l=r+22,u=a.firstCreatePass?ac(a,l,1,e,null):a.data[l],f=t[l]=function Np(r,e){return r.createText(e)}(t[11],e);H_(a,t,f,u),ua(u,!1)}function fs(r){return Qc("",r,""),fs}function Qc(r,e,t){const a=fe(),l=function cd(r,e,t,a){return Li(r,hu(),t)?e+ut(t)+a:vt}(a,r,e,t);return l!==vt&&function cc(r,e,t){const a=c_(e,r);!function B_(r,e,t){r.setValue(e,t)}(r[11],a,t)}(a,Jr(),l),Qc}function Vn(r,e,t){const a=fe();return Li(a,hu(),e)&&Bo(en(),ni(),a,r,e,a[11],t,!0),Vn}const kt="en-US";let Ke=kt;function Gg(r,e,t,a,l){if(r=$e(r),Array.isArray(r))for(let u=0;u<r.length;u++)Gg(r[u],e,t,a,l);else{const u=en(),f=fe();let g=ed(r)?r:$e(r.provide),v=Qv(r);const b=Pi(),D=1048575&b.providerIndexes,L=b.directiveStart,j=b.providerIndexes>>20;if(ed(r)||!r.multi){const G=new pp(v,l,se),q=hC(g,e,l?D:D+j,L);-1===q?(v_(fu(b,f),u,g),Wg(u,r,e.length),e.push(g),b.directiveStart++,b.directiveEnd++,l&&(b.providerIndexes+=1048576),t.push(G),f.push(G)):(t[q]=G,f[q]=G)}else{const G=hC(g,e,D+j,L),q=hC(g,e,D,D+j),ie=G>=0&&t[G],ce=q>=0&&t[q];if(l&&!ce||!l&&!ie){v_(fu(b,f),u,g);const Ce=function rA(r,e,t,a,l){const u=new pp(r,t,se);return u.multi=[],u.index=e,u.componentProviders=0,iA(u,l,a&&!t),u}(l?pC:Ju,t.length,l,a,v);!l&&ce&&(t[q].providerFactory=Ce),Wg(u,r,e.length,0),e.push(g),b.directiveStart++,b.directiveEnd++,l&&(b.providerIndexes+=1048576),t.push(Ce),f.push(Ce)}else Wg(u,r,G>-1?G:q,iA(t[l?q:G],v,!l&&a));!l&&a&&ce&&t[q].componentProviders++}}}function Wg(r,e,t,a){const l=ed(e),u=function ZI(r){return!!r.useClass}(e);if(l||u){const v=(u?$e(e.useClass):e).prototype.ngOnDestroy;if(v){const b=r.destroyHooks||(r.destroyHooks=[]);if(!l&&e.multi){const D=b.indexOf(t);-1===D?b.push(t,[a,v]):b[D+1].push(a,v)}else b.push(t,v)}}}function iA(r,e,t){return t&&r.componentProviders++,r.multi.push(e)-1}function hC(r,e,t,a){for(let l=t;l<a;l++)if(e[l]===r)return l;return-1}function Ju(r,e,t,a){return zg(this.multi,[])}function pC(r,e,t,a){const l=this.multi;let u;if(this.providerFactory){const f=this.providerFactory.componentProviders,g=_p(t,t[1],this.providerFactory.index,a);u=g.slice(0,f),zg(l,u);for(let v=f;v<g.length;v++)u.push(g[v])}else u=[],zg(l,u);return u}function zg(r,e){for(let t=0;t<r.length;t++)e.push((0,r[t])());return e}function Mn(r,e=[]){return t=>{t.providersResolver=(a,l)=>function Hg(r,e,t){const a=en();if(a.firstCreatePass){const l=As(r);Gg(t,a.data,a.blueprint,l,!0),Gg(e,a.data,a.blueprint,l,!1)}}(a,l?l(r):r,e)}}class gc{}class fC{}class sA extends gc{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new LS(this);const a=mo(e);this._bootstrapComponents=ic(a.bootstrap),this._r3Injector=IR(e,t,[{provide:gc,useValue:this},{provide:td,useValue:this.componentFactoryResolver}],Dn(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class mC extends fC{constructor(e){super(),this.moduleType=e}create(e){return new sA(this.moduleType,e)}}class _C extends gc{constructor(e,t,a){super(),this.componentFactoryResolver=new LS(this),this.instance=null;const l=new eR([...e,{provide:gc,useValue:this},{provide:td,useValue:this.componentFactoryResolver}],t||Z_(),a,new Set(["environment"]));this.injector=l,l.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}}function mf(r,e,t=null){return new _C(r,e,t).injector}let aA=(()=>{class r{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t.id)){const a=Fp(0,t.type),l=a.length>0?mf([a],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t.id,l)}return this.cachedInjectors.get(t.id)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}}return r.\u0275prov=ke({token:r,providedIn:"environment",factory:()=>new r(he(Wc))}),r})();function gC(r){r.getStandaloneInjector=e=>e.get(aA).getOrCreateStandaloneInjector(r)}function SC(r,e,t,a,l,u,f){return function Xg(r,e,t,a,l,u,f,g,v){const b=e+t;return function ps(r,e,t,a,l,u){const f=Pr(r,e,t,a);return Pr(r,e+2,l,u)||f}(r,b,l,u,f,g)?Vs(r,b+4,v?a.call(v,l,u,f,g):a(l,u,f,g)):_f(r,b+4)}(fe(),Xr(),r,e,t,a,l,u,f)}function _f(r,e){const t=r[e];return t===vt?void 0:t}function yA(r,e,t,a,l,u){const f=e+t;return Li(r,f,l)?Vs(r,f+1,u?a.call(u,l):a(l)):_f(r,f+1)}function gf(r,e){const t=en();let a;const l=r+22;t.firstCreatePass?(a=function I1(r,e){if(e)for(let t=e.length-1;t>=0;t--){const a=e[t];if(r===a.name)return a}}(e,t.pipeRegistry),t.data[l]=a,a.onDestroy&&(t.destroyHooks||(t.destroyHooks=[])).push(l,a.onDestroy)):a=t.data[l];const u=a.factory||(a.factory=Ul(a.type)),f=Mo(se);try{const g=fp(!1),v=u();return fp(g),function mw(r,e,t,a){t>=r.data.length&&(r.data[t]=null,r.blueprint[t]=null),e[t]=a}(t,fe(),l,v),v}finally{Mo(f)}}function Qu(r,e,t){const a=r+22,l=fe(),u=Os(l,a);return function Ef(r,e){return r[1].data[e].pure}(l,a)?yA(l,Xr(),e,u.transform,t,u):u.transform(t)}function yf(r){return e=>{setTimeout(r,void 0,e)}}const un=class tl extends fn{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,a){let l=e,u=t||(()=>null),f=a;if(e&&"object"==typeof e){const v=e;l=v.next?.bind(v),u=v.error?.bind(v),f=v.complete?.bind(v)}this.__isAsync&&(u=yf(u),l&&(l=yf(l)),f&&(f=yf(f)));const g=super.subscribe({next:l,error:u,complete:f});return e instanceof Cn&&e.add(g),g}};function IA(){return this._results[ad()]()}class Jg{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=ad(),a=Jg.prototype;a[t]||(a[t]=IA)}get changes(){return this._changes||(this._changes=new un)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const a=this;a.dirty=!1;const l=Qr(e);(this._changesDetected=!function EP(r,e,t){if(r.length!==e.length)return!1;for(let a=0;a<r.length;a++){let l=r[a],u=e[a];if(t&&(l=t(l),u=t(u)),u!==l)return!1}return!0}(a._results,l,t))&&(a._results=l,a.length=l.length,a.last=l[this.length-1],a.first=l[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Ta=(()=>{class r{}return r.__NG_ELEMENT_ID__=AA,r})();const RA=Ta,wA=class extends RA{constructor(e,t,a){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=a}createEmbeddedView(e,t){const a=this._declarationTContainer.tViews,l=ug(this._declarationLView,a,e,16,null,a.declTNode,null,null,null,null,t||null);l[17]=this._declarationLView[this._declarationTContainer.index];const f=this._declarationLView[19];return null!==f&&(l[19]=f.createEmbeddedView(a)),jp(a,l,e),new Yp(l)}};function AA(){return Qg(Pi(),fe())}function Qg(r,e){return 4&r.type?new wA(e,r,xu(r,e)):null}let Go=(()=>{class r{}return r.__NG_ELEMENT_ID__=R1,r})();function R1(){return wC(Pi(),fe())}const DA=Go,IC=class extends DA{constructor(e,t,a){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=a}get element(){return xu(this._hostTNode,this._hostLView)}get injector(){return new mu(this._hostTNode,this._hostLView)}get parentInjector(){const e=y_(this._hostTNode,this._hostLView);if(g_(e)){const t=fa(e,this._hostLView),a=pu(e);return new mu(t[1].data[a+8],t)}return new mu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=vf(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,a){let l,u;"number"==typeof a?l=a:null!=a&&(l=a.index,u=a.injector);const f=e.createEmbeddedView(t||{},u);return this.insert(f,l),f}createComponent(e,t,a,l,u){const f=e&&!function gp(r){return"function"==typeof r}(e);let g;if(f)g=t;else{const L=t||{};g=L.index,a=L.injector,l=L.projectableNodes,u=L.environmentInjector||L.ngModuleRef}const v=f?e:new sd(Nn(e)),b=a||this.parentInjector;if(!u&&null==v.ngModule){const j=(f?b:this.parentInjector).get(Wc,null);j&&(u=j)}const D=v.create(b,l,void 0,u);return this.insert(D.hostView,g),D}insert(e,t){const a=e._lView,l=a[1];if(function qN(r){return ws(r[3])}(a)){const D=this.indexOf(e);if(-1!==D)this.detach(D);else{const L=a[3],j=new IC(L,L[6],L[3]);j.detach(j.indexOf(e))}}const u=this._adjustIndex(t),f=this._lContainer;!function CI(r,e,t,a){const l=10+a,u=t.length;a>0&&(t[l-1][4]=e),a<u-10?(e[4]=t[l],mv(t,10+a,e)):(t.push(e),e[4]=null),e[3]=t;const f=e[17];null!==f&&t!==f&&function bI(r,e){const t=r[9];e[16]!==e[3][3][16]&&(r[2]=!0),null===t?r[9]=[e]:t.push(e)}(f,e);const g=e[19];null!==g&&g.insertView(r),e[2]|=64}(l,a,f,u);const g=Uv(u,f),v=a[11],b=Pp(v,f[7]);return null!==b&&function yI(r,e,t,a,l,u){a[0]=l,a[6]=e,ku(r,a,t,1,l,u)}(l,f[6],v,a,b,g),e.attachToViewContainerRef(),mv(RC(f),u,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=vf(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),a=Nv(this._lContainer,t);a&&(Su(RC(this._lContainer),t),II(a[1],a))}detach(e){const t=this._adjustIndex(e,-1),a=Nv(this._lContainer,t);return a&&null!=Su(RC(this._lContainer),t)?new Yp(a):null}_adjustIndex(e,t=0){return e??this.length+t}};function vf(r){return r[8]}function RC(r){return r[8]||(r[8]=[])}function wC(r,e){let t;const a=e[r.index];if(ws(a))t=a;else{let l;if(8&r.type)l=Wn(a);else{const u=e[11];l=u.createComment("");const f=xo(r,e);ql(u,Pp(u,f),l,function OI(r,e){return r.nextSibling(e)}(u,f),!1)}e[r.index]=t=wS(a,e,l,r),zp(e,t)}return new IC(t,r,e)}class AC{constructor(e){this.queryList=e,this.matches=null}clone(){return new AC(this.queryList)}setDirty(){this.queryList.setDirty()}}class th{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const a=null!==e.contentQueries?e.contentQueries[0]:t.length,l=[];for(let u=0;u<a;u++){const f=t.getByIndex(u);l.push(this.queries[f.indexInDeclarationView].clone())}return new th(l)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==vo(e,t).matches&&this.queries[t].setDirty()}}class OA{constructor(e,t,a=null){this.predicate=e,this.flags=t,this.read=a}}class Lr{constructor(e=[]){this.queries=e}elementStart(e,t){for(let a=0;a<this.queries.length;a++)this.queries[a].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let a=0;a<this.length;a++){const l=null!==t?t.length:0,u=this.getByIndex(a).embeddedTView(e,l);u&&(u.indexInDeclarationView=a,null!==t?t.push(u):t=[u])}return null!==t?new Lr(t):null}template(e,t){for(let a=0;a<this.queries.length;a++)this.queries[a].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class or{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new or(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let a=e.parent;for(;null!==a&&8&a.type&&a.index!==t;)a=a.parent;return t===(null!==a?a.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const a=this.metadata.predicate;if(Array.isArray(a))for(let l=0;l<a.length;l++){const u=a[l];this.matchTNodeWithReadOption(e,t,NA(t,u)),this.matchTNodeWithReadOption(e,t,mp(t,e,u,!1,!1))}else a===Ta?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,mp(t,e,a,!1,!1))}matchTNodeWithReadOption(e,t,a){if(null!==a){const l=this.metadata.read;if(null!==l)if(l===ci||l===Go||l===Ta&&4&t.type)this.addMatch(t.index,-2);else{const u=mp(t,e,l,!1,!1);null!==u&&this.addMatch(t.index,u)}else this.addMatch(t.index,a)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function NA(r,e){const t=r.localNames;if(null!==t)for(let a=0;a<t.length;a+=2)if(t[a]===e)return t[a+1];return null}function Zg(r,e,t,a){return-1===t?function PA(r,e){return 11&r.type?xu(r,e):4&r.type?Qg(r,e):null}(e,r):-2===t?function eE(r,e,t){return t===ci?xu(e,r):t===Ta?Qg(e,r):t===Go?wC(e,r):void 0}(r,e,a):_p(r,r[1],t,e)}function tE(r,e,t,a){const l=e[19].queries[a];if(null===l.matches){const u=r.data,f=t.matches,g=[];for(let v=0;v<f.length;v+=2){const b=f[v];g.push(b<0?null:Zg(e,u[b],f[v+1],t.metadata.read))}l.matches=g}return l.matches}function Sf(r,e,t,a){const l=r.queries.getByIndex(t),u=l.matches;if(null!==u){const f=tE(r,e,l,t);for(let g=0;g<u.length;g+=2){const v=u[g];if(v>0)a.push(f[g/2]);else{const b=u[g+1],D=e[-v];for(let L=10;L<D.length;L++){const j=D[L];j[17]===j[3]&&Sf(j[1],j,b,a)}if(null!==D[9]){const L=D[9];for(let j=0;j<L.length;j++){const G=L[j];Sf(G[1],G,b,a)}}}}}return a}function sr(r){const e=fe(),t=en(),a=w0();Ns(a+1);const l=vo(t,a);if(r.dirty&&function uu(r){return 4==(4&r[2])}(e)===(2==(2&l.metadata.flags))){if(null===l.matches)r.reset([]);else{const u=l.crossesNgTemplate?Sf(t,e,a,[]):tE(t,e,l,a);r.reset(u,vM),r.notifyOnChanges()}return!0}return!1}function Ec(r,e,t){const a=en();a.firstCreatePass&&(Ye(a,new OA(r,e,t),-1),2==(2&e)&&(a.staticViewQueries=!0)),Te(a,fe(),e)}function _s(r,e,t,a){const l=en();if(l.firstCreatePass){const u=Pi();Ye(l,new OA(e,t,a),u.index),function A1(r,e){const t=r.contentQueries||(r.contentQueries=[]);e!==(t.length?t[t.length-1]:-1)&&t.push(r.queries.length-1,e)}(l,r),2==(2&t)&&(l.staticContentQueries=!0)}Te(l,fe(),t)}function Xi(){return function MA(r,e){return r[19].queries[e].queryList}(fe(),w0())}function Te(r,e,t){const a=new Jg(4==(4&t));GR(r,e,a,a.destroy),null===e[19]&&(e[19]=new th),e[19].queries.push(new AC(a))}function Ye(r,e,t){null===r.queries&&(r.queries=new Lr),r.queries.track(new or(e,t))}function vo(r,e){return r.queries.getByIndex(e)}function nE(r,e){return Qg(r,e)}function oh(...r){}const sh=new Ne("Application Initializer");let ah=(()=>{class r{constructor(t){this.appInits=t,this.resolve=oh,this.reject=oh,this.initialized=!1,this.done=!1,this.donePromise=new Promise((a,l)=>{this.resolve=a,this.reject=l})}runInitializers(){if(this.initialized)return;const t=[],a=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let l=0;l<this.appInits.length;l++){const u=this.appInits[l]();if(ld(u))t.push(u);else if(jS(u)){const f=new Promise((g,v)=>{u.subscribe({complete:g,error:v})});t.push(f)}}Promise.all(t).then(()=>{a()}).catch(l=>{this.reject(l)}),0===t.length&&a(),this.initialized=!0}}return r.\u0275fac=function(t){return new(t||r)(he(sh,8))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const ch=new Ne("AppId",{providedIn:"root",factory:function HA(){return`${nl()}${nl()}${nl()}`}});function nl(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const wn=new Ne("Platform Initializer"),sE=new Ne("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Ii=new Ne("appBootstrapListener"),$n=new Ne("AnimationModuleType");let il=(()=>{class r{log(t){console.log(t)}warn(t){console.warn(t)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();const Pt=new Ne("LocaleId",{providedIn:"root",factory:()=>_t(Pt,nt.Optional|nt.SkipSelf)||function It(){return typeof $localize<"u"&&$localize.locale||kt}()});class GA{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}let aE=(()=>{class r{compileModuleSync(t){return new mC(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const a=this.compileModuleSync(t),u=ic(mo(t).declarations).reduce((f,g)=>{const v=Nn(g);return v&&f.push(new sd(v)),f},[]);return new GA(a,u)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const ne=(()=>Promise.resolve(0))();function et(r){typeof Zone>"u"?ne.then(()=>{r&&r.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",r)}class Ht{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:a=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new un(!1),this.onMicrotaskEmpty=new un(!1),this.onStable=new un(!1),this.onError=new un(!1),typeof Zone>"u")throw new pe(908,!1);Zone.assertZonePatched();const l=this;if(l._nesting=0,l._outer=l._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const u=Zone.AsyncStackTaggingZoneSpec;l._inner=l._inner.fork(new u("Angular"))}Zone.TaskTrackingZoneSpec&&(l._inner=l._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(l._inner=l._inner.fork(Zone.longStackTraceZoneSpec)),l.shouldCoalesceEventChangeDetection=!a&&t,l.shouldCoalesceRunChangeDetection=a,l.lastRequestAnimationFrameId=-1,l.nativeRequestAnimationFrame=function Re(){let r=Hn.requestAnimationFrame,e=Hn.cancelAnimationFrame;if(typeof Zone<"u"&&r&&e){const t=r[Zone.__symbol__("OriginalDelegate")];t&&(r=t);const a=e[Zone.__symbol__("OriginalDelegate")];a&&(e=a)}return{nativeRequestAnimationFrame:r,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function Ra(r){const e=()=>{!function Jn(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call(Hn,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,gn(r),r.isCheckStableRunning=!0,Ur(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),gn(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,a,l,u,f,g)=>{try{return gs(r),t.invokeTask(l,u,f,g)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===u.type||r.shouldCoalesceRunChangeDetection)&&e(),kC(r)}},onInvoke:(t,a,l,u,f,g,v)=>{try{return gs(r),t.invoke(l,u,f,g,v)}finally{r.shouldCoalesceRunChangeDetection&&e(),kC(r)}},onHasTask:(t,a,l,u)=>{t.hasTask(l,u),a===l&&("microTask"==u.change?(r._hasPendingMicrotasks=u.microTask,gn(r),Ur(r)):"macroTask"==u.change&&(r.hasPendingMacrotasks=u.macroTask))},onHandleError:(t,a,l,u)=>(t.handleError(l,u),r.runOutsideAngular(()=>r.onError.emit(u)),!1)})}(l)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ht.isInAngularZone())throw new pe(909,!1)}static assertNotInAngularZone(){if(Ht.isInAngularZone())throw new pe(909,!1)}run(e,t,a){return this._inner.run(e,t,a)}runTask(e,t,a,l){const u=this._inner,f=u.scheduleEventTask("NgZoneEvent: "+l,e,So,oh,oh);try{return u.runTask(f,t,a)}finally{u.cancelTask(f)}}runGuarded(e,t,a){return this._inner.runGuarded(e,t,a)}runOutsideAngular(e){return this._outer.run(e)}}const So={};function Ur(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function gn(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function gs(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function kC(r){r._nesting--,Ur(r)}class ro{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new un,this.onMicrotaskEmpty=new un,this.onStable=new un,this.onError=new un}run(e,t,a){return e.apply(t,a)}runGuarded(e,t,a){return e.apply(t,a)}runOutsideAngular(e){return e()}runTask(e,t,a,l){return e.apply(t,a)}}const Co=new Ne(""),Ys=new Ne("");let cE,Mt=(()=>{class r{constructor(t,a,l){this._ngZone=t,this.registry=a,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,cE||(function WA(r){cE=r}(l),l.addToWindow(a)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ht.assertNotInAngularZone(),et(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())et(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>!a.updateCb||!a.updateCb(t)||(clearTimeout(a.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,a,l){let u=-1;a&&a>0&&(u=setTimeout(()=>{this._callbacks=this._callbacks.filter(f=>f.timeoutId!==u),t(this._didWork,this.getPendingTasks())},a)),this._callbacks.push({doneCb:t,timeoutId:u,updateCb:l})}whenStable(t,a,l){if(l&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,a,l),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,a,l){return[]}}return r.\u0275fac=function(t){return new(t||r)(he(Ht),he(Es),he(Ys))},r.\u0275prov=ke({token:r,factory:r.\u0275fac}),r})(),Es=(()=>{class r{constructor(){this._applications=new Map}registerApplication(t,a){this._applications.set(t,a)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,a=!0){return cE?.findTestabilityInTree(this,t,a)??null}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})(),$s=null;const zA=new Ne("AllowMultipleToken"),lh=new Ne("PlatformDestroyListeners");class xC{constructor(e,t){this.name=e,this.token=t}}function YA(r,e,t=[]){const a=`Platform: ${e}`,l=new Ne(a);return(u=[])=>{let f=lE();if(!f||f.injector.get(zA,!1)){const g=[...t,...u,{provide:l,useValue:!0}];r?r(g):function KA(r){if($s&&!$s.get(zA,!1))throw new pe(400,!1);$s=r;const e=r.get(dh);(function qA(r){const e=r.get(wn,null);e&&e.forEach(t=>t())})(r)}(function $A(r=[],e){return Nr.create({name:e,providers:[{provide:J_,useValue:"platform"},{provide:lh,useValue:new Set([()=>$s=null])},...r]})}(g,a))}return function x1(r){const e=lE();if(!e)throw new pe(401,!1);return e}()}}function lE(){return $s?.get(dh)??null}let dh=(()=>{class r{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,a){const l=function FC(r,e){let t;return t="noop"===r?new ro:("zone.js"===r?void 0:r)||new Ht(e),t}(a?.ngZone,function uh(r){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!r||!r.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!r||!r.ngZoneRunCoalescing)||!1}}(a)),u=[{provide:Ht,useValue:l}];return l.run(()=>{const f=Nr.create({providers:u,parent:this.injector,name:t.moduleType.name}),g=t.create(f),v=g.injector.get(qc,null);if(!v)throw new pe(402,!1);return l.runOutsideAngular(()=>{const b=l.onError.subscribe({next:D=>{v.handleError(D)}});g.onDestroy(()=>{hh(this._modules,g),b.unsubscribe()})}),function UC(r,e,t){try{const a=t();return ld(a)?a.catch(l=>{throw e.runOutsideAngular(()=>r.handleError(l)),l}):a}catch(a){throw e.runOutsideAngular(()=>r.handleError(a)),a}}(v,l,()=>{const b=g.injector.get(ah);return b.runInitializers(),b.donePromise.then(()=>(function qe(r){zr(r,"Expected localeId to be defined"),"string"==typeof r&&(Ke=r.toLowerCase().replace(/_/g,"-"))}(g.injector.get(Pt,kt)||kt),this._moduleDoBootstrap(g),g))})})}bootstrapModule(t,a=[]){const l=XA({},a);return function Cd(r,e,t){const a=new mC(t);return Promise.resolve(a)}(0,0,t).then(u=>this.bootstrapModuleFactory(u,l))}_moduleDoBootstrap(t){const a=t.injector.get(bd);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(l=>a.bootstrap(l));else{if(!t.instance.ngDoBootstrap)throw new pe(403,!1);t.instance.ngDoBootstrap(a)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new pe(404,!1);this._modules.slice().forEach(a=>a.destroy()),this._destroyListeners.forEach(a=>a());const t=this._injector.get(lh,null);t&&(t.forEach(a=>a()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return r.\u0275fac=function(t){return new(t||r)(he(Nr))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();function XA(r,e){return Array.isArray(e)?e.reduce(XA,r):{...r,...e}}let bd=(()=>{class r{constructor(t,a,l){this._zone=t,this._injector=a,this._exceptionHandler=l,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const u=new An(g=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{g.next(this._stable),g.complete()})}),f=new An(g=>{let v;this._zone.runOutsideAngular(()=>{v=this._zone.onStable.subscribe(()=>{Ht.assertNotInAngularZone(),et(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,g.next(!0))})})});const b=this._zone.onUnstable.subscribe(()=>{Ht.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{g.next(!1)}))});return()=>{v.unsubscribe(),b.unsubscribe()}});this.isStable=Ly(u,f.pipe(function h0(){return r=>ti()(function Wm(r,e){return function(a){let l;if(l="function"==typeof r?r:function(){return r},"function"==typeof e)return a.lift(new er(l,e));const u=Object.create(a,xy);return u.source=a,u.subjectFactory=l,u}}(AN)(r))}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,a){const l=t instanceof iR;if(!this._injector.get(ah).done)throw!l&&function Bc(r){const e=Nn(r)||$r(r)||wr(r);return null!==e&&e.standalone}(t),new pe(405,false);let f;f=l?t:this._injector.get(td).resolveComponentFactory(t),this.componentTypes.push(f.componentType);const g=function LC(r){return r.isBoundToModule}(f)?void 0:this._injector.get(gc),b=f.create(Nr.NULL,[],a||f.selector,g),D=b.location.nativeElement,L=b.injector.get(Co,null);return L?.registerApplication(D),b.onDestroy(()=>{this.detachView(b.hostView),hh(this.components,b),L?.unregisterApplication(D)}),this._loadComponent(b),b}tick(){if(this._runningTick)throw new pe(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const a=t;this._views.push(a),a.attachToAppRef(this)}detachView(t){const a=t;hh(this._views,a),a.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(Ii,[]).concat(this._bootstrapListeners).forEach(l=>l(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>hh(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new pe(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return r.\u0275fac=function(t){return new(t||r)(he(Ht),he(Wc),he(qc))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function hh(r,e){const t=r.indexOf(e);t>-1&&r.splice(t,1)}let JA=!0,nn=(()=>{class r{}return r.__NG_ELEMENT_ID__=di,r})();function di(r){return function j1(r,e,t){if(r_(r)&&!t){const a=Fo(r.index,e);return new Yp(a,a)}return 47&r.type?new Yp(e[16],e):null}(Pi(),fe(),16==(16&r))}class uE{constructor(){}supports(e){return Jp(e)}create(e){return new ol(e)}}const mh=(r,e)=>e;class ol{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||mh}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,a=this._removalsHead,l=0,u=null;for(;t||a;){const f=!a||t&&t.currentIndex<hE(a,l,u)?t:a,g=hE(f,l,u),v=f.currentIndex;if(f===a)l--,a=a._nextRemoved;else if(t=t._next,null==f.previousIndex)l++;else{u||(u=[]);const b=g-l,D=v-l;if(b!=D){for(let j=0;j<b;j++){const G=j<u.length?u[j]:u[j]=0,q=G+j;D<=q&&q<b&&(u[j]=G+1)}u[f.previousIndex]=D-b}}g!==v&&e(f,g,v)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Jp(e))throw new pe(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let l,u,f,t=this._itHead,a=!1;if(Array.isArray(e)){this.length=e.length;for(let g=0;g<this.length;g++)u=e[g],f=this._trackByFn(g,u),null!==t&&Object.is(t.trackById,f)?(a&&(t=this._verifyReinsertion(t,u,f,g)),Object.is(t.item,u)||this._addIdentityChange(t,u)):(t=this._mismatch(t,u,f,g),a=!0),t=t._next}else l=0,function sw(r,e){if(Array.isArray(r))for(let t=0;t<r.length;t++)e(r[t]);else{const t=r[ad()]();let a;for(;!(a=t.next()).done;)e(a.value)}}(e,g=>{f=this._trackByFn(l,g),null!==t&&Object.is(t.trackById,f)?(a&&(t=this._verifyReinsertion(t,g,f,l)),Object.is(t.item,g)||this._addIdentityChange(t,g)):(t=this._mismatch(t,g,f,l),a=!0),t=t._next,l++}),this.length=l;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,a,l){let u;return null===e?u=this._itTail:(u=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,u,l)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(a,l))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,u,l)):e=this._addAfter(new Rd(t,a),u,l),e}_verifyReinsertion(e,t,a,l){let u=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null);return null!==u?e=this._reinsertAfter(u,e._prev,l):e.currentIndex!=l&&(e.currentIndex=l,this._addToMoves(e,l)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,a){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const l=e._prevRemoved,u=e._nextRemoved;return null===l?this._removalsHead=u:l._nextRemoved=u,null===u?this._removalsTail=l:u._prevRemoved=l,this._insertAfter(e,t,a),this._addToMoves(e,a),e}_moveAfter(e,t,a){return this._unlink(e),this._insertAfter(e,t,a),this._addToMoves(e,a),e}_addAfter(e,t,a){return this._insertAfter(e,t,a),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,a){const l=null===t?this._itHead:t._next;return e._next=l,e._prev=t,null===l?this._itTail=e:l._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new Of),this._linkedRecords.put(e),e.currentIndex=a,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,a=e._next;return null===t?this._itHead=a:t._next=a,null===a?this._itTail=t:a._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Of),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class Rd{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Vr{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let a;for(a=this._head;null!==a;a=a._nextDup)if((null===t||t<=a.currentIndex)&&Object.is(a.trackById,e))return a;return null}remove(e){const t=e._prevDup,a=e._nextDup;return null===t?this._head=a:t._nextDup=a,null===a?this._tail=t:a._prevDup=t,null===this._head}}class Of{constructor(){this.map=new Map}put(e){const t=e.trackById;let a=this.map.get(t);a||(a=new Vr,this.map.set(t,a)),a.add(e)}get(e,t){const l=this.map.get(e);return l?l.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function hE(r,e,t){const a=r.previousIndex;if(null===a)return a;let l=0;return t&&a<t.length&&(l=t[a]),a+e+l}class pE{constructor(){}supports(e){return e instanceof Map||VS(e)}create(){return new nD}}class nD{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||VS(e)))throw new pe(900,!1)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(a,l)=>{if(t&&t.key===l)this._maybeAddToChanges(t,a),this._appendAfter=t,t=t._next;else{const u=this._getOrCreateRecordForKey(l,a);t=this._insertBeforeOrAppend(t,u)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let a=t;null!==a;a=a._nextRemoved)a===this._mapHead&&(this._mapHead=null),this._records.delete(a.key),a._nextRemoved=a._next,a.previousValue=a.currentValue,a.currentValue=null,a._prev=null,a._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const a=e._prev;return t._next=e,t._prev=a,e._prev=t,a&&(a._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const l=this._records.get(e);this._maybeAddToChanges(l,t);const u=l._prev,f=l._next;return u&&(u._next=f),f&&(f._prev=u),l._next=null,l._prev=null,l}const a=new W1(e);return this._records.set(e,a),a.currentValue=t,this._addToAdditions(a),a}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(a=>t(e[a],a))}}class W1{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function HC(){return new fi([new uE])}let fi=(()=>{class r{constructor(t){this.factories=t}static create(t,a){if(null!=a){const l=a.factories.slice();t=t.concat(l)}return new r(t)}static extend(t){return{provide:r,useFactory:a=>r.create(t,a||HC()),deps:[[r,new Sp,new vp]]}}find(t){const a=this.factories.find(l=>l.supports(t));if(null!=a)return a;throw new pe(901,!1)}}return r.\u0275prov=ke({token:r,providedIn:"root",factory:HC}),r})();function sl(){return new zo([new pE])}let zo=(()=>{class r{constructor(t){this.factories=t}static create(t,a){if(a){const l=a.factories.slice();t=t.concat(l)}return new r(t)}static extend(t){return{provide:r,useFactory:a=>r.create(t,a||sl()),deps:[[r,new Sp,new vp]]}}find(t){const a=this.factories.find(l=>l.supports(t));if(a)return a;throw new pe(901,!1)}}return r.\u0275prov=ke({token:r,providedIn:"root",factory:sl}),r})();const wi=YA(null,"core",[]);let iD=(()=>{class r{constructor(t){}}return r.\u0275fac=function(t){return new(t||r)(he(bd))},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({}),r})(),_h=null;function Xs(){return _h}const rn=new Ne("DocumentToken");let Mf=(()=>{class r{historyGo(t){throw new Error("Not implemented")}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=ke({token:r,factory:function(){return function aD(){return he(KC)}()},providedIn:"platform"}),r})();const zC=new Ne("Location Initialized");let KC=(()=>{class r extends Mf{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Xs().getBaseHref(this._doc)}onPopState(t){const a=Xs().getGlobalEventTarget(this._doc,"window");return a.addEventListener("popstate",t,!1),()=>a.removeEventListener("popstate",t)}onHashChange(t){const a=Xs().getGlobalEventTarget(this._doc,"window");return a.addEventListener("hashchange",t,!1),()=>a.removeEventListener("hashchange",t)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,a,l){qC()?this._history.pushState(t,a,l):this.location.hash=l}replaceState(t,a,l){qC()?this._history.replaceState(t,a,l):this.location.hash=l}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return r.\u0275fac=function(t){return new(t||r)(he(rn))},r.\u0275prov=ke({token:r,factory:function(){return function bo(){return new KC(he(rn))}()},providedIn:"platform"}),r})();function qC(){return!!window.history.pushState}function kf(r,e){if(0==r.length)return e;if(0==e.length)return r;let t=0;return r.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?r+e.substring(1):1==t?r+e:r+"/"+e}function cD(r){const e=r.match(/#|\?|$/),t=e&&e.index||r.length;return r.slice(0,t-("/"===r[t-1]?1:0))+r.slice(t)}function Js(r){return r&&"?"!==r[0]?"?"+r:r}let Da=(()=>{class r{historyGo(t){throw new Error("Not implemented")}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=ke({token:r,factory:function(){return _t(ao)},providedIn:"root"}),r})();const Ad=new Ne("appBaseHref");let ao=(()=>{class r extends Da{constructor(t,a){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=a??this._platformLocation.getBaseHrefFromDOM()??_t(rn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return kf(this._baseHref,t)}path(t=!1){const a=this._platformLocation.pathname+Js(this._platformLocation.search),l=this._platformLocation.hash;return l&&t?`${a}${l}`:a}pushState(t,a,l,u){const f=this.prepareExternalUrl(l+Js(u));this._platformLocation.pushState(t,a,f)}replaceState(t,a,l,u){const f=this.prepareExternalUrl(l+Js(u));this._platformLocation.replaceState(t,a,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return r.\u0275fac=function(t){return new(t||r)(he(Mf),he(Ad,8))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),YC=(()=>{class r extends Da{constructor(t,a){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=a&&(this._baseHref=a)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let a=this._platformLocation.hash;return null==a&&(a="#"),a.length>0?a.substring(1):a}prepareExternalUrl(t){const a=kf(this._baseHref,t);return a.length>0?"#"+a:a}pushState(t,a,l,u){let f=this.prepareExternalUrl(l+Js(u));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.pushState(t,a,f)}replaceState(t,a,l,u){let f=this.prepareExternalUrl(l+Js(u));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.replaceState(t,a,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return r.\u0275fac=function(t){return new(t||r)(he(Mf),he(Ad,8))},r.\u0275prov=ke({token:r,factory:r.\u0275fac}),r})(),_r=(()=>{class r{constructor(t){this._subject=new un,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const a=this._locationStrategy.getBaseHref();this._baseHref=cD($C(a)),this._locationStrategy.onPopState(l=>{this._subject.emit({url:this.path(!0),pop:!0,state:l.state,type:l.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,a=""){return this.path()==this.normalize(t+Js(a))}normalize(t){return r.stripTrailingSlash(function dD(r,e){return r&&e.startsWith(r)?e.substring(r.length):e}(this._baseHref,$C(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,a="",l=null){this._locationStrategy.pushState(l,"",t,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Js(a)),l)}replaceState(t,a="",l=null){this._locationStrategy.replaceState(l,"",t,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Js(a)),l)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(a=>{this._notifyUrlChangeListeners(a.url,a.state)})),()=>{const a=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(a,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",a){this._urlChangeListeners.forEach(l=>l(t,a))}subscribe(t,a,l){return this._subject.subscribe({next:t,error:a,complete:l})}}return r.normalizeQueryParams=Js,r.joinWithSlash=kf,r.stripTrailingSlash=cD,r.\u0275fac=function(t){return new(t||r)(he(Da))},r.\u0275prov=ke({token:r,factory:function(){return function lD(){return new _r(he(Da))}()},providedIn:"root"}),r})();function $C(r){return r.replace(/\/index.html$/,"")}let ub=(()=>{class r{constructor(t,a,l,u){this._iterableDiffers=t,this._keyValueDiffers=a,this._ngEl=l,this._renderer=u,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(t){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof t?t.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(t){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof t?t.split(/\s+/):t,this._rawClass&&(Jp(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const t=this._iterableDiffer.diff(this._rawClass);t&&this._applyIterableChanges(t)}else if(this._keyValueDiffer){const t=this._keyValueDiffer.diff(this._rawClass);t&&this._applyKeyValueChanges(t)}}_applyKeyValueChanges(t){t.forEachAddedItem(a=>this._toggleClass(a.key,a.currentValue)),t.forEachChangedItem(a=>this._toggleClass(a.key,a.currentValue)),t.forEachRemovedItem(a=>{a.previousValue&&this._toggleClass(a.key,!1)})}_applyIterableChanges(t){t.forEachAddedItem(a=>{if("string"!=typeof a.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${Dn(a.item)}`);this._toggleClass(a.item,!0)}),t.forEachRemovedItem(a=>this._toggleClass(a.item,!1))}_applyClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(a=>this._toggleClass(a,!0)):Object.keys(t).forEach(a=>this._toggleClass(a,!!t[a])))}_removeClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(a=>this._toggleClass(a,!1)):Object.keys(t).forEach(a=>this._toggleClass(a,!1)))}_toggleClass(t,a){(t=t.trim())&&t.split(/\s+/g).forEach(l=>{a?this._renderer.addClass(this._ngEl.nativeElement,l):this._renderer.removeClass(this._ngEl.nativeElement,l)})}}return r.\u0275fac=function(t){return new(t||r)(se(fi),se(zo),se(ci),se(Ls))},r.\u0275dir=Be({type:r,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),r})();class ar{constructor(e,t,a,l){this.$implicit=e,this.ngForOf=t,this.index=a,this.count=l}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let al=(()=>{class r{constructor(t,a,l){this._viewContainer=t,this._template=a,this._differs=l,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const a=this._viewContainer;t.forEachOperation((l,u,f)=>{if(null==l.previousIndex)a.createEmbeddedView(this._template,new ar(l.item,this._ngForOf,-1,-1),null===f?void 0:f);else if(null==f)a.remove(null===u?void 0:u);else if(null!==u){const g=a.get(u);a.move(g,f),Pd(g,l)}});for(let l=0,u=a.length;l<u;l++){const g=a.get(l).context;g.index=l,g.count=u,g.ngForOf=this._ngForOf}t.forEachIdentityChange(l=>{Pd(a.get(l.currentIndex),l)})}static ngTemplateContextGuard(t,a){return!0}}return r.\u0275fac=function(t){return new(t||r)(se(Go),se(Ta),se(fi))},r.\u0275dir=Be({type:r,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),r})();function Pd(r,e){r.context.$implicit=e.item}let cl=(()=>{class r{constructor(t,a){this._viewContainer=t,this._context=new oL,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=a}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){bc("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){bc("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,a){return!0}}return r.\u0275fac=function(t){return new(t||r)(se(Go),se(Ta))},r.\u0275dir=Be({type:r,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),r})();class oL{constructor(){this.$implicit=null,this.ngIf=null}}function bc(r,e){if(e&&!e.createEmbeddedView)throw new Error(`${r} must be a TemplateRef, but received '${Dn(e)}'.`)}class hb{constructor(e,t){this._viewContainerRef=e,this._templateRef=t,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(e){e&&!this._created?this.create():!e&&this._created&&this.destroy()}}let Zs=(()=>{class r{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(t){this._ngSwitch=t,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(t){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(t)}_matchCase(t){const a=t==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||a,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),a}_updateDefaultCases(t){if(this._defaultViews&&t!==this._defaultUsed){this._defaultUsed=t;for(let a=0;a<this._defaultViews.length;a++)this._defaultViews[a].enforceState(t)}}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275dir=Be({type:r,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0}),r})(),wD=(()=>{class r{constructor(t,a,l){this.ngSwitch=l,l._addCase(),this._view=new hb(t,a)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return r.\u0275fac=function(t){return new(t||r)(se(Go),se(Ta),se(Zs,9))},r.\u0275dir=Be({type:r,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0}),r})();class aL{createSubscription(e,t){return e.subscribe({next:t,error:a=>{throw a}})}dispose(e){e.unsubscribe()}}class cL{createSubscription(e,t){return e.then(t,a=>{throw a})}dispose(e){}}const SE=new cL,lL=new aL;let CE=(()=>{class r{constructor(t){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=t}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(t){return this._obj?t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue:(t&&this._subscribe(t),this._latestValue)}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,a=>this._updateLatestValue(t,a))}_selectStrategy(t){if(ld(t))return SE;if(_w(t))return lL;throw function Yo(r,e){return new pe(2100,!1)}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,a){t===this._obj&&(this._latestValue=a,this._ref.markForCheck())}}return r.\u0275fac=function(t){return new(t||r)(se(nn,16))},r.\u0275pipe=Yr({name:"async",type:r,pure:!1,standalone:!0}),r})(),sn=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({}),r})();const Ih="browser";let _L=(()=>{class r{}return r.\u0275prov=ke({token:r,providedIn:"root",factory:()=>new zf(he(rn),window)}),r})();class zf{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function MD(r,e){const t=r.getElementById(e)||r.getElementsByName(e)[0];if(t)return t;if("function"==typeof r.createTreeWalker&&r.body&&(r.body.createShadowRoot||r.body.attachShadow)){const a=r.createTreeWalker(r.body,NodeFilter.SHOW_ELEMENT);let l=a.currentNode;for(;l;){const u=l.shadowRoot;if(u){const f=u.getElementById(e)||u.querySelector(`[name="${e}"]`);if(f)return f}l=a.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),a=t.left+this.window.pageXOffset,l=t.top+this.window.pageYOffset,u=this.offset();this.window.scrollTo(a-u[0],l-u[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=gb(this.window.history)||gb(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function gb(r){return Object.getOwnPropertyDescriptor(r,"scrollRestoration")}class bb extends class oV extends class WC{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function $1(r){_h||(_h=r)}(new bb)}onAndCancel(e,t,a){return e.addEventListener(t,a,!1),()=>{e.removeEventListener(t,a,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function sV(){return ME=ME||document.querySelector("base"),ME?ME.getAttribute("href"):null}();return null==t?null:function GL(r){Tb=Tb||document.createElement("a"),Tb.setAttribute("href",r);const e=Tb.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){ME=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function nL(r,e){e=encodeURIComponent(e);for(const t of r.split(";")){const a=t.indexOf("="),[l,u]=-1==a?[t,""]:[t.slice(0,a),t.slice(a+1)];if(l.trim()===e)return decodeURIComponent(u)}return null}(document.cookie,e)}}let Tb,ME=null;const WL=new Ne("TRANSITION_ID"),Ib=[{provide:sh,useFactory:function aV(r,e,t){return()=>{t.get(ah).donePromise.then(()=>{const a=Xs(),l=e.querySelectorAll(`style[ng-transition="${r}"]`);for(let u=0;u<l.length;u++)a.remove(l[u])})}},deps:[WL,rn,Nr],multi:!0}];let KL=(()=>{class r{build(){return new XMLHttpRequest}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=ke({token:r,factory:r.\u0275fac}),r})();const kE=new Ne("EventManagerPlugins");let Xf=(()=>{class r{constructor(t,a){this._zone=a,this._eventNameToPlugin=new Map,t.forEach(l=>l.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,a,l){return this._findPluginFor(a).addEventListener(t,a,l)}addGlobalEventListener(t,a,l){return this._findPluginFor(a).addGlobalEventListener(t,a,l)}getZone(){return this._zone}_findPluginFor(t){const a=this._eventNameToPlugin.get(t);if(a)return a;const l=this._plugins;for(let u=0;u<l.length;u++){const f=l[u];if(f.supports(t))return this._eventNameToPlugin.set(t,f),f}throw new Error(`No event manager plugin found for event ${t}`)}}return r.\u0275fac=function(t){return new(t||r)(he(kE),he(Ht))},r.\u0275prov=ke({token:r,factory:r.\u0275fac}),r})();class GD{constructor(e){this._doc=e}addGlobalEventListener(e,t,a){const l=Xs().getGlobalEventTarget(this._doc,e);if(!l)throw new Error(`Unsupported event target ${l} for event ${t}`);return this.addEventListener(l,t,a)}}let Rb=(()=>{class r{constructor(){this._stylesSet=new Set}addStyles(t){const a=new Set;t.forEach(l=>{this._stylesSet.has(l)||(this._stylesSet.add(l),a.add(l))}),this.onStylesAdded(a)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=ke({token:r,factory:r.\u0275fac}),r})(),Jf=(()=>{class r extends Rb{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,a,l){t.forEach(u=>{const f=this._doc.createElement("style");f.textContent=u,l.push(a.appendChild(f))})}addHost(t){const a=[];this._addStylesToHost(this._stylesSet,t,a),this._hostNodes.set(t,a)}removeHost(t){const a=this._hostNodes.get(t);a&&a.forEach(wb),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((a,l)=>{this._addStylesToHost(t,l,a)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(wb))}}return r.\u0275fac=function(t){return new(t||r)(he(rn))},r.\u0275prov=ke({token:r,factory:r.\u0275fac}),r})();function wb(r){Xs().remove(r)}const gi={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},LE=/%COMP%/g;function Er(r,e,t){for(let a=0;a<e.length;a++){let l=e[a];Array.isArray(l)?Er(r,l,t):(l=l.replace(LE,r),t.push(l))}return t}function Zf(r){return e=>{if("__ngUnwrap__"===e)return r;!1===r(e)&&(e.preventDefault(),e.returnValue=!1)}}let em=(()=>{class r{constructor(t,a,l){this.eventManager=t,this.sharedStylesHost=a,this.appId=l,this.rendererByCompId=new Map,this.defaultRenderer=new tm(t)}createRenderer(t,a){if(!t||!a)return this.defaultRenderer;switch(a.encapsulation){case Rr.Emulated:{let l=this.rendererByCompId.get(a.id);return l||(l=new pl(this.eventManager,this.sharedStylesHost,a,this.appId),this.rendererByCompId.set(a.id,l)),l.applyToHost(t),l}case 1:case Rr.ShadowDom:return new KD(this.eventManager,this.sharedStylesHost,t,a);default:if(!this.rendererByCompId.has(a.id)){const l=Er(a.id,a.styles,[]);this.sharedStylesHost.addStyles(l),this.rendererByCompId.set(a.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return r.\u0275fac=function(t){return new(t||r)(he(Xf),he(Jf),he(ch))},r.\u0275prov=ke({token:r,factory:r.\u0275fac}),r})();class tm{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?document.createElementNS(gi[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){(UE(e)?e.content:e).appendChild(t)}insertBefore(e,t,a){e&&(UE(e)?e.content:e).insertBefore(t,a)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let a="string"==typeof e?document.querySelector(e):e;if(!a)throw new Error(`The selector "${e}" did not match any elements`);return t||(a.textContent=""),a}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,a,l){if(l){t=l+":"+t;const u=gi[l];u?e.setAttributeNS(u,t,a):e.setAttribute(t,a)}else e.setAttribute(t,a)}removeAttribute(e,t,a){if(a){const l=gi[a];l?e.removeAttributeNS(l,t):e.removeAttribute(`${a}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,a,l){l&(go.DashCase|go.Important)?e.style.setProperty(t,a,l&go.Important?"important":""):e.style[t]=a}removeStyle(e,t,a){a&go.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,a){e[t]=a}setValue(e,t){e.nodeValue=t}listen(e,t,a){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,Zf(a)):this.eventManager.addEventListener(e,t,Zf(a))}}function UE(r){return"TEMPLATE"===r.tagName&&void 0!==r.content}class pl extends tm{constructor(e,t,a,l){super(e),this.component=a;const u=Er(l+"-"+a.id,a.styles,[]);t.addStyles(u),this.contentAttr=function Qf(r){return"_ngcontent-%COMP%".replace(LE,r)}(l+"-"+a.id),this.hostAttr=function zD(r){return"_nghost-%COMP%".replace(LE,r)}(l+"-"+a.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const a=super.createElement(e,t);return super.setAttribute(a,this.contentAttr,""),a}}class KD extends tm{constructor(e,t,a,l){super(e),this.sharedStylesHost=t,this.hostEl=a,this.shadowRoot=a.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const u=Er(l.id,l.styles,[]);for(let f=0;f<u.length;f++){const g=document.createElement("style");g.textContent=u[f],this.shadowRoot.appendChild(g)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,a){return super.insertBefore(this.nodeOrShadowRoot(e),t,a)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let $L=(()=>{class r extends GD{constructor(t){super(t)}supports(t){return!0}addEventListener(t,a,l){return t.addEventListener(a,l,!1),()=>this.removeEventListener(t,a,l)}removeEventListener(t,a,l){return t.removeEventListener(a,l)}}return r.\u0275fac=function(t){return new(t||r)(he(rn))},r.\u0275prov=ke({token:r,factory:r.\u0275fac}),r})();const Io=["alt","control","meta","shift"],XL={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},qD={alt:r=>r.altKey,control:r=>r.ctrlKey,meta:r=>r.metaKey,shift:r=>r.shiftKey};let Rc=(()=>{class r extends GD{constructor(t){super(t)}supports(t){return null!=r.parseEventName(t)}addEventListener(t,a,l){const u=r.parseEventName(a),f=r.eventCallback(u.fullKey,l,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Xs().onAndCancel(t,u.domEventName,f))}static parseEventName(t){const a=t.toLowerCase().split("."),l=a.shift();if(0===a.length||"keydown"!==l&&"keyup"!==l)return null;const u=r._normalizeKey(a.pop());let f="",g=a.indexOf("code");if(g>-1&&(a.splice(g,1),f="code."),Io.forEach(b=>{const D=a.indexOf(b);D>-1&&(a.splice(D,1),f+=b+".")}),f+=u,0!=a.length||0===u.length)return null;const v={};return v.domEventName=l,v.fullKey=f,v}static matchEventFullKeyCode(t,a){let l=XL[t.key]||t.key,u="";return a.indexOf("code.")>-1&&(l=t.code,u="code."),!(null==l||!l)&&(l=l.toLowerCase()," "===l?l="space":"."===l&&(l="dot"),Io.forEach(f=>{f!==l&&(0,qD[f])(t)&&(u+=f+".")}),u+=l,u===a)}static eventCallback(t,a,l){return u=>{r.matchEventFullKeyCode(u,t)&&l.runGuarded(()=>a(u))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return r.\u0275fac=function(t){return new(t||r)(he(rn))},r.\u0275prov=ke({token:r,factory:r.\u0275fac}),r})();const Fa=[{provide:sE,useValue:Ih},{provide:wn,useValue:function ZL(){bb.makeCurrent()},multi:!0},{provide:rn,useFactory:function Ab(){return function LI(r){z_=r}(document),document},deps:[]}],BE=YA(wi,"browser",Fa),Db=new Ne(""),$D=[{provide:Ys,useClass:class zL{addToWindow(e){Hn.getAngularTestability=(a,l=!0)=>{const u=e.findTestabilityInTree(a,l);if(null==u)throw new Error("Could not find testability for element.");return u},Hn.getAllAngularTestabilities=()=>e.getAllTestabilities(),Hn.getAllAngularRootElements=()=>e.getAllRootElements(),Hn.frameworkStabilizers||(Hn.frameworkStabilizers=[]),Hn.frameworkStabilizers.push(a=>{const l=Hn.getAllAngularTestabilities();let u=l.length,f=!1;const g=function(v){f=f||v,u--,0==u&&a(f)};l.forEach(function(v){v.whenStable(g)})})}findTestabilityInTree(e,t,a){return null==t?null:e.getTestability(t)??(a?Xs().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},deps:[]},{provide:Co,useClass:Mt,deps:[Ht,Es,Ys]},{provide:Mt,useClass:Mt,deps:[Ht,Es,Ys]}],nm=[{provide:J_,useValue:"root"},{provide:qc,useFactory:function VE(){return new qc},deps:[]},{provide:kE,useClass:$L,multi:!0,deps:[rn,Ht,sE]},{provide:kE,useClass:Rc,multi:!0,deps:[rn]},{provide:em,useClass:em,deps:[Xf,Jf,ch]},{provide:Fu,useExisting:em},{provide:Rb,useExisting:Jf},{provide:Jf,useClass:Jf,deps:[rn]},{provide:Xf,useClass:Xf,deps:[kE,Ht]},{provide:class EL{},useClass:KL,deps:[]},[]];let im=(()=>{class r{constructor(t){}static withServerTransition(t){return{ngModule:r,providers:[{provide:ch,useValue:t.appId},{provide:WL,useExisting:ch},Ib]}}}return r.\u0275fac=function(t){return new(t||r)(he(Db,12))},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({providers:[...nm,...$D],imports:[sn,iD]}),r})(),Nb=(()=>{class r{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}}return r.\u0275fac=function(t){return new(t||r)(he(rn))},r.\u0275prov=ke({token:r,factory:function(t){let a=null;return a=t?new t:function Ob(){return new Nb(he(rn))}(),a},providedIn:"root"}),r})();function am(r,e){return new An(t=>{const a=r.length;if(0===a)return void t.complete();const l=new Array(a);let u=0,f=0;for(let g=0;g<a;g++){const v=Oi(r[g]);let b=!1;t.add(v.subscribe({next:D=>{b||(b=!0,f++),l[g]=D},error:D=>t.error(D),complete:()=>{u++,(u===a||!b)&&(f===a&&t.next(e?e.reduce((D,L,j)=>(D[L]=l[j],D),{}):l),t.complete())}}))}})}typeof window<"u"&&window;let lO=(()=>{class r{constructor(t,a){this._renderer=t,this._elementRef=a,this.onChange=l=>{},this.onTouched=()=>{}}setProperty(t,a){this._renderer.setProperty(this._elementRef.nativeElement,t,a)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}}return r.\u0275fac=function(t){return new(t||r)(se(Ls),se(ci))},r.\u0275dir=Be({type:r}),r})(),fl=(()=>{class r extends lO{}return r.\u0275fac=function(){let e;return function(a){return(e||(e=Mi(r)))(a||r)}}(),r.\u0275dir=Be({type:r,features:[Ft]}),r})();const lo=new Ne("NgValueAccessor"),yr={provide:lo,useExisting:Un(()=>cm),multi:!0},jE=new Ne("CompositionEventMode");let cm=(()=>{class r extends lO{constructor(t,a,l){super(t,a),this._compositionMode=l,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function cx(){const r=Xs()?Xs().getUserAgent():"";return/android (\d+)/.test(r.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}return r.\u0275fac=function(t){return new(t||r)(se(Ls),se(ci),se(jE,8))},r.\u0275dir=Be({type:r,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(t,a){1&t&&Xt("input",function(u){return a._handleInput(u.target.value)})("blur",function(){return a.onTouched()})("compositionstart",function(){return a._compositionStart()})("compositionend",function(u){return a._compositionEnd(u.target.value)})},features:[Mn([yr]),Ft]}),r})();function ml(r){return null==r||("string"==typeof r||Array.isArray(r))&&0===r.length}function vi(r){return null!=r&&"number"==typeof r.length}const vr=new Ne("NgValidators"),_l=new Ne("NgAsyncValidators"),dx=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class dO{static min(e){return function HE(r){return e=>{if(ml(e.value)||ml(r))return null;const t=parseFloat(e.value);return!isNaN(t)&&t<r?{min:{min:r,actual:e.value}}:null}}(e)}static max(e){return function Vb(r){return e=>{if(ml(e.value)||ml(r))return null;const t=parseFloat(e.value);return!isNaN(t)&&t>r?{max:{max:r,actual:e.value}}:null}}(e)}static required(e){return function uO(r){return ml(r.value)?{required:!0}:null}(e)}static requiredTrue(e){return function GE(r){return!0===r.value?null:{required:!0}}(e)}static email(e){return function Dh(r){return ml(r.value)||dx.test(r.value)?null:{email:!0}}(e)}static minLength(e){return function Ro(r){return e=>ml(e.value)||!vi(e.value)?null:e.value.length<r?{minlength:{requiredLength:r,actualLength:e.value.length}}:null}(e)}static maxLength(e){return function lt(r){return e=>vi(e.value)&&e.value.length>r?{maxlength:{requiredLength:r,actualLength:e.value.length}}:null}(e)}static pattern(e){return function lm(r){if(!r)return dm;let e,t;return"string"==typeof r?(t="","^"!==r.charAt(0)&&(t+="^"),t+=r,"$"!==r.charAt(r.length-1)&&(t+="$"),e=new RegExp(t)):(t=r.toString(),e=r),a=>{if(ml(a.value))return null;const l=a.value;return e.test(l)?null:{pattern:{requiredPattern:t,actualValue:l}}}}(e)}static nullValidator(e){return null}static compose(e){return Wb(e)}static composeAsync(e){return wo(e)}}function dm(r){return null}function Bb(r){return null!=r}function En(r){return ld(r)?Oi(r):r}function jb(r){let e={};return r.forEach(t=>{e=null!=t?{...e,...t}:e}),0===Object.keys(e).length?null:e}function Hb(r,e){return e.map(t=>t(r))}function gl(r){return r.map(e=>function Gb(r){return!r.validate}(e)?e:t=>e.validate(t))}function Wb(r){if(!r)return null;const e=r.filter(Bb);return 0==e.length?null:function(t){return jb(Hb(t,e))}}function WE(r){return null!=r?Wb(gl(r)):null}function wo(r){if(!r)return null;const e=r.filter(Bb);return 0==e.length?null:function(t){return function cO(...r){if(1===r.length){const e=r[0];if(ur(e))return am(e,null);if(Ka(e)&&Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);return am(t.map(a=>e[a]),t)}}if("function"==typeof r[r.length-1]){const e=r.pop();return am(r=1===r.length&&ur(r[0])?r[0]:r,null).pipe(xt(t=>e(...t)))}return am(r,null)}(Hb(t,e).map(En)).pipe(xt(jb))}}function Ac(r){return null!=r?wo(gl(r)):null}function zE(r,e){return null===r?[e]:Array.isArray(r)?[...r,e]:[r,e]}function KE(r){return r._rawValidators}function zb(r){return r._rawAsyncValidators}function Oh(r){return r?Array.isArray(r)?r:[r]:[]}function Nh(r,e){return Array.isArray(r)?r.includes(e):r===e}function Kb(r,e){const t=Oh(e);return Oh(r).forEach(l=>{Nh(t,l)||t.push(l)}),t}function qE(r,e){return Oh(e).filter(t=>!Nh(r,t))}class um{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=WE(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Ac(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}class Sr extends um{get formDirective(){return null}get path(){return null}}class Br extends um{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class hm{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let Jo=(()=>{class r extends hm{constructor(t){super(t)}}return r.\u0275fac=function(t){return new(t||r)(se(Br,2))},r.\u0275dir=Be({type:r,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(t,a){2&t&&In("ng-untouched",a.isUntouched)("ng-touched",a.isTouched)("ng-pristine",a.isPristine)("ng-dirty",a.isDirty)("ng-valid",a.isValid)("ng-invalid",a.isInvalid)("ng-pending",a.isPending)},features:[Ft]}),r})(),qb=(()=>{class r extends hm{constructor(t){super(t)}}return r.\u0275fac=function(t){return new(t||r)(se(Sr,10))},r.\u0275dir=Be({type:r,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(t,a){2&t&&In("ng-untouched",a.isUntouched)("ng-touched",a.isTouched)("ng-pristine",a.isPristine)("ng-dirty",a.isDirty)("ng-valid",a.isValid)("ng-invalid",a.isInvalid)("ng-pending",a.isPending)("ng-submitted",a.isSubmitted)},features:[Ft]}),r})();const Mh="VALID",mm="INVALID",kn="PENDING",Cr="DISABLED";function $E(r){return(_m(r)?r.validators:r)||null}function Dc(r){return Array.isArray(r)?WE(r):r||null}function Bd(r,e){return(_m(e)?e.asyncValidators:r)||null}function $b(r){return Array.isArray(r)?Ac(r):r||null}function _m(r){return null!=r&&!Array.isArray(r)&&"object"==typeof r}function jd(r,e,t){const a=r.controls;if(!(e?Object.keys(a):a).length)throw new pe(1e3,"");if(!a[t])throw new pe(1001,"")}function si(r,e,t){r._forEachChild((a,l)=>{if(void 0===t[l])throw new pe(1002,"")})}class br{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=t,this._composedValidatorFn=Dc(this._rawValidators),this._composedAsyncValidatorFn=$b(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Mh}get invalid(){return this.status===mm}get pending(){return this.status==kn}get disabled(){return this.status===Cr}get enabled(){return this.status!==Cr}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=Dc(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=$b(e)}addValidators(e){this.setValidators(Kb(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(Kb(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(qE(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(qE(e,this._rawAsyncValidators))}hasValidator(e){return Nh(this._rawValidators,e)}hasAsyncValidator(e){return Nh(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=kn,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Cr,this.errors=null,this._forEachChild(a=>{a.disable({...e,onlySelf:!0})}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...e,skipPristineCheck:t}),this._onDisabledChange.forEach(a=>a(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Mh,this._forEachChild(a=>{a.enable({...e,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors({...e,skipPristineCheck:t}),this._onDisabledChange.forEach(a=>a(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Mh||this.status===kn)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Cr:Mh}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=kn,this._hasOwnPendingAsyncValidator=!0;const t=En(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(a=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(a,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){let t=e;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((a,l)=>a&&a._find(l),this)}getError(e,t){const a=t?this.get(t):this;return a&&a.errors?a.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new un,this.statusChanges=new un}_calculateStatus(){return this._allControlsDisabled()?Cr:this.errors?mm:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(kn)?kn:this._anyControlsHaveStatus(mm)?mm:Mh}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){_m(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(e){return null}}class Hd extends br{constructor(e,t,a){super($E(t),Bd(a,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,a={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,a={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){si(this,0,e),Object.keys(e).forEach(a=>{jd(this,!0,a),this.controls[a].setValue(e[a],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(a=>{const l=this.controls[a];l&&l.patchValue(e[a],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((a,l)=>{a.reset(e[l],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,a)=>(e[a]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,a)=>!!a._syncPendingControls()||t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const a=this.controls[t];a&&e(a,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const[t,a]of Object.entries(this.controls))if(this.contains(t)&&e(a))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,a,l)=>((a.enabled||this.disabled)&&(t[l]=a.value),t))}_reduceChildren(e,t){let a=e;return this._forEachChild((l,u)=>{a=t(a,l,u)}),a}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}}class Xb extends Hd{}function Gd(r,e){Si(r,e),e.valueAccessor.writeValue(r.value),r.disabled&&e.valueAccessor.setDisabledState?.(!0),function mO(r,e){e.valueAccessor.registerOnChange(t=>{r._pendingValue=t,r._pendingChange=!0,r._pendingDirty=!0,"change"===r.updateOn&&Zn(r,e)})}(r,e),function Zo(r,e){const t=(a,l)=>{e.valueAccessor.writeValue(a),l&&e.viewToModelUpdate(a)};r.registerOnChange(t),e._registerOnDestroy(()=>{r._unregisterOnChange(t)})}(r,e),function QE(r,e){e.valueAccessor.registerOnTouched(()=>{r._pendingTouched=!0,"blur"===r.updateOn&&r._pendingChange&&Zn(r,e),"submit"!==r.updateOn&&r.markAsTouched()})}(r,e),function JE(r,e){if(e.valueAccessor.setDisabledState){const t=a=>{e.valueAccessor.setDisabledState(a)};r.registerOnDisabledChange(t),e._registerOnDestroy(()=>{r._unregisterOnDisabledChange(t)})}}(r,e)}function XE(r,e,t=!0){const a=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(a),e.valueAccessor.registerOnTouched(a)),cr(r,e),r&&(e._invokeOnDestroyCallbacks(),r._registerOnCollectionChange(()=>{}))}function gm(r,e){r.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function Si(r,e){const t=KE(r);null!==e.validator?r.setValidators(zE(t,e.validator)):"function"==typeof t&&r.setValidators([t]);const a=zb(r);null!==e.asyncValidator?r.setAsyncValidators(zE(a,e.asyncValidator)):"function"==typeof a&&r.setAsyncValidators([a]);const l=()=>r.updateValueAndValidity();gm(e._rawValidators,l),gm(e._rawAsyncValidators,l)}function cr(r,e){let t=!1;if(null!==r){if(null!==e.validator){const l=KE(r);if(Array.isArray(l)&&l.length>0){const u=l.filter(f=>f!==e.validator);u.length!==l.length&&(t=!0,r.setValidators(u))}}if(null!==e.asyncValidator){const l=zb(r);if(Array.isArray(l)&&l.length>0){const u=l.filter(f=>f!==e.asyncValidator);u.length!==l.length&&(t=!0,r.setAsyncValidators(u))}}}const a=()=>{};return gm(e._rawValidators,a),gm(e._rawAsyncValidators,a),t}function Zn(r,e){r._pendingDirty&&r.markAsDirty(),r.setValue(r._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(r._pendingValue),r._pendingChange=!1}function Qb(r,e){Si(r,e)}function ji(r,e){r._syncPendingControls(),e.forEach(t=>{const a=t.control;"submit"===a.updateOn&&a._pendingChange&&(t.viewToModelUpdate(a._pendingValue),a._pendingChange=!1)})}const Ix={provide:Sr,useExisting:Un(()=>ym)},Em=(()=>Promise.resolve())();let ym=(()=>{class r extends Sr{constructor(t,a){super(),this.submitted=!1,this._directives=new Set,this.ngSubmit=new un,this.form=new Hd({},WE(t),Ac(a))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){Em.then(()=>{const a=this._findContainer(t.path);t.control=a.registerControl(t.name,t.control),Gd(t.control,t),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){Em.then(()=>{const a=this._findContainer(t.path);a&&a.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){Em.then(()=>{const a=this._findContainer(t.path),l=new Hd({});Qb(l,t),a.registerControl(t.name,l),l.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){Em.then(()=>{const a=this._findContainer(t.path);a&&a.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,a){Em.then(()=>{this.form.get(t.path).setValue(a)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submitted=!0,ji(this.form,this._directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t){this.form.reset(t),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}}return r.\u0275fac=function(t){return new(t||r)(se(vr,10),se(_l,10))},r.\u0275dir=Be({type:r,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(t,a){1&t&&Xt("submit",function(u){return a.onSubmit(u)})("reset",function(){return a.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Mn([Ix]),Ft]}),r})();function EO(r,e){const t=r.indexOf(e);t>-1&&r.splice(t,1)}function ZE(r){return"object"==typeof r&&null!==r&&2===Object.keys(r).length&&"value"in r&&"disabled"in r}const Hi=class extends br{constructor(e=null,t,a){super($E(t),Bd(a,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),_m(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=ZE(e)?e.value:e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(a=>a(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){EO(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){EO(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){ZE(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};let rT=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275dir=Be({type:r,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),r})(),Nc=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({}),r})();const sT=new Ne("NgModelWithFormControlWarning"),Ax={provide:Sr,useExisting:Un(()=>zd)};let zd=(()=>{class r extends Sr{constructor(t,a){super(),this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new un,this._setValidators(t),this._setAsyncValidators(a)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(cr(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const a=this.form.get(t.path);return Gd(a,t),a.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),a}getControl(t){return this.form.get(t.path)}removeControl(t){XE(t.control||null,t,!1),function Tx(r,e){const t=r.indexOf(e);t>-1&&r.splice(t,1)}(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,a){this.form.get(t.path).setValue(a)}onSubmit(t){return this.submitted=!0,ji(this.form,this.directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{const a=t.control,l=this.form.get(t.path);a!==l&&(XE(a||null,t),(r=>r instanceof Hi)(l)&&(Gd(l,t),t.control=l))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const a=this.form.get(t.path);Qb(a,t),a.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const a=this.form.get(t.path);a&&function _O(r,e){return cr(r,e)}(a,t)&&a.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Si(this.form,this),this._oldForm&&cr(this._oldForm,this)}_checkFormPresent(){}}return r.\u0275fac=function(t){return new(t||r)(se(vr,10),se(_l,10))},r.\u0275dir=Be({type:r,selectors:[["","formGroup",""]],hostBindings:function(t,a){1&t&&Xt("submit",function(u){return a.onSubmit(u)})("reset",function(){return a.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Mn([Ax]),Ft,Lo]}),r})();const Kd={provide:Br,useExisting:Un(()=>Ao)};let Ao=(()=>{class r extends Br{constructor(t,a,l,u,f){super(),this._ngModelWarningConfig=f,this._added=!1,this.update=new un,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(a),this._setAsyncValidators(l),this.valueAccessor=function Zb(r,e){if(!e)return null;let t,a,l;return Array.isArray(e),e.forEach(u=>{u.constructor===cm?t=u:function Ci(r){return Object.getPrototypeOf(r.constructor)===fl}(u)?a=u:l=u}),l||a||t||null}(0,u)}set isDisabled(t){}ngOnChanges(t){this._added||this._setUpControl(),function Lh(r,e){if(!r.hasOwnProperty("model"))return!1;const t=r.model;return!!t.isFirstChange()||!Object.is(e,t.currentValue)}(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return function kh(r,e){return[...e.path,r]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}}return r._ngModelWarningSentOnce=!1,r.\u0275fac=function(t){return new(t||r)(se(Sr,13),se(vr,10),se(_l,10),se(lo,10),se(sT,8))},r.\u0275dir=Be({type:r,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[Mn([Kd]),Ft,Lo]}),r})(),_T=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({imports:[Nc]}),r})(),sy=(()=>{class r{static withConfig(t){return{ngModule:r,providers:[{provide:sT,useValue:t.warnOnNgModelWithFormControl}]}}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({imports:[_T]}),r})();class ay extends br{constructor(e,t,a){super($E(t),Bd(a,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,a={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:a.emitEvent})}removeAt(e,t={}){let a=this._adjustIndex(e);a<0&&(a=0),this.controls[a]&&this.controls[a]._registerOnCollectionChange(()=>{}),this.controls.splice(a,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,a={}){let l=this._adjustIndex(e);l<0&&(l=0),this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),this.controls.splice(l,1),t&&(this.controls.splice(l,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){si(this,0,e),e.forEach((a,l)=>{jd(this,!1,l),this.at(l).setValue(a,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(e.forEach((a,l)=>{this.at(l)&&this.at(l).patchValue(a,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((a,l)=>{a.reset(e[l],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,a)=>!!a._syncPendingControls()||t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,a)=>{e(t,a)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}}function ET(r){return!!r&&(void 0!==r.asyncValidators||void 0!==r.validators||void 0!==r.updateOn)}let yT,Cm=(()=>{class r{constructor(){this.useNonNullable=!1}get nonNullable(){const t=new r;return t.useNonNullable=!0,t}group(t,a=null){const l=this._reduceControls(t);let u={};return ET(a)?u=a:null!==a&&(u.validators=a.validator,u.asyncValidators=a.asyncValidator),new Hd(l,u)}record(t,a=null){const l=this._reduceControls(t);return new Xb(l,a)}control(t,a,l){let u={};return this.useNonNullable?(ET(a)?u=a:(u.validators=a,u.asyncValidators=l),new Hi(t,{...u,nonNullable:!0})):new Hi(t,a,l)}array(t,a,l){const u=t.map(f=>this._createControl(f));return new ay(u,a,l)}_reduceControls(t){const a={};return Object.keys(t).forEach(l=>{a[l]=this._createControl(t[l])}),a}_createControl(t){return t instanceof Hi||t instanceof br?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:sy}),r})(),kx=(()=>{class r extends Cm{group(t,a=null){return super.group(t,a)}control(t,a,l){return super.control(t,a,l)}array(t,a,l){return super.array(t,a,l)}}return r.\u0275fac=function(){let e;return function(a){return(e||(e=Mi(r)))(a||r)}}(),r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:sy}),r})();try{yT=typeof Intl<"u"&&Intl.v8BreakIterator}catch{yT=!1}let Yd,jr=(()=>{class r{constructor(t){this._platformId=t,this.isBrowser=this._platformId?function ND(r){return r===Ih}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!yT)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return r.\u0275fac=function(t){return new(t||r)(he(sE))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const vT=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function ly(){if(Yd)return Yd;if("object"!=typeof document||!document)return Yd=new Set(vT),Yd;let r=document.createElement("input");return Yd=new Set(vT.filter(e=>(r.setAttribute("type",e),r.type===e))),Yd}let Bh,i,d;function o(r){return function ai(){if(null==Bh&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Bh=!0}))}finally{Bh=Bh||!1}return Bh}()?r:!!r.capture}function s(){if(null==i){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return i=!1,i;if("scrollBehavior"in document.documentElement.style)i=!0;else{const r=Element.prototype.scrollTo;i=!!r&&!/\{\s*\[native code\]\s*\}/.test(r.toString())}}return i}function _(r){return r.composedPath?r.composedPath()[0]:r.target}function E(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}class y extends fn{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return t&&!t.closed&&e.next(this._value),t}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new wl;return this._value}next(e){super.next(this._value=e)}}function S(...r){let e=r[r.length-1];return Al(e)?(r.pop(),Bm(r,e)):au(r)}function yV(r){return e=>e.lift(new Oj(r))}class Oj{constructor(e){this.total=e}call(e,t){return t.subscribe(new Nj(e,this.total))}}class Nj extends bn{constructor(e,t){super(e),this.total=t,this.count=0}_next(e){++this.count>this.total&&this.destination.next(e)}}class Mj{constructor(e,t){this.compare=e,this.keySelector=t}call(e,t){return t.subscribe(new kj(e,this.compare,this.keySelector))}}class kj extends bn{constructor(e,t,a){super(e),this.keySelector=a,this.hasKey=!1,"function"==typeof t&&(this.compare=t)}compare(e,t){return e===t}_next(e){let t;try{const{keySelector:l}=this;t=l?l(e):e}catch(l){return this.destination.error(l)}let a=!1;if(this.hasKey)try{const{compare:l}=this;a=l(this.key,t)}catch(l){return this.destination.error(l)}else this.hasKey=!0;a||(this.key=t,this.destination.next(e))}}function bs(r){return e=>e.lift(new Lj(r))}class Lj{constructor(e){this.notifier=e}call(e,t){const a=new xj(e),l=Dl(this.notifier,new su(a));return l&&!a.seenValue?(a.add(l),t.subscribe(a)):a}}class xj extends Qh{constructor(e){super(e),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}function Sl(r){return null!=r&&"false"!=`${r}`}function NO(r,e=0){return function Fj(r){return!isNaN(parseFloat(r))&&!isNaN(Number(r))}(r)?Number(r):e}function PO(r){return Array.isArray(r)?r:[r]}function dr(r){return null==r?"":"string"==typeof r?r:`${r}px`}function Jd(r){return r instanceof ci?r.nativeElement:r}class Uj extends Cn{constructor(e,t){super()}schedule(e,t=0){return this}}class xx extends Uj{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const a=this.id,l=this.scheduler;return null!=a&&(this.id=this.recycleAsyncId(l,a,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(l,this.id,t),this}requestAsyncId(e,t,a=0){return setInterval(e.flush.bind(e,this),a)}recycleAsyncId(e,t,a=0){if(null!==a&&this.delay===a&&!1===this.pending)return t;clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const a=this._execute(e,t);if(a)return a;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let l,a=!1;try{this.work(e)}catch(u){a=!0,l=!!u&&u||new Error(u)}if(a)return this.unsubscribe(),l}_unsubscribe(){const e=this.id,t=this.scheduler,a=t.actions,l=a.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==l&&a.splice(l,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null}}let vV=(()=>{class r{constructor(t,a=r.now){this.SchedulerAction=t,this.now=a}schedule(t,a=0,l){return new this.SchedulerAction(this,t).schedule(l,a)}}return r.now=()=>Date.now(),r})();class Cl extends vV{constructor(e,t=vV.now){super(e,()=>Cl.delegate&&Cl.delegate!==this?Cl.delegate.now():t()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(e,t=0,a){return Cl.delegate&&Cl.delegate!==this?Cl.delegate.schedule(e,t,a):super.schedule(e,t,a)}flush(e){const{actions:t}=this;if(this.active)return void t.push(e);let a;this.active=!0;do{if(a=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,a){for(;e=t.shift();)e.unsubscribe();throw a}}}const dy=new Cl(xx);function SV(r,e=dy){return t=>t.lift(new Vj(r,e))}class Vj{constructor(e,t){this.dueTime=e,this.scheduler=t}call(e,t){return t.subscribe(new Bj(e,this.dueTime,this.scheduler))}}class Bj extends bn{constructor(e,t,a){super(e),this.dueTime=t,this.scheduler=a,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(jj,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:e}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}}clearDebounce(){const e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)}}function jj(r){r.debouncedNext()}let CV=(()=>{class r{create(t){return typeof MutationObserver>"u"?null:new MutationObserver(t)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),Hj=(()=>{class r{constructor(t){this._mutationObserverFactory=t,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((t,a)=>this._cleanupObserver(a))}observe(t){const a=Jd(t);return new An(l=>{const f=this._observeElement(a).subscribe(l);return()=>{f.unsubscribe(),this._unobserveElement(a)}})}_observeElement(t){if(this._observedElements.has(t))this._observedElements.get(t).count++;else{const a=new fn,l=this._mutationObserverFactory.create(u=>a.next(u));l&&l.observe(t,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(t,{observer:l,stream:a,count:1})}return this._observedElements.get(t).stream}_unobserveElement(t){this._observedElements.has(t)&&(this._observedElements.get(t).count--,this._observedElements.get(t).count||this._cleanupObserver(t))}_cleanupObserver(t){if(this._observedElements.has(t)){const{observer:a,stream:l}=this._observedElements.get(t);a&&a.disconnect(),l.complete(),this._observedElements.delete(t)}}}return r.\u0275fac=function(t){return new(t||r)(he(CV))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),bV=(()=>{class r{constructor(t,a,l){this._contentObserver=t,this._elementRef=a,this._ngZone=l,this.event=new un,this._disabled=!1,this._currentSubscription=null}get disabled(){return this._disabled}set disabled(t){this._disabled=Sl(t),this._disabled?this._unsubscribe():this._subscribe()}get debounce(){return this._debounce}set debounce(t){this._debounce=NO(t),this._subscribe()}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();const t=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular(()=>{this._currentSubscription=(this.debounce?t.pipe(SV(this.debounce)):t).subscribe(this.event)})}_unsubscribe(){this._currentSubscription?.unsubscribe()}}return r.\u0275fac=function(t){return new(t||r)(se(Hj),se(ci),se(Ht))},r.\u0275dir=Be({type:r,selectors:[["","cdkObserveContent",""]],inputs:{disabled:["cdkObserveContentDisabled","disabled"],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"]}),r})(),Fx=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({providers:[CV]}),r})();class Gj extends bn{notifyNext(e,t,a,l,u){this.destination.next(t)}notifyError(e,t){this.destination.error(e)}notifyComplete(e){this.destination.complete()}}class Wj extends bn{constructor(e,t,a){super(),this.parent=e,this.outerValue=t,this.outerIndex=a,this.index=0}_next(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}_error(e){this.parent.notifyError(e,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function zj(r,e,t,a,l=new Wj(r,t,a)){if(!l.closed)return e instanceof An?e.subscribe(l):Vm(e)(l)}const TV={};function Ux(...r){let e,t;return Al(r[r.length-1])&&(t=r.pop()),"function"==typeof r[r.length-1]&&(e=r.pop()),1===r.length&&ur(r[0])&&(r=r[0]),au(r,t).lift(new Kj(e))}class Kj{constructor(e){this.resultSelector=e}call(e,t){return t.subscribe(new qj(e,this.resultSelector))}}class qj extends Gj{constructor(e,t){super(e),this.resultSelector=t,this.active=0,this.values=[],this.observables=[]}_next(e){this.values.push(TV),this.observables.push(e)}_complete(){const e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(let a=0;a<t;a++)this.add(zj(this,e[a],void 0,a))}}notifyComplete(e){0==(this.active-=1)&&this.destination.complete()}notifyNext(e,t,a){const l=this.values,f=this.toRespond?l[a]===TV?--this.toRespond:this.toRespond:0;l[a]=t,0===f&&(this.resultSelector?this._tryResultSelector(l):this.destination.next(l.slice()))}_tryResultSelector(e){let t;try{t=this.resultSelector.apply(this,e)}catch(a){return void this.destination.error(a)}this.destination.next(t)}}function MO(...r){return function Yj(){return qa(1)}()(S(...r))}const IV=(()=>{function r(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return r.prototype=Object.create(Error.prototype),r})(),Tm=new An(r=>r.complete());function kO(r){return r?function $j(r){return new An(e=>r.schedule(()=>e.complete()))}(r):Tm}function ho(r){return e=>0===r?kO():e.lift(new Xj(r))}class Xj{constructor(e){if(this.total=e,this.total<0)throw new IV}call(e,t){return t.subscribe(new Jj(e,this.total))}}class Jj extends bn{constructor(e,t){super(e),this.total=t,this.count=0}_next(e){const t=this.total,a=++this.count;a<=t&&(this.destination.next(e),a===t&&(this.destination.complete(),this.unsubscribe()))}}function bT(...r){const e=r[r.length-1];return Al(e)?(r.pop(),t=>MO(r,t,e)):t=>MO(r,t)}const RV=new Set;let uy,Qj=(()=>{class r{constructor(t){this._platform=t,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):e4}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&function Zj(r){if(!RV.has(r))try{uy||(uy=document.createElement("style"),uy.setAttribute("type","text/css"),document.head.appendChild(uy)),uy.sheet&&(uy.sheet.insertRule(`@media ${r} {body{ }}`,0),RV.add(r))}catch(e){console.error(e)}}(t),this._matchMedia(t)}}return r.\u0275fac=function(t){return new(t||r)(he(jr))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function e4(r){return{matches:"all"===r||""===r,media:r,addListener:()=>{},removeListener:()=>{}}}let wV=(()=>{class r{constructor(t,a){this._mediaMatcher=t,this._zone=a,this._queries=new Map,this._destroySubject=new fn}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return AV(PO(t)).some(l=>this._registerQuery(l).mql.matches)}observe(t){let u=Ux(AV(PO(t)).map(f=>this._registerQuery(f).observable));return u=MO(u.pipe(ho(1)),u.pipe(yV(1),SV(0))),u.pipe(xt(f=>{const g={matches:!1,breakpoints:{}};return f.forEach(({matches:v,query:b})=>{g.matches=g.matches||v,g.breakpoints[b]=v}),g}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const a=this._mediaMatcher.matchMedia(t),u={observable:new An(f=>{const g=v=>this._zone.run(()=>f.next(v));return a.addListener(g),()=>{a.removeListener(g)}}).pipe(bT(a),xt(({matches:f})=>({query:t,matches:f})),bs(this._destroySubject)),mql:a};return this._queries.set(t,u),u}}return r.\u0275fac=function(t){return new(t||r)(he(Qj),he(Ht))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function AV(r){return r.map(e=>e.split(",")).reduce((e,t)=>e.concat(t)).map(e=>e.trim())}function LO(r,e){return(r.getAttribute(e)||"").match(/\S+/g)||[]}const OV="cdk-describedby-message",xO="cdk-describedby-host";let Vx=0,r4=(()=>{class r{constructor(t,a){this._platform=a,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+Vx++,this._document=t,this._id=_t(ch)+"-"+Vx++}describe(t,a,l){if(!this._canBeDescribed(t,a))return;const u=Bx(a,l);"string"!=typeof a?(NV(a,this._id),this._messageRegistry.set(u,{messageElement:a,referenceCount:0})):this._messageRegistry.has(u)||this._createMessageElement(a,l),this._isElementDescribedByMessage(t,u)||this._addMessageReference(t,u)}removeDescription(t,a,l){if(!a||!this._isElementNode(t))return;const u=Bx(a,l);if(this._isElementDescribedByMessage(t,u)&&this._removeMessageReference(t,u),"string"==typeof a){const f=this._messageRegistry.get(u);f&&0===f.referenceCount&&this._deleteMessageElement(u)}0===this._messagesContainer?.childNodes.length&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){const t=this._document.querySelectorAll(`[${xO}="${this._id}"]`);for(let a=0;a<t.length;a++)this._removeCdkDescribedByReferenceIds(t[a]),t[a].removeAttribute(xO);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(t,a){const l=this._document.createElement("div");NV(l,this._id),l.textContent=t,a&&l.setAttribute("role",a),this._createMessagesContainer(),this._messagesContainer.appendChild(l),this._messageRegistry.set(Bx(t,a),{messageElement:l,referenceCount:0})}_deleteMessageElement(t){this._messageRegistry.get(t)?.messageElement?.remove(),this._messageRegistry.delete(t)}_createMessagesContainer(){if(this._messagesContainer)return;const t="cdk-describedby-message-container",a=this._document.querySelectorAll(`.${t}[platform="server"]`);for(let u=0;u<a.length;u++)a[u].remove();const l=this._document.createElement("div");l.style.visibility="hidden",l.classList.add(t),l.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&l.setAttribute("platform","server"),this._document.body.appendChild(l),this._messagesContainer=l}_removeCdkDescribedByReferenceIds(t){const a=LO(t,"aria-describedby").filter(l=>0!=l.indexOf(OV));t.setAttribute("aria-describedby",a.join(" "))}_addMessageReference(t,a){const l=this._messageRegistry.get(a);(function n4(r,e,t){const a=LO(r,e);a.some(l=>l.trim()==t.trim())||(a.push(t.trim()),r.setAttribute(e,a.join(" ")))})(t,"aria-describedby",l.messageElement.id),t.setAttribute(xO,this._id),l.referenceCount++}_removeMessageReference(t,a){const l=this._messageRegistry.get(a);l.referenceCount--,function i4(r,e,t){const l=LO(r,e).filter(u=>u!=t.trim());l.length?r.setAttribute(e,l.join(" ")):r.removeAttribute(e)}(t,"aria-describedby",l.messageElement.id),t.removeAttribute(xO)}_isElementDescribedByMessage(t,a){const l=LO(t,"aria-describedby"),u=this._messageRegistry.get(a),f=u&&u.messageElement.id;return!!f&&-1!=l.indexOf(f)}_canBeDescribed(t,a){if(!this._isElementNode(t))return!1;if(a&&"object"==typeof a)return!0;const l=null==a?"":`${a}`.trim(),u=t.getAttribute("aria-label");return!(!l||u&&u.trim()===l)}_isElementNode(t){return t.nodeType===this._document.ELEMENT_NODE}}return r.\u0275fac=function(t){return new(t||r)(he(rn),he(jr))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function Bx(r,e){return"string"==typeof r?`${e||""}/${r}`:r}function NV(r,e){r.id||(r.id=`${OV}-${e}-${Vx++}`)}function MV(r){return 0===r.buttons||0===r.offsetX&&0===r.offsetY}function kV(r){const e=r.touches&&r.touches[0]||r.changedTouches&&r.changedTouches[0];return!(!e||-1!==e.identifier||null!=e.radiusX&&1!==e.radiusX||null!=e.radiusY&&1!==e.radiusY)}const d4=new Ne("cdk-input-modality-detector-options"),u4={ignoreKeys:[18,17,224,91,16]},hy=o({passive:!0,capture:!0});let h4=(()=>{class r{constructor(t,a,l,u){this._platform=t,this._mostRecentTarget=null,this._modality=new y(null),this._lastTouchMs=0,this._onKeydown=f=>{this._options?.ignoreKeys?.some(g=>g===f.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=_(f))},this._onMousedown=f=>{Date.now()-this._lastTouchMs<650||(this._modality.next(MV(f)?"keyboard":"mouse"),this._mostRecentTarget=_(f))},this._onTouchstart=f=>{kV(f)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=_(f))},this._options={...u4,...u},this.modalityDetected=this._modality.pipe(yV(1)),this.modalityChanged=this.modalityDetected.pipe(function Pj(r,e){return t=>t.lift(new Mj(r,e))}()),t.isBrowser&&a.runOutsideAngular(()=>{l.addEventListener("keydown",this._onKeydown,hy),l.addEventListener("mousedown",this._onMousedown,hy),l.addEventListener("touchstart",this._onTouchstart,hy)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,hy),document.removeEventListener("mousedown",this._onMousedown,hy),document.removeEventListener("touchstart",this._onTouchstart,hy))}}return r.\u0275fac=function(t){return new(t||r)(he(jr),he(Ht),he(rn),he(d4,8))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const f4=new Ne("cdk-focus-monitor-default-options"),FO=o({passive:!0,capture:!0});let jx=(()=>{class r{constructor(t,a,l,u,f){this._ngZone=t,this._platform=a,this._inputModalityDetector=l,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new fn,this._rootNodeFocusAndBlurListener=g=>{for(let b=_(g);b;b=b.parentElement)"focus"===g.type?this._onFocus(g,b):this._onBlur(g,b)},this._document=u,this._detectionMode=f?.detectionMode||0}monitor(t,a=!1){const l=Jd(t);if(!this._platform.isBrowser||1!==l.nodeType)return S(null);const u=function p(r){if(function h(){if(null==d){const r=typeof document<"u"?document.head:null;d=!(!r||!r.createShadowRoot&&!r.attachShadow)}return d}()){const e=r.getRootNode?r.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&e instanceof ShadowRoot)return e}return null}(l)||this._getDocument(),f=this._elementInfo.get(l);if(f)return a&&(f.checkChildren=!0),f.subject;const g={checkChildren:a,subject:new fn,rootNode:u};return this._elementInfo.set(l,g),this._registerGlobalListeners(g),g.subject}stopMonitoring(t){const a=Jd(t),l=this._elementInfo.get(a);l&&(l.subject.complete(),this._setClasses(a),this._elementInfo.delete(a),this._removeGlobalListeners(l))}focusVia(t,a,l){const u=Jd(t);u===this._getDocument().activeElement?this._getClosestElementsInfo(u).forEach(([g,v])=>this._originChanged(g,a,v)):(this._setOrigin(a),"function"==typeof u.focus&&u.focus(l))}ngOnDestroy(){this._elementInfo.forEach((t,a)=>this.stopMonitoring(a))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(t){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(t)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:t&&this._isLastInteractionFromInputLabel(t)?"mouse":"program"}_shouldBeAttributedToTouch(t){return 1===this._detectionMode||!!t?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(t,a){t.classList.toggle("cdk-focused",!!a),t.classList.toggle("cdk-touch-focused","touch"===a),t.classList.toggle("cdk-keyboard-focused","keyboard"===a),t.classList.toggle("cdk-mouse-focused","mouse"===a),t.classList.toggle("cdk-program-focused","program"===a)}_setOrigin(t,a=!1){this._ngZone.runOutsideAngular(()=>{this._origin=t,this._originFromTouchInteraction="touch"===t&&a,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(t,a){const l=this._elementInfo.get(a),u=_(t);!l||!l.checkChildren&&a!==u||this._originChanged(a,this._getFocusOrigin(u),l)}_onBlur(t,a){const l=this._elementInfo.get(a);!l||l.checkChildren&&t.relatedTarget instanceof Node&&a.contains(t.relatedTarget)||(this._setClasses(a),this._emitOrigin(l,null))}_emitOrigin(t,a){t.subject.observers.length&&this._ngZone.run(()=>t.subject.next(a))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;const a=t.rootNode,l=this._rootNodeFocusListenerCount.get(a)||0;l||this._ngZone.runOutsideAngular(()=>{a.addEventListener("focus",this._rootNodeFocusAndBlurListener,FO),a.addEventListener("blur",this._rootNodeFocusAndBlurListener,FO)}),this._rootNodeFocusListenerCount.set(a,l+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(bs(this._stopInputModalityDetector)).subscribe(u=>{this._setOrigin(u,!0)}))}_removeGlobalListeners(t){const a=t.rootNode;if(this._rootNodeFocusListenerCount.has(a)){const l=this._rootNodeFocusListenerCount.get(a);l>1?this._rootNodeFocusListenerCount.set(a,l-1):(a.removeEventListener("focus",this._rootNodeFocusAndBlurListener,FO),a.removeEventListener("blur",this._rootNodeFocusAndBlurListener,FO),this._rootNodeFocusListenerCount.delete(a))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(t,a,l){this._setClasses(t,a),this._emitOrigin(l,a),this._lastFocusOrigin=a}_getClosestElementsInfo(t){const a=[];return this._elementInfo.forEach((l,u)=>{(u===t||l.checkChildren&&u.contains(t))&&a.push([u,l])}),a}_isLastInteractionFromInputLabel(t){const{_mostRecentTarget:a,mostRecentModality:l}=this._inputModalityDetector;if("mouse"!==l||!a||a===t||"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName||t.disabled)return!1;const u=t.labels;if(u)for(let f=0;f<u.length;f++)if(u[f].contains(a))return!0;return!1}}return r.\u0275fac=function(t){return new(t||r)(he(Ht),he(jr),he(h4),he(rn,8),he(f4,8))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const xV="cdk-high-contrast-black-on-white",FV="cdk-high-contrast-white-on-black",Hx="cdk-high-contrast-active";let UV=(()=>{class r{constructor(t,a){this._platform=t,this._document=a,this._breakpointSubscription=_t(wV).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const a=this._document.defaultView||window,l=a&&a.getComputedStyle?a.getComputedStyle(t):null,u=(l&&l.backgroundColor||"").replace(/ /g,"");switch(t.remove(),u){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(Hx,xV,FV),this._hasCheckedHighContrastMode=!0;const a=this.getHighContrastMode();1===a?t.add(Hx,xV):2===a&&t.add(Hx,FV)}}}return r.\u0275fac=function(t){return new(t||r)(he(jr),he(rn))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),m4=(()=>{class r{constructor(t){t._applyBodyHighContrastModeCssClasses()}}return r.\u0275fac=function(t){return new(t||r)(he(UV))},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({imports:[Fx]}),r})();const _4=new Ne("cdk-dir-doc",{providedIn:"root",factory:function g4(){return _t(rn)}}),E4=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let Gx=(()=>{class r{constructor(t){if(this.value="ltr",this.change=new un,t){const l=t.documentElement?t.documentElement.dir:null;this.value=function y4(r){const e=r?.toLowerCase()||"";return"auto"===e&&typeof navigator<"u"&&navigator?.language?E4.test(navigator.language)?"rtl":"ltr":"rtl"===e?"rtl":"ltr"}((t.body?t.body.dir:null)||l||"ltr")}}ngOnDestroy(){this.change.complete()}}return r.\u0275fac=function(t){return new(t||r)(he(_4,8))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),TT=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({}),r})();const S4=new Ne("mat-sanity-checks",{providedIn:"root",factory:function v4(){return!0}});let Mc=(()=>{class r{constructor(t,a,l){this._sanityChecks=a,this._document=l,this._hasDoneGlobalChecks=!1,t._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!E()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}}return r.\u0275fac=function(t){return new(t||r)(he(UV),he(S4,8),he(rn))},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({imports:[TT,TT]}),r})();function jV(r){return class extends r{constructor(...e){super(...e),this._disabled=!1}get disabled(){return this._disabled}set disabled(e){this._disabled=Sl(e)}}}function Wx(r,e){return class extends r{constructor(...t){super(...t),this.defaultColor=e,this.color=e}get color(){return this._color}set color(t){const a=t||this.defaultColor;a!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),a&&this._elementRef.nativeElement.classList.add(`mat-${a}`),this._color=a)}}}function HV(r){return class extends r{constructor(...e){super(...e),this._disableRipple=!1}get disableRipple(){return this._disableRipple}set disableRipple(e){this._disableRipple=Sl(e)}}}function C4(r,e=0){return class extends r{constructor(...t){super(...t),this._tabIndex=e,this.defaultTabIndex=e}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(t){this._tabIndex=null!=t?NO(t):this.defaultTabIndex}}}function b4(r){return class extends r{constructor(...e){super(...e),this.errorState=!1}updateErrorState(){const e=this.errorState,u=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);u!==e&&(this.errorState=u,this.stateChanges.next())}}}let GV=(()=>{class r{isErrorState(t,a){return!!(t&&t.invalid&&(t.touched||a&&a.submitted))}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();class I4{constructor(e,t,a,l=!1){this._renderer=e,this.element=t,this.config=a,this._animationForciblyDisabledThroughCss=l,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const WV={enterDuration:225,exitDuration:150},zx=o({passive:!0}),zV=["mousedown","touchstart"],KV=["mouseup","mouseleave","touchend","touchcancel"];class w4{constructor(e,t,a,l){this._target=e,this._ngZone=t,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,l.isBrowser&&(this._containerElement=Jd(a))}fadeInRipple(e,t,a={}){const l=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),u={...WV,...a.animation};a.centered&&(e=l.left+l.width/2,t=l.top+l.height/2);const f=a.radius||function A4(r,e,t){const a=Math.max(Math.abs(r-t.left),Math.abs(r-t.right)),l=Math.max(Math.abs(e-t.top),Math.abs(e-t.bottom));return Math.sqrt(a*a+l*l)}(e,t,l),g=e-l.left,v=t-l.top,b=u.enterDuration,D=document.createElement("div");D.classList.add("mat-ripple-element"),D.style.left=g-f+"px",D.style.top=v-f+"px",D.style.height=2*f+"px",D.style.width=2*f+"px",null!=a.color&&(D.style.backgroundColor=a.color),D.style.transitionDuration=`${b}ms`,this._containerElement.appendChild(D);const L=window.getComputedStyle(D),G=L.transitionDuration,q="none"===L.transitionProperty||"0s"===G||"0s, 0s"===G,ie=new I4(this,D,a,q);D.style.transform="scale3d(1, 1, 1)",ie.state=0,a.persistent||(this._mostRecentTransientRipple=ie);let ce=null;return!q&&(b||u.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const Ce=()=>this._finishRippleTransition(ie),we=()=>this._destroyRipple(ie);D.addEventListener("transitionend",Ce),D.addEventListener("transitioncancel",we),ce={onTransitionEnd:Ce,onTransitionCancel:we}}),this._activeRipples.set(ie,ce),(q||!b)&&this._finishRippleTransition(ie),ie}fadeOutRipple(e){if(2===e.state||3===e.state)return;const t=e.element,a={...WV,...e.config.animation};t.style.transitionDuration=`${a.exitDuration}ms`,t.style.opacity="0",e.state=2,(e._animationForciblyDisabledThroughCss||!a.exitDuration)&&this._finishRippleTransition(e)}fadeOutAll(){this._getActiveRipples().forEach(e=>e.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(e=>{e.config.persistent||e.fadeOut()})}setupTriggerEvents(e){const t=Jd(e);!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,this._registerEvents(zV))}handleEvent(e){"mousedown"===e.type?this._onMousedown(e):"touchstart"===e.type?this._onTouchStart(e):this._onPointerUp(),this._pointerUpEventsRegistered||(this._registerEvents(KV),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(e){0===e.state?this._startFadeOutTransition(e):2===e.state&&this._destroyRipple(e)}_startFadeOutTransition(e){const t=e===this._mostRecentTransientRipple,{persistent:a}=e.config;e.state=1,!a&&(!t||!this._isPointerDown)&&e.fadeOut()}_destroyRipple(e){const t=this._activeRipples.get(e)??null;this._activeRipples.delete(e),this._activeRipples.size||(this._containerRect=null),e===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),e.state=3,null!==t&&(e.element.removeEventListener("transitionend",t.onTransitionEnd),e.element.removeEventListener("transitioncancel",t.onTransitionCancel)),e.element.remove()}_onMousedown(e){const t=MV(e),a=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!t&&!a&&(this._isPointerDown=!0,this.fadeInRipple(e.clientX,e.clientY,this._target.rippleConfig))}_onTouchStart(e){if(!this._target.rippleDisabled&&!kV(e)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const t=e.changedTouches;for(let a=0;a<t.length;a++)this.fadeInRipple(t[a].clientX,t[a].clientY,this._target.rippleConfig)}}_onPointerUp(){!this._isPointerDown||(this._isPointerDown=!1,this._getActiveRipples().forEach(e=>{!e.config.persistent&&(1===e.state||e.config.terminateOnPointerUp&&0===e.state)&&e.fadeOut()}))}_registerEvents(e){this._ngZone.runOutsideAngular(()=>{e.forEach(t=>{this._triggerElement.addEventListener(t,this,zx)})})}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){this._triggerElement&&(zV.forEach(e=>{this._triggerElement.removeEventListener(e,this,zx)}),this._pointerUpEventsRegistered&&KV.forEach(e=>{this._triggerElement.removeEventListener(e,this,zx)}))}}const D4=new Ne("mat-ripple-global-options");let Kx=(()=>{class r{constructor(t,a,l,u,f){this._elementRef=t,this._animationMode=f,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=u||{},this._rippleRenderer=new w4(this,a,t,l)}get disabled(){return this._disabled}set disabled(t){t&&this.fadeOutAllNonPersistent(),this._disabled=t,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(t){this._trigger=t,this._setupTriggerEventsIfEnabled()}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(t,a=0,l){return"number"==typeof t?this._rippleRenderer.fadeInRipple(t,a,{...this.rippleConfig,...l}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...t})}}return r.\u0275fac=function(t){return new(t||r)(se(ci),se(Ht),se(jr),se(D4,8),se($n,8))},r.\u0275dir=Be({type:r,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(t,a){2&t&&In("mat-ripple-unbounded",a.unbounded)},inputs:{color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],radius:["matRippleRadius","radius"],animation:["matRippleAnimation","animation"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"]},exportAs:["matRipple"]}),r})(),qV=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({imports:[Mc,Mc]}),r})();const O4=["mat-button",""],N4=["*"],M4=["mat-button","mat-flat-button","mat-icon-button","mat-raised-button","mat-stroked-button","mat-mini-fab","mat-fab"],k4=Wx(jV(HV(class{constructor(r){this._elementRef=r}})));let L4=(()=>{class r extends k4{constructor(t,a,l){super(t),this._focusMonitor=a,this._animationMode=l,this.isRoundButton=this._hasHostAttributes("mat-fab","mat-mini-fab"),this.isIconButton=this._hasHostAttributes("mat-icon-button");for(const u of M4)this._hasHostAttributes(u)&&this._getHostElement().classList.add(u);t.nativeElement.classList.add("mat-button-base"),this.isRoundButton&&(this.color="accent")}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(t,a){t?this._focusMonitor.focusVia(this._getHostElement(),t,a):this._getHostElement().focus(a)}_getHostElement(){return this._elementRef.nativeElement}_isRippleDisabled(){return this.disableRipple||this.disabled}_hasHostAttributes(...t){return t.some(a=>this._getHostElement().hasAttribute(a))}}return r.\u0275fac=function(t){return new(t||r)(se(ci),se(jx),se($n,8))},r.\u0275cmp=qr({type:r,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-icon-button",""],["button","mat-fab",""],["button","mat-mini-fab",""],["button","mat-stroked-button",""],["button","mat-flat-button",""]],viewQuery:function(t,a){if(1&t&&Ec(Kx,5),2&t){let l;sr(l=Xi())&&(a.ripple=l.first)}},hostAttrs:[1,"mat-focus-indicator"],hostVars:5,hostBindings:function(t,a){2&t&&(tr("disabled",a.disabled||null),In("_mat-animation-noopable","NoopAnimations"===a._animationMode)("mat-button-disabled",a.disabled))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[Ft],attrs:O4,ngContentSelectors:N4,decls:4,vars:5,consts:[[1,"mat-button-wrapper"],["matRipple","",1,"mat-button-ripple",3,"matRippleDisabled","matRippleCentered","matRippleTrigger"],[1,"mat-button-focus-overlay"]],template:function(t,a){1&t&&(hc(),De(0,"span",0),Mr(1),Ge(),tn(2,"span",1)(3,"span",2)),2&t&&(Xe(2),In("mat-button-ripple-round",a.isRoundButton||a.isIconButton),Ze("matRippleDisabled",a._isRippleDisabled())("matRippleCentered",a.isIconButton)("matRippleTrigger",a._getHostElement()))},dependencies:[Kx],styles:[".mat-button .mat-button-focus-overlay,.mat-icon-button .mat-button-focus-overlay{opacity:0}.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:.04}@media(hover: none){.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:0}}.mat-button,.mat-icon-button,.mat-stroked-button,.mat-flat-button{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-button.mat-button-disabled,.mat-icon-button.mat-button-disabled,.mat-stroked-button.mat-button-disabled,.mat-flat-button.mat-button-disabled{cursor:default}.mat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-button.cdk-program-focused .mat-button-focus-overlay,.mat-icon-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-icon-button.cdk-program-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-program-focused .mat-button-focus-overlay,.mat-flat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-flat-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-raised-button{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button.mat-button-disabled{cursor:default}.mat-raised-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-raised-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-stroked-button{border:1px solid currentColor;padding:0 15px;line-height:34px}.mat-stroked-button .mat-button-ripple.mat-ripple,.mat-stroked-button .mat-button-focus-overlay{top:-1px;left:-1px;right:-1px;bottom:-1px}.mat-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:56px;height:56px;padding:0;flex-shrink:0}.mat-fab::-moz-focus-inner{border:0}.mat-fab.mat-button-disabled{cursor:default}.mat-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-fab::-moz-focus-inner{border:0}.mat-fab._mat-animation-noopable{transition:none !important;animation:none !important}.mat-fab .mat-button-wrapper{padding:16px 0;display:inline-block;line-height:24px}.mat-mini-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:40px;height:40px;padding:0;flex-shrink:0}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab.mat-button-disabled{cursor:default}.mat-mini-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-mini-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mini-fab .mat-button-wrapper{padding:8px 0;display:inline-block;line-height:24px}.mat-icon-button{padding:0;min-width:0;width:40px;height:40px;flex-shrink:0;line-height:40px;border-radius:50%}.mat-icon-button i,.mat-icon-button .mat-icon{line-height:24px}.mat-button-ripple.mat-ripple,.mat-button-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-button-ripple.mat-ripple:not(:empty){transform:translateZ(0)}.mat-button-focus-overlay{opacity:0;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1),background-color 200ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable .mat-button-focus-overlay{transition:none}.mat-button-ripple-round{border-radius:50%;z-index:1}.mat-button .mat-button-wrapper>*,.mat-flat-button .mat-button-wrapper>*,.mat-stroked-button .mat-button-wrapper>*,.mat-raised-button .mat-button-wrapper>*,.mat-icon-button .mat-button-wrapper>*,.mat-fab .mat-button-wrapper>*,.mat-mini-fab .mat-button-wrapper>*{vertical-align:middle}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button{display:inline-flex;justify-content:center;align-items:center;font-size:inherit;width:2.5em;height:2.5em}.mat-flat-button::before,.mat-raised-button::before,.mat-fab::before,.mat-mini-fab::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 2px) * -1)}.mat-stroked-button::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px) * -1)}.cdk-high-contrast-active .mat-button,.cdk-high-contrast-active .mat-flat-button,.cdk-high-contrast-active .mat-raised-button,.cdk-high-contrast-active .mat-icon-button,.cdk-high-contrast-active .mat-fab,.cdk-high-contrast-active .mat-mini-fab{outline:solid 1px}"],encapsulation:2,changeDetection:0}),r})(),x4=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({imports:[qV,Mc,Mc]}),r})();const YV=o({passive:!0});let F4=(()=>{class r{constructor(t,a){this._platform=t,this._ngZone=a,this._monitoredElements=new Map}monitor(t){if(!this._platform.isBrowser)return Tm;const a=Jd(t),l=this._monitoredElements.get(a);if(l)return l.subject;const u=new fn,f="cdk-text-field-autofilled",g=v=>{"cdk-text-field-autofill-start"!==v.animationName||a.classList.contains(f)?"cdk-text-field-autofill-end"===v.animationName&&a.classList.contains(f)&&(a.classList.remove(f),this._ngZone.run(()=>u.next({target:v.target,isAutofilled:!1}))):(a.classList.add(f),this._ngZone.run(()=>u.next({target:v.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{a.addEventListener("animationstart",g,YV),a.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(a,{subject:u,unlisten:()=>{a.removeEventListener("animationstart",g,YV)}}),u}stopMonitoring(t){const a=Jd(t),l=this._monitoredElements.get(a);l&&(l.unlisten(),l.subject.complete(),a.classList.remove("cdk-text-field-autofill-monitored"),a.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(a))}ngOnDestroy(){this._monitoredElements.forEach((t,a)=>this.stopMonitoring(a))}}return r.\u0275fac=function(t){return new(t||r)(he(jr),he(Ht))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),$V=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({}),r})();function qx(r,e,t,a){return x(t)&&(a=t,t=void 0),a?qx(r,e,t).pipe(xt(l=>ur(l)?a(...l):a(l))):new An(l=>{XV(r,e,function u(f){l.next(arguments.length>1?Array.prototype.slice.call(arguments):f)},l,t)})}function XV(r,e,t,a,l){let u;if(function B4(r){return r&&"function"==typeof r.addEventListener&&"function"==typeof r.removeEventListener}(r)){const f=r;r.addEventListener(e,t,l),u=()=>f.removeEventListener(e,t,l)}else if(function V4(r){return r&&"function"==typeof r.on&&"function"==typeof r.off}(r)){const f=r;r.on(e,t),u=()=>f.off(e,t)}else if(function U4(r){return r&&"function"==typeof r.addListener&&"function"==typeof r.removeListener}(r)){const f=r;r.addListener(e,t),u=()=>f.removeListener(e,t)}else{if(!r||!r.length)throw new TypeError("Invalid event target");for(let f=0,g=r.length;f<g;f++)XV(r[f],e,t,a,l)}a.add(u)}class JV{}const Qd="*";function Yx(r,e){return{type:7,name:r,definitions:e,options:{}}}function RT(r,e=null){return{type:4,styles:e,timings:r}}function QV(r,e=null){return{type:2,steps:r,options:e}}function Ts(r){return{type:6,styles:r,offset:null}}function $x(r,e,t){return{type:0,name:r,styles:e,options:t}}function wT(r,e,t=null){return{type:1,expr:r,animation:e,options:t}}function ZV(r){Promise.resolve().then(r)}class AT{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){ZV(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(a=>a()),t.length=0}}class e3{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,a=0,l=0;const u=this.players.length;0==u?ZV(()=>this._onFinish()):this.players.forEach(f=>{f.onDone(()=>{++t==u&&this._onFinish()}),f.onDestroy(()=>{++a==u&&this._onDestroy()}),f.onStart(()=>{++l==u&&this._onStart()})}),this.totalTime=this.players.reduce((f,g)=>Math.max(f,g.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(a=>{const l=a.totalTime?Math.min(1,t/a.totalTime):1;a.setPosition(l)})}getPosition(){const e=this.players.reduce((t,a)=>null===t||a.totalTime>t.totalTime?a:t,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(a=>a()),t.length=0}}const G4=["connectionContainer"],W4=["inputContainer"],z4=["label"];function K4(r,e){1&r&&(uc(0),De(1,"div",14),tn(2,"div",15)(3,"div",16)(4,"div",17),Ge(),De(5,"div",18),tn(6,"div",15)(7,"div",16)(8,"div",17),Ge(),Jc())}function q4(r,e){if(1&r){const t=ya();De(0,"div",19),Xt("cdkObserveContent",function(){return ds(t),us(ln().updateOutlineGap())}),Mr(1,1),Ge()}2&r&&Ze("cdkObserveContentDisabled","outline"!=ln().appearance)}function Y4(r,e){if(1&r&&(uc(0),Mr(1,2),De(2,"span"),$i(3),Ge(),Jc()),2&r){const t=ln(2);Xe(3),fs(t._control.placeholder)}}function $4(r,e){1&r&&Mr(0,3,["*ngSwitchCase","true"])}function X4(r,e){1&r&&(De(0,"span",23),$i(1," *"),Ge())}function J4(r,e){if(1&r){const t=ya();De(0,"label",20,21),Xt("cdkObserveContent",function(){return ds(t),us(ln().updateOutlineGap())}),zn(2,Y4,4,1,"ng-container",12),zn(3,$4,1,0,"ng-content",12),zn(4,X4,2,0,"span",22),Ge()}if(2&r){const t=ln();In("mat-empty",t._control.empty&&!t._shouldAlwaysFloat())("mat-form-field-empty",t._control.empty&&!t._shouldAlwaysFloat())("mat-accent","accent"==t.color)("mat-warn","warn"==t.color),Ze("cdkObserveContentDisabled","outline"!=t.appearance)("id",t._labelId)("ngSwitch",t._hasLabel()),tr("for",t._control.id)("aria-owns",t._control.id),Xe(2),Ze("ngSwitchCase",!1),Xe(1),Ze("ngSwitchCase",!0),Xe(1),Ze("ngIf",!t.hideRequiredMarker&&t._control.required&&!t._control.disabled)}}function Q4(r,e){1&r&&(De(0,"div",24),Mr(1,4),Ge())}function Z4(r,e){if(1&r&&(De(0,"div",25),tn(1,"span",26),Ge()),2&r){const t=ln();Xe(1),In("mat-accent","accent"==t.color)("mat-warn","warn"==t.color)}}function e5(r,e){1&r&&(De(0,"div"),Mr(1,5),Ge()),2&r&&Ze("@transitionMessages",ln()._subscriptAnimationState)}function t5(r,e){if(1&r&&(De(0,"div",30),$i(1),Ge()),2&r){const t=ln(2);Ze("id",t._hintLabelId),Xe(1),fs(t.hintLabel)}}function n5(r,e){if(1&r&&(De(0,"div",27),zn(1,t5,2,2,"div",28),Mr(2,6),tn(3,"div",29),Mr(4,7),Ge()),2&r){const t=ln();Ze("@transitionMessages",t._subscriptAnimationState),Xe(1),Ze("ngIf",t.hintLabel)}}const r5=["*",[["","matPrefix",""]],[["mat-placeholder"]],[["mat-label"]],[["","matSuffix",""]],[["mat-error"]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],o5=["*","[matPrefix]","mat-placeholder","mat-label","[matSuffix]","mat-error","mat-hint:not([align='end'])","mat-hint[align='end']"],s5=new Ne("MatError"),a5={transitionMessages:Yx("transitionMessages",[$x("enter",Ts({opacity:1,transform:"translateY(0%)"})),wT("void => enter",[Ts({opacity:0,transform:"translateY(-5px)"}),RT("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])};let Jx=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275dir=Be({type:r}),r})();const c5=new Ne("MatHint");let Qx=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275dir=Be({type:r,selectors:[["mat-label"]]}),r})(),l5=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275dir=Be({type:r,selectors:[["mat-placeholder"]]}),r})();const d5=new Ne("MatPrefix"),u5=new Ne("MatSuffix");let t3=0;const p5=Wx(class{constructor(r){this._elementRef=r}},"primary"),f5=new Ne("MAT_FORM_FIELD_DEFAULT_OPTIONS"),r3=new Ne("MatFormField");let m5=(()=>{class r extends p5{constructor(t,a,l,u,f,g,v){super(t),this._changeDetectorRef=a,this._dir=l,this._defaults=u,this._platform=f,this._ngZone=g,this._outlineGapCalculationNeededImmediately=!1,this._outlineGapCalculationNeededOnStable=!1,this._destroyed=new fn,this._hideRequiredMarker=!1,this._showAlwaysAnimate=!1,this._subscriptAnimationState="",this._hintLabel="",this._hintLabelId="mat-hint-"+t3++,this._labelId="mat-form-field-label-"+t3++,this.floatLabel=this._getDefaultFloatLabelState(),this._animationsEnabled="NoopAnimations"!==v,this.appearance=u?.appearance||"legacy",u&&(this._hideRequiredMarker=Boolean(u.hideRequiredMarker),u.color&&(this.color=this.defaultColor=u.color))}get appearance(){return this._appearance}set appearance(t){const a=this._appearance;this._appearance=t||this._defaults?.appearance||"legacy","outline"===this._appearance&&a!==t&&(this._outlineGapCalculationNeededOnStable=!0)}get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(t){this._hideRequiredMarker=Sl(t)}_shouldAlwaysFloat(){return"always"===this.floatLabel&&!this._showAlwaysAnimate}_canLabelFloat(){return"never"!==this.floatLabel}get hintLabel(){return this._hintLabel}set hintLabel(t){this._hintLabel=t,this._processHints()}get floatLabel(){return"legacy"!==this.appearance&&"never"===this._floatLabel?"auto":this._floatLabel}set floatLabel(t){t!==this._floatLabel&&(this._floatLabel=t||this._getDefaultFloatLabelState(),this._changeDetectorRef.markForCheck())}get _control(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic}set _control(t){this._explicitFormFieldControl=t}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._connectionContainerRef||this._elementRef}ngAfterContentInit(){this._validateControlChild();const t=this._control;t.controlType&&this._elementRef.nativeElement.classList.add(`mat-form-field-type-${t.controlType}`),t.stateChanges.pipe(bT(null)).subscribe(()=>{this._validatePlaceholders(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),t.ngControl&&t.ngControl.valueChanges&&t.ngControl.valueChanges.pipe(bs(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(bs(this._destroyed)).subscribe(()=>{this._outlineGapCalculationNeededOnStable&&this.updateOutlineGap()})}),Ly(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._outlineGapCalculationNeededOnStable=!0,this._changeDetectorRef.markForCheck()}),this._hintChildren.changes.pipe(bT(null)).subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.pipe(bT(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._dir&&this._dir.change.pipe(bs(this._destroyed)).subscribe(()=>{"function"==typeof requestAnimationFrame?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>this.updateOutlineGap())}):this.updateOutlineGap()})}ngAfterContentChecked(){this._validateControlChild(),this._outlineGapCalculationNeededImmediately&&this.updateOutlineGap()}ngAfterViewInit(){this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_shouldForward(t){const a=this._control?this._control.ngControl:null;return a&&a[t]}_hasPlaceholder(){return!!(this._control&&this._control.placeholder||this._placeholderChild)}_hasLabel(){return!(!this._labelChildNonStatic&&!this._labelChildStatic)}_shouldLabelFloat(){return this._canLabelFloat()&&(this._control&&this._control.shouldLabelFloat||this._shouldAlwaysFloat())}_hideControlPlaceholder(){return"legacy"===this.appearance&&!this._hasLabel()||this._hasLabel()&&!this._shouldLabelFloat()}_hasFloatingLabel(){return this._hasLabel()||"legacy"===this.appearance&&this._hasPlaceholder()}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_animateAndLockLabel(){this._hasFloatingLabel()&&this._canLabelFloat()&&(this._animationsEnabled&&this._label&&(this._showAlwaysAnimate=!0,qx(this._label.nativeElement,"transitionend").pipe(ho(1)).subscribe(()=>{this._showAlwaysAnimate=!1})),this.floatLabel="always",this._changeDetectorRef.markForCheck())}_validatePlaceholders(){}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){}_getDefaultFloatLabelState(){return this._defaults&&this._defaults.floatLabel||"auto"}_syncDescribedByIds(){if(this._control){let t=[];if(this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&t.push(...this._control.userAriaDescribedBy.split(" ")),"hint"===this._getDisplayedMessages()){const a=this._hintChildren?this._hintChildren.find(u=>"start"===u.align):null,l=this._hintChildren?this._hintChildren.find(u=>"end"===u.align):null;a?t.push(a.id):this._hintLabel&&t.push(this._hintLabelId),l&&t.push(l.id)}else this._errorChildren&&t.push(...this._errorChildren.map(a=>a.id));this._control.setDescribedByIds(t)}}_validateControlChild(){}updateOutlineGap(){const t=this._label?this._label.nativeElement:null,a=this._connectionContainerRef.nativeElement,l=".mat-form-field-outline-start",u=".mat-form-field-outline-gap";if("outline"!==this.appearance||!this._platform.isBrowser)return;if(!t||!t.children.length||!t.textContent.trim()){const D=a.querySelectorAll(`${l}, ${u}`);for(let L=0;L<D.length;L++)D[L].style.width="0";return}if(!this._isAttachedToDOM())return void(this._outlineGapCalculationNeededImmediately=!0);let f=0,g=0;const v=a.querySelectorAll(l),b=a.querySelectorAll(u);if(this._label&&this._label.nativeElement.children.length){const D=a.getBoundingClientRect();if(0===D.width&&0===D.height)return this._outlineGapCalculationNeededOnStable=!0,void(this._outlineGapCalculationNeededImmediately=!1);const L=this._getStartEnd(D),j=t.children,G=this._getStartEnd(j[0].getBoundingClientRect());let q=0;for(let ie=0;ie<j.length;ie++)q+=j[ie].offsetWidth;f=Math.abs(G-L)-5,g=q>0?.75*q+10:0}for(let D=0;D<v.length;D++)v[D].style.width=`${f}px`;for(let D=0;D<b.length;D++)b[D].style.width=`${g}px`;this._outlineGapCalculationNeededOnStable=this._outlineGapCalculationNeededImmediately=!1}_getStartEnd(t){return this._dir&&"rtl"===this._dir.value?t.right:t.left}_isAttachedToDOM(){const t=this._elementRef.nativeElement;if(t.getRootNode){const a=t.getRootNode();return a&&a!==t}return document.documentElement.contains(t)}}return r.\u0275fac=function(t){return new(t||r)(se(ci),se(nn),se(Gx,8),se(f5,8),se(jr),se(Ht),se($n,8))},r.\u0275cmp=qr({type:r,selectors:[["mat-form-field"]],contentQueries:function(t,a,l){if(1&t&&(_s(l,Jx,5),_s(l,Jx,7),_s(l,Qx,5),_s(l,Qx,7),_s(l,l5,5),_s(l,s5,5),_s(l,c5,5),_s(l,d5,5),_s(l,u5,5)),2&t){let u;sr(u=Xi())&&(a._controlNonStatic=u.first),sr(u=Xi())&&(a._controlStatic=u.first),sr(u=Xi())&&(a._labelChildNonStatic=u.first),sr(u=Xi())&&(a._labelChildStatic=u.first),sr(u=Xi())&&(a._placeholderChild=u.first),sr(u=Xi())&&(a._errorChildren=u),sr(u=Xi())&&(a._hintChildren=u),sr(u=Xi())&&(a._prefixChildren=u),sr(u=Xi())&&(a._suffixChildren=u)}},viewQuery:function(t,a){if(1&t&&(Ec(G4,7),Ec(W4,5),Ec(z4,5)),2&t){let l;sr(l=Xi())&&(a._connectionContainerRef=l.first),sr(l=Xi())&&(a._inputContainerRef=l.first),sr(l=Xi())&&(a._label=l.first)}},hostAttrs:[1,"mat-form-field"],hostVars:40,hostBindings:function(t,a){2&t&&In("mat-form-field-appearance-standard","standard"==a.appearance)("mat-form-field-appearance-fill","fill"==a.appearance)("mat-form-field-appearance-outline","outline"==a.appearance)("mat-form-field-appearance-legacy","legacy"==a.appearance)("mat-form-field-invalid",a._control.errorState)("mat-form-field-can-float",a._canLabelFloat())("mat-form-field-should-float",a._shouldLabelFloat())("mat-form-field-has-label",a._hasFloatingLabel())("mat-form-field-hide-placeholder",a._hideControlPlaceholder())("mat-form-field-disabled",a._control.disabled)("mat-form-field-autofilled",a._control.autofilled)("mat-focused",a._control.focused)("ng-untouched",a._shouldForward("untouched"))("ng-touched",a._shouldForward("touched"))("ng-pristine",a._shouldForward("pristine"))("ng-dirty",a._shouldForward("dirty"))("ng-valid",a._shouldForward("valid"))("ng-invalid",a._shouldForward("invalid"))("ng-pending",a._shouldForward("pending"))("_mat-animation-noopable",!a._animationsEnabled)},inputs:{color:"color",appearance:"appearance",hideRequiredMarker:"hideRequiredMarker",hintLabel:"hintLabel",floatLabel:"floatLabel"},exportAs:["matFormField"],features:[Mn([{provide:r3,useExisting:r}]),Ft],ngContentSelectors:o5,decls:15,vars:8,consts:[[1,"mat-form-field-wrapper"],[1,"mat-form-field-flex",3,"click"],["connectionContainer",""],[4,"ngIf"],["class","mat-form-field-prefix",3,"cdkObserveContentDisabled","cdkObserveContent",4,"ngIf"],[1,"mat-form-field-infix"],["inputContainer",""],[1,"mat-form-field-label-wrapper"],["class","mat-form-field-label",3,"cdkObserveContentDisabled","id","mat-empty","mat-form-field-empty","mat-accent","mat-warn","ngSwitch","cdkObserveContent",4,"ngIf"],["class","mat-form-field-suffix",4,"ngIf"],["class","mat-form-field-underline",4,"ngIf"],[1,"mat-form-field-subscript-wrapper",3,"ngSwitch"],[4,"ngSwitchCase"],["class","mat-form-field-hint-wrapper",4,"ngSwitchCase"],[1,"mat-form-field-outline"],[1,"mat-form-field-outline-start"],[1,"mat-form-field-outline-gap"],[1,"mat-form-field-outline-end"],[1,"mat-form-field-outline","mat-form-field-outline-thick"],[1,"mat-form-field-prefix",3,"cdkObserveContentDisabled","cdkObserveContent"],[1,"mat-form-field-label",3,"cdkObserveContentDisabled","id","ngSwitch","cdkObserveContent"],["label",""],["class","mat-placeholder-required mat-form-field-required-marker","aria-hidden","true",4,"ngIf"],["aria-hidden","true",1,"mat-placeholder-required","mat-form-field-required-marker"],[1,"mat-form-field-suffix"],[1,"mat-form-field-underline"],[1,"mat-form-field-ripple"],[1,"mat-form-field-hint-wrapper"],["class","mat-hint",3,"id",4,"ngIf"],[1,"mat-form-field-hint-spacer"],[1,"mat-hint",3,"id"]],template:function(t,a){1&t&&(hc(r5),De(0,"div",0)(1,"div",1,2),Xt("click",function(u){return a._control.onContainerClick&&a._control.onContainerClick(u)}),zn(3,K4,9,0,"ng-container",3),zn(4,q4,2,1,"div",4),De(5,"div",5,6),Mr(7),De(8,"span",7),zn(9,J4,5,16,"label",8),Ge()(),zn(10,Q4,2,0,"div",9),Ge(),zn(11,Z4,2,4,"div",10),De(12,"div",11),zn(13,e5,2,1,"div",12),zn(14,n5,5,2,"div",13),Ge()()),2&t&&(Xe(3),Ze("ngIf","outline"==a.appearance),Xe(1),Ze("ngIf",a._prefixChildren.length),Xe(5),Ze("ngIf",a._hasFloatingLabel()),Xe(1),Ze("ngIf",a._suffixChildren.length),Xe(1),Ze("ngIf","outline"!=a.appearance),Xe(1),Ze("ngSwitch",a._getDisplayedMessages()),Xe(1),Ze("ngSwitchCase","error"),Xe(1),Ze("ngSwitchCase","hint"))},dependencies:[cl,Zs,wD,bV],styles:[".mat-form-field{display:inline-block;position:relative;text-align:left}[dir=rtl] .mat-form-field{text-align:right}.mat-form-field-wrapper{position:relative}.mat-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-form-field-prefix,.mat-form-field-suffix{white-space:nowrap;flex:none;position:relative}.mat-form-field-infix{display:block;position:relative;flex:auto;min-width:0;width:180px}.cdk-high-contrast-active .mat-form-field-infix{border-image:linear-gradient(transparent, transparent)}.mat-form-field-label-wrapper{position:absolute;left:0;box-sizing:content-box;width:100%;height:100%;overflow:hidden;pointer-events:none}[dir=rtl] .mat-form-field-label-wrapper{left:auto;right:0}.mat-form-field-label{position:absolute;left:0;font:inherit;pointer-events:none;width:100%;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;transform-origin:0 0;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),color 400ms cubic-bezier(0.25, 0.8, 0.25, 1),width 400ms cubic-bezier(0.25, 0.8, 0.25, 1);display:none}[dir=rtl] .mat-form-field-label{transform-origin:100% 0;left:auto;right:0}.cdk-high-contrast-active .mat-form-field-disabled .mat-form-field-label{color:GrayText}.mat-form-field-empty.mat-form-field-label,.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-label{display:block}.mat-form-field-autofill-control:-webkit-autofill+.mat-form-field-label-wrapper .mat-form-field-label{display:none}.mat-form-field-can-float .mat-form-field-autofill-control:-webkit-autofill+.mat-form-field-label-wrapper .mat-form-field-label{display:block;transition:none}.mat-input-server:focus+.mat-form-field-label-wrapper .mat-form-field-label,.mat-input-server[placeholder]:not(:placeholder-shown)+.mat-form-field-label-wrapper .mat-form-field-label{display:none}.mat-form-field-can-float .mat-input-server:focus+.mat-form-field-label-wrapper .mat-form-field-label,.mat-form-field-can-float .mat-input-server[placeholder]:not(:placeholder-shown)+.mat-form-field-label-wrapper .mat-form-field-label{display:block}.mat-form-field-label:not(.mat-form-field-empty){transition:none}.mat-form-field-underline{position:absolute;width:100%;pointer-events:none;transform:scale3d(1, 1.0001, 1)}.mat-form-field-ripple{position:absolute;left:0;width:100%;transform-origin:50%;transform:scaleX(0.5);opacity:0;transition:background-color 300ms cubic-bezier(0.55, 0, 0.55, 0.2)}.mat-form-field.mat-focused .mat-form-field-ripple,.mat-form-field.mat-form-field-invalid .mat-form-field-ripple{opacity:1;transform:none;transition:transform 300ms cubic-bezier(0.25, 0.8, 0.25, 1),opacity 100ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 300ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-subscript-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.mat-form-field-subscript-wrapper .mat-icon,.mat-form-field-label-wrapper .mat-icon{width:1em;height:1em;font-size:inherit;vertical-align:baseline}.mat-form-field-hint-wrapper{display:flex}.mat-form-field-hint-spacer{flex:1 0 1em}.mat-error{display:block}.mat-form-field-control-wrapper{position:relative}.mat-form-field-hint-end{order:1}.mat-form-field._mat-animation-noopable .mat-form-field-label,.mat-form-field._mat-animation-noopable .mat-form-field-ripple{transition:none}",'.mat-form-field-appearance-fill .mat-form-field-flex{border-radius:4px 4px 0 0;padding:.75em .75em 0 .75em}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-form-field-flex{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-form-field-flex{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-form-field-flex{outline:dashed 3px}.mat-form-field-appearance-fill .mat-form-field-underline::before{content:"";display:block;position:absolute;bottom:0;height:1px;width:100%}.mat-form-field-appearance-fill .mat-form-field-ripple{bottom:0;height:2px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-form-field-ripple{height:0}.mat-form-field-appearance-fill:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{opacity:1;transform:none;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-fill._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{transition:none}.mat-form-field-appearance-fill .mat-form-field-subscript-wrapper{padding:0 1em}','.mat-input-element{font:inherit;background:rgba(0,0,0,0);color:currentColor;border:none;outline:none;padding:0;margin:0;width:100%;max-width:100%;vertical-align:bottom;text-align:inherit;box-sizing:content-box}.mat-input-element:-moz-ui-invalid{box-shadow:none}.mat-input-element,.mat-input-element::-webkit-search-cancel-button,.mat-input-element::-webkit-search-decoration,.mat-input-element::-webkit-search-results-button,.mat-input-element::-webkit-search-results-decoration{-webkit-appearance:none}.mat-input-element::-webkit-contacts-auto-fill-button,.mat-input-element::-webkit-caps-lock-indicator,.mat-input-element:not([type=password])::-webkit-credentials-auto-fill-button{visibility:hidden}.mat-input-element[type=date],.mat-input-element[type=datetime],.mat-input-element[type=datetime-local],.mat-input-element[type=month],.mat-input-element[type=week],.mat-input-element[type=time]{line-height:1}.mat-input-element[type=date]::after,.mat-input-element[type=datetime]::after,.mat-input-element[type=datetime-local]::after,.mat-input-element[type=month]::after,.mat-input-element[type=week]::after,.mat-input-element[type=time]::after{content:" ";white-space:pre;width:1px}.mat-input-element::-webkit-inner-spin-button,.mat-input-element::-webkit-calendar-picker-indicator,.mat-input-element::-webkit-clear-button{font-size:.75em}.mat-input-element::placeholder{-webkit-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element::-moz-placeholder{-webkit-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element::-webkit-input-placeholder{-webkit-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element:-ms-input-placeholder{-webkit-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-hide-placeholder .mat-input-element::placeholder{color:rgba(0,0,0,0) !important;-webkit-text-fill-color:rgba(0,0,0,0);transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element::-moz-placeholder{color:rgba(0,0,0,0) !important;-webkit-text-fill-color:rgba(0,0,0,0);transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::-moz-placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element::-webkit-input-placeholder{color:rgba(0,0,0,0) !important;-webkit-text-fill-color:rgba(0,0,0,0);transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::-webkit-input-placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element:-ms-input-placeholder{color:rgba(0,0,0,0) !important;-webkit-text-fill-color:rgba(0,0,0,0);transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element:-ms-input-placeholder{opacity:0}._mat-animation-noopable .mat-input-element::placeholder{transition:none}._mat-animation-noopable .mat-input-element::-moz-placeholder{transition:none}._mat-animation-noopable .mat-input-element::-webkit-input-placeholder{transition:none}._mat-animation-noopable .mat-input-element:-ms-input-placeholder{transition:none}textarea.mat-input-element{resize:vertical;overflow:auto}textarea.mat-input-element.cdk-textarea-autosize{resize:none}textarea.mat-input-element{padding:2px 0;margin:-2px 0}select.mat-input-element{-moz-appearance:none;-webkit-appearance:none;position:relative;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box;padding-top:1em;top:-1em;margin-bottom:-1em}select.mat-input-element::-moz-focus-inner{border:0}select.mat-input-element:not(:disabled){cursor:pointer}.mat-form-field-type-mat-native-select .mat-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;top:50%;right:0;margin-top:-2.5px;pointer-events:none}[dir=rtl] .mat-form-field-type-mat-native-select .mat-form-field-infix::after{right:auto;left:0}.mat-form-field-type-mat-native-select .mat-input-element{padding-right:15px}[dir=rtl] .mat-form-field-type-mat-native-select .mat-input-element{padding-right:0;padding-left:15px}.mat-form-field-type-mat-native-select .mat-form-field-label-wrapper{max-width:calc(100% - 10px)}.mat-form-field-type-mat-native-select.mat-form-field-appearance-outline .mat-form-field-infix::after{margin-top:-5px}.mat-form-field-type-mat-native-select.mat-form-field-appearance-fill .mat-form-field-infix::after{margin-top:-10px}',".mat-form-field-appearance-legacy .mat-form-field-label{transform:perspective(100px)}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon{width:1em}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon-button,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon-button{font:inherit;vertical-align:baseline}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon-button .mat-icon{font-size:inherit}.mat-form-field-appearance-legacy .mat-form-field-underline{height:1px}.cdk-high-contrast-active .mat-form-field-appearance-legacy .mat-form-field-underline{height:0;border-top:solid 1px}.mat-form-field-appearance-legacy .mat-form-field-ripple{top:0;height:2px;overflow:hidden}.cdk-high-contrast-active .mat-form-field-appearance-legacy .mat-form-field-ripple{height:0;border-top:solid 2px}.mat-form-field-appearance-legacy.mat-form-field-disabled .mat-form-field-underline{background-position:0;background-color:rgba(0,0,0,0)}.cdk-high-contrast-active .mat-form-field-appearance-legacy.mat-form-field-disabled .mat-form-field-underline{border-top-style:dotted;border-top-width:2px;border-top-color:GrayText}.mat-form-field-appearance-legacy.mat-form-field-invalid:not(.mat-focused) .mat-form-field-ripple{height:1px}",".mat-form-field-appearance-outline .mat-form-field-wrapper{margin:.25em 0}.mat-form-field-appearance-outline .mat-form-field-flex{padding:0 .75em 0 .75em;margin-top:-0.25em;position:relative}.mat-form-field-appearance-outline .mat-form-field-prefix,.mat-form-field-appearance-outline .mat-form-field-suffix{top:.25em}.mat-form-field-appearance-outline .mat-form-field-outline{display:flex;position:absolute;top:.25em;left:0;right:0;bottom:0;pointer-events:none}.mat-form-field-appearance-outline .mat-form-field-outline-start,.mat-form-field-appearance-outline .mat-form-field-outline-end{border:1px solid currentColor;min-width:5px}.mat-form-field-appearance-outline .mat-form-field-outline-start{border-radius:5px 0 0 5px;border-right-style:none}[dir=rtl] .mat-form-field-appearance-outline .mat-form-field-outline-start{border-right-style:solid;border-left-style:none;border-radius:0 5px 5px 0}.mat-form-field-appearance-outline .mat-form-field-outline-end{border-radius:0 5px 5px 0;border-left-style:none;flex-grow:1}[dir=rtl] .mat-form-field-appearance-outline .mat-form-field-outline-end{border-left-style:solid;border-right-style:none;border-radius:5px 0 0 5px}.mat-form-field-appearance-outline .mat-form-field-outline-gap{border-radius:.000001px;border:1px solid currentColor;border-left-style:none;border-right-style:none}.mat-form-field-appearance-outline.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-outline-gap{border-top-color:rgba(0,0,0,0)}.mat-form-field-appearance-outline .mat-form-field-outline-thick{opacity:0}.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-start,.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-end,.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-gap{border-width:2px}.mat-form-field-appearance-outline.mat-focused .mat-form-field-outline,.mat-form-field-appearance-outline.mat-form-field-invalid .mat-form-field-outline{opacity:0;transition:opacity 100ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-outline.mat-focused .mat-form-field-outline-thick,.mat-form-field-appearance-outline.mat-form-field-invalid .mat-form-field-outline-thick{opacity:1}.cdk-high-contrast-active .mat-form-field-appearance-outline.mat-focused .mat-form-field-outline-thick{border:3px dashed}.mat-form-field-appearance-outline:not(.mat-form-field-disabled) .mat-form-field-flex:hover .mat-form-field-outline{opacity:0;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-outline:not(.mat-form-field-disabled) .mat-form-field-flex:hover .mat-form-field-outline-thick{opacity:1}.mat-form-field-appearance-outline .mat-form-field-subscript-wrapper{padding:0 1em}.cdk-high-contrast-active .mat-form-field-appearance-outline.mat-form-field-disabled .mat-form-field-outline{color:GrayText}.mat-form-field-appearance-outline._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-outline,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-start,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-end,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-gap{transition:none}",".mat-form-field-appearance-standard .mat-form-field-flex{padding-top:.75em}.mat-form-field-appearance-standard .mat-form-field-underline{height:1px}.cdk-high-contrast-active .mat-form-field-appearance-standard .mat-form-field-underline{height:0;border-top:solid 1px}.mat-form-field-appearance-standard .mat-form-field-ripple{bottom:0;height:2px}.cdk-high-contrast-active .mat-form-field-appearance-standard .mat-form-field-ripple{height:0;border-top:solid 2px}.mat-form-field-appearance-standard.mat-form-field-disabled .mat-form-field-underline{background-position:0;background-color:rgba(0,0,0,0)}.cdk-high-contrast-active .mat-form-field-appearance-standard.mat-form-field-disabled .mat-form-field-underline{border-top-style:dotted;border-top-width:2px}.mat-form-field-appearance-standard:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{opacity:1;transform:none;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-standard._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{transition:none}"],encapsulation:2,data:{animation:[a5.transitionMessages]},changeDetection:0}),r})(),o3=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({imports:[sn,Mc,Fx,Mc]}),r})();const _5=new Ne("MAT_INPUT_VALUE_ACCESSOR"),g5=["button","checkbox","file","hidden","image","radio","range","reset","submit"];let E5=0;const y5=b4(class{constructor(r,e,t,a){this._defaultErrorStateMatcher=r,this._parentForm=e,this._parentFormGroup=t,this.ngControl=a,this.stateChanges=new fn}});let v5=(()=>{class r extends y5{constructor(t,a,l,u,f,g,v,b,D,L){super(g,u,f,l),this._elementRef=t,this._platform=a,this._autofillMonitor=b,this._formField=L,this._uid="mat-input-"+E5++,this.focused=!1,this.stateChanges=new fn,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(q=>ly().has(q)),this._iOSKeyupListener=q=>{const ie=q.target;!ie.value&&0===ie.selectionStart&&0===ie.selectionEnd&&(ie.setSelectionRange(1,1),ie.setSelectionRange(0,0))};const j=this._elementRef.nativeElement,G=j.nodeName.toLowerCase();this._inputValueAccessor=v||j,this._previousNativeValue=this.value,this.id=this.id,a.IOS&&D.runOutsideAngular(()=>{t.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._isServer=!this._platform.isBrowser,this._isNativeSelect="select"===G,this._isTextarea="textarea"===G,this._isInFormField=!!L,this._isNativeSelect&&(this.controlType=j.multiple?"mat-native-select-multiple":"mat-native-select")}get disabled(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled}set disabled(t){this._disabled=Sl(t),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(t){this._id=t||this._uid}get required(){return this._required??this.ngControl?.control?.hasValidator(dO.required)??!1}set required(t){this._required=Sl(t)}get type(){return this._type}set type(t){this._type=t||"text",this._validateType(),!this._isTextarea&&ly().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(t){t!==this.value&&(this._inputValueAccessor.value=t,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(t){this._readonly=Sl(t)}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(t=>{this.autofilled=t.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngDoCheck(){this.ngControl&&this.updateErrorState(),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(t){this._elementRef.nativeElement.focus(t)}_focusChanged(t){t!==this.focused&&(this.focused=t,this.stateChanges.next())}_onInput(){}_dirtyCheckPlaceholder(){const t=this._formField,a=t&&"legacy"===t.appearance&&!t._hasLabel?.()?null:this.placeholder;if(a!==this._previousPlaceholder){const l=this._elementRef.nativeElement;this._previousPlaceholder=a,a?l.setAttribute("placeholder",a):l.removeAttribute("placeholder")}}_dirtyCheckNativeValue(){const t=this._elementRef.nativeElement.value;this._previousNativeValue!==t&&(this._previousNativeValue=t,this.stateChanges.next())}_validateType(){g5.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let t=this._elementRef.nativeElement.validity;return t&&t.badInput}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}get shouldLabelFloat(){if(this._isNativeSelect){const t=this._elementRef.nativeElement,a=t.options[0];return this.focused||t.multiple||!this.empty||!!(t.selectedIndex>-1&&a&&a.label)}return this.focused||!this.empty}setDescribedByIds(t){t.length?this._elementRef.nativeElement.setAttribute("aria-describedby",t.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){const t=this._elementRef.nativeElement;return this._isNativeSelect&&(t.multiple||t.size>1)}}return r.\u0275fac=function(t){return new(t||r)(se(ci),se(jr),se(Br,10),se(ym,8),se(zd,8),se(GV),se(_5,10),se(F4),se(Ht),se(r3,8))},r.\u0275dir=Be({type:r,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-input-element","mat-form-field-autofill-control"],hostVars:12,hostBindings:function(t,a){1&t&&Xt("focus",function(){return a._focusChanged(!0)})("blur",function(){return a._focusChanged(!1)})("input",function(){return a._onInput()}),2&t&&(Vn("disabled",a.disabled)("required",a.required),tr("id",a.id)("data-placeholder",a.placeholder)("name",a.name||null)("readonly",a.readonly&&!a._isNativeSelect||null)("aria-invalid",a.empty&&a.required?null:a.errorState)("aria-required",a.required),In("mat-input-server",a._isServer)("mat-native-select-inline",a._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["matInput"],features:[Mn([{provide:Jx,useExisting:r}]),Ft,Lo]}),r})(),S5=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({providers:[GV],imports:[$V,o3,Mc,$V,o3]}),r})();const C5=["input"],b5=function(r){return{enterDuration:r}},T5=["*"],I5=new Ne("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1})});let R5=0;const w5={provide:lo,useExisting:Un(()=>s3),multi:!0};class A5{constructor(e,t){this.source=e,this.checked=t}}const D5=C4(Wx(HV(jV(class{constructor(r){this._elementRef=r}}))));let O5=(()=>{class r extends D5{constructor(t,a,l,u,f,g,v){super(t),this._focusMonitor=a,this._changeDetectorRef=l,this.defaults=f,this._onChange=b=>{},this._onTouched=()=>{},this._required=!1,this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.change=new un,this.toggleChange=new un,this.tabIndex=parseInt(u)||0,this.color=this.defaultColor=f.color||"accent",this._noopAnimations="NoopAnimations"===g,this.id=this._uniqueId=`${v}${++R5}`}get required(){return this._required}set required(t){this._required=Sl(t)}get checked(){return this._checked}set checked(t){this._checked=Sl(t),this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{"keyboard"===t||"program"===t?this._focused=!0:t||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(t){this.checked=!!t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}}return r.\u0275fac=function(t){Bp()},r.\u0275dir=Be({type:r,inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],required:"required",checked:"checked"},outputs:{change:"change",toggleChange:"toggleChange"},features:[Ft]}),r})(),s3=(()=>{class r extends O5{constructor(t,a,l,u,f,g){super(t,a,l,u,f,g,"mat-slide-toggle-")}_createChangeEvent(t){return new A5(this,t)}_onChangeEvent(t){t.stopPropagation(),this.toggleChange.emit(),this.defaults.disableToggleValue?this._inputElement.nativeElement.checked=this.checked:(this.checked=this._inputElement.nativeElement.checked,this._emitChangeEvent())}_onInputClick(t){t.stopPropagation()}focus(t,a){a?this._focusMonitor.focusVia(this._inputElement,a,t):this._inputElement.nativeElement.focus(t)}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}}return r.\u0275fac=function(t){return new(t||r)(se(ci),se(jx),se(nn),gu("tabindex"),se(I5),se($n,8))},r.\u0275cmp=qr({type:r,selectors:[["mat-slide-toggle"]],viewQuery:function(t,a){if(1&t&&Ec(C5,5),2&t){let l;sr(l=Xi())&&(a._inputElement=l.first)}},hostAttrs:[1,"mat-slide-toggle"],hostVars:13,hostBindings:function(t,a){2&t&&(Vn("id",a.id),tr("tabindex",null)("aria-label",null)("aria-labelledby",null)("name",null),In("mat-checked",a.checked)("mat-disabled",a.disabled)("mat-slide-toggle-label-before","before"==a.labelPosition)("_mat-animation-noopable",a._noopAnimations))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color",tabIndex:"tabIndex"},exportAs:["matSlideToggle"],features:[Mn([w5]),Ft],ngContentSelectors:T5,decls:14,vars:20,consts:[[1,"mat-slide-toggle-label"],["label",""],[1,"mat-slide-toggle-bar"],["type","checkbox","role","switch",1,"mat-slide-toggle-input","cdk-visually-hidden",3,"id","required","tabIndex","checked","disabled","change","click"],["input",""],[1,"mat-slide-toggle-thumb-container"],[1,"mat-slide-toggle-thumb"],["mat-ripple","",1,"mat-slide-toggle-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered","matRippleRadius","matRippleAnimation"],[1,"mat-ripple-element","mat-slide-toggle-persistent-ripple"],[1,"mat-slide-toggle-content",3,"cdkObserveContent"],["labelContent",""],[2,"display","none"]],template:function(t,a){if(1&t&&(hc(),De(0,"label",0,1)(2,"span",2)(3,"input",3,4),Xt("change",function(u){return a._onChangeEvent(u)})("click",function(u){return a._onInputClick(u)}),Ge(),De(5,"span",5),tn(6,"span",6),De(7,"span",7),tn(8,"span",8),Ge()()(),De(9,"span",9,10),Xt("cdkObserveContent",function(){return a._onLabelTextChange()}),De(11,"span",11),$i(12,"\xa0"),Ge(),Mr(13),Ge()()),2&t){const l=ef(1),u=ef(10);tr("for",a.inputId),Xe(2),In("mat-slide-toggle-bar-no-side-margin",!u.textContent||!u.textContent.trim()),Xe(1),Ze("id",a.inputId)("required",a.required)("tabIndex",a.tabIndex)("checked",a.checked)("disabled",a.disabled),tr("name",a.name)("aria-checked",a.checked)("aria-label",a.ariaLabel)("aria-labelledby",a.ariaLabelledby)("aria-describedby",a.ariaDescribedby),Xe(4),Ze("matRippleTrigger",l)("matRippleDisabled",a.disableRipple||a.disabled)("matRippleCentered",!0)("matRippleRadius",20)("matRippleAnimation",function mA(r,e,t,a){return yA(fe(),Xr(),r,e,t,a)}(18,b5,a._noopAnimations?0:150))}},dependencies:[Kx,bV],styles:['.mat-slide-toggle{display:inline-block;height:24px;max-width:100%;line-height:24px;white-space:nowrap;outline:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container{transform:translate3d(16px, 0, 0)}[dir=rtl] .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container{transform:translate3d(-16px, 0, 0)}.mat-slide-toggle.mat-disabled{opacity:.38}.mat-slide-toggle.mat-disabled .mat-slide-toggle-label,.mat-slide-toggle.mat-disabled .mat-slide-toggle-thumb-container{cursor:default}.mat-slide-toggle-label{-webkit-user-select:none;user-select:none;display:flex;flex:1;flex-direction:row;align-items:center;height:inherit;cursor:pointer}.mat-slide-toggle-content{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-slide-toggle-label-before .mat-slide-toggle-label{order:1}.mat-slide-toggle-label-before .mat-slide-toggle-bar{order:2}[dir=rtl] .mat-slide-toggle-label-before .mat-slide-toggle-bar,.mat-slide-toggle-bar{margin-right:8px;margin-left:0}[dir=rtl] .mat-slide-toggle-bar,.mat-slide-toggle-label-before .mat-slide-toggle-bar{margin-left:8px;margin-right:0}.mat-slide-toggle-bar-no-side-margin{margin-left:0;margin-right:0}.mat-slide-toggle-thumb-container{position:absolute;z-index:1;width:20px;height:20px;top:-3px;left:0;transform:translate3d(0, 0, 0);transition:all 80ms linear;transition-property:transform}._mat-animation-noopable .mat-slide-toggle-thumb-container{transition:none}[dir=rtl] .mat-slide-toggle-thumb-container{left:auto;right:0}.mat-slide-toggle-thumb{height:20px;width:20px;border-radius:50%;display:block}.mat-slide-toggle-bar{position:relative;width:36px;height:14px;flex-shrink:0;border-radius:8px}.mat-slide-toggle-input{bottom:0;left:10px}[dir=rtl] .mat-slide-toggle-input{left:auto;right:10px}.mat-slide-toggle-bar,.mat-slide-toggle-thumb{transition:all 80ms linear;transition-property:background-color;transition-delay:50ms}._mat-animation-noopable .mat-slide-toggle-bar,._mat-animation-noopable .mat-slide-toggle-thumb{transition:none}.mat-slide-toggle .mat-slide-toggle-ripple{position:absolute;top:calc(50% - 20px);left:calc(50% - 20px);height:40px;width:40px;z-index:1;pointer-events:none}.mat-slide-toggle .mat-slide-toggle-ripple .mat-ripple-element:not(.mat-slide-toggle-persistent-ripple){opacity:.12}.mat-slide-toggle-persistent-ripple{width:100%;height:100%;transform:none}.mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{opacity:.04}.mat-slide-toggle:not(.mat-disabled).cdk-keyboard-focused .mat-slide-toggle-persistent-ripple{opacity:.12}.mat-slide-toggle-persistent-ripple,.mat-slide-toggle.mat-disabled .mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{opacity:0}@media(hover: none){.mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{display:none}}.mat-slide-toggle-input:focus~.mat-slide-toggle-thumb-container .mat-focus-indicator::before{content:""}.cdk-high-contrast-active .mat-slide-toggle-thumb,.cdk-high-contrast-active .mat-slide-toggle-bar{border:1px solid}'],encapsulation:2,changeDetection:0}),r})(),a3=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({}),r})(),M5=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({imports:[a3,qV,Mc,Fx,a3,Mc]}),r})();new class L5 extends Cl{flush(e){this.active=!0,this.scheduled=void 0;const{actions:t}=this;let a,l=-1,u=t.length;e=e||t.shift();do{if(a=e.execute(e.state,e.delay))break}while(++l<u&&(e=t.shift()));if(this.active=!1,a){for(;++l<u&&(e=t.shift());)e.unsubscribe();throw a}}}(class k5 extends xx{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}requestAsyncId(e,t,a=0){return null!==a&&a>0?super.requestAsyncId(e,t,a):(e.actions.push(this),e.scheduled||(e.scheduled=requestAnimationFrame(()=>e.flush(null))))}recycleAsyncId(e,t,a=0){if(null!==a&&a>0||null===a&&this.delay>0)return super.recycleAsyncId(e,t,a);0===e.actions.length&&(cancelAnimationFrame(t),e.scheduled=void 0)}});let F5=1;const U5=Promise.resolve(),UO={};function c3(r){return r in UO&&(delete UO[r],!0)}const l3={setImmediate(r){const e=F5++;return UO[e]=!0,U5.then(()=>c3(e)&&r()),e},clearImmediate(r){c3(r)}};new class B5 extends Cl{flush(e){this.active=!0,this.scheduled=void 0;const{actions:t}=this;let a,l=-1,u=t.length;e=e||t.shift();do{if(a=e.execute(e.state,e.delay))break}while(++l<u&&(e=t.shift()));if(this.active=!1,a){for(;++l<u&&(e=t.shift());)e.unsubscribe();throw a}}}(class V5 extends xx{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}requestAsyncId(e,t,a=0){return null!==a&&a>0?super.requestAsyncId(e,t,a):(e.actions.push(this),e.scheduled||(e.scheduled=l3.setImmediate(e.flush.bind(e,null))))}recycleAsyncId(e,t,a=0){if(null!==a&&a>0||null===a&&this.delay>0)return super.recycleAsyncId(e,t,a);0===e.actions.length&&(l3.clearImmediate(t),e.scheduled=void 0)}});class G5{constructor(e){this.durationSelector=e}call(e,t){return t.subscribe(new W5(e,this.durationSelector))}}class W5 extends Qh{constructor(e,t){super(e),this.durationSelector=t,this.hasValue=!1}_next(e){if(this.value=e,this.hasValue=!0,!this.throttled){let t;try{const{durationSelector:l}=this;t=l(e)}catch(l){return this.destination.error(l)}const a=Dl(t,new su(this));!a||a.closed?this.clearThrottle():this.add(this.throttled=a)}}clearThrottle(){const{value:e,hasValue:t,throttled:a}=this;a&&(this.remove(a),this.throttled=void 0,a.unsubscribe()),t&&(this.value=void 0,this.hasValue=!1,this.destination.next(e))}notifyNext(){this.clearThrottle()}notifyComplete(){this.clearThrottle()}}function Zx(r){return!ur(r)&&r-parseFloat(r)+1>=0}function d3(r=0,e,t){let a=-1;return Zx(e)?a=Number(e)<1?1:Number(e):Al(e)&&(t=e),Al(t)||(t=dy),new An(l=>{const u=Zx(r)?r:+r-t.now();return t.schedule(z5,u,{index:0,period:a,subscriber:l})})}function z5(r){const{index:e,period:t,subscriber:a}=r;if(a.next(e),!a.closed){if(-1===t)return a.complete();r.index=e+1,this.schedule(r,t)}}function u3(r,e=dy){return function H5(r){return function(t){return t.lift(new G5(r))}}(()=>d3(r,e))}function bl(r,e){return function(a){return a.lift(new K5(r,e))}}class K5{constructor(e,t){this.predicate=e,this.thisArg=t}call(e,t){return t.subscribe(new q5(e,this.predicate,this.thisArg))}}class q5 extends bn{constructor(e,t,a){super(e),this.predicate=t,this.thisArg=a,this.count=0}_next(e){let t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(a){return void this.destination.error(a)}t&&this.destination.next(e)}}let h3=(()=>{class r{constructor(t,a,l){this._ngZone=t,this._platform=a,this._scrolled=new fn,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=l}register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){const a=this.scrollContainers.get(t);a&&(a.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=20){return this._platform.isBrowser?new An(a=>{this._globalSubscription||this._addGlobalListener();const l=t>0?this._scrolled.pipe(u3(t)).subscribe(a):this._scrolled.subscribe(a);return this._scrolledCount++,()=>{l.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):S()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((t,a)=>this.deregister(a)),this._scrolled.complete()}ancestorScrolled(t,a){const l=this.getAncestorScrollContainers(t);return this.scrolled(a).pipe(bl(u=>!u||l.indexOf(u)>-1))}getAncestorScrollContainers(t){const a=[];return this.scrollContainers.forEach((l,u)=>{this._scrollableContainsElement(u,t)&&a.push(u)}),a}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(t,a){let l=Jd(a),u=t.getElementRef().nativeElement;do{if(l==u)return!0}while(l=l.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>qx(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return r.\u0275fac=function(t){return new(t||r)(he(Ht),he(jr),he(rn,8))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),p3=(()=>{class r{constructor(t,a,l){this._platform=t,this._change=new fn,this._changeListener=u=>{this._change.next(u)},this._document=l,a.runOutsideAngular(()=>{if(t.isBrowser){const u=this._getWindow();u.addEventListener("resize",this._changeListener),u.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const t=this._getWindow();t.removeEventListener("resize",this._changeListener),t.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){const t=this.getViewportScrollPosition(),{width:a,height:l}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+l,right:t.left+a,height:l,width:a}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const t=this._document,a=this._getWindow(),l=t.documentElement,u=l.getBoundingClientRect();return{top:-u.top||t.body.scrollTop||a.scrollY||l.scrollTop||0,left:-u.left||t.body.scrollLeft||a.scrollX||l.scrollLeft||0}}change(t=20){return t>0?this._change.pipe(u3(t)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const t=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:t.innerWidth,height:t.innerHeight}:{width:0,height:0}}}return r.\u0275fac=function(t){return new(t||r)(he(jr),he(Ht),he(rn,8))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),e2=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({}),r})(),f3=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({imports:[TT,e2,TT,e2]}),r})();class t2{attach(e){return this._attachedHost=e,e.attach(this)}detach(){let e=this._attachedHost;null!=e&&(this._attachedHost=null,e.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(e){this._attachedHost=e}}class m3 extends t2{constructor(e,t,a,l){super(),this.component=e,this.viewContainerRef=t,this.injector=a,this.componentFactoryResolver=l}}class X5 extends t2{constructor(e,t,a,l){super(),this.templateRef=e,this.viewContainerRef=t,this.context=a,this.injector=l}get origin(){return this.templateRef.elementRef}attach(e,t=this.context){return this.context=t,super.attach(e)}detach(){return this.context=void 0,super.detach()}}class J5 extends t2{constructor(e){super(),this.element=e instanceof ci?e.nativeElement:e}}class Z5 extends class Q5{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(e){return e instanceof m3?(this._attachedPortal=e,this.attachComponentPortal(e)):e instanceof X5?(this._attachedPortal=e,this.attachTemplatePortal(e)):this.attachDomPortal&&e instanceof J5?(this._attachedPortal=e,this.attachDomPortal(e)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(e){this._disposeFn=e}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}{constructor(e,t,a,l,u){super(),this.outletElement=e,this._componentFactoryResolver=t,this._appRef=a,this._defaultInjector=l,this.attachDomPortal=f=>{const g=f.element,v=this._document.createComment("dom-portal");g.parentNode.insertBefore(v,g),this.outletElement.appendChild(g),this._attachedPortal=f,super.setDisposeFn(()=>{v.parentNode&&v.parentNode.replaceChild(g,v)})},this._document=u}attachComponentPortal(e){const a=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component);let l;return e.viewContainerRef?(l=e.viewContainerRef.createComponent(a,e.viewContainerRef.length,e.injector||e.viewContainerRef.injector),this.setDisposeFn(()=>l.destroy())):(l=a.create(e.injector||this._defaultInjector||Nr.NULL),this._appRef.attachView(l.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(l.hostView),l.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(l)),this._attachedPortal=e,l}attachTemplatePortal(e){let t=e.viewContainerRef,a=t.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return a.rootNodes.forEach(l=>this.outletElement.appendChild(l)),a.detectChanges(),this.setDisposeFn(()=>{let l=t.indexOf(a);-1!==l&&t.remove(l)}),this._attachedPortal=e,a}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(e){return e.hostView.rootNodes[0]}}let e6=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({}),r})();const _3=s();class t6{constructor(e,t){this._viewportRuler=e,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=t}attach(){}enable(){if(this._canBeEnabled()){const e=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=e.style.left||"",this._previousHTMLStyles.top=e.style.top||"",e.style.left=dr(-this._previousScrollPosition.left),e.style.top=dr(-this._previousScrollPosition.top),e.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const e=this._document.documentElement,a=e.style,l=this._document.body.style,u=a.scrollBehavior||"",f=l.scrollBehavior||"";this._isEnabled=!1,a.left=this._previousHTMLStyles.left,a.top=this._previousHTMLStyles.top,e.classList.remove("cdk-global-scrollblock"),_3&&(a.scrollBehavior=l.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),_3&&(a.scrollBehavior=u,l.scrollBehavior=f)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const t=this._document.body,a=this._viewportRuler.getViewportSize();return t.scrollHeight>a.height||t.scrollWidth>a.width}}class n6{constructor(e,t,a,l){this._scrollDispatcher=e,this._ngZone=t,this._viewportRuler=a,this._config=l,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(e){this._overlayRef=e}enable(){if(this._scrollSubscription)return;const e=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=e.subscribe(()=>{const t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=e.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class g3{enable(){}disable(){}attach(){}}function n2(r,e){return e.some(t=>r.bottom<t.top||r.top>t.bottom||r.right<t.left||r.left>t.right)}function E3(r,e){return e.some(t=>r.top<t.top||r.bottom>t.bottom||r.left<t.left||r.right>t.right)}class i6{constructor(e,t,a,l){this._scrollDispatcher=e,this._viewportRuler=t,this._ngZone=a,this._config=l,this._scrollSubscription=null}attach(e){this._overlayRef=e}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:a,height:l}=this._viewportRuler.getViewportSize();n2(t,[{width:a,height:l,bottom:l,right:a,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let r6=(()=>{class r{constructor(t,a,l,u){this._scrollDispatcher=t,this._viewportRuler=a,this._ngZone=l,this.noop=()=>new g3,this.close=f=>new n6(this._scrollDispatcher,this._ngZone,this._viewportRuler,f),this.block=()=>new t6(this._viewportRuler,this._document),this.reposition=f=>new i6(this._scrollDispatcher,this._viewportRuler,this._ngZone,f),this._document=u}}return r.\u0275fac=function(t){return new(t||r)(he(h3),he(p3),he(Ht),he(rn))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();class o6{constructor(e){if(this.scrollStrategy=new g3,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,e){const t=Object.keys(e);for(const a of t)void 0!==e[a]&&(this[a]=e[a])}}}class s6{constructor(e,t){this.connectionPair=e,this.scrollableViewProperties=t}}let y3=(()=>{class r{constructor(t){this._attachedOverlays=[],this._document=t}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){const a=this._attachedOverlays.indexOf(t);a>-1&&this._attachedOverlays.splice(a,1),0===this._attachedOverlays.length&&this.detach()}}return r.\u0275fac=function(t){return new(t||r)(he(rn))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),a6=(()=>{class r extends y3{constructor(t,a){super(t),this._ngZone=a,this._keydownListener=l=>{const u=this._attachedOverlays;for(let f=u.length-1;f>-1;f--)if(u[f]._keydownEvents.observers.length>0){const g=u[f]._keydownEvents;this._ngZone?this._ngZone.run(()=>g.next(l)):g.next(l);break}}}add(t){super.add(t),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return r.\u0275fac=function(t){return new(t||r)(he(rn),he(Ht,8))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),c6=(()=>{class r extends y3{constructor(t,a,l){super(t),this._platform=a,this._ngZone=l,this._cursorStyleIsSet=!1,this._pointerDownListener=u=>{this._pointerDownEventTarget=_(u)},this._clickListener=u=>{const f=_(u),g="click"===u.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:f;this._pointerDownEventTarget=null;const v=this._attachedOverlays.slice();for(let b=v.length-1;b>-1;b--){const D=v[b];if(D._outsidePointerEvents.observers.length<1||!D.hasAttached())continue;if(D.overlayElement.contains(f)||D.overlayElement.contains(g))break;const L=D._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>L.next(u)):L.next(u)}}}add(t){if(super.add(t),!this._isAttached){const a=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(a)):this._addEventListeners(a),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=a.style.cursor,a.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const t=this._document.body;t.removeEventListener("pointerdown",this._pointerDownListener,!0),t.removeEventListener("click",this._clickListener,!0),t.removeEventListener("auxclick",this._clickListener,!0),t.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(t.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(t){t.addEventListener("pointerdown",this._pointerDownListener,!0),t.addEventListener("click",this._clickListener,!0),t.addEventListener("auxclick",this._clickListener,!0),t.addEventListener("contextmenu",this._clickListener,!0)}}return r.\u0275fac=function(t){return new(t||r)(he(rn),he(jr),he(Ht,8))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),v3=(()=>{class r{constructor(t,a){this._platform=a,this._document=t}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t="cdk-overlay-container";if(this._platform.isBrowser||E()){const l=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let u=0;u<l.length;u++)l[u].remove()}const a=this._document.createElement("div");a.classList.add(t),E()?a.setAttribute("platform","test"):this._platform.isBrowser||a.setAttribute("platform","server"),this._document.body.appendChild(a),this._containerElement=a}}return r.\u0275fac=function(t){return new(t||r)(he(rn),he(jr))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();class l6{constructor(e,t,a,l,u,f,g,v,b,D=!1){this._portalOutlet=e,this._host=t,this._pane=a,this._config=l,this._ngZone=u,this._keyboardDispatcher=f,this._document=g,this._location=v,this._outsideClickDispatcher=b,this._animationsDisabled=D,this._backdropElement=null,this._backdropClick=new fn,this._attachments=new fn,this._detachments=new fn,this._locationChanges=Cn.EMPTY,this._backdropClickHandler=L=>this._backdropClick.next(L),this._backdropTransitionendHandler=L=>{this._disposeBackdrop(L.target)},this._keydownEvents=new fn,this._outsidePointerEvents=new fn,l.scrollStrategy&&(this._scrollStrategy=l.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=l.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(e){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const t=this._portalOutlet.attach(e);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(ho(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof t?.onDestroy&&t.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const e=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),e}dispose(){const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(e){e!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=e,this.hasAttached()&&(e.attach(this),this.updatePosition()))}updateSize(e){this._config={...this._config,...e},this._updateElementSize()}setDirection(e){this._config={...this._config,direction:e},this._updateElementDirection()}addPanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!0)}removePanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!1)}getDirection(){const e=this._config.direction;return e?"string"==typeof e?e:e.value:"ltr"}updateScrollStrategy(e){e!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=e,this.hasAttached()&&(e.attach(this),e.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const e=this._pane.style;e.width=dr(this._config.width),e.height=dr(this._config.height),e.minWidth=dr(this._config.minWidth),e.minHeight=dr(this._config.minHeight),e.maxWidth=dr(this._config.maxWidth),e.maxHeight=dr(this._config.maxHeight)}_togglePointerEvents(e){this._pane.style.pointerEvents=e?"":"none"}_attachBackdrop(){const e="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(e)})}):this._backdropElement.classList.add(e)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const e=this._backdropElement;if(e){if(this._animationsDisabled)return void this._disposeBackdrop(e);e.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{e.addEventListener("transitionend",this._backdropTransitionendHandler)}),e.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(e)},500))}}_toggleClasses(e,t,a){const l=PO(t||[]).filter(u=>!!u);l.length&&(a?e.classList.add(...l):e.classList.remove(...l))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const e=this._ngZone.onStable.pipe(bs(Ly(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),e.unsubscribe())})})}_disposeScrollStrategy(){const e=this._scrollStrategy;e&&(e.disable(),e.detach&&e.detach())}_disposeBackdrop(e){e&&(e.removeEventListener("click",this._backdropClickHandler),e.removeEventListener("transitionend",this._backdropTransitionendHandler),e.remove(),this._backdropElement===e&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const S3="cdk-overlay-connected-position-bounding-box",d6=/([A-Za-z%]+)$/;class u6{constructor(e,t,a,l,u){this._viewportRuler=t,this._document=a,this._platform=l,this._overlayContainer=u,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new fn,this._resizeSubscription=Cn.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(e)}get positions(){return this._preferredPositions}attach(e){this._validatePositions(),e.hostElement.classList.add(S3),this._overlayRef=e,this._boundingBox=e.hostElement,this._pane=e.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._originRect,t=this._overlayRect,a=this._viewportRect,l=this._containerRect,u=[];let f;for(let g of this._preferredPositions){let v=this._getOriginPoint(e,l,g),b=this._getOverlayPoint(v,t,g),D=this._getOverlayFit(b,t,a,g);if(D.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(g,v);this._canFitWithFlexibleDimensions(D,b,a)?u.push({position:g,origin:v,overlayRect:t,boundingBoxRect:this._calculateBoundingBoxRect(v,g)}):(!f||f.overlayFit.visibleArea<D.visibleArea)&&(f={overlayFit:D,overlayPoint:b,originPoint:v,position:g,overlayRect:t})}if(u.length){let g=null,v=-1;for(const b of u){const D=b.boundingBoxRect.width*b.boundingBoxRect.height*(b.position.weight||1);D>v&&(v=D,g=b)}return this._isPushed=!1,void this._applyPosition(g.position,g.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(f.position,f.originPoint);this._applyPosition(f.position,f.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Im(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(S3),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const e=this._lastPosition;if(e){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._getOriginPoint(this._originRect,this._containerRect,e);this._applyPosition(e,t)}else this.apply()}withScrollableContainers(e){return this._scrollables=e,this}withPositions(e){return this._preferredPositions=e,-1===e.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(e){return this._viewportMargin=e,this}withFlexibleDimensions(e=!0){return this._hasFlexibleDimensions=e,this}withGrowAfterOpen(e=!0){return this._growAfterOpen=e,this}withPush(e=!0){return this._canPush=e,this}withLockedPosition(e=!0){return this._positionLocked=e,this}setOrigin(e){return this._origin=e,this}withDefaultOffsetX(e){return this._offsetX=e,this}withDefaultOffsetY(e){return this._offsetY=e,this}withTransformOriginOn(e){return this._transformOriginSelector=e,this}_getOriginPoint(e,t,a){let l,u;if("center"==a.originX)l=e.left+e.width/2;else{const f=this._isRtl()?e.right:e.left,g=this._isRtl()?e.left:e.right;l="start"==a.originX?f:g}return t.left<0&&(l-=t.left),u="center"==a.originY?e.top+e.height/2:"top"==a.originY?e.top:e.bottom,t.top<0&&(u-=t.top),{x:l,y:u}}_getOverlayPoint(e,t,a){let l,u;return l="center"==a.overlayX?-t.width/2:"start"===a.overlayX?this._isRtl()?-t.width:0:this._isRtl()?0:-t.width,u="center"==a.overlayY?-t.height/2:"top"==a.overlayY?0:-t.height,{x:e.x+l,y:e.y+u}}_getOverlayFit(e,t,a,l){const u=b3(t);let{x:f,y:g}=e,v=this._getOffset(l,"x"),b=this._getOffset(l,"y");v&&(f+=v),b&&(g+=b);let j=0-g,G=g+u.height-a.height,q=this._subtractOverflows(u.width,0-f,f+u.width-a.width),ie=this._subtractOverflows(u.height,j,G),ce=q*ie;return{visibleArea:ce,isCompletelyWithinViewport:u.width*u.height===ce,fitsInViewportVertically:ie===u.height,fitsInViewportHorizontally:q==u.width}}_canFitWithFlexibleDimensions(e,t,a){if(this._hasFlexibleDimensions){const l=a.bottom-t.y,u=a.right-t.x,f=C3(this._overlayRef.getConfig().minHeight),g=C3(this._overlayRef.getConfig().minWidth),b=e.fitsInViewportHorizontally||null!=g&&g<=u;return(e.fitsInViewportVertically||null!=f&&f<=l)&&b}return!1}_pushOverlayOnScreen(e,t,a){if(this._previousPushAmount&&this._positionLocked)return{x:e.x+this._previousPushAmount.x,y:e.y+this._previousPushAmount.y};const l=b3(t),u=this._viewportRect,f=Math.max(e.x+l.width-u.width,0),g=Math.max(e.y+l.height-u.height,0),v=Math.max(u.top-a.top-e.y,0),b=Math.max(u.left-a.left-e.x,0);let D=0,L=0;return D=l.width<=u.width?b||-f:e.x<this._viewportMargin?u.left-a.left-e.x:0,L=l.height<=u.height?v||-g:e.y<this._viewportMargin?u.top-a.top-e.y:0,this._previousPushAmount={x:D,y:L},{x:e.x+D,y:e.y+L}}_applyPosition(e,t){if(this._setTransformOrigin(e),this._setOverlayElementStyles(t,e),this._setBoundingBoxStyles(t,e),e.panelClass&&this._addPanelClasses(e.panelClass),this._lastPosition=e,this._positionChanges.observers.length){const a=this._getScrollVisibility(),l=new s6(e,a);this._positionChanges.next(l)}this._isInitialRender=!1}_setTransformOrigin(e){if(!this._transformOriginSelector)return;const t=this._boundingBox.querySelectorAll(this._transformOriginSelector);let a,l=e.overlayY;a="center"===e.overlayX?"center":this._isRtl()?"start"===e.overlayX?"right":"left":"start"===e.overlayX?"left":"right";for(let u=0;u<t.length;u++)t[u].style.transformOrigin=`${a} ${l}`}_calculateBoundingBoxRect(e,t){const a=this._viewportRect,l=this._isRtl();let u,f,g,D,L,j;if("top"===t.overlayY)f=e.y,u=a.height-f+this._viewportMargin;else if("bottom"===t.overlayY)g=a.height-e.y+2*this._viewportMargin,u=a.height-g+this._viewportMargin;else{const G=Math.min(a.bottom-e.y+a.top,e.y),q=this._lastBoundingBoxSize.height;u=2*G,f=e.y-G,u>q&&!this._isInitialRender&&!this._growAfterOpen&&(f=e.y-q/2)}if("end"===t.overlayX&&!l||"start"===t.overlayX&&l)j=a.width-e.x+this._viewportMargin,D=e.x-this._viewportMargin;else if("start"===t.overlayX&&!l||"end"===t.overlayX&&l)L=e.x,D=a.right-e.x;else{const G=Math.min(a.right-e.x+a.left,e.x),q=this._lastBoundingBoxSize.width;D=2*G,L=e.x-G,D>q&&!this._isInitialRender&&!this._growAfterOpen&&(L=e.x-q/2)}return{top:f,left:L,bottom:g,right:j,width:D,height:u}}_setBoundingBoxStyles(e,t){const a=this._calculateBoundingBoxRect(e,t);!this._isInitialRender&&!this._growAfterOpen&&(a.height=Math.min(a.height,this._lastBoundingBoxSize.height),a.width=Math.min(a.width,this._lastBoundingBoxSize.width));const l={};if(this._hasExactPosition())l.top=l.left="0",l.bottom=l.right=l.maxHeight=l.maxWidth="",l.width=l.height="100%";else{const u=this._overlayRef.getConfig().maxHeight,f=this._overlayRef.getConfig().maxWidth;l.height=dr(a.height),l.top=dr(a.top),l.bottom=dr(a.bottom),l.width=dr(a.width),l.left=dr(a.left),l.right=dr(a.right),l.alignItems="center"===t.overlayX?"center":"end"===t.overlayX?"flex-end":"flex-start",l.justifyContent="center"===t.overlayY?"center":"bottom"===t.overlayY?"flex-end":"flex-start",u&&(l.maxHeight=dr(u)),f&&(l.maxWidth=dr(f))}this._lastBoundingBoxSize=a,Im(this._boundingBox.style,l)}_resetBoundingBoxStyles(){Im(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Im(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(e,t){const a={},l=this._hasExactPosition(),u=this._hasFlexibleDimensions,f=this._overlayRef.getConfig();if(l){const D=this._viewportRuler.getViewportScrollPosition();Im(a,this._getExactOverlayY(t,e,D)),Im(a,this._getExactOverlayX(t,e,D))}else a.position="static";let g="",v=this._getOffset(t,"x"),b=this._getOffset(t,"y");v&&(g+=`translateX(${v}px) `),b&&(g+=`translateY(${b}px)`),a.transform=g.trim(),f.maxHeight&&(l?a.maxHeight=dr(f.maxHeight):u&&(a.maxHeight="")),f.maxWidth&&(l?a.maxWidth=dr(f.maxWidth):u&&(a.maxWidth="")),Im(this._pane.style,a)}_getExactOverlayY(e,t,a){let l={top:"",bottom:""},u=this._getOverlayPoint(t,this._overlayRect,e);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,a)),"bottom"===e.overlayY?l.bottom=this._document.documentElement.clientHeight-(u.y+this._overlayRect.height)+"px":l.top=dr(u.y),l}_getExactOverlayX(e,t,a){let f,l={left:"",right:""},u=this._getOverlayPoint(t,this._overlayRect,e);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,a)),f=this._isRtl()?"end"===e.overlayX?"left":"right":"end"===e.overlayX?"right":"left","right"===f?l.right=this._document.documentElement.clientWidth-(u.x+this._overlayRect.width)+"px":l.left=dr(u.x),l}_getScrollVisibility(){const e=this._getOriginRect(),t=this._pane.getBoundingClientRect(),a=this._scrollables.map(l=>l.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:E3(e,a),isOriginOutsideView:n2(e,a),isOverlayClipped:E3(t,a),isOverlayOutsideView:n2(t,a)}}_subtractOverflows(e,...t){return t.reduce((a,l)=>a-Math.max(l,0),e)}_getNarrowedViewportRect(){const e=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,a=this._viewportRuler.getViewportScrollPosition();return{top:a.top+this._viewportMargin,left:a.left+this._viewportMargin,right:a.left+e-this._viewportMargin,bottom:a.top+t-this._viewportMargin,width:e-2*this._viewportMargin,height:t-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(e,t){return"x"===t?e.offsetX??this._offsetX:e.offsetY??this._offsetY}_validatePositions(){}_addPanelClasses(e){this._pane&&PO(e).forEach(t=>{""!==t&&-1===this._appliedPanelClasses.indexOf(t)&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(e=>{this._pane.classList.remove(e)}),this._appliedPanelClasses=[])}_getOriginRect(){const e=this._origin;if(e instanceof ci)return e.nativeElement.getBoundingClientRect();if(e instanceof Element)return e.getBoundingClientRect();const t=e.width||0,a=e.height||0;return{top:e.y,bottom:e.y+a,left:e.x,right:e.x+t,height:a,width:t}}}function Im(r,e){for(let t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r}function C3(r){if("number"!=typeof r&&null!=r){const[e,t]=r.split(d6);return t&&"px"!==t?null:parseFloat(e)}return r||null}function b3(r){return{top:Math.floor(r.top),right:Math.floor(r.right),bottom:Math.floor(r.bottom),left:Math.floor(r.left),width:Math.floor(r.width),height:Math.floor(r.height)}}const T3="cdk-global-overlay-wrapper";class h6{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(e){const t=e.getConfig();this._overlayRef=e,this._width&&!t.width&&e.updateSize({width:this._width}),this._height&&!t.height&&e.updateSize({height:this._height}),e.hostElement.classList.add(T3),this._isDisposed=!1}top(e=""){return this._bottomOffset="",this._topOffset=e,this._alignItems="flex-start",this}left(e=""){return this._xOffset=e,this._xPosition="left",this}bottom(e=""){return this._topOffset="",this._bottomOffset=e,this._alignItems="flex-end",this}right(e=""){return this._xOffset=e,this._xPosition="right",this}start(e=""){return this._xOffset=e,this._xPosition="start",this}end(e=""){return this._xOffset=e,this._xPosition="end",this}width(e=""){return this._overlayRef?this._overlayRef.updateSize({width:e}):this._width=e,this}height(e=""){return this._overlayRef?this._overlayRef.updateSize({height:e}):this._height=e,this}centerHorizontally(e=""){return this.left(e),this._xPosition="center",this}centerVertically(e=""){return this.top(e),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,a=this._overlayRef.getConfig(),{width:l,height:u,maxWidth:f,maxHeight:g}=a,v=!("100%"!==l&&"100vw"!==l||f&&"100%"!==f&&"100vw"!==f),b=!("100%"!==u&&"100vh"!==u||g&&"100%"!==g&&"100vh"!==g),D=this._xPosition,L=this._xOffset,j="rtl"===this._overlayRef.getConfig().direction;let G="",q="",ie="";v?ie="flex-start":"center"===D?(ie="center",j?q=L:G=L):j?"left"===D||"end"===D?(ie="flex-end",G=L):("right"===D||"start"===D)&&(ie="flex-start",q=L):"left"===D||"start"===D?(ie="flex-start",G=L):("right"===D||"end"===D)&&(ie="flex-end",q=L),e.position=this._cssPosition,e.marginLeft=v?"0":G,e.marginTop=b?"0":this._topOffset,e.marginBottom=this._bottomOffset,e.marginRight=v?"0":q,t.justifyContent=ie,t.alignItems=b?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,a=t.style;t.classList.remove(T3),a.justifyContent=a.alignItems=e.marginTop=e.marginBottom=e.marginLeft=e.marginRight=e.position="",this._overlayRef=null,this._isDisposed=!0}}let p6=(()=>{class r{constructor(t,a,l,u){this._viewportRuler=t,this._document=a,this._platform=l,this._overlayContainer=u}global(){return new h6}flexibleConnectedTo(t){return new u6(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return r.\u0275fac=function(t){return new(t||r)(he(p3),he(rn),he(jr),he(v3))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),f6=0,VO=(()=>{class r{constructor(t,a,l,u,f,g,v,b,D,L,j,G){this.scrollStrategies=t,this._overlayContainer=a,this._componentFactoryResolver=l,this._positionBuilder=u,this._keyboardDispatcher=f,this._injector=g,this._ngZone=v,this._document=b,this._directionality=D,this._location=L,this._outsideClickDispatcher=j,this._animationsModuleType=G}create(t){const a=this._createHostElement(),l=this._createPaneElement(a),u=this._createPortalOutlet(l),f=new o6(t);return f.direction=f.direction||this._directionality.value,new l6(u,a,l,f,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(t){const a=this._document.createElement("div");return a.id="cdk-overlay-"+f6++,a.classList.add("cdk-overlay-pane"),t.appendChild(a),a}_createHostElement(){const t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(bd)),new Z5(t,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return r.\u0275fac=function(t){return new(t||r)(he(r6),he(v3),he(td),he(p6),he(a6),he(Nr),he(Ht),he(rn),he(Gx),he(_r),he(c6),he($n,8))},r.\u0275prov=ke({token:r,factory:r.\u0275fac}),r})();const g6={provide:new Ne("cdk-connected-overlay-scroll-strategy"),deps:[VO],useFactory:function _6(r){return()=>r.scrollStrategies.reposition()}};let E6=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({providers:[VO,g6],imports:[TT,e6,f3,f3]}),r})();const y6=["tooltip"],I3="tooltip-panel",R3=o({passive:!0}),w3=new Ne("mat-tooltip-scroll-strategy"),b6={provide:w3,deps:[VO],useFactory:function C6(r){return()=>r.scrollStrategies.reposition({scrollThrottle:20})}},T6=new Ne("mat-tooltip-default-options",{providedIn:"root",factory:function I6(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}});let R6=(()=>{class r{constructor(t,a,l,u,f,g,v,b,D,L,j,G){this._overlay=t,this._elementRef=a,this._scrollDispatcher=l,this._viewContainerRef=u,this._ngZone=f,this._platform=g,this._ariaDescriber=v,this._focusMonitor=b,this._dir=L,this._defaultOptions=j,this._position="below",this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="mat",this._showDelay=this._defaultOptions.showDelay,this._hideDelay=this._defaultOptions.hideDelay,this.touchGestures="auto",this._message="",this._passiveListeners=[],this._destroyed=new fn,this._scrollStrategy=D,this._document=G,j&&(j.position&&(this.position=j.position),j.touchGestures&&(this.touchGestures=j.touchGestures)),L.change.pipe(bs(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)})}get position(){return this._position}set position(t){t!==this._position&&(this._position=t,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get disabled(){return this._disabled}set disabled(t){this._disabled=Sl(t),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(t){this._showDelay=NO(t)}get hideDelay(){return this._hideDelay}set hideDelay(t){this._hideDelay=NO(t),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(t){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=null!=t?String(t).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(t){this._tooltipClass=t,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(bs(this._destroyed)).subscribe(t=>{t?"keyboard"===t&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const t=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([a,l])=>{t.removeEventListener(a,l,R3)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(t,this.message,"tooltip"),this._focusMonitor.stopMonitoring(t)}show(t=this.showDelay){if(this.disabled||!this.message||this._isTooltipVisible())return void this._tooltipInstance?._cancelPendingAnimations();const a=this._createOverlay();this._detach(),this._portal=this._portal||new m3(this._tooltipComponent,this._viewContainerRef);const l=this._tooltipInstance=a.attach(this._portal).instance;l._triggerElement=this._elementRef.nativeElement,l._mouseLeaveHideDelay=this._hideDelay,l.afterHidden().pipe(bs(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),l.show(t)}hide(t=this.hideDelay){const a=this._tooltipInstance;a&&(a.isVisible()?a.hide(t):(a._cancelPendingAnimations(),this._detach()))}toggle(){this._isTooltipVisible()?this.hide():this.show()}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(){if(this._overlayRef)return this._overlayRef;const t=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),a=this._overlay.position().flexibleConnectedTo(this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(t);return a.positionChanges.pipe(bs(this._destroyed)).subscribe(l=>{this._updateCurrentPositionClass(l.connectionPair),this._tooltipInstance&&l.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:a,panelClass:`${this._cssClassPrefix}-${I3}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(bs(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(bs(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(bs(this._destroyed)).subscribe(l=>{this._isTooltipVisible()&&27===l.keyCode&&!function Dj(r,...e){return e.length?e.some(t=>r[t]):r.altKey||r.shiftKey||r.ctrlKey||r.metaKey}(l)&&(l.preventDefault(),l.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(t){const a=t.getConfig().positionStrategy,l=this._getOrigin(),u=this._getOverlayPosition();a.withPositions([this._addOffset({...l.main,...u.main}),this._addOffset({...l.fallback,...u.fallback})])}_addOffset(t){return t}_getOrigin(){const t=!this._dir||"ltr"==this._dir.value,a=this.position;let l;"above"==a||"below"==a?l={originX:"center",originY:"above"==a?"top":"bottom"}:"before"==a||"left"==a&&t||"right"==a&&!t?l={originX:"start",originY:"center"}:("after"==a||"right"==a&&t||"left"==a&&!t)&&(l={originX:"end",originY:"center"});const{x:u,y:f}=this._invertPosition(l.originX,l.originY);return{main:l,fallback:{originX:u,originY:f}}}_getOverlayPosition(){const t=!this._dir||"ltr"==this._dir.value,a=this.position;let l;"above"==a?l={overlayX:"center",overlayY:"bottom"}:"below"==a?l={overlayX:"center",overlayY:"top"}:"before"==a||"left"==a&&t||"right"==a&&!t?l={overlayX:"end",overlayY:"center"}:("after"==a||"right"==a&&t||"left"==a&&!t)&&(l={overlayX:"start",overlayY:"center"});const{x:u,y:f}=this._invertPosition(l.overlayX,l.overlayY);return{main:l,fallback:{overlayX:u,overlayY:f}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(ho(1),bs(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(t){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=t,this._tooltipInstance._markForCheck())}_invertPosition(t,a){return"above"===this.position||"below"===this.position?"top"===a?a="bottom":"bottom"===a&&(a="top"):"end"===t?t="start":"start"===t&&(t="end"),{x:t,y:a}}_updateCurrentPositionClass(t){const{overlayY:a,originX:l,originY:u}=t;let f;if(f="center"===a?this._dir&&"rtl"===this._dir.value?"end"===l?"left":"right":"start"===l?"left":"right":"bottom"===a&&"top"===u?"above":"below",f!==this._currentPosition){const g=this._overlayRef;if(g){const v=`${this._cssClassPrefix}-${I3}-`;g.removePanelClass(v+this._currentPosition),g.addPanelClass(v+f)}this._currentPosition=f}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",()=>{this._setupPointerExitEventsIfNeeded(),this.show()}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",()=>{this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const t=[];if(this._platformSupportsMouseEvents())t.push(["mouseleave",a=>{const l=a.relatedTarget;(!l||!this._overlayRef?.overlayElement.contains(l))&&this.hide()}],["wheel",a=>this._wheelListener(a)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const a=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};t.push(["touchend",a],["touchcancel",a])}this._addListeners(t),this._passiveListeners.push(...t)}_addListeners(t){t.forEach(([a,l])=>{this._elementRef.nativeElement.addEventListener(a,l,R3)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(t){if(this._isTooltipVisible()){const a=this._document.elementFromPoint(t.clientX,t.clientY),l=this._elementRef.nativeElement;a!==l&&!l.contains(a)&&this.hide()}}_disableNativeGesturesIfNecessary(){const t=this.touchGestures;if("off"!==t){const a=this._elementRef.nativeElement,l=a.style;("on"===t||"INPUT"!==a.nodeName&&"TEXTAREA"!==a.nodeName)&&(l.userSelect=l.msUserSelect=l.webkitUserSelect=l.MozUserSelect="none"),("on"===t||!a.draggable)&&(l.webkitUserDrag="none"),l.touchAction="none",l.webkitTapHighlightColor="transparent"}}}return r.\u0275fac=function(t){Bp()},r.\u0275dir=Be({type:r,inputs:{position:["matTooltipPosition","position"],disabled:["matTooltipDisabled","disabled"],showDelay:["matTooltipShowDelay","showDelay"],hideDelay:["matTooltipHideDelay","hideDelay"],touchGestures:["matTooltipTouchGestures","touchGestures"],message:["matTooltip","message"],tooltipClass:["matTooltipClass","tooltipClass"]}}),r})(),w6=(()=>{class r extends R6{constructor(t,a,l,u,f,g,v,b,D,L,j,G){super(t,a,l,u,f,g,v,b,D,L,j,G),this._tooltipComponent=D6}}return r.\u0275fac=function(t){return new(t||r)(se(VO),se(ci),se(h3),se(Go),se(Ht),se(jr),se(r4),se(jx),se(w3),se(Gx,8),se(T6,8),se(rn))},r.\u0275dir=Be({type:r,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-tooltip-trigger"],exportAs:["matTooltip"],features:[Ft]}),r})(),A6=(()=>{class r{constructor(t,a){this._changeDetectorRef=t,this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new fn,this._animationsDisabled="NoopAnimations"===a}show(t){clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},t)}hide(t){clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},t)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:t}){(!t||!this._triggerElement.contains(t))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){}_handleAnimationEnd({animationName:t}){(t===this._showAnimation||t===this._hideAnimation)&&this._finalizeAnimation(t===this._showAnimation)}_cancelPendingAnimations(){clearTimeout(this._showTimeoutId),clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(t){t?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(t){const a=this._tooltip.nativeElement,l=this._showAnimation,u=this._hideAnimation;if(a.classList.remove(t?u:l),a.classList.add(t?l:u),this._isVisible=t,t&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const f=getComputedStyle(a);("0s"===f.getPropertyValue("animation-duration")||"none"===f.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}t&&this._onShow(),this._animationsDisabled&&(a.classList.add("_mat-animation-noopable"),this._finalizeAnimation(t))}}return r.\u0275fac=function(t){return new(t||r)(se(nn),se($n,8))},r.\u0275dir=Be({type:r}),r})(),D6=(()=>{class r extends A6{constructor(t,a,l){super(t,l),this._breakpointObserver=a,this._isHandset=this._breakpointObserver.observe("(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)"),this._showAnimation="mat-tooltip-show",this._hideAnimation="mat-tooltip-hide"}}return r.\u0275fac=function(t){return new(t||r)(se(nn),se(wV),se($n,8))},r.\u0275cmp=qr({type:r,selectors:[["mat-tooltip-component"]],viewQuery:function(t,a){if(1&t&&Ec(y6,7),2&t){let l;sr(l=Xi())&&(a._tooltip=l.first)}},hostAttrs:["aria-hidden","true"],hostVars:2,hostBindings:function(t,a){1&t&&Xt("mouseleave",function(u){return a._handleMouseLeave(u)}),2&t&&qS("zoom",a.isVisible()?1:null)},features:[Ft],decls:4,vars:6,consts:[[1,"mat-tooltip",3,"ngClass","animationend"],["tooltip",""]],template:function(t,a){if(1&t&&(De(0,"div",0,1),Xt("animationend",function(u){return a._handleAnimationEnd(u)}),gf(2,"async"),$i(3),Ge()),2&t){let l;In("mat-tooltip-handset",null==(l=Qu(2,4,a._isHandset))?null:l.matches),Ze("ngClass",a.tooltipClass),Xe(3),fs(a.message)}},dependencies:[ub,CE],styles:[".mat-tooltip{color:#fff;border-radius:4px;margin:14px;max-width:250px;padding-left:8px;padding-right:8px;overflow:hidden;text-overflow:ellipsis;transform:scale(0)}.mat-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.cdk-high-contrast-active .mat-tooltip{outline:solid 1px}.mat-tooltip-handset{margin:24px;padding-left:16px;padding-right:16px}.mat-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-tooltip-show{0%{opacity:0;transform:scale(0)}50%{opacity:.5;transform:scale(0.99)}100%{opacity:1;transform:scale(1)}}@keyframes mat-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(1)}}.mat-tooltip-show{animation:mat-tooltip-show 200ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-tooltip-hide{animation:mat-tooltip-hide 100ms cubic-bezier(0, 0, 0.2, 1) forwards}"],encapsulation:2,changeDetection:0}),r})(),O6=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({providers:[b6],imports:[m4,sn,E6,Mc,Mc,e2]}),r})();function A3(r){return new pe(3e3,!1)}function uH(){return typeof window<"u"&&typeof window.document<"u"}function r2(){return typeof process<"u"&&"[object process]"==={}.toString.call(process)}function jh(r){switch(r.length){case 0:return new AT;case 1:return r[0];default:return new e3(r)}}function D3(r,e,t,a,l=new Map,u=new Map){const f=[],g=[];let v=-1,b=null;if(a.forEach(D=>{const L=D.get("offset"),j=L==v,G=j&&b||new Map;D.forEach((q,ie)=>{let ce=ie,Ce=q;if("offset"!==ie)switch(ce=e.normalizePropertyName(ce,f),Ce){case"!":Ce=l.get(ie);break;case Qd:Ce=u.get(ie);break;default:Ce=e.normalizeStyleValue(ie,ce,Ce,f)}G.set(ce,Ce)}),j||g.push(G),b=G,v=L}),f.length)throw function Z6(r){return new pe(3502,!1)}();return g}function o2(r,e,t,a){switch(e){case"start":r.onStart(()=>a(t&&s2(t,"start",r)));break;case"done":r.onDone(()=>a(t&&s2(t,"done",r)));break;case"destroy":r.onDestroy(()=>a(t&&s2(t,"destroy",r)))}}function s2(r,e,t){const u=a2(r.element,r.triggerName,r.fromState,r.toState,e||r.phaseName,t.totalTime??r.totalTime,!!t.disabled),f=r._data;return null!=f&&(u._data=f),u}function a2(r,e,t,a,l="",u=0,f){return{element:r,triggerName:e,fromState:t,toState:a,phaseName:l,totalTime:u,disabled:!!f}}function na(r,e,t){let a=r.get(e);return a||r.set(e,a=t),a}function O3(r){const e=r.indexOf(":");return[r.substring(1,e),r.slice(e+1)]}let c2=(r,e)=>!1,N3=(r,e,t)=>[],P3=null;function l2(r){const e=r.parentNode||r.host;return e===P3?null:e}(r2()||typeof Element<"u")&&(uH()?(P3=(()=>document.documentElement)(),c2=(r,e)=>{for(;e;){if(e===r)return!0;e=l2(e)}return!1}):c2=(r,e)=>r.contains(e),N3=(r,e,t)=>{if(t)return Array.from(r.querySelectorAll(e));const a=r.querySelector(e);return a?[a]:[]});let Rm=null,M3=!1;const k3=c2,L3=N3;let x3=(()=>{class r{validateStyleProperty(t){return function pH(r){Rm||(Rm=function fH(){return typeof document<"u"?document.body:null}()||{},M3=!!Rm.style&&"WebkitAppearance"in Rm.style);let e=!0;return Rm.style&&!function hH(r){return"ebkit"==r.substring(1,6)}(r)&&(e=r in Rm.style,!e&&M3&&(e="Webkit"+r.charAt(0).toUpperCase()+r.slice(1)in Rm.style)),e}(t)}matchesElement(t,a){return!1}containsElement(t,a){return k3(t,a)}getParentElement(t){return l2(t)}query(t,a,l){return L3(t,a,l)}computeStyle(t,a,l){return l||""}animate(t,a,l,u,f,g=[],v){return new AT(l,u)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=ke({token:r,factory:r.\u0275fac}),r})(),d2=(()=>{class r{}return r.NOOP=new x3,r})();const u2="ng-enter",BO="ng-leave",jO="ng-trigger",HO=".ng-trigger",U3="ng-animating",h2=".ng-animating";function Zd(r){if("number"==typeof r)return r;const e=r.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:p2(parseFloat(e[1]),e[2])}function p2(r,e){return"s"===e?1e3*r:r}function GO(r,e,t){return r.hasOwnProperty("duration")?r:function gH(r,e,t){let l,u=0,f="";if("string"==typeof r){const g=r.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===g)return e.push(A3()),{duration:0,delay:0,easing:""};l=p2(parseFloat(g[1]),g[2]);const v=g[3];null!=v&&(u=p2(parseFloat(v),g[4]));const b=g[5];b&&(f=b)}else l=r;if(!t){let g=!1,v=e.length;l<0&&(e.push(function N6(){return new pe(3100,!1)}()),g=!0),u<0&&(e.push(function P6(){return new pe(3101,!1)}()),g=!0),g&&e.splice(v,0,A3())}return{duration:l,delay:u,easing:f}}(r,e,t)}function DT(r,e={}){return Object.keys(r).forEach(t=>{e[t]=r[t]}),e}function V3(r){const e=new Map;return Object.keys(r).forEach(t=>{e.set(t,r[t])}),e}function Hh(r,e=new Map,t){if(t)for(let[a,l]of t)e.set(a,l);for(let[a,l]of r)e.set(a,l);return e}function j3(r,e,t){return t?e+":"+t+";":""}function H3(r){let e="";for(let t=0;t<r.style.length;t++){const a=r.style.item(t);e+=j3(0,a,r.style.getPropertyValue(a))}for(const t in r.style)r.style.hasOwnProperty(t)&&!t.startsWith("_")&&(e+=j3(0,SH(t),r.style[t]));r.setAttribute("style",e)}function Tl(r,e,t){r.style&&(e.forEach((a,l)=>{const u=m2(l);t&&!t.has(l)&&t.set(l,r.style[u]),r.style[u]=a}),r2()&&H3(r))}function wm(r,e){r.style&&(e.forEach((t,a)=>{const l=m2(a);r.style[l]=""}),r2()&&H3(r))}function OT(r){return Array.isArray(r)?1==r.length?r[0]:QV(r):r}const f2=new RegExp("{{\\s*(.+?)\\s*}}","g");function G3(r){let e=[];if("string"==typeof r){let t;for(;t=f2.exec(r);)e.push(t[1]);f2.lastIndex=0}return e}function NT(r,e,t){const a=r.toString(),l=a.replace(f2,(u,f)=>{let g=e[f];return null==g&&(t.push(function k6(r){return new pe(3003,!1)}()),g=""),g.toString()});return l==a?r:l}function WO(r){const e=[];let t=r.next();for(;!t.done;)e.push(t.value),t=r.next();return e}const vH=/-+([a-z0-9])/g;function m2(r){return r.replace(vH,(...e)=>e[1].toUpperCase())}function SH(r){return r.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function ia(r,e,t){switch(e.type){case 7:return r.visitTrigger(e,t);case 0:return r.visitState(e,t);case 1:return r.visitTransition(e,t);case 2:return r.visitSequence(e,t);case 3:return r.visitGroup(e,t);case 4:return r.visitAnimate(e,t);case 5:return r.visitKeyframes(e,t);case 6:return r.visitStyle(e,t);case 8:return r.visitReference(e,t);case 9:return r.visitAnimateChild(e,t);case 10:return r.visitAnimateRef(e,t);case 11:return r.visitQuery(e,t);case 12:return r.visitStagger(e,t);default:throw function L6(r){return new pe(3004,!1)}()}}function W3(r,e){return window.getComputedStyle(r)[e]}function wH(r,e){const t=[];return"string"==typeof r?r.split(/\s*,\s*/).forEach(a=>function AH(r,e,t){if(":"==r[0]){const v=function DH(r,e){switch(r){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,a)=>parseFloat(a)>parseFloat(t);case":decrement":return(t,a)=>parseFloat(a)<parseFloat(t);default:return e.push(function $6(r){return new pe(3016,!1)}()),"* => *"}}(r,t);if("function"==typeof v)return void e.push(v);r=v}const a=r.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==a||a.length<4)return t.push(function Y6(r){return new pe(3015,!1)}()),e;const l=a[1],u=a[2],f=a[3];e.push(z3(l,f));"<"==u[0]&&!("*"==l&&"*"==f)&&e.push(z3(f,l))}(a,t,e)):t.push(r),t}const YO=new Set(["true","1"]),$O=new Set(["false","0"]);function z3(r,e){const t=YO.has(r)||$O.has(r),a=YO.has(e)||$O.has(e);return(l,u)=>{let f="*"==r||r==l,g="*"==e||e==u;return!f&&t&&"boolean"==typeof l&&(f=l?YO.has(r):$O.has(r)),!g&&a&&"boolean"==typeof u&&(g=u?YO.has(e):$O.has(e)),f&&g}}const OH=new RegExp("s*:selfs*,?","g");function _2(r,e,t,a){return new NH(r).build(e,t,a)}class NH{constructor(e){this._driver=e}build(e,t,a){const l=new kH(t);return this._resetContextStyleTimingState(l),ia(this,OT(e),l)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles=new Map,e.collectedStyles.set("",new Map),e.currentTime=0}visitTrigger(e,t){let a=t.queryCount=0,l=t.depCount=0;const u=[],f=[];return"@"==e.name.charAt(0)&&t.errors.push(function F6(){return new pe(3006,!1)}()),e.definitions.forEach(g=>{if(this._resetContextStyleTimingState(t),0==g.type){const v=g,b=v.name;b.toString().split(/\s*,\s*/).forEach(D=>{v.name=D,u.push(this.visitState(v,t))}),v.name=b}else if(1==g.type){const v=this.visitTransition(g,t);a+=v.queryCount,l+=v.depCount,f.push(v)}else t.errors.push(function U6(){return new pe(3007,!1)}())}),{type:7,name:e.name,states:u,transitions:f,queryCount:a,depCount:l,options:null}}visitState(e,t){const a=this.visitStyle(e.styles,t),l=e.options&&e.options.params||null;if(a.containsDynamicStyles){const u=new Set,f=l||{};a.styles.forEach(g=>{g instanceof Map&&g.forEach(v=>{G3(v).forEach(b=>{f.hasOwnProperty(b)||u.add(b)})})}),u.size&&(WO(u.values()),t.errors.push(function V6(r,e){return new pe(3008,!1)}()))}return{type:0,name:e.name,style:a,options:l?{params:l}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const a=ia(this,OT(e.animation),t);return{type:1,matchers:wH(e.expr,t.errors),animation:a,queryCount:t.queryCount,depCount:t.depCount,options:Am(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(a=>ia(this,a,t)),options:Am(e.options)}}visitGroup(e,t){const a=t.currentTime;let l=0;const u=e.steps.map(f=>{t.currentTime=a;const g=ia(this,f,t);return l=Math.max(l,t.currentTime),g});return t.currentTime=l,{type:3,steps:u,options:Am(e.options)}}visitAnimate(e,t){const a=function xH(r,e){if(r.hasOwnProperty("duration"))return r;if("number"==typeof r)return g2(GO(r,e).duration,0,"");const t=r;if(t.split(/\s+/).some(u=>"{"==u.charAt(0)&&"{"==u.charAt(1))){const u=g2(0,0,"");return u.dynamic=!0,u.strValue=t,u}const l=GO(t,e);return g2(l.duration,l.delay,l.easing)}(e.timings,t.errors);t.currentAnimateTimings=a;let l,u=e.styles?e.styles:Ts({});if(5==u.type)l=this.visitKeyframes(u,t);else{let f=e.styles,g=!1;if(!f){g=!0;const b={};a.easing&&(b.easing=a.easing),f=Ts(b)}t.currentTime+=a.duration+a.delay;const v=this.visitStyle(f,t);v.isEmptyStep=g,l=v}return t.currentAnimateTimings=null,{type:4,timings:a,style:l,options:null}}visitStyle(e,t){const a=this._makeStyleAst(e,t);return this._validateStyleAst(a,t),a}_makeStyleAst(e,t){const a=[],l=Array.isArray(e.styles)?e.styles:[e.styles];for(let g of l)"string"==typeof g?g===Qd?a.push(g):t.errors.push(new pe(3002,!1)):a.push(V3(g));let u=!1,f=null;return a.forEach(g=>{if(g instanceof Map&&(g.has("easing")&&(f=g.get("easing"),g.delete("easing")),!u))for(let v of g.values())if(v.toString().indexOf("{{")>=0){u=!0;break}}),{type:6,styles:a,easing:f,offset:e.offset,containsDynamicStyles:u,options:null}}_validateStyleAst(e,t){const a=t.currentAnimateTimings;let l=t.currentTime,u=t.currentTime;a&&u>0&&(u-=a.duration+a.delay),e.styles.forEach(f=>{"string"!=typeof f&&f.forEach((g,v)=>{const b=t.collectedStyles.get(t.currentQuerySelector),D=b.get(v);let L=!0;D&&(u!=l&&u>=D.startTime&&l<=D.endTime&&(t.errors.push(function j6(r,e,t,a,l){return new pe(3010,!1)}()),L=!1),u=D.startTime),L&&b.set(v,{startTime:u,endTime:l}),t.options&&function yH(r,e,t){const a=e.params||{},l=G3(r);l.length&&l.forEach(u=>{a.hasOwnProperty(u)||t.push(function M6(r){return new pe(3001,!1)}())})}(g,t.options,t.errors)})})}visitKeyframes(e,t){const a={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function H6(){return new pe(3011,!1)}()),a;let u=0;const f=[];let g=!1,v=!1,b=0;const D=e.steps.map(Ce=>{const we=this._makeStyleAst(Ce,t);let ue=null!=we.offset?we.offset:function LH(r){if("string"==typeof r)return null;let e=null;if(Array.isArray(r))r.forEach(t=>{if(t instanceof Map&&t.has("offset")){const a=t;e=parseFloat(a.get("offset")),a.delete("offset")}});else if(r instanceof Map&&r.has("offset")){const t=r;e=parseFloat(t.get("offset")),t.delete("offset")}return e}(we.styles),Fe=0;return null!=ue&&(u++,Fe=we.offset=ue),v=v||Fe<0||Fe>1,g=g||Fe<b,b=Fe,f.push(Fe),we});v&&t.errors.push(function G6(){return new pe(3012,!1)}()),g&&t.errors.push(function W6(){return new pe(3200,!1)}());const L=e.steps.length;let j=0;u>0&&u<L?t.errors.push(function z6(){return new pe(3202,!1)}()):0==u&&(j=1/(L-1));const G=L-1,q=t.currentTime,ie=t.currentAnimateTimings,ce=ie.duration;return D.forEach((Ce,we)=>{const ue=j>0?we==G?1:j*we:f[we],Fe=ue*ce;t.currentTime=q+ie.delay+Fe,ie.duration=Fe,this._validateStyleAst(Ce,t),Ce.offset=ue,a.styles.push(Ce)}),a}visitReference(e,t){return{type:8,animation:ia(this,OT(e.animation),t),options:Am(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:Am(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:Am(e.options)}}visitQuery(e,t){const a=t.currentQuerySelector,l=e.options||{};t.queryCount++,t.currentQuery=e;const[u,f]=function PH(r){const e=!!r.split(/\s*,\s*/).find(t=>":self"==t);return e&&(r=r.replace(OH,"")),r=r.replace(/@\*/g,HO).replace(/@\w+/g,t=>HO+"-"+t.slice(1)).replace(/:animating/g,h2),[r,e]}(e.selector);t.currentQuerySelector=a.length?a+" "+u:u,na(t.collectedStyles,t.currentQuerySelector,new Map);const g=ia(this,OT(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=a,{type:11,selector:u,limit:l.limit||0,optional:!!l.optional,includeSelf:f,animation:g,originalSelector:e.selector,options:Am(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(function K6(){return new pe(3013,!1)}());const a="full"===e.timings?{duration:0,delay:0,easing:"full"}:GO(e.timings,t.errors,!0);return{type:12,animation:ia(this,OT(e.animation),t),timings:a,options:null}}}class kH{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function Am(r){return r?(r=DT(r)).params&&(r.params=function MH(r){return r?DT(r):null}(r.params)):r={},r}function g2(r,e,t){return{duration:r,delay:e,easing:t}}function E2(r,e,t,a,l,u,f=null,g=!1){return{type:1,element:r,keyframes:e,preStyleProps:t,postStyleProps:a,duration:l,delay:u,totalTime:l+u,easing:f,subTimeline:g}}class XO{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let a=this._map.get(e);a||this._map.set(e,a=[]),a.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const VH=new RegExp(":enter","g"),jH=new RegExp(":leave","g");function y2(r,e,t,a,l,u=new Map,f=new Map,g,v,b=[]){return(new HH).buildKeyframes(r,e,t,a,l,u,f,g,v,b)}class HH{buildKeyframes(e,t,a,l,u,f,g,v,b,D=[]){b=b||new XO;const L=new v2(e,t,b,l,u,D,[]);L.options=v;const j=v.delay?Zd(v.delay):0;L.currentTimeline.delayNextStep(j),L.currentTimeline.setStyles([f],null,L.errors,v),ia(this,a,L);const G=L.timelines.filter(q=>q.containsAnimation());if(G.length&&g.size){let q;for(let ie=G.length-1;ie>=0;ie--){const ce=G[ie];if(ce.element===t){q=ce;break}}q&&!q.allowOnlyTimelineStyles()&&q.setStyles([g],null,L.errors,v)}return G.length?G.map(q=>q.buildKeyframes()):[E2(t,[],[],[],0,j,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const a=t.subInstructions.get(t.element);if(a){const l=t.createSubContext(e.options),u=t.currentTimeline.currentTime,f=this._visitSubInstructions(a,l,l.options);u!=f&&t.transformIntoNewTimeline(f)}t.previousNode=e}visitAnimateRef(e,t){const a=t.createSubContext(e.options);a.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,a),this.visitReference(e.animation,a),t.transformIntoNewTimeline(a.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,a){for(const l of e){const u=l?.delay;if(u){const f="number"==typeof u?u:Zd(NT(u,l?.params??{},t.errors));a.delayNextStep(f)}}}_visitSubInstructions(e,t,a){let u=t.currentTimeline.currentTime;const f=null!=a.duration?Zd(a.duration):null,g=null!=a.delay?Zd(a.delay):null;return 0!==f&&e.forEach(v=>{const b=t.appendInstructionToTimeline(v,f,g);u=Math.max(u,b.duration+b.delay)}),u}visitReference(e,t){t.updateOptions(e.options,!0),ia(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const a=t.subContextCount;let l=t;const u=e.options;if(u&&(u.params||u.delay)&&(l=t.createSubContext(u),l.transformIntoNewTimeline(),null!=u.delay)){6==l.previousNode.type&&(l.currentTimeline.snapshotCurrentStyles(),l.previousNode=JO);const f=Zd(u.delay);l.delayNextStep(f)}e.steps.length&&(e.steps.forEach(f=>ia(this,f,l)),l.currentTimeline.applyStylesToKeyframe(),l.subContextCount>a&&l.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const a=[];let l=t.currentTimeline.currentTime;const u=e.options&&e.options.delay?Zd(e.options.delay):0;e.steps.forEach(f=>{const g=t.createSubContext(e.options);u&&g.delayNextStep(u),ia(this,f,g),l=Math.max(l,g.currentTimeline.currentTime),a.push(g.currentTimeline)}),a.forEach(f=>t.currentTimeline.mergeTimelineCollectedStyles(f)),t.transformIntoNewTimeline(l),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const a=e.strValue;return GO(t.params?NT(a,t.params,t.errors):a,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const a=t.currentAnimateTimings=this._visitTiming(e.timings,t),l=t.currentTimeline;a.delay&&(t.incrementTime(a.delay),l.snapshotCurrentStyles());const u=e.style;5==u.type?this.visitKeyframes(u,t):(t.incrementTime(a.duration),this.visitStyle(u,t),l.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const a=t.currentTimeline,l=t.currentAnimateTimings;!l&&a.hasCurrentStyleProperties()&&a.forwardFrame();const u=l&&l.easing||e.easing;e.isEmptyStep?a.applyEmptyStep(u):a.setStyles(e.styles,u,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const a=t.currentAnimateTimings,l=t.currentTimeline.duration,u=a.duration,g=t.createSubContext().currentTimeline;g.easing=a.easing,e.styles.forEach(v=>{g.forwardTime((v.offset||0)*u),g.setStyles(v.styles,v.easing,t.errors,t.options),g.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(g),t.transformIntoNewTimeline(l+u),t.previousNode=e}visitQuery(e,t){const a=t.currentTimeline.currentTime,l=e.options||{},u=l.delay?Zd(l.delay):0;u&&(6===t.previousNode.type||0==a&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=JO);let f=a;const g=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!l.optional,t.errors);t.currentQueryTotal=g.length;let v=null;g.forEach((b,D)=>{t.currentQueryIndex=D;const L=t.createSubContext(e.options,b);u&&L.delayNextStep(u),b===t.element&&(v=L.currentTimeline),ia(this,e.animation,L),L.currentTimeline.applyStylesToKeyframe(),f=Math.max(f,L.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(f),v&&(t.currentTimeline.mergeTimelineCollectedStyles(v),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const a=t.parentContext,l=t.currentTimeline,u=e.timings,f=Math.abs(u.duration),g=f*(t.currentQueryTotal-1);let v=f*t.currentQueryIndex;switch(u.duration<0?"reverse":u.easing){case"reverse":v=g-v;break;case"full":v=a.currentStaggerTime}const D=t.currentTimeline;v&&D.delayNextStep(v);const L=D.currentTime;ia(this,e.animation,t),t.previousNode=e,a.currentStaggerTime=l.currentTime-L+(l.startTime-a.currentTimeline.startTime)}}const JO={};class v2{constructor(e,t,a,l,u,f,g,v){this._driver=e,this.element=t,this.subInstructions=a,this._enterClassName=l,this._leaveClassName=u,this.errors=f,this.timelines=g,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=JO,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=v||new QO(this._driver,t,0),g.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const a=e;let l=this.options;null!=a.duration&&(l.duration=Zd(a.duration)),null!=a.delay&&(l.delay=Zd(a.delay));const u=a.params;if(u){let f=l.params;f||(f=this.options.params={}),Object.keys(u).forEach(g=>{(!t||!f.hasOwnProperty(g))&&(f[g]=NT(u[g],f,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const a=e.params={};Object.keys(t).forEach(l=>{a[l]=t[l]})}}return e}createSubContext(e=null,t,a){const l=t||this.element,u=new v2(this._driver,l,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(l,a||0));return u.previousNode=this.previousNode,u.currentAnimateTimings=this.currentAnimateTimings,u.options=this._copyOptions(),u.updateOptions(e),u.currentQueryIndex=this.currentQueryIndex,u.currentQueryTotal=this.currentQueryTotal,u.parentContext=this,this.subContextCount++,u}transformIntoNewTimeline(e){return this.previousNode=JO,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,a){const l={duration:t??e.duration,delay:this.currentTimeline.currentTime+(a??0)+e.delay,easing:""},u=new GH(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,l,e.stretchStartingKeyframe);return this.timelines.push(u),l}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,a,l,u,f){let g=[];if(l&&g.push(this.element),e.length>0){e=(e=e.replace(VH,"."+this._enterClassName)).replace(jH,"."+this._leaveClassName);let b=this._driver.query(this.element,e,1!=a);0!==a&&(b=a<0?b.slice(b.length+a,b.length):b.slice(0,a)),g.push(...b)}return!u&&0==g.length&&f.push(function q6(r){return new pe(3014,!1)}()),g}}class QO{constructor(e,t,a,l){this._driver=e,this.element=t,this.startTime=a,this._elementTimelineStylesLookup=l,this.duration=0,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1===this._keyframes.size&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new QO(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,a]of this._globalTimelineStyles)this._backFill.set(t,a||Qd),this._currentKeyframe.set(t,Qd);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,a,l){t&&this._previousKeyframe.set("easing",t);const u=l&&l.params||{},f=function WH(r,e){const t=new Map;let a;return r.forEach(l=>{if("*"===l){a=a||e.keys();for(let u of a)t.set(u,Qd)}else Hh(l,t)}),t}(e,this._globalTimelineStyles);for(let[g,v]of f){const b=NT(v,u,a);this._pendingStyles.set(g,b),this._localTimelineStyles.has(g)||this._backFill.set(g,this._globalTimelineStyles.get(g)??Qd),this._updateStyle(g,b)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,a)=>{const l=this._styleSummary.get(a);(!l||t.time>l.time)&&this._updateStyle(a,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,a=1===this._keyframes.size&&0===this.duration;let l=[];this._keyframes.forEach((g,v)=>{const b=Hh(g,new Map,this._backFill);b.forEach((D,L)=>{"!"===D?e.add(L):D===Qd&&t.add(L)}),a||b.set("offset",v/this.duration),l.push(b)});const u=e.size?WO(e.values()):[],f=t.size?WO(t.values()):[];if(a){const g=l[0],v=new Map(g);g.set("offset",0),v.set("offset",1),l=[g,v]}return E2(this.element,l,u,f,this.duration,this.startTime,this.easing,!1)}}class GH extends QO{constructor(e,t,a,l,u,f,g=!1){super(e,t,f.delay),this.keyframes=a,this.preStyleProps=l,this.postStyleProps=u,this._stretchStartingKeyframe=g,this.timings={duration:f.duration,delay:f.delay,easing:f.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:a,easing:l}=this.timings;if(this._stretchStartingKeyframe&&t){const u=[],f=a+t,g=t/f,v=Hh(e[0]);v.set("offset",0),u.push(v);const b=Hh(e[0]);b.set("offset",Y3(g)),u.push(b);const D=e.length-1;for(let L=1;L<=D;L++){let j=Hh(e[L]);const G=j.get("offset");j.set("offset",Y3((t+G*a)/f)),u.push(j)}a=f,t=0,l="",e=u}return E2(this.element,e,this.preStyleProps,this.postStyleProps,a,t,l,!0)}}function Y3(r,e=3){const t=Math.pow(10,e-1);return Math.round(r*t)/t}class S2{}const zH=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class KH extends S2{normalizePropertyName(e,t){return m2(e)}normalizeStyleValue(e,t,a,l){let u="";const f=a.toString().trim();if(zH.has(t)&&0!==a&&"0"!==a)if("number"==typeof a)u="px";else{const g=a.match(/^[+-]?[\d\.]+([a-z]*)$/);g&&0==g[1].length&&l.push(function x6(r,e){return new pe(3005,!1)}())}return f+u}}function $3(r,e,t,a,l,u,f,g,v,b,D,L,j){return{type:0,element:r,triggerName:e,isRemovalTransition:l,fromState:t,fromStyles:u,toState:a,toStyles:f,timelines:g,queriedElements:v,preStyleProps:b,postStyleProps:D,totalTime:L,errors:j}}const C2={};class X3{constructor(e,t,a){this._triggerName=e,this.ast=t,this._stateStyles=a}match(e,t,a,l){return function qH(r,e,t,a,l){return r.some(u=>u(e,t,a,l))}(this.ast.matchers,e,t,a,l)}buildStyles(e,t,a){let l=this._stateStyles.get("*");return void 0!==e&&(l=this._stateStyles.get(e?.toString())||l),l?l.buildStyles(t,a):new Map}build(e,t,a,l,u,f,g,v,b,D){const L=[],j=this.ast.options&&this.ast.options.params||C2,q=this.buildStyles(a,g&&g.params||C2,L),ie=v&&v.params||C2,ce=this.buildStyles(l,ie,L),Ce=new Set,we=new Map,ue=new Map,Fe="void"===l,Vt={params:YH(ie,j),delay:this.ast.options?.delay},pn=D?[]:y2(e,t,this.ast.animation,u,f,q,ce,Vt,b,L);let Ai=0;if(pn.forEach(oa=>{Ai=Math.max(oa.duration+oa.delay,Ai)}),L.length)return $3(t,this._triggerName,a,l,Fe,q,ce,[],[],we,ue,Ai,L);pn.forEach(oa=>{const sa=oa.element,Cy=na(we,sa,new Set);oa.preStyleProps.forEach(Lc=>Cy.add(Lc));const nu=na(ue,sa,new Set);oa.postStyleProps.forEach(Lc=>nu.add(Lc)),sa!==t&&Ce.add(sa)});const ra=WO(Ce.values());return $3(t,this._triggerName,a,l,Fe,q,ce,pn,ra,we,ue,Ai)}}function YH(r,e){const t=DT(e);for(const a in r)r.hasOwnProperty(a)&&null!=r[a]&&(t[a]=r[a]);return t}class $H{constructor(e,t,a){this.styles=e,this.defaultParams=t,this.normalizer=a}buildStyles(e,t){const a=new Map,l=DT(this.defaultParams);return Object.keys(e).forEach(u=>{const f=e[u];null!==f&&(l[u]=f)}),this.styles.styles.forEach(u=>{"string"!=typeof u&&u.forEach((f,g)=>{f&&(f=NT(f,l,t));const v=this.normalizer.normalizePropertyName(g,t);f=this.normalizer.normalizeStyleValue(g,v,f,t),a.set(v,f)})}),a}}class JH{constructor(e,t,a){this.name=e,this.ast=t,this._normalizer=a,this.transitionFactories=[],this.states=new Map,t.states.forEach(l=>{this.states.set(l.name,new $H(l.style,l.options&&l.options.params||{},a))}),J3(this.states,"true","1"),J3(this.states,"false","0"),t.transitions.forEach(l=>{this.transitionFactories.push(new X3(e,l,this.states))}),this.fallbackTransition=function QH(r,e,t){return new X3(r,{type:1,animation:{type:2,steps:[],options:null},matchers:[(f,g)=>!0],options:null,queryCount:0,depCount:0},e)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,a,l){return this.transitionFactories.find(f=>f.match(e,t,a,l))||null}matchStyles(e,t,a){return this.fallbackTransition.buildStyles(e,t,a)}}function J3(r,e,t){r.has(e)?r.has(t)||r.set(t,r.get(e)):r.has(t)&&r.set(e,r.get(t))}const ZH=new XO;class e8{constructor(e,t,a){this.bodyNode=e,this._driver=t,this._normalizer=a,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,t){const a=[],u=_2(this._driver,t,a,[]);if(a.length)throw function eH(r){return new pe(3503,!1)}();this._animations.set(e,u)}_buildPlayer(e,t,a){const l=e.element,u=D3(0,this._normalizer,0,e.keyframes,t,a);return this._driver.animate(l,u,e.duration,e.delay,e.easing,[],!0)}create(e,t,a={}){const l=[],u=this._animations.get(e);let f;const g=new Map;if(u?(f=y2(this._driver,t,u,u2,BO,new Map,new Map,a,ZH,l),f.forEach(D=>{const L=na(g,D.element,new Map);D.postStyleProps.forEach(j=>L.set(j,null))})):(l.push(function tH(){return new pe(3300,!1)}()),f=[]),l.length)throw function nH(r){return new pe(3504,!1)}();g.forEach((D,L)=>{D.forEach((j,G)=>{D.set(G,this._driver.computeStyle(L,G,Qd))})});const b=jh(f.map(D=>{const L=g.get(D.element);return this._buildPlayer(D,new Map,L)}));return this._playersById.set(e,b),b.onDestroy(()=>this.destroy(e)),this.players.push(b),b}destroy(e){const t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);const a=this.players.indexOf(t);a>=0&&this.players.splice(a,1)}_getPlayer(e){const t=this._playersById.get(e);if(!t)throw function iH(r){return new pe(3301,!1)}();return t}listen(e,t,a,l){const u=a2(t,"","","");return o2(this._getPlayer(e),a,u,l),()=>{}}command(e,t,a,l){if("register"==a)return void this.register(e,l[0]);if("create"==a)return void this.create(e,t,l[0]||{});const u=this._getPlayer(e);switch(a){case"play":u.play();break;case"pause":u.pause();break;case"reset":u.reset();break;case"restart":u.restart();break;case"finish":u.finish();break;case"init":u.init();break;case"setPosition":u.setPosition(parseFloat(l[0]));break;case"destroy":this.destroy(e)}}}const Q3="ng-animate-queued",b2="ng-animate-disabled",o8=[],Z3={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},s8={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},ja="__ng_removed";class T2{constructor(e,t=""){this.namespaceId=t;const a=e&&e.hasOwnProperty("value");if(this.value=function d8(r){return r??null}(a?e.value:e),a){const u=DT(e);delete u.value,this.options=u}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(e){const t=e.params;if(t){const a=this.options.params;Object.keys(t).forEach(l=>{null==a[l]&&(a[l]=t[l])})}}}const PT="void",I2=new T2(PT);class a8{constructor(e,t,a){this.id=e,this.hostElement=t,this._engine=a,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,Ha(t,this._hostClassName)}listen(e,t,a,l){if(!this._triggers.has(t))throw function rH(r,e){return new pe(3302,!1)}();if(null==a||0==a.length)throw function oH(r){return new pe(3303,!1)}();if(!function u8(r){return"start"==r||"done"==r}(a))throw function sH(r,e){return new pe(3400,!1)}();const u=na(this._elementListeners,e,[]),f={name:t,phase:a,callback:l};u.push(f);const g=na(this._engine.statesByElement,e,new Map);return g.has(t)||(Ha(e,jO),Ha(e,jO+"-"+t),g.set(t,I2)),()=>{this._engine.afterFlush(()=>{const v=u.indexOf(f);v>=0&&u.splice(v,1),this._triggers.has(t)||g.delete(t)})}}register(e,t){return!this._triggers.has(e)&&(this._triggers.set(e,t),!0)}_getTrigger(e){const t=this._triggers.get(e);if(!t)throw function aH(r){return new pe(3401,!1)}();return t}trigger(e,t,a,l=!0){const u=this._getTrigger(t),f=new R2(this.id,t,e);let g=this._engine.statesByElement.get(e);g||(Ha(e,jO),Ha(e,jO+"-"+t),this._engine.statesByElement.set(e,g=new Map));let v=g.get(t);const b=new T2(a,this.id);if(!(a&&a.hasOwnProperty("value"))&&v&&b.absorbOptions(v.options),g.set(t,b),v||(v=I2),b.value!==PT&&v.value===b.value){if(!function f8(r,e){const t=Object.keys(r),a=Object.keys(e);if(t.length!=a.length)return!1;for(let l=0;l<t.length;l++){const u=t[l];if(!e.hasOwnProperty(u)||r[u]!==e[u])return!1}return!0}(v.params,b.params)){const ie=[],ce=u.matchStyles(v.value,v.params,ie),Ce=u.matchStyles(b.value,b.params,ie);ie.length?this._engine.reportError(ie):this._engine.afterFlush(()=>{wm(e,ce),Tl(e,Ce)})}return}const j=na(this._engine.playersByElement,e,[]);j.forEach(ie=>{ie.namespaceId==this.id&&ie.triggerName==t&&ie.queued&&ie.destroy()});let G=u.matchTransition(v.value,b.value,e,b.params),q=!1;if(!G){if(!l)return;G=u.fallbackTransition,q=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:G,fromState:v,toState:b,player:f,isFallbackTransition:q}),q||(Ha(e,Q3),f.onStart(()=>{py(e,Q3)})),f.onDone(()=>{let ie=this.players.indexOf(f);ie>=0&&this.players.splice(ie,1);const ce=this._engine.playersByElement.get(e);if(ce){let Ce=ce.indexOf(f);Ce>=0&&ce.splice(Ce,1)}}),this.players.push(f),j.push(f),f}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,a)=>{this._elementListeners.set(a,t.filter(l=>l.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(a=>a.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const a=this._engine.driver.query(e,HO,!0);a.forEach(l=>{if(l[ja])return;const u=this._engine.fetchNamespacesByElement(l);u.size?u.forEach(f=>f.triggerLeaveAnimation(l,t,!1,!0)):this.clearElementCache(l)}),this._engine.afterFlushAnimationsDone(()=>a.forEach(l=>this.clearElementCache(l)))}triggerLeaveAnimation(e,t,a,l){const u=this._engine.statesByElement.get(e),f=new Map;if(u){const g=[];if(u.forEach((v,b)=>{if(f.set(b,v.value),this._triggers.has(b)){const D=this.trigger(e,b,PT,l);D&&g.push(D)}}),g.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,f),a&&jh(g).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),a=this._engine.statesByElement.get(e);if(t&&a){const l=new Set;t.forEach(u=>{const f=u.name;if(l.has(f))return;l.add(f);const v=this._triggers.get(f).fallbackTransition,b=a.get(f)||I2,D=new T2(PT),L=new R2(this.id,f,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:f,transition:v,fromState:b,toState:D,player:L,isFallbackTransition:!0})})}}removeNode(e,t){const a=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let l=!1;if(a.totalAnimations){const u=a.players.length?a.playersByQueriedElement.get(e):[];if(u&&u.length)l=!0;else{let f=e;for(;f=f.parentNode;)if(a.statesByElement.get(f)){l=!0;break}}}if(this.prepareLeaveAnimationListeners(e),l)a.markElementAsRemoved(this.id,e,!1,t);else{const u=e[ja];(!u||u===Z3)&&(a.afterFlush(()=>this.clearElementCache(e)),a.destroyInnerAnimations(e),a._onRemovalComplete(e,t))}}insertNode(e,t){Ha(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(a=>{const l=a.player;if(l.destroyed)return;const u=a.element,f=this._elementListeners.get(u);f&&f.forEach(g=>{if(g.name==a.triggerName){const v=a2(u,a.triggerName,a.fromState.value,a.toState.value);v._data=e,o2(a.player,g.phase,v,g.callback)}}),l.markedForDestroy?this._engine.afterFlush(()=>{l.destroy()}):t.push(a)}),this._queue=[],t.sort((a,l)=>{const u=a.transition.ast.depCount,f=l.transition.ast.depCount;return 0==u||0==f?u-f:this._engine.driver.containsElement(a.element,l.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(a=>a.element===e)||t,t}}class c8{constructor(e,t,a){this.bodyNode=e,this.driver=t,this._normalizer=a,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(l,u)=>{}}_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(a=>{a.queued&&e.push(a)})}),e}createNamespace(e,t){const a=new a8(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(a,t):(this.newHostElements.set(t,a),this.collectEnterElement(t)),this._namespaceLookup[e]=a}_balanceNamespaceList(e,t){const a=this._namespaceList,l=this.namespacesByHostElement;if(a.length-1>=0){let f=!1,g=this.driver.getParentElement(t);for(;g;){const v=l.get(g);if(v){const b=a.indexOf(v);a.splice(b+1,0,e),f=!0;break}g=this.driver.getParentElement(g)}f||a.unshift(e)}else a.push(e);return l.set(t,e),e}register(e,t){let a=this._namespaceLookup[e];return a||(a=this.createNamespace(e,t)),a}registerTrigger(e,t,a){let l=this._namespaceLookup[e];l&&l.register(t,a)&&this.totalAnimations++}destroy(e,t){if(!e)return;const a=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(a.hostElement),delete this._namespaceLookup[e];const l=this._namespaceList.indexOf(a);l>=0&&this._namespaceList.splice(l,1)}),this.afterFlushAnimationsDone(()=>a.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,a=this.statesByElement.get(e);if(a)for(let l of a.values())if(l.namespaceId){const u=this._fetchNamespace(l.namespaceId);u&&t.add(u)}return t}trigger(e,t,a,l){if(ZO(t)){const u=this._fetchNamespace(e);if(u)return u.trigger(t,a,l),!0}return!1}insertNode(e,t,a,l){if(!ZO(t))return;const u=t[ja];if(u&&u.setForRemoval){u.setForRemoval=!1,u.setForMove=!0;const f=this.collectedLeaveElements.indexOf(t);f>=0&&this.collectedLeaveElements.splice(f,1)}if(e){const f=this._fetchNamespace(e);f&&f.insertNode(t,a)}l&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),Ha(e,b2)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),py(e,b2))}removeNode(e,t,a,l){if(ZO(t)){const u=e?this._fetchNamespace(e):null;if(u?u.removeNode(t,l):this.markElementAsRemoved(e,t,!1,l),a){const f=this.namespacesByHostElement.get(t);f&&f.id!==e&&f.removeNode(t,l)}}else this._onRemovalComplete(t,l)}markElementAsRemoved(e,t,a,l,u){this.collectedLeaveElements.push(t),t[ja]={namespaceId:e,setForRemoval:l,hasAnimation:a,removedBeforeQueried:!1,previousTriggersValues:u}}listen(e,t,a,l,u){return ZO(t)?this._fetchNamespace(e).listen(t,a,l,u):()=>{}}_buildInstruction(e,t,a,l,u){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,a,l,e.fromState.options,e.toState.options,t,u)}destroyInnerAnimations(e){let t=this.driver.query(e,HO,!0);t.forEach(a=>this.destroyActiveAnimationsForElement(a)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,h2,!0),t.forEach(a=>this.finishActiveQueriedAnimationOnElement(a)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(a=>{a.queued?a.markedForDestroy=!0:a.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(a=>a.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return jh(this.players).onDone(()=>e());e()})}processLeaveNode(e){const t=e[ja];if(t&&t.setForRemoval){if(e[ja]=Z3,t.namespaceId){this.destroyInnerAnimations(e);const a=this._fetchNamespace(t.namespaceId);a&&a.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(b2)&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach(a=>{this.markElementAsDisabled(a,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((a,l)=>this._balanceNamespaceList(a,l)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let a=0;a<this.collectedEnterElements.length;a++)Ha(this.collectedEnterElements[a],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const a=[];try{t=this._flushAnimations(a,e)}finally{for(let l=0;l<a.length;l++)a[l]()}}else for(let a=0;a<this.collectedLeaveElements.length;a++)this.processLeaveNode(this.collectedLeaveElements[a]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(a=>a()),this._flushFns=[],this._whenQuietFns.length){const a=this._whenQuietFns;this._whenQuietFns=[],t.length?jh(t).onDone(()=>{a.forEach(l=>l())}):a.forEach(l=>l())}}reportError(e){throw function cH(r){return new pe(3402,!1)}()}_flushAnimations(e,t){const a=new XO,l=[],u=new Map,f=[],g=new Map,v=new Map,b=new Map,D=new Set;this.disabledNodes.forEach(Ve=>{D.add(Ve);const it=this.driver.query(Ve,".ng-animate-queued",!0);for(let mt=0;mt<it.length;mt++)D.add(it[mt])});const L=this.bodyNode,j=Array.from(this.statesByElement.keys()),G=nB(j,this.collectedEnterElements),q=new Map;let ie=0;G.forEach((Ve,it)=>{const mt=u2+ie++;q.set(it,mt),Ve.forEach(Sn=>Ha(Sn,mt))});const ce=[],Ce=new Set,we=new Set;for(let Ve=0;Ve<this.collectedLeaveElements.length;Ve++){const it=this.collectedLeaveElements[Ve],mt=it[ja];mt&&mt.setForRemoval&&(ce.push(it),Ce.add(it),mt.hasAnimation?this.driver.query(it,".ng-star-inserted",!0).forEach(Sn=>Ce.add(Sn)):we.add(it))}const ue=new Map,Fe=nB(j,Array.from(Ce));Fe.forEach((Ve,it)=>{const mt=BO+ie++;ue.set(it,mt),Ve.forEach(Sn=>Ha(Sn,mt))}),e.push(()=>{G.forEach((Ve,it)=>{const mt=q.get(it);Ve.forEach(Sn=>py(Sn,mt))}),Fe.forEach((Ve,it)=>{const mt=ue.get(it);Ve.forEach(Sn=>py(Sn,mt))}),ce.forEach(Ve=>{this.processLeaveNode(Ve)})});const Vt=[],pn=[];for(let Ve=this._namespaceList.length-1;Ve>=0;Ve--)this._namespaceList[Ve].drainQueuedTransitions(t).forEach(mt=>{const Sn=mt.player,Gr=mt.element;if(Vt.push(Sn),this.collectedEnterElements.length){const No=Gr[ja];if(No&&No.setForMove){if(No.previousTriggersValues&&No.previousTriggersValues.has(mt.triggerName)){const Lm=No.previousTriggersValues.get(mt.triggerName),za=this.statesByElement.get(mt.element);if(za&&za.has(mt.triggerName)){const IN=za.get(mt.triggerName);IN.value=Lm,za.set(mt.triggerName,IN)}}return void Sn.destroy()}}const Rl=!L||!this.driver.containsElement(L,Gr),aa=ue.get(Gr),qh=q.get(Gr),Di=this._buildInstruction(mt,a,qh,aa,Rl);if(Di.errors&&Di.errors.length)return void pn.push(Di);if(Rl)return Sn.onStart(()=>wm(Gr,Di.fromStyles)),Sn.onDestroy(()=>Tl(Gr,Di.toStyles)),void l.push(Sn);if(mt.isFallbackTransition)return Sn.onStart(()=>wm(Gr,Di.fromStyles)),Sn.onDestroy(()=>Tl(Gr,Di.toStyles)),void l.push(Sn);const Rj=[];Di.timelines.forEach(No=>{No.stretchStartingKeyframe=!0,this.disabledNodes.has(No.element)||Rj.push(No)}),Di.timelines=Rj,a.append(Gr,Di.timelines),f.push({instruction:Di,player:Sn,element:Gr}),Di.queriedElements.forEach(No=>na(g,No,[]).push(Sn)),Di.preStyleProps.forEach((No,Lm)=>{if(No.size){let za=v.get(Lm);za||v.set(Lm,za=new Set),No.forEach((IN,cF)=>za.add(cF))}}),Di.postStyleProps.forEach((No,Lm)=>{let za=b.get(Lm);za||b.set(Lm,za=new Set),No.forEach((IN,cF)=>za.add(cF))})});if(pn.length){const Ve=[];pn.forEach(it=>{Ve.push(function lH(r,e){return new pe(3505,!1)}())}),Vt.forEach(it=>it.destroy()),this.reportError(Ve)}const Ai=new Map,ra=new Map;f.forEach(Ve=>{const it=Ve.element;a.has(it)&&(ra.set(it,it),this._beforeAnimationBuild(Ve.player.namespaceId,Ve.instruction,Ai))}),l.forEach(Ve=>{const it=Ve.element;this._getPreviousPlayers(it,!1,Ve.namespaceId,Ve.triggerName,null).forEach(Sn=>{na(Ai,it,[]).push(Sn),Sn.destroy()})});const oa=ce.filter(Ve=>rB(Ve,v,b)),sa=new Map;tB(sa,this.driver,we,b,Qd).forEach(Ve=>{rB(Ve,v,b)&&oa.push(Ve)});const nu=new Map;G.forEach((Ve,it)=>{tB(nu,this.driver,new Set(Ve),v,"!")}),oa.forEach(Ve=>{const it=sa.get(Ve),mt=nu.get(Ve);sa.set(Ve,new Map([...Array.from(it?.entries()??[]),...Array.from(mt?.entries()??[])]))});const Lc=[],by=[],Ty={};f.forEach(Ve=>{const{element:it,player:mt,instruction:Sn}=Ve;if(a.has(it)){if(D.has(it))return mt.onDestroy(()=>Tl(it,Sn.toStyles)),mt.disabled=!0,mt.overrideTotalTime(Sn.totalTime),void l.push(mt);let Gr=Ty;if(ra.size>1){let aa=it;const qh=[];for(;aa=aa.parentNode;){const Di=ra.get(aa);if(Di){Gr=Di;break}qh.push(aa)}qh.forEach(Di=>ra.set(Di,Gr))}const Rl=this._buildAnimation(mt.namespaceId,Sn,Ai,u,nu,sa);if(mt.setRealPlayer(Rl),Gr===Ty)Lc.push(mt);else{const aa=this.playersByElement.get(Gr);aa&&aa.length&&(mt.parentPlayer=jh(aa)),l.push(mt)}}else wm(it,Sn.fromStyles),mt.onDestroy(()=>Tl(it,Sn.toStyles)),by.push(mt),D.has(it)&&l.push(mt)}),by.forEach(Ve=>{const it=u.get(Ve.element);if(it&&it.length){const mt=jh(it);Ve.setRealPlayer(mt)}}),l.forEach(Ve=>{Ve.parentPlayer?Ve.syncPlayerEvents(Ve.parentPlayer):Ve.destroy()});for(let Ve=0;Ve<ce.length;Ve++){const it=ce[Ve],mt=it[ja];if(py(it,BO),mt&&mt.hasAnimation)continue;let Sn=[];if(g.size){let Rl=g.get(it);Rl&&Rl.length&&Sn.push(...Rl);let aa=this.driver.query(it,h2,!0);for(let qh=0;qh<aa.length;qh++){let Di=g.get(aa[qh]);Di&&Di.length&&Sn.push(...Di)}}const Gr=Sn.filter(Rl=>!Rl.destroyed);Gr.length?h8(this,it,Gr):this.processLeaveNode(it)}return ce.length=0,Lc.forEach(Ve=>{this.players.push(Ve),Ve.onDone(()=>{Ve.destroy();const it=this.players.indexOf(Ve);this.players.splice(it,1)}),Ve.play()}),Lc}elementContainsData(e,t){let a=!1;const l=t[ja];return l&&l.setForRemoval&&(a=!0),this.playersByElement.has(t)&&(a=!0),this.playersByQueriedElement.has(t)&&(a=!0),this.statesByElement.has(t)&&(a=!0),this._fetchNamespace(e).elementContainsData(t)||a}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,a,l,u){let f=[];if(t){const g=this.playersByQueriedElement.get(e);g&&(f=g)}else{const g=this.playersByElement.get(e);if(g){const v=!u||u==PT;g.forEach(b=>{b.queued||!v&&b.triggerName!=l||f.push(b)})}}return(a||l)&&(f=f.filter(g=>!(a&&a!=g.namespaceId||l&&l!=g.triggerName))),f}_beforeAnimationBuild(e,t,a){const u=t.element,f=t.isRemovalTransition?void 0:e,g=t.isRemovalTransition?void 0:t.triggerName;for(const v of t.timelines){const b=v.element,D=b!==u,L=na(a,b,[]);this._getPreviousPlayers(b,D,f,g,t.toState).forEach(G=>{const q=G.getRealPlayer();q.beforeDestroy&&q.beforeDestroy(),G.destroy(),L.push(G)})}wm(u,t.fromStyles)}_buildAnimation(e,t,a,l,u,f){const g=t.triggerName,v=t.element,b=[],D=new Set,L=new Set,j=t.timelines.map(q=>{const ie=q.element;D.add(ie);const ce=ie[ja];if(ce&&ce.removedBeforeQueried)return new AT(q.duration,q.delay);const Ce=ie!==v,we=function p8(r){const e=[];return iB(r,e),e}((a.get(ie)||o8).map(Ai=>Ai.getRealPlayer())).filter(Ai=>!!Ai.element&&Ai.element===ie),ue=u.get(ie),Fe=f.get(ie),Vt=D3(0,this._normalizer,0,q.keyframes,ue,Fe),pn=this._buildPlayer(q,Vt,we);if(q.subTimeline&&l&&L.add(ie),Ce){const Ai=new R2(e,g,ie);Ai.setRealPlayer(pn),b.push(Ai)}return pn});b.forEach(q=>{na(this.playersByQueriedElement,q.element,[]).push(q),q.onDone(()=>function l8(r,e,t){let a=r.get(e);if(a){if(a.length){const l=a.indexOf(t);a.splice(l,1)}0==a.length&&r.delete(e)}return a}(this.playersByQueriedElement,q.element,q))}),D.forEach(q=>Ha(q,U3));const G=jh(j);return G.onDestroy(()=>{D.forEach(q=>py(q,U3)),Tl(v,t.toStyles)}),L.forEach(q=>{na(l,q,[]).push(G)}),G}_buildPlayer(e,t,a){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,a):new AT(e.duration,e.delay)}}class R2{constructor(e,t,a){this.namespaceId=e,this.triggerName=t,this.element=a,this._player=new AT,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,a)=>{t.forEach(l=>o2(e,a,void 0,l))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){na(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function ZO(r){return r&&1===r.nodeType}function eB(r,e){const t=r.style.display;return r.style.display=e??"none",t}function tB(r,e,t,a,l){const u=[];t.forEach(v=>u.push(eB(v)));const f=[];a.forEach((v,b)=>{const D=new Map;v.forEach(L=>{const j=e.computeStyle(b,L,l);D.set(L,j),(!j||0==j.length)&&(b[ja]=s8,f.push(b))}),r.set(b,D)});let g=0;return t.forEach(v=>eB(v,u[g++])),f}function nB(r,e){const t=new Map;if(r.forEach(g=>t.set(g,[])),0==e.length)return t;const l=new Set(e),u=new Map;function f(g){if(!g)return 1;let v=u.get(g);if(v)return v;const b=g.parentNode;return v=t.has(b)?b:l.has(b)?1:f(b),u.set(g,v),v}return e.forEach(g=>{const v=f(g);1!==v&&t.get(v).push(g)}),t}function Ha(r,e){r.classList?.add(e)}function py(r,e){r.classList?.remove(e)}function h8(r,e,t){jh(t).onDone(()=>r.processLeaveNode(e))}function iB(r,e){for(let t=0;t<r.length;t++){const a=r[t];a instanceof e3?iB(a.players,e):e.push(a)}}function rB(r,e,t){const a=t.get(r);if(!a)return!1;let l=e.get(r);return l?a.forEach(u=>l.add(u)):e.set(r,a),t.delete(r),!0}class eN{constructor(e,t,a){this.bodyNode=e,this._driver=t,this._normalizer=a,this._triggerCache={},this.onRemovalComplete=(l,u)=>{},this._transitionEngine=new c8(e,t,a),this._timelineEngine=new e8(e,t,a),this._transitionEngine.onRemovalComplete=(l,u)=>this.onRemovalComplete(l,u)}registerTrigger(e,t,a,l,u){const f=e+"-"+l;let g=this._triggerCache[f];if(!g){const v=[],D=_2(this._driver,u,v,[]);if(v.length)throw function Q6(r,e){return new pe(3404,!1)}();g=function XH(r,e,t){return new JH(r,e,t)}(l,D,this._normalizer),this._triggerCache[f]=g}this._transitionEngine.registerTrigger(t,l,g)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,a,l){this._transitionEngine.insertNode(e,t,a,l)}onRemove(e,t,a,l){this._transitionEngine.removeNode(e,t,l||!1,a)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,a,l){if("@"==a.charAt(0)){const[u,f]=O3(a);this._timelineEngine.command(u,t,f,l)}else this._transitionEngine.trigger(e,t,a,l)}listen(e,t,a,l,u){if("@"==a.charAt(0)){const[f,g]=O3(a);return this._timelineEngine.listen(f,t,g,u)}return this._transitionEngine.listen(e,t,a,l,u)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let _8=(()=>{class r{constructor(t,a,l){this._element=t,this._startStyles=a,this._endStyles=l,this._state=0;let u=r.initialStylesByElement.get(t);u||r.initialStylesByElement.set(t,u=new Map),this._initialStyles=u}start(){this._state<1&&(this._startStyles&&Tl(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Tl(this._element,this._initialStyles),this._endStyles&&(Tl(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(r.initialStylesByElement.delete(this._element),this._startStyles&&(wm(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(wm(this._element,this._endStyles),this._endStyles=null),Tl(this._element,this._initialStyles),this._state=3)}}return r.initialStylesByElement=new WeakMap,r})();function w2(r){let e=null;return r.forEach((t,a)=>{(function g8(r){return"display"===r||"position"===r})(a)&&(e=e||new Map,e.set(a,t))}),e}class oB{constructor(e,t,a,l){this.element=e,this.keyframes=t,this.options=a,this._specialStyles=l,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=a.duration,this._delay=a.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){const t=[];return e.forEach(a=>{t.push(Object.fromEntries(a))}),t}_triggerWebAnimation(e,t,a){return e.animate(this._convertKeyframesToObject(t),a)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((a,l)=>{"offset"!==l&&e.set(l,this._finished?a:W3(this.element,l))}),this.currentSnapshot=e}triggerCallback(e){const t="start"===e?this._onStartFns:this._onDoneFns;t.forEach(a=>a()),t.length=0}}class E8{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}matchesElement(e,t){return!1}containsElement(e,t){return k3(e,t)}getParentElement(e){return l2(e)}query(e,t,a){return L3(e,t,a)}computeStyle(e,t,a){return window.getComputedStyle(e)[t]}animate(e,t,a,l,u,f=[]){const v={duration:a,delay:l,fill:0==l?"both":"forwards"};u&&(v.easing=u);const b=new Map,D=f.filter(G=>G instanceof oB);(function CH(r,e){return 0===r||0===e})(a,l)&&D.forEach(G=>{G.currentSnapshot.forEach((q,ie)=>b.set(ie,q))});let L=function EH(r){return r.length?r[0]instanceof Map?r:r.map(e=>V3(e)):[]}(t).map(G=>Hh(G));L=function bH(r,e,t){if(t.size&&e.length){let a=e[0],l=[];if(t.forEach((u,f)=>{a.has(f)||l.push(f),a.set(f,u)}),l.length)for(let u=1;u<e.length;u++){let f=e[u];l.forEach(g=>f.set(g,W3(r,g)))}}return e}(e,L,b);const j=function m8(r,e){let t=null,a=null;return Array.isArray(e)&&e.length?(t=w2(e[0]),e.length>1&&(a=w2(e[e.length-1]))):e instanceof Map&&(t=w2(e)),t||a?new _8(r,t,a):null}(e,L);return new oB(e,L,v,j)}}let y8=(()=>{class r extends JV{constructor(t,a){super(),this._nextAnimationId=0,this._renderer=t.createRenderer(a.body,{id:"0",encapsulation:Rr.None,styles:[],data:{animation:[]}})}build(t){const a=this._nextAnimationId.toString();this._nextAnimationId++;const l=Array.isArray(t)?QV(t):t;return sB(this._renderer,null,a,"register",[l]),new v8(a,this._renderer)}}return r.\u0275fac=function(t){return new(t||r)(he(Fu),he(rn))},r.\u0275prov=ke({token:r,factory:r.\u0275fac}),r})();class v8 extends class j4{}{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new S8(this._id,e,t||{},this._renderer)}}class S8{constructor(e,t,a,l){this.id=e,this.element=t,this._renderer=l,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",a)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return sB(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function sB(r,e,t,a,l){return r.setProperty(e,`@@${t}:${a}`,l)}const aB="@.disabled";let C8=(()=>{class r{constructor(t,a,l){this.delegate=t,this.engine=a,this._zone=l,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),a.onRemovalComplete=(u,f)=>{const g=f?.parentNode(u);g&&f.removeChild(g,u)}}createRenderer(t,a){const u=this.delegate.createRenderer(t,a);if(!(t&&a&&a.data&&a.data.animation)){let D=this._rendererCache.get(u);return D||(D=new cB("",u,this.engine,()=>this._rendererCache.delete(u)),this._rendererCache.set(u,D)),D}const f=a.id,g=a.id+"-"+this._currentId;this._currentId++,this.engine.register(g,t);const v=D=>{Array.isArray(D)?D.forEach(v):this.engine.registerTrigger(f,g,t,D.name,D)};return a.data.animation.forEach(v),new b8(this,g,u,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(t,a,l){t>=0&&t<this._microtaskId?this._zone.run(()=>a(l)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(u=>{const[f,g]=u;f(g)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([a,l]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return r.\u0275fac=function(t){return new(t||r)(he(Fu),he(eN),he(Ht))},r.\u0275prov=ke({token:r,factory:r.\u0275fac}),r})();class cB{constructor(e,t,a,l){this.namespaceId=e,this.delegate=t,this.engine=a,this._onDestroy=l,this.destroyNode=this.delegate.destroyNode?u=>t.destroyNode(u):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,a,l=!0){this.delegate.insertBefore(e,t,a),this.engine.onInsert(this.namespaceId,t,e,l)}removeChild(e,t,a){this.engine.onRemove(this.namespaceId,t,this.delegate,a)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,a,l){this.delegate.setAttribute(e,t,a,l)}removeAttribute(e,t,a){this.delegate.removeAttribute(e,t,a)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,a,l){this.delegate.setStyle(e,t,a,l)}removeStyle(e,t,a){this.delegate.removeStyle(e,t,a)}setProperty(e,t,a){"@"==t.charAt(0)&&t==aB?this.disableAnimations(e,!!a):this.delegate.setProperty(e,t,a)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,a){return this.delegate.listen(e,t,a)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class b8 extends cB{constructor(e,t,a,l,u){super(t,a,l,u),this.factory=e,this.namespaceId=t}setProperty(e,t,a){"@"==t.charAt(0)?"."==t.charAt(1)&&t==aB?this.disableAnimations(e,a=void 0===a||!!a):this.engine.process(this.namespaceId,e,t.slice(1),a):this.delegate.setProperty(e,t,a)}listen(e,t,a){if("@"==t.charAt(0)){const l=function T8(r){switch(r){case"body":return document.body;case"document":return document;case"window":return window;default:return r}}(e);let u=t.slice(1),f="";return"@"!=u.charAt(0)&&([u,f]=function I8(r){const e=r.indexOf(".");return[r.substring(0,e),r.slice(e+1)]}(u)),this.engine.listen(this.namespaceId,l,u,f,g=>{this.factory.scheduleListenerCallback(g._data||-1,a,g)})}return this.delegate.listen(e,t,a)}}let R8=(()=>{class r extends eN{constructor(t,a,l,u){super(t.body,a,l)}ngOnDestroy(){this.flush()}}return r.\u0275fac=function(t){return new(t||r)(he(rn),he(d2),he(S2),he(bd))},r.\u0275prov=ke({token:r,factory:r.\u0275fac}),r})();const lB=[{provide:JV,useClass:y8},{provide:S2,useFactory:function w8(){return new KH}},{provide:eN,useClass:R8},{provide:Fu,useFactory:function A8(r,e,t){return new C8(r,e,t)},deps:[em,eN,Ht]}],A2=[{provide:d2,useFactory:()=>new E8},{provide:$n,useValue:"BrowserAnimations"},...lB],dB=[{provide:d2,useClass:x3},{provide:$n,useValue:"NoopAnimations"},...lB];let D8=(()=>{class r{static withConfig(t){return{ngModule:r,providers:t.disableAnimations?dB:A2}}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({providers:A2,imports:[im]}),r})();const nN=(()=>{function r(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return r.prototype=Object.create(Error.prototype),r})();function uB(r){return new An(e=>{let t;try{t=r()}catch(l){return void e.error(l)}return(t?Oi(t):kO()).subscribe(e)})}function fy(r,e){return new An(e?t=>e.schedule(O8,0,{error:r,subscriber:t}):t=>t.error(r))}function O8({error:r,subscriber:e}){e.error(r)}function Ga(r,e){return"function"==typeof e?t=>t.pipe(Ga((a,l)=>Oi(r(a,l)).pipe(xt((u,f)=>e(a,u,l,f))))):t=>t.lift(new N8(r))}class N8{constructor(e){this.project=e}call(e,t){return t.subscribe(new P8(e,this.project))}}class P8 extends Qh{constructor(e,t){super(e),this.project=t,this.index=0}_next(e){let t;const a=this.index++;try{t=this.project(e,a)}catch(l){return void this.destination.error(l)}this._innerSub(t)}_innerSub(e){const t=this.innerSubscription;t&&t.unsubscribe();const a=new su(this),l=this.destination;l.add(a),this.innerSubscription=Dl(e,a),this.innerSubscription!==a&&l.add(this.innerSubscription)}_complete(){const{innerSubscription:e}=this;(!e||e.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(e){this.destination.next(e)}}function iN(r=null){return e=>e.lift(new M8(r))}class M8{constructor(e){this.defaultValue=e}call(e,t){return t.subscribe(new k8(e,this.defaultValue))}}class k8 extends bn{constructor(e,t){super(e),this.defaultValue=t,this.isEmpty=!0}_next(e){this.isEmpty=!1,this.destination.next(e)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function hB(r=F8){return e=>e.lift(new L8(r))}class L8{constructor(e){this.errorFactory=e}call(e,t){return t.subscribe(new x8(e,this.errorFactory))}}class x8 extends bn{constructor(e,t){super(e),this.errorFactory=t,this.hasValue=!1}_next(e){this.hasValue=!0,this.destination.next(e)}_complete(){if(this.hasValue)return this.destination.complete();{let e;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)}}}function F8(){return new nN}function Gh(r,e){const t=arguments.length>=2;return a=>a.pipe(r?bl((l,u)=>r(l,u,a)):$h,ho(1),t?iN(e):hB(()=>new nN))}function Dm(r,e){return Wi(r,e,1)}function Wh(){}function Hr(r,e,t){return function(l){return l.lift(new U8(r,e,t))}}class U8{constructor(e,t,a){this.nextOrObserver=e,this.error=t,this.complete=a}call(e,t){return t.subscribe(new V8(e,this.nextOrObserver,this.error,this.complete))}}class V8 extends bn{constructor(e,t,a,l){super(e),this._tapNext=Wh,this._tapError=Wh,this._tapComplete=Wh,this._tapError=a||Wh,this._tapComplete=l||Wh,x(t)?(this._context=this,this._tapNext=t):t&&(this._context=t,this._tapNext=t.next||Wh,this._tapError=t.error||Wh,this._tapComplete=t.complete||Wh)}_next(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)}_error(e){try{this._tapError.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.error(e)}_complete(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}function Om(r){return function(t){const a=new B8(r),l=t.lift(a);return a.caught=l}}class B8{constructor(e){this.selector=e}call(e,t){return t.subscribe(new j8(e,this.selector,this.caught))}}class j8 extends Qh{constructor(e,t,a){super(e),this.selector=t,this.caught=a}error(e){if(!this.isStopped){let t;try{t=this.selector(e,this.caught)}catch(u){return void super.error(u)}this._unsubscribeAndRecycle();const a=new su(this);this.add(a);const l=Dl(t,a);l!==a&&this.add(l)}}}function pB(r,e){let t=!1;return arguments.length>=2&&(t=!0),function(l){return l.lift(new H8(r,e,t))}}class H8{constructor(e,t,a=!1){this.accumulator=e,this.seed=t,this.hasSeed=a}call(e,t){return t.subscribe(new G8(e,this.accumulator,this.seed,this.hasSeed))}}class G8 extends bn{constructor(e,t,a,l){super(e),this.accumulator=t,this._seed=a,this.hasSeed=l,this.index=0}get seed(){return this._seed}set seed(e){this.hasSeed=!0,this._seed=e}_next(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}_tryNext(e){const t=this.index++;let a;try{a=this.accumulator(this.seed,e,t)}catch(l){this.destination.error(l)}this.seed=a,this.destination.next(a)}}function D2(r){return function(t){return 0===r?kO():t.lift(new W8(r))}}class W8{constructor(e){if(this.total=e,this.total<0)throw new IV}call(e,t){return t.subscribe(new z8(e,this.total))}}class z8 extends bn{constructor(e,t){super(e),this.total=t,this.ring=new Array,this.count=0}_next(e){const t=this.ring,a=this.total,l=this.count++;t.length<a?t.push(e):t[l%a]=e}_complete(){const e=this.destination;let t=this.count;if(t>0){const a=this.count>=this.total?this.total:this.count,l=this.ring;for(let u=0;u<a;u++){const f=t++%a;e.next(l[f])}}e.complete()}}function fB(r,e){const t=arguments.length>=2;return a=>a.pipe(r?bl((l,u)=>r(l,u,a)):$h,D2(1),t?iN(e):hB(()=>new nN))}class q8{constructor(e,t){this.predicate=e,this.inclusive=t}call(e,t){return t.subscribe(new Y8(e,this.predicate,this.inclusive))}}class Y8 extends bn{constructor(e,t,a){super(e),this.predicate=t,this.inclusive=a,this.index=0}_next(e){const t=this.destination;let a;try{a=this.predicate(e,this.index++)}catch(l){return void t.error(l)}this.nextOrComplete(e,a)}nextOrComplete(e,t){const a=this.destination;Boolean(t)?a.next(e):(this.inclusive&&a.next(e),a.complete())}}class X8{constructor(e){this.value=e}call(e,t){return t.subscribe(new J8(e,this.value))}}class J8 extends bn{constructor(e,t){super(e),this.value=t}_next(e){this.destination.next(this.value)}}function O2(r){return e=>e.lift(new Q8(r))}class Q8{constructor(e){this.callback=e}call(e,t){return t.subscribe(new Z8(e,this.callback))}}class Z8 extends bn{constructor(e,t){super(e),this.add(new Cn(t))}}const Gt="primary",MT=Symbol("RouteTitle");class eG{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function my(r){return new eG(r)}function tG(r,e,t){const a=t.path.split("/");if(a.length>r.length||"full"===t.pathMatch&&(e.hasChildren()||a.length<r.length))return null;const l={};for(let u=0;u<a.length;u++){const f=a[u],g=r[u];if(f.startsWith(":"))l[f.substring(1)]=g;else if(f!==g.path)return null}return{consumed:r.slice(0,a.length),posParams:l}}function Il(r,e){const t=r?Object.keys(r):void 0,a=e?Object.keys(e):void 0;if(!t||!a||t.length!=a.length)return!1;let l;for(let u=0;u<t.length;u++)if(l=t[u],!mB(r[l],e[l]))return!1;return!0}function mB(r,e){if(Array.isArray(r)&&Array.isArray(e)){if(r.length!==e.length)return!1;const t=[...r].sort(),a=[...e].sort();return t.every((l,u)=>a[u]===l)}return r===e}function _B(r){return Array.prototype.concat.apply([],r)}function gB(r){return r.length>0?r[r.length-1]:null}function po(r,e){for(const t in r)r.hasOwnProperty(t)&&e(r[t],t)}function zh(r){return jS(r)?r:ld(r)?Oi(Promise.resolve(r)):S(r)}const rG={exact:function vB(r,e,t){if(!Pm(r.segments,e.segments)||!rN(r.segments,e.segments,t)||r.numberOfChildren!==e.numberOfChildren)return!1;for(const a in e.children)if(!r.children[a]||!vB(r.children[a],e.children[a],t))return!1;return!0},subset:SB},EB={exact:function oG(r,e){return Il(r,e)},subset:function sG(r,e){return Object.keys(e).length<=Object.keys(r).length&&Object.keys(e).every(t=>mB(r[t],e[t]))},ignored:()=>!0};function yB(r,e,t){return rG[t.paths](r.root,e.root,t.matrixParams)&&EB[t.queryParams](r.queryParams,e.queryParams)&&!("exact"===t.fragment&&r.fragment!==e.fragment)}function SB(r,e,t){return CB(r,e,e.segments,t)}function CB(r,e,t,a){if(r.segments.length>t.length){const l=r.segments.slice(0,t.length);return!(!Pm(l,t)||e.hasChildren()||!rN(l,t,a))}if(r.segments.length===t.length){if(!Pm(r.segments,t)||!rN(r.segments,t,a))return!1;for(const l in e.children)if(!r.children[l]||!SB(r.children[l],e.children[l],a))return!1;return!0}{const l=t.slice(0,r.segments.length),u=t.slice(r.segments.length);return!!(Pm(r.segments,l)&&rN(r.segments,l,a)&&r.children[Gt])&&CB(r.children[Gt],e,u,a)}}function rN(r,e,t){return e.every((a,l)=>EB[t](r[l].parameters,a.parameters))}class Nm{constructor(e,t,a){this.root=e,this.queryParams=t,this.fragment=a}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=my(this.queryParams)),this._queryParamMap}toString(){return lG.serialize(this)}}class $t{constructor(e,t){this.segments=e,this.children=t,this.parent=null,po(t,(a,l)=>a.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return oN(this)}}class kT{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=my(this.parameters)),this._parameterMap}toString(){return RB(this)}}function Pm(r,e){return r.length===e.length&&r.every((t,a)=>t.path===e[a].path)}let bB=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=ke({token:r,factory:function(){return new P2},providedIn:"root"}),r})();class P2{parse(e){const t=new EG(e);return new Nm(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){const t=`/${LT(e.root,!0)}`,a=function hG(r){const e=Object.keys(r).map(t=>{const a=r[t];return Array.isArray(a)?a.map(l=>`${sN(t)}=${sN(l)}`).join("&"):`${sN(t)}=${sN(a)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams),l="string"==typeof e.fragment?`#${function dG(r){return encodeURI(r)}(e.fragment)}`:"";return`${t}${a}${l}`}}const lG=new P2;function oN(r){return r.segments.map(e=>RB(e)).join("/")}function LT(r,e){if(!r.hasChildren())return oN(r);if(e){const t=r.children[Gt]?LT(r.children[Gt],!1):"",a=[];return po(r.children,(l,u)=>{u!==Gt&&a.push(`${u}:${LT(l,!1)}`)}),a.length>0?`${t}(${a.join("//")})`:t}{const t=function cG(r,e){let t=[];return po(r.children,(a,l)=>{l===Gt&&(t=t.concat(e(a,l)))}),po(r.children,(a,l)=>{l!==Gt&&(t=t.concat(e(a,l)))}),t}(r,(a,l)=>l===Gt?[LT(r.children[Gt],!1)]:[`${l}:${LT(a,!1)}`]);return 1===Object.keys(r.children).length&&null!=r.children[Gt]?`${oN(r)}/${t[0]}`:`${oN(r)}/(${t.join("//")})`}}function TB(r){return encodeURIComponent(r).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function sN(r){return TB(r).replace(/%3B/gi,";")}function M2(r){return TB(r).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function aN(r){return decodeURIComponent(r)}function IB(r){return aN(r.replace(/\+/g,"%20"))}function RB(r){return`${M2(r.path)}${function uG(r){return Object.keys(r).map(e=>`;${M2(e)}=${M2(r[e])}`).join("")}(r.parameters)}`}const pG=/^[^\/()?;=#]+/;function cN(r){const e=r.match(pG);return e?e[0]:""}const fG=/^[^=?&#]+/,_G=/^[^&#]+/;class EG{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new $t([],{}):new $t([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let a={};return this.peekStartsWith("(")&&(a=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(a[Gt]=new $t(e,t)),a}parseSegment(){const e=cN(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new pe(4009,!1);return this.capture(e),new kT(aN(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=cN(this.remaining);if(!t)return;this.capture(t);let a="";if(this.consumeOptional("=")){const l=cN(this.remaining);l&&(a=l,this.capture(a))}e[aN(t)]=aN(a)}parseQueryParam(e){const t=function mG(r){const e=r.match(fG);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let a="";if(this.consumeOptional("=")){const f=function gG(r){const e=r.match(_G);return e?e[0]:""}(this.remaining);f&&(a=f,this.capture(a))}const l=IB(t),u=IB(a);if(e.hasOwnProperty(l)){let f=e[l];Array.isArray(f)||(f=[f],e[l]=f),f.push(u)}else e[l]=u}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const a=cN(this.remaining),l=this.remaining[a.length];if("/"!==l&&")"!==l&&";"!==l)throw new pe(4010,!1);let u;a.indexOf(":")>-1?(u=a.slice(0,a.indexOf(":")),this.capture(u),this.capture(":")):e&&(u=Gt);const f=this.parseChildren();t[u]=1===Object.keys(f).length?f[Gt]:new $t([],f),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new pe(4011,!1)}}function k2(r){return r.segments.length>0?new $t([],{[Gt]:r}):r}function lN(r){const e={};for(const a of Object.keys(r.children)){const u=lN(r.children[a]);(u.segments.length>0||u.hasChildren())&&(e[a]=u)}return function yG(r){if(1===r.numberOfChildren&&r.children[Gt]){const e=r.children[Gt];return new $t(r.segments.concat(e.segments),e.children)}return r}(new $t(r.segments,e))}function Mm(r){return r instanceof Nm}function CG(r,e,t,a,l){if(0===t.length)return _y(e.root,e.root,e.root,a,l);const u=function DB(r){if("string"==typeof r[0]&&1===r.length&&"/"===r[0])return new AB(!0,0,r);let e=0,t=!1;const a=r.reduce((l,u,f)=>{if("object"==typeof u&&null!=u){if(u.outlets){const g={};return po(u.outlets,(v,b)=>{g[b]="string"==typeof v?v.split("/"):v}),[...l,{outlets:g}]}if(u.segmentPath)return[...l,u.segmentPath]}return"string"!=typeof u?[...l,u]:0===f?(u.split("/").forEach((g,v)=>{0==v&&"."===g||(0==v&&""===g?t=!0:".."===g?e++:""!=g&&l.push(g))}),l):[...l,u]},[]);return new AB(t,e,a)}(t);return u.toRoot()?_y(e.root,e.root,new $t([],{}),a,l):function f(v){const b=function TG(r,e,t,a){if(r.isAbsolute)return new gy(e.root,!0,0);if(-1===a)return new gy(t,t===e.root,0);return function OB(r,e,t){let a=r,l=e,u=t;for(;u>l;){if(u-=l,a=a.parent,!a)throw new pe(4005,!1);l=a.segments.length}return new gy(a,!1,l-u)}(t,a+(xT(r.commands[0])?0:1),r.numberOfDoubleDots)}(u,e,r.snapshot?._urlSegment,v),D=b.processChildren?UT(b.segmentGroup,b.index,u.commands):x2(b.segmentGroup,b.index,u.commands);return _y(e.root,b.segmentGroup,D,a,l)}(r.snapshot?._lastPathIndex)}function xT(r){return"object"==typeof r&&null!=r&&!r.outlets&&!r.segmentPath}function FT(r){return"object"==typeof r&&null!=r&&r.outlets}function _y(r,e,t,a,l){let f,u={};a&&po(a,(v,b)=>{u[b]=Array.isArray(v)?v.map(D=>`${D}`):`${v}`}),f=r===e?t:wB(r,e,t);const g=k2(lN(f));return new Nm(g,u,l)}function wB(r,e,t){const a={};return po(r.children,(l,u)=>{a[u]=l===e?t:wB(l,e,t)}),new $t(r.segments,a)}class AB{constructor(e,t,a){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=a,e&&a.length>0&&xT(a[0]))throw new pe(4003,!1);const l=a.find(FT);if(l&&l!==gB(a))throw new pe(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class gy{constructor(e,t,a){this.segmentGroup=e,this.processChildren=t,this.index=a}}function x2(r,e,t){if(r||(r=new $t([],{})),0===r.segments.length&&r.hasChildren())return UT(r,e,t);const a=function RG(r,e,t){let a=0,l=e;const u={match:!1,pathIndex:0,commandIndex:0};for(;l<r.segments.length;){if(a>=t.length)return u;const f=r.segments[l],g=t[a];if(FT(g))break;const v=`${g}`,b=a<t.length-1?t[a+1]:null;if(l>0&&void 0===v)break;if(v&&b&&"object"==typeof b&&void 0===b.outlets){if(!PB(v,b,f))return u;a+=2}else{if(!PB(v,{},f))return u;a++}l++}return{match:!0,pathIndex:l,commandIndex:a}}(r,e,t),l=t.slice(a.commandIndex);if(a.match&&a.pathIndex<r.segments.length){const u=new $t(r.segments.slice(0,a.pathIndex),{});return u.children[Gt]=new $t(r.segments.slice(a.pathIndex),r.children),UT(u,0,l)}return a.match&&0===l.length?new $t(r.segments,{}):a.match&&!r.hasChildren()?F2(r,e,t):a.match?UT(r,0,l):F2(r,e,t)}function UT(r,e,t){if(0===t.length)return new $t(r.segments,{});{const a=function IG(r){return FT(r[0])?r[0].outlets:{[Gt]:r}}(t),l={};return po(a,(u,f)=>{"string"==typeof u&&(u=[u]),null!==u&&(l[f]=x2(r.children[f],e,u))}),po(r.children,(u,f)=>{void 0===a[f]&&(l[f]=u)}),new $t(r.segments,l)}}function F2(r,e,t){const a=r.segments.slice(0,e);let l=0;for(;l<t.length;){const u=t[l];if(FT(u)){const v=wG(u.outlets);return new $t(a,v)}if(0===l&&xT(t[0])){a.push(new kT(r.segments[e].path,NB(t[0]))),l++;continue}const f=FT(u)?u.outlets[Gt]:`${u}`,g=l<t.length-1?t[l+1]:null;f&&g&&xT(g)?(a.push(new kT(f,NB(g))),l+=2):(a.push(new kT(f,{})),l++)}return new $t(a,{})}function wG(r){const e={};return po(r,(t,a)=>{"string"==typeof t&&(t=[t]),null!==t&&(e[a]=F2(new $t([],{}),0,t))}),e}function NB(r){const e={};return po(r,(t,a)=>e[a]=`${t}`),e}function PB(r,e,t){return r==t.path&&Il(e,t.parameters)}class eu{constructor(e,t){this.id=e,this.url=t}}class U2 extends eu{constructor(e,t,a="imperative",l=null){super(e,t),this.type=0,this.navigationTrigger=a,this.restoredState=l}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class km extends eu{constructor(e,t,a){super(e,t),this.urlAfterRedirects=a,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class dN extends eu{constructor(e,t,a,l){super(e,t),this.reason=a,this.code=l,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class MB extends eu{constructor(e,t,a,l){super(e,t),this.error=a,this.target=l,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class AG extends eu{constructor(e,t,a,l){super(e,t),this.urlAfterRedirects=a,this.state=l,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class DG extends eu{constructor(e,t,a,l){super(e,t),this.urlAfterRedirects=a,this.state=l,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class OG extends eu{constructor(e,t,a,l,u){super(e,t),this.urlAfterRedirects=a,this.state=l,this.shouldActivate=u,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class NG extends eu{constructor(e,t,a,l){super(e,t),this.urlAfterRedirects=a,this.state=l,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class PG extends eu{constructor(e,t,a,l){super(e,t),this.urlAfterRedirects=a,this.state=l,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class MG{constructor(e){this.route=e,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class kG{constructor(e){this.route=e,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class LG{constructor(e){this.snapshot=e,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class xG{constructor(e){this.snapshot=e,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class FG{constructor(e){this.snapshot=e,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class UG{constructor(e){this.snapshot=e,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class kB{constructor(e,t,a){this.routerEvent=e,this.position=t,this.anchor=a,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class LB{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=V2(e,this._root);return t?t.children.map(a=>a.value):[]}firstChild(e){const t=V2(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=B2(e,this._root);return t.length<2?[]:t[t.length-2].children.map(l=>l.value).filter(l=>l!==e)}pathFromRoot(e){return B2(e,this._root).map(t=>t.value)}}function V2(r,e){if(r===e.value)return e;for(const t of e.children){const a=V2(r,t);if(a)return a}return null}function B2(r,e){if(r===e.value)return[e];for(const t of e.children){const a=B2(r,t);if(a.length)return a.unshift(e),a}return[]}class tu{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function Ey(r){const e={};return r&&r.children.forEach(t=>e[t.value.outlet]=t),e}class xB extends LB{constructor(e,t){super(e),this.snapshot=t,j2(this,e)}toString(){return this.snapshot.toString()}}function FB(r,e){const t=function BG(r,e){const f=new uN([],{},{},"",{},Gt,e,null,r.root,-1,{});return new VB("",new tu(f,[]))}(r,e),a=new y([new kT("",{})]),l=new y({}),u=new y({}),f=new y({}),g=new y(""),v=new Kh(a,l,f,g,u,Gt,e,t.root);return v.snapshot=t.root,new xB(new tu(v,[]),t)}class Kh{constructor(e,t,a,l,u,f,g,v){this.url=e,this.params=t,this.queryParams=a,this.fragment=l,this.data=u,this.outlet=f,this.component=g,this.title=this.data?.pipe(xt(b=>b[MT]))??S(void 0),this._futureSnapshot=v}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(xt(e=>my(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(xt(e=>my(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function UB(r,e="emptyOnly"){const t=r.pathFromRoot;let a=0;if("always"!==e)for(a=t.length-1;a>=1;){const l=t[a],u=t[a-1];if(l.routeConfig&&""===l.routeConfig.path)a--;else{if(u.component)break;a--}}return function jG(r){return r.reduce((e,t)=>({params:{...e.params,...t.params},data:{...e.data,...t.data},resolve:{...t.data,...e.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(a))}class uN{constructor(e,t,a,l,u,f,g,v,b,D,L,j){this.url=e,this.params=t,this.queryParams=a,this.fragment=l,this.data=u,this.outlet=f,this.component=g,this.title=this.data?.[MT],this.routeConfig=v,this._urlSegment=b,this._lastPathIndex=D,this._correctedLastPathIndex=j??D,this._resolve=L}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=my(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=my(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(a=>a.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class VB extends LB{constructor(e,t){super(t),this.url=e,j2(this,t)}toString(){return BB(this._root)}}function j2(r,e){e.value._routerState=r,e.children.forEach(t=>j2(r,t))}function BB(r){const e=r.children.length>0?` { ${r.children.map(BB).join(", ")} } `:"";return`${r.value}${e}`}function H2(r){if(r.snapshot){const e=r.snapshot,t=r._futureSnapshot;r.snapshot=t,Il(e.queryParams,t.queryParams)||r.queryParams.next(t.queryParams),e.fragment!==t.fragment&&r.fragment.next(t.fragment),Il(e.params,t.params)||r.params.next(t.params),function nG(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;++t)if(!Il(r[t],e[t]))return!1;return!0}(e.url,t.url)||r.url.next(t.url),Il(e.data,t.data)||r.data.next(t.data)}else r.snapshot=r._futureSnapshot,r.data.next(r._futureSnapshot.data)}function G2(r,e){const t=Il(r.params,e.params)&&function aG(r,e){return Pm(r,e)&&r.every((t,a)=>Il(t.parameters,e[a].parameters))}(r.url,e.url);return t&&!(!r.parent!=!e.parent)&&(!r.parent||G2(r.parent,e.parent))}function VT(r,e,t){if(t&&r.shouldReuseRoute(e.value,t.value.snapshot)){const a=t.value;a._futureSnapshot=e.value;const l=function GG(r,e,t){return e.children.map(a=>{for(const l of t.children)if(r.shouldReuseRoute(a.value,l.value.snapshot))return VT(r,a,l);return VT(r,a)})}(r,e,t);return new tu(a,l)}{if(r.shouldAttach(e.value)){const u=r.retrieve(e.value);if(null!==u){const f=u.route;return f.value._futureSnapshot=e.value,f.children=e.children.map(g=>VT(r,g)),f}}const a=function WG(r){return new Kh(new y(r.url),new y(r.params),new y(r.queryParams),new y(r.fragment),new y(r.data),r.outlet,r.component,r)}(e.value),l=e.children.map(u=>VT(r,u));return new tu(a,l)}}const W2="ngNavigationCancelingError";function jB(r,e){const{redirectTo:t,navigationBehaviorOptions:a}=Mm(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,l=HB(!1,0,e);return l.url=t,l.navigationBehaviorOptions=a,l}function HB(r,e,t){const a=new Error("NavigationCancelingError: "+(r||""));return a[W2]=!0,a.cancellationCode=e,t&&(a.url=t),a}function GB(r){return WB(r)&&Mm(r.url)}function WB(r){return r&&r[W2]}class zG{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new BT,this.attachRef=null}}let BT=(()=>{class r{constructor(){this.contexts=new Map}onChildOutletCreated(t,a){const l=this.getOrCreateContext(t);l.outlet=a,this.contexts.set(t,l)}onChildOutletDestroyed(t){const a=this.getContext(t);a&&(a.outlet=null,a.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let a=this.getContext(t);return a||(a=new zG,this.contexts.set(t,a)),a}getContext(t){return this.contexts.get(t)||null}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const hN=!1;let z2=(()=>{class r{constructor(t,a,l,u,f){this.parentContexts=t,this.location=a,this.changeDetector=u,this.environmentInjector=f,this.activated=null,this._activatedRoute=null,this.activateEvents=new un,this.deactivateEvents=new un,this.attachEvents=new un,this.detachEvents=new un,this.name=l||Gt,t.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.getContext(this.name)?.outlet===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new pe(4012,hN);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new pe(4012,hN);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new pe(4012,hN);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,a){this.activated=t,this._activatedRoute=a,this.location.insert(t.hostView),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,a){if(this.isActivated)throw new pe(4013,hN);this._activatedRoute=t;const l=this.location,f=t._futureSnapshot.component,g=this.parentContexts.getOrCreateContext(this.name).children,v=new KG(t,g,l.injector);if(a&&function qG(r){return!!r.resolveComponentFactory}(a)){const b=a.resolveComponentFactory(f);this.activated=l.createComponent(b,l.length,v)}else this.activated=l.createComponent(f,{index:l.length,injector:v,environmentInjector:a??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return r.\u0275fac=function(t){return new(t||r)(se(BT),se(Go),gu("name"),se(nn),se(Wc))},r.\u0275dir=Be({type:r,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0}),r})();class KG{constructor(e,t,a){this.route=e,this.childContexts=t,this.parent=a}get(e,t){return e===Kh?this.route:e===BT?this.childContexts:this.parent.get(e,t)}}let K2=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=qr({type:r,selectors:[["ng-component"]],standalone:!0,features:[gC],decls:1,vars:0,template:function(t,a){1&t&&tn(0,"router-outlet")},dependencies:[z2],encapsulation:2}),r})();function zB(r,e){return r.providers&&!r._injector&&(r._injector=mf(r.providers,e,`Route: ${r.path}`)),r._injector??e}function Y2(r){const e=r.children&&r.children.map(Y2),t=e?{...r,children:e}:{...r};return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==Gt&&(t.component=K2),t}function Wa(r){return r.outlet||Gt}function KB(r,e){const t=r.filter(a=>Wa(a)===e);return t.push(...r.filter(a=>Wa(a)!==e)),t}function jT(r){if(!r)return null;if(r.routeConfig?._injector)return r.routeConfig._injector;for(let e=r.parent;e;e=e.parent){const t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class QG{constructor(e,t,a,l){this.routeReuseStrategy=e,this.futureState=t,this.currState=a,this.forwardEvent=l}activate(e){const t=this.futureState._root,a=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,a,e),H2(this.futureState.root),this.activateChildRoutes(t,a,e)}deactivateChildRoutes(e,t,a){const l=Ey(t);e.children.forEach(u=>{const f=u.value.outlet;this.deactivateRoutes(u,l[f],a),delete l[f]}),po(l,(u,f)=>{this.deactivateRouteAndItsChildren(u,a)})}deactivateRoutes(e,t,a){const l=e.value,u=t?t.value:null;if(l===u)if(l.component){const f=a.getContext(l.outlet);f&&this.deactivateChildRoutes(e,t,f.children)}else this.deactivateChildRoutes(e,t,a);else u&&this.deactivateRouteAndItsChildren(t,a)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const a=t.getContext(e.value.outlet),l=a&&e.value.component?a.children:t,u=Ey(e);for(const f of Object.keys(u))this.deactivateRouteAndItsChildren(u[f],l);if(a&&a.outlet){const f=a.outlet.detach(),g=a.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:f,route:e,contexts:g})}}deactivateRouteAndOutlet(e,t){const a=t.getContext(e.value.outlet),l=a&&e.value.component?a.children:t,u=Ey(e);for(const f of Object.keys(u))this.deactivateRouteAndItsChildren(u[f],l);a&&a.outlet&&(a.outlet.deactivate(),a.children.onOutletDeactivated(),a.attachRef=null,a.resolver=null,a.route=null)}activateChildRoutes(e,t,a){const l=Ey(t);e.children.forEach(u=>{this.activateRoutes(u,l[u.value.outlet],a),this.forwardEvent(new UG(u.value.snapshot))}),e.children.length&&this.forwardEvent(new xG(e.value.snapshot))}activateRoutes(e,t,a){const l=e.value,u=t?t.value:null;if(H2(l),l===u)if(l.component){const f=a.getOrCreateContext(l.outlet);this.activateChildRoutes(e,t,f.children)}else this.activateChildRoutes(e,t,a);else if(l.component){const f=a.getOrCreateContext(l.outlet);if(this.routeReuseStrategy.shouldAttach(l.snapshot)){const g=this.routeReuseStrategy.retrieve(l.snapshot);this.routeReuseStrategy.store(l.snapshot,null),f.children.onOutletReAttached(g.contexts),f.attachRef=g.componentRef,f.route=g.route.value,f.outlet&&f.outlet.attach(g.componentRef,g.route.value),H2(g.route.value),this.activateChildRoutes(e,null,f.children)}else{const g=jT(l.snapshot),v=g?.get(td)??null;f.attachRef=null,f.route=l,f.resolver=v,f.injector=g,f.outlet&&f.outlet.activateWith(l,f.injector),this.activateChildRoutes(e,null,f.children)}}else this.activateChildRoutes(e,null,a)}}class qB{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class pN{constructor(e,t){this.component=e,this.route=t}}function ZG(r,e,t){const a=r._root;return HT(a,e?e._root:null,t,[a.value])}function yy(r,e){const t=Symbol(),a=e.get(r,t);return a===t?"function"!=typeof r||function PN(r){return null!==Zh(r)}(r)?e.get(r):r:a}function HT(r,e,t,a,l={canDeactivateChecks:[],canActivateChecks:[]}){const u=Ey(e);return r.children.forEach(f=>{(function tW(r,e,t,a,l={canDeactivateChecks:[],canActivateChecks:[]}){const u=r.value,f=e?e.value:null,g=t?t.getContext(r.value.outlet):null;if(f&&u.routeConfig===f.routeConfig){const v=function nW(r,e,t){if("function"==typeof t)return t(r,e);switch(t){case"pathParamsChange":return!Pm(r.url,e.url);case"pathParamsOrQueryParamsChange":return!Pm(r.url,e.url)||!Il(r.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!G2(r,e)||!Il(r.queryParams,e.queryParams);default:return!G2(r,e)}}(f,u,u.routeConfig.runGuardsAndResolvers);v?l.canActivateChecks.push(new qB(a)):(u.data=f.data,u._resolvedData=f._resolvedData),HT(r,e,u.component?g?g.children:null:t,a,l),v&&g&&g.outlet&&g.outlet.isActivated&&l.canDeactivateChecks.push(new pN(g.outlet.component,f))}else f&&GT(e,g,l),l.canActivateChecks.push(new qB(a)),HT(r,null,u.component?g?g.children:null:t,a,l)})(f,u[f.value.outlet],t,a.concat([f.value]),l),delete u[f.value.outlet]}),po(u,(f,g)=>GT(f,t.getContext(g),l)),l}function GT(r,e,t){const a=Ey(r),l=r.value;po(a,(u,f)=>{GT(u,l.component?e?e.children.getContext(f):null:e,t)}),t.canDeactivateChecks.push(new pN(l.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,l))}function WT(r){return"function"==typeof r}function $2(r){return r instanceof nN||"EmptyError"===r?.name}const fN=Symbol("INITIAL_VALUE");function vy(){return Ga(r=>Ux(r.map(e=>e.pipe(ho(1),bT(fN)))).pipe(xt(e=>{for(const t of e)if(!0!==t){if(t===fN)return fN;if(!1===t||t instanceof Nm)return t}return!0}),bl(e=>e!==fN),ho(1)))}function YB(r){return function XT(...r){return wy(r)}(Hr(e=>{if(Mm(e))throw jB(0,e)}),xt(e=>!0===e))}const X2={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function $B(r,e,t,a,l){const u=J2(r,e,t);return u.matched?function yW(r,e,t,a){const l=e.canMatch;return l&&0!==l.length?S(l.map(f=>{const g=yy(f,r);return zh(function cW(r){return r&&WT(r.canMatch)}(g)?g.canMatch(e,t):r.runInContext(()=>g(e,t)))})).pipe(vy(),YB()):S(!0)}(a=zB(e,a),e,t).pipe(xt(f=>!0===f?u:{...X2})):S(u)}function J2(r,e,t){if(""===e.path)return"full"===e.pathMatch&&(r.hasChildren()||t.length>0)?{...X2}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const l=(e.matcher||tG)(t,r,e);if(!l)return{...X2};const u={};po(l.posParams,(g,v)=>{u[v]=g.path});const f=l.consumed.length>0?{...u,...l.consumed[l.consumed.length-1].parameters}:u;return{matched:!0,consumedSegments:l.consumed,remainingSegments:t.slice(l.consumed.length),parameters:f,positionalParamSegments:l.posParams??{}}}function mN(r,e,t,a,l="corrected"){if(t.length>0&&function CW(r,e,t){return t.some(a=>_N(r,e,a)&&Wa(a)!==Gt)}(r,t,a)){const f=new $t(e,function SW(r,e,t,a){const l={};l[Gt]=a,a._sourceSegment=r,a._segmentIndexShift=e.length;for(const u of t)if(""===u.path&&Wa(u)!==Gt){const f=new $t([],{});f._sourceSegment=r,f._segmentIndexShift=e.length,l[Wa(u)]=f}return l}(r,e,a,new $t(t,r.children)));return f._sourceSegment=r,f._segmentIndexShift=e.length,{segmentGroup:f,slicedSegments:[]}}if(0===t.length&&function bW(r,e,t){return t.some(a=>_N(r,e,a))}(r,t,a)){const f=new $t(r.segments,function vW(r,e,t,a,l,u){const f={};for(const g of a)if(_N(r,t,g)&&!l[Wa(g)]){const v=new $t([],{});v._sourceSegment=r,v._segmentIndexShift="legacy"===u?r.segments.length:e.length,f[Wa(g)]=v}return{...l,...f}}(r,e,t,a,r.children,l));return f._sourceSegment=r,f._segmentIndexShift=e.length,{segmentGroup:f,slicedSegments:t}}const u=new $t(r.segments,r.children);return u._sourceSegment=r,u._segmentIndexShift=e.length,{segmentGroup:u,slicedSegments:t}}function _N(r,e,t){return(!(r.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}function XB(r,e,t,a){return!!(Wa(r)===a||a!==Gt&&_N(e,t,r))&&("**"===r.path||J2(e,r,t).matched)}function JB(r,e,t){return 0===e.length&&!r.children[t]}const gN=!1;class EN{constructor(e){this.segmentGroup=e||null}}class QB{constructor(e){this.urlTree=e}}function zT(r){return fy(new EN(r))}function ZB(r){return fy(new QB(r))}class wW{constructor(e,t,a,l,u){this.injector=e,this.configLoader=t,this.urlSerializer=a,this.urlTree=l,this.config=u,this.allowRedirects=!0}apply(){const e=mN(this.urlTree.root,[],[],this.config).segmentGroup,t=new $t(e.segments,e.children);return this.expandSegmentGroup(this.injector,this.config,t,Gt).pipe(xt(u=>this.createUrlTree(lN(u),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Om(u=>{if(u instanceof QB)return this.allowRedirects=!1,this.match(u.urlTree);throw u instanceof EN?this.noMatchError(u):u}))}match(e){return this.expandSegmentGroup(this.injector,this.config,e.root,Gt).pipe(xt(l=>this.createUrlTree(lN(l),e.queryParams,e.fragment))).pipe(Om(l=>{throw l instanceof EN?this.noMatchError(l):l}))}noMatchError(e){return new pe(4002,gN)}createUrlTree(e,t,a){const l=k2(e);return new Nm(l,t,a)}expandSegmentGroup(e,t,a,l){return 0===a.segments.length&&a.hasChildren()?this.expandChildren(e,t,a).pipe(xt(u=>new $t([],u))):this.expandSegment(e,a,t,a.segments,l,!0)}expandChildren(e,t,a){const l=[];for(const u of Object.keys(a.children))"primary"===u?l.unshift(u):l.push(u);return Oi(l).pipe(Dm(u=>{const f=a.children[u],g=KB(t,u);return this.expandSegmentGroup(e,g,f,u).pipe(xt(v=>({segment:v,outlet:u})))}),pB((u,f)=>(u[f.outlet]=f.segment,u),{}),fB())}expandSegment(e,t,a,l,u,f){return Oi(a).pipe(Dm(g=>this.expandSegmentAgainstRoute(e,t,a,g,l,u,f).pipe(Om(b=>{if(b instanceof EN)return S(null);throw b}))),Gh(g=>!!g),Om((g,v)=>{if($2(g))return JB(t,l,u)?S(new $t([],{})):zT(t);throw g}))}expandSegmentAgainstRoute(e,t,a,l,u,f,g){return XB(l,t,u,f)?void 0===l.redirectTo?this.matchSegmentAgainstRoute(e,t,l,u,f):g&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,a,l,u,f):zT(t):zT(t)}expandSegmentAgainstRouteUsingRedirect(e,t,a,l,u,f){return"**"===l.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,a,l,f):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,a,l,u,f)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,a,l){const u=this.applyRedirectCommands([],a.redirectTo,{});return a.redirectTo.startsWith("/")?ZB(u):this.lineralizeSegments(a,u).pipe(Wi(f=>{const g=new $t(f,{});return this.expandSegment(e,g,t,f,l,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,a,l,u,f){const{matched:g,consumedSegments:v,remainingSegments:b,positionalParamSegments:D}=J2(t,l,u);if(!g)return zT(t);const L=this.applyRedirectCommands(v,l.redirectTo,D);return l.redirectTo.startsWith("/")?ZB(L):this.lineralizeSegments(l,L).pipe(Wi(j=>this.expandSegment(e,t,a,j.concat(b),f,!1)))}matchSegmentAgainstRoute(e,t,a,l,u){return"**"===a.path?(e=zB(a,e),a.loadChildren?(a._loadedRoutes?S({routes:a._loadedRoutes,injector:a._loadedInjector}):this.configLoader.loadChildren(e,a)).pipe(xt(g=>(a._loadedRoutes=g.routes,a._loadedInjector=g.injector,new $t(l,{})))):S(new $t(l,{}))):$B(t,a,l,e).pipe(Ga(({matched:f,consumedSegments:g,remainingSegments:v})=>f?this.getChildConfig(e=a._injector??e,a,l).pipe(Wi(D=>{const L=D.injector??e,j=D.routes,{segmentGroup:G,slicedSegments:q}=mN(t,g,v,j),ie=new $t(G.segments,G.children);if(0===q.length&&ie.hasChildren())return this.expandChildren(L,j,ie).pipe(xt(ue=>new $t(g,ue)));if(0===j.length&&0===q.length)return S(new $t(g,{}));const ce=Wa(a)===u;return this.expandSegment(L,ie,j,q,ce?Gt:u,!0).pipe(xt(we=>new $t(g.concat(we.segments),we.children)))})):zT(t)))}getChildConfig(e,t,a){return t.children?S({routes:t.children,injector:e}):t.loadChildren?void 0!==t._loadedRoutes?S({routes:t._loadedRoutes,injector:t._loadedInjector}):function EW(r,e,t,a){const l=e.canLoad;return void 0===l||0===l.length?S(!0):S(l.map(f=>{const g=yy(f,r);return zh(function rW(r){return r&&WT(r.canLoad)}(g)?g.canLoad(e,t):r.runInContext(()=>g(e,t)))})).pipe(vy(),YB())}(e,t,a).pipe(Wi(l=>l?this.configLoader.loadChildren(e,t).pipe(Hr(u=>{t._loadedRoutes=u.routes,t._loadedInjector=u.injector})):function IW(r){return fy(HB(gN,3))}())):S({routes:[],injector:e})}lineralizeSegments(e,t){let a=[],l=t.root;for(;;){if(a=a.concat(l.segments),0===l.numberOfChildren)return S(a);if(l.numberOfChildren>1||!l.children[Gt])return fy(new pe(4e3,gN));l=l.children[Gt]}}applyRedirectCommands(e,t,a){return this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,a)}applyRedirectCreateUrlTree(e,t,a,l){const u=this.createSegmentGroup(e,t.root,a,l);return new Nm(u,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const a={};return po(e,(l,u)=>{if("string"==typeof l&&l.startsWith(":")){const g=l.substring(1);a[u]=t[g]}else a[u]=l}),a}createSegmentGroup(e,t,a,l){const u=this.createSegments(e,t.segments,a,l);let f={};return po(t.children,(g,v)=>{f[v]=this.createSegmentGroup(e,g,a,l)}),new $t(u,f)}createSegments(e,t,a,l){return t.map(u=>u.path.startsWith(":")?this.findPosParam(e,u,l):this.findOrReturn(u,a))}findPosParam(e,t,a){const l=a[t.path.substring(1)];if(!l)throw new pe(4001,gN);return l}findOrReturn(e,t){let a=0;for(const l of t){if(l.path===e.path)return t.splice(a),l;a++}return e}}class DW{}class PW{constructor(e,t,a,l,u,f,g,v){this.injector=e,this.rootComponentType=t,this.config=a,this.urlTree=l,this.url=u,this.paramsInheritanceStrategy=f,this.relativeLinkResolution=g,this.urlSerializer=v}recognize(){const e=mN(this.urlTree.root,[],[],this.config.filter(t=>void 0===t.redirectTo),this.relativeLinkResolution).segmentGroup;return this.processSegmentGroup(this.injector,this.config,e,Gt).pipe(xt(t=>{if(null===t)return null;const a=new uN([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Gt,this.rootComponentType,null,this.urlTree.root,-1,{}),l=new tu(a,t),u=new VB(this.url,l);return this.inheritParamsAndData(u._root),u}))}inheritParamsAndData(e){const t=e.value,a=UB(t,this.paramsInheritanceStrategy);t.params=Object.freeze(a.params),t.data=Object.freeze(a.data),e.children.forEach(l=>this.inheritParamsAndData(l))}processSegmentGroup(e,t,a,l){return 0===a.segments.length&&a.hasChildren()?this.processChildren(e,t,a):this.processSegment(e,t,a,a.segments,l)}processChildren(e,t,a){return Oi(Object.keys(a.children)).pipe(Dm(l=>{const u=a.children[l],f=KB(t,l);return this.processSegmentGroup(e,f,u,l)}),pB((l,u)=>l&&u?(l.push(...u),l):null),function K8(r,e=!1){return t=>t.lift(new q8(r,e))}(l=>null!==l),iN(null),fB(),xt(l=>{if(null===l)return null;const u=ej(l);return function MW(r){r.sort((e,t)=>e.value.outlet===Gt?-1:t.value.outlet===Gt?1:e.value.outlet.localeCompare(t.value.outlet))}(u),u}))}processSegment(e,t,a,l,u){return Oi(t).pipe(Dm(f=>this.processSegmentAgainstRoute(f._injector??e,f,a,l,u)),Gh(f=>!!f),Om(f=>{if($2(f))return JB(a,l,u)?S([]):S(null);throw f}))}processSegmentAgainstRoute(e,t,a,l,u){if(t.redirectTo||!XB(t,a,l,u))return S(null);let f;if("**"===t.path){const g=l.length>0?gB(l).parameters:{},v=nj(a)+l.length;f=S({snapshot:new uN(l,g,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,rj(t),Wa(t),t.component??t._loadedComponent??null,t,tj(a),v,oj(t),v),consumedSegments:[],remainingSegments:[]})}else f=$B(a,t,l,e).pipe(xt(({matched:g,consumedSegments:v,remainingSegments:b,parameters:D})=>{if(!g)return null;const L=nj(a)+v.length;return{snapshot:new uN(v,D,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,rj(t),Wa(t),t.component??t._loadedComponent??null,t,tj(a),L,oj(t),L),consumedSegments:v,remainingSegments:b}}));return f.pipe(Ga(g=>{if(null===g)return S(null);const{snapshot:v,consumedSegments:b,remainingSegments:D}=g;e=t._injector??e;const L=t._loadedInjector??e,j=function kW(r){return r.children?r.children:r.loadChildren?r._loadedRoutes:[]}(t),{segmentGroup:G,slicedSegments:q}=mN(a,b,D,j.filter(ce=>void 0===ce.redirectTo),this.relativeLinkResolution);if(0===q.length&&G.hasChildren())return this.processChildren(L,j,G).pipe(xt(ce=>null===ce?null:[new tu(v,ce)]));if(0===j.length&&0===q.length)return S([new tu(v,[])]);const ie=Wa(t)===u;return this.processSegment(L,j,G,q,ie?Gt:u).pipe(xt(ce=>null===ce?null:[new tu(v,ce)]))}))}}function LW(r){const e=r.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function ej(r){const e=[],t=new Set;for(const a of r){if(!LW(a)){e.push(a);continue}const l=e.find(u=>a.value.routeConfig===u.value.routeConfig);void 0!==l?(l.children.push(...a.children),t.add(l)):e.push(a)}for(const a of t){const l=ej(a.children);e.push(new tu(a.value,l))}return e.filter(a=>!t.has(a))}function tj(r){let e=r;for(;e._sourceSegment;)e=e._sourceSegment;return e}function nj(r){let e=r,t=e._segmentIndexShift??0;for(;e._sourceSegment;)e=e._sourceSegment,t+=e._segmentIndexShift??0;return t-1}function rj(r){return r.data||{}}function oj(r){return r.resolve||{}}function sj(r){return"string"==typeof r.title||null===r.title}function Q2(r){return Ga(e=>{const t=r(e);return t?Oi(t).pipe(xt(()=>e)):S(e)})}let aj=(()=>{class r{buildTitle(t){let a,l=t.root;for(;void 0!==l;)a=this.getResolvedTitleForRoute(l)??a,l=l.children.find(u=>u.outlet===Gt);return a}getResolvedTitleForRoute(t){return t.data[MT]}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=ke({token:r,factory:function(){return _t(cj)},providedIn:"root"}),r})(),cj=(()=>{class r extends aj{constructor(t){super(),this.title=t}updateTitle(t){const a=this.buildTitle(t);void 0!==a&&this.title.setTitle(a)}}return r.\u0275fac=function(t){return new(t||r)(he(Nb))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();class GW{}class zW extends class WW{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}const vN=new Ne("",{providedIn:"root",factory:()=>({})}),Z2=new Ne("ROUTES");let eF=(()=>{class r{constructor(t,a){this.injector=t,this.compiler=a,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return S(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const a=zh(t.loadComponent()).pipe(Hr(u=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=u}),O2(()=>{this.componentLoaders.delete(t)})),l=new Gm(a,()=>new fn).pipe(ti());return this.componentLoaders.set(t,l),l}loadChildren(t,a){if(this.childrenLoaders.get(a))return this.childrenLoaders.get(a);if(a._loadedRoutes)return S({routes:a._loadedRoutes,injector:a._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(a);const u=this.loadModuleFactoryOrRoutes(a.loadChildren).pipe(xt(g=>{this.onLoadEndListener&&this.onLoadEndListener(a);let v,b,D=!1;Array.isArray(g)?b=g:(v=g.create(t).injector,b=_B(v.get(Z2,[],nt.Self|nt.Optional)));return{routes:b.map(Y2),injector:v}}),O2(()=>{this.childrenLoaders.delete(a)})),f=new Gm(u,()=>new fn).pipe(ti());return this.childrenLoaders.set(a,f),f}loadModuleFactoryOrRoutes(t){return zh(t()).pipe(Wi(a=>a instanceof fC||Array.isArray(a)?S(a):Oi(this.compiler.compileModuleAsync(a))))}}return r.\u0275fac=function(t){return new(t||r)(he(Nr),he(aE))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();class qW{}class YW{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function $W(r){throw r}function XW(r,e,t){return e.parse("/")}const JW={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},QW={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};function dj(){const r=_t(bB),e=_t(BT),t=_t(_r),a=_t(Nr),l=_t(aE),u=_t(Z2,{optional:!0})??[],f=_t(vN,{optional:!0})??{},g=_t(cj),v=_t(aj,{optional:!0}),b=_t(qW,{optional:!0}),D=_t(GW,{optional:!0}),L=new Tr(null,r,e,t,a,l,_B(u));return b&&(L.urlHandlingStrategy=b),D&&(L.routeReuseStrategy=D),L.titleStrategy=v??g,function ZW(r,e){r.errorHandler&&(e.errorHandler=r.errorHandler),r.malformedUriErrorHandler&&(e.malformedUriErrorHandler=r.malformedUriErrorHandler),r.onSameUrlNavigation&&(e.onSameUrlNavigation=r.onSameUrlNavigation),r.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=r.paramsInheritanceStrategy),r.relativeLinkResolution&&(e.relativeLinkResolution=r.relativeLinkResolution),r.urlUpdateStrategy&&(e.urlUpdateStrategy=r.urlUpdateStrategy),r.canceledNavigationResolution&&(e.canceledNavigationResolution=r.canceledNavigationResolution)}(f,L),L}let Tr=(()=>{class r{constructor(t,a,l,u,f,g,v){this.rootComponentType=t,this.urlSerializer=a,this.rootContexts=l,this.location=u,this.config=v,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new fn,this.errorHandler=$W,this.malformedUriErrorHandler=XW,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>S(void 0),this.urlHandlingStrategy=new YW,this.routeReuseStrategy=new zW,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=f.get(eF),this.configLoader.onLoadEndListener=j=>this.triggerEvent(new kG(j)),this.configLoader.onLoadStartListener=j=>this.triggerEvent(new MG(j)),this.ngModule=f.get(gc),this.console=f.get(il);const L=f.get(Ht);this.isNgZoneEnabled=L instanceof Ht&&Ht.isInAngularZone(),this.resetConfig(v),this.currentUrlTree=function iG(){return new Nm(new $t([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=FB(this.currentUrlTree,this.rootComponentType),this.transitions=new y({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){return this.location.getState()?.\u0275routerPageId}setupNavigations(t){const a=this.events;return t.pipe(bl(l=>0!==l.id),xt(l=>({...l,extractedUrl:this.urlHandlingStrategy.extract(l.rawUrl)})),Ga(l=>{let u=!1,f=!1;return S(l).pipe(Hr(g=>{this.currentNavigation={id:g.id,initialUrl:g.rawUrl,extractedUrl:g.extractedUrl,trigger:g.source,extras:g.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Ga(g=>{const v=this.browserUrlTree.toString(),b=!this.navigated||g.extractedUrl.toString()!==v||v!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||b)&&this.urlHandlingStrategy.shouldProcessUrl(g.rawUrl))return uj(g.source)&&(this.browserUrlTree=g.extractedUrl),S(g).pipe(Ga(L=>{const j=this.transitions.getValue();return a.next(new U2(L.id,this.serializeUrl(L.extractedUrl),L.source,L.restoredState)),j!==this.transitions.getValue()?Tm:Promise.resolve(L)}),function AW(r,e,t,a){return Ga(l=>function RW(r,e,t,a,l){return new wW(r,e,t,a,l).apply()}(r,e,t,l.extractedUrl,a).pipe(xt(u=>({...l,urlAfterRedirects:u}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Hr(L=>{this.currentNavigation={...this.currentNavigation,finalUrl:L.urlAfterRedirects},l.urlAfterRedirects=L.urlAfterRedirects}),function FW(r,e,t,a,l,u){return Wi(f=>function NW(r,e,t,a,l,u,f="emptyOnly",g="legacy"){return new PW(r,e,t,a,l,f,g,u).recognize().pipe(Ga(v=>null===v?function OW(r){return new An(e=>e.error(r))}(new DW):S(v)))}(r,e,t,f.urlAfterRedirects,a.serialize(f.urlAfterRedirects),a,l,u).pipe(xt(g=>({...f,targetSnapshot:g}))))}(this.ngModule.injector,this.rootComponentType,this.config,this.urlSerializer,this.paramsInheritanceStrategy,this.relativeLinkResolution),Hr(L=>{if(l.targetSnapshot=L.targetSnapshot,"eager"===this.urlUpdateStrategy){if(!L.extras.skipLocationChange){const G=this.urlHandlingStrategy.merge(L.urlAfterRedirects,L.rawUrl);this.setBrowserUrl(G,L)}this.browserUrlTree=L.urlAfterRedirects}const j=new AG(L.id,this.serializeUrl(L.extractedUrl),this.serializeUrl(L.urlAfterRedirects),L.targetSnapshot);a.next(j)}));if(b&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:j,extractedUrl:G,source:q,restoredState:ie,extras:ce}=g,Ce=new U2(j,this.serializeUrl(G),q,ie);a.next(Ce);const we=FB(G,this.rootComponentType).snapshot;return S(l={...g,targetSnapshot:we,urlAfterRedirects:G,extras:{...ce,skipLocationChange:!1,replaceUrl:!1}})}return this.rawUrlTree=g.rawUrl,g.resolve(null),Tm}),Hr(g=>{const v=new DG(g.id,this.serializeUrl(g.extractedUrl),this.serializeUrl(g.urlAfterRedirects),g.targetSnapshot);this.triggerEvent(v)}),xt(g=>l={...g,guards:ZG(g.targetSnapshot,g.currentSnapshot,this.rootContexts)}),function dW(r,e){return Wi(t=>{const{targetSnapshot:a,currentSnapshot:l,guards:{canActivateChecks:u,canDeactivateChecks:f}}=t;return 0===f.length&&0===u.length?S({...t,guardsResult:!0}):function uW(r,e,t,a){return Oi(r).pipe(Wi(l=>function gW(r,e,t,a,l){const u=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return u&&0!==u.length?S(u.map(g=>{const v=jT(e)??l,b=yy(g,v);return zh(function aW(r){return r&&WT(r.canDeactivate)}(b)?b.canDeactivate(r,e,t,a):v.runInContext(()=>b(r,e,t,a))).pipe(Gh())})).pipe(vy()):S(!0)}(l.component,l.route,t,e,a)),Gh(l=>!0!==l,!0))}(f,a,l,r).pipe(Wi(g=>g&&function iW(r){return"boolean"==typeof r}(g)?function hW(r,e,t,a){return Oi(e).pipe(Dm(l=>MO(function fW(r,e){return null!==r&&e&&e(new LG(r)),S(!0)}(l.route.parent,a),function pW(r,e){return null!==r&&e&&e(new FG(r)),S(!0)}(l.route,a),function _W(r,e,t){const a=e[e.length-1],u=e.slice(0,e.length-1).reverse().map(f=>function eW(r){const e=r.routeConfig?r.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:r,guards:e}:null}(f)).filter(f=>null!==f).map(f=>uB(()=>S(f.guards.map(v=>{const b=jT(f.node)??t,D=yy(v,b);return zh(function sW(r){return r&&WT(r.canActivateChild)}(D)?D.canActivateChild(a,r):b.runInContext(()=>D(a,r))).pipe(Gh())})).pipe(vy())));return S(u).pipe(vy())}(r,l.path,t),function mW(r,e,t){const a=e.routeConfig?e.routeConfig.canActivate:null;if(!a||0===a.length)return S(!0);const l=a.map(u=>uB(()=>{const f=jT(e)??t,g=yy(u,f);return zh(function oW(r){return r&&WT(r.canActivate)}(g)?g.canActivate(e,r):f.runInContext(()=>g(e,r))).pipe(Gh())}));return S(l).pipe(vy())}(r,l.route,t))),Gh(l=>!0!==l,!0))}(a,u,r,e):S(g)),xt(g=>({...t,guardsResult:g})))})}(this.ngModule.injector,g=>this.triggerEvent(g)),Hr(g=>{if(l.guardsResult=g.guardsResult,Mm(g.guardsResult))throw jB(0,g.guardsResult);const v=new OG(g.id,this.serializeUrl(g.extractedUrl),this.serializeUrl(g.urlAfterRedirects),g.targetSnapshot,!!g.guardsResult);this.triggerEvent(v)}),bl(g=>!!g.guardsResult||(this.restoreHistory(g),this.cancelNavigationTransition(g,"",3),!1)),Q2(g=>{if(g.guards.canActivateChecks.length)return S(g).pipe(Hr(v=>{const b=new NG(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);this.triggerEvent(b)}),Ga(v=>{let b=!1;return S(v).pipe(function UW(r,e){return Wi(t=>{const{targetSnapshot:a,guards:{canActivateChecks:l}}=t;if(!l.length)return S(t);let u=0;return Oi(l).pipe(Dm(f=>function VW(r,e,t,a){const l=r.routeConfig,u=r._resolve;return void 0!==l?.title&&!sj(l)&&(u[MT]=l.title),function BW(r,e,t,a){const l=function jW(r){return[...Object.keys(r),...Object.getOwnPropertySymbols(r)]}(r);if(0===l.length)return S({});const u={};return Oi(l).pipe(Wi(f=>function HW(r,e,t,a){const l=jT(e)??a,u=yy(r,l);return zh(u.resolve?u.resolve(e,t):l.runInContext(()=>u(e,t)))}(r[f],e,t,a).pipe(Gh(),Hr(g=>{u[f]=g}))),D2(1),function $8(r){return e=>e.lift(new X8(r))}(u),Om(f=>$2(f)?Tm:fy(f)))}(u,r,e,a).pipe(xt(f=>(r._resolvedData=f,r.data=UB(r,t).resolve,l&&sj(l)&&(r.data[MT]=l.title),null)))}(f.route,a,r,e)),Hr(()=>u++),D2(1),Wi(f=>u===l.length?S(t):Tm))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Hr({next:()=>b=!0,complete:()=>{b||(this.restoreHistory(v),this.cancelNavigationTransition(v,"",2))}}))}),Hr(v=>{const b=new PG(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);this.triggerEvent(b)}))}),Q2(g=>{const v=b=>{const D=[];b.routeConfig?.loadComponent&&!b.routeConfig._loadedComponent&&D.push(this.configLoader.loadComponent(b.routeConfig).pipe(Hr(L=>{b.component=L}),xt(()=>{})));for(const L of b.children)D.push(...v(L));return D};return Ux(v(g.targetSnapshot.root)).pipe(iN(),ho(1))}),Q2(()=>this.afterPreactivation()),xt(g=>{const v=function HG(r,e,t){const a=VT(r,e._root,t?t._root:void 0);return new xB(a,e)}(this.routeReuseStrategy,g.targetSnapshot,g.currentRouterState);return l={...g,targetRouterState:v}}),Hr(g=>{this.currentUrlTree=g.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(g.urlAfterRedirects,g.rawUrl),this.routerState=g.targetRouterState,"deferred"===this.urlUpdateStrategy&&(g.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,g),this.browserUrlTree=g.urlAfterRedirects)}),((r,e,t)=>xt(a=>(new QG(e,a.targetRouterState,a.currentRouterState,t).activate(r),a)))(this.rootContexts,this.routeReuseStrategy,g=>this.triggerEvent(g)),Hr({next(){u=!0},complete(){u=!0}}),O2(()=>{u||f||this.cancelNavigationTransition(l,"",1),this.currentNavigation?.id===l.id&&(this.currentNavigation=null)}),Om(g=>{if(f=!0,WB(g)){GB(g)||(this.navigated=!0,this.restoreHistory(l,!0));const v=new dN(l.id,this.serializeUrl(l.extractedUrl),g.message,g.cancellationCode);if(a.next(v),GB(g)){const b=this.urlHandlingStrategy.merge(g.url,this.rawUrlTree),D={skipLocationChange:l.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||uj(l.source)};this.scheduleNavigation(b,"imperative",null,D,{resolve:l.resolve,reject:l.reject,promise:l.promise})}else l.resolve(!1)}else{this.restoreHistory(l,!0);const v=new MB(l.id,this.serializeUrl(l.extractedUrl),g,l.targetSnapshot??void 0);a.next(v);try{l.resolve(this.errorHandler(g))}catch(b){l.reject(b)}}return Tm}))}))}resetRootComponentType(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType}setTransition(t){this.transitions.next({...this.transitions.value,...t})}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const a="popstate"===t.type?"popstate":"hashchange";"popstate"===a&&setTimeout(()=>{const l={replaceUrl:!0},u=t.state?.navigationId?t.state:null;if(u){const g={...u};delete g.navigationId,delete g.\u0275routerPageId,0!==Object.keys(g).length&&(l.state=g)}const f=this.parseUrl(t.url);this.scheduleNavigation(f,a,u,l)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(t){this.events.next(t)}resetConfig(t){this.config=t.map(Y2),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,a={}){const{relativeTo:l,queryParams:u,fragment:f,queryParamsHandling:g,preserveFragment:v}=a,b=l||this.routerState.root,D=v?this.currentUrlTree.fragment:f;let L=null;switch(g){case"merge":L={...this.currentUrlTree.queryParams,...u};break;case"preserve":L=this.currentUrlTree.queryParams;break;default:L=u||null}return null!==L&&(L=this.removeEmptyProps(L)),CG(b,this.currentUrlTree,t,L,D??null)}navigateByUrl(t,a={skipLocationChange:!1}){const l=Mm(t)?t:this.parseUrl(t),u=this.urlHandlingStrategy.merge(l,this.rawUrlTree);return this.scheduleNavigation(u,"imperative",null,a)}navigate(t,a={skipLocationChange:!1}){return function e9(r){for(let e=0;e<r.length;e++){if(null==r[e])throw new pe(4008,false)}}(t),this.navigateByUrl(this.createUrlTree(t,a),a)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let a;try{a=this.urlSerializer.parse(t)}catch(l){a=this.malformedUriErrorHandler(l,this.urlSerializer,t)}return a}isActive(t,a){let l;if(l=!0===a?{...JW}:!1===a?{...QW}:a,Mm(t))return yB(this.currentUrlTree,t,l);const u=this.parseUrl(t);return yB(this.currentUrlTree,u,l)}removeEmptyProps(t){return Object.keys(t).reduce((a,l)=>{const u=t[l];return null!=u&&(a[l]=u),a},{})}processNavigations(){this.navigations.subscribe(t=>{this.navigated=!0,this.lastSuccessfulId=t.id,this.currentPageId=t.targetPageId,this.events.next(new km(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.titleStrategy?.updateTitle(this.routerState.snapshot),t.resolve(!0)},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}scheduleNavigation(t,a,l,u,f){if(this.disposed)return Promise.resolve(!1);let g,v,b;f?(g=f.resolve,v=f.reject,b=f.promise):b=new Promise((j,G)=>{g=j,v=G});const D=++this.navigationId;let L;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(l=this.location.getState()),L=l&&l.\u0275routerPageId?l.\u0275routerPageId:u.replaceUrl||u.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):L=0,this.setTransition({id:D,targetPageId:L,source:a,restoredState:l,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:t,extras:u,resolve:g,reject:v,promise:b,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),b.catch(j=>Promise.reject(j))}setBrowserUrl(t,a){const l=this.urlSerializer.serialize(t),u={...a.extras.state,...this.generateNgRouterState(a.id,a.targetPageId)};this.location.isCurrentPathEqualTo(l)||a.extras.replaceUrl?this.location.replaceState(l,"",u):this.location.go(l,"",u)}restoreHistory(t,a=!1){if("computed"===this.canceledNavigationResolution){const l=this.currentPageId-t.targetPageId;"popstate"!==t.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.currentNavigation?.finalUrl||0===l?this.currentUrlTree===this.currentNavigation?.finalUrl&&0===l&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(l)}else"replace"===this.canceledNavigationResolution&&(a&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(t,a,l){const u=new dN(t.id,this.serializeUrl(t.extractedUrl),a,l);this.triggerEvent(u),t.resolve(!1)}generateNgRouterState(t,a){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:a}:{navigationId:t}}}return r.\u0275fac=function(t){Bp()},r.\u0275prov=ke({token:r,factory:function(){return dj()},providedIn:"root"}),r})();function uj(r){return"imperative"!==r}class hj{}let i9=(()=>{class r{constructor(t,a,l,u,f){this.router=t,this.injector=l,this.preloadingStrategy=u,this.loader=f}setUpPreloading(){this.subscription=this.router.events.pipe(bl(t=>t instanceof km),Dm(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,a){const l=[];for(const u of a){u.providers&&!u._injector&&(u._injector=mf(u.providers,t,`Route: ${u.path}`));const f=u._injector??t,g=u._loadedInjector??f;u.loadChildren&&!u._loadedRoutes&&void 0===u.canLoad||u.loadComponent&&!u._loadedComponent?l.push(this.preloadConfig(f,u)):(u.children||u._loadedRoutes)&&l.push(this.processRoutes(g,u.children??u._loadedRoutes))}return Oi(l).pipe(qa())}preloadConfig(t,a){return this.preloadingStrategy.preload(a,()=>{let l;l=a.loadChildren&&void 0===a.canLoad?this.loader.loadChildren(t,a):S(null);const u=l.pipe(Wi(f=>null===f?S(void 0):(a._loadedRoutes=f.routes,a._loadedInjector=f.injector,this.processRoutes(f.injector??t,f.routes))));return a.loadComponent&&!a._loadedComponent?Oi([u,this.loader.loadComponent(a)]).pipe(qa()):u})}}return r.\u0275fac=function(t){return new(t||r)(he(Tr),he(aE),he(Wc),he(hj),he(eF))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const iF=new Ne("");let pj=(()=>{class r{constructor(t,a,l={}){this.router=t,this.viewportScroller=a,this.options=l,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},l.scrollPositionRestoration=l.scrollPositionRestoration||"disabled",l.anchorScrolling=l.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(t=>{t instanceof U2?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof km&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.router.parseUrl(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(t=>{t instanceof kB&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,a){this.router.triggerEvent(new kB(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,a))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return r.\u0275fac=function(t){Bp()},r.\u0275prov=ke({token:r,factory:r.\u0275fac}),r})();function Sy(r,e){return{\u0275kind:r,\u0275providers:e}}function rF(r){return[{provide:Z2,multi:!0,useValue:r}]}function mj(){const r=_t(Nr);return e=>{const t=r.get(bd);if(e!==t.components[0])return;const a=r.get(Tr),l=r.get(_j);1===r.get(oF)&&a.initialNavigation(),r.get(gj,null,nt.Optional)?.setUpPreloading(),r.get(iF,null,nt.Optional)?.init(),a.resetRootComponentType(t.componentTypes[0]),l.closed||(l.next(),l.unsubscribe())}}const _j=new Ne("",{factory:()=>new fn}),oF=new Ne("",{providedIn:"root",factory:()=>1});const gj=new Ne("");function a9(r){return Sy(0,[{provide:gj,useExisting:i9},{provide:hj,useExisting:r}])}const Ej=new Ne("ROUTER_FORROOT_GUARD"),c9=[_r,{provide:bB,useClass:P2},{provide:Tr,useFactory:dj},BT,{provide:Kh,useFactory:function fj(r){return r.routerState.root},deps:[Tr]},eF];function l9(){return new xC("Router",Tr)}let d9=(()=>{class r{constructor(t){}static forRoot(t,a){return{ngModule:r,providers:[c9,[],rF(t),{provide:Ej,useFactory:f9,deps:[[Tr,new vp,new Sp]]},{provide:vN,useValue:a||{}},a?.useHash?{provide:Da,useClass:YC}:{provide:Da,useClass:ao},{provide:iF,useFactory:()=>{const r=_t(Tr),e=_t(_L),t=_t(vN);return t.scrollOffset&&e.setOffset(t.scrollOffset),new pj(r,e,t)}},a?.preloadingStrategy?a9(a.preloadingStrategy).\u0275providers:[],{provide:xC,multi:!0,useFactory:l9},a?.initialNavigation?m9(a):[],[{provide:yj,useFactory:mj},{provide:Ii,multi:!0,useExisting:yj}]]}}static forChild(t){return{ngModule:r,providers:[rF(t)]}}}return r.\u0275fac=function(t){return new(t||r)(he(Ej,8))},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({imports:[K2]}),r})();function f9(r){return"guarded"}function m9(r){return["disabled"===r.initialNavigation?Sy(3,[{provide:sh,multi:!0,useFactory:()=>{const e=_t(Tr);return()=>{e.setUpLocationChangeListener()}}},{provide:oF,useValue:2}]).\u0275providers:[],"enabledBlocking"===r.initialNavigation?Sy(2,[{provide:oF,useValue:0},{provide:sh,multi:!0,deps:[Nr],useFactory:e=>{const t=e.get(zC,Promise.resolve());let a=!1;return()=>t.then(()=>new Promise(u=>{const f=e.get(Tr),g=e.get(_j);(function l(u){e.get(Tr).events.pipe(bl(g=>g instanceof km||g instanceof dN||g instanceof MB),xt(g=>g instanceof km||g instanceof dN&&(0===g.code||1===g.code)&&null),bl(g=>null!==g),ho(1)).subscribe(()=>{u()})})(()=>{u(!0),a=!0}),f.afterPreactivation=()=>(u(!0),a||g.closed?S(void 0):g),f.initialNavigation()}))}}]).\u0275providers:[]]}const yj=new Ne(""),vj_configs={AppID:"fee9eb8f5bb44a6893ec96fd5e993a31"};let g9=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=qr({type:r,selectors:[["app-root"]],decls:1,vars:0,template:function(t,a){1&t&&tn(0,"router-outlet")},dependencies:[z2],changeDetection:0}),r})();function sF(r=0,e=dy){return(!Zx(r)||r<0)&&(r=0),(!e||"function"!=typeof e.schedule)&&(e=dy),new An(t=>(t.add(e.schedule(E9,r,{subscriber:t,counter:0,period:r})),t))}function E9(r){const{subscriber:e,counter:t,period:a}=r;e.next(t),this.schedule({subscriber:e,counter:t+1,period:a},a)}class kc{constructor(e,t,a){this.kind=e,this.value=t,this.error=a,this.hasValue="N"===e}observe(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}}do(e,t,a){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return a&&a()}}accept(e,t,a){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,a)}toObservable(){switch(this.kind){case"N":return S(this.value);case"E":return fy(this.error);case"C":return kO()}throw new Error("unexpected notification kind value")}static createNext(e){return typeof e<"u"?new kc("N",e):kc.undefinedValueNotification}static createError(e){return new kc("E",void 0,e)}static createComplete(){return kc.completeNotification}}kc.completeNotification=new kc("C"),kc.undefinedValueNotification=new kc("N",void 0);class S9{constructor(e,t){this.delay=e,this.scheduler=t}call(e,t){return t.subscribe(new aF(e,this.delay,this.scheduler))}}class aF extends bn{constructor(e,t,a){super(e),this.delay=t,this.scheduler=a,this.queue=[],this.active=!1,this.errored=!1}static dispatch(e){const t=e.source,a=t.queue,l=e.scheduler,u=e.destination;for(;a.length>0&&a[0].time-l.now()<=0;)a.shift().notification.observe(u);if(a.length>0){const f=Math.max(0,a[0].time-l.now());this.schedule(e,f)}else this.unsubscribe(),t.active=!1}_schedule(e){this.active=!0,this.destination.add(e.schedule(aF.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))}scheduleNotification(e){if(!0===this.errored)return;const t=this.scheduler,a=new C9(t.now()+this.delay,e);this.queue.push(a),!1===this.active&&this._schedule(t)}_next(e){this.scheduleNotification(kc.createNext(e))}_error(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()}_complete(){this.scheduleNotification(kc.createComplete()),this.unsubscribe()}}class C9{constructor(e,t){this.time=e,this.notification=t}}var b9=Fm(890);function T9(r,e){if(1&r){const t=ya();De(0,"div",1)(1,"button",2),Xt("click",function(){return ds(t),us(ln().onToggleFullScreen())}),De(2,"div",3),be(),De(3,"svg",4)(4,"g",26)(5,"g",6)(6,"g",7)(7,"g",11),tn(8,"path",27)(9,"path",28)(10,"path",29)(11,"path",30),Ge()()()(),De(12,"g",31)(13,"g",6)(14,"g",32)(15,"g",7),tn(16,"path",33)(17,"path",34)(18,"path",35)(19,"path",36),Ge()()()()()(),Qa(),De(20,"p"),$i(21),Ge()()()}if(2&r){const t=ln();Xe(1),In("controls__button--active",t.fullScreenEnabled),Xe(3),In("controls__icon--shown",!t.fullScreenEnabled),Xe(8),In("controls__icon--shown",t.fullScreenEnabled),Xe(9),fs(t.fullScreenEnabled?"Exit fullscreen":"Fullscreen")}}function I9(r,e){if(1&r){const t=ya();De(0,"div",1)(1,"button",37),Xt("click",function(){return ds(t),us(ln().onToggleSmallScreen())}),De(2,"div",3),be(),De(3,"svg",4)(4,"g",38),tn(5,"path",39),Ge(),De(6,"defs")(7,"filter",40),tn(8,"feFlood",41)(9,"feColorMatrix",42)(10,"feOffset",43)(11,"feGaussianBlur",44)(12,"feComposite",45)(13,"feColorMatrix",46)(14,"feBlend",47)(15,"feBlend",48),Ge()()()(),Qa(),De(16,"p"),$i(17,"Minimize"),Ge()()()}if(2&r){const t=ln();Xe(1),In("controls__button--active",t.smallScreenEnabled)}}function R9(r,e){if(1&r&&(De(0,"div",8),$i(1),Ge()),2&r){const t=ln();Xe(1),fs(t.text)}}const w9=function(r,e,t,a){return{"spinner--connected":r,"spinner--ended":e,"spinner--small":t,"spinner--error":a}};function A9(r,e){if(1&r&&(uc(0),$i(1),Jc()),2&r){const t=ln(2);Xe(1),Qc(" Calling to ",t.data.user.name," ")}}function D9(r,e){1&r&&$i(0),2&r&&Qc(" ",ln(2).data.user.name," is calling ")}function O9(r,e){if(1&r){const t=ya();uc(0),De(1,"button",11),Xt("click",function(){return ds(t),us(ln(2).onAcceptCall())}),Ge(),Jc()}}function N9(r,e){if(1&r){const t=ya();De(0,"div",1)(1,"div",2)(2,"div",3),tn(3,"img",4),Ge(),De(4,"p",5),zn(5,A9,2,1,"ng-container",6),zn(6,D9,1,1,"ng-template",null,7,nE),Ge()(),De(8,"div",8),zn(9,O9,2,0,"ng-container",9),De(10,"span")(11,"button",10),Xt("click",function(){return ds(t),us(ln().onDeclineCall())}),Ge()()()()}if(2&r){const t=ef(7),a=ln();In("video-call--full-screen",a.fullScreen),Ze("@fade",void 0),Xe(3),Ze("src",a.data.user.photoURL,$_),Xe(2),Ze("ngIf",a.data.outcome)("ngIfElse",t),Xe(4),Ze("ngIf",!a.data.outcome)}}function P9(r,e){if(1&r&&tn(0,"ngx-spinner",15),2&r){const t=ln().ngIf,a=ln(2);Ze("error",t.error)("text",t.statusText)("connected",t.connected)("ended",t.ended)("small",a.smallScreenEnabled)}}function M9(r,e){1&r&&tn(0,"ngx-timer",16),2&r&&Ze("started",ln().ngIf.started)}function k9(r,e){if(1&r&&(tn(0,"div",17),gf(1,"async")),2&r){const t=e.$implicit;In("hidden",!1===Qu(1,3,ln(3).remoteStreamVideoToggle$)),Ze("id",t)}}function L9(r,e){if(1&r){const t=ya();be(),Qa(),De(0,"ngx-controls",18),Xt("toggleCamera",function(l){return ds(t),us(ln(3).onToggleCamera(l))})("toggleMicrophone",function(l){return ds(t),us(ln(3).onToggleMicrophone(l))})("toggleFullScreen",function(l){return ds(t),us(ln(3).onToggleFullScreen(l))})("toggleSmallScreen",function(l){return ds(t),us(ln(3).onToggleSmallScreen(l))})("endCall",function(){return ds(t),us(ln(3).onEndCall())}),Ge()}if(2&r){const t=ln(3);Ze("cameraEnabled",t.cameraEnabled)("microphoneEnabled",t.microphoneEnabled)("fullScreenEnabled",t.fullScreenEnabled)("smallScreenEnabled",t.smallScreenEnabled)("displaySmallScreen",t.displaySmallScreen)}}function x9(r,e){if(1&r&&(De(0,"div",2),zn(1,P9,1,5,"ngx-spinner",3),zn(2,M9,1,1,"ngx-timer",4),tn(3,"div",5),zn(4,k9,2,5,"div",6),De(5,"div",7),be(),De(6,"svg",8)(7,"g",9),tn(8,"path",10)(9,"path",11),Ge(),De(10,"defs")(11,"clipPath",12),tn(12,"rect",13),Ge()()()(),zn(13,L9,1,5,"ngx-controls",14),Ge()),2&r){const t=e.ngIf,a=ln(2);Xe(1),Ze("ngIf",t.loading),Xe(1),Ze("ngIf",t.started),Xe(1),In("hidden",!a.cameraEnabled||a.smallScreenEnabled),Ze("id",a.localContainerId),Xe(1),Ze("ngForOf",a.remoteCalls),Xe(9),Ze("ngIf",t.connected&&!t.ended)}}function F9(r,e){if(1&r&&(De(0,"div"),zn(1,x9,14,7,"div",1),gf(2,"async"),Ge()),2&r){const t=ln();Ze("@fade",void 0)("@.disabled",!t.animate),Xe(1),Ze("ngIf",Qu(2,3,t.streamState$))}}const TN_HIDDEN={opacity:0,"margin-top":"100%"},TN_SHOWN={opacity:1,"margin-top":0},Sj=Yx("fade",[wT(":enter",[Ts(TN_HIDDEN),RT("250ms ease-in-out",Ts(TN_SHOWN))]),wT(":leave",[Ts(TN_SHOWN),RT("250ms ease-in-out",Ts(TN_HIDDEN))])]);class Cj{constructor(e){this.cdr=e,this.afterClosed=new fn,this.shown=!0}closeDialog(e){this.onAfterClosed(e)}onAfterClosed(e){this.shown=!1,this.cdr.markForCheck(),this.afterClosed.next(e)}}let U9=(()=>{class r{constructor(){this.cameraEnabled=!0,this.microphoneEnabled=!0,this.fullScreenEnabled=!1,this.smallScreenEnabled=!1,this.displaySmallScreen=!1,this.toggleCamera=new un,this.toggleMicrophone=new un,this.toggleFullScreen=new un,this.toggleSmallScreen=new un,this.endCall=new un}onToggleCamera(){this.toggleCamera.emit(this.cameraEnabled)}onToggleMicrophone(){this.toggleMicrophone.emit(this.microphoneEnabled)}onToggleFullScreen(){this.toggleFullScreen.emit(this.fullScreenEnabled)}onToggleSmallScreen(){this.toggleSmallScreen.emit(this.smallScreenEnabled)}onEndCall(){this.endCall.emit()}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=qr({type:r,selectors:[["ngx-controls"]],inputs:{cameraEnabled:"cameraEnabled",microphoneEnabled:"microphoneEnabled",fullScreenEnabled:"fullScreenEnabled",smallScreenEnabled:"smallScreenEnabled",displaySmallScreen:"displaySmallScreen"},outputs:{toggleCamera:"toggleCamera",toggleMicrophone:"toggleMicrophone",toggleFullScreen:"toggleFullScreen",toggleSmallScreen:"toggleSmallScreen",endCall:"endCall"},decls:43,vars:16,consts:[[1,"controls"],[1,"controls__item"],[1,"controls__button",3,"click"],[1,"controls__icon-wrapper"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","video-camera",1,"controls__icon"],["id","Group"],["id","Group_2"],["id","Vector","d","M63.4134 16.2294C63.0454 15.9814 62.5787 15.928 62.1707 16.096L50.6668 20.6986V20C50.6668 16.3226 47.6748 13.3334 44.0001 13.3334H6.66663C2.992 13.3334 0 16.3226 0 20V44C0 47.6774 2.992 50.6666 6.66663 50.6666H44C47.6746 50.6666 50.6666 47.6772 50.6666 44V43.3014L62.1706 47.904C62.5812 48.072 63.048 48.0186 63.4132 47.7706C63.7786 47.5226 63.9999 47.1093 63.9999 46.6666V17.3334C64 16.8906 63.7786 16.4774 63.4134 16.2294Z","fill","white"],["id","no-camera",1,"controls__icon"],["id","Vector","d","M44.0002 13.3325H6.66735C2.99276 13.3325 0.000793457 16.3218 0.000793457 19.999V43.9988C0.000793457 47.6761 2.99276 50.6654 6.66735 50.6654H7.67797L44.9176 13.4257C44.6162 13.3832 44.315 13.3325 44.0002 13.3325Z","fill","white"],["id","Group_3"],["id","Group_4"],["id","Vector_2","d","M63.4134 16.2285C63.0454 15.9805 62.5788 15.9271 62.1708 16.0951L50.6669 20.6977V19.9991C50.6669 18.6417 50.2535 17.3831 49.5549 16.3297L63.608 2.2766C64.128 1.75661 64.128 0.911242 63.608 0.391247C63.088 -0.128748 62.2426 -0.128748 61.7226 0.391247L0.389996 61.724C-0.129999 62.244 -0.129999 63.0894 0.389996 63.6094C0.651369 63.868 0.992615 63.9988 1.33399 63.9988C1.67536 63.9988 2.01661 63.8681 2.27798 63.6094L15.2192 50.6655H44.0003C47.6749 50.6655 50.6669 47.6762 50.6669 43.9989V43.3003L62.1708 47.9029C62.5814 48.0709 63.0481 48.0175 63.4134 47.7695C63.7788 47.5215 64 47.1082 64 46.6655V17.3325C64 16.8898 63.7788 16.4765 63.4134 16.2285Z","fill","white"],["id","microphone",1,"controls__icon"],["id","Vector"],["fill-rule","evenodd","clip-rule","evenodd","d","M44.3474 12.1407L44.3468 17.2309V33.8672C44.3468 40.6024 38.9004 46.0823 32.206 46.0823C27.8366 46.0787 23.8059 43.7286 21.6503 39.9279L20.4131 36.8161C20.1824 35.875 20.0659 34.9098 20.0659 33.941V12.1407C20.0659 5.43551 25.5014 0 32.2066 0C38.9118 0 44.3474 5.43551 44.3474 12.1407Z","fill","white"],["fill-rule","evenodd","clip-rule","evenodd","d","M15.0971 33.7512C15.0947 36.1345 15.5932 38.4912 16.5596 40.6697L18.1223 43.4553C22.3699 49.6259 30.1387 52.3143 37.292 50.089C44.4453 47.8638 49.318 41.2426 49.3156 33.7518C49.3156 32.9026 50.0039 32.2143 50.8532 32.2143C51.7018 32.2143 52.3907 32.9026 52.3907 33.7518C52.4051 44.4499 44.0585 53.2951 33.3778 53.9017V60.9246H39.8098C40.6584 60.9246 41.3473 61.6135 41.3473 62.4622C41.3473 63.3114 40.6584 63.9997 39.8098 63.9997H24.6029C23.7537 63.9997 23.0654 63.3114 23.0654 62.4622C23.0654 61.6135 23.7537 60.9246 24.6029 60.9246H30.3033V53.847C25.6228 53.4212 21.2413 51.3623 17.926 48.0313C17.1926 47.298 16.5163 46.51 15.9031 45.6739L14.2418 42.9874C12.7757 40.1297 12.0148 36.9633 12.022 33.7512C12.022 32.902 12.7103 32.2137 13.5595 32.2137C14.4088 32.2137 15.0971 32.902 15.0971 33.7512Z","fill","white"],["id","no-microphone",1,"controls__icon"],["id","Vector","d","M52.9733 4.25592L44.3474 12.8813V12.1407C44.3474 5.43551 38.9118 0 32.2066 0C25.5014 0 20.0659 5.43551 20.0659 12.1407V33.941C20.0659 34.9098 20.1824 35.875 20.4131 36.8161L16.5596 40.6697C15.5932 38.4912 15.0947 36.1345 15.0971 33.7512C15.0971 32.902 14.4088 32.2137 13.5595 32.2137C12.7103 32.2137 12.022 32.902 12.022 33.7512C12.0148 36.9633 12.7757 40.1297 14.2418 42.9874L8.81411 48.4151C8.4117 48.8007 8.24954 49.3731 8.39008 49.9124C8.53002 50.4518 8.95105 50.8728 9.4898 51.0133C10.0291 51.1539 10.6021 50.9917 10.9877 50.5899L15.9031 45.6739C16.5163 46.51 17.1926 47.298 17.926 48.0313C21.2413 51.3623 25.6228 53.4212 30.3033 53.847V60.9246H24.6029C23.7537 60.9246 23.0654 61.6135 23.0654 62.4622C23.0654 63.3114 23.7537 63.9997 24.6029 63.9997H39.8098C40.6584 63.9997 41.3473 63.3114 41.3473 62.4622C41.3473 61.6135 40.6584 60.9246 39.8098 60.9246H33.3778V53.9017C44.0585 53.2951 52.4051 44.4499 52.3907 33.7518C52.3907 32.9026 51.7018 32.2143 50.8532 32.2143C50.0039 32.2143 49.3156 32.9026 49.3156 33.7518C49.318 41.2426 44.4453 47.8638 37.292 50.089C30.1387 52.3143 22.3699 49.6259 18.1224 43.4553L21.6503 39.9279C23.8059 43.7286 27.8366 46.0787 32.206 46.0823C38.9004 46.0823 44.3468 40.6024 44.3468 33.8672V17.2309L55.1475 6.43072C55.7481 5.83071 55.7481 4.85713 55.1475 4.25652C54.5469 3.65591 53.5733 3.65591 52.9733 4.25652V4.25592Z","fill","white"],["class","controls__item",4,"ngIf"],[1,"controls__button","controls__button--danger",3,"click"],["id","phone"],["id","Vector","d","M51.7097 13.2478C51.2458 12.7839 50.4959 12.7839 50.032 13.2478L1.38351 61.8963C0.919568 62.3602 0.919568 63.1101 1.38351 63.574C1.61488 63.8054 1.91864 63.9217 2.2224 63.9217C2.52615 63.9217 2.82991 63.8054 3.06129 63.574L51.7097 14.9256C52.1737 14.4628 52.1737 13.7117 51.7097 13.2478Z","fill","white"],["id","Vector_2","d","M16.9605 42.9635L26.1159 33.8081L21.3365 29.0287C18.91 26.6022 18.6869 24.3679 20.5878 21.5629C20.8535 21.1951 22.5444 19.6941 23.992 18.4839C24.9151 17.9333 25.5487 17.1181 25.8264 16.1155C26.1954 14.783 25.9225 13.2156 25.0516 11.6885C24.8463 11.3373 19.9625 3.06229 15.4583 0.680892C14.6171 0.235937 13.6714 0.0010004 12.721 0.0010004C11.1571 0.0010004 9.68576 0.610886 8.58109 1.71556L5.57082 4.72702C-3.21082 13.5098 -1.58525 24.419 10.2719 36.2749L16.9605 42.9635Z","fill","white"],["id","Vector_3","d","M63.313 48.5357C60.9304 44.0328 52.6566 39.1478 52.2923 38.9342C51.2304 38.329 50.1209 38.0099 49.0839 38.0099C47.5402 38.0099 46.2753 38.717 45.51 40.0033C44.2986 41.452 42.7964 43.1429 42.4345 43.4051C39.6129 45.3154 37.4071 45.1007 34.9652 42.6588L31.148 38.8416L21.9926 47.997L27.7189 53.7233C34.5356 60.5412 41.0367 63.9976 47.0371 63.9976C47.0383 63.9976 47.0383 63.9976 47.0383 63.9976C51.4534 63.9976 55.5672 62.1217 59.2669 58.4232L62.2771 55.413C64.1068 53.5845 64.5233 50.821 63.313 48.5357Z","fill","white"],["id","fullscreen",1,"controls__icon"],["id","Vector","d","M57.8018 53.4382L44.3964 40.0328L40.0328 44.3964L53.4382 57.8018H43.0205V64H64V43.0205H57.8018V53.4382Z","fill","white"],["id","Vector_2","d","M44.3964 23.9803L57.8018 10.5618V20.9795H64V0H43.0205V6.1982H53.4382L40.0328 19.6036L44.3964 23.9803Z","fill","white"],["id","Vector_3","d","M19.6036 40.0328L6.1982 53.4382V43.0205H0V64H20.9795V57.8018H10.5618L23.9803 44.3964L19.6036 40.0328Z","fill","white"],["id","Vector_4","d","M20.9795 6.1982V0H0V20.9795H6.1982V10.5618L19.6036 23.9803L23.9803 19.6036L10.5618 6.1982H20.9795Z","fill","white"],["id","exit-full-screen",1,"controls__icon"],["id","fullscreen_x5F_exit"],["id","Vector","d","M49.172 54.828L58.344 64L64 58.344L54.828 49.172L64 40H40V64L49.172 54.828Z","fill","white"],["id","Vector_2","d","M0 24H24V0L14.828 9.172L5.75 0.086L0.094 5.742L9.172 14.828L0 24Z","fill","white"],["id","Vector_3","d","M0 58.344L5.656 64L14.828 54.828L24 64V40H0L9.172 49.172L0 58.344Z","fill","white"],["id","Vector_4","d","M40 24H64L54.828 14.828L63.922 5.742L58.266 0.086L49.172 9.172L40 0V24Z","fill","white"],[1,"controls__button","controls__button--rotate",3,"click"],["filter","url(#filter0_d_0_4)"],["d","M-4.81762e-07 34.7678V57.0215C-4.81762e-07 60.8696 3.13284 64 6.98275 64H57.016C60.8672 64 64 60.8696 64 57.0215V7.05508C64 3.20697 60.8672 0.0757321 57.016 0.0757321H34.6959C35.8972 1.3077 36.6961 2.93443 36.871 4.74067H57.0168C58.2942 4.74067 59.3335 5.77899 59.3335 7.05508V57.0216C59.3335 58.2969 58.2942 59.3352 57.0168 59.3352H6.98342C5.7062 59.3352 4.66761 58.2969 4.66761 57.0216V36.9389C2.90982 36.7703 1.27948 36.0149 -4.81762e-07 34.7678ZM10.7807 30.6654H26.0384L1.34093 5.97437C-0.02533 4.60686 -0.02533 2.39174 1.34093 1.02583C2.70813 -0.341677 4.92462 -0.341677 6.29089 1.02423L30.9883 25.7159V10.4614C30.9883 8.52907 32.5556 6.96139 34.4888 6.96139C35.4553 6.96139 36.3305 7.35214 36.9642 7.98612C37.5976 8.62116 37.9897 9.49543 37.9897 10.4613V34.1643C37.9897 36.0966 36.4228 37.6635 34.4896 37.6635H10.7807C8.84705 37.6635 7.28056 36.0974 7.28056 34.1643C7.28056 32.2312 8.84705 30.6654 10.7807 30.6654Z","fill","white"],["id","filter0_d_0_4","x","-4","y","0","width","72","height","72","filterUnits","userSpaceOnUse","color-interpolation-filters","sRGB"],["flood-opacity","0","result","BackgroundImageFix"],["in","SourceAlpha","type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0","result","hardAlpha"],["dy","4"],["stdDeviation","2"],["in2","hardAlpha","operator","out"],["type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"],["mode","normal","in2","BackgroundImageFix","result","effect1_dropShadow_0_4"],["mode","normal","in","SourceGraphic","in2","effect1_dropShadow_0_4","result","shape"]],template:function(t,a){1&t&&(De(0,"div",0)(1,"div",1)(2,"button",2),Xt("click",function(){return a.onToggleCamera()}),De(3,"div",3),be(),De(4,"svg",4)(5,"g",5)(6,"g",6)(7,"g",7),tn(8,"path",8),Ge()()(),De(9,"g",9)(10,"g",6)(11,"g",7),tn(12,"path",10),Ge()(),De(13,"g",11)(14,"g",12),tn(15,"path",13),Ge()()()()(),Qa(),De(16,"p"),$i(17,"Camera"),Ge()()(),De(18,"div",1)(19,"button",2),Xt("click",function(){return a.onToggleMicrophone()}),De(20,"div",3),be(),De(21,"svg",4)(22,"g",14)(23,"g",15),tn(24,"path",16)(25,"path",17),Ge()(),De(26,"g",18),tn(27,"path",19),Ge()()(),Qa(),De(28,"p"),$i(29,"Mic"),Ge()()(),zn(30,T9,22,7,"div",20),zn(31,I9,18,2,"div",20),De(32,"div",1)(33,"button",21),Xt("click",function(){return a.onEndCall()}),De(34,"div",3),be(),De(35,"svg",4)(36,"g",22)(37,"g",6),tn(38,"path",23)(39,"path",24)(40,"path",25),Ge()()()(),Qa(),De(41,"p"),$i(42,"End"),Ge()()()()),2&t&&(In("controls--small",a.smallScreenEnabled),Xe(2),In("controls__button--active",a.cameraEnabled),Xe(3),In("controls__icon--shown",a.cameraEnabled),Xe(4),In("controls__icon--shown",!a.cameraEnabled),Xe(10),In("controls__button--active",a.microphoneEnabled),Xe(3),In("controls__icon--shown",a.microphoneEnabled),Xe(4),In("controls__icon--shown",!a.microphoneEnabled),Xe(4),Ze("ngIf",!a.smallScreenEnabled),Xe(1),Ze("ngIf",a.displaySmallScreen))},dependencies:[cl],styles:["[_nghost-%COMP%]{transition:.3s}.controls[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);bottom:0;display:flex;justify-content:center;padding:15px 0;position:absolute;left:0;width:100%}.controls--small[_ngcontent-%COMP%]{border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding:5px 0}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{height:32px;width:32px}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:16px;width:16px}.controls--small[_ngcontent-%COMP%]   .controls__item[_ngcontent-%COMP%]{margin:0}.controls--small[_ngcontent-%COMP%]   .controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:none}.controls__item[_ngcontent-%COMP%]{margin:0 5px;text-align:center}.controls__button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer}.controls__button[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#101316}.controls__button--active[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#0b73c9}.controls__button--active[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#158ef2}.controls__button--active.controls__button--rotate[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transform:translate(-50%,-50%) rotate(-180deg)}.controls__button--danger[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#d73b3d}.controls__button--danger[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#e06567}.controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;margin:8px 0 0}.controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#313a42;border-radius:50%;box-shadow:0 3px 8px #00000080;margin:auto;position:relative;height:60px;width:60px;transition:.3s}.controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%) rotate(0);height:32px;width:32px;transition:.3s}.controls__icon[_ngcontent-%COMP%]{opacity:0;transition:.3s}.controls__icon--shown[_ngcontent-%COMP%]{opacity:1}"],changeDetection:0}),r})(),V9=(()=>{class r{constructor(){this.error=!1,this.connected=!0,this.ended=!1,this.small=!1}get color(){return this.ended?"#aaa":this.error?"#d73b3d":this.connected?"#37D425":"#1195E6"}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=qr({type:r,selectors:[["ngx-spinner"]],inputs:{text:"text",error:"error",connected:"connected",ended:"ended",small:"small"},decls:8,vars:9,consts:[[1,"spinner",3,"ngClass"],[1,"spinner__wrapper"],[1,"spinner__icon"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 32 32","fill","none"],["d","M5.25 5.5C3.45507 5.5 2 6.95508 2 8.75V19.25C2 21.0449 3.45507 22.5 5.25 22.5H14.75C16.5449 22.5 18 21.0449 18 19.25V8.75C18 6.95507 16.5449 5.5 14.75 5.5H5.25Z"],["d","M23.1232 20.6431L19.5 17.0935V10.9989L23.1121 7.3706C23.8988 6.58044 25.248 7.13753 25.248 8.25251V19.7502C25.248 20.8577 23.9143 21.4181 23.1232 20.6431Z"],[1,"spinner__cirle"],["class","spinner__text",4,"ngIf"],[1,"spinner__text"]],template:function(t,a){1&t&&(De(0,"div",0)(1,"div",1)(2,"div",2),be(),De(3,"svg",3),tn(4,"path",4)(5,"path",5),Ge()(),Qa(),tn(6,"div",6),zn(7,R9,2,1,"div",7),Ge()()),2&t&&(Ze("ngClass",SC(4,w9,a.connected,a.ended,a.small,a.error)),Xe(4),tr("fill",a.color),Xe(1),tr("fill",a.color),Xe(2),Ze("ngIf",!a.small))},dependencies:[ub,cl],styles:[".spinner[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;position:relative;transition:.3s}.spinner--connected[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#37d425}.spinner--ended[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:transparent}.spinner--error[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#d73b3d}.spinner--small[_ngcontent-%COMP%]{border-radius:10px;height:200px}.spinner--small[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-width:4px;height:80px;width:80px}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]{top:26px;transform:translate(-35%)}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.spinner__wrapper[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}.spinner__cirle[_ngcontent-%COMP%]{animation:spin 2s linear infinite;border:5px solid #1195E6;border-radius:50%;border-top-color:transparent;height:160px;margin:auto;width:160px;transition:.3s}.spinner__icon[_ngcontent-%COMP%]{left:50%;position:absolute;top:52px;transform:translate(-40%);transition:.3s}.spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px;transition:.3s}.spinner__text[_ngcontent-%COMP%]{color:#fff;font-size:1.3em;margin-top:25px;text-align:center}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"],changeDetection:0}),r})(),B9=(()=>{class r{constructor(){this.started=Date.now()}ngOnInit(){this.time$=d3(0,1e3).pipe(xt(()=>this.format(Date.now()-this.started)))}format(t){const a=Math.floor(t/1e3%60).toString().padStart(2,"0"),l=Math.floor(t/6e4%60).toString().padStart(2,"0");return[Math.floor(t/36e5%24).toString().padStart(2,"0"),l,a].join(":")}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=qr({type:r,selectors:[["ngx-timer"]],inputs:{started:"started"},decls:4,vars:3,consts:[[1,"timer"]],template:function(t,a){1&t&&(De(0,"div",0)(1,"span"),$i(2),gf(3,"async"),Ge()()),2&t&&(Xe(2),fs(Qu(3,1,a.time$)))},dependencies:[CE],styles:[".timer[_ngcontent-%COMP%]{color:#fff;position:relative;text-align:center;z-index:1}.timer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);border-radius:5px;padding:5px 10px}"],changeDetection:0}),r})(),j9=(()=>{class r extends Cj{constructor(t){super(t),this.fullScreen=!1}ngOnInit(){this.play(`assets/${this.data.outcome?"outcome":"income"}.mp3`)}ngOnDestroy(){this.stop()}onAcceptCall(){this.fullScreen=!0,this.cdr.markForCheck(),this.afterClosed.next(this.data)}onDeclineCall(){this.play("assets/cancel.mp3"),setTimeout(()=>this.closeDialog(null),200)}play(t,a=!0){this.audio&&this.stop(),this.audio=new Audio(t),this.audio.loop=a,this.audio.load(),this.audio.play()}stop(){this.audio.pause(),this.audio.remove()}}return r.\u0275fac=function(t){return new(t||r)(se(nn))},r.\u0275cmp=qr({type:r,selectors:[["ngx-video-call"]],inputs:{data:"data"},features:[Ft],decls:1,vars:1,consts:[["class","video-call",3,"video-call--full-screen",4,"ngIf"],[1,"video-call"],[1,"video-call-user"],[1,"video-call-user__block","video-call-user__block--animated"],["alt","",1,"video-call-user__img",3,"src"],[1,"video-call-user__title"],[4,"ngIf","ngIfElse"],["income",""],[1,"video-call__actions"],[4,"ngIf"],["aria-label","Decline",1,"video-call__button","video-call__button--decline",3,"click"],["aria-label","Accept",1,"video-call__button","video-call__button--accept",3,"click"]],template:function(t,a){1&t&&zn(0,N9,12,7,"div",0),2&t&&Ze("ngIf",a.shown&&a.data)},dependencies:[cl],styles:['[_nghost-%COMP%]{display:block;height:100vh;position:relative}.video-call[_ngcontent-%COMP%]{background-image:linear-gradient(#3F51B5,#313A42);background-size:cover;border-radius:10px;box-shadow:0 5px 10px #0000001a;display:flex;flex-direction:column;height:100%;justify-content:flex-end;left:50%;max-height:400px;max-width:400px;position:absolute;top:50%;transform:translate(-50%,-50%);width:100%;z-index:5;transition:.3s}.video-call--full-screen[_ngcontent-%COMP%]{background-image:linear-gradient(#22292F);border-radius:0;max-height:100%;max-width:100%}.video-call-user[_ngcontent-%COMP%]{left:50%;position:absolute;text-align:center;top:50%;transform:translate(-50%,-55%);z-index:1}.video-call-user__block[_ngcontent-%COMP%]{background:#fff;border-radius:50%;border:solid 5px #fff;height:180px;margin:0 auto;transform:scale(1);width:180px}.video-call-user__block--animated[_ngcontent-%COMP%]{animation:play 2s ease infinite;backface-visibility:hidden}.video-call-user__img[_ngcontent-%COMP%]{border-radius:50%;height:100%;left:0;object-fit:cover;position:absolute;top:0;width:100%}.video-call-user__title[_ngcontent-%COMP%]{color:#fff;font-size:1.2em;font-weight:700;margin:15px 0 0}.video-call__actions[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:10px 0}.video-call__button[_ngcontent-%COMP%]{border-radius:50%;box-shadow:0 0 #3f51b500,0 .05em .1em #0003;border:0;cursor:pointer;display:block;font-size:40px;height:1em;margin:0 5px;position:relative;transform:translateZ(0) scale(1);width:1em;transition:.3s}.video-call__button[_ngcontent-%COMP%]:before, .video-call__button[_ngcontent-%COMP%]:after{content:"";position:absolute}.video-call__button[_ngcontent-%COMP%]:before{background-color:#ffffff1a;border-radius:50%;height:1em;left:0;opacity:1;top:0;transform:translateZ(0) scale(0);width:1em}.video-call__button[_ngcontent-%COMP%]:after{background-position:50% 50%;background-repeat:no-repeat;background-size:cover;background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTYuNiAxMC44YzEuNCAyLjggMy44IDUuMSA2LjYgNi42bDIuMi0yLjJjLjMtLjMuNy0uNCAxLS4yIDEuMS40IDIuMy42IDMuNi42LjUgMCAxIC40IDEgMVYyMGMwIC41LS41IDEtMSAxLTkuNCAwLTE3LTcuNi0xNy0xNyAwLS42LjQtMSAxLTFoMy41Yy41IDAgMSAuNCAxIDEgMCAxLjIuMiAyLjUuNiAzLjYuMS40IDAgLjctLjIgMWwtMi4zIDIuMnoiIGZpbGw9IiNmZmZmZmYiLz48L3N2Zz4=);height:.5em;left:.25em;top:.25em;transform:translateZ(0);width:.5em;transition:.3s}.video-call__button--accept[_ngcontent-%COMP%]{animation:phone-outer 3s infinite;background-color:#3f51b5}.video-call__button--accept[_ngcontent-%COMP%]:before{animation:phone-inner 3s infinite}.video-call__button--accept[_ngcontent-%COMP%]:after{animation:phone-icon 3s infinite}.video-call__button--decline[_ngcontent-%COMP%]{background-color:#d73b3d}.video-call__button--decline[_ngcontent-%COMP%]:hover{background-color:#ce2a2c}.video-call__button--decline[_ngcontent-%COMP%]:after{top:.28em;transform:translateZ(0) rotate(135deg)}@keyframes play{0%{transform:scale(1)}15%{box-shadow:0 0 0 5px #9b9da466}25%{box-shadow:0 0 0 10px #9b9da466,0 0 0 20px #9b9da433}25%{box-shadow:0 0 0 15px #9b9da466,0 0 0 30px #9b9da433}}@keyframes phone-outer{0%{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}33.3333%{box-shadow:0 0 #3f51b51a,0 .05em .1em #00000080;transform:translateZ(0) scale(1.1)}66.6666%{box-shadow:0 0 0 .5em #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}to{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}}@keyframes phone-inner{0%{opacity:1;transform:translateZ(0) scale(0)}33.3333%{opacity:1;transform:translateZ(0) scale(.9)}66.6666%{opacity:0;transform:translateZ(0) scale(0)}to{opacity:0;transform:translateZ(0) scale(0)}}@keyframes phone-icon{0%{transform:translateZ(0)}2%{transform:translate3d(.01em,0,0)}4%{transform:translate3d(-.01em,0,0)}6%{transform:translate3d(.01em,0,0)}8%{transform:translate3d(-.01em,0,0)}10%{transform:translate3d(.01em,0,0)}12%{transform:translate3d(-.01em,0,0)}14%{transform:translate3d(.01em,0,0)}16%{transform:translate3d(-.01em,0,0)}18%{transform:translate3d(.01em,0,0)}20%{transform:translate3d(-.01em,0,0)}22%{transform:translate3d(.01em,0,0)}24%{transform:translate3d(-.01em,0,0)}26%{transform:translate3d(.01em,0,0)}28%{transform:translate3d(-.01em,0,0)}30%{transform:translate3d(.01em,0,0)}32%{transform:translate3d(-.01em,0,0)}34%{transform:translate3d(.01em,0,0)}36%{transform:translate3d(-.01em,0,0)}38%{transform:translate3d(.01em,0,0)}40%{transform:translate3d(-.01em,0,0)}42%{transform:translate3d(.01em,0,0)}44%{transform:translate3d(-.01em,0,0)}46%{transform:translateZ(0)}}'],data:{animation:[Sj]},changeDetection:0}),r})(),H9=(()=>{class r{constructor(t,a,l,u){this.document=t,this.componentFactoryResolver=a,this.appRef=l,this.injector=u,this.wrapperSelector="ngx-webrtc-wrapper"}open(t,a={}){return this.appendComponent(t,a)}appendComponent(t,a){const l=this.componentFactoryResolver.resolveComponentFactory(t).create(this.injector),{instance:u}=l;Object.keys(a).forEach(g=>u[g]=a[g]),this.appRef.attachView(l.hostView);const f=l.hostView.rootNodes[0];return this.getContainer().append(f),u.afterClosed.pipe(ho(1),function v9(r,e=dy){const a=function y9(r){return r instanceof Date&&!isNaN(+r)}(r)?+r-e.now():Math.abs(r);return l=>l.lift(new S9(a,e))}(250)).subscribe(()=>{this.appRef.detachView(l.hostView),l.destroy()}),u}getContainer(){let t=this.document.querySelector(`.${this.wrapperSelector}`);return t||(t=this.document.createElement("div"),t.setAttribute("class",this.wrapperSelector),t.setAttribute("style","position: fixed; top: 0; width: 100%;"),this.document.body.appendChild(t)),t}}return r.\u0275fac=function(t){return new(t||r)(he(rn),he(td),he(bd),he(Nr))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const bj={connected:!1,loading:!0,statusText:"Initializing",started:null,ended:!1,error:!1},G9={mode:"rtc",codec:"h264"};let Tj=(()=>{class r{constructor(t){this.config=t,this.agoraRTC=b9,this.streamState=new y(bj),this.remoteStreamVideoToggle=new y(!0),this.callEnd=new fn,this.localContainerId="local-video",this.remoteCalls=[],this.remoteStreamVideoToggle$=this.remoteStreamVideoToggle.asObservable(),this.streamState$=this.streamState.asObservable(),this.agoraRTC.checkSystemRequirements()||this.handleError(new Error("Web RTC is not supported in this browser"))}init(t,a,l=!1){return this.uid=t,this.agoraRTC.setLogLevel(l?0:4),this.client=this.agoraRTC.createClient(G9),this.assignClientHandlers(),this.initLocalStream().then(()=>{this.client.join(this.config.AppID,a,null,this.uid).then(()=>{this.localTracks.videoTrack.play(this.localContainerId),this.client.publish(Object.values(this.localTracks)),this.streamState.next({...this.streamState.value,connected:!0,statusText:"Waiting others to join"})})}),this.callEnd.asObservable()}deinit(){this.streamState.next(bj)}endCall(){this.client.leave().then(()=>{Object.values(this.localTracks).forEach(t=>{t.stop(),t.close()}),this.streamState.next({...this.streamState.value,started:null,loading:!0,statusText:"",ended:!0}),this.remoteCalls=[],sF(500).pipe(ho(1)).subscribe(()=>this.callEnd.next())})}toggleVideo(t){this.localTracks&&this.localTracks.videoTrack.setMuted(t)}toggleAudio(t){this.localTracks&&this.localTracks.audioTrack.setMuted(t)}toggleFullScreen(t){t?document.exitFullscreen():document.documentElement.requestFullscreen()}isVideoEnabled(){return!!this.localTracks&&!this.localTracks.videoTrack.muted}isAudioEnabled(){return!!this.localTracks&&!this.localTracks.audioTrack.muted}assignClientHandlers(){this.client.on("user-joined",t=>{this.streamState.next({...this.streamState.value,started:Date.now(),loading:!1}),this.remoteCalls.length||this.remoteCalls.push(this.getRemoteId(t))}),this.client.on("user-published",(t,a)=>{const l=this.getRemoteId(t);this.client.subscribe(t,a).then(u=>{this.remoteCalls.includes(l)&&u.play(l)})}),this.client.on("user-info-updated",(t,a)=>{"mute-video"===a&&this.remoteStreamVideoToggle.next(!1),"unmute-video"===a&&this.remoteStreamVideoToggle.next(!0)}),this.client.on("user-left",()=>{this.endCall()})}initLocalStream(){return Promise.all([this.agoraRTC.createCameraVideoTrack(),this.agoraRTC.createMicrophoneAudioTrack()]).then(([t,a])=>{this.localTracks={audioTrack:a,videoTrack:t}}).catch(t=>{this.handleError(t)})}getRemoteId(t){return`remote_call-${t.uid}`}handleError(t){throw this.streamState.next({...this.streamState.value,statusText:t.message,error:!0}),sF(5e3).pipe(ho(1)).subscribe(()=>this.callEnd.next()),new Error(t.message)}}return r.\u0275fac=function(t){return new(t||r)(he("AgoraConfig"))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),W9=(()=>{class r{constructor(t,a){this.renderer=t,this.el=a,this.subscription=new Cn,this.delay=5e3}onEnter(){this.subscription.unsubscribe(),this.setStyle(1)}onLeave(){this.hide()}ngOnInit(){this.hide()}hide(){this.subscription.unsubscribe(),this.subscription=sF(this.delay).pipe(ho(1)).subscribe(()=>this.setStyle(0))}setStyle(t){this.renderer.setStyle(this.el.nativeElement,"opacity",t)}}return r.\u0275fac=function(t){return new(t||r)(se(Ls),se(ci))},r.\u0275dir=Be({type:r,selectors:[["","ngxToggle",""]],hostBindings:function(t,a){1&t&&Xt("mouseenter",function(){return a.onEnter()})("mouseleave",function(){return a.onLeave()})}}),r})(),Ij=(()=>{class r extends Cj{constructor(t,a){super(a),this.webRtcService=t,this.animate=!0,this.displaySmallScreen=!1,this.debug=!1,this.callEnd=new un,this.smallScreenEnabled=!1,this.active=!1,this.streamState$=this.webRtcService.streamState$,this.remoteStreamVideoToggle$=this.webRtcService.remoteStreamVideoToggle$}ngOnInit(){this.webRtcService.init(this.uid,this.channel,this.debug).pipe(ho(1)).subscribe(()=>{this.active=this.smallScreenEnabled,this.callEnd.emit(),this.closeDialog(!0)})}ngOnDestroy(){this.webRtcService.deinit()}get localContainerId(){return this.webRtcService.localContainerId}get remoteCalls(){return this.webRtcService.remoteCalls}get cameraEnabled(){return this.webRtcService.isVideoEnabled()}get microphoneEnabled(){return this.webRtcService.isAudioEnabled()}get fullScreenEnabled(){return!!document.fullscreenElement}onToggleCamera(t){this.webRtcService.toggleVideo(t)}onToggleMicrophone(t){this.webRtcService.toggleAudio(t)}onToggleFullScreen(t){this.webRtcService.toggleFullScreen(t)}onToggleSmallScreen(t){this.smallScreenEnabled=!t,this.active=!0}onEndCall(){this.webRtcService.endCall()}}return r.\u0275fac=function(t){return new(t||r)(se(Tj),se(nn))},r.\u0275cmp=qr({type:r,selectors:[["ngx-webrtc"]],hostVars:4,hostBindings:function(t,a){2&t&&In("small-screen",a.smallScreenEnabled)("active",a.active)},inputs:{uid:"uid",channel:"channel",animate:"animate",displaySmallScreen:"displaySmallScreen",debug:"debug"},outputs:{callEnd:"callEnd"},features:[Ft],decls:1,vars:1,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[1,"container"],[3,"error","text","connected","ended","small",4,"ngIf"],[3,"started",4,"ngIf"],[1,"container__local",3,"id"],["class","container__remote",3,"id","hidden",4,"ngFor","ngForOf"],[1,"container__user-icon"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","user","clip-path","url(#clip0)"],["id","Vector","d","M31.5439 30.829C35.7793 30.829 39.4468 29.3099 42.4434 26.3129C45.4399 23.3163 46.959 19.6498 46.959 15.414C46.959 11.1796 45.4399 7.51267 42.4429 4.51512C39.4458 1.51904 35.7788 0 31.5439 0C27.3081 0 23.6416 1.51904 20.645 4.51561C17.6484 7.51218 16.1289 11.1792 16.1289 15.414C16.1289 19.6498 17.6484 23.3168 20.6455 26.3134C23.6426 29.3095 27.3096 30.829 31.5439 30.829V30.829Z","fill","#0B73C9"],["id","Vector_2","d","M58.5161 49.2127C58.4297 47.9656 58.2549 46.6053 57.9976 45.1688C57.7378 43.7215 57.4033 42.3533 57.0029 41.1029C56.5894 39.8104 56.0269 38.534 55.3315 37.3109C54.6099 36.0414 53.7622 34.9359 52.811 34.0262C51.8164 33.0746 50.5986 32.3094 49.1904 31.7513C47.7871 31.1962 46.2319 30.9149 44.5684 30.9149C43.915 30.9149 43.2832 31.183 42.063 31.9774C41.312 32.4672 40.4336 33.0336 39.4531 33.66C38.6147 34.1942 37.479 34.6947 36.0762 35.1478C34.7075 35.5907 33.3179 35.8153 31.9463 35.8153C30.5747 35.8153 29.1855 35.5907 27.8154 35.1478C26.4141 34.6952 25.2783 34.1947 24.4409 33.6605C23.4697 33.0399 22.5908 32.4735 21.8286 31.9769C20.6099 31.1825 19.9775 30.9144 19.3242 30.9144C17.6602 30.9144 16.1055 31.1962 14.7026 31.7518C13.2954 32.309 12.0771 33.0741 11.0815 34.0267C10.1309 34.9369 9.28271 36.0419 8.56201 37.3109C7.86719 38.534 7.30469 39.8099 6.89062 41.1034C6.49072 42.3538 6.15625 43.7215 5.89648 45.1688C5.63916 46.6033 5.46436 47.9642 5.37793 49.2142C5.29297 50.4388 5.25 51.7098 5.25 52.9934C5.25 56.3343 6.31201 59.0388 8.40625 61.0335C10.4746 63.0017 13.2114 64.0002 16.5396 64.0002H47.356C50.6841 64.0002 53.4199 63.0022 55.4888 61.0335C57.5835 59.0403 58.6455 56.3352 58.6455 52.993C58.645 51.7034 58.6016 50.4314 58.5161 49.2127V49.2127Z","fill","#0B73C9"],["id","clip0"],["width","64","height","64","fill","#0B73C9"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall",4,"ngIf"],[3,"error","text","connected","ended","small"],[3,"started"],[1,"container__remote",3,"id"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall"]],template:function(t,a){1&t&&zn(0,F9,3,5,"div",0),2&t&&Ze("ngIf",a.shown)},dependencies:[al,cl,U9,B9,V9,W9,CE],styles:["ngx-timer[_ngcontent-%COMP%]{display:block;padding-top:25px}[_nghost-%COMP%]{bottom:0;max-width:100%;right:0;width:100%;transition:.3s}.active[_nghost-%COMP%]{position:fixed}.small-screen[_nghost-%COMP%]{max-width:210px}.small-screen[_nghost-%COMP%]   ngx-timer[_ngcontent-%COMP%]{padding-top:10px}.small-screen[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{border-radius:10px;box-shadow:#00000059 0 5px 15px;height:200px;max-width:200px;margin-right:10px;margin-bottom:10px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]{border-radius:10px;height:200px;width:200px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]    >div{border-radius:10px}.small-screen[_nghost-%COMP%]   .container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.container[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;max-width:100%;margin-left:auto;overflow:hidden;position:relative;transition:.3s}.container__local[_ngcontent-%COMP%]{border-radius:5px;height:20vh;opacity:1;overflow:hidden;position:absolute;right:1rem;top:1rem;width:20vw;z-index:1;transition:.3s}.container__local.hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden}.container__local[_ngcontent-%COMP%]:not(:empty){box-shadow:0 3px 8px #00000080}.container__remote[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;left:0;position:absolute;top:0;width:100vw;transition:.3s}.container__remote[_ngcontent-%COMP%]    >div{transition:.3s}.container__remote.hidden[_ngcontent-%COMP%]{display:none}.container__remote.hidden[_ngcontent-%COMP%] + .container__user-icon[_ngcontent-%COMP%]{display:block}.container__remote[_ngcontent-%COMP%]:empty{display:none}.container__user-icon[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);border-radius:50%;box-shadow:0 3px 8px #00000080;display:none;left:50%;padding:20px;position:absolute;top:50%;transform:translate(-50%,-50%)}.container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px}@media screen and (max-width: 769px){ngx-controls[_ngcontent-%COMP%]{opacity:1!important}}"],data:{animation:[Sj]},changeDetection:0}),r})(),z9=(()=>{class r{constructor(t){this.dialog=t}open(t){const a=new fn,l=this.dialog.open(j9,{data:t});return l.afterClosed.asObservable().pipe(Ga(u=>u?.channel?this.dialog.open(Ij,{uid:u.uid,channel:u.channel,debug:!!u.debug,displaySmallScreen:!0}).afterClosed.asObservable():S(!1)),ho(1),Hr(()=>a.next(!0))).subscribe(),{acceptCall:l.onAcceptCall.bind(l),close:l.closeDialog.bind(l),afterConfirmation:()=>l.afterClosed.asObservable().pipe(ho(1)),afterCallEnd:()=>a.asObservable().pipe(ho(1))}}}return r.\u0275fac=function(t){return new(t||r)(he(H9))},r.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),K9=(()=>{class r{static forRoot(t){return{ngModule:r,providers:[Tj,{provide:"AgoraConfig",useValue:t}]}}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r}),r.\u0275inj=Zt({imports:[sn]}),r})();const q9=[{path:"",component:(()=>{class r{constructor(t,a,l,u,f){this.formBuilder=t,this.router=a,this.localStorage=l,this.videoCallDialogService=u,this.cdr=f,this.sessionKey="ngx-webrtc:channelId",this.outcome=!1}get channelId(){return this.localStorage.getItem(this.sessionKey)||"test-channel-ngx-webrtc"}get tooltipText(){return this.outcome?"Outcome":"Income"}ngOnInit(){this.form=this.formBuilder.group({channelId:[this.channelId,dO.required]})}onSubmit(){this.saveChannel(),this.router.navigate(["conference"],{queryParams:{...this.form.value}})}onModalOpen(){this.saveChannel(),this.dialog=this.videoCallDialogService.open({uid:String(Math.floor(100*Math.random())),channel:this.channelId,outcome:this.outcome,user:{name:"Test User",photoURL:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTvDtoEwuV9E2kHqNDi6MnBzXlefn8TfyrwgQ&usqp=CAU"},debug:!0});const t=setTimeout(()=>this.dialog?.close(),7e3);this.dialog.afterConfirmation().pipe(bl(a=>!!a),Hr(()=>clearTimeout(t))).subscribe(),this.dialog.afterCallEnd().subscribe(()=>{clearTimeout(t),this.dialog=null,this.cdr.markForCheck()})}saveChannel(){const{channelId:t}=this.form.value;this.localStorage.setItem(this.sessionKey,t)}}return r.\u0275fac=function(t){return new(t||r)(se(kx),se(Tr),se(Storage),se(z9),se(nn))},r.\u0275cmp=qr({type:r,selectors:[["app-home"]],decls:25,vars:8,consts:[[1,"home"],[1,"home__welcome"],[1,"home__form",3,"formGroup","ngSubmit"],[1,"home__wrapper","home__wrapper--center"],["src","assets/user.svg","alt","User",1,"user"],[1,"home__title"],[1,"home__wrapper"],["matInput","","placeholder","Channel id","formControlName","channelId"],[1,"home__wrapper","home__wrapper--center","home__wrapper--buttons"],["mat-flat-button","","color","primary",1,"home__btn",3,"disabled"],["mat-raised-button","","type","button",1,"home__btn",3,"disabled","click"],[3,"checked","disabled","matTooltip","change","click"],[1,"home__footer"],["href","https://www.npmjs.com/package/ngx-webrtc-lib","target","_blank"],["viewBox","0 0 27.23 27.23"],["width","27.23","height","27.23","rx","2"],["fill","#fff","points","5.8 21.75 13.66 21.75 13.67 9.98 17.59 9.98 17.58 21.76 21.51 21.76 21.52 6.06 5.82 6.04 5.8 21.75"],["href","https://github.com/TarasMoskovych/ngx-webrtc","target","_blank"],["aria-hidden","true","role","img","viewBox","0 0 16 16","width","50","height","50",1,""],["fill-rule","evenodd","d","M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"]],template:function(t,a){1&t&&(De(0,"div",0)(1,"div",1)(2,"form",2),Xt("ngSubmit",function(){return!a.dialog&&a.onSubmit()}),De(3,"div",3),tn(4,"img",4),Ge(),De(5,"h1",5),$i(6," Welcome "),Ge(),De(7,"mat-form-field",6)(8,"mat-label"),$i(9,"Channel Id"),Ge(),tn(10,"input",7),Ge(),De(11,"div",8)(12,"button",9),$i(13,"Start / Join call"),Ge(),De(14,"button",10),Xt("click",function(){return!a.dialog&&a.onModalOpen()}),$i(15,"Open Call Dialog "),De(16,"mat-slide-toggle",11),Xt("change",function(u){return a.outcome=u.checked})("click",function(u){return u.stopPropagation()}),Ge()()()(),De(17,"div",12)(18,"a",13),be(),De(19,"svg",14),tn(20,"rect",15)(21,"polygon",16),Ge()(),Qa(),De(22,"a",17),be(),De(23,"svg",18),tn(24,"path",19),Ge()()()()()),2&t&&(Xe(2),Ze("formGroup",a.form),Xe(5),In("mat-focused",a.form.valid),Xe(5),Ze("disabled",a.form.invalid||!!a.dialog),Xe(2),Ze("disabled",a.form.invalid||!!a.dialog),Xe(2),Ze("checked",a.outcome)("disabled",!!a.dialog)("matTooltip",a.tooltipText))},dependencies:[rT,cm,Jo,qb,zd,Ao,m5,Qx,v5,L4,w6,s3],styles:[".home[_ngcontent-%COMP%]{align-items:center;background-color:#f2f2f2;display:flex;flex-wrap:wrap;justify-content:center;min-height:100vh;width:100%}.home__welcome[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 5px 10px #0000001a;overflow:hidden;padding:10px 40px;width:390px}.home__welcome[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{height:150px}.home__title[_ngcontent-%COMP%]{color:#333;display:block;font-size:30px;font-weight:500;margin:10px 0 60px;text-align:center}.home__wrapper[_ngcontent-%COMP%]{width:100%}.home__wrapper--center[_ngcontent-%COMP%]{text-align:center}.home__wrapper--buttons[_ngcontent-%COMP%]{align-items:center;display:flex}.home__btn[_ngcontent-%COMP%]{margin:0 5px}.home__footer[_ngcontent-%COMP%]{margin-top:30px;text-align:center}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:#333;cursor:pointer;height:24px;margin:0 5px;width:24px;transition:.3s}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]:hover{fill:#aaa}"],changeDetection:0}),r})()},{path:"conference",component:(()=>{class r{constructor(t,a){this.route=t,this.router=a,this.uid=String(Math.floor(100*Math.random()))}ngOnInit(){this.channel=this.route.snapshot.queryParams.channelId||"test-channel"}onCallEnd(){this.router.navigateByUrl("/")}}return r.\u0275fac=function(t){return new(t||r)(se(Kh),se(Tr))},r.\u0275cmp=qr({type:r,selectors:[["app-conference"]],decls:1,vars:4,consts:[[3,"animate","channel","debug","uid","callEnd"]],template:function(t,a){1&t&&(De(0,"ngx-webrtc",0),Xt("callEnd",function(){return a.onCallEnd()}),Ge()),2&t&&Ze("animate",!1)("channel",a.channel)("debug",!0)("uid",a.uid)},dependencies:[Ij],changeDetection:0}),r})()},{path:"**",redirectTo:""}];let Y9=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=On({type:r,bootstrap:[g9]}),r.\u0275inj=Zt({providers:[{provide:Storage,useValue:window.localStorage}],imports:[im,D8,K9.forRoot(vj_configs),sy,d9.forRoot(q9),S5,x4,O6,M5]}),r})();(function V1(){JA=!1})(),BE().bootstrapModule(Y9).catch(r=>console.error(r))},890:function(xc,xm,Fm){var x=Fm(156).default;xc.exports=function(){"use strict";let Zi=!0,is=!0;function rs(o,n,i){const s=o.match(n);return s&&s.length>=i&&parseInt(s[i],10)}function ur(o,n,i){if(!o.RTCPeerConnection)return;const s=o.RTCPeerConnection.prototype,c=s.addEventListener;s.addEventListener=function(h,p){if(h!==n)return c.apply(this,arguments);const m=_=>{const E=i(_);E&&(p.handleEvent?p.handleEvent(E):p(E))};return this._eventMap=this._eventMap||{},this._eventMap[n]||(this._eventMap[n]=new Map),this._eventMap[n].set(p,m),c.apply(this,[h,m])};const d=s.removeEventListener;s.removeEventListener=function(h,p){if(h!==n||!this._eventMap||!this._eventMap[n])return d.apply(this,arguments);if(!this._eventMap[n].has(p))return d.apply(this,arguments);const m=this._eventMap[n].get(p);return this._eventMap[n].delete(p),0===this._eventMap[n].size&&delete this._eventMap[n],0===Object.keys(this._eventMap).length&&delete this._eventMap,d.apply(this,[h,m])},Object.defineProperty(s,"on"+n,{get(){return this["_on"+n]},set(h){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),h&&this.addEventListener(n,this["_on"+n]=h)},enumerable:!0,configurable:!0})}function Ka(o){return"boolean"!=typeof o?new Error("Argument type: "+typeof o+". Please use a boolean."):(Zi=o,o?"adapter.js logging disabled":"adapter.js logging enabled")}function iu(o){return"boolean"!=typeof o?new Error("Argument type: "+typeof o+". Please use a boolean."):(is=!o,"adapter.js deprecation warnings "+(o?"disabled":"enabled"))}function os(){if("object"==typeof window){if(Zi)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Cn(o,n){is&&console.warn(o+" is deprecated, please use "+n+" instead.")}function Iy(o){return"[object Object]"===Object.prototype.toString.call(o)}function Yh(o){return Iy(o)?Object.keys(o).reduce(function(n,i){const s=Iy(o[i]),c=s?Yh(o[i]):o[i],d=s&&!Object.keys(c).length;return void 0===c||d?n:Object.assign(n,{[i]:c})},{}):o}function qT(o,n,i){n&&!i.has(n.id)&&(i.set(n.id,n),Object.keys(n).forEach(s=>{s.endsWith("Id")?qT(o,o.get(n[s]),i):s.endsWith("Ids")&&n[s].forEach(c=>{qT(o,o.get(c),i)})}))}function bn(o,n,i){const s=i?"outbound-rtp":"inbound-rtp",c=new Map;if(null===n)return c;const d=[];return o.forEach(h=>{"track"===h.type&&h.trackIdentifier===n.id&&d.push(h)}),d.forEach(h=>{o.forEach(p=>{p.type===s&&p.trackId===h.id&&qT(o,p,c)})}),c}const Ry=os;function YT(o,n){const i=o&&o.navigator;if(!i.mediaDevices)return;const s=function(h){if("object"!=typeof h||h.mandatory||h.optional)return h;const p={};return Object.keys(h).forEach(m=>{if("require"===m||"advanced"===m||"mediaSource"===m)return;const _="object"==typeof h[m]?h[m]:{ideal:h[m]};void 0!==_.exact&&"number"==typeof _.exact&&(_.min=_.max=_.exact);const E=function(y,S){return y?y+S.charAt(0).toUpperCase()+S.slice(1):"deviceId"===S?"sourceId":S};if(void 0!==_.ideal){p.optional=p.optional||[];let y={};"number"==typeof _.ideal?(y[E("min",m)]=_.ideal,p.optional.push(y),y={},y[E("max",m)]=_.ideal,p.optional.push(y)):(y[E("",m)]=_.ideal,p.optional.push(y))}void 0!==_.exact&&"number"!=typeof _.exact?(p.mandatory=p.mandatory||{},p.mandatory[E("",m)]=_.exact):["min","max"].forEach(y=>{void 0!==_[y]&&(p.mandatory=p.mandatory||{},p.mandatory[E(y,m)]=_[y])})}),h.advanced&&(p.optional=(p.optional||[]).concat(h.advanced)),p},c=function(h,p){if(n.version>=61)return p(h);if((h=JSON.parse(JSON.stringify(h)))&&"object"==typeof h.audio){const m=function(_,E,y){E in _&&!(y in _)&&(_[y]=_[E],delete _[E])};m((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),m(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=s(h.audio)}if(h&&"object"==typeof h.video){let m=h.video.facingMode;m=m&&("object"==typeof m?m:{ideal:m});const _=n.version<66;if(m&&("user"===m.exact||"environment"===m.exact||"user"===m.ideal||"environment"===m.ideal)&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||_)){let E;if(delete h.video.facingMode,"environment"===m.exact||"environment"===m.ideal?E=["back","rear"]:"user"!==m.exact&&"user"!==m.ideal||(E=["front"]),E)return i.mediaDevices.enumerateDevices().then(y=>{let S=(y=y.filter(T=>"videoinput"===T.kind)).find(T=>E.some(O=>T.label.toLowerCase().includes(O)));return!S&&y.length&&E.includes("back")&&(S=y[y.length-1]),S&&(h.video.deviceId=m.exact?{exact:S.deviceId}:{ideal:S.deviceId}),h.video=s(h.video),Ry("chrome: "+JSON.stringify(h)),p(h)})}h.video=s(h.video)}return Ry("chrome: "+JSON.stringify(h)),p(h)},d=function(h){return n.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=function(h,p,m){c(h,_=>{i.webkitGetUserMedia(_,p,E=>{m&&m(d(E))})})}.bind(i),i.mediaDevices.getUserMedia){const h=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(p){return c(p,m=>h(m).then(_=>{if(m.audio&&!_.getAudioTracks().length||m.video&&!_.getVideoTracks().length)throw _.getTracks().forEach(E=>{E.stop()}),new DOMException("","NotFoundError");return _},_=>Promise.reject(d(_))))}}}function $T(o){o.MediaStream=o.MediaStream||o.webkitMediaStream}function ru(o){if("object"==typeof o&&o.RTCPeerConnection&&!("ontrack"in o.RTCPeerConnection.prototype)){Object.defineProperty(o.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const n=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",s=>{let c;c=o.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===s.track.id):{track:s.track};const d=new Event("track");d.track=s.track,d.receiver=c,d.transceiver={receiver:c},d.streams=[i.stream],this.dispatchEvent(d)}),i.stream.getTracks().forEach(s=>{let c;c=o.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===s.id):{track:s};const d=new Event("track");d.track=s,d.receiver=c,d.transceiver={receiver:c},d.streams=[i.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),n.apply(this,arguments)}}else ur(o,"track",n=>(n.transceiver||Object.defineProperty(n,"transceiver",{value:{receiver:n.receiver}}),n))}function $h(o){if("object"==typeof o&&o.RTCPeerConnection&&!("getSenders"in o.RTCPeerConnection.prototype)&&"createDTMFSender"in o.RTCPeerConnection.prototype){const n=function(c,d){return{track:d,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===d.kind?c.createDTMFSender(d):null),this._dtmf},_pc:c}};if(!o.RTCPeerConnection.prototype.getSenders){o.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function(h,p){let m=c.apply(this,arguments);return m||(m=n(this,h),this._senders.push(m)),m};const d=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const p=this._senders.indexOf(h);-1!==p&&this._senders.splice(p,1)}}const i=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(d=>{this._senders.push(n(this,d))})};const s=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(d=>{const h=this._senders.find(p=>p.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if("object"==typeof o&&o.RTCPeerConnection&&"getSenders"in o.RTCPeerConnection.prototype&&"createDTMFSender"in o.RTCPeerConnection.prototype&&o.RTCRtpSender&&!("dtmf"in o.RTCRtpSender.prototype)){const n=o.RTCPeerConnection.prototype.getSenders;o.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i},Object.defineProperty(o.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function XT(o){if(!o.RTCPeerConnection)return;const n=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){const[i,s,c]=arguments;if(arguments.length>0&&"function"==typeof i)return n.apply(this,arguments);if(0===n.length&&(0===arguments.length||"function"!=typeof i))return n.apply(this,[]);const d=function(p){const m={};return p.result().forEach(_=>{const E={id:_.id,timestamp:_.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[_.type]||_.type};_.names().forEach(y=>{E[y]=_.stat(y)}),m[E.id]=E}),m},h=function(p){return new Map(Object.keys(p).map(m=>[m,p[m]]))};return arguments.length>=2?n.apply(this,[function(m){s(h(d(m)))},i]):new Promise((p,m)=>{n.apply(this,[function(_){p(h(d(_)))},m])}).then(s,c)}}function wy(o){if(!("object"==typeof o&&o.RTCPeerConnection&&o.RTCRtpSender&&o.RTCRtpReceiver))return;if(!("getStats"in o.RTCRtpSender.prototype)){const i=o.RTCPeerConnection.prototype.getSenders;i&&(o.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(d=>d._pc=this),c});const s=o.RTCPeerConnection.prototype.addTrack;s&&(o.RTCPeerConnection.prototype.addTrack=function(){const c=s.apply(this,arguments);return c._pc=this,c}),o.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(d=>bn(d,c.track,!0))}}if(!("getStats"in o.RTCRtpReceiver.prototype)){const i=o.RTCPeerConnection.prototype.getReceivers;i&&(o.RTCPeerConnection.prototype.getReceivers=function(){const s=i.apply(this,[]);return s.forEach(c=>c._pc=this),s}),ur(o,"track",s=>(s.receiver._pc=s.srcElement,s)),o.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(c=>bn(c,s.track,!1))}}if(!("getStats"in o.RTCRtpSender.prototype)||!("getStats"in o.RTCRtpReceiver.prototype))return;const n=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof o.MediaStreamTrack){const i=arguments[0];let s,c,d;return this.getSenders().forEach(h=>{h.track===i&&(s?d=!0:s=h)}),this.getReceivers().forEach(h=>(h.track===i&&(c?d=!0:c=h),h.track===i)),d||s&&c?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():c?c.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}function An(o){o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const n=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=n.apply(this,arguments);return this._shimmedLocalStreams[h.id]?-1===this._shimmedLocalStreams[h.id].indexOf(p)&&this._shimmedLocalStreams[h.id].push(p):this._shimmedLocalStreams[h.id]=[h,p],p};const i=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(m=>{if(this.getSenders().find(_=>_.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();i.apply(this,arguments);const p=this.getSenders().filter(m=>-1===h.indexOf(m));this._shimmedLocalStreams[d.id]=[d].concat(p)};const s=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],s.apply(this,arguments)};const c=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const p=this._shimmedLocalStreams[h].indexOf(d);-1!==p&&this._shimmedLocalStreams[h].splice(p,1),1===this._shimmedLocalStreams[h].length&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function Ay(o,n){if(!o.RTCPeerConnection)return;if(o.RTCPeerConnection.prototype.addTrack&&n.version>=65)return An(o);const i=o.RTCPeerConnection.prototype.getLocalStreams;o.RTCPeerConnection.prototype.getLocalStreams=function(){const m=i.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(_=>this._reverseStreams[_.id])};const s=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(_=>{if(this.getSenders().find(E=>E.track===_))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const _=new o.MediaStream(m.getTracks());this._streams[m.id]=_,this._reverseStreams[_.id]=m,m=_}s.apply(this,[m])};const c=o.RTCPeerConnection.prototype.removeStream;function d(m,_){let E=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(y=>{const S=m._reverseStreams[y];E=E.replace(new RegExp(m._streams[S.id].id,"g"),S.id)}),new RTCSessionDescription({type:_.type,sdp:E})}o.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},o.RTCPeerConnection.prototype.addTrack=function(m,_){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const E=[].slice.call(arguments,1);if(1!==E.length||!E[0].getTracks().find(S=>S===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(S=>S.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const y=this._streams[_.id];if(y)y.addTrack(m),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const S=new o.MediaStream([m]);this._streams[_.id]=S,this._reverseStreams[S.id]=_,this.addStream(S)}return this.getSenders().find(S=>S.track===m)},["createOffer","createAnswer"].forEach(function(m){const _=o.RTCPeerConnection.prototype[m],E={[m](){const y=arguments;return arguments.length&&"function"==typeof arguments[0]?_.apply(this,[S=>{const T=d(this,S);y[0].apply(null,[T])},S=>{y[1]&&y[1].apply(null,S)},arguments[2]]):_.apply(this,arguments).then(S=>d(this,S))}};o.RTCPeerConnection.prototype[m]=E[m]});const h=o.RTCPeerConnection.prototype.setLocalDescription;o.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,_){let E=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(y=>{const S=m._reverseStreams[y],T=m._streams[S.id];E=E.replace(new RegExp(S.id,"g"),T.id)}),new RTCSessionDescription({type:_.type,sdp:E})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const p=Object.getOwnPropertyDescriptor(o.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(o.RTCPeerConnection.prototype,"localDescription",{get(){const m=p.get.apply(this);return""===m.type?m:d(this,m)}}),o.RTCPeerConnection.prototype.removeTrack=function(m){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let _;this._streams=this._streams||{},Object.keys(this._streams).forEach(E=>{this._streams[E].getTracks().find(y=>m.track===y)&&(_=this._streams[E])}),_&&(1===_.getTracks().length?this.removeStream(this._reverseStreams[_.id]):_.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function JT(o,n){!o.RTCPeerConnection&&o.webkitRTCPeerConnection&&(o.RTCPeerConnection=o.webkitRTCPeerConnection),o.RTCPeerConnection&&n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=o.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new("addIceCandidate"===i?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};o.RTCPeerConnection.prototype[i]=c[i]})}function wl(o,n){ur(o,"negotiationneeded",i=>{const s=i.target;if(!(n.version<72||s.getConfiguration&&"plan-b"===s.getConfiguration().sdpSemantics)||"stable"===s.signalingState)return i})}var QT=Object.freeze({__proto__:null,fixNegotiationNeeded:wl,shimAddTrackRemoveTrack:Ay,shimAddTrackRemoveTrackWithNative:An,shimGetDisplayMedia:function(o,n){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&("function"==typeof n?o.navigator.mediaDevices.getDisplayMedia=function(i){return n(i).then(s=>{const c=i.video&&i.video.width,d=i.video&&i.video.height;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:i.video&&i.video.frameRate||3}},c&&(i.video.mandatory.maxWidth=c),d&&(i.video.mandatory.maxHeight=d),o.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:$h,shimGetStats:XT,shimGetUserMedia:YT,shimMediaStream:$T,shimOnTrack:ru,shimPeerConnection:JT,shimSenderReceiverGetStats:wy});function Dy(o,n){const i=o&&o.navigator,s=o&&o.MediaStreamTrack;if(i.getUserMedia=function(c,d,h){Cn("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(c).then(d,h)},!(n.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const c=function(h,p,m){p in h&&!(m in h)&&(h[m]=h[p],delete h[p])},d=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return"object"==typeof h&&"object"==typeof h.audio&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},s&&s.prototype.getSettings){const h=s.prototype.getSettings;s.prototype.getSettings=function(){const p=h.apply(this,arguments);return c(p,"mozAutoGainControl","autoGainControl"),c(p,"mozNoiseSuppression","noiseSuppression"),p}}if(s&&s.prototype.applyConstraints){const h=s.prototype.applyConstraints;s.prototype.applyConstraints=function(p){return"audio"===this.kind&&"object"==typeof p&&(p=JSON.parse(JSON.stringify(p)),c(p,"autoGainControl","mozAutoGainControl"),c(p,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[p])}}}}function fn(o){"object"==typeof o&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Um(o,n){if("object"!=typeof o||!o.RTCPeerConnection&&!o.mozRTCPeerConnection)return;!o.RTCPeerConnection&&o.mozRTCPeerConnection&&(o.RTCPeerConnection=o.mozRTCPeerConnection),n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const d=o.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new("addIceCandidate"===c?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};o.RTCPeerConnection.prototype[c]=h[c]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){const[c,d,h]=arguments;return s.apply(this,[c||null]).then(p=>{if(n.version<53&&!d)try{p.forEach(m=>{m.type=i[m.type]||m.type})}catch(m){if("TypeError"!==m.name)throw m;p.forEach((_,E)=>{p.set(E,Object.assign({},_,{type:i[_.type]||_.type}))})}return p}).then(d,h)}}function Al(o){if("object"!=typeof o||!o.RTCPeerConnection||!o.RTCRtpSender||o.RTCRtpSender&&"getStats"in o.RTCRtpSender.prototype)return;const n=o.RTCPeerConnection.prototype.getSenders;n&&(o.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(c=>c._pc=this),s});const i=o.RTCPeerConnection.prototype.addTrack;i&&(o.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),o.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function xt(o){if("object"!=typeof o||!o.RTCPeerConnection||!o.RTCRtpSender||o.RTCRtpSender&&"getStats"in o.RTCRtpReceiver.prototype)return;const n=o.RTCPeerConnection.prototype.getReceivers;n&&(o.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i}),ur(o,"track",i=>(i.receiver._pc=i.srcElement,i)),o.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ZT(o){o.RTCPeerConnection&&!("removeStream"in o.RTCPeerConnection.prototype)&&(o.RTCPeerConnection.prototype.removeStream=function(n){Cn("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function e0(o){o.DataChannel&&!o.RTCDataChannel&&(o.RTCDataChannel=o.DataChannel)}function Oy(o){if("object"!=typeof o||!o.RTCPeerConnection)return;const n=o.RTCPeerConnection.prototype.addTransceiver;n&&(o.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;void 0===i&&(i=[]),i=[...i];const s=i.length>0;s&&i.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=n.apply(this,arguments);if(s){const{sender:d}=c,h=d.getParameters();(!("encodings"in h)||1===h.encodings.length&&0===Object.keys(h.encodings[0]).length)&&(h.encodings=i,d.sendEncodings=i,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return c})}function t0(o){if("object"!=typeof o||!o.RTCRtpSender)return;const n=o.RTCRtpSender.prototype.getParameters;n&&(o.RTCRtpSender.prototype.getParameters=function(){const i=n.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function n0(o){if("object"!=typeof o||!o.RTCPeerConnection)return;const n=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}function Xh(o){if("object"!=typeof o||!o.RTCPeerConnection)return;const n=o.RTCPeerConnection.prototype.createAnswer;o.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}var RN=Object.freeze({__proto__:null,shimAddTransceiver:Oy,shimCreateAnswer:Xh,shimCreateOffer:n0,shimGetDisplayMedia:function(o,n){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&(o.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return!0===i.video?i.video={mediaSource:n}:i.video.mediaSource=n,o.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:t0,shimGetUserMedia:Dy,shimOnTrack:fn,shimPeerConnection:Um,shimRTCDataChannel:e0,shimReceiverGetStats:xt,shimRemoveStream:ZT,shimSenderGetStats:Al});function r0(o){if("object"==typeof o&&o.RTCPeerConnection){if("getLocalStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in o.RTCPeerConnection.prototype)){const n=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(s=>n.call(this,s,i)),i.getVideoTracks().forEach(s=>n.call(this,s,i))},o.RTCPeerConnection.prototype.addTrack=function(i,...s){return s&&s.forEach(c=>{this._localStreams?this._localStreams.includes(c)||this._localStreams.push(c):this._localStreams=[c]}),n.apply(this,arguments)}}"removeStream"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(-1===i)return;this._localStreams.splice(i,1);const s=n.getTracks();this.getSenders().forEach(c=>{s.includes(c.track)&&this.removeTrack(c)})})}}function o0(o){if("object"==typeof o&&o.RTCPeerConnection&&("getRemoteStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in o.RTCPeerConnection.prototype))){Object.defineProperty(o.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(c=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(c))return;this._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,this.dispatchEvent(d)})})}});const n=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(c=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(c)>=0)return;i._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,i.dispatchEvent(d)})}),n.apply(i,arguments)}}}function Ny(o){if("object"!=typeof o||!o.RTCPeerConnection)return;const n=o.RTCPeerConnection.prototype,i=n.createOffer,s=n.createAnswer,c=n.setLocalDescription,d=n.setRemoteDescription,h=n.addIceCandidate;n.createOffer=function(m,_){const y=i.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return _?(y.then(m,_),Promise.resolve()):y},n.createAnswer=function(m,_){const y=s.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return _?(y.then(m,_),Promise.resolve()):y};let p=function(m,_,E){const y=c.apply(this,[m]);return E?(y.then(_,E),Promise.resolve()):y};n.setLocalDescription=p,p=function(m,_,E){const y=d.apply(this,[m]);return E?(y.then(_,E),Promise.resolve()):y},n.setRemoteDescription=p,p=function(m,_,E){const y=h.apply(this,[m]);return E?(y.then(_,E),Promise.resolve()):y},n.addIceCandidate=p}function Py(o){const n=o&&o.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){const i=n.mediaDevices,s=i.getUserMedia.bind(i);n.mediaDevices.getUserMedia=c=>s(Vm(c))}!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=function(i,s,c){n.mediaDevices.getUserMedia(i).then(s,c)}.bind(n))}function Vm(o){return o&&void 0!==o.video?Object.assign({},o,{video:Yh(o.video)}):o}function s0(o){if(!o.RTCPeerConnection)return;const n=o.RTCPeerConnection;o.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const c=[];for(let d=0;d<i.iceServers.length;d++){let h=i.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(Cn("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(i.iceServers[d])}i.iceServers=c}return new n(i,s)},o.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in n&&Object.defineProperty(o.RTCPeerConnection,"generateCertificate",{get:()=>n.generateCertificate})}function a0(o){"object"==typeof o&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Bm(o){const n=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(i){if(i){void 0!==i.offerToReceiveAudio&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find(d=>"audio"===d.receiver.track.kind);!1===i.offerToReceiveAudio&&s?"sendrecv"===s.direction?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":"recvonly"===s.direction&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):!0!==i.offerToReceiveAudio||s||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==i.offerToReceiveVideo&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const c=this.getTransceivers().find(d=>"video"===d.receiver.track.kind);!1===i.offerToReceiveVideo&&c?"sendrecv"===c.direction?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":"recvonly"===c.direction&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):!0!==i.offerToReceiveVideo||c||this.addTransceiver("video",{direction:"recvonly"})}return n.apply(this,arguments)}}function c0(o){"object"!=typeof o||o.AudioContext||(o.AudioContext=o.webkitAudioContext)}var l0=Object.freeze({__proto__:null,shimAudioContext:c0,shimCallbacksAPI:Ny,shimConstraints:Vm,shimCreateOfferLegacy:Bm,shimGetUserMedia:Py,shimLocalStreamsAPI:r0,shimRTCIceServerUrls:s0,shimRemoteStreamsAPI:o0,shimTrackEventTransceiver:a0}),ou=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hr(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Oi={exports:{}};!function(o){const n={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};n.localCName=n.generateIdentifier(),n.splitLines=function(i){return i.trim().split("\n").map(s=>s.trim())},n.splitSections=function(i){return i.split("\nm=").map((s,c)=>(c>0?"m="+s:s).trim()+"\r\n")},n.getDescription=function(i){const s=n.splitSections(i);return s&&s[0]},n.getMediaSections=function(i){const s=n.splitSections(i);return s.shift(),s},n.matchPrefix=function(i,s){return n.splitLines(i).filter(c=>0===c.indexOf(s))},n.parseCandidate=function(i){let s;s=0===i.indexOf("a=candidate:")?i.substring(12).split(" "):i.substring(10).split(" ");const c={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let d=8;d<s.length;d+=2)switch(s[d]){case"raddr":c.relatedAddress=s[d+1];break;case"rport":c.relatedPort=parseInt(s[d+1],10);break;case"tcptype":c.tcpType=s[d+1];break;case"ufrag":c.ufrag=s[d+1],c.usernameFragment=s[d+1];break;default:void 0===c[s[d]]&&(c[s[d]]=s[d+1])}return c},n.writeCandidate=function(i){const s=[];s.push(i.foundation);const c=i.component;s.push("rtp"===c?1:"rtcp"===c?2:c),s.push(i.protocol.toUpperCase()),s.push(i.priority),s.push(i.address||i.ip),s.push(i.port);const d=i.type;return s.push("typ"),s.push(d),"host"!==d&&i.relatedAddress&&i.relatedPort&&(s.push("raddr"),s.push(i.relatedAddress),s.push("rport"),s.push(i.relatedPort)),i.tcpType&&"tcp"===i.protocol.toLowerCase()&&(s.push("tcptype"),s.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(s.push("ufrag"),s.push(i.usernameFragment||i.ufrag)),"candidate:"+s.join(" ")},n.parseIceOptions=function(i){return i.substring(14).split(" ")},n.parseRtpMap=function(i){let s=i.substring(9).split(" ");const c={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),c.name=s[0],c.clockRate=parseInt(s[1],10),c.channels=3===s.length?parseInt(s[2],10):1,c.numChannels=c.channels,c},n.writeRtpMap=function(i){let s=i.payloadType;void 0!==i.preferredPayloadType&&(s=i.preferredPayloadType);const c=i.channels||i.numChannels||1;return"a=rtpmap:"+s+" "+i.name+"/"+i.clockRate+(1!==c?"/"+c:"")+"\r\n"},n.parseExtmap=function(i){const s=i.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},n.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&"sendrecv"!==i.direction?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+"\r\n"},n.parseFmtp=function(i){const s={};let c;const d=i.substring(i.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)c=d[h].trim().split("="),s[c[0].trim()]=c[1];return s},n.writeFmtp=function(i){let s="",c=i.payloadType;if(void 0!==i.preferredPayloadType&&(c=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const d=[];Object.keys(i.parameters).forEach(h=>{d.push(void 0!==i.parameters[h]?h+"="+i.parameters[h]:h)}),s+="a=fmtp:"+c+" "+d.join(";")+"\r\n"}return s},n.parseRtcpFb=function(i){const s=i.substring(i.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},n.writeRtcpFb=function(i){let s="",c=i.payloadType;return void 0!==i.preferredPayloadType&&(c=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(d=>{s+="a=rtcp-fb:"+c+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+"\r\n"}),s},n.parseSsrcMedia=function(i){const s=i.indexOf(" "),c={ssrc:parseInt(i.substring(7,s),10)},d=i.indexOf(":",s);return d>-1?(c.attribute=i.substring(s+1,d),c.value=i.substring(d+1)):c.attribute=i.substring(s+1),c},n.parseSsrcGroup=function(i){const s=i.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(c=>parseInt(c,10))}},n.getMid=function(i){const s=n.matchPrefix(i,"a=mid:")[0];if(s)return s.substring(6)},n.parseFingerprint=function(i){const s=i.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},n.getDtlsParameters=function(i,s){return{role:"auto",fingerprints:n.matchPrefix(i+s,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(i,s){let c="a=setup:"+s+"\r\n";return i.fingerprints.forEach(d=>{c+="a=fingerprint:"+d.algorithm+" "+d.value+"\r\n"}),c},n.parseCryptoLine=function(i){const s=i.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},n.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+("object"==typeof i.keyParams?n.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+"\r\n"},n.parseCryptoKeyParams=function(i){if(0!==i.indexOf("inline:"))return null;const s=i.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},n.getCryptoParameters=function(i,s){return n.matchPrefix(i+s,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(i,s){const c=n.matchPrefix(i+s,"a=ice-ufrag:")[0],d=n.matchPrefix(i+s,"a=ice-pwd:")[0];return c&&d?{usernameFragment:c.substring(12),password:d.substring(10)}:null},n.writeIceParameters=function(i){let s="a=ice-ufrag:"+i.usernameFragment+"\r\na=ice-pwd:"+i.password+"\r\n";return i.iceLite&&(s+="a=ice-lite\r\n"),s},n.parseRtpParameters=function(i){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=n.splitLines(i)[0].split(" ");s.profile=c[2];for(let h=3;h<c.length;h++){const p=c[h],m=n.matchPrefix(i,"a=rtpmap:"+p+" ")[0];if(m){const _=n.parseRtpMap(m),E=n.matchPrefix(i,"a=fmtp:"+p+" ");switch(_.parameters=E.length?n.parseFmtp(E[0]):{},_.rtcpFeedback=n.matchPrefix(i,"a=rtcp-fb:"+p+" ").map(n.parseRtcpFb),s.codecs.push(_),_.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(_.name.toUpperCase())}}}n.matchPrefix(i,"a=extmap:").forEach(h=>{s.headerExtensions.push(n.parseExtmap(h))});const d=n.matchPrefix(i,"a=rtcp-fb:* ").map(n.parseRtcpFb);return s.codecs.forEach(h=>{d.forEach(p=>{h.rtcpFeedback.find(m=>m.type===p.type&&m.parameter===p.parameter)||h.rtcpFeedback.push(p)})}),s},n.writeRtpDescription=function(i,s){let c="";c+="m="+i+" ",c+=s.codecs.length>0?"9":"0",c+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=s.codecs.map(h=>void 0!==h.preferredPayloadType?h.preferredPayloadType:h.payloadType).join(" ")+"\r\n",c+="c=IN IP4 0.0.0.0\r\n",c+="a=rtcp:9 IN IP4 0.0.0.0\r\n",s.codecs.forEach(h=>{c+=n.writeRtpMap(h),c+=n.writeFmtp(h),c+=n.writeRtcpFb(h)});let d=0;return s.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(c+="a=maxptime:"+d+"\r\n"),s.headerExtensions&&s.headerExtensions.forEach(h=>{c+=n.writeExtmap(h)}),c},n.parseRtpEncodingParameters=function(i){const s=[],c=n.parseRtpParameters(i),d=-1!==c.fecMechanisms.indexOf("RED"),h=-1!==c.fecMechanisms.indexOf("ULPFEC"),p=n.matchPrefix(i,"a=ssrc:").map(S=>n.parseSsrcMedia(S)).filter(S=>"cname"===S.attribute),m=p.length>0&&p[0].ssrc;let _;const E=n.matchPrefix(i,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(T=>parseInt(T,10)));E.length>0&&E[0].length>1&&E[0][0]===m&&(_=E[0][1]),c.codecs.forEach(S=>{if("RTX"===S.name.toUpperCase()&&S.parameters.apt){let T={ssrc:m,codecPayloadType:parseInt(S.parameters.apt,10)};m&&_&&(T.rtx={ssrc:_}),s.push(T),d&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:m,mechanism:h?"red+ulpfec":"red"},s.push(T))}}),0===s.length&&m&&s.push({ssrc:m});let y=n.matchPrefix(i,"b=");return y.length&&(y=0===y[0].indexOf("b=TIAS:")?parseInt(y[0].substring(7),10):0===y[0].indexOf("b=AS:")?1e3*parseInt(y[0].substring(5),10)*.95-16e3:void 0,s.forEach(S=>{S.maxBitrate=y})),s},n.parseRtcpParameters=function(i){const s={},c=n.matchPrefix(i,"a=ssrc:").map(p=>n.parseSsrcMedia(p)).filter(p=>"cname"===p.attribute)[0];c&&(s.cname=c.value,s.ssrc=c.ssrc);const d=n.matchPrefix(i,"a=rtcp-rsize");s.reducedSize=d.length>0,s.compound=0===d.length;const h=n.matchPrefix(i,"a=rtcp-mux");return s.mux=h.length>0,s},n.writeRtcpParameters=function(i){let s="";return i.reducedSize&&(s+="a=rtcp-rsize\r\n"),i.mux&&(s+="a=rtcp-mux\r\n"),void 0!==i.ssrc&&i.cname&&(s+="a=ssrc:"+i.ssrc+" cname:"+i.cname+"\r\n"),s},n.parseMsid=function(i){let s;const c=n.matchPrefix(i,"a=msid:");if(1===c.length)return s=c[0].substring(7).split(" "),{stream:s[0],track:s[1]};const d=n.matchPrefix(i,"a=ssrc:").map(h=>n.parseSsrcMedia(h)).filter(h=>"msid"===h.attribute);return d.length>0?(s=d[0].value.split(" "),{stream:s[0],track:s[1]}):void 0},n.parseSctpDescription=function(i){const s=n.parseMLine(i),c=n.matchPrefix(i,"a=max-message-size:");let d;c.length>0&&(d=parseInt(c[0].substring(19),10)),isNaN(d)&&(d=65536);const h=n.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:s.fmt,maxMessageSize:d};const p=n.matchPrefix(i,"a=sctpmap:");if(p.length>0){const m=p[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:d}}},n.writeSctpDescription=function(i,s){let c=[];return c="DTLS/SCTP"!==i.protocol?["m="+i.kind+" 9 "+i.protocol+" "+s.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+s.port+"\r\n"]:["m="+i.kind+" 9 "+i.protocol+" "+s.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+s.port+" "+s.protocol+" 65535\r\n"],void 0!==s.maxMessageSize&&c.push("a=max-message-size:"+s.maxMessageSize+"\r\n"),c.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,22)},n.writeSessionBoilerplate=function(i,s,c){let d;const h=void 0!==s?s:2;return d=i||n.generateSessionId(),"v=0\r\no="+(c||"thisisadapterortc")+" "+d+" "+h+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.getDirection=function(i,s){const c=n.splitLines(i);for(let d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substring(2)}return s?n.getDirection(s):"sendrecv"},n.getKind=function(i){return n.splitLines(i)[0].split(" ")[0].substring(2)},n.isRejected=function(i){return"0"===i.split(" ",2)[1]},n.parseMLine=function(i){const s=n.splitLines(i)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},n.parseOLine=function(i){const s=n.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},n.isValidSDP=function(i){if("string"!=typeof i||0===i.length)return!1;const s=n.splitLines(i);for(let c=0;c<s.length;c++)if(s[c].length<2||"="!==s[c].charAt(1))return!1;return!0},o.exports=n}(Oi);var su=Oi.exports,Jh=hr(su),Qh=function Fc(o,n){return n.forEach(function(i){i&&"string"!=typeof i&&!Array.isArray(i)&&Object.keys(i).forEach(function(s){if("default"!==s&&!(s in o)){var c=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(o,s,c.get?c:{enumerable:!0,get:function(){return i[s]}})}})}),Object.freeze(o)}({__proto__:null,default:Jh},[su]);function My(o){if(!o.RTCIceCandidate||o.RTCIceCandidate&&"foundation"in o.RTCIceCandidate.prototype)return;const n=o.RTCIceCandidate;o.RTCIceCandidate=function(i){if("object"==typeof i&&i.candidate&&0===i.candidate.indexOf("a=")&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const s=new n(i),c=Jh.parseCandidate(i.candidate),d=Object.assign(s,c);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new n(i)},o.RTCIceCandidate.prototype=n.prototype,ur(o,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new o.RTCIceCandidate(i.candidate),writable:"false"}),i))}function Dl(o){!o.RTCIceCandidate||o.RTCIceCandidate&&"relayProtocol"in o.RTCIceCandidate.prototype||ur(o,"icecandidate",n=>{if(n.candidate){const i=Jh.parseCandidate(n.candidate.candidate);"relay"===i.type&&(n.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return n})}function Wi(o,n){if(!o.RTCPeerConnection)return;"sctp"in o.RTCPeerConnection.prototype||Object.defineProperty(o.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const i=function(p){if(!p||!p.sdp)return!1;const m=Jh.splitSections(p.sdp);return m.shift(),m.some(_=>{const E=Jh.parseMLine(_);return E&&"application"===E.kind&&-1!==E.protocol.indexOf("SCTP")})},s=function(p){const m=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===m||m.length<2)return-1;const _=parseInt(m[1],10);return _!=_?-1:_},c=function(p){let m=65536;return"firefox"===n.browser&&(m=n.version<57?-1===p?16384:2147483637:n.version<60?57===n.version?65535:65536:2147483637),m},d=function(p,m){let _=65536;"firefox"===n.browser&&57===n.version&&(_=65535);const E=Jh.matchPrefix(p.sdp,"a=max-message-size:");return E.length>0?_=parseInt(E[0].substr(19),10):"firefox"===n.browser&&-1!==m&&(_=2147483637),_},h=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===n.browser&&n.version>=76){const{sdpSemantics:p}=this.getConfiguration();"plan-b"===p&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const p=s(arguments[0]),m=c(p),_=d(arguments[0],p);let E;E=0===m&&0===_?Number.POSITIVE_INFINITY:0===m||0===_?Math.max(m,_):Math.min(m,_);const y={};Object.defineProperty(y,"maxMessageSize",{get:()=>E}),this._sctp=y}return h.apply(this,arguments)}}function jm(o){if(!o.RTCPeerConnection||!("createDataChannel"in o.RTCPeerConnection.prototype))return;function n(s,c){const d=s.send;s.send=function(){const h=arguments[0];if("open"===s.readyState&&c.sctp&&(h.length||h.size||h.byteLength)>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(s,arguments)}}const i=o.RTCPeerConnection.prototype.createDataChannel;o.RTCPeerConnection.prototype.createDataChannel=function(){const s=i.apply(this,arguments);return n(s,this),s},ur(o,"datachannel",s=>(n(s.channel,s.target),s))}function ky(o){if(!o.RTCPeerConnection||"connectionState"in o.RTCPeerConnection.prototype)return;const n=o.RTCPeerConnection.prototype;Object.defineProperty(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const s=n[i];n[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const d=c.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",c);d.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function d0(o,n){if(!o.RTCPeerConnection||"chrome"===n.browser&&n.version>=71||"safari"===n.browser&&n.version>=605)return;const i=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&-1!==s.sdp.indexOf("\na=extmap-allow-mixed")){const c=s.sdp.split("\n").filter(d=>"a=extmap-allow-mixed"!==d.trim()).join("\n");o.RTCSessionDescription&&s instanceof o.RTCSessionDescription?arguments[0]=new o.RTCSessionDescription({type:s.type,sdp:c}):s.sdp=c}return i.apply(this,arguments)}}function qa(o,n){if(!o.RTCPeerConnection||!o.RTCPeerConnection.prototype)return;const i=o.RTCPeerConnection.prototype.addIceCandidate;i&&0!==i.length&&(o.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===n.browser&&n.version<78||"firefox"===n.browser&&n.version<68||"safari"===n.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function au(o,n){if(!o.RTCPeerConnection||!o.RTCPeerConnection.prototype)return;const i=o.RTCPeerConnection.prototype.setLocalDescription;i&&0!==i.length&&(o.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if("object"!=typeof s||s.type&&s.sdp)return i.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer"}return s.sdp||"offer"!==s.type&&"answer"!==s.type?i.apply(this,[s]):("offer"===s.type?this.createOffer:this.createAnswer).apply(this).then(c=>i.apply(this,[c]))})}var Ly=Object.freeze({__proto__:null,removeExtmapAllowMixed:d0,shimAddIceCandidateNullOrEmpty:qa,shimConnectionState:ky,shimMaxMessageSize:Wi,shimParameterlessSetLocalDescription:au,shimRTCIceCandidate:My,shimRTCIceCandidateRelayProtocol:Dl,shimSendThrowTypeError:jm});!function({window:o}={},n={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const i=os,s=function(d){const h={browser:null,version:null};if(void 0===d||!d.navigator)return h.browser="Not a browser.",h;const{navigator:p}=d;if(p.mozGetUserMedia)h.browser="firefox",h.version=rs(p.userAgent,/Firefox\/(\d+)\./,1);else if(p.webkitGetUserMedia||!1===d.isSecureContext&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=rs(p.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!p.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=rs(p.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(o),c={browserDetails:s,commonShim:Ly,extractVersion:rs,disableLog:Ka,disableWarnings:iu,sdp:Qh};switch(s.browser){case"chrome":if(!QT||!JT||!n.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(null===s.version)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=QT,qa(o,s),au(o),YT(o,s),$T(o),JT(o,s),ru(o),Ay(o,s),$h(o),XT(o),wy(o),wl(o,s),My(o),Dl(o),ky(o),Wi(o,s),jm(o),d0(o,s);break;case"firefox":if(!RN||!Um||!n.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=RN,qa(o,s),au(o),Dy(o,s),Um(o,s),fn(o),ZT(o),Al(o),xt(o),e0(o),Oy(o),t0(o),n0(o),Xh(o),My(o),ky(o),Wi(o,s),jm(o);break;case"safari":if(!l0||!n.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=l0,qa(o,s),au(o),s0(o),Bm(o),Ny(o),r0(o),o0(o),a0(o),Py(o),c0(o),My(o),Dl(o),Wi(o,s),jm(o),d0(o,s);break;default:i("Unsupported browser!")}}({window:typeof window>"u"?void 0:window});var ti=function(o){try{return!!o()}catch{return!0}},Hm=!ti(function(){var o=function(){}.bind();return"function"!=typeof o||o.hasOwnProperty("prototype")}),u0=Hm,Gm=Function.prototype,xy=Gm.call,wN=u0&&Gm.bind.bind(xy,xy),Ei=u0?wN:function(o){return function(){return xy.apply(o,arguments)}},Is=Ei({}.isPrototypeOf),Wm=function(o){return o&&o.Math==Math&&o},er=Wm("object"==typeof globalThis&&globalThis)||Wm("object"==typeof window&&window)||Wm("object"==typeof self&&self)||Wm("object"==typeof ou&&ou)||function(){return this}()||ou||Function("return this")(),h0=Function.prototype,Fn=h0.apply,zm=h0.call,Dn="object"==typeof Reflect&&Reflect.apply||(Hm?zm.bind(Fn):function(){return zm.apply(Fn,arguments)}),Km=Ei,DN=Km({}.toString),Un=Km("".slice),$e=function(o){return Un(DN(o),8,-1)},Fy=$e,lF=Ei,pe=function(o){if("Function"===Fy(o))return lF(o)},cu="object"==typeof document&&document.all,ut={all:cu,IS_HTMLDDA:void 0===cu&&void 0!==cu},yn=ut.all,Ni=ut.IS_HTMLDDA?function(o){return"function"==typeof o||o===yn}:function(o){return"function"==typeof o},qm={},ca=!ti(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),Ir=Function.prototype.call,Wr=Hm?Ir.bind(Ir):function(){return Ir.apply(Ir,arguments)},Uy={},ON={}.propertyIsEnumerable,la=Object.getOwnPropertyDescriptor,dF=la&&!ON.call({1:2},1);Uy.f=dF?function(o){var n=la(this,o);return!!n&&n.enumerable}:ON;var Ol,Vy,lu=function(o,n){return{enumerable:!(1&o),configurable:!(2&o),writable:!(4&o),value:n}},NN=ti,uF=$e,By=Object,hF=Ei("".split),zr=NN(function(){return!By("z").propertyIsEnumerable(0)})?function(o){return"String"==uF(o)?hF(o,""):By(o)}:By,an=function(o){return null==o},pF=an,fF=TypeError,$m=function(o){if(pF(o))throw fF("Can't call method on "+o);return o},ke=zr,mF=$m,Zt=function(o){return ke(mF(o))},Zh=Ni,PN=ut.all,Po=ut.IS_HTMLDDA?function(o){return"object"==typeof o?null!==o:Zh(o)||o===PN}:function(o){return"object"==typeof o?null!==o:Zh(o)},Nl={},jy=Nl,Xm=er,Jm=Ni,Qm=function(o){return Jm(o)?o:void 0},Kr=function(o,n){return arguments.length<2?Qm(jy[o])||Qm(Xm[o]):jy[o]&&jy[o][n]||Xm[o]&&Xm[o][n]},Pl=typeof navigator<"u"&&String(navigator.userAgent)||"",ep=Pl,p0=er.process,Mo=er.Deno,Hy=p0&&p0.versions||Mo&&Mo.version,MN=Hy&&Hy.v8;MN&&(Vy=(Ol=MN.split("."))[0]>0&&Ol[0]<4?1:+(Ol[0]+Ol[1])),!Vy&&ep&&(!(Ol=ep.match(/Edge\/(\d+)/))||Ol[1]>=74)&&(Ol=ep.match(/Chrome\/(\d+)/))&&(Vy=+Ol[1]);var fo=Vy,ss=fo,gF=er.String,Rr=!!Object.getOwnPropertySymbols&&!ti(function(){var o=Symbol();return!gF(o)||!(Object(o)instanceof Symbol)||!Symbol.sham&&ss&&ss<41}),Hn=Rr&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,EF=Kr,yF=Ni,du=Is,vn=Object,Uc=Hn?function(o){return"symbol"==typeof o}:function(o){var n=EF("Symbol");return yF(n)&&du(n.prototype,vn(o))},Gy=String,Vc=function(o){try{return Gy(o)}catch{return"Object"}},f0=Ni,Ya=Vc,tp=TypeError,as=function(o){if(f0(o))return o;throw tp(Ya(o)+" is not a function")},qr=as,kN=an,Zm=function(o,n){var i=o[n];return kN(i)?void 0:qr(i)},e_=Wr,On=Ni,Wy=Po,m0=TypeError,Be={exports:{}},Yr=er,Nn=Object.defineProperty,wr="__core-js_shared__",Bc=er[wr]||function(o,n){try{Nn(Yr,o,{value:n,configurable:!0,writable:!0})}catch{Yr[o]=n}return n}(wr,{}),mo=Bc;(Be.exports=function(o,n){return mo[o]||(mo[o]=void 0!==n?n:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var pr=Be.exports,Me=$m,wt=Object,Tn=function(o){return wt(Me(o))},ko=Tn,Ml=Ei({}.hasOwnProperty),cn=Object.hasOwn||function(o,n){return Ml(ko(o),n)},kl=Ei,yi=0,np=Math.random(),ip=kl(1..toString),Tt=function(o){return"Symbol("+(void 0===o?"":o)+")_"+ip(++yi+np,36)},Ll=cn,zy=Tt,xl=Rr,Ar=Hn,da=er.Symbol,jc=pr("wks"),Rs=Ar?da.for||da:da&&da.withoutSetter||zy,Pn=function(o){return Ll(jc,o)||(jc[o]=xl&&Ll(da,o)?da[o]:Rs("Symbol."+o)),jc[o]},_0=Wr,Gn=Po,g0=Uc,LN=Zm,Ky=TypeError,rp=Pn("toPrimitive"),i_=function(o,n){if(!Gn(o)||g0(o))return o;var i,s=LN(o,rp);if(s){if(void 0===n&&(n="default"),i=_0(s,o,n),!Gn(i)||g0(i))return i;throw Ky("Can't convert object to primitive value")}return void 0===n&&(n="number"),function(o,n){var i,s;if("string"===n&&On(i=o.toString)&&!Wy(s=e_(i,o))||On(i=o.valueOf)&&!Wy(s=e_(i,o))||"string"!==n&&On(i=o.toString)&&!Wy(s=e_(i,o)))return s;throw m0("Can't convert object to primitive value")}(o,n)},Fl=Uc,zi=function(o){var n=i_(o,"string");return Fl(n)?n:n+""},E0=Po,Dr=er.document,ws=E0(Dr)&&E0(Dr.createElement),op=function(o){return ws?Dr.createElement(o):{}},r_=op,sp=!ca&&!ti(function(){return 7!=Object.defineProperty(r_("div"),"a",{get:function(){return 7}}).a}),xN=Wr,vF=Uy,FN=lu,UN=Zt,SF=zi,CF=cn,bF=sp,VN=Object.getOwnPropertyDescriptor;qm.f=ca?VN:function(o,n){if(o=UN(o),n=SF(n),bF)try{return VN(o,n)}catch{}if(CF(o,n))return FN(!xN(vF.f,o,n),o[n])};var TF=ti,IF=Ni,RF=/#|\.prototype\./,o_=function(o,n){var i=AF[wF(o)];return i==OF||i!=DF&&(IF(n)?TF(n):!!n)},wF=o_.normalize=function(o){return String(o).replace(RF,".").toLowerCase()},AF=o_.data={},DF=o_.NATIVE="N",OF=o_.POLYFILL="P",BN=o_,NF=as,y0=Hm,qy=pe(pe.bind),s_=function(o,n){return NF(o),void 0===n?o:y0?qy(o,n):function(){return o.apply(n,arguments)}},Ds={},jN=ca&&ti(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),Ul=Po,HN=String,Lo=TypeError,cs=function(o){if(Ul(o))return o;throw Lo(HN(o)+" is not an object")},WN=sp,ap=cs,S0=zi,Yy=TypeError,$y=Object.defineProperty,ls=Object.getOwnPropertyDescriptor,cp="enumerable",Xy="configurable",lp="writable";Ds.f=ca?jN?function(o,n,i){if(ap(o),n=S0(n),ap(i),"function"==typeof o&&"prototype"===n&&"value"in i&&lp in i&&!i[lp]){var s=ls(o,n);s&&s[lp]&&(o[n]=i.value,i={configurable:Xy in i?i[Xy]:s[Xy],enumerable:cp in i?i[cp]:s[cp],writable:!1})}return $y(o,n,i)}:$y:function(o,n,i){if(ap(o),n=S0(n),ap(i),WN)try{return $y(o,n,i)}catch{}if("get"in i||"set"in i)throw Yy("Accessors not supported");return"value"in i&&(o[n]=i.value),o};var zN=Ds,PF=lu,Wn=ca?function(o,n,i){return zN.f(o,n,PF(1,i))}:function(o,n,i){return o[n]=i,o},a_=er,MF=Dn,c_=pe,xo=Ni,KN=qm.f,Jy=BN,Os=Nl,Fo=s_,uu=Wn,dp=cn,qN=function(o){var n=function(i,s,c){if(this instanceof n){switch(arguments.length){case 0:return new o;case 1:return new o(i);case 2:return new o(i,s)}return new o(i,s,c)}return MF(o,this,arguments)};return n.prototype=o.prototype,n},Wt=function(o,n){var i,s,c,d,h,p,m,_,E,y=o.target,S=o.global,T=o.stat,O=o.proto,N=S?a_:T?a_[y]:(a_[y]||{}).prototype,w=S?Os:Os[y]||uu(Os,y,{})[y],k=w.prototype;for(d in n)s=!(i=Jy(S?d:y+(T?".":"#")+d,o.forced))&&N&&dp(N,d),p=w[d],s&&(m=o.dontCallGetSet?(E=KN(N,d))&&E.value:N[d]),h=s&&m?m:n[d],s&&typeof p==typeof h||(_=o.bind&&s?Fo(h,a_):o.wrap&&s?qN(h):O&&xo(h)?c_(h):h,(o.sham||h&&h.sham||p&&p.sham)&&uu(_,"sham",!0),uu(w,d,_),O&&(dp(Os,c=y+"Prototype")||uu(Os,c,{}),uu(Os[c],d,h),o.real&&k&&(i||!k[d])&&uu(k,d,h)))},C0=Math.ceil,Qy=Math.floor,yt=Math.trunc||function(o){var n=+o;return(n>0?Qy:C0)(n)},l_=function(o){var n=+o;return n!=n||0===n?0:yt(n)},kF=l_,YN=Math.max,$N=Math.min,b0=function(o,n){var i=kF(o);return i<0?YN(i+n,0):$N(i,n)},T0=l_,XN=Math.min,fe=function(o){return function(o){return o>0?XN(T0(o),9007199254740991):0}(o.length)},en=Zt,ds=b0,us=fe,Pi=function(o){return function(n,i,s){var c,d=en(n),h=us(d),p=ds(s,h);if(o&&i!=i){for(;h>p;)if((c=d[p++])!=c)return!0}else for(;h>p;p++)if((o||p in d)&&d[p]===i)return o||p||0;return!o&&-1}},Zy={includes:Pi(!0),indexOf:Pi(!1)},up=Zy.includes;Wt({target:"Array",proto:!0,forced:ti(function(){return!Array(1).includes()})},{includes:function(o){return up(this,o,arguments.length>1?arguments[1]:void 0)}});var ua=Nl,$a=function(o){return ua[o+"Prototype"]},ev=$a("Array").includes,LF=Po,QN=$e,xF=Pn("match"),Xr=TypeError,ha={};ha[Pn("toStringTag")]="z";var d_="[object z]"===String(ha),hu=d_,Xa=Ni,u_=$e,R0=Pn("toStringTag"),ZN=Object,eP="Arguments"==u_(function(){return arguments}()),Ja=hu?u_:function(o){var n,i,s;return void 0===o?"Undefined":null===o?"Null":"string"==typeof(i=function(c,d){try{return c[d]}catch{}}(n=ZN(o),R0))?i:eP?u_(n):"Object"==(s=u_(n))&&Xa(n.callee)?"Arguments":s},tv=Ja,w0=String,Ns=function(o){if("Symbol"===tv(o))throw TypeError("Cannot convert a Symbol value to a string");return w0(o)},tP=Pn("match"),A0=Wt,nv=function(o){if(function(o){var n;return LF(o)&&(void 0!==(n=o[xF])?!!n:"RegExp"==QN(o))}(o))throw Xr("The method doesn't accept regular expressions");return o},D0=$m,iv=Ns,N0=Ei("".indexOf);A0({target:"String",proto:!0,forced:!function(o){var n=/./;try{"/./"[o](n)}catch{try{return n[tP]=!1,"/./"[o](n)}catch{}}return!1}("includes")},{includes:function(o){return!!~N0(iv(D0(this)),iv(nv(o)),arguments.length>1?arguments[1]:void 0)}});var rv=$a("String").includes,P0=Is,nP=ev,Jr=rv,pa=Array.prototype,ni=String.prototype,be=hr(function(o){var n=o.includes;return o===pa||P0(pa,o)&&n===pa.includes?nP:"string"==typeof o||o===ni||P0(ni,o)&&n===ni.includes?Jr:n}),M0={exports:{}},k0=Ds.f;Wt({target:"Object",stat:!0,forced:Object.defineProperty!==k0,sham:!ca},{defineProperty:k0});var L0=Nl.Object,h_=M0.exports=function(o,n,i){return L0.defineProperty(o,n,i)};L0.defineProperty.sham&&(h_.sham=!0);var p_=hr(M0.exports),f_=$e,hp=Array.isArray||function(o){return"Array"==f_(o)},x0=TypeError,rP=zi,Hc=Ds,pp=lu,F0=function(o,n,i){var s=rP(n);s in o?Hc.f(o,s,pp(0,i)):o[s]=i},oP=Ni,Vl=Bc,ov=Ei(Function.toString);oP(Vl.inspectSource)||(Vl.inspectSource=function(o){return ov(o)});var U0=Vl.inspectSource,sP=Ei,FF=ti,aP=Ni,m_=Ja,V0=U0,sv=function(){},__=[],av=Kr("Reflect","construct"),g_=/^\s*(?:class|function)\b/,pu=sP(g_.exec),cP=!g_.exec(sv),fa=function(o){if(!aP(o))return!1;try{return av(sv,__,o),!0}catch{return!1}},E_=function(o){if(!aP(o))return!1;switch(m_(o)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return cP||!!pu(g_,V0(o))}catch{return!0}};E_.sham=!0;var fp=!av||FF(function(){var o;return fa(fa.call)||!fa(Object)||!fa(function(){o=!0})||o})?E_:fa,lP=hp,B0=fp,j0=Po,dP=Pn("species"),Ps=Array,fu=function(o,n){return new(function(o){var n;return lP(o)&&(B0(n=o.constructor)&&(n===Ps||lP(n.prototype))||j0(n)&&null===(n=n[dP]))&&(n=void 0),void 0===n?Ps:n}(o))(0===n?0:n)},cv=ti,lv=fo,y_=Pn("species"),v_=Wt,hP=ti,H0=hp,G0=Po,W0=Tn,z0=fe,K0=function(o){if(o>9007199254740991)throw x0("Maximum allowed index exceeded");return o},mp=F0,_p=fu,q0=fo,dv=Pn("isConcatSpreadable"),mu=q0>=51||!hP(function(){var o=[];return o[dv]=!1,o.concat()[0]!==o}),fP=function(o){if(!G0(o))return!1;var n=o[dv];return void 0!==n?!!n:H0(o)};v_({target:"Array",proto:!0,arity:1,forced:!mu||!function(o){return lv>=51||!cv(function(){var n=[];return(n.constructor={})[y_]=function(){return{foo:1}},1!==n[o](Boolean).foo})}("concat")},{concat:function(o){var n,i,s,c,d,h=W0(this),p=_p(h,0),m=0;for(n=-1,s=arguments.length;n<s;n++)if(fP(d=-1===n?h:arguments[n]))for(c=z0(d),K0(m+c),i=0;i<c;i++,m++)i in d&&mp(p,m,d[i]);else K0(m+1),mp(p,m++,d);return p.length=m,p}});var Mi={},_u={},uv=cn,Y0=Zt,gu=Zy.indexOf,Eu=_u,Bl=Ei([].push),jl=function(o,n){var i,s=Y0(o),c=0,d=[];for(i in s)!uv(Eu,i)&&uv(s,i)&&Bl(d,i);for(;n.length>c;)uv(s,i=n[c++])&&(~gu(d,i)||Bl(d,i));return d},S_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],hv=jl,yu=S_,mP=Object.keys||function(o){return hv(o,yu)},UF=Ds,VF=cs,BF=Zt,jF=mP;Mi.f=ca&&!jN?Object.defineProperties:function(o,n){VF(o);for(var i,s=BF(n),c=jF(n),d=c.length,h=0;d>h;)UF.f(o,i=c[h++],s[i]);return o};var pv,gP=Kr("document","documentElement"),HF=Tt,vu=pr("keys"),fv=function(o){return vu[o]||(vu[o]=HF(o))},GF=cs,Ki=Mi,C_=S_,gp=_u,WF=gP,EP=op,Qr="prototype",Ms="script",mv=fv("IE_PROTO"),Su=function(){},Cu=function(o){return"<script>"+o+"</"+Ms+">"},_v=function(o){o.write(Cu("")),o.close();var n=o.parentWindow.Object;return o=null,n},b_=function(){try{pv=new ActiveXObject("htmlfile")}catch{}var o,n;b_=typeof document<"u"?document.domain&&pv?_v(pv):("javascript:",(n=EP("iframe")).style.display="none",WF.appendChild(n),n.src=String("javascript:"),(o=n.contentWindow.document).open(),o.write(Cu("document.F=Object")),o.close(),o.F):_v(pv);for(var s=C_.length;s--;)delete b_[Qr][C_[s]];return b_()};gp[mv]=!0;var T_=Object.create||function(o,n){var i;return null!==o?(Su[Qr]=GF(o),i=new Su,Su[Qr]=null,i[mv]=o):i=b_(),void 0===n?i:Ki.f(i,n)},gv={},zF=jl,$0=S_.concat("length","prototype");gv.f=Object.getOwnPropertyNames||function(o){return zF(o,$0)};var _o={},I_=b0,bu=fe,KF=F0,X0=Array,yP=Math.max,J0=function(o,n,i){for(var s=bu(o),c=I_(n,s),d=I_(void 0===i?s:i,s),h=X0(yP(d-c,0)),p=0;c<d;c++,p++)KF(h,p,o[c]);return h.length=p,h},vP=$e,SP=Zt,Q0=gv.f,CP=J0,R_="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];_o.f=function(o){return R_&&"Window"==vP(o)?function(n){try{return Q0(n)}catch{return CP(R_)}}(o):Q0(SP(o))};var Hl={};Hl.f=Object.getOwnPropertySymbols;var qF=Wn,Za=function(o,n,i,s){return s&&s.enumerable?o[n]=i:qF(o,n,i),o},Ev=Ds,Ep=function(o,n,i){return Ev.f(o,n,i)},Tu={};Tu.f=Pn;var w_,Iu,Gc,Gl=Nl,TP=cn,he=Tu,Z0=Ds.f,_t=function(o){var n=Gl.Symbol||(Gl.Symbol={});TP(n,o)||Z0(n,o,{value:he.f(o)})},yv=Wr,yp=Kr,IP=Pn,RP=Za,eI=function(){var o=yp("Symbol"),n=o&&o.prototype,i=n&&n.valueOf,s=IP("toPrimitive");n&&!n[s]&&RP(n,s,function(c){return yv(i,this)},{arity:1})},vv=Ja,tI=d_,Sp=Ds.f,wP=Wn,nI=cn,Cp=d_?{}.toString:function(){return"[object "+vv(this)+"]"},bp=Pn("toStringTag"),Wl=function(o,n,i,s){if(o){var c=i?o:o.prototype;nI(c,bp)||Sp(c,bp,{configurable:!0,value:n}),s&&!tI&&wP(c,"toString",Cp)}},iI=er.WeakMap,Ru=Ni(iI)&&/native code/.test(String(iI)),DP=Po,YF=Wn,A_=cn,$F=fv,OP=_u,rI="Object already initialized",Cv=er.TypeError;if(Ru||Bc.state){var ks=Bc.state||(Bc.state=new(0,er.WeakMap));ks.get=ks.get,ks.has=ks.has,ks.set=ks.set,w_=function(o,n){if(ks.has(o))throw Cv(rI);return n.facade=o,ks.set(o,n),n},Iu=function(o){return ks.get(o)||{}},Gc=function(o){return ks.has(o)}}else{var Au=$F("state");OP[Au]=!0,w_=function(o,n){if(A_(o,Au))throw Cv(rI);return n.facade=o,YF(o,Au,n),n},Iu=function(o){return A_(o,Au)?o[Au]:{}},Gc=function(o){return A_(o,Au)}}var Tp={set:w_,get:Iu,has:Gc,enforce:function(o){return Gc(o)?Iu(o):w_(o,{})},getterFor:function(o){return function(n){var i;if(!DP(n)||(i=Iu(n)).type!==o)throw Cv("Incompatible receiver, "+o+" required");return i}}},XF=s_,oI=zr,JF=Tn,NP=fe,PP=fu,O_=Ei([].push),zl=function(o){var n=1==o,i=2==o,s=3==o,c=4==o,d=6==o,h=7==o,p=5==o||d;return function(m,_,E,y){for(var S,T,O=JF(m),N=oI(O),w=XF(_,E),k=NP(N),V=0,U=y||PP,Y=n?U(m,k):i||h?U(m,0):void 0;k>V;V++)if((p||V in N)&&(T=w(S=N[V],V,O),o))if(n)Y[V]=T;else if(T)switch(o){case 3:return!0;case 5:return S;case 6:return V;case 2:O_(Y,S)}else switch(o){case 4:return!1;case 7:O_(Y,S)}return d?-1:s||c?c:Y}},QF={forEach:zl(0),map:zl(1),filter:zl(2),some:zl(3),every:zl(4),find:zl(5),findIndex:zl(6),filterReject:zl(7)},Du=Wt,sI=er,aI=Wr,ZF=Ei,Ip=ca,Rp=Rr,MP=ti,qi=cn,bv=Is,N_=cs,wp=Zt,P_=zi,go=Ns,Tv=lu,Ap=T_,cI=mP,lI=gv,M_=_o,kP=Hl,dI=qm,uI=Ds,hI=Mi,pI=Uy,fI=Za,Zr=Ep,Dp=pr,Iv=_u,k_=Tt,Or=Pn,Op=Tu,mI=_t,LP=eI,xP=Wl,Rv=Tp,L_=QF.forEach,eo=fv("hidden"),x_="Symbol",Ou="prototype",FP=Rv.set,_I=Rv.getterFor(x_),Uo=Object[Ou],ec=sI.Symbol,F_=ec&&ec[Ou],gI=sI.TypeError,wv=sI.QObject,Nu=dI.f,Kl=uI.f,EI=M_.f,Av=pI.f,U_=ZF([].push),ma=Dp("symbols"),V_=Dp("op-symbols"),Pu=Dp("wks"),Np=!wv||!wv[Ou]||!wv[Ou].findChild,B_=Ip&&MP(function(){return 7!=Ap(Kl({},"a",{get:function(){return Kl(this,"a",{value:7}).a}})).a})?function(o,n,i){var s=Nu(Uo,n);s&&delete Uo[n],Kl(o,n,i),s&&o!==Uo&&Kl(Uo,n,s)}:Kl,Dv=function(o,n){var i=ma[o]=Ap(F_);return FP(i,{type:x_,tag:o,description:n}),Ip||(i.description=n),i},Mu=function(o,n,i){o===Uo&&Mu(V_,n,i),N_(o);var s=P_(n);return N_(i),qi(ma,s)?(i.enumerable?(qi(o,eo)&&o[eo][s]&&(o[eo][s]=!1),i=Ap(i,{enumerable:Tv(0,!1)})):(qi(o,eo)||Kl(o,eo,Tv(1,{})),o[eo][s]=!0),B_(o,s,i)):Kl(o,s,i)},Ov=function(o,n){N_(o);var i=wp(n),s=cI(i).concat(CI(i));return L_(s,function(c){Ip&&!aI(yI,i,c)||Mu(o,c,i[c])}),o},yI=function(o){var n=P_(o),i=aI(Av,this,n);return!(this===Uo&&qi(ma,n)&&!qi(V_,n))&&(!(i||!qi(this,n)||!qi(ma,n)||qi(this,eo)&&this[eo][n])||i)},vI=function(o,n){var i=wp(o),s=P_(n);if(i!==Uo||!qi(ma,s)||qi(V_,s)){var c=Nu(i,s);return!c||!qi(ma,s)||qi(i,eo)&&i[eo][s]||(c.enumerable=!0),c}},SI=function(o){var n=EI(wp(o)),i=[];return L_(n,function(s){qi(ma,s)||qi(Iv,s)||U_(i,s)}),i},CI=function(o){var n=o===Uo,i=EI(n?V_:wp(o)),s=[];return L_(i,function(c){!qi(ma,c)||n&&!qi(Uo,c)||U_(s,ma[c])}),s};Rp||(ec=function(){if(bv(F_,this))throw gI("Symbol is not a constructor");var o=arguments.length&&void 0!==arguments[0]?go(arguments[0]):void 0,n=k_(o),i=function(s){this===Uo&&aI(i,V_,s),qi(this,eo)&&qi(this[eo],n)&&(this[eo][n]=!1),B_(this,n,Tv(1,s))};return Ip&&Np&&B_(Uo,n,{configurable:!0,set:i}),Dv(n,o)},fI(F_=ec[Ou],"toString",function(){return _I(this).tag}),fI(ec,"withoutSetter",function(o){return Dv(k_(o),o)}),pI.f=yI,uI.f=Mu,hI.f=Ov,dI.f=vI,lI.f=M_.f=SI,kP.f=CI,Op.f=function(o){return Dv(Or(o),o)},Ip&&Zr(F_,"description",{configurable:!0,get:function(){return _I(this).description}})),Du({global:!0,constructor:!0,wrap:!0,forced:!Rp,sham:!Rp},{Symbol:ec}),L_(cI(Pu),function(o){mI(o)}),Du({target:x_,stat:!0,forced:!Rp},{useSetter:function(){Np=!0},useSimple:function(){Np=!1}}),Du({target:"Object",stat:!0,forced:!Rp,sham:!Ip},{create:function(o,n){return void 0===n?Ap(o):Ov(Ap(o),n)},defineProperty:Mu,defineProperties:Ov,getOwnPropertyDescriptor:vI}),Du({target:"Object",stat:!0,forced:!Rp},{getOwnPropertyNames:SI}),LP(),xP(ec,x_),Iv[eo]=!0;var bI=Rr&&!!Symbol.for&&!!Symbol.keyFor,TI=Wt,Nv=Kr,II=cn,Pv=Ns,RI=pr,UP=bI,j_=RI("string-to-symbol-registry"),wI=RI("symbol-to-string-registry");TI({target:"Symbol",stat:!0,forced:!UP},{for:function(o){var n=Pv(o);if(II(j_,n))return j_[n];var i=Nv("Symbol")(n);return j_[n]=i,wI[i]=n,i}});var ql=Wt,AI=cn,DI=Uc,VP=Vc,eU=bI,Pp=pr("symbol-to-string-registry");ql({target:"Symbol",stat:!0,forced:!eU},{keyFor:function(o){if(!DI(o))throw TypeError(VP(o)+" is not a symbol");if(AI(Pp,o))return Pp[o]}});var OI=Ei([].slice),Mv=hp,NI=Ni,kv=$e,Lv=Ns,xv=Ei([].push),H_=Wt,Mp=Kr,Fv=Dn,Uv=Wr,Yl=Ei,G_=ti,ku=Ni,PI=Uc,Vv=OI,BP=function(o){if(NI(o))return o;if(Mv(o)){for(var n=o.length,i=[],s=0;s<n;s++){var c=o[s];"string"==typeof c?xv(i,c):"number"!=typeof c&&"Number"!=kv(c)&&"String"!=kv(c)||xv(i,Lv(c))}var d=i.length,h=!0;return function(p,m){if(h)return h=!1,m;if(Mv(this))return m;for(var _=0;_<d;_++)if(i[_]===p)return m}}},jP=Rr,MI=String,_a=Mp("JSON","stringify"),$l=Yl(/./.exec),W_=Yl("".charAt),Xl=Yl("".charCodeAt),HP=Yl("".replace),GP=Yl(1..toString),tU=/[\uD800-\uDFFF]/g,kI=/^[\uD800-\uDBFF]$/,z_=/^[\uDC00-\uDFFF]$/,LI=!jP||G_(function(){var o=Mp("Symbol")();return"[null]"!=_a([o])||"{}"!=_a({a:o})||"{}"!=_a(Object(o))}),Bv=G_(function(){return'"\\udf06\\ud834"'!==_a("\udf06\ud834")||'"\\udead"'!==_a("\udead")}),K_=function(o,n){var i=Vv(arguments),s=BP(n);if(ku(s)||void 0!==o&&!PI(o))return i[1]=function(c,d){if(ku(s)&&(d=Uv(s,this,MI(c),d)),!PI(d))return d},Fv(_a,null,i)},jv=function(o,n,i){var s=W_(i,n-1),c=W_(i,n+1);return $l(kI,o)&&!$l(z_,c)||$l(z_,o)&&!$l(kI,s)?"\\u"+GP(Xl(o,0),16):o};_a&&H_({target:"JSON",stat:!0,arity:3,forced:LI||Bv},{stringify:function(o,n,i){var s=Vv(arguments),c=Fv(LI?K_:_a,null,s);return Bv&&"string"==typeof c?HP(c,tU,jv):c}});var Hv=Hl,xI=Tn;Wt({target:"Object",stat:!0,forced:!Rr||ti(function(){Hv.f(1)})},{getOwnPropertySymbols:function(o){var n=Hv.f;return n?n(xI(o)):[]}}),_t("asyncIterator"),_t("hasInstance"),_t("isConcatSpreadable"),_t("iterator"),_t("match"),_t("matchAll"),_t("replace"),_t("search"),_t("species"),_t("split");var FI=eI;_t("toPrimitive"),FI();var UI=Kr,WP=Wl;_t("toStringTag"),WP(UI("Symbol"),"Symbol"),_t("unscopables"),Wl(er.JSON,"JSON",!0);var Jl,VI,BI,zP=Nl.Symbol,Vo={},Ql=ca,qP=Function.prototype,nU=Ql&&Object.getOwnPropertyDescriptor,jI=cn(qP,"name"),YP={EXISTS:jI,PROPER:jI&&"something"===function(){}.name,CONFIGURABLE:jI&&(!Ql||Ql&&nU(qP,"name").configurable)},iU=!ti(function(){function o(){}return o.prototype.constructor=null,Object.getPrototypeOf(new o)!==o.prototype}),HI=cn,$P=Ni,XP=Tn,JP=iU,GI=fv("IE_PROTO"),kp=Object,tc=kp.prototype,Zl=JP?kp.getPrototypeOf:function(o){var n=XP(o);if(HI(n,GI))return n[GI];var i=n.constructor;return $P(i)&&n instanceof i?i.prototype:n instanceof kp?tc:null},WI=ti,zI=Ni,KI=Po,rU=T_,QP=Zl,oU=Za,Lp=Pn("iterator"),q_=!1;[].keys&&("next"in(BI=[].keys())?(VI=QP(QP(BI)))!==Object.prototype&&(Jl=VI):q_=!0);var sU=!KI(Jl)||WI(function(){var o={};return Jl[Lp].call(o)!==o});zI((Jl=sU?{}:rU(Jl))[Lp])||oU(Jl,Lp,function(){return this});var ZP={IteratorPrototype:Jl,BUGGY_SAFARI_ITERATORS:q_},qI=ZP.IteratorPrototype,eM=T_,tM=lu,nM=Wl,iM=Vo,YI=function(){return this},Y_=Ei,rM=as,Gv=Ni,oM=String,ki=TypeError,aM=cs,$I=Object.setPrototypeOf||("__proto__"in{}?function(){var o,n=!1,i={};try{(o=function(o,n,i){try{return Y_(rM(Object.getOwnPropertyDescriptor(o,n)[i]))}catch{}}(Object.prototype,"__proto__","set"))(i,[]),n=i instanceof Array}catch{}return function(s,c){return aM(s),function(o){if("object"==typeof o||Gv(o))return o;throw ki("Can't set "+oM(o)+" as a prototype")}(c),n?o(s,c):s.__proto__=c,s}}():void 0),cM=Wt,lM=Wr,hM=Zl,aU=Wl,pM=Za,Lu=Vo,XI=YP.PROPER,xp=ZP.BUGGY_SAFARI_ITERATORS,X_=Pn("iterator"),Fp="values",zv="entries",Kv=function(){return this},fM=function(o,n,i,s,c,d,h){!function(o,n,i,s){var c=n+" Iterator";o.prototype=eM(qI,{next:tM(+!s,i)}),nM(o,c,!1,!0),iM[c]=YI}(i,n,s);var p,m,_,E=function(k){if(k===c&&N)return N;if(!xp&&k in T)return T[k];switch(k){case"keys":case Fp:case zv:return function(){return new i(this,k)}}return function(){return new i(this)}},y=n+" Iterator",S=!1,T=o.prototype,O=T[X_]||T["@@iterator"]||c&&T[c],N=!xp&&O||E(c),w="Array"==n&&T.entries||O;if(w&&(p=hM(w.call(new o)))!==Object.prototype&&p.next&&(aU(p,y,!0,!0),Lu[y]=Kv),XI&&c==Fp&&O&&O.name!==Fp&&(S=!0,N=function(){return lM(O,this)}),c)if(m={values:E(Fp),keys:d?N:E("keys"),entries:E(zv)},h)for(_ in m)(xp||S||!(_ in T))&&pM(T,_,m[_]);else cM({target:n,proto:!0,forced:xp||S},m);return h&&T[X_]!==N&&pM(T,X_,N,{name:c}),Lu[n]=N,m},QI=function(o,n){return{value:o,done:n}},qv=Zt,Yv=Vo,ed=fM,ZI=QI,J_="Array Iterator",Q_=Tp.set,mM=Tp.getterFor(J_);ed(Array,"Array",function(o,n){Q_(this,{type:J_,target:qv(o),index:0,kind:n})},function(){var o=mM(this),n=o.target,i=o.kind,s=o.index++;return!n||s>=n.length?(o.target=void 0,ZI(void 0,!0)):ZI("keys"==i?s:"values"==i?n[s]:[s,n[s]],!1)},"values"),Yv.Arguments=Yv.Array;var Z_=er,Wc=Ja,eR=Wn,eg=Vo,tR=Pn("toStringTag");for(var Jv in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var Qv=Z_[Jv],zc=Qv&&Qv.prototype;zc&&Wc(zc)!==tR&&eR(zc,tR,Jv),eg[Jv]=eg.Array}var _M=zP,EM=Ds.f,nR=Pn("metadata"),tg=Function.prototype;void 0===tg[nR]&&EM(tg,nR,{value:null}),_t("dispose"),_t("metadata");var yM=_M;_t("asyncDispose");var iR=Ei,Zv=Kr("Symbol"),rR=Zv.keyFor,cU=iR(Zv.prototype.valueOf),oR=Zv.isRegisteredSymbol||function(o){try{return void 0!==rR(cU(o))}catch{return!1}};Wt({target:"Symbol",stat:!0},{isRegisteredSymbol:oR});for(var td=pr,sR=Kr,xu=Ei,ci=Uc,vM=Pn,eS=sR("Symbol"),Fu=eS.isWellKnownSymbol,Ls=sR("Object","getOwnPropertyNames"),SM=xu(eS.prototype.valueOf),aR=td("wks"),nc=0,cR=Ls(eS),tS=cR.length;nc<tS;nc++)try{var ng=cR[nc];ci(eS[ng])&&vM(ng)}catch{}var lR=function(o){if(Fu&&Fu(o))return!0;try{for(var n=SM(o),i=0,s=Ls(aR),c=s.length;i<c;i++)if(aR[s[i]]==n)return!0}catch{}return!1};Wt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:lR}),_t("matcher"),_t("observable"),Wt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:oR}),Wt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:lR}),_t("metadataKey"),_t("patternMatch"),_t("replaceAll");var Kc=hr(yM),qc=Ei,CM=l_,bM=Ns,TM=$m,IM=qc("".charAt),dR=qc("".charCodeAt),RM=qc("".slice),uR=function(o){return function(n,i){var s,c,d=bM(TM(n)),h=CM(i),p=d.length;return h<0||h>=p?o?"":void 0:(s=dR(d,h))<55296||s>56319||h+1===p||(c=dR(d,h+1))<56320||c>57343?o?IM(d,h):s:o?RM(d,h,h+2):c-56320+(s-55296<<10)+65536}},Uu=(uR(!1),uR(!0)),ic=Ns,wM=fM,AM=QI,DM="String Iterator",pR=Tp.set,lU=Tp.getterFor(DM);wM(String,"String",function(o){pR(this,{type:DM,string:ic(o),index:0})},function(){var o,n=lU(this),i=n.string,s=n.index;return s>=i.length?AM(void 0,!0):(o=Uu(i,s),n.index+=o.length,AM(o,!1))});var nS=hr(Tu.f("iterator"));function ig(o){return(ig="function"==typeof Kc&&"symbol"==typeof nS?function(n){return typeof n}:function(n){return n&&"function"==typeof Kc&&n.constructor===Kc&&n!==Kc.prototype?"symbol":typeof n})(o)}var fR=hr(Tu.f("toPrimitive"));function C(o,n,i){return(n=function OM(o){var n=function(i,s){if("object"!==ig(i)||null===i)return i;var c=i[fR];if(void 0!==c){var d=c.call(i,s);if("object"!==ig(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}(o,"string");return"symbol"===ig(n)?n:String(n)}(n))in o?p_(o,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[n]=i,o}var NM=$a("Array").keys,PM=Ja,xs=cn,MM=Is,mR=NM,iS=Array.prototype,kM={DOMTokenList:!0,NodeList:!0},Eo=hr(function(o){var n=o.keys;return o===iS||MM(iS,o)&&n===iS.keys||xs(kM,PM(o))?mR:n}),_R=Vc,gR=TypeError,ER=J0,LM=Math.floor,rS=function(o,n){var i=o.length,s=LM(i/2);return i<8?vt(o,n):Xe(o,rS(ER(o,0,s),n),rS(ER(o,s),n),n)},vt=function(o,n){for(var i,s,c=o.length,d=1;d<c;){for(s=d,i=o[d];s&&n(o[s-1],i)>0;)o[s]=o[--s];s!==d++&&(o[s]=i)}return o},Xe=function(o,n,i,s){for(var c=n.length,d=i.length,h=0,p=0;h<c||p<d;)o[h+p]=h<c&&p<d?s(n[h],i[p])<=0?n[h++]:i[p++]:h<c?n[h++]:i[p++];return o},yR=rS,vR=ti,SR=function(o,n){var i=[][o];return!!i&&vR(function(){i.call(null,n||function(){return 1},1)})},CR=Pl.match(/firefox\/(\d+)/i),bR=!!CR&&+CR[1],xM=/MSIE|Trident/.test(Pl),oS=Pl.match(/AppleWebKit\/(\d+)\./),UM=Wt,VM=Ei,TR=as,IR=Tn,Nr=fe,BM=function(o,n){if(!delete o[n])throw gR("Cannot delete property "+_R(n)+" of "+_R(o))},rg=Ns,Up=ti,jM=yR,dU=SR,HM=bR,uU=xM,RR=fo,sS=!!oS&&+oS[1],nd=[],wR=VM(nd.sort),Vu=VM(nd.push),GM=Up(function(){nd.sort(void 0)}),AR=Up(function(){nd.sort(null)}),og=dU("sort"),DR=!Up(function(){if(RR)return RR<70;if(!(HM&&HM>3)){if(uU)return!0;if(sS)return sS<603;var o,n,i,s,c="";for(o=65;o<76;o++){switch(n=String.fromCharCode(o),o){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(s=0;s<47;s++)nd.push({k:n+s,v:i})}for(nd.sort(function(d,h){return h.v-d.v}),s=0;s<nd.length;s++)n=nd[s].k.charAt(0),c.charAt(c.length-1)!==n&&(c+=n);return"DGBEFHACIJK"!==c}});UM({target:"Array",proto:!0,forced:GM||!AR||!og||!DR},{sort:function(o){void 0!==o&&TR(o);var n=IR(this);if(DR)return void 0===o?wR(n):wR(n,o);var i,s,c=[],d=Nr(n);for(s=0;s<d;s++)s in n&&Vu(c,n[s]);for(jM(c,function(h){return function(p,m){return void 0===m?-1:void 0===p?1:void 0!==h?+h(p,m)||0:rg(p)>rg(m)?1:-1}}(o)),i=Nr(c),s=0;s<i;)n[s]=c[s++];for(;s<d;)BM(n,s++);return n}});var OR=$a("Array").sort,WM=Is,zM=OR,aS=Array.prototype,Vp=hr(function(o){var n=o.sort;return o===aS||WM(aS,o)&&n===aS.sort?zM:n}),KM=Kr,NR=gv,qM=Hl,PR=cs,MR=Ei([].concat),cS=KM("Reflect","ownKeys")||function(o){var n=NR.f(PR(o)),i=qM.f;return i?MR(n,i(o)):n},YM=cn,lS=cS,$M=qm,hU=Ds,se=Po,Bp=Wn,dS=Error,sg=Ei("".replace),Fs=String(dS("zxcasd").stack),uS=/\n\s*at [^:]*:[^\n]*/,XM=uS.test(Fs),hS=lu,rc=!ti(function(){var o=Error("a");return!("stack"in o)||(Object.defineProperty(o,"stack",hS(1,7)),7!==o.stack)}),pS=Wn,fS=rc,JM=Error.captureStackTrace,LR=Vo,pU=Pn("iterator"),ag=Array.prototype,cg=Ja,lg=Zm,mS=an,_S=Vo,fU=Pn("iterator"),xR=function(o){if(!mS(o))return lg(o,fU)||lg(o,"@@iterator")||_S[cg(o)]},QM=Wr,ZM=as,ek=cs,FR=Vc,mU=xR,tk=TypeError,_U=Wr,gS=cs,UR=Zm,nk=s_,ES=Wr,gU=cs,EU=Vc,vU=fe,ik=Is,CU=xR,rk=function(o,n,i){var s,c;gS(o);try{if(!(s=UR(o,"return"))){if("throw"===n)throw i;return i}s=_U(s,o)}catch(d){c=!0,s=d}if("throw"===n)throw i;if(c)throw s;return gS(s),i},bU=TypeError,yS=function(o,n){this.stopped=o,this.result=n},oc=yS.prototype,id=function(o,n,i){var s,c,d,h,p,m,_,y=!(!i||!i.AS_ENTRIES),S=!(!i||!i.IS_RECORD),T=!(!i||!i.IS_ITERATOR),O=!(!i||!i.INTERRUPTED),N=nk(n,i&&i.that),w=function(V){return s&&rk(s,"normal",V),new yS(!0,V)},k=function(V){return y?(gU(V),O?N(V[0],V[1],w):N(V[0],V[1])):O?N(V,w):N(V)};if(S)s=o.iterator;else if(T)s=o;else{if(!(c=CU(o)))throw bU(EU(o)+" is not iterable");if(function(o){return void 0!==o&&(LR.Array===o||ag[pU]===o)}(c)){for(d=0,h=vU(o);h>d;d++)if((p=k(o[d]))&&ik(oc,p))return p;return new yS(!1)}s=function(o,n){var i=arguments.length<2?mU(o):n;if(ZM(i))return ek(QM(i,o));throw tk(FR(o)+" is not iterable")}(o,c)}for(m=S?o.next:s.next;!(_=ES(m,s)).done;){try{p=k(_.value)}catch(V){rk(s,"throw",V)}if("object"==typeof p&&p&&ik(oc,p))return p}return new yS(!1)},ok=Ns,VR=Wt,vS=Is,BR=Zl,Bu=$I,sc=T_,dg=Wn,SS=lu,ak=function(o,n){se(n)&&"cause"in n&&Bp(o,"cause",n.cause)},jR=function(o,n,i,s){fS&&(JM?JM(o,n):pS(o,"stack",function(o,n){if(XM&&"string"==typeof o&&!dS.prepareStackTrace)for(;n--;)o=sg(o,uS,"");return o}(i,s)))},ck=id,lk=function(o,n){return void 0===o?arguments.length<2?"":n:ok(o)},ug=Pn("toStringTag"),ac=Error,CS=[].push,Us=function(o,n){var i,s=vS(jp,this);Bu?i=Bu(ac(),s?BR(this):jp):(i=s?this:sc(jp),dg(i,ug,"Error")),void 0!==n&&dg(i,"message",lk(n)),jR(i,Us,i.stack,1),arguments.length>2&&ak(i,arguments[2]);var c=[];return ck(o,CS,{that:c}),dg(i,"errors",c),i};Bu?Bu(Us,ac):function(o,n,i){for(var s=lS(n),c=hU.f,d=$M.f,h=0;h<s.length;h++){var p=s[h];YM(o,p)||i&&YM(i,p)||c(o,p,d(n,p))}}(Us,ac,{name:!0});var jp=Us.prototype=sc(ac.prototype,{constructor:SS(1,Us),message:SS(1,""),name:SS(1,"AggregateError")});VR({global:!0,constructor:!0,arity:2},{AggregateError:Us});var Yc,rd,bS,Hp,od=typeof process<"u"&&"process"==$e(process),HR=Kr,TS=Ep,dk=ca,uk=Pn("species"),hk=Is,GR=TypeError,pk=fp,WR=Vc,zR=TypeError,KR=cs,qR=an,fk=Pn("species"),mk=function(o,n){var i,s=KR(o).constructor;return void 0===s||qR(i=KR(s)[fk])?n:function(o){if(pk(o))return o;throw zR(WR(o)+" is not a constructor")}(i)},_k=TypeError,hg=/(?:ipad|iphone|ipod).*applewebkit/i.test(Pl),yo=er,gk=Dn,Ek=s_,YR=Ni,$R=cn,XR=ti,IS=gP,yk=OI,JR=op,QR=function(o,n){if(o<n)throw _k("Not enough arguments");return o},ZR=hg,vk=od,hs=yo.setImmediate,Gp=yo.clearImmediate,Sk=yo.process,RS=yo.Dispatch,TU=yo.Function,wS=yo.MessageChannel,Ck=yo.String,AS=0,Wp={},pg="onreadystatechange";XR(function(){Yc=yo.location});var DS=function(o){if($R(Wp,o)){var n=Wp[o];delete Wp[o],n()}},OS=function(o){return function(){DS(o)}},zp=function(o){DS(o.data)},fg=function(o){yo.postMessage(Ck(o),Yc.protocol+"//"+Yc.host)};hs&&Gp||(hs=function(o){QR(arguments.length,1);var n=YR(o)?o:TU(o),i=yk(arguments,1);return Wp[++AS]=function(){gk(n,void 0,i)},rd(AS),AS},Gp=function(o){delete Wp[o]},vk?rd=function(o){Sk.nextTick(OS(o))}:RS&&RS.now?rd=function(o){RS.now(OS(o))}:wS&&!ZR?(Hp=(bS=new wS).port2,bS.port1.onmessage=zp,rd=Ek(Hp.postMessage,Hp)):yo.addEventListener&&YR(yo.postMessage)&&!yo.importScripts&&Yc&&"file:"!==Yc.protocol&&!XR(fg)?(rd=fg,yo.addEventListener("message",zp,!1)):rd=pg in JR("script")?function(o){IS.appendChild(JR("script"))[pg]=function(){IS.removeChild(this),DS(o)}}:function(o){setTimeout(OS(o),0)});var Kp={set:hs,clear:Gp},bk=function(){this.head=null,this.tail=null};bk.prototype={add:function(o){var n={item:o,next:null},i=this.tail;i?i.next=n:this.head=n,this.tail=n},get:function(){var o=this.head;if(o)return null===(this.head=o.next)&&(this.tail=null),o.item}};var $c,ew,mg,_g,NS,PS=bk,MS=/ipad|iphone|ipod/i.test(Pl)&&typeof Pebble<"u",cc=/web0s(?!.*chrome)/i.test(Pl),ga=er,qp=s_,kS=Kp.set,LS=PS,tw=hg,Tk=MS,Ik=cc,sd=od,nw=ga.MutationObserver||ga.WebKitMutationObserver,Rk=ga.document,iw=ga.process,xS=ga.Promise,rw=(0,qm.f)(ga,"queueMicrotask"),FS=rw&&rw.value;if(!FS){var gg=new LS,$p=function(){var o,n;for(sd&&(o=iw.domain)&&o.exit();n=gg.get();)try{n()}catch(i){throw gg.head&&$c(),i}o&&o.enter()};tw||sd||Ik||!nw||!Rk?!Tk&&xS&&xS.resolve?((_g=xS.resolve(void 0)).constructor=xS,NS=qp(_g.then,_g),$c=function(){NS($p)}):sd?$c=function(){iw.nextTick($p)}:(kS=qp(kS,ga),$c=function(){kS($p)}):(ew=!0,mg=Rk.createTextNode(""),new nw($p).observe(mg,{characterData:!0}),$c=function(){mg.data=ew=!ew}),FS=function(o){gg.head||$c(),gg.add(o)}}var Ft=FS,ju=function(o){try{return{error:!1,value:o()}}catch(n){return{error:!0,value:n}}},lc=er.Promise,ow="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,wk=!ow&&!od&&"object"==typeof window&&"object"==typeof document,Ak=er,Xp=lc,Dk=Ni,Ok=BN,Eg=U0,IU=wk,Jp=ow,US=fo,sw=Xp&&Xp.prototype,VS=Pn("species"),aw=!1,Vs=Dk(Ak.PromiseRejectionEvent),Li={CONSTRUCTOR:Ok("Promise",function(){var o=Eg(Xp),n=o!==String(Xp);if(!n&&66===US||!sw.catch||!sw.finally)return!0;if(!US||US<51||!/native code/.test(o)){var i=new Xp(function(c){c(1)}),s=function(c){c(function(){},function(){})};if((i.constructor={})[VS]=s,!(aw=i.then(function(){})instanceof s))return!0}return!n&&(IU||Jp)&&!Vs}),REJECTION_EVENT:Vs,SUBCLASSING:aw},Pr={},Zp=as,ps=TypeError,tr=function(o){var n,i;this.promise=new o(function(s,c){if(void 0!==n||void 0!==i)throw ps("Bad Promise constructor");n=s,i=c}),this.resolve=Zp(n),this.reject=Zp(i)};Pr.f=function(o){return new tr(o)};var Xc,cd,Hu=Wt,dc=od,jo=er,Ea=Wr,Gu=Za,Wu=Wl,cw=as,yg=Ni,lw=Po,uw=mk,BS=Kp.set,vg=Ft,pw=ju,Nk=PS,fw=Tp,zn=lc,ef=Pr,Ze="Promise",Sg=Li.CONSTRUCTOR,Pk=Li.REJECTION_EVENT,De=fw.getterFor(Ze),Ge=fw.set,tf=zn,uc=zn&&zn.prototype,Jc=jo.TypeError,Cg=jo.document,ya=jo.process,ld=ef.f,_w=ld,jS=!!(Cg&&Cg.createEvent&&jo.dispatchEvent),Xt="unhandledrejection",HS=function(o){var n;return!(!lw(o)||!yg(n=o.then))&&n},gw=function(o,n){var i,s,c,d=n.value,h=1==n.state,p=h?o.ok:o.fail,m=o.resolve,_=o.reject,E=o.domain;try{p?(h||(2===n.rejection&&Mk(n),n.rejection=1),!0===p?i=d:(E&&E.enter(),i=p(d),E&&(E.exit(),c=!0)),i===o.promise?_(Jc("Promise-chain cycle")):(s=HS(i))?Ea(s,i,m,_):m(i)):_(d)}catch(y){E&&!c&&E.exit(),_(y)}},GS=function(o,n){o.notified||(o.notified=!0,vg(function(){for(var i,s=o.reactions;i=s.get();)gw(i,o);o.notified=!1,n&&!o.rejection&&Ew(o)}))},WS=function(o,n,i){var s,c;jS?((s=Cg.createEvent("Event")).promise=n,s.reason=i,s.initEvent(o,!1,!0),jo.dispatchEvent(s)):s={promise:n,reason:i},!Pk&&(c=jo["on"+o])?c(s):o===Xt&&function(o,n){try{1==arguments.length?console.error(o):console.error(o,n)}catch{}}("Unhandled promise rejection",i)},Ew=function(o){Ea(BS,jo,function(){var n,i=o.facade,s=o.value;if(ln(o)&&(n=pw(function(){dc?ya.emit("unhandledRejection",s,i):WS(Xt,i,s)}),o.rejection=dc||ln(o)?2:1,n.error))throw n.value})},ln=function(o){return 1!==o.rejection&&!o.parent},Mk=function(o){Ea(BS,jo,function(){var n=o.facade;dc?ya.emit("rejectionHandled",n):WS("rejectionhandled",n,o.value)})},hc=function(o,n,i){return function(s){o(n,s,i)}},Mr=function(o,n,i){o.done||(o.done=!0,i&&(o=i),o.value=n,o.state=2,GS(o,!0))},bg=function(o,n,i){if(!o.done){o.done=!0,i&&(o=i);try{if(o.facade===n)throw Jc("Promise can't be resolved itself");var s=HS(n);s?vg(function(){var c={done:!1};try{Ea(s,n,hc(bg,c,o),hc(Mr,c,o))}catch(d){Mr(c,d,o)}}):(o.value=n,o.state=1,GS(o,!1))}catch(c){Mr({done:!1},c,o)}}};Sg&&(uc=(tf=function(o){(function(o,n){if(hk(n,o))return o;throw GR("Incorrect invocation")})(this,uc),cw(o),Ea(Xc,this);var n=De(this);try{o(hc(bg,n),hc(Mr,n))}catch(i){Mr(n,i)}}).prototype,(Xc=function(o){Ge(this,{type:Ze,done:!1,notified:!1,parent:!1,reactions:new Nk,rejection:!1,state:0,value:void 0})}).prototype=Gu(uc,"then",function(o,n){var i=De(this),s=ld(uw(this,tf));return i.parent=!0,s.ok=!yg(o)||o,s.fail=yg(n)&&n,s.domain=dc?ya.domain:void 0,0==i.state?i.reactions.add(s):vg(function(){gw(s,i)}),s.promise}),cd=function(){var o=new Xc,n=De(o);this.promise=o,this.resolve=hc(bg,n),this.reject=hc(Mr,n)},ef.f=ld=function(o){return o===tf||void 0===o?new cd(o):_w(o)}),Hu({global:!0,constructor:!0,wrap:!0,forced:Sg},{Promise:tf}),Wu(tf,Ze,!1,!0),function(o){var n=HR(o);dk&&n&&!n[uk]&&TS(n,uk,{configurable:!0,get:function(){return this}})}(Ze);var Tg=Pn("iterator"),zS=!1;try{var yw=0,KS={next:function(){return{done:!!yw++}},return:function(){zS=!0}};KS[Tg]=function(){return this},Array.from(KS,function(){throw 2})}catch{}var vw=lc,nf=Li.CONSTRUCTOR||!function(o,n){if(!n&&!zS)return!1;var i=!1;try{var s={};s[Tg]=function(){return{next:function(){return{done:i=!0}}}},o(s)}catch{}return i}(function(o){vw.all(o).then(void 0,function(){})}),Cw=Wr,bw=as,RU=Pr,kk=ju,Lk=id;Wt({target:"Promise",stat:!0,forced:nf},{all:function(o){var n=this,i=RU.f(n),s=i.resolve,c=i.reject,d=kk(function(){var h=bw(n.resolve),p=[],m=0,_=1;Lk(o,function(E){var y=m++,S=!1;_++,Cw(h,n,E).then(function(T){S||(S=!0,p[y]=T,--_||s(p))},c)}),--_||s(p)});return d.error&&c(d.value),i.promise}}),Wt({target:"Promise",proto:!0,forced:Li.CONSTRUCTOR,real:!0},{catch:function(o){return this.then(void 0,o)}});var Yi=Wr,Iw=as,Fk=Pr,Uk=ju,Rw=id;Wt({target:"Promise",stat:!0,forced:nf},{race:function(o){var n=this,i=Fk.f(n),s=i.reject,c=Uk(function(){var d=Iw(n.resolve);Rw(o,function(h){Yi(d,n,h).then(i.resolve,s)})});return c.error&&s(c.value),i.promise}});var Vk=Wr,ww=Pr;Wt({target:"Promise",stat:!0,forced:Li.CONSTRUCTOR},{reject:function(o){var n=ww.f(this);return Vk(n.reject,void 0,o),n.promise}});var Aw=cs,Ku=Po,Bk=Pr,Dw=function(o,n){if(Aw(o),Ku(n)&&n.constructor===o)return n;var i=Bk.f(o);return(0,i.resolve)(n),i.promise},Ow=Wt,jk=lc,Nw=Li.CONSTRUCTOR,wU=Dw,qS=Kr("Promise"),In=!Nw;Ow({target:"Promise",stat:!0,forced:!0},{resolve:function(o){return wU(In&&this===qS?jk:this,o)}});var va=Wr,Hk=as,Gk=Pr,Sa=ju,Bs=id;Wt({target:"Promise",stat:!0,forced:nf},{allSettled:function(o){var n=this,i=Gk.f(n),s=i.resolve,c=i.reject,d=Sa(function(){var h=Hk(n.resolve),p=[],m=0,_=1;Bs(o,function(E){var y=m++,S=!1;_++,va(h,n,E).then(function(T){S||(S=!0,p[y]={status:"fulfilled",value:T},--_||s(p))},function(T){S||(S=!0,p[y]={status:"rejected",reason:T},--_||s(p))})}),--_||s(p)});return d.error&&c(d.value),i.promise}});var js=Wr,Pw=as,Mw=Kr,Wk=Pr,zk=ju,Kk=id,kw="No one promise resolved";Wt({target:"Promise",stat:!0,forced:nf},{any:function(o){var n=this,i=Mw("AggregateError"),s=Wk.f(n),c=s.resolve,d=s.reject,h=zk(function(){var p=Pw(n.resolve),m=[],_=0,E=1,y=!1;Kk(o,function(S){var T=_++,O=!1;E++,js(p,n,S).then(function(N){O||y||(y=!0,c(N))},function(N){O||y||(O=!0,m[T]=N,--E||d(new i(m,kw)))})}),--E||d(new i(m,kw))});return h.error&&d(h.value),s.promise}});var Lw=Kr,Yk=Ni,xw=mk,$S=Dw,Ig=lc&&lc.prototype;Wt({target:"Promise",proto:!0,real:!0,forced:!!lc&&ti(function(){Ig.finally.call({then:function(){}},function(){})})},{finally:function(o){var n=xw(this,Lw("Promise")),i=Yk(o);return this.then(i?function(s){return $S(n,o()).then(function(){return s})}:o,i?function(s){return $S(n,o()).then(function(){throw s})}:o)}});var Fw=Nl.Promise,z=hr(Fw);const $i=()=>{};function fs(){const o={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:$i};return o.promise=new z((n,i)=>{o.resolve=s=>{o.isFinished||(o.isResolved=!0,o.isFinished=!0,n(s),o.value=s)},o.reject=s=>{o.isFinished||(o.isRejected=!0,o.isFinished=!0,i(s))}}),o}const Qc=new Map,rf=new Map,Hs=new Map;var ii,gt,o;(o=ii||(ii={})).WIN_10="Windows 10",o.WIN_81="Windows 8.1",o.WIN_8="Windows 8",o.WIN_7="Windows 7",o.WIN_VISTA="Windows Vista",o.WIN_SERVER_2003="Windows Server 2003",o.WIN_XP="Windows XP",o.WIN_2000="Windows 2000",o.ANDROID="Android",o.HARMONY_OS="HarmonyOS",o.OPEN_BSD="Open BSD",o.SUN_OS="Sun OS",o.LINUX="Linux",o.IOS="iOS",o.MAC_OS="Mac OS",o.QNX="QNX",o.UNIX="UNIX",o.BEOS="BeOS",o.OS_2="OS/2",o.SEARCH_BOT="Search Bot",function(o){o.CHROME="Chrome",o.SAFARI="Safari",o.EDGE="Edge",o.FIREFOX="Firefox",o.OPERA="OPR",o.QQ="QQBrowser",o.WECHAT="MicroMessenger"}(gt||(gt={}));var Rg={exports:{}};!function(o,n){!function(i,s){var c="function",d="undefined",h="object",p="string",m="major",_="model",E="name",y="type",S="vendor",T="version",O="architecture",N="console",w="mobile",k="tablet",V="smarttv",U="wearable",Y="embedded",re="Amazon",K="Apple",$="ASUS",X="BlackBerry",J="Browser",Ee="Chrome",ve="Firefox",ze="Google",dt="Microsoft",bt="Motorola",ee="Opera",ae="Samsung",Le="Sony",pt="Xiaomi",le="Zebra",R="Facebook",F="Chromium OS",H="Mac OS",oe=function(Ln){for(var ei={},Qt=0;Qt<Ln.length;Qt++)ei[Ln[Qt].toUpperCase()]=Ln[Qt];return ei},Ue=function(Ln,ei){return typeof Ln===p&&-1!==Yt(ei).indexOf(Yt(Ln))},Yt=function(Ln){return Ln.toLowerCase()},Gi=function(Ln,ei){if(typeof Ln===p)return Ln=Ln.replace(/^\s\s*/,""),typeof ei===d?Ln:Ln.substring(0,350)},Do=function(Ln,ei){for(var Qt,Oo,Pc,xn,ft,uo,Xd=0;Xd<ei.length&&!ft;){var Ba=ei[Xd],Lx=ei[Xd+1];for(Qt=Oo=0;Qt<Ba.length&&!ft&&Ba[Qt];)if(ft=Ba[Qt++].exec(Ln))for(Pc=0;Pc<Lx.length;Pc++)uo=ft[++Oo],typeof(xn=Lx[Pc])===h&&xn.length>0?2===xn.length?this[xn[0]]=typeof xn[1]==c?xn[1].call(this,uo):xn[1]:3===xn.length?this[xn[0]]=typeof xn[1]!==c||xn[1].exec&&xn[1].test?uo?uo.replace(xn[1],xn[2]):s:uo?xn[1].call(this,uo,xn[2]):s:4===xn.length&&(this[xn[0]]=uo?xn[3].call(this,uo.replace(xn[1],xn[2])):s):this[xn]=uo||s;Xd+=2}},vl=function(Ln,ei){for(var Qt in ei)if(typeof ei[Qt]===h&&ei[Qt].length>0){for(var Oo=0;Oo<ei[Qt].length;Oo++)if(Ue(ei[Qt][Oo],Ln))return"?"===Qt?s:Qt}else if(Ue(ei[Qt],Ln))return"?"===Qt?s:Qt;return Ln},ST={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},CT={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[T,[E,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[T,[E,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[E,T],[/opios[\/ ]+([\w\.]+)/i],[T,[E,ee+" Mini"]],[/\bopr\/([\w\.]+)/i],[T,[E,ee]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[E,T],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[T,[E,"UC"+J]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[T,[E,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[T,[E,"WeChat"]],[/konqueror\/([\w\.]+)/i],[T,[E,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[T,[E,"IE"]],[/yabrowser\/([\w\.]+)/i],[T,[E,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[E,/(.+)/,"$1 Secure "+J],T],[/\bfocus\/([\w\.]+)/i],[T,[E,ve+" Focus"]],[/\bopt\/([\w\.]+)/i],[T,[E,ee+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[T,[E,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[T,[E,"Dolphin"]],[/coast\/([\w\.]+)/i],[T,[E,ee+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[T,[E,"MIUI "+J]],[/fxios\/([-\w\.]+)/i],[T,[E,ve]],[/\bqihu|(qi?ho?o?|360)browser/i],[[E,"360 "+J]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[E,/(.+)/,"$1 "+J],T],[/(comodo_dragon)\/([\w\.]+)/i],[[E,/_/g," "],T],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[E,T],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[E],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[E,R],T],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[E,T],[/\bgsa\/([\w\.]+) .*safari\//i],[T,[E,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[T,[E,Ee+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[E,Ee+" WebView"],T],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[T,[E,"Android "+J]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[E,T],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[T,[E,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[T,E],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[E,[T,vl,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[E,T],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[E,"Netscape"],T],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[T,[E,ve+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[E,T],[/(cobalt)\/([\w\.]+)/i],[E,[T,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[O,"amd64"]],[/(ia32(?=;))/i],[[O,Yt]],[/((?:i[346]|x)86)[;\)]/i],[[O,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[O,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[O,"armhf"]],[/windows (ce|mobile); ppc;/i],[[O,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[O,/ower/,"",Yt]],[/(sun4\w)[;\)]/i],[[O,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[O,Yt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[_,[S,ae],[y,k]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[_,[S,ae],[y,w]],[/\((ip(?:hone|od)[\w ]*);/i],[_,[S,K],[y,w]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[_,[S,K],[y,k]],[/(macintosh);/i],[_,[S,K]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[_,[S,"Sharp"],[y,w]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[_,[S,"Huawei"],[y,k]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[_,[S,"Huawei"],[y,w]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[_,/_/g," "],[S,pt],[y,w]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[_,/_/g," "],[S,pt],[y,k]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[_,[S,"OPPO"],[y,w]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[_,[S,"Vivo"],[y,w]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[_,[S,"Realme"],[y,w]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[_,[S,bt],[y,w]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[_,[S,bt],[y,k]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[_,[S,"LG"],[y,k]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[_,[S,"LG"],[y,w]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[_,[S,"Lenovo"],[y,k]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[_,/_/g," "],[S,"Nokia"],[y,w]],[/(pixel c)\b/i],[_,[S,ze],[y,k]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[_,[S,ze],[y,w]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[_,[S,Le],[y,w]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[_,"Xperia Tablet"],[S,Le],[y,k]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[_,[S,"OnePlus"],[y,w]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[_,[S,re],[y,k]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[_,/(.+)/g,"Fire Phone $1"],[S,re],[y,w]],[/(playbook);[-\w\),; ]+(rim)/i],[_,S,[y,k]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[_,[S,X],[y,w]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[_,[S,$],[y,k]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[_,[S,$],[y,w]],[/(nexus 9)/i],[_,[S,"HTC"],[y,k]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[S,[_,/_/g," "],[y,w]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[_,[S,"Acer"],[y,k]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[_,[S,"Meizu"],[y,w]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[S,_,[y,w]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,_,[y,k]],[/(surface duo)/i],[_,[S,dt],[y,k]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[_,[S,"Fairphone"],[y,w]],[/(u304aa)/i],[_,[S,"AT&T"],[y,w]],[/\bsie-(\w*)/i],[_,[S,"Siemens"],[y,w]],[/\b(rct\w+) b/i],[_,[S,"RCA"],[y,k]],[/\b(venue[\d ]{2,7}) b/i],[_,[S,"Dell"],[y,k]],[/\b(q(?:mv|ta)\w+) b/i],[_,[S,"Verizon"],[y,k]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[_,[S,"Barnes & Noble"],[y,k]],[/\b(tm\d{3}\w+) b/i],[_,[S,"NuVision"],[y,k]],[/\b(k88) b/i],[_,[S,"ZTE"],[y,k]],[/\b(nx\d{3}j) b/i],[_,[S,"ZTE"],[y,w]],[/\b(gen\d{3}) b.+49h/i],[_,[S,"Swiss"],[y,w]],[/\b(zur\d{3}) b/i],[_,[S,"Swiss"],[y,k]],[/\b((zeki)?tb.*\b) b/i],[_,[S,"Zeki"],[y,k]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],_,[y,k]],[/\b(ns-?\w{0,9}) b/i],[_,[S,"Insignia"],[y,k]],[/\b((nxa|next)-?\w{0,9}) b/i],[_,[S,"NextBook"],[y,k]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],_,[y,w]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],_,[y,w]],[/\b(ph-1) /i],[_,[S,"Essential"],[y,w]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[_,[S,"Envizen"],[y,k]],[/\b(trio[-\w\. ]+) b/i],[_,[S,"MachSpeed"],[y,k]],[/\btu_(1491) b/i],[_,[S,"Rotor"],[y,k]],[/(shield[\w ]+) b/i],[_,[S,"Nvidia"],[y,k]],[/(sprint) (\w+)/i],[S,_,[y,w]],[/(kin\.[onetw]{3})/i],[[_,/\./g," "],[S,dt],[y,w]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[_,[S,le],[y,k]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[_,[S,le],[y,w]],[/smart-tv.+(samsung)/i],[S,[y,V]],[/hbbtv.+maple;(\d+)/i],[[_,/^/,"SmartTV"],[S,ae],[y,V]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,"LG"],[y,V]],[/(apple) ?tv/i],[S,[_,K+" TV"],[y,V]],[/crkey/i],[[_,Ee+"cast"],[S,ze],[y,V]],[/droid.+aft(\w)( bui|\))/i],[_,[S,re],[y,V]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[_,[S,"Sharp"],[y,V]],[/(bravia[\w ]+)( bui|\))/i],[_,[S,Le],[y,V]],[/(mitv-\w{5}) bui/i],[_,[S,pt],[y,V]],[/Hbbtv.*(technisat) (.*);/i],[S,_,[y,V]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[S,Gi],[_,Gi],[y,V]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[y,V]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,_,[y,N]],[/droid.+; (shield) bui/i],[_,[S,"Nvidia"],[y,N]],[/(playstation [345portablevi]+)/i],[_,[S,Le],[y,N]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[_,[S,dt],[y,N]],[/((pebble))app/i],[S,_,[y,U]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[_,[S,K],[y,U]],[/droid.+; (glass) \d/i],[_,[S,ze],[y,U]],[/droid.+; (wt63?0{2,3})\)/i],[_,[S,le],[y,U]],[/(quest( 2| pro)?)/i],[_,[S,R],[y,U]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[y,Y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[_,[y,w]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[_,[y,k]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[y,k]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[y,w]],[/(android[-\w\. ]{0,9});.+buil/i],[_,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[T,[E,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[T,[E,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[E,T],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[T,E]],os:[[/microsoft (windows) (vista|xp)/i],[E,T],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[E,[T,vl,ST]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[E,"Windows"],[T,vl,ST]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[T,/_/g,"."],[E,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[E,H],[T,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[T,E],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[E,T],[/\(bb(10);/i],[T,[E,X]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[T,[E,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[T,[E,ve+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[T,[E,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[T,[E,"watchOS"]],[/crkey\/([\d\.]+)/i],[T,[E,Ee+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[E,F],T],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[E,T],[/(sunos) ?([\w\.\d]*)/i],[[E,"Solaris"],T],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[E,T]]},Cs=function(Ln,ei){if(typeof Ln===h&&(ei=Ln,Ln=s),!(this instanceof Cs))return new Cs(Ln,ei).getResult();var Qt=typeof i!==d&&i.navigator?i.navigator:s,Oo=Ln||(Qt&&Qt.userAgent?Qt.userAgent:""),Pc=Qt&&Qt.userAgentData?Qt.userAgentData:s,xn=ei?function(ft,uo){var Xd={};for(var Ba in ft)Xd[Ba]=uo[Ba]&&uo[Ba].length%2==0?uo[Ba].concat(ft[Ba]):ft[Ba];return Xd}(CT,ei):CT;return this.getBrowser=function(){var uo,ft={};return ft[E]=s,ft[T]=s,Do.call(ft,Oo,xn.browser),ft[m]=typeof(uo=ft[T])===p?uo.replace(/[^\d\.]/g,"").split(".")[0]:s,Qt&&Qt.brave&&typeof Qt.brave.isBrave==c&&(ft[E]="Brave"),ft},this.getCPU=function(){var ft={};return ft[O]=s,Do.call(ft,Oo,xn.cpu),ft},this.getDevice=function(){var ft={};return ft[S]=s,ft[_]=s,ft[y]=s,Do.call(ft,Oo,xn.device),!ft[y]&&Pc&&Pc.mobile&&(ft[y]=w),"Macintosh"==ft[_]&&Qt&&typeof Qt.standalone!==d&&Qt.maxTouchPoints&&Qt.maxTouchPoints>2&&(ft[_]="iPad",ft[y]=k),ft},this.getEngine=function(){var ft={};return ft[E]=s,ft[T]=s,Do.call(ft,Oo,xn.engine),ft},this.getOS=function(){var ft={};return ft[E]=s,ft[T]=s,Do.call(ft,Oo,xn.os),!ft[E]&&Pc&&"Unknown"!=Pc.platform&&(ft[E]=Pc.platform.replace(/chrome os/i,F).replace(/macos/i,H)),ft},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Oo},this.setUA=function(ft){return Oo=typeof ft===p&&ft.length>350?Gi(ft,350):ft,this},this.setUA(Oo),this};Cs.VERSION="0.7.34",Cs.BROWSER=oe([E,T,m]),Cs.CPU=oe([O]),Cs.DEVICE=oe([_,S,y,N,w,V,k,U,Y]),Cs.ENGINE=Cs.OS=oe([E,T]),o.exports&&(n=o.exports=Cs),n.UAParser=Cs;var $d=typeof i!==d&&(i.jQuery||i.Zepto);if($d&&!$d.ua){var bm=new Cs;$d.ua=bm.getResult(),$d.ua.get=function(){return bm.getUA()},$d.ua.set=function(Ln){bm.setUA(Ln);var ei=bm.getResult();for(var Qt in ei)$d.ua[Qt]=ei[Qt]}}}("object"==typeof window?window:ou)}(Rg,Rg.exports);const wg=new(hr(Rg.exports));let Ca=wg.getResult(),Ag=null;function Et(o){if(!Ag){o&&wg.setUA(o),Ca=wg.getResult();const n=function(d){if("Blink"===d.engine.name&&"WeChat"!==d.browser.name)return gt.CHROME;switch(d.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return gt.CHROME;case"Safari":case"Mobile Safari":return gt.SAFARI;case"Edge":return gt.EDGE;case"Firefox":return gt.FIREFOX;case"QQBrowser":return gt.QQ;case"Opera":return gt.OPERA;case"WeChat":return gt.WECHAT;default:return d.browser.name||""}}(Ca),i=function(d){let h;return h="Blink"===d.engine.name?d.engine.version||"":d.browser.version||"",h.split(".")[0]}(Ca),s="Windows"===(d=Ca).os.name?d.os.version?d.os.name+" "+d.os.version:d.os.name:d.os.name||"",c=Ca.os.version;if(!(n&&i&&s&&c))return{name:n,version:i,os:s,osVersion:c};Ag={name:n,version:i,os:s,osVersion:c}}var d;return Ag}function Dg(){return Et().os}function Uw(){const o=Et();return"".concat(o.os," ").concat(o.osVersion)}function Og(){const o=Et();return!!("WebKit"===Ca.engine.name&&o.os===ii.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&o.name!==gt.SAFARI||ir()&&o.name!==gt.SAFARI)}function XS(){return Et().name===gt.CHROME}function nr(){return Et().name===gt.SAFARI}function zt(){return Et().name===gt.FIREFOX}function ir(){return Et().os===ii.IOS}function JS(o){const n=Et();return!(n.name!==gt.CHROME||!n.osVersion)&&Number(n.version)>=o}function Vw(o){const n=Et();return!(n.name!==gt.EDGE||!n.osVersion)&&Number(n.version)>=o}function Bw(o){const n=Et();return!(n.name!==gt.OPERA||!n.osVersion)&&Number(n.version)>=o}function jw(){const o=Et();return!(o.name!==gt.CHROME||!o.osVersion)&&Number(o.version)<=90}function Hw(){const o=Et();if(o.os!==ii.IOS||!o.osVersion)return!1;const n=o.osVersion.split(".");return Number(n[0])<14||14===Number(n[0])&&Number(n[1])<=6}function qu(){const o=Et();if(o.os!==ii.IOS||!o.osVersion)return!1;const n=o.osVersion.split(".");return 15===Number(n[0])}function QS(){const o=Et();if(o.os!==ii.IOS||!o.osVersion)return!1;const n=o.osVersion.split(".");return 16===Number(n[0])}function Gw(){const o=Et();if(o.os!==ii.IOS||!o.osVersion)return!1;const n=o.osVersion.split(".");return 15===Number(n[0])&&Number(n[1])>=1}function Gs(){return nr()&&navigator.maxTouchPoints>0}function ZS(){return Et().name===gt.WECHAT}function eC(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function pc(){const o=Et();return o.name!==gt.EDGE&&o.name!==gt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function sf(){return Dg()===ii.ANDROID}function Yu(){const o=Et();return sf()&&(o.name===gt.CHROME||o.name===gt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}var M;!function(o){o.UNEXPECTED_ERROR="UNEXPECTED_ERROR",o.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",o.TIMEOUT="TIMEOUT",o.INVALID_PARAMS="INVALID_PARAMS",o.NOT_READABLE="NOT_READABLE",o.NOT_SUPPORTED="NOT_SUPPORTED",o.INVALID_OPERATION="INVALID_OPERATION",o.OPERATION_ABORTED="OPERATION_ABORTED",o.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",o.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",o.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",o.DATACHANNEL_FAILED="DATACHANNEL_FAILED",o.NETWORK_ERROR="NETWORK_ERROR",o.NETWORK_TIMEOUT="NETWORK_TIMEOUT",o.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",o.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",o.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",o.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",o.ELECTRON_IS_NULL="ELECTRON_IS_NULL",o.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",o.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",o.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",o.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",o.PERMISSION_DENIED="PERMISSION_DENIED",o.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",o.TRACK_IS_DISABLED="TRACK_IS_DISABLED",o.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",o.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",o.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",o.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",o.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",o.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",o.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",o.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",o.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",o.UID_CONFLICT="UID_CONFLICT",o.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",o.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",o.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",o.INVALID_TRACK="INVALID_TRACK",o.SENDER_NOT_FOUND="SENDER_NOT_FOUND",o.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",o.SET_ANSWER_FAILED="SET_ANSWER_FAILED",o.ICE_FAILED="ICE_FAILED",o.PC_CLOSED="PC_CLOSED",o.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",o.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",o.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",o.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",o.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",o.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",o.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",o.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",o.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",o.INVALID_REMOTE_USER="INVALID_REMOTE_USER",o.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",o.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",o.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",o.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",o.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",o.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",o.WS_ABORT="WS_ABORT",o.WS_DISCONNECT="WS_DISCONNECT",o.WS_ERR="WS_ERR",o.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",o.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",o.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",o.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",o.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",o.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",o.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",o.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",o.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",o.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",o.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",o.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",o.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",o.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",o.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",o.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",o.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",o.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",o.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",o.INVALID_PLUGIN="INVALID_PLUGIN",o.DISCONNECT_P2P="DISCONNECT_P2P",o.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",o.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",o.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",o.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",o.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",o.PROHIBITED_OPERATION="PROHIBITED_OPERATION",o.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"}(M||(M={}));let Q=class extends Error{constructor(o){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(n),C(this,"code",void 0),C(this,"message",void 0),C(this,"data",void 0),C(this,"name","AgoraRTCException"),this.code=o,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=i}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",n=arguments.length>1?arguments[1]:void 0;return"error"===o&&(n||console).error(this.toString()),"warning"===o&&(n||console).warn(this.toString()),this}throw(o){throw this.print("error",o),this}};function Zc(o,n){if("boolean"!=typeof o)throw new Q(M.INVALID_PARAMS,"Invalid ".concat(n,": The value is of the boolean type."))}function Vn(o,n,i){if(!be(i).call(i,o))throw new Q(M.INVALID_PARAMS,"".concat(n," can only be set as ").concat(JSON.stringify(i)))}function At(o,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(o<i||o>s||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&("number"!=typeof(c=o)||c%1!=0))throw new Q(M.INVALID_PARAMS,"invalid ".concat(n,": the value range is [").concat(i,", ").concat(s,"]. integer only"));var c}function fc(o,n){if("number"!=typeof o){if(!(o.min||o.max||o.ideal||o.exact))throw new Q(M.INVALID_PARAMS,"".concat(n," is not a valid ConstrainLong"));void 0!==o.min&&At(o.min,"".concat(n,".min"),0,1/0),void 0!==o.max&&At(o.max,"".concat(n,".max"),1,1/0),void 0!==o.exact&&At(o.exact,"".concat(n,".exact"),1,1/0),void 0!==o.ideal&&At(o.ideal,"".concat(n,".ideal"),1,1/0)}else At(o,n,1,1/0)}function bi(o,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==o)throw new Q(M.INVALID_PARAMS,"".concat(n||"param"," cannot be empty"));if(!Jk(o,i,s,c))throw new Q(M.INVALID_PARAMS,"Invalid ".concat(n||"string param",": Length of the string: [").concat(i,",").concat(s,"].").concat(c?" ASCII characters only.":""))}function mc(o,n){if(!Array.isArray(o))throw new Q(M.INVALID_PARAMS,"".concat(n," should be an array"))}function Bt(o){return null==o}function Jk(o){return"string"==typeof o&&o.length<=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:255)&&o.length>=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)&&(!(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])||function(c){if("string"!=typeof c)return!1;for(let d=0;d<c.length;d+=1){const h=c.charCodeAt(d);if(h<0||h>255)return!1}return!0}(o))}function kr(o,n,i){if("getBigUint64"in DataView.prototype)return o.getBigUint64(n,i);const s=o.getUint32(n,i),c=o.getUint32(n+4,i),d=Number(!!i),h=Number(!i);return BigInt(s*h+c*d)<<BigInt(32)|BigInt(s*d+c*h)}function Qk(o,n,i,s){if("setBigUint64"in DataView.prototype)return o.setBigUint64(n,i,s);const c=Number(i>>BigInt(32)),d=Number(i&BigInt(4294967295));s?(o.setUint32(n+4,c,s),o.setUint32(n,d,s)):(o.setUint32(n,c,s),o.setUint32(n+4,d,s))}var ud,af;(function(o){o.COVERED="COVERED",o.POSITION="POSITION",o.SIZE="SIZE",o.STYLE="STYLE"})(ud||(ud={})),function(o){o.UNMOUNTED="UNMOUNTED",o.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(af||(af={}));const Zk=new class{constructor(){C(this,"_clientSize",null),C(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),C(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),C(this,"getStyle",o=>window.getComputedStyle(o,null)),C(this,"checkCssVisibleProperty",o=>{var n;let i=!0;const s=this.getStyle(o),{display:c,visibility:d,opacity:h,filter:p}=s;return("none"===c||be(n=["hidden","collapse"]).call(n,d)||Number(h)<.1)&&(i=!1),!!i&&(p&&p.split(" ").filter(m=>{var _;const E=m.split("(")[0];return be(_=["brightness","blur","opacity"]).call(_,E)}).map(m=>{const[_,E]=m.split(/\(|\)/);return[_,Number(E.match(/^[0-9\.]+/))]}).forEach(m=>{const[_,E]=m;switch(_){case"brightness":(E<.1||E>3)&&(i=!1);break;case"blur":E>3&&(i=!1);break;case"opacity":E<.1&&(i=!1)}}),i)}),C(this,"checkPropertyUpToAllParentNodes",(o,n)=>{let i=!0,s=!0;let d=o;for(;d&&s;)n(d)||(i=!1,s=!1),d=d.parentElement,d||(s=!1);return i}),C(this,"checkActualCssVisibleIncludeInherit",o=>this.checkPropertyUpToAllParentNodes(o,this.checkCssVisibleProperty)),C(this,"getSizeAboutClient",o=>{const{width:n,height:i,left:s,right:c,top:d,bottom:h}=o.getBoundingClientRect(),p=this.getClientWidth(),m=this.getClientHeight();return{width:n,height:i,left:s,right:c,top:d,bottom:h,clientWidth:p,clientHeight:m,clientMin:Math.min(p,m)}}),C(this,"checkActualSize",()=>{const{width:o,height:n,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(o,n,i)}),C(this,"elementFromPoint",(o,n)=>document.elementFromPoint?document.elementFromPoint(o,n):null),C(this,"checkCoverForAPoint",(o,n,i)=>{const s=this.elementFromPoint(o,n);return null!==s&&s!==i}),C(this,"getPointPositionList",()=>{const{width:o,height:n,left:i,top:s}=this._clientSize,c=o/6,d=n/6,h=[],p=10**6;for(let m=0;m<5;m++)for(let _=0;_<5;_++)h.push({x:(i*p+(0===m?.1:4===m?(c*m*p-1e5)/p:c*m)*p)/p,y:(s*p+(0===_?.1:4===_?(d*_*p-1e5)/p:d*_)*p)/p});return[...h]}),C(this,"checkElementCover",o=>this.getPointPositionList().map(n=>this.checkCoverForAPoint(n.x,n.y,o)).filter(n=>!!n).length>6),C(this,"checkSizeIsVisible",(o,n,i)=>(o>50||i/o<=10)&&(n>50||i/n<=10)),C(this,"checkSizeOfPartInClient",()=>{const{left:o,right:n,top:i,bottom:s,clientHeight:c,clientWidth:d,clientMin:h}=this._clientSize;let p,m,_,E;if(o<0)p=0;else{if(!(o<d))return!1;p=o}if(n<0)return!1;if(m=n<d?n:d,i<0)_=0;else{if(!(i<c))return!1;_=i}return!(s<0)&&(E=s<c?s:c,this.checkSizeIsVisible(m-p,E-_,h))}),C(this,"returnHiddenResult",o=>(this._clientSize=null,{visible:!1,reason:o})),C(this,"checkOneElementVisible",o=>{if(o instanceof HTMLElement){if(this.checkElementIsMountedOnDom(o)){if(this.checkActualCssVisibleIncludeInherit(o)){if(this._clientSize=this.getSizeAboutClient(o),this.checkElementCover(o))return this.returnHiddenResult(ud.COVERED);{const n=this.checkActualSize(),i=this.checkSizeOfPartInClient();return n&&!i?this.returnHiddenResult(ud.POSITION):n?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(ud.SIZE)}}return this.returnHiddenResult(ud.STYLE)}return this.returnHiddenResult(af.UNMOUNTED)}return this.returnHiddenResult(af.INVALID_HTML_ELEMENT)}),C(this,"checkElementIsMountedOnDom",o=>this.checkPropertyUpToAllParentNodes(o,n=>"HTML"!==n.nodeName.toUpperCase()?null!==n.parentElement:!!document.documentElement))}};function Pe(o){return(new TextEncoder).encode(o)}const Ww=function(o,n){const i=new Uint8Array(o.byteLength+n.byteLength);return i.set(new Uint8Array(o),0),i.set(new Uint8Array(n),o.byteLength),i},e1=function(){var o=x(function*(n){const i=function(h){const p=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),m=new Uint8Array(new ArrayBuffer(p.length));for(let _=0;_<p.length;_+=1)m[_]=p.charCodeAt(_);return m}(),s=yield window.crypto.subtle.importKey("spki",i,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),c=Pe(n),d=yield window.crypto.subtle.encrypt({name:"RSA-OAEP"},s,c);return function(h){let p="";for(let m=0;m<h.length;m+=1)p+=String.fromCharCode(h[m]);return window.btoa(p)}(new Uint8Array(d))});return function(i){return o.apply(this,arguments)}}(),t1=function(){var o=x(function*(n){return function(i,s){let c="";return new Uint8Array(i).forEach(d=>{c+=d.toString(16).padStart(2,"0")}),c}(yield crypto.subtle.digest("SHA-256",Pe(n)))});return function(i){return o.apply(this,arguments)}}();class kt{constructor(){C(this,"_events",{}),C(this,"addListener",this.on)}getListeners(n){return this._events[n]?this._events[n].map(i=>i.listener):[]}on(n,i){this._events[n]||(this._events[n]=[]);const s=this._events[n];-1===this._indexOfListener(s,i)&&s.push({listener:i,once:!1})}once(n,i){this._events[n]||(this._events[n]=[]);const s=this._events[n];-1===this._indexOfListener(s,i)&&s.push({listener:i,once:!0})}off(n,i){if(!this._events[n])return;const s=this._events[n],c=this._indexOfListener(s,i);-1!==c&&s.splice(c,1),0===this._events[n].length&&delete this._events[n]}removeAllListeners(n){n?delete this._events[n]:this._events={}}emit(n){this._events[n]||(this._events[n]=[]);const i=this._events[n].map(h=>h);for(var s=arguments.length,c=new Array(s>1?s-1:0),d=1;d<s;d++)c[d-1]=arguments[d];for(let h=0;h<i.length;h+=1){const p=i[h];p.once&&this.off(n,p.listener),p.listener.apply(this,c||[])}}safeEmit(n){for(var i=arguments.length,s=new Array(i>1?i-1:0),c=1;c<i;c++)s[c-1]=arguments[c];[...this._events[n]||[]].forEach(d=>{d.once&&this.off(n,d.listener);try{d.listener.apply(this,s)}catch(h){console.error("safeEmit event:".concat(n," error ").concat(h?.toString()))}})}_indexOfListener(n,i){let s=n.length;for(;s--;)if(n[s].listener===i)return s;return-1}}let cf=null;function lf(){if(cf)return cf;if(window.electron)return cf=window.electron;if(!window.require)return null;try{return cf=window.require("electron"),cf}catch{return null}}var Rn,Je,zw,Ke,qe,ri,xi,ba;function tC(o){return At(o.timeout,"config.timeout",0,1e5),At(o.timeoutFactor,"config.timeoutFactor",0,100,!1),At(o.maxRetryCount,"config.maxRetryConfig",0,1/0),At(o.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function hd(o){if(!Array.isArray(o)||o.length<1)return!1;try{o.forEach(n=>{if(!n.urls)throw Error()})}catch{return!1}return!0}function Kw(o){return bi(o.turnServerURL,"turnServerURL"),bi(o.username,"username"),bi(o.password,"password"),o.udpport&&At(o.udpport,"udpport",1,99999,!0),o.forceturn&&Zc(o.forceturn,"forceturn"),o.security&&Zc(o.security,"security"),o.tcpport&&At(o.tcpport,"tcpport",1,99999,!0),!0}function qw(o){return void 0!==o.level&&Vn(o.level,"level",[1,2,3]),void 0!==o.delay&&At(o.delay,"delay",0,3e3,!0),!0}function dn(o,n){for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return 0===o.getListeners(n).length?z.reject(new Q(M.UNEXPECTED_ERROR,"can not emit promise")):new z((d,h)=>{o.emit(n,...s,d,h)})}function St(o,n){if(0===o.getListeners(n).length)return z.resolve();for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return dn(o,n,...s)}function to(o,n){if(0===o.getListeners(n).length)return null;for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return _c(o,n,...s)}function _c(o,n){let i=null,s=null;for(var c=arguments.length,d=new Array(c>2?c-2:0),h=2;h<c;h++)d[h-2]=arguments[h];if(o.emit(n,...d,p=>{i=p},p=>{s=p}),null!==s)throw s;if(null===i)throw new Q(M.UNEXPECTED_ERROR,"handler is not sync");return i}(function(o){o.CREATE_CLIENT="createClient",o.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",o.SET_AREA="setArea",o.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",o.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",o.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",o.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",o.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",o.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",o.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",o.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",o.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",o.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",o.START_PROXY_SERVER="Client.startProxyServer",o.STOP_PROXY_SERVER="Client.stopProxyServer",o.SET_PROXY_SERVER="Client.setProxyServer",o.SET_TURN_SERVER="Client.setTurnServer",o.SET_CLIENT_ROLE="Client.setClientRole",o.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",o.ENABLE_DUAL_STREAM="Client.enableDualStream",o.DISABLE_DUAL_STREAM="Client.disableDualStream",o.JOIN="Client.join",o.LEAVE="Client.leave",o.PUBLISH="Client.publish",o.UNPUBLISH="Client.unpublish",o.SUBSCRIBE="Client.subscribe",o.MASS_SUBSCRIBE="Client.massSubscribe",o.MASS_UNSUBSCRIBE="Client.massUnsubscribe",o.UNSUBSCRIBE="Client.unsubscribe",o.RENEW_TOKEN="Client.renewToken",o.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",o.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",o.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",o.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",o.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",o.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",o.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",o.DATACHANNEL_FAILBACK="Client._datachannelFailback",o.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",o.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",o.START_LIVE_STREAMING="Client.startLiveStreaming",o.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",o.STOP_LIVE_STREAMING="Client.stopLiveStreaming",o.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",o.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",o.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",o.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",o.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",o.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",o.SET_CONFIG_DISTRIBUTE="_configDistribute",o.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",o.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",o.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",o.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",o.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",o.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",o.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",o.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",o.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",o.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",o.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",o.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",o.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",o.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",o.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",o.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",o.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",o.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",o.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",o.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",o.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",o.STREAM_TYPE_CHANGE="streamTypeChange",o.CONNECTION_STATE_CHANGE="connectionStateChange",o.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",o.IMAGE_MODERATION_UPLOAD="imageModerationUpload"})(Rn||(Rn={})),function(o){o.TRACER="tracer"}(Je||(Je={})),function(o){o[o.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",o[o.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",o[o.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(zw||(zw={})),function(o){o.LEAVE="LEAVE",o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.UID_BANNED="UID_BANNED",o.IP_BANNED="IP_BANNED",o.CHANNEL_BANNED="CHANNEL_BANNED",o.FALLBACK="FALLBACK",o.LICENSE_MISSING="LICENSE_MISSING",o.LICENSE_EXPIRED="LICENSE_EXPIRED",o.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",o.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",o.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",o.LICENSE_ILLEGAL="LICENSE_ILLEGAL",o.TOKEN_EXPIRE="TOKEN_EXPIRE"}(Ke||(Ke={})),function(o){o.CONNECTION_STATE_CHANGE="connection-state-change",o.MEDIA_RECONNECT_START="media-reconnect-start",o.MEDIA_RECONNECT_END="media-reconnect-end",o.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",o.USER_JOINED="user-joined",o.USER_LEAVED="user-left",o.USER_PUBLISHED="user-published",o.USER_UNPUBLISHED="user-unpublished",o.USER_INFO_UPDATED="user-info-updated",o.CLIENT_BANNED="client-banned",o.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",o.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",o.VOLUME_INDICATOR="volume-indicator",o.CRYPT_ERROR="crypt-error",o.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",o.NETWORK_QUALITY="network-quality",o.STREAM_TYPE_CHANGED="stream-type-changed",o.STREAM_FALLBACK="stream-fallback",o.RECEIVE_METADATA="receive-metadata",o.STREAM_MESSAGE="stream-message",o.LIVE_STREAMING_ERROR="live-streaming-error",o.LIVE_STREAMING_WARNING="live-streaming-warning",o.INJECT_STREAM_STATUS="stream-inject-status",o.EXCEPTION="exception",o.ERROR="error",o.P2P_LOST="p2p_lost",o.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",o.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",o.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",o.PUBLISHED_USER_LIST="published-user-list",o.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",o.CONTENT_INSPECT_ERROR="content-inspect-error",o.CONTENT_INSPECT_RESULT="content-inspect-result",o.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(qe||(qe={})),function(o){o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.MULTI_IP="MULTI_IP",o.TIMEOUT="TIMEOUT",o.OFFLINE="OFFLINE",o.LEAVE="LEAVE",o.P2P_FAILED="P2P_FAILED",o.FALLBACK="FALLBACK"}(ri||(ri={})),function(o){o.ONLINE="ONLINE",o.OFFLINE="OFFLINE"}(xi||(xi={})),function(o){o.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",o.ONLINE="ONLINE",o.OFFLINE="OFFLINE"}(ba||(ba={}));const Bn=new class extends kt{set networkState(o){this.emit(ba.NETWORK_STATE_CHANGE,o,this._networkState),o===xi.ONLINE?this.emit(ba.ONLINE):o===xi.OFFLINE&&(this.onlineWaiter=new z(n=>{this.once(ba.ONLINE,()=>{this.onlineWaiter=void 0,n(xi.ONLINE)})}),this.emit(ba.OFFLINE)),this._networkState=o}get networkState(){return this._networkState}get isOnline(){return this._networkState===xi.ONLINE}constructor(){super(),C(this,"_moduleName","network-indicator"),C(this,"_networkState",xi.ONLINE),C(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=xi.ONLINE}),window.addEventListener("offline",()=>{this.networkState=xi.OFFLINE})}};function df(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function el(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?df(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):df(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function Ng(o,n){const i=o.indexOf(n);-1!==i&&o.splice(i,1)}function pd(o){const n=[];return o.forEach(i=>{-1===n.indexOf(i)&&n.push(i)}),n}function ms(o){void 0!==z?z.resolve().then(o):setTimeout(o,0)}function mn(o){return JSON.parse(JSON.stringify(o))}function Ws(o){try{return mn(o)}catch{return o}}const Yw={};function uf(o,n){Yw[n]||(Yw[n]=!0,o())}function Pg(o){const n=window.atob(o),i=new Uint8Array(new ArrayBuffer(n.length));for(let s=0;s<n.length;s+=1)i[s]=n.charCodeAt(s);return i}function hf(o){let n="";for(let i=0;i<o.length;i+=1)n+=String.fromCharCode(o[i]);return window.btoa(n)}function zs(o){return window.TextEncoder?(new TextEncoder).encode(o).length:o.length}function nC(o){let n=0;return/DingTalk/i.test(navigator.userAgent)&&o.realFormData&&(o=o.realFormData),o.forEach(i=>{n+="string"==typeof i?zs(i):i.size}),n+138}function n1(o){const n=new Q(M.TIMEOUT,"timeout");return new z((i,s)=>{window.setTimeout(()=>s(n),o)})}function ui(o){return new z(n=>{window.setTimeout(n,o)})}function Ot(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,n=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,o).toLowerCase();return i.length===o?"".concat(n).concat(i):"".concat(n).concat(i)+Ot(o-i.length,"")}function iC(){return Ot(32,"").toUpperCase()}const rC=()=>{},r1=new class{constructor(){C(this,"fnMap",new Map)}throttleByKey(o,n,i,s){for(var c=arguments.length,d=new Array(c>4?c-4:0),h=4;h<c;h++)d[h-4]=arguments[h];if(this.fnMap.has(n)){const p=this.fnMap.get(n);if(p.threshold!==i){p.fn(...p.args),clearTimeout(p.timer);const m=window.setTimeout(()=>{const _=this.fnMap.get(n);_&&_.fn(..._.args),this.fnMap.delete(n)},i);this.fnMap.set(n,{fn:o,threshold:i,timer:m,args:d,skipFn:s})}else p.skipFn&&p.skipFn(...p.args),this.fnMap.set(n,el(el({},p),{},{fn:o,args:d,skipFn:s}))}else{const p=window.setTimeout(()=>{const m=this.fnMap.get(n);m&&m.fn(...m.args),this.fnMap.delete(n)},i);this.fnMap.set(n,{fn:o,threshold:i,timer:p,args:d,skipFn:s})}}},o1=r1.throttleByKey.bind(r1);function s1(o){return"object"==typeof o&&null!==o&&!(o instanceof RegExp)}function Mg(o,n){if(!s1(o)||!s1(n)||Array.isArray(o)&&!Array.isArray(n)||!Array.isArray(o)&&Array.isArray(n))return n;if(Array.isArray(n)&&Array.isArray(o)){const i=[...o];for(let s=0;s<n.length;s++)i[s]=Mg(o[s],n[s]);return i}{const i=el({},o);for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(i[s]=Object.prototype.hasOwnProperty.call(o,s)?Mg(o[s],n[s]):n[s]);return i}}let kg=1,Lg=console;class li{static setLogger(n){Lg=n}constructor(n){C(this,"lockingPromise",z.resolve()),C(this,"locks",0),C(this,"name",""),C(this,"lockId",void 0),this.lockId=kg++,n&&(this.name=n),Lg.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(n){let i;this.locks+=1,Lg.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof n?n:""));const s=new z(d=>{i=()=>{this.locks-=1,Lg.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof n?n:"")),d()}}),c=this.lockingPromise.then(()=>i);return this.lockingPromise=this.lockingPromise.then(()=>s),c}}function fd(o,n){return function(i,s,c){const d=c.value;if("function"!=typeof d)throw new Error("Cannot use mutex on object property.");return c.value=x(function*(){const h=this[n];if(!h)throw new Error("mutex property key ".concat(n," doesn't exist on ").concat(o));const p=yield h.lock("From ".concat(o,".").concat(s));try{for(var m=arguments.length,_=new Array(m),E=0;E<m;E++)_[E]=arguments[E];return yield d.apply(this,_)}finally{p()}}),c}}const _n={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function xg(o,n){const i=Math.floor(n.timeout*Math.pow(n.timeoutFactor,o));return Math.min(n.maxRetryTimeout,i)}function Ks(o,n,i,s){const c=Object.assign({},_n,s);let d=c.timeout;const h=function(){var _=x(function*(){var E;yield(E=d,new z(y=>{window.setTimeout(y,E)})),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)});return function(){return _.apply(this,arguments)}}();let p=!1;const m=new z(function(){var _=x(function*(E,y){n=n||(()=>!1),i=i||(()=>!0);for(let S=0;S<c.maxRetryCount;S+=1){if(p)return y(new Q(M.OPERATION_ABORTED));try{const T=yield o();if(!n(T,S)||S+1===c.maxRetryCount)return E(T);yield h()}catch(T){if(!i(T,S)||S+1===c.maxRetryCount)return y(T);yield h()}}});return function(E,y){return _.apply(this,arguments)}}());return m.cancel=()=>p=!0,m}var a1=as,c1=Tn,l1=zr,$w=fe,d1=TypeError,Xw=function(o){return function(n,i,s,c){a1(i);var d=c1(n),h=l1(d),p=$w(d),m=o?p-1:0,_=o?-1:1;if(s<2)for(;;){if(m in h){c=h[m],m+=_;break}if(m+=_,o?m<0:p<=m)throw d1("Reduce of empty array with no initial value")}for(;o?m>=0:p>m;m+=_)m in h&&(c=i(c,h[m],m,d));return c}},pf=[Xw(!1),Xw(!0)][0];Wt({target:"Array",proto:!0,forced:!od&&fo>79&&fo<83||!SR("reduce")},{reduce:function(o){var n=arguments.length;return pf(this,o,n,n>1?arguments[1]:void 0)}});var u1=$a("Array").reduce,Jw=Is,h1=u1,Fg=Array.prototype,md=hr(function(o){var n=o.reduce;return o===Fg||Jw(Fg,o)&&n===Fg.reduce?h1:n});let Ug=class{constructor(o){C(this,"input",[]),C(this,"size",void 0),this.size=o}add(o){this.input.push(o),this.input.length>this.size&&this.input.splice(0,1)}mean(){var o;return 0===this.input.length?0:md(o=this.input).call(o,(n,i)=>n+i)/this.input.length}};var oC,ff={exports:{}},Qw=function(o,n){return function(){for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];return o.apply(n,i)}},Zw=Qw,Vg=Object.prototype.toString,sC=(oC=Object.create(null),function(o){var n=Vg.call(o);return oC[n]||(oC[n]=n.slice(8,-1).toLowerCase())});function _d(o){return o=o.toLowerCase(),function(n){return sC(n)===o}}function aC(o){return Array.isArray(o)}function $u(o){return void 0===o}var eA=_d("ArrayBuffer");function cC(o){return null!==o&&"object"==typeof o}function Bg(o){if("object"!==sC(o))return!1;var n=Object.getPrototypeOf(o);return null===n||n===Object.prototype}var p1=_d("Date"),f1=_d("File"),m1=_d("Blob"),_1=_d("FileList");function lC(o){return"[object Function]"===Vg.call(o)}var g1=_d("URLSearchParams");function dC(o,n){if(null!=o)if("object"!=typeof o&&(o=[o]),aC(o))for(var i=0,s=o.length;i<s;i++)n.call(null,o[i],i,o);else for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&n.call(null,o[c],c,o)}var jg,tA=(jg=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(o){return jg&&o instanceof jg}),fr={isArray:aC,isArrayBuffer:eA,isBuffer:function(o){return null!==o&&!$u(o)&&null!==o.constructor&&!$u(o.constructor)&&"function"==typeof o.constructor.isBuffer&&o.constructor.isBuffer(o)},isFormData:function(o){var n="[object FormData]";return o&&("function"==typeof FormData&&o instanceof FormData||Vg.call(o)===n||lC(o.toString)&&o.toString()===n)},isArrayBufferView:function(o){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(o):o&&o.buffer&&eA(o.buffer)},isString:function(o){return"string"==typeof o},isNumber:function(o){return"number"==typeof o},isObject:cC,isPlainObject:Bg,isUndefined:$u,isDate:p1,isFile:f1,isBlob:m1,isFunction:lC,isStream:function(o){return cC(o)&&lC(o.pipe)},isURLSearchParams:g1,isStandardBrowserEnv:function(){return(typeof navigator>"u"||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&typeof window<"u"&&typeof document<"u"},forEach:dC,merge:function o(){var n={};function i(d,h){n[h]=Bg(n[h])&&Bg(d)?o(n[h],d):Bg(d)?o({},d):aC(d)?d.slice():d}for(var s=0,c=arguments.length;s<c;s++)dC(arguments[s],i);return n},extend:function(o,n,i){return dC(n,function(s,c){o[c]=i&&"function"==typeof s?Zw(s,i):s}),o},trim:function(o){return o.trim?o.trim():o.replace(/^\s+|\s+$/g,"")},stripBOM:function(o){return 65279===o.charCodeAt(0)&&(o=o.slice(1)),o},inherits:function(o,n,i,s){o.prototype=Object.create(n.prototype,s),o.prototype.constructor=o,i&&Object.assign(o.prototype,i)},toFlatObject:function(o,n,i){var s,c,d,h={};n=n||{};do{for(c=(s=Object.getOwnPropertyNames(o)).length;c-- >0;)h[d=s[c]]||(n[d]=o[d],h[d]=!0);o=Object.getPrototypeOf(o)}while(o&&(!i||i(o,n))&&o!==Object.prototype);return n},kindOf:sC,kindOfTest:_d,endsWith:function(o,n,i){o=String(o),(void 0===i||i>o.length)&&(i=o.length);var s=o.indexOf(n,i-=n.length);return-1!==s&&s===i},toArray:function(o){if(!o)return null;var n=o.length;if($u(n))return null;for(var i=new Array(n);n-- >0;)i[n]=o[n];return i},isTypedArray:tA,isFileList:_1},Xu=fr;function uC(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var nA=function(o,n,i){if(!n)return o;var s;if(i)s=i(n);else if(Xu.isURLSearchParams(n))s=n.toString();else{var c=[];Xu.forEach(n,function(h,p){null!=h&&(Xu.isArray(h)?p+="[]":h=[h],Xu.forEach(h,function(m){Xu.isDate(m)?m=m.toISOString():Xu.isObject(m)&&(m=JSON.stringify(m)),c.push(uC(p)+"="+uC(m))}))}),s=c.join("&")}if(s){var d=o.indexOf("#");-1!==d&&(o=o.slice(0,d)),o+=(-1===o.indexOf("?")?"?":"&")+s}return o},E1=fr;function Hg(){this.handlers=[]}Hg.prototype.use=function(o,n,i){return this.handlers.push({fulfilled:o,rejected:n,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1},Hg.prototype.eject=function(o){this.handlers[o]&&(this.handlers[o]=null)},Hg.prototype.forEach=function(o){E1.forEach(this.handlers,function(n){null!==n&&o(n)})};var Gg,Wg,iA=Hg,hC=fr;function Ju(){if(Wg)return Gg;Wg=1;var o=fr;function n(c,d,h,p,m){Error.call(this),this.message=c,this.name="AxiosError",d&&(this.code=d),h&&(this.config=h),p&&(this.request=p),m&&(this.response=m)}o.inherits(n,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var i=n.prototype,s={};return["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(c){s[c]={value:c}}),Object.defineProperties(n,s),Object.defineProperty(i,"isAxiosError",{value:!0}),n.from=function(c,d,h,p,m,_){var E=Object.create(i);return o.toFlatObject(c,E,function(y){return y!==Error.prototype}),n.call(E,c.message,d,h,p,m),E.name=c.name,_&&Object.assign(E,_),E},Gg=n}var pC,zg,rA,Mn,gc,fC,oA={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function y1(){if(zg)return pC;zg=1;var o=fr;return pC=function(n,i){i=i||new FormData;var s=[];function c(d){return null===d?"":o.isDate(d)?d.toISOString():o.isArrayBuffer(d)||o.isTypedArray(d)?"function"==typeof Blob?new Blob([d]):Buffer.from(d):d}return function d(h,p){if(o.isPlainObject(h)||o.isArray(h)){if(-1!==s.indexOf(h))throw Error("Circular reference detected in "+p);s.push(h),o.forEach(h,function(m,_){if(!o.isUndefined(m)){var E,y=p?p+"."+_:_;if(m&&!p&&"object"==typeof m)if(o.endsWith(_,"{}"))m=JSON.stringify(m);else if(o.endsWith(_,"[]")&&(E=o.toArray(m)))return void E.forEach(function(S){!o.isUndefined(S)&&i.append(y,c(S))});d(m,y)}}),s.pop()}else i.append(p,c(h))}(n),i}}var _C,mf,aA,gC,Kg,EC,yC,vC,qg,cA,lA,dA,S1=function(o,n){return o&&!function(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}(n)?function(o,n){return n?o.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):o}(o,n):n};function Yg(){if(EC)return Kg;EC=1;var o=Ju();function n(i){o.call(this,i??"canceled",o.ERR_CANCELED),this.name="CanceledError"}return fr.inherits(n,o,{__CANCEL__:!0}),Kg=n}var rr=fr,pA=function(o,n){hC.forEach(o,function(i,s){s!==n&&s.toUpperCase()===n.toUpperCase()&&(o[n]=i,delete o[s])})},fA=Ju(),mA=oA,b1=y1(),T1={"Content-Type":"application/x-www-form-urlencoded"};function SC(o,n){!rr.isUndefined(o)&&rr.isUndefined(o["Content-Type"])&&(o["Content-Type"]=n)}var _A,$g={transitional:mA,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&"[object process]"===Object.prototype.toString.call(process))&&(_A=function DU(){if(cA)return qg;cA=1;var o=fr,n=function sA(){if(Mn)return rA;Mn=1;var o=Ju();return rA=function(n,i,s){var c=s.config.validateStatus;s.status&&c&&!c(s.status)?i(new o("Request failed with status code "+s.status,[o.ERR_BAD_REQUEST,o.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):n(s)}}(),i=function mC(){if(fC)return gc;fC=1;var o=fr;return gc=o.isStandardBrowserEnv()?{write:function(n,i,s,c,d,h){var p=[];p.push(n+"="+encodeURIComponent(i)),o.isNumber(s)&&p.push("expires="+new Date(s).toGMTString()),o.isString(c)&&p.push("path="+c),o.isString(d)&&p.push("domain="+d),!0===h&&p.push("secure"),document.cookie=p.join("; ")},read:function(n){var i=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}}(),s=nA,c=S1,d=function hA(){if(mf)return _C;mf=1;var o=fr,n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return _C=function(i){var s,c,d,h={};return i&&o.forEach(i.split("\n"),function(p){if(d=p.indexOf(":"),s=o.trim(p.substr(0,d)).toLowerCase(),c=o.trim(p.substr(d+1)),s){if(h[s]&&n.indexOf(s)>=0)return;h[s]="set-cookie"===s?(h[s]?h[s]:[]).concat([c]):h[s]?h[s]+", "+c:c}}),h}}(),h=function C1(){if(gC)return aA;gC=1;var o=fr;return aA=o.isStandardBrowserEnv()?function(){var n,i=/(msie|trident)/i.test(navigator.userAgent),s=document.createElement("a");function c(d){var h=d;return i&&(s.setAttribute("href",h),h=s.href),s.setAttribute("href",h),{href:s.href,protocol:s.protocol?s.protocol.replace(/:$/,""):"",host:s.host,search:s.search?s.search.replace(/^\?/,""):"",hash:s.hash?s.hash.replace(/^#/,""):"",hostname:s.hostname,port:s.port,pathname:"/"===s.pathname.charAt(0)?s.pathname:"/"+s.pathname}}return n=c(window.location.href),function(d){var h=o.isString(d)?c(d):d;return h.protocol===n.protocol&&h.host===n.host}}():function(){return!0}}(),p=oA,m=Ju(),_=Yg(),E=function AU(){return vC||(vC=1,yC=function(o){var n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return n&&n[1]||""}),yC}();return qg=function(y){return new Promise(function(S,T){var O,N=y.data,w=y.headers,k=y.responseType;function V(){y.cancelToken&&y.cancelToken.unsubscribe(O),y.signal&&y.signal.removeEventListener("abort",O)}o.isFormData(N)&&o.isStandardBrowserEnv()&&delete w["Content-Type"];var U=new XMLHttpRequest;if(y.auth){var Y=y.auth.username||"",re=y.auth.password?unescape(encodeURIComponent(y.auth.password)):"";w.Authorization="Basic "+btoa(Y+":"+re)}var K=c(y.baseURL,y.url);function $(){if(U){var Ee="getAllResponseHeaders"in U?d(U.getAllResponseHeaders()):null;n(function(ze){S(ze),V()},function(ze){T(ze),V()},{data:k&&"text"!==k&&"json"!==k?U.response:U.responseText,status:U.status,statusText:U.statusText,headers:Ee,config:y,request:U}),U=null}}if(U.open(y.method.toUpperCase(),s(K,y.params,y.paramsSerializer),!0),U.timeout=y.timeout,"onloadend"in U?U.onloadend=$:U.onreadystatechange=function(){U&&4===U.readyState&&(0!==U.status||U.responseURL&&0===U.responseURL.indexOf("file:"))&&setTimeout($)},U.onabort=function(){U&&(T(new m("Request aborted",m.ECONNABORTED,y,U)),U=null)},U.onerror=function(){T(new m("Network Error",m.ERR_NETWORK,y,U,U)),U=null},U.ontimeout=function(){var Ee=y.timeout?"timeout of "+y.timeout+"ms exceeded":"timeout exceeded";y.timeoutErrorMessage&&(Ee=y.timeoutErrorMessage),T(new m(Ee,(y.transitional||p).clarifyTimeoutError?m.ETIMEDOUT:m.ECONNABORTED,y,U)),U=null},o.isStandardBrowserEnv()){var X=(y.withCredentials||h(K))&&y.xsrfCookieName?i.read(y.xsrfCookieName):void 0;X&&(w[y.xsrfHeaderName]=X)}"setRequestHeader"in U&&o.forEach(w,function(Ee,ve){void 0===N&&"content-type"===ve.toLowerCase()?delete w[ve]:U.setRequestHeader(ve,Ee)}),o.isUndefined(y.withCredentials)||(U.withCredentials=!!y.withCredentials),k&&"json"!==k&&(U.responseType=y.responseType),"function"==typeof y.onDownloadProgress&&U.addEventListener("progress",y.onDownloadProgress),"function"==typeof y.onUploadProgress&&U.upload&&U.upload.addEventListener("progress",y.onUploadProgress),(y.cancelToken||y.signal)&&(O=function(Ee){U&&(T(!Ee||Ee&&Ee.type?new _:Ee),U.abort(),U=null)},y.cancelToken&&y.cancelToken.subscribe(O),y.signal&&(y.signal.aborted?O():y.signal.addEventListener("abort",O))),N||(N=null);var J=E(K);J&&-1===["http","https","file"].indexOf(J)?T(new m("Unsupported protocol "+J+":",m.ERR_BAD_REQUEST,y)):U.send(N)})}}()),_A),transformRequest:[function(o,n){if(pA(n,"Accept"),pA(n,"Content-Type"),rr.isFormData(o)||rr.isArrayBuffer(o)||rr.isBuffer(o)||rr.isStream(o)||rr.isFile(o)||rr.isBlob(o))return o;if(rr.isArrayBufferView(o))return o.buffer;if(rr.isURLSearchParams(o))return SC(n,"application/x-www-form-urlencoded;charset=utf-8"),o.toString();var i,s=rr.isObject(o),c=n&&n["Content-Type"];if((i=rr.isFileList(o))||s&&"multipart/form-data"===c){var d=this.env&&this.env.FormData;return b1(i?{"files[]":o}:o,d&&new d)}return s||"application/json"===c?(SC(n,"application/json"),function(h,p,m){if(rr.isString(h))try{return(0,JSON.parse)(h),rr.trim(h)}catch(_){if("SyntaxError"!==_.name)throw _}return(0,JSON.stringify)(h)}(o)):o}],transformResponse:[function(o){var n=this.transitional||$g.transitional,c=!(n&&n.silentJSONParsing)&&"json"===this.responseType;if(c||n&&n.forcedJSONParsing&&rr.isString(o)&&o.length)try{return JSON.parse(o)}catch(d){if(c)throw"SyntaxError"===d.name?fA.from(d,fA.ERR_BAD_RESPONSE,this,null,this.response):d}return o}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:dA?lA:(dA=1,lA=null)},validateStatus:function(o){return o>=200&&o<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};rr.forEach(["delete","get","head"],function(o){$g.headers[o]={}}),rr.forEach(["post","put","patch"],function(o){$g.headers[o]=rr.merge(T1)});var gA,EA,CC=$g,_f=fr,yA=CC;function bC(){return EA?gA:(EA=1,gA=function(o){return!(!o||!o.__CANCEL__)})}var TC=fr,Xg=function(o,n,i){var s=this||yA;return _f.forEach(i,function(c){o=c.call(s,o,n)}),o},vA=bC(),gf=CC,I1=Yg();function SA(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new I1}var Qu,CA,Ho=fr,bA=function(o,n){n=n||{};var i={};function s(_,E){return Ho.isPlainObject(_)&&Ho.isPlainObject(E)?Ho.merge(_,E):Ho.isPlainObject(E)?Ho.merge({},E):Ho.isArray(E)?E.slice():E}function c(_){return Ho.isUndefined(n[_])?Ho.isUndefined(o[_])?void 0:s(void 0,o[_]):s(o[_],n[_])}function d(_){if(!Ho.isUndefined(n[_]))return s(void 0,n[_])}function h(_){return Ho.isUndefined(n[_])?Ho.isUndefined(o[_])?void 0:s(void 0,o[_]):s(void 0,n[_])}function p(_){return _ in n?s(o[_],n[_]):_ in o?s(void 0,o[_]):void 0}var m={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:p};return Ho.forEach(Object.keys(o).concat(Object.keys(n)),function(_){var E=m[_]||c,y=E(_);Ho.isUndefined(y)&&E!==p||(i[_]=y)}),i};function TA(){return CA?Qu:(CA=1,Qu={version:"0.27.2"})}var Ef=TA().version,tl=Ju(),yf={};["object","boolean","number","function","string","symbol"].forEach(function(o,n){yf[o]=function(i){return typeof i===o||"a"+(n<1?"n ":" ")+o}});var un={};yf.transitional=function(o,n,i){function s(c,d){return"[Axios v"+Ef+"] Transitional option '"+c+"'"+d+(i?". "+i:"")}return function(c,d,h){if(!1===o)throw new tl(s(d," has been removed"+(n?" in "+n:"")),tl.ERR_DEPRECATED);return n&&!un[d]&&(un[d]=!0,console.warn(s(d," has been deprecated since v"+n+" and will be removed in the near future"))),!o||o(c,d,h)}};var IA,Jg,Ta,RA,wA,AA,Go=fr,R1=nA,DA=iA,IC=function(o){return SA(o),o.headers=o.headers||{},o.data=Xg.call(o,o.data,o.headers,o.transformRequest),o.headers=TC.merge(o.headers.common||{},o.headers[o.method]||{},o.headers),TC.forEach(["delete","get","head","post","put","patch","common"],function(n){delete o.headers[n]}),(o.adapter||gf.adapter)(o).then(function(n){return SA(o),n.data=Xg.call(o,n.data,n.headers,o.transformResponse),n},function(n){return vA(n)||(SA(o),n&&n.response&&(n.response.data=Xg.call(o,n.response.data,n.response.headers,o.transformResponse))),Promise.reject(n)})},vf=bA,RC=S1,wC={assertOptions:function(o,n,i){if("object"!=typeof o)throw new tl("options must be an object",tl.ERR_BAD_OPTION_VALUE);for(var s=Object.keys(o),c=s.length;c-- >0;){var d=s[c],h=n[d];if(h){var p=o[d],m=void 0===p||h(p,d,o);if(!0!==m)throw new tl("option "+d+" must be "+m,tl.ERR_BAD_OPTION_VALUE)}else if(!0!==i)throw new tl("Unknown option "+d,tl.ERR_BAD_OPTION)}},validators:yf},Zu=wC.validators;function eh(o){this.defaults=o,this.interceptors={request:new DA,response:new DA}}eh.prototype.request=function(o,n){"string"==typeof o?(n=n||{}).url=o:n=o||{},n.method=(n=vf(this.defaults,n)).method?n.method.toLowerCase():this.defaults.method?this.defaults.method.toLowerCase():"get";var i=n.transitional;void 0!==i&&wC.assertOptions(i,{silentJSONParsing:Zu.transitional(Zu.boolean),forcedJSONParsing:Zu.transitional(Zu.boolean),clarifyTimeoutError:Zu.transitional(Zu.boolean)},!1);var s=[],c=!0;this.interceptors.request.forEach(function(y){"function"==typeof y.runWhen&&!1===y.runWhen(n)||(c=c&&y.synchronous,s.unshift(y.fulfilled,y.rejected))});var d,h=[];if(this.interceptors.response.forEach(function(y){h.push(y.fulfilled,y.rejected)}),!c){var p=[IC,void 0];for(Array.prototype.unshift.apply(p,s),p=p.concat(h),d=Promise.resolve(n);p.length;)d=d.then(p.shift(),p.shift());return d}for(var m=n;s.length;){var _=s.shift(),E=s.shift();try{m=_(m)}catch(y){E(y);break}}try{d=IC(m)}catch(y){return Promise.reject(y)}for(;h.length;)d=d.then(h.shift(),h.shift());return d},eh.prototype.getUri=function(o){o=vf(this.defaults,o);var n=RC(o.baseURL,o.url);return R1(n,o.params,o.paramsSerializer)},Go.forEach(["delete","get","head","options"],function(o){eh.prototype[o]=function(n,i){return this.request(vf(i||{},{method:o,url:n,data:(i||{}).data}))}}),Go.forEach(["post","put","patch"],function(o){function n(i){return function(s,c,d){return this.request(vf(d||{},{method:o,headers:i?{"Content-Type":"multipart/form-data"}:{},url:s,data:c}))}}eh.prototype[o]=n(),eh.prototype[o+"Form"]=n(!0)});var w1=fr,AC=Qw,th=eh,OA=bA,Lr=function o(n){var i=new th(n),s=AC(th.prototype.request,i);return w1.extend(s,th.prototype,i),w1.extend(s,i),s.create=function(c){return o(OA(n,c))},s}(CC);Lr.Axios=th,Lr.CanceledError=Yg(),Lr.CancelToken=function(){if(Jg)return IA;Jg=1;var o=Yg();function n(i){if("function"!=typeof i)throw new TypeError("executor must be a function.");var s;this.promise=new Promise(function(d){s=d});var c=this;this.promise.then(function(d){if(c._listeners){var h,p=c._listeners.length;for(h=0;h<p;h++)c._listeners[h](d);c._listeners=null}}),this.promise.then=function(d){var h,p=new Promise(function(m){c.subscribe(m),h=m}).then(d);return p.cancel=function(){c.unsubscribe(h)},p},i(function(d){c.reason||(c.reason=new o(d),s(c.reason))})}return n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.prototype.subscribe=function(i){this.reason?i(this.reason):this._listeners?this._listeners.push(i):this._listeners=[i]},n.prototype.unsubscribe=function(i){if(this._listeners){var s=this._listeners.indexOf(i);-1!==s&&this._listeners.splice(s,1)}},n.source=function(){var i;return{token:new n(function(s){i=s}),cancel:i}},IA=n}(),Lr.isCancel=bC(),Lr.VERSION=TA().version,Lr.toFormData=y1(),Lr.AxiosError=Ju(),Lr.Cancel=Lr.CanceledError,Lr.all=function(o){return Promise.all(o)},Lr.spread=RA?Ta:(RA=1,Ta=function(o){return function(n){return o.apply(null,n)}}),Lr.isAxiosError=function(){if(AA)return wA;AA=1;var o=fr;return wA=function(n){return o.isObject(n)&&!0===n.isAxiosError}}(),ff.exports=Lr,ff.exports.default=Lr;var or=hr(ff.exports);function NA(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function PA(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?NA(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):NA(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}let Zg,eE=0,tE=0;function Sf(o,n,i,s){return new z((c,d)=>{n.responseType=n.responseType||"json",n.data&&!i?(n.data=JSON.stringify(n.data),eE+=zs(n.data)):i&&(n.data.size?eE+=n.data.size:n.data instanceof FormData?eE+=nC(n.data):eE+=zs(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=o,or.request(n).then(h=>{"string"==typeof h.data?tE+=zs(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?tE+=h.data.byteLength:tE+=zs(JSON.stringify(h.data)),s&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{or.isCancel(h)?d(new Q(M.OPERATION_ABORTED,"cancel token canceled")):d("ECONNABORTED"===h.code?new Q(M.NETWORK_TIMEOUT,h.message):h.response?new Q(M.NETWORK_RESPONSE_ERROR,h.response.status):new Q(M.NETWORK_ERROR,h.message))})})}function sr(o,n){return Ec.apply(this,arguments)}function Ec(){return Ec=x(function*(o,n){const i=new Blob([n.data],{type:"buffer"});return yield Sf(o,PA(PA({},n),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}),Ec.apply(this,arguments)}const Xi=()=>void 0!==window.isSecureContext;function MA(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Te(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?MA(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):MA(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}var Ye;!function(o){o.SET_SESSION_ID="SET_SESSION_ID",o.SET_P2P_ID="SET_P2P_id",o.SET_DC_ID="SET_DC_id",o.SET_UID="SET_UID",o.SET_PUB_ID="SET_PUB_ID",o.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",o.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",o.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",o.AVOID_JOIN_START="AVOID_JOIN_START",o.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",o.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",o.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",o.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",o.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",o.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",o.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",o.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",o.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",o.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",o.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",o.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",o.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",o.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",o.RESET_KEY_METRICS="RESET_KEY_METRICS",o.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",o.SET_USE_P2P="SET_USE_P2P"}(Ye||(Ye={}));class A1{constructor(n,i,s,c){C(this,"state",void 0),this.state={codec:n,audioCodec:i,mode:s,clientId:c,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1}}dispatch(n){this.state=function(i,s){switch(s.type){case Ye.SET_SESSION_ID:return Te(Te({},i),{},{sessionId:s.sessionId});case Ye.SET_P2P_ID:return Te(Te({},i),{},{p2pId:s.p2pId});case Ye.SET_UID:return Te(Te({},i),{},{uid:s.uid});case Ye.SET_PUB_ID:return Te(Te({},i),{},{pubId:s.pubId});case Ye.KEY_METRIC_CLIENT_CREATED:return Te(Te({},i),{},{keyMetrics:Te(Te({},i.keyMetrics),{},{clientCreated:s.metric})});case Ye.KEY_METRIC_JOIN_START:return Te(Te({},i),{},{keyMetrics:Te(Te({},i.keyMetrics),{},{joinStart:s.metric})});case Ye.AVOID_JOIN_START:return Te(Te({},i),{},{avoidJoinStart:s.avoidJoinStart});case Ye.KEY_METRIC_JOIN_END:return Te(Te({},i),{},{keyMetrics:Te(Te({},i.keyMetrics),{},{joinEnd:s.metric})});case Ye.KEY_METRIC_REQUEST_AP_START:return Te(Te({},i),{},{keyMetrics:Te(Te({},i.keyMetrics),{},{requestAPStart:s.metric})});case Ye.KEY_METRIC_REQUEST_AP_END:return Te(Te({},i),{},{keyMetrics:Te(Te({},i.keyMetrics),{},{requestAPEnd:s.metric})});case Ye.KEY_METRIC_JOIN_GATEWAY_START:return Te(Te({},i),{},{keyMetrics:Te(Te({},i.keyMetrics),{},{joinGatewayStart:s.metric})});case Ye.KEY_METRIC_JOIN_GATEWAY_END:return Te(Te({},i),{},{keyMetrics:Te(Te({},i.keyMetrics),{},{joinGatewayEnd:s.metric})});case Ye.KEY_METRIC_PEER_CONNECTION_START:return Te(Te({},i),{},{keyMetrics:Te(Te({},i.keyMetrics),{},{peerConnectionStart:s.metric})});case Ye.KEY_METRIC_PEER_CONNECTION_END:return Te(Te({},i),{},{keyMetrics:Te(Te({},i.keyMetrics),{},{peerConnectionEnd:s.metric})});case Ye.KEY_METRIC_DESCRIPTION_START:return Te(Te({},i),{},{keyMetrics:Te(Te({},i.keyMetrics),{},{descriptionStart:s.metric})});case Ye.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Te(Te({},i),{},{keyMetrics:Te(Te({},i.keyMetrics),{},{signalChannelOpen:s.metric})});case Ye.KEY_METRIC_ICE_CONNECTION_END:return Te(Te({},i),{},{keyMetrics:Te(Te({},i.keyMetrics),{},{iceConnectionEnd:s.metric})});case Ye.KEY_METRIC_PUBLISH:{const c=i.keyMetrics.publish,d=c.findIndex(h=>h.trackId===s.metric.trackId);return-1!==d?(c[d]=Te(Te({},c[d]),s.metric),Te(Te({},i),{},{keyMetrics:Te(Te({},i.keyMetrics),{},{publish:[...c]})})):Te(Te({},i),{},{keyMetrics:Te(Te({},i.keyMetrics),{},{publish:[...i.keyMetrics.publish,s.metric]})})}case Ye.KEY_METRIC_SUBSCRIBE:{const c=i.keyMetrics.subscribe,d=c.findIndex(h=>h.userId===s.metric.userId&&h.type===s.metric.type);return-1!==d?(c[d]=Te(Te({},c[d]),s.metric),Te(Te({},i),{},{keyMetrics:Te(Te({},i.keyMetrics),{},{subscribe:[...c]})})):Te(Te({},i),{},{keyMetrics:Te(Te({},i.keyMetrics),{},{subscribe:[...i.keyMetrics.subscribe,s.metric]})})}case Ye.SET_CLOUD_PROXY_SERVER_MODE:return i.cloudProxyServerMode=s.mode,i;case Ye.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof s.index?i.joinChannelServiceRecords=[...i.joinChannelServiceRecords,s.record]:(i.joinChannelServiceRecords[s.index]=Te(Te({},i.joinChannelServiceRecords[s.index]),s.record),i.joinChannelServiceRecords=[...i.joinChannelServiceRecords]),i;case Ye.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return i.joinChannelServiceRecords=[],i;case Ye.RESET_KEY_METRICS:return i.keyMetrics={publish:[],subscribe:[]},i;case Ye.SET_USE_DATACHANNEL:return Te(Te({},i),{},{useDataChannel:s.val});case Ye.SET_USE_P2P:return Te(Te({},i),{},{useP2P:s.val});default:return i}}(this.state,n)}set sessionId(n){this.dispatch({type:Ye.SET_SESSION_ID,sessionId:n})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(n){this.dispatch({type:Ye.SET_P2P_ID,p2pId:n})}get p2pId(){return this.state.p2pId}set dcId(n){this.dispatch({type:Ye.SET_DC_ID,dcId:n})}get dcId(){return this.state.dcId}set uid(n){this.dispatch({type:Ye.SET_UID,uid:n})}get uid(){return this.state.uid}set pubId(n){this.dispatch({type:Ye.SET_PUB_ID,pubId:n})}get pubId(){return this.state.pubId}set cloudProxyServerMode(n){this.dispatch({type:Ye.SET_CLOUD_PROXY_SERVER_MODE,mode:n})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(n){this.dispatch({type:Ye.SET_USE_DATACHANNEL,val:n})}get useDataChannel(){return this.state.useDataChannel}set useP2P(n){this.dispatch({type:Ye.SET_USE_P2P,val:n})}get useP2P(){return this.state.useP2P}clientCreated(){this.dispatch({type:Ye.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Ye.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Ye.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Ye.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Ye.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Ye.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Ye.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Ye.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Ye.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Ye.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Ye.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Ye.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(n,i,s,c){this.dispatch({type:Ye.KEY_METRIC_PUBLISH,metric:Te(Te({trackId:n,type:i},s&&{publishStart:s}),c&&{publishEnd:c})})}subscribe(n,i,s,c,d,h,p){this.dispatch({type:Ye.KEY_METRIC_SUBSCRIBE,metric:Te(Te(Te(Te(Te({userId:n,type:i},s&&{subscribeStart:s}),c&&{subscribeEnd:c}),d&&{firstFrame:d}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(n,i,s,c){n.forEach(d=>{this.dispatch({type:Ye.KEY_METRIC_SUBSCRIBE,metric:Te(Te(Te({userId:d.userId,type:d.type},i&&{subscribeStart:i}),s&&{subscribeEnd:s}),c&&{firstFrame:c})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(n,i){"gateway"===n.service&&Array.isArray(n.urls)&&(n.urls=n.urls.map(s=>s.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof i?(this.dispatch({type:Ye.RECORD_JOIN_CHANNEL_SERVICE,record:Te(Te({},n),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(i<0||i>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Ye.RECORD_JOIN_CHANNEL_SERVICE,record:n,index:i}),i)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Ye.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Ye.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(n){this.dispatch({type:Ye.AVOID_JOIN_START,avoidJoinStart:n})}}const vo=function(o){if(o.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return o;const n=o.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(n&&n[1]&&n[2]){const c=n[2];return"".concat(n[1],".").concat(c)}const i=o.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(i&&i[1]&&i[2]){const c=i[2];return"".concat(i[1],".").concat(100*(Number(c)+1))}return"4.0.0.999"}("4.19.1"),nE=function(){try{return!0===JSON.parse("true")}catch{return!0}}(),mr="v4.19.1-0-g605286cc(10/11/2023, 2:37:03 PM)",hi={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,RTM2_FLAG:void 0,AP_RTM:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,USE_XR:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:1e4,P2P:!1,SHOW_P2P_LOG:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}};function Nt(o,n,i){var s,c;be(s=Object.keys(hi)).call(s,o)&&(!i&&be(c=Object.keys(gd)).call(c,o)||(hi[o]=n))}function B(o){return hi[o]}const gd={},DC=new class extends kt{reportLogUploadError(o){this.emit("REPORT_LOG_UPLOAD",o)}};class kA{constructor(n){C(this,"logger",void 0),C(this,"prefixLists",[]),this.logger=n}debug(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];this.logger.debug(...this.prefixLists,...i)}info(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];this.logger.info(...this.prefixLists,...i)}warning(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];this.logger.warning(...this.prefixLists,...i)}error(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];this.logger.error(...this.prefixLists,...i)}prefix(n){return this.prefixLists.push(n),this}popPrefix(){return this.prefixLists.pop(),this}}function iE(){const o=new Date;return o.toTimeString().split(" ")[0]+":"+o.getMilliseconds()}function nh(){const o=new Date,n=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return n?n?.[0]+":"+o.getUTCMilliseconds():o.toTimeString().split(" ")[0]+":"+o.getMilliseconds()}const Wo={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},ih=Date.now(),Cf=o=>{for(const n in Wo)if(Object.prototype.hasOwnProperty.call(Wo,n)&&Wo[n]===o)return n;return"DEFAULT"},I=new class{constructor(){C(this,"proxyServerURL",void 0),C(this,"logLevel",Wo.DEBUG),C(this,"uploadState","collecting"),C(this,"uploadLogWaitingList",[]),C(this,"uploadLogUploadingList",[]),C(this,"uploadErrorCount",0),C(this,"currentLogID",0),C(this,"url",void 0),C(this,"extLog",(o,n)=>{this.appendLogToWaitingList(o,...n)})}debug(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];const s=[Wo.DEBUG].concat(n);this.log.apply(this,s)}info(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];const s=[Wo.INFO].concat(n);this.log.apply(this,s)}warning(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];const s=[Wo.WARNING].concat(n);this.log.apply(this,s)}warn(){this.warning(...arguments)}error(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];const s=[Wo.ERROR].concat(n);this.log.apply(this,s)}upload(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];const s=[Wo.DEBUG].concat(n);this.uploadLog.apply(this,s)}setLogLevel(o){o=Math.min(Math.max(0,o),4),this.logLevel=o}enableLogUpload(){Nt("UPLOAD_LOG",!0)}disableLogUpload(){Nt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(o){this.proxyServerURL=o}prefix(o){return new kA(this).prefix(o)}log(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];if(Date.now()-ih<100)return void setTimeout(()=>{this.log(...n)},Date.now()-ih);const s=Math.max(0,Math.min(4,n[0]));if(n[0]=iE()+" Agora-SDK [".concat(Cf(s),"]:"),this.appendLogToWaitingList(s,...n),s<this.logLevel)return;const c=iE()+" %cAgora-SDK [".concat(Cf(s),"]:");let d=[];if(!B("USE_NEW_LOG"))switch(s){case Wo.DEBUG:d=[c,"color: #64B5F6;"].concat(n.slice(1)),console.log.apply(console,d);break;case Wo.INFO:d=[c,"color: #1E88E5; font-weight: bold;"].concat(n.slice(1)),console.log.apply(console,d);break;case Wo.WARNING:d=[c,"color: #FB8C00; font-weight: bold;"].concat(n.slice(1)),console.warn.apply(console,d);break;case Wo.ERROR:d=[c,"color: #B00020; font-weight: bold;"].concat(n.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];if(Date.now()-ih<100)return void setTimeout(()=>{this.uploadLog(...n)},Date.now()-ih);const s=Math.max(0,Math.min(4,n[0]));n[0]=iE()+" Agora-SDK [".concat(Cf(s),"]:"),this.appendLogToWaitingList(s,...n)}appendLogToWaitingList(o){if(!B("UPLOAD_LOG"))return;for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];Array.isArray(i[0])?i[0][0]=nh()+" Agora-SDK [".concat(Cf(o),"]:"):i[0]=nh()+" Agora-SDK [".concat(Cf(o),"]:");let c="";i.forEach(d=>{"object"==typeof d&&(d=JSON.stringify(d)),c+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:o,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}uploadLogs(){var o=this;return x(function*(){const n=o.uploadLogUploadingList,i={sdk_version:vo,process_id:B("PROCESS_ID"),payload:JSON.stringify(n)};return Ks(x(function*(){const s=yield or.post(o.url||(o.proxyServerURL?"https://".concat(o.proxyServerURL,"/ls/?h=").concat(B("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(B("LOG_UPLOAD_SERVER"),"/upload/v1")),i,{responseType:"text"});if("OK"!==s.data){const c=new Error("unexpected upload log response");throw c.response=s,c}}),()=>(o.uploadLogUploadingList=[],!1),s=>(DC.reportLogUploadError(s.response?{status:s.response.status,data:s.response.data,headers:s.response.headers,message:s.message}:s.request?{status:s.request.status,message:s.message}:{status:-1,message:s.message}),!0),{timeout:B("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:B("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})})()}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,B("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_INTERVAL"))}).catch(o=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var LA,xA;function D1(o){return bi(o.reportId,"params.reportId",0,100,!1),bi(o.category,"params.category",0,100,!1),bi(o.event,"params.event",0,100,!1),bi(o.label,"params.label",0,100,!1),At(o.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(function(o){o.FREE="free",o.UPLOADING="uploading"})(LA||(LA={})),function(o){o[o.MISC=0]="MISC",o[o.INTERNAL_EVENT=1]="INTERNAL_EVENT",o[o.PUBLIC_EVENT=2]="PUBLIC_EVENT",o[o.WEB_EVENT=3]="WEB_EVENT",o[o.INTERNAL_API=4]="INTERNAL_API",o[o.WEB_API=5]="WEB_API",o[o.PUBLIC_API=6]="PUBLIC_API"}(xA||(xA={}));const OC={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var Yn,Kt,bf,rE;function O1(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function je(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?O1(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):O1(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}(function(o){o.PUBLISH="publish",o.SUBSCRIBE="subscribe",o.WS_COMPRESSOR_INIT="ws_compressor_init",o.SESSION_INIT="session_init",o.JOIN_CHOOSE_SERVER="join_choose_server",o.REQ_USER_ACCOUNT="req_user_account",o.JOIN_GATEWAY="join_gateway",o.REJOIN_GATEWAY="rejoin_gateway",o.STREAM_SWITCH="stream_switch",o.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",o.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",o.FIRST_VIDEO_RECEIVED="first_video_received",o.FIRST_AUDIO_RECEIVED="first_audio_received",o.FIRST_VIDEO_DECODE="first_video_decode",o.FIRST_AUDIO_DECODE="first_audio_decode",o.ON_ADD_AUDIO_STREAM="on_add_audio_stream",o.ON_ADD_VIDEO_STREAM="on_add_video_stream",o.ON_UPDATE_STREAM="on_update_stream",o.ON_REMOVE_STREAM="on_remove_stream",o.USER_ANALYTICS="req_user_analytics",o.PC_STATS="pc_stats"})(Yn||(Yn={})),function(o){o.SESSION="io.agora.pb.Wrtc.Session",o.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",o.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",o.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",o.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",o.PUBLISH="io.agora.pb.Wrtc.Publish",o.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",o.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",o.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",o.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",o.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",o.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",o.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",o.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",o.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",o.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",o.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",o.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",o.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",o.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",o.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",o.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",o.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",o.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",o.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",o.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",o.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",o.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",o.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",o.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",o.PC_STATS="io.agora.pb.Wrtc.PCStats"}(Kt||(Kt={})),function(o){o[o.WORKER_EVENT=156]="WORKER_EVENT",o[o.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(bf||(bf={})),function(o){o[o.SESSION=26]="SESSION",o[o.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",o[o.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",o[o.JOIN_GATEWAY=28]="JOIN_GATEWAY",o[o.PUBLISH=30]="PUBLISH",o[o.SUBSCRIBE=29]="SUBSCRIBE",o[o.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",o[o.STREAM_SWITCH=32]="STREAM_SWITCH",o[o.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",o[o.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",o[o.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",o[o.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",o[o.API_INVOKE=41]="API_INVOKE",o[o.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",o[o.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",o[o.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",o[o.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",o[o.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",o[o.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",o[o.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",o[o.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",o[o.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",o[o.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",o[o.WORKER_EVENT=156]="WORKER_EVENT",o[o.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",o[o.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",o[o.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",o[o.USER_ANALYTICS=1e4]="USER_ANALYTICS",o[o.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(rE||(rE={}));class Tf{constructor(){var n=this;C(this,"baseInfoMap",new Map),C(this,"proxyServer",void 0),C(this,"eventUploadTimer",void 0),C(this,"setSessionIdTimer",void 0),C(this,"url",void 0),C(this,"backupUrl",void 0),C(this,"_appId",void 0),C(this,"keyEventUploadPendingItems",[]),C(this,"normalEventUploadPendingItems",[]),C(this,"apiInvokeUploadPendingItems",[]),C(this,"apiInvokeCount",0),C(this,"ltsList",[]),C(this,"lastSendNormalEventTime",Date.now()),C(this,"customReportCounterTimer",void 0),C(this,"customReportCount",0),C(this,"extApiInvoke",function(){var i=x(function*(s){for(const c of s){const d=je(je({},c),{},{sid:null,invokeId:++n.apiInvokeCount,tag:Je.TRACER});n.sendApiInvoke(d)}});return function(s){return i.apply(this,arguments)}}()),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),B("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),B("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(n){return this.baseInfoMap.get(n)}adjustSessionStartTime(n){if(!this.baseInfoMap.has(n)&&!this.baseInfoMap.get(n))return void I.error("adjust session ".concat(n," start time, sid is not exist or info is undefined"));const i=this.baseInfoMap.get(n),s=Date.now(),c=i.startTime;i.startTime=s,I.debug("rewrite session ".concat(n," startTime: ").concat(s," , ").concat(s-c,"ms")),this.baseInfoMap.set(n,i)}setAppId(n){this._appId=n}reportApiInvoke(n,i,s){i.timeout=i.timeout||6e4,i.reportResult=void 0===i.reportResult||i.reportResult;const c=Date.now();this.apiInvokeCount+=1;const d=this.apiInvokeCount,h=()=>({tag:i.tag,invokeId:d,sid:n,name:i.name,apiInvokeTime:c,options:i.options,states:i.states||null}),p=!!B("SHOW_REPORT_INVOKER_LOG");p&&I.info("".concat(i.name," start"),i.options);let m=!1;ui(i.timeout).then(()=>{m||(this.sendApiInvoke(je(je({},h()),{},{error:M.API_INVOKE_TIMEOUT,success:!1})),I.debug("".concat(i.name," timeout")))});const _=new Q(M.UNEXPECTED_ERROR,"".concat(i.name,": this api invoke is end"));return{onSuccess:E=>{const y=()=>{if(m)throw _;return m=!0,this.sendApiInvoke(je(je({},h()),{},{success:!0},i.reportResult&&{result:E})),p&&I.info("".concat(i.name," onSuccess")),E};return s?o1(y,i.name+"Success",s,()=>m=!0):y()},onError:E=>{const y=()=>{if(m)throw E;m=!0,this.sendApiInvoke(je(je({},h()),{},{success:!1,error:E})),p&&I.info("".concat(i.name," onFailure"),E.toString())};return s?o1(y,i.name+"Error",s,()=>m=!0):y()}}}sessionInit(n,i){if(this.baseInfoMap.has(n))return;const s=Date.now(),c=this.createBaseInfo(n,s);c.cname=i.cname;const d=Object.assign({},{willUploadConsoleLog:B("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:nE?"global":"oversea",areas:B("AREAS")&&B("AREAS").join(",")},i.extend),h=Date.now(),p=je(je({},c),{},{eventType:Yn.SESSION_INIT,appid:i.appid,browser:navigator.userAgent,build:mr,lts:h,elapse:h-s,extend:JSON.stringify(d),mode:i.mode,process:B("PROCESS_ID"),appType:B("APP_TYPE"),success:!0,version:vo});this.send({type:Kt.SESSION,data:p},!0)}joinChooseServer(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=je(je({},c),{},{eventType:Yn.JOIN_CHOOSE_SERVER,lts:d,eventElapse:d-i.lts,chooseServerAddr:i.csAddr,errorCode:i.ec,elapse:d-s.startTime,success:i.succ,chooseServerAddrList:JSON.stringify(i.serverList),uid:i.uid?parseInt(i.uid):null,cid:i.cid?parseInt(i.cid):null,chooseServerIp:i.csIp||"",opid:i.opid,unilbsServerIds:i.unilbsServerIds,extend:i.extend||void 0,isHttp3:i.isHttp3});this.send({type:Kt.JOIN_CHOOSE_SERVER,data:h},!0)}reqUserAccount(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=je(je({},c),{},{eventType:Yn.REQ_USER_ACCOUNT,lts:d,success:i.success,serverAddress:i.serverAddr,stringUid:i.stringUid,uid:i.uid,errorCode:i.errorCode,elapse:d-s.startTime,eventElapse:d-i.lts,extend:JSON.stringify(i.extend)});this.send({type:Kt.REQ_USER_ACCOUNT,data:h},!0)}joinGateway(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info;i.vid&&(c.vid=i.vid),c.uid=i.uid,c.cid=i.cid;const d=Date.now(),{firstSuccess:h,avoidJoinStartTime:p,isProxy:m,addr:_}=i,E=d-(h&&p?p:s.startTime),y=je(je({},c),{},{eventType:Yn.JOIN_GATEWAY,lts:d,gatewayAddr:i.addr,success:i.succ,errorCode:i.ec,elapse:E,eventElapse:d-i.lts,firstSuccess:h,signalChannel:i.signalChannel}),S=y.success?1:0;if(i.succ&&(s.lastJoinSuccessTime=d),h)this.send({type:Kt.JOIN_GATEWAY,data:y},!0);else{let T;if(_)if(m){const N=_.match(/h=(\d{1,3}-){3}\d{1,3}/g),w=_.match(/p=[0-9]{1,6}/g);T={isSuccess:S,gatewayIp:N&&N.length?N[0].split("=")[1].replace(/-/g,"."):"",port:w&&w.length?w[0].split("=")[1]:"",isProxy:m?1:0}}else{const N=_.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),w=_.match(/(:|p=)[0-9]{1,6}/g);T={isSuccess:S,gatewayIp:N&&N.length?N[0].split("//")[1].replace(/-/g,"."):"",port:w&&w.length?w[0].split(/:|p=/g)[1]:"",isProxy:m?1:0}}else T={isSuccess:S,gatewayIp:"",port:"",isProxy:m?1:0};delete y.success,delete y.eventType,delete y.firstSuccess,y.vid=Number(y.vid);const O=Object.assign({},y,T,{eventType:Yn.REJOIN_GATEWAY});this.send({type:Kt.RE_JOIN_GATEWAY,data:O},!0)}}joinChannelTimeout(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=Date.now(),d=je(je({},s.info),{},{lts:c,timeout:i,elapse:c-s.startTime});this.send({type:Kt.JOIN_CHANNEL_TIMEOUT,data:d},!0)}publish(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=je(je({},c),{},{eventType:Yn.PUBLISH,lts:d,eventElapse:i.eventElapse,elapse:d-s.startTime,success:i.succ,errorCode:i.ec,videoName:i.videoName,audioName:i.audioName,screenName:i.screenName,screenshare:i.screenshare,audio:i.audio,video:i.video,p2pid:i.p2pid,publishRequestid:i.publishRequestid});this.send({type:Kt.PUBLISH,data:h},!0)}subscribe(n,i,s){const c=this.baseInfoMap.get(n);if(!c)return;const d=c.info,h=Date.now(),p=je(je({},d),{},{eventType:Yn.SUBSCRIBE,lts:h,eventElapse:i.eventElapse,elapse:h-c.startTime,success:i.succ,errorCode:i.ec,video:i.video,audio:i.audio,subscribeRequestid:i.subscribeRequestid,p2pid:i.p2pid},s&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof i.peerid?p.peerSuid=i.peerid:p.peer=i.peerid,this.send({type:Kt.SUBSCRIBE,data:p},!0)}wsCompressorInit(n){var i;const s=[...Eo(i=this.baseInfoMap).call(i)],d=this.baseInfoMap.get(s.length?s[0]:"UnableToGetSid");if(!d)return;const h=d.info,p=Date.now(),m=je(je({},h),{},{eventType:Yn.WS_COMPRESSOR_INIT,lts:p,eventElapse:n.eventElapse,elapse:p-d.startTime,status:n.status?1:2});this.send({type:Kt.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(n,i,s,c){const d=this.baseInfoMap.get(n);if(!d)return;const h=d.info,p=Date.now(),m=je(je(je({},h),c),{},{elapse:p-d.startTime,eventType:i,lts:p,firstDecodeFrame:Math.max(p-d.startTime,0),apEnd:Math.max(c.apEnd-d.startTime,0),apStart:Math.max(c.apStart-d.startTime,0),joinGwEnd:Math.max(c.joinGwEnd-d.startTime,0),joinGwStart:Math.max(c.joinGwStart-d.startTime,0),pcEnd:Math.max(c.pcEnd-d.startTime,0),pcStart:Math.max(c.pcStart-d.startTime,0),subscriberEnd:Math.max(c.subscriberEnd-d.startTime,0),subscriberStart:Math.max(c.subscriberStart-d.startTime,0),videoAddNotify:Math.max(c.videoAddNotify-d.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(n,i,s,c){const d=this.baseInfoMap.get(n);if(!d)return;const h=d.info,p=Date.now(),m=je(je(je({},h),c),{},{elapse:p-d.startTime,eventType:i,lts:p});this.send({type:s,data:m},!0)}pcStats(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=je(je(je({},c),i),{},{vid:void 0===c.vid?0:Number(c.vid),elapse:d-s.startTime,eventType:Yn.PC_STATS,lts:d});this.send({type:Kt.PC_STATS,data:h},!0)}onGatewayStream(n,i,s,c){const d=this.baseInfoMap.get(n);if(!d)return;const h=d.info,p=Date.now(),m=je(je(je({},h),c),{},{eventType:i,lts:p});this.send({type:s,data:m},!0)}streamSwitch(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=je(je({},c),{},{eventType:Yn.STREAM_SWITCH,lts:d,isDual:i.isdual,elapse:d-s.startTime,success:i.succ});this.send({type:Kt.STREAM_SWITCH,data:h},!0)}requestProxyAppCenter(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=je(je({},c),{},{eventType:Yn.REQUEST_PROXY_APPCENTER,lts:d,eventElapse:d-i.lts,elapse:d-s.startTime,APAddr:i.APAddr,workerManagerList:i.workerManagerList,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:Kt.REQUEST_PROXY_APPCENTER,data:h},!0)}requestProxyWorkerManager(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=je(je({},c),{},{eventType:Yn.REQUEST_PROXY_WORKER_MANAGER,lts:d,eventElapse:d-i.lts,elapse:d-s.startTime,workerManagerAddr:i.workerManagerAddr,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:Kt.REQUEST_PROXY_WORKER_MANAGER,data:h},!0)}setProxyServer(n){this.proxyServer=n,I.debug(n?"reportProxyServerurl: ".concat(n):"disable reportProxyServerurl: ".concat(n))}peerPublishStatus(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=je(je({},c),{},{subscribeElapse:i.subscribeElapse,peer:i.peer,peerPublishDuration:Math.max(i.audioPublishDuration,i.videoPublishDuration),audiotag:i.audioPublishDuration>0?1:-1,videotag:i.videoPublishDuration>0?1:-1,lts:d,elapse:d-s.startTime,joinChannelSuccessElapse:d-(s.lastJoinSuccessTime||d),peerPublishDurationVideo:i.videoPublishDuration,peerPublishDurationAudio:i.audioPublishDuration});this.send({type:Kt.PEER_PUBLISH_STATUS,data:h},!0)}workerEvent(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now();(function(p,m,_){const E=p[m];if(!E||"string"!=typeof E)return[p];p[m]="";const y=zs(JSON.stringify(p));let S=0;const T=[];let O=0;for(let N=0;N<E.length;N++)O+=E.charCodeAt(N)<=127?1:3,O<=1300-y||(T[T.length]=el(el({},p),{},{[m]:E.substring(S,N)}),S=N,O=E.charCodeAt(N)<=127?1:3);return S!==E.length-1&&(T[T.length]=el(el({},p),{},{[m]:E.substring(S)})),T})(je(je(je({},c),i),{},{elapse:d-s.startTime,lts:d,productType:"WebRTC"}),"payload").forEach(p=>this.send({type:Kt.WORKER_EVENT,data:p},!0))}apworkerEvent(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=je(je(je({},c),i),{},{elapse:d-s.startTime,lts:d});this.send({type:Kt.AP_WORKER_EVENT,data:h},!0)}joinWebProxyAP(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=je(je(je({},c),i),{},{elapse:d-s.startTime,lts:d,extend:i.extend||void 0});this.send({type:Kt.JOIN_WEB_PROXY_AP,data:h},!0)}WebSocketQuit(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=je(je(je({},c),i),{},{elapse:d-s.startTime,lts:d});this.send({type:Kt.WEBSOCKET_QUIT,data:h},!0)}sendCustomReportMessage(n,i){var s=this;return x(function*(){if(s.customReportCount+=i.length,s.customReportCount>B("CUSTOM_REPORT_LIMIT"))throw new Q(M.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);s.customReportCounterTimer||(s.customReportCounterTimer=window.setInterval(()=>{s.customReportCount=0},5e3));const c=Date.now(),d=i.map(h=>({type:Kt.USER_ANALYTICS,data:je(je({sid:n},h),{},{lts:c})}));try{B("NEW_REPORT_SERVER")?yield s.postDataToStatsCollector2(d):yield s.postDataToStatsCollector(d)}catch(h){throw I.error("send custom report message failed",h.toString()),new Q(M.CUSTOM_REPORT_SEND_FAILED,h.message)}})()}sendApiInvoke(n){const i=B("NOT_REPORT_EVENT");if(n.tag&&be(i)&&be(i).call(i,n.tag))return!1;if(null===n.sid)return this.apiInvokeUploadPendingItems.push(n),!1;const s=this.baseInfoMap.get(n.sid);if(!s)return this.apiInvokeUploadPendingItems.push(n),!1;const{cname:c,uid:d,cid:h}=s.info;let p;if(n.lts=n.lts||Date.now(),n.error)if(n.error instanceof Q){const{code:_,message:E}=n.error;p=_||E||n.error.toString()}else p=n.error.toString();const m={invokeId:n.invokeId,sid:n.sid,cname:c,cid:h,uid:d,lts:n.lts,success:n.success,elapse:n.lts-s.startTime,execElapse:n.lts-n.apiInvokeTime,apiName:n.name,options:n.options?JSON.stringify(n.options):void 0,execStates:n.states?JSON.stringify(n.states):void 0,execResult:n.result?JSON.stringify(n.result):void 0,errorCode:n.error?p:void 0,errorMsg:n.error?JSON.stringify(n.error):void 0};return this.send({type:Kt.API_INVOKE,data:m},!1),!0}appendSessionId(){Tf.__CLIENT_LIST__.forEach(n=>{if(n._sessionId){const i=this.apiInvokeUploadPendingItems.length;for(let s=0;s<i;s++){const c=this.apiInvokeUploadPendingItems.shift();c&&(c.sid=n._sessionId,this.sendApiInvoke(Object.assign({},c)))}}})}send(n,i){if(i)return this.keyEventUploadPendingItems.push(n),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(n),this.normalEventUploadPendingItems.length>B("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(n,i){const s=[],c=[];for(;n.length;){const h=n.shift();s.length<20?s.push(h):c.push(h)}n.push(...c);for(const h of[...s]){var d;-1!==this.ltsList.indexOf(h.data.lts)?(h.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(h.data.lts)):(this.ltsList.push(h.data.lts),Vp(d=this.ltsList).call(d,(p,m)=>p-m))}return i||(this.lastSendNormalEventTime=Date.now()),B("ENABLE_EVENT_REPORT")&&s.length&&(B("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((h=>p=>{B("EVENT_REPORT_RETRY")&&(i?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(h):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(h),this.normalEventUploadPendingItems.length>B("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-B("NORMAL_EVENT_QUEUE_CAPACITY")),I.warning("report: drop normal events"))))})(s)),n}postDataToStatsCollector2(n){var i=this;return x(function*(){Bn.networkState===xi.OFFLINE&&(yield z.race([Bn.onlineWaiter,ui(2*_n.maxRetryTimeout)]));const s=h=>{let p=new Uint8Array;return h.forEach(m=>{const _=Pe(JSON.stringify(m.data)),E=new ArrayBuffer(5),y=(T=>{let O=0;return Object.entries(Kt).forEach(N=>{let[w,k]=N;k===T.type&&(O=EventNameToID[w])}),O})(m),S=new DataView(E);S.setUint16(0,_.byteLength,!0),S.setUint8(2,255&y),S.setUint8(3,y>>>8&255),S.setUint8(4,y>>>16&255),p=Ww(p,new Uint8Array(E)),p=Ww(p,_)}),p},c="event";let d=i.proxyServer?"https://".concat(i.proxyServer,"/rs/?h=").concat(B("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(c):"https://".concat(B("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(c);for(let h=0;h<2;h+=1){1===h&&(d=i.proxyServer?"https://".concat(i.proxyServer,"/rs/?h=").concat(B("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(c):"https://".concat(B("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(c));try{yield Sf(d,{timeout:1e4,data:s(n),headers:je(je({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},i._appId&&{appid:i._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(p){if(1===h)throw p;continue}return}})()}postDataToStatsCollector(n){var i=arguments,s=this;return x(function*(){let c=i.length>1&&void 0!==i[1]&&i[1];const d={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:n.map(m=>JSON.stringify(m)),vid:(m=>{const _=m&&m.data.sid&&s.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(n[0])};Bn.networkState===xi.OFFLINE&&(yield z.race([Bn.onlineWaiter,ui(2*_n.maxRetryTimeout)]));const h=c?"/events/proto-raws":"/events/messages";let p=s.url||(s.proxyServer?"https://".concat(s.proxyServer,"/rs/?h=").concat(B("EVENT_REPORT_DOMAIN"),"&p=").concat(B("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(B("EVENT_REPORT_DOMAIN"),":").concat(B("STATS_COLLECTOR_PORT")).concat(h));for(let m=0;m<2;m+=1){1===m&&(p=s.backupUrl||(s.proxyServer?"https://".concat(s.proxyServer,"/rs/?h=").concat(B("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(B("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(B("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(B("STATS_COLLECTOR_PORT")).concat(h)));try{c?yield sr(p,{timeout:1e4,data:d}):yield Sf(p,{timeout:1e4,data:d})}catch(_){if(1===m)throw _;continue}return}})()}createBaseInfo(n,i){const s=Object.assign({},OC);return s.sid=n,this.baseInfoMap.set(n,{info:s,startTime:i}),s}reportResourceTiming(n,i){const s=performance.getEntriesByName(n),c=s[s.length-1];c&&this.reportApiInvoke(i,{name:"Client.resourceTiming",options:c,tag:Je.TRACER}).onSuccess()}}function Ae(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(n,i,s){const c=s.value;if("function"==typeof c){const d=o.className||n.__className__||("AgoraRTCClient"===n.constructor.name?"Client":n.constructor.name);s.value=function(){for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];let _=p;if(o.argsMap)try{_=o.argsMap(this,...p)}catch(y){I.warning(y),_=[]}try{JSON.stringify(_)}catch{I.warning("arguments for method ".concat(d,".").concat(String(i)," not serializable for apiInvoke.")),_=[]}const E=(o.report||ye).reportApiInvoke(this._sessionId||null,{name:"".concat(d,".").concat(String(i)),options:_,tag:Je.TRACER,reportResult:o.reportResult},o.throttleTime);try{const y=c.apply(this,p);return y instanceof z?y.then(S=>(E.onSuccess(o.reportResult&&S),S)).catch(S=>{throw E.onError(S),S}):(E.onSuccess(o.reportResult&&y),y)}catch(y){throw E.onError(y),y}}}return s}}C(Tf,"__CLIENT_LIST__",[]);const ye=new Tf;DC.on("REPORT_LOG_UPLOAD",o=>{o.networkState=Bn.networkState,ye.reportApiInvoke(null,{name:"logUploadError",options:o,tag:Je.TRACER})});const N1=["CHINA","GLOBAL"],no=function(){const o="us".concat("erna","me"),n="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const s=i.join(""),c=[];for(let p=0;p<6;p++)c.push("1");const d=c.join(""),h={};return h[o]=s,h[n]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=no,nE||(hi.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],hi.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],hi.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],hi.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],hi.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],hi.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],hi.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",hi.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",hi.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",hi.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",hi.AREAS=["NORTH_AMERICA","OVERSEA"]);const oE=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Ed=[];function yd(o,n){return!!n&&Ed.some(i=>i.uid===o&&i.channelName===n)}Tf.__CLIENT_LIST__=Ed;var FA,xr,rh,If,io,Ti,Ie,He,de,Se,Fr,xe,UA,vd,Oe,Kn,yc,P1=$a("Array").values,M1=Ja,OU=cn,VA=Is,NU=P1,BA=Array.prototype,PU={DOMTokenList:!0,NodeList:!0},vc=hr(function(o){var n=o.values;return o===BA||VA(BA,o)&&n===BA.values||OU(PU,M1(o))?NU:n});function te(o,n,i,s){var c,d=arguments.length,h=d<3?n:null===s?s=Object.getOwnPropertyDescriptor(n,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(o,n,i,s);else for(var p=o.length-1;p>=0;p--)(c=o[p])&&(h=(d<3?c(h):d>3?c(n,i,h):c(n,i))||h);return d>3&&h&&Object.defineProperty(n,i,h),h}function P(o,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(o,n)}(function(o){o.L1T1="L1T1",o.L1T2="L1T2",o.L1T3="L1T3",o.L2T1_KEY="L2T1_KEY",o.L2T2_KEY="L2T2_KEY",o.L2T3_KEY="L2T3_KEY",o.L3T1_KEY="L3T1_KEY",o.L3T2_KEY="L3T2_KEY",o.L3T3_KEY="L3T3_KEY"})(FA||(FA={})),function(o){o.CERTIFICATE="certificate",o.CODEC="codec",o.CANDIDATE_PAIR="candidate-pair",o.LOCAL_CANDIDATE="local-candidate",o.REMOTE_CANDIDATE="remote-candidate",o.INBOUND="inbound-rtp",o.TRACK="track",o.OUTBOUND="outbound-rtp",o.PC="peer-connection",o.REMOTE_INBOUND="remote-inbound-rtp",o.REMOTE_OUTBOUND="remote-outbound-rtp",o.TRANSPORT="transport",o.CSRC="csrc",o.DATA_CHANNEL="data-channel",o.STREAM="stream",o.SENDER="sender",o.RECEIVER="receiver"}(xr||(xr={})),function(o){o[o.ACCESS_POINT=101]="ACCESS_POINT",o[o.UNILBS=201]="UNILBS",o[o.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(rh||(rh={})),function(o){o[o.IIIEGAL_APPID=1]="IIIEGAL_APPID",o[o.IIIEGAL_UID=2]="IIIEGAL_UID",o[o.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(If||(If={})),function(o){o[o.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",o[o.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",o[o.INTERNAL_ERROR=8]="INTERNAL_ERROR",o[o.NO_AUTHORIZED=9]="NO_AUTHORIZED",o[o.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",o[o.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",o[o.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",o[o.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",o[o.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",o[o.USER_OVERLOAD=16]="USER_OVERLOAD",o[o.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",o[o.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(io||(io={})),function(o){o[o.NO_FLAG_SET=100]="NO_FLAG_SET",o[o.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",o[o.INVALID_FALG_SET=102]="INVALID_FALG_SET",o[o.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",o[o.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",o[o.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",o[o.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",o[o.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",o[o.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",o[o.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",o[o.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",o[o.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",o[o.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",o[o.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",o[o.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",o[o.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",o[o.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",o[o.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",o[o.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(Ti||(Ti={})),function(o){o[o.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",o[o.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",o[o.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",o[o.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",o[o.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",o[o.K_TICKET_INVALID=7]="K_TICKET_INVALID",o[o.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",o[o.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",o[o.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",o[o.K_UID_BANNED=14]="K_UID_BANNED",o[o.K_IP_BANNED=15]="K_IP_BANNED",o[o.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",o[o.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",o[o.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",o[o.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",o[o.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",o[o.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",o[o.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",o[o.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",o[o.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",o[o.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",o[o.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",o[o.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",o[o.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",o[o.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",o[o.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",o[o.ERR_INVALID_UID=117]="ERR_INVALID_UID",o[o.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",o[o.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",o[o.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",o[o.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",o[o.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",o[o.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",o[o.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",o[o.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",o[o.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",o[o.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",o[o.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",o[o.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",o[o.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",o[o.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",o[o.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",o[o.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",o[o.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",o[o.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",o[o.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",o[o.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",o[o.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",o[o.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",o[o.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",o[o.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",o[o.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",o[o.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",o[o.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",o[o.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",o[o.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",o[o.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",o[o.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",o[o.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",o[o.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",o[o.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",o[o.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",o[o.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",o[o.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Ie||(Ie={})),function(o){o.CONNECTING="connecting",o.CONNECTED="connected",o.RECONNECTING="reconnecting",o.CLOSED="closed"}(He||(He={})),function(o){o.WS_CONNECTED="ws_connected",o.WS_RECONNECTING="ws_reconnecting",o.WS_CLOSED="ws_closed",o.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",o.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",o.ON_BINARY_DATA="on_binary_data",o.REQUEST_RECOVER="request_recover",o.REQUEST_JOIN_INFO="request_join_info",o.REQUEST_REJOIN_INFO="req_rejoin_info",o.IS_P2P_DISCONNECTED="is_p2p_dis",o.DISCONNECT_P2P="dis_p2p",o.ABORT_P2P_EXECUTION="abort_p2p_execution",o.NEED_RENEW_SESSION="need-sid",o.REPORT_JOIN_GATEWAY="report_join_gateway",o.REQUEST_TIMEOUT="request_timeout",o.REQUEST_SUCCESS="request_success",o.JOIN_RESPONSE="join_response",o.DATACHANNEL_PRECONNECT="datachannel_preconnect",o.DATACHANNEL_CONNECTING="datachannel_connecting",o.DATACHANNEL_FAILBACK="datachannel_failback",o.P2P_START="p2p_start",o.P2P_CONNECTION="p2p_connection",o.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",o.P2P_SUBSCRIBE="p2p_subscribe",o.P2P_UNSUBSCRIBE="p2p_unsubscribe",o.P2P_EXCHANGE_SDP="p2p_exchange_sdp",o.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",o.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream"}(de||(de={})),function(o){o.PING="ping",o.PING_BACK="ping_back",o.JOIN="join_v3",o.REJOIN="rejoin_v3",o.LEAVE="leave",o.SET_CLIENT_ROLE="set_client_role",o.PUBLISH="publish",o.PUBLISH_DATASTREAM="publish_datastream",o.UNPUBLISH="unpublish",o.UNPUBLISH_DATASTREAM="unpublish_datastream",o.SUBSCRIBE="subscribe",o.SUBSCRIBE_DATASTREAM="subscribe_datastream",o.SUBSCRIBE_STREAMS="subscribe_streams",o.UNSUBSCRIBE="unsubscribe",o.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",o.UNSUBSCRIBE_STREAMS="unsubscribe_streams",o.SUBSCRIBE_CHANGE="subscribe_change",o.TRAFFIC_STATS="traffic_stats",o.RENEW_TOKEN="renew_token",o.SWITCH_VIDEO_STREAM="switch_video_stream",o.DEFAULT_VIDEO_STREAM="default_video_stream",o.SET_FALLBACK_OPTION="set_fallback_option",o.GATEWAY_INFO="gateway_info",o.CONTROL="control",o.SEND_METADATA="send_metadata",o.DATA_STREAM="data_stream",o.PICK_SVC_LAYER="pick_svc_layer",o.RESTART_ICE="restart_ice",o.CONNECT_PC="connect_pc",o.SET_VIDEO_PROFILE="set_video_profile",o.SET_PARAMETER="set_parameter",o.SET_RTM2_FLAG="set_rtm2_flag"}(Se||(Se={})),function(o){o.PUBLISH_STATS="publish_stats",o.PUBLISH_RELATED_STATS="publish_related_stats",o.SUBSCRIBE_STATS="subscribe_stats",o.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",o.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",o.DENOISER_STATS="denoiser_stats",o.TRANSPORT_STATS="transport_stats",o.EXTENSION_USAGE_STATS="extension_usage_stats"}(Fr||(Fr={})),function(o){o.ON_USER_ONLINE="on_user_online",o.ON_USER_OFFLINE="on_user_offline",o.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",o.ON_PUBLISH_STREAM="on_publish_stream",o.ON_UPLINK_STATS="on_uplink_stats",o.ON_P2P_LOST="on_p2p_lost",o.ON_REMOVE_STREAM="on_remove_stream",o.ON_ADD_AUDIO_STREAM="on_add_audio_stream",o.ON_ADD_VIDEO_STREAM="on_add_video_stream",o.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",o.ON_USER_BANNED="on_user_banned",o.ON_USER_LICENSE_BANNED="on_user_license_banned",o.ON_NOTIFICATION="on_notification",o.ON_CRYPT_ERROR="on_crypt_error",o.MUTE_AUDIO="mute_audio",o.MUTE_VIDEO="mute_video",o.UNMUTE_AUDIO="unmute_audio",o.UNMUTE_VIDEO="unmute_video",o.ON_P2P_OK="on_p2p_ok",o.RECEIVE_METADATA="receive_metadata",o.ON_DATA_STREAM="on_data_stream",o.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",o.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",o.ENABLE_LOCAL_VIDEO="enable_local_video",o.DISABLE_LOCAL_VIDEO="disable_local_video",o.ENABLE_LOCAL_AUDIO="enable_local_audio",o.DISABLE_LOCAL_AUDIO="disable_local_audio",o.ON_PUBLISHED_USER_LIST="on_published_user_list"}(xe||(xe={})),function(o){o.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",o.NEED_ANSWER="NEED_ANSWER",o.NEED_RENEGOTIATE="NEED_RENEGOTIATE",o.P2P_LOST="P2P_LOST",o.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",o.NEED_UNPUB="NEED_UNPUB",o.NEED_UNSUB="NEED_UNSUB",o.NEED_UPLOAD="NEED_UPLOAD",o.NEED_CONTROL="NEED_CONTROL",o.START_RECONNECT="START_RECONNECT",o.END_RECONNECT="END_RECONNECT",o.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(UA||(UA={})),function(o){o.SEND_ONLY="SEND_ONLY",o.RECEIVE_ONLY="RECEIVE_ONLY"}(vd||(vd={})),function(o){o.CONNECTED="websocket:connected",o.RECONNECTING="websocket:reconnecting",o.WILL_RECONNECT="websocket:will_reconnect",o.CLOSED="websocket:closed",o.FAILED="websocket:failed",o.ON_MESSAGE="websocket:on_message",o.REQUEST_NEW_URLS="websocket:request_new_urls",o.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",o.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(Oe||(Oe={}));class W extends Q{constructor(n){super(n,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),C(this,"name","AgoraRTCException")}print(){return super.print(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",I)}throw(){super.throw(I)}}function jA(o){if("string"!=typeof o||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(o))throw I.error("Invalid Channel Name ".concat(o)),new W(M.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function oh(o){if(!("number"==typeof(n=o)&&Math.floor(n)===n&&0<=n&&n<=4294967295||Jk(o,1,255)))throw new W(M.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var n;"string"==typeof o&&I.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}(function(o){o.TRANSCODE="mix_streaming",o.RAW="raw_streaming",o.INJECT="inject_streaming"})(Kn||(Kn={})),function(o){o[o.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",o[o.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",o[o.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",o[o.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",o[o.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",o[o.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",o[o.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",o[o.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",o[o.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",o[o.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",o[o.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(yc||(yc={}));const MU={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},sh={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function ah(o,n){bi(o.url,"".concat(n,".url"),1,1e3,!1),Bt(o.x)||At(o.x,"".concat(n,".x"),0,1e4),Bt(o.y)||At(o.y,"".concat(n,".y"),0,1e4),Bt(o.width)||At(o.width,"".concat(n,".width"),0,1e4),Bt(o.height)||At(o.height,"".concat(n,".height"),0,1e4),Bt(o.zOrder)||At(o.zOrder,"".concat(n,".zOrder"),0,255),Bt(o.alpha)||At(o.alpha,"".concat(n,".alpha"),0,1,!1)}const ch={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},HA={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var qs,nl,wn,sE,Ii,Ia,$n,il,It,Pt,Sd,Xn,NC,at;function GA(o){if(!o.channelName)throw new W(M.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof o.uid)throw new W(M.INVALID_PARAMS,"invalid uid in info, uid must be a number");return o.token&&bi(o.token,"info.token",1,2047),oh(o.uid),jA(o.channelName),!0}(function(o){o.WARNING="@live_uap-warning",o.ERROR="@line_uap-error",o.PUBLISH_STREAM_STATUS="@live_uap-publish-status",o.INJECT_STREAM_STATUS="@live_uap-inject-status",o.WORKER_STATUS="@live_uap-worker-status",o.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(qs||(qs={})),function(o){o.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(nl||(nl={})),function(o){o[o.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",o[o.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",o[o.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",o[o.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",o[o.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",o[o.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",o[o.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",o[o.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",o[o.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",o[o.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",o[o.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",o[o.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",o[o.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",o[o.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",o[o.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",o[o.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",o[o.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",o[o.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(wn||(wn={})),function(o){o.CONNECT_FAILED="connect failed",o.CONNECT_TIMEOUT="connect timeout",o.WS_DISCONNECTED="websocket disconnected",o.REQUEST_TIMEOUT="request timeout",o.REQUEST_FAILED="request failed",o.WAIT_STATUS_TIMEOUT="wait status timeout",o.WAIT_STATUS_ERROR="wait status error",o.BAD_STATE="bad state",o.WS_ABORT="ws abort",o.AP_REQUEST_TIMEOUT="AP request timeout",o.AP_JSON_PARSE_ERROR="AP json parse error",o.AP_REQUEST_ERROR="AP request error",o.AP_REQUEST_ABORT="AP request abort"}(sE||(sE={})),function(o){o[o.SetSdkProfile=0]="SetSdkProfile",o[o.SetSourceChannel=1]="SetSourceChannel",o[o.SetSourceUserId=2]="SetSourceUserId",o[o.SetDestChannel=3]="SetDestChannel",o[o.StartPacketTransfer=4]="StartPacketTransfer",o[o.StopPacketTransfer=5]="StopPacketTransfer",o[o.UpdateDestChannel=6]="UpdateDestChannel",o[o.Reconnect=7]="Reconnect",o[o.SetVideoProfile=8]="SetVideoProfile"}(Ii||(Ii={})),function(o){o.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",o.NETWORK_CONNECTED="NETWORK_CONNECTED",o.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",o.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",o.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",o.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",o.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",o.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",o.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",o.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(Ia||(Ia={})),function(o){o.RELAY_STATE_IDLE="RELAY_STATE_IDLE",o.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",o.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",o.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}($n||($n={})),function(o){o.RELAY_OK="RELAY_OK",o.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",o.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",o.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(il||(il={})),function(o){o.High="high",o.Low="low",o.Audio="audio",o.Screen="screen",o.ScreenLow="screen_low"}(It||(It={})),function(o){o.DISCONNECT="disconnect",o.CONNECTION_STATE_CHANGE="connection-state-change",o.NETWORK_QUALITY="network-quality",o.STREAM_TYPE_CHANGE="stream-type-change",o.IS_P2P_DISCONNECTED="is-p2p-dis",o.DISCONNECT_P2P="dis-p2p",o.REQUEST_NEW_GATEWAY_LIST="req-gate-url",o.NEED_RENEW_SESSION="need-sid",o.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",o.JOIN_RESPONSE="join-response",o.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",o.RESET_CONNECTION_EVENTS="reset-connection-events",o.DATACHANNEL_PRECONNECT="datachannel_preconnect",o.DATACHANNEL_FAILBACK="datachannel_failback",o.RESET_SIGNAL="reset-signal"}(Pt||(Pt={})),function(o){o.P2P_DISCONNECTED="P2P_DISCONNECTED",o.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",o.TIMEOUT="TIMEOUT",o.UNKNOWN_REASON="UNKNOWN_REASON"}(Sd||(Sd={})),function(o){o[o.Nothing=0]="Nothing",o[o.Audio=1]="Audio",o[o.LwoVideo=2]="LwoVideo",o[o.Video=4]="Video",o[o.Data=8]="Data",o[o.DataStream0=256]="DataStream0",o[o.DataStream1=512]="DataStream1",o[o.DataStream2=1024]="DataStream2",o[o.DataStream3=2048]="DataStream3",o[o.DataStream4=4096]="DataStream4",o[o.DataStream5=8192]="DataStream5",o[o.DataStream6=16384]="DataStream6",o[o.DataStream7=32768]="DataStream7"}(Xn||(Xn={})),function(o){o[o.websocket=0]="websocket",o[o.datachannel=1]="datachannel"}(NC||(NC={})),function(o){o.CHINA="CHINA",o.ASIA="ASIA",o.NORTH_AMERICA="NORTH_AMERICA",o.EUROPE="EUROPE",o.JAPAN="JAPAN",o.INDIA="INDIA",o.KOREA="KOREA",o.HKMC="HKMC",o.US="US",o.OCEANIA="OCEANIA",o.SOUTH_AMERICA="SOUTH_AMERICA",o.AFRICA="AFRICA",o.OVERSEA="OVERSEA",o.GLOBAL="GLOBAL",o.EXTENSIONS="EXTENSIONS"}(at||(at={}));const aE=[at.AFRICA,at.ASIA,at.CHINA,at.EUROPE,at.GLOBAL,at.INDIA,at.JAPAN,at.NORTH_AMERICA,at.OCEANIA,at.OVERSEA,at.SOUTH_AMERICA];var pi;!function(o){o.CHINA="CN",o.ASIA="AS",o.NORTH_AMERICA="NA",o.EUROPE="EU",o.JAPAN="JP",o.INDIA="IN",o.KOREA="KR",o.HKMC="HK",o.US="US",o.OCEANIA="OC",o.SOUTH_AMERICA="SA",o.AFRICA="AF",o.OVERSEA="OVERSEA",o.GLOBAL="GLOBAL",o.EXTENSIONS="GLOBAL"}(pi||(pi={}));const PC={CHINA:{},ASIA:{CODE:pi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:pi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:pi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:pi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","\tuap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:pi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:pi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:pi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:pi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:pi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:pi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:pi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:pi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:pi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};var Rf,MC,_e,Fi,Ri,ne,et,Re,Ht,So,Ur,Jn,Ra,gn,gs,kC,ro,Co,Ys,Mt,Es,WA;nE&&(PC.CHINA={CODE:pi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(o){o.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(Rf||(Rf={}));class cE extends kt{constructor(n,i){super(),C(this,"onICEConnectionStateChange",void 0),C(this,"onConnectionStateChange",void 0),C(this,"onDTLSTransportStateChange",void 0),C(this,"onDTLSTransportError",void 0),C(this,"onICETransportStateChange",void 0),C(this,"onFirstAudioReceived",void 0),C(this,"onFirstVideoReceived",void 0),C(this,"onFirstAudioDecoded",void 0),C(this,"onFirstVideoDecoded",void 0),C(this,"onFirstVideoDecodedTimeout",void 0),C(this,"onSelectedLocalCandidateChanged",void 0),C(this,"onSelectedRemoteCandidateChanged",void 0)}}class $s extends cE{constructor(n,i){super(n,i)}}(function(o){o.SEND="sendonly",o.RECV="recvonly",o.SENDRECV="sendrecv",o.INACTIVE="inactive"})(MC||(MC={})),function(o){o.VIDEO="video",o.AUDIO="audio"}(_e||(_e={})),function(o){o[o.UDP=0]="UDP",o[o.TCP=1]="TCP",o[o.RELAY=2]="RELAY"}(Fi||(Fi={})),function(o){o[o.FIRST_CONNECTION=0]="FIRST_CONNECTION",o[o.TCP_RESTART=1]="TCP_RESTART",o[o.RELAY_RESTART=2]="RELAY_RESTART",o[o.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",o[o.OLD_RESTART=11]="OLD_RESTART",o[o.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(Ri||(Ri={})),function(o){o.LocalVideoTrack="videoTrack",o.LocalAudioTrack="audioTrack",o.LocalVideoLowTrack="videoLowTrack"}(ne||(ne={})),function(o){o.New="new",o.Connected="connected",o.Reconnecting="reconnecting",o.Disconnected="disconnected"}(et||(et={})),function(o){o.StateChange="stateChange",o.IceConnectionStateChange="iceConnectionStateChange",o.RequestMuteLocal="requestMuteLocal",o.RequestUnmuteLocal="requestUnmuteLocal",o.RequestRePublish="requestRePublish",o.RequestRePublishDataChannel="requestRePublishDataChannel",o.RequestReSubscribe="requestReSubscribe",o.RequestUploadStats="requestUploadStats",o.MediaReconnectStart="MediaReconnectStart",o.MediaReconnectEnd="MediaReconnectEnd",o.NeedSignalRTT="NeedSignalRTT",o.RequestRestartICE="RequestRestartIce",o.PeerConnectionStateChange="PeerConnectionStateChange",o.RequestReconnect="RequestReconnect",o.RequestReconnectPC="RequestReconnectPC",o.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",o.P2PLost="P2PLost",o.UpdateVideoEncoder="UpdateVideoEncoder",o.ConnectionTypeChange="ConnectionTypeChange",o.RequestLowStreamParameter="RequestLowStreamParameter",o.QueryClientConnectionState="QueryClientConnectionState",o.LocalCandidate="LocalCandidate",o.RequestP2PMuteLocal="requestP2PMuteLocal",o.RequestP2PPublish="RequestP2PPublish",o.RequestP2PUnPublish="RequestP2PUnPublish",o.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",o.RequestP2PMuteRemote="RequestP2PMuteRemote",o.RequestP2PRestartICE="RequestP2PRestartICE"}(Re||(Re={})),function(o){o.MUTE_LOCAL_VIDEO="mute_local_video",o.MUTE_LOCAL_AUDIO="mute_local_audio",o.UNMUTE_LOCAL_VIDEO="unmute_local_video",o.UNMUTE_LOCAL_AUDIO="unmute_local_audio",o.MUTE_REMOTE_VIDEO="mute_remote_video",o.MUTE_REMOTE_AUDIO="mute_remote_audio",o.UNMUTE_REMOTE_VIDEO="unmute_remote_video",o.UNMUTE_REMOTE_AUDIO="unmute_remote_audio"}(Ht||(Ht={})),function(o){o.CONNECTING="CONNECTING",o.RECONNECTING="RECONNECTING",o.CONNECTED="CONNECTED",o.CLOSED="CLOSED"}(So||(So={})),function(o){o[o.CONNECT_AP=0]="CONNECT_AP",o[o.AP_CONNECTED=1]="AP_CONNECTED",o[o.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",o[o.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",o[o.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",o[o.CONNECT_WORKER=5]="CONNECT_WORKER",o[o.WORKER_CONNECTED=6]="WORKER_CONNECTED",o[o.CLOSED=7]="CLOSED"}(Ur||(Ur={})),function(o){o.CONNECTION_STATE_CHANGE="connection-state-change",o.STATE_CHANGE="state-change",o.INSPECT_RESULT="inspect-result",o.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",o.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Jn||(Jn={})),function(o){o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.MULTI_IP="MULTI_IP",o.TIMEOUT="TIMEOUT",o.OFFLINE="OFFLINE",o.LEAVE="LEAVE",o.P2P_FAILED="P2P_FAILED",o.FALLBACK="FALLBACK"}(Ra||(Ra={})),function(o){o.CONNECTED="transmitter:connected",o.RECONNECTING="transmitter:reconnecting",o.WILL_RECONNECT="transmitter:will_reconnect",o.CLOSED="transmitter:closed",o.FAILED="transmitter:failed",o.ON_MESSAGE="transmitter:on_message",o.REQUEST_NEW_URLS="transmitter:request_new_urls",o.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",o.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",o.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",o.FAILBACK="transmitter:failback"}(gn||(gn={})),function(o){o.CAMERA_CHANGED="camera-changed",o.MICROPHONE_CHANGED="microphone-changed",o.PLAYBACK_DEVICE_CHANGED="playback-device-changed",o.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",o.AUTOPLAY_FAILED="autoplay-failed",o.SECURITY_POLICY_VIOLATION="security-policy-violation"}(gs||(gs={})),function(o){o[o.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",o[o.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",o[o.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",o[o.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",o[o.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",o[o.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",o[o.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",o[o.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",o[o.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",o[o.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",o[o.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",o[o.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",o[o.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",o[o.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",o[o.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",o[o.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",o[o.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",o[o.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",o[o.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",o[o.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(kC||(kC={})),function(o){o.CONNECTING="CONNECTING",o.RECONNECTING="RECONNECTING",o.CONNECTED="CONNECTED",o.CLOSED="CLOSED"}(ro||(ro={})),function(o){o.CONNECTION_STATE_CHANGE="connection-state-change",o.STATE_CHANGE="state-change",o.INSPECT_RESULT="inspect-result",o.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",o.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Co||(Co={})),function(o){o[o.CONNECT_AP=0]="CONNECT_AP",o[o.AP_CONNECTED=1]="AP_CONNECTED",o[o.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",o[o.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",o[o.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",o[o.CONNECT_WORKER=5]="CONNECT_WORKER",o[o.WORKER_CONNECTED=6]="WORKER_CONNECTED",o[o.CLOSED=7]="CLOSED"}(Ys||(Ys={})),function(o){o.CALL="call",o.CANDIDATE="candidate",o.PUBLISH="publish",o.UNPUBLISH="unpublish",o.SUBSCRIBE="subscribe",o.UNSUBSCRIBE="unsubscribe",o.CONTROL="control",o.RESTART_ICE="restart_ice",o.ACK="ack",o.JOIN="join",o.EXCHANGE_SDP="exchange_sdp",o.DO_SUBSCRIBE="do_subscribe",o.DO_UNSUBSCRIBE="do_unsubscribe"}(Mt||(Mt={})),function(o){o.MUTE_LOCAL_AUDIO="mute_local_audio",o.MUTE_LOCAL_VIDEO="mute_local_video",o.UNMUTE_LOCAL_AUDIO="unmute_local_audio",o.UNMUTE_LOCAL_VIDEO="unmute_local_video"}(Es||(Es={})),function(o){o[o.SUCCESS=1]="SUCCESS",o[o.FAILED=0]="FAILED"}(WA||(WA={}));const zA={[rh.ACCESS_POINT]:{[Ti.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ti.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ti.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ti.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ti.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ti.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ti.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[rh.UNILBS]:{[io.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[io.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[io.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[io.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[io.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[io.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[io.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[io.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[io.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[io.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[io.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[io.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[rh.STRING_UID_ALLOCATOR]:{[If.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[If.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[If.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function lh(o){const n=zA[Math.floor(o/1e4)];if(!n)return{desc:"unkonw error",retry:!1};const i=n[o%1e4];if(!i){if(Math.floor(o/1e4)===rh.ACCESS_POINT){const s=o%1e4;if("1"===s.toString()[0])return{desc:o.toString(),retry:!1};if("2"===s.toString()[0])return{desc:o.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return i}const Sc={[Ie.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ie.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ie.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ie.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ie.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ie.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ie.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ie.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ie.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ie.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ie.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ie.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ie.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ie.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ie.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ie.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ie.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ie.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ie.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ie.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ie.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ie.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ie.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ie.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ie.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ie.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ie.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ie.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ie.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ie.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ie.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ie.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ie.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ie.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ie.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ie.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ie.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ie.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ie.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ie.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ie.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ie.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ie.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ie.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ie.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ie.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ie.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ie.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ie.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ie.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ie.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ie.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ie.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ie.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ie.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ie.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ie.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ie.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ie.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ie.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Cd(o){return Sc[o]||{desc:"UNKNOW_ERROR_".concat(o),action:"failed"}}function k1(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function LC(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?k1(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):k1(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function xC(o){return o.every(n=>n.readyState===WebSocket.CLOSED||n.readyState===WebSocket.CLOSING)}function KA(o,n){if("string"==typeof o)return o;const{proxy:i,host:s,port:c}=o;if(n){const d=B("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===d?"wss://".concat(s,"/ws/?p=").concat(Number(c)+150):"wss://".concat(s,":").concat(d,"/ws/?p=").concat(Number(c)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(s,"&p=").concat(c):"wss://".concat(s,":").concat(c)}const L1=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,qA=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,kU=/wss:\/\/(.+):([0-9]+)\/?/,YA=/wss:\/\/(.[^\/]+)\/?/;let x1=0;class $A{constructor(n,i){C(this,"id",0),C(this,"store",void 0),C(this,"recordIndex",void 0),C(this,"websockets",[]),C(this,"try443PortDuration",2e3),C(this,"forceCloseWSDuration",5e3),C(this,"try443PortTimeout",null),C(this,"forceCloseTimeout",null),C(this,"isTry443PortFailed",!1),C(this,"isNormalPortFailed",!1),C(this,"useDoubleDomain",!1),C(this,"useProxy",!1),C(this,"startTime",Date.now()),this.id=++x1,this.try443PortDuration=B("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=n||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(n=>{n.onopen=null,n.onclose=null,n.onmessage=null,n.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var n;const i=Date.now()-this.startTime;for(var s=arguments.length,c=new Array(s),d=0;d<s;d++)c[d]=arguments[d];I.debug("[choose-best-ws ".concat(null===(n=this.store)||void 0===n?void 0:n.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...c)}createWebSocket(n,i,s){this.logger("createWebSocket:",n,{isTry443Port:i,hasTimeoutDetection:s});const c=B("GATEWAY_DOMAINS"),d=Date.now(),h=[],p=c.find(E=>{var y;return be(y=n.host).call(y,E)});p||(this.useDoubleDomain=!1);const m=[];if(this.useDoubleDomain)c.forEach(E=>{m.push(KA(LC(LC({},n),{},{host:n.host.replace(p,E)}),i))});else{const E=LC({},n);if(i&&p){const y=c.find(S=>S!==p);y&&(E.host=E.host.replace(p,y))}m.push(KA(E,i))}try{m.forEach(E=>{const y=new WebSocket(E);y.binaryType="arraybuffer",h.push(y),this.logger("ws is connecting:",y.url)})}catch(E){if(this.logger("ws create failed"),h.forEach(y=>y.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(n,i,s);if(!i&&443!==Number(n.port))return this.createWebSocket(n,!0,s);throw new W(M.WS_ERR,"init websocket failed! Error: ".concat(E.toString()))}const _=fs();return this.store&&this.store.recordJoinChannelService({urls:h.map(E=>E.url),service:"gateway"},this.recordIndex),h.forEach(E=>{E.onopen=()=>{this.logger("onopen: ws ".concat(E.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(y=>{y!==E&&(y.onopen=null,y.onclose=null,y.onmessage=null,y.close(),this.logger("close backup websocket: ".concat(y.url)))}),this.websockets.length=0,_.resolve(E)},E.onclose=y=>{this.logger("onclose: ws ".concat(E.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(E.readyState)),i?this.isTry443PortFailed=xC(h):this.isNormalPortFailed=xC(h),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(i&&this.isTry443PortFailed||!i&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(y.reason)),_.reject({code:y.code,reason:Sd.A_ROUND_WS_FAILED}))},E.onmessage=y=>this.logger("".concat(E.url," onmessage: ").concat(y.data))}),this.websockets.push(...h),s||(()=>{const E=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",_.isResolved),this.websockets.forEach(y=>y.readyState!==WebSocket.OPEN&&y.close())};if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(E,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",_.isResolved),_.isResolved)return E();Et().os===ii.MAC_OS&&zt()&&E(),this.createWebSocket(n,!0,!0).then(y=>_.resolve(y)).catch(y=>{this.isNormalPortFailed&&_.reject(y),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(E,this.forceCloseWSDuration)},this.try443PortDuration)})(),_.promise}chooseBestWebsocket(n,i,s,c){return this.useDoubleDomain=!!i,"string"==typeof n&&(n=function(d){let h,p,m;return[,h,p,m]=d.match(L1)||[],h||([,p,m]=d.match(qA)||[]),p&&m||([,p,m]=d.match(kU)||[]),p&&m||([,p]=d.match(YA)||[]),p||I.warning("un-destructible url: ",d),{proxy:h,host:p,port:m||"443"}}(n)),this.recordIndex=c,this.useProxy=!!n.proxy,s&&this.useProxy&&(I.warn("cannot use 443 only when use proxy"),s=!1),this.createWebSocket(n,!!s,!1).finally(()=>this.clearTimeout())}}function F1(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}class lE extends kt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(n){var i;be(i=["tryNext","recover"]).call(i,n)&&this.resetReconnectCount(n),this._reconnectMode=n}get state(){return this._state}set state(n){n!==this._state&&(this._state=n,"reconnecting"===this._state?this.emit(Oe.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Oe.CONNECTED):"closed"===this._state?this.emit(Oe.CLOSED):"failed"===this._state&&this.emit(Oe.FAILED))}resetReconnectCount(n){I.debug("websocket reset reconnect count, reason: "+n),this.reconnectCount=0}constructor(n,i){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),C(this,"connectionID",0),C(this,"currentURLIndex",0),C(this,"urls",[]),C(this,"_reconnectMode","tryNext"),C(this,"reconnectReason",void 0),C(this,"_initMutex",new li("websocket")),C(this,"name",void 0),C(this,"_state","closed"),C(this,"reconnectInterrupter",void 0),C(this,"websocket",void 0),C(this,"retryConfig",void 0),C(this,"reconnectCount",0),C(this,"forceCloseTimeout",5e3),C(this,"onlineReconnectListener",void 0),C(this,"useCompress",void 0),C(this,"tryDoubleDomain",!1),C(this,"use443PortOnly",!1),C(this,"wsInflateLength",0),C(this,"wsDeflateLength",0),C(this,"closeEstablishingWs",()=>{}),C(this,"store",void 0),C(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=n,this.retryConfig=function(y){for(var S=1;S<arguments.length;S++){var T=null!=arguments[S]?arguments[S]:{};S%2?F1(Object(T),!0).forEach(function(O){C(y,O,T[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(T)):F1(Object(T)).forEach(function(O){Object.defineProperty(y,O,Object.getOwnPropertyDescriptor(T,O))})}return y}({},i),this.useCompress=s,this.tryDoubleDomain=c,this.use443PortOnly=d;const{timeout:p,timeoutFactor:m}=i,_=Math.max(300,Math.floor(3*p/5)),E=Math.max(1.2,Math.floor(8*m)/10);xi.ONLINE&&(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=E),Bn.on(ba.NETWORK_STATE_CHANGE,(y,S)=>{y!==S&&(this.resetReconnectCount("network state change: ".concat(S," -> ").concat(y)),y===xi.ONLINE?(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=E):(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}init(n){var i=arguments,s=this;return x(function*(){let c=i.length>1&&void 0!==i[1]?i[1]:5e3;const d=yield s._initMutex.lock();s.forceCloseTimeout=c,s.urls=n,s.state="connecting";try{const h=fs();s.createWebSocketConnection(s.urls[s.currentURLIndex]).then(h.resolve).catch(h.reject),s.once(Oe.CLOSED,()=>{h.reject(new Q(M.WS_DISCONNECT))}),s.once(Oe.CONNECTED,h.resolve),yield h.promise}catch{}finally{d()}})()}close(n,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const s=this.websocket;i?setTimeout(()=>s.close(),500):s.close(),this.websocket=void 0}this.state=n?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(n,i){if(!this.websocket)return void I.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==n&&(this.reconnectMode=n),I.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const s=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),s&&s.bind(this.websocket)({code:9999,reason:i})}sendMessage(n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Q(M.WS_ABORT,"websocket is not ready");try{i||(n=JSON.stringify(n)),this.websocket.send(n)}catch(s){throw new Q(M.WS_ERR,"send websocket message error"+s.toString())}}setWsInflateData(n){this.wsDeflateLength=this.wsDeflateLength+n.originLength,this.wsInflateLength=this.wsInflateLength+n.compressedLength}getWsInflateData(){const n=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:n,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}createWebSocketConnection(n){var i=this;return x(function*(){var s;const c=fs();i.connectionID+=1,i.joinGatewayRecordIndex=void 0;const d=y=>{var S;null===(S=i.store)||void 0===S||S.signalChannelOpen(),I.debug("[".concat(i.name,"] websocket opened:"),y),i.reconnectMode="retry",i.state="connected",i.resetReconnectCount("opened"),c.resolve()},h=function(){var y=x(function*(S){var T;if(I.debug("[".concat(i.name,"] websocket close ").concat(null===(T=i.websocket)||void 0===T?void 0:T.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(i.reconnectMode)),i.reconnectCount>=i.retryConfig.maxRetryCount)c.reject(new Q(M.WS_DISCONNECT,"websocket close: ".concat(S.code))),i.close();else{"connected"===i.state&&(i.reconnectReason=S.reason,i.state="reconnecting");const O=to(i,Oe.WILL_RECONNECT,i.reconnectMode,S.reason)||i.reconnectMode,N=yield i.reconnectWithAction(O);if("closed"===i.state)return void I.debug("[".concat(i.connectionID,"] ws is closed, no need to reconnect"));if(!N)return c.reject(new Q(M.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),i.close(!0);c.resolve()}});return function(T){return y.apply(this,arguments)}}(),p=y=>{i.emit(Oe.ON_MESSAGE,y)},m=y=>{I.warn("[".concat(i.connectionID,"] ws open error ").concat(y))};i.websocket&&(i.websocket.onclose=null,i.websocket.close()),B("GATEWAY_WSS_ADDRESS")&&i.name.startsWith("gateway")&&(n=B("GATEWAY_WSS_ADDRESS")),I.debug("[".concat(i.name,"] start connect, url:"),n);const _=null===(s=i.store)||void 0===s?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var E;const y=yield i.chooseBestWebsocketConnection(n);i.websocket=y,d&&d(i.websocket.url),i.websocket.onclose=h,i.websocket.onmessage=p,i.websocket.onerror=m,null===(E=i.store)||void 0===E||E.recordJoinChannelService({endTs:Date.now(),status:"success"},_),i.joinGatewayRecordIndex=_}catch(y){const S="closed"===i.state,T=y instanceof Q,O=T&&y.code===M.WS_ABORT,N=T&&y.code===M.WS_ERR,w=T?y.message:y&&(y.reason||y.toString());I.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(w)),i.store&&i.store.recordJoinChannelService({endTs:Date.now(),status:O?"aborted":"error",errors:[y]},_),S||N?(c.reject(S?new Q(M.WS_DISCONNECT,"websocket is closed: ".concat(w)):new Q(M.WS_ERR,"init websocket failed: ".concat(w))),N&&I.error("[".concat(i.name,"] init websocket failed: ").concat(w))):h&&h(y)}return c.promise})()}reconnectWithAction(n){var i=arguments,s=this;return x(function*(){let c=!(i.length>1&&void 0!==i[1])||i[1];if(s.reconnectCount>=s.retryConfig.maxRetryCount||0===s.urls.length||"closed"===s.state)return!1;I.warning("[choose-best-ws] action: =>",n),s.onlineReconnectListener||Bn.isOnline||!Bn.onlineWaiter||(s.onlineReconnectListener=Bn.onlineWaiter.then(()=>{s.onlineReconnectListener=void 0}));let d=!0;if(s.reconnectInterrupter=()=>d=!1,c){const m=xg(s.reconnectCount,s.retryConfig);I.debug("[".concat(s.name,"] wait ").concat(m,"ms to reconnect websocket, mode: ").concat(n)),yield z.race([ui(m),s.onlineReconnectListener||new z(()=>{})])}if("closed"===s._state||!d)return!1;s.reconnectCount+=1;const h=function(){var m=x(function*(_,E){s.emit(Oe.RECONNECT_CREATE_CONNECTION,E),yield s.createWebSocketConnection(_)});return function(E,y){return m.apply(this,arguments)}}();try{if("retry"===n)s.emit(Oe.RECONNECT_WAITTING_FINISH,n),yield h(s.urls[s.currentURLIndex],n);else if("tryNext"===n){if(s.currentURLIndex+=1,s.currentURLIndex>=s.urls.length)return s.reconnectWithAction("recover",!1);I.debug("[".concat(s.name,"] websocket url length: ").concat(s.urls.length," current index: ").concat(s.currentURLIndex)),s.emit(Oe.RECONNECT_WAITTING_FINISH,n),yield h(s.urls[s.currentURLIndex],n)}else"recover"===n&&(I.debug("[".concat(s.name,"] request new urls")),s.resetReconnectCount("recover mode"),s.emit(Oe.RECONNECT_WAITTING_FINISH,n),s.urls=yield dn(s,Oe.REQUEST_NEW_URLS),s.currentURLIndex=0,yield h(s.urls[s.currentURLIndex],n))}catch(m){var p;I.error("[".concat(s.name,"] reconnect failed ").concat(m&&m.toString()));const _=null==m||null===(p=m.data)||void 0===p?void 0:p.desc;return Array.isArray(_)&&be(_).call(_,"dynamic key expired")?(s.emit(Oe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):s.reconnectWithAction(n,c)}return!0})()}}class dh extends lE{constructor(n,i){super(n,i,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(n,i){var s=this;return x(function*(){const c=fs(),d=new $A(s.forceCloseTimeout,s.store);s.closeEstablishingWs=()=>{I.debug("[choose-best-ws] close establishing websockets"),d.closeAllWebsockets(),c.reject(new Q(M.WS_ABORT,"choose best websocket aborted"))};const h=B("GATEWAY_DOMAINS");return I.debug("[choose-best-ws] currentDomain: ",n,", domains: ",h,"total: ".concat(s.urls.length),"current: ".concat(s.currentURLIndex+1)),d.chooseBestWebsocket(n,s.tryDoubleDomain,s.use443PortOnly,i).then(c.resolve).catch(c.reject),c.promise.finally(()=>{s.closeEstablishingWs=void 0})})()}}class uh extends lE{constructor(n,i){super(n,i,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(n,i){var s=this;return x(function*(){return new z((c,d)=>{let h=!1;const p=[];s.closeEstablishingWs=()=>{I.debug("[choose-best-ws] close establishing websockets"),p.forEach(N=>{N.onclose=null,N.onopen=null,N.onmessage=null,N.close()}),d(new Q(M.WS_ABORT,"choose best websocket aborted"))};const m=B("GATEWAY_DOMAINS");let _;const E=n.indexOf("?h="),y=m.find(N=>-1!==E?be(n).call(n,N,E):be(n).call(n,N));I.debug("[choose-best-ws] currentDomain: ",y,", domains: ",m);let S=!s.tryDoubleDomain||!y;if(!S&&y){var T;const N=Date.now();try{m.forEach(w=>{const k=-1===E?n.replace(y,w):n.substr(0,E)+n.substr(E).replace(y,w),V=new WebSocket(k);V.binaryType="arraybuffer",p.push(V),I.debug("[choose-best-ws] ws is connecting:",V.url)})}catch{for(I.debug("[choose-best-ws] ws create failed, fallback to single url"),p.forEach(k=>k.close());p.length;)p.pop();S=!0}null===(T=s.store)||void 0===T||T.recordJoinChannelService({urls:p.map(w=>w.url),service:"gateway"},i),p.forEach(w=>{w.onopen=()=>{if(h)return;const k=Date.now()-N;I.debug("[choose-best-ws] ws open cost ".concat(k,"ms")),p.filter(V=>V!==w).forEach(V=>{I.debug("[choose-best-ws]close backup websocket: ".concat(V.url)),V.close()}),h=!0,c(w)},w.onclose=k=>{_=k,!h&&(p.find(V=>!(V.readyState===WebSocket.CLOSED||V.readyState===WebSocket.CLOSING))||(I.debug("[choose-best-ws] all websocket is closed"),h=!0,d(_)))},w.onmessage=k=>{I.debug("[choose-best-ws]".concat(w.url," onmessage: ").concat(k.data))}}),ui(s.forceCloseTimeout).then(()=>{p.forEach(w=>{w.readyState!==WebSocket.OPEN&&w.close()})})}if(S){var O;let N;I.debug("[choose-best-ws] use single url: ",n),null===(O=s.store)||void 0===O||O.recordJoinChannelService({urls:[n],service:"gateway"},i);try{N=new WebSocket(n),p.push(N),N.binaryType="arraybuffer"}catch(w){const k=new Q(M.WS_ERR,"init websocket failed! Error: ".concat(w.toString()));return I.error("[".concat(s.name,"]").concat(k)),void d(k)}N.onopen=()=>{c(N)},N.onclose=w=>{d(w)},N.onmessage=w=>{I.debug("[choose-best-ws]".concat(N.url," onmessage: ").concat(w.data))},ui(s.forceCloseTimeout).then(()=>{N&&N.readyState!==WebSocket.OPEN&&N.close()})}}).then(c=>(s.closeEstablishingWs=void 0,c)).catch(c=>{throw s.closeEstablishingWs=void 0,c})})()}}class FC extends kt{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===He.CONNECTED?this.emit(de.WS_CONNECTED):n===He.RECONNECTING?this.emit(de.WS_RECONNECTING,this._websocketReconnectReason):n===He.CLOSED&&this.emit(de.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),C(this,"_disconnectedReason",void 0),C(this,"_websocketReconnectReason",void 0),C(this,"_connectionState",He.CLOSED),C(this,"reconnectToken",void 0),C(this,"websocket",void 0),C(this,"openConnectionTime",void 0),C(this,"clientId",void 0),C(this,"lastMsgTime",Date.now()),C(this,"uploadCache",[]),C(this,"uploadCacheInterval",void 0),C(this,"rttRolling",new Ug(5)),C(this,"pingpongTimer",void 0),C(this,"wsInflateDataTimer",void 0),C(this,"pingpongTimeoutCount",0),C(this,"joinResponse",void 0),C(this,"multiIpOption",void 0),C(this,"initError",void 0),C(this,"spec",void 0),C(this,"store",void 0),C(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(de.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===xe.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===xe.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Ke.UID_BANNED);break;case 15:this.close(Ke.IP_BANNED);break;case 16:this.close(Ke.CHANNEL_BANNED)}if(c._type===xe.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ie.ERR_LICENSE_MISSING:this.close(Ke.LICENSE_MISSING);break;case Ie.ERR_LICENSE_EXPIRED:this.close(Ke.LICENSE_EXPIRED);break;case Ie.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ke.LICENSE_MINUTES_EXCEEDED);break;case Ie.ERR_LICENSE_PERIOD_INVALID:this.close(Ke.LICENSE_PERIOD_INVALID);break;case Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ke.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ie.ERR_LICENSE_ILLEGAL:this.close(Ke.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new dh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===He.CONNECTED&&this.reconnect("retry",ri.OFFLINE)})}request(n,i,s,c){var d=this;return x(function*(){const h=Ot(6,""),p={_id:h,_type:n,_message:i},m=d.websocket.connectionID,_=()=>new z((N,w)=>{if(d.connectionState===He.CONNECTED)return N();const k=()=>{d.off(de.WS_CLOSED,V),N()},V=()=>{d.off(de.WS_CONNECTED,k),w(new W(M.WS_ABORT))};d.once(de.WS_CONNECTED,k),d.once(de.WS_CLOSED,V),n!==Se.PUBLISH&&n!==Se.SUBSCRIBE&&n!==Se.UNSUBSCRIBE&&n!==Se.UNPUBLISH&&n!==Se.CONTROL&&n!==Se.RESTART_ICE||d.once(de.DISCONNECT_P2P,()=>{w(new W(M.DISCONNECT_P2P))}),n!==Se.PUBLISH&&n!==Se.RESTART_ICE||d.once(de.ABORT_P2P_EXECUTION,()=>{w(new W(M.DISCONNECT_P2P))})});if(d.connectionState!==He.CONNECTING&&d.connectionState!==He.RECONNECTING||n===Se.JOIN||n===Se.REJOIN||(yield _()),d.websocket.sendMessage(p,!0),c)return;const E=new z((N,w)=>{let k=!1;const V=(Y,re)=>{k=!0,N({isSuccess:"success"===Y,message:re||{}}),d.off(de.WS_CLOSED,U),d.off(de.WS_RECONNECTING,U),d.emit(de.REQUEST_SUCCESS,n,i)};d.once("res-@".concat(h),V);const U=()=>{w(new W(M.WS_ABORT,"type: ".concat(n))),d.off(de.WS_CLOSED,U),d.off(de.WS_RECONNECTING,U),d.off("res-@".concat(h),V)};d.once(de.WS_CLOSED,U),d.once(de.WS_RECONNECTING,U),ui(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||k||(I.warning("[".concat(d.clientId,"] ws request timeout, type: ").concat(n)),d.emit(de.REQUEST_TIMEOUT,n,i))})});let y=null;try{y=yield E}catch(N){if(d.connectionState===He.CLOSED||n===Se.LEAVE)throw new W(M.WS_ABORT);return!d.spec.forceWaitGatewayResponse||s?N.throw():n===Se.JOIN||n===Se.REJOIN?null:(yield _(),yield d.request(n,i))}if(y.isSuccess)return y.message;const S=Number(y.message.error_code||y.message.code),T=Cd(S),O=new W(M.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(y.message.error_str),{code:S,data:y.message});return"success"===T.action?y.message:(I.warning("[".concat(d.clientId,"] [").concat(d.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(S,", message: ").concat(T.desc,", action: ").concat(T.action)),S===Ie.ERR_TOO_MANY_BROADCASTERS?((n===Se.JOIN||n===Se.REJOIN)&&(d.initError=O,d.close()),O.throw()):"failed"===T.action?O.throw():"quit"===T.action?(d.initError=O,d.close(),O.throw()):(S===Ie.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=y.message.option,I.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",ri.MULTI_IP)):d.reconnect(T.action,ri.SERVER_ERROR),n===Se.JOIN||n===Se.REJOIN?null:yield d.request(n,i)))})()}waitMessage(n,i){return new z(s=>{const c=d=>{(!i||i(d))&&(this.off(n,c),s(d))};this.on(n,c)})}upload(n,i){const s={_type:n,_message:i};try{this.websocket.sendMessage(s)}catch{const d=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==He.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){this.websocket.sendMessage({_type:n,_message:i})}init(n,i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new z((s,c)=>{this.once(de.WS_CONNECTED,()=>s(this.joinResponse)),this.once(de.WS_CLOSED,()=>c(this.initError||new W(M.WS_ABORT))),this.connectionState=He.CONNECTING,this.websocket.init(n).catch(c),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||Ke.LEAVE,this.connectionState=He.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),n===Ke.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new dh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}join(){var n=this;return x(function*(){if(!n.joinResponse){n.emit(de.ABORT_P2P_EXECUTION);const i=yield dn(n,de.REQUEST_JOIN_INFO),s=yield n.request(Se.JOIN,i);if(!s)return n.emit(de.REPORT_JOIN_GATEWAY,Sd.TIMEOUT,n.url||""),!1;n.joinResponse=s,n.emit(de.JOIN_RESPONSE,n.joinResponse),n.reconnectToken=n.joinResponse.rejoin_token}return n.connectionState=He.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),!0})()}rejoin(){var n=this;return x(function*(){if(!n.reconnectToken)throw new W(M.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=_c(n,de.REQUEST_REJOIN_INFO);i.token=n.reconnectToken;const s=yield n.request(Se.REJOIN,i);return!!s&&(n.connectionState=He.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),s.peers&&s.peers.forEach(c=>{n.emit(xe.ON_USER_ONLINE,{uid:c.uid}),c.audio&&n.emit(xe.ON_ADD_AUDIO_STREAM,{uid:c.uid,uint_id:c.uint_id,audio:!0,ssrcId:c.audio_ssrc}),c.video&&n.emit(xe.ON_ADD_VIDEO_STREAM,{uid:c.uid,uint_id:c.uint_id,video:!0,ssrcId:c.video_ssrc}),n.emit(c.audio_mute?xe.MUTE_AUDIO:xe.UNMUTE_AUDIO,{uid:c.uid}),n.emit(c.video_mute?xe.MUTE_VIDEO:xe.UNMUTE_VIDEO,{uid:c.uid}),n.emit(c.audio_enable_local?xe.ENABLE_LOCAL_AUDIO:xe.DISABLE_LOCAL_AUDIO,{uid:c.uid}),n.emit(c.video_enable_local?xe.ENABLE_LOCAL_VIDEO:xe.DISABLE_LOCAL_VIDEO,{uid:c.uid}),c.audio||c.video||n.emit(xe.ON_REMOVE_STREAM,{uid:c.uid,uint_id:c.uint_id})}),!0)})()}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleNotification(n){I.debug("[".concat(this.clientId,"] receive notification: "),n);const i=Cd(n.code);if("success"!==i.action){if("failed"!==i.action)return"quit"===i.action?("ERR_REPEAT_JOIN_CHANNEL"===i.desc&&this.close(Ke.UID_BANNED),void this.close()):void this.reconnect(i.action,ri.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=B("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(I.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ri.TIMEOUT):this.request(Se.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),B("REPORT_STATS")&&this.send(Se.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWsInflateData(){const{wsInflateLength:n,wsDeflateLength:i}=this.websocket.getWsInflateData();0!==n&&0!==i&&this.upload(Fr.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:n})}handleWebsocketEvents(){this.websocket.on(Oe.RECONNECT_WAITTING_FINISH,n=>{this.emit(de.WS_RECONNECT_WAITTING_FINISH,n)}),this.websocket.on(Oe.RECONNECT_CREATE_CONNECTION,n=>{this.emit(de.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(Oe.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Oe.CLOSED,()=>{this.connectionState=He.CLOSED}),this.websocket.on(Oe.FAILED,()=>{this._disconnectedReason=Ke.NETWORK_ERROR,this.connectionState=He.CLOSED}),this.websocket.on(Oe.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState=this.connectionState===He.CONNECTED?He.RECONNECTING:He.CONNECTING}),this.websocket.on(Oe.WILL_RECONNECT,(n,i,s)=>{const c=_c(this,de.IS_P2P_DISCONNECTED),d=c||"retry"!==n;c&&"retry"===n&&(I.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),n="tryNext",i=Sd.P2P_DISCONNECTED),d&&(I.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(n)),this.emit(de.REPORT_JOIN_GATEWAY,i||Sd.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P)),s(n)}),this.websocket.on(Oe.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(n=>{I.warning("[".concat(this.clientId,"] rejoin failed ").concat(n)),this.reconnect("tryNext",ri.SERVER_ERROR)}):this.join().catch(n=>{if(this.emit(de.REPORT_JOIN_GATEWAY,n.message||n.code||Sd.UNKNOWN_REASON,this.url||""),n instanceof W&&n.code===M.UNEXPECTED_RESPONSE&&n.data.code===Ie.ERR_NO_AUTHORIZED)return I.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ri.SERVER_ERROR);I.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ri.SERVER_ERROR):(this.initError=n,this.close())})}),this.websocket.on(Oe.REQUEST_NEW_URLS,(n,i)=>{dn(this,de.REQUEST_RECOVER,this.multiIpOption).then(n).catch(i)}),this.websocket.on(Oe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var UC="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",XA=$m,bd=Ns,hh=UC,VC=Ei("".replace),U1=RegExp("^["+hh+"]+"),JA=RegExp("(^|[^"+hh+"])["+hh+"]+$"),dE=function(o){return function(n){var i=bd(XA(n));return 1&o&&(i=VC(i,U1,"")),2&o&&(i=VC(i,JA,"$1")),i}},LU={start:dE(1),end:dE(2),trim:dE(3)},V1=YP.PROPER,xU=ti,B1=UC,QA=LU.trim;Wt({target:"String",proto:!0,forced:function(o){return xU(function(){return!!B1[o]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[o]()||V1&&B1[o].name!==o})}("trim")},{trim:function(){return QA(this)}});var nn,di,j1=$a("String").trim,FU=Is,UU=j1,ZA=String.prototype,eD=hr(function(o){var n=o.trim;return"string"==typeof o||o===ZA||FU(ZA,o)&&n===ZA.trim?UU:n});function wf(o,n,i){return{sampleRate:o,stereo:n,bitrate:i}}function rt(o,n,i,s,c){return{width:o,height:n,frameRate:i,bitrateMin:s,bitrateMax:c}}function oo(o,n,i,s,c){return{width:{max:o},height:{max:n},frameRate:i,bitrateMin:s,bitrateMax:c}}function BC(o,n){return{numSpatialLayers:o,numTemporalLayers:n}}(function(o){o[o.CHOOSE_SERVER=11]="CHOOSE_SERVER",o[o.CLOUD_PROXY=18]="CLOUD_PROXY",o[o.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",o[o.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(nn||(nn={})),function(o){o.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",o.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",o.IOS_INTERRUPTION_START="ios-interruption-start",o.IOS_INTERRUPTION_END="ios-interruption-end",o.STATE_CHANGE="state-change"}(di||(di={}));const H1={"90p":rt(160,90),"90p_1":rt(160,90),"120p":rt(160,120,15,30,65),"120p_1":rt(160,120,15,30,65),"120p_3":rt(120,120,15,30,50),"120p_4":rt(212,120),"180p":rt(320,180,15,30,140),"180p_1":rt(320,180,15,30,140),"180p_3":rt(180,180,15,30,100),"180p_4":rt(240,180,15,30,120),"240p":rt(320,240,15,40,200),"240p_1":rt(320,240,15,40,200),"240p_3":rt(240,240,15,40,140),"240p_4":rt(424,240,15,40,220),"360p":rt(640,360,15,80,400),"360p_1":rt(640,360,15,80,400),"360p_3":rt(360,360,15,80,260),"360p_4":rt(640,360,30,80,600),"360p_6":rt(360,360,30,80,400),"360p_7":rt(480,360,15,80,320),"360p_8":rt(480,360,30,80,490),"360p_9":rt(640,360,15,80,800),"360p_10":rt(640,360,24,80,800),"360p_11":rt(640,360,24,80,1e3),"480p":rt(640,480,15,100,500),"480p_1":rt(640,480,15,100,500),"480p_2":rt(640,480,30,100,1e3),"480p_3":rt(480,480,15,100,400),"480p_4":rt(640,480,30,100,750),"480p_6":rt(480,480,30,100,600),"480p_8":rt(848,480,15,100,610),"480p_9":rt(848,480,30,100,930),"480p_10":rt(640,480,10,100,400),"720p":rt(1280,720,15,120,1130),"720p_1":rt(1280,720,15,120,1130),"720p_2":rt(1280,720,30,120,2e3),"720p_3":rt(1280,720,30,120,1710),"720p_5":rt(960,720,15,120,910),"720p_6":rt(960,720,30,120,1380),"1080p":rt(1920,1080,15,120,2080),"1080p_1":rt(1920,1080,15,120,2080),"1080p_2":rt(1920,1080,30,120,3e3),"1080p_3":rt(1920,1080,30,120,3150),"1080p_5":rt(1920,1080,60,120,4780),"1440p":rt(2560,1440,30,120,4850),"1440p_1":rt(2560,1440,30,120,4850),"1440p_2":rt(2560,1440,60,120,7350),"4k":rt(3840,2160,30,120,8910),"4k_1":rt(3840,2160,30,120,8910),"4k_3":rt(3840,2160,60,120,13500)},tD={"480p":oo(640,480,5),"480p_1":oo(640,480,5),"480p_2":oo(640,480,30),"480p_3":oo(640,480,15),"720p":oo(1280,720,5),"720p_1":oo(1280,720,5),"720p_2":oo(1280,720,30),"720p_3":oo(1280,720,15),"1080p":oo(1920,1080,5),"1080p_1":oo(1920,1080,5),"1080p_2":oo(1920,1080,30),"1080p_3":oo(1920,1080,15)},Td={"1SL1TL":BC(1,1),"3SL3TL":BC(3,3),"2SL3TL":BC(2,3)};function wa(o){return o||(o="480p_1"),"string"==typeof o?Object.assign({},H1[o]):o}function Af(o){return"string"==typeof o?Object.assign({},tD[o]):o}function ph(o){return"string"==typeof o?Object.assign({},Td[o]):o}const G1={speech_low_quality:wf(16e3,!1),speech_standard:wf(32e3,!1,18),music_standard:wf(48e3,!1),standard_stereo:wf(48e3,!0,56),high_quality:wf(48e3,!1,128),high_quality_stereo:wf(48e3,!0,192)};function fh(o){return"string"==typeof o?Object.assign({},G1[o]):o}const rl=[];function Df(o){return Vn(o,"mediaSource",["screen","window","application"]),!0}var me,qt,Id,jC,uE,mh,ol,Rd,Vr,Of;(function(o){o.NEED_RENEGOTIATE="@need_renegotiate",o.NEED_REPLACE_TRACK="@need_replace_track",o.NEED_CLOSE="@need_close",o.NEED_ENABLE_TRACK="@need_enable_track",o.NEED_DISABLE_TRACK="@need_disable_track",o.NEED_SESSION_ID="@need_sid",o.SET_OPTIMIZATION_MODE="@set_optimization_mode",o.GET_STATS="@get_stats",o.GET_LOW_VIDEO_TRACK="@get_low_video_track",o.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",o.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",o.NEED_MUTE_TRACK="@need_mute_track",o.NEED_UNMUTE_TRACK="@need_unmute_track"})(me||(me={})),function(o){o.SCREEN_TRACK="screen_track",o.CUSTOM_TRACK="custome_track",o.LOW_STREAM="low_stream"}(qt||(qt={})),function(o){o[o.HIGH_STREAM=0]="HIGH_STREAM",o[o.LOW_STREAM=1]="LOW_STREAM"}(Id||(Id={})),function(o){o[o.HIGH_STREAM=0]="HIGH_STREAM",o[o.LOW_STREAM=1]="LOW_STREAM"}(jC||(jC={})),function(o){o[o.DISABLE=0]="DISABLE",o[o.LOW_STREAM=1]="LOW_STREAM",o[o.AUDIO_ONLY=2]="AUDIO_ONLY"}(uE||(uE={})),function(o){o.TRANSCEIVER_UPDATED="transceiver-updated"}(mh||(mh={})),function(o){o.SOURCE_STATE_CHANGE="source-state-change",o.TRACK_ENDED="track-ended",o.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",o.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",o.CLOSED="closed"}(ol||(ol={})),function(o){o.FIRST_FRAME_DECODED="first-frame-decoded",o.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(Rd||(Rd={})),function(o){o.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",o.RECEIVE_TRACK_BUFFER="receive_track_buffer",o.ON_AUDIO_BUFFER="on_audio_buffer",o.UPDATE_SOURCE="update_source"}(Vr||(Vr={})),function(o){o.UPDATE_TRACK_SOURCE="update-track-source"}(Of||(Of={}));const hE={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},pE={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},nD={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},W1={uplinkNetworkQuality:0,downlinkNetworkQuality:0},HC={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var fi,so,sl,zo,Ui;(function(o){o.ON_TRACK="on_track",o.ON_NODE="on_node"})(fi||(fi={})),function(o){o.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",o.REQUEST_CONSTRAINTS="request_constraints"}(so||(so={})),function(o){o.IDLE="IDLE",o.INITING="INITING",o.INITEND="INITEND"}(sl||(sl={})),function(o){o.STATE_CHANGE="state_change",o.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",o.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",o.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(zo||(zo={})),function(o){o.NONE="none",o.INIT="init",o.CANPLAY="canplay",o.PLAYING="playing",o.PAUSED="paused",o.SUSPEND="suspend",o.STALLED="stalled",o.WAITING="waiting",o.ERROR="error",o.DESTROYED="destroyed",o.ABORT="abort",o.ENDED="ended",o.EMPTIED="emptied",o.LOADEDDATA="loadeddata"}(Ui||(Ui={}));const GC={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};var Nf;!function(o){o.OPEN="open",o.MESSAGE="message",o.CLOSE="close",o.CLOSING="closing",o.ERROR="error"}(Nf||(Nf={}));class z1 extends kt{constructor(n,i){super(),C(this,"_ID",void 0),C(this,"_rtpTransceiver",void 0),C(this,"_lowRtpTransceiver",void 0),C(this,"_hints",[]),C(this,"_isClosed",!1),C(this,"_originMediaStreamTrack",void 0),C(this,"_mediaStreamTrack",void 0),C(this,"_external",{}),this._ID=i||Ot(8,"track-"),this._originMediaStreamTrack=n,this._mediaStreamTrack=n,be(rl).call(rl,this)||rl.push(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(n){if(!n){ye.reportApiInvoke(null,{name:Rn.GET_MEDIA_STREAM_TRACK,options:[],tag:Je.TRACER}).onSuccess(this._mediaStreamTrack&&"string"==typeof this._mediaStreamTrack.label?this._mediaStreamTrack.label:"")}return this._mediaStreamTrack}getRTCRtpTransceiver(n){return n===Id.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(n){const i=rl.indexOf(n);-1!==i&&rl.splice(i,1)}(this),this.emit(ol.CLOSED)}_updateRtpTransceiver(n,i){if(i===Id.LOW_STREAM){if(this._lowRtpTransceiver===n)return;this._lowRtpTransceiver=n}else{if(this._rtpTransceiver===n)return;this._rtpTransceiver=n}this.emit(mh.TRANSCEIVER_UPDATED,n,i)}}class wi extends z1{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}constructor(n,i){super(n,i),C(this,"_enabled",!0),C(this,"_muted",!1),C(this,"_isExternalTrack",!1),C(this,"_isClosed",!1),C(this,"_enabledMutex",void 0),C(this,"processor",void 0),C(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new li("".concat(this.getTrackId())),n.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var n,i;return null!==(n=null===(i=this._originMediaStreamTrack)||void 0===i?void 0:i.label)&&void 0!==n?n:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,I.debug("[".concat(this.getTrackId(),"] close")),this.emit(me.NEED_CLOSE),super.close())}_updateOriginMediaStreamTrack(n,i){var s=arguments,c=this;return x(function*(){c._isExternalTrack=s.length>2&&void 0!==s[2]&&s[2],n!==c._originMediaStreamTrack&&(c._originMediaStreamTrack&&(c._originMediaStreamTrack.removeEventListener("ended",c._handleTrackEnded),i&&c._originMediaStreamTrack.stop()),n.addEventListener("ended",c._handleTrackEnded),c._originMediaStreamTrack=n,c._muted&&(c._originMediaStreamTrack.enabled=!1),c._mediaStreamTrack=c._originMediaStreamTrack,c._updatePlayerSource(),yield St(c,me.NEED_REPLACE_TRACK,c),c.processor&&c.processor.updateInput({track:c._originMediaStreamTrack,context:c.processorContext}))})()}_getDefaultPlayerConfig(){return{}}onTrackEnded(){I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ol.TRACK_ENDED)}stateCheck(n,i){if(I.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(n,": ").concat(i,"]")),Zc(i,n),this._enabled&&this._muted&&"enabled"===n&&!1===i)throw new Q(M.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",I);if(!this._enabled&&!this._muted&&"muted"===n&&!0===i)throw new Q(M.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",I)}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function iD(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}const Aa=window.AudioContext||window.webkitAudioContext;let Ko=null;const Dt=new class extends kt{constructor(){var o;super(...arguments),o=this,C(this,"prevState",void 0),C(this,"curState",void 0),C(this,"currentTime",void 0),C(this,"currentTimeStuckAt",void 0),C(this,"interruptDetectorTrack",void 0),C(this,"onLocalAudioTrackMute",()=>{I.info("ios15-interruption-start"),this.emit(di.IOS_15_16_INTERRUPTION_START)}),C(this,"onLocalAudioTrackUnmute",x(function*(){I.info("ios15-interruption-end"),"running"!==o.curState||o.duringInterruption?I.info("ios15-interruption-end-canceled"):(Ko&&(yield Ko.suspend()),o.emit(di.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(o){I.debug("webaudio bindInterruptDetectorTrack ".concat(o.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=o,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(o){I.debug("webaudio unbindInterruptDetectorTrack ".concat(o.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===o&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Pf(){if(!Ko){if(function VU(){if(!Aa)return void I.error("your browser is not support web audio");I.info("create audio context");const o=function(n){for(var i=1;i<arguments.length;i++){var s=null!=arguments[i]?arguments[i]:{};i%2?iD(Object(s),!0).forEach(function(c){C(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):iD(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}({},B("WEBAUDIO_INIT_OPTIONS"));var n;I.debug("audio context init option:",JSON.stringify(o)),Ko=new Aa(o),Dt.curState=Ko.state,Ko.onstatechange=()=>{Dt.prevState=Dt.curState,Dt.curState=Ko?Ko.state:void 0;const{prevState:n,curState:i}=Dt,s="running"===i,c="interrupted"===i,d="running"===n,h="suspended"===n,p="interrupted"===n,m=Et().osVersion;(ir()||Gs())&&d&&c&&(I.info("ios".concat(m,"-interruption-start")),Dt.emit(di.IOS_INTERRUPTION_START)),(ir()||Gs())&&(h||p)&&s&&(I.info("ios".concat(m,"-interruption-end")),Dt.emit(di.IOS_INTERRUPTION_END)),n!==i&&(I.debug("AudioContext State Change","".concat(n,"=>").concat(i)),Dt.emit(di.STATE_CHANGE))},setInterval(()=>{var n;const i=null===(n=Ko)||void 0===n?void 0:n.currentTime;Dt.currentTime!==i?(Dt.currentTimeStuckAt&&(I.debug("AudioContext current time resume at ".concat(i)),Dt.currentTimeStuckAt=void 0),Dt.currentTime=i):(i!==Dt.currentTimeStuckAt&&(ye.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:Je.TRACER}).onSuccess(),I.warning("AudioContext current time stuck at ".concat(i))),Dt.currentTimeStuckAt=i)},5e3),(n=x(function*(i){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let c,d=!1,h=!1,p=!1;function m(k){"running"===i.state?_(!1):ir()||Gs()?"suspended"===i.state&&(_(!0),k&&i.resume().then(y,y)):"closed"!==i.state&&(_(!0),k&&i.resume().then(y,y))}function _(k){if(d!==k){d=k;for(let V=0,U=s;V<U.length;V+=1){const Y=U[V];k?window.addEventListener(Y,S,{capture:!0,passive:!0}):window.removeEventListener(Y,S,{capture:!0,passive:!0})}}}function y(){m(!1)}function S(){m(!0)}function T(k){if(!p)if(c.paused)if(k){let V;O(!1),p=!0;try{V=c.play(),V?V.then(N,N):(c.addEventListener("playing",N),c.addEventListener("abort",N),c.addEventListener("error",N))}catch{N()}}else O(!0);else O(!1)}function O(k){if(h!==k){h=k;for(let V=0,U=s;V<U.length;V++){const Y=U[V];k?window.addEventListener(Y,w,{capture:!0,passive:!0}):window.removeEventListener(Y,w,{capture:!0,passive:!0})}}}function N(){c.removeEventListener("playing",N),c.removeEventListener("abort",N),c.removeEventListener("error",N),p=!1,T(!1)}function w(){T(!0)}if(ir()){const k=i.createMediaStreamDestination(),V=document.createElement("div");V.innerHTML="<audio x-webkit-airplay='deny'></audio>",c=V.children.item(0),c.controls=!1,c.disableRemotePlayback=!0,c.preload="auto",c.srcObject=k.stream,T(!0)}Dt.on(di.STATE_CHANGE,function E(){m(!0)}),m(!1)}),function(i){return n.apply(this,arguments)})(Ko)}(),!Ko)throw new Q(M.NOT_SUPPORTED,"can not create audio context");return Ko}return Ko}function K1(){return!!Ko}function wd(o){if(function(){if(null!==rD)return rD;const s=Pf(),c=s.createBufferSource(),d=s.createGain(),h=s.createGain();c.connect(d),c.connect(h),c.disconnect(d);let p=!1;try{c.disconnect(d)}catch{p=!0}return c.disconnect(),rD=p,p}())return;const n=o.connect,i=o.disconnect;o.connect=(s,c,d)=>{var h;return o._inputNodes||(o._inputNodes=[]),be(h=o._inputNodes).call(h,s)||(s instanceof AudioNode?(o._inputNodes.push(s),n.call(o,s,c,d)):n.call(o,s,c)),o},o.disconnect=(s,c,d)=>{i.call(o),s?Ng(o._inputNodes,s):o._inputNodes=[];for(const h of o._inputNodes)n.call(o,h)}}let rD=null;function oD(o,n){let i=!1;const s=1/n;if(B("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{i?window.clearInterval(c):o(performance.now()/1e3)},1e3*s)}else{const c=Pf();let d=c.createGain();d.gain.value=0,d.connect(c.destination);const h=()=>{if(i)return void(d=null);const p=c.createOscillator();p.onended=h,p.connect(d),p.start(0),p.stop(c.currentTime+s),o(c.currentTime)};h()}return()=>{i=!0}}const Ji={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1};function Ut(){return Ji}class q1{constructor(){C(this,"context",void 0),C(this,"analyserNode",void 0),C(this,"sourceNode",void 0),this.context=Pf(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(n){if(n!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=n,n?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ir()||Gs()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode))return 0;const n=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(n);else{const s=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(s);for(let c=0;c<n.length;++c)n[c]=s[c]/128-1}const i=md(n).call(n,(s,c)=>s+c*c,0)/n.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var n,i;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(i=this.sourceNode)||void 0===i||i.connect(this.analyserNode)}catch{I.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Y1 extends kt{get processSourceNode(){return this.sourceNode}set processedNode(n){var i;if(!this.isDestroyed&&this._processedNode!==n){try{var s;null===(s=this.sourceNode)||void 0===s||s.disconnect(this.outputNode)}catch{}null===(i=this._processedNode)||void 0===i||i.disconnect(),this._processedNode=n,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),C(this,"outputNode",void 0),C(this,"outputTrack",void 0),C(this,"isPlayed",!1),C(this,"context",void 0),C(this,"audioBufferNode",void 0),C(this,"destNode",void 0),C(this,"audioOutputLevel",0),C(this,"volumeLevelAnalyser",void 0),C(this,"_processedNode",void 0),C(this,"playNode",void 0),C(this,"isDestroyed",!1),C(this,"onNoAudioInput",void 0),C(this,"isNoAudioInput",!1),C(this,"_noAudioInputCount",0),this.context=Pf(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),wd(this.outputNode),this.volumeLevelAnalyser=new q1}startGetAudioBuffer(n){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(n),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(Vr.ON_AUDIO_BUFFER,function(s){for(let c=0;c<s.outputBuffer.numberOfChannels;c+=1){const d=s.outputBuffer.getChannelData(c);for(let h=0;h<d.length;h+=1)d[h]=0}return s.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ut().webAudioMediaStreamDest)throw new Q(M.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(n){"running"!==this.context.state&&ms(()=>{Dt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=n||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}checkHasAudioInput(){var n=arguments,i=this;return x(function*(){let s=n.length>0&&void 0!==n[0]?n[0]:0;if(s>5)return i.isNoAudioInput=!0,i.onNoAudioInput&&i.onNoAudioInput(),!1;ir()||Gs()?"suspended"===i.context.state&&i.context.resume():"running"!==i.context.state&&i.context.resume();const c=i.volumeLevelAnalyser.getAnalyserNode();let d;c.getFloatTimeDomainData?(d=new Float32Array(c.fftSize),c.getFloatTimeDomainData(d)):(d=new Uint8Array(c.fftSize),c.getByteTimeDomainData(d));let h=!1;for(let p=0;p<d.length;p++)0!==d[p]&&(h=!0);return h?(i.isNoAudioInput=!1,!0):(yield ui(200),(yield i.checkHasAudioInput(s?s+1:1))&&h)})()}getAudioVolume(){return this.outputNode.gain.value}setVolume(n){this.outputNode.gain.setValueAtTime(n,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var n,i;null===(n=this.processedNode)||void 0===n||n.disconnect(),null===(i=this.sourceNode)||void 0===i||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var n;this.processedNode?null===(n=this.processedNode)||void 0===n||n.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class _h extends Y1{get isFreeze(){return!1}constructor(n,i,s){var c,d;if(super(),c=this,C(this,"sourceNode",void 0),C(this,"track",void 0),C(this,"clonedTrack",void 0),C(this,"audioElement",void 0),C(this,"isCurrentTrackCloned",!1),C(this,"isRemoteTrack",!1),C(this,"originVolumeLevelAnalyser",void 0),C(this,"rebuildWebAudio",x(function*(){if(I.debug("ready to rebuild web audio, state:",c.context.state),c.isNoAudioInput&&(yield c.checkHasAudioInput()),!c.isNoAudioInput||c.isDestroyed)return document.body.removeEventListener("click",c.rebuildWebAudio,!0),void I.debug("rebuild web audio success, current volume status",c.getAccurateVolumeLevel());c.context.resume().then(()=>I.info("resume success")),I.debug("rebuild web audio because of ios 12 bugs"),c.disconnect();const m=c.track;c.track=c.track.clone(),c.isCurrentTrackCloned?m.stop():c.isCurrentTrackCloned=!0;const _=new MediaStream([c.track]);c.sourceNode=c.context.createMediaStreamSource(_),wd(c.sourceNode),c.volumeLevelAnalyser.rebuildAnalyser();const E=c.outputNode.gain.value;c.outputNode=c.context.createGain(),c.outputNode.gain.setValueAtTime(E,c.context.currentTime),wd(c.outputNode),c.emit(Vr.UPDATE_SOURCE),c.connect(),c.audioElement.srcObject=_,c.isPlayed&&c.play(c.playNode),c.checkHasAudioInput()})),"audio"!==n.kind)throw new Q(M.UNEXPECTED_ERROR);this.track=n;const h=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(h),wd(this.sourceNode),s){const m=s.clone();m.enabled=!0,this.clonedTrack=m,I.debug("create an unmuted track ".concat(m.id," from the original track ").concat(s.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));wd(_),this.originVolumeLevelAnalyser=new q1,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=h;const p=Et();i&&p.os===ii.IOS&&Number(null===(d=p.osVersion)||void 0===d?void 0:d.split(".")[0])<15&&(Dt.on(di.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(n){this.sourceNode.disconnect(),this.track=n,this.isCurrentTrackCloned=!1;const i=new MediaStream([n]);this.sourceNode=this.context.createMediaStreamSource(i),wd(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Vr.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var n;this.audioElement.srcObject=null,this.audioElement.remove(),Dt.off("state-change",this.rebuildWebAudio),null===(n=this.originVolumeLevelAnalyser)||void 0===n||n.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(n){return this.context.createMediaStreamSource(new MediaStream([n]))}updateOriginTrack(n){const i=n.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),I.debug("create an unmuted track ".concat(i.id," from the original track ").concat(n.id," to get the volume"));const s=this.context.createMediaStreamSource(new MediaStream([i]));wd(s),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(s)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}function Xs(o,n,i){return sD.apply(this,arguments)}function sD(){return sD=x(function*(o,n,i){const s=(d,h)=>d?"number"!=typeof d?d.max||d.exact||d.ideal||d.min||h:d:h,c={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxHeight:s(n.height,1080),maxWidth:s(n.width,1920)}}};return n.frameRate&&"number"!=typeof n.frameRate?(c.video.mandatory.maxFrameRate=n.frameRate.max,c.video.mandatory.minFrameRate=n.frameRate.min):"number"==typeof n.frameRate&&(c.video.mandatory.maxFrameRate=n.frameRate),yield navigator.mediaDevices.getUserMedia(c)}),sD.apply(this,arguments)}function $1(o,n){return WC.apply(this,arguments)}function WC(){return WC=x(function*(o,n){const i=yield rn(o.mediaSource),{sourceId:s,audio:c}=yield function(d){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new z((p,m)=>{const _=document.createElement("div");_.innerText="share screen",_.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const E=document.createElement("div");E.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const y=document.createElement("div");y.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",y.setAttribute("style","height: 12%;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const T=document.createElement("div");T.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const O=document.createElement("button");O.innerHTML="cancel",O.setAttribute("style","width: 85px;"),O.onclick=()=>{document.body.removeChild(k);const V=new Error("NotAllowedError");V.name="NotAllowedError",m(V)};let N=h;const w=document.createElement("div");if(h){const V=document.createElement("input");V.setAttribute("type","checkbox");const U=document.createElement("span");V.setAttribute("style","margin-right: 6px;"),U.innerText="Share audio",V.checked=N,V.onchange=()=>{N=V.checked},w.appendChild(V),w.appendChild(U)}T.appendChild(w),T.appendChild(O),E.appendChild(y),E.appendChild(S),E.appendChild(T);const k=document.createElement("div");k.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),k.appendChild(_),k.appendChild(E),document.body.appendChild(k),d.map(V=>{if(V.id){const U=document.createElement("div");U.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Y=V.thumbnail;try{const{width:re}=Y.getSize();re>1920&&(Y=Y.resize({width:1920}))}catch(re){throw re&&re.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),re}U.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Y.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+V.name.replace(/[\u00A0-\u9999<>\&]/g,function(re){return"&#"+re.charCodeAt(0)+";"})+"</span>",U.onclick=()=>{document.body.removeChild(k),p({sourceId:V.id,audio:N})},S.appendChild(U)}})})}(i,n);return yield Xs(s,o,c)}),WC.apply(this,arguments)}function rn(o){return Mf.apply(this,arguments)}function Mf(){return Mf=x(function*(o){let n=["window","screen"];"application"!==o&&"window"!==o||(n=["window"]),"screen"===o&&(n=["screen"]);const i=lf();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new Q(M.ELECTRON_IS_NULL);let s=null;try{var c;s=(null===(c=i.desktopCapturer)||void 0===c?void 0:c.getSources({types:n}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:n})}catch{s=null}s&&s.then||(s=new z((d,h)=>{i.desktopCapturer.getSources({types:n},(p,m)=>{p?h(p):d(m)})}));try{return yield s}catch(d){throw new Q(M.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}),Mf.apply(this,arguments)}function aD(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}const zC=new li("safari");let KC=!1,qC=!1;function bo(o,n){return kf.apply(this,arguments)}function kf(){return kf=x(function*(o,n){let i=0,s=null;for(;i<2;)try{s=yield cD(o,n,i>0);break}catch(c){if(c instanceof Q)throw I.error("[".concat(n,"] ").concat(c.toString())),c;const d=Da(c.name||c.code||c,c.message);if(d.code===M.MEDIA_OPTION_INVALID){I.debug("[".concat(n,"] detect media option invalid, retry")),i+=1,yield ui(500);continue}throw I.error("[".concat(n,"] ").concat(d.toString())),d}if(!s)throw new Q(M.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return s}),kf.apply(this,arguments)}function cD(o,n,i){return Js.apply(this,arguments)}function Js(){return Js=x(function*(o,n,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Q(M.NOT_SUPPORTED,"can not find getUserMedia");i&&(o.video&&(delete o.video.width,delete o.video.height),o.screen&&(delete o.screen.width,delete o.screen.height));const s=Ut(),c=new MediaStream;if(o.audioSource&&c.addTrack(o.audioSource),o.videoSource&&c.addTrack(o.videoSource),!o.audio&&!o.video&&!o.screen)return I.debug("Using Video Source/ Audio Source"),c;if(o.screen)if(lf())Ad(c,o.screen.sourceId?yield Xs(o.screen.sourceId,o.screen,o.screenAudio):yield $1(o.screen,o.screenAudio));else if(XS()&&o.screen.extensionId&&o.screen.mandatory){if(!s.getStreamFromExtension)throw new Q(M.NOT_SUPPORTED,"This browser does not support screen sharing");I.debug("[".concat(n,'] Screen access on chrome stable, looking for extension"'));const S=yield(h=o.screen.extensionId,p=n,new z((T,O)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},N=>{if(!N||!N.streamId)return I.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),N),void O(new Q(M.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));T(N.streamId)})}catch(N){I.error("[".concat(p,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),N.toString()),O(new Q(M.CHROME_PLUGIN_NOT_INSTALL))}}));o.screen.mandatory.chromeMediaSourceId=S,Ad(c,yield navigator.mediaDevices.getUserMedia({video:{mandatory:o.screen.mandatory}}))}else if(s.getDisplayMedia){var d;o.screen.mediaSource&&Df(o.screen.mediaSource);const S={width:o.screen.width,height:o.screen.height,frameRate:o.screen.frameRate,displaySurface:null!==(d=o.screen.displaySurface)&&void 0!==d?d:"screen"===o.screen.mediaSource?"monitor":o.screen.mediaSource},{selfBrowserSurface:T,surfaceSwitching:O,systemAudio:N}=o.screen,w={selfBrowserSurface:T,surfaceSwitching:O,systemAudio:N};!T&&delete w.selfBrowserSurface,!O&&delete w.surfaceSwitching,!N&&delete w.systemAudio,I.debug("[".concat(n,"] getDisplayMedia:"),JSON.stringify({video:S,audio:!!o.screenAudio,controls:w}));const k=yield navigator.mediaDevices.getDisplayMedia(function(V){for(var U=1;U<arguments.length;U++){var Y=null!=arguments[U]?arguments[U]:{};U%2?aD(Object(Y),!0).forEach(function(re){C(V,re,Y[re])}):Object.getOwnPropertyDescriptors?Object.defineProperties(V,Object.getOwnPropertyDescriptors(Y)):aD(Object(Y)).forEach(function(re){Object.defineProperty(V,re,Object.getOwnPropertyDescriptor(Y,re))})}return V}({video:S,audio:!!o.screenAudio},w));Ad(c,k)}else{if(!zt())throw I.error("[".concat(n,"] This browser does not support screenSharing")),new Q(M.NOT_SUPPORTED,"This browser does not support screen sharing");{o.screen.mediaSource&&Df(o.screen.mediaSource);const S={video:{mediaSource:o.screen.mediaSource,width:o.screen.width,height:o.screen.height,frameRate:o.screen.frameRate}};I.debug("[".concat(n,"] getUserMedia: ").concat(JSON.stringify(S))),Ad(c,yield navigator.mediaDevices.getUserMedia(S))}}var h,p;if(!o.video&&!o.audio)return c;let m={video:o.video,audio:o.audio},_=B("MEDIA_DEVICE_CONSTRAINTS");if(_)try{"string"==typeof _&&(_=JSON.parse(_)),m=Mg(m,_)}catch{}I.debug("[".concat(n,"] GetUserMedia"),JSON.stringify(m)),Et();let E,y=null;(nr()||ir()||Og())&&(y=yield zC.lock());try{E=yield navigator.mediaDevices.getUserMedia(m)}catch(S){throw y&&y(),S}return m.audio&&(KC=!0),m.video&&(qC=!0),Ad(c,E),y&&y(),c}),Js.apply(this,arguments)}function Da(o,n){switch(o){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Q(M.MEDIA_OPTION_INVALID,"".concat(o,": ").concat(n));case"NotFoundError":case"DevicesNotFoundError":return new Q(M.DEVICE_NOT_FOUND,"".concat(o,": ").concat(n));case"NotSupportedError":return new Q(M.NOT_SUPPORTED,"".concat(o,": ").concat(n));case"NotReadableError":return new Q(M.NOT_READABLE,"".concat(o,": ").concat(n));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Q(M.PERMISSION_DENIED,"".concat(o,": ").concat(n));case"ConstraintNotSatisfiedError":return new Q(M.CONSTRAINT_NOT_SATISFIED,"".concat(o,": ").concat(n));default:return I.error("getUserMedia unexpected error",o),new Q(M.UNEXPECTED_ERROR,"".concat(o,": ").concat(n))}}function Ad(o,n){const i=o.getVideoTracks()[0],s=o.getAudioTracks()[0],c=n.getVideoTracks()[0],d=n.getAudioTracks()[0];d&&(s&&o.removeTrack(s),o.addTrack(d)),c&&(i&&o.removeTrack(i),o.addTrack(c))}const ao=new class extends kt{get state(){return this._state}set state(o){o!==this._state&&(this.emit(zo.STATE_CHANGE,o),this._state=o)}constructor(){super(),C(this,"_state",sl.IDLE),C(this,"isAccessMicrophonePermission",!1),C(this,"isAccessCameraPermission",!1),C(this,"lastAccessMicrophonePermission",!1),C(this,"lastAccessCameraPermission",!1),C(this,"checkdeviceMatched",!1),C(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(B("ENUMERATE_DEVICES_INTERVAL")||(sf()||Dg()===ii.HARMONY_OS)&&pc())&&this.updateDevicesInfo()},B("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(o=>I.error(o.toString()))}enumerateDevices(o,n){var i=arguments,s=this;return x(function*(){let c=i.length>2&&void 0!==i[2]&&i[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Q(M.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const d=yield navigator.mediaDevices.enumerateDevices(),h=s.checkMediaDeviceInfoIsOk(d);let p=!s.isAccessMicrophonePermission&&o,m=!s.isAccessCameraPermission&&n;h.audio&&(p=!1),h.video&&(m=!1);let _=null,E=null,y=null;if(!c&&(p||m)){if(zC.isLocked&&(I.debug("[device manager] wait GUM lock"),(yield zC.lock())(),I.debug("[device manager] GUM unlock")),KC&&(p=!1,s.isAccessMicrophonePermission=!0),qC&&(m=!1,s.isAccessCameraPermission=!0),I.debug("[device manager] check media device permissions",o,n,p,m),p&&m){try{y=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const T=Da(S.name||S.code||S,S.message);if(T.code===M.PERMISSION_DENIED)throw T;I.warning("getUserMedia failed in getDevices",T)}s.isAccessCameraPermission=!0,s.isAccessMicrophonePermission=!0}else if(p){try{_=yield navigator.mediaDevices.getUserMedia({audio:o})}catch(S){const T=Da(S.name||S.code||S,S.message);if(T.code===M.PERMISSION_DENIED)throw T;I.warning("getUserMedia failed in getDevices",T)}s.isAccessMicrophonePermission=!0}else if(m){try{E=yield navigator.mediaDevices.getUserMedia({video:n})}catch(S){const T=Da(S.name||S.code||S,S.message);if(T.code===M.PERMISSION_DENIED)throw T;I.warning("getUserMedia failed in getDevices",T)}s.isAccessCameraPermission=!0}I.debug("[device manager] mic permission",o,"cam permission",n)}try{const S=yield navigator.mediaDevices.enumerateDevices();return _&&_.getTracks().forEach(T=>T.stop()),E&&E.getTracks().forEach(T=>T.stop()),y&&y.getTracks().forEach(T=>T.stop()),_=null,E=null,y=null,S}catch(S){return _&&_.getTracks().forEach(T=>T.stop()),E&&E.getTracks().forEach(T=>T.stop()),y&&y.getTracks().forEach(T=>T.stop()),_=null,E=null,y=null,new Q(M.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}})()}getRecordingDevices(){var o=arguments,n=this;return x(function*(){let i=o.length>0&&void 0!==o[0]&&o[0];return(yield n.enumerateDevices(!0,!1,i)).filter(s=>"audioinput"===s.kind)})()}getCamerasDevices(){var o=arguments,n=this;return x(function*(){let i=o.length>0&&void 0!==o[0]&&o[0];return(yield n.enumerateDevices(!1,!0,i)).filter(s=>"videoinput"===s.kind)})()}getSpeakers(){var o=arguments,n=this;return x(function*(){let i=o.length>0&&void 0!==o[0]&&o[0];return(yield n.enumerateDevices(!0,!1,i)).filter(s=>"audiooutput"===s.kind)})()}searchDeviceIdByName(o){let n=null;return this.deviceInfoMap.forEach(i=>{i.device.label===o&&(n=i.device.deviceId)}),n}getDeviceById(o){var n=this;return x(function*(){const i=(yield n.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===o);if(!i)throw new Q(M.DEVICE_NOT_FOUND,"deviceId: ".concat(o));return i})()}init(){var o=this;return x(function*(){o.state=sl.INITING;try{yield o.updateDevicesInfo(),o.state=sl.INITEND}catch(n){throw I.warning("Device Detection functionality cannot start properly.",n.toString()),o.state=sl.IDLE,!("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)&&new Q(M.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),n}})()}updateDevicesInfo(){var o=this;return x(function*(){const n=yield o.enumerateDevices(!0,!0,!0),i=Date.now(),s=[];if(n[0]&&n[0].label&&!1===o.checkdeviceMatched){o.checkdeviceMatched=!0;const d=n.find(p=>"audioinput"===p.kind&&"default"===p.deviceId),h=n.find(p=>"audiooutput"===p.kind&&"default"===p.deviceId);d&&h?h.groupId===d.groupId?I.debug("[device-check] default input ".concat(d.label," and output ").concat(h.label," is the same group")):I.warning("[device-check] default input ".concat(d.label," and output ").concat(h.label," is not the same group")):I.debug("[device-check] default input or output not found")}const c=o.checkMediaDeviceInfoIsOk(n);if(n.forEach(d=>{if(!d.deviceId)return;const h=o.deviceInfoMap.get("".concat(d.kind,"_").concat(d.deviceId));if("ACTIVE"!==(h?h.state:"INACTIVE")){const p={initAt:i,updateAt:i,device:d,state:"ACTIVE"};o.deviceInfoMap.set("".concat(d.kind,"_").concat(d.deviceId),p),s.push(p)}h&&(h.updateAt=i)}),o.deviceInfoMap.forEach((d,h)=>{"ACTIVE"===d.state&&d.updateAt!==i&&(d.state="INACTIVE",s.push(d))}),o.state!==sl.INITEND)return c.audio&&(o.lastAccessMicrophonePermission=!0,o.isAccessMicrophonePermission=!0),void(c.video&&(o.lastAccessCameraPermission=!0,o.isAccessCameraPermission=!0));s.forEach(d=>{switch(d.device.kind){case"audioinput":o.lastAccessMicrophonePermission&&o.isAccessMicrophonePermission&&o.emit(zo.RECORDING_DEVICE_CHANGED,d);break;case"videoinput":o.lastAccessCameraPermission&&o.isAccessCameraPermission&&o.emit(zo.CAMERA_DEVICE_CHANGED,d);break;case"audiooutput":o.lastAccessMicrophonePermission&&o.isAccessMicrophonePermission&&o.emit(zo.PLAYOUT_DEVICE_CHANGED,d)}}),c.audio&&(o.lastAccessMicrophonePermission=!0,o.isAccessMicrophonePermission=!0),c.video&&(o.lastAccessCameraPermission=!0,o.isAccessCameraPermission=!0)})()}checkMediaDeviceInfoIsOk(o){const n=o.filter(c=>"audioinput"===c.kind),i=o.filter(c=>"videoinput"===c.kind),s={audio:!1,video:!1};for(const c of n)if(c.label&&c.deviceId){s.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){s.video=!0;break}return s}};let YC=!1;const _r=new class extends kt{constructor(){super(...arguments),C(this,"onAutoplayFailed",void 0),C(this,"onAudioAutoplayFailed",void 0)}};function lD(){if(Et(),!YC){const o=n=>{n.preventDefault(),YC=!1,Yu()?document.body.removeEventListener("click",o,!0):(document.body.removeEventListener("touchstart",o,!0),document.body.removeEventListener("mousedown",o,!0))};YC=!0,Yu()?document.body.addEventListener("click",o,!0):(document.body.addEventListener("touchstart",o,!0),document.body.addEventListener("mousedown",o,!0)),I.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),_r.onAutoplayFailed?_r.onAutoplayFailed():I.warning(_r.onAudioAutoplayFailed?"AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .":"We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),_r.emit("autoplay-failed")}}function dD(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function $C(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?dD(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):dD(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function XC(o,n,i,s){if(!o)return;const c=ye.getBaseInfoBySessionId(o);if(!c)return;const d=c.info,h=Date.now(),p=$C($C({},d),{},{vid:void 0===d.vid?0:Number(d.vid),lts:h,elapse:h-c.startTime,cbRegistered:_r.onAutoplayFailed||_r.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:n,trackId:s,extend:void 0});ye.send({type:Kt.AUTOPLAY_FAILED,data:p},!0)}const To=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],on=new class{constructor(){C(this,"onAutoplayFailed",void 0),C(this,"elementMap",new Map),C(this,"elementStateMap",new Map),C(this,"elementsNeedToResume",[]),C(this,"sinkIdMap",new Map),C(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(o=>{let[n,i]=o;const s=this.elementStateMap.get(n),c=i.srcObject.getAudioTracks()[0];qu()?c&&"live"===c.readyState&&"running"===Dt.curState&&(I.debug("auto resume after interruption for iOS 15"),i.pause(),i.play()):s&&"paused"===s&&c&&"live"===c.readyState&&"running"===Dt.curState&&(I.debug("auto resume after interruption for iOS"),i.play())})}),C(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(o=>{let[n,i]=o;const s=i.srcObject.getAudioTracks()[0];s&&"live"===s.readyState&&(I.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),Dt.on(di.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Dt.on(di.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Dt.on(di.STATE_CHANGE,()=>{ir()&&"suspended"===Dt.prevState&&"running"===Dt.curState&&this.autoResumeAfterInterruption()})}setSinkID(o,n){var i=this;return x(function*(){const s=i.elementMap.get(o);if(i.sinkIdMap.set(o,n),s)try{yield s.setSinkId(n)}catch(c){throw new Q(M.PERMISSION_DENIED,"can not set sink id: "+c.toString())}})()}play(o,n,i,s){if(this.elementMap.has(n))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([o]),this.bindAudioElementEvents(n,c),this.elementMap.set(n,c),this.elementStateMap.set(n,Ui.INIT),this.setVolume(n,i);const d=this.sinkIdMap.get(n);if(d)try{c.setSinkId(d).catch(p=>{I.warning("[".concat(n,"] set sink id failed"),p.toString())})}catch(p){I.warning("[".concat(n,"] set sink id failed"),p.toString())}const h=c.play();h&&h.then&&h.catch(p=>{s&&XC(s,"audio",p.message,n),I.warning("audio element play warning",p.toString()),this.elementMap.has(n)&&"NotAllowedError"===p.name&&(I.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),ms(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),lD()}))})}updateTrack(o,n){const i=this.elementMap.get(o);i&&(i.srcObject=new MediaStream([n]))}isPlaying(o){return this.elementMap.has(o)&&"playing"===this.elementStateMap.get(o)}setVolume(o,n){const i=this.elementMap.get(o);i&&(n=Math.max(0,Math.min(100,n)),i.volume=n/100)}stop(o){const n=this.elementMap.get(o);if(this.sinkIdMap.delete(o),!n)return;const i=this.elementsNeedToResume.indexOf(n);this.elementsNeedToResume.splice(i,1),n.srcObject=null,n.remove(),this.elementMap.delete(o),this.elementStateMap.delete(o)}bindAudioElementEvents(o,n){To.forEach(i=>{n.addEventListener(i,s=>{const c=this.elementStateMap.get(o),d="pause"===s.type?"paused":s.type;if(I.debug("[".concat(o,"] audio-element-status change ").concat(c," => ").concat(d)),"error"===s.type){const h=n?.error;h&&I.error("[".concat(o,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(o,d)})})}getPlayerState(o){return this.elementStateMap.get(o)||"uninit"}autoResumeAudioElement(){const o=()=>{this.elementsNeedToResume.forEach(n=>{n.play().then(i=>{I.debug("Auto resume audio element success")}).catch(i=>{I.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new z(n=>{document.body?n():window.addEventListener("load",()=>n())}).then(()=>{Yu()?document.body.addEventListener("click",o,!0):(document.body.addEventListener("touchstart",o,!0),document.body.addEventListener("mousedown",o,!0))})}};function ot(){return function(o,n,i){const s=i.value;return"function"==typeof s&&(i.value=function(){this._isClosed&&new Q(M.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",I);for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];const p=s.apply(this,d);return p instanceof z?new z((m,_)=>{p.then(m).catch(_)}):p}),i}}function jt(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Qn(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?jt(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):jt(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class tt extends kt{constructor(n){super(),C(this,"name","VideoProcessorDestination"),C(this,"ID","0"),C(this,"_source",void 0),C(this,"videoContext",void 0),C(this,"inputTrack",void 0),this.videoContext=n}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Q(M.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Q(M.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(n){if(n.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");n.track&&n.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=n.track,this.emit(fi.ON_TRACK,n.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(fi.ON_TRACK,void 0)}}class X1 extends kt{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,i){super(),C(this,"constraintsMap",new Map),C(this,"statsRegistry",[]),C(this,"usageRegistry",[]),C(this,"trackId",void 0),C(this,"direction",void 0),C(this,"_chained",!1),this.trackId=n,this.direction=i}getConstraints(){var n=this;return x(function*(){return yield dn(n,so.REQUEST_CONSTRAINTS)})()}requestApplyConstraints(n,i){var s=this;return x(function*(){var c;return I.info("processor ".concat(i.name," requestApplyConstraints for ").concat(s.trackId)),n&&s.constraintsMap.set(i,n),St(s,so.REQUEST_UPDATE_CONSTRAINTS,Array.from(vc(c=s.constraintsMap).call(c)))})()}requestRevertConstraints(n){var i=this;return x(function*(){var s;if(i.constraintsMap.has(n))return I.info("processor ".concat(n.name," requestRevertConstraints for ").concat(i.trackId)),i.constraintsMap.delete(n),St(i,so.REQUEST_UPDATE_CONSTRAINTS,Array.from(vc(s=i.constraintsMap).call(s)))})()}registerStats(n,i,s){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:i,cb:s})}unregisterStats(n,i){const s=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i);-1!==s&&this.statsRegistry.splice(s,1)}gatherStats(){const n=[];for(const{processorID:i,processorName:s,type:c,cb:d}of this.statsRegistry)try{const h=d();n.push({processorID:i,processorName:s,type:c,stats:h})}catch(h){I.error(new Q(M.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,i){this.usageRegistry.find(s=>s.processorID===n.ID&&s.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:i})}unregisterUsage(n){const i=this.usageRegistry.findIndex(s=>s.processorID===n.ID&&s.processorName===n.name);-1!==i&&this.usageRegistry.splice(i,1)}gatherUsage(){var n=this;return x(function*(){const i=[];if(!n.chained)return[];for(const{cb:s}of n.usageRegistry)try{let c=s();c instanceof z&&(c=yield c),i.push(Qn(Qn({},c),{},{direction:n.direction}))}catch(c){I.error("gather extension usage error",c)}return i})()}getDirection(){return this.direction}}class fE extends kt{constructor(n){super(),C(this,"name","AudioProcessorDestination"),C(this,"ID","0"),C(this,"inputTrack",void 0),C(this,"inputNode",void 0),C(this,"audioProcessorContext",void 0),C(this,"_source",void 0),this.audioProcessorContext=n}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Q(M.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Q(M.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(fi.ON_TRACK,void 0),this.emit(fi.ON_NODE,void 0)}updateInput(n){if(n.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");n.track&&this.inputTrack!==n.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=n.track,this.emit(fi.ON_TRACK,this.inputTrack)),n.node&&this.inputNode!==n.node&&(this.audioProcessorContext.chained=!0,this.inputNode=n.node,this.emit(fi.ON_NODE,this.inputNode))}}class mE extends kt{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,i,s){super(),C(this,"constraintsMap",new Map),C(this,"statsRegistry",[]),C(this,"audioContext",void 0),C(this,"trackId",void 0),C(this,"direction",void 0),C(this,"usageRegistry",[]),C(this,"_chained",!1),this.audioContext=n,this.trackId=i,this.direction=s}getConstraints(){var n=this;return x(function*(){return dn(n,so.REQUEST_CONSTRAINTS)})()}getAudioContext(){return this.audioContext}requestApplyConstraints(n,i){var s=this;return x(function*(){var c;return I.info("processor ".concat(i.name," requestApplyConstraints for ").concat(s.trackId)),n&&s.constraintsMap.set(i,n),St(s,so.REQUEST_UPDATE_CONSTRAINTS,Array.from(vc(c=s.constraintsMap).call(c)))})()}requestRevertConstraints(n){var i=this;return x(function*(){var s;if(i.constraintsMap.has(n))return i.constraintsMap.delete(n),St(i,so.REQUEST_UPDATE_CONSTRAINTS,Array.from(vc(s=i.constraintsMap).call(s)))})()}registerStats(n,i,s){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:i,cb:s})}unregisterStats(n,i){const s=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i);-1!==s&&this.statsRegistry.splice(s,1)}gatherStats(){const n=[];for(const{processorID:i,processorName:s,type:c,cb:d}of this.statsRegistry)try{const h=d();n.push({processorID:i,processorName:s,type:c,stats:h})}catch(h){I.error(new Q(M.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,i){this.usageRegistry.find(s=>s.processorID===n.ID&&s.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:i})}unregisterUsage(n){const i=this.usageRegistry.findIndex(s=>s.processorID===n.ID&&s.processorName===n.name);-1!==i&&this.usageRegistry.splice(i,1)}gatherUsage(){var n=this;return x(function*(){const i=[];if(!n.chained)return[];for(const{cb:s}of n.usageRegistry)try{let c=s();c instanceof z&&(c=yield c),i.push(Qn(Qn({},c),{},{direction:n.direction}))}catch(c){I.error("gather extension usage error",c)}return i})()}getDirection(){return this.direction}}class JC extends kt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),C(this,"context",void 0),C(this,"processSourceNode",void 0),C(this,"outputTrack",void 0),C(this,"processedNode",void 0),C(this,"clonedTrack",void 0),C(this,"outputNode",void 0),this.outputNode=new J1}setVolume(){}createOutputTrack(){throw new Q(M.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class J1{disconnect(){}connect(){}}let gh=null;class BU{constructor(){C(this,"state","open"),C(this,"trigger",void 0),C(this,"tasks",[]),I.debug("[macro-task-queue] is created."),this.trigger=window.setTimeout(()=>{this.state="closed",I.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(n=>n.key),"]")),this.trigger=void 0,this.tasks.forEach(n=>{let{func:i}=n;return i()}),this.tasks.length=0,I.debug("[macro-task-queue] is closed.")})}enqueue(n,i){"closed"!==this.state&&(this.tasks.push({key:n,func:i}),I.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof n?n:"")))}runTask(n){if("closed"===this.state)return;const i=this.tasks.findIndex(s=>s.key===n);if(-1!==i){const s=this.tasks.splice(i,1);I.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof n?n:"")),s[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,I.debug("[macro-task-queue] is closed."))}}function uD(o){return function(n,i,s){var c;const d=null!==(c=s.value)&&void 0!==c?c:s.get,h=function(){gh&&"open"===gh.state&&gh.runTask(o);for(var p=arguments.length,m=new Array(p),_=0;_<p;_++)m[_]=arguments[_];return d?.apply(this,...m)};return s.value?s.value=h:s.get=h,s}}function Lf(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Eh(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?Lf(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Lf(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class ct extends wi{get _source(){return this._trackSource}set _source(n){this._trackSource=n}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}get processorDestination(){return this._processorDestination}set processorDestination(n){this._processorDestination=n}get isPlaying(){return this._useAudioElement?on.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(n,i,s,c,d){super(n,s),C(this,"trackMediaType","audio"),C(this,"_encoderConfig",void 0),C(this,"_trackSource",void 0),C(this,"_enabled",!0),C(this,"_volume",100),C(this,"_useAudioElement",!1),C(this,"_bypassWebAudio",!1),C(this,"processor",void 0),C(this,"_processorContext",void 0),C(this,"_processorDestination",void 0),C(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=i,this._getOriginVolumeLevel=!!c;const h=()=>{this.processorContext=new mE(this._source.context,this.getTrackId(),"local"),this.processorDestination=new fE(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Vr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},p=d&&nr()&&!K1();B("DISABLE_WEBAUDIO")?(this._source=new JC,this._useAudioElement=!0,this._bypassWebAudio=!0):p?this._source=new JC:(this._source=new _h(n,!1,this._getOriginVolumeLevel?n:void 0),B("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),h(),!B("DISABLE_WEBAUDIO")&&p&&(gh||(gh=new BU),gh).enqueue("INIT_WEBAUDIO",()=>{this._source=new _h(n,!1,this._getOriginVolumeLevel?n:void 0),B("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),h(),this.emit(Of.UPDATE_TRACK_SOURCE)})}setVolume(n){At(n,"volume",0,1e3),this._volume=n,this._source.setVolume(n/100),this._useAudioElement&&on.setVolume(this.getTrackId(),n);try{if(this._bypassWebAudio)return void I.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const i=this._source.createOutputTrack();this._mediaStreamTrack!==i&&(this._mediaStreamTrack=i,St(this,me.NEED_REPLACE_TRACK,this).then(()=>{I.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{I.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}setPlaybackDevice(n){var i=this;return x(function*(){if(!i._useAudioElement)throw new Q(M.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield on.setSinkID(i.getTrackId(),n)})()}setEnabled(n,i,s){var c=this;return x(function*(){return c._setEnabled(n,i,s)})()}_setEnabled(n,i,s){var c=this;return x(function*(){if(!s){if(n===c._enabled)return;c.stateCheck("enabled",n)}if(I.info("[".concat(c.getTrackId(),"] start setEnabled"),n),n){c._originMediaStreamTrack.enabled=!0;try{s||(c._enabled=!0),yield St(c,me.NEED_ENABLE_TRACK,c),I.info("[".concat(c.getTrackId(),"] setEnabled to ").concat(n," success"))}catch(d){throw s||(c._enabled=!1),I.error("[".concat(c.getTrackId(),"] setEnabled to true error"),d.toString()),d}}else{c._originMediaStreamTrack.enabled=!1,s||(c._enabled=!1);try{yield St(c,me.NEED_DISABLE_TRACK,c)}catch(d){throw s||(c._enabled=!0),I.error("[".concat(c.getTrackId(),"] setEnabled to false error"),d.toString()),d}}})()}setMuted(n){var i=this;return x(function*(){n!==i._muted&&(i.stateCheck("muted",n),i._muted=n,i._originMediaStreamTrack.enabled=!n,I.debug("[".concat(i.getTrackId(),"] start set muted: ").concat(n)),n?yield St(i,me.NEED_MUTE_TRACK,i):yield St(i,me.NEED_UNMUTE_TRACK,i))})()}getStats(){return uf(()=>{I.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),to(this,me.GET_STATS)||Eh({},hE)}setAudioFrameCallback(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!n)return this._source.removeAllListeners(Vr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(i),this._source.removeAllListeners(Vr.ON_AUDIO_BUFFER),this._source.on(Vr.ON_AUDIO_BUFFER,s=>n(s))}play(){I.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(I.debug("[".concat(this.getTrackId(),"] start audio playback in element")),on.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){I.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?on.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];I.debug("[".concat(this.getTrackId(),"] update player source track")),n&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&on.updateTrack(this.getTrackId(),this._mediaStreamTrack)}_updateOriginMediaStreamTrack(n,i){var s=this;return x(function*(){s._originMediaStreamTrack!==n&&(s._originMediaStreamTrack&&(s._originMediaStreamTrack.removeEventListener("ended",s._handleTrackEnded),i&&s._originMediaStreamTrack.stop()),n.addEventListener("ended",s._handleTrackEnded),s._originMediaStreamTrack=n,s._muted&&(s._originMediaStreamTrack.enabled=!1),s.processor&&s.processor.updateInput({track:n,context:s.processorContext}),s._mediaStreamTrack!==s._source.outputTrack?(s._mediaStreamTrack=s._originMediaStreamTrack,s._updatePlayerSource(),yield St(s,me.NEED_REPLACE_TRACK,s)):s._source.updateTrack(s._originMediaStreamTrack),s._getOriginVolumeLevel&&s._source.updateOriginTrack(n))})()}renewMediaStreamTrack(n){return z.resolve(void 0)}pipe(n){if(this._bypassWebAudio)throw new Q(M.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===n)return n;if(n._source)throw new Q(M.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),n}unpipe(){var n;if(!this.processor)return;const i=this.processor;null===(n=this._source.processSourceNode)||void 0===n||n.disconnect(),this.processor._source=!1,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(fi.ON_TRACK,function(){var i=x(function*(s){s?s!==n._mediaStreamTrack&&(n._mediaStreamTrack=s,n._updatePlayerSource(!1),n._source.processedNode=n._source.createMediaStreamSourceNode(s),yield St(n,me.NEED_REPLACE_TRACK,n)):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource(),yield St(n,me.NEED_REPLACE_TRACK,n))});return function(s){return i.apply(this,arguments)}}()),this.processorDestination.on(fi.ON_NODE,i=>{this._source.processedNode=i})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(fi.ON_TRACK),this.processorDestination.removeAllListeners(fi.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(so.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(so.REQUEST_CONSTRAINTS)}}te([uD("INIT_WEBAUDIO"),P("design:type",Object),P("design:paramtypes",[Object])],ct.prototype,"_source",null),te([uD("INIT_WEBAUDIO"),P("design:type",mE),P("design:paramtypes",[mE])],ct.prototype,"processorContext",null),te([uD("INIT_WEBAUDIO"),P("design:type",fE),P("design:paramtypes",[fE])],ct.prototype,"processorDestination",null),te([Ae({argsMap:(o,n)=>[o.getTrackId(),n],throttleTime:300}),P("design:type",Function),P("design:paramtypes",[Number]),P("design:returntype",void 0)],ct.prototype,"setVolume",null),te([Ae({argsMap:(o,n)=>[o.getTrackId(),n]}),ot(),P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],ct.prototype,"setPlaybackDevice",null),te([fd("LocalAudioTrack","_enabledMutex"),Ae({argsMap:(o,n)=>[o.getTrackId(),n]}),ot(),P("design:type",Function),P("design:paramtypes",[Boolean,Object,Boolean]),P("design:returntype",z)],ct.prototype,"setEnabled",null),te([fd("LocalAudioTrack","_enabledMutex"),Ae({argsMap:(o,n)=>[o.getTrackId(),n]}),ot(),P("design:type",Function),P("design:paramtypes",[Boolean]),P("design:returntype",z)],ct.prototype,"setMuted",null),te([ot(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",Object)],ct.prototype,"getStats",null),te([ot(),P("design:type",Function),P("design:paramtypes",[Object,Number]),P("design:returntype",void 0)],ct.prototype,"setAudioFrameCallback",null),te([Ae({argsMap:o=>[o.getTrackId()]}),ot(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],ct.prototype,"play",null),te([Ae({argsMap:o=>[o.getTrackId()]}),ot(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],ct.prototype,"stop",null),te([Ae({argsMap:o=>[o.getTrackId()]}),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],ct.prototype,"close",null),te([Ae({argsMap:(o,n)=>[o.getTrackId(),n.name]}),P("design:type",Function),P("design:paramtypes",[Object]),P("design:returntype",Object)],ct.prototype,"pipe",null),te([Ae({argsMap:o=>[o.getTrackId()]}),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],ct.prototype,"unpipe",null);class Qi extends ct{get __className__(){return"MicrophoneAudioTrack"}constructor(n,i,s,c){super(n,i.encoderConfig?fh(i.encoderConfig):{},c,B("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),C(this,"_config",void 0),C(this,"_deviceName","default"),C(this,"_constraints",void 0),C(this,"_originalConstraints",void 0),C(this,"_enabled",!0),this._config=i,this._constraints=s,this._originalConstraints=s,this._deviceName=n.label,"boolean"==typeof i.bypassWebAudio&&(this._bypassWebAudio=i.bypassWebAudio),(qu()||QS())&&Dt.bindInterruptDetectorTrack(this),this.on(Of.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),K1()&&this.bindProcessorContextEvents()}setDevice(n){var i=this;return x(function*(){if(I.info("[".concat(i.getTrackId(),"] start set device to ").concat(n)),i._enabled)try{const s=yield ao.getDeviceById(n),c={};c.audio=Eh({},i._constraints),c.audio.deviceId={exact:n},i._originMediaStreamTrack.stop();let d=null;try{d=yield bo(c,i.getTrackId())}catch(h){throw I.error("[".concat(i.getTrackId(),"] setDevice failed"),h.toString()),d=yield bo({audio:i._constraints},i.getTrackId()),yield i._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),h}yield i._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),i._deviceName=s.label,i._config.microphoneId=n,i._constraints.deviceId={exact:n}}catch(s){throw I.error("[".concat(i.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=yield ao.getDeviceById(n);i._deviceName=s.label,i._config.microphoneId=n,i._constraints.deviceId={exact:n}}catch(s){throw I.error("[".concat(i.getTrackId(),"] setDevice error"),s.toString()),s}I.info("[".concat(i.getTrackId(),"] set device to ").concat(n," success"))})()}setEnabled(n,i,s){var c=()=>super._setEnabled,d=this;return x(function*(){if(i)return I.debug("[".concat(d.getTrackId(),"] setEnabled false (do not close microphone)")),yield c().call(d,n);if(!s){if(n===d._enabled)return;d.stateCheck("enabled",n)}if(I.info("[".concat(d.getTrackId(),"] start setEnabled"),n),!n){var h;d._originMediaStreamTrack.onended=null,d._originMediaStreamTrack.stop(),null===(h=d._source.clonedTrack)||void 0===h||h.stop(),s||(d._enabled=!1);try{yield St(d,me.NEED_DISABLE_TRACK,d)}catch(_){throw I.error("[".concat(d.getTrackId(),"] setEnabled false failed"),_.toString()),_}return}const p=Eh({},d._constraints),m=ao.searchDeviceIdByName(d._deviceName);m&&!p.deviceId&&(p.deviceId=m);try{s||(d._enabled=!0);const _=yield bo({audio:d._constraints},d.getTrackId());yield d._updateOriginMediaStreamTrack(_.getAudioTracks()[0],!1),yield St(d,me.NEED_ENABLE_TRACK,d)}catch(_){throw s||(d._enabled=!1),I.error("[".concat(d.getTrackId(),"] setEnabled true failed"),_.toString()),_}I.info("[".concat(d.getTrackId(),"] setEnabled success"))})()}close(){super.close(),(qu()||QS())&&Dt.unbindInterruptDetectorTrack(this)}onTrackEnded(){var n=this;if((ir()||Gs())&&this._enabled&&!this._isClosed&&Dt.duringInterruption){const i=function(){var s=x(function*(){Dt.off(di.IOS_INTERRUPTION_END,i),n._enabled&&!n._isClosed&&(I.debug("[".concat(n.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),yield n.setEnabled(!1),yield n.setEnabled(!0))});return function(){return s.apply(this,arguments)}}();Dt.on(di.IOS_INTERRUPTION_END,i)}else I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ol.TRACK_ENDED)}renewMediaStreamTrack(n){var i=this;return x(function*(){const s=n||i._constraints,c=ao.searchDeviceIdByName(i._deviceName);if(c&&!s.deviceId&&(s.deviceId=c),i._constraints=s,i._enabled){i._originMediaStreamTrack.stop();const d=yield bo({audio:i._constraints},i.getTrackId());yield i._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!0)}})()}bindProcessorContextEvents(){var n=this;this.processorContext.on(so.REQUEST_UPDATE_CONSTRAINTS,function(){var i=x(function*(s,c,d){try{const h=Object.assign({},n._originalConstraints,...s);yield n.renewMediaStreamTrack(h),c()}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this.processorContext.on(so.REQUEST_CONSTRAINTS,function(){var i=x(function*(s){s(n._originMediaStreamTrack.getSettings())});return function(s){return i.apply(this,arguments)}}())}}te([Ae({argsMap:(o,n)=>[o.getTrackId(),n]}),ot(),P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],Qi.prototype,"setDevice",null),te([fd("MicrophoneAudioTrack","_enabledMutex"),Ae({argsMap:(o,n,i)=>[o.getTrackId(),n,i]}),ot(),P("design:type",Function),P("design:paramtypes",[Boolean,Boolean,Boolean]),P("design:returntype",z)],Qi.prototype,"setEnabled",null),te([Ae({argsMap:o=>[o.getTrackId()]}),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],Qi.prototype,"close",null);class Oa extends ct{get __className__(){return"BufferSourceAudioTrack"}constructor(n,i,s,c){super(i.createOutputTrack(),s,c),C(this,"source",void 0),C(this,"_bufferSource",void 0),this.source=n,this._bufferSource=i,this._bufferSource.on(Vr.AUDIO_SOURCE_STATE_CHANGE,d=>{this.safeEmit(ol.SOURCE_STATE_CHANGE,d)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(n){n&&this._bufferSource.updateOptions(n),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(n){this._bufferSource.seekAudioBuffer(n)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(n){At(n,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(n)}}te([Ae({argsMap:(o,n)=>[o.getTrackId(),n,o.duration]}),ot(),P("design:type",Function),P("design:paramtypes",[Object]),P("design:returntype",void 0)],Oa.prototype,"startProcessAudioBuffer",null),te([Ae({argsMap:o=>[o.getTrackId()]}),ot(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],Oa.prototype,"pauseProcessAudioBuffer",null),te([Ae({argsMap:o=>[o.getTrackId()]}),ot(),P("design:type",Function),P("design:paramtypes",[Number]),P("design:returntype",void 0)],Oa.prototype,"seekAudioBuffer",null),te([Ae({argsMap:o=>[o.getTrackId()]}),ot(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],Oa.prototype,"resumeProcessAudioBuffer",null),te([Ae({argsMap:o=>[o.getTrackId()]}),ot(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],Oa.prototype,"stopProcessAudioBuffer",null),te([Ae({argsMap:o=>[o.getTrackId()]}),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],Oa.prototype,"close",null),te([Ae({argsMap:o=>[o.getTrackId()]}),ot(),P("design:type",Function),P("design:paramtypes",[Number]),P("design:returntype",void 0)],Oa.prototype,"setAudioBufferPlaybackSpeed",null);class qn extends ct{get __className__(){return"MixingAudioTrack"}get isActive(){for(const n of this.trackList)if(n._enabled&&!n._isClosed&&!n.muted)return!0;return!1}constructor(){const n=Pf().createMediaStreamDestination();super(n.stream.getAudioTracks()[0],void 0,Ot(8,"track-mix-")),C(this,"trackList",void 0),C(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=n,this.trackList=[]}hasAudioTrack(n){return-1!==this.trackList.indexOf(n)}addAudioTrack(n){-1===this.trackList.indexOf(n)?(I.debug("add ".concat(n.getTrackId()," to mixing track")),n._source.outputNode.connect(this.destNode),this.trackList.push(n),this.updateEncoderConfig()):I.debug("track ".concat(n.getTrackId()," is already added"))}removeAudioTrack(n){if(-1!==this.trackList.indexOf(n)){I.debug("remove ".concat(n.getTrackId()," from mixing track"));try{n._source.outputNode.disconnect(this.destNode)}catch{}Ng(this.trackList,n),this.updateEncoderConfig()}}updateEncoderConfig(){const n={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(n.bitrate||0)&&(n.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(n.sampleRate||0)&&(n.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(n.sampleSize||0)&&(n.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(n.stereo=!0))}),this._encoderConfig=n}_updateRtpTransceiver(n){this._rtpTransceiver!==n&&(this._rtpTransceiver=n,this.trackList.forEach(i=>{i instanceof qn?i.emit(mh.TRANSCEIVER_UPDATED,n):i._updateRtpTransceiver(n)}))}}function QC(o){const n={};o.facingMode&&(n.facingMode=o.facingMode),o.cameraId&&(n.deviceId={exact:o.cameraId});const i=wa(o.encoderConfig);return null!=i.width&&(n.width=i.width),null!=i.height&&(n.height=i.height),!eC()&&i.frameRate&&(n.frameRate=i.frameRate),Et().name===gt.EDGE&&"object"==typeof n.frameRate&&(n.frameRate.max=60),zt()&&(n.frameRate={ideal:30,max:30}),n}function Q1(o){const n={};if(eC()||(void 0!==o.AGC&&(n.autoGainControl=o.AGC),void 0!==o.AEC&&(n.echoCancellation=o.AEC),void 0!==o.ANS&&(n.noiseSuppression=o.ANS,XS()&&o.ANS&&(n.googHighpassFilter=o.ANS))),o.encoderConfig){const i=fh(o.encoderConfig);n.channelCount=i.stereo?2:1,n.sampleRate=i.sampleRate,n.sampleSize=i.sampleSize}return o.microphoneId&&(n.deviceId={exact:o.microphoneId}),sf()&&(n.sampleRate=void 0),n}class Z1 extends Y1{set currentState(n){n!==this._currentState&&(this._currentState=n,this.safeEmit(Vr.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),C(this,"audioBuffer",void 0),C(this,"sourceNode",void 0),C(this,"startPlayTime",0),C(this,"startPlayOffset",0),C(this,"pausePlayTime",0),C(this,"options",void 0),C(this,"currentLoopCount",0),C(this,"currentPlaybackSpeed",100),C(this,"_currentState","stopped"),this.audioBuffer=n,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:(this.playbackSpeed/100*(this.context.currentTime-this.startPlayTime)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(n){"stopped"===this.currentState?(this.options=n,this.startPlayOffset=this.options.startPlayTime||0):I.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(n){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=n,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=n))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(n){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=n/100),this.currentPlaybackSpeed=n}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const n=this.context.createBufferSource();return n.buffer=this.audioBuffer,n.loop=!!this.options.loop,n.connect(this.outputNode),n.playbackRate.value=this.currentPlaybackSpeed/100,n}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const hD=new Map;function ZC(){return ZC=x(function*(o,n){let i=null;if("string"==typeof o){const c=hD.get(o);if(c)return I.debug("use cached audio resource: ",o),c;try{i=(yield Ks(()=>or.get(o,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(d){throw new Q(M.FETCH_AUDIO_FILE_FAILED,d.toString())}}else i=yield new z((d,h)=>{const p=new FileReader;p.onload=m=>{m.target?d(m.target.result):h(new Q(M.READ_LOCAL_AUDIO_FILE_ERROR))},p.onerror=()=>{h(new Q(M.READ_LOCAL_AUDIO_FILE_ERROR))},p.readAsArrayBuffer(o)});const s=yield function(c){const d=Pf();return new z((h,p)=>{d.decodeAudioData(c,m=>{h(m)},m=>{p(new Q(M.DECODE_AUDIO_FILE_FAILED,m.toString()))})})}(i);return"string"==typeof o&&n&&hD.set(o,s),s}),ZC.apply(this,arguments)}const eb=o=>{const n=document.createElement("canvas");return n.width=2,n.height=2,new z((i,s)=>{n.toBlob(function(){var c=x(function*(d){if(n.remove(),d){const h=yield eL(d);i({buffer:h,width:n.width,height:n.height})}else s(new Q(M.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(d){return c.apply(this,arguments)}}(),o,1)})},eL=function(){var o=x(function*(n){const i=yield n.arrayBuffer();return new Uint8Array(i)});return function(i){return o.apply(this,arguments)}}(),Vi=new class extends kt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),C(this,"_lastHiddenTime",0),C(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),I.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function _E(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function fD(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?_E(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):_E(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class tb{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(n){n!==this._videoElementStatus&&(I.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(n)),this._videoElementStatus=n)}constructor(n){C(this,"trackId",void 0),C(this,"config",void 0),C(this,"onFirstVideoFrameDecoded",void 0),C(this,"freezeTimeCounterList",[]),C(this,"renderFreezeAccTime",0),C(this,"isKeepLastFrame",!1),C(this,"timeUpdatedCount",0),C(this,"freezeTime",0),C(this,"playbackTime",0),C(this,"lastTimeUpdatedTime",0),C(this,"autoplayFailed",!1),C(this,"videoTrack",void 0),C(this,"videoElement",void 0),C(this,"cacheVideoElement",void 0),C(this,"videoElementCheckInterval",void 0),C(this,"_videoElementStatus",Ui.NONE),C(this,"isGettingVideoDimensions",!1),C(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return I.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),C(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===Dt.curState&&(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Uw())),Gw()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),C(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Ui.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Ui.CANPLAY;break;case"stalled":this.videoElementStatus=Ui.STALLED;break;case"suspend":this.videoElementStatus=Ui.SUSPEND;break;case"pause":this.videoElementStatus=Ui.PAUSED,ir()||Gs()||nr()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Ui.WAITING;break;case"abort":this.videoElementStatus=Ui.ABORT;break;case"ended":this.videoElementStatus=Ui.ENDED;break;case"emptied":this.videoElementStatus=Ui.EMPTIED;break;case"error":{this.videoElementStatus=Ui.ERROR;const s=this.videoElement.error;s&&I.error("[".concat(this.trackId,"] media error, code: ").concat(s.code,", message: ").concat(s.message));break}case"timeupdate":{const s=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=s);const c=s-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=s,Vi.lastVisibleTime<Vi.lastHiddenTime||d<Vi.lastHiddenTime||d<Vi.lastVisibleTime)return;for(c>B("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),C(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Uw())),Gw()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=n.trackId,this.config=n,this.videoElement=n.element instanceof HTMLVideoElement?n.element:document.createElement("video"),Dt.on(di.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Dt.on(di.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var n;return null!==(n=this.videoElement.parentElement)&&void 0!==n?n:void 0}updateConfig(n){this.config=n,this.trackId=n.trackId,n.element!==this.videoElement&&(this.destroy(),this.videoElement=n.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.initVideoElement())}play(n){const i=this.videoElement.play();i&&i.catch&&i.catch(c=>{n&&XC(n,"video",c.message,this.trackId),"NotAllowedError"===c.name?(I.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):I.warning("[".concat(this.trackId,"] play warning: "),c)});const s=Et();if(("Safari"===s.name&&15===Number(s.version)||qu())&&i&&i.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(c).catch(c)}}getCurrentFrame(){const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const i=n.getContext("2d");if(!i)return I.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,n.width,n.height);const s=i.getImageData(0,0,n.width,n.height);return n.remove(),s}getCurrentFrameToUint8Array(n){var i=arguments,s=this;return x(function*(){let c=i.length>1&&void 0!==i[1]?i[1]:1;const d=document.createElement("canvas");d.width=s.videoElement.videoWidth,d.height=s.videoElement.videoHeight;const h=d.getContext("2d");return h?(h.drawImage(s.videoElement,0,0,d.width,d.height),new z((p,m)=>{d.toBlob(function(){var _=x(function*(E){if(d.remove(),E){const y=yield eL(E);p({buffer:y,width:d.width,height:d.height})}else m(new Q(M.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(E){return _.apply(this,arguments)}}(),n,c<0?.1:c>1?1:c)})):yield eb(n)})()}destroy(){Dt.off(di.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Dt.off(di.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=Ui.INIT,!this.videoElementCheckInterval&&(mD.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{var d;(d=this.videoElement)!==document.body&&document.body.contains(d)||(this.videoElementStatus=Ui.DESTROYED)},1e3),B("ENABLE_VIDEO_FRAME_CALLBACK"))){var n,i;let d;const h=(p,m)=>{if(this.videoElementStatus===Ui.PLAYING){if(d){const y=m.presentationTime-d.presentationTime;y>B("VIDEO_FREEZE_DURATION")&&Vi.lastVisibleTime>=Vi.lastHiddenTime&&d.timestamp>Vi.lastVisibleTime&&d.timestamp>Vi.lastHiddenTime&&(this.renderFreezeAccTime+=y)}d=fD(fD({},m),{},{timestamp:p})}var _,E;B("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(_=(E=this.videoElement).requestVideoFrameCallback)||void 0===_||_.call(E,h))};null===(n=(i=this.videoElement).requestVideoFrameCallback)||void 0===n||n.call(i,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),sf()&&(this.videoElement.poster="noposter");const s=Et();"Safari"===s.name&&15===Number(s.version)||qu()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.videoElement.style.objectFit=this.config.fit?this.config.fit:"cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,zt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,zt()&&this.videoElement.load());const c=this.videoElement.play();void 0!==c&&c.catch(d=>{I.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){mD.forEach(n=>{this.videoElement&&this.videoElement.removeEventListener(n,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Ui.NONE}handleAutoPlayFailed(){const n=i=>{i.preventDefault(),this.videoElement.play().then(()=>{I.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(s=>{I.error(s)}),this.autoplayFailed=!1,Yu()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};Yu()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),lD()}}const mD=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class _D extends tb{constructor(n){super(n),C(this,"container",void 0),C(this,"slot",void 0),this.slot=n.element,this.updateConfig(n)}updateConfig(n){this.config=n,this.trackId=n.trackId;const i=n.element;i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.createElements())}play(n){var i;null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)&&super.play(n)}getCurrentFrame(){var n;return null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}getCurrentFrameToUint8Array(n){var i=arguments,s=()=>super.getCurrentFrameToUint8Array,c=this;return x(function*(){var d;let h=i.length>1&&void 0!==i[1]?i[1]:1;return null!==(d=c.container)&&void 0!==d&&d.contains(c.videoElement)?yield s().call(c,n,h):yield eb(n)})()}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",B("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var n;!this.container||null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var n;if(null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var n;null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function yh(o){return new z((n,i)=>{let s=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const d=ir()?"canplay":"playing";c.addEventListener(d,()=>{const h=c.videoWidth,p=c.videoHeight;!h&&zt()||(s=!0,c.srcObject=null,c.remove(),n([h,p]))}),c.srcObject=new MediaStream([o]),c.play().catch(rC),setTimeout(()=>{s||(c.srcObject=null,c.remove(),n([c.videoWidth,c.videoHeight]))},4e3)})}const tL=function(){var o=x(function*(n,i,s){const c=function(p){const m=[];for(let _=0;_<p.length;_+=2)m.push(parseInt(p.slice(_,_+2),16));return Uint8Array.from(m)}(function(p){const m="0123456789abcdef";function _(Ee){let ve,ze="";for(ve=0;ve<=3;ve++)ze+=m.charAt(Ee>>8*ve+4&15)+m.charAt(Ee>>8*ve&15);return ze}function E(Ee,ve){const ze=(65535&Ee)+(65535&ve);return(Ee>>16)+(ve>>16)+(ze>>16)<<16|65535&ze}function y(Ee,ve,ze,ht,Ct,dt){return E((bt=E(E(ve,Ee),E(ht,dt)))<<(ee=Ct)|bt>>>32-ee,ze);var bt,ee}function S(Ee,ve,ze,ht,Ct,dt,bt){return y(ve&ze|~ve&ht,Ee,ve,Ct,dt,bt)}function T(Ee,ve,ze,ht,Ct,dt,bt){return y(ve&ht|ze&~ht,Ee,ve,Ct,dt,bt)}function O(Ee,ve,ze,ht,Ct,dt,bt){return y(ve^ze^ht,Ee,ve,Ct,dt,bt)}function N(Ee,ve,ze,ht,Ct,dt,bt){return y(ze^(ve|~ht),Ee,ve,Ct,dt,bt)}const w=function(Ee){let ve;const ze=1+(Ee.length+8>>6),ht=new Array(16*ze);for(ve=0;ve<16*ze;ve++)ht[ve]=0;for(ve=0;ve<Ee.length;ve++)ht[ve>>2]|=Ee.charCodeAt(ve)<<ve%4*8;return ht[ve>>2]|=128<<ve%4*8,ht[16*ze-2]=8*Ee.length,ht}(p);let k,V,U,Y,re,K=1732584193,$=-271733879,X=-1732584194,J=271733878;for(k=0;k<w.length;k+=16)V=K,U=$,Y=X,re=J,K=S(K,$,X,J,w[k+0],7,-680876936),J=S(J,K,$,X,w[k+1],12,-389564586),X=S(X,J,K,$,w[k+2],17,606105819),$=S($,X,J,K,w[k+3],22,-1044525330),K=S(K,$,X,J,w[k+4],7,-176418897),J=S(J,K,$,X,w[k+5],12,1200080426),X=S(X,J,K,$,w[k+6],17,-1473231341),$=S($,X,J,K,w[k+7],22,-45705983),K=S(K,$,X,J,w[k+8],7,1770035416),J=S(J,K,$,X,w[k+9],12,-1958414417),X=S(X,J,K,$,w[k+10],17,-42063),$=S($,X,J,K,w[k+11],22,-1990404162),K=S(K,$,X,J,w[k+12],7,1804603682),J=S(J,K,$,X,w[k+13],12,-40341101),X=S(X,J,K,$,w[k+14],17,-1502002290),$=S($,X,J,K,w[k+15],22,1236535329),K=T(K,$,X,J,w[k+1],5,-165796510),J=T(J,K,$,X,w[k+6],9,-1069501632),X=T(X,J,K,$,w[k+11],14,643717713),$=T($,X,J,K,w[k+0],20,-373897302),K=T(K,$,X,J,w[k+5],5,-701558691),J=T(J,K,$,X,w[k+10],9,38016083),X=T(X,J,K,$,w[k+15],14,-660478335),$=T($,X,J,K,w[k+4],20,-405537848),K=T(K,$,X,J,w[k+9],5,568446438),J=T(J,K,$,X,w[k+14],9,-1019803690),X=T(X,J,K,$,w[k+3],14,-187363961),$=T($,X,J,K,w[k+8],20,1163531501),K=T(K,$,X,J,w[k+13],5,-1444681467),J=T(J,K,$,X,w[k+2],9,-51403784),X=T(X,J,K,$,w[k+7],14,1735328473),$=T($,X,J,K,w[k+12],20,-1926607734),K=O(K,$,X,J,w[k+5],4,-378558),J=O(J,K,$,X,w[k+8],11,-2022574463),X=O(X,J,K,$,w[k+11],16,1839030562),$=O($,X,J,K,w[k+14],23,-35309556),K=O(K,$,X,J,w[k+1],4,-1530992060),J=O(J,K,$,X,w[k+4],11,1272893353),X=O(X,J,K,$,w[k+7],16,-155497632),$=O($,X,J,K,w[k+10],23,-1094730640),K=O(K,$,X,J,w[k+13],4,681279174),J=O(J,K,$,X,w[k+0],11,-358537222),X=O(X,J,K,$,w[k+3],16,-722521979),$=O($,X,J,K,w[k+6],23,76029189),K=O(K,$,X,J,w[k+9],4,-640364487),J=O(J,K,$,X,w[k+12],11,-421815835),X=O(X,J,K,$,w[k+15],16,530742520),$=O($,X,J,K,w[k+2],23,-995338651),K=N(K,$,X,J,w[k+0],6,-198630844),J=N(J,K,$,X,w[k+7],10,1126891415),X=N(X,J,K,$,w[k+14],15,-1416354905),$=N($,X,J,K,w[k+5],21,-57434055),K=N(K,$,X,J,w[k+12],6,1700485571),J=N(J,K,$,X,w[k+3],10,-1894986606),X=N(X,J,K,$,w[k+10],15,-1051523),$=N($,X,J,K,w[k+1],21,-2054922799),K=N(K,$,X,J,w[k+8],6,1873313359),J=N(J,K,$,X,w[k+15],10,-30611744),X=N(X,J,K,$,w[k+6],15,-1560198380),$=N($,X,J,K,w[k+13],21,1309151649),K=N(K,$,X,J,w[k+4],6,-145523070),J=N(J,K,$,X,w[k+11],10,-1120210379),X=N(X,J,K,$,w[k+2],15,718787259),$=N($,X,J,K,w[k+9],21,-343485551),K=E(K,V),$=E($,U),X=E(X,Y),J=E(J,re);return _(K)+_($)+_(X)+_(J)}(""+i+s)).slice(0,16),d=c.slice(0,12),h=yield window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:d},h,n))});return function(i,s,c){return o.apply(this,arguments)}}(),Bi=function(){var o=x(function*(n,i,s){return yield tL(n.buffer,i,s)});return function(i,s,c){return o.apply(this,arguments)}}();function st(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Qe(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?st(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):st(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class We extends wi{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Ui.PLAYING)}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}get __className__(){return"LocalVideoTrack"}constructor(n,i,s,c,d,h){if(super(n,d),C(this,"trackMediaType","video"),C(this,"_player",void 0),C(this,"_videoVisibleTimer",null),C(this,"_previousVideoVisibleStatus",void 0),C(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),C(this,"_encoderConfig",void 0),C(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),C(this,"_optimizationMode",void 0),C(this,"_videoHeight",void 0),C(this,"_videoWidth",void 0),C(this,"_forceBitrateLimit",void 0),C(this,"_enabled",!0),C(this,"processorDestination",void 0),C(this,"_processorContext",void 0),nr()){const{width:p,height:m}=n.getSettings();this._videoWidth=p,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=s,this._optimizationMode=c,this._hints=h||[],-1===this._hints.indexOf(qt.SCREEN_TRACK))this.updateBitrateFromProfile();else if(function(p,m,_){const E=Et();return!(E.name!==p||!E.osVersion)&&115===Number(E.version)}(gt.CHROME)&&-1!==Dg().indexOf("Windows")){const p=function(m,_){if("VideoFrame"in window&&"TransformStream"in window&&Ut().supportWebRTCInsertableStream){const E=new MediaStreamTrackProcessor(m),y=new MediaStreamTrackGenerator({kind:"video"});let S,T,O=Date.now();const N=()=>{w&&(clearInterval(w),w=void 0),S&&(S.close(),S=void 0),m.stop(),T=void 0,y.removeEventListener("ended",N)};let w=window.setInterval(()=>{if(T&&S&&Date.now()-O>1e3)try{"live"===y.readyState?T.enqueue(S.clone()):N()}catch{N()}},1e3);const k=new TransformStream({transform:(V,U)=>{"live"===y.readyState?(T=U,O=Date.now(),void 0===S?(S=V,U.enqueue(V.clone())):(U.enqueue(S),S=V)):V.close()}});return y.addEventListener("ended",N),E.readable.pipeThrough(k).pipeTo(y.writable),y}}(n);p&&(I.info("local screen video track begin to inject frame"),this._mediaStreamTrack=p)}i&&-1!==this._hints.indexOf(qt.CUSTOM_TRACK)&&this.setEncoderConfiguration(i),this.processorContext=new X1(this.getTrackId(),"local"),this.processorDestination=new tt(this.processorContext),this.bindProcessorDestinationEvents()}play(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof n){const c=document.getElementById(n);c?n=c:(I.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}I.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const s=Qe(Qe(Qe({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:n});this._player?this._player.updateConfig(s):(this._player=n instanceof HTMLVideoElement?new tb(s):new _D(s),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(ol.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},B("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,I.debug("[".concat(this.getTrackId(),"] stop video playback")))}setEnabled(n,i){var s=this;return x(function*(){if(!i){if(n===s._enabled)return;s.stateCheck("enabled",n)}if(I.info("[".concat(s.getTrackId(),"] start setEnabled"),n),!n){s._originMediaStreamTrack.enabled=!1;try{yield St(s,me.NEED_DISABLE_TRACK,s)}catch(c){throw I.error("[".concat(s.getTrackId(),"] setEnabled to false error"),c.toString()),c}return i||(s._enabled=!1),void I.info("[".concat(s.getTrackId(),"] setEnabled to false success"))}s._originMediaStreamTrack.enabled=!0;try{yield St(s,me.NEED_ENABLE_TRACK,s)}catch(c){throw I.error("[".concat(s.getTrackId(),"] setEnabled to true error"),c.toString()),c}I.info("[".concat(s.getTrackId(),"] setEnabled to true success")),i||(s._enabled=!0)})()}setMuted(n){var i=this;return x(function*(){n!==i._muted&&(i.stateCheck("muted",n),i._muted=n,i._originMediaStreamTrack.enabled=!n,I.debug("[".concat(i.getTrackId(),"] start set muted: ").concat(n)),n?yield St(i,me.NEED_MUTE_TRACK,i):yield St(i,me.NEED_UNMUTE_TRACK,i))})()}setEncoderConfiguration(n,i){var s=this;return x(function*(){if(!s._enabled)throw new Q(M.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(n=wa(n),s._forceBitrateLimit&&(n.bitrateMax=s._forceBitrateLimit.max_bitrate?s._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=s._forceBitrateLimit.min_bitrate?s._forceBitrateLimit.min_bitrate:n.bitrateMin),n.width||n.height||n.frameRate){const c=QC({encoderConfig:n});(nr()||ir()||Gs())&&(c.deviceId=void 0),I.debug("[".concat(s.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(c));try{yield s._originMediaStreamTrack.applyConstraints(c),s.updateMediaStreamTrackResolution()}catch(d){const h=new Q(M.UNEXPECTED_ERROR,d.toString());throw I.error("[".concat(s.getTrackId(),"] applyConstraints error"),h.toString()),h}}s._encoderConfig=n,-1===s._hints.indexOf(qt.SCREEN_TRACK)&&s.updateBitrateFromProfile();try{yield St(s,me.NEED_UPDATE_VIDEO_ENCODER,s)}catch(c){return c.throw(I)}})()}getStats(){return uf(()=>{I.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),to(this,me.GET_STATS)||Qe({},pE)}setBeautyEffect(n){return x(function*(){I.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")})()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}getCurrentFrameImage(n){var i=arguments,s=this;return x(function*(){return s._player?s._player.getCurrentFrameToUint8Array(n,i.length>1&&void 0!==i[1]?i[1]:1):yield eb(n)})()}setBitrateLimit(n){var i=this;return x(function*(){if(I.debug("[".concat(i.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(n))),n){i._forceBitrateLimit=n,i._encoderConfig&&(i._encoderConfig.bitrateMax=i._encoderConfig.bitrateMax&&i._encoderConfig.bitrateMax<n.max_bitrate?i._encoderConfig.bitrateMax:n.max_bitrate,i._encoderConfig.bitrateMin=n.min_bitrate);try{yield St(i,me.NEED_UPDATE_VIDEO_ENCODER,i)}catch(s){return s.throw(I)}}})()}setOptimizationMode(n){var i=this;return x(function*(){if("motion"!==n&&"detail"!==n&&"balanced"!==n)return void I.error(M.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=i._optimizationMode;try{i._optimizationMode=n,yield St(i,me.SET_OPTIMIZATION_MODE,i)}catch(c){throw i._optimizationMode=s,I.error("[".concat(i.getTrackId(),"] set optimization mode failed"),c.toString()),c}I.info("[".concat(i.getTrackId(),"] set optimization mode success (").concat(n,")"))})()}setScalabiltyMode(n){if(1===n.numSpatialLayers&&1!==n.numTemporalLayers)return I.error(M.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=n,I.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(n,")"))}updateMediaStreamTrackResolution(){yh(this._originMediaStreamTrack).then(n=>{let[i,s]=n;this._videoHeight=s,this._videoWidth=i}).catch(rC)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:n,height:i,frameRate:s}=this.getMediaStreamTrackSettings();if(!n||!i||!s)return;const[c,d]=function(h,p,m,_){let E;const y=200*Math.pow(m/15,.6)*Math.pow(h*p/640/360,.75),S=y;if("STANDARD_BITRATE"===_)E=4*y;else{if("COMPATIABLE_BITRATE"!==_)return;E=2*y}return[Math.floor(E),Math.floor(S)]}(n,i,s,B("BITRATE_ADAPTER_TYPE"))||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=d,this._encoderConfig.bitrateMax=c,I.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(n,", h: ").concat(i,", fps: ").concat(s,"] => [brMax: ").concat(c,", brMin: ").concat(d,"]")))}getVideoElementVisibleStatus(){try{var n,i;const s=null==this||null===(n=this._player)||void 0===n?void 0:n.getContainerElement(),c={track:this,element:null==this||null===(i=this._player)||void 0===i?void 0:i.getVideoElement(),slot:s?.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=Zk.checkOneElementVisible(d),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;ye.reportApiInvoke(null,{tag:Je.TRACER,name:Rn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(m.visible?"Video is visible":"Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Q(M.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}renewMediaStreamTrack(n){return x(function*(){})()}pipe(n){if(this.processor===n)return n;if(n._source)throw new Q(M.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;const n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(n){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=this._encoderConfig;n&&(s=Qe(Qe({},s),wa(n))),s=Ws(s);const c=Ot(8,"track-video-cloned-"),d=new We(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,s,Ws(this._scalabilityMode),this._optimizationMode,c,Ws(this._hints));return n&&s&&d.setEncoderConfiguration(s),I.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),d}replaceTrack(n,i){var s=this;return x(function*(){if(!(n instanceof MediaStreamTrack))throw new Q(M.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==n.kind)throw new Q(M.INVALID_PARAMS,"track should be a video MediaStreamTrack");yield s._updateOriginMediaStreamTrack(n,i,!0),s.updateMediaStreamTrackResolution()})()}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(fi.ON_TRACK,function(){var i=x(function*(s){s?s!==n._mediaStreamTrack&&(n._mediaStreamTrack=s,n._updatePlayerSource(),yield St(n,me.NEED_REPLACE_TRACK,n)):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource(),yield St(n,me.NEED_REPLACE_TRACK,n))});return function(s){return i.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(fi.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(so.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(so.REQUEST_CONSTRAINTS)}}te([Ae({argsMap:(o,n,i)=>[o.getTrackId(),"string"==typeof n?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),ot(),P("design:type",Function),P("design:paramtypes",[Object,Object]),P("design:returntype",void 0)],We.prototype,"play",null),te([Ae({argsMap:o=>[o.getTrackId()]}),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],We.prototype,"stop",null),te([fd("LocalVideoTrack","_enabledMutex"),Ae({argsMap:(o,n)=>[o.getTrackId(),n]}),ot(),P("design:type",Function),P("design:paramtypes",[Boolean,Boolean]),P("design:returntype",z)],We.prototype,"setEnabled",null),te([fd("LocalVideoTrack","_enabledMutex"),Ae({argsMap:(o,n)=>[o.getTrackId(),n]}),ot(),P("design:type",Function),P("design:paramtypes",[Boolean]),P("design:returntype",z)],We.prototype,"setMuted",null),te([Ae({argsMap:(o,n)=>[o.getTrackId(),n]}),ot(),P("design:type",Function),P("design:paramtypes",[Object,Boolean]),P("design:returntype",z)],We.prototype,"setEncoderConfiguration",null),te([ot(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",Object)],We.prototype,"getStats",null),te([Ae({argsMap:(o,n,i)=>[o.getTrackId(),n,i]}),ot(),P("design:type",Function),P("design:paramtypes",[Boolean,Object]),P("design:returntype",z)],We.prototype,"setBeautyEffect",null),te([ot(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",ImageData)],We.prototype,"getCurrentFrameData",null),te([ot(),P("design:type",Function),P("design:paramtypes",[String,Number]),P("design:returntype",z)],We.prototype,"getCurrentFrameImage",null),te([ot(),P("design:type",Function),P("design:paramtypes",[Object]),P("design:returntype",z)],We.prototype,"setBitrateLimit",null),te([ot(),P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],We.prototype,"setOptimizationMode",null),te([ot(),P("design:type",Function),P("design:paramtypes",[Object]),P("design:returntype",void 0)],We.prototype,"setScalabiltyMode",null),te([ot(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],We.prototype,"updateMediaStreamTrackResolution",null),te([Ae({argsMap:(o,n)=>[o.getTrackId(),n.name]}),P("design:type",Function),P("design:paramtypes",[Object]),P("design:returntype",Object)],We.prototype,"pipe",null),te([Ae({argsMap:o=>[o.getTrackId()]}),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],We.prototype,"unpipe",null),te([Ae({argsMap:o=>[o.getTrackId()]}),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],We.prototype,"close",null),te([Ae({argsMap:(o,n,i)=>[o.getTrackId(),n.label,i]}),P("design:type",Function),P("design:paramtypes",[MediaStreamTrack,Boolean]),P("design:returntype",z)],We.prototype,"replaceTrack",null);class Qs extends We{get __className__(){return"CameraVideoTrack"}constructor(n,i,s,c,d,h){var p;super(n,wa(i.encoderConfig),c,d,h),p=this,C(this,"_config",void 0),C(this,"_originalConstraints",void 0),C(this,"_constraints",void 0),C(this,"_enabled",!0),C(this,"_deviceName","default"),C(this,"tryResumeVideoForIOS15_16WeChat",x(function*(){(qu()||QS())&&!function(){const m=Et();if(m.os!==ii.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return 15===Number(_[0])&&Number(_[1])>=2}()&&ZS()&&p._enabled&&!p._isClosed&&(I.debug("[".concat(p.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),yield p.renewMediaStreamTrack())})),this._config=i,this._originalConstraints=s,this._constraints=s,this._deviceName=n.label,this._encoderConfig=wa(this._config.encoderConfig),Dt.on(di.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Dt.on(di.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}setDevice(n){var i=this;return x(function*(){return"string"==typeof n?i._setDeviceById(n):n.deviceId?i._setDeviceById(n.deviceId):n.facingMode?i._setDeviceByFacingModel(n.facingMode):void 0})()}_setDeviceById(n){var i=this;return x(function*(){if(I.info("[".concat(i.getTrackId(),"] set device to ").concat(n)),i._enabled)try{const s=yield ao.getDeviceById(n),c={};c.video=Qe({},i._constraints),c.video.deviceId={exact:n},c.video.facingMode=void 0,i._originMediaStreamTrack.stop();let d=null;try{d=yield bo(c,i.getTrackId())}catch(h){throw I.error("[".concat(i.getTrackId(),"] setDevice failed"),h.toString()),d=yield bo({video:i._constraints},i.getTrackId()),yield i._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),h}yield i._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),i.updateMediaStreamTrackResolution(),i._deviceName=s.label,i._config.cameraId=n,i._constraints.deviceId={exact:n}}catch(s){throw I.error("[".concat(i.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=yield ao.getDeviceById(n);i._deviceName=s.label,i._config.cameraId=n,i._constraints.deviceId={exact:n}}catch(s){throw I.error("[".concat(i.getTrackId(),"] setDevice error"),s.toString()),s}I.info("[".concat(i.getTrackId(),"] setDevice success"))})()}_setDeviceByFacingModel(n){var i=this;return x(function*(){I.info("[".concat(i.getTrackId(),"] set facingMode ").concat(n));const s={video:Qe(Qe({},i._constraints),{},{deviceId:void 0,facingMode:{exact:n}})};if(i._enabled){i._originMediaStreamTrack.stop();let c=null;try{c=yield bo(s,i.getTrackId())}catch(d){throw I.error("[".concat(i.getTrackId(),"] setDeviceByFacingModel failed"),d.toString()),c=yield bo({video:i._constraints},i.getTrackId()),yield i._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),d}yield i._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),i.updateMediaStreamTrackResolution()}i._deviceName="",i._config.facingMode=n,i._config.cameraId=void 0,i._constraints=Qe({},s.video),I.info("[".concat(i.getTrackId(),"] setDeviceByFacingModel success"))})()}setEnabled(n,i){var s=this;return x(function*(){if(!i){if(n===s._enabled)return;s.stateCheck("enabled",n)}if(I.info("[".concat(s.getTrackId(),"] start setEnabled"),n),n){try{if(s.isExternalTrack)s._originMediaStreamTrack.enabled=!0;else{const c=yield bo({video:s._constraints},s.getTrackId());yield s._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1)}yield St(s,me.NEED_ENABLE_TRACK,s)}catch(c){throw I.error("[".concat(s.getTrackId(),"] setEnabled true error"),c.toString()),c}s.updateMediaStreamTrackResolution(),I.info("[".concat(s.getTrackId(),"] setEnabled to true success")),i||(s._enabled=!0)}else{s.isExternalTrack?s._originMediaStreamTrack.enabled=!1:(s._originMediaStreamTrack.onended=null,s._originMediaStreamTrack.stop()),i||(s._enabled=!1);try{yield St(s,me.NEED_DISABLE_TRACK,s)}catch(c){throw I.error("[".concat(s.getTrackId(),"] setEnabled to false error"),c.toString()),c}I.info("[".concat(s.getTrackId(),"] setEnabled to false success"))}})()}setEncoderConfiguration(n,i){var s=this;return x(function*(){if(!s._enabled)throw new Q(M.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");n=wa(n),s._forceBitrateLimit&&(n.bitrateMax=s._forceBitrateLimit.max_bitrate?s._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=s._forceBitrateLimit.min_bitrate?s._forceBitrateLimit.min_bitrate:n.bitrateMin);const c=mn(s._config);c.encoderConfig=n;const d=QC(c);(nr()||ir()||Gs())&&(d.deviceId=void 0),I.debug("[".concat(s.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(d));try{yield s._originMediaStreamTrack.applyConstraints(d),s.updateMediaStreamTrackResolution()}catch(h){const p=new Q(M.UNEXPECTED_ERROR,h.toString());throw I.error("[".concat(s.getTrackId(),"] applyConstraints error"),p.toString()),p}s._config=c,s._constraints=d,s._originalConstraints=d,s._encoderConfig=n,-1===s._hints.indexOf(qt.SCREEN_TRACK)&&s.updateBitrateFromProfile();try{yield St(s,me.NEED_UPDATE_VIDEO_ENCODER,s)}catch(h){return h.throw(I)}})()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){var n=this;if((ir()||Gs())&&this._enabled&&!this._isClosed&&Dt.duringInterruption){const i=function(){var s=x(function*(){Dt.off(di.IOS_INTERRUPTION_END,i),n._enabled&&!n._isClosed&&(I.debug("[".concat(n.getTrackId(),"] try capture camera media device for interrupted iOS device.")),yield n.setEnabled(!1),yield n.setEnabled(!0))});return function(){return s.apply(this,arguments)}}();Dt.on(di.IOS_INTERRUPTION_END,i)}else I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ol.TRACK_ENDED)}renewMediaStreamTrack(n){var i=this;return x(function*(){const s=n||i._constraints,c=ao.searchDeviceIdByName(i._deviceName);if(c&&!s.deviceId&&(s.deviceId={exact:c}),i._enabled){const d=yield bo({video:s},i.getTrackId());i._constraints=s,yield i._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!0),i.updateMediaStreamTrackResolution()}})()}close(){super.close(),Dt.off(di.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Dt.off(di.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(n){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=this._encoderConfig;n&&(s=Qe(Qe({},s),wa(n))),s=Ws(s);const c=Ot(8,"track-cam-cloned-"),d=new Qs(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,Ws(Qe(Qe({},this._config),{},{encoderConfig:s})),Ws(this._constraints),Ws(this._scalabilityMode),this._optimizationMode,c);return n&&s&&d.setEncoderConfiguration(s),I.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),d}bindProcessorContextEvents(){var n=this;this.processorContext.on(so.REQUEST_UPDATE_CONSTRAINTS,function(){var i=x(function*(s,c,d){try{const h=Object.assign({},n._originalConstraints,...s);yield n.renewMediaStreamTrack(h),c()}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this.processorContext.on(so.REQUEST_CONSTRAINTS,function(){var i=x(function*(s){s(n._originMediaStreamTrack.getSettings())});return function(s){return i.apply(this,arguments)}}())}}function Na(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Dd(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?Na(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Na(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function qo(o,n,i,s){i.optimizationMode&&(s&&s.width&&s.height?(i.encoderConfig=Dd(Dd({},s),{},{bitrateMin:s.bitrateMin,bitrateMax:s.bitrateMax}),"motion"!==i.optimizationMode&&"detail"!==i.optimizationMode||(n.contentHint=i.optimizationMode,n.contentHint===i.optimizationMode?I.debug("[".concat(o,"] set content hint to"),i.optimizationMode):I.debug("[".concat(o,"] set content hint failed")))):I.warning("[".concat(o,"] can not apply optimization mode bitrate config, no encoderConfig")))}function gD(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function mi(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?gD(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):gD(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}te([Ae({argsMap:(o,n)=>[o.getTrackId(),n]}),ot(),P("design:type",Function),P("design:paramtypes",[Object]),P("design:returntype",z)],Qs.prototype,"setDevice",null),te([fd("CameraVideoTrack","_enabledMutex"),Ae({argsMap:(o,n)=>[o.getTrackId(),n]}),ot(),P("design:type",Function),P("design:paramtypes",[Boolean,Boolean]),P("design:returntype",z)],Qs.prototype,"setEnabled",null),te([Ae({argsMap:(o,n)=>[o.getTrackId(),n]}),ot(),P("design:type",Function),P("design:paramtypes",[Object,Boolean]),P("design:returntype",z)],Qs.prototype,"setEncoderConfiguration",null),te([Ae({argsMap:o=>[o.getTrackId()]}),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],Qs.prototype,"close",null);class ED extends z1{getUserId(){return this._userId}constructor(n,i,s,c){super(n,"track-".concat(n.kind,"-").concat(i,"-").concat(c.clientId,"_").concat(Ot(5,""))),C(this,"_userId",void 0),C(this,"_uintId",void 0),C(this,"_isDestroyed",!1),C(this,"store",void 0),C(this,"processor",void 0),this._userId=i,this._uintId=s,this.store=c}_updateOriginMediaStreamTrack(n){this._originMediaStreamTrack=n,this._mediaStreamTrack=n,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,I.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}class Jt extends ED{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Ui.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(n,i,s,c){super(n,i,s,c),C(this,"_videoVisibleTimer",null),C(this,"_previousVideoVisibleStatus",void 0),C(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),C(this,"trackMediaType","video"),C(this,"_videoWidth",void 0),C(this,"_videoHeight",void 0),C(this,"_player",void 0),C(this,"processorDestination",void 0),C(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new X1(this.getTrackId(),"remote"),this.processorDestination=new tt(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return uf(()=>{I.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),to(this,me.GET_STATS)||mi({},HC)}play(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof n){const c=document.getElementById(n);c?n=c:(I.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}I.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const s=mi(mi({fit:"cover"},i),{},{trackId:this.getTrackId(),element:n});this._player?this._player.updateConfig(s):(this._player=n instanceof HTMLVideoElement?new tb(s):new _D(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Rd.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Rd.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},B("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,I.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){yh(this._originMediaStreamTrack).then(n=>{let[i,s]=n;this._videoHeight=s,this._videoWidth=i}).catch(rC)}_updatePlayerSource(){I.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var n,i;const s=null==this||null===(n=this._player)||void 0===n?void 0:n.getContainerElement(),c={track:this,element:null==this||null===(i=this._player)||void 0===i?void 0:i.getVideoElement(),slot:s?.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=Zk.checkOneElementVisible(d),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;ye.reportApiInvoke(null,{tag:Je.TRACER,name:Rn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(m.visible?"Video is visible":"Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Q(M.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(n){if(this.processor===n)return n;if(n._source)throw new Q(M.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;const n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(fi.ON_TRACK,function(){var i=x(function*(s){s?s!==n._mediaStreamTrack&&(n._mediaStreamTrack=s,n._updatePlayerSource()):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource())});return function(s){return i.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(fi.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}te([Ae({argsMap:(o,n,i)=>[o.getTrackId(),"string"==typeof n?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),P("design:type",Function),P("design:paramtypes",[Object,Object]),P("design:returntype",void 0)],Jt.prototype,"play",null),te([Ae({argsMap:o=>[o.getTrackId()]}),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],Jt.prototype,"stop",null),te([Ae({argsMap:(o,n)=>[o.getTrackId(),n.name]}),P("design:type",Function),P("design:paramtypes",[Object]),P("design:returntype",Object)],Jt.prototype,"pipe",null),te([Ae({argsMap:o=>[o.getTrackId()]}),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],Jt.prototype,"unpipe",null);class ys extends ED{get isPlaying(){return this._useAudioElement?on.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(n,i,s,c){super(n,i,s,c),C(this,"trackMediaType","audio"),C(this,"_source",void 0),C(this,"_useAudioElement",!0),C(this,"_volume",100),C(this,"processorContext",void 0),C(this,"processorDestination",void 0),C(this,"_played",!1),C(this,"_bypassWebAudio",!1),B("DISABLE_WEBAUDIO")?(this._source=new JC,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new _h(n,!0),B("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Vr.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Rd.FIRST_FRAME_DECODED)}),this.processorContext=new mE(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new fE(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Vr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!n)return this._source.removeAllListeners(Vr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(i),this._source.removeAllListeners(Vr.ON_AUDIO_BUFFER),this._source.on(Vr.ON_AUDIO_BUFFER,s=>n(s))}setVolume(n){this._volume=n,this._useAudioElement?on.setVolume(this.getTrackId(),n):this._source.setVolume(n/100)}setPlaybackDevice(n){var i=this;return x(function*(){if(!i._useAudioElement)throw new Q(M.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield on.setSinkID(i.getTrackId(),n)})()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return uf(()=>{I.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),to(this,me.GET_STATS)||mi({},nD)}play(){I.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(I.debug("[".concat(this.getTrackId(),"] use audio element to play")),on.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){I.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?on.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];I.debug("[".concat(this.getTrackId(),"] update player source track")),n&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&on.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(n){if(this._bypassWebAudio)throw new Q(M.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===n)return n;if(n._source)throw new Q(M.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),n}unpipe(){var n;if(this._bypassWebAudio)throw new Q(M.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const i=this.processor;null===(n=this._source.processSourceNode)||void 0===n||n.disconnect(),this.processor._source=!1,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(fi.ON_TRACK,function(){var i=x(function*(s){s?s!==n._mediaStreamTrack&&(n._mediaStreamTrack=s,n._updatePlayerSource(!1),n._source.processedNode=n._source.createMediaStreamSourceNode(s)):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource())});return function(s){return i.apply(this,arguments)}}()),this.processorDestination.on(fi.ON_NODE,i=>{this._source.processedNode=i;const s=!i;this._useAudioElement!==s&&(this._played?(this.stop(),this._useAudioElement=s,this.play()):this._useAudioElement=s)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(fi.ON_TRACK),this.processorDestination.removeAllListeners(fi.ON_NODE)}}function Cc(o){let n=o.length;for(;--n>=0;)o[n]=0}te([Ae({argsMap:(o,n)=>[o.getTrackId(),n],throttleTime:300}),P("design:type",Function),P("design:paramtypes",[Number]),P("design:returntype",void 0)],ys.prototype,"setVolume",null),te([Ae({argsMap:(o,n)=>[o.getTrackId(),n]}),P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],ys.prototype,"setPlaybackDevice",null),te([Ae({argsMap:o=>[o.getTrackId()]}),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],ys.prototype,"play",null),te([Ae({argsMap:o=>[o.getTrackId()]}),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],ys.prototype,"stop",null),te([Ae({argsMap:(o,n)=>[o.getTrackId(),n.name]}),P("design:type",Function),P("design:paramtypes",[Object]),P("design:returntype",Object)],ys.prototype,"pipe",null),te([Ae({argsMap:o=>[o.getTrackId()]}),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],ys.prototype,"unpipe",null);const Uf=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Od=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),ib=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),yD=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Pa=new Array(576);Cc(Pa);const Vf=new Array(60);Cc(Vf);const Bf=new Array(512);Cc(Bf);const jf=new Array(256);Cc(jf);const rb=new Array(29);Cc(rb);const Hf=new Array(30);function ob(o,n,i,s,c){this.static_tree=o,this.extra_bits=n,this.extra_base=i,this.elems=s,this.max_length=c,this.has_stree=o&&o.length}let sb,Gf,Sh;function ab(o,n){this.dyn_tree=o,this.max_code=0,this.stat_desc=n}Cc(Hf);const vD=o=>o<256?Bf[o]:Bf[256+(o>>>7)],Nd=(o,n)=>{o.pending_buf[o.pending++]=255&n,o.pending_buf[o.pending++]=n>>>8&255},co=(o,n,i)=>{o.bi_valid>16-i?(o.bi_buf|=n<<o.bi_valid&65535,Nd(o,o.bi_buf),o.bi_buf=n>>16-o.bi_valid,o.bi_valid+=i-16):(o.bi_buf|=n<<o.bi_valid&65535,o.bi_valid+=i)},Ma=(o,n,i)=>{co(o,i[2*n],i[2*n+1])},gE=(o,n)=>{let i=0;do{i|=1&o,o>>>=1,i<<=1}while(--n>0);return i>>>1},SD=(o,n,i)=>{const s=new Array(16);let c,d,h=0;for(c=1;c<=15;c++)h=h+i[c-1]<<1,s[c]=h;for(d=0;d<=n;d++){let p=o[2*d+1];0!==p&&(o[2*d]=gE(s[p]++,p))}},CD=o=>{let n;for(n=0;n<286;n++)o.dyn_ltree[2*n]=0;for(n=0;n<30;n++)o.dyn_dtree[2*n]=0;for(n=0;n<19;n++)o.bl_tree[2*n]=0;o.dyn_ltree[512]=1,o.opt_len=o.static_len=0,o.sym_next=o.matches=0},bD=o=>{o.bi_valid>8?Nd(o,o.bi_buf):o.bi_valid>0&&(o.pending_buf[o.pending++]=o.bi_buf),o.bi_buf=0,o.bi_valid=0},EE=(o,n,i,s)=>{const c=2*n,d=2*i;return o[c]<o[d]||o[c]===o[d]&&s[n]<=s[i]},cb=(o,n,i)=>{const s=o.heap[i];let c=i<<1;for(;c<=o.heap_len&&(c<o.heap_len&&EE(n,o.heap[c+1],o.heap[c],o.depth)&&c++,!EE(n,s,o.heap[c],o.depth));)o.heap[i]=o.heap[c],i=c,c<<=1;o.heap[i]=s},TD=(o,n,i)=>{let s,c,d,h,p=0;if(0!==o.sym_next)do{s=255&o.pending_buf[o.sym_buf+p++],s+=(255&o.pending_buf[o.sym_buf+p++])<<8,c=o.pending_buf[o.sym_buf+p++],0===s?Ma(o,c,n):(d=jf[c],Ma(o,d+256+1,n),h=Uf[d],0!==h&&(c-=rb[d],co(o,c,h)),s--,d=vD(s),Ma(o,d,i),h=Od[d],0!==h&&(s-=Hf[d],co(o,s,h)))}while(p<o.sym_next);Ma(o,256,n)},lb=(o,n)=>{const i=n.dyn_tree,s=n.stat_desc.static_tree,c=n.stat_desc.has_stree,d=n.stat_desc.elems;let h,p,m,_=-1;for(o.heap_len=0,o.heap_max=573,h=0;h<d;h++)0!==i[2*h]?(o.heap[++o.heap_len]=_=h,o.depth[h]=0):i[2*h+1]=0;for(;o.heap_len<2;)m=o.heap[++o.heap_len]=_<2?++_:0,i[2*m]=1,o.depth[m]=0,o.opt_len--,c&&(o.static_len-=s[2*m+1]);for(n.max_code=_,h=o.heap_len>>1;h>=1;h--)cb(o,i,h);m=d;do{h=o.heap[1],o.heap[1]=o.heap[o.heap_len--],cb(o,i,1),p=o.heap[1],o.heap[--o.heap_max]=h,o.heap[--o.heap_max]=p,i[2*m]=i[2*h]+i[2*p],o.depth[m]=(o.depth[h]>=o.depth[p]?o.depth[h]:o.depth[p])+1,i[2*h+1]=i[2*p+1]=m,o.heap[1]=m++,cb(o,i,1)}while(o.heap_len>=2);o.heap[--o.heap_max]=o.heap[1],((E,y)=>{const S=y.dyn_tree,T=y.max_code,O=y.stat_desc.static_tree,N=y.stat_desc.has_stree,w=y.stat_desc.extra_bits,k=y.stat_desc.extra_base,V=y.stat_desc.max_length;let U,Y,re,K,$,X,J=0;for(K=0;K<=15;K++)E.bl_count[K]=0;for(S[2*E.heap[E.heap_max]+1]=0,U=E.heap_max+1;U<573;U++)Y=E.heap[U],K=S[2*S[2*Y+1]+1]+1,K>V&&(K=V,J++),S[2*Y+1]=K,Y>T||(E.bl_count[K]++,$=0,Y>=k&&($=w[Y-k]),X=S[2*Y],E.opt_len+=X*(K+$),N&&(E.static_len+=X*(O[2*Y+1]+$)));if(0!==J){do{for(K=V-1;0===E.bl_count[K];)K--;E.bl_count[K]--,E.bl_count[K+1]+=2,E.bl_count[V]--,J-=2}while(J>0);for(K=V;0!==K;K--)for(Y=E.bl_count[K];0!==Y;)re=E.heap[--U],re>T||(S[2*re+1]!==K&&(E.opt_len+=(K-S[2*re+1])*S[2*re],S[2*re+1]=K),Y--)}})(o,n),SD(i,_,o.bl_count)},yE=(o,n,i)=>{let s,c,d=-1,h=n[1],p=0,m=7,_=4;for(0===h&&(m=138,_=3),n[2*(i+1)+1]=65535,s=0;s<=i;s++)c=h,h=n[2*(s+1)+1],++p<m&&c===h||(p<_?o.bl_tree[2*c]+=p:0!==c?(c!==d&&o.bl_tree[2*c]++,o.bl_tree[32]++):p<=10?o.bl_tree[34]++:o.bl_tree[36]++,p=0,d=c,0===h?(m=138,_=3):c===h?(m=6,_=3):(m=7,_=4))},vE=(o,n,i)=>{let s,c,d=-1,h=n[1],p=0,m=7,_=4;for(0===h&&(m=138,_=3),s=0;s<=i;s++)if(c=h,h=n[2*(s+1)+1],!(++p<m&&c===h)){if(p<_)do{Ma(o,c,o.bl_tree)}while(0!=--p);else 0!==c?(c!==d&&(Ma(o,c,o.bl_tree),p--),Ma(o,16,o.bl_tree),co(o,p-3,2)):p<=10?(Ma(o,17,o.bl_tree),co(o,p-3,3)):(Ma(o,18,o.bl_tree),co(o,p-11,7));p=0,d=c,0===h?(m=138,_=3):c===h?(m=6,_=3):(m=7,_=4)}};let db=!1;const ID=(o,n,i,s)=>{co(o,0+(s?1:0),3),bD(o),Nd(o,i),Nd(o,~i),i&&o.pending_buf.set(o.window.subarray(n,n+i),o.pending),o.pending+=i};var iL={_tr_init:o=>{db||((()=>{let n,i,s,c,d;const h=new Array(16);for(s=0,c=0;c<28;c++)for(rb[c]=s,n=0;n<1<<Uf[c];n++)jf[s++]=c;for(jf[s-1]=c,d=0,c=0;c<16;c++)for(Hf[c]=d,n=0;n<1<<Od[c];n++)Bf[d++]=c;for(d>>=7;c<30;c++)for(Hf[c]=d<<7,n=0;n<1<<Od[c]-7;n++)Bf[256+d++]=c;for(i=0;i<=15;i++)h[i]=0;for(n=0;n<=143;)Pa[2*n+1]=8,n++,h[8]++;for(;n<=255;)Pa[2*n+1]=9,n++,h[9]++;for(;n<=279;)Pa[2*n+1]=7,n++,h[7]++;for(;n<=287;)Pa[2*n+1]=8,n++,h[8]++;for(SD(Pa,287,h),n=0;n<30;n++)Vf[2*n+1]=5,Vf[2*n]=gE(n,5);sb=new ob(Pa,Uf,257,286,15),Gf=new ob(Vf,Od,0,30,15),Sh=new ob(new Array(0),ib,0,19,7)})(),db=!0),o.l_desc=new ab(o.dyn_ltree,sb),o.d_desc=new ab(o.dyn_dtree,Gf),o.bl_desc=new ab(o.bl_tree,Sh),o.bi_buf=0,o.bi_valid=0,CD(o)},_tr_stored_block:ID,_tr_flush_block:(o,n,i,s)=>{let c,d,h=0;o.level>0?(2===o.strm.data_type&&(o.strm.data_type=(p=>{let m,_=4093624447;for(m=0;m<=31;m++,_>>>=1)if(1&_&&0!==p.dyn_ltree[2*m])return 0;if(0!==p.dyn_ltree[18]||0!==p.dyn_ltree[20]||0!==p.dyn_ltree[26])return 1;for(m=32;m<256;m++)if(0!==p.dyn_ltree[2*m])return 1;return 0})(o)),lb(o,o.l_desc),lb(o,o.d_desc),h=(p=>{let m;for(yE(p,p.dyn_ltree,p.l_desc.max_code),yE(p,p.dyn_dtree,p.d_desc.max_code),lb(p,p.bl_desc),m=18;m>=3&&0===p.bl_tree[2*yD[m]+1];m--);return p.opt_len+=3*(m+1)+5+5+4,m})(o),c=o.opt_len+3+7>>>3,d=o.static_len+3+7>>>3,d<=c&&(c=d)):c=d=i+5,i+4<=c&&-1!==n?ID(o,n,i,s):4===o.strategy||d===c?(co(o,2+(s?1:0),3),TD(o,Pa,Vf)):(co(o,4+(s?1:0),3),((p,m,_,E)=>{let y;for(co(p,m-257,5),co(p,_-1,5),co(p,E-4,4),y=0;y<E;y++)co(p,p.bl_tree[2*yD[y]+1],3);vE(p,p.dyn_ltree,m-1),vE(p,p.dyn_dtree,_-1)})(o,o.l_desc.max_code+1,o.d_desc.max_code+1,h+1),TD(o,o.dyn_ltree,o.dyn_dtree)),CD(o),s&&bD(o)},_tr_tally:(o,n,i)=>(o.pending_buf[o.sym_buf+o.sym_next++]=n,o.pending_buf[o.sym_buf+o.sym_next++]=n>>8,o.pending_buf[o.sym_buf+o.sym_next++]=i,0===n?o.dyn_ltree[2*i]++:(o.matches++,n--,o.dyn_ltree[2*(jf[i]+256+1)]++,o.dyn_dtree[2*vD(n)]++),o.sym_next===o.sym_end),_tr_align:o=>{var n;co(o,2,3),Ma(o,256,Pa),16===(n=o).bi_valid?(Nd(n,n.bi_buf),n.bi_buf=0,n.bi_valid=0):n.bi_valid>=8&&(n.pending_buf[n.pending++]=255&n.bi_buf,n.bi_buf>>=8,n.bi_valid-=8)}},Ch=(o,n,i,s)=>{let c=65535&o|0,d=o>>>16&65535|0,h=0;for(;0!==i;){h=i>2e3?2e3:i,i-=h;do{c=c+n[s++]|0,d=d+c|0}while(--h);c%=65521,d%=65521}return c|d<<16|0};const RD=new Uint32Array((()=>{let o,n=[];for(var i=0;i<256;i++){o=i;for(var s=0;s<8;s++)o=1&o?3988292384^o>>>1:o>>>1;n[i]=o}return n})());var ar=(o,n,i,s)=>{const c=RD,d=s+i;o^=-1;for(let h=s;h<d;h++)o=o>>>8^c[255&(o^n[h])];return-1^o},al={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Pd={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:rL,_tr_stored_block:cl,_tr_flush_block:oL,_tr_tally:bc,_tr_align:hb}=iL,{Z_NO_FLUSH:Zs,Z_PARTIAL_FLUSH:wD,Z_FULL_FLUSH:sL,Z_FINISH:ea,Z_BLOCK:pb,Z_OK:gr,Z_STREAM_END:AD,Z_STREAM_ERROR:ka,Z_DATA_ERROR:HU,Z_BUF_ERROR:Yo,Z_DEFAULT_COMPRESSION:aL,Z_FILTERED:cL,Z_HUFFMAN_ONLY:SE,Z_RLE:lL,Z_FIXED:CE,Z_DEFAULT_STRATEGY:dL,Z_UNKNOWN:uL,Z_DEFLATED:bE}=Pd,La=262,Ld=(o,n)=>(o.msg=al[n],n),DD=o=>2*o-(o>4?9:0),ll=o=>{let n=o.length;for(;--n>=0;)o[n]=0},mb=o=>{let n,i,s,c=o.w_size;n=o.hash_size,s=n;do{i=o.head[--s],o.head[s]=i>=c?i-c:0}while(--n);n=c,s=n;do{i=o.prev[--s],o.prev[s]=i>=c?i-c:0}while(--n)};let xa=(o,n,i)=>(n<<o.hash_shift^i)&o.hash_mask;const $o=o=>{const n=o.state;let i=n.pending;i>o.avail_out&&(i=o.avail_out),0!==i&&(o.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+i),o.next_out),o.next_out+=i,n.pending_out+=i,o.total_out+=i,o.avail_out-=i,n.pending-=i,0===n.pending&&(n.pending_out=0))},vs=(o,n)=>{oL(o,o.block_start>=0?o.block_start:-1,o.strstart-o.block_start,n),o.block_start=o.strstart,$o(o.strm)},sn=(o,n)=>{o.pending_buf[o.pending++]=n},Ih=(o,n)=>{o.pending_buf[o.pending++]=n>>>8&255,o.pending_buf[o.pending++]=255&n},_b=(o,n,i,s)=>{let c=o.avail_in;return c>s&&(c=s),0===c?0:(o.avail_in-=c,n.set(o.input.subarray(o.next_in,o.next_in+c),i),1===o.state.wrap?o.adler=Ch(o.adler,n,c,i):2===o.state.wrap&&(o.adler=ar(o.adler,n,c,i)),o.next_in+=c,o.total_in+=c,c)},OD=(o,n)=>{let i,s,c=o.max_chain_length,d=o.strstart,h=o.prev_length,p=o.nice_match;const m=o.strstart>o.w_size-La?o.strstart-(o.w_size-La):0,_=o.window,E=o.w_mask,y=o.prev,S=o.strstart+258;let T=_[d+h-1],O=_[d+h];o.prev_length>=o.good_match&&(c>>=2),p>o.lookahead&&(p=o.lookahead);do{if(i=n,_[i+h]===O&&_[i+h-1]===T&&_[i]===_[d]&&_[++i]===_[d+1]){d+=2,i++;do{}while(_[++d]===_[++i]&&_[++d]===_[++i]&&_[++d]===_[++i]&&_[++d]===_[++i]&&_[++d]===_[++i]&&_[++d]===_[++i]&&_[++d]===_[++i]&&_[++d]===_[++i]&&d<S);if(s=258-(S-d),d=S-258,s>h){if(o.match_start=n,h=s,s>=p)break;T=_[d+h-1],O=_[d+h]}}}while((n=y[n&E])>m&&0!=--c);return h<=o.lookahead?h:o.lookahead},Rh=o=>{const n=o.w_size;let i,s,c;do{if(s=o.window_size-o.lookahead-o.strstart,o.strstart>=n+(n-La)&&(o.window.set(o.window.subarray(n,n+n-s),0),o.match_start-=n,o.strstart-=n,o.block_start-=n,o.insert>o.strstart&&(o.insert=o.strstart),mb(o),s+=n),0===o.strm.avail_in)break;if(i=_b(o.strm,o.window,o.strstart+o.lookahead,s),o.lookahead+=i,o.lookahead+o.insert>=3)for(c=o.strstart-o.insert,o.ins_h=o.window[c],o.ins_h=xa(o,o.ins_h,o.window[c+1]);o.insert&&(o.ins_h=xa(o,o.ins_h,o.window[c+3-1]),o.prev[c&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=c,c++,o.insert--,!(o.lookahead+o.insert<3)););}while(o.lookahead<La&&0!==o.strm.avail_in)},ND=(o,n)=>{let i,s,c,d=o.pending_buf_size-5>o.w_size?o.w_size:o.pending_buf_size-5,h=0,p=o.strm.avail_in;do{if(i=65535,c=o.bi_valid+42>>3,o.strm.avail_out<c||(c=o.strm.avail_out-c,s=o.strstart-o.block_start,i>s+o.strm.avail_in&&(i=s+o.strm.avail_in),i>c&&(i=c),i<d&&(0===i&&n!==ea||n===Zs||i!==s+o.strm.avail_in)))break;h=n===ea&&i===s+o.strm.avail_in?1:0,cl(o,0,0,h),o.pending_buf[o.pending-4]=i,o.pending_buf[o.pending-3]=i>>8,o.pending_buf[o.pending-2]=~i,o.pending_buf[o.pending-1]=~i>>8,$o(o.strm),s&&(s>i&&(s=i),o.strm.output.set(o.window.subarray(o.block_start,o.block_start+s),o.strm.next_out),o.strm.next_out+=s,o.strm.avail_out-=s,o.strm.total_out+=s,o.block_start+=s,i-=s),i&&(_b(o.strm,o.strm.output,o.strm.next_out,i),o.strm.next_out+=i,o.strm.avail_out-=i,o.strm.total_out+=i)}while(0===h);return p-=o.strm.avail_in,p&&(p>=o.w_size?(o.matches=2,o.window.set(o.strm.input.subarray(o.strm.next_in-o.w_size,o.strm.next_in),0),o.strstart=o.w_size,o.insert=o.strstart):(o.window_size-o.strstart<=p&&(o.strstart-=o.w_size,o.window.set(o.window.subarray(o.w_size,o.w_size+o.strstart),0),o.matches<2&&o.matches++,o.insert>o.strstart&&(o.insert=o.strstart)),o.window.set(o.strm.input.subarray(o.strm.next_in-p,o.strm.next_in),o.strstart),o.strstart+=p,o.insert+=p>o.w_size-o.insert?o.w_size-o.insert:p),o.block_start=o.strstart),o.high_water<o.strstart&&(o.high_water=o.strstart),h?4:n!==Zs&&n!==ea&&0===o.strm.avail_in&&o.strstart===o.block_start?2:(c=o.window_size-o.strstart,o.strm.avail_in>c&&o.block_start>=o.w_size&&(o.block_start-=o.w_size,o.strstart-=o.w_size,o.window.set(o.window.subarray(o.w_size,o.w_size+o.strstart),0),o.matches<2&&o.matches++,c+=o.w_size,o.insert>o.strstart&&(o.insert=o.strstart)),c>o.strm.avail_in&&(c=o.strm.avail_in),c&&(_b(o.strm,o.window,o.strstart,c),o.strstart+=c,o.insert+=c>o.w_size-o.insert?o.w_size-o.insert:c),o.high_water<o.strstart&&(o.high_water=o.strstart),c=o.bi_valid+42>>3,c=o.pending_buf_size-c>65535?65535:o.pending_buf_size-c,d=c>o.w_size?o.w_size:c,s=o.strstart-o.block_start,(s>=d||(s||n===ea)&&n!==Zs&&0===o.strm.avail_in&&s<=c)&&(i=s>c?c:s,h=n===ea&&0===o.strm.avail_in&&i===s?1:0,cl(o,o.block_start,i,h),o.block_start+=i,$o(o.strm)),h?3:1)},PD=(o,n)=>{let i,s;for(;;){if(o.lookahead<La){if(Rh(o),o.lookahead<La&&n===Zs)return 1;if(0===o.lookahead)break}if(i=0,o.lookahead>=3&&(o.ins_h=xa(o,o.ins_h,o.window[o.strstart+3-1]),i=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),0!==i&&o.strstart-i<=o.w_size-La&&(o.match_length=OD(o,i)),o.match_length>=3)if(s=bc(o,o.strstart-o.match_start,o.match_length-3),o.lookahead-=o.match_length,o.match_length<=o.max_lazy_match&&o.lookahead>=3){o.match_length--;do{o.strstart++,o.ins_h=xa(o,o.ins_h,o.window[o.strstart+3-1]),i=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart}while(0!=--o.match_length);o.strstart++}else o.strstart+=o.match_length,o.match_length=0,o.ins_h=o.window[o.strstart],o.ins_h=xa(o,o.ins_h,o.window[o.strstart+1]);else s=bc(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++;if(s&&(vs(o,!1),0===o.strm.avail_out))return 1}return o.insert=o.strstart<2?o.strstart:2,n===ea?(vs(o,!0),0===o.strm.avail_out?3:4):o.sym_next&&(vs(o,!1),0===o.strm.avail_out)?1:2},Wf=(o,n)=>{let i,s,c;for(;;){if(o.lookahead<La){if(Rh(o),o.lookahead<La&&n===Zs)return 1;if(0===o.lookahead)break}if(i=0,o.lookahead>=3&&(o.ins_h=xa(o,o.ins_h,o.window[o.strstart+3-1]),i=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),o.prev_length=o.match_length,o.prev_match=o.match_start,o.match_length=2,0!==i&&o.prev_length<o.max_lazy_match&&o.strstart-i<=o.w_size-La&&(o.match_length=OD(o,i),o.match_length<=5&&(o.strategy===cL||3===o.match_length&&o.strstart-o.match_start>4096)&&(o.match_length=2)),o.prev_length>=3&&o.match_length<=o.prev_length){c=o.strstart+o.lookahead-3,s=bc(o,o.strstart-1-o.prev_match,o.prev_length-3),o.lookahead-=o.prev_length-1,o.prev_length-=2;do{++o.strstart<=c&&(o.ins_h=xa(o,o.ins_h,o.window[o.strstart+3-1]),i=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart)}while(0!=--o.prev_length);if(o.match_available=0,o.match_length=2,o.strstart++,s&&(vs(o,!1),0===o.strm.avail_out))return 1}else if(o.match_available){if(s=bc(o,0,o.window[o.strstart-1]),s&&vs(o,!1),o.strstart++,o.lookahead--,0===o.strm.avail_out)return 1}else o.match_available=1,o.strstart++,o.lookahead--}return o.match_available&&(s=bc(o,0,o.window[o.strstart-1]),o.match_available=0),o.insert=o.strstart<2?o.strstart:2,n===ea?(vs(o,!0),0===o.strm.avail_out?3:4):o.sym_next&&(vs(o,!1),0===o.strm.avail_out)?1:2};function Tc(o,n,i,s,c){this.good_length=o,this.max_lazy=n,this.nice_length=i,this.max_chain=s,this.func=c}const TE=[new Tc(0,0,0,0,ND),new Tc(4,4,8,4,PD),new Tc(4,5,16,8,PD),new Tc(4,6,32,32,PD),new Tc(4,4,16,16,Wf),new Tc(8,16,32,32,Wf),new Tc(8,16,128,128,Wf),new Tc(8,32,128,256,Wf),new Tc(32,128,258,1024,Wf),new Tc(32,258,258,4096,Wf)];function _L(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=bE,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),ll(this.dyn_ltree),ll(this.dyn_dtree),ll(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),ll(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),ll(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const zf=o=>{if(!o)return 1;const n=o.state;return!n||n.strm!==o||42!==n.status&&57!==n.status&&69!==n.status&&73!==n.status&&91!==n.status&&103!==n.status&&113!==n.status&&666!==n.status?1:0},gb=o=>{if(zf(o))return Ld(o,ka);o.total_in=o.total_out=0,o.data_type=uL;const n=o.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=2===n.wrap?57:n.wrap?42:113,o.adler=2===n.wrap?0:1,n.last_flush=-2,rL(n),gr},MD=o=>{const n=gb(o);var i;return n===gr&&((i=o.state).window_size=2*i.w_size,ll(i.head),i.max_lazy_match=TE[i.level].max_lazy,i.good_match=TE[i.level].good_length,i.nice_match=TE[i.level].nice_length,i.max_chain_length=TE[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),n},gL=(o,n,i,s,c,d)=>{if(!o)return ka;let h=1;if(n===aL&&(n=6),s<0?(h=0,s=-s):s>15&&(h=2,s-=16),c<1||c>9||i!==bE||s<8||s>15||n<0||n>9||d<0||d>CE||8===s&&1!==h)return Ld(o,ka);8===s&&(s=9);const p=new _L;return o.state=p,p.strm=o,p.status=42,p.wrap=h,p.gzhead=null,p.w_bits=s,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=c+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<c+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.sym_buf=p.lit_bufsize,p.sym_end=3*(p.lit_bufsize-1),p.level=n,p.strategy=d,p.method=i,MD(o)};var xd_deflateInit2=gL,xd_deflateSetHeader=(o,n)=>zf(o)||2!==o.state.wrap?ka:(o.state.gzhead=n,gr),xd_deflate=(o,n)=>{if(zf(o)||n>pb||n<0)return o?Ld(o,ka):ka;const i=o.state;if(!o.output||0!==o.avail_in&&!o.input||666===i.status&&n!==ea)return Ld(o,0===o.avail_out?Yo:ka);const s=i.last_flush;if(i.last_flush=n,0!==i.pending){if($o(o),0===o.avail_out)return i.last_flush=-1,gr}else if(0===o.avail_in&&DD(n)<=DD(s)&&n!==ea)return Ld(o,Yo);if(666===i.status&&0!==o.avail_in)return Ld(o,Yo);if(42===i.status&&0===i.wrap&&(i.status=113),42===i.status){let c=bE+(i.w_bits-8<<4)<<8,d=-1;if(d=i.strategy>=SE||i.level<2?0:i.level<6?1:6===i.level?2:3,c|=d<<6,0!==i.strstart&&(c|=32),c+=31-c%31,Ih(i,c),0!==i.strstart&&(Ih(i,o.adler>>>16),Ih(i,65535&o.adler)),o.adler=1,i.status=113,$o(o),0!==i.pending)return i.last_flush=-1,gr}if(57===i.status)if(o.adler=0,sn(i,31),sn(i,139),sn(i,8),i.gzhead)sn(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),sn(i,255&i.gzhead.time),sn(i,i.gzhead.time>>8&255),sn(i,i.gzhead.time>>16&255),sn(i,i.gzhead.time>>24&255),sn(i,9===i.level?2:i.strategy>=SE||i.level<2?4:0),sn(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(sn(i,255&i.gzhead.extra.length),sn(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(o.adler=ar(o.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(sn(i,0),sn(i,0),sn(i,0),sn(i,0),sn(i,0),sn(i,9===i.level?2:i.strategy>=SE||i.level<2?4:0),sn(i,3),i.status=113,$o(o),0!==i.pending)return i.last_flush=-1,gr;if(69===i.status){if(i.gzhead.extra){let c=i.pending,d=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+d>i.pending_buf_size;){let p=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+p),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>c&&(o.adler=ar(o.adler,i.pending_buf,i.pending-c,c)),i.gzindex+=p,$o(o),0!==i.pending)return i.last_flush=-1,gr;c=0,d-=p}let h=new Uint8Array(i.gzhead.extra);i.pending_buf.set(h.subarray(i.gzindex,i.gzindex+d),i.pending),i.pending+=d,i.gzhead.hcrc&&i.pending>c&&(o.adler=ar(o.adler,i.pending_buf,i.pending-c,c)),i.gzindex=0}i.status=73}if(73===i.status){if(i.gzhead.name){let c,d=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>d&&(o.adler=ar(o.adler,i.pending_buf,i.pending-d,d)),$o(o),0!==i.pending)return i.last_flush=-1,gr;d=0}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,sn(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>d&&(o.adler=ar(o.adler,i.pending_buf,i.pending-d,d)),i.gzindex=0}i.status=91}if(91===i.status){if(i.gzhead.comment){let c,d=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>d&&(o.adler=ar(o.adler,i.pending_buf,i.pending-d,d)),$o(o),0!==i.pending)return i.last_flush=-1,gr;d=0}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,sn(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>d&&(o.adler=ar(o.adler,i.pending_buf,i.pending-d,d))}i.status=103}if(103===i.status){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&($o(o),0!==i.pending))return i.last_flush=-1,gr;sn(i,255&o.adler),sn(i,o.adler>>8&255),o.adler=0}if(i.status=113,$o(o),0!==i.pending)return i.last_flush=-1,gr}if(0!==o.avail_in||0!==i.lookahead||n!==Zs&&666!==i.status){let c=0===i.level?ND(i,n):i.strategy===SE?((d,h)=>{let p;for(;;){if(0===d.lookahead&&(Rh(d),0===d.lookahead)){if(h===Zs)return 1;break}if(d.match_length=0,p=bc(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,p&&(vs(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,h===ea?(vs(d,!0),0===d.strm.avail_out?3:4):d.sym_next&&(vs(d,!1),0===d.strm.avail_out)?1:2})(i,n):i.strategy===lL?((d,h)=>{let p,m,_,E;const y=d.window;for(;;){if(d.lookahead<=258){if(Rh(d),d.lookahead<=258&&h===Zs)return 1;if(0===d.lookahead)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(_=d.strstart-1,m=y[_],m===y[++_]&&m===y[++_]&&m===y[++_])){E=d.strstart+258;do{}while(m===y[++_]&&m===y[++_]&&m===y[++_]&&m===y[++_]&&m===y[++_]&&m===y[++_]&&m===y[++_]&&m===y[++_]&&_<E);d.match_length=258-(E-_),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(p=bc(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(p=bc(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),p&&(vs(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,h===ea?(vs(d,!0),0===d.strm.avail_out?3:4):d.sym_next&&(vs(d,!1),0===d.strm.avail_out)?1:2})(i,n):TE[i.level].func(i,n);if(3!==c&&4!==c||(i.status=666),1===c||3===c)return 0===o.avail_out&&(i.last_flush=-1),gr;if(2===c&&(n===wD?hb(i):n!==pb&&(cl(i,0,0,!1),n===sL&&(ll(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),$o(o),0===o.avail_out))return i.last_flush=-1,gr}return n!==ea?gr:i.wrap<=0?AD:(2===i.wrap?(sn(i,255&o.adler),sn(i,o.adler>>8&255),sn(i,o.adler>>16&255),sn(i,o.adler>>24&255),sn(i,255&o.total_in),sn(i,o.total_in>>8&255),sn(i,o.total_in>>16&255),sn(i,o.total_in>>24&255)):(Ih(i,o.adler>>>16),Ih(i,65535&o.adler)),$o(o),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?gr:AD)},xd_deflateEnd=o=>{if(zf(o))return ka;const n=o.state.status;return o.state=null,113===n?Ld(o,HU):gr},xd_deflateSetDictionary=(o,n)=>{let i=n.length;if(zf(o))return ka;const s=o.state,c=s.wrap;if(2===c||1===c&&42!==s.status||s.lookahead)return ka;if(1===c&&(o.adler=Ch(o.adler,n,i,0)),s.wrap=0,i>=s.w_size){0===c&&(ll(s.head),s.strstart=0,s.block_start=0,s.insert=0);let m=new Uint8Array(s.w_size);m.set(n.subarray(i-s.w_size,i),0),n=m,i=s.w_size}const d=o.avail_in,h=o.next_in,p=o.input;for(o.avail_in=i,o.next_in=0,o.input=n,Rh(s);s.lookahead>=3;){let m=s.strstart,_=s.lookahead-2;do{s.ins_h=xa(s,s.ins_h,s.window[m+3-1]),s.prev[m&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=m,m++}while(--_);s.strstart=m,s.lookahead=2,Rh(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,o.next_in=h,o.input=p,o.avail_in=d,s.wrap=c,gr};const WU=(o,n)=>Object.prototype.hasOwnProperty.call(o,n);var IE_assign=function(o){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const i=n.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const s in i)WU(i,s)&&(o[s]=i[s])}}return o},IE_flattenChunks=o=>{let n=0;for(let s=0,c=o.length;s<c;s++)n+=o[s].length;const i=new Uint8Array(n);for(let s=0,c=0,d=o.length;s<d;s++){let h=o[s];i.set(h,c),c+=h.length}return i};let kD=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{kD=!1}const Kf=new Uint8Array(256);for(let o=0;o<256;o++)Kf[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;Kf[254]=Kf[254]=1;var dl_string2buf=o=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(o);let n,i,s,c,d,h=o.length,p=0;for(c=0;c<h;c++)i=o.charCodeAt(c),55296==(64512&i)&&c+1<h&&(s=o.charCodeAt(c+1),56320==(64512&s)&&(i=65536+(i-55296<<10)+(s-56320),c++)),p+=i<128?1:i<2048?2:i<65536?3:4;for(n=new Uint8Array(p),d=0,c=0;d<p;c++)i=o.charCodeAt(c),55296==(64512&i)&&c+1<h&&(s=o.charCodeAt(c+1),56320==(64512&s)&&(i=65536+(i-55296<<10)+(s-56320),c++)),i<128?n[d++]=i:i<2048?(n[d++]=192|i>>>6,n[d++]=128|63&i):i<65536?(n[d++]=224|i>>>12,n[d++]=128|i>>>6&63,n[d++]=128|63&i):(n[d++]=240|i>>>18,n[d++]=128|i>>>12&63,n[d++]=128|i>>>6&63,n[d++]=128|63&i);return n},dl_buf2string=(o,n)=>{const i=n||o.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(o.subarray(0,n));let s,c;const d=new Array(2*i);for(c=0,s=0;s<i;){let h=o[s++];if(h<128){d[c++]=h;continue}let p=Kf[h];if(p>4)d[c++]=65533,s+=p-1;else{for(h&=2===p?31:3===p?15:7;p>1&&s<i;)h=h<<6|63&o[s++],p--;p>1?d[c++]=65533:h<65536?d[c++]=h:(h-=65536,d[c++]=55296|h>>10&1023,d[c++]=56320|1023&h)}}return((h,p)=>{if(p<65534&&h.subarray&&kD)return String.fromCharCode.apply(null,h.length===p?h:h.subarray(0,p));let m="";for(let _=0;_<p;_++)m+=String.fromCharCode(h[_]);return m})(d,c)},dl_utf8border=(o,n)=>{(n=n||o.length)>o.length&&(n=o.length);let i=n-1;for(;i>=0&&128==(192&o[i]);)i--;return i<0||0===i?n:i+Kf[o[i]]>n?i:n},LD=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const qf=Object.prototype.toString,{Z_NO_FLUSH:yL,Z_SYNC_FLUSH:vL,Z_FULL_FLUSH:zU,Z_FINISH:SL,Z_OK:RE,Z_STREAM_END:CL,Z_DEFAULT_COMPRESSION:bL,Z_DEFAULT_STRATEGY:KU,Z_DEFLATED:TL}=Pd;function Yf(o){this.options=IE_assign({level:bL,method:TL,chunkSize:16384,windowBits:15,memLevel:8,strategy:KU},o||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new LD,this.strm.avail_out=0;let i=xd_deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(i!==RE)throw new Error(al[i]);if(n.header&&xd_deflateSetHeader(this.strm,n.header),n.dictionary){let s;if(s="string"==typeof n.dictionary?dl_string2buf(n.dictionary):"[object ArrayBuffer]"===qf.call(n.dictionary)?new Uint8Array(n.dictionary):n.dictionary,i=xd_deflateSetDictionary(this.strm,s),i!==RE)throw new Error(al[i]);this._dict_set=!0}}function Eb(o,n){const i=new Yf(n);if(i.push(o,!0),i.err)throw i.msg||al[i.err];return i.result}Yf.prototype.push=function(o,n){const i=this.strm,s=this.options.chunkSize;let c,d;if(this.ended)return!1;for(d=n===~~n?n:!0===n?SL:yL,i.input="string"==typeof o?dl_string2buf(o):"[object ArrayBuffer]"===qf.call(o)?new Uint8Array(o):o,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),(d===vL||d===zU)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(c=xd_deflate(i,d),c===CL)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),c=xd_deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===RE;if(0!==i.avail_out){if(d>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},Yf.prototype.onData=function(o){this.chunks.push(o)},Yf.prototype.onEnd=function(o){o===RE&&(this.result=IE_flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.msg=this.strm.msg};var IL={Deflate:Yf,deflate:Eb,deflateRaw:function(o,n){return(n=n||{}).raw=!0,Eb(o,n)},gzip:function(o,n){return(n=n||{}).gzip=!0,Eb(o,n)},constants:Pd};const yb=16209;var RL=function(o,n){let i,s,c,d,h,p,m,_,E,y,S,T,O,N,w,k,V,U,Y,re,K,$,X,J;const Ee=o.state;i=o.next_in,X=o.input,s=i+(o.avail_in-5),c=o.next_out,J=o.output,d=c-(n-o.avail_out),h=c+(o.avail_out-257),p=Ee.dmax,m=Ee.wsize,_=Ee.whave,E=Ee.wnext,y=Ee.window,S=Ee.hold,T=Ee.bits,O=Ee.lencode,N=Ee.distcode,w=(1<<Ee.lenbits)-1,k=(1<<Ee.distbits)-1;e:do{T<15&&(S+=X[i++]<<T,T+=8,S+=X[i++]<<T,T+=8),V=O[S&w];t:for(;;){if(U=V>>>24,S>>>=U,T-=U,U=V>>>16&255,0===U)J[c++]=65535&V;else{if(!(16&U)){if(0==(64&U)){V=O[(65535&V)+(S&(1<<U)-1)];continue t}if(32&U){Ee.mode=16191;break e}o.msg="invalid literal/length code",Ee.mode=yb;break e}Y=65535&V,U&=15,U&&(T<U&&(S+=X[i++]<<T,T+=8),Y+=S&(1<<U)-1,S>>>=U,T-=U),T<15&&(S+=X[i++]<<T,T+=8,S+=X[i++]<<T,T+=8),V=N[S&k];n:for(;;){if(U=V>>>24,S>>>=U,T-=U,U=V>>>16&255,!(16&U)){if(0==(64&U)){V=N[(65535&V)+(S&(1<<U)-1)];continue n}o.msg="invalid distance code",Ee.mode=yb;break e}if(re=65535&V,U&=15,T<U&&(S+=X[i++]<<T,T+=8,T<U&&(S+=X[i++]<<T,T+=8)),re+=S&(1<<U)-1,re>p){o.msg="invalid distance too far back",Ee.mode=yb;break e}if(S>>>=U,T-=U,U=c-d,re>U){if(U=re-U,U>_&&Ee.sane){o.msg="invalid distance too far back",Ee.mode=yb;break e}if(K=0,$=y,0===E){if(K+=m-U,U<Y){Y-=U;do{J[c++]=y[K++]}while(--U);K=c-re,$=J}}else if(E<U){if(K+=m+E-U,U-=E,U<Y){Y-=U;do{J[c++]=y[K++]}while(--U);if(K=0,E<Y){U=E,Y-=U;do{J[c++]=y[K++]}while(--U);K=c-re,$=J}}}else if(K+=E-U,U<Y){Y-=U;do{J[c++]=y[K++]}while(--U);K=c-re,$=J}for(;Y>2;)J[c++]=$[K++],J[c++]=$[K++],J[c++]=$[K++],Y-=3;Y&&(J[c++]=$[K++],Y>1&&(J[c++]=$[K++]))}else{K=c-re;do{J[c++]=J[K++],J[c++]=J[K++],J[c++]=J[K++],Y-=3}while(Y>2);Y&&(J[c++]=J[K++],Y>1&&(J[c++]=J[K++]))}break}}break}}while(i<s&&c<h);Y=T>>3,i-=Y,T-=Y<<3,S&=(1<<T)-1,o.next_in=i,o.next_out=c,o.avail_in=i<s?s-i+5:5-(i-s),o.avail_out=c<h?h-c+257:257-(c-h),Ee.hold=S,Ee.bits=T};const wL=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),AL=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),qU=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),DL=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var oi=(o,n,i,s,c,d,h,p)=>{const m=p.bits;let _,E,y,S,T,O,N=0,w=0,k=0,V=0,U=0,Y=0,re=0,K=0,$=0,X=0,J=null;const Ee=new Uint16Array(16),ve=new Uint16Array(16);let ze,ht,Ct,dt=null;for(N=0;N<=15;N++)Ee[N]=0;for(w=0;w<s;w++)Ee[n[i+w]]++;for(U=m,V=15;V>=1&&0===Ee[V];V--);if(U>V&&(U=V),0===V)return c[d++]=20971520,c[d++]=20971520,p.bits=1,0;for(k=1;k<V&&0===Ee[k];k++);for(U<k&&(U=k),K=1,N=1;N<=15;N++)if(K<<=1,K-=Ee[N],K<0)return-1;if(K>0&&(0===o||1!==V))return-1;for(ve[1]=0,N=1;N<15;N++)ve[N+1]=ve[N]+Ee[N];for(w=0;w<s;w++)0!==n[i+w]&&(h[ve[n[i+w]]++]=w);if(0===o?(J=dt=h,O=20):1===o?(J=wL,dt=AL,O=257):(J=qU,dt=DL,O=0),X=0,w=0,N=k,T=d,Y=U,re=0,y=-1,$=1<<U,S=$-1,1===o&&$>852||2===o&&$>592)return 1;for(;;){ze=N-re,h[w]+1<O?(ht=0,Ct=h[w]):h[w]>=O?(ht=dt[h[w]-O],Ct=J[h[w]-O]):(ht=96,Ct=0),_=1<<N-re,E=1<<Y,k=E;do{E-=_,c[T+(X>>re)+E]=ze<<24|ht<<16|Ct|0}while(0!==E);for(_=1<<N-1;X&_;)_>>=1;if(0!==_?(X&=_-1,X+=_):X=0,w++,0==--Ee[N]){if(N===V)break;N=n[i+h[w]]}if(N>U&&(X&S)!==y){for(0===re&&(re=U),T+=k,Y=N-re,K=1<<Y;Y+re<V&&(K-=Ee[Y+re],!(K<=0));)Y++,K<<=1;if($+=1<<Y,1===o&&$>852||2===o&&$>592)return 1;y=X&S,c[y]=U<<24|Y<<16|T-d|0}}return 0!==X&&(c[T+X]=N-re<<24|64<<16|0),p.bits=U,0};const{Z_FINISH:OL,Z_BLOCK:YU,Z_TREES:vb,Z_OK:wh,Z_STREAM_END:$U,Z_NEED_DICT:XU,Z_STREAM_ERROR:Ss,Z_DATA_ERROR:NL,Z_MEM_ERROR:PL,Z_BUF_ERROR:JU,Z_DEFLATED:Sb}=Pd,AE=16180,DE=16190,ta=16191,Cb=16199,$f=16200,_i=16209,ML=o=>(o>>>24&255)+(o>>>8&65280)+((65280&o)<<8)+((255&o)<<24);function kL(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ul=o=>{if(!o)return 1;const n=o.state;return!n||n.strm!==o||n.mode<AE||n.mode>16211?1:0},LL=o=>{if(ul(o))return Ss;const n=o.state;return o.total_in=o.total_out=n.total=0,o.msg="",n.wrap&&(o.adler=1&n.wrap),n.mode=AE,n.last=0,n.havedict=0,n.flags=-1,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(852),n.distcode=n.distdyn=new Int32Array(592),n.sane=1,n.back=-1,wh},xL=o=>{if(ul(o))return Ss;const n=o.state;return n.wsize=0,n.whave=0,n.wnext=0,LL(o)},FL=(o,n)=>{let i;if(ul(o))return Ss;const s=o.state;return n<0?(i=0,n=-n):(i=5+(n>>4),n<48&&(n&=15)),n&&(n<8||n>15)?Ss:(null!==s.window&&s.wbits!==n&&(s.window=null),s.wrap=i,s.wbits=n,xL(o))},UL=(o,n)=>{if(!o)return Ss;const i=new kL;o.state=i,i.strm=o,i.window=null,i.mode=AE;const s=FL(o,n);return s!==wh&&(o.state=null),s};let FD,UD,VL=!0;const QU=o=>{if(VL){FD=new Int32Array(512),UD=new Int32Array(32);let n=0;for(;n<144;)o.lens[n++]=8;for(;n<256;)o.lens[n++]=9;for(;n<280;)o.lens[n++]=7;for(;n<288;)o.lens[n++]=8;for(oi(1,o.lens,0,288,FD,0,o.work,{bits:9}),n=0;n<32;)o.lens[n++]=5;oi(2,o.lens,0,32,UD,0,o.work,{bits:5}),VL=!1}o.lencode=FD,o.lenbits=9,o.distcode=UD,o.distbits=5},BL=(o,n,i,s)=>{let c;const d=o.state;return null===d.window&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),s>=d.wsize?(d.window.set(n.subarray(i-d.wsize,i),0),d.wnext=0,d.whave=d.wsize):(c=d.wsize-d.wnext,c>s&&(c=s),d.window.set(n.subarray(i-s,i-s+c),d.wnext),(s-=c)?(d.window.set(n.subarray(i-s,i),0),d.wnext=s,d.whave=d.wsize):(d.wnext+=c,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=c))),0};var Ic_inflateReset=xL,Ic_inflateInit2=UL,Ic_inflate=(o,n)=>{let i,s,c,d,h,p,m,_,E,y,S,T,O,N,w,k,V,U,Y,re,K,$,X=0;const J=new Uint8Array(4);let Ee,ve;const ze=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ul(o)||!o.output||!o.input&&0!==o.avail_in)return Ss;i=o.state,i.mode===ta&&(i.mode=16192),h=o.next_out,c=o.output,m=o.avail_out,d=o.next_in,s=o.input,p=o.avail_in,_=i.hold,E=i.bits,y=p,S=m,$=wh;e:for(;;)switch(i.mode){case AE:if(0===i.wrap){i.mode=16192;break}for(;E<16;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(2&i.wrap&&35615===_){0===i.wbits&&(i.wbits=15),i.check=0,J[0]=255&_,J[1]=_>>>8&255,i.check=ar(i.check,J,2,0),_=0,E=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&_)<<8)+(_>>8))%31){o.msg="incorrect header check",i.mode=_i;break}if((15&_)!==Sb){o.msg="unknown compression method",i.mode=_i;break}if(_>>>=4,E-=4,K=8+(15&_),0===i.wbits&&(i.wbits=K),K>15||K>i.wbits){o.msg="invalid window size",i.mode=_i;break}i.dmax=1<<i.wbits,i.flags=0,o.adler=i.check=1,i.mode=512&_?16189:ta,_=0,E=0;break;case 16181:for(;E<16;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(i.flags=_,(255&i.flags)!==Sb){o.msg="unknown compression method",i.mode=_i;break}if(57344&i.flags){o.msg="unknown header flags set",i.mode=_i;break}i.head&&(i.head.text=_>>8&1),512&i.flags&&4&i.wrap&&(J[0]=255&_,J[1]=_>>>8&255,i.check=ar(i.check,J,2,0)),_=0,E=0,i.mode=16182;case 16182:for(;E<32;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}i.head&&(i.head.time=_),512&i.flags&&4&i.wrap&&(J[0]=255&_,J[1]=_>>>8&255,J[2]=_>>>16&255,J[3]=_>>>24&255,i.check=ar(i.check,J,4,0)),_=0,E=0,i.mode=16183;case 16183:for(;E<16;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}i.head&&(i.head.xflags=255&_,i.head.os=_>>8),512&i.flags&&4&i.wrap&&(J[0]=255&_,J[1]=_>>>8&255,i.check=ar(i.check,J,2,0)),_=0,E=0,i.mode=16184;case 16184:if(1024&i.flags){for(;E<16;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}i.length=_,i.head&&(i.head.extra_len=_),512&i.flags&&4&i.wrap&&(J[0]=255&_,J[1]=_>>>8&255,i.check=ar(i.check,J,2,0)),_=0,E=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&i.flags&&(T=i.length,T>p&&(T=p),T&&(i.head&&(K=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(s.subarray(d,d+T),K)),512&i.flags&&4&i.wrap&&(i.check=ar(i.check,s,T,d)),p-=T,d+=T,i.length-=T),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&i.flags){if(0===p)break e;T=0;do{K=s[d+T++],i.head&&K&&i.length<65536&&(i.head.name+=String.fromCharCode(K))}while(K&&T<p);if(512&i.flags&&4&i.wrap&&(i.check=ar(i.check,s,T,d)),p-=T,d+=T,K)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&i.flags){if(0===p)break e;T=0;do{K=s[d+T++],i.head&&K&&i.length<65536&&(i.head.comment+=String.fromCharCode(K))}while(K&&T<p);if(512&i.flags&&4&i.wrap&&(i.check=ar(i.check,s,T,d)),p-=T,d+=T,K)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&i.flags){for(;E<16;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(4&i.wrap&&_!==(65535&i.check)){o.msg="header crc mismatch",i.mode=_i;break}_=0,E=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),o.adler=i.check=0,i.mode=ta;break;case 16189:for(;E<32;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}o.adler=i.check=ML(_),_=0,E=0,i.mode=DE;case DE:if(0===i.havedict)return o.next_out=h,o.avail_out=m,o.next_in=d,o.avail_in=p,i.hold=_,i.bits=E,XU;o.adler=i.check=1,i.mode=ta;case ta:if(n===YU||n===vb)break e;case 16192:if(i.last){_>>>=7&E,E-=7&E,i.mode=16206;break}for(;E<3;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}switch(i.last=1&_,_>>>=1,E-=1,3&_){case 0:i.mode=16193;break;case 1:if(QU(i),i.mode=Cb,n===vb){_>>>=2,E-=2;break e}break;case 2:i.mode=16196;break;case 3:o.msg="invalid block type",i.mode=_i}_>>>=2,E-=2;break;case 16193:for(_>>>=7&E,E-=7&E;E<32;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if((65535&_)!=(_>>>16^65535)){o.msg="invalid stored block lengths",i.mode=_i;break}if(i.length=65535&_,_=0,E=0,i.mode=16194,n===vb)break e;case 16194:i.mode=16195;case 16195:if(T=i.length,T){if(T>p&&(T=p),T>m&&(T=m),0===T)break e;c.set(s.subarray(d,d+T),h),p-=T,d+=T,m-=T,h+=T,i.length-=T;break}i.mode=ta;break;case 16196:for(;E<14;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(i.nlen=257+(31&_),_>>>=5,E-=5,i.ndist=1+(31&_),_>>>=5,E-=5,i.ncode=4+(15&_),_>>>=4,E-=4,i.nlen>286||i.ndist>30){o.msg="too many length or distance symbols",i.mode=_i;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;E<3;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}i.lens[ze[i.have++]]=7&_,_>>>=3,E-=3}for(;i.have<19;)i.lens[ze[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,Ee={bits:i.lenbits},$=oi(0,i.lens,0,19,i.lencode,0,i.work,Ee),i.lenbits=Ee.bits,$){o.msg="invalid code lengths set",i.mode=_i;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;X=i.lencode[_&(1<<i.lenbits)-1],w=X>>>24,k=X>>>16&255,V=65535&X,!(w<=E);){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(V<16)_>>>=w,E-=w,i.lens[i.have++]=V;else{if(16===V){for(ve=w+2;E<ve;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(_>>>=w,E-=w,0===i.have){o.msg="invalid bit length repeat",i.mode=_i;break}K=i.lens[i.have-1],T=3+(3&_),_>>>=2,E-=2}else if(17===V){for(ve=w+3;E<ve;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}_>>>=w,E-=w,K=0,T=3+(7&_),_>>>=3,E-=3}else{for(ve=w+7;E<ve;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}_>>>=w,E-=w,K=0,T=11+(127&_),_>>>=7,E-=7}if(i.have+T>i.nlen+i.ndist){o.msg="invalid bit length repeat",i.mode=_i;break}for(;T--;)i.lens[i.have++]=K}}if(i.mode===_i)break;if(0===i.lens[256]){o.msg="invalid code -- missing end-of-block",i.mode=_i;break}if(i.lenbits=9,Ee={bits:i.lenbits},$=oi(1,i.lens,0,i.nlen,i.lencode,0,i.work,Ee),i.lenbits=Ee.bits,$){o.msg="invalid literal/lengths set",i.mode=_i;break}if(i.distbits=6,i.distcode=i.distdyn,Ee={bits:i.distbits},$=oi(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,Ee),i.distbits=Ee.bits,$){o.msg="invalid distances set",i.mode=_i;break}if(i.mode=Cb,n===vb)break e;case Cb:i.mode=$f;case $f:if(p>=6&&m>=258){o.next_out=h,o.avail_out=m,o.next_in=d,o.avail_in=p,i.hold=_,i.bits=E,RL(o,S),h=o.next_out,c=o.output,m=o.avail_out,d=o.next_in,s=o.input,p=o.avail_in,_=i.hold,E=i.bits,i.mode===ta&&(i.back=-1);break}for(i.back=0;X=i.lencode[_&(1<<i.lenbits)-1],w=X>>>24,k=X>>>16&255,V=65535&X,!(w<=E);){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(k&&0==(240&k)){for(U=w,Y=k,re=V;X=i.lencode[re+((_&(1<<U+Y)-1)>>U)],w=X>>>24,k=X>>>16&255,V=65535&X,!(U+w<=E);){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}_>>>=U,E-=U,i.back+=U}if(_>>>=w,E-=w,i.back+=w,i.length=V,0===k){i.mode=16205;break}if(32&k){i.back=-1,i.mode=ta;break}if(64&k){o.msg="invalid literal/length code",i.mode=_i;break}i.extra=15&k,i.mode=16201;case 16201:if(i.extra){for(ve=i.extra;E<ve;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}i.length+=_&(1<<i.extra)-1,_>>>=i.extra,E-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;X=i.distcode[_&(1<<i.distbits)-1],w=X>>>24,k=X>>>16&255,V=65535&X,!(w<=E);){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(0==(240&k)){for(U=w,Y=k,re=V;X=i.distcode[re+((_&(1<<U+Y)-1)>>U)],w=X>>>24,k=X>>>16&255,V=65535&X,!(U+w<=E);){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}_>>>=U,E-=U,i.back+=U}if(_>>>=w,E-=w,i.back+=w,64&k){o.msg="invalid distance code",i.mode=_i;break}i.offset=V,i.extra=15&k,i.mode=16203;case 16203:if(i.extra){for(ve=i.extra;E<ve;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}i.offset+=_&(1<<i.extra)-1,_>>>=i.extra,E-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){o.msg="invalid distance too far back",i.mode=_i;break}i.mode=16204;case 16204:if(0===m)break e;if(T=S-m,i.offset>T){if(T=i.offset-T,T>i.whave&&i.sane){o.msg="invalid distance too far back",i.mode=_i;break}T>i.wnext?(T-=i.wnext,O=i.wsize-T):O=i.wnext-T,T>i.length&&(T=i.length),N=i.window}else N=c,O=h-i.offset,T=i.length;T>m&&(T=m),m-=T,i.length-=T;do{c[h++]=N[O++]}while(--T);0===i.length&&(i.mode=$f);break;case 16205:if(0===m)break e;c[h++]=i.length,m--,i.mode=$f;break;case 16206:if(i.wrap){for(;E<32;){if(0===p)break e;p--,_|=s[d++]<<E,E+=8}if(S-=m,o.total_out+=S,i.total+=S,4&i.wrap&&S&&(o.adler=i.check=i.flags?ar(i.check,c,S,h-S):Ch(i.check,c,S,h-S)),S=m,4&i.wrap&&(i.flags?_:ML(_))!==i.check){o.msg="incorrect data check",i.mode=_i;break}_=0,E=0}i.mode=16207;case 16207:if(i.wrap&&i.flags){for(;E<32;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(4&i.wrap&&_!==(4294967295&i.total)){o.msg="incorrect length check",i.mode=_i;break}_=0,E=0}i.mode=16208;case 16208:$=$U;break e;case _i:$=NL;break e;case 16210:return PL;default:return Ss}return o.next_out=h,o.avail_out=m,o.next_in=d,o.avail_in=p,i.hold=_,i.bits=E,(i.wsize||S!==o.avail_out&&i.mode<_i&&(i.mode<16206||n!==OL))&&BL(o,o.output,o.next_out,S-o.avail_out),y-=o.avail_in,S-=o.avail_out,o.total_in+=y,o.total_out+=S,i.total+=S,4&i.wrap&&S&&(o.adler=i.check=i.flags?ar(i.check,c,S,o.next_out-S):Ch(i.check,c,S,o.next_out-S)),o.data_type=i.bits+(i.last?64:0)+(i.mode===ta?128:0)+(i.mode===Cb||16194===i.mode?256:0),(0===y&&0===S||n===OL)&&$===wh&&($=JU),$},Ic_inflateEnd=o=>{if(ul(o))return Ss;let n=o.state;return n.window&&(n.window=null),o.state=null,wh},Ic_inflateGetHeader=(o,n)=>{if(ul(o))return Ss;const i=o.state;return 0==(2&i.wrap)?Ss:(i.head=n,n.done=!1,wh)},Ic_inflateSetDictionary=(o,n)=>{const i=n.length;let s,c,d;return ul(o)?Ss:(s=o.state,0!==s.wrap&&s.mode!==DE?Ss:s.mode===DE&&(c=1,c=Ch(c,n,i,0),c!==s.check)?NL:(d=BL(o,n,i,i),d?(s.mode=16210,PL):(s.havedict=1,wh)))},eV=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const VD=Object.prototype.toString,{Z_NO_FLUSH:jL,Z_FINISH:tV,Z_OK:NE,Z_STREAM_END:BD,Z_NEED_DICT:jD,Z_STREAM_ERROR:nV,Z_DATA_ERROR:HL,Z_MEM_ERROR:iV}=Pd;function PE(o){this.options=IE_assign({chunkSize:65536,windowBits:15,to:""},o||{});const n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,0===n.windowBits&&(n.windowBits=-15)),!(n.windowBits>=0&&n.windowBits<16)||o&&o.windowBits||(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&0==(15&n.windowBits)&&(n.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new LD,this.strm.avail_out=0;let i=Ic_inflateInit2(this.strm,n.windowBits);if(i!==NE)throw new Error(al[i]);if(this.header=new eV,Ic_inflateGetHeader(this.strm,this.header),n.dictionary&&("string"==typeof n.dictionary?n.dictionary=dl_string2buf(n.dictionary):"[object ArrayBuffer]"===VD.call(n.dictionary)&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(i=Ic_inflateSetDictionary(this.strm,n.dictionary),i!==NE)))throw new Error(al[i])}function HD(o,n){const i=new PE(n);if(i.push(o),i.err)throw i.msg||al[i.err];return i.result}PE.prototype.push=function(o,n){const i=this.strm,s=this.options.chunkSize,c=this.options.dictionary;let d,h,p;if(this.ended)return!1;for(h=n===~~n?n:!0===n?tV:jL,i.input="[object ArrayBuffer]"===VD.call(o)?new Uint8Array(o):o,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),d=Ic_inflate(i,h),d===jD&&c&&(d=Ic_inflateSetDictionary(i,c),d===NE?d=Ic_inflate(i,h):d===HL&&(d=jD));i.avail_in>0&&d===BD&&i.state.wrap>0&&0!==o[i.next_in];)Ic_inflateReset(i),d=Ic_inflate(i,h);switch(d){case nV:case HL:case jD:case iV:return this.onEnd(d),this.ended=!0,!1}if(p=i.avail_out,i.next_out&&(0===i.avail_out||d===BD))if("string"===this.options.to){let m=dl_utf8border(i.output,i.next_out),_=i.next_out-m,E=dl_buf2string(i.output,m);i.next_out=_,i.avail_out=s-_,_&&i.output.set(i.output.subarray(m,m+_),0),this.onData(E)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(d!==NE||0!==p){if(d===BD)return d=Ic_inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},PE.prototype.onData=function(o){this.chunks.push(o)},PE.prototype.onEnd=function(o){o===NE&&(this.result="string"===this.options.to?this.chunks.join(""):IE_flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.msg=this.strm.msg};var rV={Inflate:PE,inflate:HD,inflateRaw:function(o,n){return(n=n||{}).raw=!0,HD(o,n)},ungzip:HD,constants:Pd};const{deflate:bb}=IL,{inflate:GL}=rV;var Ib,zL=bb,KL=GL;!function(o){o[o.ONE_BYTE=0]="ONE_BYTE",o[o.TWO_BYTE=1]="TWO_BYTE"}(Ib||(Ib={}));class kE{constructor(){C(this,"_sequence",0),C(this,"_startTime",Date.now()),C(this,"isUseOneByte",!0)}get startTime(){const n=Date.now()-this._startTime;return n<Math.pow(2,16)?n:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(n){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:n};if(n.byteLength>128){const p=new Uint8Array(4);p.set([1,0,0,0]);const _={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[{id:0,length:4,data:p.buffer}]};i.commonPacketHeader.extension=1,i.extension=_,i.payload=this.compress(n),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;const s=new ArrayBuffer(i.commonPacketHeader.length),c=new Uint8Array(s),d=new DataView(s);let h=0;if(d.setUint16(h,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),h+=2,d.setUint32(h,i.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,i.commonStreamHeader,!0),h+=2,i.extension){const p=this.serializeExtension(i.extension);c.set(new Uint8Array(p),h),h+=p.byteLength}if(c.set(new Uint8Array(i.payload),h),h+=i.payload.byteLength,h!==i.commonPacketHeader.length)throw Error("serialize error!");return s}deserialize(n){if(n.byteLength<4)return new ArrayBuffer(0);const i=new DataView(n);let s=0;const c=i.getUint16(s,!0);s+=2;const d=(32768&c)>>15;let h,p;if(i.getUint16(s+2,!0),i.getUint16(s,!0),s+=4,i.getUint16(s,!0),s+=2,d){p=this.deserializeExtension(n.slice(s)),s+=2+p.length,h=n.slice(s);let m=!1;if(p.datas.length>0){const _=p.datas.find(E=>0===E.id);_&&(m=1==(1&new DataView(_.data).getUint32(0,!0)))}h=m?this.decompress(h):h}else h=n.slice(8);return h}serializeExtension(n){const{profile:i,length:s,datas:c}=n,d=new ArrayBuffer(s+2),h=new Uint8Array(d),p=new DataView(d);let m=0;if(p.setUint8(m++,i),p.setUint8(m++,s),c.forEach(_=>{i?(p.setUint8(m++,_.id),p.setUint8(m++,_.length),h.set(new Uint8Array(_.data),m),m+=_.data.byteLength):(p.setUint8(m++,_.id|_.length<<4),h.set(new Uint8Array(_.data),m),m+=_.data.byteLength)}),m!==s+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(s+2));return d}deserializeExtension(n){const i=new DataView(n);let s=0;const c=i.getUint8(s);s++;const d=i.getUint8(s);s++;const h=c===Ib.TWO_BYTE,p=[],m=new DataView(n,2);let _=0;for(;_<d;){let E=0,y=0,S=new ArrayBuffer(0);h?(E=m.getUint8(_),_++,y=m.getUint8(_),_++):(E=15&m.getUint8(_),y=m.getUint8(_)>>4,_++),y>0&&(S=m.buffer.slice(_+2,_+2+y),_+=S.byteLength),p.push({id:E,length:y,data:S})}if(_!==d)throw Error("parse error");return{profile:c,length:d,datas:p}}decompress(n){return KL(new Uint8Array(n))}compress(n){return zL(new Uint8Array(n))}}class Xf extends kt{constructor(n,i){super(),C(this,"_version",1),C(this,"_type",3),C(this,"_config",void 0),C(this,"_originDataChannel",void 0),C(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),C(this,"_dataStreamPacketHandler",void 0),C(this,"_datachannelEventMap",new Map),this._config=n,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader(),this._dataStreamPacketHandler=new kE}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return B("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var n,i;return null!==(n=null===(i=this._originDataChannel)||void 0===i?void 0:i.readyState)&&void 0!==n?n:"connecting"}get _originDataChannelId(){var n,i;return null!==(n=null===(i=this._originDataChannel)||void 0===i?void 0:i.id)&&void 0!==n?n:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}_waitTillOpen(){var n=this;return x(function*(){return new z((i,s)=>{if(n._originDataChannel){"open"===n._originDataChannel.readyState&&i();const c=setTimeout(()=>{var d;s(new Q(M.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(d=n._originDataChannel)||void 0===d?void 0:d.id)))},1e4);n._originDataChannel.onopen=()=>{clearTimeout(c),n._originDataChannel&&n._bandDataChannelEvents(n._originDataChannel),i()},n._originDataChannel.onerror=()=>{throw clearTimeout(c),new Q(M.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Q(M.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})})()}_updateOriginDataChannel(n){this._originDataChannel=n,this._bandDataChannelEvents(n)}_initPacketHeader(){const n=new DataView(this._dataStreamPacketHeader);n.setUint16(0,this._version),n.setUint8(2,this._type),n.setUint8(3,this._config.id)}_bandDataChannelEvents(n){this._unbindDataChannelEvents(n),[Nf.OPEN,Nf.CLOSE,Nf.ERROR].forEach(i=>{const s=()=>{this.emit(i)};this._datachannelEventMap.set(i,s),n.addEventListener(i,s)})}_unbindDataChannelEvents(n){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[s,c]=i;n.removeEventListener(s,c)}),this._datachannelEventMap.clear()}}class GD extends Xf{constructor(n){super(n),C(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const s=i.data.slice(0,this._dataStreamPacketHeader.byteLength);if(new DataView(s).getUint8(3)!==this.id)return;let c=i.data.slice(this._dataStreamPacketHeader.byteLength);c=this._dataStreamPacketHandler.deserialize(c),this.emit(Nf.MESSAGE,c)}}_updateOriginDataChannel(n){super._updateOriginDataChannel(n),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Rb extends Xf{send(n){if(this._originDataChannel){let i=n;i=this._dataStreamPacketHandler.serialize(n);const s=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);s.set(new Uint8Array(this._dataStreamPacketHeader),0),s.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(s.buffer)}}}class Jf extends kt{constructor(){super(...arguments),C(this,"resultStorage",new Map)}setLocalAudioStats(n,i,s){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",n,this.checkAudioInputLevel(s,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",n,this.checkSendAudioBitrate(s,i))}setLocalVideoStats(n,i,s){this.record("SEND_VIDEO_BITRATE_TOO_LOW",n,this.checkSendVideoBitrate(s,i)),this.record("FRAMERATE_INPUT_TOO_LOW",n,this.checkFramerateInput(s,i)),this.record("FRAMERATE_SENT_TOO_LOW",n,this.checkFramerateSent(s))}setRemoteAudioStats(n,i){const s=n.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",s,this.checkAudioOutputLevel(i))}setRemoteVideoStats(n,i){const s=n.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",s,this.checkVideoDecode(i))}record(n,i,s){if(B("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(n)||this.resultStorage.set(n,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(n);if(c&&(c.result.push(s),c.result.length>=5)){var d;const h=be(d=c.result).call(d,!0);c.isPrevNormal&&!h&&this.emit("exception",wb[n],n,i),!c.isPrevNormal&&h&&this.emit("exception",wb[n]+2e3,n+"_RECOVER",i),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(n){return!(n.receiveBitrate>0&&0===n.receiveLevel)}checkAudioInputLevel(n,i){return i instanceof qn&&!i.isActive||!!i.muted||0!==n.sendVolumeLevel}checkFramerateInput(n,i){let s=null;i._encoderConfig&&i._encoderConfig.frameRate&&(s=Er(i._encoderConfig.frameRate));const c=n.captureFrameRate;return!s||!c||!(s>10&&c<5||s<10&&s>=5&&c<=1)}checkFramerateSent(n){return!(n.captureFrameRate&&n.sendFrameRate&&n.captureFrameRate>5&&n.sendFrameRate<=1)}checkSendVideoBitrate(n,i){return!!i.muted||0!==n.sendBitrate}checkSendAudioBitrate(n,i){return i instanceof qn&&!i.isActive||!!i.muted||0!==n.sendBitrate}checkVideoDecode(n){return 0===n.receiveBitrate||0!==n.decodeFrameRate}}const wb={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},gi=new class{markSubscribeStart(o,n){performance.mark("agora-web-sdk/".concat(o,"/subscribe-").concat(n))}markPublishStart(o,n){performance.mark("agora-web-sdk/".concat(o,"/publish-").concat(n))}measureFromSubscribeStart(o,n){const i=performance.getEntriesByName("agora-web-sdk/".concat(o,"/subscribe-").concat(n));if(i.length>0){const s=i[i.length-1];return Math.round(performance.now()-s.startTime)}return 0}measureFromPublishStart(o,n){const i=performance.getEntriesByName("agora-web-sdk/".concat(o,"/publish-").concat(n));if(i.length>0){const s=i[i.length-1];return Math.round(performance.now()-s.startTime)}return 0}};function LE(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function hl(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?LE(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):LE(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class Ud{constructor(n){C(this,"store",void 0),C(this,"onStatsException",void 0),C(this,"onUploadPublishDuration",void 0),C(this,"onStatsChanged",void 0),C(this,"localStats",new Map),C(this,"remoteStats",new Map),C(this,"updateStatsInterval",void 0),C(this,"trafficStats",void 0),C(this,"trafficStatsPeerList",[]),C(this,"uplinkStats",void 0),C(this,"exceptionMonitor",void 0),C(this,"p2pChannel",void 0),C(this,"scalabilityMode",FA.L1T1),C(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=n,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new Jf,this.exceptionMonitor.on("exception",(i,s,c)=>{this.onStatsException&&this.onStatsException(i,s,c)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ne.LocalAudioTrack)||hl({},hE)}getLocalVideoTrackStats(){return this.localStats.get(ne.LocalVideoTrack)||hl({},pE)}getRemoteAudioTrackStats(n){const i=(d,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return p&&(h.publishDuration=p.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},s={};if(n){var c;const d=null===(c=this.remoteStats.get(n))||void 0===c?void 0:c.audioStats;d&&(s[n]=i(n,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:p}]=d;p&&(s[h]=i(h,p))});return s}getRemoteNetworkQualityStats(n){const i={};if(n){var s;const c=null===(s=this.remoteStats.get(n))||void 0===s?void 0:s.networkStats;c&&(i[n]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{networkStats:h}]=c;h&&(i[d]=h)});return i}getRemoteVideoTrackStats(n){const i=(d,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return p&&(h.publishDuration=p.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},s={};if(n){var c;const d=null===(c=this.remoteStats.get(n))||void 0===c?void 0:c.videoStats;d&&(s[n]=i(n,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:p}]=d;p&&(s[h]=i(h,p))});return s}getRTCStats(){let n=0,i=0,s=0,c=0;const d=this.localStats.get(ne.LocalAudioTrack);d&&(n+=d.sendBytes,i+=d.sendBitrate);const h=this.localStats.get(ne.LocalVideoTrack);h&&(n+=h.sendBytes,i+=h.sendBitrate);const p=this.localStats.get(ne.LocalVideoLowTrack);p&&(n+=p.sendBytes,i+=p.sendBitrate),this.remoteStats.forEach(_=>{let{audioStats:E,videoStats:y}=_;E&&(s+=E.receiveBytes,c+=E.receiveBitrate),y&&(s+=y.receiveBytes,c+=y.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:i,SendBytes:n,RecvBytes:s,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(n){this.localStats.set(n,void 0)}removeLocalStats(n){n?this.localStats.delete(n):this.localStats.clear()}addRemoteStats(n){this.remoteStats.set(n,{})}removeRemoteStats(n){n?this.remoteStats.delete(n):this.remoteStats.clear()}addP2PChannel(n){this.p2pChannel=n}updateTrafficStats(n){n.peer_delay=n.peer_delay.filter(i=>void 0!==i.B_ppad||void 0!==i.B_ppvd),n.peer_delay.filter(i=>-1===this.trafficStatsPeerList.indexOf(i.peer_uid)).forEach(i=>{var s;const c=null===(s=this.p2pChannel)||void 0===s?void 0:s.getRemoteMedia(i.peer_uid),d=null!=c&&c.videoSSRC?gi.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=null!=c&&c.audioSSRC?gi.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;void 0!==i.B_ppad&&void 0!==i.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=n}updateUplinkStats(n){this.uplinkStats&&this.uplinkStats.B_fir!==n.B_fir&&I.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(n.B_fir)),this.uplinkStats=n}static isRemoteVideoFreeze(n,i,s){return!!n&&(!!s&&i.framesDecodeFreezeTime>s.framesDecodeFreezeTime||!(!s||i.framesDecodeCount>s.framesDecodeCount))}static isRemoteAudioFreeze(n){return!!n&&n._isFreeze()}isLocalVideoFreeze(n){return!(!n.inputFrame||!n.sentFrame)&&n.inputFrame.frameRate>5&&n.sentFrame.frameRate<3}updateLocalStats(n){Array.from(this.localStats.entries()).forEach(i=>{let[s,c]=i;switch(s){case ne.LocalVideoTrack:case ne.LocalVideoLowTrack:{const h=c,p=hl({},pE),m=n.getStats(),_=n.getLocalMedia(s);if(m){const E=m.videoSend.find(y=>y.ssrc===_?.ssrcs[0].ssrcId);if(E){const y=n.getLocalVideoSize(),S=n.getEncoderConfig(ne.LocalVideoTrack);"H264"!==E.codec&&"H265"!==E.codec&&"VP8"!==E.codec&&"VP9"!==E.codec&&"AV1X"!==E.codec&&"AV1"!==E.codec||(p.codecType=E.codec),p.sendBytes=E.bytes,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0,E.inputFrame?(p.captureFrameRate=E.inputFrame.frameRate,p.captureResolutionHeight=E.inputFrame.height,p.captureResolutionWidth=E.inputFrame.width):y&&(p.captureResolutionWidth=y.width,p.captureResolutionHeight=y.height),E.sentFrame?(p.sendFrameRate=E.sentFrame.frameRate,p.sendResolutionHeight=E.sentFrame.height,p.sendResolutionWidth=E.sentFrame.width):y&&(p.sendResolutionWidth=y.width,p.sendResolutionHeight=y.height),E.avgEncodeMs&&(p.encodeDelay=E.avgEncodeMs),S&&S.bitrateMax&&(p.targetSendBitrate=1e3*S.bitrateMax),p.sendPackets=E.packets,p.sendPacketsLost=E.packetsLost,p.sendJitterMs=E.jitterMs,p.sendRttMs=E.rttMs,p.totalDuration=h?h.totalDuration+1:1,p.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(E)&&(p.totalFreezeTime+=1),E.scalabilityMode&&this.scalabilityMode!==E.scalabilityMode&&(I.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(E.scalabilityMode)),this.scalabilityMode=E.scalabilityMode)}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(s,p),(h?.sendResolutionWidth!==p.sendResolutionWidth||h?.sendResolutionHeight!==p.sendResolutionHeight)&&(null===(d=this.onStatsChanged)||void 0===d||d.call(this,"resolution",{width:p.sendResolutionWidth,height:p.sendResolutionHeight})),p&&_&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,_.track,p);break}case ne.LocalAudioTrack:{const h=c,p=hl({},hE),m=n.getStats(),_=n.getLocalMedia(s);if(m){const E=m.audioSend.find(y=>y.ssrc===_?.ssrcs[0].ssrcId);if(E){if("opus"!==E.codec&&"aac"!==E.codec&&"PCMU"!==E.codec&&"PCMA"!==E.codec&&"G722"!==E.codec||(p.codecType=E.codec),E.inputLevel)p.sendVolumeLevel=Math.round(32767*E.inputLevel);else{const y=n.getLocalAudioVolume();y&&(p.sendVolumeLevel=Math.round(32767*y))}p.sendBytes=E.bytes,p.sendPackets=E.packets,p.sendPacketsLost=E.packetsLost,p.sendJitterMs=E.jitterMs,p.sendRttMs=E.rttMs,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0}}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ne.LocalAudioTrack,p),p&&_&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,_.track,p);break}}})}updateRemoteStats(n){Array.from(this.remoteStats.entries()).forEach(i=>{let[s,{videoStats:c,audioStats:d,videoPcStats:h}]=i;const p=d,m=c,_=h,E=hl({},nD),y=hl({},HC),S=hl({},W1),{audioTrack:T,videoTrack:O,audioSSRC:N,videoSSRC:w}=n.getRemoteMedia(s),k=n.getStats(),V=k?.audioRecv.find(re=>re.ssrc===N),U=k?.videoRecv.find(re=>re.ssrc===w),Y=this.trafficStats&&this.trafficStats.peer_delay.find(re=>re.peer_uid===s);if(V&&("opus"!==V.codec&&"aac"!==V.codec&&"PCMU"!==V.codec&&"PCMA"!==V.codec&&"G722"!==V.codec||(E.codecType=V.codec),V.outputLevel?E.receiveLevel=Math.round(32767*V.outputLevel):T&&(E.receiveLevel=Math.round(32767*T.getVolumeLevel())),E.receiveBytes=V.bytes,E.receivePackets=V.packets,E.receivePacketsLost=V.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.receiveBitrate=p?8*Math.max(0,E.receiveBytes-p.receiveBytes):0,E.totalDuration=p?p.totalDuration+1:1,E.totalFreezeTime=p?p.totalFreezeTime:0,E.freezeRate=E.totalFreezeTime/E.totalDuration,E.receiveDelay=V.jitterBufferMs,E.totalDuration>10&&Ud.isRemoteAudioFreeze(T)&&(E.totalFreezeTime+=1)),U){"H264"!==U.codec&&"H265"!==U.codec&&"VP8"!==U.codec&&"VP9"!==U.codec&&"AV1X"!==U.codec&&"AV1"!==U.codec||(y.codecType=U.codec),y.receiveBytes=U.bytes,y.receiveBitrate=m?8*Math.max(0,y.receiveBytes-m.receiveBytes):0,y.decodeFrameRate=U.decodeFrameRate<0?0:U.decodeFrameRate,y.renderFrameRate=U.decodeFrameRate<0?0:U.decodeFrameRate,U.outputFrame&&(y.renderFrameRate=U.outputFrame.frameRate),U.receivedFrame?(y.receiveFrameRate=U.receivedFrame.frameRate,y.receiveResolutionHeight=U.receivedFrame.height,y.receiveResolutionWidth=U.receivedFrame.width):O&&(y.receiveResolutionHeight=O._videoHeight||0,y.receiveResolutionWidth=O._videoWidth||0),void 0!==U.framesRateFirefox&&(y.receiveFrameRate=Math.round(U.framesRateFirefox)),y.receivePackets=U.packets,y.receivePacketsLost=U.packetsLost,y.packetLossRate=y.receivePacketsLost/(y.receivePackets+y.receivePacketsLost),y.totalDuration=m?m.totalDuration+1:1,y.totalFreezeTime=m?m.totalFreezeTime:0,y.receiveDelay=U.jitterBufferMs||0;const re=!!w&&n.getRemoteVideoIsReady(w);O&&re&&Ud.isRemoteVideoFreeze(O,U,_)&&(y.totalFreezeTime+=1),y.freezeRate=y.totalFreezeTime/y.totalDuration}Y&&(E.end2EndDelay=Y.B_ad,y.end2EndDelay=Y.B_vd,E.transportDelay=Y.B_ed,y.transportDelay=Y.B_ed,E.currentPacketLossRate=Y.B_ealr4/100,y.currentPacketLossRate=Y.B_evlr4/100,S.uplinkNetworkQuality=Y.B_punq?Y.B_punq:0,S.downlinkNetworkQuality=Y.B_pdnq?Y.B_pdnq:0),this.remoteStats.set(s,{audioStats:E,videoStats:y,videoPcStats:U,networkStats:S}),T&&this.exceptionMonitor.setRemoteAudioStats(T,E),O&&this.exceptionMonitor.setRemoteVideoStats(O,y)})}}function WD(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function xE(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?WD(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):WD(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function Qf(o){return o.match(/^[\.\:\d]+$/)?"".concat(o.replace(/[^\d]/g,"-"),".").concat(B("TURN_DOMAIN")):(I.info("Cannot recognized as IP address ".concat(o,". Used As Host instead")),o)}function zD(o,n){var i,s;const c=B("GATEWAY_DOMAINS");let d=c[1]&&-1!==n.indexOf(c[1])?1:0;o.addresses=o.addresses||[];const h=o.addresses.map(m=>m.domain_prefix?{address:"".concat(m.domain_prefix,".").concat(c[d++%c.length],":").concat(m.port)}:m.ip.match(/^[\.\:\d]+$/)?{ip:m.ip,port:m.port,address:"".concat(m.ip.replace(/[^\d]/g,"-"),".").concat(c[d++%c.length],":").concat(m.port)}:(I.info("Cannot recognized as IP address ".concat(m.ip,". Used As Host instead")),{ip:m.ip,port:m.port,address:"".concat(m.ip,":").concat(m.port)}));if(null!==(i=o.detail)&&void 0!==i&&i[18]&&"string"==typeof(null===(s=o.detail)||void 0===s?void 0:s[18])){const _=o.detail[18]?.split(";");for(let E=0;E<_.length;E++){var p;const y=eD(p=_[E]).call(p);h[E]&&y&&(h[E].ip6=y)}}return{gatewayAddrs:h,uid:o.uid,cid:o.cid,cert:o.cert,vid:o.detail&&o.detail[8],uni_lbs_ip:o.detail&&o.detail[1],res:o,csIp:o.detail&&o.detail[502]}}function Er(o){return"number"==typeof o?o:o.exact||o.ideal||o.max||o.min||0}function Zf(o){const n=o._encoderConfig;if(!n)return{};const i={resolution:n.width&&n.height?"".concat(Er(n.width),"x").concat(Er(n.height)):void 0,maxVideoBW:n.bitrateMax,minVideoBW:n.bitrateMin};return"number"==typeof n.frameRate?(i.maxFrameRate=n.frameRate,i.minFrameRate=n.frameRate):n.frameRate&&(i.maxFrameRate=n.frameRate.max||n.frameRate.ideal||n.frameRate.exact||n.frameRate.min,i.minFrameRate=n.frameRate.min||n.frameRate.ideal||n.frameRate.exact||n.frameRate.max),i}function qL(o){const n={connectionType:0,googRtt:o.rtt};switch(o.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=o.selectedCandidatePair.localCandidate.relayProtocol;"udp"===i&&(n.connectionType=1),"tcp"===i&&(n.connectionType=3),"tls"===i&&(n.connectionType=4);break}case"srflx":n.connectionType=2}return n}function em(o){return o>=0&&o<.17?1:o>=.17&&o<.36?2:o>=.36&&o<.59?3:o>=.59&&o<=1?4:o>1?5:0}function tm(o,n){let i,s,c;switch(n){case nn.CHOOSE_SERVER:s=4096,c="choose server";break;case nn.CLOUD_PROXY:s=1048576,c="proxy";break;case nn.CLOUD_PROXY_5:s=4194304,c="proxy5";break;case nn.CLOUD_PROXY_FALLBACK:s=4194310,c="proxy fallback";break;default:throw new W(M.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:o.detail&&o.detail[502],retry:!1})}if(o.response_body.forEach(d=>{d.buffer&&d.buffer.flag===s&&(i={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>xE(xE({},h),{},{ticket:d.buffer.cert})),server_ts:o.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:xE(xE({},d.buffer.detail),o.detail),flag:d.buffer.flag,opid:o.opid,cert:d.buffer.cert})}),!i)throw new W(M.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:o.detail&&o.detail[502]});return i}function YL(o,n){return FE.apply(this,arguments)}function FE(){return FE=x(function*(o,n){return yield z.all(o.addresses.map(function(){var i=x(function*(s){return{address:Qf(s.ip),tcpport:s.port,udpport:s.port,username:n&&B("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?n.toString():no.username,password:n&&B("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?yield t1(n.toString()):no.password}});return function(s){return i.apply(this,arguments)}}()))}),FE.apply(this,arguments)}function UE(o,n){const i=n._videoHeight||n.getMediaStreamTrack(!0).getSettings().height;return i?Math.max(i/Er(o.height),1):(I.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function pl(o){let{candidateType:n,relayProtocol:i,type:s,address:c,port:d,protocol:h}=o;return"local-candidate"===s?{candidateType:n,relayProtocol:i,protocol:h}:{candidateType:n,relayProtocol:i,address:c,port:d,protocol:h}}function KD(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}class $L extends kt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(n){var i;be(i=["tryNext","recover"]).call(i,n)&&this.resetReconnectCount(n),this._reconnectMode=n}get state(){return this._state}set state(n){n!==this._state&&(this._state=n,"reconnecting"===this._state?this.emit(gn.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(gn.CONNECTED):"closed"===this._state?this.emit(gn.CLOSED):"failed"===this._state&&this.emit(gn.FAILED))}constructor(n,i,s,c){super(),C(this,"connectionID",0),C(this,"currentURLIndex",0),C(this,"reconnectReason",void 0),C(this,"_reconnectMode","tryNext"),C(this,"_name",void 0),C(this,"_state","closed"),C(this,"_retryConfig",void 0),C(this,"_reconnectCount",0),C(this,"_forceCloseTimeout",5e3),C(this,"_onlineReconnectListener",void 0),C(this,"_closeEstablishingTransmitter",()=>{}),C(this,"_store",void 0),C(this,"_joinChannelServiceRecordIndex",void 0),C(this,"_useCompress",void 0),C(this,"_inflateLength",0),C(this,"_deflateLength",0),this._store=c,this._name=n,this._retryConfig=function(d){for(var h=1;h<arguments.length;h++){var p=null!=arguments[h]?arguments[h]:{};h%2?KD(Object(p),!0).forEach(function(m){C(d,m,p[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(p)):KD(Object(p)).forEach(function(m){Object.defineProperty(d,m,Object.getOwnPropertyDescriptor(p,m))})}return d}({},i),this._useCompress=s}resetReconnectCount(n){I.debug("".concat(this._name," reset reconnect count, reason: ").concat(n)),this._reconnectCount=0}close(n,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const s=this._transmitter;i?setTimeout(()=>s.close(),500):s.close(),this._transmitter=void 0}this.state=n?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(n,i){if(!this._transmitter)return void I.warning("[".concat(this._name,"] can not reconnect, no websocket"));var s;void 0!==n&&(this.reconnectMode=n),I.debug("[".concat(this._name,"] reconnect is triggered initiative")),"number"==typeof this._joinChannelServiceRecordIndex&&(null===(s=this._store)||void 0===s||s.recordJoinChannelService({status:"error",errors:[new Error(i)]},this._joinChannelServiceRecordIndex));const c=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),c&&c.bind(this._transmitter)({code:9999,reason:i})}getInflateData(){const n=this._inflateLength,i=this._deflateLength;return this.clearInflateData(),{inflateLength:n,deflateLength:i}}setInflateData(n){this._deflateLength=this._deflateLength+n.originLength,this._inflateLength=this._inflateLength+n.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}var Io;!function(o){o[o.Default=0]="Default",o[o.Ack=1]="Ack"}(Io||(Io={}));class XL{constructor(n,i,s){C(this,"version",1),C(this,"initialRTO",void 0),C(this,"maxBatchAckCount",void 0),C(this,"maxRTO",void 0),C(this,"initialRTT",void 0),C(this,"ID",void 0),C(this,"rtt",void 0),C(this,"packetNumber",1),C(this,"rtoRatioMap",new Map),C(this,"timeoutMap",new Map),C(this,"unorderedPacketQueue",[]),C(this,"batchAckPacketQueue",[]),C(this,"lastOrderedPacketNumber",0),C(this,"batchAckTimer",void 0),C(this,"sendImpl",void 0),C(this,"receiveImpl",void 0),this.sendImpl=n,this.receiveImpl=i,this.ID=Ot(7,"transmitter-"),this.initialRTO=void 0!==s?.initialRTO?s.initialRTO:B("TRANSMITTER_INITIAL_RTO"),this.initialRTT=void 0!==s?.initialRTT?s.initialRTT:B("TRANSMITTER_INITIAL_RTT"),this.rtt=void 0!==s?.initialRTT?s.initialRTT:B("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=void 0!==s?.maxBatchAckCount?s.maxBatchAckCount:B("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=void 0!==s?.maxRTO?s.maxRTO:B("TRANSMITTER_MAX_RTO")}packetize(n,i){return{type:Io.Default,version:this.version,packetNumber:i,payload:n}}serialize(n){switch(n.type){case Io.Default:{let i;i="string"==typeof n.payload?(new TextEncoder).encode(n.payload):n.payload;const s=new ArrayBuffer(i.length+15),c=new DataView(s);return c.setUint16(0,n.version),c.setUint8(2,n.type),c.setUint32(3,n.packetNumber),Qk(c,7,BigInt(n.sendTs)),new Uint8Array(c.buffer).set(i,15),s}case Io.Ack:{const i=new ArrayBuffer(16),s=new DataView(i);return s.setUint16(0,n.version),s.setUint8(2,n.type),s.setUint32(3,n.maxAckPacketNumber),s.setUint8(7,n.shift),Qk(s,8,BigInt(n.ackSendTs)),i}}}deserialize(n){const i=new DataView(n),s=i.getUint16(0),c=i.getUint8(2);switch(c){case Io.Default:{const d=i.getUint32(3),h=kr(i,7),p=n.slice(15),m=(new TextDecoder).decode(p);return{version:s,type:c,packetNumber:d,sendTs:Number(h),payload:m}}case Io.Ack:{const d=i.getUint32(3),h=i.getUint8(7),p=kr(i,8);return{version:s,type:c,maxAckPacketNumber:d,shift:h,ackSendTs:Number(p)}}default:throw I.error("[".concat(this.ID,"] Unrecognized packet type ").concat(c)),new Error("Unrecognized packet type ".concat(c))}}sendMessage(n){const i=this.packetize(n,this.packetNumber);this.packetNumber=4294967295===this.packetNumber?1:this.packetNumber+1;const s=this.calculateRTO(i),c=window.setTimeout(()=>{this.resendMessage(i)},s);this.timeoutMap.set(i.packetNumber,c),this.sendPacket(i)}onData(n){const i=this.deserialize(n);i.type===Io.Default?this.ack(i):i.type===Io.Ack&&(this.updateRTT(i,Math.round(performance.now())),this.clearRTO(i))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(n=>{let[i,s]=n;window.clearTimeout(s)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,void 0!==this.batchAckTimer&&window.clearTimeout(this.batchAckTimer)}resendMessage(n){const i=this.calculateRTO(n),s=window.setTimeout(()=>{this.resendMessage(n)},i);this.timeoutMap.set(n.packetNumber,s),this.sendPacket(n)}calculateRTO(n){const i=this.rtoRatioMap.get(n.packetNumber);if(void 0===i)return this.rtoRatioMap.set(n.packetNumber,1),this.initialRTO;{const s=9*this.rtt/8*i;return this.rtoRatioMap.set(n.packetNumber,i+1),s>this.maxRTO?this.maxRTO:s}}updateRTT(n,i){this.rtt=this.rtt*(7/8)+(i-n.ackSendTs-this.rtt)/8}ack(n){if(n.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(n):(this.batchAckPacketQueue.push(n),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(n.payload);;){const i=this.unorderedPacketQueue[0];if(!i){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(i.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else n.packetNumber<=this.lastOrderedPacketNumber?this.sendPacket({ackSendTs:n.sendTs,maxAckPacketNumber:n.packetNumber,shift:0,type:Io.Ack,version:this.version}):n.packetNumber>this.lastOrderedPacketNumber&&(this.unorderedPacketQueue[n.packetNumber-this.lastOrderedPacketNumber-2]=n,this.sendPacket({ackSendTs:n.sendTs,maxAckPacketNumber:n.packetNumber,shift:0,type:Io.Ack,version:this.version}))}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0,this.sendPacket({ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Io.Ack,version:this.version}),this.batchAckPacketQueue=[]}sendPacket(n){n.type===Io.Default&&(n.sendTs=Math.round(performance.now()));const i=this.serialize(n);this.sendImpl(i)}clearRTO(n){for(let i=n.maxAckPacketNumber-n.shift;i<=n.maxAckPacketNumber;i++){const s=this.timeoutMap.get(i);void 0!==s&&window.clearTimeout(s),this.timeoutMap.delete(i),this.rtoRatioMap.delete(i)}}}class qD extends $L{constructor(n,i){super(n,i,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0),C(this,"_initMutex",void 0),C(this,"_reconnectInterrupter",void 0),C(this,"_url",void 0),C(this,"_transmitter",void 0),C(this,"_addresses",void 0),C(this,"_reliableTransmission",void 0),this._initMutex=new li("datachannel");const{timeout:s,timeoutFactor:c}=i,d=Math.max(300,Math.floor(3*s/5)),h=Math.max(1.2,Math.floor(8*c)/10);xi.ONLINE&&(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h),Bn.on(ba.NETWORK_STATE_CHANGE,(p,m)=>{p!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(p)),p===xi.ONLINE?(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h):(this._retryConfig.timeout=s,this._retryConfig.timeoutFactor=c))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}init(n){var i=arguments,s=this;return x(function*(){s._forceCloseTimeout=i.length>1&&void 0!==i[1]?i[1]:5e3;return s._initMutex.lock().then(h=>new z((p,m)=>{((h,p)=>{s._addresses=n,s.currentURLIndex=s._addresses.findIndex(_=>_.fingerprint||B("FINGERPRINT"));const m=s._addresses[s.currentURLIndex];s.state="connecting",s.createTransmitterConnection(m).then(h).catch(p),s.once(gn.CLOSED,()=>p(new W(M.WS_DISCONNECT))),s.once(gn.CONNECTED,()=>h())})(p,m)}).then(()=>{h()}).catch(()=>{h()}))})()}sendMessage(n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new W(M.WS_ABORT,"datachannel is not ready");try{i||(n=JSON.stringify(n)),this._reliableTransmission.sendMessage(n)}catch(s){throw new W(M.WS_ERR,"send datachannel signal message error"+s.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(n){const i=JSON.stringify(n);return{compressed:i,compressedLength:i.length,origin:n}}sendMessageWithUint8Array(n){return{compressed:n,compressedLength:n.byteLength,origin:n}}createTransmitterConnection(n){var i=this;return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(n.ip,":").concat(n.port),new z((s,c)=>{var d;const h=()=>{I.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),s()},p=function(){var y=x(function*(S){var T;if(null===(T=i._closeEstablishingTransmitter)||void 0===T||T.call(i),I.debug("[".concat(i._name,"] datachannel close ").concat(i._url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(i.reconnectMode)),i._reconnectCount<i._retryConfig.maxRetryCount){"connected"===i.state&&(i.reconnectReason=S.reason,i.state="reconnecting");const O=to(i,gn.WILL_RECONNECT,i.reconnectMode)||i.reconnectMode,N=yield i.reconnectWithAction(O);if("closed"===i.state)return void I.debug("[".concat(i.connectionID,"] dc is closed, no need to reconnect"));if(!N)return c(new W(M.WS_DISCONNECT,"datachannel reconnect failed: ".concat(S.code))),void i.close(!0);s()}else c(new W(M.WS_DISCONNECT,"datachannel close: ".concat(S.code))),i.close()});return function(T){return y.apply(this,arguments)}}(),m=y=>{var S;null===(S=this._reliableTransmission)||void 0===S||S.onData(y.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),I.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(n)));const _=null===(d=this._store)||void 0===d?void 0:d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),E=Date.now();dn(this,gn.TO_CONNECT_DATACHANNEL,n).then(y=>{var S,T;if(!y)throw new Error("transmissonInfo not exist yet");const{transmitter:O,close:N}=y;this._transmitter=O,null===(S=this._store)||void 0===S||S.signalChannelOpen();const w=Date.now()-E;I.debug("[choose dc] dc open cost ".concat(w,"ms")),this._reliableTransmission=new XL(k=>{var V;this._transmitter&&"open"===this._transmitter.readyState&&(null===(V=this._transmitter)||void 0===V||V.send(k))},k=>{"string"==typeof k&&this.emit(gn.ON_MESSAGE,k)}),this._closeEstablishingTransmitter=()=>{var k;null===(k=this._reliableTransmission)||void 0===k||k.close(),this._reliableTransmission=void 0,N()},h&&h(),O.onclose=p,O.onmessage=m,null===(T=this._store)||void 0===T||T.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this._joinChannelServiceRecordIndex=_}).catch(y=>{var S;if(null===(S=this._store)||void 0===S||S.recordJoinChannelService({endTs:Date.now(),status:y instanceof W&&y.code===M.WS_ABORT?"aborted":"error",errors:[y]},_),"closed"!==this.state){if(y instanceof W&&y.code===M.WS_ERR){const T=new W(M.WS_ERR,"init datachannel failed! Error: ".concat(y.toString()));return I.error("[".concat(this._name,"]").concat(T)),void c(T)}p&&p(y)}else c(new W(M.WS_DISCONNECT,"datachannel is closed: ".concat(y.toString())))})})}reconnectWithAction(n){var i=arguments,s=this;return x(function*(){let c=!(i.length>1&&void 0!==i[1])||i[1];if(s._reconnectCount>=s._retryConfig.maxRetryCount||!s._addresses||"closed"===s.state)return!1;s._onlineReconnectListener||Bn.networkState!==xi.OFFLINE||(s._onlineReconnectListener=Bn.onlineWaiter&&Bn.onlineWaiter.then(()=>{s._onlineReconnectListener=void 0}));let d=!0;if(s._reconnectInterrupter=()=>{d=!1},c){const _=xg(s._reconnectCount,s._retryConfig);I.debug("[".concat(s._name,"] wait ").concat(_,"ms to reconnect datachannel, mode: ").concat(n)),yield z.race([ui(_),s._onlineReconnectListener||new z(()=>{})])}if("closed"===s.state||!d)return!1;s._reconnectCount+=1;const h=function(){var _=x(function*(E,y){s.emit(gn.RECONNECT_CREATE_CONNECTION,y),yield s.createTransmitterConnection(E)});return function(y,S){return _.apply(this,arguments)}}();try{if("retry"===n){const _=s._addresses[s.currentURLIndex];s.emit(gn.RECONNECT_WAITTING_FINISH,n),yield h(_,n)}else if("tryNext"===n){s.currentURLIndex+=1;for(let E=s.currentURLIndex;E<s._addresses.length;E++){if(s._addresses[E].fingerprint||B("FINGERPRINT")){s.currentURLIndex=E;break}s.currentURLIndex+=1}if(s.currentURLIndex>=s._addresses.length)return I.debug("[".concat(s._name,"] the available addresses are exhausted, change to recover")),yield s.reconnectWithAction("recover",!1);I.debug("[".concat(s._name,"] datachannel url length: ").concat(s._addresses.length," current index: ").concat(s.currentURLIndex));const _=s._addresses[s.currentURLIndex];s.emit(gn.RECONNECT_WAITTING_FINISH,n),yield h(_,n)}else"recover"===n&&(I.debug("[".concat(s._name,"] start to failback to websocket")),s.resetReconnectCount("recover mode"),s.emit(gn.RECONNECT_WAITTING_FINISH,n),s.emit(gn.FAILBACK));return!0}catch(_){var p,m;return I.error("[".concat(s._name,"] reconnect failed"),_.toString()),null!=_&&null!==(p=_.data)&&void 0!==p&&p.desc&&Array.isArray(_.data.desc)&&_.data.desc.length&&be(m=_.data.desc).call(m,"dynamic key expired")?(s.emit(gn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):yield s.reconnectWithAction(n,c)}})()}}class Rc extends kt{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===He.CONNECTED?this.emit(de.WS_CONNECTED):n===He.RECONNECTING?this.emit(de.WS_RECONNECTING,this._websocketReconnectReason):n===He.CLOSED&&this.emit(de.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),C(this,"_disconnectedReason",void 0),C(this,"_websocketReconnectReason",void 0),C(this,"_connectionState",He.CLOSED),C(this,"reconnectToken",void 0),C(this,"websocket",void 0),C(this,"openConnectionTime",void 0),C(this,"clientId",void 0),C(this,"lastMsgTime",Date.now()),C(this,"uploadCache",[]),C(this,"uploadCacheInterval",void 0),C(this,"rttRolling",new Ug(5)),C(this,"pingpongTimer",void 0),C(this,"inflateDataTimer",void 0),C(this,"pingpongTimeoutCount",0),C(this,"joinResponse",void 0),C(this,"multiIpOption",void 0),C(this,"initError",void 0),C(this,"spec",void 0),C(this,"store",void 0),C(this,"onWebsocketMessage",s=>{if(s instanceof ArrayBuffer)return void this.emit(de.ON_BINARY_DATA,s);const c=JSON.parse(s);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")&&(this.emit(c._type,c._message),c._type===xe.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===xe.ON_USER_BANNED))switch(c._message.error_code){case 14:this.close(Ke.UID_BANNED);break;case 15:this.close(Ke.IP_BANNED);break;case 16:this.close(Ke.CHANNEL_BANNED)}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new qD("gateway-".concat(this.clientId),this.spec.retryConfig,!0,i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===He.CONNECTED&&this.reconnect("retry",Ra.OFFLINE)})}request(n,i,s,c){var d=this;return x(function*(){const h=Ot(6,""),p={_id:h,_type:n,_message:i},m=d.websocket.connectionID,_=()=>new z((N,w)=>{if(d.connectionState===He.CONNECTED)return N();const k=()=>{d.off(de.WS_CLOSED,V),N()},V=()=>{d.off(de.WS_CONNECTED,k),w(new W(M.WS_ABORT))};d.once(de.WS_CONNECTED,k),d.once(de.WS_CLOSED,V),n!==Se.PUBLISH&&n!==Se.SUBSCRIBE&&n!==Se.UNSUBSCRIBE&&n!==Se.UNPUBLISH&&n!==Se.CONTROL&&n!==Se.RESTART_ICE||d.once(de.DISCONNECT_P2P,()=>{w(new W(M.DISCONNECT_P2P))}),n!==Se.PUBLISH&&n!==Se.RESTART_ICE||d.once(de.ABORT_P2P_EXECUTION,()=>{w(new W(M.DISCONNECT_P2P))})});if(d.connectionState!==He.CONNECTING&&d.connectionState!==He.RECONNECTING||n===Se.JOIN||n===Se.REJOIN||(yield _()),n===Se.LEAVE&&(d.websocket.unbindDcCloseEventListener(),c=!0),d.websocket.sendMessage(p,!0,!1),c)return;const E=new z((N,w)=>{let k=!1;const V=(Y,re)=>{k=!0,N({isSuccess:"success"===Y,message:re||{}}),d.off(de.WS_CLOSED,U),d.off(de.WS_RECONNECTING,U),d.emit(de.REQUEST_SUCCESS,n,i)};d.once("res-@".concat(h),V);const U=()=>{w(new W(M.WS_ABORT,"type: ".concat(n))),d.off(de.WS_CLOSED,U),d.off(de.WS_RECONNECTING,U),d.off("res-@".concat(h),V)};d.once(de.WS_CLOSED,U),d.once(de.WS_RECONNECTING,U),ui(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||k||(I.warning("dc request timeout, type: ".concat(n)),d.emit(de.REQUEST_TIMEOUT,n,i))})});let y=null;try{y=yield E}catch(N){if(d.connectionState===He.CLOSED||n===Se.LEAVE)throw new W(M.WS_ABORT);return!d.spec.forceWaitGatewayResponse||s?N.throw():n===Se.JOIN||n===Se.REJOIN?null:(yield _(),yield d.request(n,i))}if(y.isSuccess)return y.message;const S=Number(y.message.error_code||y.message.code),T=Cd(S),O=new W(M.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(y.message.error_str),{code:S,data:y.message});return"success"===T.action?y.message:(I.warning("[".concat(d.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(S,", message: ").concat(T.desc,", action: ").concat(T.action)),S===Ie.ERR_TOO_MANY_BROADCASTERS?((n===Se.JOIN||n===Se.REJOIN)&&(d.initError=O,d.close()),O.throw()):"failed"===T.action?O.throw():"quit"===T.action?(d.initError=O,d.close(),O.throw()):(S===Ie.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=y.message.option,I.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",Ra.MULTI_IP)):d.reconnect(T.action,Ra.SERVER_ERROR),n===Se.JOIN||n===Se.REJOIN?null:yield d.request(n,i)))})()}waitMessage(n,i){return new z(s=>{const c=d=>{(!i||i(d))&&(this.off(n,c),s(d))};this.on(n,c)})}upload(n,i){const s={_type:n,_message:i};try{this.websocket.sendMessage(s)}catch{const d=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==He.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){this.websocket.sendMessage({_type:n,_message:i})}init(n,i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new z((s,c)=>{this.once(de.WS_CONNECTED,()=>s(this.joinResponse)),this.once(de.WS_CLOSED,()=>c(this.initError||new W(M.WS_ABORT))),this.connectionState=He.CONNECTING,this.websocket.init(n).catch(c),this.websocket.once(gn.FAILBACK,()=>{void 0===this.openConnectionTime&&c(new W(M.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{i&&void 0===this.openConnectionTime&&(I.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),c(new W(M.INIT_DATACHANNEL_TIMEOUT)))},B("DC_JOIN_WITH_FAILBACK"))})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||Ke.LEAVE,this.connectionState=He.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),n===Ke.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new qD("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}join(){var n=this;return x(function*(){if(!n.joinResponse){n.emit(de.ABORT_P2P_EXECUTION);const i=yield dn(n,de.DATACHANNEL_CONNECTING),s=yield n.request(Se.JOIN,i);if(!s)return n.emit(de.REPORT_JOIN_GATEWAY,M.TIMEOUT,n.url||""),!1;n.joinResponse=s,n.emit(de.JOIN_RESPONSE,n.joinResponse),n.reconnectToken=n.joinResponse.rejoin_token}return n.connectionState=He.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),!0})()}rejoin(){var n=this;return x(function*(){if(!n.reconnectToken)throw new W(M.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=_c(n,de.REQUEST_REJOIN_INFO);i.token=n.reconnectToken;const s=yield n.request(Se.REJOIN,i);return!!s&&(n.connectionState=He.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),s.peers&&s.peers.forEach(c=>{n.emit(xe.ON_USER_ONLINE,{uid:c.uid}),c.audio&&n.emit(xe.ON_ADD_AUDIO_STREAM,{uid:c.uid,uint_id:c.uint_id,audio:!0,ssrcId:c.audio_ssrc}),c.video&&n.emit(xe.ON_ADD_VIDEO_STREAM,{uid:c.uid,uint_id:c.uint_id,video:!0,ssrcId:c.video_ssrc}),n.emit(c.audio_mute?xe.MUTE_AUDIO:xe.UNMUTE_AUDIO,{uid:c.uid}),n.emit(c.video_mute?xe.MUTE_VIDEO:xe.UNMUTE_VIDEO,{uid:c.uid}),n.emit(c.audio_enable_local?xe.ENABLE_LOCAL_AUDIO:xe.DISABLE_LOCAL_AUDIO,{uid:c.uid}),n.emit(c.video_enable_local?xe.ENABLE_LOCAL_VIDEO:xe.DISABLE_LOCAL_VIDEO,{uid:c.uid}),c.audio||c.video||n.emit(xe.ON_REMOVE_STREAM,{uid:c.uid,uint_id:c.uint_id})}),!0)})()}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleNotification(n){I.debug("[".concat(this.clientId,"] receive notification: "),n);const i=Cd(n.code);if("success"!==i.action){if("failed"!==i.action)return"quit"===i.action?("ERR_REPEAT_JOIN_CHANNEL"===i.desc&&this.close(Ke.UID_BANNED),void this.close()):void this.reconnect(i.action,Ra.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=B("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(I.warning("PINGPONG Timeout. Last Socket Message: ".concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ra.TIMEOUT):this.request(Se.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),B("REPORT_STATS")&&this.send(Se.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleInflateData(){const{inflateLength:n,deflateLength:i}=this.websocket.getInflateData();0!==n&&0!==i&&this.upload(Fr.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:n})}handleWebsocketEvents(){var n=this;this.websocket.on(gn.RECONNECT_WAITTING_FINISH,i=>{this.emit(de.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(gn.RECONNECT_CREATE_CONNECTION,i=>{this.emit(de.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(gn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(gn.CLOSED,()=>{this.connectionState=He.CLOSED}),this.websocket.on(gn.FAILED,()=>{this._disconnectedReason=Ke.NETWORK_ERROR,this.connectionState=He.CLOSED}),this.websocket.on(gn.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState=this.connectionState===He.CONNECTED?He.RECONNECTING:He.CONNECTING}),this.websocket.on(gn.WILL_RECONNECT,(i,s)=>{if(_c(this,de.IS_P2P_DISCONNECTED)&&"retry"===i)return I.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P),s("tryNext");"retry"!==i&&(I.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(i)),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P)),s(i)}),this.websocket.on(gn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{I.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",Ra.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(de.REPORT_JOIN_GATEWAY,i.message||i.code,this.url||""),i instanceof W&&i.code===M.UNEXPECTED_RESPONSE&&i.data.code===Ie.ERR_NO_AUTHORIZED)return I.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Ra.SERVER_ERROR);I.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ra.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(gn.REQUEST_NEW_URLS,(i,s)=>{dn(this,de.REQUEST_RECOVER,this.multiIpOption).then(i).catch(s)}),this.websocket.on(gn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(gn.TO_CONNECT_DATACHANNEL,function(){var i=x(function*(s,c,d){return dn(n,de.DATACHANNEL_PRECONNECT,s).then(c).catch(d)});return function(s,c,d){return i.apply(this,arguments)}}()),this.websocket.on(gn.FAILBACK,()=>{void 0!==this.openConnectionTime&&this.emit(de.DATACHANNEL_FAILBACK)})}}class Ah extends kt{constructor(n){super(),C(this,"_signal",void 0),C(this,"_sequence",0),C(this,"_userMap",new Map),C(this,"_encoder",new TextEncoder),this._signal=n}send(n,i,s,c,d){var h=this;return x(function*(){var p,m,_;"string"!=typeof i&&(i=JSON.stringify(i)),c=null!==(p=c)&&void 0!==p?p:Ot(6,""),d=null!==(m=d)&&void 0!==m?m:h._sequence++;const E={_id:c,_type:n,_seq:null!==(_=d)&&void 0!==_?_:h._sequence++,_message:i};if(B("SHOW_P2P_LOG")&&I.debug("send message",E),h.sendStreamMessage(JSON.stringify(E)),s)return;const y=new z((T,O)=>{const N=window.setTimeout(()=>{h.off("res-@".concat(c),w),I.warning("[external-signal] request timeout, type: ".concat(n)),O(new Q(0===h._userMap.size?M.INVALID_REMOTE_USER:M.TIMEOUT))},B("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),w=(k,V)=>{N&&window.clearTimeout(N),"success"===k?T({isSuccess:!0,message:V}):O(new Q(M.UNEXPECTED_ERROR,V))};h.once("res-@".concat(c),w)});let S;try{S=yield y}catch(T){if(T.code===M.TIMEOUT)return yield h.send(n,i,!1,c,d);throw T}return S.isSuccess?S.message:void 0})()}sendStreamMessage(n){this._splitMessage(n).forEach(i=>{this._signal.request(Se.DATA_STREAM,{payload:hf(this._encoder.encode(i))})})}onMessage(n){const{_uid:i}=n;let s;const c=this._userMap.get(i);if(c?s=c.splitMessageMap:(s=new Map,this._userMap.set(i,{isStart:!1,splitMessageMap:s,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map})),"id"in n&&"total"in n){var d;const{id:h,total:p}=n,m=null!==(d=s.get(h))&&void 0!==d?d:[];if(m.push(n),s.has(h)||s.set(h,m),m.length!==p)return;{const _=Vp(m).call(m,(E,y)=>E.index-y.index).map(E=>E.payload).join("");s.delete(h),(n=JSON.parse(_))._uid=i}}this.handleReceivedMessage(n)}setStart(n){this._userMap.has(n)?this._userMap.get(n).isStart=!0:this._userMap.set(n,{isStart:!0,splitMessageMap:new Map,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map}),this.handleReceivedMessage()}setEnd(n){return this._userMap.delete(n),0===this._userMap.size}ack(n,i,s){this.send(Mt.ACK,JSON.stringify({success:!s,message:i}),!0,n)}handleReceivedMessage(n){const i=()=>{this._userMap.forEach(_=>{const{receivedMessagesMap:E,nextExpectedSequenceNumber:y}=_;for(;E.has(y);){const S=E.get(y);E.delete(y),this.receiveMessage(S),_.nextExpectedSequenceNumber++}})};if(!n)return void i();const{_uid:s,_seq:c}=n,d=this._userMap.get(s),{receivedMessagesMap:h,isStart:p,nextExpectedSequenceNumber:m}=d;c<m?I.debug("[external-signal] receive old message, seq: ".concat(c)):(h.set(c,n),p&&c===m&&(this.receiveMessage(n),h.delete(m),d.nextExpectedSequenceNumber++,i()))}receiveMessage(n){const{_id:i,_type:s,_message:c,_uid:d}=n;if(B("SHOW_P2P_LOG")&&I.debug("\u6536\u5230\u6d88\u606f",n),i)switch(n._type){case Mt.PUBLISH:const h=JSON.parse(c);this._signal.emit(s,h,d),this.ack(n._id);break;case Mt.CONTROL:case Mt.UNPUBLISH:case Mt.DO_SUBSCRIBE:case Mt.DO_UNSUBSCRIBE:{const p=JSON.parse(c);p.uid=d,dn(this._signal,s,p).then(m=>{this.ack(n._id,m)}).catch(m=>{this.ack(n._id,void 0,!0)});break}case Mt.ACK:{const{success:p,message:m}=JSON.parse(c);this.emit("res-@".concat(i),p?"success":"failed",m);break}case Mt.CALL:dn(this,s,c).then(p=>{this.ack(i,p)});break;case Mt.RESTART_ICE:case Mt.EXCHANGE_SDP:case Mt.SUBSCRIBE:case Mt.UNSUBSCRIBE:dn(this._signal,s,c).then(p=>{this.ack(i,p)}).catch(p=>{this.ack(n._id,void 0,!0)});break;case Mt.CANDIDATE:this._signal.emit(s,c),this.ack(i);break;case Mt.JOIN:this.emit(s,JSON.parse(c));break;default:this.emit(s,c),this.ack(i)}}_splitMessage(n){if(n.length<Ah.MAX_MESSAGE_SIZE)return[n];const i=[],s=Ot(6,"");let c=0;const d=Math.ceil(n.length/800);for(;n.length>0;){c++;const h=n.slice(0,800);i.push({id:s,index:c,total:d,payload:h}),n=n.slice(800)}return i.map(h=>JSON.stringify(h))}clear(){this._sequence=0,this._userMap.clear()}}C(Ah,"MAX_MESSAGE_SIZE",1024);class JL extends kt{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===He.CONNECTED?this.emit(de.WS_CONNECTED):n===He.RECONNECTING?this.emit(de.WS_RECONNECTING,this._websocketReconnectReason):n===He.CLOSED&&this.emit(de.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),C(this,"_disconnectedReason",void 0),C(this,"_websocketReconnectReason",void 0),C(this,"_connectionState",He.CLOSED),C(this,"reconnectToken",void 0),C(this,"_userInRoom",!1),C(this,"_userOnlineTime",void 0),C(this,"websocket",void 0),C(this,"openConnectionTime",void 0),C(this,"clientId",void 0),C(this,"lastMsgTime",Date.now()),C(this,"uploadCache",[]),C(this,"uploadCacheInterval",void 0),C(this,"rttRolling",new Ug(5)),C(this,"pingpongTimer",void 0),C(this,"wsInflateDataTimer",void 0),C(this,"pingpongTimeoutCount",0),C(this,"joinResponse",void 0),C(this,"multiIpOption",void 0),C(this,"initError",void 0),C(this,"spec",void 0),C(this,"store",void 0),C(this,"_external_signal",void 0),C(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(de.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case xe.ON_DATA_STREAM:return void this.handleDataStream(c._message);case xe.MUTE_AUDIO:case xe.MUTE_VIDEO:case xe.ON_P2P_LOST:return;case xe.ON_USER_ONLINE:this.emit(c._type,c._message);const{uid:d}=c._message;return this._external_signal.setStart(d),void this._external_signal.send(Mt.JOIN,{onlineTime:this._userOnlineTime},!0)}if(this.emit(c._type,c._message),c._type===xe.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===xe.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Ke.UID_BANNED);break;case 15:this.close(Ke.IP_BANNED);break;case 16:this.close(Ke.CHANNEL_BANNED)}if(c._type===xe.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ie.ERR_LICENSE_MISSING:this.close(Ke.LICENSE_MISSING);break;case Ie.ERR_LICENSE_EXPIRED:this.close(Ke.LICENSE_EXPIRED);break;case Ie.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ke.LICENSE_MINUTES_EXCEEDED);break;case Ie.ERR_LICENSE_PERIOD_INVALID:this.close(Ke.LICENSE_PERIOD_INVALID);break;case Ie.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ke.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ie.ERR_LICENSE_ILLEGAL:this.close(Ke.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new dh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===He.CONNECTED&&this.reconnect("retry",ri.OFFLINE)}),this._external_signal=new Ah(this),this._handleSignalP2PEvents()}request(n,i,s,c){var d=this;return x(function*(){const h=Ot(6,""),p={_id:h,_type:n,_message:i},m=d.websocket.connectionID,_=()=>new z((N,w)=>{if(d.connectionState===He.CONNECTED)return N();const k=()=>{d.off(de.WS_CLOSED,V),N()},V=()=>{d.off(de.WS_CONNECTED,k),w(new Q(M.WS_ABORT))};d.once(de.WS_CONNECTED,k),d.once(de.WS_CLOSED,V),n!==Se.PUBLISH&&n!==Se.SUBSCRIBE&&n!==Se.UNSUBSCRIBE&&n!==Se.UNPUBLISH&&n!==Se.CONTROL&&n!==Se.RESTART_ICE||d.once(de.DISCONNECT_P2P,()=>{w(new Q(M.DISCONNECT_P2P))}),n!==Se.PUBLISH&&n!==Se.RESTART_ICE||d.once(de.ABORT_P2P_EXECUTION,()=>{w(new Q(M.DISCONNECT_P2P))})});if(d.connectionState!==He.CONNECTING&&d.connectionState!==He.RECONNECTING||n===Se.JOIN||n===Se.REJOIN||(yield _()),d.websocket.sendMessage(p,!0),c)return;const E=new z((N,w)=>{let k=!1;const V=(Y,re)=>{k=!0,N({isSuccess:"success"===Y,message:re||{}}),d.off(de.WS_CLOSED,U),d.off(de.WS_RECONNECTING,U),d.emit(de.REQUEST_SUCCESS,n,i)};d.once("res-@".concat(h),V);const U=()=>{w(new Q(M.WS_ABORT,"type: ".concat(n))),d.off(de.WS_CLOSED,U),d.off(de.WS_RECONNECTING,U),d.off("res-@".concat(h),V)};d.once(de.WS_CLOSED,U),d.once(de.WS_RECONNECTING,U),ui(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||k||(I.warning("[".concat(d.clientId,"] ws request timeout, type: ").concat(n)),d.emit(de.REQUEST_TIMEOUT,n,i))})});let y=null;try{y=yield E}catch(N){if(d.connectionState===He.CLOSED||n===Se.LEAVE)throw new Q(M.WS_ABORT);return!d.spec.forceWaitGatewayResponse||s?N.throw():n===Se.JOIN||n===Se.REJOIN?null:(yield _(),yield d.request(n,i))}if(y.isSuccess)return y.message;const S=Number(y.message.error_code||y.message.code),T=Cd(S),O=new Q(M.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(y.message.error_str),{code:S,data:y.message});return"success"===T.action?y.message:(I.warning("[".concat(d.clientId,"] [").concat(d.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(S,", message: ").concat(T.desc,", action: ").concat(T.action)),S===Ie.ERR_TOO_MANY_BROADCASTERS?((n===Se.JOIN||n===Se.REJOIN)&&(d.initError=O,d.close()),O.throw()):"failed"===T.action?O.throw():"quit"===T.action?(d.initError=O,d.close(),O.throw()):(S===Ie.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=y.message.option,I.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",ri.MULTI_IP)):d.reconnect(T.action,ri.SERVER_ERROR),n===Se.JOIN||n===Se.REJOIN?null:yield d.request(n,i)))})()}waitMessage(n,i){return new z(s=>{const c=d=>{(!i||i(d))&&(this.off(n,c),s(d))};this.on(n,c)})}upload(n,i){const s={_type:n,_message:i};try{this.websocket.sendMessage(s)}catch{const d=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==He.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){this.websocket.sendMessage({_type:n,_message:i})}sendExtensionMessage(n,i,s){var c=this;return x(function*(){return yield c.waitTillUserOnline(),yield c._external_signal.send(n,i,s)})()}init(n,i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new z((s,c)=>{this.once(de.WS_CONNECTED,()=>s(this.joinResponse)),this.once(de.WS_CLOSED,()=>c(this.initError||new Q(M.WS_ABORT))),this.connectionState=He.CONNECTING,this.websocket.init(n).catch(c),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||Ke.LEAVE,this.connectionState=He.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),n===Ke.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new dh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}join(){var n=this;return x(function*(){if(!n.joinResponse){n.emit(de.ABORT_P2P_EXECUTION);const i=yield dn(n,de.REQUEST_JOIN_INFO),s=yield n.request(Se.JOIN,i);if(!s)return n.emit(de.REPORT_JOIN_GATEWAY,M.TIMEOUT,n.url||""),!1;n.joinResponse=s,n.emit(de.JOIN_RESPONSE,n.joinResponse),n.reconnectToken=n.joinResponse.rejoin_token}return n.connectionState=He.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),n._userOnlineTime=(new Date).getTime(),n._external_signal.clear(),!0})()}rejoin(){var n=this;return x(function*(){if(!n.reconnectToken)throw new Q(M.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=_c(n,de.REQUEST_REJOIN_INFO);return i.token=n.reconnectToken,!!(yield n.request(Se.REJOIN,i))&&(n.connectionState=He.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),!0)})()}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleDataStream(n){try{var i;const s=Pg(n.payload),c=(new TextDecoder).decode(s),d=JSON.parse(c);"total"in d&&"id"in d||be(i=Object.values(Mt)).call(i,d._type)?(n.seq&&delete n.seq,d._uid=n.uid,this._external_signal.onMessage(d)):this.emit(xe.ON_DATA_STREAM,n)}catch{}}handleNotification(n){I.debug("[".concat(this.clientId,"] receive notification: "),n);const i=Cd(n.code);if("success"!==i.action){if("failed"!==i.action)return"quit"===i.action?("ERR_REPEAT_JOIN_CHANNEL"===i.desc&&this.close(Ke.UID_BANNED),void this.close()):void this.reconnect(i.action,ri.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=B("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(I.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ri.TIMEOUT):this.request(Se.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),B("REPORT_STATS")&&this.send(Se.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWsInflateData(){const{wsInflateLength:n,wsDeflateLength:i}=this.websocket.getWsInflateData();0!==n&&0!==i&&this.upload(Fr.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:n})}handleWebsocketEvents(){this.websocket.on(Oe.RECONNECT_WAITTING_FINISH,n=>{this.emit(de.WS_RECONNECT_WAITTING_FINISH,n)}),this.websocket.on(Oe.RECONNECT_CREATE_CONNECTION,n=>{this.emit(de.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(Oe.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Oe.CLOSED,()=>{this.connectionState=He.CLOSED}),this.websocket.on(Oe.FAILED,()=>{this._disconnectedReason=Ke.NETWORK_ERROR,this.connectionState=He.CLOSED}),this.websocket.on(Oe.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState=this.connectionState===He.CONNECTED?He.RECONNECTING:He.CONNECTING}),this.websocket.on(Oe.WILL_RECONNECT,(n,i,s)=>{if(_c(this,de.IS_P2P_DISCONNECTED)&&"retry"===n)return I.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P),s("tryNext");"retry"!==n&&(I.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(n)),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P)),s(n)}),this.websocket.on(Oe.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(n=>{I.warning("[".concat(this.clientId,"] rejoin failed ").concat(n)),this.reconnect("tryNext",ri.SERVER_ERROR)}):this.join().catch(n=>{if(this.emit(de.REPORT_JOIN_GATEWAY,n.message||n.code,this.url||""),n instanceof Q&&n.code===M.UNEXPECTED_RESPONSE&&n.data.code===Ie.ERR_NO_AUTHORIZED)return I.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ri.SERVER_ERROR);I.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ri.SERVER_ERROR):(this.initError=n,this.close())})}),this.websocket.on(Oe.REQUEST_NEW_URLS,(n,i)=>{dn(this,de.REQUEST_RECOVER,this.multiIpOption).then(n).catch(i)}),this.websocket.on(Oe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}_handleSignalP2PEvents(){var n=this;this._external_signal.on(Mt.JOIN,function(){var i=x(function*(s){if(n._userOnlineTime&&n._userOnlineTime<s.onlineTime){const c=yield dn(n,de.P2P_START,void 0),d=yield n._external_signal.send(Mt.CALL,c);n.emit(de.P2P_CONNECTION,d,!0)}n._userInRoom=!0,n.emit("user-online")});return function(s){return i.apply(this,arguments)}}()),this.on(xe.ON_USER_OFFLINE,function(){var i=x(function*(s){n._external_signal.clear(),n._userInRoom=!1});return function(s){return i.apply(this,arguments)}}()),this._external_signal.on(Mt.CALL,function(){var i=x(function*(s,c,d){n._userInRoom=!0,n.emit("user-online");try{c(yield dn(n,de.P2P_START,s))}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}())}waitTillUserOnline(){var n=this;return x(function*(){return new z(i=>{if(n._userInRoom)i();else{const s=()=>{n.off("user-online",s),i()};n.on("user-online",s)}})})()}}function QL(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Xo(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?QL(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):QL(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}const YD=new Map;class ZL extends kt{get state(){return this._state}set state(n){if(n===this._state)return;const i=this._state;this._state=n,"DISCONNECTED"===n&&this._disconnectedReason?this.emit(Pt.CONNECTION_STATE_CHANGE,n,i,this._disconnectedReason):this.emit(Pt.CONNECTION_STATE_CHANGE,n,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(n){I.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(n)),this._joinGatewayStartTime=n}constructor(n,i){super(),C(this,"store",void 0),C(this,"joinInfo",void 0),C(this,"key",void 0),C(this,"ntpOffset",0),C(this,"signal",void 0),C(this,"role",void 0),C(this,"inChannelInfo",{joinAt:null,duration:0}),C(this,"spec",void 0),C(this,"_state","DISCONNECTED"),C(this,"_statsCollector",void 0),C(this,"_disconnectedReason",void 0),C(this,"isSignalRecover",!1),C(this,"hasChangeBGPAddress",!1),C(this,"trafficStatsInterval",void 0),C(this,"networkQualityInterval",void 0),C(this,"_joinGatewayStartTime",0),C(this,"_signalTimeout",!1),C(this,"_clientRoleOptions",void 0),C(this,"_isProactiveJoin",!1),this.store=n,this.spec=i,this.signal=this.store.useP2P?new JL(Xo(Xo({},i),{},{retryConfig:i.websocketRetryConfig}),n):this.store.useDataChannel?new Rc(Xo(Xo({},i),{},{retryConfig:i.websocketRetryConfig}),n):new FC(Xo(Xo({},i),{},{retryConfig:i.websocketRetryConfig}),n),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}join(n,i,s){var c=this;return x(function*(){if(c.signal instanceof Rc){let _=!1;"disabled"!==n.cloudProxyServer?(I.debug("[".concat(c.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(n.cloudProxyServer,")")),_=!0):"".concat(n.apResponse.cid,"_").concat(n.apResponse.cert).length>255||"".concat(n.apResponse.cid,"_").concat(n.apResponse.cert).length<22?(I.debug("[".concat(c.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),_=!0):n.apResponse.addresses.some(E=>E.fingerprint)||B("FINGERPRINT")||(I.debug("[".concat(c.store.clientId,"] Dc is not supported, because fingerprint does not exist")),_=!0),_&&c.resetSignal()}c.store.joinGatewayStart(),"disabled"!==n.cloudProxyServer&&(c.hasChangeBGPAddress=!0);const d=Date.now();let h=YD.get(n.cname);if(h||(h=new Map,YD.set(n.cname,h)),c._isProactiveJoin=!0,h.has(n.uid)){const _=new W(M.UID_CONFLICT);throw ye.joinGateway(n.sid,{lts:d,succ:!1,ec:_.message,addr:null,uid:n.uid,cid:n.cid,firstSuccess:c._isProactiveJoin,avoidJoinStartTime:c.store.avoidJoinStart,isProxy:!!n.proxyServer,signalChannel:c.signal instanceof Rc?"1":"0"}),c._isProactiveJoin=!1,_}h.set(n.uid,!0),c.joinInfo=n,c.key=i;let p=0;c.joinGatewayStartTime=d;const m=n.proxyServer;try{let _;if(I.debug("[".concat(c.store.clientId,"] use ").concat(c.signal instanceof Rc?"datachannel":"websocket"," join uid ").concat(p)),c.signal instanceof Rc)_=yield c.signal.init(n.apResponse.addresses,s);else{const E=n.gatewayAddrs.map(y=>{let{address:S}=y;const[T,O]=S.split(":"),N={host:T,port:O};return n.proxyServer&&(N.proxy=n.proxyServer),N});_=yield c.signal.init(E,s)}p=_.uid,I.debug("[".concat(c.store.clientId,"] ").concat(c.signal instanceof Rc?"datachannel":"websocket"," join uid ").concat(p," cost ").concat(Date.now()-c.joinGatewayStartTime))}catch(_){throw _&&_.code===M.INIT_WEBSOCKET_TIMEOUT?(I.warning("[".concat(c.store.clientId,"] User join failed"),_.toString()),_):_&&_.code===M.INIT_DATACHANNEL_TIMEOUT?(I.warning("[".concat(c.store.clientId,"] User join datachannel failed"),_.toString()),c.resetSignal(),_):(I.error("[".concat(c.store.clientId,"] User join failed"),_.toString()),ye.joinGateway(n.sid,{lts:d,succ:!1,ec:_.message,addr:c.signal.url,uid:n.uid,cid:n.cid,firstSuccess:c._isProactiveJoin,avoidJoinStartTime:c.store.avoidJoinStart,isProxy:!!m,signalChannel:c.signal instanceof Rc?"1":"0"}),c._isProactiveJoin=!1,h.delete(n.uid),c.signal.close(),_)}return c.state="CONNECTED",c.inChannelInfo.joinAt=Date.now(),I.debug("[".concat(c.store.clientId,"] Connected to gateway server")),c.trafficStatsInterval=window.setInterval(()=>{c.updateTrafficStats().catch(_=>{I.warning("[".concat(c.store.clientId,"] get traffic stats error"),_.toString())})},3e3),c.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?c.emit(Pt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):c.emit(Pt.NETWORK_QUALITY,c._signalTimeout?{downlinkNetworkQuality:5,uplinkNetworkQuality:5}:"CONNECTED"===c.state&&c._statsCollector.trafficStats?{uplinkNetworkQuality:em(c._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:em(c._statsCollector.trafficStats.B_dnq)}:{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),c.store.joinGatewayEnd(),p})()}leave(){var n=arguments,i=this;return x(function*(){let s=n.length>0&&void 0!==n[0]&&n[0],c=n.length>1?n[1]:void 0;if("DISCONNECTED"!==i.state){c!==Ke.FALLBACK&&(i.state="DISCONNECTING");try{s||i.signal.connectionState!==He.CONNECTED||(yield(d=i.signal.request(Se.LEAVE,void 0,!0),3e3,z.race([d,n1(3e3)])))}catch(d){I.warning("[".concat(i.store.clientId,"] leave request failed, ignore"),d)}i.signal.close(c),c!==Ke.FALLBACK&&(i.state="DISCONNECTED"),i.reset()}var d})()}publish(n,i,s){var c=this;return x(function*(){if("CONNECTED"!==c.state&&"RECONNECTING"!==c.state)throw new W(M.INVALID_OPERATION,"can not publish when connection state is ".concat(c.state));const d={state:"offer",p2p_id:c.store.p2pId,ortc:i,mode:c.spec.mode,extend:B("PUB_EXTEND"),twcc:!!B("PUBLISH_TWCC"),rtx:!!B("USE_PUB_RTX")};try{return(yield c.signal.request(Se.PUBLISH,d,!0))._message}catch(h){if(s&&h.data&&h.data.code===Ie.ERR_PUBLISH_REQUEST_INVALID)return I.warning("[".concat(c.store.clientId,"] receive publish error code, retry"),h.toString()),yield c.tryUnpubBeforeRepub(n,i),c.publish(n,i,!1);throw h}})()}publishDataChannel(n,i,s){var c=this;return x(function*(){var d;if("CONNECTED"!==c.state&&"RECONNECTING"!==c.state)throw new W(M.INVALID_OPERATION,"can not publish when connection state is ".concat(c.state));const h={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:null!==(d=i.maxRetransmits)&&void 0!==d?d:10,channel_id:i.channelId,metadata:i.metadata};try{yield c.signal.request(Se.PUBLISH_DATASTREAM,h,!0)}catch(p){if(s&&p.data&&p.data.code===Ie.ERR_PUBLISH_REQUEST_INVALID)return I.warning("[".concat(c.store.clientId,"] receive publish datachannels error code, retry"),p.toString()),yield c.tryUnpubDataChannelBeforeRepub(n,i),c.publishDataChannel(n,i,!1);throw p}})()}unpublish(n,i){var s=this;return x(function*(){try{if("CONNECTED"!==s.state&&"RECONNECTING"!==s.state)throw new W(M.INVALID_OPERATION,"can not publish when connection state is ".concat(s.state));yield s.signal.request(Se.UNPUBLISH,{stream_id:i,ortc:n},!0)}catch(c){I.warning("[".concat(s.store.clientId,"] unpublish warning: "),c)}})()}unpublishDataChannel(n){var i=this;return x(function*(){try{if("CONNECTED"!==i.state&&"RECONNECTING"!==i.state)throw new W(M.INVALID_OPERATION,"can not publish when connection state is ".concat(i.state));yield z.all(n.map(s=>i.signal.request(Se.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){I.warning("unpublish datachannels warning: ",s)}})()}subscribe(n,i,s){var c=this;return x(function*(){if("CONNECTED"!==c.state&&"RECONNECTING"!==c.state)throw new W(M.INVALID_OPERATION,"can not subscribe when connection state is ".concat(c.state));const d={stream_id:n,stream_type:i.stream_type,mode:c.spec.mode,codec:c.spec.codec,p2p_id:c.store.p2pId,twcc:!!B("SUBSCRIBE_TWCC"),rtx:!!B("USE_SUB_RTX"),extend:B("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(B("SVC"))&&0!==B("SVC").length?B("SVC"):void 0};try{return(yield c.signal.request(Se.SUBSCRIBE,d,!0))._message}catch(h){if(s&&h.data&&h.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(c.store.clientId,"] receiver subscribe error code, retry"),h.toString()),yield c.tryUnsubBeforeResub(n,i),yield c.subscribe(n,i,!1);throw h}})()}subscribeDataChannel(n,i,s){var c=this;return x(function*(){if("CONNECTED"!==c.state&&"RECONNECTING"!==c.state)throw new W(M.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(c.state));const d={uid:n,stream_id:i.id,channel_id:i.datachannelId};try{return void(yield c.signal.request(Se.SUBSCRIBE_DATASTREAM,d,!0))}catch(h){if(s&&h.data&&h.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(c.store.clientId,"] receiver subscribe datachannel error code, retry"),h.toString()),yield c.tryUnsubDataChannelBeforeResub(n,i),yield c.subscribeDataChannel(n,i,!1);throw h}})()}subscribeAll(n,i){var s=this;return x(function*(){if("CONNECTED"!==s.state&&"RECONNECTING"!==s.state)throw new W(M.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(s.state));const c={p2p_id:s.store.p2pId,users:n,dtx:!1,rtx:!!B("USE_SUB_RTX")};try{return yield s.signal.request(Se.SUBSCRIBE_STREAMS,c,!0)}catch(d){if(i&&d.data&&d.data.code===Ie.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(s.store.clientId,"] receiver massSubscribe error code, retry"),d.toString()),yield s.tryMassUnsubBeforeResub(n),yield s.subscribeAll(n,!1);throw d}})()}setVideoProfile(n){var i=this;return x(function*(){const s=function(c){if(!(c.bitrateMax&&c.bitrateMin&&c.frameRate&&c.height&&c.width))return;let d=c.frameRate,h=c.width,p=c.height,m=!0;return"number"!=typeof d&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),"number"!=typeof h&&(h=h.exact||h.ideal||h.max||h.min||0,h||(m=!1)),"number"!=typeof p&&(p=p.exact||p.ideal||p.max||p.min||0,d||(m=!1)),m?{stream_type:0,width:h,height:p,fps:d,start_bps:1e3*c.bitrateMax,min_bps:1e3*c.bitrateMin,target_bps:1e3*c.bitrateMax}:void 0}(n);if(s)return i.signal.request(Se.SET_VIDEO_PROFILE,s);I.debug("[".concat(i.store.clientId,"] encoder config is not complete, do not report to gateway"))})()}unsubscribe(n,i){var s=this;return x(function*(){try{yield s.signal.request(Se.UNSUBSCRIBE,{p2p_id:s.store.p2pId,ortc:n,stream_id:i},!0)}catch(c){I.warning("[".concat(s.store.clientId,"] unsubscribe warning: "),c)}})()}unsubscribeDataChannel(n,i){var s=this;return x(function*(){try{if("CONNECTED"!==s.state&&"RECONNECTING"!==s.state)throw new W(M.INVALID_OPERATION,"can not publish when connection state is ".concat(s.state));yield z.all(n.map(c=>s.signal.request(Se.UNSUBSCRIBE_DATASTREAM,{stream_id:c,uid:i},!0)))}catch(c){I.warning("unsubscribeDataChannel warning: ",c)}})()}massUnsubscribe(n){var i=this;return x(function*(){try{yield i.signal.request(Se.UNSUBSCRIBE_STREAMS,n,!0)}catch(s){I.warning("[".concat(i.store.clientId,"] massUnsubscribeAll warning: "),s)}})()}reconnectPC(n){var i=this;return x(function*(){const{iceParameters:s,dtlsParameters:c,rtpCapabilities:d}=n;return{gatewayEstablishParams:yield i.signal.request(Se.CONNECT_PC,{p2p_id:i.store.p2pId,stream_id:i.store.uid,ortc:{iceParameters:s,dtlsParameters:c,rtpCapabilities:d}},!0),gatewayAddress:i.getCurrentGatewayAddress()}})()}getGatewayInfo(){return this.signal.request(Se.GATEWAY_INFO)}renewToken(n){var i=this;return x(function*(){yield i.signal.request(Se.RENEW_TOKEN,n),i.key=n.token})()}setClientRole(n,i){var s=this;return x(function*(){if(i&&(s._clientRoleOptions=Object.assign({},i)),"CONNECTED"!==s.state)return void(s.role=n);let c,d=0;"audience"===n?s._clientRoleOptions&&s._clientRoleOptions.delay?(c=s._clientRoleOptions.delay,d=1):d=s._clientRoleOptions&&s._clientRoleOptions.level?s._clientRoleOptions.level:2:d=0,yield s.signal.request(Se.SET_CLIENT_ROLE,{role:n,level:d,delay:c,client_ts:Date.now()}),s.role=n})()}setRemoteVideoStreamType(n,i){var s=this;return x(function*(){yield s.signal.request(Se.SWITCH_VIDEO_STREAM,{stream_id:n,stream_type:i})})()}setDefaultRemoteVideoStreamType(n){var i=this;return x(function*(){yield i.signal.request(Se.DEFAULT_VIDEO_STREAM,{stream_type:n})})()}setStreamFallbackOption(n,i){var s=this;return x(function*(){yield s.signal.request(Se.SET_FALLBACK_OPTION,{stream_id:n,fallback_type:i})})()}pickSVCLayer(n,i){var s=this;return x(function*(){yield s.signal.request(Se.PICK_SVC_LAYER,{stream_id:n,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})})()}setRTM2Flag(n){var i=this;return x(function*(){yield i.signal.request(Se.SET_RTM2_FLAG,{rtm2_flag:n})})()}sendExtensionMessage(n,i,s){var c=this;return x(function*(){if(c.signal instanceof JL)return c.signal.sendExtensionMessage(n,i,s)})()}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Xo({},this.inChannelInfo)}getGatewayVersion(){var n=this;return x(function*(){return(yield n.signal.request(Se.GATEWAY_INFO)).version})()}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const n=YD.get(this.joinInfo.cname);n&&n.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const n=function(i){let s;return s=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),s?{username:no.username,password:no.password,turnServerURL:s[2],tcpport:parseInt(s[3])+30,udpport:parseInt(s[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],n&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(Xo(Xo({},no),{},{turnServerURL:n.turnServerURL,tcpport:n.tcpport,udpport:n.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}updateTrafficStats(){var n=this;return x(function*(){if("CONNECTED"!==n.state)return;const i=yield n.signal.request(Se.TRAFFIC_STATS,void 0,!0);i.timestamp=Date.now(),null!=i.ntp_offset&&(n.ntpOffset=i.ntp_offset),i.peer_delay.forEach(s=>{const c=n._statsCollector.trafficStats&&n._statsCollector.trafficStats.peer_delay.find(d=>d.peer_uid===s.peer_uid);c&&c.B_st!==s.B_st&&ms(()=>{n.emit(Pt.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),n._statsCollector.updateTrafficStats(i)})()}getJoinMessage(n){if(!this.joinInfo||!this.key)throw new W(M.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let s=B("REPORT_APP_SCENARIO");if("string"!=typeof s)try{s=JSON.stringify(s)}catch{s=void 0}s&&s.length>128&&(s=void 0);const c=Xo({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:vo,browser:navigator.userAgent,process_id:B("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:B("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:{enablePublishedUserList:B("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:B("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof B("SUBSCRIBE_AUDIO_FILTER_TOPN")?B("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof B("ENABLE_PUBLISH_AUDIO_FILTER")?B("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof B("ENABLE_USER_LICENSE_CHECK")?B("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===B("USE_PUB_RTX")||!0===B("USE_SUB_RTX")||void 0,disableFEC:B("DISABLE_FEC"),enableNTPReport:!!B("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!B("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:"boolean"==typeof B("ENABLE_DATASTREAM_2")?B("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:"number"==typeof B("RTM2_FLAG")?B("RTM2_FLAG"):void 0,enableUserAutoRebalanceCheck:!!B("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:"boolean"==typeof B("USE_XR")?B("USE_XR"):void 0}},join_ts:this.joinGatewayStartTime},n);return this.joinInfo.stringUid&&(c.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(c.aes_mode=this.joinInfo.aesmode,B("ENCRYPT_AES")?(c.aes_secret=this.joinInfo.aespassword,c.aes_encrypt=!0):c.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(c.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(c.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),void 0!==this.joinInfo.defaultVideoStream&&(c.default_video_stream=this.joinInfo.defaultVideoStream),c}getRejoinMessage(){if(!this.joinInfo)throw new W(M.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){var n=this;this.signal.on(de.WS_RECONNECT_WAITTING_FINISH,i=>{var s;be(s=["tryNext","recover"]).call(s,i)&&this.joinInfo&&ye.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(de.WS_RECONNECT_CREATE_CONNECTION,i=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(de.WS_RECONNECTING,i=>{this.joinInfo&&ye.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i||ri.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",ye.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(de.WS_CLOSED,i=>{let s;switch(i){case Ke.LEAVE:s=ri.LEAVE;break;case Ke.UID_BANNED:case Ke.IP_BANNED:case Ke.CHANNEL_BANNED:case Ke.SERVER_ERROR:s=ri.SERVER_ERROR;break;case Ke.FALLBACK:s=ri.FALLBACK;break;case Ke.LICENSE_MISSING:case Ke.LICENSE_EXPIRED:case Ke.LICENSE_MINUTES_EXCEEDED:case Ke.LICENSE_PERIOD_INVALID:case Ke.LICENSE_MULTIPLE_SDK_SERVICE:case Ke.LICENSE_ILLEGAL:case Ke.TOKEN_EXPIRE:s=i;break;default:s=ri.NETWORK_ERROR}I.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+ri.NETWORK_ERROR)),this.joinInfo&&ye.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:i===Ke.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=i,i!==Ke.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(de.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(I.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),ye.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Rc?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const i=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!i)return void I.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(i));Nt("EVENT_REPORT_DOMAIN",i[1]),Nt("EVENT_REPORT_BACKUP_DOMAIN",i[1]),Nt("LOG_UPLOAD_SERVER","".concat(i[1],":6444"))}}),this.signal.on(xe.ON_UPLINK_STATS,i=>{this._statsCollector.updateUplinkStats(i)}),this.signal.on(de.REQUEST_RECOVER,(i,s,c)=>{if(!this.joinInfo)return c(new W(M.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));i&&(this.joinInfo.multiIP=i,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,dn(this,Pt.REQUEST_NEW_GATEWAY_LIST).then(s).catch(c)}),this.signal.on(de.REQUEST_JOIN_INFO,function(){var i=x(function*(s){var c;if(n.updateTurnConfigFromSignal(),n.store.useP2P)return void s(n.getJoinMessage({ortc:{}}));const{iceParameters:d,dtlsParameters:h,rtpCapabilities:p}=yield dn(n,Pt.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(c=n.joinInfo)||void 0===c?void 0:c.turnServer});s(n.getJoinMessage({ortc:{iceParameters:d,dtlsParameters:h,rtpCapabilities:p,version:"2"}}))});return function(s){return i.apply(this,arguments)}}()),this.signal.on(de.REQUEST_REJOIN_INFO,i=>{i(this.getRejoinMessage())}),this.signal.on(de.REPORT_JOIN_GATEWAY,(i,s)=>{this.joinInfo&&(ye.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Rc?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(de.IS_P2P_DISCONNECTED,i=>{i(_c(this,Pt.IS_P2P_DISCONNECTED))}),this.signal.on(de.DISCONNECT_P2P,()=>{this.emit(Pt.DISCONNECT_P2P)}),this.signal.on(de.NEED_RENEW_SESSION,()=>{this.emit(Pt.NEED_RENEW_SESSION)}),this.signal.on(de.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(de.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(de.JOIN_RESPONSE,i=>{const s=this.getCurrentGatewayAddress();this.emit(Pt.JOIN_RESPONSE,i,s)}),this.signal.on(de.DATACHANNEL_PRECONNECT,function(){var i=x(function*(s,c,d){n.updateTurnConfigFromSignal();const h=n.getCurrentGatewayAddress();return dn(n,Pt.DATACHANNEL_PRECONNECT,s,h).then(c).catch(d)});return function(s,c,d){return i.apply(this,arguments)}}()),this.signal.on(de.DATACHANNEL_CONNECTING,function(){var i=x(function*(s){const{iceParameters:c,dtlsParameters:d,rtpCapabilities:h}=yield dn(n,Pt.REQUEST_DC_CONNECTION_PARAMS);s(n.getJoinMessage({ortc:{iceParameters:c,dtlsParameters:d,rtpCapabilities:h,version:"2"}}))});return function(s){return i.apply(this,arguments)}}()),this.signal.on(de.DATACHANNEL_FAILBACK,()=>{I.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Pt.DATACHANNEL_FAILBACK)})}tryUnsubBeforeResub(n,i){var s=this;return x(function*(){try{yield s.signal.request(Se.UNSUBSCRIBE,{p2p_id:s.store.p2pId,stream_id:n,ortc:[i]},!0)}catch(c){throw I.warning("[".concat(s.store.clientId,"] tryUnsubBeforeResub warning"),c),c}})()}tryUnsubDataChannelBeforeResub(n,i){var s=this;return x(function*(){try{yield s.signal.request(Se.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(c){throw I.warning("unsubscribe datachannel warning",c),c}})()}tryUnpubBeforeRepub(n,i){var s=this;return x(function*(){try{yield s.signal.request(Se.UNPUBLISH,{stream_id:n,ortc:i},!0)}catch(c){throw I.warning("[".concat(s.store.clientId,"] tryUnpubBeforeRepub warning: "),c),c}})()}tryUnpubDataChannelBeforeRepub(n,i){var s=this;return x(function*(){try{yield s.signal.request(Se.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(c){throw I.warning("unpublish datastream warning: ",c),c}})()}tryMassUnsubBeforeResub(n){var i=this;return x(function*(){const s={users:n.map(c=>({stream_id:c.stream_id,stream_type:c.stream_type}))};try{yield i.signal.request(Se.UNSUBSCRIBE_STREAMS,s,!0)}catch(c){throw I.warning("[".concat(i.store.clientId,"] tryMassUnsubBeforeResub warning"),c),c}})()}muteLocal(n,i){var s=this;return x(function*(){const c={action:n.find(d=>d.stream_type===It.Audio)?"mute_local_audio":"mute_local_video",p2p_id:s.store.p2pId,ortc:n,stream_id:i};try{yield s.signal.request(Se.CONTROL,c,!0,!0)}catch(d){throw I.warning("[".concat(s.store.clientId,"] gateway muteLocal warning: "),d),d}})()}unmuteLocal(n,i){var s=this;return x(function*(){const c={action:n.find(d=>d.stream_type===It.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:s.store.p2pId,ortc:n,stream_id:i};try{yield s.signal.request(Se.CONTROL,c,!0,!0)}catch(d){throw I.warning("[".concat(s.store.clientId,"] gateway unmuteLocal warning: "),d),d}})()}muteRemote(n,i){var s=this;return x(function*(){const c={action:n===_e.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:s.store.p2pId,stream_id:i};try{yield s.signal.request(Se.CONTROL,c,!0,!0)}catch(d){throw I.warning("[".concat(s.store.clientId,"] gateway muteRemote warning: "),d),d}})()}unmuteRemote(n,i){var s=this;return x(function*(){const c={action:n===_e.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:s.store.p2pId,stream_id:i};try{yield s.signal.request(Se.CONTROL,c,!0,!0)}catch(d){throw I.warning("[".concat(s.store.clientId,"] gateway unmuteRemote warning: "),d),d}})()}uploadStats(n,i){this.signal.upload(n,i)}getSignalRTT(){return this.signal.rtt}restartICE(n){var i=this;return x(function*(){const s={p2p_id:i.store.p2pId,stream_id:i.store.uid,ortc:n};try{return yield i.signal.request(Se.RESTART_ICE,s,!0)}catch(c){throw I.warning("[".concat(i.store.clientId,"] P2PChannel.restartICE warning: "),c),c}})()}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,ri.P2P_FAILED)}getCurrentGatewayAddress(){var n;if(!B("GATEWAY_WSS_ADDRESS"))return null!==(n=this.joinInfo)&&void 0!==n&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}setPublishAudioFilterEnabled(n){var i=this;return x(function*(){yield i.signal.request(Se.SET_PARAMETER,{enablePublishAudioFilter:n})})()}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Ke.FALLBACK)),this.store.useDataChannel=!1,this.signal=new FC(Xo(Xo({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Pt.RESET_SIGNAL,NC.websocket)}}let VE=0,Ab=0;function Fa(o,n,i,s){return new z((c,d)=>{n.timeout=n.timeout||B("HTTP_CONNECT_TIMEOUT"),n.responseType=n.responseType||"json",n.data&&!i?(n.data=JSON.stringify(n.data),VE+=zs(n.data)):i&&(n.data.size?VE+=n.data.size:n.data instanceof FormData?VE+=nC(n.data):VE+=zs(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=o,or.request(n).then(h=>{"string"==typeof h.data?Ab+=zs(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?Ab+=h.data.byteLength:Ab+=zs(JSON.stringify(h.data)),s&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{or.isCancel(h)?d(new W(M.OPERATION_ABORTED,"cancel token canceled")):d("ECONNABORTED"===h.code?new W(M.NETWORK_TIMEOUT,h.message):h.response?new W(M.NETWORK_RESPONSE_ERROR,h.response.status):new W(M.NETWORK_ERROR,h.message))})})}!function(){var o;function n(ee){var ae=0;return function(){return ae<ee.length?{done:!1,value:ee[ae++]}:{done:!0}}}var s,i="function"==typeof Object.defineProperties?Object.defineProperty:function(ee,ae,ge){return ee==Array.prototype||ee==Object.prototype||(ee[ae]=ge.value),ee},c=function(ee){ee=["object"==typeof globalThis&&globalThis,ee,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof ou&&ou];for(var ae=0;ae<ee.length;++ae){var ge=ee[ae];if(ge&&ge.Math==Math)return ge}throw Error("Cannot find global object")}(this);function d(ee,ae){if(ae)e:{var ge=c;ee=ee.split(".");for(var Le=0;Le<ee.length-1;Le++){var pt=ee[Le];if(!(pt in ge))break e;ge=ge[pt]}(ae=ae(Le=ge[ee=ee[ee.length-1]]))!=Le&&null!=ae&&i(ge,ee,{configurable:!0,writable:!0,value:ae})}}function h(ee){return(ee={next:ee})[Symbol.iterator]=function(){return this},ee}function p(ee){var ae=typeof Symbol<"u"&&Symbol.iterator&&ee[Symbol.iterator];return ae?ae.call(ee):{next:n(ee)}}if(d("Symbol",function(ee){function ae(pt,le){this.A=pt,i(this,"description",{configurable:!0,writable:!0,value:le})}if(ee)return ee;ae.prototype.toString=function(){return this.A};var ge="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Le=0;return function pt(le){if(this instanceof pt)throw new TypeError("Symbol is not a constructor");return new ae(ge+(le||"")+"_"+Le++,le)}}),d("Symbol.iterator",function(ee){if(ee)return ee;ee=Symbol("Symbol.iterator");for(var ae="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ge=0;ge<ae.length;ge++){var Le=c[ae[ge]];"function"==typeof Le&&"function"!=typeof Le.prototype[ee]&&i(Le.prototype,ee,{configurable:!0,writable:!0,value:function(){return h(n(this))}})}return ee}),"function"==typeof Object.setPrototypeOf)s=Object.setPrototypeOf;else{var m;e:{var _={};try{_.__proto__={a:!0},m=_.a;break e}catch{}m=!1}s=m?function(ee,ae){if(ee.__proto__=ae,ee.__proto__!==ae)throw new TypeError(ee+" is not extensible");return ee}:null}var E=s;function y(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function S(ee){if(ee.m)throw new TypeError("Generator is already running");ee.m=!0}function T(ee,ae){return ee.h=3,{value:ae}}function O(ee){this.g=new y,this.G=ee}function N(ee,ae,ge,Le){try{var pt=ae.call(ee.g.j,ge);if(!(pt instanceof Object))throw new TypeError("Iterator result "+pt+" is not an object");if(!pt.done)return ee.g.m=!1,pt;var le=pt.value}catch(R){return ee.g.j=null,ee.g.s(R),w(ee)}return ee.g.j=null,Le.call(ee.g,le),w(ee)}function w(ee){for(;ee.g.h;)try{var ae=ee.G(ee.g);if(ae)return ee.g.m=!1,{value:ae.value,done:!1}}catch(ge){ee.g.v=void 0,ee.g.s(ge)}if(ee.g.m=!1,ee.g.l){if(ae=ee.g.l,ee.g.l=null,ae.F)throw ae.D;return{value:ae.return,done:!0}}return{value:void 0,done:!0}}function k(ee){this.next=function(ae){return ee.o(ae)},this.throw=function(ae){return ee.s(ae)},this.return=function(ae){return function(ge,Le){S(ge.g);var pt=ge.g.j;return pt?N(ge,"return"in pt?pt.return:function(le){return{value:le,done:!0}},Le,ge.g.return):(ge.g.return(Le),w(ge))}(ee,ae)},this[Symbol.iterator]=function(){return this}}function V(ee,ae){return ae=new k(new O(ae)),E&&ee.prototype&&E(ae,ee.prototype),ae}if(y.prototype.o=function(ee){this.v=ee},y.prototype.s=function(ee){this.l={D:ee,F:!0},this.h=this.C||this.u},y.prototype.return=function(ee){this.l={return:ee},this.h=this.u},O.prototype.o=function(ee){return S(this.g),this.g.j?N(this,this.g.j.next,ee,this.g.o):(this.g.o(ee),w(this))},O.prototype.s=function(ee){return S(this.g),this.g.j?N(this,this.g.j.throw,ee,this.g.o):(this.g.s(ee),w(this))},d("Array.prototype.entries",function(ee){return ee||function(){return function(ae,ge){ae instanceof String&&(ae+="");var Le=0,pt=!1,le={next:function(){if(!pt&&Le<ae.length){var R=Le++;return{value:ge(R,ae[R]),done:!1}}return pt=!0,{done:!0,value:void 0}}};return le[Symbol.iterator]=function(){return le},le}(this,function(ae,ge){return[ae,ge]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var U=function(ee,ae){for(var ge=0;ge<ee.length;ge++)ae(ee[ge])},Y=function(ee){return ee.replace(/\r?\n|\r/g,"\r\n")},re=function(ee,ae,ge){return ae instanceof Blob?(ge=void 0!==ge?String(ge+""):"string"==typeof ae.name?ae.name:"blob",ae.name===ge&&"[object Blob]"!==Object.prototype.toString.call(ae)||(ae=new File([ae],ge)),[String(ee),ae]):[String(ee),String(ae)]},K=function(ee,ae){if(ee.length<ae)throw new TypeError(ae+" argument required, but only "+ee.length+" present.")},$="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,X=$.FormData,J=$.XMLHttpRequest&&$.XMLHttpRequest.prototype.send,Ee=$.Request&&$.fetch,ve=$.navigator&&$.navigator.sendBeacon,ze=$.Element&&$.Element.prototype,ht=$.Symbol&&Symbol.toStringTag;ht&&(Blob.prototype[ht]||(Blob.prototype[ht]="Blob"),"File"in $&&!File.prototype[ht]&&(File.prototype[ht]="File"));try{new File([],"")}catch{$.File=function(ae,ge,Le){return ae=new Blob(ae,Le||{}),Object.defineProperties(ae,{name:{value:ge},lastModified:{value:+(Le&&void 0!==Le.lastModified?new Date(Le.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ht&&Object.defineProperty(ae,ht,{value:"File"}),ae}}var Ct=function(ee){return ee.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},dt=function(ee){this.i=[];var ae=this;ee&&U(ee.elements,function(ge){if(ge.name&&!ge.disabled&&"submit"!==ge.type&&"button"!==ge.type&&!ge.matches("form fieldset[disabled] *"))if("file"===ge.type){var Le=ge.files&&ge.files.length?ge.files:[new File([],"",{type:"application/octet-stream"})];U(Le,function(pt){ae.append(ge.name,pt)})}else"select-multiple"===ge.type||"select-one"===ge.type?U(ge.options,function(pt){!pt.disabled&&pt.selected&&ae.append(ge.name,pt.value)}):"checkbox"===ge.type||"radio"===ge.type?ge.checked&&ae.append(ge.name,ge.value):(Le="textarea"===ge.type?Y(ge.value):ge.value,ae.append(ge.name,Le))})};if((o=dt.prototype).append=function(ee,ae,ge){K(arguments,2),this.i.push(re(ee,ae,ge))},o.delete=function(ee){K(arguments,1);var ae=[];ee=String(ee),U(this.i,function(ge){ge[0]!==ee&&ae.push(ge)}),this.i=ae},o.entries=function ee(){var ae,ge=this;return V(ee,function(Le){if(1==Le.h&&(ae=0),3!=Le.h)return ae<ge.i.length?Le=T(Le,ge.i[ae]):(Le.h=0,Le=void 0),Le;ae++,Le.h=2})},o.forEach=function(ee,ae){K(arguments,1);for(var ge=p(this),Le=ge.next();!Le.done;Le=ge.next()){var pt=p(Le.value);Le=pt.next().value,pt=pt.next().value,ee.call(ae,pt,Le,this)}},o.get=function(ee){K(arguments,1);var ae=this.i;ee=String(ee);for(var ge=0;ge<ae.length;ge++)if(ae[ge][0]===ee)return ae[ge][1];return null},o.getAll=function(ee){K(arguments,1);var ae=[];return ee=String(ee),U(this.i,function(ge){ge[0]===ee&&ae.push(ge[1])}),ae},o.has=function(ee){K(arguments,1),ee=String(ee);for(var ae=0;ae<this.i.length;ae++)if(this.i[ae][0]===ee)return!0;return!1},o.keys=function ee(){var ae,ge,le=this;return V(ee,function(R){if(1==R.h&&(ae=p(le),ge=ae.next()),3!=R.h)return ge.done?void(R.h=0):T(R,p(ge.value).next().value);ge=ae.next(),R.h=2})},o.set=function(ee,ae,ge){K(arguments,2),ee=String(ee);var Le=[],pt=re(ee,ae,ge),le=!0;U(this.i,function(R){R[0]===ee?le&&(le=!Le.push(pt)):Le.push(R)}),le&&Le.push(pt),this.i=Le},o.values=function ee(){var ae,ge,pt,le=this;return V(ee,function(R){if(1==R.h&&(ae=p(le),ge=ae.next()),3!=R.h)return ge.done?void(R.h=0):((pt=p(ge.value)).next(),T(R,pt.next().value));ge=ae.next(),R.h=2})},dt.prototype._asNative=function(){for(var ee=new X,ae=p(this),ge=ae.next();!ge.done;ge=ae.next()){var Le=p(ge.value);ge=Le.next().value,Le=Le.next().value,ee.append(ge,Le)}return ee},dt.prototype._blob=function(){var ee="----formdata-polyfill-"+Math.random(),ae=[],ge="--"+ee+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(Le,pt){return"string"==typeof Le?ae.push(ge+Ct(Y(pt))+'"\r\n\r\n'+Y(Le)+"\r\n"):ae.push(ge+Ct(Y(pt))+'"; filename="'+Ct(Le.name)+'"\r\nContent-Type: '+(Le.type||"application/octet-stream")+"\r\n\r\n",Le,"\r\n")}),ae.push("--"+ee+"--"),new Blob(ae,{type:"multipart/form-data; boundary="+ee})},dt.prototype[Symbol.iterator]=function(){return this.entries()},dt.prototype.toString=function(){return"[object FormData]"},ze&&!ze.matches&&(ze.matches=ze.matchesSelector||ze.mozMatchesSelector||ze.msMatchesSelector||ze.oMatchesSelector||ze.webkitMatchesSelector||function(ee){for(var ae=(ee=(this.document||this.ownerDocument).querySelectorAll(ee)).length;0<=--ae&&ee.item(ae)!==this;);return-1<ae}),ht&&(dt.prototype[ht]="FormData"),J){var bt=$.XMLHttpRequest.prototype.setRequestHeader;$.XMLHttpRequest.prototype.setRequestHeader=function(ee,ae){bt.call(this,ee,ae),"content-type"===ee.toLowerCase()&&(this.B=!0)},$.XMLHttpRequest.prototype.send=function(ee){ee instanceof dt?(ee=ee._blob(),this.B||this.setRequestHeader("Content-Type",ee.type),J.call(this,ee)):J.call(this,ee)}}Ee&&($.fetch=function(ee,ae){return ae&&ae.body&&ae.body instanceof dt&&(ae.body=ae.body._blob()),Ee.call(this,ee,ae)}),ve&&($.navigator.sendBeacon=function(ee,ae){return ae instanceof dt&&(ae=ae._asNative()),ve.call(this,ee,ae)}),$.FormData=dt}}();const BE=()=>{const o=B("AREAS");return 0===o.length&&o.push(at.GLOBAL),md(o).call(o,(n,i,s)=>{const c=Db(i);return c?0===s?c:"".concat(n,",").concat(c):n},"")},Db=o=>o===at.OVERSEA?"".concat(pi.ASIA,",").concat(pi.EUROPE,",").concat(pi.AFRICA,",").concat(pi.NORTH_AMERICA,",").concat(pi.SOUTH_AMERICA,",").concat(pi.OCEANIA):pi[o],$D=o=>{const n={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return o.map(i=>{const s=PC[i],c=Object.keys(s);c&&c.map(d=>{"CODE"!==d&&(n[d]=n[d].concat(s[d]))})}),n},nm={GLOBAL:{ASIA:[at.CHINA,at.JAPAN,at.INDIA,at.KOREA,at.HKMC],EUROPE:[],NORTH_AMERICA:[at.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},im=Object.keys(nm[at.GLOBAL]),XD=[at.CHINA,at.NORTH_AMERICA,at.EUROPE,at.ASIA,at.JAPAN,at.INDIA,at.OCEANIA,at.SOUTH_AMERICA,at.AFRICA,at.KOREA,at.HKMC,at.US],ex=function(o,n){let i=[];if(be(o).call(o,at.GLOBAL)){const d=[at.GLOBAL,at.OVERSEA],h=Object.keys(PC);if(n===at.GLOBAL)throw new W(M.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(n===at.CHINA)i=[at.OVERSEA];else if(c=n,be(im).call(im,c)){const p=nm[at.GLOBAL][n]||[],m=[...d,n,...p];i=h.filter(_=>!be(m).call(m,_))}else if(function(p){let m=!1;return im.forEach(_=>{var E;be(E=nm[at.GLOBAL][_]).call(E,p)&&(m=!0)}),m}(n)){const p=function(_){let E;return im.forEach(y=>{var S;be(S=nm[at.GLOBAL][y]).call(S,_)&&(E=y)}),E}(n),m=[...d,p,n];i=h.filter(_=>!be(m).call(m,_))}else i=o;i=function(p){const m=[];return XD.forEach(_=>{be(p).call(p,_)&&m.push(_)}),m.concat(p.filter(_=>!be(XD).call(XD,_)))}(i)}else i=o;var c;return i};function tx(o){var n,i;if(!o&&be(n=B("AREAS")).call(n,at.EXTENSIONS))return I.debug("update area from ap : reset"),void Ob(N1,!0);if(!be(i=B("AREAS")).call(i,at.GLOBAL)||!o)return;let s=PC.EXTENSIONS;s&&(s={CODE:Db(at.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(o,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(o,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(o,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(o,".agora.io"),"cds-ap-web-2-".concat(o,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(o,".agora.io"),"sua-ap-web-2-".concat(o,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(o,".agora.io"),"uap-ap-web-2-".concat(o,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(o,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(o,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(o,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(o,".agora.io")]},I.debug("update area from ap success: ".concat(o,",config is "),s),Nt("AREAS",[at.EXTENSIONS],!0),Object.keys(s).map(c=>{Nt(c,"LOG_UPLOAD_SERVER"===c||"EVENT_REPORT_DOMAIN"===c||"EVENT_REPORT_BACKUP_DOMAIN"===c||"PROXY_SERVER_TYPE3"===c?s[c][0]:s[c])}))}function Ob(o){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=ye.reportApiInvoke(null,{name:Rn.SET_AREA,options:o,tag:Je.TRACER});try{let s=[];if("string"==typeof o&&(s=[o]),Array.isArray(o)&&(o.forEach(d=>{if(!be(aE).call(aE,d))throw new W(M.INVALID_PARAMS,"invalid area code")}),s=o),"[object Object]"===Object.prototype.toString.call(o)){const{areaCode:d,excludedArea:h}=o;if(!d)throw new W(M.INVALID_PARAMS,"area code is needed");let p=d;"string"==typeof d&&(p=[d]),s=h?ex(p,h):p}if(!n){if(gd.AREAS){const d=new W(M.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(d),void I.warning("setArea is prohibited because of config-distribute")}if(be(s).call(s,at.GLOBAL)&&B("AREAS")===at.EXTENSIONS){const d=new W(M.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(d),void I.warning("setArea is prohibited because of ap extensions")}}Nt("AREAS",s,n);const c=$D(s);Object.keys(c).map(d=>{Nt(d,"LOG_UPLOAD_SERVER"===d||"EVENT_REPORT_DOMAIN"===d||"EVENT_REPORT_BACKUP_DOMAIN"===d||"PROXY_SERVER_TYPE3"===d?c[d][0]:c[d])}),I.debug("set area success:",s.join(","))}catch(s){throw i.onError(s),s}i.onSuccess()}function Nb(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Pb(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?Nb(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Nb(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}let Mb=1;function cV(o,n,i,s,c){Mb+=1;const d={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:Mb,requestId:Mb,version:vo,cname:i.cname},h={service_name:n,json_body:JSON.stringify(d)};let p,m,_=o[0];return Ks(x(function*(){p=Date.now();const E=yield Fa(_,{data:h,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-p,0!==E.code){const T=new W(M.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:m});throw I.error(T.toString()),T}const y=JSON.parse(E.json_body);if(200!==y.code){const T=new W(M.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(y.code,", reason: ").concat(y.reason),{code:y.code,responseTime:m});throw I.error(T.toString()),T}if(!y.servers||0===y.servers.length){const T=new W(M.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:y.code,responseTime:m});throw I.error(T.toString()),T}const S=(O=n,{addressList:(T=y).servers.map(N=>"wss://".concat(N.address.replace(/\./g,"-"),".").concat(B("WORKER_DOMAIN"),":").concat(N.wss,"?serviceName=").concat(encodeURIComponent(O))),workerToken:T.workerToken,vid:T.vid});var T,O;return B("LIVE_STREAMING_ADDRESS")&&(S.addressList=B("LIVE_STREAMING_ADDRESS")instanceof Array?B("LIVE_STREAMING_ADDRESS"):[B("LIVE_STREAMING_ADDRESS")]),Pb(Pb({},S),{},{responseTime:m})}),(E,y)=>(ye.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:n,responseDetail:JSON.stringify(E.addressList),firstSuccess:0===y,responseTime:m,serverIp:o[y%o.length]}),!1),(E,y)=>(ye.apworkerEvent(i.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:n,responseTime:m,serverIp:o[y%o.length]}),!!(E.code!==M.OPERATION_ABORTED&&E.code!==M.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(_=o[(y+1)%o.length],!0)),c)}let JD=1;function kb(o,n,i,s){let{url:c,areaCode:d}=o;const h=Date.now();let p;const[m,_]=xb(n,d,[nn.CHOOSE_SERVER]);let E=Bn.networkState;return Ks(x(function*(){E&&Bn.networkState===xi.OFFLINE&&Bn.onlineWaiter&&(yield z.race([Bn.onlineWaiter,ui(s&&s.maxRetryTimeout||_n.maxRetryTimeout)])),E=Bn.networkState;const{data:y,headers:S}=yield Fa(c,{data:m,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p="1"===S.http3?1:-1,ye.reportResourceTiming(c,n.sid),QD(y,c,n,h,[nn.CHOOSE_SERVER],p);const T=tm(y,nn.CHOOSE_SERVER);return ZD(T),zD(T,c)}),y=>(y&&ye.joinChooseServer(n.sid,{lts:h,succ:!0,csAddr:c,opid:_,serverList:y.gatewayAddrs.map(S=>S.address),ec:null,cid:y.cid.toString(),uid:y.uid.toString(),csIp:y.csIp,unilbsServerIds:[nn.CHOOSE_SERVER].toString(),isHttp3:p}),!1),y=>y.code!==M.OPERATION_ABORTED&&(y.code===M.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(ye.joinChooseServer(n.sid,{lts:h,succ:!1,csAddr:c,serverList:null,opid:_,ec:y.code,csIp:y.data&&y.data.csIp,unilbsServerIds:[nn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:E}),isHttp3:p}),I.warning("[".concat(n.clientId,"] Choose server network error, retry"),y),!0)),s)}function wc(o,n,i,s){let c,{url:d,areaCode:h,serviceIds:p}=o;const m=Date.now(),[_,E]=xb(n,h,p);let y;return Ks(x(function*(){y&&Bn.networkState===xi.OFFLINE&&Bn.onlineWaiter&&(yield z.race([Bn.onlineWaiter,ui(s&&s.maxRetryTimeout||_n.maxRetryTimeout)])),y=Bn.networkState;const{data:S,headers:T}=yield Fa(d,{data:_,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c="1"===T.http3?1:-1,ye.reportResourceTiming(d,n.sid),QD(S,d,n,m,p,c);const O=tm(S,nn.CHOOSE_SERVER),N=tm(S,"proxy5"===n.cloudProxyServer?nn.CLOUD_PROXY_5:"proxy3"===n.cloudProxyServer||"proxy4"===n.cloudProxyServer?nn.CLOUD_PROXY:nn.CLOUD_PROXY_FALLBACK);return ZD(O),{gatewayInfo:zD(O,d),proxyInfo:N,url:d}}),S=>(S.gatewayInfo&&ye.joinChooseServer(n.sid,{lts:m,succ:!0,csAddr:d,serverList:S.gatewayInfo.gatewayAddrs.map(T=>T.address),ec:null,opid:E,cid:S.gatewayInfo.cid.toString(),uid:S.gatewayInfo.uid.toString(),csIp:S.gatewayInfo.csIp,unilbsServerIds:p.toString(),isHttp3:c}),S.proxyInfo&&ye.joinWebProxyAP(n.sid,{lts:m,sucess:1,apServerAddr:d,turnServerAddrList:S.proxyInfo.addresses.map(T=>T.ip).join(","),errorCode:null,eventType:n.cloudProxyServer,unilbsServerIds:p.toString()}),!1),S=>S.code!==M.OPERATION_ABORTED&&(S.code===M.CAN_NOT_GET_GATEWAY_SERVER?S.data.retry:(ye.joinWebProxyAP(n.sid,{lts:m,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:S.code,eventType:n.cloudProxyServer,unilbsServerIds:p.toString(),extend:JSON.stringify({networkState:y})}),I.warning("[".concat(n.clientId,"] multi unilbs network error, retry"),S),!0)),s)}const QD=(o,n,i,s,c,d)=>{const h=[],p=m=>{4096===m.flag?ye.joinChooseServer(i.sid,{lts:s,succ:!1,csAddr:n,opid:o.opid,serverList:null,ec:m.error.message,csIp:m.error.data&&m.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:d}):1048576!==m.flag&&4194304!==m.flag&&4194310!==m.flag||ye.joinWebProxyAP(i.sid,{lts:s,sucess:0,apServerAddr:n,turnServerAddrList:null,errorCode:m.error.code,eventType:i.cloudProxyServer,unilbsServerIds:c.toString()})};if(o.response_body.forEach(m=>{const _=m.buffer.code;if(23===m.uri&&0===_&&!m.buffer.edges_services)if(4194310===m.buffer.flag)I.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),m.buffer.edges_services=[];else{const E={error:new W(M.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:o.detail[502]}),flag:m.buffer.flag};h.push(E),p(E)}if(0!==_){const E=lh(_),y={error:new W(M.CAN_NOT_GET_GATEWAY_SERVER,E.desc,{desc:E.desc,retry:E.retry,csIp:o.detail[502]}),flag:m.buffer.flag};4194310===m.buffer.flag?I.warning(y.error.toString()):h.push(y),p(y)}}),h.length)throw I.warning("[".concat(i.clientId,"] multi unilbs ").concat(n," failed, ").concat(h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message,", retry: ").concat(m.error.data.retry)).join(" | "))),new W(M.CAN_NOT_GET_GATEWAY_SERVER,h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message)).join(" | "),{retry:!!h.find(m=>m.error.data.retry),csIp:o.detail[502],desc:[...new Set(h.map(m=>{var _;return null==m||null===(_=m.error)||void 0===_||null===(_=_.data)||void 0===_?void 0:_.desc}).filter(m=>!!m))]})},ZD=o=>{var n,i,s,c;if(o.addresses&&0===o.addresses.length&&0===o.code)throw new W(M.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:o.detail&&o.detail[502]});if(B("AP_AREA")&&(null!==(s=o.detail)&&void 0!==s&&s[23]&&"string"==typeof(null===(c=o.detail)||void 0===c?void 0:c[23])?tx(o.detail[23].toLowerCase()):tx()),null!==(n=o.detail)&&void 0!==n&&n[19]&&"string"==typeof(null===(i=o.detail)||void 0===i?void 0:i[19])){const p=o.detail[19]?.split(";");for(let m=0;m<p.length;m++){var d;const _=eD(d=p[m]).call(d);o.addresses[m]&&p&&(o.addresses[m].fingerprint=_)}}if(B("GATEWAY_ADDRESS")&&B("GATEWAY_ADDRESS").length>0){I.debug("assign gateway address to",B("GATEWAY_ADDRESS"));const h=B("GATEWAY_ADDRESS").map(p=>{var m,_;const E=null!==(m=null===(_=o.addresses.find(y=>y.ip===p.ip&&y.port===p.port))||void 0===_?void 0:_.fingerprint)&&void 0!==m?m:"";return{ip:p.ip,port:p.port,ticket:o.addresses[0]&&o.addresses[0].ticket,fingerprint:E}});o.addresses=h}},Lb=(o,n)=>{if(o.response_body&&o.response_body.length){const i=o.response_body[0];if(0!==i.buffer.code){const s=lh(i.buffer.code);throw new W(M.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(s.desc),{retry:s.retry})}return i.buffer.ticket}throw I.debug("update ticket request received ap response without response body:",n),new W(M.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},xb=(o,n,i)=>{const s=Math.floor(1e12*Math.random()),c={appid:o.appId,client_ts:Date.now(),opid:s,sid:o.sid,request_bodies:[{uri:22,buffer:{cname:o.cname,detail:Pb({6:o.stringUid,11:n,12:B("USE_NEW_TOKEN")?"1":void 0,22:n},B("AP_RTM")?{26:"RTM2"}:{}),key:o.token,service_ids:i,uid:o.uid||0}}]};c.request_bodies.forEach(h=>{o.multiIP&&o.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[o.multiIP.uni_lbs_ip],vos_ip:[o.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",JSON.stringify(c)),[d,s]},lV=(o,n)=>{const i=Math.floor(1e12*Math.random()),s={appid:o.appId,client_ts:Date.now(),opid:i,sid:o.sid,request_bodies:[{uri:28,buffer:{cname:o.cname,detail:{1:"",6:o.stringUid,12:"1"},token:o.token,service_ids:n,uid:o.uid||0,edges_services:o.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(s)),[c,i]};let rm=0;function om(o){return z.all(o.map(n=>n.then(i=>{throw i},i=>i))).then(n=>{throw n},n=>n)}const sm=function(){var o=x(function*(n){let{fragementLength:i,referenceList:s,asyncMapHandler:c,allFailedhandler:d,promisesCollector:h}=n,p=0;const m=i;let _,E=0;const y=function(){var S=x(function*(){const T=(()=>{const O=p*m;return s.slice(O,O+m).map(c)})();h&&h.push(...T);try{_=yield om(T)}catch(O){if(E+=m,p++,!(E>=s.length))return void(yield y());d(O)}T.forEach(O=>O.cancel())});return function(){return S.apply(this,arguments)}}();return yield y(),_});return function(i){return o.apply(this,arguments)}}();function eO(o,n,i,s){return tO.apply(this,arguments)}function tO(){return tO=x(function*(o,n,i,s){return{gatewayInfo:yield(d=x(function*(h,p,m,_){let E=null;const y=[],S=function(){var O=x(function*(){const N=B("WEBCS_DOMAIN").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(V=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:BE()})),w=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(V=>V.url)}),k=yield sm({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:V=>(I.debug("[".concat(h.clientId,"] Connect to choose_server:"),V.url),kb(V,h,p,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},w),V[0]},promisesCollector:y});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},w),k});return function(){return O.apply(this,arguments)}}(),T=function(){var O=x(function*(){if(yield ui(1e3),null!==E)return E;const N=B("WEBCS_DOMAIN_BACKUP_LIST").map(V=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:BE()})),w=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(V=>V.url)}),k=yield sm({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:V=>(I.debug("[".concat(h.clientId,"] Connect to backup choose_server:"),V.url),kb(V,h,p,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},w),V[0]},promisesCollector:y});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},w),k});return function(){return O.apply(this,arguments)}}();try{return E=yield om([S(),T()]),y.length&&y.forEach(O=>O.cancel&&"function"==typeof O.cancel&&O.cancel()),E}catch(O){throw O[0]}}),function(h,p,m,_){return d.apply(this,arguments)})(o,n,i,s)};var d}),tO.apply(this,arguments)}function nx(o,n,i,s,c){return nO.apply(this,arguments)}function nO(){return nO=x(function*(o,n,i,s,c){const d=o.cloudProxyServer;if("disabled"===d){if(!s)return;if(o.useLocalAccessPoint)return yield eO(o,n,i,c);if(B("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:_,proxyInfo:E}=yield rx(o,n,i,c);return o.turnServer&&"auto"!==o.turnServer.mode||(o.turnServer={mode:"manual",servers:E.map(y=>({turnServerURL:y.address,tcpport:y.tcpport||no.tcpport,udpport:y.udpport||no.udpport,username:y.username||no.username,password:y.password||no.password,forceturn:!1,security:!0}))}),{gatewayInfo:_}}return yield eO(o,n,i,c)}const{proxyInfo:h,gatewayInfo:p}=yield rx(o,n,i,c),m={gatewayInfo:p};return o.turnServer={mode:"manual",servers:h.map(_=>({turnServerURL:_.address,tcpport:"proxy3"===d?void 0:_.tcpport?_.tcpport:no.tcpport,udpport:"proxy4"===d?void 0:_.udpport?_.udpport:no.udpport,username:_.username||no.username,password:_.password||no.password,forceturn:"proxy4"!==d,security:"proxy5"===d}))},I.debug("[".concat(o.clientId,"] set proxy server: ").concat(o.proxyServer,", mode: ").concat(d)),m}),nO.apply(this,arguments)}function ix(o,n,i,s,c){return Fb.apply(this,arguments)}function Fb(){return Fb=x(function*(o,n,i,s,c){let h=[];h=B("ACCOUNT_REGISTER").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(n.proxyServer?m=>"https://".concat(n.proxyServer,"/ap/?url=").concat(m+"/api/v1"):m=>"https://".concat(m,"/api/v1"));const p=c?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const m=yield(_=x(function*(E,y,S,T,O){const N=Date.now(),w={sid:S.sid,opid:10,appid:S.appId,string_uid:y};let k=E[0];const V=yield Ks(()=>Fa(k+"".concat(-1===k.indexOf("?")?"?":"&","action=stringuid"),{data:w,cancelToken:T,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(U,Y)=>{if(0===U.code){if(U.uid<=0||U.uid>=Math.pow(2,32))throw I.error("Invalid Uint Uid ".concat(y," => ").concat(U.uid),U),ye.reqUserAccount(w.sid,{lts:N,success:!1,serverAddr:k,stringUid:w.string_uid,uid:U.uid,errorCode:M.INVALID_UINT_UID_FROM_STRING_UID,extend:w}),new W(M.INVALID_UINT_UID_FROM_STRING_UID);return ye.reqUserAccount(w.sid,{lts:N,success:!0,serverAddr:k,stringUid:w.string_uid,uid:U.uid,errorCode:null,extend:w}),!1}const re=lh(U.code);return re.retry&&(k=E[(Y+1)%E.length]),ye.reqUserAccount(w.sid,{lts:N,success:!1,serverAddr:k,stringUid:w.string_uid,uid:U.uid,errorCode:re.desc,extend:w}),re.retry},(U,Y)=>U.code!==M.OPERATION_ABORTED&&(ye.reqUserAccount(w.sid,{lts:N,success:!1,serverAddr:k,stringUid:w.string_uid,uid:null,errorCode:U.code,extend:w}),k=E[(Y+1)%E.length],!0),O);if(0!==V.code){const U=lh(V.code);throw new W(M.UNEXPECTED_RESPONSE,U.desc)}return V}),function(E,y,S,T,O){return _.apply(this,arguments)})(h,o,n,i,s);return c?.recordJoinChannelService({status:"success",endTs:Date.now()},p),m.uid}catch(m){throw c?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},p),m}var _}),Fb.apply(this,arguments)}function iO(){return iO=x(function*(o,n,i){const s=B("CDS_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(p=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(p+"/api/v1"):"https://".concat(p,"/api/v1?action=config")).map(p=>function(m,_,E,y){const S=Et(),T={flag:64,cipher_method:0,features:{device:S.name,system:S.os,system_general:navigator.userAgent,vendor:_.appId,version:vo,cname:_.cname,sid:_.sid,session_id:_.sid,detail:"",proxyServer:_.proxyServer}};return Ks(()=>Fa(m,{data:T,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,O=>O.code!==M.OPERATION_ABORTED,y)}(p,o,n,i));let c=null,d=null,h={};try{c=yield om(s)}catch(p){if(p.code===M.OPERATION_ABORTED)throw p;d=p}if(s.forEach(p=>p.cancel()),ye.reportApiInvoke(o.sid,{name:Rn.REQUEST_CONFIG_DISTRIBUTE,options:{error:d,res:c}}).onSuccess(),c&&c.test_tags)try{h=function(p){if(!p.test_tags)return{};const m=p.test_tags,_=Object.keys(m),E={};return _.forEach(y=>{var S;const T=eD(S=y.slice(4)).call(S),O=JSON.parse(m[y])[1];E[T]=O}),E}(c)}catch{}return h}),iO.apply(this,arguments)}function rx(o,n,i,s){return rO.apply(this,arguments)}function rO(){return rO=x(function*(o,n,i,s){const c=B("PROXY_SERVER_TYPE3"),d=(T,O,N)=>{let w=N||c;return Array.isArray(w)&&(w=O%2==0?c[1]:c[0]),"https://".concat(w,"/ap/?url=").concat(T)};let h=null;const p=[],m=function(){var T=x(function*(){const O=B("WEBCS_DOMAIN").slice(0,B("AJAX_REQUEST_CONCURRENT")).map((k,V)=>{let U;return U="disabled"===o.cloudProxyServer&&o.proxyServer?d("".concat(k,"/api/v2/transpond/webrtc?v=2"),V,o.proxyServer):"disabled"===o.cloudProxyServer||"fallback"===o.cloudProxyServer?"https://".concat(k,"/api/v2/transpond/webrtc?v=2"):d("".concat(k,"/api/v2/transpond/webrtc?v=2"),V),{url:U,areaCode:BE(),serviceIds:[nn.CHOOSE_SERVER,"proxy5"===o.cloudProxyServer?nn.CLOUD_PROXY_5:"proxy3"===o.cloudProxyServer||"proxy4"===o.cloudProxyServer?nn.CLOUD_PROXY:nn.CLOUD_PROXY_FALLBACK]}}),N=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(k=>k.url)}),w=yield sm({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:k=>(I.debug("[".concat(o.clientId,"] Connect to choose_server:"),k.url),wc(k,o,n,i)),allFailedhandler:k=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},N),k[0]},promisesCollector:p});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},N),w});return function(){return T.apply(this,arguments)}}(),_=function(){var T=x(function*(){if(yield ui(1e3),null!==h)return h;const O=B("WEBCS_DOMAIN_BACKUP_LIST").map((k,V)=>{let U;return U="disabled"===o.cloudProxyServer&&o.proxyServer?d("".concat(k,"/api/v2/transpond/webrtc?v=2"),V,o.proxyServer):"disabled"===o.cloudProxyServer||"fallback"===o.cloudProxyServer?"https://".concat(k,"/api/v2/transpond/webrtc?v=2"):d("".concat(k,"/api/v2/transpond/webrtc?v=2"),V),{url:U,areaCode:BE(),serviceIds:[nn.CHOOSE_SERVER,"proxy5"===o.cloudProxyServer?nn.CLOUD_PROXY_5:"proxy3"===o.cloudProxyServer||"proxy4"===o.cloudProxyServer?nn.CLOUD_PROXY:nn.CLOUD_PROXY_FALLBACK]}}),N=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(k=>k.url)}),w=yield sm({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:k=>(I.debug("[".concat(o.clientId,"] Connect to backup choose_server:"),k.url),wc(k,o,n,i)),allFailedhandler:k=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},N),k[0]},promisesCollector:p});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},N),w});return function(){return T.apply(this,arguments)}}();let E,y,S;try{({gatewayInfo:E,proxyInfo:y,url:S}=yield om([m(),_()]))}catch(T){throw T[0]}if(p.length&&p.forEach(T=>T.cancel&&"function"==typeof T.cancel&&T.cancel()),!E||!y)throw new W(M.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(o.apUrl=S,"disabled"!==o.cloudProxyServer&&Array.isArray(c)&&S){const T=/^https?:\/\/(.+?)(\/.*)?$/.exec(S)[1];be(c).call(c,T)&&(o.proxyServer=T,I.setProxyServer(T),ye.setProxyServer(T))}return h={gatewayInfo:E,proxyInfo:yield YL(y,E.uid)},h}),rO.apply(this,arguments)}function ox(o,n,i,s){return oO.apply(this,arguments)}function oO(){return oO=x(function*(o,n,i,s){const c=B("UAP_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(d=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap"));return yield cV(c,o,n,i,s)}),oO.apply(this,arguments)}function sO(){return sO=x(function*(o,n,i){const s=B("UAP_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(c=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(c+"/api/v1?action=uap"):"https://".concat(c,"/api/v1?action=uap")).map(c=>function(d,h,p,m){const _={command:"convergeAllocateEdge",sid:h.sid,appId:h.appId,token:h.token,ts:Date.now(),version:vo,cname:h.cname,uid:h.uid.toString(),requestId:JD,seq:JD};JD+=1;const E={service_name:"tele_channel",json_body:JSON.stringify(_)};return Ks(x(function*(){const y=yield Fa(d,{data:E,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==y.code){const T=new W(M.UNEXPECTED_RESPONSE,"cross channel ap error, code"+y.code,{retry:!0});throw I.error(T.toString()),T}const S=JSON.parse(y.json_body);if(200!==S.code){const T=new W(M.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(S.code,", reason: ").concat(S.reason));throw I.error(T.toString()),T}if(!S.servers||0===S.servers.length){const T=new W(M.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw I.error(T.toString()),T}return{vid:S.vid,workerToken:S.workerToken,addressList:(B("CHANNEL_MEDIA_RELAY_SERVERS")||S.servers).map(T=>"wss://".concat(T.address.replace(/\./g,"-"),".").concat(B("WORKER_DOMAIN"),":").concat(T.wss))}}),void 0,y=>!!(y.code!==M.OPERATION_ABORTED&&y.code!==M.UNEXPECTED_RESPONSE||y.data&&y.data.retry),m)}(c,o,n,i));try{const c=yield om(s);return s.forEach(d=>d.cancel()),c}catch(c){throw c[0]}}),sO.apply(this,arguments)}function aO(){return aO=x(function*(o,n,i){let s=null;const c=[],d=function(){var h=x(function*(p){const m=B(p?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return p&&(yield ui(1e3),null!==s)?s:yield sm({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(I.debug("[".concat(o.clientId,"] update ticket, Connect to ").concat(p?"backup":""," choose_server:"),_),function(E,y,S,T){const[O]=lV(y,[nn.CHOOSE_SERVER]);let N=Bn.networkState;return Ks(x(function*(){N&&Bn.networkState===xi.OFFLINE&&Bn.onlineWaiter&&(yield z.race([Bn.onlineWaiter,ui(T&&T.maxRetryTimeout||_n.maxRetryTimeout)])),N=Bn.networkState;const w=yield Fa(E,{data:O,cancelToken:S,headers:{"Content-Type":"multipart/form-data;"}},!0);return Lb(w,E)}),()=>!1,w=>w.code!==M.OPERATION_ABORTED&&(w.code===M.UPDATE_TICKET_FAILED?w.data.retry:(I.warning("[".concat(y.clientId,"] update ticket network error, retry"),w),!0)),T)}(_,o,n,i)),allFailedhandler:_=>{throw _[0]},promisesCollector:c})});return function(m){return h.apply(this,arguments)}}();try{return s=yield om([d(!1),d(!0)]),c.length&&c.forEach(h=>h.cancel&&"function"==typeof h.cancel&&h.cancel()),s}catch(h){throw h[0]}}),aO.apply(this,arguments)}function cO(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function am(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?cO(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):cO(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class lO extends kt{constructor(){super(),C(this,"configs",void 0),C(this,"joinInfo",void 0),C(this,"cancelToken",void 0),C(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),C(this,"interval",void 0),C(this,"mutex",new li("config-distribute")),C(this,"mutableParamsRead",!1)}startGetConfigDistribute(n,i){this.joinInfo=n,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),B("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},B("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}awaitConfigDistributeComplete(){var n=this;return x(function*(){!n.mutex.isLocked||(yield n.mutex.lock())()})()}updateConfigDistribute(){var n=this;return x(function*(){if(n.mutableParamsRead||(n.mutableParamsRead=!0,ye.reportApiInvoke(null,{options:void 0,name:Rn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Je.TRACER}).onSuccess(JSON.stringify(gd))),!n.joinInfo||!n.cancelToken||!n.retryConfig)return void I.debug("[config-distribute] get config distribute interrupted have no joininfo");let i;const s=yield n.mutex.lock();try{i=yield function dV(o,n,i){return iO.apply(this,arguments)}(n.joinInfo,n.cancelToken,n.retryConfig),I.debug("[config-distribute] get config distribute",JSON.stringify(i)),i.limit_bitrate&&n.handleBitrateLimit(i.limit_bitrate),n.cacheGlobalParameterConfig(i),n.configs=i}catch(c){const d=new W(M.NETWORK_RESPONSE_ERROR,c);I.warning("[config-distribute] ".concat(d.toString()))}finally{s()}})()}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(n){var i;(i=n)&&i.uplink&&i.id&&void 0!==i.uplink.max_bitrate&&void 0!==i.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==n.id&&this.emit(Rf.UPDATE_BITRATE_LIMIT,n):this.emit(Rf.UPDATE_BITRATE_LIMIT,n))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&am({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(n){var i;const s=Vp(i=Object.keys(n).filter(d=>/^webrtc_ng_global_parameter/.test(d))).call(i);for(let d=0;d<s.length;d++)for(let h=s.length-1;h>d;h--){const p=s[h];if("number"==typeof n[p].__priority){const m=n[p].__priority,_=s[h-1];if("number"==typeof n[_].__priority){if(!(m>n[_].__priority))continue;{const E=p;s[h]=s[h-1],s[h-1]=E}}else{const E=p;s[h]=s[h-1],s[h-1]=E}}}const c={};s.forEach(d=>{const h=n[d],p=h.__expires;Object.keys(h).forEach(m=>{"__priority"===m||"__expires"===m||Object.prototype.hasOwnProperty.call(c,m)||(c[m]=am({value:h[m]},p&&{expires:p}))})});try{!function(p){try{const m=Date.now();Object.keys(p).forEach(_=>{switch(_){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":if(Object.prototype.hasOwnProperty.call(hi,_)){const{value:E,expires:y}=p[_];if(y&&y<=m)return;gd[_]=E,hi[_]=E,I.debug("Update global parameters from config distribute",_,E)}}})}catch(m){I.error("Error update config immediately: ".concat(p),m.message)}}(c);const d=JSON.stringify(c),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),I.debug("Caching global parameters ".concat(d))}catch(d){I.error("Error caching global parameters:",d.message)}}}function fl(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function lo(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?fl(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):fl(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class ax extends kt{constructor(n,i,s,c){super(),C(this,"spec",void 0),C(this,"token",void 0),C(this,"websocket",void 0),C(this,"pingpongTimer",void 0),C(this,"reconnectMode","retry"),C(this,"serviceMode",void 0),C(this,"reqId",0),C(this,"commandReqId",0),C(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),C(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):this.serviceMode===Kn.INJECT?this.emit(qs.INJECT_STREAM_STATUS,h):(ye.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Kn.TRANSCODE?1:2}),this.emit(qs.PUBLISH_STREAM_STATUS,h))}),this.spec=i,this.token=n,this.serviceMode=c,this.websocket=new uh("live-streaming",s),this.websocket.on(Oe.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Oe.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Oe.REQUEST_NEW_URLS,(d,h)=>{dn(this,qs.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(Oe.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(n){return this.websocket.init(n)}request(n,i,s,c){var d=this;return x(function*(){d.reqId+=1,"request"===n&&(d.commandReqId+=1);const h=d.commandReqId,p=d.reqId;if(!p||!d.websocket)throw new W(M.UNEXPECTED_ERROR);const m=lo({command:n,sdkVersion:"4.19.1"===vo?"0.0.1":vo,seq:p,requestId:p,allocate:s,cname:d.spec.cname,appId:d.spec.appId,sid:d.spec.sid,uid:d.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if("closed"===d.websocket.state)throw new W(M.WS_DISCONNECT);const _=()=>new z((T,O)=>{d.websocket.once(Oe.CLOSED,()=>O(new W(M.WS_ABORT))),d.websocket.once(Oe.CONNECTED,T)});"connected"!==d.websocket.state&&(yield _()),m.clientRequest&&(m.clientRequest.workerToken=d.token);const E=new z((T,O)=>{const N=()=>{O(new W(M.WS_ABORT))};d.websocket.once(Oe.RECONNECTING,N),d.websocket.once(Oe.CLOSED,N),d.once("@".concat(p,"-").concat(d.spec.sid),w=>{T(w)})});c&&ye.workerEvent(d.spec.sid,lo(lo({},c),{},{requestId:h,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const y=Date.now();d.websocket.sendMessage(m);let S=null;try{S=yield E}catch(T){if("closed"===d.websocket.state)throw T;return yield _(),yield d.request(n,i,s)}return c&&ye.workerEvent(d.spec.sid,lo(lo({},c),{},{requestId:h,actionType:"response",payload:JSON.stringify(S.serverResponse),serverCode:S.code,success:200===S.code,responseTime:Date.now()-y})),200!==S.code&&d.handleResponseError(S),S})()}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const n="4.19.1"===vo?"0.0.1":vo;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:n,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(n){switch(n.code){case wn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void I.warning("live stream response already exists stream");case wn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case wn.LIVE_STREAM_RESPONSE_BAD_STREAM:case wn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new W(M.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:n.code}).throw();case wn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===n.serverResponse.command||"UninjectStream"===n.serverResponse.command)return;throw new W(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case wn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new W(M.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:n.code}).throw();case wn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new W(M.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(qs.WARNING,i,n.serverResponse.url)}case wn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new W(M.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(qs.WARNING,i,n.serverResponse.url)}case wn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new W(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case wn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new W(M.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:n.code}).throw();case wn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new W(M.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(qs.WARNING,i,n.serverResponse.url)}case wn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new W(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code}).throw();case wn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new W(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case wn.LIVE_STREAM_RESPONSE_WORKER_LOST:case wn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===n.serverResponse.command||"UninjectStream"===n.serverResponse.command)return;throw new W(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case wn.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===n.serverResponse.command||"UninjectStream"===n.serverResponse.command)return;if("UpdateTranscoding"===n.serverResponse.command||"ControlStream"===n.serverResponse.command)return new W(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:n.code}).throw();throw new W(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case wn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case wn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case wn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case wn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new W(M.LIVE_STREAMING_CDN_ERROR,"",{code:n.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(rC)},6e3)}}function Ub(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function yr(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?Ub(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Ub(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class cx extends kt{constructor(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_n,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_n;super(),C(this,"onLiveStreamWarning",void 0),C(this,"onLiveStreamError",void 0),C(this,"onInjectStatusChange",void 0),C(this,"spec",void 0),C(this,"retryTimeout",1e4),C(this,"connection",void 0),C(this,"httpRetryConfig",void 0),C(this,"wsRetryConfig",void 0),C(this,"streamingTasks",new Map),C(this,"isStartingStreamingTask",!1),C(this,"taskMutex",new li("live-streaming")),C(this,"cancelToken",or.CancelToken.source()),C(this,"transcodingConfig",void 0),C(this,"injectConfig",yr({},HA)),C(this,"injectLoopTimes",0),C(this,"uapResponse",void 0),C(this,"lastTaskId",1),C(this,"statusError",new Map),this.spec=n,this.httpRetryConfig=s,this.wsRetryConfig=i}setTranscodingConfig(n){var i=this;return x(function*(){const s=yr(yr({},ch),n);var p;66!==s.videoCodecProfile&&77!==s.videoCodecProfile&&100!==s.videoCodecProfile&&(I.debug("[".concat(i.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(p=>yr(yr(yr({},MU),p),{},{zOrder:p.zOrder?p.zOrder+1:1}))),Bt((p=s).width)||At(p.width,"config.width",0,1e4),Bt(p.height)||At(p.height,"config.height",0,1e4),Bt(p.videoBitrate)||At(p.videoBitrate,"config.videoBitrate",1,1e6),Bt(p.videoFrameRate)||At(p.videoFrameRate,"config.videoFrameRate"),Bt(p.lowLatency)||Zc(p.lowLatency,"config.lowLatency"),Bt(p.audioSampleRate)||Vn(p.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Bt(p.audioBitrate)||At(p.audioBitrate,"config.audioBitrate",1,128),Bt(p.audioChannels)||Vn(p.audioChannels,"config.audioChannels",[1,2,3,4,5]),Bt(p.videoGop)||At(p.videoGop,"config.videoGop"),Bt(p.videoCodecProfile)||Vn(p.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Bt(p.userCount)||At(p.userCount,"config.userCount",0,17),Bt(p.backgroundColor)||At(p.backgroundColor,"config.backgroundColor",0,16777215),Bt(p.userConfigExtraInfo)||bi(p.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),p.transcodingUsers&&!Bt(p.transcodingUsers)&&(mc(p.transcodingUsers,"config.transcodingUsers"),p.transcodingUsers.forEach((m,_)=>{oh(m.uid),Bt(m.x)||At(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),Bt(m.y)||At(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),Bt(m.width)||At(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),Bt(m.height)||At(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),Bt(m.zOrder)||At(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),Bt(m.alpha)||At(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),Bt(p.watermark)||ah(p.watermark,"watermark"),Bt(p.backgroundImage)||ah(p.backgroundImage,"backgroundImage"),p.images&&!Bt(p.images)&&(mc(p.images,"config.images"),p.images.forEach((m,_)=>{ah(m,"images[".concat(_,"]"))}));const c=[];s.images&&c.push(...s.images.map(p=>yr(yr(yr({},sh),p),{},{zOrder:255}))),s.backgroundImage&&(c.push(yr(yr(yr({},sh),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(c.push(yr(yr(yr({},sh),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=c,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(p=>yr({},p)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const d=(s.userConfigs||[]).map(p=>"number"==typeof p.uid?z.resolve(p.uid):ix(p.uid,i.spec,i.cancelToken.token,i.httpRetryConfig));if((yield z.all(d)).forEach((p,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=p)}),i.transcodingConfig=s,i.connection)try{var h;const p=yield i.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:i.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(vc(h=i.streamingTasks).call(h)).map(m=>m.taskId).join("#")});I.debug("[".concat(i.spec.clientId,"] update live transcoding config success, code: ").concat(p.code,", config:"),JSON.stringify(i.transcodingConfig))}catch(p){if(!p.data||!p.data.retry)throw p;p.data.changeAddress&&i.connection.tryNextAddress(),i.streamingTasks.forEach(m=>{I.warning("[".concat(i.spec.clientId,"] live streaming receive error"),p.toString(),"try to republish",m.url),i.startLiveStreamingTask(m.url,m.mode,p).then(()=>{I.debug("[".concat(i.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{I.error("[".concat(i.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),i.onLiveStreamError&&i.onLiveStreamError(m.url,_)})})}})()}setInjectStreamConfig(n,i){this.injectConfig=Object.assign({},this.injectConfig,n),this.injectLoopTimes=i}startLiveStreamingTask(n,i,s){var c=this;return x(function*(){var d;if(Array.from(vc(d=c.streamingTasks).call(d)).find(_=>_.mode===Kn.INJECT)&&i===Kn.INJECT)return new W(M.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!c.transcodingConfig&&i===Kn.TRANSCODE)throw new W(M.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let h={command:"PublishStream",ts:Date.now(),url:n,uid:c.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};I.debug("[".concat(c.spec.clientId,"] start live streaming ").concat(n,", mode: ").concat(i));const p=yield c.taskMutex.lock();if(!c.connection&&s)return void p();if(c.streamingTasks.get(n)&&!s)return p(),new W(M.LIVE_STREAMING_TASK_CONFLICT).throw();try{c.connection||(c.connection=yield c.connect(i))}catch(_){throw p(),_}switch(i){case Kn.TRANSCODE:h.transcodingConfig=yr({},c.transcodingConfig);break;case Kn.RAW:break;case Kn.INJECT:h={cname:c.spec.cname,command:"InjectStream",sid:c.spec.sid,transcodingConfig:c.injectConfig,ts:Date.now(),url:n,loopTimes:c.injectLoopTimes}}c.uapResponse&&c.uapResponse.vid&&(h.vid=c.uapResponse.vid),c.isStartingStreamingTask=!0;const m=c.lastTaskId++;try{const _=new z((y,S)=>{ui(c.retryTimeout).then(()=>{if(s)return S(s);const T=c.statusError.get(n);return T?(c.statusError.delete(n),S(T)):void 0})}),E=yield z.race([c.connection.request("request",{clientRequest:h},!0,{url:n,command:"PublishStream",workerType:i===Kn.TRANSCODE?1:2,requestByUser:!s,tid:m.toString()}),_]);c.isStartingStreamingTask=!1,I.debug("[".concat(c.spec.clientId,"] live streaming started, code: ").concat(E.code)),c.streamingTasks.set(n,{clientRequest:h,mode:i,url:n,taskId:m}),p()}catch(_){if(p(),c.isStartingStreamingTask=!1,!_.data||!_.data.retry||s)throw _;return _.data.changeAddress?(c.connection.tryNextAddress(),yield c.startLiveStreamingTask(n,i,_)):yield c.startLiveStreamingTask(n,i,_)}})()}stopLiveStreamingTask(n){return new z((i,s)=>{const c=this.streamingTasks.get(n);if(!c||!this.connection)return new W(M.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=c.mode;c.abortTask=()=>{I.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(n),i()},this.connection.request("request",{clientRequest:{command:d===Kn.INJECT?"UninjectStream":"UnpublishStream",url:c.url}},!1,{url:n,command:"UnPublishStream",workerType:d===Kn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{I.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(n),0===this.streamingTasks.size&&d!==Kn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),i(),d===Kn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(yc.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,n)}).catch(s)})}controlInjectStream(n,i,s,c){var d=this;return x(function*(){const h=d.streamingTasks.get(n);if(!h||!d.connection||h.mode!==Kn.INJECT)throw new W(M.INVALID_OPERATION,"can not find inject stream task to control");return(yield d.connection.request("request",{clientRequest:{command:"ControlStream",url:n,control:i,audioVolume:s,position:c}})).serverResponse})()}resetAllTask(){var n;const i=Array.from(vc(n=this.streamingTasks).call(n));this.terminate();for(const s of i)this.startLiveStreamingTask(s.url,s.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(s.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=or.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}connect(n){var i=this;return x(function*(){if(i.connection)throw new W(M.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=yield dn(i,nl.REQUEST_WORKER_MANAGER_LIST,n);return i.uapResponse=s,i.connection=new ax(s.workerToken,i.spec,i.wsRetryConfig,n),i.connection.on(qs.WARNING,(c,d)=>i.onLiveStreamWarning&&i.onLiveStreamWarning(d,c)),i.connection.on(qs.PUBLISH_STREAM_STATUS,c=>i.handlePublishStreamServer(c)),i.connection.on(qs.INJECT_STREAM_STATUS,c=>i.handleInjectStreamServerStatus(c)),i.connection.on(qs.REQUEST_NEW_ADDRESS,(c,d)=>{if(!i.connection)return d(new W(M.UNEXPECTED_ERROR,"can not get new live streaming address list"));dn(i,nl.REQUEST_WORKER_MANAGER_LIST,n).then(h=>{i.uapResponse=h,c(h.addressList)}).catch(d)}),yield i.connection.init(s.addressList),i.connection})()}handlePublishStreamServer(n){const i=n.serverStatus&&n.serverStatus.url||"empty_url",s=this.streamingTasks.get(i),c=n.reason;switch(n.code){case wn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case wn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case wn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case wn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new W(M.LIVE_STREAMING_CDN_ERROR,"",{code:n.code});if(s)return I.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,h);if(!this.isStartingStreamingTask)return;this.statusError.set(i,h)}case wn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new W(M.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,h)}case wn.LIVE_STREAM_RESPONSE_WORKER_LOST:case wn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(vc(d=this.streamingTasks).call(d));for(const p of h)p.abortTask?p.abortTask():(I.warning("[".concat(this.spec.clientId,"] publish stream status code"),n.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new W(M.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code})).then(()=>{I.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(m=>{I.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,m)}));return}}}handleInjectStreamServerStatus(n){const i=Number(n.uid),s=n.serverStatus&&n.serverStatus.url;switch(n.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(yc.INJECT_STREAM_STATUS_START_SUCCESS,i,s));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(yc.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,i,s),void this.streamingTasks.delete(s);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(yc.INJECT_STREAM_STATUS_START_UNAUTHORIZED,i,s),void this.streamingTasks.delete(s);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(yc.INJECT_STREAM_STATUS_BROKEN,i,s),void this.streamingTasks.delete(s);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(yc.INJECT_STREAM_STATUS_START_TIMEOUT,i,s),void this.streamingTasks.delete(s);default:return void I.debug("inject stream server status",n)}}hasUrl(n){return this.streamingTasks.has(n)}}class jE{constructor(){C(this,"destChannelMediaInfos",new Map),C(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(n){GA(n),this.srcChannelMediaInfo=n}addDestChannelInfo(n){GA(n),this.destChannelMediaInfos.set(n.channelName,n)}removeDestChannelInfo(n){jA(n),this.destChannelMediaInfos.delete(n)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function cm(o){if(!(o instanceof jE))return new W(M.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const n=o.getSrcChannelMediaInfo(),i=o.getDestChannelMediaInfo();return n?0===i.size?new W(M.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new W(M.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class lx extends kt{constructor(n,i,s){super(),C(this,"ws",void 0),C(this,"requestId",1),C(this,"heartBeatTimer",void 0),C(this,"joinInfo",void 0),C(this,"clientId",void 0),C(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),C(this,"onClose",c=>{this.emit("close"),this.dispose()}),C(this,"onMessage",c=>{const d=JSON.parse(c.data);if(!d||"serverResponse"!==d.command||!d.requestId)return d&&"serverStatus"===d.command&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=n,this.clientId=i,this.ws=new uh("cross-channel-".concat(this.clientId),s),this.ws.on(Oe.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Oe.CONNECTED,this.onOpen),this.ws.on(Oe.ON_MESSAGE,this.onMessage),this.ws.on(Oe.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(n){const i=this.requestId++;return n.requestId=i,n.seq=i,this.ws.sendMessage(n),i}waitStatus(n){return new z((i,s)=>{const c=window.setTimeout(()=>{s(new W(M.TIMEOUT,"wait status timeout, status: ".concat(n)))},5e3);this.once(n,d=>{window.clearTimeout(c),d.state&&0!==d.state?s(new W(M.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(n))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),s(new W(M.WS_ABORT))})})}request(n){var i=this;return x(function*(){if("closed"===i.ws.state)throw new W(M.WS_DISCONNECT);"connected"!==i.ws.state&&(yield new z((p,m)=>{i.ws.once(Oe.CLOSED,()=>m(new W(M.WS_ABORT))),i.ws.once(Oe.CONNECTED,p)}));const c=i.sendMessage(n),d=new z((p,m)=>{const _=()=>{m(new W(M.WS_ABORT))};i.ws.once(Oe.RECONNECTING,_),i.ws.once(Oe.CLOSED,_),i.once("req_".concat(c),p),ui(3e3).then(()=>{i.removeAllListeners("req_".concat(c)),i.ws.off(Oe.RECONNECTING,_),i.ws.off(Oe.CLOSED,_),m(new W(M.TIMEOUT,"cross channel ws request timeout"))})}),h=yield d;if(!h||200!==h.code)throw new W(M.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(h)));return h})()}connect(n){var i=this;return x(function*(){i.ws.removeAllListeners(Oe.REQUEST_NEW_URLS),i.ws.on(Oe.REQUEST_NEW_URLS,s=>{s(n)}),yield i.ws.init(n)})()}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(n){const i=this.requestId++;return n.requestId=i,this.ws.sendMessage(n),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class ml extends kt{set state(n){n!==this._state&&(n!==$n.RELAY_STATE_FAILURE&&(this.errorCode=il.RELAY_OK),this.emit("state",n,this.errorCode),this._state=n)}get state(){return this._state}constructor(n,i,s,c,d){var h;super(),h=this,C(this,"joinInfo",void 0),C(this,"sid",void 0),C(this,"clientId",void 0),C(this,"cancelToken",or.CancelToken.source()),C(this,"workerToken",void 0),C(this,"requestId",0),C(this,"signal",void 0),C(this,"prevChannelMediaConfig",void 0),C(this,"httpRetryConfig",void 0),C(this,"_resolution",void 0),C(this,"_state",$n.RELAY_STATE_IDLE),C(this,"errorCode",il.RELAY_OK),C(this,"onStatus",p=>{I.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(p))),p&&p.command&&("onAudioPacketReceived"===p.command&&this.emit("event",Ia.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===p.command&&this.emit("event",Ia.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===p.command&&(this.errorCode=il.SRC_TOKEN_EXPIRED,this.state=$n.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===p.command&&(this.errorCode=il.DEST_TOKEN_EXPIRED,this.state=$n.RELAY_STATE_FAILURE))}),C(this,"onReconnect",x(function*(){I.debug("[".concat(h.clientId,"] ChannelMediaSocket disconnect, reconnecting")),h.emit("event",Ia.NETWORK_DISCONNECTED),h.state=$n.RELAY_STATE_IDLE,h.prevChannelMediaConfig&&h.sendStartRelayMessage(h.prevChannelMediaConfig).catch(p=>{h.state!==$n.RELAY_STATE_IDLE&&(I.error("auto restart channel media relay failed",p.toString()),h.errorCode=il.SERVER_CONNECTION_LOST,h.state=$n.RELAY_STATE_FAILURE)})})),this.joinInfo=n,this.clientId=i,this.sid=iC(),this.signal=new lx(this.joinInfo,this.clientId,s),this.httpRetryConfig=c,this._resolution=d}startChannelMediaRelay(n){var i=this;return x(function*(){if(i.state!==$n.RELAY_STATE_IDLE)throw new W(M.INVALID_OPERATION);i.state=$n.RELAY_STATE_CONNECTING,yield i.connect(),I.debug("[".concat(i.clientId,"] startChannelMediaRelay: connect success"));try{yield i.sendStartRelayMessage(n)}catch(s){throw s.data&&s.data.serverResponse&&"SetSourceChannel"===s.data.serverResponse.command?new W(M.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&"SetDestChannelStatus"===s.serverResponse.command?new W(M.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&"StartPacketTransfer"===s.serverResponse.command?new W(M.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}i.prevChannelMediaConfig=n})()}updateChannelMediaRelay(n){var i=this;return x(function*(){if(i.state!==$n.RELAY_STATE_RUNNING)throw new W(M.INVALID_OPERATION);yield i.sendUpdateMessage(n),i.prevChannelMediaConfig=n})()}setVideoProfile(n){var i=this;return x(function*(){if(i._resolution=n,i.state!==$n.RELAY_STATE_RUNNING)throw new W(M.INVALID_OPERATION);const s=i.genMessage(Ii.SetVideoProfile);yield i.signal.request(s),I.debug("[".concat(i.clientId,"] startChannelMediaRelay: setVideoProfile success"))})()}stopChannelMediaRelay(){var n=this;return x(function*(){yield n.sendStopRelayMessage(),I.debug("[".concat(n.clientId,"] stopChannelMediaRelay: send stop message success")),n.state=$n.RELAY_STATE_IDLE,n.dispose()})()}dispose(){I.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=or.CancelToken.source(),this.state=$n.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}connect(){var n=this;return x(function*(){const i=yield function uV(o,n,i){return sO.apply(this,arguments)}(n.joinInfo,n.cancelToken.token,n.httpRetryConfig);n.workerToken=i.workerToken,yield n.signal.connect(i.addressList),n.emit("event",Ia.NETWORK_CONNECTED),n.signal.on("status",n.onStatus),n.signal.on("reconnecting",n.onReconnect)})()}sendStartRelayMessage(n){var i=this;return x(function*(){const s=i.genMessage(Ii.StopPacketTransfer);yield i.signal.request(s),yield i.signal.waitStatus("Normal Quit"),I.debug("[".concat(i.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const c=i.genMessage(Ii.SetSdkProfile,n);yield i.signal.request(c),I.debug("[".concat(i.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const d=i.genMessage(Ii.SetSourceChannel,n);yield i.signal.request(d),yield i.signal.waitStatus("SetSourceChannelStatus"),i.emit("event",Ia.PACKET_JOINED_SRC_CHANNEL),I.debug("[".concat(i.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const h=i.genMessage(Ii.SetSourceUserId,n);yield i.signal.request(h),I.debug("[".concat(i.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const p=i.genMessage(Ii.SetDestChannel,n);yield i.signal.request(p),yield i.signal.waitStatus("SetDestChannelStatus"),i.emit("event",Ia.PACKET_JOINED_DEST_CHANNEL),I.debug("[".concat(i.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=i.genMessage(Ii.StartPacketTransfer,n);yield i.signal.request(m),i.emit("event",Ia.PACKET_SENT_TO_DEST_CHANNEL),i.state=$n.RELAY_STATE_RUNNING,I.debug("[".concat(i.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),i.setVideoProfile(i._resolution)})()}sendUpdateMessage(n){var i=this;return x(function*(){const s=i.genMessage(Ii.UpdateDestChannel,n);yield i.signal.request(s),i.emit("event",Ia.PACKET_UPDATE_DEST_CHANNEL),I.debug("[".concat(i.clientId,"] sendUpdateMessage: UpdateDestChannel success"))})()}sendStopRelayMessage(){var n=this;return x(function*(){const i=n.genMessage(Ii.StopPacketTransfer);yield n.signal.request(i),I.debug("[".concat(n.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))})()}genMessage(n,i){const s=[],c=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:vo,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.19.1"===h.sdkVersion&&(h.sdkVersion="0.0.1");let p=null,m=null;switch(n){case Ii.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Ii.SetSourceChannel:if(m=i&&i.getSrcChannelMediaInfo(),!m)throw new W(M.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},h;case Ii.SetSourceUserId:if(m=i&&i.getSrcChannelMediaInfo(),!m)throw new W(M.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:m.uid+""},h;case Ii.SetDestChannel:if(p=i&&i.getDestChannelMediaInfo(),!p)throw new W(M.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{s.push(_.channelName),c.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:s,uid:c,token:d},h;case Ii.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Ii.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Ii.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Ii.UpdateDestChannel:if(p=i&&i.getDestChannelMediaInfo(),!p)throw new W(M.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{s.push(_.channelName),c.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:s,uid:c,token:d},h;case Ii.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}class vi{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(n,i){C(this,"uid",void 0),C(this,"_uintid",void 0),C(this,"_trust_in_room_",!0),C(this,"_trust_audio_enabled_state_",!0),C(this,"_trust_video_enabled_state_",!0),C(this,"_trust_audio_mute_state_",!0),C(this,"_trust_video_mute_state_",!0),C(this,"_audio_muted_",!1),C(this,"_video_muted_",!1),C(this,"_audio_enabled_",!0),C(this,"_video_enabled_",!0),C(this,"_audio_added_",!1),C(this,"_video_added_",!1),C(this,"_trust_video_stream_added_state_",!0),C(this,"_trust_audio_stream_added_state_",!0),C(this,"_audioTrack",void 0),C(this,"_videoTrack",void 0),C(this,"_dataChannels",[]),C(this,"_audioSSRC",void 0),C(this,"_videoSSRC",void 0),C(this,"_audioOrtc",void 0),C(this,"_videoOrtc",void 0),C(this,"_cname",void 0),C(this,"_rtxSsrcId",void 0),this.uid=n,this._uintid=i}}var vr=Fw,_l=Pr;Wt({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var o=_l.f(this);return{promise:o.promise,resolve:o.resolve,reject:o.reject}}});var dx=Pr,dO=ju;Wt({target:"Promise",stat:!0,forced:!0},{try:function(o){var n=dx.f(this),i=dO(o);return(i.error?n.reject:n.resolve)(i.value),n.promise}});var HE=hr(vr),Vb=Tu.f("asyncIterator"),uO=hr(Vb);function GE(o,n){this.v=o,this.k=n}function Dh(o){var n,i;function s(d,h){try{var p=o[d](h),m=p.value,_=m instanceof GE;HE.resolve(_?m.v:m).then(function(E){if(_){var y="return"===d?"return":"next";if(!m.k||E.done)return s(y,E);E=o[y](E).value}c(p.done?"return":"normal",E)},function(E){s("throw",E)})}catch(E){c("throw",E)}}function c(d,h){switch(d){case"return":n.resolve({value:h,done:!0});break;case"throw":n.reject(h);break;default:n.resolve({value:h,done:!1})}(n=n.next)?s(n.key,n.arg):i=null}this._invoke=function(d,h){return new HE(function(p,m){var _={key:d,arg:h,resolve:p,reject:m,next:null};i?i=i.next=_:(n=i=_,s(d,h))})},"function"!=typeof o.return&&(this.return=void 0)}function Ro(o){return function(){return new Dh(o.apply(this,arguments))}}function lt(o){return new GE(o,0)}function lm(o){var n={},i=!1;function s(c,d){return i=!0,{done:!1,value:new GE(d=new HE(function(h){h(o[c](d))}),1)}}return n[void 0!==Kc&&nS||"@@iterator"]=function(){return this},n.next=function(c){return i?(i=!1,c):s("next",c)},"function"==typeof o.throw&&(n.throw=function(c){if(i)throw i=!1,c;return s("throw",c)}),"function"==typeof o.return&&(n.return=function(c){return i?(i=!1,c):s("return",c)}),n}Dh.prototype["function"==typeof Kc&&uO||"@@asyncIterator"]=function(){return this},Dh.prototype.next=function(o){return this._invoke("next",o)},Dh.prototype.throw=function(o){return this._invoke("throw",o)},Dh.prototype.return=function(o){return this._invoke("return",o)};var dm=hr(Vb),Bb={exports:{}};!function(o,n){o.exports=(()=>{var i={8:(d,h,p)=>{p.r(h),p.d(h,{Parser:()=>ve,Printer:()=>bt,parse:()=>Le,print:()=>pt});const m="\n",_="".concat("\r").concat(m),E=" ";let y;function S(le){return le>="0"&&le<="9"}function T(le){return le>="!"&&le<="~"}function O(le){return T(le)||le>="\x80"&&le<="\xff"}function N(le){return"!"===le||le>="#"&&le<="'"||le>="*"&&le<="+"||le>="-"&&le<="."||le>="0"&&le<="9"||le>="A"&&le<="Z"||le>="^"&&le<="~"}function w(le){return le>="1"&&le<="9"}function k(le){return le>="A"&&le<="Z"||le>="a"&&le<="z"}function V(le){return"d"===le||"h"===le||"m"===le||"s"===le}function U(le){return le>"\x01"&&le<"\t"||le>"\v"&&le<"\f"||le>"\x0e"&&le<"\xff"}function Y(le){return k(le)||S(le)||"+"===le||"/"===le}function re(le){return S(le)||k(le)||"+"===le||"/"===le||"-"===le||"_"===le}function K(le){return k(le)||S(le)||"+"===le||"/"===le}function $(le,R){var F=Object.keys(le);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(le);R&&(H=H.filter(function(oe){return Object.getOwnPropertyDescriptor(le,oe).enumerable})),F.push.apply(F,H)}return F}function X(le){for(var R=1;R<arguments.length;R++){var F=null!=arguments[R]?arguments[R]:{};R%2?$(Object(F),!0).forEach(function(H){J(le,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(le,Object.getOwnPropertyDescriptors(F)):$(Object(F)).forEach(function(H){Object.defineProperty(le,H,Object.getOwnPropertyDescriptor(F,H))})}return le}function J(le,R,F){return R in le?Object.defineProperty(le,R,{value:F,enumerable:!0,configurable:!0,writable:!0}):le[R]=F,le}var le;(le=y||(y={})).VERSION="v",le.ORIGIN="o",le.SESSION_NAME="s",le.INFORMATION="i",le.URI="u",le.EMAIL="e",le.PHONE="p",le.CONNECTION="c",le.BANDWIDTH="b",le.TIME="t",le.REPEAT="r",le.ZONE_ADJUSTMENTS="z",le.KEY="k",le.ATTRIBUTE="a",le.MEDIA="m";class Ee{consumeText(R,F){let H=F;for(;H<R.length;){const oe=R[H];if("\0"===oe||"\r"===oe||oe===m)break;H+=1}if(H-F==0)throw new Error("Invalid text, at ".concat(R));return H}consumeUnicastAddress(R,F,H){return this.consumeTill(R,F,E)}consumeOneOrMore(R,F,H){let oe=F;for(;H(R[oe]);)oe++;if(oe-F==0)throw new Error("Invalid rule at ".concat(F,"."));return oe}consumeSpace(R,F){if(R[F]===E)return F+1;throw new Error("Invalid space at ".concat(F,"."))}consumeIP4Address(R,F){let H=F;for(let oe=0;oe<4;oe++)if(H=this.consumeDecimalUChar(R,H),3!==oe){if("."!==R[H])throw new Error("Invalid IP4 address.");H++}return H}consumeDecimalUChar(R,F){let H=F;for(let Ue=0;Ue<3&&S(R[H]);Ue++,H++);if(H-F==0)throw new Error("Invalid decimal uchar.");const oe=parseInt(R.slice(F,H));if(oe>=0&&oe<=255)return H;throw new Error("Invalid decimal uchar")}consumeIP6Address(R,F){let H=this.consumeHexpart(R,F);return":"===R[H]&&(H+=1,H=this.consumeIP4Address(R,H)),H}consumeHexpart(R,F){let H=F;if(":"===R[H]&&":"===R[H+1]){H+=2;try{H=this.consumeHexseq(R,H)}catch{}return H}if(H=this.consumeHexseq(R,H),":"===R[H]&&":"===R[H+1]){H+=2;try{H=this.consumeHexseq(R,H)}catch{}return H}return H}consumeHexseq(R,F){let H=F;for(;H=this.consumeHex4(R,H),":"===R[H]&&":"!==R[H+1];)H+=1;return H}consumeHex4(R,F){let H=0;for(;H<4;H++)if(!((oe=R[F+H])>="0"&&oe<="9"||oe>="a"&&oe<="f"||oe>="A"&&oe<="F")){if(0===H)throw new Error("Invalid hex 4");break}var oe;return F+H}consumeFQDN(R,F){let H=F;for(;S(R[H])||k(R[H])||"-"===R[H]||"."===R[H];)H+=1;if(H-F<4)throw new Error("Invalid FQDN");return H}consumeExtnAddr(R,F){return this.consumeOneOrMore(R,F,O)}consumeMulticastAddress(R,F,H){switch(H){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(R,F);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(R,F);default:try{return this.consumeFQDN(R,F)}catch{return this.consumeExtnAddr(R,F)}}}consumeIP6MulticastAddress(R,F){const H=this.consumeHexpart(R,F);return"/"===R[H]?this.consumeInteger(R,H+1):H}consumeIP4MulticastAddress(R,F){let H=F+3;const oe=R.slice(F,H),Ue=parseInt(oe);if(Ue<224||Ue>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Yt=0;Yt<3;Yt++){if("."!==R[H])throw new Error("Invalid IP4 multicast address.");H+=1,H=this.consumeDecimalUChar(R,H)}return"/"===R[H]&&(H+=1),H=this.consumeTTL(R,H),"/"===R[H]&&(H=this.consumeInteger(R,H)),H}consumeInteger(R,F){if(!w(R[F]))throw new Error("Invalid integer.");for(F+=1;S(R[F]);)F+=1;return F}consumeTTL(R,F){if("0"===R[F])return F+1;if(!w(R[F]))throw new Error("Invalid TTL.");F+=1;for(let H=0;H<2&&S(R[F]);H++)F+=1;return F}consumeToken(R,F){return this.consumeOneOrMore(R,F,N)}consumeTime(R,F){let H=F;if("0"===R[H])return H+1;for(w(R[H])&&(H+=1);S(R[H]);)H++;if(H-F<10)throw new Error("Invalid time");return H}consumeAddress(R,F){return this.consumeTill(R,F,E)}consumeTypedTime(R,F){let H=F;return H=this.consumeOneOrMore(R,H,S),V(R[H])?H+1:H}consumeRepeatInterval(R,F){if(!w(R[F]))throw new Error("Invalid repeat interval");for(F+=1;S(R[F]);)F+=1;return V(R[F])&&(F+=1),F}consumePort(R,F){return this.consumeOneOrMore(R,F,S)}consume(R,F,H){for(let oe=0;oe<H.length;oe++){if(F+oe>=R.length)throw new Error("consume exceeding value length");if(R[F+oe]!==H[oe])throw new Error("consume ".concat(H," failed at ").concat(oe))}return F+H.length}consumeTill(R,F,H){let oe=F;for(;oe<R.length&&("string"!=typeof H||R[oe]!==H)&&("function"!=typeof H||!H(R[oe]));)oe++;return oe}}class ve extends Ee{constructor(){super(),J(this,"records",[]),J(this,"currentLine",0)}parse(R){const F=this.probeEOL(R);this.records=R.split(F).filter(ei=>!!ei.trim()).map(this.parseLine),this.currentLine=0;const H=this.parseVersion(),oe=this.parseOrigin(),Ue=this.parseSessionName(),Yt=this.parseInformation(),Gi=this.parseUri(),Do=this.parseEmail(),vl=this.parsePhone(),ST=this.parseConnection(),CT=this.parseBandWidth(),Cs=this.parseTimeFields(),$d=this.parseKey(),bm=this.parseSessionAttribute(),Ln=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:H,origin:oe,sessionName:Ue,information:Yt,uri:Gi,emails:Do,phones:vl,connection:ST,bandwidths:CT,timeFields:Cs,key:$d,attributes:bm,mediaDescriptions:Ln}}getCurrentRecord(){const R=this.records[this.currentLine];if(!R)throw new Error("Record doesn't exit.");return R}probeEOL(R){for(let F=0;F<R.length;F++)if(R[F]===m)return"\r"===R[F-1]?_:m;throw new Error("Invalid newline character.")}parseLine(R,F){if(R.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const H=R[0];if("="!==R[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:H,value:R.slice(2),line:F,cur:0}}parseSessionAttribute(){const R=new ht;for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==y.ATTRIBUTE)break;const H={attField:this.extractOneOrMore(F,oe=>N(oe)&&":"!==oe),_cur:0};":"===F.value[F.cur]&&(F.cur+=1,H.attValue=this.extractOneOrMore(F,U)),R.parse(H),this.currentLine++}return R.digest()}parseMediaAttributes(R){const F=new Ct(R);for(;this.currentLine<this.records.length;){const H=this.getCurrentRecord();if(H.type!==y.ATTRIBUTE)break;const oe={attField:this.extractOneOrMore(H,Ue=>N(Ue)&&":"!==Ue),_cur:0};":"===H.value[H.cur]&&(H.cur+=1,oe.attValue=this.extractOneOrMore(H,U)),F.parse(oe),this.currentLine++}return F.digest()}parseKey(){const R=this.getCurrentRecord();if(R.type===y.KEY){if("prompt"===R.value||"clear:"===R.value||"base64:"===R.value||"uri:"===R.value)return R.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const R=this.getCurrentRecord();if(R.type===y.ZONE_ADJUSTMENTS){const F=[];for(;;)try{const H=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);let oe=!1;"-"===R.value[R.cur]&&(oe=!0,R.cur+=1);const Ue=this.extract(R,this.consumeTypedTime);F.push({time:H,typedTime:Ue,back:oe})}catch{break}if(0===F.length)throw new Error("Invalid zone adjustments");return this.currentLine++,F}return[]}parseRepeat(){const R=[];for(;;){const F=this.getCurrentRecord();if(F.type!==y.REPEAT)break;{const H=this.extract(F,this.consumeRepeatInterval),oe=this.parseTypedTime(F);R.push({repeatInterval:H,typedTimes:oe}),this.currentLine++}}return R}parseTypedTime(R){const F=[];for(;;)try{this.consumeSpaceForRecord(R),F.push(this.extract(R,this.consumeTypedTime))}catch{break}if(0===F.length)throw new Error("Invalid typed time.");return F}parseTime(){const R=this.getCurrentRecord(),F=this.extract(R,this.consumeTime);this.consumeSpaceForRecord(R);const H=this.extract(R,this.consumeTime);return this.currentLine++,{startTime:F,stopTime:H}}parseBandWidth(){const R=[];for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==y.BANDWIDTH)break;{const H=this.extractOneOrMore(F,N);if(":"!==F.value[F.cur])throw new Error("Invalid bandwidth field.");F.cur++;const oe=this.extractOneOrMore(F,S);R.push({bwtype:H,bandwidth:oe}),this.currentLine++}}return R}parseVersion(){const R=this.getCurrentRecord();if(R.type!==y.VERSION)throw new Error("first sdp record must be version");const F=R.value.slice(0,this.consumeOneOrMore(R.value,0,S));if(F.length!==R.value.length)throw new Error('invalid proto version, "v='.concat(R.value,'"'));return this.currentLine++,F}parseOrigin(){const R=this.getCurrentRecord();if(R.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");const F=this.extractOneOrMore(R,O);this.consumeSpaceForRecord(R);const H=this.extractOneOrMore(R,S);this.consumeSpaceForRecord(R);const oe=this.extractOneOrMore(R,S);this.consumeSpaceForRecord(R);const Ue=this.extractOneOrMore(R,N);this.consumeSpaceForRecord(R);const Yt=this.extractOneOrMore(R,N);this.consumeSpaceForRecord(R);const Gi=this.extract(R,this.consumeUnicastAddress);return this.currentLine++,{username:F,sessId:H,sessVersion:oe,nettype:Ue,addrtype:Yt,unicastAddress:Gi}}parseSessionName(){const R=this.getCurrentRecord();if(R.type===y.SESSION_NAME){const F=this.extract(R,this.consumeText);return this.currentLine++,F}}parseInformation(){const R=this.getCurrentRecord();if(R.type!==y.INFORMATION)return;const F=this.extract(R,this.consumeText);return this.currentLine++,F}parseUri(){const R=this.getCurrentRecord();if(R.type===y.URI)return this.currentLine++,R.value}parseEmail(){const R=[];for(;;){const F=this.getCurrentRecord();if(F.type!==y.EMAIL)break;R.push(F.value),this.currentLine++}return R}parsePhone(){const R=[];for(;;){const F=this.getCurrentRecord();if(F.type!==y.PHONE)break;R.push(F.value),this.currentLine++}return R}parseConnection(){const R=this.getCurrentRecord();if(R.type===y.CONNECTION){const F=this.extractOneOrMore(R,N);this.consumeSpaceForRecord(R);const H=this.extractOneOrMore(R,N);this.consumeSpaceForRecord(R);const oe=this.extract(R,this.consumeAddress);return this.currentLine++,{nettype:F,addrtype:H,address:oe}}}parseMedia(){const R=this.getCurrentRecord(),F=this.extract(R,this.consumeToken);this.consumeSpaceForRecord(R);let H=this.extract(R,this.consumePort);"/"===R.value[R.cur]&&(R.cur+=1,H+=this.extract(R,this.consumeInteger)),this.consumeSpaceForRecord(R);const oe=[];for(oe.push(this.extract(R,this.consumeToken));"/"===R.value[R.cur];)R.cur+=1,oe.push(this.extract(R,this.consumeToken));if(0===oe.length)throw new Error("Invalid proto");const Ue=this.parseFmt(R);return this.currentLine++,{mediaType:F,port:H,protos:oe,fmts:Ue}}parseTimeFields(){const R=[];for(;this.getCurrentRecord().type===y.TIME;){const F=this.parseTime(),H=this.parseRepeat(),oe=this.parseZone();R.push({time:F,repeats:H,zones:oe})}return R}parseMediaDescription(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){const F=this.parseMedia(),H=this.parseInformation(),oe=this.parseConnections(),Ue=this.parseBandWidth(),Yt=this.parseKey(),Gi=this.parseMediaAttributes(F);R.push({media:F,information:H,connections:oe,bandwidths:Ue,key:Yt,attributes:Gi})}return R}parseConnections(){const R=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)R.push(this.parseConnection());return R}parseFmt(R){const F=[];for(;;)try{this.consumeSpaceForRecord(R),F.push(this.extract(R,this.consumeToken))}catch{break}if(0===F.length)throw new Error("Invalid fmts");return F}extract(R,F,...H){const oe=F.call(this,R.value,R.cur,...H),Ue=R.value.slice(R.cur,oe);return R.cur=oe,Ue}extractOneOrMore(R,F){const H=this.consumeOneOrMore(R.value,R.cur,F),oe=R.value.slice(R.cur,H);return R.cur=H,oe}consumeSpaceForRecord(R){if(R.value[R.cur]!==E)throw new Error("Invalid space at ".concat(R.cur,"."));R.cur+=1}}class ze extends Ee{constructor(...R){super(...R),J(this,"attributes",void 0),J(this,"digested",!1)}extractOneOrMore(R,F,H){const oe=this.consumeOneOrMore(R.attValue,R._cur,F),Ue=R.attValue.slice(R._cur,oe),[Yt,Gi]=H||[];if("number"==typeof Yt&&Ue.length<Yt)throw new Error("error in length, should be more or equal than ".concat(Yt," characters."));if("number"==typeof Gi&&Ue.length>Gi)throw new Error("error in length, should be less or equal than ".concat(Gi," characters."));return R._cur=oe,Ue}consumeAttributeSpace(R){if(R.attValue[R._cur]!==E)throw new Error("Invalid space at ".concat(R._cur,"."));R._cur+=1}extract(R,F,...H){if(!R.attValue)throw new Error("Nothing to extract from attValue.");const oe=F.call(this,R.attValue,R._cur,...H),Ue=R.attValue.slice(R._cur,oe);return R._cur=oe,Ue}atEnd(R){if(!R.attValue)throw new Error;return R._cur>=R.attValue.length}peekChar(R){if(!R.attValue)throw new Error;return R.attValue[R._cur]}peek(R,F){if(!R.attValue)throw new Error;for(let H=0;H<F.length;H++)if(F[H]!==R.attValue[R._cur+H])return!1;return!0}parseIceUfrag(R){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(R,Y,[4,256])}parseIcePwd(R){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(R,Y,[22,256])}parseIceOptions(R){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const F=[];for(;!this.atEnd(R);){F.push(this.extractOneOrMore(R,Y));try{this.consumeAttributeSpace(R)}catch(H){if(this.atEnd(R))break;throw H}}this.attributes.iceOptions=F}parseFingerprint(R){const F=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const H=this.extract(R,this.consumeTill);this.attributes.fingerprints.push({hashFunction:F,fingerprint:H})}parseExtmap(R){const F=this.extractOneOrMore(R,S);let H;"/"===this.peekChar(R)&&(this.extract(R,this.consume,"/"),H=this.extract(R,this.consumeToken)),this.consumeAttributeSpace(R);const oe=this.extract(R,this.consumeTill,E),Ue=X(X({entry:parseInt(F,10)},H&&{direction:H}),{},{extensionName:oe});this.peekChar(R)===E&&(this.consumeAttributeSpace(R),Ue.extensionAttributes=this.extract(R,this.consumeTill)),this.attributes.extmaps.push(Ue)}parseSetup(R){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const F=this.extract(R,this.consumeTill);if("active"!==F&&"passive"!==F&&"actpass"!==F&&"holdconn"!==F)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=F}}class ht extends ze{constructor(...R){super(...R),J(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"group":this.parseGroup(R);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"fingerprint":this.parseFingerprint(R);break;case"setup":this.parseSetup(R);break;case"tls-id":this.parseTlsId(R);break;case"identity":this.parseIdentity(R);break;case"extmap":this.parseExtmap(R);break;case"msid-semantic":this.parseMsidSemantic(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(F){throw console.error("parsing session attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),F}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(R){const F=this.extract(R,this.consumeToken),H=[];for(;!this.atEnd(R)&&this.peekChar(R)===E;)this.consumeAttributeSpace(R),H.push(this.extract(R,this.consumeToken));this.attributes.groups.push({semantic:F,identificationTag:H})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(R){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(R,re)}parseIdentity(R){const F=this.extractOneOrMore(R,K),H=[];for(;!this.atEnd(R)&&this.peekChar(R)===E;){this.consumeAttributeSpace(R);const oe=this.extract(R,this.consumeToken);this.extract(R,this.consume,"=");const Ue=this.extractOneOrMore(R,Yt=>Yt!==E&&U(Yt));H.push({name:oe,value:Ue})}this.attributes.identities.push({assertionValue:F,extensions:H})}parseMsidSemantic(R){this.peekChar(R)===E&&this.consumeAttributeSpace(R);const F={semantic:this.extract(R,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(R)}catch{break}if("*"===this.peekChar(R)){this.extract(R,this.consume,"*"),F.applyForAll=!0;break}{const H=this.extract(R,this.consumeTill,E);F.identifierList.push(H)}}this.attributes.msidSemantic=F}}class Ct extends ze{constructor(R){super(),J(this,"attributes",void 0),-1!==R.protos.indexOf("RTP")||R.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(R){if(this.digested)throw new Error("already digested");try{switch(R.attField){case"extmap":this.parseExtmap(R);break;case"setup":this.parseSetup(R);break;case"ice-ufrag":this.parseIceUfrag(R);break;case"ice-pwd":this.parseIcePwd(R);break;case"ice-options":this.parseIceOptions(R);break;case"candidate":this.parseCandidate(R);break;case"remote-candidate":this.parseRemoteCandidate(R);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(R);break;case"rtpmap":this.parseRtpmap(R);break;case"ptime":this.parsePtime(R);break;case"maxptime":this.parseMaxPtime(R);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(R);break;case"ssrc":this.parseSSRC(R);break;case"fmtp":this.parseFmtp(R);break;case"rtcp-fb":this.parseRtcpFb(R);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(R);break;case"mid":this.parseMid(R);break;case"msid":this.parseMsid(R);break;case"imageattr":this.parseImageAttr(R);break;case"rid":this.parseRid(R);break;case"simulcast":this.parseSimulcast(R);break;case"sctp-port":this.parseSctpPort(R);break;case"max-message-size":this.parseMaxMessageSize(R);break;case"ssrc-group":this.parseSSRCGroup(R);break;default:R.ignored=!0,this.attributes.unrecognized.push(R)}}catch(F){throw console.error("parsing media attribute ".concat(R.attField,' error, "a=').concat(R.attField,":").concat(R.attValue,'"')),F}if(!R.ignored&&R.attValue&&!this.atEnd(R))throw new Error("attribute parsing error")}parseCandidate(R){const F=this.extractOneOrMore(R,Y,[1,32]);this.consumeAttributeSpace(R);const H=this.extractOneOrMore(R,S,[1,5]);this.consumeAttributeSpace(R);const oe=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const Ue=this.extractOneOrMore(R,S,[1,10]);this.consumeAttributeSpace(R);const Yt=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const Gi=this.extract(R,this.consumePort);this.consumeAttributeSpace(R),this.extract(R,this.consume,"typ"),this.consumeAttributeSpace(R);const Do={foundation:F,componentId:H,transport:oe,priority:Ue,connectionAddress:Yt,port:Gi,type:this.extract(R,this.consumeToken),extension:{}};for(this.peek(R," raddr")&&(this.extract(R,this.consume," raddr"),this.consumeAttributeSpace(R),Do.relAddr=this.extract(R,this.consumeAddress)),this.peek(R," rport")&&(this.extract(R,this.consume," rport"),this.consumeAttributeSpace(R),Do.relPort=this.extract(R,this.consumePort));this.peekChar(R)===E;){this.consumeAttributeSpace(R);const vl=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R),Do.extension[vl]=this.extractOneOrMore(R,T)}this.attributes.candidates.push(Do)}parseRemoteCandidate(R){const F=[];for(;;){const H=this.extractOneOrMore(R,S,[1,5]);this.consumeAttributeSpace(R);const oe=this.extract(R,this.consumeAddress);this.consumeAttributeSpace(R);const Ue=this.extract(R,this.consumePort);F.push({componentId:H,connectionAddress:oe,port:Ue});try{this.consumeAttributeSpace(R)}catch{break}}this.attributes.remoteCandidatesList.push(F)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(R){const F=this.extract(R,this.consumeToken);this.consumeAttributeSpace(R);const H=this.extract(R,this.consumeTill,"/");this.extract(R,this.consume,"/");const oe={encodingName:H,clockRate:this.extractOneOrMore(R,S)};this.atEnd(R)||"/"!==this.peekChar(R)||(this.extract(R,this.consume,"/"),oe.encodingParameters=parseInt(this.extract(R,this.consumeTill),10));const Ue=this.attributes.payloads.find(Yt=>Yt.payloadType===parseInt(F,10));Ue?Ue.rtpMap=oe:this.attributes.payloads.push({payloadType:parseInt(F,10),rtpMap:oe,rtcpFeedbacks:[]})}parsePtime(R){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(R,this.consumeTill)}parseMaxPtime(R){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(R,this.consumeTill)}parseDirection(R){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=R.attField}parseSSRC(R){const F=this.extractOneOrMore(R,S);this.consumeAttributeSpace(R);const H=this.extract(R,this.consumeTill,":");let oe;":"===this.peekChar(R)&&(this.extract(R,this.consume,":"),oe=this.extract(R,this.consumeTill));const Ue=this.attributes.ssrcs.find(Yt=>Yt.ssrcId===parseInt(F,10));Ue?Ue.attributes[H]=oe:this.attributes.ssrcs.push({ssrcId:parseInt(F,10),attributes:{[H]:oe}})}parseFmtp(R){const F=this.extract(R,this.consumeTill,E);this.consumeAttributeSpace(R);const H=this.extract(R,this.consumeTill),oe={};H.split(";").forEach(Yt=>{let[Gi,Do]=Yt.split("=");Gi=Gi.trim();const vl="string"==typeof Do?Do.trim():null;"string"==typeof Gi&&Gi.length>0&&(oe[Gi]=vl)});const Ue=this.attributes.payloads.find(Yt=>Yt.payloadType===parseInt(F,10));Ue?Ue.fmtp={parameters:oe}:this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[],fmtp:{parameters:oe}})}parseFmtParameters(R){const F={},H=this.extract(R,this.consumeTill,"=");R._cur++;const oe=this.extract(R,this.consumeTill,";");for(F[H]=oe;";"===R.attValue[R._cur];){const Ue=this.extract(R,this.consumeTill,"=");R._cur++;const Yt=this.extract(R,this.consumeTill,";");F[Ue]=Yt}return F}parseRtcpFb(R){let F="";F="*"===this.peekChar(R)?this.extract(R,this.consume,"*"):this.extract(R,this.consumeTill,E),this.consumeAttributeSpace(R);const H=this.extract(R,this.consumeTill,E);let oe;if("trr-int"===H)oe={type:H,interval:this.extract(R,this.consumeTill)};else{const Ue={type:H};this.peekChar(R)===E&&(this.consumeAttributeSpace(R),Ue.parameter=this.extract(R,this.consumeToken),this.peekChar(R)===E&&(Ue.additional=this.extract(R,this.consumeTill))),oe=Ue}if("*"===F)this.attributes.rtcpFeedbackWildcards.push(oe);else{const Ue=this.attributes.payloads.find(Yt=>Yt.payloadType===parseInt(F,10));Ue?Ue.rtcpFeedbacks.push(oe):this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[oe]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(R){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const F={port:this.extract(R,this.consumePort)};this.peekChar(R)===E&&(this.consumeAttributeSpace(R),F.netType=this.extractOneOrMore(R,N),this.consumeAttributeSpace(R),F.addressType=this.extractOneOrMore(R,N),this.consumeAttributeSpace(R),F.address=this.extract(R,this.consumeAddress)),this.attributes.rtcp=F}parseMsid(R){const F={id:this.extractOneOrMore(R,N,[1,64])};this.peekChar(R)===E&&(this.consumeAttributeSpace(R),F.appdata=this.extractOneOrMore(R,N,[1,64])),this.attributes.msids.push(F)}parseImageAttr(R){this.attributes.imageattr.push(R.attValue)}parseRid(R){const F=this.extractOneOrMore(R,oe=>k(oe)||S(oe)||"_"===oe||"-"===oe);this.consumeAttributeSpace(R);const H={id:F,direction:this.extract(R,this.consumeToken),params:[]};if(this.peekChar(R)===E){if(this.consumeAttributeSpace(R),this.peek(R,"pt=")){this.extract(R,this.consume,"pt=");const oe=[];for(;;){const Ue=this.extract(R,this.consumeToken);oe.push(Ue);try{this.extract(R,this.consume,",")}catch{break}}H.payloads=oe,this.peekChar(R)===E&&this.extract(R,this.consume,E)}for(;;){const oe=this.extract(R,this.consumeToken);switch(oe){case"depend":{const Ue={type:oe,rids:this.extract(R,this.consume,"=").split(",")};H.params.push(Ue);break}default:{const Ue={type:oe};"="===this.peekChar(R)&&(this.extract(R,this.consume,"="),Ue.val=this.extract(R,this.consumeTill,";")),H.params.push(Ue)}}try{this.extract(R,this.consume,";")}catch{break}}}this.attributes.rids.push(H)}parseSimulcast(R){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=R.attValue,this.extract(R,this.consumeTill)}parseSctpPort(R){this.attributes.sctpPort=this.extractOneOrMore(R,S,[1,5])}parseMaxMessageSize(R){this.attributes.maxMessageSize=this.extractOneOrMore(R,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(R){this.attributes.mid=this.extract(R,this.consumeToken)}parseSSRCGroup(R){const F=this.extract(R,this.consumeToken),H=[];for(;;)try{this.consumeAttributeSpace(R);const oe=this.extract(R,this.consumeInteger);H.push(parseInt(oe,10))}catch{break}this.attributes.ssrcGroups.push({semantic:F,ssrcIds:H})}}function dt(le,R,F){return R in le?Object.defineProperty(le,R,{value:F,enumerable:!0,configurable:!0,writable:!0}):le[R]=F,le}class bt{constructor(){dt(this,"eol",_)}print(R,F){let H="";return F&&(this.eol=F),H+=this.printVersion(R.version),H+=this.printOrigin(R.origin),H+=this.printSessionName(R.sessionName),H+=this.printInformation(R.information),H+=this.printUri(R.uri),H+=this.printEmail(R.emails),H+=this.printPhone(R.phones),H+=this.printConnection(R.connection),H+=this.printBandwidth(R.bandwidths),H+=this.printTimeFields(R.timeFields),H+=this.printKey(R.key),H+=this.printSessionAttributes(R.attributes),H+=this.printMediaDescription(R.mediaDescriptions),H}printVersion(R){return"v=".concat(R).concat(this.eol)}printOrigin(R){return"o=".concat(R.username," ").concat(R.sessId," ").concat(R.sessVersion," ").concat(R.nettype," ").concat(R.addrtype," ").concat(R.unicastAddress).concat(this.eol)}printSessionName(R){return R?"s=".concat(R).concat(this.eol):""}printInformation(R){return R?"i=".concat(R).concat(this.eol):""}printUri(R){return R?"u=".concat(R).concat(this.eol):""}printEmail(R){let F="";for(const H of R)F+="e=".concat(H).concat(this.eol);return F}printPhone(R){let F="";for(const H of R)F+="e=".concat(H).concat(this.eol);return F}printConnection(R){return R?"c=".concat(R.nettype," ").concat(R.addrtype," ").concat(R.address).concat(this.eol):""}printBandwidth(R){let F="";for(const H of R)F+="b=".concat(H.bwtype,":").concat(H.bandwidth).concat(this.eol);return F}printTimeFields(R){let F="";for(const H of R){F+="t=".concat(H.time.startTime," ").concat(H.time.startTime).concat(this.eol);for(const oe of H.repeats)F+="r=".concat(oe.repeatInterval," ").concat(oe.typedTimes.join(" ")).concat(this.eol);H.zoneAdjustments&&(F+="z=",F+="z=".concat(H.zoneAdjustments.map(oe=>"".concat(oe.time," ").concat(oe.back?"-":""," ").concat(oe.typedTime)).join(" ")).concat(this.eol),F+=this.eol)}return F}printKey(R){return R?"k=".concat(R).concat(this.eol):""}printAttributes(R){let F="";for(const H of R)F+="a=".concat(H.attField).concat(H.attValue?":".concat(H.attValue):"").concat(this.eol);return F}printMediaDescription(R){let F="";for(const H of R)F+=this.printMedia(H.media),F+=this.printInformation(H.information),F+=this.printConnections(H.connections),F+=this.printBandwidth(H.bandwidths),F+=this.printKey(H.key),F+=this.printMediaAttributes(H);return F}printConnections(R){let F="";for(const H of R)F+=this.printConnection(H);return F}printMedia(R){return"m=".concat(R.mediaType," ").concat(R.port," ").concat(R.protos.join("/")," ").concat(R.fmts.join(" ")).concat(this.eol)}printSessionAttributes(R){return new ae(this.eol).print(R)}printMediaAttributes(R){return new ge(this.eol).print(R)}}class ee{constructor(R){dt(this,"eol",void 0),this.eol=R}printIceUfrag(R){return void 0===R?"":"a=ice-ufrag:".concat(R).concat(this.eol)}printIcePwd(R){return void 0===R?"":"a=ice-pwd:".concat(R).concat(this.eol)}printIceOptions(R){return void 0===R?"":"a=ice-options:".concat(R.join(E)).concat(this.eol)}printFingerprints(R){return R.length>0?R.map(F=>"a=fingerprint:".concat(F.hashFunction).concat(E).concat(F.fingerprint)).join(this.eol)+this.eol:""}printExtmap(R){return R.map(F=>"a=extmap:".concat(F.entry).concat(F.direction?"/".concat(F.direction):"").concat(E).concat(F.extensionName).concat(F.extensionAttributes?"".concat(E).concat(F.extensionAttributes):"").concat(this.eol)).join("")}printSetup(R){return void 0===R?"":"a=setup:".concat(R).concat(this.eol)}printUnrecognized(R){return R.map(F=>"a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol)).join("")}}class ae extends ee{print(R){let F="";return F+=this.printGroups(R.groups),F+=this.printMsidSemantic(R.msidSemantic),F+=this.printIceLite(R.iceLite),F+=this.printIceUfrag(R.iceUfrag),F+=this.printIcePwd(R.icePwd),F+=this.printIceOptions(R.iceOptions),F+=this.printFingerprints(R.fingerprints),F+=this.printSetup(R.setup),F+=this.printTlsId(R.tlsId),F+=this.printIdentity(R.identities),F+=this.printExtmap(R.extmaps),F+=this.printUnrecognized(R.unrecognized),F}printGroups(R){let F="";return R.length>0&&(F+=R.map(H=>"a=group:".concat(H.semantic).concat(H.identificationTag.map(oe=>"".concat(E).concat(oe)).join("")).concat(this.eol)).join("")),F}printIceLite(R){return void 0===R?"":"a=ice-lite"+this.eol}printTlsId(R){return R?"a=tls-id:".concat(R).concat(this.eol):""}printIdentity(R){return 0===R.length?"":R.map(F=>"a=identity:".concat(F.assertionValue).concat(F.extensions.map(H=>"".concat(E).concat(H.name).concat(H.value?"=".concat(H.value):"")))).join(this.eol)+this.eol}printMsidSemantic(R){if(!R)return"";let F="a=msid-semantic:".concat(R.semantic);return R.applyForAll?F+="".concat(E,"*"):R.identifierList.length>0&&(F+=R.identifierList.map(H=>"".concat(E).concat(H))),F+this.eol}}class ge extends ee{print(R){const F=R.attributes;let H="";return H+=this.printRTCP(F.rtcp),H+=this.printIceUfrag(F.iceUfrag),H+=this.printIcePwd(F.icePwd),H+=this.printIceOptions(F.iceOptions),H+=this.printCandidates(F.candidates),H+=this.printRemoteCandidatesList(F.remoteCandidatesList),H+=this.printEndOfCandidates(F.endOfCandidates),H+=this.printFingerprints(F.fingerprints),H+=this.printSetup(F.setup),H+=this.printMid(F.mid),H+=this.printExtmap(F.extmaps),H+=this.printRTPRelated(F),H+=this.printPtime(F.ptime),H+=this.printMaxPtime(F.maxPtime),H+=this.printDirection(F.direction),H+=this.printSSRCGroups(F.ssrcGroups),H+=this.printSSRC(F.ssrcs),H+=this.printRTCPMux(F.rtcpMux),H+=this.printRTCPMuxOnly(F.rtcpMuxOnly),H+=this.printRTCPRsize(F.rtcpRsize),H+=this.printMSId(F.msids),H+=this.printImageattr(F.imageattr),H+=this.printRid(F.rids),H+=this.printSimulcast(F.simulcast),H+=this.printSCTPPort(F.sctpPort),H+=this.printMaxMessageSize(F.maxMessageSize),H+=this.printUnrecognized(F.unrecognized),H}printCandidates(R){return R.map(F=>"a=candidate:".concat(F.foundation).concat(E).concat(F.componentId).concat(E).concat(F.transport).concat(E).concat(F.priority).concat(E).concat(F.connectionAddress).concat(E).concat(F.port).concat(E,"typ").concat(E).concat(F.type).concat(F.relAddr?"".concat(E,"raddr").concat(E).concat(F.relAddr):"").concat(F.relPort?"".concat(E,"rport").concat(E).concat(F.relPort):"").concat(Object.keys(F.extension).map(H=>"".concat(E).concat(H).concat(E).concat(F.extension[H])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(R){return R.map(F=>"a=remote-candidates:".concat(F.join(E)).concat(this.eol)).join("")}printEndOfCandidates(R){return void 0===R?"":"a=end-of-candidates"+this.eol}printRTPRelated(R){if(!R.payloads)return"";const F=R.payloads;let H="";H+=R.rtcpFeedbackWildcards.map(oe=>this.printRTCPFeedback("*",oe)).join("");for(const oe of F)H+=this.printRtpMap(oe.payloadType,oe.rtpMap),H+=this.printFmtp(oe.payloadType,oe.fmtp),H+=oe.rtcpFeedbacks.map(Ue=>this.printRTCPFeedback(oe.payloadType,Ue)).join("");return H}printFmtp(R,F){if(!F)return"";const H=Object.keys(F.parameters);return 1===H.length&&null===F.parameters[H[0]]?"a=fmtp:".concat(R).concat(E).concat(H[0]).concat(this.eol):"a=fmtp:".concat(R).concat(E).concat(Object.keys(F.parameters).map(oe=>"".concat(oe,"=").concat(F.parameters[oe])).join(";")).concat(this.eol)}printRtpMap(R,F){return F?"a=rtpmap:".concat(R).concat(E).concat(F.encodingName,"/").concat(F.clockRate).concat(F.encodingParameters?"/".concat(F.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(R,F){let H="a=rtcp-fb:".concat(R).concat(E),oe=F;return"trr-int"===oe.type?H+="ttr-int".concat(E).concat(oe.interval):(H+="".concat(oe.type),oe.parameter&&(H+="".concat(E).concat(oe.parameter),oe.additional&&(H+="".concat(E).concat(oe.additional)))),H+this.eol}printPtime(R){return void 0===R?"":"a=ptime:".concat(R).concat(this.eol)}printMaxPtime(R){return void 0===R?"":"a=maxptime:".concat(R).concat(this.eol)}printDirection(R){return void 0===R?"":"a=".concat(R).concat(this.eol)}printSSRC(R){return R.map(F=>Object.keys(F.attributes).map(H=>"a=ssrc:".concat(F.ssrcId.toString(10)).concat(E).concat(H).concat(F.attributes[H]?":".concat(F.attributes[H]):"").concat(this.eol)).join("")).join("")}printRTCPMux(R){return void 0===R?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(R){return void 0===R?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(R){return void 0===R?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(R){if(void 0===R)return"";let F="a=rtcp:".concat(R.port);return R.netType&&(F+="".concat(E).concat(R.netType)),R.addressType&&(F+="".concat(E).concat(R.addressType)),R.address&&(F+="".concat(E).concat(R.address)),F+this.eol}printMSId(R){return R.map(F=>"a=msid:".concat(F.id).concat(F.appdata?"".concat(E).concat(F.appdata):"").concat(this.eol)).join("")}printImageattr(R){return R.map(F=>"a=imageattr:".concat(F).concat(this.eol)).join("")}printRid(R){return R.map(F=>{let H="a=rid:".concat(F.id).concat(E).concat(F.direction);return F.payloads&&(H+="".concat(E,"pt=").concat(F.payloads.join(","))),F.params.length>0&&(H+="".concat(E).concat(F.params.map(oe=>"depend"===oe.type?"depend=".concat(oe.rids.join(",")):"".concat(oe.type,"=").concat(oe.val)).join(";"))),H+this.eol}).join("")}printSimulcast(R){return void 0===R?"":"a=simulcast:".concat(R).concat(this.eol)}printSCTPPort(R){return void 0===R?"":"a=sctp-port:".concat(R).concat(this.eol)}printMaxMessageSize(R){return void 0===R?"":"a=max-message-size:".concat(R).concat(this.eol)}printMid(R){return void 0===R?"":"a=mid:".concat(R).concat(this.eol)}printSSRCGroups(R){return R.map(F=>"a=ssrc-group:".concat(F.semantic).concat(F.ssrcIds.map(H=>"".concat(E).concat(H.toString(10))).join("")).concat(this.eol)).join("")}}function Le(le){return(new ve).parse(le)}function pt(le,R){return(new bt).print(le,R)}}},s={};function c(d){if(s[d])return s[d].exports;var h=s[d]={exports:{}};return i[d](h,h.exports,c),h.exports}return c.d=(d,h)=>{for(var p in h)c.o(h,p)&&!c.o(d,p)&&Object.defineProperty(d,p,{enumerable:!0,get:h[p]})},c.o=(d,h)=>Object.prototype.hasOwnProperty.call(d,h),c.r=d=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},c(8)})()}(Bb);var En=Bb.exports;function jb(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Hb(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?jb(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):jb(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function Gb(o){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:p,filterVideoCodec:m}=n,{useXR:_}=i;let E=[],y=[],S=[],T=[],O=!1,N=!1;if(En.parse(o).mediaDescriptions.forEach(w=>{s&&s!==w.attributes.direction||("video"!==w.media.mediaType||O||(y=w.attributes.payloads,T=w.attributes.extmaps,O=!0),"audio"!==w.media.mediaType||N||(E=w.attributes.payloads,S=w.attributes.extmaps,N=!0))}),!T||0===y.length)throw new Error("Cannot get video capabilities from SDP.");if(!S||0===E.length)throw new Error("Cannot get audio capabilities from SDP.");return y.forEach(w=>{var k;null!==(k=w.rtpMap)&&void 0!==k&&k.clockRate&&(w.rtpMap.clockRate=parseInt(w.rtpMap.clockRate)),_&&w.rtcpFeedbacks.push({type:"rrtr"})}),E.forEach(w=>{var k;null!==(k=w.rtpMap)&&void 0!==k&&k.clockRate&&(w.rtpMap.clockRate=parseInt(w.rtpMap.clockRate)),_&&w.rtcpFeedbacks.push({type:"rrtr"})}),c&&(E=E.filter(w=>{var k;return"rtx"!==(null===(k=w.rtpMap)||void 0===k?void 0:k.encodingName.toLowerCase())}),y=y.filter(w=>{var k;return"rtx"!==(null===(k=w.rtpMap)||void 0===k?void 0:k.encodingName.toLowerCase())})),d&&(y=y.filter(w=>{var k;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(k=w.rtpMap)||void 0===k?void 0:k.encodingName)||"")})),h&&(E=E.filter(w=>{var k;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(k=w.rtpMap)||void 0===k?void 0:k.encodingName)||"")})),p&&p?.length>0&&(E=E.filter(w=>{var k;return be(p).call(p,(null===(k=w.rtpMap)||void 0===k?void 0:k.encodingName.toLowerCase())||"")})),m&&m?.length>0&&(y=y.filter(w=>{var k;return be(m).call(m,(null===(k=w.rtpMap)||void 0===k?void 0:k.encodingName.toLowerCase())||"")})),{audioCodecs:E,videoCodecs:y,audioExtensions:S,videoExtensions:T}}function gl(o){const n=En.parse(o);let i,s;for(const c of n.mediaDescriptions){if(!i){const d=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:d,icePwd:h}}if(!s){const d=c.attributes.fingerprints;d.length>0&&(s={fingerprints:d})}}if(!s&&n.attributes.fingerprints.length>0&&(s={fingerprints:n.attributes.fingerprints}),!s||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:s}}function Wb(o,n){const i=[],s=o.attributes.ssrcGroups.filter(h=>"FID"===h.semantic),c=o.attributes.ssrcGroups.find(h=>"SIM"===h.semantic),d=o.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var p;const m=null===(p=s.find(_=>_.ssrcIds[0]===h))||void 0===p?void 0:p.ssrcIds[1];i.push({ssrcId:h,rtx:n?m:void 0})});else if(s.length>0){const p=s[0].ssrcIds[1];i.push({ssrcId:s[0].ssrcIds[0],rtx:n?p:void 0})}else{if(0===d.length)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:d[0].ssrcId})}return i}function WE(o,n){const{cname:i}=o;let s;n&&n.ip&&"number"==typeof n.port?(s=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:n.ip,port:n.port.toString(),type:"host",extension:{}}],I.debug("Using remote candidate from AP ".concat(n.ip,":").concat(n.port)),n.ip6&&(s.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:n.ip6,port:n.port.toString(),type:"host",extension:{}}),I.debug("Using IPV6 remote candidate from AP ".concat(n.ip6,":").concat(n.port)))):s=o.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}}));const c={fingerprints:o.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},d={iceUfrag:o.iceParameters.iceUfrag,icePwd:o.iceParameters.icePwd};let h;switch(o.dtlsParameters.role){case"server":h="passive";break;case"client":h="active";break;case"auto":h="actpass"}return{dtlsParameters:c,iceParameters:d,candidates:s,rtpCapabilities:Sr(o.rtpCapabilities),setup:h,cname:i}}function wo(o,n,i){const s=[],c=[];return o.forEach(d=>{let{ssrcId:h,rtx:p}=d;const m=Ot(8,"track-"),_={ssrcId:h,attributes:Hb({label:m,mslabel:i=i||Ot(10,""),msid:"".concat(i," ").concat(m)},n&&{cname:n})};if(s.push(_),void 0!==p){const E={ssrcId:p,attributes:Hb({label:m,mslabel:i,msid:"".concat(i," ").concat(m)},n&&{cname:n})};s.push(E),c.push({semantic:"FID",ssrcIds:[h,p]})}}),o.length>1&&c.push({semantic:"SIM",ssrcIds:o.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:s,ssrcGroups:c}}function Ac(o,n){n instanceof ct&&o.attributes.payloads.forEach(i=>{var s;const c=null===(s=i.rtpMap)||void 0===s?void 0:s.encodingName.toLowerCase();if(!c||-1===["opus","pcmu","pcma","g722"].indexOf(c))return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const d=n._encoderConfig;d&&"pcmu"!==c&&"pcma"!==c&&"g722"!==c&&(d.bitrate&&!zt()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function zE(o){const n=o.attributes.unrecognized.findIndex(i=>"x-google-flag"===i.attField&&"conference"===i.attValue);-1!==n&&o.attributes.unrecognized.splice(n,1)}function KE(o,n){var i;if(!(n instanceof We&&n._encoderConfig&&-1===n._hints.indexOf(qt.SCREEN_TRACK)))return;const s=n._encoderConfig;Ut().supportMinBitrate&&s.bitrateMin&&o.attributes.payloads.forEach(c=>{var d,h;be(d=["h264","h265","vp8","vp9","av1"]).call(d,(null===(h=c.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(s.bitrateMin))}),Ut().supportMinBitrate&&!be(i=n._hints).call(i,qt.LOW_STREAM)&&s.bitrateMax&&o.attributes.payloads.forEach(c=>{var d,h;be(d=["h264","h265","vp8","vp9","av1"]).call(d,(null===(h=c.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(B("X_GOOGLE_START_BITRATE")||Math.floor(s.bitrateMax)))})}function zb(o){if("video"!==o.media.mediaType)return;const n=Et();if(n.name!==gt.SAFARI&&n.os!==ii.IOS)return;const i=o.attributes.extmaps.findIndex(s=>/video-orientation/g.test(s.extensionName));-1!==i&&o.attributes.extmaps.splice(i,1)}function Oh(o,n,i){if(!n)return;let s,c;if("video"===o.media.mediaType?(s=i.videoExtensions,c=i.videoCodecs):(s=i.audioExtensions,c=i.audioCodecs),!0===n.twcc){const d=s.find(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);d&&(o.attributes.extmaps.find(p=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===p.extensionName)||o.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),(p=c,m=o.attributes.payloads,m.filter(_=>!!p.find(E=>E.payloadType===_.payloadType&&!!E.rtcpFeedbacks.find(y=>"transport-cc"===y.type)))).forEach(p=>{p.rtcpFeedbacks.find(m=>"transport-cc"===m.type)||p.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(!1===n.twcc){const d=o.attributes.extmaps.findIndex(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);-1!==d&&o.attributes.extmaps.splice(d,1),o.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>"transport-cc"===m.type);-1!==p&&h.rtcpFeedbacks.splice(p,1)})}var p,m;if(!0===n.remb){const d=s.find(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);d&&(o.attributes.extmaps.find(p=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===p.extensionName)||o.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(p,m){return m.filter(_=>!!p.find(E=>E.payloadType===_.payloadType&&!!E.rtcpFeedbacks.find(y=>"goog-remb"===y.type)))}(c,o.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(m=>"goog-remb"===m.type)||p.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(!1===n.remb){const d=o.attributes.extmaps.findIndex(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);-1!==d&&o.attributes.extmaps.splice(d,1),o.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>"goog-remb"===m.type);-1!==p&&h.rtcpFeedbacks.splice(p,1)})}}function Nh(o,n,i){if(zt()||"video"!==o.media.mediaType||!(n instanceof We)||"vp9"!==i&&"vp8"!==i||"vp8"===i&&!B("SIMULCAST")||void 0===n._scalabilityMode||n._scalabilityMode.numSpatialLayers<=1)return;const s="vp8"===i?2:n._scalabilityMode.numSpatialLayers,c=o.attributes.ssrcs[0],d=o.attributes.ssrcGroups.find(p=>"FID"===p.semantic&&p.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let p=1;p<s;p++)o.attributes.ssrcs.push({ssrcId:c.ssrcId+p,attributes:mn(c.attributes)}),h.ssrcIds.push(c.ssrcId+p),d&&(o.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+p,attributes:mn(c.attributes)}),o.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+p,d.ssrcIds[1]+p]}));o.attributes.ssrcGroups.unshift(h)}function Kb(){return qE.apply(this,arguments)}function qE(){return qE=x(function*(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{filterRTX:i,filterVideoFec:s,filterAudioFec:c,filterAudioCodec:d,filterVideoCodec:h}=o,{useXR:p}=n,m=new RTCPeerConnection;m.addTransceiver("video",{direction:"sendonly"}),m.addTransceiver("audio",{direction:"sendonly"}),m.addTransceiver("video",{direction:"recvonly"}),m.addTransceiver("audio",{direction:"recvonly"});const _=(yield m.createOffer()).sdp,E=Gb(_,{filterRTX:i,filterVideoFec:s,filterAudioFec:c,filterAudioCodec:d,filterVideoCodec:h},{useXR:p},"sendonly"),y=Gb(_,{filterRTX:i,filterVideoFec:s,filterAudioFec:c,filterAudioCodec:d,filterVideoCodec:h},{useXR:p},"recvonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(um(E,y,"videoExtensions",S,T,O),um(E,y,"videoCodecs",S,T,O),um(E,y,"audioExtensions",S,T,O),um(E,y,"audioCodecs",S,T,O),B("RAISE_H264_BASELINE_PRIORITY")){const N=O.videoCodecs.findIndex(w=>{var k,V;return"h264"===(null===(k=w.rtpMap)||void 0===k?void 0:k.encodingName.toLocaleLowerCase())&&"42001f"===(null===(V=w.fmtp)||void 0===V?void 0:V.parameters["profile-level-id"])});if(-1!==N){const w=O.videoCodecs.findIndex(k=>{var V;return"h264"===(null===(V=k.rtpMap)||void 0===V?void 0:V.encodingName.toLocaleLowerCase())});if(w<N){I.debug("raising H264 baseline profile priority");const k=O.videoCodecs[N];O.videoCodecs.splice(N,1),O.videoCodecs.splice(w,0,k)}-1!==w&&(T.videoCodecs=T.videoCodecs.filter(k=>{var V,U;return!("h264"===(null===(V=k.rtpMap)||void 0===V?void 0:V.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(U=k.fmtp)||void 0===U?void 0:U.parameters["profile-level-id"]))})),-1!==w&&B("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(k=>{var V,U;return!("h264"===(null===(V=k.rtpMap)||void 0===V?void 0:V.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(U=k.fmtp)||void 0===U?void 0:U.parameters["profile-level-id"]))}))}}try{m.close()}catch{}return{send:S,recv:T,sendrecv:O}}),qE.apply(this,arguments)}function um(o,n,i,s,c,d){if("videoExtensions"===i||"audioExtensions"===i){const h=[];return o[i].forEach(p=>{n[i].some((m,_)=>{if(p.entry===m.entry&&p.extensionName===m.extensionName)return h.push(_),!0})?d[i].push(p):s[i].push(p)}),void n[i].forEach((p,m)=>{-1===h.indexOf(m)&&c[i].push(p)})}if("videoCodecs"===i||"audioCodecs"===i){const h=[];return o[i].forEach(p=>{n[i].some((m,_)=>{if(p.payloadType===m.payloadType&&JSON.stringify(p)===JSON.stringify(m))return h.push(_),!0})?d[i].push(p):s[i].push(p)}),void n[i].forEach((p,m)=>{-1===h.indexOf(m)&&c[i].push(p)})}}function Sr(o){const{send:n,recv:i,sendrecv:s}=o;if(!s){if(!n||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:n,recv:i}}let c,d;return n?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...n.audioCodecs,...s.audioCodecs],c.videoCodecs=[...n.videoCodecs,...s.videoCodecs],c.audioExtensions=[...n.audioExtensions,...s.audioExtensions],c.videoExtensions=[...n.videoExtensions,...s.videoExtensions]):c=s,i?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...i.audioCodecs,...s.audioCodecs],d.videoCodecs=[...i.videoCodecs,...s.videoCodecs],d.audioExtensions=[...i.audioExtensions,...s.audioExtensions],d.videoExtensions=[...i.videoExtensions,...s.videoExtensions]):d=s,{send:c,recv:d}}function Br(o){"audio"===o.media.mediaType&&o.attributes.payloads.filter(n=>{var i;return"opus"===(null===(i=n.rtpMap)||void 0===i?void 0:i.encodingName.toLowerCase())}).forEach(n=>{n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"})}function hm(o){o.mediaDescriptions.forEach(n=>{"video"!==n.media.mediaType&&"audio"!==n.media.mediaType||n.attributes.payloads.forEach(i=>{-1===i.rtcpFeedbacks.findIndex(s=>"rrtr"===s.type)&&i.rtcpFeedbacks.push({type:"rrtr"})})})}function ux(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function hx(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?ux(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):ux(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function Jo(o){if(Array.isArray(o))return o.map(i=>i);if(!qb(o))return o;const n={};for(const i in o){const s=o[i];n[i]=qb(s)||Array.isArray(s)?Jo(s):s}return n}function qb(o){return!("object"!=typeof o||Array.isArray(o)||!o)}class pm{constructor(n){C(this,"input",[]),C(this,"size",void 0),this.size=n}add(n){this.input.push(n),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Qo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},fm={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Qo,remoteCandidate:Qo}},YE={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},hO={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},px={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},fx={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function mx(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function _x(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?mx(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):mx(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class pO{constructor(n,i){var s=this;C(this,"onFirstVideoReceived",void 0),C(this,"onFirstVideoDecoded",void 0),C(this,"onFirstAudioReceived",void 0),C(this,"onFirstVideoDecodedTimeout",void 0),C(this,"onFirstAudioDecoded",void 0),C(this,"onSelectedLocalCandidateChanged",void 0),C(this,"onSelectedRemoteCandidateChanged",void 0),C(this,"videoIsReady",!1),C(this,"videoIsReady2",{}),C(this,"pc",void 0),C(this,"options",void 0),C(this,"intervalTimer",void 0),C(this,"stats",Jo(fm)),C(this,"isFirstVideoReceived",{}),C(this,"isFirstVideoDecoded",{}),C(this,"isFirstAudioReceived",{}),C(this,"isFirstAudioDecoded",{}),C(this,"isFirstVideoDecodedTimeout",{}),C(this,"lossRateWindowStats",[]),this.pc=n,this.options=i,this.intervalTimer=window.setInterval(x(function*(){s.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new z(n=>{n({local:_x({},Qo),remote:_x({},Qo)})})}setVideoIsReady(n){this.videoIsReady=n}setVideoIsReady2(n,i){this.videoIsReady2[n]=i}getVideoIsReady(n){return this.videoIsReady2[n]||!1}setIsFirstAudioDecoded(n){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(n){this.lossRateWindowStats.push(n),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const i=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let c=0,d=0,h=0,p=0;for(const m of s)n[m].forEach((_,E)=>{if(!this.lossRateWindowStats[i-1][m][E]||!this.lossRateWindowStats[0][m][E])return;const y=this.lossRateWindowStats[i-1][m][E].packets-this.lossRateWindowStats[0][m][E].packets,S=this.lossRateWindowStats[i-1][m][E].packetsLost-this.lossRateWindowStats[0][m][E].packetsLost;"videoSend"===m||"audioSend"===m?(c+=y,h+=S):(d+=y,p+=S),_.packetLostRate=Number.isNaN(y)||Number.isNaN(y)||y<=0||S<=0?0:S/(y+S)});n.sendPacketLossRate=c<=0||h<=0?0:h/(c+h),n.recvPacketLossRate=d<=0||p<=0?0:p/(d+p)}}function gx(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function hV(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?gx(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):gx(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class Ex extends pO{constructor(){super(...arguments),C(this,"_stats",fm),C(this,"lastDecodeVideoReceiverStats",new Map)}updateStats(){var n=this;return x(function*(){const i=yield n._getStats(),s=n.statsResponsesToObjects(i);n._stats=Jo(fm);const c=s.filter(h=>"ssrc"===h.type);n.processSSRCStats(c);const d=s.find(h=>"VideoBwe"===h.type);d&&n.processBandwidthStats(d),n._stats.timestamp=Date.now(),n.calcLossRate(n._stats),n.stats=n._stats})()}processBandwidthStats(n){this._stats.bitrate={actualEncoded:Number(n.googActualEncBitrate),targetEncoded:Number(n.googTargetEncBitrate),retransmit:Number(n.googRetransmitBitrate),transmit:Number(n.googTransmitBitrate)},this._stats.sendBandwidth=Number(n.googAvailableSendBandwidth)}processSSRCStats(n){n.forEach(i=>{var s;const c=be(s=i.id).call(s,"send");switch("".concat(i.mediaType,"_").concat(c?"send":"recv")){case"video_send":{const d=Jo(hO);d.codec=i.googCodecName,d.adaptionChangeReason="none",i.googCpuLimitedResolution&&(d.adaptionChangeReason="cpu"),i.googBandwidthLimitedResolution&&(d.adaptionChangeReason="bandwidth"),d.avgEncodeMs=Number(i.googAvgEncodeMs),d.inputFrame={width:Number(i.googFrameWidthInput)||Number(i.googFrameWidthSent),height:Number(i.googFrameHeightInput)||Number(i.googFrameHeightSent),frameRate:Number(i.googFrameRateInput)},d.sentFrame={width:Number(i.googFrameWidthSent),height:Number(i.googFrameHeightSent),frameRate:Number(i.googFrameRateInput)},d.firsCount=Number(i.googFirReceived),d.nacksCount=Number(i.googNacksReceived),d.plisCount=Number(i.googPlisReceived),d.frameCount=Number(i.framesEncoded),d.bytes=Number(i.bytesSent),d.packets=Number(i.packetsSent),d.packetsLost=Number(i.packetsLost),d.ssrc=Number(i.ssrc),d.rttMs=Number(i.googRtt||0),this._stats.videoSend.push(d),this._stats.rtt=d.rttMs;break}case"video_recv":{const d=Jo(YE),h=this.lastDecodeVideoReceiverStats.get(Number(i.ssrc));if(d.codec=i.googCodecName,d.targetDelayMs=Number(i.googTargetDelayMs),d.renderDelayMs=Number(i.googRenderDelayMs),d.currentDelayMs=Number(i.googCurrentDelayMs),d.minPlayoutDelayMs=Number(i.googMinPlayoutDelayMs),d.decodeMs=Number(i.googDecodeMs),d.maxDecodeMs=Number(i.googMaxDecodeMs),d.receivedFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateReceived)},d.decodedFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateDecoded)},d.decodeFrameRate=Number(i.googFrameRateDecoded),d.outputFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateOutput)},d.jitterBufferMs=Number(i.googJitterBufferMs),d.firsCount=Number(i.googFirsSent),d.nacksCount=Number(i.googNacksSent),d.plisCount=Number(i.googPlisSent),d.framesDecodeCount=Number(i.framesDecoded),d.bytes=Number(i.bytesReceived),d.packets=Number(i.packetsReceived),d.packetsLost=Number(i.packetsLost),d.ssrc=Number(i.ssrc),d.packets>0&&!this.isFirstVideoReceived[d.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(d.ssrc),this.isFirstVideoReceived[d.ssrc]=!0),d.framesDecodeCount>0&&!this.isFirstVideoDecoded[d.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(d.ssrc,d.decodedFrame.width,d.decodedFrame.height),this.isFirstVideoDecoded[d.ssrc]=!0),h){const p=h.stats,m=Date.now()-h.lts;d.framesDecodeFreezeTime=p.framesDecodeFreezeTime,d.framesDecodeInterval=p.framesDecodeInterval,d.framesDecodeCount>p.framesDecodeCount&&this.isFirstVideoDecoded[d.ssrc]?(h.lts=Date.now(),d.framesDecodeInterval=m,d.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(i.ssrc,10))?d.framesDecodeFreezeTime+=d.framesDecodeInterval:this.setVideoIsReady2(parseInt(i.ssrc,10),!0))):d.framesDecodeCount<h.stats.framesDecodeCount&&(d.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(d.ssrc,{stats:hV({},d),lts:Date.now()}),this._stats.videoRecv.push(d);break}case"audio_recv":{const d=Jo(fx);d.codec=i.googCodecName,d.outputLevel=Math.abs(Number(i.audioOutputLevel))/32767,d.decodingCNG=Number(i.googDecodingCNG),d.decodingCTN=Number(i.googDecodingCTN),d.decodingCTSG=Number(i.googDecodingCTSG),d.decodingNormal=Number(i.googDecodingNormal),d.decodingPLC=Number(i.googDecodingPLC),d.decodingPLCCNG=Number(i.googDecodingPLCCNG),d.expandRate=Number(i.googExpandRate),d.accelerateRate=Number(i.googAccelerateRate),d.preemptiveExpandRate=Number(i.googPreemptiveExpandRate),d.secondaryDecodedRate=Number(i.googSecondaryDecodedRate),d.speechExpandRate=Number(i.googSpeechExpandRate),d.preferredJitterBufferMs=Number(i.googPreferredJitterBufferMs),d.jitterBufferMs=Number(i.googJitterBufferMs),d.jitterMs=Number(i.googJitterReceived),d.bytes=Number(i.bytesReceived),d.packets=Number(i.packetsReceived),d.packetsLost=Number(i.packetsLost),d.ssrc=Number(i.ssrc),d.receivedFrames=Number(i.googDecodingCTN)||Number(i.packetsReceived),d.droppedFrames=Number(i.googDecodingPLC)+Number(i.googDecodingPLCCNG)||Number(i.packetsLost),d.receivedFrames>0&&!this.isFirstAudioReceived[d.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(d.ssrc),this.isFirstAudioReceived[d.ssrc]=!0),d.decodingNormal>0&&!this.isFirstAudioDecoded[d.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(d.ssrc),this.isFirstAudioDecoded[d.ssrc]=!0),this._stats.audioRecv.push(d);break}case"audio_send":{const d=Jo(px);d.codec=i.googCodecName,d.inputLevel=Math.abs(Number(i.audioInputLevel))/32767,d.aecReturnLoss=Number(i.googEchoCancellationReturnLoss||0),d.aecReturnLossEnhancement=Number(i.googEchoCancellationReturnLossEnhancement||0),d.residualEchoLikelihood=Number(i.googResidualEchoLikelihood||0),d.residualEchoLikelihoodRecentMax=Number(i.googResidualEchoLikelihoodRecentMax||0),d.bytes=Number(i.bytesSent),d.packets=Number(i.packetsSent),d.packetsLost=Number(i.packetsLost),d.ssrc=Number(i.ssrc),d.rttMs=Number(i.googRtt||0),this._stats.rtt=d.rttMs,this._stats.audioSend.push(d);break}}})}_getStats(){return new z((n,i)=>{this.pc.getStats(n,i)})}statsResponsesToObjects(n){const i=[];return n.result().forEach(s=>{const c={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(d=>{c[d]=s.stat(d)}),i.push(c)}),i}}function Yb(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Vd(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?Yb(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Yb(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class fO extends pO{constructor(){super(...arguments),C(this,"_stats",fm),C(this,"report",void 0),C(this,"lastDecodeVideoReceiverStats",new Map),C(this,"lastVideoFramesRecv",new Map),C(this,"lastVideoFramesSent",new Map),C(this,"lastVideoFramesDecode",new Map),C(this,"lastVideoJBDelay",new Map),C(this,"lastAudioJBDelay",new Map),C(this,"mediaBytesSent",new Map),C(this,"mediaBytesRetransmit",new Map),C(this,"mediaBytesTargetEncode",new Map),C(this,"lastEncoderMs",new Map)}updateStats(){var n=this;return x(function*(){n.report=yield n.pc.getStats(),n._stats=Jo(fm),n.report.forEach(i=>{switch(i.type){case xr.OUTBOUND:case xr.INBOUND:{const s=i.mediaType||i.kind,c=!s&&"frameWidth"in i,d=!s&&!("frameWidth"in i);i.type===xr.OUTBOUND?"audio"===s||d?n.processAudioOutboundStats(i):("video"===s||c)&&n.processVideoOutboundStats(i):i.type===xr.INBOUND&&("audio"===s||d?n.processAudioInboundStats(i):("video"===s||c)&&n.processVideoInboundStats(i));break}case xr.TRANSPORT:{const s=n.report.get(i.selectedCandidatePairId);s&&n.processCandidatePairStats(s);break}case xr.CANDIDATE_PAIR:i.selected&&n.processCandidatePairStats(i)}}),n.updateSendBitrate(),n._stats.timestamp=Date.now(),n.calcLossRate(n._stats),n.stats=n._stats})()}getSelectedCandidatePair(){var n=this;return x(function*(){const i=yield n.pc.getStats(),s={local:Vd({},Qo),remote:Vd({},Qo)};return i.forEach(c=>{let d;if(c.type===xr.TRANSPORT&&(d=i.get(c.selectedCandidatePairId)),c.type===xr.CANDIDATE_PAIR&&c.selected&&(d=c),d){const h=(p,m)=>{p.type=m.type,p.id=m.id,m.address&&(p.address=m.address),m.candidateType&&(p.candidateType=m.candidateType),m.port&&(p.port=m.port),m.priority&&(p.priority=m.priority),m.protocol&&(p.protocol=m.protocol),m.relayProtocol&&(p.relayProtocol=m.relayProtocol)};if(d.localCandidateId){const p=i.get(d.localCandidateId);p&&h(s.local,p)}if(d.remoteCandidateId){const p=i.get(d.remoteCandidateId);p&&h(s.remote,p)}}}),s})()}processCandidatePairStats(n){if(this._stats.sendBandwidth=n.availableOutgoingBitrate||0,n.currentRoundTripTime&&(this._stats.rtt=1e3*n.currentRoundTripTime),this._stats.videoSend.forEach(i=>{n.currentRoundTripTime&&(i.rttMs=1e3*n.currentRoundTripTime)}),this._stats.audioSend.forEach(i=>{n.currentRoundTripTime&&(i.rttMs=1e3*n.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=n.id,n.localCandidateId){const i=this.report.get(n.localCandidateId);i&&this.processCandidateStats(i)}if(n.remoteCandidateId){const i=this.report.get(n.remoteCandidateId);i&&this.processCandidateStats(i)}}processCandidateStats(n){let i;n.type===xr.LOCAL_CANDIDATE&&(i=this._stats.selectedCandidatePair.localCandidate),n.type===xr.REMOTE_CANDIDATE&&(i=this._stats.selectedCandidatePair.remoteCandidate),i&&(i.type=n.type,i.id=n.id,n.address&&(i.address=n.address),n.candidateType&&(i.candidateType=n.candidateType),n.port&&(i.port=n.port),n.priority&&(i.priority=n.priority),n.protocol&&(i.protocol=n.protocol),n.relayProtocol&&(i.relayProtocol=n.relayProtocol),n.type===xr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==i.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Vd({},i),Vd({},this.stats.selectedCandidatePair.localCandidate)),n.type===xr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==i.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Vd({},i),Vd({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(n){let i=this._stats.audioRecv.find(s=>s.ssrc===n.ssrc);i||(i=Jo(fx),this._stats.audioRecv.push(i)),i.ssrc=n.ssrc,i.packets=n.packetsReceived,i.packetsLost=n.packetsLost,i.bytes=n.bytesReceived,i.jitterMs=1e3*n.jitter,this.processAudioTrackReceiverStats(n,n.trackId,i),n.codecId&&(i.codec=this.getCodecFromCodecStats(n.codecId)),i.receivedFrames||(i.receivedFrames=n.packetsReceived),i.droppedFrames||(i.droppedFrames=n.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.outputLevel&&i.outputLevel>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),"number"==typeof n.concealedSamples&&(i.concealedSamples=n.concealedSamples)}processVideoInboundStats(n){let i=this._stats.videoRecv.find(h=>h.ssrc===n.ssrc);i||(i=Jo(YE),this._stats.videoRecv.push(i)),i.ssrc=n.ssrc,i.packets=n.packetsReceived,i.packetsLost=n.packetsLost,i.bytes=n.bytesReceived,i.firsCount=n.firCount,i.nacksCount=n.nackCount,i.plisCount=n.pliCount,i.framesDecodeCount=n.framesDecoded,i.totalInterFrameDelay=n.totalInterFrameDelay,i.totalSquaredInterFrameDelay=n.totalSquaredInterFrameDelay;const s=this.lastDecodeVideoReceiverStats.get(i.ssrc),c=this.lastVideoFramesDecode.get(i.ssrc),d=Date.now();if(i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]){const h=i.decodedFrame?i.decodedFrame.width:0,p=i.decodedFrame?i.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,h,p),this.isFirstVideoDecoded[i.ssrc]=!0}if(s){const h=s.stats,p=d-s.lts;i.framesDecodeFreezeTime=h.framesDecodeFreezeTime,i.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[i.ssrc]&&p>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[i.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(i.ssrc),this.isFirstVideoDecodedTimeout[i.ssrc]=!0),i.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(s.lts=Date.now(),i.framesDecodeInterval=p,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):i.framesDecodeCount<h.framesDecodeCount&&(i.framesDecodeInterval=0),n.framesDecoded&&n.qpSum&&(i.qpSumPerFrame=s.stats.framesDecodeCount>n.framesDecoded?n.qpSum/n.framesDecoded:(n.qpSum-s.qpSum)/(n.framesDecoded-s.stats.framesDecodeCount))}c&&d-c.lts>=800?(i.decodeFrameRate=Math.round((i.framesDecodeCount-c.count)/((d-c.lts)/1e3)),this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:d,rate:i.decodeFrameRate})):c?i.decodeFrameRate=c.rate:this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:d,rate:0}),n.totalDecodeTime&&(i.decodeMs=1e3*n.totalDecodeTime),this.processVideoTrackReceiverStats(n,n.trackId,i),n.codecId&&(i.codec=this.getCodecFromCodecStats(n.codecId)),n.framerateMean&&(i.framesRateFirefox=n.framerateMean),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:Vd({},i),lts:s?s.lts:Date.now(),qpSum:n.qpSum})}processVideoOutboundStats(n){let i=this._stats.videoSend.find(c=>c.ssrc===n.ssrc);i||(i=Jo(hO),this._stats.videoSend.push(i));const s=this.mediaBytesSent.get(n.ssrc);if(s)s.add(n.bytesSent);else{const c=new pm(10);c.add(n.bytesSent),this.mediaBytesSent.set(n.ssrc,c)}if(void 0!==n.retransmittedBytesSent){const c=this.mediaBytesRetransmit.get(n.ssrc);if(c)c.add(n.retransmittedBytesSent);else{const d=new pm(10);d.add(n.retransmittedBytesSent),this.mediaBytesRetransmit.set(n.ssrc,d)}}if(n.totalEncodedBytesTarget){const c=this.mediaBytesTargetEncode.get(n.ssrc);if(c)c.add(n.totalEncodedBytesTarget);else{const d=new pm(10);d.add(n.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(n.ssrc,d)}}if(i.ssrc=n.ssrc,i.bytes=n.bytesSent,i.packets=n.packetsSent,i.firsCount=n.firCount,i.nacksCount=n.nackCount,i.plisCount=n.pliCount,i.frameCount=n.framesEncoded,i.adaptionChangeReason=n.qualityLimitationReason,i.scalabilityMode=n.scalabilityMode,n.totalEncodeTime&&n.framesEncoded){const c=this.lastEncoderMs.get(n.ssrc);i.avgEncodeMs=!c||c.lastFrameCount>n.framesEncoded?1e3*n.totalEncodeTime/n.framesEncoded:1e3*(n.totalEncodeTime-c.lastEncoderTime)/(n.framesEncoded-c.lastFrameCount)}if(n.framesEncoded&&n.qpSum){const c=this.lastEncoderMs.get(n.ssrc);i.qpSumPerFrame=!c||c.lastFrameCount>n.framesEncoded?n.qpSum/n.framesEncoded:(n.qpSum-c.lastQpSum)/(n.framesEncoded-c.lastFrameCount)}if(this.lastEncoderMs.set(n.ssrc,{lastFrameCount:n.framesEncoded,lastEncoderTime:n.totalEncodeTime,lastQpSum:n.qpSum,lts:Date.now()}),n.codecId&&(i.codec=this.getCodecFromCodecStats(n.codecId)),n.mediaSourceId&&this.processVideoMediaSource(n.mediaSourceId,i),this.processVideoTrackSenderStats(n,n.trackId,i),n.remoteId)this.processRemoteInboundStats(n.remoteId,i);else{const c=this.findRemoteStatsId(n.ssrc,xr.REMOTE_INBOUND);c&&this.processRemoteInboundStats(c,i)}}processAudioOutboundStats(n){let i=this._stats.audioSend.find(s=>s.ssrc===n.ssrc);if(i||(i=Jo(px),this._stats.audioSend.push(i)),i.ssrc=n.ssrc,i.packets=n.packetsSent,i.bytes=n.bytesSent,n.mediaSourceId&&this.processAudioMediaSource(n.mediaSourceId,i),n.codecId&&(i.codec=this.getCodecFromCodecStats(n.codecId)),this.processAudioTrackSenderStats(n,n.trackId,i),n.remoteId)this.processRemoteInboundStats(n.remoteId,i);else{const s=this.findRemoteStatsId(n.ssrc,xr.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,i)}}findRemoteStatsId(n,i){var s;const c=Array.from(vc(s=this.report).call(s)).find(d=>d.type===i&&d.ssrc===n);return c?c.id:null}processVideoMediaSource(n,i){const s=this.report.get(n);s&&s.width&&s.height&&s.framesPerSecond&&(i.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(n,i){const s=this.report.get(n);s&&(i.inputLevel=s.audioLevel)}processVideoTrackSenderStats(n,i,s){var c,d,h,p;const m=i?this.report.get(i):void 0,_=null!==(c=m?.framesSent)&&void 0!==c?c:n.framesSent;if("number"!=typeof _)return;let E=null!==(d=m?.frameWidth)&&void 0!==d?d:n.frameWidth,y=null!==(h=m?.frameHeight)&&void 0!==h?h:n.frameHeight,S=null!==(p=m?.framesPerSecond)&&void 0!==p?p:n.framesPerSecond;if("number"==typeof E&&"number"==typeof y||(E=0,y=0),null==S){const T=Date.now(),O=this.lastVideoFramesSent.get(s.ssrc);O&&T-O.lts>=800?(S=Math.round((_-O.count)/((T-O.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:_,lts:T,rate:S})):O?S=O.rate:this.lastVideoFramesSent.set(s.ssrc,{count:_,lts:T,rate:0})}s.sentFrame={width:E,height:y,frameRate:Math.max(0,S)}}processVideoTrackReceiverStats(n,i,s){var c,d,h,p,m;const _=i?this.report.get(i):void 0,E=null!==(c=_?.framesReceived)&&void 0!==c?c:n.framesReceived,y=null!==(d=_?.frameWidth)&&void 0!==d?d:n.frameWidth,S=null!==(h=_?.frameHeight)&&void 0!==h?h:n.frameHeight,T=null!==(p=_?.jitterBufferDelay)&&void 0!==p?p:n.jitterBufferDelay,O=null!==(m=_?.jitterBufferEmittedCount)&&void 0!==m?m:n.jitterBufferEmittedCount;if("number"==typeof E){const N=this.lastVideoFramesRecv.get(s.ssrc),w=Date.now();s.framesReceivedCount=E;let k=0;N&&w-N.lts>=800?(k=Math.round((E-N.count)/((w-N.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:w,rate:k})):N?k=N.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:w,rate:0}),s.receivedFrame={width:y||0,height:S||0,frameRate:k||0},s.decodedFrame={width:y||0,height:S||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:y||0,height:S||0,frameRate:s.decodeFrameRate||0}}if(T&&O){const N=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let w=N.jitterBufferMs;const k=O-N.jitterBufferEmittedCount;k>0&&(w=1e3*(T-N.jitterBufferDelay)/k),s.jitterBufferMs=w,s.currentDelayMs=Math.round(w),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:T,jitterBufferEmittedCount:O,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(n,i,s){var c,d,h,p;const m=i?this.report.get(i):void 0,_=null!==(c=null!==(d=m?.echoReturnLoss)&&void 0!==d?d:n.echoReturnLoss)&&void 0!==c?c:0,E=null!==(h=null!==(p=m?.echoReturnLossEnhancement)&&void 0!==p?p:n.echoReturnLossEnhancement)&&void 0!==h?h:0;s.aecReturnLoss=_,s.aecReturnLossEnhancement=E}processAudioTrackReceiverStats(n,i,s){var c,d,h,p,m,_,E;const y=i?this.report.get(i):void 0,S=null!==(c=y?.removedSamplesForAcceleration)&&void 0!==c?c:n.removedSamplesForAcceleration,T=null!==(d=y?.totalSamplesReceived)&&void 0!==d?d:n.totalSamplesReceived,O=null!==(h=y?.jitterBufferDelay)&&void 0!==h?h:n.jitterBufferDelay,N=null!==(p=y?.jitterBufferEmittedCount)&&void 0!==p?p:n.jitterBufferEmittedCount,w=null!==(m=y?.audioLevel)&&void 0!==m?m:n?.audioLevel,k=null!==(_=y?.totalSamplesDuration)&&void 0!==_?_:n?.totalSamplesDuration,V=null!==(E=y?.concealedSamples)&&void 0!==E?E:n.concealedSamples;if(S&&T&&(s.accelerateRate=S/T),O&&N){const Y=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let re=Y.jitterBufferMs;const K=N-Y.jitterBufferEmittedCount;K>0&&(re=1e3*(O-Y.jitterBufferDelay)/K),s.jitterBufferMs=Math.round(re),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:O,jitterBufferEmittedCount:N,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=w;let U=1920;k&&T&&(U=T/k/50,s.receivedFrames=Math.round(T/U)),V&&(s.droppedFrames=Math.round(V/U))}processRemoteInboundStats(n,i){const s=this.report.get(n);s&&(i.packetsLost=s.packetsLost,s.roundTripTime&&(i.rttMs=1e3*s.roundTripTime),s.jitter&&(i.jitterMs=1e3*s.jitter),s.timestamp&&(i.timestamp=s.timestamp))}getCodecFromCodecStats(n){const i=this.report.get(n);if(!i)return"";const s=i.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let n=0,i=null,s=null;this.mediaBytesSent.forEach(d=>{n+=d.diffMean()}),this.mediaBytesRetransmit.forEach(d=>{i=null===i?d.diffMean():i+d.diffMean()}),this.mediaBytesTargetEncode.forEach(d=>{s=null===s?d.diffMean():s+d.diffMean()}),this._stats.bitrate={actualEncoded:8*(null!==i?n-i:n)/(this.options.updateInterval/1e3),transmit:8*n/(this.options.updateInterval/1e3)},null!==i&&(this._stats.bitrate.retransmit=8*i/(this.options.updateInterval/1e3)),null!==s&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}}class yx extends pO{updateStats(){return z.resolve()}}function Ph(o){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const d=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new Ex(o,{updateInterval:n,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new fO(o,{updateInterval:n,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):(h=o,window.RTCStatsReport&&h.getStats()instanceof z?new fO(o,{updateInterval:n,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new yx(o,{updateInterval:n,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}));var h}function Mh(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function mm(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?Mh(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Mh(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class kn extends $s{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(n,i){super(n,i),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"statsFilter",void 0),C(this,"useRTX",!1),C(this,"localCapabilities",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"establishPromise",void 0),C(this,"mutex",new li("P2PConnection-mutex")),this.store=i,this.peerConnection=new RTCPeerConnection(kn.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.statsFilter=Ph(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,zt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){var n=this;return x(function*(){try{const i=yield n.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=gl(i.sdp),c=Gb(i.sdp,{filterRTX:!n.useRTX,filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return n.localCapabilities=c,n.initialOffer=i,mm(mm({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:c},offerSDP:i.sdp})}catch(i){throw new Q(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}})()}connect(n,i,s,c,d,h){var p=this;return x(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");p.remoteSDP=new class{constructor(_){C(this,"sessionDesc",void 0),C(this,"localCapabilities",void 0),C(this,"rtpCapabilities",void 0),C(this,"candidates",void 0),C(this,"iceParameters",void 0),C(this,"dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),_=mn(_);const{remoteIceParameters:E,remoteDtlsParameters:y,candidates:S,remoteRTPCapabilities:T,remoteSetup:O,localCapabilities:N,cname:k}=_,V=En.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=T,this.candidates=S,this.iceParameters=E,this.dtlsParameters=y,this.setup=O,this.localCapabilities=N,this.cname=k;for(let U=0;U<V.mediaDescriptions.length;U++){const Y=V.mediaDescriptions[U];Y.attributes.iceUfrag=E.iceUfrag,Y.attributes.icePwd=E.icePwd,Y.attributes.fingerprints=y.fingerprints,Y.attributes.candidates=S,Y.attributes.setup=O,"video"===Y.media.mediaType&&(Y.media.fmts=T.videoCodecs.map(re=>re.payloadType.toString(10)),Y.attributes.payloads=T.videoCodecs,Y.attributes.extmaps=T.videoExtensions),"audio"===Y.media.mediaType&&(Y.media.fmts=T.audioCodecs.map(re=>re.payloadType.toString(10)),Y.attributes.payloads=T.audioCodecs,Y.attributes.extmaps=T.audioExtensions),V.mediaDescriptions[U]=this.mungMediaDesc(Y)}this.sessionDesc=V,this.currentMidIndex=V.mediaDescriptions.length-1}toString(){return En.print(this.sessionDesc)}send(_,E,y){const{ssrcs:S,ssrcGroups:T}=wo(E,this.cname),O=this.sessionDesc.mediaDescriptions.find(k=>_===_e.VIDEO?"video"===k.media.mediaType:"audio"===k.media.mediaType),N=S[0].attributes.label,w=S[0].attributes.mslabel;return O.attributes.ssrcs=O.attributes.ssrcs.concat(S),O.attributes.ssrcGroups=O.attributes.ssrcGroups.concat(T),{id:N,mslabel:w}}batchSend(_){return _.map(E=>{let{kind:y,ssrcMsg:S}=E;return this.send(y,S,void 0)})}stopSending(_){this.sessionDesc.mediaDescriptions.forEach(E=>{const y=[],S=[],T=[];E.attributes.ssrcs.forEach(O=>{be(_).call(_,O.attributes.label||"")?T.push(O):y.push(O)}),E.attributes.ssrcGroups.forEach(O=>{var N;be(N=T.map(w=>w.ssrcId)).call(N,O.ssrcIds[0])||S.push(O)}),E.attributes.ssrcs=y,E.attributes.ssrcGroups=S})}mute(_){const E=this.sessionDesc.mediaDescriptions.find(y=>y.attributes.mid===_);if(!E)throw new Error("mediaDescription not found with ".concat(_," in remote SDP when calling RemoteSDP.mute."));E.attributes.direction="inactive"}unmute(_){const E=this.sessionDesc.mediaDescriptions.find(y=>y.attributes.mid===_);if(!E)throw new Error("mediaDescription not found with ".concat(_," in remote SDP when calling RemoteSDP.unmute."));E.attributes.direction="sendonly"}receive(_,E,y){_.forEach((S,T)=>{const O=S._mediaStreamTrack,N=this.sessionDesc.mediaDescriptions.findIndex(k=>k.attributes.mid===O.kind),w=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[N],S);this.sessionDesc.mediaDescriptions[N]=w})}stopReceiving(_){}updateCandidates(_){_===Fi.TCP?this.candidates.forEach(E=>{-1===this.candidates.findIndex(y=>"tcp"===y.transport&&y.connectionAddress===E.connectionAddress&&y.port===E.port)&&this.candidates.push(hx(hx({},E),{},{foundation:"tcpcandidate",priority:Number(E.priority)-1+"",transport:"tcp",port:Number(E.port)+90+""}))}):this.candidates=this.candidates.filter(E=>"tcp"!==E.transport);for(const E of this.sessionDesc.mediaDescriptions)E.attributes.candidates=this.candidates}restartICE(_){_=mn(_),this.iceParameters=_,this.sessionDesc.mediaDescriptions.forEach(E=>{E.attributes.iceUfrag=_.iceUfrag,E.attributes.icePwd=_.icePwd})}predictReceivingMids(_){const E=[];for(let y=0;y<_;y++)E.push((this.currentMidIndex+y+1).toString(10));return E}mungRecvMediaDsec(_,E){const y=mn(_);return Ac(y,E),KE(y,E),y}updateRecvMedia(_,E){const y=this.sessionDesc.mediaDescriptions.findIndex(S=>S.attributes.mid===_);if(-1!==y){const S=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[y],E);this.sessionDesc.mediaDescriptions[y]=S}}bumpMid(_){this.currentMidIndex+=_}updateTrackLabel(_,E,y){const S=this.sessionDesc.mediaDescriptions.find(O=>_===_e.VIDEO?"video"===O.attributes.mid:"audio"===O.attributes.mid);if(S){const O=S.attributes.ssrcs.find(N=>N.attributes.label===E);var T;O&&(O.attributes.label=y,null===(T=O.attributes.msid)||void 0===T||T.replace(E,y))}}mungMediaDesc(_){const E=mn(_);return zE(E),function(y){const S=y.attributes.extmaps.find(T=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===T.extensionName);S&&y.attributes.extmaps.splice(y.attributes.extmaps.indexOf(S),1),y.attributes.payloads.forEach(T=>{const O=T.rtcpFeedbacks.findIndex(N=>"transport-cc"===N.type);-1!==O&&T.rtcpFeedbacks.splice(O,1)})}(E),E}getSSRC(_){for(const E of this.sessionDesc.mediaDescriptions)for(const y of E.attributes.ssrcs)if(y.attributes.label===_)return[y]}}({remoteIceParameters:n,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:c.send,remoteSetup:d,localCapabilities:p.localCapabilities,sdkCodec:p.store.codec,cname:h});const m=p.remoteSDP.toString();yield p.peerConnection.setLocalDescription(p.initialOffer),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}})()}send(n,i){var s=this;return Ro(function*(){const c=yield lt(s.mutex.lock());try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=n.map(S=>s.peerConnection.addTrack(S._mediaStreamTrack)),h=yield lt(s.peerConnection.createOffer()),p=En.parse(h.sdp),m=n.map(S=>{const T=S._mediaStreamTrack,O=p.mediaDescriptions.find(N=>N.attributes.mid===T.kind);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return function(N,w,k){const V=N.attributes.ssrcs.filter(Y=>Y.attributes.label===w),U=N.attributes.ssrcGroups;if(0===V.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(U&&V.length>1){const Y=U.find(re=>-1!==re.ssrcIds.indexOf(V[0].ssrcId));return Y?[{ssrcId:Y.ssrcIds[0],rtx:k?Y.ssrcIds[1]:void 0}]:[{ssrcId:V[0].ssrcId}]}return[{ssrcId:V[0].ssrcId}]}(O,T.id,s.useRTX)});let _;try{_=yield m}catch(S){throw d.forEach(T=>{nr()&&T.replaceTrack(null),s.peerConnection.removeTrack(T)}),S}const E=s.mungSendOfferSDP(h.sdp,n);s.remoteSDP.receive(n,i,_);const y=s.remoteSDP.toString();return yield lt(s.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield lt(s.applySendEncodings(d,n)),yield lt(s.peerConnection.setRemoteDescription({type:"answer",sdp:y})),n.map((S,T)=>({localSSRC:m[T],id:S._mediaStreamTrack.id}))}catch(d){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}stopSending(n){var i=this;return x(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=i.peerConnection.getSenders().filter(h=>{var p;return-1!==n.indexOf((null===(p=h.track)||void 0===p?void 0:p.id)||"")});if(s.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(h=>{nr()&&h.replaceTrack(null),i.peerConnection.removeTrack(h)});const c=yield i.peerConnection.createOffer();yield i.peerConnection.setLocalDescription(c),i.remoteSDP.stopReceiving(n);const d=i.remoteSDP.toString();yield i.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}})()}receive(n,i,s,c){var d=this;return x(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{id:h,mslabel:p}=d.remoteSDP.send(n,i,c),m=new z((y,S)=>{const T=setTimeout(()=>{S(new Error("Cannot receive track, id: ".concat(h)))},1e4),O=N=>{const w=Et();if(("Safari"===w.name&&11===Number(w.version)||ir())&&N.track.id!==h&&N.streams[0].id===p){var k;const V=N.streams[0].getTracks()[0];return null===(k=d.remoteSDP)||void 0===k||k.updateTrackLabel(n,h,N.track.id),d.peerConnection.removeEventListener("track",O),clearTimeout(T),void y(V)}if(N.track.id===h)return d.peerConnection.removeEventListener("track",O),clearTimeout(T),void y(N.track)};d.peerConnection.addEventListener("track",O)}),_=d.remoteSDP.toString();yield d.peerConnection.setRemoteDescription({type:"offer",sdp:_});const E=yield d.peerConnection.createAnswer();return yield d.peerConnection.setLocalDescription(E),{track:yield m,id:h}}catch(h){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}stopReceiving(n){var i=this;return x(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");i.remoteSDP.stopSending(n);const s=i.remoteSDP.toString();yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=yield i.peerConnection.createAnswer();yield i.peerConnection.setLocalDescription(c)}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}})()}muteRemote(n){return x(function*(){})()}unmuteRemote(n){return x(function*(){})()}muteLocal(n){var i=this;return x(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=i.peerConnection.getSenders().filter(c=>{var d;return-1!==n.indexOf((null===(d=c.track)||void 0===d?void 0:d.id)||"")});if(s.length!==n.length)throw new Error("sender' length doesn't match mids' length.");s.map(c=>{if(nr()&&c.track)c.track.enabled=!1;else{const d=c.getParameters();d.encodings.forEach(h=>h.active=!1),c.setParameters(d)}})}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}})()}unmuteLocal(n){var i=this;return x(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=i.peerConnection.getSenders().filter(h=>{var p;return-1!==n.indexOf((null===(p=h.track)||void 0===p?void 0:p.id)||"")});if(s.length!==n.length)throw new Error("Senders' length doesn't match mids' length.");s.map(function(){var h=x(function*(p){if(nr()&&p.track)p.track.enabled=!0;else{const m=p.getParameters();m.encodings.forEach(_=>_.active=!0),yield p.setParameters(m)}});return function(p){return h.apply(this,arguments)}}());const c=yield i.peerConnection.createOffer();yield i.peerConnection.setLocalDescription(c);const d=i.remoteSDP.toString();yield i.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}})()}restartICE(n){var i=this;return Ro(function*(){const s=yield lt(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ut().supportPCSetConfiguration){const m=i.peerConnection.getConfiguration(),_=n===Fi.RELAY?"relay":"all";m.iceTransportPolicy!==_&&(I.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(_,"]")),m.iceTransportPolicy=_,i.peerConnection.setConfiguration(m))}else if(n===Fi.RELAY)return;n!==Fi.RELAY&&i.remoteSDP.updateCandidates(n);const c=yield lt(i.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=gl(c.sdp),{remoteIceParameters:h}=yield d.iceParameters;i.remoteSDP.restartICE(h);const p=i.remoteSDP.toString();yield lt(i.peerConnection.setLocalDescription(c)),yield lt(i.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(c){I.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}close(){var n;this.peerConnection.close(),null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}updateEncoderConfig(n,i){var s=this;return x(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const c=yield s.peerConnection.createOffer(),d=s.mungSendOfferSDP(c.sdp,[i]);s.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const h=s.remoteSDP.toString();yield s.peerConnection.setLocalDescription({type:"offer",sdp:d}),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(c){throw new Q(M.EXCHANGE_SDP_FAILED,c.toString())}})()}updateSendParameters(n,i){var s=this;return x(function*(){const c=s.peerConnection.getSenders().filter(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===n});1===c.length&&(yield s.applySendEncodings(c,[i]))})()}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}replaceTrack(n,i){var s=this;return x(function*(){const c=s.peerConnection.getSenders().find(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===i});c&&(yield c.replaceTrack(n._mediaStreamTrack))})()}createDataChannels(n,i){throw new Q(M.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(n){throw new Q(M.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;null===(n=this.onICEConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[],sdpSemantics:"plan-b"};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(hd(n.turnServer.servers)?i.iceServers=n.turnServer.servers:(i.iceServers&&i.iceServers.push(...kn.turnServerConfigToIceServers(n.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...kn.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}updateRtpSenderEncodings(n,i){var s=this;return x(function*(){var c;if(i||(i=s.peerConnection.getSenders().find(E=>{var y;return(null===(y=E.track)||void 0===y?void 0:y.id)===n._mediaStreamTrack.id})),!i)return I.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(!Ut().supportSetRtpSenderParameters)return I.warn("Browser not support set rtp-sender parameters");const d={},h={};if(n instanceof We)switch(n._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(B("DSCP_TYPE")&&pc()){var p;const E=B("DSCP_TYPE");be(p=["very-low","low","medium","high"]).call(p,E)&&(h.networkPriority=E)}const m=i.getParameters(),_=null===(c=m.encodings)||void 0===c?void 0:c[0];_&&Object.assign(_,h),Object.assign(m,d),I.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),yield i.setParameters(m)})()}applySendEncodings(n,i){var s=this;return x(function*(){try{if(!Ut().supportSetRtpSenderParameters||n.length!==i.length)return;for(let c=0;c<n.length;c++){const d=n[c],h=i[c];d&&h&&(yield s.updateRtpSenderEncodings(h,d))}}catch{I.debug("[".concat(s.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(n,i){const s=En.parse(n);return i.forEach((c,d)=>{const h=c._mediaStreamTrack,p=s.mediaDescriptions.find(m=>m.attributes.mid===h.kind);p&&Ac(p,c)}),En.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;null===(i=this.onFirstAudioReceived)||void 0===i||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;null===(i=this.onFirstVideoReceived)||void 0===i||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;null===(i=this.onFirstAudioDecoded)||void 0===i||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,s)=>{var c;null===(c=this.onFirstVideoDecoded)||void 0===c||c.call(this,n,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,n,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}batchReceive(n){var i=this;return x(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=i.remoteSDP.batchSend(n).map((h,p)=>{let{id:m,mslabel:_}=h;const{kind:E}=n[p];return new z((y,S)=>{const T=setTimeout(()=>{S(new Error("Cannot receive track, id: ".concat(m)))},1e4),O=N=>{const w=Et();if("Safari"===w.name&&11===Number(w.version)&&N.track.id!==m&&N.streams[0].id===_){var k;const V=N.streams[0].getTracks()[0];return null===(k=i.remoteSDP)||void 0===k||k.updateTrackLabel(E,m,N.track.id),i.peerConnection.removeEventListener("track",O),clearTimeout(T),void y({track:V,id:m})}if(N.track.id===m)return i.peerConnection.removeEventListener("track",O),clearTimeout(T),void y({track:N.track,id:m})};i.peerConnection.addEventListener("track",O)})}),c=i.remoteSDP.toString();yield i.peerConnection.setRemoteDescription({type:"offer",sdp:c});const d=yield i.peerConnection.createAnswer();return yield i.peerConnection.setLocalDescription(d),yield z.all(s)}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}})()}getRemoteSSRC(n){var i=this;return x(function*(){if(i.remoteSDP)return i.remoteSDP.getSSRC(n)?.[0].ssrcId})()}setConfiguration(n){if(Ut().supportPCSetConfiguration){const i=kn.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}}function Cr(o,n,i){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=x(function*(){const c=this.mutex,d=yield c.lock("Locking from P2PConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),i}function $E(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Dc(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?$E(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):$E(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}te([Cr,P("design:type",Function),P("design:paramtypes",[Object,Object,Array,Object,String,String]),P("design:returntype",z)],kn.prototype,"connect",null),te([Cr,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],kn.prototype,"stopSending",null),te([Cr,P("design:type",Function),P("design:paramtypes",[String,Array,String,Object]),P("design:returntype",z)],kn.prototype,"receive",null),te([Cr,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],kn.prototype,"stopReceiving",null),te([Cr,P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],kn.prototype,"muteRemote",null),te([Cr,P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],kn.prototype,"unmuteRemote",null),te([Cr,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],kn.prototype,"muteLocal",null),te([Cr,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],kn.prototype,"unmuteLocal",null),te([Cr,P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],kn.prototype,"close",null),te([Cr,P("design:type",Function),P("design:paramtypes",[String,wi]),P("design:returntype",z)],kn.prototype,"updateEncoderConfig",null),te([Cr,P("design:type",Function),P("design:paramtypes",[String,wi]),P("design:returntype",z)],kn.prototype,"updateSendParameters",null),te([Cr,P("design:type",Function),P("design:paramtypes",[wi,String]),P("design:returntype",z)],kn.prototype,"replaceTrack",null),te([Cr,P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],kn.prototype,"getRemoteSSRC",null);function _m(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function jd(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?_m(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):_m(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}let si=class KT extends $s{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,i;return null!==(n=null===(i=this.peerConnection.getReceivers()[0])||void 0===i||null===(i=i.transport)||void 0===i?void 0:i.state)&&void 0!==n?n:null}constructor(n,i){super(n,i),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"transportEventReceiver",void 0),C(this,"statsFilter",void 0),C(this,"useXR",B("USE_XR")),C(this,"localCapabilities",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"dataStreamChannelMap",new Map),C(this,"establishPromise",void 0),C(this,"mutex",new li("P2PConnection-mutex")),this.store=i,this.peerConnection=new RTCPeerConnection(KT.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.statsFilter=Ph(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,zt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){var n=this;return x(function*(){try{n.peerConnection.addTransceiver("video",{direction:"recvonly"}),n.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=yield n.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=gl(i.sdp),c=yield Kb({filterRTX:!B("USE_PUB_RTX")&&!B("USE_SUB_RTX"),filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC")},{useXR:n.useXR});return n.localCapabilities=Sr(c),n.initialOffer=i,jd(jd({},s),{},{rtpCapabilities:c,offerSDP:i.sdp})}catch(i){throw new Q(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}})()}connect(n,i,s,c,d,h){var p=this;return x(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");p.remoteSDP=new class{get localCapabilities(){return mn(this._localCapabilities)}get rtpCapabilities(){return mn(this._rtpCapabilities)}get candidates(){return mn(this._candidates)}get iceParameters(){return mn(this._iceParameters)}get dtlsParameters(){return mn(this._dtlsParameters)}constructor(O){C(this,"sessionDesc",void 0),C(this,"_localCapabilities",void 0),C(this,"_rtpCapabilities",void 0),C(this,"_candidates",void 0),C(this,"_iceParameters",void 0),C(this,"_dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),C(this,"firefoxSsrcMidMap",new Map),O=mn(O);const{remoteIceParameters:N,remoteDtlsParameters:w,candidates:k,remoteRTPCapabilities:V,remoteSetup:U,localCapabilities:Y,cname:re}=O,K=En.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=V,this._candidates=k,this._iceParameters=N,this._dtlsParameters=w,this._localCapabilities=Y,this.setup=U,this.cname=re;const $=this.rtpCapabilities.send;for(const X of K.mediaDescriptions){if(X.attributes.iceUfrag=N.iceUfrag,X.attributes.icePwd=N.icePwd,X.attributes.fingerprints=w.fingerprints,X.attributes.candidates=k,X.attributes.setup=U,"video"===X.media.mediaType&&(X.media.fmts=$.videoCodecs.map(J=>J.payloadType.toString(10)),X.attributes.payloads=$.videoCodecs,X.attributes.extmaps=$.videoExtensions,B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:J,ssrcGroups:Ee}=wo([{ssrcId:4e4,rtx:B("USE_SUB_RTX")?40001:void 0}],this.cname);X.attributes.ssrcs=J,X.attributes.ssrcGroups=Ee}if("audio"===X.media.mediaType&&(X.media.fmts=$.audioCodecs.map(J=>J.payloadType.toString(10)),X.attributes.payloads=$.audioCodecs,X.attributes.extmaps=$.audioExtensions,Br(X),B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:J,ssrcGroups:Ee}=wo([{ssrcId:2e4}],this.cname);X.attributes.ssrcs=J,X.attributes.ssrcGroups=Ee}}this.sessionDesc=K,this.currentMidIndex=K.mediaDescriptions.length-1}preloadRemoteMedia(){const O=B("PRELOAD_MEDIA_COUNT"),N=this.candidates,w=this.dtlsParameters,k=this.iceParameters,V=this.rtpCapabilities.send;for(let U=1;U<O;U++){const Y=2*U+2e4,re=2*U+4e4,{ssrcs:K,ssrcGroups:$}=wo([{ssrcId:Y}],this.cname),{ssrcs:X,ssrcGroups:J}=wo([{ssrcId:re,rtx:B("USE_SUB_RTX")?re+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:V.videoCodecs.map(Ee=>Ee.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:k.iceUfrag,icePwd:k.icePwd,unrecognized:[],candidates:N,extmaps:V.videoExtensions,fingerprints:w.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:X,ssrcGroups:J,rtcpFeedbackWildcards:[],payloads:V.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*U)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:V.audioCodecs.map(Ee=>Ee.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:k.iceUfrag,icePwd:k.icePwd,unrecognized:[],candidates:N,extmaps:V.audioExtensions,fingerprints:w.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:K,ssrcGroups:$,rtcpFeedbackWildcards:[],payloads:V.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*U+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return En.print(this.sessionDesc)}send(O,N,w,k){const{ssrcs:V,ssrcGroups:U}=wo(N,this.cname,B("SYNC_GROUP")?w:void 0),Y=this.findPreloadMediaDesc(V);if(Y){if(zt()&&this.firefoxSsrcMidMap.set(V[0].ssrcId,Y.attributes.mid),k&&(k.twcc||k.remb)){const re=this.sessionDesc.mediaDescriptions.indexOf(Y);return this.sessionDesc.mediaDescriptions[re]=this.mungSendMediaDesc(Y,k),{mid:Y.attributes.mid,needExchangeSDP:!0}}return{mid:Y.attributes.mid,needExchangeSDP:!1}}{const re=this.findAvailableMediaIndex(O,V);let K;return-1===re||1===re&&(nr()||jw())||0===re&&B("USE_SUB_RTX")||Hw()?(K=this.createOrRecycleSendMedia(O,V,U,"sendonly",k),this.updateBundleMids()):(K=mn(this.sessionDesc.mediaDescriptions[re]),K.attributes.direction="sendonly",K.attributes.ssrcs=V,K.attributes.ssrcGroups=U,this.sessionDesc.mediaDescriptions[re]=this.mungSendMediaDesc(K,k)),zt()&&this.firefoxSsrcMidMap.set(V[0].ssrcId,K.attributes.mid),{mid:K.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:O,needExchangeSDP:N}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:O.attributes.mid,needExchangeSDP:N}}batchSend(O){const N=O.map(V=>{let{kind:U,ssrcMsg:Y,mslabel:re}=V;return this.send(U,Y,re)}),w=[];let k=!1;return N.forEach(V=>{let{mid:U,needExchangeSDP:Y}=V;Y&&(k=!0),w.push(U)}),{mids:w,needExchangeSDP:k}}stopSending(O){const N=this.sessionDesc.mediaDescriptions.filter(w=>w.attributes.mid&&-1!==O.indexOf(w.attributes.mid));if(N.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");N.forEach(w=>{"0"===w.attributes.mid||zt()||Hw()?w.attributes.ssrcs=[]:(w.attributes.ssrcs=[],w.attributes.direction="inactive",w.media.port="0")}),this.updateBundleMids()}mute(O){const N=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===O);if(!N)throw new Error("mediaDescription not found with ".concat(O," in remote SDP when calling RemoteSDP.mute."));N.attributes.direction="inactive"}unmute(O){const N=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===O);if(!N)throw new Error("mediaDescription not found with ".concat(O," in remote SDP when calling RemoteSDP.unmute."));N.attributes.direction="sendonly"}muteRemote(O){const N=this.sessionDesc.mediaDescriptions.filter(w=>be(O).call(O,w.attributes.mid||""));if(N.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");N.forEach(w=>{w.attributes.direction="inactive"})}unmuteRemote(O){const N=this.sessionDesc.mediaDescriptions.filter(w=>be(O).call(O,w.attributes.mid||""));if(N.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");N.forEach(w=>{w.attributes.direction="recvonly"})}receive(O,N,w,k){O.forEach((V,U)=>{this.createOrRecycleRecvMedia(V,[],"recvonly",N,w,k[U])}),this.updateBundleMids()}stopReceiving(O){const N=this.sessionDesc.mediaDescriptions.filter(w=>-1!==O.indexOf(w.attributes.mid));if(N.length!==O.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");N.forEach(w=>{w.media.port="0",w.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(O){const N=this._candidates.filter(w=>"udp"===w.transport);if(O===Fi.TCP){if(0===N.length)return;if(B("TCP_CANDIDATE_ONLY")){const w=this._candidates.filter(k=>"tcp"===k.transport);N.forEach(k=>{-1===w.findIndex(V=>V.connectionAddress===k.connectionAddress)&&w.push(Dc(Dc({},k),{},{foundation:"tcpcandidate",priority:Number(k.priority)-1+"",transport:"tcp",port:Number(k.port)+90+""}))}),this._candidates=w}else{const w=[];N.forEach(k=>{w.push(Dc(Dc({},k),{},{foundation:"tcpcandidate",priority:Number(k.priority)-1+"",transport:"tcp",port:Number(k.port)+90+""}))}),this._candidates=[...N,...w]}}else if(O===Fi.RELAY){if(0!==N.length)return;{const w=this._candidates.filter(k=>"tcp"===k.transport);w.forEach(k=>{N.push(Dc(Dc({},k),{},{foundation:"udpcandidate",priority:Number(k.priority)+1+"",transport:"udp",port:Number(k.port)-90+""}))}),this._candidates=[...N,...w]}}else 0===N.length?(this._candidates.filter(w=>"tcp"===w.transport).forEach(w=>{N.push(Dc(Dc({},w),{},{foundation:"udpcandidate",priority:Number(w.priority)+1+"",transport:"udp",port:Number(w.port)-90+""}))}),this._candidates=N):this._candidates=this._candidates.filter(w=>"tcp"!==w.transport);for(const w of this.sessionDesc.mediaDescriptions)w.attributes.candidates=this.candidates}restartICE(O){O=mn(O),this._iceParameters=O,this.sessionDesc.mediaDescriptions.forEach(N=>{N.attributes.iceUfrag=O.iceUfrag,N.attributes.icePwd=O.icePwd})}predictReceivingMids(O){const N=[];for(let w=0;w<O;w++)N.push((this.currentMidIndex+w+1).toString(10));return N}findAvailableMediaIndex(O,N){return this.sessionDesc.mediaDescriptions.findIndex(w=>{const k=w.media.mediaType===O&&"0"!==w.media.port&&("sendonly"===w.attributes.direction||"sendrecv"===w.attributes.direction)&&0===w.attributes.ssrcs.length;if(zt()){if(k){const V=this.firefoxSsrcMidMap.get(N[0].ssrcId);return!(V||"0"!==w.attributes.mid&&"1"!==w.attributes.mid)||!(!V||V!==w.attributes.mid)}return!1}return k})}createOrRecycleDataChannel(){for(const w of this.sessionDesc.mediaDescriptions)if("application"===w.media.mediaType)return{mediaDesc:w,needExchangeSDP:!1};this.currentMidIndex+=1;const O="".concat(this.currentMidIndex),N={media:{mediaType:"application",port:"9",protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(O),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(N),{mediaDesc:N,needExchangeSDP:!0}}createOrRecycleRecvMedia(O,N,w,k,V,U){const Y=O._mediaStreamTrack.kind,re=this.rtpCapabilities.recv,K=this.localCapabilities.send;let $=[];if(Y===_e.VIDEO){var X,J;if(B("H264_PROFILE_LEVEL_ID")&&"h264"===k&&($=re.videoCodecs.filter(Ct=>{var dt,bt,ee;return be(dt=(null===(bt=Ct.rtpMap)||void 0===bt?void 0:bt.encodingName.toLowerCase())||"").call(dt,k)&&(null==Ct||null===(ee=Ct.fmtp)||void 0===ee?void 0:ee.parameters["profile-level-id"])===B("H264_PROFILE_LEVEL_ID")})),!$||0===(null===(X=$)||void 0===X?void 0:X.length)){const Ct=K.videoCodecs.filter(dt=>{var bt,ee;return be(bt=(null===(ee=dt.rtpMap)||void 0===ee?void 0:ee.encodingName.toLowerCase())||"").call(bt,k)});0!==Ct.length&&($=re.videoCodecs.filter(dt=>Ct.some(bt=>bt.payloadType===dt.payloadType)))}if(B("USE_PUB_RTX")){const Ct=$.map(bt=>bt.payloadType.toString()),dt=re.videoCodecs.filter(bt=>{var ee,ae;return"rtx"===(null===(ee=bt.rtpMap)||void 0===ee?void 0:ee.encodingName)&&be(Ct).call(Ct,(null===(ae=bt.fmtp)||void 0===ae?void 0:ae.parameters.apt)||"")});$=[...$,...dt]}0===$.length&&(I.warning("codec ".concat(k," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(J=re.videoCodecs[0].rtpMap)||void 0===J?void 0:J.encodingName)),$=re.videoCodecs)}else $=re.audioCodecs.filter(Ct=>{var dt,bt;return be(dt=(null===(bt=Ct.rtpMap)||void 0===bt?void 0:bt.encodingName.toLowerCase())||"").call(dt,V)}),0===$.length&&(I.warning("codec ".concat(V," not included in rtpCapabilities, fallback to opus")),$=re.audioCodecs.filter(Ct=>{var dt,bt;return be(dt=(null===(bt=Ct.rtpMap)||void 0===bt?void 0:bt.encodingName.toLowerCase())||"").call(dt,"opus")}));const Ee=Y===_e.VIDEO?re.videoExtensions:re.audioExtensions;this.currentMidIndex+=1;const ve="".concat(this.currentMidIndex);let ze={media:{mediaType:Y,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:$.map(Ct=>Ct.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Ee,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:N,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:$,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:w,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ve)}};ze=this.mungRecvMediaDsec(ze,O,U);const ht=this.findFirstClosedMedia(Y);if(ht){const Ct=this.sessionDesc.mediaDescriptions.indexOf(ht);this.sessionDesc.mediaDescriptions[Ct]=ze}else this.sessionDesc.mediaDescriptions.push(ze);return ze}createOrRecycleSendMedia(O,N,w,k,V){const U=this.rtpCapabilities.send,Y=O===_e.VIDEO?U.videoCodecs:U.audioCodecs,re=O===_e.VIDEO?U.videoExtensions:U.audioExtensions;this.currentMidIndex+=1;const K="".concat(this.currentMidIndex);let $={media:{mediaType:O,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:Y.map(J=>J.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:re,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:N,ssrcGroups:w,rtcpFeedbackWildcards:[],payloads:Y,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:k,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(K)}};$=this.mungSendMediaDesc($,V);const X=this.findFirstClosedMedia(O);if(X){const J=this.sessionDesc.mediaDescriptions.indexOf(X);this.sessionDesc.mediaDescriptions[J]=$}else this.sessionDesc.mediaDescriptions.push($);return $}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(O=>"0"!==O.media.port).map(O=>O.attributes.mid)}mungRecvMediaDsec(O,N,w){const k=mn(O);return zE(k),Ac(k,N),KE(k,N),zb(k),Oh(k,w,this.localCapabilities.send),k}mungSendMediaDesc(O,N){const w=mn(O);return Oh(w,N,this.localCapabilities.recv),Br(w),w}updateRecvMedia(O,N){const w=this.sessionDesc.mediaDescriptions.findIndex(k=>k.attributes.mid===O);if(-1!==w){const k=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[w],N);this.sessionDesc.mediaDescriptions[w]=k}}bumpMid(O){this.currentMidIndex+=O}findFirstClosedMedia(O){return this.sessionDesc.mediaDescriptions.find(N=>zt()?"0"===N.media.port&&N.media.mediaType===O:"0"===N.media.port)}findPreloadMediaDesc(O){return this.sessionDesc.mediaDescriptions.find(N=>{var w;return(null===(w=N.attributes)||void 0===w||null===(w=w.ssrcs[0])||void 0===w?void 0:w.ssrcId)===O[0].ssrcId})}getSSRC(O){var N;return null===(N=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===O))||void 0===N?void 0:N.attributes.ssrcs}}({remoteIceParameters:n,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:c,remoteSetup:d,localCapabilities:p.localCapabilities,cname:h});const m=p.remoteSDP.toString(),_=En.parse(p.initialOffer.sdp),E=_.mediaDescriptions.find(O=>"audio"===O.media.mediaType);E&&Br(E),p.useXR&&hm(_);const y=En.print(_),S=p.logSDPExchange(y||"","offer","local","connect");p.store.descriptionStart(),yield p.peerConnection.setLocalDescription({type:"offer",sdp:y}),S?.(m),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m});const T=p.peerConnection.getTransceivers()[0];if(null!=T&&T.receiver&&p.tryBindTransportEvents(T.receiver),B("PRELOAD_MEDIA_COUNT")>0){p.remoteSDP.preloadRemoteMedia();const O=p.remoteSDP.toString();yield p.peerConnection.setRemoteDescription({type:"offer",sdp:O});const N=yield p.peerConnection.createAnswer();yield p.peerConnection.setLocalDescription(N)}}catch(m){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}})()}send(n,i,s){var c=this;return Ro(function*(){const d=yield lt(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[];n.forEach(N=>{const w=c.peerConnection.addTransceiver(N._mediaStreamTrack,{direction:"sendonly"});h.push(w),N._updateRtpTransceiver(w)}),zt()&&!0===B("SIMULCAST")&&(yield lt(c.applySimulcastForFirefox(h,n)));const p=yield lt(c.peerConnection.createOffer()),m=c.remoteSDP.predictReceivingMids(n.length),_=c.mungSendOfferSDP(p.sdp,n,m),E=En.parse(_),y=m.map(N=>{const w=E.mediaDescriptions.find(k=>k.attributes.mid===N);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return Wb(w,B("USE_PUB_RTX"))});let S;try{S=yield y}catch(N){S=[],c.remoteSDP.receive(n,i,s,S);const w=c.remoteSDP.toString();throw yield lt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield lt(c.peerConnection.setRemoteDescription({type:"answer",sdp:w})),yield lt(c.stopSending(m,!0)),N}c.remoteSDP.receive(n,i,s,S);const T=c.remoteSDP.toString(),O=c.logSDPExchange(_,"offer","local","send");return yield lt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield lt(c.applySimulcastEncodings(h,n)),yield lt(c.applySendEncodings(h,n)),O?.(T),yield lt(c.peerConnection.setRemoteDescription({type:"answer",sdp:T})),h.map((N,w)=>({localSSRC:y[w],id:m[w],transceiver:N}))}catch(h){throw h instanceof Q?h:new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}createDataChannels(n,i){var s=this;return x(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let c=s.dataStreamChannelMap.get(n);c&&"open"===c.readyState?I.debug("[P2PConnection] Channels are already available and can be reused directly."):(c=s.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:B("DATASTREAM_MAX_RETRANSMITS")}),c.binaryType="arraybuffer",s.dataStreamChannelMap.set(n,c)),i.forEach(h=>{h._updateOriginDataChannel(c)});const{needExchangeSDP:d}=s.remoteSDP.sendDataChannel();if(d){const h=s.remoteSDP.toString();yield s.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=yield s.peerConnection.createAnswer();yield s.peerConnection.setLocalDescription(p),I.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else I.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(c){throw c instanceof Q?c:new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(c.toString()))}})()}stopDataChannels(n){var i=this;return x(function*(){try{return i.dataStreamChannelMap.get(n)?.close(),void i.dataStreamChannelMap.delete(n)}catch(s){throw s instanceof Q?s:new Q(M.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}})()}stopSending(n,i){var s=this;return x(function*(){const c=i?void 0:yield s.mutex.lock("From P2PConnection.stopSending");try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const d=s.peerConnection.getTransceivers().filter(_=>-1!==n.indexOf(_.mid));if(d.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");d.map(_=>{var E;_.direction="inactive",null===(E=_.stop)||void 0===E||E.call(_)});const h=yield s.peerConnection.createOffer(),p=s.logSDPExchange(h.sdp||"","offer","local","stopSending");yield s.peerConnection.setLocalDescription(h),s.remoteSDP.stopReceiving(n);const m=s.remoteSDP.toString();p?.(m),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{c&&c()}})()}receive(n,i,s,c){var d=this;return x(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=d.remoteSDP.send(n,i,s,c);if(p){const _=d.remoteSDP.toString(),E=d.logSDPExchange(_,"offer","remote","receive");yield d.peerConnection.setRemoteDescription({type:"offer",sdp:_});const y=yield d.peerConnection.createAnswer(),S=d.mungReceiveAnswerSDP(y.sdp,h,n);E?.(S||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:S}),I.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."))}else I.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(n," no need to exchange SDP."));const m=d.peerConnection.getTransceivers().find(_=>_.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h,transceiver:m}}catch(h){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(n){var i=this;return x(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:c}=i.remoteSDP.batchSend(n);if(c){const d=i.remoteSDP.toString(),h=i.logSDPExchange(d,"offer","remote","receive");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:d});const p=yield i.peerConnection.createAnswer();h?.(p.sdp||""),yield i.peerConnection.setLocalDescription(p),I.debug("[".concat(i.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else I.debug("[".concat(i.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return s.map(d=>{const h=i.peerConnection.getTransceivers().find(p=>p.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d,transceiver:h}})}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}})()}stopReceiving(n){var i=this;return x(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");i.remoteSDP.stopSending(n);const s=i.remoteSDP.toString(),c=i.logSDPExchange(s,"offer","remote","stopReceiving");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();c?.(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}})()}muteRemote(n){var i=this;return x(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(n," before remote SDP created."));i.remoteSDP.mute(n);const s=i.remoteSDP.toString(),c=i.logSDPExchange(s,"offer","remote","muteRemote");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();c?.(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}})()}unmuteRemote(n){var i=this;return x(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(n," before remote SDP created."));i.remoteSDP.unmute(n);const s=i.remoteSDP.toString(),c=i.logSDPExchange(s,"offer","remote","unmuteRemote");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();c?.(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}})()}muteLocal(n){var i=this;return x(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=i.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==n.indexOf(p.mid));if(s.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(p=>{p.direction="inactive"});const c=yield i.peerConnection.createOffer(),d=i.logSDPExchange(c.sdp||"","offer","local","muteLocal");yield i.peerConnection.setLocalDescription(c),i.remoteSDP.muteRemote(n);const h=i.remoteSDP.toString();d?.(h),yield i.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}})()}unmuteLocal(n){var i=this;return x(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=i.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==n.indexOf(p.mid));if(s.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(function(){var p=x(function*(m,_){m.direction="sendonly"});return function(m,_){return p.apply(this,arguments)}}());const c=yield i.peerConnection.createOffer(),d=i.logSDPExchange(c.sdp||"","offer","local","unmuteLocal");yield i.peerConnection.setLocalDescription(c),i.remoteSDP.unmuteRemote(n);const h=i.remoteSDP.toString();d?.(h),yield i.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}})()}restartICE(n){var i=this;return Ro(function*(){const s=yield lt(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ut().supportPCSetConfiguration){const _=i.peerConnection.getConfiguration(),E=n===Fi.RELAY?"relay":"all";_.iceTransportPolicy!==E&&(I.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(E,"]")),_.iceTransportPolicy=E,i.peerConnection.setConfiguration(_))}else if(n===Fi.RELAY)return;i.remoteSDP.updateCandidates(n);const c=yield lt(i.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=gl(c.sdp),{remoteIceParameters:h}=yield d.iceParameters;i.remoteSDP.restartICE(h);const p=i.remoteSDP.toString(),m=i.logSDPExchange(c.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield lt(i.peerConnection.setLocalDescription(c)),m?.(p),yield lt(i.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(c){I.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}close(){var n;this.peerConnection.close(),null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}updateEncoderConfig(n,i){var s=this;return x(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const c=yield s.peerConnection.createOffer(),d=s.mungSendOfferSDP(c.sdp,[i],[n]);s.remoteSDP.updateRecvMedia(n,i);const h=s.remoteSDP.toString(),p=s.logSDPExchange(d,"offer","local","updateEncoderConfig");yield s.peerConnection.setLocalDescription({type:"offer",sdp:d}),p?.(h),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(c){throw new Q(M.EXCHANGE_SDP_FAILED,c.toString())}})()}updateSendParameters(n,i){var s=this;return x(function*(){const c=s.peerConnection.getTransceivers().filter(d=>d.mid===n);1===c.length&&(s.isVP8Simulcast(i)?zt()||(yield s.applySimulcastEncodings(c,[i])):yield s.applySendEncodings(c,[i]))})()}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}replaceTrack(n,i){var s=this;return x(function*(){const c=s.peerConnection.getTransceivers().find(d=>d.mid===i);c&&(yield c.sender.replaceTrack(n._mediaStreamTrack))})()}getSelectedCandidatePair(){var n=this;return x(function*(){const i=n.peerConnection.getReceivers();if(i.length>0&&i[0].transport&&i[0].transport.iceTransport&&i[0].transport.iceTransport.getSelectedCandidatePair&&i[0].transport.iceTransport.getSelectedCandidatePair()){const s=i[0].transport.iceTransport,{local:c,remote:d}=s.getSelectedCandidatePair();return{local:jd(jd({},Qo),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port}),remote:jd(jd({},Qo),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return n.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;null===(n=this.onICEConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[]};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(hd(n.turnServer.servers)?i.iceServers=n.turnServer.servers:(i.iceServers&&i.iceServers.push(...KT.turnServerConfigToIceServers(n.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...KT.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),B("ENABLE_ENCODED_TRANSFORM")&&Ut().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Qf(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!B("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}tryBindTransportEvents(n){const i=n.transport;if(i){this.transportEventReceiver=n,i.onstatechange=()=>{var c;null!=i&&i.state&&(null===(c=this.onDTLSTransportStateChange)||void 0===c||c.call(this,i.state))},i.onerror=c=>{var d;null===(d=this.onDTLSTransportError)||void 0===d||d.call(this,"error"in c?c.error:c)};const s=i.iceTransport;s&&(s.onstatechange=()=>{const c=i?.iceTransport.state;var d;c&&(null===(d=this.onICETransportStateChange)||void 0===d||d.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:d}=s.getSelectedCandidatePair();I.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(n,i){var s=this;return x(function*(){var c;if(i||(i=s.peerConnection.getSenders().find(y=>y.track===n._mediaStreamTrack)),!i)return I.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(s.isVP8Simulcast(n))return I.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ut().supportSetRtpSenderParameters)return I.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(n._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(n._encoderConfig){var p;const{bitrateMax:y,frameRate:S,scaleResolutionDownBy:T}=n._encoderConfig;y&&(h.maxBitrate=1e3*y),be(p=n._hints).call(p,qt.LOW_STREAM)&&(S&&(h.maxFramerate=Er(S)),T&&T>=1&&(h.scaleResolutionDownBy=T))}if(B("DSCP_TYPE")&&pc()){var m;const y=B("DSCP_TYPE");be(m=["very-low","low","medium","high"]).call(m,y)&&(h.networkPriority=y)}const _=i.getParameters(),E=null===(c=_.encodings)||void 0===c?void 0:c[0];zt()&&!E&&(d.encodings=[h]),E&&Object.assign(E,h),Object.assign(_,d),I.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),yield i.setParameters(_)})()}applySendEncodings(n,i){var s=this;return x(function*(){try{if(!Ut().supportSetRtpSenderParameters||n.length!==i.length)return;for(let c=0;c<n.length;c++){const d=n[c],h=i[c];h instanceof We&&!s.isVP8Simulcast(h)&&(yield s.updateRtpSenderEncodings(h,d.sender))}}catch{I.debug("[".concat(s.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(n,i,s){const c=En.parse(n);return i.forEach((d,h)=>{const p=s[h],m=c.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(Ac(m,d),Nh(m,d,this.store.codec))}),En.print(c)}mungReceiveAnswerSDP(n,i,s){const c=En.parse(n),d=c.mediaDescriptions.find(h=>h.attributes.mid===i);return d&&(s===_e.AUDIO&&"audio"===d.media.mediaType&&Br(d),this.useXR&&hm(c)),En.print(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;null===(i=this.onFirstAudioReceived)||void 0===i||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;null===(i=this.onFirstVideoReceived)||void 0===i||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;null===(i=this.onFirstAudioDecoded)||void 0===i||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,s)=>{var c;null===(c=this.onFirstVideoDecoded)||void 0===c||c.call(this,n,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;null===(i=this.onFirstVideoDecodedTimeout)||void 0===i||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(n,i){var s=this;return x(function*(){if(n.length===i.length)for(let _=0;_<n.length;_++){var c,d,h,p,m;const E=n[_],y=i[_];if(y instanceof We&&!be(c=y._hints).call(c,qt.LOW_STREAM)&&null!==(d=y._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=y._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=y._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=y._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===s.store.codec){const S={},T={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const O=E.sender.getParameters();yield E.sender.setParameters(Object.assign(O,S))}}})()}applySimulcastEncodings(n,i){var s=this;return x(function*(){if(!zt()&&n.length===i.length)for(let c=0;c<n.length;c++){const d=i[c];if(d instanceof We&&s.isVP8Simulcast(d)){const h=n[c],p={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=h.sender.getParameters();yield h.sender.setParameters(Object.assign(_,p))}}})()}isVP8Simulcast(n){var i,s,c,d,h;return!!(n instanceof We&&B("SIMULCAST")&&"vp8"===this.store.codec&&!be(i=n._hints).call(i,qt.LOW_STREAM)&&null!==(s=n._encoderConfig)&&void 0!==s&&s.bitrateMax&&(null===(c=n._encoderConfig)||void 0===c?void 0:c.bitrateMax)>200&&null!==(d=n._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=n._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,s,c){if(B("SDP_LOGGING"))return I.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during P2PConnection.").concat(c,"\n"),n),"offer"===i?d=>{this.logSDPExchange(d,"answer","local"===s?"remote":"local",c)}:void 0}getRemoteSSRC(n){var i=this;return x(function*(){if(i.remoteSDP)return i.remoteSDP.getSSRC(n)?.[0].ssrcId})()}setConfiguration(n){if(Ut().supportPCSetConfiguration){const i=KT.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}};function br(o,n,i){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=x(function*(){const c=this.mutex,d=yield c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),i}function Hd(o,n){let i=document.createElement("video"),s=document.createElement("canvas");i.setAttribute("style","display:none"),s.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),s.width=Er(n.width),s.height=Er(n.height);const c=Er(n.framerate||15);document.body.append(i),document.body.append(s);let d=o._mediaStreamTrack;i.srcObject=new MediaStream([d]),i.play();const h=s.getContext("2d");if(!h)throw new W(M.UNEXPECTED_ERROR,"can not get canvas context");const p=Ut(),m=s.captureStream(p.supportRequestFrame?0:c).getVideoTracks()[0];m.canvas||(m.canvas=s),s.startCapture=()=>{if(!i)return s.stopCapture&&s.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const S=s.width*(i.videoHeight/i.videoWidth);Math.abs(S-s.height)>=2&&(I.debug("adjust low stream resolution","".concat(s.width,"x").concat(s.height," -> ").concat(s.width,"x").concat(S)),s.height=S)}h.drawImage(i,0,0,s.width,s.height),m.requestFrame&&m.requestFrame(),d!==o._mediaStreamTrack&&(d=o._mediaStreamTrack,i.srcObject=new MediaStream([d]))},s.stopCapture=oD(()=>s.startCapture&&s.startCapture(),c);const _=m.stop;return m.stop=()=>{_.call(m),i&&(i.remove(),i.srcObject=null,i=null),s&&(s.width=0,s.remove(),s.stopCapture&&s.stopCapture(),s.startCapture=void 0,s.stopCapture=void 0,s=null),I.debug("clean low stream renderer")},m}function vx(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Sx(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?vx(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):vx(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}te([br,P("design:type",Function),P("design:paramtypes",[Object,Object,Array,Object,String,String]),P("design:returntype",z)],si.prototype,"connect",null),te([br,P("design:type",Function),P("design:paramtypes",[Object,Array]),P("design:returntype",z)],si.prototype,"createDataChannels",null),te([br,P("design:type",Function),P("design:paramtypes",[String,Array,String,Object]),P("design:returntype",z)],si.prototype,"receive",null),te([br,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],si.prototype,"batchReceive",null),te([br,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],si.prototype,"stopReceiving",null),te([br,P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],si.prototype,"muteRemote",null),te([br,P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],si.prototype,"unmuteRemote",null),te([br,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],si.prototype,"muteLocal",null),te([br,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],si.prototype,"unmuteLocal",null),te([br,P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],si.prototype,"close",null),te([br,P("design:type",Function),P("design:paramtypes",[String,wi]),P("design:returntype",z)],si.prototype,"updateEncoderConfig",null),te([br,P("design:type",Function),P("design:paramtypes",[String,wi]),P("design:returntype",z)],si.prototype,"updateSendParameters",null),te([br,P("design:type",Function),P("design:paramtypes",[wi,String]),P("design:returntype",z)],si.prototype,"replaceTrack",null),te([br,P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],si.prototype,"getRemoteSSRC",null);const Xb="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\na=ice-lite\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 127.0.0.1\na=mid:0\n";class XE{get localCapabilities(){return mn(this._localCapabilities)}get rtpCapabilities(){return mn(this._rtpCapabilities)}get candidates(){return mn(this._candidates)}get iceParameters(){return mn(this._iceParameters)}get dtlsParameters(){return mn(this._dtlsParameters)}constructor(n){C(this,"sessionDesc",void 0),C(this,"_localCapabilities",void 0),C(this,"_rtpCapabilities",void 0),C(this,"_candidates",void 0),C(this,"_iceParameters",void 0),C(this,"_dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),C(this,"firefoxSsrcMidMap",new Map),n=mn(n);const{remoteIceParameters:i,remoteDtlsParameters:s,candidates:c,remoteRTPCapabilities:d,remoteSetup:h,localCapabilities:p,cname:m}=n,_=En.parse(Xb);this._rtpCapabilities=d,this._candidates=c,this._iceParameters=i,this._dtlsParameters=s,this._localCapabilities=p,this.setup=h,this.cname=m;const E=this.rtpCapabilities.send;for(const y of _.mediaDescriptions){if(y.attributes.iceUfrag=i.iceUfrag,y.attributes.icePwd=i.icePwd,y.attributes.fingerprints=s.fingerprints,y.attributes.candidates=c,y.attributes.setup=h,"application"===y.media.mediaType&&(y.attributes.sctpPort="5000"),"video"===y.media.mediaType&&(y.media.fmts=E.videoCodecs.map(S=>S.payloadType.toString(10)),y.attributes.payloads=E.videoCodecs,y.attributes.extmaps=E.videoExtensions,B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:S,ssrcGroups:T}=wo([{ssrcId:4e4,rtx:B("USE_SUB_RTX")?40001:void 0}],this.cname);y.attributes.ssrcs=S,y.attributes.ssrcGroups=T}if("audio"===y.media.mediaType&&(y.media.fmts=E.audioCodecs.map(S=>S.payloadType.toString(10)),y.attributes.payloads=E.audioCodecs,y.attributes.extmaps=E.audioExtensions,Br(y),B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:S,ssrcGroups:T}=wo([{ssrcId:2e4}],this.cname);y.attributes.ssrcs=S,y.attributes.ssrcGroups=T}}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}updateRemoteRTPCapabilities(n){const i=En.parse(Xb);this._rtpCapabilities=n;const s=this.rtpCapabilities.send;for(const c of i.mediaDescriptions){if(c.attributes.iceUfrag=this._iceParameters.iceUfrag,c.attributes.icePwd=this._iceParameters.icePwd,c.attributes.fingerprints=this._dtlsParameters.fingerprints,c.attributes.candidates=this._candidates,c.attributes.setup=this.setup,"application"===c.media.mediaType&&(c.attributes.sctpPort="5000"),"video"===c.media.mediaType&&(c.media.fmts=s.videoCodecs.map(d=>d.payloadType.toString(10)),c.attributes.payloads=s.videoCodecs,c.attributes.extmaps=s.videoExtensions,B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=wo([{ssrcId:4e4,rtx:B("USE_SUB_RTX")?40001:void 0}],this.cname);c.attributes.ssrcs=d,c.attributes.ssrcGroups=h}if("audio"===c.media.mediaType&&(c.media.fmts=s.audioCodecs.map(d=>d.payloadType.toString(10)),c.attributes.payloads=s.audioCodecs,c.attributes.extmaps=s.audioExtensions,B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=wo([{ssrcId:2e4}],this.cname);c.attributes.ssrcs=d,c.attributes.ssrcGroups=h}}this.sessionDesc=i,this.currentMidIndex=i.mediaDescriptions.length-1}preloadRemoteMedia(n){const i=this.candidates,s=this.dtlsParameters,c=this.iceParameters,d=this.rtpCapabilities.send;for(let h=1;h<n;h++){const p=2*h+2e4,m=2*h+4e4,{ssrcs:_,ssrcGroups:E}=wo([{ssrcId:p}],this.cname),{ssrcs:y,ssrcGroups:S}=wo([{ssrcId:m,rtx:B("USE_SUB_RTX")?m+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.videoCodecs.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:c.iceUfrag,icePwd:c.icePwd,unrecognized:[],candidates:i,extmaps:d.videoExtensions,fingerprints:s.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:y,ssrcGroups:S,rtcpFeedbackWildcards:[],payloads:d.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.audioCodecs.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:c.iceUfrag,icePwd:c.icePwd,unrecognized:[],candidates:i,extmaps:d.audioExtensions,fingerprints:s.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:d.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return En.print(this.sessionDesc)}send(n,i,s,c){const{ssrcs:d,ssrcGroups:h}=wo(i,this.cname,B("SYNC_GROUP")?s:void 0),p=this.findPreloadMediaDesc(d);if(p){if(zt()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,p.attributes.mid),c&&(c.twcc||c.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(p,c),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(n,d);let _;return-1===m||nr()||ir()||jw()||0===m&&B("USE_SUB_RTX")?(_=this.createOrRecycleSendMedia(n,d,h,"sendonly",c),this.updateBundleMids()):(_=mn(this.sessionDesc.mediaDescriptions[m]),_.attributes.direction="sendonly",_.attributes.ssrcs=d,_.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(_,c)),zt()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,_.attributes.mid),{mid:_.attributes.mid,needExchangeSDP:!0}}}batchSend(n){const i=n.map(d=>{let{kind:h,ssrcMsg:p,mslabel:m}=d;return this.send(h,p,m)}),s=[];let c=!1;return i.forEach(d=>{let{mid:h,needExchangeSDP:p}=d;p&&(c=!0),s.push(h)}),{mids:s,needExchangeSDP:c}}stopSending(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&-1!==n.indexOf(s.attributes.mid));if(i.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");i.forEach(s=>{"0"===s.attributes.mid||zt()||nr()||ir()?s.attributes.ssrcs=[]:(s.attributes.ssrcs=[],s.attributes.direction="inactive",s.media.port="0")}),this.updateBundleMids()}mute(n){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(n){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}muteRemote(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>be(n).call(n,s.attributes.mid||""));if(i.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>be(n).call(n,s.attributes.mid||""));if(i.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(s=>{s.attributes.direction="recvonly"})}receive(n,i,s,c){n.forEach((d,h)=>{this.createOrRecycleRecvMedia(d,[],"recvonly",i,s,c[h])}),this.updateBundleMids()}stopReceiving(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>-1!==n.indexOf(s.attributes.mid));if(i.length!==n.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");i.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(n){n===Fi.TCP?this._candidates.forEach(i=>{-1===this._candidates.findIndex(s=>"tcp"===s.transport&&s.connectionAddress===i.connectionAddress&&s.port===i.port)&&this._candidates.push(Sx(Sx({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}):this._candidates=this._candidates.filter(i=>"tcp"!==i.transport);for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}restartICE(n){n=mn(n),this._iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=n.iceUfrag,i.attributes.icePwd=n.icePwd})}predictReceivingMids(n){const i=[];for(let s=0;s<n;s++)i.push((this.currentMidIndex+s+1).toString(10));return i}findAvailableMediaIndex(n,i){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const c=s.media.mediaType===n&&"0"!==s.media.port&&("sendonly"===s.attributes.direction||"sendrecv"===s.attributes.direction)&&0===s.attributes.ssrcs.length;if(zt()){if(c){const d=this.firefoxSsrcMidMap.get(i[0].ssrcId);return!(d||"0"!==s.attributes.mid&&"1"!==s.attributes.mid)||!(!d||d!==s.attributes.mid)}return!1}return c})}createOrRecycleRecvMedia(n,i,s,c,d,h){const p=n._mediaStreamTrack.kind,m=this.rtpCapabilities.recv,_=this.localCapabilities.send;let E=[];if(p===_e.VIDEO){var y,S;if(B("H264_PROFILE_LEVEL_ID")&&"h264"===c&&(E=m.videoCodecs.filter(k=>{var V,U,Y;return be(V=(null===(U=k.rtpMap)||void 0===U?void 0:U.encodingName.toLowerCase())||"").call(V,c)&&(null==k||null===(Y=k.fmtp)||void 0===Y?void 0:Y.parameters["profile-level-id"])===B("H264_PROFILE_LEVEL_ID")})),!E||0===(null===(y=E)||void 0===y?void 0:y.length)){const k=_.videoCodecs.filter(V=>{var U,Y;return be(U=(null===(Y=V.rtpMap)||void 0===Y?void 0:Y.encodingName.toLowerCase())||"").call(U,c)});0!==k.length&&(E=m.videoCodecs.filter(V=>k.some(U=>U.payloadType===V.payloadType)))}if(B("USE_PUB_RTX")){const k=E.map(U=>U.payloadType.toString()),V=m.videoCodecs.filter(U=>{var Y,re;return"rtx"===(null===(Y=U.rtpMap)||void 0===Y?void 0:Y.encodingName)&&be(k).call(k,(null===(re=U.fmtp)||void 0===re?void 0:re.parameters.apt)||"")});E=[...E,...V]}0===E.length&&(I.warning("codec ".concat(c," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(S=m.videoCodecs[0].rtpMap)||void 0===S?void 0:S.encodingName)),E=m.videoCodecs)}else E=m.audioCodecs.filter(k=>{var V,U;return be(V=(null===(U=k.rtpMap)||void 0===U?void 0:U.encodingName.toLowerCase())||"").call(V,d)}),0===E.length&&(I.warning("codec ".concat(d," not included in rtpCapabilities, fallback to opus")),E=m.audioCodecs.filter(k=>{var V,U;return be(V=(null===(U=k.rtpMap)||void 0===U?void 0:U.encodingName.toLowerCase())||"").call(V,"opus")}));const T=p===_e.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;const O="".concat(this.currentMidIndex);let N={media:{mediaType:p,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:E.map(k=>k.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:T,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:E,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(O)}};N=this.mungRecvMediaDsec(N,n,h);const w=this.findFirstClosedMedia(p);if(w){const k=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[k]=N}else this.sessionDesc.mediaDescriptions.push(N);return N}createOrRecycleSendMedia(n,i,s,c,d){const h=this.rtpCapabilities.send,p=n===_e.VIDEO?h.videoCodecs:h.audioCodecs,m=n===_e.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const _="".concat(this.currentMidIndex);let E={media:{mediaType:n,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:c,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};E=this.mungSendMediaDesc(E,d);const y=this.findFirstClosedMedia(n);if(y){const S=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[S]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(n=>"0"!==n.media.port).map(n=>n.attributes.mid)}mungRecvMediaDsec(n,i,s){const c=mn(n);return zE(c),Ac(c,i),KE(c,i),zb(c),Oh(c,s,this.localCapabilities.send),c}mungSendMediaDesc(n,i){const s=mn(n);return Oh(s,i,this.localCapabilities.recv),Br(s),s}updateRecvMedia(n,i){const s=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===n);if(-1!==s){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],i);this.sessionDesc.mediaDescriptions[s]=c}}bumpMid(n){this.currentMidIndex+=n}findFirstClosedMedia(n){return this.sessionDesc.mediaDescriptions.find(i=>zt()?"0"===i.media.port&&i.media.mediaType===n:"0"===i.media.port)}findPreloadMediaDesc(n){return this.sessionDesc.mediaDescriptions.find(i=>{var s;return(null===(s=i.attributes)||void 0===s||null===(s=s.ssrcs[0])||void 0===s?void 0:s.ssrcId)===n[0].ssrcId})}getSSRC(n){var i;return null===(i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===n))||void 0===i?void 0:i.attributes.ssrcs}}function gm(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function JE(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?gm(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):gm(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class Si extends $s{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(n,i,s){super(n,i),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"transportEventReceiver",void 0),C(this,"statsFilter",void 0),C(this,"useXR",B("USE_XR")),C(this,"localCapabilities",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"dataStreamChannelMap",new Map),C(this,"establishPromise",void 0),C(this,"mutex",new li("NVExtentionsConnection-mutex")),C(this,"rtcMedia",void 0),this.store=i,this.peerConnection=s,this.statsFilter=Ph(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,zt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(n){var i=this;return x(function*(){try{const s=yield i.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=gl(s.sdp),d=yield Kb({filterRTX:!B("USE_PUB_RTX")&&!B("USE_SUB_RTX"),filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC")},{useXR:i.useXR});return i.localCapabilities=d,i.initialOffer=s,JE(JE({},c),{},{rtpCapabilities:d,offerSDP:s.sdp})}catch(s){throw new W(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}})()}connect(n,i,s,c,d,h){var p=this;return x(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");p.remoteSDP=new XE({remoteIceParameters:n,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:c,remoteSetup:d,localCapabilities:Sr(p.localCapabilities),cname:h});const m=p.remoteSDP.toString(),_=En.parse(p.initialOffer.sdp),E=_.mediaDescriptions.find(T=>"audio"===T.media.mediaType);E&&Br(E),p.useXR&&hm(_);const y=En.print(_),S=p.logSDPExchange(y||"","offer","local","connect");yield p.peerConnection.setLocalDescription({type:"offer",sdp:y}),S?.(m),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new W(M.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(m.toString()))}})()}updateRemoteConnect(n){var i=this;return x(function*(){var s,c,d;null===(s=i.remoteSDP)||void 0===s||s.updateRemoteRTPCapabilities(n),null===(c=i.remoteSDP)||void 0===c||c.preloadRemoteMedia(2);const h=null===(d=i.remoteSDP)||void 0===d?void 0:d.toString();yield i.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=yield i.peerConnection.createAnswer();yield i.peerConnection.setLocalDescription(p),I.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")})()}send(n,i,s){var c=this;return Ro(function*(){const d=yield lt(c.mutex.lock("From NVExtentionsConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const h=[];n.forEach(N=>{const w=c.peerConnection.addTransceiver(N._mediaStreamTrack,{direction:"sendonly"});h.push(w)}),zt()&&!0===B("SIMULCAST")&&(yield lt(c.applySimulcastForFirefox(h,n)));const p=yield lt(c.peerConnection.createOffer()),m=c.remoteSDP.predictReceivingMids(n.length),_=c.mungSendOfferSDP(p.sdp,n,m),E=En.parse(_),y=m.map(N=>{const w=E.mediaDescriptions.find(k=>k.attributes.mid===N);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return Wb(w,B("USE_PUB_RTX"))});let S;try{S=yield y}catch(N){S=[],c.remoteSDP.receive(n,i,s,S);const w=c.remoteSDP.toString();throw yield lt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield lt(c.peerConnection.setRemoteDescription({type:"answer",sdp:w})),yield lt(c.stopSending(m,!0)),N}c.remoteSDP.receive(n,i,s,S);const T=c.remoteSDP.toString(),O=c.logSDPExchange(_,"offer","local","send");return yield lt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield lt(c.applySimulcastEncodings(h,n)),yield lt(c.applySendEncodings(h,n)),O?.(T),yield lt(c.peerConnection.setRemoteDescription({type:"answer",sdp:T})),h.map((N,w)=>({localSSRC:y[w],id:m[w],transceiver:N}))}catch(h){throw h instanceof W?h:new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(h.toString()))}finally{d()}})()}stopSending(n,i){var s=this;return x(function*(){const c=i?void 0:yield s.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!s.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const d=s.peerConnection.getTransceivers().filter(_=>-1!==n.indexOf(_.mid));if(d.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");d.map(_=>{var E;_.direction="inactive",null===(E=_.stop)||void 0===E||E.call(_)});const h=yield s.peerConnection.createOffer(),p=s.logSDPExchange(h.sdp||"","offer","local","stopSending");yield s.peerConnection.setLocalDescription(h),s.remoteSDP.stopReceiving(n);const m=s.remoteSDP.toString();p?.(m),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(d.toString()))}finally{c&&c()}})()}createDataChannels(n,i){var s=this;return x(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let c=s.dataStreamChannelMap.get(n);return c&&"open"===c.readyState?I.debug("[P2PConnection] Channels are already available and can be reused directly."):(c=s.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:B("DATASTREAM_MAX_RETRANSMITS")}),c.binaryType="arraybuffer",s.dataStreamChannelMap.set(n,c)),void i.forEach(d=>{d._updateOriginDataChannel(c)})}catch(c){throw c instanceof W?c:new W(M.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(c.toString()))}})()}stopDataChannels(n){var i=this;return x(function*(){try{return i.dataStreamChannelMap.get(n)?.close(),void i.dataStreamChannelMap.delete(n)}catch(s){throw s instanceof W?s:new W(M.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(s.toString()))}})()}receive(n,i,s,c){var d=this;return x(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(n," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=d.remoteSDP.send(n,i,s,c);if(p){const _=d.remoteSDP.toString(),E=d.logSDPExchange(_,"offer","remote","receive");yield d.peerConnection.setRemoteDescription({type:"offer",sdp:_});const y=yield d.peerConnection.createAnswer(),S=d.mungReceiveAnswerSDP(y.sdp,h,n);E?.(S||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:S}),I.debug("[NVExtentionsConnection] receive ".concat(n," by exchanging SDP."))}else I.debug("[NVExtentionsConnection] receive ".concat(n," no need to exchange SDP."));const m=d.peerConnection.getTransceivers().find(_=>_.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h}}catch(h){throw new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(n){var i=this;return x(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:c}=i.remoteSDP.batchSend(n);if(c){const d=i.remoteSDP.toString(),h=i.logSDPExchange(d,"offer","remote","receive");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:d});const p=yield i.peerConnection.createAnswer();h?.(p.sdp||""),yield i.peerConnection.setLocalDescription(p),I.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else I.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return s.map(d=>{const h=i.peerConnection.getTransceivers().find(p=>p.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d}})}catch(s){throw new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(s.toString()))}})()}stopReceiving(n){var i=this;return x(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");i.remoteSDP.stopSending(n);const s=i.remoteSDP.toString(),c=i.logSDPExchange(s,"offer","remote","stopReceiving");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();c?.(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(s.toString()))}})()}muteRemote(n){var i=this;return x(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(n," before remote SDP created."));i.remoteSDP.mute(n);const s=i.remoteSDP.toString(),c=i.logSDPExchange(s,"offer","remote","muteRemote");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();c?.(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(s.toString()))}})()}unmuteRemote(n){var i=this;return x(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(n," before remote SDP created."));i.remoteSDP.unmute(n);const s=i.remoteSDP.toString(),c=i.logSDPExchange(s,"offer","remote","unmuteRemote");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();c?.(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(s.toString()))}})()}muteLocal(n){var i=this;return x(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const s=i.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==n.indexOf(p.mid));if(s.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(p=>{p.direction="inactive"});const c=yield i.peerConnection.createOffer(),d=i.logSDPExchange(c.sdp||"","offer","local","muteLocal");yield i.peerConnection.setLocalDescription(c),i.remoteSDP.muteRemote(n);const h=i.remoteSDP.toString();d?.(h),yield i.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(s.toString()))}})()}unmuteLocal(n){var i=this;return x(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const s=i.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==n.indexOf(p.mid));if(s.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(function(){var p=x(function*(m,_){m.direction="sendonly"});return function(m,_){return p.apply(this,arguments)}}());const c=yield i.peerConnection.createOffer(),d=i.logSDPExchange(c.sdp||"","offer","local","unmuteLocal");yield i.peerConnection.setLocalDescription(c),i.remoteSDP.unmuteRemote(n);const h=i.remoteSDP.toString();d?.(h),yield i.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new W(M.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(s.toString()))}})()}restartICE(n){var i=this;return Ro(function*(){const s=yield lt(i.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ut().supportPCSetConfiguration){const _=i.peerConnection.getConfiguration(),E=n===Fi.RELAY?"relay":"all";_.iceTransportPolicy!==E&&(I.debug("restartICE change iceTransportPolicy from [".concat(_.iceTransportPolicy,"] to [").concat(E,"]")),_.iceTransportPolicy=E,i.peerConnection.setConfiguration(_))}else if(n===Fi.RELAY)return;n!==Fi.RELAY&&i.remoteSDP.updateCandidates(n);const c=yield lt(i.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=gl(c.sdp),{remoteIceParameters:h}=yield d.iceParameters;i.remoteSDP.restartICE(h);const p=i.remoteSDP.toString(),m=i.logSDPExchange(c.sdp||"","offer","local","restartICE");yield lt(i.peerConnection.setLocalDescription(c)),m?.(p),yield lt(i.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(c){I.warning("restart ICE failed, abort operation",c)}finally{s()}})()}close(){var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}updateEncoderConfig(n,i){var s=this;return x(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const c=yield s.peerConnection.createOffer(),d=s.mungSendOfferSDP(c.sdp,[i],[n]);s.remoteSDP.updateRecvMedia(n,i);const h=s.remoteSDP.toString(),p=s.logSDPExchange(d,"offer","local","updateEncoderConfig");yield s.peerConnection.setLocalDescription({type:"offer",sdp:d}),p?.(h),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(c){throw new W(M.EXCHANGE_SDP_FAILED,c.toString())}})()}updateSendParameters(n,i){var s=this;return x(function*(){const c=s.peerConnection.getTransceivers().filter(d=>d.mid===n);1===c.length&&(s.isVP8Simulcast(i)?zt()||(yield s.applySimulcastEncodings(c,[i])):yield s.applySendEncodings(c,[i]))})()}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}replaceTrack(n,i){var s=this;return x(function*(){const c=s.peerConnection.getTransceivers().find(d=>d.mid===i);c&&(yield c.sender.replaceTrack(n._mediaStreamTrack))})()}getP2PConnectionParams(){var n;if(null===(n=this.peerConnection.currentLocalDescription)||void 0===n||!n.sdp||!this.localCapabilities)throw new Error;return JE(JE({},gl(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;null===(n=this.onICEConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[]};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(hd(n.turnServer.servers)?i.iceServers=n.turnServer.servers:(i.iceServers&&i.iceServers.push(...Si.turnServerConfigToIceServers(n.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...Si.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Qf(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!B("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}applySendEncodings(n,i){var s=this;return x(function*(){try{if(!Ut().supportSetRtpSenderParameters||n.length!==i.length)return;for(let S=0;S<n.length;S++){const T=n[S],O=i[S];if(O&&O instanceof We){var c,d,h;if(s.isVP8Simulcast(O))continue;const N={},w={};switch(O._optimizationMode){case"motion":N.degradationPreference="maintain-framerate";break;case"detail":N.degradationPreference="maintain-resolution";break;default:N.degradationPreference="balanced"}var p,m,_,E;if(null!==(c=O._encoderConfig)&&void 0!==c&&c.bitrateMax&&(w.maxBitrate=1e3*(null===(p=O._encoderConfig)||void 0===p?void 0:p.bitrateMax)),be(d=O._hints).call(d,qt.LOW_STREAM)&&(null!==(m=O._encoderConfig)&&void 0!==m&&m.frameRate&&(w.maxFramerate=Er(O._encoderConfig.frameRate)),null!==(_=O._encoderConfig)&&void 0!==_&&_.scaleResolutionDownBy&&(null===(E=O._encoderConfig)||void 0===E?void 0:E.scaleResolutionDownBy)>1&&(w.scaleResolutionDownBy=O._encoderConfig.scaleResolutionDownBy)),B("DSCP_TYPE")&&pc()){var y;const U=B("DSCP_TYPE");be(y=["very-low","low","medium","high"]).call(y,U)&&(w.networkPriority=U)}const k=T.sender.getParameters(),V=null===(h=k.encodings)||void 0===h?void 0:h[0];zt()&&!V&&(N.encodings=[w]),V&&Object.assign(V,w),Object.assign(k,N),yield T.sender.setParameters(k)}}}catch{I.debug("Apply RTPSendEncodings failed.")}})()}mungSendOfferSDP(n,i,s){const c=En.parse(n);return i.forEach((d,h)=>{const p=s[h],m=c.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(Ac(m,d),Nh(m,d,this.store.codec))}),En.print(c)}mungReceiveAnswerSDP(n,i,s){const c=En.parse(n),d=c.mediaDescriptions.find(h=>h.attributes.mid===i);return d&&s===_e.AUDIO&&"audio"===d.media.mediaType&&Br(d),this.useXR&&hm(c),En.print(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;null===(i=this.onFirstAudioReceived)||void 0===i||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;null===(i=this.onFirstVideoReceived)||void 0===i||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;null===(i=this.onFirstAudioDecoded)||void 0===i||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,s)=>{var c;null===(c=this.onFirstVideoDecoded)||void 0===c||c.call(this,n,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;null===(i=this.onFirstVideoDecodedTimeout)||void 0===i||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(n,i){var s=this;return x(function*(){if(n.length===i.length)for(let _=0;_<n.length;_++){var c,d,h,p,m;const E=n[_],y=i[_];if(y instanceof We&&!be(c=y._hints).call(c,qt.LOW_STREAM)&&null!==(d=y._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=y._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=y._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=y._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===s.store.codec){const S={},T={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const O=E.sender.getParameters();yield E.sender.setParameters(Object.assign(O,S))}}})()}applySimulcastEncodings(n,i){var s=this;return x(function*(){if(!zt()&&n.length===i.length)for(let c=0;c<n.length;c++){const d=i[c];if(d instanceof We&&s.isVP8Simulcast(d)){const h=n[c],p={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=h.sender.getParameters();yield h.sender.setParameters(Object.assign(_,p))}}})()}isVP8Simulcast(n){var i,s,c,d,h;return!!(n instanceof We&&B("SIMULCAST")&&"vp8"===this.store.codec&&!be(i=n._hints).call(i,qt.LOW_STREAM)&&null!==(s=n._encoderConfig)&&void 0!==s&&s.bitrateMax&&(null===(c=n._encoderConfig)||void 0===c?void 0:c.bitrateMax)>200&&null!==(d=n._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=n._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,s,c){if(B("SDP_LOGGING"))return I.upload("exchanging ".concat(s," ").concat(i," SDP during NVExtentionsConnection.").concat(c,"\n"),n),"offer"===i?d=>{this.logSDPExchange(d,"answer","local"===s?"remote":"local",c)}:void 0}getRemoteSSRC(n){var i=this;return x(function*(){if(i.remoteSDP)return i.remoteSDP.getSSRC(n)?.[0].ssrcId})()}setConfiguration(n){if(Ut().supportPCSetConfiguration){const i=Si.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}}function cr(o,n,i){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=x(function*(){const c=this.mutex,d=yield c.lock("From NVExtentionsConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),i}function mO(o){var n,i,s,c=2;for(typeof Symbol<"u"&&(i=dm,s=Symbol.iterator);c--;){if(i&&null!=(n=o[i]))return n.call(o);if(s&&null!=(n=o[s]))return new QE(n.call(o));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function QE(o){function n(i){if(Object(i)!==i)return z.reject(new TypeError(i+" is not an object."));var s=i.done;return z.resolve(i.value).then(function(c){return{value:c,done:s}})}return(QE=function(i){this.s=i,this.n=i.next}).prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return void 0===s?z.resolve({value:i,done:!0}):n(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return void 0===s?z.reject(i):n(s.apply(this.s,arguments))}},new QE(o)}te([cr,P("design:type",Function),P("design:paramtypes",[Object,Object,Array,Object,String,String]),P("design:returntype",z)],Si.prototype,"connect",null),te([cr,P("design:type",Function),P("design:paramtypes",[Object]),P("design:returntype",z)],Si.prototype,"updateRemoteConnect",null),te([cr,P("design:type",Function),P("design:paramtypes",[Object,Array]),P("design:returntype",z)],Si.prototype,"createDataChannels",null),te([cr,P("design:type",Function),P("design:paramtypes",[String,Array,String,Object]),P("design:returntype",z)],Si.prototype,"receive",null),te([cr,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],Si.prototype,"batchReceive",null),te([cr,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],Si.prototype,"stopReceiving",null),te([cr,P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],Si.prototype,"muteRemote",null),te([cr,P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],Si.prototype,"unmuteRemote",null),te([cr,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],Si.prototype,"muteLocal",null),te([cr,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],Si.prototype,"unmuteLocal",null),te([cr,P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],Si.prototype,"close",null),te([cr,P("design:type",Function),P("design:paramtypes",[String,wi]),P("design:returntype",z)],Si.prototype,"updateEncoderConfig",null),te([cr,P("design:type",Function),P("design:paramtypes",[String,wi]),P("design:returntype",z)],Si.prototype,"updateSendParameters",null),te([cr,P("design:type",Function),P("design:paramtypes",[wi,String]),P("design:returntype",z)],Si.prototype,"replaceTrack",null),te([cr,P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],Si.prototype,"getRemoteSSRC",null);class Zn extends $s{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(n,i){super(n,i),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"cname",void 0),C(this,"mutex",new li("DataChannelConnection-mutex")),C(this,"dataChannel",void 0),C(this,"_p2pConnection",void 0),C(this,"establishPromise",void 0),C(this,"_nvMedia",void 0),this.store=i,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(Zn.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new Si(n,i,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}establish(){var n=this;return x(function*(){var i;const s=null===(i=n._nvMedia)||void 0===i?void 0:i.getLocalRtpCapabilities();return yield n._p2pConnection.establish(s)})()}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}connect(n,i,s,c,d,h){var p=this;return x(function*(){return p.cname=h,yield p._p2pConnection.connect(n,i,s,c,d,h),yield new z((m,_)=>{const E=setTimeout(()=>{p.closeSignal(),_(new W(M.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(s))))},2e3);p.dataChannel.onopen=()=>{if("open"===p.dataChannel.readyState)return clearTimeout(E),void m()},p.dataChannel.onerror=y=>{p.closeSignal(),_(y)}}),{transmitter:p.dataChannel,close:p.closeSignal.bind(p)}})()}send(n,i,s){var c=this;return Ro(function*(){const d=yield lt(c.mutex.lock("From DataChannelConnection.send"));try{return yield*lm(mO(c._p2pConnection.send(n,i,s)))}finally{d()}})()}stopSending(n,i){var s=this;return x(function*(){return s._p2pConnection.stopSending(n,i)})()}createDataChannels(n,i){var s=this;return x(function*(){return s._p2pConnection.createDataChannels(n,i)})()}stopDataChannels(n){var i=this;return x(function*(){return i._p2pConnection.stopDataChannels(n)})()}receive(n,i,s,c){var d=this;return x(function*(){return d._nvMedia?(I.debug("[DataChannelConnection] receive ".concat(n," by DataChannel.")),yield d._nvMedia.reveiveByRTCMedia(n,i,d.cname)):(I.debug("[DataChannelConnection] receive ".concat(n," by WebRTC.")),yield d._p2pConnection.receive(n,i,s,c))})()}batchReceive(n){var i=this;return x(function*(){return[...yield i._p2pConnection.batchReceive(n)]})()}stopReceiving(n){var i=this;return x(function*(){return yield i._p2pConnection.stopReceiving(n)})()}muteRemote(n){var i=this;return x(function*(){return yield i._p2pConnection.muteRemote(n)})()}unmuteRemote(n){var i=this;return x(function*(){return yield i._p2pConnection.unmuteRemote(n)})()}muteLocal(n){var i=this;return x(function*(){return yield i._p2pConnection.muteLocal(n)})()}unmuteLocal(n){var i=this;return x(function*(){return yield i._p2pConnection.unmuteLocal(n)})()}restartICE(n){var i=this;return Ro(function*(){return yield*lm(mO(i._p2pConnection.restartICE(n)))})()}close(){var n;null===(n=this._nvMedia)||void 0===n||n.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(n){return this._p2pConnection.getRemoteVideoIsReady(n)}updateRemoteConnect(n){var i;null===(i=this._nvMedia)||void 0===i||i.setRemoteRtpCapabilities(n),this._p2pConnection.updateRemoteConnect(n)}updateEncoderConfig(n,i){var s=this;return x(function*(){return yield s._p2pConnection.updateEncoderConfig(n,i)})()}updateSendParameters(n,i){var s=this;return x(function*(){return yield s._p2pConnection.updateSendParameters(n,i)})()}setStatsRemoteVideoIsReady(n,i){this._p2pConnection.setStatsRemoteVideoIsReady(n,i)}replaceTrack(n,i){var s=this;return x(function*(){return yield s._p2pConnection.replaceTrack(n,i)})()}getRemoteSSRC(n){var i=this;return x(function*(){return i._p2pConnection.getRemoteSSRC(n)})()}logSDPExchange(n,i,s,c){if(B("SDP_LOGGING"))return I.upload("exchanging ".concat(s," ").concat(i," SDP during DataChannelConnection.").concat(c,"\n"),n),"offer"===i?d=>{this.logSDPExchange(d,"answer","local"===s?"remote":"local",c)}:void 0}static resolvePCConfiguration(n){const i={iceServers:[]};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(hd(n.turnServer.servers)?i.iceServers=n.turnServer.servers:(i.iceServers&&i.iceServers.push(...Zn.turnServerConfigToIceServers(n.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...Zn.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Qf(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!B("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=n=>{var i;return null===(i=this.onICEConnectionStateChange)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onConnectionStateChange=n=>{var i;return null===(i=this.onConnectionStateChange)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onDTLSTransportStateChange=n=>{var i;return null===(i=this.onDTLSTransportStateChange)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onDTLSTransportError=n=>{var i;return null===(i=this.onDTLSTransportError)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onICETransportStateChange=n=>{var i;return null===(i=this.onICETransportStateChange)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onFirstAudioReceived=n=>{var i;return null===(i=this.onFirstAudioReceived)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onFirstVideoReceived=n=>{var i;return null===(i=this.onFirstVideoReceived)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onFirstAudioDecoded=n=>{var i;return null===(i=this.onFirstAudioDecoded)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onFirstVideoDecoded=(n,i,s)=>{var c;return null===(c=this.onFirstVideoDecoded)||void 0===c?void 0:c.call(this,n,i,s)},this._p2pConnection.onFirstVideoDecodedTimeout=n=>{var i;return null===(i=this.onFirstVideoDecodedTimeout)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onSelectedLocalCandidateChanged=(n,i)=>{var s;return null===(s=this.onSelectedLocalCandidateChanged)||void 0===s?void 0:s.call(this,n,i)},this._p2pConnection.onSelectedRemoteCandidateChanged=(n,i)=>{var s;return null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s?void 0:s.call(this,n,i)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0}setConfiguration(n){this._p2pConnection.setConfiguration(n)}}function Zo(o,n,i){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=x(function*(){const c=this.mutex,d=yield c.lock("From DataChannelConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),i}function Qb(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function _O(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?Qb(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Qb(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}te([Zo,P("design:type",Function),P("design:paramtypes",[Object,Object,Array,Object,String,String]),P("design:returntype",z)],Zn.prototype,"connect",null),te([Zo,P("design:type",Function),P("design:paramtypes",[Object,Array]),P("design:returntype",z)],Zn.prototype,"createDataChannels",null),te([Zo,P("design:type",Function),P("design:paramtypes",[String,Array,String,Object]),P("design:returntype",z)],Zn.prototype,"receive",null),te([Zo,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],Zn.prototype,"stopReceiving",null),te([Zo,P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],Zn.prototype,"muteRemote",null),te([Zo,P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],Zn.prototype,"unmuteRemote",null),te([Zo,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],Zn.prototype,"muteLocal",null),te([Zo,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],Zn.prototype,"unmuteLocal",null),te([Zo,P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],Zn.prototype,"close",null),te([Zo,P("design:type",Function),P("design:paramtypes",[String,wi]),P("design:returntype",z)],Zn.prototype,"updateEncoderConfig",null),te([Zo,P("design:type",Function),P("design:paramtypes",[String,wi]),P("design:returntype",z)],Zn.prototype,"updateSendParameters",null),te([Zo,P("design:type",Function),P("design:paramtypes",[wi,String]),P("design:returntype",z)],Zn.prototype,"replaceTrack",null),te([Zo,P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],Zn.prototype,"getRemoteSSRC",null);class Cx extends kt{constructor(){super(),C(this,"uplinkStatsUploadInterval",void 0),C(this,"uplinkRelatedStatsUploadInterval",void 0),C(this,"uplinkDenoiserStatsUploadInterval",void 0),C(this,"transportStatsUploadInterval",void 0),C(this,"uplinkExtensionStatsUploadInterval",void 0),C(this,"downlinkExtensionStatsUploadInterval",void 0),C(this,"extensionUsageStatsUploadInterval",void 0),C(this,"downlinkStatsUploadInterval",void 0),C(this,"downlinkRelatedStatsUploadInterval",void 0),C(this,"lastStats",void 0),C(this,"uploadUnplinkStarted",!1),C(this,"uploadDownlinkStarted",!1),C(this,"uploadTransportStarted",!1),C(this,"uploadExtensionUsageStarted",!1),C(this,"requestStats",void 0),C(this,"requestTransportStats",void 0),C(this,"requestLocalMedia",void 0),C(this,"requestRemoteMedia",void 0),C(this,"requestAllTracks",void 0),C(this,"requestVideoIsReady",void 0),C(this,"requestUpload",void 0)}startUploadTransportStats(n){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var i;const s=null===(i=this.requestStats)||void 0===i?void 0:i.call(this);if(s){const d=qL(s);if(n){var c;const h=null===(c=this.requestStats)||void 0===c?void 0:c.call(this,!0);if(h){const p=qL(h);d.connectionType+=p.connectionType<<3}d.connectionType+=110}else d.connectionType+=100;ms(()=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,Fr.TRANSPORT_STATS,d)})}},1e3))}startUploadExtensionUsageStats(){var n=this;if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const i=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(x(function*(){var s,c,d;const h=Date.now(),p={connectionInterval:B("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:h};let m=[];const _=(null===(s=n.requestAllTracks)||void 0===s?void 0:s.call(n))||[];for(const T of _)!T.muted&&T.enabled&&(m=m.concat(yield T.getProcessorUsage()));const E=(null===(c=n.requestRemoteMedia)||void 0===c?void 0:c.call(n))||[];for(const[T,O]of E)O.has(_e.VIDEO)&&T.videoTrack&&(m=m.concat(yield T.videoTrack.getProcessorUsage())),O.has(_e.AUDIO)&&T.audioTrack&&(m=m.concat(yield T.audioTrack.getProcessorUsage()));if(0===m.length)return;p.details=function(T,O){const N={};for(const{id:U,value:Y,level:re,direction:K}of T){var w;const $=null!==(w=O.get(U))&&void 0!==w?w:0,X=2===Y?$+B("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:$;var k,V;O.set(U,X),N[U]?(2===Y&&(N[U].value=Y),re>N[U].level&&(N[U].level=re),"remote"===K&&(N[U].remoteUidCount+=1),N[U].totalTs=null!==(k=O.get(U))&&void 0!==k?k:0):N[U]={value:Y,level:re,remoteUidCount:"local"===K?0:1,totalTs:null!==(V=O.get(U))&&void 0!==V?V:0}}return Object.keys(N).map(U=>{const{level:Y,value:re,totalTs:K}=N[U];return{id:U,level:Y,value:re,totalTs:K}})}(m,i);const y=Date.now();null===(d=n.requestUpload)||void 0===d||d.call(n,Fr.EXTENSION_USAGE_STATS,{usageStats:p,sendTs:y>h?y:h+1})}),B("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var n;const i=null===(n=this.requestStats)||void 0===n?void 0:n.call(this);i&&(this.uploadUplinkStats(i),this.lastStats=i)},3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var n;const i=null===(n=this.requestStats)||void 0===n?void 0:n.call(this);i&&this.uploadRelatedUplinkStats(i,this.lastStats),this.lastStats=i},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var n;const i=null===(n=this.requestAllTracks)||void 0===n?void 0:n.call(this);i&&this.uploadDenoiserStats(i)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var n;const i=null===(n=this.requestAllTracks)||void 0===n?void 0:n.call(this);i&&this.uploadExtensionStats(i)},2e3))}uploadUplinkStats(n){var i;((null===(i=this.requestLocalMedia)||void 0===i?void 0:i.call(this))||[]).forEach(s=>{let[c,{track:d,ssrcs:h}]=s;switch(c){case ne.LocalVideoLowTrack:case ne.LocalVideoTrack:{const p=function(E,y,S){var T;const O=y.videoSend.find(w=>w.ssrc===E);if(!O)return null;const N={id:Ot(10,""),timestamp:new Date(y.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:O.ssrc.toString()};switch(N.A_vstd=S._originMediaStreamTrack&&!S._originMediaStreamTrack.enabled||S._mediaStreamTrack&&!S._mediaStreamTrack.enabled?"1":"0",O.sentFrame&&(N.A_fhs=O.sentFrame.height.toString(),N.A_frs=O.sentFrame.frameRate.toString(),N.A_fws=O.sentFrame.width.toString()),O.adaptionChangeReason){case"none":N.A_ac="0";break;case"cpu":N.A_ac="1";break;case"bandwidth":N.A_ac="2";break;case"other":N.A_ac="3"}return N.A_lvps=GC[S._player?S._player.videoElementStatus:"uninit"].toString(),N.A_nr=null===(T=O.nacksCount)||void 0===T?void 0:T.toString(),O.avgEncodeMs&&(N.A_aem=O.avgEncodeMs.toFixed(0).toString()),B("P2P")&&(O.bytes&&(N.bytesSent=O.bytes.toString()),"number"==typeof O.packetsLost&&(N.packetsLost=O.packetsLost.toString()),O.packets&&(N.packetsSent=O.packets.toString())),N}(h[0].ssrcId,n,d),m=c===ne.LocalVideoTrack?function(E,y,S){var T,O,N,w,k,V,U,Y;const re=y.videoSend.find(Ee=>Ee.ssrc===E);if(!re)return null;const K={id:Ot(10,""),timestamp:new Date(y.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:re.ssrc.toString()},$=null!==(T=null!==(O=null===(N=re.inputFrame)||void 0===N?void 0:N.height)&&void 0!==O?O:S?._videoHeight)&&void 0!==T?T:0,X=null!==(w=null!==(k=null===(V=re.inputFrame)||void 0===V?void 0:V.width)&&void 0!==k?k:S?._videoWidth)&&void 0!==w?w:0,J=null!==(U=null===(Y=re.inputFrame)||void 0===Y?void 0:Y.frameRate)&&void 0!==U?U:0;return $&&(K.A_fhi=$+""),X&&(K.A_fwi=X+""),J&&(K.A_fri=J+""),K}(h[0].ssrcId,n,d):null;p&&ms(()=>{var E;return null===(E=this.requestUpload)||void 0===E?void 0:E.call(this,Fr.PUBLISH_STATS,{stream_type:c===ne.LocalVideoLowTrack?"low":"high",stats:_O(_O({},p),m)})});const _=function(E){const y={id:"bweforvideo",timestamp:new Date(E.timestamp).toISOString(),type:"VideoBwe"};return E.bitrate.retransmit&&(y.A_rb=E.bitrate.retransmit.toString()),E.bitrate.targetEncoded&&(y.A_teb=E.bitrate.targetEncoded.toString()),y.A_aeb=E.bitrate.actualEncoded.toString(),y.A_tb=E.bitrate.transmit.toString(),void 0!==E.sendBandwidth&&(y.A_asb=E.sendBandwidth.toString()),y}(n);_&&setTimeout(()=>{var E;return null===(E=this.requestUpload)||void 0===E?void 0:E.call(this,Fr.PUBLISH_STATS,{stream_type:c===ne.LocalVideoLowTrack?"low":"high",stats:_})},1e3);break}case ne.LocalAudioTrack:{const p=function(m,_,E){const y=_.audioSend.find(T=>T.ssrc===m);if(!y)return null;const S={id:Ot(10,""),timestamp:new Date(_.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:y.ssrc.toString()};return S.A_astd=E._originMediaStreamTrack&&!E._originMediaStreamTrack.enabled||E._mediaStreamTrack&&!E._mediaStreamTrack.enabled?"1":"0",S.A_ail=y.inputLevel?Math.round(100*y.inputLevel).toString():Math.round(100*E._source.getAccurateVolumeLevel()).toString(),S.A_apil=Math.round(100*E._source.getAccurateVolumeLevel()).toString(),y.aecReturnLoss&&(S.A_ecrl=Math.round(y.aecReturnLoss).toString()),y.aecReturnLossEnhancement&&(S.A_ecrle=Math.round(y.aecReturnLossEnhancement).toString()),B("P2P")&&(y.bytes&&(S.bytesSent=y.bytes.toString()),"number"==typeof y.packetsLost&&(S.packetsLost=y.packetsLost.toString()),y.packets&&(S.packetsSent=y.packets.toString())),S}(h[0].ssrcId,n,d);p&&ms(()=>{var m;return null===(m=this.requestUpload)||void 0===m?void 0:m.call(this,Fr.PUBLISH_STATS,{stream_type:"high",stats:p})});break}}})}uploadRelatedUplinkStats(n,i){var s;((null===(s=this.requestLocalMedia)||void 0===s?void 0:s.call(this))||[]).filter(c=>{let[d]=c;return d===ne.LocalVideoLowTrack||d===ne.LocalVideoTrack}).forEach(c=>{let[d,{ssrcs:h}]=c;const p=function(m,_){const E=_.videoSend.find(y=>y.ssrc===m);return E?{mediaType:"video",isVideoMute:!1,frameRateInput:E.inputFrame&&E.inputFrame.frameRate.toString(),frameRateSent:E.sentFrame&&E.sentFrame.frameRate.toString(),googRtt:E.rttMs.toString(),qpSumPerFrame:Math.floor(E.qpSumPerFrame).toString()}:null}(h[0].ssrcId,n);p&&ms(()=>{var m;null===(m=this.requestUpload)||void 0===m||m.call(this,Fr.PUBLISH_RELATED_STATS,{stream_type:d===ne.LocalVideoLowTrack?"low":"high",stats:p})})})}uploadDenoiserStats(n){for(let d=0;d<n.length;d++){const h=n[d];if(h instanceof Qi){var i,s,c;const p=null===(i=(s=h._external).getDenoiserStats)||void 0===i?void 0:i.call(s);return void(p&&(null===(c=this.requestUpload)||void 0===c||c.call(this,Fr.DENOISER_STATS,p)))}}}uploadExtensionStats(n){for(let i=0;i<n.length;i++)n[i].getProcessorStats().forEach(s=>{var c;null===(c=this.requestUpload)||void 0===c||c.call(this,s.type,s.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let n;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let i=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var s;const c=null===(s=this.requestStats)||void 0===s?void 0:s.call(this,!0);c&&(this.uploadDownlinkStats(c,i,n),n=c),i=!i},3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var s;const c=null===(s=this.requestStats)||void 0===s?void 0:s.call(this,!0);c&&(this.uploadRelatedDownlinkStats(c,this.lastStats),this.lastStats=c)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var s;const c=null===(s=this.requestRemoteMedia)||void 0===s?void 0:s.call(this);c&&this.uploadDownlinkExtensionStats(c)},2e3)}uploadDownlinkStats(n,i,s){var c;((null===(c=this.requestRemoteMedia)||void 0===c?void 0:c.call(this))||[]).forEach(d=>{let[h,p]=d;if(p.has(_e.VIDEO)&&h.videoTrack){const m=h.videoTrack?function(_,E,y,S,T){const O=E.videoRecv.find(V=>V.ssrc===_);if(!O)return null;const N={id:Ot(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:O.ssrc.toString()};var w,k;if(N.bytesReceived=O.bytes.toString(),N.packetsLost=O.packetsLost.toString(),N.packetsReceived=O.packets.toString(),O.framesRateFirefox&&(N.A_frr=O.framesRateFirefox.toString()),O.receivedFrame?(N.A_frr=O.receivedFrame.frameRate.toString(),N.A_fhr=O.receivedFrame.height.toString(),N.A_fwr=O.receivedFrame.width.toString()):(N.A_fhr=null===(w=S._videoHeight)||void 0===w?void 0:w.toString(),N.A_fwr=null===(k=S._videoWidth)||void 0===k?void 0:k.toString()),N.A_frd=O.decodeFrameRate.toString(),O.outputFrame&&(N.A_fro=O.outputFrame.frameRate.toString()),void 0!==O.jitterBufferMs&&(N.A_jbm=Math.floor(O.jitterBufferMs).toString()),void 0!==O.currentDelayMs&&(N.A_cdm=Math.floor(O.currentDelayMs).toString()),N.A_fs=O.firsCount.toString(),N.A_ns=O.nacksCount.toString(),N.A_ps=O.plisCount.toString(),S&&(N.A_vrtd=S._originMediaStreamTrack.enabled&&S._mediaStreamTrack.enabled?"0":"1"),S._player&&S._player.freezeTimeCounterList.length>0&&(N.A_vrft=Math.round(S._player.freezeTimeCounterList.splice(0,1)[0]).toString()),T&&S._player&&"visible"===Vi.visibility){const V=Math.min(6e3,S._player.renderFreezeAccTime);N.A_vrrft=Math.round(V).toString(),S._player.renderFreezeAccTime=Math.max(0,S._player.renderFreezeAccTime-V)}if(N.A_rvps=GC[S._player?S._player.videoElementStatus:"uninit"].toString(),y){const V=y.videoRecv.find(U=>U.ssrc===_);if(V&&void 0!==O.totalInterFrameDelay&&void 0!==O.totalSquaredInterFrameDelay&&void 0!==V.totalInterFrameDelay&&void 0!==V.totalSquaredInterFrameDelay){const U=O.totalInterFrameDelay-V.totalInterFrameDelay,re=O.framesDecodeCount-V.framesDecodeCount,K=U/re*1e3,$=Math.round(1e3*Math.sqrt((O.totalSquaredInterFrameDelay-V.totalSquaredInterFrameDelay-Math.pow(U,2)/re)/re));!isNaN($)&&K+$>Math.max(3*K,K+150)&&(N.A_ifdsd=$.toString())}}return N}(h._videoSSRC,n,s,h.videoTrack,i):void 0;m&&ms(()=>{var _;return null===(_=this.requestUpload)||void 0===_?void 0:_.call(this,Fr.SUBSCRIBE_STATS,{stream_id:h.uid,stats:m})})}if(p.has(_e.AUDIO)&&h.audioTrack){const m=h.audioTrack?function(_,E,y,S){const T=E.audioRecv.find(N=>N.ssrc===_);if(!T)return null;const O={id:Ot(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:T.ssrc.toString()};if(O.bytesReceived=T.bytes.toString(),O.packetsLost=T.packetsLost.toString(),O.packetsReceived=T.packets.toString(),O.A_aol=T.outputLevel?Math.round(100*T.outputLevel).toString():Math.round(100*S._source.getAccurateVolumeLevel()).toString(),O.A_apol=Math.round(100*S._source.getAccurateVolumeLevel()).toString(),S&&(O.A_artd=S._originMediaStreamTrack.enabled&&S._mediaStreamTrack.enabled?"0":"1"),O.A_jr=T.jitterMs.toString(),O.A_jbm=Math.floor(T.jitterBufferMs).toString(),O.A_cdm=Math.floor(T.jitterBufferMs).toString(),O.A_raps=GC[on.getPlayerState(S.getTrackId())].toString(),y){const N=y.audioRecv.find(w=>w.ssrc===_);if(N){const w=T.concealedSamples-N.concealedSamples;w>0&&(O.A_cs=Math.round(w).toString())}}return O}(h._audioSSRC,n,s,h.audioTrack):void 0;m&&ms(()=>{var _;return null===(_=this.requestUpload)||void 0===_?void 0:_.call(this,Fr.SUBSCRIBE_STATS,{stream_id:h.uid,stats:m})})}})}uploadRelatedDownlinkStats(n,i){var s;((null===(s=this.requestRemoteMedia)||void 0===s?void 0:s.call(this))||[]).forEach(c=>{let[d,h]=c;if(h.has(_e.VIDEO)&&d.videoTrack){var p;const m=!0===(d._videoSSRC&&(null===(p=this.requestVideoIsReady)||void 0===p?void 0:p.call(this,d._videoSSRC))||!1),_=function(E,y,S,T,O,N){const w=S.videoRecv.find(Y=>Y.ssrc===E),k=O?O.videoRecv.find(Y=>Y.ssrc===E):void 0;if(!w)return null;const V=Ud.isRemoteVideoFreeze(N,w,k)&&y,U={mediaType:"video",isVideoMute:!1,peerId:T,frameRateReceived:w.receivedFrame&&w.receivedFrame.frameRate.toString(),frameRateDecoded:w.decodedFrame&&w.decodedFrame.frameRate.toString(),isFreeze:V,bytesReceived:w.bytes.toString(),packetsReceived:w.packets.toString(),packetsLost:w.packetsLost.toString(),qpSumPerFrame:Math.floor(w.qpSumPerFrame).toString()};return w.framesRateFirefox&&(U.frameRateDecoded=w.framesRateFirefox.toString(),U.frameRateReceived=w.framesRateFirefox.toString()),U}(d._videoSSRC,m,n,d.uid,i,d.videoTrack);_&&ms(()=>{var E;null===(E=this.requestUpload)||void 0===E||E.call(this,Fr.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:_})})}if(h.has(_e.AUDIO)&&d.audioTrack){const m=function(_,E,y,S){const T=E.audioRecv.find(N=>N.ssrc===_);if(!T)return null;const O=Ud.isRemoteAudioFreeze(S);return{mediaType:"audio",isAudioMute:!1,peerId:y,googJitterReceived:T.jitterMs.toString(),isFreeze:O,bytesReceived:T.bytes.toString(),packetsReceived:T.packets.toString(),packetsLost:T.packetsLost.toString(),frameReceived:T.receivedFrames.toString(),frameDropped:T.droppedFrames.toString()}}(d._audioSSRC,n,d.uid,d.audioTrack);m&&ms(()=>{var _;null===(_=this.requestUpload)||void 0===_||_.call(this,Fr.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:m})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(n){n.forEach(i=>{let[s,c]=i;c.has(_e.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(d=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,d.type,d.stats)}),c.has(_e.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(d=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,d.type,d.stats)})})}}function gO(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Oc(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?gO(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):gO(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function bx(o){var n,i,s,c=2;for(typeof Symbol<"u"&&(i=dm,s=Symbol.iterator);c--;){if(i&&null!=(n=o[i]))return n.call(o);if(s&&null!=(n=o[s]))return new Lh(n.call(o));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function Lh(o){function n(i){if(Object(i)!==i)return z.reject(new TypeError(i+" is not an object."));var s=i.done;return z.resolve(i.value).then(function(c){return{value:c,done:s}})}return(Lh=function(i){this.s=i,this.n=i.next}).prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return void 0===s?z.resolve({value:i,done:!0}):n(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return void 0===s?z.reject(i):n(s.apply(this.s,arguments))}},new Lh(o)}class Ci extends kt{get state(){return this._state}set state(n){const i=this._state;this._state=n,this.emit(Re.StateChange,i,this._state)}constructor(n,i){var s;super(),s=this,C(this,"store",void 0),C(this,"statsUploader",void 0),C(this,"connection",void 0),C(this,"localTrackMap",new Map),C(this,"remoteUserMap",new Map),C(this,"localDataChannels",[]),C(this,"remoteDataChannelMap",new Map),C(this,"pendingLocalTracks",[]),C(this,"pendingRemoteTracks",[]),C(this,"pendingLocalDataChannels",[]),C(this,"pendingRemoteDataChannels",[]),C(this,"statsCollector",void 0),C(this,"isPlanB",!1),C(this,"shouldForwardP2PCreation",void 0),C(this,"iceFailedCount",0),C(this,"dtlsFailedCount",0),C(this,"mutex",new li("P2PChannel-mutex")),C(this,"_state",et.Disconnected),C(this,"_pcStatsUploadType",B("NEW_ICE_RESTART")?Ri.FIRST_CONNECTION:Ri.OLD_FIRST_CONNECTION),C(this,"_isInRestartIce",!1),C(this,"_isStartRestartIce",!1),C(this,"_restartStates",["disconnected","failed"]),C(this,"_restartTimer",void 0),C(this,"_isFirstConnected",!0),C(this,"handleMuteLocalTrack",function(){var c=x(function*(d,h,p){const m=yield s.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!s.connection||s.state!==et.Connected)return void p(new Q(M.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const _=s.filterTobeMutedTracks(d);if(0===_.length)return void h();const E=_.find(S=>"videoLowTrack"===S[0]);E&&E[1].track._originMediaStreamTrack.stop(),yield s.connection.muteLocal(_.map(S=>{let[,{id:T}]=S;return T}));const y=s.createMuteMessage(_);yield St(s,Re.RequestMuteLocal,y),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),C(this,"handleUnmuteLocalTrack",function(){var c=x(function*(d,h,p){const m=yield s.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!s.connection||s.state!==et.Connected)return void p(new Q(M.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const _=s.filterTobeUnmutedTracks(d);if(0===_.length)return void h();const E=_.find(S=>"videoLowTrack"===S[0]);if(E){const S=E[1];if(S.track._originMediaStreamTrack.stop(),!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ut().supportDualStreamEncoding){const T=d._mediaStreamTrack.clone();S.track._mediaStreamTrack=T,S.track._originMediaStreamTrack=T}else{const T=Hd(d,_c(s,Re.RequestLowStreamParameter));S.track._mediaStreamTrack=T,S.track._originMediaStreamTrack=T}yield new z((T,O)=>{s.handleReplaceTrack(S.track,T,O,!0)})}yield s.connection.unmuteLocal(_.map(S=>{let[,{id:T}]=S;return T}));const y=s.createUnmuteMessage(_);yield St(s,Re.RequestUnmuteLocal,y),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),C(this,"handleUpdateVideoEncoder",function(){var c=x(function*(d,h,p){const m=yield s.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const _=s.localTrackMap.get(ne.LocalVideoTrack);if(!s.connection||!_||_.track!==d||s.state!==et.Connected)return void h();const{id:E,track:y}=_;yield s.connection.updateSendParameters(E,y),yield s.connection.updateEncoderConfig(E,y),s.emit(Re.UpdateVideoEncoder,y),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),C(this,"handleSetOptimizationMode",function(){var c=x(function*(d,h,p){const m=yield s.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const _=s.localTrackMap.get(ne.LocalVideoTrack);if(!s.connection||!_||_.track!==d||s.state!==et.Connected)return;const{id:E,track:y}=_;yield s.connection.updateSendParameters(E,y),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),C(this,"handleReplaceTrack",function(){var c=x(function*(d,h,p,m){let _;I.debug("[".concat(s.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(d.getTrackId(),"]")),"boolean"==typeof m&&m||(_=yield s.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var E;const S=Array.from(s.localTrackMap.entries()).find(T=>{let[,{track:O}]=T;return d===O});if(!s.connection||!S||s.state!==et.Connected)return void h();if(yield null===(E=s.connection)||void 0===E?void 0:E.replaceTrack(d,S[1].id),s.isPlanB){const T=S[1];T.id=d._mediaStreamTrack.id,s.localTrackMap.set(S[0],T)}if(S[0]===ne.LocalVideoTrack&&!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ut().supportDualStreamEncoding){const T=s.localTrackMap.get(ne.LocalVideoLowTrack);if(T){const O=d._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=O,T.track._originMediaStreamTrack=O,yield new z((N,w)=>{s.handleReplaceTrack(T.track,N,w,!0)})}}h()}catch(S){p(S)}finally{var y;null===(y=_)||void 0===y||y()}});return function(d,h,p,m){return c.apply(this,arguments)}}()),C(this,"handleGetLocalVideoStats",c=>{c(this.statsCollector.getLocalVideoTrackStats())}),C(this,"handleGetLocalAudioStats",c=>{c(this.statsCollector.getLocalAudioTrackStats())}),C(this,"handleGetRemoteVideoStats",c=>this.statsCollector.getRemoteVideoTrackStats(c.uid)[c.uid]),C(this,"handleGetRemoteAudioStats",c=>this.statsCollector.getRemoteAudioTrackStats(c.uid)[c.uid]),this.store=n,this.statsCollector=i,this.statsCollector.addP2PChannel(this),this.statsUploader=new Cx,this.bindStatsUploaderEvents(),this.isPlanB=!Ut().supportUnifiedPlan||B("CHROME_FORCE_PLAN_B")&&pc(),this.shouldForwardP2PCreation=B("FORWARD_P2P_CREATION")&&Ut().supportPCSetConfiguration&&function(){const c=Dg();return c===ii.ANDROID||c===ii.IOS||c===ii.HARMONY_OS}(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Zn({},this.store):this.isPlanB?new kn({},this.store):new si({},this.store),this.bindConnectionEvents(this.connection))}startP2PConnection(n,i){var s=this;return x(function*(){var c;s.state=et.New;const d=s.shouldForwardP2PCreation&&"closed"===(null===(c=s.connection)||void 0===c?void 0:c.peerConnectionState);if(s.shouldForwardP2PCreation&&!d||(d&&s.connection&&(I.warning("[".concat(s.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),s.connection.close(),s.unbindConnectionEvents(s.connection)),s.connection=s.store.useDataChannel?new Zn(n,s.store):s.isPlanB?new kn(n,s.store):new si(n,s.store),s.bindConnectionEvents(s.connection)),!s.connection)throw new Q(M.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return s._pcStatsUploadType=B("NEW_ICE_RESTART")?Ri.FIRST_CONNECTION:Ri.OLD_FIRST_CONNECTION,s._isFirstConnected=!0,s._isInRestartIce=!1,s._isStartRestartIce=!1,s.connection.setConfiguration(n),s.connection.establishPromise})()}connect(n,i,s,c,d,h){var p=this;return x(function*(){if(!p.connection)throw new Q(M.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");p.connection instanceof Zn?p.connection.updateRemoteConnect(c):(p.store.peerConnectionStart(),yield p.connection.connect(n,i,s,c,d,h),p.statsUploader.startUploadTransportStats(),p.statsUploader.startUploadExtensionUsageStats(),p.state=et.Connected)})()}preConnect(n,i,s,c,d,h){var p=this;return x(function*(){if(!p.connection)throw new Q(M.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");p.store.peerConnectionStart();const m=yield p.connection.connect(n,i,s,c,d,h);return p.statsUploader.startUploadTransportStats(),p.statsUploader.startUploadExtensionUsageStats(),p.state=et.Connected,m})()}getEstablishParams(){if(this.connection instanceof Zn)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publishDataChannel(n){var i=this;return x(function*(){if(!i.connection){if(i.state===et.Disconnected)throw new Q(M.UNEXPECTED_ERROR,"PeerConnection already disconnected.");const c=n.filter(d=>-1!==i.pendingLocalDataChannels.findIndex(h=>h.id===d.id));return void(i.pendingLocalDataChannels=i.pendingLocalDataChannels.concat(c))}const s=i.filterTobePublishedDataChannels(n);0!==s.length&&(s.forEach(c=>{const d=Date.now();i.store.publish(c.id.toString(),"datachannel",d)}),yield i.connection.createDataChannels(i.store.uid,s),s.forEach(c=>{i.localDataChannels.push(c);const d=Date.now();i.store.publish(c.id+"","datachannel",void 0,d)}))})()}publish(n,i,s){var c=this;return Ro(function*(){const d=yield lt(c.mutex.lock("From P2PChannel.publish"));try{if(!c.connection||c.state!==et.Connected){if(c.state===et.Disconnected)throw new Q(M.UNEXPECTED_ERROR,"PeerConnection already disconnected.");c.throwIfTrackTypeNotMatch(n);const p=n.filter(m=>-1===c.pendingLocalTracks.indexOf(m));return void(c.pendingLocalTracks=c.pendingLocalTracks.concat(p))}c.store.pubId=c.store.pubId+1,gi.markPublishStart(c.store.clientId,c.store.pubId);const h=c.filterTobePublishedTracks(n,i,s);if(0===h.length)return void(yield lt(c.tryToUnmuteAudio(n)));yield*lm(bx(c.doPublish(c.connection,h)))}finally{d()}})()}doPublish(n,i){var s=this;return Ro(function*(){i.forEach(E=>{let{track:y,type:S}=E;const T=Date.now();s.store.publish(y.getTrackId(),S===ne.LocalAudioTrack?"audio":"video",T)}),s.bindLocalTrackEvents(i);const c=yield lt(n.send(i.map(E=>{let{track:y}=E;return y}),s.store.codec,s.store.audioCodec)),d=(yield lt(c.next())).value,h=s.createGatewayPublishMessage(i,d);let p;try{p=yield h}catch(E){throw c.throw(E),E?.code===M.WS_ABORT&&i.forEach(y=>{let{track:S}=y;-1===s.pendingLocalTracks.indexOf(S)&&s.pendingLocalTracks.push(S)}),s.unbindLocalTrackEvents(i),E}const m=s.mapPubResToRemoteConfig(h,p),_=(yield lt(c.next(m))).value;i.forEach(E=>{let{type:y}=E;s.statsCollector.addLocalStats(y)}),s.assignLocalTracks(i,_),s.statsUploader.startUploadUplinkStats(),i.forEach(E=>{let{track:y,type:S}=E;const T=Date.now();s.store.publish(y.getTrackId(),S===ne.LocalAudioTrack?"audio":"video",void 0,T)})})()}updateVideoStreamParameter(n,i){var s=this;return x(function*(){const c=s.localTrackMap.get(i);if(!c)return;if(!(c.track instanceof We))return I.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(s.connection instanceof si||s.connection instanceof kn))return I.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:d}=c,h=function(p,m){const _={};return p.height&&p.width&&(_.scaleResolutionDownBy=UE(p,m)),_.maxFramerate=p.framerate?Er(p.framerate):void 0,_.maxBitrate=p.bitrate?1e3*p.bitrate:void 0,_}(n,d);if(d._encoderConfig||(d._encoderConfig={}),i!==ne.LocalVideoLowTrack||!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ut().supportDualStreamEncoding)null!=h.scaleResolutionDownBy&&(d._encoderConfig.scaleResolutionDownBy=h.scaleResolutionDownBy);else{const p=d._originMediaStreamTrack;if(!p.canvas)return I.warn("[".concat(d.getTrackId(),"] no canvas on track"));!function(m,_){const E=m.canvas;_.width&&(E.width=Er(_.width)),_.height&&(E.height=Er(_.height)),_.framerate&&(E.stopCapture&&E.stopCapture(),E.stopCapture=oD(()=>{!E.startCapture&&E.stopCapture&&E.stopCapture(),E.startCapture&&E.startCapture()},Er(_.framerate)))}(p,n)}null!=h.maxBitrate&&(d._encoderConfig.bitrateMax=h.maxBitrate/1e3),null!=h.maxFramerate&&(d._encoderConfig.frameRate&&"object"==typeof d._encoderConfig.frameRate?d._encoderConfig.frameRate.max=h.maxFramerate:d._encoderConfig.frameRate={max:h.maxFramerate}),I.debug("[".concat(d.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(d._encoderConfig))),yield s.connection.updateRtpSenderEncodings(d)})()}publishLowStream(n){var i=this;return Ro(function*(){if(!i.connection||i.state!==et.Connected)return;const s=yield lt(i.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const d=i.localTrackMap.get(ne.LocalVideoTrack);if(!d)throw new Q(M.UNEXPECTED_ERROR,"Could not find high stream");if(i.localTrackMap.has(ne.LocalVideoLowTrack))throw new Q(M.UNEXPECTED_ERROR,"[".concat(i.store.clientId,"] Can't publish low stream when stream already publish"));const h=[{track:i.getLowVideoTrack(d.track,n),type:ne.LocalVideoLowTrack}];if(yield*lm(bx(i.doPublish(i.connection,h))),d.track.muted||!d.track.enabled){var c;const p=null===(c=i.localTrackMap.get(ne.LocalVideoLowTrack))||void 0===c?void 0:c.id;void 0!==p&&(yield lt(i.connection.muteLocal([p])))}}finally{s()}})()}republish(){var n=this;return x(function*(){n.pendingLocalTracks.length>0&&(I.debug("[".concat(n.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield dn(n,Re.RequestRePublish,n.pendingLocalTracks),n.emit(Re.MediaReconnectEnd,n.store.uid),n.pendingLocalTracks=[]),n.pendingLocalDataChannels.length>0&&(I.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),yield dn(n,Re.RequestRePublishDataChannel,n.pendingLocalDataChannels),n.pendingLocalDataChannels=[])})()}reSubscribe(n){var i=this;return x(function*(){for(let s=i.pendingRemoteTracks.length-1;s>=0;s--){const{user:c,kind:d}=i.pendingRemoteTracks[s];(d!==_e.AUDIO||c._audio_added_&&c._audioSSRC)&&(d!==_e.VIDEO||c._video_added_&&c._videoSSRC)||i.pendingRemoteTracks.splice(s,1)}if(n)yield dn(i,Re.RequestReSubscribe,i.pendingRemoteTracks);else for(const{user:s,kind:c}of i.pendingRemoteTracks)yield i.subscribe(s,c,c===_e.VIDEO?s._videoSSRC:s._audioSSRC);i.pendingRemoteTracks.forEach(s=>{let{user:c}=s;i.emit(Re.MediaReconnectEnd,c.uid)}),i.pendingRemoteTracks=[]})()}unpublish(n){var i=this;return x(function*(){if(!i.connection||i.state!==et.Connected)return void n.forEach(d=>{const h=i.pendingLocalTracks.indexOf(d);-1!==h&&i.pendingLocalTracks.splice(h,1)});const s=i.filterTobeUnpublishedTracks(n);if(0===s.length)return;const c=s.find(d=>"videoLowTrack"===d[0]);return c&&c[1].track.close(),i.doUnpublish(i.connection,s)})()}unpublishDataChannel(n){var i=this;return x(function*(){if(!i.connection||i.state!==et.Connected)return void n.forEach(c=>{const d=i.pendingLocalDataChannels.indexOf(c);-1!==d&&i.pendingLocalDataChannels.splice(d,1)});const s=i.filterTobeUnpublishedDataChannels(n);return 0!==s.length?(s.forEach(c=>{const d=i.localDataChannels.indexOf(c);-1!==d&&i.localDataChannels.splice(d,1)}),0===i.localDataChannels.length&&(yield i.connection.stopDataChannels(i.store.uid)),s.map(c=>c.id)):void 0})()}unpublishLowStream(){var n=this;return x(function*(){if(!n.connection||n.state!==et.Connected)return;const i=n.localTrackMap.get(ne.LocalVideoLowTrack);return i?(i.track.close(),n.doUnpublish(n.connection,[[ne.LocalVideoLowTrack,i]])):void 0})()}doUnpublish(n,i){var s=this;return x(function*(){const c=s.createGatewayUnpublishMessage(i);return yield n.stopSending(i.map(d=>{let[,{id:h}]=d;return h})),s.withdrawLocalTracks(i),s.unbindLocalTrackEvents(i.map(d=>{let[h,{track:p}]=d;return{type:h,track:p}})),i.forEach(d=>{let[h]=d;s.statsCollector.removeLocalStats(h)}),0===s.localTrackMap.size&&s.statsUploader.stopUploadUplinkStats(),c})()}subscribeDataChannel(n,i){var s=this;return x(function*(){if(!s.connection||s.state!==et.Connected)throw new Q(M.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const c=i.filter(d=>{var h;return!(null!==(h=s.remoteDataChannelMap.get(n))&&void 0!==h&&h.get(d.id))});if(0!==c.length)return yield s.connection.createDataChannels(n.uid,c),c.forEach(d=>{var h;s.remoteDataChannelMap.has(n)?null===(h=s.remoteDataChannelMap.get(n))||void 0===h||h.set(d.id,d):s.remoteDataChannelMap.set(n,new Map([[d.id,d]]));const p=s.pendingRemoteDataChannels.findIndex(m=>{let{user:_,id:E}=m;return _.uid===n.uid&&E===d.id});-1!==p&&s.pendingRemoteDataChannels.splice(p,1)}),c.map(d=>d.id)})()}subscribe(n,i,s,c,d){var h=this;return x(function*(){var p;if(!h.connection||h.state!==et.Connected)throw new Q(M.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(p=h.remoteUserMap.get(n))&&void 0!==p&&p.has(i))return;let m,_,E;if(d){const T=d.find(N=>{let{stream_type:w}=N;return w===i});if(!T)throw new Q(M.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(i," for user: ").concat(n.uid," because subscribe answer from gateway does not contain stream_type: ").concat(i,"."));const O=yield h.connection.receive(i,T.ssrcs,String(n._uintid),T.attributes);h.connection instanceof si&&(E=O.transceiver),m=O.track,_=O.id}else{const T=yield h.connection.receive(i,[{ssrcId:s,rtx:c}],String(n._uintid),void 0);h.connection instanceof si&&(E=T.transceiver),m=T.track,_=T.id}i===_e.AUDIO?(n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(m):(n._audioTrack=new ys(m,n.uid,n._uintid,h.store),I.info("[".concat(h.store.clientId,"] [").concat(h.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),E&&n._audioTrack._updateRtpTransceiver(E),h.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(m):(n._videoTrack=new Jt(m,n.uid,n._uintid,h.store),I.info("[".concat(h.store.clientId,"] [").concat(h.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),E&&n._videoTrack._updateRtpTransceiver(E),h.bindRemoteTrackEvents(n,n._videoTrack));const y=h.remoteUserMap.get(n);y?y.set(i,_):h.remoteUserMap.set(n,new Map([[i,_]])),h.statsCollector.addRemoteStats(n.uid),h.statsUploader.startUploadDownlinkStats();const S=h.pendingRemoteTracks.findIndex(T=>{let{user:O,kind:N}=T;return O.uid===n.uid&&i===N});-1!==S&&(h.pendingRemoteTracks.splice(S,1),h.emit(Re.MediaReconnectEnd,n.uid))})()}massSubscribe(n){var i=this;return x(function*(){return i.massSubscribeNoLock(n)})()}massSubscribeNoLock(n){var i=this;return x(function*(){if(!i.connection||i.state!==et.Connected)throw new Q(M.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");n=n.filter(c=>{var d;let{user:h,mediaType:p}=c;return!(null!==(d=i.remoteUserMap.get(h))&&void 0!==d&&d.has(p))});const s=yield i.connection.batchReceive(n.map(c=>{let{user:d,mediaType:h,ssrcId:p,rtxSsrcId:m}=c;return{kind:h,ssrcMsg:[{ssrcId:p,rtx:m}],mslabel:String(d._uintid)}}));n.forEach((c,d)=>{let{user:h,mediaType:p}=c;const{track:m,id:_,transceiver:E}=s[d];p===_e.AUDIO?(h._audioTrack?h._audioTrack._updateOriginMediaStreamTrack(m):(h._audioTrack=new ys(m,h.uid,h._uintid,i.store),I.info("[".concat(i.store.clientId,"] [").concat(i.store.p2pId,"] create remote audio track: ").concat(h._audioTrack.getTrackId()))),E&&h._audioTrack._updateRtpTransceiver(E),i.bindRemoteTrackEvents(h,h._audioTrack)):(h._videoTrack?h._videoTrack._updateOriginMediaStreamTrack(m):(h._videoTrack=new Jt(m,h.uid,h._uintid,i.store),I.info("[".concat(i.store.clientId,"] [").concat(i.store.p2pId,"] create remote video track: ").concat(h._videoTrack.getTrackId()))),E&&h._videoTrack._updateRtpTransceiver(E),i.bindRemoteTrackEvents(h,h._videoTrack));const y=i.remoteUserMap.get(h);y?y.set(p,_):i.remoteUserMap.set(h,new Map([[p,_]])),i.statsCollector.addRemoteStats(h.uid),i.statsUploader.startUploadDownlinkStats();const S=i.pendingRemoteTracks.findIndex(T=>{let{user:O,kind:N}=T;return O.uid===h.uid&&p===N});-1!==S&&(i.pendingRemoteTracks.splice(S,1),i.emit(Re.MediaReconnectEnd,h.uid))})})()}unsubscribe(n,i,s){var c=this;return x(function*(){const d=c.pendingRemoteTracks.filter(m=>{let{user:_,kind:E}=m;return void 0!==i?_.uid===n.uid&&i===E:_.uid===n.uid});if(d.forEach(m=>{const _=c.pendingRemoteTracks.indexOf(m);c.pendingRemoteTracks.splice(_,1)}),c.connection&&c.state===et.Connected||s||d.forEach(m=>{let{kind:_}=m;var E;if(_===_e.AUDIO)null===(E=n._audioTrack)||void 0===E||E._destroy(),n._audioTrack=void 0;else if(_===_e.VIDEO){var y;null===(y=n._videoTrack)||void 0===y||y._destroy(),n._videoTrack=void 0}}),!c.connection||c.state!==et.Connected)return;const h=c.filterTobeUnSubscribedTracks(n,i);if(0===h.length)return;yield c.connection.stopReceiving(h.map(m=>{let[,{id:_}]=m;return _}));const p=c.createUnsubscribeMessage(h);return c.withdrawRemoteTracks(h),0===c.remoteUserMap.size&&c.statsUploader.stopUploadDownlinkStats(),h.forEach(m=>{let[_,{kind:E}]=m;var y,S;if(E===_e.VIDEO&&_._videoSSRC&&(null===(y=c.connection)||void 0===y||y.setStatsRemoteVideoIsReady(_._videoSSRC,!1)),E===_e.VIDEO)c.unbindRemoteTrackEvents(_._videoTrack),s||(null===(S=_._videoTrack)||void 0===S||S._destroy(),_._videoTrack=void 0);else if(E===_e.AUDIO){var T;c.unbindRemoteTrackEvents(_._audioTrack),!s&&(null===(T=_._audioTrack)||void 0===T||T._destroy(),_._audioTrack=void 0)}}),p})()}unsubscribeDataChannel(n,i){var s=this;return x(function*(){if(i.forEach(h=>{const p=s.pendingRemoteDataChannels.findIndex(m=>m.id===h.id);-1!==p&&s.pendingRemoteDataChannels.splice(p,1)}),!s.connection)return;const c=s.filterTobeUnSubscribedDataChannels(n,i);if(0===c.length)return;i.forEach(h=>{h._close()});const d=s.remoteDataChannelMap.get(n);return c.forEach(h=>{d&&d.delete(h.id)}),d&&0===d.size&&(s.remoteDataChannelMap.delete(n),yield s.connection.stopDataChannels(n.uid)),c.map(h=>h.id)})()}massUnsubscribe(n){var i=this;return x(function*(){return i.massUnsubscribeNoLock(n)})()}massUnsubscribeNoLock(n){var i=this;return x(function*(){let s=[];for(const{user:h,mediaType:p}of n){const m=i.pendingRemoteTracks.filter(_=>{let{user:E,kind:y}=_;return void 0!==p?E.uid===h.uid&&p===y:E.uid===h.uid});m.forEach(_=>{const E=i.pendingRemoteTracks.indexOf(_);i.pendingRemoteTracks.splice(E,1)}),s=s.concat(m)}if(!i.connection||i.state!==et.Connected)return void s.forEach(h=>{let{user:p,kind:m}=h;var _;if(m===_e.AUDIO)null===(_=p._audioTrack)||void 0===_||_._destroy(),p._audioTrack=void 0;else if(m===_e.VIDEO){var E;null===(E=p._videoTrack)||void 0===E||E._destroy(),p._videoTrack=void 0}});const c=md(n).call(n,(h,p)=>{let{user:m,mediaType:_}=p;const E=i.filterTobeUnSubscribedTracks(m,_);return h.concat(E)},[]);if(0===c.length)return;yield i.connection.stopReceiving(c.map(h=>{let[,{id:p}]=h;return p}));const d=i.createUnsubscribeAllMessage(c);return i.withdrawRemoteTracks(c),0===i.remoteUserMap.size&&i.statsUploader.stopUploadDownlinkStats(),c.forEach(h=>{let[p,{kind:m}]=h;var _,E;if(m===_e.VIDEO&&p._videoSSRC&&(null===(_=i.connection)||void 0===_||_.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),m===_e.VIDEO)i.unbindRemoteTrackEvents(p._videoTrack),null===(E=p._videoTrack)||void 0===E||E._destroy(),p._videoTrack=void 0;else if(m===_e.AUDIO){var y;i.unbindRemoteTrackEvents(p._audioTrack),null===(y=p._audioTrack)||void 0===y||y._destroy(),p._audioTrack=void 0}}),d})()}muteRemote(n,i){var s=this;return x(function*(){if(!s.connection)return;const c=s.remoteUserMap.get(n);if(!c)return void I.warning("[".concat(s.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(n.uid,"."));if(!c.get(i))return void I.warning("[".concat(s.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(n.uid," media type ").concat(i,"."));const d=i===_e.VIDEO?n._videoSSRC:n._audioSSRC;void 0!==d&&s.connection.setStatsRemoteVideoIsReady(d,!1)})()}unmuteRemote(n,i){var s=this;return x(function*(){return s.unmuteRemoteNoLock(n,i)})()}unmuteRemoteNoLock(n,i){var s=this;return x(function*(){if(!s.connection)return;const c=s.remoteUserMap.get(n);c?c.get(i)||I.warning("[".concat(s.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(n.uid," media type ").concat(i,".")):I.warning("[".concat(s.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(n.uid,"."))})()}getAllTracks(n){const i=this.localTrackMap.get(ne.LocalAudioTrack);if(i?.track instanceof qn){const s=i.track;return Array.from(this.localTrackMap.entries()).filter(c=>{let[d]=c;return d!==ne.LocalAudioTrack}).filter(c=>{let[d]=c;return!(n&&d===ne.LocalVideoLowTrack)}).map(c=>{let[,{track:d}]=c;return d}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return!(n&&c===ne.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(n,i,s,c,d){if(n){const p=this.localTrackMap.get(ne.LocalAudioTrack),m=this.localTrackMap.get(c?ne.LocalVideoLowTrack:ne.LocalVideoTrack);ye.publish(this.store.sessionId,{eventElapse:gi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:i,audioName:p?.track.getTrackLabel(),videoName:m?.track.getTrackLabel(),screenshare:-1!==m?.track._hints.indexOf(qt.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}else{var h;s||(s=[]);const p=s.find(_=>_ instanceof ct),m=c?null===(h=this.localTrackMap.get(ne.LocalVideoTrack))||void 0===h?void 0:h.track:s.find(_=>_ instanceof We);ye.publish(this.store.sessionId,{eventElapse:gi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:i,audioName:p?.getTrackLabel(),videoName:m?.getTrackLabel(),screenshare:-1!==m?._hints.indexOf(qt.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}}reportSubscribeEvent(n,i,s,c){const d=c===_e.VIDEO?s._videoSSRC:s._audioSSRC;d&&ye.subscribe(this.store.sessionId,{succ:n,ec:i,video:c===_e.VIDEO,audio:c===_e.AUDIO,peerid:s.uid,subscribeRequestid:c===_e.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:gi.measureFromSubscribeStart(this.store.clientId,d)})}reset(){I.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new li("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Zn({},this.store):this.isPlanB?new kn({},this.store):new si({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const n=this.localTrackMap.get(ne.LocalAudioTrack);if(n?.track instanceof qn){if(n.track.trackList.length>0){const i=n.track;n.track.trackList.forEach(s=>{i.removeAudioTrack(s)})}n.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=et.Disconnected}getStats(){var n;return null===(n=this.connection)||void 0===n?void 0:n.getStats()}getRemoteVideoIsReady(n){var i;return(null===(i=this.connection)||void 0===i?void 0:i.getRemoteVideoIsReady(n))||!1}getLocalAudioVolume(){const n=this.localTrackMap.get(ne.LocalAudioTrack);if(n)return n.track.getVolumeLevel()}getLocalVideoSize(){const n=this.localTrackMap.get(ne.LocalVideoTrack);if(n)return{width:n.track._videoWidth||0,height:n.track._videoHeight||0}}getEncoderConfig(n){const i=this.localTrackMap.get(n);return i&&i.track instanceof We||i&&i.track instanceof ct?i.track._encoderConfig:void 0}getLocalMedia(n){return this.localTrackMap.get(n)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(n,i){if(!n)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(n);return!!s&&(!i||s.has(i))}hasRemoteMediaWithLock(n,i){var s=this;return x(function*(){if(!n)return s.remoteUserMap.size>0;const c=s.remoteUserMap.get(n);return!!c&&(!i||c.has(i))})()}getRemoteMedia(n){var i;const s=Array.from(Eo(i=this.remoteUserMap).call(i)).find(c=>c.uid===n);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let n=Array.from(this.remoteUserMap.entries()).map(s=>{let[c]=s;return{uid:c.uid,level:c.audioTrack?100*c.audioTrack._source.getAccurateVolumeLevel():0}});const i=this.localTrackMap.get(ne.LocalAudioTrack);return i&&n.push({level:100*i.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),n=Vp(n).call(n,(s,c)=>s.level-c.level),n}disconnectForReconnect(){var n=this;return x(function*(){n.connection&&(I.debug("[".concat(n.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),n.state=et.Reconnecting,B("KEEP_LAST_FRAME")&&0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(i=>{let[s]=i;var c;s._videoTrack&&s._videoTrack._player&&(null===(c=s._videoTrack._player.getVideoElement())||void 0===c||c.pause(),s._videoTrack._player.isKeepLastFrame=!0,s._videoTrack._originMediaStreamTrack.stop())}),n.connection.close(),n.unbindConnectionEvents(n.connection),n.connection=void 0,n.shouldForwardP2PCreation&&(n.connection=n.store.useDataChannel?new Zn({},n.store):n.isPlanB?new kn({},n.store):new si({},n.store),n.bindConnectionEvents(n.connection)),0!==n.localTrackMap.size&&(Array.from(n.localTrackMap.entries()).forEach(i=>{var s;let[c,{track:d}]=i;switch(c){case ne.LocalVideoTrack:be(s=d._hints).call(s,qt.LOW_STREAM)?d.close():n.pendingLocalTracks.push(d);break;case ne.LocalAudioTrack:d instanceof qn?n.pendingLocalTracks=n.pendingLocalTracks.concat(d.trackList):n.pendingLocalTracks.push(d)}}),n.emit(Re.MediaReconnectStart,n.store.uid)),n.unbindLocalTrackEvents(),n.localTrackMap.clear(),0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(i=>{let[s,c]=i;Array.from(Eo(c).call(c)).forEach(d=>{n.setPendingRemoteMedia(s,d)}),n.emit(Re.MediaReconnectStart,s.uid)}),n.unbindAllRemoteTrackEvents(),n.remoteUserMap.clear(),0!==n.localDataChannels.length&&(n.localDataChannels.forEach(i=>{n.pendingLocalDataChannels.push(i)}),n.localDataChannels.length=0),0!==n.remoteDataChannelMap.size&&(Array.from(n.remoteDataChannelMap.entries()).forEach(i=>{let[s,c]=i;Array.from(Eo(c).call(c)).forEach(d=>{n.setPendingRemoteDataChannel(s,d)})}),n.remoteDataChannelMap.clear()),n.statsUploader.stopUploadUplinkStats(),n.statsUploader.stopUploadDownlinkStats(),n.statsUploader.stopUploadTransportStats(),I.debug("[".concat(n.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))})()}hasPendingRemoteDataChannel(n,i){for(const s of this.pendingRemoteDataChannels){const{user:c,id:d}=s;if((n instanceof vi?n.uid:n)===c.uid&&d===i)return!0}return!1}setPendingRemoteDataChannel(n,i){this.hasPendingRemoteDataChannel(n,i)||this.pendingRemoteDataChannels.push({user:n,id:i})}hasPendingRemoteMedia(n,i){for(const s of this.pendingRemoteTracks){const{user:c,kind:d}=s;if((n instanceof vi?n.uid:n)===c.uid&&i===d)return!0}return!1}setPendingRemoteMedia(n,i){this.hasPendingRemoteMedia(n,i)||this.pendingRemoteTracks.push({user:n,kind:i})}restartICE(n){var i=this;return Ro(function*(){if(!i.connection||i.state!==et.Connected||i.connection instanceof Zn)return;const s=yield lt(i.mutex.lock("From P2PChannel.restartICE"));let c;try{c=yield lt(i.connection.restartICE(n));const h=yield lt(c.next());if(h.done)return;const p=h.value,m=yield p;switch(i.reportPCDisconnectedOrFailed(n),n){case Fi.TCP:i._pcStatsUploadType=Ri.TCP_RESTART;break;case Fi.RELAY:i._pcStatsUploadType=Ri.RELAY_RESTART;break;default:i._pcStatsUploadType=Ri.OLD_RESTART}i._isInRestartIce=!0,c.next(m)}catch(h){var d;null===(d=c)||void 0===d||d.throw(h)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const n=this.connection.getStats(),i=this.localTrackMap.get(ne.LocalVideoTrack),s=this.localTrackMap.get(ne.LocalAudioTrack),c=n.videoSend.find(O=>O.ssrc===i?.ssrcs[0].ssrcId),d=n.audioSend.find(O=>O.ssrc===s?.ssrcs[0].ssrcId);if(!c||!d)return 1;const h=to(this,Re.NeedSignalRTT),p=c?c.rttMs:void 0,m=d?d.rttMs:void 0,_=p&&m?(p+m)/2:p||m,y=100*n.sendPacketLossRate*.7/50+.3*((_&&h?(_+h)/2:_||h)||0)/1500,S=y<.17?1:y<.36?2:y<.59?3:y<.1?4:5,T=i?.track;if(T&&T._encoderConfig&&-1===T._hints.indexOf(qt.SCREEN_TRACK)){const O=T._encoderConfig.bitrateMax,N=n.bitrate.actualEncoded;if(O&&N){const w=(1e3*O-N)/(1e3*O);return oE[w<.15?0:w<.3?1:w<.45?2:w<.6?3:4][S]}}return S}getDownlinkNetworkQuality(){if(!this.connection)return 0;const n=this.connection.getStats();let i=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[c]=s;const d=c._audioSSRC,h=c._videoSSRC,p=n.audioRecv.find(N=>N.ssrc===d),m=n.videoRecv.find(N=>N.ssrc===h);if(!p&&!m)return void(i+=1);const _=to(this,Re.NeedSignalRTT),E=n.rtt,y=(E&&_?(E+_)/2:E||_)||0,S=p?p.jitterMs:void 0,T=n.recvPacketLossRate;let O=.7*T*100/50+.3*y/1500;S&&(O=.6*T*100/50+.2*y/1500+.2*S/400),i+=O<.1?1:O<.17?2:O<.36?3:O<.59?4:5}),this.remoteUserMap.size>0?Math.round(i/this.remoteUserMap.size):i}muteLocalTrack(n){var i=this;return x(function*(){return new z((s,c)=>{i.handleMuteLocalTrack(n,s,c)})})()}filterTobePublishedTracks(n,i,s){const c=[],d=Ut(),h=this.getAllTracks();n=pd(n=n.filter(_=>-1===h.indexOf(_)));let p=!1,m=!1;for(const _ of n){if(_ instanceof We&&(this.localTrackMap.has(ne.LocalVideoTrack)||p?new Q(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(c.push({track:_,type:ne.LocalVideoTrack}),p=!0),i)){const E=this.getLowVideoTrack(_,s);c.push({track:E,type:ne.LocalVideoLowTrack})}if(_ instanceof ct){const E=this.localTrackMap.get(ne.LocalAudioTrack);if(E){if(!(E.track instanceof qn))throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const y=c.find(S=>{let{type:T}=S;return T===ne.LocalAudioTrack});if(!(y.track instanceof qn))throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(_)}else{if(!d.webAudioMediaStreamDest||_ instanceof qn||_._bypassWebAudio)c.push({track:_,type:ne.LocalAudioTrack});else{const y=new qn;y.addAudioTrack(_),c.push({track:y,type:ne.LocalAudioTrack})}m=!0}}}return c}filterTobeUnpublishedTracks(n){const i=[],s=this.getAllTracks();n=pd(n=n.filter(c=>-1!==s.indexOf(c)));for(const c of n){if(c instanceof ct){const d=this.localTrackMap.get(ne.LocalAudioTrack);if(!d)continue;d.track instanceof qn?(d.track.removeAudioTrack(c),this.unbindLocalAudioTrackEvents(c),0===d.track.trackList.length&&(i.push([ne.LocalAudioTrack,d]),d.track.close())):i.push([ne.LocalAudioTrack,d])}if(c instanceof We){const d=this.localTrackMap.get(ne.LocalVideoTrack);if(!d)continue;i.push([ne.LocalVideoTrack,d]);const h=this.localTrackMap.get(ne.LocalVideoLowTrack);h&&i.push([ne.LocalVideoLowTrack,h])}}return i}filterTobePublishedDataChannels(n){return(n=pd(n)).filter(i=>-1===this.localDataChannels.findIndex(s=>s.id===i.id))}filterTobeUnpublishedDataChannels(n){return(n=(n=pd(n)).filter(i=>-1!==this.localDataChannels.indexOf(i))).filter(i=>i._originDataChannel)}bindLocalTrackEvents(n){n.forEach(i=>{let{track:s,type:c}=i;switch(c){case ne.LocalVideoTrack:s.addListener(me.GET_STATS,this.handleGetLocalVideoStats),s.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(me.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),s.addListener(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.bindLocalAudioTrackEvents(s)}})}bindLocalAudioTrackEvents(n,i){n instanceof qn?n.trackList.forEach(s=>{s.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(me.GET_STATS,this.handleGetLocalAudioStats),s.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.addListener(me.GET_STATS,this.handleGetLocalAudioStats),n.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),i||n.addListener(me.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(n){n||(n=Array.from(this.localTrackMap.entries()).map(i=>{let[s,{track:c}]=i;return{track:c,type:s}})),n.forEach(i=>{let{track:s,type:c}=i;switch(c){case ne.LocalVideoTrack:s.off(me.GET_STATS,this.handleGetLocalVideoStats),s.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(me.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),s.off(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s)}})}unbindLocalAudioTrackEvents(n){n instanceof qn?n.trackList.forEach(i=>{i.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(me.GET_STATS,this.handleGetLocalAudioStats),i.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.off(me.GET_STATS,this.handleGetLocalAudioStats),n.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(n,i){i instanceof Jt&&i.addListener(me.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(n))}),i instanceof ys&&i.addListener(me.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(n))})}unbindRemoteTrackEvents(n){n&&n.removeAllListeners(me.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i,s]=n;s.has(_e.AUDIO)&&this.unbindRemoteTrackEvents(i._audioTrack),s.has(_e.VIDEO)&&this.unbindRemoteTrackEvents(i._videoTrack)})}createGatewayPublishMessage(n,i){return n.map((s,c)=>{var d;let h,p,{track:m,type:_}=s;switch(_){case ne.LocalAudioTrack:h=It.Audio,p={dtx:m instanceof Qi&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ne.LocalVideoTrack:h=be(d=m._hints).call(d,qt.SCREEN_TRACK)?It.Screen:It.High,p=Oc(Oc({},Zf(m)),{},{codec:this.store.codec});break;case ne.LocalVideoLowTrack:h=It.Low,p=Oc(Oc({},Zf(m)),{},{codec:this.store.codec})}return{stream_type:h,attributes:p,ssrcs:i[c]}})}createGatewayUnpublishMessage(n){return n.map(i=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=i;switch(d){case ne.LocalVideoTrack:c=be(s=h._hints).call(s,qt.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalAudioTrack:c=It.Audio;break;case ne.LocalVideoLowTrack:c=It.Low}return{stream_type:c,ssrcs:p,mid:m}})}assignLocalTracks(n,i){n.forEach((s,c)=>{let{track:d,type:h}=s;this.localTrackMap.set(h,{track:d,id:i[c].id,ssrcs:i[c].localSSRC})})}withdrawLocalTracks(n){n.forEach(i=>{let[s]=i;this.localTrackMap.delete(s)})}bindConnectionEvents(n){var i=this;n.onConnectionStateChange=function(){var s=x(function*(c){if(I.info("[".concat(i.store.clientId,"] [p2pId: ").concat(i.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(c,")")),i.emit(Re.PeerConnectionStateChange,c),"connected"!==c||i.store.keyMetrics.peerConnectionEnd||i.store.peerConnectionEnd(),"connected"===c&&(i._restartTimer&&(clearTimeout(i._restartTimer),i._restartTimer=void 0),(i._isFirstConnected||i._isInRestartIce)&&i.reportPCStats(Date.now(),!0,i._pcStatsUploadType),i._isInRestartIce=!1,i._isFirstConnected=!1,i._isStartRestartIce=!1),B("NEW_ICE_RESTART")){var d;if(be(d=i._restartStates).call(d,c)){if(i._isStartRestartIce)return;i._isStartRestartIce=!0;const h=_=>{("disconnected"===n.iceConnectionState||"checking"===n.iceConnectionState||"failed"===n.iceConnectionState)&&(I.debug("[".concat(i.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(_)),"CONNECTED"===to(i,Re.QueryClientConnectionState)&&i.emit(Re.RequestRestartICE,_))},p=()=>{"disconnected"!==n.iceConnectionState&&"checking"!==n.iceConnectionState&&"failed"!==n.iceConnectionState||(i.reportPCStats(Date.now(),!1,i._pcStatsUploadType),I.debug("[".concat(i.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>i.emit(Re.P2PLost),0),i.iceFailedCount+=1,i.requestReconnect())},m=B("ICE_RESTART_INTERVAL");return void(i._restartTimer=window.setTimeout(()=>{if(B("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ut().supportPCSetConfiguration)h(Fi.RELAY),i._restartTimer=window.setTimeout(p,m);else if(zt())h(Fi.UDP),i._restartTimer=window.setTimeout(p,4e3);else{if(h(Fi.TCP),Ut().supportPCSetConfiguration)return void(i._restartTimer=window.setTimeout(()=>{h(Fi.RELAY),i._restartTimer=window.setTimeout(p,m)},m));i._restartTimer=window.setTimeout(p,m)}},800))}}else{if("disconnected"===c&&"disconnected"===n.iceConnectionState)return setTimeout(()=>{"disconnected"===n.iceConnectionState&&B("ICE_RESTART")&&"CONNECTED"===to(i,Re.QueryClientConnectionState)&&i.emit(Re.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===n.peerConnectionState&&(I.debug("[".concat(i.store.clientId,"] [p2pId: ").concat(i.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),i.reportPCStats(Date.now(),!1,i._pcStatsUploadType),i._isInRestartIce=!1,setTimeout(()=>i.emit(Re.P2PLost),0),i.iceFailedCount+=1,i.requestReconnect())},4e3);"failed"===c&&(I.debug("[".concat(i.store.clientId,"] [p2pId: ").concat(i.store.p2pId,"]: P2PConnection state failed, force reconnect")),i.reportPCDisconnectedOrFailed(),setTimeout(()=>i.emit(Re.P2PLost),0),i.iceFailedCount+=1,yield i.requestReconnect())}});return function(c){return s.apply(this,arguments)}}(),n.onICEConnectionStateChange=s=>{"connected"!==s||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(s,")")),ye.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:s,tag:Je.TRACER}).onSuccess(),this.emit(Re.IceConnectionStateChange,s)},n.onICETransportStateChange=s=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(s,")"))},n.onDTLSTransportStateChange=s=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(s,")"))},n.onDTLSTransportError=s=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(s,")"))},n.onFirstAudioDecoded=s=>{var c;const d=Array.from(Eo(c=this.remoteUserMap).call(c)).find(p=>p._audioSSRC===s);var h;d&&(this.store.subscribe(d.uid,"audio",void 0,void 0,void 0,Date.now()),null===(h=d.audioTrack)||void 0===h||h.emit(Rd.FIRST_FRAME_DECODED),ye.firstRemoteFrame(this.store.sessionId,Yn.FIRST_AUDIO_DECODE,Kt.FIRST_AUDIO_DECODE,{peer:d._uintid,subscribeElapse:gi.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId}))},n.onFirstAudioReceived=s=>{var c;const d=Array.from(Eo(c=this.remoteUserMap).call(c)).find(h=>h._audioSSRC===s);d&&ye.firstRemoteFrame(this.store.sessionId,Yn.FIRST_AUDIO_RECEIVED,Kt.FIRST_AUDIO_RECEIVED,{peer:d._uintid,subscribeElapse:gi.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},n.onFirstVideoDecoded=(s,c,d)=>{this.reportVideoFirstFrameDecoded(s,c,d)},n.onFirstVideoReceived=s=>{var c;const d=Array.from(Eo(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===s);d&&ye.firstRemoteFrame(this.store.sessionId,Yn.FIRST_VIDEO_RECEIVED,Kt.FIRST_VIDEO_RECEIVED,{peer:d._uintid,subscribeElapse:gi.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},n.onSelectedLocalCandidateChanged=(s,c)=>{const d="relay"===s.candidateType;"unknown"!==c.candidateType&&d===("relay"===c.candidateType)||this.emit(Re.ConnectionTypeChange,d),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(pl(c))," -> ").concat(JSON.stringify(pl(s)),")"))},n.onSelectedRemoteCandidateChanged=(s,c)=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(pl(c))," -> ").concat(JSON.stringify(pl(s)),")"))},n.onFirstVideoDecodedTimeout=s=>{this.reportVideoFirstFrameDecoded(s,void 0,void 0,!0)}}unbindConnectionEvents(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(n){const i=[];if(-1===this.getAllTracks().indexOf(n))return i;const s=this.localTrackMap.get(ne.LocalAudioTrack);if(n instanceof ct&&s?.track instanceof qn)return s.track.isActive||i.push([ne.LocalAudioTrack,s]),i;const c=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(c&&(i.push(c),c[0]===ne.LocalVideoTrack)){const d=this.localTrackMap.get(ne.LocalVideoLowTrack);d&&i.push([ne.LocalVideoLowTrack,d])}return i}filterTobeUnmutedTracks(n){const i=[],s=this.localTrackMap.get(ne.LocalAudioTrack);if(n instanceof ct&&s?.track instanceof qn)return s.track.isActive&&i.push([ne.LocalAudioTrack,s]),i;const c=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(c)if(c[0]===ne.LocalVideoTrack){i.push(c);const d=this.localTrackMap.get(ne.LocalVideoLowTrack);d&&i.push([ne.LocalVideoLowTrack,d])}else i.push(c);return i}createMuteMessage(n){return n.map(i=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=i;switch(d){case ne.LocalAudioTrack:c=It.Audio;break;case ne.LocalVideoTrack:c=be(s=h._hints).call(s,qt.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalVideoLowTrack:c=It.Low}return{stream_type:c,ssrcs:p,mid:m}})}createUnmuteMessage(n){return n.map(i=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=i;switch(d){case ne.LocalAudioTrack:c=It.Audio;break;case ne.LocalVideoTrack:c=be(s=h._hints).call(s,qt.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalVideoLowTrack:c=It.Low}return{stream_type:c,ssrcs:p,mid:m}})}filterTobeUnSubscribedTracks(n,i){const s=[],c=this.remoteUserMap.get(n);if(!c)return s;if(i){const d=c.get(i);if(!d)return s;s.push([n,{kind:i,id:d}])}else Array.from(c.entries()).forEach(d=>{let[h,p]=d;s.push([n,{kind:h,id:p}])});return s}filterTobeUnSubscribedDataChannels(n,i){const s=[];return i.forEach(c=>{var d;null!==(d=this.remoteDataChannelMap.get(n))&&void 0!==d&&d.has(c.id)&&s.push(c)}),s}createUnsubscribeMessage(n){const i=[];return n.forEach(s=>{let[c,{kind:d}]=s;switch(d){case _e.VIDEO:return void(c._videoSSRC&&i.push({stream_type:_e.VIDEO,ssrcId:c._videoSSRC}));case _e.AUDIO:return void(c._audioSSRC&&i.push({stream_type:_e.AUDIO,ssrcId:c._audioSSRC}))}}),i}createUnsubscribeAllMessage(n){const i=new Map;return n.forEach(s=>{let[c,{kind:d}]=s;if(i.has(c)){let h=i.get(c);h|=d===_e.VIDEO?Xn.Video:Xn.Audio,i.set(c,h)}else i.set(c,d===_e.VIDEO?Xn.Video:Xn.Audio)}),{users:Array.from(i.entries()).map(s=>{let[c,d]=s;return{stream_id:c.uid,stream_type:d}})}}withdrawRemoteTracks(n){n.forEach(i=>{let[s,{kind:c}]=i;const d=this.remoteUserMap.get(s);d&&(d.delete(c),0===Array.from(d.entries()).length&&this.remoteUserMap.delete(s))})}updateBitrateLimit(n){var i=this;return x(function*(){const s=i.localTrackMap.get(ne.LocalVideoTrack),c=i.localTrackMap.get(ne.LocalVideoLowTrack);s&&(yield s.track.setBitrateLimit(n.uplink)),c&&n.low_stream_uplink&&(yield c.track.setBitrateLimit({max_bitrate:n.low_stream_uplink.bitrate,min_bitrate:n.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(n,i){return n.map((s,c)=>{var d;let{stream_type:h}=s;return null===(d=i.find(p=>{let{stream_type:m}=p;return h===m}))||void 0===d?void 0:d.attributes})}tryToUnmuteAudio(n){var i=this;return x(function*(){for(let c=0;c<n.length;c++)if(n[c]instanceof ct){var s;const d=i.filterTobeUnmutedTracks(n[c]);if(0===d.length)continue;yield null===(s=i.connection)||void 0===s?void 0:s.unmuteLocal(d.map(p=>{let[,{id:m}]=p;return m}));const h=i.createUnmuteMessage(d);return void(yield St(i,Re.RequestUnmuteLocal,h))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=n=>{var i;return!(null===(i=this.connection)||void 0===i||!i.getRemoteVideoIsReady(n))},this.statsUploader.requestUpload=(n,i)=>this.emit(Re.RequestUploadStats,n,i),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var n=this;return x(function*(){n.dtlsFailedCount+=1,yield ui(xg(n.dtlsFailedCount,_n)),n.emit(Re.RequestReconnect)})()}reconnectP2P(){var n=this;return x(function*(){const i=Array.from(n.localTrackMap.entries()),s=n.createGatewayUnpublishMessage(i);Array.from(n.remoteUserMap.entries()),s.length>0&&(yield dn(n,Re.RequestUnpublishForReconnectPC,s)),n.disconnectForReconnect(),n.emit(Re.RequestReconnectPC)})()}canPublishLowStream(){return this.localTrackMap.has(ne.LocalVideoTrack)||this.pendingLocalTracks.some(n=>n instanceof We)}throwIfTrackTypeNotMatch(n){if(n.filter(i=>i instanceof We).length>1)throw new Q(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n.filter(i=>i instanceof ct).length>1&&(n.some(i=>i instanceof ct&&i._bypassWebAudio)||!Ut().webAudioMediaStreamDest))throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const i of n){if(i instanceof We&&this.pendingLocalTracks.some(s=>s instanceof We))throw new Q(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i instanceof ct&&this.pendingLocalTracks.some(s=>s instanceof ct)&&(!Ut().webAudioMediaStreamDest||i._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof ct&&s._bypassWebAudio)))throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(n,i){const s=!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ut().supportDualStreamEncoding,c=Oc(Oc({},{width:160,height:120,framerate:15,bitrate:50}),i);let d;d=s?n._mediaStreamTrack.clone():Hd(n,c);const h=Ot(8,"track-low-"),p=new We(d,Oc(Oc({},s&&{scaleResolutionDownBy:UE(c,n)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return p.on(mh.TRANSCEIVER_UPDATED,m=>{n._updateRtpTransceiver(m,Id.LOW_STREAM)}),p._hints.push(qt.LOW_STREAM),n.addListener(me.NEED_CLOSE,()=>{p.close()}),p}globalLock(){var n=this;return x(function*(){return n.mutex.lock("From P2PChannel.globalLock")})()}reportPCStats(n,i,s){var c=arguments,d=this;return x(function*(){let h=c.length>3&&void 0!==c[3]?c[3]:null;if(d.connection&&d.connection instanceof si){var p,m,_,E;const y=d.store.keyMetrics.descriptionStart||0,{iceConnectionState:S,dtlsTransportState:T,peerConnectionState:O}=d.connection,{local:N,remote:w}=yield d.connection.getSelectedCandidatePair();ye.pcStats(d.store.sessionId,{startTime:y,eventElapse:n-y||0,iceconnectionsate:S,dtlsstate:T,connectionstate:O,intSucc:i?1:2,error:h,selectedLocalCandidateProtocol:null!==(p=N?.protocol)&&void 0!==p?p:"",selectedLocalCandidateType:null!==(m=N.candidateType)&&void 0!==m?m:"",selectedLocalCandidateAddress:"".concat(N.address,":").concat(N.port),selectedRemoteCandidateProtocol:null!==(_=w.protocol)&&void 0!==_?_:"",selectedRemoteCandidateType:null!==(E=w.candidateType)&&void 0!==E?E:"",selectedRemoteCandidateAddress:"".concat(w.address,":").concat(w.port),restartCnt:s})}})()}reportVideoFirstFrameDecoded(n,i,s,c){var d;const h=Array.from(Eo(d=this.remoteUserMap).call(d)).find(p=>p._videoSSRC===n);if(h){c||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const p=this.store.keyMetrics,m=p.subscribe.find(_=>_.userId===h.uid&&"video"===_.type);ye.firstRemoteVideoDecode(this.store.sessionId,Yn.FIRST_VIDEO_DECODE,Kt.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:i,videoheight:s,subscribeElapse:gi.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId,apEnd:p.requestAPEnd||0,apStart:p.requestAPStart||0,joinGwEnd:p.joinGatewayEnd||0,joinGwStart:p.joinGatewayStart||0,pcEnd:p.peerConnectionEnd||0,pcStart:p.peerConnectionStart||0,subscriberEnd:m?.subscribeEnd||0,subscriberStart:m?.subscribeStart||0,videoAddNotify:m?.streamAdded||0,state:c?1:0})}}remoteMediaSsrcChanged(n,i,s){var c=this;return x(function*(){if(!c.connection)return!1;const d=c.remoteUserMap.get(n);if(!d)return!1;const h=d.get(i);if(!h)return!1;const p=yield c.connection.getRemoteSSRC(h);return void 0!==p&&p!==s})()}resetConnection(n){I.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(n)),this.state===et.Connected?(I.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=n===NC.datachannel?new Zn({},this.store):this.isPlanB?new kn({},this.store):new si({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(n=>{let[i,{track:s}]=n;i===ne.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Id.LOW_STREAM):s._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(n){this.connection&&this.connection instanceof si&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this.reportPCStats(Date.now(),!1,this._pcStatsUploadType===Ri.TCP_RESTART&&n===Fi.RELAY?this._pcStatsUploadType:Ri.DISCONNECTED_OR_FAILED)))}}function ji(o,n,i){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=x(function*(){const c=this.mutex,d=yield c.lock("From P2PChannel.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),i}function pV(o){let n={};e:for(;!Rx(o);){let i=Va(o);switch(i>>>3){case 0:break e;case 1:n.requestId=nT(o,Va(o));break;case 2:n.requestType=Va(o)>>>0;break;case 3:n.scorePorn=oT(o);break;case 4:n.scoreSexy=oT(o);break;case 5:n.scoreNeutral=oT(o);break;case 6:n.requestScene=Va(o)>>>0;break;case 7:n.scene=Va(o)>>>0;break;default:ym(o,7&i)}}return n}function Ix(o,n){let i=o.service;void 0!==i&&(Rt(n,8),Rt(n,i));let s=o.vendor;void 0!==s&&(Rt(n,16),Rt(n,s));let c=o.token;void 0!==c&&(Rt(n,26),Ua(n,c));let d=o.callbackUrl;void 0!==d&&(Rt(n,34),Ua(n,d))}function Em(o){let n=Va(o),i=o.limit;return o.limit=o.offset+n,i}function ym(o,n){switch(n){case 0:for(;128&iT(o););break;case 2:vO(o,Va(o));break;case 5:vO(o,4);break;case 1:vO(o,8);break;default:throw new Error("Unimplemented type: "+n)}}te([ji,P("design:type",Function),P("design:paramtypes",[Object,Boolean]),P("design:returntype",z)],Ci.prototype,"startP2PConnection",null),te([ji,P("design:type",Function),P("design:paramtypes",[Object,Object,Array,Object,String,String]),P("design:returntype",z)],Ci.prototype,"connect",null),te([ji,P("design:type",Function),P("design:paramtypes",[Object,Object,Array,Object,String,String]),P("design:returntype",z)],Ci.prototype,"preConnect",null),te([ji,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],Ci.prototype,"publishDataChannel",null),te([ji,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],Ci.prototype,"unpublish",null),te([ji,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],Ci.prototype,"unpublishDataChannel",null),te([ji,P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",z)],Ci.prototype,"unpublishLowStream",null),te([ji,P("design:type",Function),P("design:paramtypes",[vi,Array]),P("design:returntype",z)],Ci.prototype,"subscribeDataChannel",null),te([ji,P("design:type",Function),P("design:paramtypes",[vi,String,Number,Number,Array]),P("design:returntype",z)],Ci.prototype,"subscribe",null),te([ji,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],Ci.prototype,"massSubscribe",null),te([ji,P("design:type",Function),P("design:paramtypes",[vi,String,Boolean]),P("design:returntype",z)],Ci.prototype,"unsubscribe",null),te([ji,P("design:type",Function),P("design:paramtypes",[vi,Array]),P("design:returntype",z)],Ci.prototype,"unsubscribeDataChannel",null),te([ji,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],Ci.prototype,"massUnsubscribe",null),te([ji,P("design:type",Function),P("design:paramtypes",[vi,String]),P("design:returntype",z)],Ci.prototype,"muteRemote",null),te([ji,P("design:type",Function),P("design:paramtypes",[vi,String]),P("design:returntype",z)],Ci.prototype,"unmuteRemote",null),te([ji,P("design:type",Function),P("design:paramtypes",[vi,String]),P("design:returntype",z)],Ci.prototype,"hasRemoteMediaWithLock",null),te([ji,P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",z)],Ci.prototype,"disconnectForReconnect",null),te([ji,P("design:type",Function),P("design:paramtypes",[Object]),P("design:returntype",z)],Ci.prototype,"updateBitrateLimit",null),te([ji,P("design:type",Function),P("design:paramtypes",[vi,String,Number]),P("design:returntype",z)],Ci.prototype,"remoteMediaSsrcChanged",null);let EO=new Float32Array(1);new Uint8Array(EO.buffer);let ZE=new Float64Array(1),Hi=new Uint8Array(ZE.buffer);function vm(o){return{low:o|=0,high:o>>31,unsigned:o>=0}}let yO=[];function eT(){const o=yO.pop();return o?(o.offset=o.limit=0,o):{bytes:new Uint8Array(64),offset:0,limit:0}}function fV(o){yO.push(o)}function vO(o,n){if(o.offset+n>o.limit)throw new Error("Skip past limit");o.offset+=n}function Rx(o){return o.offset>=o.limit}function Sm(o,n){let i=o.bytes,s=o.offset,c=o.limit,d=s+n;if(d>i.length){let h=new Uint8Array(2*d);h.set(i),o.bytes=h}return o.offset=d,d>c&&(o.limit=d),s}function tT(o,n){let i=o.offset;if(i+n>o.limit)throw new Error("Read past limit");return o.offset+=n,i}function nT(o,n){let i=tT(o,n),s=String.fromCharCode,c=o.bytes,d="\ufffd",h="";for(let p=0;p<n;p++){let m,_,E,y,S=c[p+i];0==(128&S)?h+=s(S):192==(224&S)?p+1>=n?h+=d:(m=c[p+i+1],128!=(192&m)?h+=d:(y=(31&S)<<6|63&m,y<128?h+=d:(h+=s(y),p++))):224==(240&S)?p+2>=n?h+=d:(m=c[p+i+1],_=c[p+i+2],32896!=(49344&(m|_<<8))?h+=d:(y=(15&S)<<12|(63&m)<<6|63&_,y<2048||y>=55296&&y<=57343?h+=d:(h+=s(y),p+=2))):240==(248&S)?p+3>=n?h+=d:(m=c[p+i+1],_=c[p+i+2],E=c[p+i+3],8421504!=(12632256&(m|_<<8|E<<16))?h+=d:(y=(7&S)<<18|(63&m)<<12|(63&_)<<6|63&E,y<65536||y>1114111?h+=d:(y-=65536,h+=s(55296+(y>>10),56320+(1023&y)),p+=3))):h+=d}return h}function Ua(o,n){let i=n.length,s=0;for(let h=0;h<i;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<i&&(p=(p<<10)+n.charCodeAt(++h)-56613888),s+=p<128?1:p<2048?2:p<65536?3:4}Rt(o,s);let c=Sm(o,s),d=o.bytes;for(let h=0;h<i;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<i&&(p=(p<<10)+n.charCodeAt(++h)-56613888),p<128?d[c++]=p:(p<2048?d[c++]=p>>6&31|192:(p<65536?d[c++]=p>>12&15|224:(d[c++]=p>>18&7|240,d[c++]=p>>12&63|128),d[c++]=p>>6&63|128),d[c++]=63&p|128)}}function SO(o,n){let i=Sm(o,n.limit),s=o.bytes,c=n.bytes;for(let d=0,h=n.limit;d<h;d++)s[d+i]=c[d]}function iT(o){return o.bytes[tT(o,1)]}function rT(o,n){let i=Sm(o,1);o.bytes[i]=n}function oT(o){let n=tT(o,8),i=o.bytes;return Hi[0]=i[n++],Hi[1]=i[n++],Hi[2]=i[n++],Hi[3]=i[n++],Hi[4]=i[n++],Hi[5]=i[n++],Hi[6]=i[n++],Hi[7]=i[n++],ZE[0]}function ey(o,n){let i=Sm(o,8),s=o.bytes;ZE[0]=n,s[i++]=Hi[0],s[i++]=Hi[1],s[i++]=Hi[2],s[i++]=Hi[3],s[i++]=Hi[4],s[i++]=Hi[5],s[i++]=Hi[6],s[i++]=Hi[7]}function Va(o){let n,i=0,s=0;do{n=iT(o),i<32&&(s|=(127&n)<<i),i+=7}while(128&n);return s}function Rt(o,n){for(n>>>=0;n>=128;)rT(o,127&n|128),n>>>=7;rT(o,n)}function Nc(o,n){let i=n.low>>>0,s=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,d=0===c?0===s?i<16384?i<128?1:2:i<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,h=Sm(o,d),p=o.bytes;switch(d){case 10:p[h+9]=c>>>7&1;case 9:p[h+8]=9!==d?128|c:127&c;case 8:p[h+7]=8!==d?s>>>21|128:s>>>21&127;case 7:p[h+6]=7!==d?s>>>14|128:s>>>14&127;case 6:p[h+5]=6!==d?s>>>7|128:s>>>7&127;case 5:p[h+4]=5!==d?128|s:127&s;case 4:p[h+3]=4!==d?i>>>21|128:i>>>21&127;case 3:p[h+2]=3!==d?i>>>14|128:i>>>14&127;case 2:p[h+1]=2!==d?i>>>7|128:i>>>7&127;case 1:p[h]=1!==d?128|i:127&i}}function CO(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}const bO=new Map([["moderation",1],["supervise",2]]);class ty extends kt{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const i=this._connectionState;this._connectionState=n,this.emit(Jn.CONNECTION_STATE_CHANGE,i,n)}get inspectType(){return this._inspectType}set inspectType(n){var i;this._inspectMode=md(i=n.map(s=>bO.get(s)||0)).call(i,(s,c)=>s+c),this._inspectType=n}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(n){super(),C(this,"name","AgoraRTCVideoContentInspect"),C(this,"_connectionState",So.CONNECTING),C(this,"_innerConnectionState",void 0),C(this,"sequence",0),C(this,"inspectStartTime",void 0),C(this,"workerManagerConnection",void 0),C(this,"workerConnection",void 0),C(this,"workerMessageLengthLimit",void 0),C(this,"inspectIntervalMinimum",void 0),C(this,"qualityRatio",void 0),C(this,"_connectInfo",void 0),C(this,"_cancelTokenSource",or.CancelToken.source()),C(this,"_retryConfig",void 0),C(this,"wmSequence",0),C(this,"inspectInterval",void 0),C(this,"inspectTimer",null),C(this,"ossFilePrefix",void 0),C(this,"extraInfo",void 0),C(this,"_inspectType",void 0),C(this,"_inspectMode",void 0),C(this,"_quality",1),C(this,"qualityTimer",null),C(this,"_inspectId",void 0),C(this,"_needWorkUrlOnly",!1),C(this,"inspectImage",()=>{if(this.connectionState!==So.CONNECTED)throw new W(M.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===So.CONNECTED?this.requestToInspectImage():I.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Ot(5,"inspect-"),this.workerMessageLengthLimit=B("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=B("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=B("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=n.interval,this.ossFilePrefix=n.ossFilePrefix,this.extraInfo=n.extraInfo,this.inspectType=n.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new uh("worker-manager-"+this._inspectId,_n),this.on(Jn.STATE_CHANGE,(i,s)=>{this._innerConnectionState=i,I.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ur[i]," ").concat(s||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new uh("worker-"+this._inspectId,_n),this.handleWorkerEvents()}init(n,i){var s=this;return x(function*(){s.emit(Jn.STATE_CHANGE,Ur.CONNECT_AP),s._connectInfo=n;const c=s._cancelTokenSource.token;return s._retryConfig=i,new z((d,h)=>{s.on(Jn.CONNECTION_STATE_CHANGE,(p,m)=>{m===So.CONNECTED&&d()}),s.requestAP(n,c,i).then(p=>{s.connectWorkerManager(p)}).catch(p=>{h(p)})})})()}requestAP(n,i,s){var c=this;return x(function*(){const d=B("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),h=yield function(m,_,E,y){let{appId:S,areaCode:T,cname:O,sid:N,token:w,uid:k}=_;rm++;const V="image_moderation_api",U={service_name:V,json_body:JSON.stringify({appId:S,areaCode:T,cname:O,command:"allocateEdge",requestId:rm,seq:rm,sid:N,token:w,ts:Date.now(),uid:k+""})};let Y,re,K=m[0];return Ks(x(function*(){Y=Date.now();const $=yield Fa(K,{data:U,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(re=Date.now()-Y,0!==$.code){const ve=new W(M.UNEXPECTED_RESPONSE,"image inspect ap error, code"+$.code,{retry:!0,responseTime:re});throw I.error(ve.toString()),ve}const X=JSON.parse($.json_body);if(200!==X.code){const ve=new W(M.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(X.code,", reason: ").concat(X.reason),{code:X.code,responseTime:re});throw I.error(ve.toString()),ve}if(!X.servers||!Array.isArray(X.servers)||0===X.servers.length){const ve=new W(M.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:X.code,responseTime:re});throw I.error(ve.toString()),ve}const J=B("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Ee=B("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:X.servers.map(ve=>{let{address:ze,wss:ht}=ve;if(ze&&ht)return"wss://".concat(ze.replace(/\./g,"-"),".").concat(J,":").concat(Ee||ht)}).filter(ve=>!!ve),workerToken:X.workerToken,vid:X.vid,responseTime:re}}),($,X)=>(ye.apworkerEvent(N,{success:!0,sc:200,serviceName:V,responseDetail:JSON.stringify($.addressList),firstSuccess:0===X,responseTime:re,serverIp:m[X%m.length]}),!1),($,X)=>(ye.apworkerEvent(N,{success:!1,sc:$.data&&$.data.code||200,serviceName:V,responseTime:re,serverIp:m[X%m.length]}),!!($.code!==M.OPERATION_ABORTED&&$.code!==M.UNEXPECTED_RESPONSE||$.data&&$.data.retry)&&(K=m[(X+1)%m.length],!0)),y)}(d,n,i,s);c.emit(Jn.STATE_CHANGE,Ur.AP_CONNECTED);const{addressList:p}=h;return c.wmSequence++,p})()}connectWorkerManager(n){var i=arguments,s=this;return x(function*(){s._needWorkUrlOnly=i.length>1&&void 0!==i[1]&&i[1],s.emit(Jn.STATE_CHANGE,Ur.CONNECT_WORKER_MANAGER),yield s.workerManagerConnection.init(n,1e4)})()}connectWorker(n){var i=this;return x(function*(){yield i.workerConnection.init([n])})()}handleWorkerManagerEvents(){var n=this;this.workerManagerConnection.on(Oe.CONNECTED,x(function*(){n.emit(Jn.STATE_CHANGE,Ur.WORKER_MANAGER_CONNECTED,n.workerManagerConnection.url),n.workerManagerConnection.sendMessage({appId:n._connectInfo.appId,cname:n._connectInfo.cname,uid:n._connectInfo.uid+"",sdkVersion:"4.19.1",sid:n._connectInfo.sid,seq:n.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(Oe.CLOSED,()=>{this._innerConnectionState<Ur.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Oe.FAILED,()=>{this._innerConnectionState<Ur.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Oe.RECONNECTING,()=>{this._innerConnectionState<Ur.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Oe.ON_MESSAGE,function(){var i=x(function*(s){n.emit(Jn.STATE_CHANGE,Ur.GET_WORKER_MANAGER_RESPONSE);const c=n.workerManagerConnection.url;n.workerManagerConnection.close();const d=JSON.parse(s.data);if(200!==d.code)throw I.error("[".concat(n._inspectId,"] Unexpected code ").concat(d.code," from worker manager")),new W(M.UNEXPECTED_RESPONSE,"response code of worker is unexpected",d);if(!(d.serverResponse&&d.serverResponse.portWss&&c))throw I.error("[".concat(n._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(d))),new W(M.UNEXPECTED_RESPONSE,"response content of worker is unexpected",d);{const h=B("VIDEO_INSPECT_WORKER_PORT")||d.serverResponse.portWss,p=c.replace(/:\d+\/?$/,":".concat(h));n.emit(Jn.STATE_CHANGE,Ur.CONNECT_WORKER,p),n._needWorkUrlOnly?n.emit(Jn.REQUEST_NEW_WORKER_URL,p):yield n.connectWorker(p)}});return function(s){return i.apply(this,arguments)}}()),this.workerManagerConnection.on(Oe.WILL_RECONNECT,(i,s,c)=>{c(i)}),this.workerManagerConnection.on(Oe.REQUEST_NEW_URLS,(i,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i).catch(s)})}handleWorkerEvents(){var n=this;this.workerConnection.on(Oe.CONNECTED,x(function*(){n.emit(Jn.STATE_CHANGE,Ur.WORKER_CONNECTED,n.workerConnection.url),n.connectionState=So.CONNECTED})),this.workerConnection.on(Oe.ON_MESSAGE,function(){var i=x(function*(s){if(s.data instanceof ArrayBuffer){const d=function Tx(o){return function(i){let s={};e:for(;!Rx(i);){let c=Va(i);switch(c>>>3){case 0:break e;case 1:s.code=Va(i);break;case 2:s.msg=nT(i,Va(i));break;case 3:{let d=Em(i);s.data=pV(i),i.limit=d;break}default:ym(i,7&c)}}return s}({bytes:n=o,offset:0,limit:n.length});var n}(new Uint8Array(s.data));if(B("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&I.debug("[".concat(n._inspectId,"] Response message for worker of inspect content "),JSON.stringify(d)),200===d.code){if(Array.isArray(n.inspectType)&&1===n.inspectType.length&&"supervise"===n.inspectType[0])return void n.emit(Jn.INSPECT_RESULT,void 0,void 0);if(d.data&&d.data.scorePorn&&d.data.scoreSexy&&d.data.scoreNeutral){var c;const h={porn:d.data.scorePorn,sexy:d.data.scoreSexy,neutral:d.data.scoreNeutral},p=md(c=Object.keys(h)).call(c,(_,E)=>h[_]>h[E]?_:E,"porn"),m=Object.keys(h).find(_=>_===p);n.emit(Jn.INSPECT_RESULT,m)}else n.emit(Jn.INSPECT_RESULT,void 0,new W(M.UNEXPECTED_RESPONSE,d.code+"","There is an unexpected data on message"))}else n.emit(Jn.INSPECT_RESULT,void 0,new W(M.UNEXPECTED_RESPONSE,d.code+"",d.msg))}else I.error("[".concat(n._inspectId,"] Unexpected message type from worker")),n.emit(Jn.INSPECT_RESULT,void 0,new W(M.UNEXPECTED_RESPONSE,"invalid worker message type"))});return function(s){return i.apply(this,arguments)}}()),this.workerConnection.on(Oe.CLOSED,()=>{this.connectionState=So.CLOSED}),this.workerConnection.on(Oe.FAILED,()=>{this.connectionState=So.CLOSED}),this.workerConnection.on(Oe.RECONNECTING,()=>{this.connectionState=this.connectionState===So.CONNECTED?So.RECONNECTING:So.CONNECTING}),this.workerConnection.on(Oe.WILL_RECONNECT,(i,s,c)=>{"recover"===i&&c(i),c("tryNext")}),this.workerConnection.on(Oe.REQUEST_NEW_URLS,(i,s)=>{this.workerManagerConnection.close(),this.once(Jn.REQUEST_NEW_WORKER_URL,c=>{i([c])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(c=>{this.connectWorkerManager(c,!0)}).catch(c=>{s(c)})})}static intToLong(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}requestToInspectImage(){var n=this;return x(function*(){n.sequence++;const i=to(n,Jn.CLIENT_LOCAL_VIDEO_TRACK),s={appId:n._connectInfo.appId,cname:n._connectInfo.cname,cid:n._connectInfo.cid,sid:n._connectInfo.sid,uid:n._connectInfo.uid,vid:n._connectInfo.vid};if(i){if(!i.isPlaying)return void n.emit(Jn.INSPECT_RESULT,void 0,new W(M.INVALID_OPERATION,"Only the track being played can be inspected"));const c=yield n.generateRequestData(i,s);n.workerConnection.sendMessage(c,!0,!0)}else n.emit(Jn.INSPECT_RESULT,void 0,new W(M.INVALID_OPERATION,"Only the track being published can be inspected"))})()}generateRequestData(n,i){var s=this;return x(function*(){let{appId:c,cname:d,cid:h,vid:p,sid:m,uid:_}=i;const E=Date.now(),y=yield n.getCurrentFrameImage("image/jpeg",s.quality),S=yield Bi(y,c,d),T=s.sequence+"-"+h+"-"+_+"-"+E+"-"+Ot(12,""),O={appId:c,cid:h,cname:d,deviceId:"",elapse:ty.intToLong(Number(E-s.inspectStartTime)),fileSize:S.byteLength,jpgEncryption:2,height:y.height,width:y.width,jpg:S,networkType:6,osType:7,requestId:T,sdkVersion:"4.19.1",sequence:s.sequence,sid:m,timestamp:ty.intToLong(E),uid:_,vid:p,service:s._inspectMode,callbackData:s.extraInfo,ossFilePrefix:s.ossFilePrefix};void 0===s.extraInfo&&delete O.callbackData,void 0===s.ossFilePrefix&&delete O.ossFilePrefix;const N=function Zb(o){let n=eT();return function(i,s){let c=i.appId;void 0!==c&&(Rt(s,10),Ua(s,c));let d=i.cid;void 0!==d&&(Rt(s,16),Rt(s,d));let h=i.cname;void 0!==h&&(Rt(s,26),Ua(s,h));let p=i.deviceId;void 0!==p&&(Rt(s,34),Ua(s,p));let m=i.elapse;void 0!==m&&(Rt(s,40),Nc(s,m));let _=i.fileSize;void 0!==_&&(Rt(s,48),Nc(s,vm(_)));let E=i.height;void 0!==E&&(Rt(s,56),Nc(s,vm(E)));let y=i.jpg;void 0!==y&&(Rt(s,66),Rt(s,y.length),function(bt,ee){let ae=Sm(bt,ee.length);bt.bytes.set(ee,ae)}(s,y));let S=i.networkType;void 0!==S&&(Rt(s,72),Nc(s,vm(S)));let T=i.osType;void 0!==T&&(Rt(s,80),Nc(s,vm(T)));let O=i.requestId;void 0!==O&&(Rt(s,90),Ua(s,O));let N=i.sdkVersion;void 0!==N&&(Rt(s,98),Ua(s,N));let w=i.sequence;void 0!==w&&(Rt(s,104),Nc(s,vm(w)));let k=i.sid;void 0!==k&&(Rt(s,114),Ua(s,k));let V=i.timestamp;void 0!==V&&(Rt(s,120),Nc(s,V));let U=i.uid;void 0!==U&&(Rt(s,128),Rt(s,U));let Y=i.vid;void 0!==Y&&(Rt(s,136),Rt(s,Y));let re=i.width;void 0!==re&&(Rt(s,144),Nc(s,vm(re)));let K=i.service;void 0!==K&&(Rt(s,152),Rt(s,K));let $=i.callbackData;void 0!==$&&(Rt(s,162),Ua(s,$));let X=i.jpgEncryption;void 0!==X&&(Rt(s,168),Rt(s,X));let J=i.requestType;void 0!==J&&(Rt(s,176),Rt(s,J));let Ee=i.scorePorn;void 0!==Ee&&(Rt(s,185),ey(s,Ee));let ve=i.scoreSexy;void 0!==ve&&(Rt(s,193),ey(s,ve));let ze=i.scoreNeutral;void 0!==ze&&(Rt(s,201),ey(s,ze));let ht=i.scene;void 0!==ht&&(Rt(s,208),Rt(s,ht));let Ct=i.ossFilePrefix;void 0!==Ct&&(Rt(s,218),Ua(s,Ct));let dt=i.serviceVendor;if(void 0!==dt)for(let bt of dt){Rt(s,226);let ee=eT();Ix(bt,ee),Rt(s,ee.limit),SO(s,ee),fV(ee)}}(o,n),function(i){let s=i.bytes,c=i.limit;return s.length===c?s:s.subarray(0,c)}(n)}(O);if(N.byteLength<s.workerMessageLengthLimit){if(B("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const w=function(k){for(var V=1;V<arguments.length;V++){var U=null!=arguments[V]?arguments[V]:{};V%2?CO(Object(U),!0).forEach(function(Y){C(k,Y,U[Y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(U)):CO(Object(U)).forEach(function(Y){Object.defineProperty(k,Y,Object.getOwnPropertyDescriptor(U,Y))})}return k}({},O);delete w.jpg,I.debug("[".concat(s._inspectId,"] Request message for worker of inspect content "),JSON.stringify(w))}return N}return s.quality=s.quality*s.qualityRatio,yield s.generateRequestData(n,{appId:c,cname:d,cid:h,vid:p,sid:m,uid:_})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=or.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=So.CLOSED,this.emit(Jn.STATE_CHANGE,Ur.CLOSED)}}function wx(o,n){switch(n){case 0:for(;128&Ao(o););break;case 2:zd(o,Fh(o));break;case 5:zd(o,4);break;case 1:zd(o,8);break;default:throw new Error("Unimplemented type: "+n)}}function Wd(o){return{low:o|=0,high:o>>31,unsigned:o>=0}}let Ax=[];function zd(o,n){if(o.offset+n>o.limit)throw new Error("Skip past limit");o.offset+=n}function Dx(o){return o.offset>=o.limit}function xh(o,n){let i=o.bytes,s=o.offset,c=o.limit,d=s+n;if(d>i.length){let h=new Uint8Array(2*d);h.set(i),o.bytes=h}return o.offset=d,d>c&&(o.limit=d),s}function IO(o,n){let i=o.offset;if(i+n>o.limit)throw new Error("Read past limit");return o.offset+=n,i}function ny(o,n){let i=xh(o,n.length);o.bytes.set(n,i)}function aT(o,n){let i=IO(o,n),s=String.fromCharCode,c=o.bytes,d="\ufffd",h="";for(let p=0;p<n;p++){let m,_,E,y,S=c[p+i];0==(128&S)?h+=s(S):192==(224&S)?p+1>=n?h+=d:(m=c[p+i+1],128!=(192&m)?h+=d:(y=(31&S)<<6|63&m,y<128?h+=d:(h+=s(y),p++))):224==(240&S)?p+2>=n?h+=d:(m=c[p+i+1],_=c[p+i+2],32896!=(49344&(m|_<<8))?h+=d:(y=(15&S)<<12|(63&m)<<6|63&_,y<2048||y>=55296&&y<=57343?h+=d:(h+=s(y),p+=2))):240==(248&S)?p+3>=n?h+=d:(m=c[p+i+1],_=c[p+i+2],E=c[p+i+3],8421504!=(12632256&(m|_<<8|E<<16))?h+=d:(y=(7&S)<<18|(63&m)<<12|(63&_)<<6|63&E,y<65536||y>1114111?h+=d:(y-=65536,h+=s(55296+(y>>10),56320+(1023&y)),p+=3))):h+=d}return h}function Kd(o,n){let i=n.length,s=0;for(let h=0;h<i;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<i&&(p=(p<<10)+n.charCodeAt(++h)-56613888),s+=p<128?1:p<2048?2:p<65536?3:4}jn(o,s);let c=xh(o,s),d=o.bytes;for(let h=0;h<i;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<i&&(p=(p<<10)+n.charCodeAt(++h)-56613888),p<128?d[c++]=p:(p<2048?d[c++]=p>>6&31|192:(p<65536?d[c++]=p>>12&15|224:(d[c++]=p>>18&7|240,d[c++]=p>>12&63|128),d[c++]=p>>6&63|128),d[c++]=63&p|128)}}function Ao(o){return o.bytes[IO(o,1)]}function RO(o,n){let i=xh(o,1);o.bytes[i]=n}function Fh(o){let n,i=0,s=0;do{n=Ao(o),i<32&&(s|=(127&n)<<i),i+=7}while(128&n);return s}function jn(o,n){for(n>>>=0;n>=128;)RO(o,127&n|128),n>>>=7;RO(o,n)}function cT(o,n){let i,s=0,c=0,d=0;return i=Ao(o),s=127&i,128&i&&(i=Ao(o),s|=(127&i)<<7,128&i&&(i=Ao(o),s|=(127&i)<<14,128&i&&(i=Ao(o),s|=(127&i)<<21,128&i&&(i=Ao(o),c=127&i,128&i&&(i=Ao(o),c|=(127&i)<<7,128&i&&(i=Ao(o),c|=(127&i)<<14,128&i&&(i=Ao(o),c|=(127&i)<<21,128&i&&(i=Ao(o),d=127&i,128&i&&(i=Ao(o),d|=(127&i)<<7))))))))),{low:s|c<<28,high:c>>>4|d<<24,unsigned:n}}function El(o,n){let i=n.low>>>0,s=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,d=0===c?0===s?i<16384?i<128?1:2:i<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,h=xh(o,d),p=o.bytes;switch(d){case 10:p[h+9]=c>>>7&1;case 9:p[h+8]=9!==d?128|c:127&c;case 8:p[h+7]=8!==d?s>>>21|128:s>>>21&127;case 7:p[h+6]=7!==d?s>>>14|128:s>>>14&127;case 6:p[h+5]=6!==d?s>>>7|128:s>>>7&127;case 5:p[h+4]=5!==d?128|s:127&s;case 4:p[h+3]=4!==d?i>>>21|128:i>>>21&127;case 3:p[h+2]=3!==d?i>>>14|128:i>>>14&127;case 2:p[h+1]=2!==d?i>>>7|128:i>>>7&127;case 1:p[h]=1!==d?128|i:127&i}}const wO={},lT={},iy=4294967296,Ox=iy*iy,ry=Ox/2,dT=hT(0,!0),uT=hT(0),AO=Uh(0,-2147483648,!1),qd=Uh(-1,2147483647,!1),Nx=Uh(-1,-1,!0);function hT(o,n){let i,s,c;return n?(c=0<=(o>>>=0)&&o<256)&&(s=lT[o],s)?s:(i=Uh(o,0,!0),c&&(lT[o]=i),i):(c=-128<=(o|=0)&&o<128)&&(s=wO[o],s)?s:(i=Uh(o,o<0?-1:0,!1),c&&(wO[o]=i),i)}function Uh(o,n,i){return{low:0|o,high:0|n,unsigned:!!i}}function DO(o,n){if(isNaN(o))return n?dT:uT;if(n){if(o<0)return dT;if(o>=Ox)return Nx}else{if(o<=-ry)return AO;if(o+1>=ry)return qd}return o<0?n?dT:uT:Uh(o%iy|0,o/iy|0,n)}function OO(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}class pT extends kt{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const i=this._connectionState;this._connectionState=n,this.emit(Co.CONNECTION_STATE_CHANGE,n,i)}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(n){var i;super(),C(this,"name","AgoraRTCImageModeration"),C(this,"_connectionState",ro.CONNECTING),C(this,"_sequence",0),C(this,"_moderationStartTime",void 0),C(this,"_workerConnection",void 0),C(this,"_workerMessageLengthLimit",void 0),C(this,"_qualityRatio",void 0),C(this,"_connectInfo",void 0),C(this,"_cancelTokenSource",or.CancelToken.source()),C(this,"_retryConfig",void 0),C(this,"_moderationInterval",void 0),C(this,"_moderationTimer",null),C(this,"_moderationMode",1),C(this,"_quality",1),C(this,"_qualityTimer",null),C(this,"_ticket",void 0),C(this,"_moderationIntervalMinimum",void 0),C(this,"_uploadFailedNum",0),C(this,"_uploadNum",0),C(this,"_uploadTimer",null),C(this,"_moderationId",void 0),C(this,"inspectImage",()=>{if(this.connectionState!==ro.CONNECTED)throw new W(M.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===ro.CONNECTED?this.requestToInspectImage():I.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Ot(5,"image-moderation-"),this._workerMessageLengthLimit=B("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=B("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(i=n.interval)&&void 0!==i?i:1e3,this._qualityRatio=B("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new uh("worker-"+this._moderationId,_n),this.on(Co.STATE_CHANGE,(s,c)=>{I.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Ys[s]," ").concat(c||""))}),this.handleWorkerEvents()}init(n,i){var s=this;return x(function*(){s.emit(Co.STATE_CHANGE,Ys.CONNECT_AP),s._connectInfo=n;const c=s._cancelTokenSource.token;return s._retryConfig=i,new z((d,h)=>{s.on(Co.CONNECTION_STATE_CHANGE,(p,m)=>{p===ro.CONNECTED&&d()}),s.requestAP(n,c,i).then(p=>{s.connectWorker(p)}).catch(p=>{h(p)})})})()}updateConfig(n){var i;this._moderationInterval=null!==(i=n.interval)&&void 0!==i?i:1e3,I.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(n))),this.connectionState===ro.CONNECTED&&this.inspectImage()}requestAP(n,i,s){var c=this;return x(function*(){const d=B("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),h=yield function(_,E,y,S){let{appId:T,areaCode:O,cname:N,sid:w,token:k,uid:V}=E;rm++;const U="moderation_plugin",Y={service_name:U,json_body:JSON.stringify({appId:T,areaCode:O,cname:N,command:"allocateEdge",requestId:rm,seq:rm,sid:w,appToken:k,ts:Date.now(),uid:V+""})};let re,K,$=_[0];return Ks(x(function*(){re=Date.now();const X=yield Fa($,{data:Y,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(K=Date.now()-re,0!==X.code){const ve=new W(M.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+X.code,{retry:!0,responseTime:K});throw I.error(ve.toString()),ve}const J=JSON.parse(X.json_body);if(200!==J.code){const ve=new W(M.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(J.code,", reason: ").concat(J.reason),{code:J.code,responseTime:K});throw I.error(ve.toString()),ve}if(!J.servers||!Array.isArray(J.servers)||0===J.servers.length){const ve=new W(M.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:J.code,responseTime:K});throw I.error(ve.toString()),ve}if(!J.servers.some(ve=>!!ve.wss)){const ve=new W(M.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:J.code,responseTime:K});throw I.error(ve.toString()),ve}const Ee=B("IMAGE_MODERATION_WORKER_HOST");return{addressList:J.servers.map(ve=>{let{address:ze,wss:ht}=ve;if(ze&&ht)return"wss://".concat(ze.replace(/\./g,"-"),".").concat(Ee,":").concat(ht,"/moderation")}).filter(ve=>!!ve),workerToken:J.workerToken,vid:J.vid,ticket:J.appTicket,responseTime:K}}),(X,J)=>(ye.apworkerEvent(w,{success:!0,sc:200,serviceName:U,responseDetail:JSON.stringify(X.addressList),firstSuccess:0===J,responseTime:K,serverIp:_[J%_.length]}),!1),(X,J)=>(ye.apworkerEvent(w,{success:!1,sc:X.data&&X.data.code||200,serviceName:U,responseTime:K,serverIp:_[J%_.length]}),!!(X.code!==M.OPERATION_ABORTED&&X.code!==M.UNEXPECTED_RESPONSE||X.data&&X.data.retry)&&($=_[(J+1)%_.length],!0)),S)}(d,n,i,s);c.emit(Co.STATE_CHANGE,Ys.AP_CONNECTED);const{addressList:p,ticket:m}=h;return c._ticket=m,p})()}connectWorker(n){var i=this;return x(function*(){i.emit(Co.STATE_CHANGE,Ys.CONNECT_WORKER),yield i._workerConnection.init(n,1e4)})()}handleWorkerEvents(){var n=this;this._workerConnection.on(Oe.CONNECTED,x(function*(){n.emit(Co.STATE_CHANGE,Ys.WORKER_CONNECTED,n._workerConnection.url),n.connectionState=ro.CONNECTED})),this._workerConnection.on(Oe.CLOSED,()=>{this.connectionState=ro.CLOSED}),this._workerConnection.on(Oe.FAILED,()=>{this.connectionState=ro.CLOSED}),this._workerConnection.on(Oe.RECONNECTING,()=>{this.connectionState=this.connectionState===ro.CONNECTED?ro.RECONNECTING:ro.CONNECTING}),this._workerConnection.on(Oe.ON_MESSAGE,function(){var i=x(function*(s){if(s.data instanceof ArrayBuffer){const c=function sT(o){return function(i){let s={};e:for(;!Dx(i);){let c=Fh(i);switch(c>>>3){case 0:break e;case 1:s.code=Fh(i);break;case 2:s.msg=aT(i,Fh(i));break;case 3:s.requestId=aT(i,Fh(i));break;case 4:s.timestamp=cT(i,!1);break;default:wx(i,7&c)}}return s}({bytes:n=o,offset:0,limit:n.length});var n}(new Uint8Array(s.data));B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("[".concat(n._moderationId,"] Response message for worker of image moderation "),JSON.stringify(c)),n._uploadNum++,void 0===c.code||0===c.code||(n._uploadFailedNum++,I.error("[".concat(n._moderationId,"] Error response from worke, code is ").concat(c.code,", msg is ").concat(c.msg)),n._uploadTimer||(n._uploadTimer=window.setTimeout(()=>{ye.reportApiInvoke(n._connectInfo.sid||null,{name:Rn.IMAGE_MODERATION_UPLOAD,options:[n._uploadFailedNum,n._uploadNum,c.code],tag:Je.TRACER}).onError(new W(M.IMAGE_MODERATION_UPLOAD_FAILED,c.msg)),n._uploadTimer=null},B("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else I.error("[".concat(n._moderationId,"] Unexpected message type from worker"))});return function(s){return i.apply(this,arguments)}}()),this._workerConnection.on(Oe.WILL_RECONNECT,(i,s,c)=>{"recover"===i&&c(i),c("tryNext")}),this._workerConnection.on(Oe.REQUEST_NEW_URLS,(i,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i).catch(s)})}static intToLong(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}requestToInspectImage(){var n=this;return x(function*(){const i=to(n,Co.CLIENT_LOCAL_VIDEO_TRACK),s={appId:n._connectInfo.appId,cname:n._connectInfo.cname,cid:n._connectInfo.cid,sid:n._connectInfo.sid,uid:n._connectInfo.uid,vid:n._connectInfo.vid};if(i){if(!i.isPlaying)return void(B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("Only the track being played can be inspected"));n._sequence++;const c=yield n.generateRequestData(i,s);n._workerConnection.sendMessage(c,!0,!0)}else B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("Only the track being published can be inspected")})()}generateRequestData(n,i){var s=this;return x(function*(){let{appId:c,cname:d,cid:h,vid:p,sid:m,uid:_}=i;const E=Date.now(),y=yield n.getCurrentFrameImage("image/jpeg",s.quality),S=yield Bi(y,c,d),T=s._sequence+"-"+h+"-"+_+"-"+E+"-"+Ot(12,""),O={appId:c,cid:h,cname:d,deviceId:"",elapse:pT.intToLong(Number(E-s._moderationStartTime)),fileSize:y.buffer.byteLength,height:y.height,width:y.width,jpg:S,networkType:6,osType:7,requestId:T,sdkVersion:"4.19.1",sequence:s._sequence,sid:m,timestamp:DO(E),uid:_,vid:p,service:s._moderationMode,ticket:s._ticket},N=function TO(o){let n=function(){const i=Ax.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,s){let c=i.appId;void 0!==c&&(jn(s,10),Kd(s,c));let d=i.cid;void 0!==d&&(jn(s,16),jn(s,d));let h=i.cname;void 0!==h&&(jn(s,26),Kd(s,h));let p=i.deviceId;void 0!==p&&(jn(s,34),Kd(s,p));let m=i.elapse;void 0!==m&&(jn(s,40),El(s,m));let _=i.fileSize;void 0!==_&&(jn(s,48),El(s,Wd(_)));let E=i.height;void 0!==E&&(jn(s,56),El(s,Wd(E)));let y=i.jpg;void 0!==y&&(jn(s,66),jn(s,y.length),ny(s,y));let S=i.networkType;void 0!==S&&(jn(s,72),El(s,Wd(S)));let T=i.osType;void 0!==T&&(jn(s,80),El(s,Wd(T)));let O=i.requestId;void 0!==O&&(jn(s,90),Kd(s,O));let N=i.sdkVersion;void 0!==N&&(jn(s,98),Kd(s,N));let w=i.sequence;void 0!==w&&(jn(s,104),El(s,Wd(w)));let k=i.sid;void 0!==k&&(jn(s,114),Kd(s,k));let V=i.timestamp;void 0!==V&&(jn(s,120),El(s,V));let U=i.uid;void 0!==U&&(jn(s,128),jn(s,U));let Y=i.vid;void 0!==Y&&(jn(s,136),jn(s,Y));let re=i.width;void 0!==re&&(jn(s,144),El(s,Wd(re)));let K=i.service;void 0!==K&&(jn(s,152),jn(s,K));let $=i.callbackData;void 0!==$&&(jn(s,162),jn(s,$.length),ny(s,$));let X=i.ticket;void 0!==X&&(jn(s,170),Kd(s,X))}(o,n),function(i){let s=i.bytes,c=i.limit;return s.length===c?s:s.subarray(0,c)}(n)}(O);if(N.byteLength<s._workerMessageLengthLimit){if(B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const w=function(k){for(var V=1;V<arguments.length;V++){var U=null!=arguments[V]?arguments[V]:{};V%2?OO(Object(U),!0).forEach(function(Y){C(k,Y,U[Y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(U)):OO(Object(U)).forEach(function(Y){Object.defineProperty(k,Y,Object.getOwnPropertyDescriptor(U,Y))})}return k}({},O);delete w.jpg,I.debug("[".concat(s._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(w))}return N}return s.quality=s.quality*s._qualityRatio,yield s.generateRequestData(n,{appId:c,cname:d,cid:h,vid:p,sid:m,uid:_})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=or.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ro.CLOSED,this.emit(Co.STATE_CHANGE,Ys.CLOSED)}}function oy(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Vh(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?oy(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):oy(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class lr extends cE{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,i;return null!==(n=null===(i=this.peerConnection.getReceivers()[0])||void 0===i||null===(i=i.transport)||void 0===i?void 0:i.state)&&void 0!==n?n:null}constructor(n,i,s){super(n,i),C(this,"direction",void 0),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"transportEventReceiver",void 0),C(this,"statsFilter",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"mutex",new li("P2PConnection-mutex")),C(this,"dataChannel",void 0),C(this,"onLocalCandidate",void 0),this.store=i,this.peerConnection=new RTCPeerConnection(lr.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.direction=s??vd.SEND_ONLY,this.dataChannel=this.peerConnection.createDataChannel("agora-p2p-signal",{ordered:!0}),this.statsFilter=Ph(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,zt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}establish(n){var i=this;return x(function*(){try{if(n){yield i.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=yield i.peerConnection.createAnswer();if(yield i.peerConnection.setLocalDescription(s),!s.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");return s.sdp}{const s=yield i.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");return yield i.peerConnection.setLocalDescription(s),s.sdp}}catch(s){throw new Q(M.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}})()}connect(n){var i=this;return x(function*(){try{yield i.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(s){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}})()}addRemoteCandidate(n){var i=this;return x(function*(){try{yield i.peerConnection.addIceCandidate(n)}catch(s){throw new Q(M.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}})()}send(n){var i=this;return x(function*(){try{const s=[];n.forEach(h=>{const p=i.peerConnection.addTransceiver(h._mediaStreamTrack,{direction:"sendonly"});s.push(p)}),zt()&&!0===B("SIMULCAST")&&(yield i.applySimulcastForFirefox(s,n)),yield i.applySimulcastEncodings(s,n),yield i.applySendEncodings(s,n);const c=yield i.peerConnection.createOffer();if(yield i.peerConnection.setLocalDescription(c),!c.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");const d=s.map(h=>{const p=i.getLocalSSRC(h.mid,c.sdp);if(!p)throw new Error("Cannot get ssrc when trying to send PeerConnection.");return{mid:h.mid,localSSRC:[{ssrcId:p}]}});return{sdp:c.sdp,trackMessage:d}}catch(s){throw s instanceof Q?s:new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}})()}stopSending(n,i){var s=this;return x(function*(){const c=i?void 0:yield s.mutex.lock("From P2PConnection.stopSending");try{const d=s.peerConnection.getTransceivers().filter(p=>-1!==n.indexOf(p.mid));if(d.length!==n.length)throw new Error("Transceivers' length (".concat(d.length,") doesn't match mids' length (").concat(n.length,") when trying to call P2PConnection.stopSending."));d.map(p=>{var m;p.direction="inactive",null===(m=p.stop)||void 0===m||m.call(p),s.peerConnection.removeTrack(p.sender)});const h=yield s.peerConnection.createOffer();if(yield s.peerConnection.setLocalDescription(h),!h.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");return h.sdp}catch(d){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{c&&c()}})()}receive(n,i,s){var c=this;return x(function*(){try{yield c.peerConnection.setRemoteDescription({type:"offer",sdp:i});const d=yield c.peerConnection.createAnswer();if(!d.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");yield c.peerConnection.setLocalDescription(d),I.debug("[".concat(c.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."));const h=c.getRemoteMid(s,i);if(void 0===h)throw new Error("Cannot get transceiver mid when trying to receive track.");const p=c.peerConnection.getTransceivers().find(m=>m.mid===h);if(!p||null===p.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,mid:p.mid,sdp:d.sdp}}catch(d){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}})()}setDescription(n,i){var s=this;return x(function*(){try{if("remote"===n){yield s.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=yield s.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return yield s.peerConnection.setLocalDescription(c),I.debug("[".concat(s.store.clientId,"] [P2PConnection] exchanging SDP, type is ").concat(n)),c.sdp}yield s.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(c){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection.setDescription failed; ".concat(c.toString()))}})()}stopReceiving(n,i){var s=this;return x(function*(){try{const c=s.peerConnection.getTransceivers().filter(h=>-1!==n.indexOf(h.mid));if(c.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(h=>{var p;h.direction="inactive",null===(p=h.stop)||void 0===p||p.call(h)}),yield s.peerConnection.setRemoteDescription({type:"offer",sdp:i});const d=yield s.peerConnection.createAnswer();if(yield s.peerConnection.setLocalDescription(d),!d.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return d.sdp}catch(c){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(c.toString()))}})()}restartICE(){var n=this;return x(function*(){try{const i=yield n.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");return n.store.descriptionStart(),yield n.peerConnection.setLocalDescription(i),i.sdp}catch(i){throw new Q(M.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}})()}close(){var n;this.peerConnection.close(),null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}updateEncoderConfig(n,i){return x(function*(){})()}updateSendParameters(n,i){var s=this;return x(function*(){const c=s.peerConnection.getTransceivers().filter(d=>d.mid===n);1===c.length&&(s.isVP8Simulcast(i)?zt()||(yield s.applySimulcastEncodings(c,[i])):yield s.applySendEncodings(c,[i]))})()}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}replaceTrack(n,i){var s=this;return x(function*(){const c=s.peerConnection.getTransceivers().find(d=>d.mid===i);c&&(yield c.sender.replaceTrack(n._mediaStreamTrack))})()}getSelectedCandidatePair(){var n=this;return x(function*(){const i=n.peerConnection.getReceivers();if(i.length>0&&i[0].transport&&i[0].transport.iceTransport&&i[0].transport.iceTransport.getSelectedCandidatePair&&i[0].transport.iceTransport.getSelectedCandidatePair()){const s=i[0].transport.iceTransport,{local:c,remote:d}=s.getSelectedCandidatePair();return{local:Vh(Vh({},Qo),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port}),remote:Vh(Vh({},Qo),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return n.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;null===(n=this.onICEConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{var i;n.candidate&&(null===(i=this.onLocalCandidate)||void 0===i||i.call(this,n.candidate)),n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[]};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(hd(n.turnServer.servers)?i.iceServers=n.turnServer.servers:(i.iceServers&&i.iceServers.push(...lr.turnServerConfigToIceServers(n.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...lr.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),B("ENABLE_ENCODED_TRANSFORM")&&Ut().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(s=>{s.tcpport&&(i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Qf(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=udp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"stun:".concat(s.turnServerURL,":").concat(s.tcpport)}))}),i}tryBindTransportEvents(n){const i=n.transport;if(i){this.transportEventReceiver=n,i.onstatechange=()=>{var c;null!=i&&i.state&&(null===(c=this.onDTLSTransportStateChange)||void 0===c||c.call(this,i.state))},i.onerror=c=>{var d;null===(d=this.onDTLSTransportError)||void 0===d||d.call(this,"error"in c?c.error:c)};const s=i.iceTransport;s&&(s.onstatechange=()=>{const c=i?.iceTransport.state;var d;c&&(null===(d=this.onICETransportStateChange)||void 0===d||d.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:d}=s.getSelectedCandidatePair();I.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(n,i){var s=this;return x(function*(){var c;if(i||(i=s.peerConnection.getSenders().find(y=>y.track===n._mediaStreamTrack)),!i)return I.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(s.isVP8Simulcast(n))return I.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ut().supportSetRtpSenderParameters)return I.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(n._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(n._encoderConfig){var p;const{bitrateMax:y,frameRate:S,scaleResolutionDownBy:T}=n._encoderConfig;y&&(h.maxBitrate=1e3*y),be(p=n._hints).call(p,qt.LOW_STREAM)&&(S&&(h.maxFramerate=Er(S)),T&&T>=1&&(h.scaleResolutionDownBy=T))}if(B("DSCP_TYPE")&&pc()){var m;const y=B("DSCP_TYPE");be(m=["very-low","low","medium","high"]).call(m,y)&&(h.networkPriority=y)}const _=i.getParameters(),E=null===(c=_.encodings)||void 0===c?void 0:c[0];zt()&&!E&&(d.encodings=[h]),E&&Object.assign(E,h),Object.assign(_,d),I.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),yield i.setParameters(_)})()}applySendEncodings(n,i){var s=this;return x(function*(){try{if(!Ut().supportSetRtpSenderParameters||n.length!==i.length)return;for(let c=0;c<n.length;c++){const d=n[c],h=i[c];h instanceof We&&!s.isVP8Simulcast(h)&&(yield s.updateRtpSenderEncodings(h,d.sender))}}catch{I.debug("[".concat(s.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(n,i,s){const c=En.parse(n);return i.forEach((d,h)=>{const p=s[h],m=c.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(Ac(m,d),Nh(m,d,this.store.codec))}),En.print(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;null===(i=this.onFirstAudioReceived)||void 0===i||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;null===(i=this.onFirstVideoReceived)||void 0===i||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;null===(i=this.onFirstAudioDecoded)||void 0===i||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,s)=>{var c;null===(c=this.onFirstVideoDecoded)||void 0===c||c.call(this,n,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;null===(i=this.onFirstVideoDecodedTimeout)||void 0===i||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(n,i){var s=this;return x(function*(){if(n.length===i.length)for(let _=0;_<n.length;_++){var c,d,h,p,m;const E=n[_],y=i[_];if(y instanceof We&&!be(c=y._hints).call(c,qt.LOW_STREAM)&&null!==(d=y._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=y._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=y._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=y._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===s.store.codec){const S={},T={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const O=E.sender.getParameters();yield E.sender.setParameters(Object.assign(O,S))}}})()}applySimulcastEncodings(n,i){var s=this;return x(function*(){if(!zt()&&n.length===i.length)for(let c=0;c<n.length;c++){const d=i[c];if(d instanceof We&&s.isVP8Simulcast(d)){const h=n[c],p={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=h.sender.getParameters();yield h.sender.setParameters(Object.assign(_,p))}}})()}isVP8Simulcast(n){var i,s,c,d,h;return!!(n instanceof We&&B("SIMULCAST")&&"vp8"===this.store.codec&&!be(i=n._hints).call(i,qt.LOW_STREAM)&&null!==(s=n._encoderConfig)&&void 0!==s&&s.bitrateMax&&(null===(c=n._encoderConfig)||void 0===c?void 0:c.bitrateMax)>200&&null!==(d=n._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=n._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,s,c){if(B("SDP_LOGGING"))return I.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during P2PConnection.").concat(c,"\n"),n),"offer"===i?d=>{this.logSDPExchange(d,"answer","local"===s?"remote":"local",c)}:void 0}getLocalSSRC(n,i){var s,c,d;if(i=null!==(s=i)&&void 0!==s?s:null===(c=this.currentLocalDescription)||void 0===c?void 0:c.sdp)return(null===(d=En.parse(i).mediaDescriptions.find(p=>p.attributes.mid===n))||void 0===d?void 0:d.attributes.ssrcs)?.[0].ssrcId}getRemoteMid(n,i){var s,c,d;if(i=null!==(s=i)&&void 0!==s?s:null===(c=this.currentRemoteDescription)||void 0===c?void 0:c.sdp)return null===(d=En.parse(i).mediaDescriptions.find(h=>h.attributes.ssrcs.some(p=>p.ssrcId===n)))||void 0===d?void 0:d.attributes.mid}getRemoteSSRC(n,i){var s=this;return x(function*(){var c,d,h;if(i=null!==(c=i)&&void 0!==c?c:null===(d=s.currentRemoteDescription)||void 0===d?void 0:d.sdp)return(null===(h=En.parse(i).mediaDescriptions.find(m=>m.attributes.mid===n))||void 0===h?void 0:h.attributes.ssrcs)?.[0].ssrcId})()}}function es(o,n,i){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=x(function*(){const c=this.mutex,d=yield c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),i}var ts;function fT(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function yl(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?fT(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):fT(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}te([es,P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],lr.prototype,"establish",null),te([es,P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],lr.prototype,"connect",null),te([es,P("design:type",Function),P("design:paramtypes",[RTCIceCandidate]),P("design:returntype",z)],lr.prototype,"addRemoteCandidate",null),te([es,P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],lr.prototype,"send",null),te([es,P("design:type",Function),P("design:paramtypes",[String,String,Number]),P("design:returntype",z)],lr.prototype,"receive",null),te([es,P("design:type",Function),P("design:paramtypes",[String,String]),P("design:returntype",z)],lr.prototype,"setDescription",null),te([es,P("design:type",Function),P("design:paramtypes",[Array,String]),P("design:returntype",z)],lr.prototype,"stopReceiving",null),te([es,P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",z)],lr.prototype,"restartICE",null),te([es,P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],lr.prototype,"close",null),te([es,P("design:type",Function),P("design:paramtypes",[String,wi]),P("design:returntype",z)],lr.prototype,"updateEncoderConfig",null),te([es,P("design:type",Function),P("design:paramtypes",[String,wi]),P("design:returntype",z)],lr.prototype,"updateSendParameters",null),te([es,P("design:type",Function),P("design:paramtypes",[wi,String]),P("design:returntype",z)],lr.prototype,"replaceTrack",null),function(o){o.SEND_ONLY="SEND_ONLY",o.RECEIVE_ONLY="RECEIVE_ONLY"}(ts||(ts={}));class hn extends kt{get state(){return this._state}set state(n){const i=this._state;this._state=n,this.emit(Re.StateChange,i,this._state)}constructor(n,i){var s;super(),s=this,C(this,"store",void 0),C(this,"statsUploader",void 0),C(this,"sendConnection",void 0),C(this,"recvConnection",void 0),C(this,"localTrackMap",new Map),C(this,"remoteUserMap",new Map),C(this,"localDataChannels",[]),C(this,"pendingLocalTracks",[]),C(this,"pendingRemoteTracks",[]),C(this,"statsCollector",void 0),C(this,"dtlsFailedCount",0),C(this,"sendMutex",new li("P2PChannel2-send-mutex")),C(this,"recvMutex",new li("P2PChannel2-recv-mutex")),C(this,"_state",et.Disconnected),C(this,"_restartStates",["disconnected","failed"]),C(this,"_restartTimer",void 0),C(this,"handleMuteLocalTrack",function(){var c=x(function*(d,h,p){const m=yield s.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!s.sendConnection||s.state!==et.Connected)return void p(new Q(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const y=s.filterTobeMutedTracks(d);if(0===y.length)return void h();const S=y.find(U=>"videoLowTrack"===U[0]);S&&S[1].track._originMediaStreamTrack.stop();let T=!1;var _,E;T="video"===d.trackMediaType?!(null===(_=s.localTrackMap.get(ne.LocalAudioTrack))||void 0===_||!_.track._muted):void 0===(null===(E=s.localTrackMap.get(ne.LocalVideoTrack))||void 0===E?void 0:E.id);const O=y.filter(U=>{let[Y,re]=U;return(Y!==ne.LocalAudioTrack||T)&&void 0!==re.id}).map(U=>{let[,Y]=U;return Y});let N;O.length>0&&(N=yield s.sendConnection.stopSending(O.map(U=>U.id)),O.forEach(U=>{U.id=void 0,U.ssrcs=void 0}));const w=s.createMuteMessage(y),k="video"===d.trackMediaType?Es.MUTE_LOCAL_VIDEO:Es.MUTE_LOCAL_AUDIO,V=yield dn(s,Re.RequestP2PMuteLocal,{action:k,sdp:N,message:w,isMuteAll:T});V&&(yield s.sendConnection.setDescription("local",V)),(N||"audio"===d.trackMediaType)&&(yield St(s,Re.RequestMuteLocal,w)),h()}catch(y){p(y)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),C(this,"handleUnmuteLocalTrack",function(){var c=x(function*(d,h,p){const m=yield s.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!s.sendConnection||s.state!==et.Connected)return void p(new Q(M.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const _=s.filterTobeUnmutedTracks(d);if(0===_.length)return void h();const E=s.createUnmuteMessage(_),y="video"===d.trackMediaType?Es.UNMUTE_LOCAL_VIDEO:Es.UNMUTE_LOCAL_AUDIO;yield St(s,Re.RequestP2PMuteLocal,{action:y,message:E}),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),C(this,"handleUpdateVideoEncoder",function(){var c=x(function*(d,h,p){const m=yield s.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const _=s.localTrackMap.get(ne.LocalVideoTrack);if(!s.sendConnection||!_||_.track!==d||s.state!==et.Connected)return void h();const{id:E,track:y}=_;E&&(yield s.sendConnection.updateSendParameters(E,y),yield s.sendConnection.updateEncoderConfig(E,y),s.emit(Re.UpdateVideoEncoder,y)),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),C(this,"handleSetOptimizationMode",function(){var c=x(function*(d,h,p){const m=yield s.sendMutex.lock("Locking from P2PChannel2.handleSetOptimizationMode");try{const _=s.localTrackMap.get(ne.LocalVideoTrack);if(!s.sendConnection||!_||_.track!==d||s.state!==et.Connected)return;const{id:E,track:y}=_;E&&(yield s.sendConnection.updateSendParameters(E,y)),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),C(this,"handleReplaceTrack",function(){var c=x(function*(d,h,p,m){let _;I.debug("[".concat(s.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(d.getTrackId(),"]")),"boolean"==typeof m&&m||(_=yield s.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var E;const S=Array.from(s.localTrackMap.entries()).find(T=>{let[,{track:O}]=T;return d===O});if(!s.sendConnection||!S||void 0===S[1].id||s.state!==et.Connected)return void h();if(yield null===(E=s.sendConnection)||void 0===E?void 0:E.replaceTrack(d,S[1].id),S[0]===ne.LocalVideoTrack&&Ut().supportDualStreamEncoding){const T=s.localTrackMap.get(ne.LocalVideoLowTrack);if(T){const O=d._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=O,T.track._originMediaStreamTrack=O,yield new z((N,w)=>{s.handleReplaceTrack(T.track,N,w,!0)})}}h()}catch(S){p(S)}finally{var y;null===(y=_)||void 0===y||y()}});return function(d,h,p,m){return c.apply(this,arguments)}}()),C(this,"handleGetLocalVideoStats",c=>{c(this.statsCollector.getLocalVideoTrackStats())}),C(this,"handleGetLocalAudioStats",c=>{c(this.statsCollector.getLocalAudioTrackStats())}),C(this,"handleGetRemoteVideoStats",c=>this.statsCollector.getRemoteVideoTrackStats(c.uid)[c.uid]),C(this,"handleGetRemoteAudioStats",c=>this.statsCollector.getRemoteAudioTrackStats(c.uid)[c.uid]),this.store=n,this.statsCollector=i,this.statsCollector.addP2PChannel(this),this.statsUploader=new Cx,this.bindStatsUploaderEvents()}startP2PConnection(n,i){return x(function*(){throw new Q(M.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")})()}connect(n,i,s,c,d,h){return x(function*(){throw new Q(M.NOT_SUPPORTED,"p2p mode does not support connect.")})()}startP2P(n,i){var s=this;return x(function*(){if(s.state=et.New,s.sendConnection&&(I.warning("[".concat(s.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),s.sendConnection.close(),s.unbindConnectionEvents(s.sendConnection)),s.recvConnection&&(I.warning("[".concat(s.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),s.recvConnection.close(),s.unbindConnectionEvents(s.recvConnection)),s.sendConnection=new lr(n,s.store),s.bindConnectionEvents(s.sendConnection),s.recvConnection=new lr(n,s.store,vd.RECEIVE_ONLY),s.bindConnectionEvents(s.recvConnection),i){s.store.peerConnectionStart(),yield s.recvConnection.establish(i);const c=yield s.sendConnection.establish(i);return s.statsUploader.startUploadTransportStats(!0),s.statsUploader.startUploadExtensionUsageStats(),s.state=et.Connected,c}return yield s.recvConnection.establish(i),s.sendConnection.establish(i)})()}p2pConnect(n){var i=this;return x(function*(){if(!i.sendConnection||!i.recvConnection)throw new Q(M.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.startP2PConnection .");i.store.peerConnectionStart(),yield i.recvConnection.connect(n),yield i.sendConnection.connect(n),i.statsUploader.startUploadTransportStats(),i.statsUploader.startUploadExtensionUsageStats(),i.state=et.Connected})()}addRemoteCandidate(n){var i=this;return x(function*(){if(!i.sendConnection||!i.recvConnection)throw new Q(M.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield i.recvConnection.addRemoteCandidate(n),yield i.sendConnection.addRemoteCandidate(n)})()}publish(n,i,s){var c=this;return x(function*(){if(!c.sendConnection||c.state!==et.Connected){c.throwIfTrackTypeNotMatch(n);const p=n.filter(m=>-1===c.pendingLocalTracks.indexOf(m));return void(c.pendingLocalTracks=c.pendingLocalTracks.concat(p))}c.store.pubId=c.store.pubId+1,gi.markPublishStart(c.store.clientId,c.store.pubId);const d=c.filterTobePublishedTracks(n,i,s);if(0===d.length)return void(yield c.tryToUnmuteAudio(n));d.forEach(p=>{let{track:m,type:_}=p;const E=Date.now();c.store.publish(m.getTrackId(),_===ne.LocalAudioTrack?"audio":"video",E)}),c.bindLocalTrackEvents(d);const h=c.createGatewayPublishMessage(d);return c.assignLocalTracks(d),d.forEach(p=>{let{track:m,type:_}=p;const E=Date.now();c.store.publish(m.getTrackId(),_===ne.LocalAudioTrack?"audio":"video",void 0,E)}),h})()}dopublish(n){var i=this;return x(function*(){if(!i.sendConnection||i.state!==et.Connected)return;const s=i.localTrackMap.get(n);if(s){const{sdp:c,trackMessage:d}=yield i.sendConnection.send([s.track]),{mid:h,localSSRC:p}=d[0];s.id=h,s.ssrcs=p,i.statsCollector.addLocalStats(n),i.statsUploader.startUploadUplinkStats();const m=yield dn(i,Re.RequestP2PPublish,{kind:n===ne.LocalAudioTrack?_e.AUDIO:_e.VIDEO,sdp:c,ssrcId:p[0].ssrcId});yield i.sendConnection.setDescription("local",m);const _=i.createUnmuteMessage([[n,s]]);yield St(i,Re.RequestUnmuteLocal,_)}})()}setDescription(n,i){var s=this;return x(function*(){let c,d;"local"===n?(c=yield s.sendMutex.lock("From P2PChannel.restartICE"),d=s.sendConnection):(c=yield s.recvMutex.lock("From P2PChannel.restartICE"),d=s.recvConnection);try{return d&&s.state===et.Connected?yield d.setDescription(n,i):void 0}finally{c()}})()}publishLowStream(n){return Ro(function*(){throw new Q(M.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}republish(){var n=this;return x(function*(){n.pendingLocalTracks.length>0&&(I.debug("[".concat(n.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield dn(n,Re.RequestRePublish,n.pendingLocalTracks),n.emit(Re.MediaReconnectEnd,n.store.uid),n.pendingLocalTracks=[])})()}unpublish(n){var i=this;return x(function*(){if(!i.sendConnection||i.state!==et.Connected)return void(0===n.length?i.pendingLocalTracks.length=0:i.pendingLocalTracks=i.pendingLocalTracks.filter(_=>!be(n).call(n,_)));const s=i.filterTobeUnpublishedTracks(n);if(0===s.length)return;i.unbindLocalTrackEvents(s.map(_=>{let[E,{track:y}]=_;return{type:E,track:y}}));const c=s.filter(_=>{let[,{id:E}]=_;return void 0!==E});if(!i.sendConnection||i.state!==et.Connected)return void n.forEach(_=>{const E=i.pendingLocalTracks.indexOf(_);-1!==E&&i.pendingLocalTracks.splice(E,1)});const d=s.find(_=>"videoLowTrack"===_[0]);let h;d&&d[1].track.close();const p=i.createGatewayUnpublishMessage(s);c.length>0&&(h=yield i.sendConnection.stopSending(c.map(_=>{let[,{id:E}]=_;return E}))),i.withdrawLocalTracks(s),i.unbindLocalTrackEvents(s.map(_=>{let[E,{track:y}]=_;return{type:E,track:y}})),s.forEach(_=>{let[E]=_;i.statsCollector.removeLocalStats(E)}),0===i.localTrackMap.size&&i.statsUploader.stopUploadUplinkStats();const m=i.createMuteMessage(s);return yield z.all(m.map(function(){var _=x(function*(E){yield St(i,Re.RequestMuteLocal,[E])});return function(E){return _.apply(this,arguments)}}())),{sdp:h,unpubMsg:p}})()}unpublishLowStream(){return x(function*(){throw new Q(M.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")})()}doUnpublish(n){var i=this;return x(function*(){if(!i.sendConnection||i.state!==et.Connected)return;const s=[];if(n!==_e.AUDIO){const c=i.localTrackMap.get(ne.LocalVideoTrack);void 0!==c?.id&&s.push([ne.LocalVideoTrack,c]);const d=i.localTrackMap.get(ne.LocalVideoLowTrack);void 0!==d?.id&&s.push([ne.LocalVideoLowTrack,d]),i.statsCollector.removeLocalStats(ne.LocalVideoTrack),i.statsCollector.removeLocalStats(ne.LocalVideoLowTrack)}if(n!==_e.VIDEO){const c=i.localTrackMap.get(ne.LocalAudioTrack);void 0!==c?.id&&s.push([ne.LocalAudioTrack,c]),i.statsCollector.removeLocalStats(ne.LocalAudioTrack)}if(s.length>0){const c=yield i.sendConnection.stopSending(s.map(p=>{let[,m]=p;return m.id}));s.forEach(p=>{let[,m]=p;m.id=void 0,m.ssrcs=void 0});const d=yield dn(i,Re.RequestP2PUnPublish,{sdp:c,kind:n});yield i.sendConnection.setDescription("local",d);const h=i.createMuteMessage(s);yield z.all(h.map(function(){var p=x(function*(m){yield St(i,Re.RequestMuteLocal,[m])});return function(m){return p.apply(this,arguments)}}()))}})()}subscribe(n,i,s,c){var d=this;return x(function*(){var h;if(!d.recvConnection||d.state!==et.Connected)throw new Q(M.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(h=d.remoteUserMap.get(n))&&void 0!==h&&h.has(i))return;const{track:p,mid:m,sdp:_}=yield d.recvConnection.receive(i,s,c);i===_e.AUDIO?(n._audioSSRC=c,n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(p):(n._audioTrack=new ys(p,n.uid,n._uintid,d.store),I.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),d.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoSSRC=c,n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(p):(n._videoTrack=new Jt(p,n.uid,n._uintid,d.store),I.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),d.bindRemoteTrackEvents(n,n._videoTrack));const E=d.remoteUserMap.get(n);E?E.set(i,m):d.remoteUserMap.set(n,new Map([[i,m]])),d.statsCollector.addRemoteStats(n.uid),d.statsUploader.startUploadDownlinkStats(),yield St(d,Re.RequestP2PUnmuteRemote,i);const y=d.pendingRemoteTracks.findIndex(S=>{let{user:T,kind:O}=S;return T.uid===n.uid&&i===O});return-1!==y&&(d.pendingRemoteTracks.splice(y,1),d.emit(Re.MediaReconnectEnd,n.uid)),_})()}unsubscribe(n,i,s,c){var d=this;return x(function*(){const h=d.pendingRemoteTracks.filter(_=>{let{user:E,kind:y}=_;return void 0!==s?E.uid===n.uid&&s===y:E.uid===n.uid});if(h.forEach(_=>{const E=d.pendingRemoteTracks.indexOf(_);d.pendingRemoteTracks.splice(E,1)}),d.recvConnection&&d.state===et.Connected||c||h.forEach(_=>{let{kind:E}=_;var y;if(E===_e.AUDIO)null===(y=n._audioTrack)||void 0===y||y._destroy(),n._audioTrack=void 0;else if(E===_e.VIDEO){var S;null===(S=n._videoTrack)||void 0===S||S._destroy(),n._videoTrack=void 0}}),!d.recvConnection||d.state!==et.Connected)return;const p=d.filterTobeUnSubscribedTracks(n,s);if(0===p.length)return void(s!==_e.VIDEO&&St(d,Re.RequestP2PMuteRemote,_e.AUDIO));const m=yield d.recvConnection.stopReceiving(p.map(_=>{let[,{id:E}]=_;return E}),i);return d.withdrawRemoteTracks(p),0===d.remoteUserMap.size&&d.statsUploader.stopUploadDownlinkStats(),p.forEach(_=>{let[E,{kind:y}]=_;var S,T;if(y===_e.VIDEO&&E._videoSSRC&&(null===(S=d.recvConnection)||void 0===S||S.setStatsRemoteVideoIsReady(E._videoSSRC,!1)),y===_e.VIDEO)d.unbindRemoteTrackEvents(E._videoTrack),c||(null===(T=E._videoTrack)||void 0===T||T._destroy(),E._videoTrack=void 0);else if(y===_e.AUDIO){var O;d.unbindRemoteTrackEvents(E._audioTrack),!c&&(null===(O=E._audioTrack)||void 0===O||O._destroy(),E._audioTrack=void 0)}}),p.filter(_=>{let[,{kind:E}]=_;return E!==_e.AUDIO}).forEach(_=>{let[,{kind:E}]=_;St(d,Re.RequestP2PMuteRemote,E)}),s!==_e.VIDEO&&St(d,Re.RequestP2PMuteRemote,_e.AUDIO),m})()}getAllDataChannels(){return this.localDataChannels}massSubscribe(n){return x(function*(){throw new Q(M.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")})()}massSubscribeNoLock(n){return x(function*(){throw new Q(M.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")})()}massUnsubscribe(n){return x(function*(){throw new Q(M.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")})()}massUnsubscribeNoLock(n){return x(function*(){throw new Q(M.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")})()}muteRemote(n,i){var s=this;return x(function*(){if(!s.recvConnection)return;const c=s.remoteUserMap.get(n);if(!c)return void I.warning("[".concat(s.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(n.uid,"."));if(!c.get(i))return void I.warning("[".concat(s.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(n.uid," media type ").concat(i,"."));const d=i===_e.VIDEO?n._videoSSRC:n._audioSSRC;void 0!==d&&s.recvConnection.setStatsRemoteVideoIsReady(d,!1)})()}unmuteRemote(n,i){var s=this;return x(function*(){return s.unmuteRemoteNoLock(n,i)})()}unmuteRemoteNoLock(n,i){var s=this;return x(function*(){if(!s.recvConnection)return;const c=s.remoteUserMap.get(n);c?c.get(i)||I.warning("[".concat(s.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(n.uid," media type ").concat(i,".")):I.warning("[".concat(s.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(n.uid,"."))})()}getAllTracks(n){const i=this.localTrackMap.get(ne.LocalAudioTrack);if(i?.track instanceof qn){const s=i.track;return Array.from(this.localTrackMap.entries()).filter(c=>{let[d]=c;return d!==ne.LocalAudioTrack}).filter(c=>{let[d]=c;return!(n&&d===ne.LocalVideoLowTrack)}).map(c=>{let[,{track:d}]=c;return d}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return!(n&&c===ne.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c})}reportPublishEvent(n,i,s,c,d){if(n){const p=this.localTrackMap.get(ne.LocalAudioTrack),m=this.localTrackMap.get(c?ne.LocalVideoLowTrack:ne.LocalVideoTrack);ye.publish(this.store.sessionId,{eventElapse:gi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:i,audioName:p?.track.getTrackLabel(),videoName:m?.track.getTrackLabel(),screenshare:-1!==m?.track._hints.indexOf(qt.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}else{var h;s||(s=[]);const p=s.find(_=>_ instanceof ct),m=c?null===(h=this.localTrackMap.get(ne.LocalVideoTrack))||void 0===h?void 0:h.track:s.find(_=>_ instanceof We);ye.publish(this.store.sessionId,{eventElapse:gi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:i,audioName:p?.getTrackLabel(),videoName:m?.getTrackLabel(),screenshare:-1!==m?._hints.indexOf(qt.SCREEN_TRACK),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}}reportSubscribeEvent(n,i,s,c){const d=c===_e.VIDEO?s._videoSSRC:s._audioSSRC;d&&ye.subscribe(this.store.sessionId,{succ:n,ec:i,video:c===_e.VIDEO,audio:c===_e.AUDIO,peerid:s.uid,subscribeRequestid:c===_e.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:gi.measureFromSubscribeStart(this.store.clientId,d)})}reset(){I.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new li("P2PChannel2-send-mutex"),this.sendMutex=new li("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const n=this.localTrackMap.get(ne.LocalAudioTrack);if(n?.track instanceof qn){if(n.track.trackList.length>0){const i=n.track;n.track.trackList.forEach(s=>{i.removeAudioTrack(s)})}n.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=et.Disconnected}getStats(n){var i,s;return n?null===(s=this.recvConnection)||void 0===s?void 0:s.getStats():null===(i=this.sendConnection)||void 0===i?void 0:i.getStats()}getRemoteVideoIsReady(n){var i;return(null===(i=this.recvConnection)||void 0===i?void 0:i.getRemoteVideoIsReady(n))||!1}getLocalAudioVolume(){const n=this.localTrackMap.get(ne.LocalAudioTrack);if(n)return n.track.getVolumeLevel()}getLocalVideoSize(){const n=this.localTrackMap.get(ne.LocalVideoTrack);if(n)return{width:n.track._videoWidth||0,height:n.track._videoHeight||0}}getEncoderConfig(n){const i=this.localTrackMap.get(n);return i&&i.track instanceof We||i&&i.track instanceof ct?i.track._encoderConfig:void 0}getLocalMedia(n){return this.localTrackMap.get(n)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(n,i){if(!n)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(n);return!!s&&(!i||s.has(i))}hasRemoteMediaWithLock(n,i){var s=this;return x(function*(){if(!n)return s.remoteUserMap.size>0;const c=s.remoteUserMap.get(n);return!!c&&(!i||c.has(i))})()}getRemoteMedia(n){var i;const s=Array.from(Eo(i=this.remoteUserMap).call(i)).find(c=>c.uid===n);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let n=Array.from(this.remoteUserMap.entries()).map(s=>{let[c]=s;return{uid:c.uid,level:c.audioTrack?100*c.audioTrack._source.getAccurateVolumeLevel():0}});const i=this.localTrackMap.get(ne.LocalAudioTrack);return i&&n.push({level:100*i.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),n=Vp(n).call(n,(s,c)=>s.level-c.level),n}disconnectForReconnect(){var n=this;return x(function*(){n.sendConnection&&n.recvConnection&&(I.debug("[".concat(n.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),n.state=et.Reconnecting,B("KEEP_LAST_FRAME")&&0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(i=>{let[s]=i;var c;s._videoTrack&&s._videoTrack._player&&(null===(c=s._videoTrack._player.getVideoElement())||void 0===c||c.pause(),s._videoTrack._player.isKeepLastFrame=!0,s._videoTrack._originMediaStreamTrack.stop())}),n.sendConnection.close(),n.unbindConnectionEvents(n.sendConnection),n.sendConnection=void 0,n.recvConnection.close(),n.unbindConnectionEvents(n.recvConnection),n.recvConnection=void 0,0!==n.localTrackMap.size&&(Array.from(n.localTrackMap.entries()).forEach(i=>{var s;let[c,{track:d}]=i;switch(c){case ne.LocalVideoTrack:be(s=d._hints).call(s,qt.LOW_STREAM)?d.close():n.pendingLocalTracks.push(d);break;case ne.LocalAudioTrack:d instanceof qn?n.pendingLocalTracks=n.pendingLocalTracks.concat(d.trackList):n.pendingLocalTracks.push(d)}}),n.emit(Re.MediaReconnectStart,n.store.uid)),n.unbindLocalTrackEvents(),n.localTrackMap.clear(),0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(i=>{let[s,c]=i;Array.from(Eo(c).call(c)).forEach(d=>{n.setPendingRemoteMedia(s,d)}),n.emit(Re.MediaReconnectStart,s.uid)}),n.unbindAllRemoteTrackEvents(),n.remoteUserMap.clear(),n.statsUploader.stopUploadUplinkStats(),n.statsUploader.stopUploadDownlinkStats(),n.statsUploader.stopUploadTransportStats(),I.debug("[".concat(n.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))})()}hasPendingRemoteMedia(n,i){for(const s of this.pendingRemoteTracks){const{user:c,kind:d}=s;if((n instanceof vi?n.uid:n)===c.uid&&i===d)return!0}return!1}setPendingRemoteMedia(n,i){this.hasPendingRemoteMedia(n,i)||this.pendingRemoteTracks.push({user:n,kind:i})}restartICE(n){var i=this;return x(function*(){let s;s=n.direction===vd.SEND_ONLY?yield i.sendMutex.lock("From P2PChannel.restartICE"):yield i.recvMutex.lock("From P2PChannel.restartICE");try{const c=yield n.restartICE(),d=yield dn(i,Re.RequestP2PRestartICE,c);n.setDescription("local",d)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const n=this.sendConnection.getStats(),i=this.localTrackMap.get(ne.LocalVideoTrack),s=this.localTrackMap.get(ne.LocalAudioTrack),c=n.videoSend.find(O=>{var N;return O.ssrc===(null==i||null===(N=i.ssrcs)||void 0===N?void 0:N[0].ssrcId)}),d=n.audioSend.find(O=>{var N;return O.ssrc===(null==s||null===(N=s.ssrcs)||void 0===N?void 0:N[0].ssrcId)});if(!c||!d)return 1;const h=to(this,Re.NeedSignalRTT),p=c?c.rttMs:void 0,m=d?d.rttMs:void 0,_=p&&m?(p+m)/2:p||m,y=100*n.sendPacketLossRate*.7/50+.3*((_&&h?(_+h)/2:_||h)||0)/1500,S=y<.17?1:y<.36?2:y<.59?3:y<.1?4:5,T=i?.track;if(T&&T._encoderConfig&&-1===T._hints.indexOf(qt.SCREEN_TRACK)){const O=T._encoderConfig.bitrateMax,N=n.bitrate.actualEncoded;if(O&&N){const w=(1e3*O-N)/(1e3*O);return oE[w<.15?0:w<.3?1:w<.45?2:w<.6?3:4][S]}}return S}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const n=this.recvConnection.getStats();let i=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[c]=s;const d=c._audioSSRC,h=c._videoSSRC,p=n.audioRecv.find(N=>N.ssrc===d),m=n.videoRecv.find(N=>N.ssrc===h);if(!p&&!m)return void(i+=1);const _=to(this,Re.NeedSignalRTT),E=n.rtt,y=(E&&_?(E+_)/2:E||_)||0,S=p?p.jitterMs:void 0,T=n.recvPacketLossRate;let O=.7*T*100/50+.3*y/1500;S&&(O=.6*T*100/50+.2*y/1500+.2*S/400),i+=O<.1?1:O<.17?2:O<.36?3:O<.59?4:5}),this.remoteUserMap.size>0?Math.round(i/this.remoteUserMap.size):i}muteLocalTrack(n){var i=this;return x(function*(){return new z((s,c)=>{i.handleMuteLocalTrack(n,s,c)})})()}filterTobePublishedTracks(n,i,s){const c=[],d=Ut(),h=this.getAllTracks();n=pd(n=n.filter(_=>-1===h.indexOf(_)));let p=!1,m=!1;for(const _ of n){if(_ instanceof We&&(this.localTrackMap.has(ne.LocalVideoTrack)||p?new Q(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(c.push({track:_,type:ne.LocalVideoTrack}),p=!0),i)){const E=this.getLowVideoTrack(_,s);c.push({track:E,type:ne.LocalVideoLowTrack})}if(_ instanceof ct){const E=this.localTrackMap.get(ne.LocalAudioTrack);if(E){if(!(E.track instanceof qn))throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const y=c.find(S=>{let{type:T}=S;return T===ne.LocalAudioTrack});if(!(y.track instanceof qn))throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(_)}else{if(!d.webAudioMediaStreamDest||_ instanceof qn||_._bypassWebAudio)c.push({track:_,type:ne.LocalAudioTrack});else{const y=new qn;y.addAudioTrack(_),c.push({track:y,type:ne.LocalAudioTrack})}m=!0}}}return c}filterTobeUnpublishedTracks(n){const i=[],s=this.getAllTracks();n=pd(n=n.filter(c=>-1!==s.indexOf(c)));for(const c of n){if(c instanceof ct){const d=this.localTrackMap.get(ne.LocalAudioTrack);if(!d)continue;d.track instanceof qn?(d.track.removeAudioTrack(c),this.unbindLocalAudioTrackEvents(c),0===d.track.trackList.length&&(i.push([ne.LocalAudioTrack,d]),d.track.close())):i.push([ne.LocalAudioTrack,d])}if(c instanceof We){const d=this.localTrackMap.get(ne.LocalVideoTrack);if(!d)continue;i.push([ne.LocalVideoTrack,d]);const h=this.localTrackMap.get(ne.LocalVideoLowTrack);h&&i.push([ne.LocalVideoLowTrack,h])}}return i}bindLocalTrackEvents(n){n.forEach(i=>{let{track:s,type:c}=i;switch(c){case ne.LocalVideoTrack:s.addListener(me.GET_STATS,this.handleGetLocalVideoStats),s.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(me.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),s.addListener(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.bindLocalAudioTrackEvents(s)}})}bindLocalAudioTrackEvents(n,i){n instanceof qn?n.trackList.forEach(s=>{s.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(me.GET_STATS,this.handleGetLocalAudioStats),s.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.addListener(me.GET_STATS,this.handleGetLocalAudioStats),n.addListener(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),i||n.addListener(me.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(n){n||(n=Array.from(this.localTrackMap.entries()).map(i=>{let[s,{track:c}]=i;return{track:c,type:s}})),n.forEach(i=>{let{track:s,type:c}=i;switch(c){case ne.LocalVideoTrack:s.off(me.GET_STATS,this.handleGetLocalVideoStats),s.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(me.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(me.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),s.off(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s)}})}unbindLocalAudioTrackEvents(n){n instanceof qn?n.trackList.forEach(i=>{i.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(me.GET_STATS,this.handleGetLocalAudioStats),i.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.off(me.GET_STATS,this.handleGetLocalAudioStats),n.off(me.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(me.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(me.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(me.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(me.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(n,i){i instanceof Jt&&i.addListener(me.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(n))}),i instanceof ys&&i.addListener(me.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(n))})}unbindRemoteTrackEvents(n){n&&n.removeAllListeners(me.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i,s]=n;s.has(_e.AUDIO)&&this.unbindRemoteTrackEvents(i._audioTrack),s.has(_e.VIDEO)&&this.unbindRemoteTrackEvents(i._videoTrack)})}createGatewayPublishMessage(n){return n.map(i=>{var s;let c,d,{track:h,type:p}=i;switch(p){case ne.LocalAudioTrack:c=It.Audio,d={dtx:h instanceof Qi&&h._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ne.LocalVideoTrack:c=be(s=h._hints).call(s,qt.SCREEN_TRACK)?It.Screen:It.High,d=yl(yl({},Zf(h)),{},{codec:this.store.codec});break;case ne.LocalVideoLowTrack:c=It.Low,d=yl(yl({},Zf(h)),{},{codec:this.store.codec})}return{kind:p===ne.LocalAudioTrack?_e.AUDIO:_e.VIDEO,stream_type:c,attributes:d,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(n){return n.map(i=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=i;switch(d){case ne.LocalVideoTrack:c=be(s=h._hints).call(s,qt.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalAudioTrack:c=It.Audio;break;case ne.LocalVideoLowTrack:c=It.Low}return{stream_type:c,ssrcs:p,mid:m}})}assignLocalTracks(n){n.forEach(i=>{let{track:s,type:c}=i;this.localTrackMap.set(c,{track:s})})}withdrawLocalTracks(n){n.forEach(i=>{let[s]=i;this.localTrackMap.delete(s)})}bindConnectionEvents(n){var i=this;n.onConnectionStateChange=function(){var s=x(function*(c){var d;if(I.info("[".concat(i.store.clientId,"] [p2pId: ").concat(i.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(c,")")),i.emit(Re.PeerConnectionStateChange,c),"connected"!==c||i.store.keyMetrics.peerConnectionEnd||i.store.peerConnectionEnd(),be(d=i._restartStates).call(d,c)||n.direction===vd.SEND_ONLY){if(i._restartTimer)return;const h=()=>{("disconnected"===n.iceConnectionState||"checking"===n.iceConnectionState||"failed"===n.iceConnectionState)&&(I.debug("[".concat(i.store.clientId,"] [P2PChannel] start use restartICE")),"CONNECTED"===to(i,Re.QueryClientConnectionState)&&i.restartICE(n))};i._restartTimer=window.setTimeout(()=>{h(),i._restartTimer=void 0},800)}});return function(c){return s.apply(this,arguments)}}(),n.onICEConnectionStateChange=s=>{"connected"!==s||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(s,")")),ye.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:s,tag:Je.TRACER}).onSuccess(),this.emit(Re.IceConnectionStateChange,s)},n.onICETransportStateChange=s=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(s,")"))},n.onDTLSTransportStateChange=s=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(s,")"))},n.onDTLSTransportError=s=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(s,")"))},n.onFirstAudioDecoded=s=>{var c;const d=Array.from(Eo(c=this.remoteUserMap).call(c)).find(p=>p._audioSSRC===s);var h;d&&(this.store.subscribe(d.uid,"audio",void 0,void 0,void 0,Date.now()),null===(h=d.audioTrack)||void 0===h||h.emit(Rd.FIRST_FRAME_DECODED),ye.firstRemoteFrame(this.store.sessionId,Yn.FIRST_AUDIO_DECODE,Kt.FIRST_AUDIO_DECODE,{peer:d._uintid,subscribeElapse:gi.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId}))},n.onFirstAudioReceived=s=>{var c;const d=Array.from(Eo(c=this.remoteUserMap).call(c)).find(h=>h._audioSSRC===s);d&&ye.firstRemoteFrame(this.store.sessionId,Yn.FIRST_AUDIO_RECEIVED,Kt.FIRST_AUDIO_RECEIVED,{peer:d._uintid,subscribeElapse:gi.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},n.onFirstVideoDecoded=(s,c,d)=>{this.reportVideoFirstFrameDecoded(s,c,d)},n.onFirstVideoReceived=s=>{var c;const d=Array.from(Eo(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===s);d&&ye.firstRemoteFrame(this.store.sessionId,Yn.FIRST_VIDEO_RECEIVED,Kt.FIRST_VIDEO_RECEIVED,{peer:d._uintid,subscribeElapse:gi.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},n.onSelectedLocalCandidateChanged=(s,c)=>{const d="relay"===s.candidateType;"unknown"!==c.candidateType&&d===("relay"===c.candidateType)||this.emit(Re.ConnectionTypeChange,d),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(pl(c))," -> ").concat(JSON.stringify(pl(s)),")"))},n.onSelectedRemoteCandidateChanged=(s,c)=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(pl(c))," -> ").concat(JSON.stringify(pl(s)),")"))},n.onFirstVideoDecodedTimeout=s=>{this.reportVideoFirstFrameDecoded(s,void 0,void 0,!0)},n.onLocalCandidate=s=>{this.emit(Re.LocalCandidate,s)}}unbindConnectionEvents(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0,n.onLocalCandidate=void 0}filterTobeMutedTracks(n){const i=[];if(-1===this.getAllTracks().indexOf(n))return i;const s=this.localTrackMap.get(ne.LocalAudioTrack);if(n instanceof ct&&s?.track instanceof qn)return s.track.isActive||i.push([ne.LocalAudioTrack,s]),i;const c=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(c&&(i.push(c),c[0]===ne.LocalVideoTrack)){const d=this.localTrackMap.get(ne.LocalVideoLowTrack);d&&i.push([ne.LocalVideoLowTrack,d])}return i}filterTobeUnmutedTracks(n){const i=[],s=this.localTrackMap.get(ne.LocalAudioTrack);if(n instanceof ct&&s?.track instanceof qn)return s.track.isActive&&i.push([ne.LocalAudioTrack,s]),i;const c=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(c)if(c[0]===ne.LocalVideoTrack){i.push(c);const d=this.localTrackMap.get(ne.LocalVideoLowTrack);d&&i.push([ne.LocalVideoLowTrack,d])}else i.push(c);return i}createMuteMessage(n){return n.map(i=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=i;switch(d){case ne.LocalAudioTrack:c=It.Audio;break;case ne.LocalVideoTrack:c=be(s=h._hints).call(s,qt.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalVideoLowTrack:c=It.Low}return{stream_type:c,ssrcs:p,mid:m}})}createUnmuteMessage(n){return n.map(i=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=i;switch(d){case ne.LocalAudioTrack:c=It.Audio;break;case ne.LocalVideoTrack:c=be(s=h._hints).call(s,qt.SCREEN_TRACK)?It.Screen:It.High;break;case ne.LocalVideoLowTrack:c=It.Low}return{stream_type:c,ssrcs:p,mid:m}})}filterTobeUnSubscribedTracks(n,i){const s=[],c=this.remoteUserMap.get(n);if(!c)return s;if(i){const d=c.get(i);if(!d)return s;s.push([n,{kind:i,id:d}])}else Array.from(c.entries()).forEach(d=>{let[h,p]=d;s.push([n,{kind:h,id:p}])});return s}createUnsubscribeMessage(n){const i=[];return n.forEach(s=>{let[c,{kind:d}]=s;switch(d){case _e.VIDEO:return void(c._videoSSRC&&i.push({stream_type:_e.VIDEO,ssrcId:c._videoSSRC}));case _e.AUDIO:return void(c._audioSSRC&&i.push({stream_type:_e.AUDIO,ssrcId:c._audioSSRC}))}}),i}withdrawRemoteTracks(n){n.forEach(i=>{let[s,{kind:c}]=i;const d=this.remoteUserMap.get(s);d&&(d.delete(c),0===Array.from(d.entries()).length&&this.remoteUserMap.delete(s))})}updateBitrateLimit(n){var i=this;return x(function*(){const s=i.localTrackMap.get(ne.LocalVideoTrack),c=i.localTrackMap.get(ne.LocalVideoLowTrack);s&&(yield s.track.setBitrateLimit(n.uplink)),c&&n.low_stream_uplink&&(yield c.track.setBitrateLimit({max_bitrate:n.low_stream_uplink.bitrate,min_bitrate:n.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const i=this.recvConnection.peerConnectionState;return"connected"!==this.sendConnection.peerConnectionState&&"connected"!==i}return!0}tryToUnmuteAudio(n){var i=this;return x(function*(){for(let s=0;s<n.length;s++)if(n[s]instanceof ct){const c=i.filterTobeUnmutedTracks(n[s]);if(0===c.length)continue;const d=i.createUnmuteMessage(c);return void(yield St(i,Re.RequestUnmuteLocal,d))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=n=>this.getStats(n),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(n=>{let[,{ssrcs:i}]=n;return!!i}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=n=>{var i;return!(null===(i=this.recvConnection)||void 0===i||!i.getRemoteVideoIsReady(n))},this.statsUploader.requestUpload=(n,i)=>this.emit(Re.RequestUploadStats,n,i),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var n=this;return x(function*(){n.dtlsFailedCount+=1,yield ui(xg(n.dtlsFailedCount,_n)),n.emit(Re.RequestReconnect)})()}reconnectP2P(){return x(function*(){})()}canPublishLowStream(){return this.localTrackMap.has(ne.LocalVideoTrack)||this.pendingLocalTracks.some(n=>n instanceof We)}throwIfTrackTypeNotMatch(n){if(n.filter(i=>i instanceof We).length>1)throw new Q(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n.filter(i=>i instanceof ct).length>1&&(n.some(i=>i instanceof ct&&i._bypassWebAudio)||!Ut().webAudioMediaStreamDest))throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const i of n){if(i instanceof We&&this.pendingLocalTracks.some(s=>s instanceof We))throw new Q(M.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i instanceof ct&&this.pendingLocalTracks.some(s=>s instanceof ct)&&(!Ut().webAudioMediaStreamDest||i._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof ct&&s._bypassWebAudio)))throw new Q(M.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(n,i){const s=!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ut().supportDualStreamEncoding,c=yl(yl({},{width:160,height:120,framerate:15,bitrate:50}),i);let d;d=s?n._mediaStreamTrack.clone():Hd(n,c);const h=Ot(8,"track-low-"),p=new We(d,yl(yl({},s&&{scaleResolutionDownBy:UE(c,n)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return p.on(mh.TRANSCEIVER_UPDATED,m=>{n._updateRtpTransceiver(m,Id.LOW_STREAM)}),p._hints.push(qt.LOW_STREAM),n.addListener(me.NEED_CLOSE,()=>{p.close()}),p}globalLock(){var n=this;return x(function*(){return n.recvMutex.lock("From P2PChannel2.globalLock")})()}reportVideoFirstFrameDecoded(n,i,s,c){var d;const h=Array.from(Eo(d=this.remoteUserMap).call(d)).find(p=>p._videoSSRC===n);if(h){c||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const p=this.store.keyMetrics,m=p.subscribe.find(_=>_.userId===h.uid&&"video"===_.type);ye.firstRemoteVideoDecode(this.store.sessionId,Yn.FIRST_VIDEO_DECODE,Kt.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:i,videoheight:s,subscribeElapse:gi.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId,apEnd:p.requestAPEnd||0,apStart:p.requestAPStart||0,joinGwEnd:p.joinGatewayEnd||0,joinGwStart:p.joinGatewayStart||0,pcEnd:p.peerConnectionEnd||0,pcStart:p.peerConnectionStart||0,subscriberEnd:m?.subscribeEnd||0,subscriberStart:m?.subscribeStart||0,videoAddNotify:m?.streamAdded||0,state:c?1:0})}}remoteMediaSsrcChanged(n,i,s){var c=this;return x(function*(){if(!c.recvConnection)return!1;const d=c.remoteUserMap.get(n);if(!d)return!1;const h=d.get(i);if(!h)return!1;const p=yield c.recvConnection.getRemoteSSRC(h);return void 0!==p&&p!==s})()}resetConnection(n){I.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(n)),this.state===et.Connected?(I.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}publishDataChannel(n){return x(function*(){throw new Q(M.NOT_SUPPORTED)})()}unpublishDataChannel(n){return x(function*(){throw new Q(M.NOT_SUPPORTED)})()}subscribeDataChannel(n,i){return x(function*(){throw new Q(M.NOT_SUPPORTED)})()}unsubscribeDataChannel(n,i){return x(function*(){throw new Q(M.NOT_SUPPORTED)})()}hasPendingRemoteDataChannel(n,i){throw new Q(M.NOT_SUPPORTED)}setPendingRemoteDataChannel(n,i){throw new Q(M.NOT_SUPPORTED)}preConnect(n,i,s,c,d,h){return x(function*(){throw new Q(M.NOT_SUPPORTED)})()}getEstablishParams(){throw new Q(M.NOT_SUPPORTED)}reSubscribe(n){return x(function*(){throw new Q(M.NOT_SUPPORTED)})()}updateVideoStreamParameter(n,i){return x(function*(){throw new Q(M.NOT_SUPPORTED)})()}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(n=>{let[i,{track:s}]=n;i===ne.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Id.LOW_STREAM):s._updateRtpTransceiver(void 0)})}}function ns(o){return function(n,i,s){const c=n[i];if("function"!=typeof c)throw new Error("Cannot use mutex on object property.");return s.value=x(function*(){for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];switch(o){case ts.SEND_ONLY:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(i));try{return yield c.apply(this,h)}finally{m()}}case ts.RECEIVE_ONLY:{const m=yield this.recvMutex.lock("From P2PChannel2.".concat(i));try{return yield c.apply(this,h)}finally{m()}}default:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(i)),_=yield this.recvMutex.lock("From P2PChannel2.".concat(i));try{return yield c.apply(this,h)}finally{m(),_()}}}}),s}}function mT(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Px(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?mT(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):mT(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}te([ns(),P("design:type",Function),P("design:paramtypes",[Object,String]),P("design:returntype",z)],hn.prototype,"startP2P",null),te([ns(),P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],hn.prototype,"p2pConnect",null),te([ns(ts.SEND_ONLY),P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],hn.prototype,"dopublish",null),te([ns(ts.SEND_ONLY),P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],hn.prototype,"unpublish",null),te([ns(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",z)],hn.prototype,"unpublishLowStream",null),te([ns(ts.SEND_ONLY),P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],hn.prototype,"doUnpublish",null),te([ns(ts.RECEIVE_ONLY),P("design:type",Function),P("design:paramtypes",[vi,String,String,Number]),P("design:returntype",z)],hn.prototype,"subscribe",null),te([ns(ts.RECEIVE_ONLY),P("design:type",Function),P("design:paramtypes",[vi,String,String,Boolean]),P("design:returntype",z)],hn.prototype,"unsubscribe",null),te([ns(ts.RECEIVE_ONLY),P("design:type",Function),P("design:paramtypes",[vi,String]),P("design:returntype",z)],hn.prototype,"muteRemote",null),te([ns(ts.RECEIVE_ONLY),P("design:type",Function),P("design:paramtypes",[vi,String]),P("design:returntype",z)],hn.prototype,"unmuteRemote",null),te([ns(ts.RECEIVE_ONLY),P("design:type",Function),P("design:paramtypes",[vi,String]),P("design:returntype",z)],hn.prototype,"hasRemoteMediaWithLock",null),te([ns(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",z)],hn.prototype,"disconnectForReconnect",null),te([ns(ts.RECEIVE_ONLY),P("design:type",Function),P("design:paramtypes",[vi,String,Number]),P("design:returntype",z)],hn.prototype,"remoteMediaSsrcChanged",null);const mV=Date.now(),_T=new Map,gT=new Map;function sy(o){return ay.apply(this,arguments)}function ay(){return ay=x(function*(o){const n=_T.get(o),i=Array.isArray(n)&&n[n.length-1],s=gT.get(o);if(!i)return void(s.isSyncing=!1);const c={uid:i.uid,payload:Pg(i.payload)};0===s.firstRecvTs&&(s.firstRecvTs=i.recvTs,s.firstSendTs=i.sendTs);const d=i.sendTs-s.firstSendTs,h=d-(Date.now()-s.firstRecvTs);h>0&&(s.firstRecvTs=Date.now()-d);let p=i.mediaDelay+h;p<=0?(n.pop(),Mx(i.context,c),p=0):p=Math.min(p,20),setTimeout(()=>n.length&&sy(o),p)}),ay.apply(this,arguments)}function Mx(o,n){o.safeEmit(qe.STREAM_MESSAGE,n.uid,n.payload),o.onStreamMessage&&o.onStreamMessage(n)}function ET(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Cm(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?ET(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):ET(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}li.setLogger(I);class Lt extends kt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var n;return(null===(n=this._config)||void 0===n?void 0:n.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(n){var i;let s;if(super(),i=this,C(this,"store",void 0),C(this,"_uid",void 0),C(this,"_channelName",void 0),C(this,"_uintUid",void 0),C(this,"_users",[]),C(this,"_config",void 0),C(this,"_clientId",void 0),C(this,"_appId",void 0),C(this,"_sessionId",null),C(this,"_key",void 0),C(this,"_joinInfo",void 0),C(this,"_gateway",void 0),C(this,"_statsCollector",void 0),C(this,"_configDistribute",void 0),C(this,"_leaveMutex",new li("client-leave")),C(this,"_publishMutex",new li("client-publish")),C(this,"_renewTokenMutex",new li("client-renewtoken")),C(this,"_subscribeMutex",new li("client-subscribe")),C(this,"_encryptionMode","none"),C(this,"_encryptionSecret",null),C(this,"_encryptionSalt",null),C(this,"_proxyServer",void 0),C(this,"_turnServer",{servers:[],mode:"auto"}),C(this,"_cloudProxyServerMode","disabled"),C(this,"_isDualStreamEnabled",!1),C(this,"_defaultStreamFallbackType",void 0),C(this,"_lowStreamParameter",void 0),C(this,"_streamFallbackTypeCacheMap",new Map),C(this,"_remoteStreamTypeCacheMap",new Map),C(this,"_axiosCancelSource",or.CancelToken.source()),C(this,"_audioVolumeIndicationInterval",void 0),C(this,"_networkQualityInterval",void 0),C(this,"_userOfflineTimeout",void 0),C(this,"_streamRemovedTimeout",void 0),C(this,"_injectStreamingClient",void 0),C(this,"_liveTranscodeStreamingClient",void 0),C(this,"_liveRawStreamingClient",void 0),C(this,"_channelMediaRelayClient",void 0),C(this,"_networkQualitySensitivity","normal"),C(this,"_p2pChannel",void 0),C(this,"_useLocalAccessPoint",!1),C(this,"_setLocalAPVersion",void 0),C(this,"_joinAndNotLeaveYet",!1),C(this,"_numberOfJoinCount",0),C(this,"_remoteDefaultVideoStreamType",void 0),C(this,"_inspect",void 0),C(this,"_moderation",void 0),C(this,"_license",void 0),C(this,"_pendingPublishedUsers",[]),C(this,"ntpAlignErrorCount",0),C(this,"remoteInboundOffset",0),C(this,"_handleLocalTrackEnable",(c,d,h)=>{this.publish(c,!1).then(d).catch(h)}),C(this,"_handleLocalTrackDisable",(c,d,h)=>{this.unpublish(c).then(d).catch(h)}),C(this,"_handleUserOnline",c=>{if(B("BLOCK_LOCAL_CLIENT")&&yd(c.uid,this.channelName))return void I.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof c.uid&&I.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find(h=>h.uid===c.uid);if(d)d._trust_in_room_=!0;else{const h=new vi(c.uid,c.uint_id||c.uid);this._users.push(h),I.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(qe.USER_JOINED,h)}}),C(this,"_handleUserOffline",c=>{if(B("BLOCK_LOCAL_CLIENT")&&yd(c.uid,this.channelName))return;const d=this._users.find(h=>h.uid===c.uid);d&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),Ng(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),I.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(qe.USER_LEAVED,d,c.reason))}),C(this,"_handleAddAudioOrVideoStream",(c,d,h,p,m,_,E)=>{if(B("BLOCK_LOCAL_CLIENT")&&yd(d,this.channelName))return;const y=this._users.find(T=>T.uid===d);if(!y)return void I.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));I.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(y.uid,c,void 0,void 0,void 0,Date.now());const S="audio"===c?y.hasAudio:y.hasVideo;y._uintid||(y._uintid=m||d),"audio"===c?y._trust_audio_stream_added_state_=!0:y._trust_video_stream_added_state_=!0,"audio"===c?(y._audio_added_=!0,void 0!==h&&(y._audioSSRC=h),void 0!==p&&(y._cname=p),_&&(y._audioOrtc=_)):(y._video_added_=!0,void 0!==h&&(y._videoSSRC=h),void 0!==p&&(y._cname=p),void 0!==E&&(y._rtxSsrcId=E),_&&(y._videoOrtc=_)),("audio"===c?y.hasAudio:y.hasVideo)&&!S&&(I.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published ").concat(c)),this.safeEmit(qe.USER_PUBLISHED,y,c)),"video"===c?ye.onGatewayStream(this._sessionId,Yn.ON_ADD_VIDEO_STREAM,Kt.ON_ADD_VIDEO_STREAM,{peer:m||d,ssrc:y._videoSSRC}):ye.onGatewayStream(this._sessionId,Yn.ON_ADD_AUDIO_STREAM,Kt.ON_ADD_AUDIO_STREAM,{peer:m||d,ssrc:y._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(y,c,h).then(T=>{if(T&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(y.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Ci))return this._p2pChannel.unsubscribe(y,c,!0).then(()=>this._subscribe(y,c,!0).catch(O=>{I.error("[".concat(this._clientId,"] resubscribe error"),O.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(y,c)&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(y.uid," after reconnect.")),this._subscribe(y,c,!0).catch(T=>{I.error("[".concat(this._clientId,"] resubscribe error"),T.toString())}))}),C(this,"_handleRemoveStream",(c,d,h)=>{if(B("BLOCK_LOCAL_CLIENT")&&yd(c.uid,this.channelName))return;const p=this._users.find(_=>_.uid===c.uid);if(!p)return void I.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));I.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let m=()=>{};if(p.hasAudio&&p.hasVideo?m=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished audio track")),this.safeEmit(qe.USER_UNPUBLISHED,p,"audio"),I.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished video track")),this.safeEmit(qe.USER_UNPUBLISHED,p,"video")}:p.hasVideo?m=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished video track")),this.safeEmit(qe.USER_UNPUBLISHED,p,"video")}:p.hasAudio&&(m=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished audio track")),this.safeEmit(qe.USER_UNPUBLISHED,p,"audio")}),p._trust_audio_stream_added_state_=!0,p._trust_video_stream_added_state_=!0,p._audio_added_=!1,p._video_added_=!1,this._p2pChannel instanceof Ci)this._p2pChannel.unsubscribe(p).then(_=>{if(_)return this._gateway.unsubscribe(_,p.uid)});else if(d&&h)if(c.sdp){const{sdp:_}=c;this._p2pChannel.unsubscribe(p,_).then(E=>{E&&d(E)}).catch(h)}else d&&d();p._audioSSRC=void 0,p._videoSSRC=void 0,p._audioOrtc=void 0,p._videoOrtc=void 0,p._rtxSsrcId=void 0,ye.onGatewayStream(this._sessionId,Yn.ON_REMOVE_STREAM,Kt.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),m()}),C(this,"_handleSetStreamLocalEnable",(c,d,h)=>{if(B("BLOCK_LOCAL_CLIENT")&&yd(d,this.channelName))return;const p=this._users.find(E=>E.uid===d);if(!p)return void I.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));I.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const m="audio"===c?p.hasAudio:p.hasVideo;if("audio"===c){p._trust_audio_enabled_state_=!0;const E=p._audio_enabled_;if(p._audio_enabled_=h,p._audio_enabled_===E)return;{const y=p._audio_enabled_?"enable-local-audio":"disable-local-audio";I.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(y)),this.safeEmit(qe.USER_INFO_UPDATED,d,y)}}else{p._trust_video_enabled_state_=!0;const E=p._video_enabled_;if(p._video_enabled_=h,p._video_enabled_===E)return;{const y=p._video_enabled_?"enable-local-video":"disable-local-video";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(y)),this.safeEmit(qe.USER_INFO_UPDATED,d,y)}}const _="audio"===c?p.hasAudio:p.hasVideo;return m!==_?!m&&_?(I.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(c)),void this.safeEmit(qe.USER_PUBLISHED,p,c)):("video"===c&&p._videoTrack&&p._videoTrack._destroy(),this._p2pChannel.muteRemote(p,c),I.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(c)),void this.safeEmit(qe.USER_UNPUBLISHED,p,c)):void 0}),C(this,"_handleMuteStream",(c,d,h,p,m,_)=>{if(B("BLOCK_LOCAL_CLIENT")&&yd(c,this.channelName))return;I.debug("[".concat(this._clientId,"] receive mute message"),c,d,h);const E=this._users.find(T=>T.uid===c);if(!E)return void I.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const y="audio"===d?E.hasAudio:E.hasVideo;if("audio"===d){E._trust_audio_mute_state_=!0;const T=E._audio_muted_;if(E._audio_muted_=h,E._audio_muted_===T)return;{const O=E._audio_muted_?"mute-audio":"unmute-audio";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(O)),this.safeEmit(qe.USER_INFO_UPDATED,c,O)}}else{E._trust_video_mute_state_=!0;const T=E._video_muted_;if(E._video_muted_=h,E._video_muted_===T)return;{const O=E._video_muted_?"mute-video":"unmute-video";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(O)),this.safeEmit(qe.USER_INFO_UPDATED,c,O)}}const S="audio"===d?E.hasAudio:E.hasVideo;if(y!==S){if(!y&&S)return this.store.useP2P||("audio"===d?E._audioSSRC:E._videoSSRC)?(I.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(d)),void this.safeEmit(qe.USER_PUBLISHED,E,d)):void I.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));"video"===d&&E._videoTrack&&E._videoTrack._destroy(),m&&_&&this._p2pChannel instanceof hn&&(p?this._p2pChannel.unsubscribe(E,p,d).then(T=>{m(T)}).catch(_):m()),this._p2pChannel.muteRemote(E,d),I.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(d)),this.safeEmit(qe.USER_UNPUBLISHED,E,d)}}),C(this,"_handleP2PLost",function(){var c=x(function*(d){I.debug("[".concat(i._clientId,"] receive p2p lost"),d),parseInt(d.p2pid,10)===i.store.p2pId?yield i._p2pChannel.requestReconnect():I.warning("[".concat(i._clientId,"] P2PLost stream not found"),d)});return function(d){return c.apply(this,arguments)}}()),C(this,"_handleTokenWillExpire",()=>{I.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(qe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),C(this,"_handleBeforeUnload",c=>{"beforeunload"===c.type&&void 0!==c.returnValue&&""!==c.returnValue||(this.leave(),I.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),C(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(qe.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(qe.NETWORK_QUALITY,c)}),C(this,"_handleP2PAddAudioOrVideoStream",(c,d)=>{const h=this._users.find(m=>m.uid===d);if(!h)return void I.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));I.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(h.uid,c,void 0,void 0,void 0,Date.now());const p="audio"===c?h.hasAudio:h.hasVideo;"audio"===c?h._trust_audio_stream_added_state_=!0:h._trust_video_stream_added_state_=!0,"audio"===c?h._audio_added_=!0:h._video_added_=!0,("audio"===c?h.hasAudio:h.hasVideo)&&!p&&(I.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published ").concat(c)),this.safeEmit(qe.USER_PUBLISHED,h,c)),this._p2pChannel.hasPendingRemoteMedia(h,c)&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(h.uid," after reconnect.")),this._subscribe(h,c,!0).catch(m=>{I.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._config=n,this._clientId=Ot(5,"client-"),this.store=new A1(n.codec,n.audioCodec,n.mode,this._clientId),this.store.clientCreated(),n.proxyServer&&this.setProxyServer(n.proxyServer,!0),n.turnServer&&this.setTurnServer(n.turnServer,!0),I.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(vo," build: ").concat(mr,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),n.clientRoleOptions)try{qw(n.clientRoleOptions),s=Object.assign({},n.clientRoleOptions)}catch(c){I.warning("[".concat(this._clientId,"] ").concat(c.toString()))}this._statsCollector=new Ud(this.store),this._statsCollector.onStatsException=(c,d,h)=>{I.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(d,", uid: ").concat(h)),this.safeEmit(qe.EXCEPTION,{code:c,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(c,d,h,p)=>{const m=this._users.find(_=>_.uid===c);m&&ye.peerPublishStatus(this._sessionId,{subscribeElapse:p,audioPublishDuration:d,videoPublishDuration:h,peer:m._uintid})},this.store.useDataChannel=Ut().supportDataChannel&&B("SIGNAL_CHANNEL"),this.store.useP2P=B("P2P"),this._gateway=new ZL(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:n.websocketRetryConfig||_n,httpRetryConfig:n.httpRetryConfig||_n,forceWaitGatewayResponse:void 0===n.forceWaitGatewayResponse||n.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:n.role,clientRoleOptions:s}),this._configDistribute=new lO,this.store.useP2P?(this._p2pChannel=new hn(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new Ci(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}joinMeta(n,i,s,c,d){var h=arguments,p=this;return x(function*(){let m=!(h.length>5&&void 0!==h[5])||h[5],_=h.length>6&&void 0!==h[6]&&h[6];Nt("JOIN_GATEWAY_USE_443PORT_ONLY",m),Nt("JOIN_GATEWAY_USE_DUAL_DOMAIN",_);const E=p._gateway.signal.websocket;return E instanceof dh&&(E.use443PortOnly=m,E.tryDoubleDomain=_),(y=x(function*(S,T,O){Qc.get(S)||Qc.set(S,[]),rf.get(S)||rf.set(S,T),Hs.get(S)||Hs.set(S,0);const N=Qc.get(S),w=rf.get(S);if(!N||!w)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Hs.get(S)===w){const re=fs();N.push(re),yield re.promise}Hs.set(S,Hs.get(S)+1);for(var k=arguments.length,V=new Array(k>3?k-3:0),U=3;U<k;U++)V[U-3]=arguments[U];const Y=yield O(...V);return Hs.set(S,Hs.get(S)-1),Hs.get(S)===w-1&&N.length>0&&(N[0].resolve(),N.shift()),0===Hs.get(S)&&(Qc.set(S,[]),rf.set(S,0),Hs.set(S,0)),Y}),function(S,T,O){return y.apply(this,arguments)})("client.join",B("JOIN_MAX_CONCURRENCY"),p.join.bind(p),n,i,s,c,d);var y})()}join(n,i,s,c,d){var h=this;return x(function*(){const p=++h._numberOfJoinCount;h.store.joinStart(),c&&(h.store.uid=c);const m="HTTPS"===(Zg||Zg||(Zg=(window.location.protocol.split(":")[0]||"").toUpperCase(),Zg)),_=Xi()?window.isSecureContext:"Browser Not Support";(Xi()||m)&&window.isSecureContext||I.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");const E=iC();"DISCONNECTED"===h.connectionState&&(h.store.avoidJoinStart=Math.round(Date.now()),I.debug("[".concat(h._clientId,"] set avoidJoinStart to ").concat(h.store.avoidJoinStart)));const y=ye.reportApiInvoke(E,{name:Rn.JOIN,options:[n,i,s,c],states:{isHttps:m,isSecureContext:_},tag:Je.TRACER});ye.setAppId(n);try{if(!s&&null!==s)throw new W(M.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&bi(s,"token",1,2047),bi(n,"appid",1,2047),jA(i),c&&oh(c),d&&bi(d,"optionalInfo",1,2047)}catch(w){throw y.onError(w),w}if(I.info("[".concat(h._clientId,"] start join channel ").concat(i,", join number: ").concat(p)),h._leaveMutex.isLocked&&(I.debug("[".concat(h._clientId,"] join: waiting leave operation")),(yield h._leaveMutex.lock())(),I.debug("[".concat(h._clientId,"] join: continue"))),h._joinAndNotLeaveYet=!0,"DISCONNECTED"!==h.connectionState){const w=new W(M.INVALID_OPERATION,"[".concat(h._clientId,"] Client already in connecting/connected state"));throw y.onError(w),w}h._sessionId||(h._sessionId=E,h.store.sessionId=h._sessionId),h._gateway.state="CONNECTING";const S=Cm({clientId:h._clientId,appId:n,sid:h._sessionId,cname:i,uid:"string"!=typeof c?c:null,turnServer:h._turnServer,proxyServer:h._proxyServer,token:s||n,cloudProxyServer:h._cloudProxyServerMode,optionalInfo:d,license:h._license,useLocalAccessPoint:h._useLocalAccessPoint},void 0!==h._remoteDefaultVideoStreamType&&{defaultVideoStream:h._remoteDefaultVideoStreamType});if(h._useLocalAccessPoint&&(S.setLocalAPVersion=h._setLocalAPVersion),"string"==typeof c&&(S.stringUid=c,h._uintUid?(S.uid=h._uintUid,h._uintUid=void 0):S.uid=0),"none"!==h._encryptionMode&&h._encryptionSecret){if(S.aesmode=h._encryptionMode,S.aespassword=yield e1(h._encryptionSecret),!h._joinAndNotLeaveYet)throw new W(M.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));h._encryptionSalt&&(S.aessalt=h._encryptionSalt)}h._startSession(h._sessionId,{channel:i,appId:n});const T=h._sessionId;setTimeout(()=>{"CONNECTING"===h.connectionState&&T===h._sessionId&&ye.joinChannelTimeout(h._sessionId,5)},5e3);try{var O;let w;const k=S.cloudProxyServer;if(be(O=["proxy3","proxy4","proxy5"]).call(O,k)){const re=B("PROXY_SERVER_TYPE3");S.proxyServer=Array.isArray(re)?re[0]:re}if(ye.setProxyServer(S.proxyServer),I.setProxyServer(S.proxyServer),h.store.requestAPStart(),S.stringUid&&!S.uid){const re=yield ix(S.stringUid,S,h._axiosCancelSource.token,h._config.httpRetryConfig||_n,h.store);I.debug("[".concat(h._clientId,"] getUserAccount Success ").concat(S.stringUid," => ").concat(re)),S.uid=re,w=yield nx(S,h._axiosCancelSource.token,h._config.httpRetryConfig||_n,!0,h.store)}else w=yield nx(S,h._axiosCancelSource.token,h._config.httpRetryConfig||_n,!0,h.store);if(!h._joinAndNotLeaveYet)throw new W(M.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));h.store.requestAPEnd(),setTimeout(()=>{h._configDistribute.startGetConfigDistribute(S,h._axiosCancelSource.token),h._configDistribute.on(Rf.UPDATE_BITRATE_LIMIT,re=>{h._p2pChannel.updateBitrateLimit(re)})},0),h._key=s||n;const V=w.gatewayInfo;h._joinInfo=Cm(Cm({},S),{},{cid:V.cid,uid:S.uid?S.uid:V.uid,vid:V.vid,apResponse:V.res,uni_lbs_ip:V.uni_lbs_ip,gatewayAddrs:V.gatewayAddrs});const U=yield h._joinGateway();if(!h._joinAndNotLeaveYet)throw new W(M.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));y.onSuccess(U),h._appId=n,h._channelName=S.cname,h._uid=U,h.store.uid=U,setTimeout(()=>{h._networkQualityInterval&&window.clearInterval(h._networkQualityInterval),h._networkQualityInterval=window.setInterval(h._handleUpdateNetworkQuality,2e3),window.addEventListener(nr()?"beforeunload":"pagehide",h._handleBeforeUnload)},0);const Y=S.stringUid?"string uid: ".concat(S.stringUid,",uid: ").concat(S.uid):"uid: ".concat(h._uid);return I.info("[".concat(h._clientId,"] Joining channel success: channel: ").concat(i,",").concat(Y)),setTimeout(()=>{I.startUpload()},5e3),h.store.joinEnd(),N=h,be(Ed).call(Ed,N)||Ed.push(N),U}catch(w){const k=Array.isArray(w)?w[0]:w;throw k&&k.code===M.OPERATION_ABORTED?I.warning("[".concat(h._clientId,"] join number: ").concat(p,", Joining channel failed, rollback"),k):I.error("[".concat(h._clientId,"] join number: ").concat(p,", Joining channel failed, rollback"),k),k.code!==M.OPERATION_ABORTED&&h._numberOfJoinCount===p&&(h._gateway.state="DISCONNECTED",h._reset()),y.onError(k),k}var N})()}_joinGateway(){if(!this._joinInfo||!this._key)throw new W(M.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!B("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(n=>n).catch(n=>{if(n.code===M.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,Ke.FALLBACK),n;if(n.code===M.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,Ke.FALLBACK),n;throw n}).then(n=>{if(n instanceof W){if(n.code===M.INIT_WEBSOCKET_TIMEOUT){if(I.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new W(M.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const i=B("PROXY_SERVER_TYPE3");if(Array.isArray(i))if(this._joinInfo.apUrl){const c=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),d=c.slice(c.length-2).join(".");i.forEach(h=>{this._joinInfo&&be(h).call(h,d)&&(this._joinInfo.proxyServer=h)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=i[0])}else this._joinInfo.proxyServer=i[0];else this._joinInfo.proxyServer=i;const s=B("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return s&&s[1]&&"443"!==s[1]&&I.setProxyServer(this._joinInfo.proxyServer),"443"!==B("STATS_COLLECTOR_PORT").toString()&&ye.setProxyServer(this._joinInfo.proxyServer),ye.reportApiInvoke(this._sessionId,{name:Rn.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:Je.TRACER}).onSuccess(),this.safeEmit(qe.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),B("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(c=>{"forceturn"in c&&(c.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(I.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new W(M.INVALID_OPERATION);return ye.reportApiInvoke(this._sessionId,{name:Rn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Je.TRACER}).onSuccess(),this._joinGateway()}return n}).then(n=>n)}leave(){var n=this;return x(function*(){I.info("[".concat(n._clientId,"] Leaving channel")),window.removeEventListener(nr()?"beforeunload":"pagehide",n._handleBeforeUnload),n._reset(),function(s){const c=Ed.indexOf(s);-1!==c&&Ed.splice(c,1)}(n);const i=yield n._leaveMutex.lock();if("DISCONNECTED"===n.connectionState)return I.info("[".concat(n._clientId,"] Leaving channel repeated, success")),void i();yield n._gateway.leave("CONNECTED"!==n.connectionState),I.info("[".concat(n._clientId,"] Leaving channel success")),n._joinAndNotLeaveYet=!1,n.store.resetJoinChannelServiceRecords(),i()})()}publish(n){var i=arguments,s=this;return x(function*(){let c=!(i.length>1&&void 0!==i[1])||i[1];if(!Array.isArray(n)){if(!(n instanceof wi))return s._publishDataChannel(n);n=[n]}if(0===n.length)throw new W(M.INVALID_PARAMS,"param list is empty");const d=n;if("audience"===s._gateway.role)throw new W(M.INVALID_OPERATION,"audience can not publish stream");for(const p of d){if(!(p instanceof wi))throw new W(M.INVALID_PARAMS,"parameter is not local track");if(!p._enabled&&c)throw new W(M.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(p.getTrackId()))}I.info("[".concat(s._clientId,"] Publishing tracks, id ").concat(d.map(p=>"".concat(p.getTrackId()," "))));const h=yield s._publishMutex.lock();yield s._configDistribute.awaitConfigDistributeComplete(),c&&d.forEach(p=>{const m=s._configDistribute.getBitrateLimit();p instanceof We&&m&&p.setBitrateLimit(m.uplink)});try{yield s._publishHighStream(d),I.info("[".concat(s._clientId,"] Publish success, id ").concat(d.map(p=>"".concat(p.getTrackId()," "))))}catch(p){throw I.error("[".concat(s._clientId,"] publish error"),p.toString()),p}finally{h()}})()}_publishDataChannel(n){var i=this;return x(function*(){At(n.id,"id",0,65535,!0),Zc(n.ordered,"ordered"),bi(n.metadata,"metadata",0,512),I.info("[".concat(i._clientId,"] Publishing datachannels, id ").concat(n.id));const s=yield i._publishMutex.lock();try{if(-1!==i._p2pChannel.getAllDataChannels().findIndex(d=>d.id===n.id))throw new W(M.INVALID_PARAMS,"Invalid id: ".concat(n.id,". If you want to republish the datachannel, unpublish first"));if(!i._joinInfo||void 0===i._uid)throw new W(M.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==i.connectionState&&"RECONNECTING"!==i.connectionState)throw new W(M.INVALID_OPERATION,"can not publish datachannel in ".concat(i.connectionState," state"));if("auto"===i._turnServer.mode&&B("FORCE_TURN")&&!B("TURN_ENABLE_TCP")&&!B("TURN_ENABLE_UDP"))throw new W(M.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const c=new Rb(n);yield i._p2pChannel.publishDataChannel([c]);try{const d={streamId:n.id,ordered:n.ordered,maxRetransmits:B("DATASTREAM_MAX_RETRANSMITS"),metadata:n.metadata,channelId:c._originDataChannelId};yield i._gateway.publishDataChannel(i._uid,d,!0)}catch(d){if(d.code!==M.DISCONNECT_P2P)throw d}return yield c._waitTillOpen(),I.info("[".concat(i._clientId,"] Publish dataChannels success, id ").concat(c.id)),c}catch(c){throw I.error("[".concat(i._clientId,"] publish datachannels error"),c.toString()),c}finally{s()}})()}unpublish(n){var i=this;return x(function*(){if(!i._joinInfo||void 0===i._uid)throw new W(M.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let s=[];if(n)if(Array.isArray(n))s=n;else{if(!(n instanceof wi))return i._unpublishDataChannel([n]);s=[n]}else i.store.useP2P||(yield i._unpublishDataChannel()),s=i._p2pChannel.getAllTracks(!0);I.info("[".concat(i._clientId,"] Unpublish tracks, tracks ").concat(s.map(d=>"".concat(d.getTrackId()," "))," "));const c=yield i._publishMutex.lock();try{if(i._p2pChannel instanceof hn){const d=yield i._p2pChannel.unpublish(s);if(d){const h=yield i._gateway.sendExtensionMessage(Mt.UNPUBLISH,d);h&&(yield i._p2pChannel.setDescription("local",h))}}else{const d=yield i._p2pChannel.unpublish(s);d&&(yield i._gateway.unpublish(d,i._uid)),I.info("[".concat(i._clientId,"] Unpublish success,tracks ").concat(s.map(h=>"".concat(h.getTrackId()))))}}catch(d){throw I.error("[".concat(i._clientId,"] unpublish error"),d.toString()),d}finally{c&&c()}})()}_unpublishDataChannel(n){var i=this;return x(function*(){void 0!==n&&0!==n.length||(n=i._p2pChannel.getAllDataChannels()),I.info("[".concat(i._clientId,"] Unpublish datachannels, datachannels ").concat(n.map(c=>"".concat(c.id," "))," "));const s=yield i._publishMutex.lock();try{const c=yield i._p2pChannel.unpublishDataChannel(n);c&&(yield i._gateway.unpublishDataChannel(c)),I.info("[".concat(i._clientId,"] Unpublish dataChannel success,dataChannel ").concat(n.map(d=>"".concat(d.id))))}catch(c){throw I.error("[".concat(i._clientId,"] unpublish dataChannel error"),c.toString()),c}finally{s&&s()}})()}subscribe(n,i,s){var c=this;return x(function*(){return"datachannel"===i?c._subscribeDataChannel(n,s):c._subscribe(n,i)})()}_subscribeDataChannel(n,i){var s=this;return x(function*(){var c;if(At(i,"channelId",0,65535,!0),!s._joinInfo)throw new W(M.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==s.connectionState&&"RECONNECTING"!==s.connectionState)throw new W(M.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(s.connectionState," state"));if(!s._users.find(m=>m===n))throw I.error("[".concat(s._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),new W(M.INVALID_REMOTE_USER,"user is not in the channel");if(!n.hasAudio&&!n.hasVideo&&0===n._dataChannels.length)throw I.error("[".concat(s._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),new W(M.INVALID_REMOTE_USER,"user is not published");const d=null===(c=n._dataChannels)||void 0===c?void 0:c.find(m=>m.id===i);if(!d)throw I.error("[".concat(s._clientId,"] can not subscribe ").concat(n.uid," with mediaType datachannel, remote datachannel is not published")),new W(M.REMOTE_USER_IS_NOT_PUBLISHED);const h=yield s._subscribeMutex.lock();I.info("[".concat(s._clientId,"] subscribe user ").concat(n.uid,", mediaType: datachannel"));try{const m=yield s._p2pChannel.subscribeDataChannel(n,[d]);if(m&&be(m).call(m,d.id))try{var p;if(!d._originDataChannelId)throw I.error("[".concat(s._clientId,"] can not subscribe ").concat(n.uid," with mediaType datachannel, cannot get RTCDatachannel")),new W(M.REMOTE_USER_IS_NOT_PUBLISHED);const _={id:d.id,datachannelId:d._originDataChannelId,ordered:d.ordered,maxRetransmits:d.maxRetransmits,metadata:null!==(p=d.metadata)&&void 0!==p?p:""};yield s._gateway.subscribeDataChannel(n.uid,_,!0)}catch(_){if(_?.code!==M.WS_ABORT)throw yield s._p2pChannel.unsubscribeDataChannel(n,[d]),_;yield s._p2pChannel.unsubscribeDataChannel(n,[d]),s._p2pChannel.setPendingRemoteDataChannel(n,d.id)}return yield d._waitTillOpen(),I.info("[".concat(s._clientId,"] subscribe success user ").concat(n.uid,", mediaType: datachannel")),d}finally{h()}})()}_p2pSubscribe(n,i,s){var c=this;return x(function*(){if(Vn(i,"mediaType",["audio","video"]),!c._joinInfo)throw new W(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==c.connectionState&&"RECONNECTING"!==c.connectionState)throw new W(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(c.connectionState," state"));if(!c._users.find(p=>p===n)){const p=new W(M.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),p}if(!n.hasAudio&&!n.hasVideo){const p=new W(M.INVALID_REMOTE_USER,"user is not published");throw I.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),p}if(!s&&("audio"===i&&!n.hasAudio||"video"===i&&!n.hasVideo)){const p=new W(M.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid," with mediaType ").concat(i,", remote track is not published")),p}const d=yield c._subscribeMutex.lock();I.info("[".concat(c._clientId,"] subscribe user ").concat(n.uid,", mediaType: ").concat(i));const h="audio"===i?ne.LocalAudioTrack:c._joinInfo.defaultVideoStream===jC.LOW_STREAM?ne.LocalVideoLowTrack:ne.LocalVideoTrack;try{(yield c._p2pChannel.hasRemoteMediaWithLock(n,i))?yield c._p2pChannel.unmuteRemote(n,i):(c.store.subscribe(n.uid,i,Date.now()),c._p2pChannel instanceof hn&&(yield c._gateway.sendExtensionMessage(Mt.SUBSCRIBE,{trackType:h}))),I.info("[".concat(c._clientId,"] subscribe success user ").concat(n.uid,", mediaType: ").concat(i)),c._defaultStreamFallbackType&&c.setStreamFallbackOption(n.uid,c._defaultStreamFallbackType).catch(m=>{I.warning("[".concat(c._clientId,"] auto set fallback failed"),m)});const p="audio"===i?n._audioTrack:n._videoTrack;if(!p)throw new W(M.UNEXPECTED_ERROR,"can not find remote track in user object");return p}catch(p){throw I.error("[".concat(c._clientId,"] subscribe user ").concat(n.uid," error"),p),p}finally{d()}})()}_subscribe(n,i,s){var c=this;return x(function*(){if(c._p2pChannel instanceof hn)return c._p2pSubscribe(n,i);if(Vn(i,"mediaType",["audio","video"]),!c._joinInfo)throw new W(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==c.connectionState&&"RECONNECTING"!==c.connectionState)throw new W(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(c.connectionState," state"));if(!c._users.find(E=>E===n)){const E=new W(M.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),E}if(!n.hasAudio&&!n.hasVideo){const E=new W(M.INVALID_REMOTE_USER,"user is not published");throw I.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),E}if(!(s||("audio"!==i||n.hasAudio&&void 0!==n._audioSSRC)&&("video"!==i||n.hasVideo&&void 0!==n._videoSSRC))){const E=new W(M.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid," with mediaType ").concat(i,", remote track is not published")),E}let d="audio"===i?n._audioSSRC:n._videoSSRC,h="audio"===i?n._audioOrtc:n._videoOrtc,p="video"===i?n._rtxSsrcId:void 0,m={stream_type:"audio"===i?_e.AUDIO:_e.VIDEO,ssrcId:d};const _=yield c._subscribeMutex.lock();I.info("[".concat(c._clientId,"] subscribe user ").concat(n.uid,", mediaType: ").concat(i));try{if(yield c._p2pChannel.hasRemoteMediaWithLock(n,i))yield c._p2pChannel.unmuteRemote(n,i);else try{const y="audio"===i?n._audioSSRC:n._videoSSRC;void 0!==y&&y!==d&&(d=y,h="audio"===i?n._audioOrtc:n._videoOrtc,p="video"===i?n._rtxSsrcId:void 0,m={stream_type:"audio"===i?_e.AUDIO:_e.VIDEO,ssrcId:d}),gi.markSubscribeStart(c.store.clientId,d),c.store.subscribe(n.uid,i,Date.now()),yield c._p2pChannel.subscribe(n,i,d,p,h);try{yield c._gateway.subscribe(n.uid,m,!0)}catch(S){if(S?.code!==M.WS_ABORT)throw yield c._p2pChannel.unsubscribe(n,i),S;yield c._p2pChannel.unsubscribe(n,i,!0),c._p2pChannel.setPendingRemoteMedia(n,i)}c.store.subscribe(n.uid,i,void 0,Date.now()),c._p2pChannel.reportSubscribeEvent(!0,null,n,i)}catch(y){throw c._p2pChannel.reportSubscribeEvent(!1,y?.code,n,i),y}I.info("[".concat(c._clientId,"] subscribe success user ").concat(n.uid,", mediaType: ").concat(i)),c._defaultStreamFallbackType&&c.setStreamFallbackOption(n.uid,c._defaultStreamFallbackType).catch(y=>{I.warning("[".concat(c._clientId,"] auto set fallback failed"),y)});const E="audio"===i?n._audioTrack:n._videoTrack;if(!E)throw new W(M.UNEXPECTED_ERROR,"can not find remote track in user object");return E}catch(E){throw I.error("[".concat(c._clientId,"] subscribe user ").concat(n.uid," error"),E),E}finally{_()}})()}massSubscribe(n){var i=this;return x(function*(){if(mc(n,"subscribeList"),!i._joinInfo)throw new W(M.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==i.connectionState&&"RECONNECTING"!==i.connectionState)throw new W(M.INVALID_OPERATION,"Can't subscribe stream in ".concat(i.connectionState," state"));const s=Date.now(),c=new Map,d=yield i._subscribeMutex.lock();I.info("[".concat(i._clientId,"]start massSubscribe user ").concat(n.map(_=>{let{user:E,mediaType:y}=_;return"user: ".concat(E?.uid,", mediaType: ").concat(y)}).join("; ")));const h=(n=[...n]).map(_=>{let{user:E,mediaType:y}=_;return{user:E,mediaType:y}}),p=yield i._p2pChannel.globalLock();try{var m;for(let E=n.length-1;E>=0;E--){const y=n[E],{user:S,mediaType:T}=y;if(Vn(T,"mediaType",["audio","video"]),!S){const w=new W(M.INVALID_PARAMS,"user property does not exist in subscribeList item");throw I.error("[".concat(i._clientId,"] user property does not exist in subscribeList item")),w}if(!i._users.find(w=>w===S)){const w=new W(M.INVALID_REMOTE_USER,"user is not in the channel");I.error("[".concat(i._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),h[E].error=w,n.splice(E,1);continue}if("audio"===T&&(!S.hasAudio||void 0===S._audioSSRC)||"video"===T&&(!S.hasVideo||void 0===S._videoSSRC)){const w=new W(M.REMOTE_USER_IS_NOT_PUBLISHED);I.error("[".concat(i._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(T,", remote user is not published")),h[E].error=w,n.splice(E,1);continue}const O=Xn.Video|Xn.LwoVideo,N=c.get(S);if(N){if("video"===T?N&O:N&Xn.Audio){n.splice(E,1),I.warning("[".concat(i._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(T," twice"));continue}c.set(S,N|("video"===T?O:Xn.Audio))}else c.set(S,"video"===T?O:Xn.Audio)}for(let E=n.length-1;E>=0;E--){const y=n[E],{user:S,mediaType:T}=y,O=Xn.Video|Xn.LwoVideo;if(i._p2pChannel.hasRemoteMedia(S,T)){yield i._p2pChannel.unmuteRemoteNoLock(S,T);const N=c.get(S);c.set(S,"video"===T?N^O:N^Xn.Audio),n.splice(E,1)}}i.store.massSubscribe(n.map(E=>({userId:E.user.uid,type:E.mediaType})),s);const _=md(m=Array.from(c.entries())).call(m,(E,y)=>{let[S,T]=y;if(0===T)return E;const O={stream_id:S.uid,stream_type:T};return T&Xn.Audio&&(O.audio_ssrc=S._audioSSRC),T&Xn.Video&&(O.video_ssrc=S._videoSSRC),E.push(O),E},[]);try{n.length>0&&(yield i._p2pChannel.massSubscribeNoLock(n.map(y=>{let{user:S,mediaType:T}=y;return{user:S,mediaType:T,ssrcId:T===_e.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:T===_e.VIDEO?S._rtxSsrcId:void 0}})));const E=new Map;if(_.length>0&&((yield i._gateway.subscribeAll(_,!0))?.users||[]).forEach(S=>{let{stream_id:T,video_error_code:O,audio_error_code:N,error_code:w}=S;(O||N||w)&&E.set(T,{video_error_code:O,audio_error_code:N,error_code:w})}),Array.from(E.entries()).length>0){const y=Array.from(E.entries()).map(S=>{let T,[O,N]=S;return N.error_code||N.video_error_code&&N.audio_error_code?T=void 0:N.video_error_code?T=_e.VIDEO:N.audio_error_code&&(T=_e.AUDIO),{user:i.remoteUsers.find(w=>w.uid===O),mediaType:T}});yield i._p2pChannel.massUnsubscribeNoLock(y)}for(const y of h){const S=E.get(y.user.uid);if(S){const T=S.error_code||"audio"===y.mediaType&&S.audio_error_code||"video"===y.mediaType&&S.video_error_code;if(T){const O=Cd(T);I.error("user:".concat(y.user.uid," mediaType:").concat(y.mediaType," has massSubscribe error ").concat(O.desc)),y.error=new W(M.SUBSCRIBE_FAILED,"code ".concat(T,": ").concat(O.desc))}}y.error||(y.track="video"===y.mediaType?y.user.videoTrack:y.user.audioTrack)}return i.store.massSubscribe(h.filter(y=>!y.error).map(y=>({userId:y.user.uid,type:y.mediaType})),void 0,Date.now()),h.forEach(y=>{var S;ye.subscribe(i.store.sessionId,{succ:!!y.error,ec:(null===(S=y.error)||void 0===S?void 0:S.code)||null,video:y.mediaType===_e.VIDEO,audio:y.mediaType===_e.AUDIO,peerid:y.user.uid,subscribeRequestid:y.mediaType===_e.VIDEO?y.user._videoSSRC:y.user._audioSSRC,p2pid:i.store.p2pId,eventElapse:Math.floor(performance.now()-s)},!0)}),I.info("[".concat(i._clientId,"] massSubscribe success ").concat(n.map(y=>{let{user:S,mediaType:T}=y;return"user: ".concat(S?.uid,", mediaType: ").concat(T)}).join("; "))),h}catch(E){throw yield i._p2pChannel.massUnsubscribeNoLock(n),E}}finally{p(),d()}})()}unsubscribe(n,i,s){var c=this;return x(function*(){if(i||c.store.useP2P){if("datachannel"===i)return c._unsubscribeDataChannel(n,s)}else yield c._unsubscribeDataChannel(n,s);if(i&&Vn(i,"mediaType",["audio","video"]),!c._joinInfo)throw new W(M.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!c._users.find(h=>h===n)){const h=new W(M.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(c._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),h}I.info("[".concat(c._clientId,"] unsubscribe uid: ").concat(n.uid,", mediaType: ").concat(i));const d=yield c._subscribeMutex.lock();try{if(c._p2pChannel instanceof hn)yield c._gateway.sendExtensionMessage(Mt.UNSUBSCRIBE,{mediaType:i});else{const h=yield c._p2pChannel.unsubscribe(n,i);h&&(yield c._gateway.unsubscribe(h,n.uid)),I.info("[".concat(c._clientId,"] unsubscribe success uid: ").concat(n.uid,", mediaType: ").concat(i))}}catch(h){if(h.code===M.DISCONNECT_P2P)return void I.warning("disconnecting p2p, abort unsubscribe request.");throw I.error("[".concat(c._clientId,"] unsubscribe user ").concat(n.uid," error"),h.toString()),h}finally{d()}})()}_unsubscribeDataChannel(n,i){var s=this;return x(function*(){if(i&&At(i,"id",0,65535,!0),!s._joinInfo)throw new W(M.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!s._users.find(d=>d===n)){const d=new W(M.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(s._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),d}let c;if("number"==typeof i){const d=n._dataChannels.find(h=>h.id===i);d&&(c=[d])}else c=n._dataChannels;if(void 0===c){const d=new W(M.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(s._clientId,"] can not unsubscribe ").concat(n.uid," with channelId ").concat(i,", remote datachannel is not published")),d}I.info("[".concat(s._clientId,"] unsubscribe uid: ").concat(n.uid,", mediaType: datachannel, ids: ").concat(c.map(d=>d.id)));try{const d=yield s._p2pChannel.unsubscribeDataChannel(n,c);d&&(yield s._gateway.unsubscribeDataChannel(d,n.uid)),I.info("[".concat(s._clientId,"] unsubscribe datachannel success uid: ").concat(n.uid,", mediaType: datachannel, ids: ").concat(d))}catch(d){if(d.code===M.DISCONNECT_P2P)return void I.warning("disconnecting p2p, abort unsubscribe request.");throw I.error("[".concat(s._clientId,"] unsubscribe user ").concat(n.uid," error"),d.toString()),d}})()}massUnsubscribe(n){var i=this;return x(function*(){if(mc(n,"unsubscribeList"),!i._joinInfo)throw new W(M.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");I.info("[".concat(i._clientId,"] start massUnsubscribe ").concat(n.map(c=>{let{user:d,mediaType:h}=c;return"user: ".concat(d?.uid,", mediaType: ").concat(h,";")}).join())),n=[...n];const s=new Map;for(let c=n.length-1;c>=0;c--){const{user:d,mediaType:h}=n[c];if(!d){const m=new W(M.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw I.error("[".concat(i._clientId,"] user property does not exist in unsubscribeList item")),m}if(Vn(h,"mediaType",["video","audio",void 0]),!i._users.find(m=>m===d)){I.warning("[".concat(i._clientId,"] can not unsubscribe ").concat(d.uid,", user is not in the channel")),n.splice(c,1);continue}const p=Xn.Video|Xn.LwoVideo;if(s.has(d)){const m=s.get(d);let _;switch(h){case"video":_=m&p;break;case"audio":_=m&Xn.Audio;break;default:_=m&(Xn.Audio|p)}if(_){I.warning("[".concat(i._clientId,"] repeat massUnsubscribe user:").concat(d.uid,",mediaType:").concat(h," twice.")),n.splice(c,1);continue}h?"audio"===h?s.set(d,m|Xn.Audio):"video"===h&&s.set(d,m|p):s.set(d,m|Xn.Audio|p)}else h?"audio"===h?s.set(d,Xn.Audio):"video"===h&&s.set(d,p):s.set(d,Xn.Audio|p)}try{const c=yield i._p2pChannel.massUnsubscribe(n);c&&(yield i._gateway.massUnsubscribe(c)),I.info("[".concat(i._clientId,"] massUnsubscribe success ").concat(n.map(d=>{let{user:h,mediaType:p}=d;return"user: ".concat(h?.uid,", mediaType: ").concat(p,";")}).join()))}catch(c){if(c.code===M.DISCONNECT_P2P)return void I.warning("[".concat(i._clientId,"] disconnecting p2p, abort unsubscribe request."));throw I.error("[".concat(i._clientId,"] massUnsubscribe error"),c.toString()),c}})()}setLowStreamParameter(n){var i=this;return x(function*(){(function(c){if(!c)throw new Q(M.INVALID_PARAMS);Bt(c.width)||fc(c.width,"streamParameter.width"),Bt(c.height)||fc(c.height,"streamParameter.height"),Bt(c.framerate)||fc(c.framerate,"streamParameter.framerate"),Bt(c.bitrate)||At(c.bitrate,"streamParameter.bitrate")})(n),(!n.width&&n.height||n.width&&!n.height)&&I.warning("[".concat(i._clientId,"] The width and height parameters take effect only when both are set")),I.info("[".concat(i._clientId,"] set low stream parameter to"),JSON.stringify(n));const s=i._configDistribute.getLowStreamConfigDistribute();if(s&&s.bitrate&&n.bitrate&&s.bitrate<n.bitrate&&(n.bitrate=s.bitrate),i._lowStreamParameter=n,i._isDualStreamEnabled)return i._p2pChannel.updateVideoStreamParameter(n,ne.LocalVideoLowTrack)})()}enableDualStream(){var n=this;return x(function*(){if(!Ut().supportDualStream)throw ye.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new W(M.NOT_SUPPORTED,"Your browser is not support dual stream");if(n._isDualStreamEnabled)throw new W(M.INVALID_OPERATION,"Dual stream is already enabled");if(n._p2pChannel.canPublishLowStream())try{yield n._publishLowStream()}catch(i){throw ye.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),i}n._isDualStreamEnabled=!0,ye.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),I.info("[".concat(n._clientId,"] enable dual stream"))})()}disableDualStream(){var n=this;return x(function*(){if(n._isDualStreamEnabled){if(!n._joinInfo)throw new W(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(n._p2pChannel.getLocalMedia(ne.LocalVideoLowTrack))try{const i=yield n._p2pChannel.unpublishLowStream();i&&(yield n._gateway.unpublish(i,n._joinInfo.stringUid||n._joinInfo.uid))}catch(i){throw ye.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),i}n._isDualStreamEnabled=!1,ye.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),I.info("[".concat(n._clientId,"] disable dual stream"))}})()}setClientRole(n,i){var s=this;return x(function*(){if(Vn(n,"role",["audience","host"]),i&&qw(i),"rtc"===s.mode)throw I.warning("[".concat(s._clientId,"]rtc mode can not use setClientRole")),new W(M.INVALID_OPERATION,"rtc mode can not use setClientRole");if(i&&i.level&&"host"===n)throw new W(M.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===n&&s._p2pChannel.hasLocalMedia())throw new W(M.INVALID_OPERATION,"can not set client role to audience when publishing stream");yield s._gateway.setClientRole(n,i),s._config.role=n,I.info("[".concat(s._clientId,"] set client role to ").concat(n,", level: ").concat(i&&i.level))})()}getRemoteInboundOffset(){var n;const i=null===(n=this._p2pChannel.getStats())||void 0===n?void 0:n.audioSend[0];if(!i||!i.timestamp)return 0;const s=i.timestamp-Date.now();return Math.abs(s)>1e3+i.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(n,i){if(bi(n,"proxyServer"),!i){if("DISCONNECTED"!==this.connectionState)throw new W(M.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new W(M.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=n,ye.setProxyServer(this._proxyServer),I.setProxyServer(this._proxyServer),I.info("[".concat(this._clientId,"] Set proxy server ").concat(i?"by initialize call":""," success."))}setTurnServer(n,i){if(Array.isArray(n)||(n=[n]),!i){if("DISCONNECTED"!==this.connectionState)throw new W(M.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new W(M.INVALID_OPERATION,"You have already set the proxy")}if(hd(n))return this._turnServer={servers:n,mode:"original-manual"},void I.info("[".concat(this._clientId,"] Set original turnserver ").concat(i?"by initialize call":""," success: ").concat(n.map(s=>s.urls).join(","),"."));n.forEach(s=>Kw(s)),this._turnServer={servers:n,mode:"manual"},I.info("[".concat(this._clientId,"] Set turnserver ").concat(i?"by initialize call":""," success."))}setLicense(n){if("DISCONNECTED"!==this.connectionState)throw new W(M.INVALID_OPERATION,"you should set license before join channel");if(bi(n,"license",32,32),!/^[A-Za-z\d]+$/.test(n))throw new W(M.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=n,I.info("[".concat(this._clientId,"] set license success"),n)}startProxyServer(n){if("DISCONNECTED"!==this.connectionState)throw new W(M.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new W(M.INVALID_OPERATION,"You have already set the proxy");const i=[3,4,5];let s;switch(void 0===n&&(n=3),n){case 1:case 2:throw new W(M.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new W(M.INVALID_PARAMS,"proxy server mode must be ".concat(i.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,I.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new W(M.INVALID_OPERATION,"Stop proxy server after leave channel");ye.setProxyServer(),I.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",I.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(n){if(!n.accessPoints)throw new W(M.INVALID_PARAMS,"accessPoints is required.");mc(n.accessPoints.serverList,"accessPoints.serverList"),bi(n.accessPoints.domain,"accessPoints.domain");const i=(T,O)=>{At(T,O,0,65535,!0)};let s=443;if(n.accessPoints.port&&(i(n.accessPoints.port,"accessPoints.port"),s=n.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new W(M.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");B("CLOSE_AFB_FOR_LOCAL_AP")&&(Nt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Nt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const c=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,d=n.accessPoints.domain,h=n.accessPoints.serverList.map(T=>c.test(T)?"".concat(T.replace(/\./g,"-"),".").concat(d):T),p=h.map(T=>"".concat(T,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Nt("WEBCS_DOMAIN",p),Nt("WEBCS_DOMAIN_BACKUP_LIST",p),Nt("GATEWAY_DOMAINS",[d]),n.report&&n.report.hostname&&Array.isArray(n.report.hostname)&&n.report.hostname.length?(mc(n.report.hostname,"report.hostname"),Nt("EVENT_REPORT_DOMAIN",n.report.hostname[0]),Nt("EVENT_REPORT_BACKUP_DOMAIN",n.report.hostname[1]||n.report.hostname[0])):(Nt("EVENT_REPORT_DOMAIN",h[0]),Nt("EVENT_REPORT_BACKUP_DOMAIN",h[1]||h[0]));let m=6443;n.report&&n.report.port&&(i(n.report.port,"report.port"),m=n.report.port),Nt("STATS_COLLECTOR_PORT",m),Nt("ENABLE_EVENT_REPORT",!!n.report);let _="";n.log&&n.log.hostname&&Array.isArray(n.log.hostname)&&n.log.hostname.length?(mc(n.log.hostname,"log.hostname"),_=n.log.hostname[0]):_=h[0];let E=6444;n.log&&n.log.port&&(i(n.log.port,"log.port"),E=n.log.port),Nt("LOG_UPLOAD_SERVER","".concat(_,":").concat(E));let y=[];n.cds&&n.cds.hostname&&Array.isArray(n.cds.hostname)&&n.cds.hostname.length?(mc(n.cds.hostname,"cds.hostname"),y=n.cds.hostname):y=h;let S=443;n.cds&&n.cds.port&&(i(n.cds.port,"cds.port"),S=n.cds.port),Nt("CDS_AP",y.map(T=>"".concat(T,":").concat(S))),Nt("ENABLE_CONFIG_DISTRIBUTE",!!n.cds),I.info("set local access point v2 success")}setLocalAccessPoints(n,i){if(mc(n,"serverList"),bi(i,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new W(M.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;n=n.map(c=>s.test(c)?"".concat(c.replace(/\./g,"-"),".").concat(i):c),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Nt("WEBCS_DOMAIN",n),Nt("WEBCS_DOMAIN_BACKUP_LIST",n),Nt("GATEWAY_DOMAINS",[i]),Nt("EVENT_REPORT_DOMAIN",n[0]),Nt("EVENT_REPORT_BACKUP_DOMAIN",n[1]||n[0]),Nt("LOG_UPLOAD_SERVER","".concat(n[0],":6444")),I.info("[".concat(this._clientId,"] set local access point success"))}setRemoteDefaultVideoStreamType(n){var i=this;return x(function*(){if(Vn(n,"streamType",[0,1]),i._remoteDefaultVideoStreamType=n,i._joinInfo)try{yield i._gateway.setDefaultRemoteVideoStreamType(n),i._joinInfo.defaultVideoStream=i._remoteDefaultVideoStreamType}catch(s){throw I.error("[".concat(i._clientId,"] set default remote video stream type error"),s.toString()),s}else I.debug("[".concat(i._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(n))})()}setRemoteVideoStreamType(n,i){var s=this;return x(function*(){Vn(i,"streamType",[0,1]);try{yield s._gateway.setRemoteVideoStreamType(n,i),setTimeout(()=>{const c=s._users.find(d=>d.uid===n);c&&c.videoTrack&&c.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(c){throw I.error("[".concat(s._clientId,"] set remote video stream type error"),c.toString()),c}I.info("[".concat(s._clientId,"] set remote ").concat(n," video stream type to ").concat(i)),s._remoteStreamTypeCacheMap.set(n,i)})()}setStreamFallbackOption(n,i){var s=this;return x(function*(){Vn(i,"fallbackType",[0,1,2]);try{yield s._gateway.setStreamFallbackOption(n,i)}catch(c){throw I.error("[".concat(s._clientId,"] set stream fallback option"),c.toString()),c}I.info("[".concat(s._clientId,"] set remote ").concat(n," stream fallback type to ").concat(i)),s._streamFallbackTypeCacheMap.set(n,i)})()}setEncryptionConfig(n,i,s){Vn(n,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"]),bi(i,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(be(c).call(c,n)){if(!s||!(s instanceof Uint8Array&&32===s.length))throw new W(M.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new W(M.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(i)||I.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=n,this._encryptionSecret=i,s&&(this._encryptionSalt=hf(s))}renewToken(n){var i=this;return x(function*(){if(bi(n,"token",1,2047),!i._key||!i._joinInfo)throw new W(M.INVALID_OPERATION,"renewToken should not be called before user join");const s=i._key;i._key=n,i._joinInfo&&(i._joinInfo.token=n);const c=yield i._renewTokenMutex.lock();try{if(B("USE_NEW_TOKEN")){I.debug("[".concat(i._clientId,"] start renew token with ticket from unilbs"));const d=yield function sx(o,n,i){return aO.apply(this,arguments)}(i._joinInfo,i._axiosCancelSource.token,i._config.httpRetryConfig||_n);I.debug("[".concat(i._clientId,"] get ticket from unilbs success")),yield i._gateway.renewToken({token:n,ticket:d})}else I.debug("[".concat(i._clientId,"] start renew token without ticket")),yield i._gateway.renewToken({token:n});I.debug("[".concat(i._clientId,"] renewToken success"))}catch(d){throw i._key=s,i._joinInfo.token=s,I.error("[".concat(i._clientId,"] renewToken failed"),d.toString()),d}finally{c()}})()}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?I.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const n=this._p2pChannel.getAudioLevels();this.safeEmit(qe.VOLUME_INDICATOR,n)},B("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const n=this._statsCollector.getRTCStats(),i=this._gateway.getInChannelInfo();return n.Duration=Math.round(i.duration/1e3),n}startLiveStreaming(n,i){var s=this;return x(function*(){if(!i){if("h264"!==s.codec)throw new W(M.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!s._p2pChannel.hasLocalMedia())throw new W(M.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(s._liveRawStreamingClient&&s._liveRawStreamingClient.hasUrl(n)||s._liveTranscodeStreamingClient&&s._liveTranscodeStreamingClient.hasUrl(n))throw new W(M.LIVE_STREAMING_TASK_CONFLICT);const c=i?Kn.TRANSCODE:Kn.RAW;return s._createLiveStreamingClient(c).startLiveStreamingTask(n,c)})()}setLiveTranscoding(n){return this._createLiveStreamingClient(Kn.TRANSCODE).setTranscodingConfig(n)}stopLiveStreaming(n){var i=this;return x(function*(){const s=[i._liveRawStreamingClient,i._liveTranscodeStreamingClient].filter(c=>c&&c.hasUrl(n));if(!s.length)throw new W(M.INVALID_PARAMS,"can not find live streaming url to stop");yield z.all(s.map(c=>c&&c.stopLiveStreamingTask(n)))})()}addInjectStreamUrl(n,i){var s=this;return x(function*(){if(!s._joinInfo)throw new W(M.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const c=s._createLiveStreamingClient(Kn.INJECT);c.setInjectStreamConfig(i,0),yield c.startLiveStreamingTask(n,Kn.INJECT)})()}removeInjectStreamUrl(){var n=this;return x(function*(){var i;const s=n._createLiveStreamingClient(Kn.INJECT),c=Array.from(vc(i=s.streamingTasks).call(i)).find(d=>d.mode===Kn.INJECT);if(!n._joinInfo||!c)throw new W(M.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");yield s.stopLiveStreamingTask(c.url)})()}startChannelMediaRelay(n){var i=this;return x(function*(){cm(n),yield i._createChannelMediaRelayClient().startChannelMediaRelay(n)})()}updateChannelMediaRelay(n){var i=this;return x(function*(){cm(n),yield i._createChannelMediaRelayClient().updateChannelMediaRelay(n)})()}stopChannelMediaRelay(){var n=this;return x(function*(){yield n._createChannelMediaRelayClient().stopChannelMediaRelay(),n._statsCollector.onStatsChanged&&(n._statsCollector.onStatsChanged=void 0)})()}sendStreamMessage(n){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new W(M.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof n||n instanceof Uint8Array)&&(n={payload:n}),"string"==typeof n.payload){const s=new TextEncoder;n.payload=s.encode(n.payload)}if(new Blob([n.payload]).size>1024)throw new W(M.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(Se.DATA_STREAM,{payload:hf(n.payload),syncWithAudio:n.syncWithAudio,sendTs:Date.now()-mV},!i)}sendMetadata(n){if(!this._joinInfo)throw new W(M.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([n]).size>1024)throw new W(M.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Se.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:hf(n)})}sendCustomReportMessage(n){var i=this;return x(function*(){if(Array.isArray(n)||(n=[n]),n.forEach(D1),!i._joinInfo)throw new W(M.INVALID_OPERATION,"can not send custom report, not joined");yield ye.sendCustomReportMessage(i._joinInfo.sid,n)})()}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}pickSVCLayer(n,i){var s=this;return x(function*(){Vn(i.spatialLayer,"spatialLayer",[0,1,2,3]),Vn(i.temporalLayer,"temporalLayer",[0,1,2,3]);try{yield s._gateway.pickSVCLayer(n,i)}catch(c){throw I.error("[".concat(s._clientId,"] pick SVC layer failed"),c.toString()),c}})()}setRTM2Flag(n){if(Vn(n,"flag",[0,1]),!this._joinInfo)throw new W(M.INVALID_OPERATION,"Can't setRtm2Flag, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new W(M.INVALID_OPERATION,"Can't setRtm2Flag in ".concat(this.connectionState," state"));return this._gateway.setRTM2Flag(n)}_reset(){if(I.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=or.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._pendingPublishedUsers=[],this._users.forEach(n=>{n._audioTrack&&n._audioTrack._destroy(),n._videoTrack&&n._videoTrack._destroy(),n._dataChannels&&(n._dataChannels.forEach(i=>i._close()),n._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new li("client-publish"),this._subscribeMutex=new li("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(n,i){const s=n||iC();I.debug(n?"[".concat(this._clientId,"] new Session ").concat(s):"[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(s)),this._sessionId=s,this.store.sessionId=s,i?ye.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:i.channel,appid:i.appId,mode:this.mode}):this._joinInfo?ye.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&ye.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=s),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=s)}_publishHighStream(n){var i=this;return x(function*(){if(!i._joinInfo||void 0===i._uid)throw new W(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==i.connectionState&&"RECONNECTING"!==i.connectionState)throw new W(M.INVALID_OPERATION,"can not publish stream in ".concat(i.connectionState," state"));if("auto"===i._turnServer.mode&&B("FORCE_TURN")&&!B("TURN_ENABLE_TCP")&&!B("TURN_ENABLE_UDP"))throw new W(M.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");I.debug("[".concat(i._clientId,"] publish high stream"));try{if(i._p2pChannel instanceof hn){const c=yield i._p2pChannel.publish(n,i._isDualStreamEnabled,i._lowStreamParameter);if(c)try{yield i._gateway.sendExtensionMessage(Mt.PUBLISH,c)}catch(d){throw i._p2pChannel.unpublish(n),d}}else{const c=yield i._p2pChannel.publish(n,i._isDualStreamEnabled,i._lowStreamParameter),d=(yield c.next()).value;if(d){var s;let h;try{h=yield i._gateway.publish(i._uid,d,!0)}catch(p){if(p.code!==M.DISCONNECT_P2P)throw c.throw(p),p}yield c.next((null===(s=h)||void 0===s?void 0:s.ortc)||[])}i._p2pChannel.reportPublishEvent(!0,null);for(const h of n)h instanceof We&&h._encoderConfig&&i._gateway.setVideoProfile(h._encoderConfig),!h.muted&&h.enabled||(yield i._p2pChannel.muteLocalTrack(h))}}catch(c){if(i._p2pChannel.reportPublishEvent(!1,c?.code,n),c?.code===M.WS_ABORT)return;throw c}})()}_publishLowStream(){var n=this;return x(function*(){if(!n._joinInfo||void 0===n._uid)throw new W(M.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==n.connectionState&&"RECONNECTING"!==n.connectionState)throw new W(M.INVALID_OPERATION,"can not publish stream in ".concat(n.connectionState," state"));I.debug("[".concat(n._clientId,"] publish low stream"));const i=n._configDistribute.getLowStreamConfigDistribute();i&&i.bitrate&&(n._lowStreamParameter||(n._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),n._lowStreamParameter&&n._lowStreamParameter.bitrate&&i.bitrate<n._lowStreamParameter.bitrate&&(n._lowStreamParameter.bitrate=i.bitrate));try{const c=yield n._p2pChannel.publishLowStream(n._lowStreamParameter),d=(yield c.next()).value;if(d){var s;let h;try{h=yield n._gateway.publish(n._uid,d,!0)}catch(p){if(p.code!==M.DISCONNECT_P2P)throw c.throw(p),p}c.next((null===(s=h)||void 0===s?void 0:s.ortc)||[]),n._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(c){if(n._p2pChannel.reportPublishEvent(!1,c?.code,void 0,!0),c?.code===M.WS_ABORT)return;throw c}})()}_createLiveStreamingClient(n){if(!this._joinInfo||!this._appId)return new W(M.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=()=>new cx(this._joinInfo,this._config.websocketRetryConfig||_n,this._config.httpRetryConfig||_n),s=c=>{c.onLiveStreamError=(d,h)=>{ye.reportApiInvoke(this._sessionId,{name:Rn.ON_LIVE_STREAM_ERROR,options:[d,h],tag:Je.TRACER}).onSuccess(),this.safeEmit(qe.LIVE_STREAMING_ERROR,d,h)},c.onLiveStreamWarning=(d,h)=>{ye.reportApiInvoke(this._sessionId,{name:Rn.ON_LIVE_STREAM_WARNING,options:[d,h],tag:Je.TRACER}).onSuccess(),this.safeEmit(qe.LIVE_STREAMING_WARNING,d,h)},c.on(nl.REQUEST_WORKER_MANAGER_LIST,(d,h,p)=>{if(!this._joinInfo)return p(new W(M.INVALID_OPERATION,"can not find join info to get worker manager"));ox(d,this._joinInfo,this._axiosCancelSource.token,_n).then(h).catch(p)})};switch(n){case Kn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=i(),s(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Kn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=i(),s(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Kn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=i(),this._injectStreamingClient.on(nl.REQUEST_WORKER_MANAGER_LIST,(c,d,h)=>{if(!this._joinInfo)return h(new W(M.INVALID_OPERATION,"can not find join info to get worker manager"));ox(c,this._joinInfo,this._axiosCancelSource.token,_n).then(d).catch(h)}),this._injectStreamingClient.onInjectStatusChange=(c,d,h)=>{this.safeEmit(qe.INJECT_STREAM_STATUS,c,d,h)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new W(M.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:n,sendResolutionHeight:i}=this.getLocalVideoStats();this._channelMediaRelayClient=new ml(this._joinInfo,this._clientId,this._config.websocketRetryConfig||_n,this._config.httpRetryConfig||_n,{width:n,height:i}),this._channelMediaRelayClient.on("state",c=>{c===$n.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(qe.CHANNEL_MEDIA_RELAY_STATE,c)}),this._channelMediaRelayClient.on("event",c=>{this.safeEmit(qe.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._statsCollector.onStatsChanged=(c,d)=>{var h;"resolution"===c&&(null===(h=this._channelMediaRelayClient)||void 0===h||h.setVideoProfile(d))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(n,i){const{added:s,deleted:c}=n,d=[];Array.isArray(s)&&s.length>0&&s.forEach(h=>{const{uid:p,stream_id:m,ordered:_,max_retrans_times:E,metadata:y}=h,S=this._users.find(T=>T._uintid===p);if(S){if(I.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(p)),be(d).call(d,S)||d.push(S),S._uintid||(S._uintid=p),-1===S._dataChannels.findIndex(T=>T.id===h.stream_id)){const T={id:m,ordered:!!_,maxRetransmits:E,metadata:y},O=new GD(T);S._dataChannels.push(O),I.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published datachannel")),i||this.safeEmit(qe.USER_PUBLISHED,S,"datachannel",T)}this._p2pChannel.hasPendingRemoteDataChannel(S,h.stream_id)&&(I.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(S.uid," after reconnect.")),this._subscribeDataChannel(S,h.stream_id).catch(T=>{I.error("[".concat(this._clientId,"] resubscribe datachannel error"),T.toString())}))}else I.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))}),i&&(this.safeEmit(qe.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(c)&&c.length>0&&c.forEach(h=>{const{uid:p}=h,_=this._users.find(y=>y._uintid===p);if(!_)return void I.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const E=_._dataChannels.find(y=>y.id===h.stream_id);E&&(I.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(p)),this._p2pChannel.unsubscribeDataChannel(_,[E]).then(y=>{if(y)return _._dataChannels=_._dataChannels.filter(S=>S!==E),this._gateway.unsubscribeDataChannel(y,_.uid)}),I.info("[".concat(this._clientId,"] remote user ").concat(p," unpublished datachannel ,id:").concat(E.id)),this.safeEmit(qe.USER_UNPUBLISHED,_,"datachannel",E._config))})}_handleRemoveDataChannels(n){const i=this._users.find(s=>s.uid===n.uid);if(i){if(void 0!==i._dataChannels&&i._dataChannels.length>0){I.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(n.uid));const s=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished datachannel")),i._dataChannels.forEach(c=>{this.safeEmit(qe.USER_UNPUBLISHED,i,"datachannel",c._config)})};this._p2pChannel.unsubscribeDataChannel(i,i._dataChannels).then(c=>{if(c)return this._gateway.unsubscribeDataChannel(c,i.uid)}),s()}}else I.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){var n=this;this._gateway.on(Pt.DISCONNECT_P2P,x(function*(){yield n._p2pChannel.disconnectForReconnect()})),this._gateway.on(Pt.CONNECTION_STATE_CHANGE,(i,s,c)=>{var d;if(c===Ke.FALLBACK)return;const h=()=>{this.safeEmit(qe.CONNECTION_STATE_CHANGE,i,s,c)};if(ye.reportApiInvoke(this._sessionId||(null===(d=this._gateway.joinInfo)||void 0===d?void 0:d.sid)||null,{name:Rn.CONNECTION_STATE_CHANGE,options:[i,s,c],tag:Je.TRACER}).onSuccess(JSON.stringify({cur:i,prev:s,reason:c})),I.info("[".concat(this._clientId,"] connection state change: ").concat(s," -> ").concat(i)),"DISCONNECTED"===i)return this._reset(),void h();if("RECONNECTING"===i)this._users.forEach(m=>{m._trust_in_room_=!1,m._trust_audio_enabled_state_=!1,m._trust_video_enabled_state_=!1,m._trust_audio_mute_state_=!1,m._trust_video_mute_state_=!1,m._trust_audio_stream_added_state_=!1,m._trust_video_stream_added_state_=!1,m._audioSSRC=void 0,m._videoSSRC=void 0,m._videoOrtc=void 0,m._audioOrtc=void 0,m._cname=void 0,m._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===i){var p;this._streamFallbackTypeCacheMap.forEach((m,_)=>{this._gateway.setStreamFallbackOption(_,m).catch(E=>{I.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),E)})}),this._remoteStreamTypeCacheMap.forEach((m,_)=>{this._gateway.setRemoteVideoStreamType(_,m).catch(E=>{I.warning("[".concat(this._clientId,"] auto set remote stream type failed"),E)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(p=this._joinInfo)||void 0===p?void 0:p.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{I.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(m=>{I.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(m))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(m=>!m._trust_in_room_).forEach(m=>{I.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(m.uid)),this._handleUserOffline({uid:m.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(m=>{m._trust_audio_mute_state_||(I.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(m.uid)),this._handleMuteStream(m.uid,_e.AUDIO,!1)),m._trust_video_mute_state_||(I.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(m.uid)),this._handleMuteStream(m.uid,_e.VIDEO,!1)),m._trust_audio_enabled_state_||(I.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(m.uid)),this._handleSetStreamLocalEnable("audio",m.uid,!0)),m._trust_video_enabled_state_||(I.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(m.uid)),this._handleSetStreamLocalEnable("video",m.uid,!0)),m._trust_video_stream_added_state_||(I.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(m.uid)),this._handleResetAddStream(m,"video")),m._trust_audio_stream_added_state_||(I.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(m.uid)),this._handleResetAddStream(m,"audio")),m._video_added_||m._audio_added_||(I.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(m.uid)),this._handleRemoveStream({uid:m.uid,uint_id:m._uintid}))}))},1e3))}h()}),this._gateway.on(Pt.REQUEST_NEW_GATEWAY_LIST,(i,s)=>{if(!this._joinInfo)return s(new W(M.UNEXPECTED_ERROR,"can not recover, no join info"));eO(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||_n,this.store).then(c=>{this._joinInfo&&(this._joinInfo.apResponse=c.gatewayInfo.res,this._joinInfo.gatewayAddrs=c.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=c.gatewayInfo.uni_lbs_ip);const d=[];c.gatewayInfo.gatewayAddrs.forEach(h=>{let{address:p}=h;const[m,_]=p.split(":");d.push(this._joinInfo&&this._joinInfo.proxyServer?{proxy:this._joinInfo.proxyServer,host:m,port:_}:{host:m,port:_})}),i(d)}).catch(s)}),this._gateway.on(Pt.NETWORK_QUALITY,i=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(qe.NETWORK_QUALITY,i)}),this._gateway.on(Pt.STREAM_TYPE_CHANGE,(i,s)=>{this.safeEmit(qe.STREAM_TYPE_CHANGED,i,s),ye.reportApiInvoke(this._sessionId,{name:Rn.STREAM_TYPE_CHANGE,options:[i,s],tag:Je.TRACER}).onSuccess(JSON.stringify({uid:i,streamType:s}))}),this._gateway.on(Pt.IS_P2P_DISCONNECTED,i=>{this._p2pChannel.isP2PDisconnected()?i(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?i(!1):i(!0)}),this._gateway.on(Pt.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(Pt.REQUEST_P2P_CONNECTION_PARAMS,function(){var i=x(function*(s,c,d){try{c(yield n._p2pChannel.startP2PConnection(s))}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this._gateway.on(Pt.JOIN_RESPONSE,(i,s)=>{if(this.store.useP2P)return;const{dtlsParameters:c,iceParameters:d,candidates:h,rtpCapabilities:p,setup:m,cname:_}=WE(i.ortc,s);this._p2pChannel.connect(d,c,h,p,m,_)}),this._gateway.on(Pt.REQUEST_DC_CONNECTION_PARAMS,i=>{i(this._p2pChannel.getEstablishParams())}),this._gateway.on(Pt.RESET_SIGNAL,i=>{this._p2pChannel.resetConnection(i),this._handleGatewaySignalEvents()}),this._gateway.on(Pt.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(Pt.DATACHANNEL_PRECONNECT,function(){var i=x(function*(s,c,d,h){var p,m,_,E,y,S;yield n._p2pChannel.startP2PConnection({turnServer:null===(p=n._joinInfo)||void 0===p?void 0:p.turnServer},!0);const T=function(O,N){let w;return N&&N.ip&&"number"==typeof N.port?(w=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:N.ip,port:N.port.toString(),type:"host",extension:{}}],I.debug("Using remote candidate from AP ".concat(N.ip,":").concat(N.port)),N.ip6&&(w.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:N.ip6,port:N.port.toString(),type:"host",extension:{}}),I.debug("Using IPV6 remote candidate from AP ".concat(N.ip6,":").concat(N.port)))):w=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:O.ip,port:O.port.toString(),type:"host",extension:{}}],w}(s,c);return n._p2pChannel.preConnect({iceUfrag:"".concat(null===(m=n._joinInfo)||void 0===m?void 0:m.apResponse.cid,"_").concat(null===(_=n._joinInfo)||void 0===_?void 0:_.apResponse.cert),icePwd:"".concat(null===(E=n._joinInfo)||void 0===E?void 0:E.apResponse.cid,"_").concat(null===(y=n._joinInfo)||void 0===y?void 0:y.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(S=B("FINGERPRINT"))&&void 0!==S?S:s.fingerprint}]},T,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(d).catch(h)});return function(s,c,d,h){return i.apply(this,arguments)}}())}_handleGatewaySignalEvents(){var n=this;this._gateway.signal.on(xe.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(xe.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(xe.ON_ADD_AUDIO_STREAM,i=>this._handleAddAudioOrVideoStream("audio",i.uid,i.ssrcId,i.cname,i.uint_id,i.ortc)),this._gateway.signal.on(xe.ON_ADD_VIDEO_STREAM,i=>this._handleAddAudioOrVideoStream("video",i.uid,i.ssrcId,i.cname,i.uint_id,i.ortc,i.rtxSsrcId)),this._gateway.signal.on(xe.ON_REMOTE_DATASTREAM_UPDATE,i=>{this._handleUpdateDataChannel(i)}),this._gateway.signal.on(xe.ON_REMOTE_FULL_DATASTREAM_INFO,i=>{this._handleUpdateDataChannel({added:i.datastreams,deleted:[]},!0)}),this._gateway.signal.on(xe.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(xe.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(xe.MUTE_AUDIO,i=>this._handleMuteStream(i.uid,_e.AUDIO,!0)),this._gateway.signal.on(xe.UNMUTE_AUDIO,i=>this._handleMuteStream(i.uid,_e.AUDIO,!1)),this._gateway.signal.on(xe.MUTE_VIDEO,i=>this._handleMuteStream(i.uid,_e.VIDEO,!0)),this._gateway.signal.on(xe.UNMUTE_VIDEO,i=>this._handleMuteStream(i.uid,_e.VIDEO,!1)),this._gateway.signal.on(xe.RECEIVE_METADATA,i=>{const s=Pg(i.metadata);this.safeEmit(qe.RECEIVE_METADATA,i.uid,s)}),this._gateway.signal.on(xe.ON_DATA_STREAM,function(){var i=x(function*(s){if(!s)return;let c=0;if(s.ordered||s.syncWithAudio){const d=n._p2pChannel.getStats(),h=n.remoteUsers.find(m=>m.uid===s.uid),p=d?.audioRecv.find(m=>m.ssrc===h?._audioSSRC);c=p?.jitterBufferMs}null==c&&(c=0),function gV(o){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!o.syncWithAudio)return Mx(i,{uid:o.uid,payload:Pg(o.payload)});const s="".concat(i.id,"-").concat(o.uid),c=_T.get(s)||[],d=c.findIndex(_=>o.sendTs>=_.sendTs),h=Px(Px({},o),{},{context:i,mediaDelay:n,recvTs:Date.now()});-1===d?c.push(h):c.splice(d,0,h),_T.set(s,c);let p=!1;var m;gT.has(s)?p=!(null===(m=gT.get(s))||void 0===m||!m.isSyncing):gT.set(s,{isSyncing:p,firstRecvTs:0,firstSendTs:0}),p||sy(s)}(s,c,{id:n._clientId,onStreamMessage:"function"==typeof n.onStreamMessage?n.onStreamMessage.bind(n):void 0,safeEmit:n.safeEmit.bind(n)})});return function(s){return i.apply(this,arguments)}}()),this._gateway.signal.on(xe.ON_CRYPT_ERROR,()=>{uf(()=>{I.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(qe.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(xe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{I.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ke.TOKEN_EXPIRE),this.safeEmit(qe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(xe.ON_STREAM_FALLBACK_UPDATE,i=>{I.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(i.stream_id,", attr: ").concat(i.stream_type)),this.safeEmit(qe.STREAM_FALLBACK,i.stream_id,1===i.stream_type?"fallback":"recover")}),this._gateway.signal.on(xe.ON_PUBLISH_STREAM,i=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:i.proxy})),I.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(i))))}),this._gateway.signal.on(xe.ENABLE_LOCAL_VIDEO,i=>{this._handleSetStreamLocalEnable("video",i.uid,!0)}),this._gateway.signal.on(xe.DISABLE_LOCAL_VIDEO,i=>{this._handleSetStreamLocalEnable("video",i.uid,!1)}),this._gateway.signal.on(de.REQUEST_TIMEOUT,(i,s)=>{if(this._joinInfo)switch(i){case Se.PUBLISH:{if(!s)return;const h=s.ortc;if(h){var c,d;const p=h.some(E=>{let{stream_type:y}=E;return y===It.Audio}),m=h.some(E=>{let{stream_type:y}=E;return y!==It.Audio}),_=h.some(E=>{let{stream_type:y}=E;return y===It.Screen||y===It.ScreenLow});"offer"===s.state&&ye.publish(this._joinInfo.sid,{eventElapse:gi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:M.TIMEOUT,audio:p,video:m,p2pid:s.p2p_id,publishRequestid:this.store.pubId,screenshare:_,audioName:p?null===(c=h.find(E=>{let{stream_type:y}=E;return y===It.Audio}))||void 0===c||null===(c=c.ssrcs[0])||void 0===c?void 0:c.ssrcId.toString():void 0,videoName:m?null===(d=h.find(E=>{let{stream_type:y}=E;return y!==It.Audio}))||void 0===d||null===(d=d.ssrcs[0])||void 0===d?void 0:d.ssrcId.toString():void 0})}break}case Se.SUBSCRIBE:s&&ye.subscribe(this._joinInfo.sid,{succ:!1,ec:M.TIMEOUT,audio:s.stream_type===_e.AUDIO,video:s.stream_type===_e.VIDEO,peerid:s.stream_id,subscribeRequestid:s.ssrcId,p2pid:this.store.p2pId,eventElapse:gi.measureFromSubscribeStart(this.store.clientId,s.ssrcId)})}}),this._gateway.signal.on(xe.ON_P2P_OK,i=>{}),this._gateway.signal.on(xe.ON_PUBLISHED_USER_LIST,i=>{if(null==i||!i.users)return;B("BLOCK_LOCAL_CLIENT")&&(i.users=i.users.filter(d=>!yd(d.string_id||d.stream_id,this.channelName)));const s=[],c=[];for(const d of i.users){let h=this._users.find(S=>S._uintid===d.stream_id);h?h._trust_in_room_=!0:(h=new vi(d.string_id||d.stream_id,d.stream_id),this._users.push(h),0===this.getListeners(qe.PUBLISHED_USER_LIST).length&&(I.debug("[".concat(this._clientId,"] user online"),d.stream_id),this.safeEmit(qe.USER_JOINED,h)));const p=Xn.Audio&d.stream_type,m=(Xn.Video|Xn.LwoVideo)&d.stream_type,_=0!=(65280&d.stream_type),E=p&&h.hasAudio,y=m&&h.hasVideo;m&&(h._trust_video_stream_added_state_=!0,h._video_added_=!0,h._videoSSRC=d.video_ssrc,h._rtxSsrcId=d.video_rtx),p&&(h._trust_audio_stream_added_state_=!0,h._audio_added_=!0,h._audioSSRC=d.audio_ssrc),p&&!E&&0===this.getListeners(qe.PUBLISHED_USER_LIST).length&&(I.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published audio")),this.safeEmit(qe.USER_PUBLISHED,h,"audio")),m&&!y&&0===this.getListeners(qe.PUBLISHED_USER_LIST).length&&(I.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published video")),this.safeEmit(qe.USER_PUBLISHED,h,"video")),(p&&!E||m&&!y||_)&&s.push(h),m&&this._p2pChannel.hasPendingRemoteMedia(h,"video")&&c.push({user:h,mediaType:"video"}),p&&this._p2pChannel.hasPendingRemoteMedia(h,"audio")&&c.push({user:h,mediaType:"audio"})}c.length>0&&(I.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(c.map(d=>"user: ".concat(d.user.uid,", mediaType: ").concat(d.mediaType)).join("; ")," ")),this.massSubscribe(c).catch(d=>{I.error("[".concat(this._clientId,"] mass resubscribe error"),d.toString())})),this.getListeners(qe.PUBLISHED_USER_LIST).length>0?B("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=s:(I.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(s.map(d=>d.uid).join(", "))),this.safeEmit(qe.PUBLISHED_USER_LIST,s)):I.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(s.map(d=>d.uid).join(", ")))})}_handleP2PEvents(){var n=this;this._gateway.signal.on(xe.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Mt.PUBLISH,function(){var i=x(function*(s,c){s.forEach(d=>d.kind===_e.VIDEO?(n._handleP2PAddAudioOrVideoStream("video",c),n._handleMuteStream(c,_e.VIDEO,!!d.isMuted)):(n._handleP2PAddAudioOrVideoStream("audio",c),n._handleMuteStream(c,_e.AUDIO,!!d.isMuted)))});return function(s,c){return i.apply(this,arguments)}}()),this._gateway.signal.on(de.P2P_START,function(){var i=x(function*(s,c){var d;n._p2pChannel instanceof hn&&c(yield n._p2pChannel.startP2P({turnServer:null===(d=n._joinInfo)||void 0===d?void 0:d.turnServer},s))});return function(s,c){return i.apply(this,arguments)}}()),this._gateway.signal.on(de.P2P_CONNECTION,function(){var i=x(function*(s){n._p2pChannel instanceof hn&&(yield n._p2pChannel.p2pConnect(s))});return function(s){return i.apply(this,arguments)}}()),this._gateway.signal.on(de.P2P_REMOTE_CANDIDATE_UPDATE,i=>{this._p2pChannel instanceof hn&&this._p2pChannel.addRemoteCandidate(JSON.parse(i))}),this._gateway.signal.on(Mt.SUBSCRIBE,function(){var i=x(function*(s,c,d){if(n._p2pChannel instanceof hn){const{trackType:h}=JSON.parse(s);try{yield n._p2pChannel.dopublish(h),c()}catch(p){d(p)}}});return function(s,c,d){return i.apply(this,arguments)}}()),this._gateway.signal.on(Mt.UNSUBSCRIBE,function(){var i=x(function*(s,c,d){if(n._p2pChannel instanceof hn){const{mediaType:h}=JSON.parse(s);try{yield n._p2pChannel.doUnpublish(h),c()}catch(p){d(p)}}});return function(s,c,d){return i.apply(this,arguments)}}()),this._gateway.signal.on(Mt.EXCHANGE_SDP,function(){var i=x(function*(s,c,d){if(n._p2pChannel instanceof hn){const{type:h,sdp:p}=JSON.parse(s);try{c(yield n._p2pChannel.setDescription(h,p))}catch(m){d(m)}}});return function(s,c,d){return i.apply(this,arguments)}}()),this._gateway.signal.on(Mt.UNPUBLISH,function(){var i=x(function*(s,c,d){if(n._p2pChannel instanceof hn){const{unpubMsg:h,uid:p}=s;if(1===h.length){const m=h[0].stream_type===It.Audio?_e.AUDIO:_e.VIDEO;n._handleMuteStream(p,m,!0);const{sdp:_}=s;if(n._p2pChannel instanceof hn&&_){const E=n._users.find(y=>y.uid===p);if(!E)return I.warning("[".concat(n._clientId,"] can not find remote user, ignore mute event, uid: ").concat(p)),void c();n._p2pChannel.unsubscribe(E,_,m).then(y=>{y&&c(y)}).catch(d)}else c()}else n._handleRemoveStream(s,c,d)}});return function(s,c,d){return i.apply(this,arguments)}}()),this._gateway.signal.on(Mt.CONTROL,function(){var i=x(function*(s,c,d){const{action:h,sdp:p,isMuteAll:m,uid:_}=s;switch(h){case Es.MUTE_LOCAL_VIDEO:n._handleMuteStream(_,_e.VIDEO,!0,p,c,d);break;case Es.MUTE_LOCAL_AUDIO:c(),n._handleMuteStream(_,_e.AUDIO,!0);break;case Es.UNMUTE_LOCAL_VIDEO:c(),n._handleP2PAddAudioOrVideoStream("video",_),n._handleMuteStream(_,_e.VIDEO,!1);break;case Es.UNMUTE_LOCAL_AUDIO:c(),n._handleP2PAddAudioOrVideoStream("audio",_),n._handleMuteStream(_,_e.AUDIO,!1)}m&&n._handleRemoveStream(s,c,d)});return function(s,c,d){return i.apply(this,arguments)}}()),this._gateway.signal.on(Mt.DO_SUBSCRIBE,function(){var i=x(function*(s,c,d){if(n._p2pChannel instanceof hn){const{kind:h,sdp:p,ssrcId:m,uid:_}=s,E=n._users.find(y=>y.uid===_);if(!E)return I.error("[".concat(n._clientId,"] can not find target user!(on_add_stream)")),void c();try{c(yield n._p2pChannel.subscribe(E,h,p,m))}catch(y){d(y)}}});return function(s,c,d){return i.apply(this,arguments)}}()),this._gateway.signal.on(Mt.DO_UNSUBSCRIBE,function(){var i=x(function*(s,c,d){if(n._p2pChannel instanceof hn){const{uid:h,kind:p,sdp:m}=s,_=n._users.find(E=>E.uid===h);if(!_)return I.error("[".concat(n._clientId,"] can not find target user!(on_add_stream)")),void c();try{c(yield n._p2pChannel.unsubscribe(_,m,p))}catch(E){d(E)}}});return function(s,c,d){return i.apply(this,arguments)}}()),this._gateway.signal.on(Mt.RESTART_ICE,function(){var i=x(function*(s,c,d){if(n._p2pChannel instanceof hn)try{c(yield n._p2pChannel.setDescription("remote",s))}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestP2PRestartICE,function(){var i=x(function*(s,c,d){try{c(yield n._gateway.sendExtensionMessage(Mt.RESTART_ICE,s))}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Re.LocalCandidate,i=>{this._gateway.sendExtensionMessage(Mt.CANDIDATE,JSON.stringify(i))}),this._p2pChannel.on(Re.RequestP2PMuteLocal,function(){var i=x(function*(s,c,d){try{c(yield n._gateway.sendExtensionMessage(Mt.CONTROL,s))}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestP2PPublish,function(){var i=x(function*(s,c,d){try{c(yield n._gateway.sendExtensionMessage(Mt.DO_SUBSCRIBE,s))}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestP2PUnPublish,function(){var i=x(function*(s,c,d){try{c(yield n._gateway.sendExtensionMessage(Mt.DO_UNSUBSCRIBE,s))}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestP2PUnmuteRemote,function(){var i=x(function*(s,c,d){if(n._joinInfo)try{yield n._gateway.unmuteRemote(s,n._joinInfo.stringUid||n._joinInfo.uid),c()}catch(h){h.code===M.DISCONNECT_P2P?c():d(h)}else c()});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestP2PMuteRemote,function(){var i=x(function*(s,c,d){if(n._joinInfo)try{yield n._gateway.muteRemote(s,n._joinInfo.stringUid||n._joinInfo.uid),c()}catch(h){h.code===M.DISCONNECT_P2P?c():d(h)}else c()});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Re.StateChange,(i,s)=>{s===et.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){var n=this;this._p2pChannel.on(Re.RequestMuteLocal,function(){var i=x(function*(s,c,d){if(n._joinInfo)try{yield n._gateway.muteLocal(s,n._joinInfo.stringUid||n._joinInfo.uid),c()}catch(h){h.code===M.DISCONNECT_P2P?c():d(h)}else c()});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestUnmuteLocal,function(){var i=x(function*(s,c,d){if(n._joinInfo)try{yield n._gateway.unmuteLocal(s,n._joinInfo.stringUid||n._joinInfo.uid),c()}catch(h){h.code===M.DISCONNECT_P2P?c():d(h)}else c()});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestRePublish,(i,s,c)=>{this.publish(i,!1).then(s).catch(c)}),this._p2pChannel.on(Re.RequestRePublishDataChannel,(i,s,c)=>{z.all(i.map(function(){var d=x(function*(h){yield n._p2pChannel.publishDataChannel([h]);const p={streamId:h.id,ordered:h.ordered,maxRetransmits:h.maxRetransmits,metadata:h.metadata,channelId:h._originDataChannelId};try{yield n._gateway.publishDataChannel(n._uid,p,!0)}catch(m){if(m.code!==M.DISCONNECT_P2P)throw m}});return function(h){return d.apply(this,arguments)}}())).then(s).catch(c)}),this._p2pChannel.on(Re.RequestReSubscribe,function(){var i=x(function*(s,c,d){try{for(const{user:h,kind:p}of s)p===_e.VIDEO?yield n.subscribe(h,"video"):yield n.subscribe(h,"audio");c()}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestUploadStats,(i,s)=>{this._gateway.uploadStats(i,s)}),this._p2pChannel.on(Re.MediaReconnectStart,i=>{this.safeEmit(qe.MEDIA_RECONNECT_START,i)}),this._p2pChannel.on(Re.MediaReconnectEnd,i=>{this.safeEmit(qe.MEDIA_RECONNECT_END,i)}),this._p2pChannel.on(Re.NeedSignalRTT,i=>{i(this._gateway.getSignalRTT())}),this._p2pChannel.on(Re.RequestRestartICE,function(){var i=x(function*(s){if(n._p2pChannel instanceof hn)return;const c=yield n._p2pChannel.restartICE(s),d=yield c.next();if(d.done)return;const h=d.value;let p;try{p=yield n._gateway.restartICE({iceParameters:h})}catch(_){return void c.throw(_)}const{iceParameters:m}=function(_){const E=_.iceParameters;return{iceParameters:{iceUfrag:E.iceUfrag,icePwd:E.icePwd}}}(p);yield c.next({remoteIceParameters:m})});return function(s){return i.apply(this,arguments)}}()),this._p2pChannel.on(Re.RequestReconnect,x(function*(){n._gateway.reconnect()})),this._p2pChannel.on(Re.RequestReconnectPC,x(function*(){var i;const{iceParameters:s,dtlsParameters:c,rtpCapabilities:d}=yield n._p2pChannel.startP2PConnection({turnServer:null===(i=n._joinInfo)||void 0===i?void 0:i.turnServer}),{gatewayEstablishParams:h,gatewayAddress:p}=yield n._gateway.reconnectPC({iceParameters:s,dtlsParameters:c,rtpCapabilities:d}),{dtlsParameters:m,iceParameters:_,candidates:E,rtpCapabilities:y,setup:S,cname:T}=WE(h,p);yield n._p2pChannel.connect(_,m,E,y,S,T),yield n._p2pChannel.republish(),yield n._p2pChannel.reSubscribe()})),this._p2pChannel.on(Re.RequestUnpublishForReconnectPC,function(){var i=x(function*(s,c,d){n._joinInfo&&void 0!==n._uid?(yield n._gateway.unpublish(s,n._uid),c()):d()});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Re.P2PLost,()=>{this.safeEmit(qe.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Re.UpdateVideoEncoder,i=>{i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig)}),this._p2pChannel.on(Re.ConnectionTypeChange,i=>{this.safeEmit(qe.IS_USING_CLOUD_PROXY,i)}),this._p2pChannel.on(Re.RequestLowStreamParameter,i=>{i(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Re.QueryClientConnectionState,i=>{i(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}enableContentInspect(n){var i=this;return x(function*(){if("CONNECTED"!==i.connectionState||!i._joinInfo)throw new W(M.INVALID_OPERATION,"[".concat(i._clientId,"] Client did not join channel"));if(i._inspect)throw new W(M.INVALID_OPERATION,"[".concat(i._clientId,"] Inspect content service already in connecting/connected state"));if(!n)throw new W(M.INVALID_PARAMS,"[".concat(i._clientId,"] inspectConfig is necessary"));if(!n.inspectType||!Array.isArray(n.inspectType))throw new W(M.INVALID_PARAMS,"[".concat(i._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const s=[...new Set(n.inspectType)];s.forEach(c=>{var d;if(!be(d=["supervise","moderation"]).call(d,c))throw new W(M.INVALID_PARAMS,"[".concat(i._clientId,"] ").concat(c," is not a valid inspect type."))}),n.inspectType=s}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new W(M.INVALID_PARAMS,"[".concat(i._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const s=new ty(n);i._inspect=s,i.handleVideoInspectEvents(i._inspect),yield s.init({appId:i._joinInfo.appId,areaCode:"",cname:i._joinInfo.cname,sid:i._joinInfo.sid,token:i._joinInfo.token,uid:i._joinInfo.uid,cid:i._joinInfo.cid,vid:i._joinInfo.vid?Number(i._joinInfo.vid):0},_n)}catch(s){throw Array.isArray(s)?s[0]:s}})()}disableContentInspect(){var n=this;return x(function*(){if(!n._inspect)throw new W(M.INVALID_OPERATION,"[".concat(n._clientId,"] inspectVideoContent not started"));try{n._inspect.close(),n._inspect=void 0}catch(i){throw Array.isArray(i)?i[0]:i}})()}setImageModeration(n,i){var s=this;return x(function*(){if(Zc(n,"enabled"),n){if(!i)throw new W(M.INVALID_PARAMS,"[".concat(s._clientId,"] config is necessary"));if(At(i.interval,"interval",1e3,1/0),"CONNECTED"!==s.connectionState||!s._joinInfo)throw new W(M.INVALID_OPERATION,"[".concat(s._clientId,'] can not enable image moderation, not joined"'));try{if(s._moderation)return void s._moderation.updateConfig(i);const c=new pT(i);s._moderation=c,s.handleImageModerationEvents(s._moderation),yield c.init({appId:s._joinInfo.appId,areaCode:"",cname:s._joinInfo.cname,sid:s._joinInfo.sid,token:s._joinInfo.token,uid:s._joinInfo.uid,cid:s._joinInfo.cid,vid:s._joinInfo.vid?Number(s._joinInfo.vid):0},_n)}catch(c){throw Array.isArray(c)?c[0]:c}}else{if(!s._moderation)throw new W(M.INVALID_OPERATION,"[".concat(s._clientId,"] image moderation not started"));try{s._moderation.close(),s._moderation.removeAllListeners(),s._moderation=void 0}catch(c){throw Array.isArray(c)?c[0]:c}}})()}handleImageModerationEvents(n){n.on(Co.CONNECTION_STATE_CHANGE,(i,s)=>{if(this.safeEmit(qe.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,i,s),i===ro.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new W(M.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");n.inspectImage()}}),n.on(Co.CLIENT_LOCAL_VIDEO_TRACK,i=>{i(this.localTracks.filter(s=>"video"===s.trackMediaType)[0])})}handleVideoInspectEvents(n){n.on(Jn.CONNECTION_STATE_CHANGE,(i,s)=>{if(this.safeEmit(qe.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,i,s),s===So.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(qe.CONTENT_INSPECT_ERROR,new W(M.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));n.inspectImage()}}),n.on(Jn.INSPECT_RESULT,(i,s)=>{var c;if(s?.code===M.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return I.debug("Stop inspect content because that has left channel"),null==this||null===(c=this._inspect)||void 0===c||c.close(),void(this._inspect=void 0);this.safeEmit(qe.CONTENT_INSPECT_RESULT,i,s)}),n.on(Jn.CLIENT_LOCAL_VIDEO_TRACK,i=>{i(this.localTracks.filter(s=>"video"===s.trackMediaType)[0])})}getJoinChannelServiceRecords(){return I.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}setPublishAudioFilterEnabled(n){var i=this;return x(function*(){Zc(n,"enabled"),Nt("ENABLE_PUBLISH_AUDIO_FILTER",n),i._joinInfo&&(yield i._gateway.setPublishAudioFilterEnabled(n))})()}_handleResetAddStream(n,i){switch(i){case"audio":n._audio_added_=!1,n._trust_audio_stream_added_state_=!0;break;case"video":n._video_added_=!1,n._trust_video_stream_added_state_=!0}}}te([Ae(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",z)],Lt.prototype,"leave",null),te([Ae({argsMap:(o,n)=>{if(!Array.isArray(n)){if(!(n instanceof wi))return[n];n=[n]}return n.map(i=>i?Object(i).toString():"null")}}),P("design:type",Function),P("design:paramtypes",[Object,Boolean]),P("design:returntype",z)],Lt.prototype,"publish",null),te([Ae({argsMap:(o,n)=>(n||(n=[]),n instanceof Rb?[n.getChannelId()]:(Array.isArray(n)||(n=[n]),n.map(i=>i.getTrackId())))}),P("design:type",Function),P("design:paramtypes",[Object]),P("design:returntype",z)],Lt.prototype,"unpublish",null),te([Ae({argsMap:(o,n,i,s)=>[n.uid,i,s]}),P("design:type",Function),P("design:paramtypes",[vi,String,Number]),P("design:returntype",z)],Lt.prototype,"subscribe",null),te([Ae({argsMap:(o,n)=>n.map(i=>{let{user:s,mediaType:c}=i;return[s?.uid,c]})}),P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],Lt.prototype,"massSubscribe",null),te([Ae({argsMap:(o,n,i,s)=>[n.uid,i,s]}),P("design:type",Function),P("design:paramtypes",[vi,String,Number]),P("design:returntype",z)],Lt.prototype,"unsubscribe",null),te([Ae({argsMap:(o,n)=>n.map(i=>{let{user:s,mediaType:c}=i;return{uid:s?.uid,mediaType:c}})}),P("design:type",Function),P("design:paramtypes",[Array]),P("design:returntype",z)],Lt.prototype,"massUnsubscribe",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[Object]),P("design:returntype",z)],Lt.prototype,"setLowStreamParameter",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",z)],Lt.prototype,"enableDualStream",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",z)],Lt.prototype,"disableDualStream",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[String,Object]),P("design:returntype",z)],Lt.prototype,"setClientRole",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[String,Boolean]),P("design:returntype",void 0)],Lt.prototype,"setProxyServer",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[Object,Boolean]),P("design:returntype",void 0)],Lt.prototype,"setTurnServer",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",void 0)],Lt.prototype,"setLicense",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[Number]),P("design:returntype",void 0)],Lt.prototype,"startProxyServer",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],Lt.prototype,"stopProxyServer",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[Object]),P("design:returntype",void 0)],Lt.prototype,"setLocalAccessPointsV2",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[Array,String]),P("design:returntype",void 0)],Lt.prototype,"setLocalAccessPoints",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[Number]),P("design:returntype",z)],Lt.prototype,"setRemoteDefaultVideoStreamType",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[Object,Number]),P("design:returntype",z)],Lt.prototype,"setRemoteVideoStreamType",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[Object,Number]),P("design:returntype",z)],Lt.prototype,"setStreamFallbackOption",null),te([Ae({argsMap:(o,n)=>[n]}),P("design:type",Function),P("design:paramtypes",[String,String,Uint8Array]),P("design:returntype",void 0)],Lt.prototype,"setEncryptionConfig",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],Lt.prototype,"renewToken",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],Lt.prototype,"enableAudioVolumeIndicator",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[String,Boolean]),P("design:returntype",z)],Lt.prototype,"startLiveStreaming",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[Object]),P("design:returntype",z)],Lt.prototype,"setLiveTranscoding",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[String]),P("design:returntype",z)],Lt.prototype,"stopLiveStreaming",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[String,Object]),P("design:returntype",z)],Lt.prototype,"addInjectStreamUrl",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",z)],Lt.prototype,"removeInjectStreamUrl",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[jE]),P("design:returntype",z)],Lt.prototype,"startChannelMediaRelay",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[jE]),P("design:returntype",z)],Lt.prototype,"updateChannelMediaRelay",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",z)],Lt.prototype,"stopChannelMediaRelay",null),te([Ae({argsMap:(o,n)=>(Array.isArray(n)||(n=[n]),[JSON.stringify(n)])}),P("design:type",Function),P("design:paramtypes",[Object]),P("design:returntype",z)],Lt.prototype,"sendCustomReportMessage",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[Object,Object]),P("design:returntype",z)],Lt.prototype,"pickSVCLayer",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[Number]),P("design:returntype",z)],Lt.prototype,"setRTM2Flag",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[Object]),P("design:returntype",z)],Lt.prototype,"enableContentInspect",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",z)],Lt.prototype,"disableContentInspect",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[Boolean,Object]),P("design:returntype",z)],Lt.prototype,"setImageModeration",null),te([Ae({reportResult:!0}),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",Array)],Lt.prototype,"getJoinChannelServiceRecords",null),te([Ae(),P("design:type",Function),P("design:paramtypes",[Boolean]),P("design:returntype",z)],Lt.prototype,"setPublishAudioFilterEnabled",null);const kx=Et().name;class cy{constructor(n,i){C(this,"id",0),C(this,"element",void 0),C(this,"peerPair",void 0),C(this,"context",void 0),C(this,"audioPlayerElement",void 0),C(this,"audioTrack",void 0),cy.count+=1,this.id=cy.count,this.element=n,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=n=>{const i=document.createElement("audio");i.srcObject=new MediaStream([n.track]),i.play(),this.audioPlayerElement=i}}switchSdp(){var n=this;return x(function*(){if(!n.peerPair)return;const i=function(){var c=x(function*(d,h){const p="offer"===h?yield d.createOffer():yield d.createAnswer();return yield d.setLocalDescription(p),"complete"===d.iceGatheringState?d.localDescription:new z(m=>{d.onicegatheringstatechange=()=>{"complete"===d.iceGatheringState&&m(d.localDescription)}})});return function(h,p){return c.apply(this,arguments)}}(),s=function(){var c=x(function*(d,h){return yield d.setRemoteDescription(h)});return function(h,p){return c.apply(this,arguments)}}();try{const c=yield i(n.peerPair[0],"offer");yield s(n.peerPair[1],c);const d=yield i(n.peerPair[1],"answer");yield s(n.peerPair[0],d)}catch(c){throw new W(M.LOCAL_AEC_ERROR,c.toString()).print()}})()}getTracksFromMediaElement(n){var i=this;return x(function*(){if(i.audioTrack)return i.audioTrack;let s;try{n instanceof HTMLVideoElement&&(n.captureStream?n.captureStream():n.mozCaptureStream()),s=i.context.createMediaStreamDestination(),i.context.createMediaElementSource(n).connect(s)}catch(d){throw new W(M.LOCAL_AEC_ERROR,d.toString()).print()}if(!s)throw new W(M.LOCAL_AEC_ERROR,"no dest node when local aec").print();const c=s.stream.getAudioTracks()[0];return i.audioTrack=c,c})()}getElement(){return this.element}startEchoCancellation(){var n=this;return x(function*(){n.context.resume(),n.peerPair&&n.close(),n.initPeers();const i=n.element,s=yield n.getTracksFromMediaElement(i);n.peerPair&&n.peerPair[0].addTrack(s),yield n.switchSdp()})()}close(){I.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(n=>{n.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}C(cy,"count",0);const yT=window.AudioContext||window.webkitAudioContext;class jr{constructor(){C(this,"units",[]),C(this,"context",void 0)}processExternalMediaAEC(n){if(!this._doesEnvironmentNeedAEC())return I.debug("the system does not need to process local aec"),-1;this.context||(this.context=new yT);let i=this.units.find(s=>s&&s.getElement()===n);return i||(i=new cy(n,this.context),this.units.push(i)),i.startEchoCancellation(),I.debug("start processing local audio echo cancellation, id is",i.id),i.id}_doesEnvironmentNeedAEC(){return Et().name!==gt.SAFARI}}te([Ae({report:ye}),P("design:type",Function),P("design:paramtypes",[HTMLAudioElement]),P("design:returntype",Number)],jr.prototype,"processExternalMediaAEC",null);const EV=new jr;function Yd(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function vT(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?Yd(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Yd(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}const ly=window||document;function Bh(o){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!ly)return;const i=ai._cspEventHandlerPointer;if(i&&n)return void console.error(i,n);const s=c=>{if(!(c&&c.blockedURI&&(ai.onSecurityPolicyViolation||ai.getListeners(gs.SECURITY_POLICY_VIOLATION).length>0)))return;const d=c.blockedURI;B("CSP_DETECTED_HOSTNAME_LIST").some(h=>be(d).call(d,h))&&(ai.onSecurityPolicyViolation&&"function"==typeof ai.onSecurityPolicyViolation&&ai.onSecurityPolicyViolation(c),ai.getListeners(gs.SECURITY_POLICY_VIOLATION).length>0&&ai.safeEmit(gs.SECURITY_POLICY_VIOLATION,c))};i&&ly.removeEventListener("securitypolicyviolation",i),(n||o&&"function"==typeof o||ai.getListeners(gs.SECURITY_POLICY_VIOLATION).length>0)&&ly.addEventListener("securitypolicyviolation",s),ai._cspEventHandlerPointer=s}Nt("PROCESS_ID","process-".concat(Ot(8,""),"-").concat(Ot(4,""),"-").concat(Ot(4,""),"-").concat(Ot(4,""),"-").concat(Ot(12,""))),function(){const o=Et();Ji.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ji.getStreamFromExtension=o.name===gt.CHROME&&Number(o.version)>34,Ji.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const n=new RTCPeerConnection;let i=!1;try{n.addTransceiver("audio"),i=!0}catch{}return n.close(),i}(),Ji.supportMinBitrate=o.name===gt.CHROME||o.name===gt.EDGE,Ji.supportSetRtpSenderParameters=function(){const n=Et();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!pc()||!(!nr()&&!Og())||n.name===gt.FIREFOX&&Number(n.version)>=64)}(),o.name===gt.SAFARI&&(Ji.supportDualStream=Number(o.version)>=14),Ji.webAudioMediaStreamDest=function(){const n=Et();return!(n.name===gt.SAFARI&&Number(n.version)<12)}(),Ji.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,Ji.supportWebGL=typeof WebGLRenderingContext<"u",Ji.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,pc()||(Ji.webAudioWithAEC=!0),Ji.supportShareAudio=function(){const n=Et();return(n.os===ii.WIN_10||n.os===ii.WIN_81||n.os===ii.WIN_7||n.os===ii.LINUX||n.os===ii.MAC_OS)&&n.name===gt.CHROME&&Number(n.version)>=74}(),Ji.supportDataChannel=!!(JS(76)||function(n){const i=Et();return!(i.name!==gt.FIREFOX||!i.osVersion)&&Number(i.version)>=68}()||function(n){const i=Et();return!(i.name!==gt.SAFARI||!i.osVersion)&&Number(i.version)>=14}()),Ji.supportPCSetConfiguration=function(){const n=window.RTCPeerConnection;return!zt()&&!!n&&n.prototype.setConfiguration instanceof Function}(),Ji.supportWebRTCEncodedTransform=function(){const n=Et();return"Chrome"===n.name&&Number(n.version)>=86}(),Ji.supportWebRTCInsertableStream=function(){const n=Et();return(n.name===gt.CHROME||n.name===gt.EDGE)&&Number(n.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ms(()=>{Ji.supportDualStreamEncoding=function(){const n=Et();return!!B("DISABLE_WEBAUDIO")||"Safari"===n.name&&Number(n.version)>=14||!!("Chrome"===n.name&&/Windows/i.test(n.os||"")&&Number(n.version)>=100&&B("CHROME_DUAL_STREAM_USE_ENCODING"))}(),I.info("browser compatibility",JSON.stringify(Ji),JSON.stringify(o))})}(),function(){let o;try{o=window.localStorage.getItem("websdk_ng_global_parameter")}catch(n){return void I.error("Error loading sdk config",n.message)}if(o)try{const n=JSON.parse(window.atob(o)),i=Date.now();I.debug("Loading global parameters from cache",n),Object.keys(n).forEach(s=>{if(Object.prototype.hasOwnProperty.call(hi,s)){const{value:c,expires:d}=n[s];if(d&&d<=i)return;gd[s]=c,hi[s]=c}})}catch(n){I.error("Error loading mutableParamsCache: ".concat(o),n.message)}}(),Array.isArray(gd.AREAS)&&gd.AREAS.length>0&&Ob(gd.AREAS,!0);const ai=function(o){const n=new kt,i=o,s={getListeners:n.getListeners.bind(n),on:(c,d)=>(c===gs.SECURITY_POLICY_VIOLATION&&Bh(d,!0),n.on.bind(n)(c,d)),addListener:n.addListener.bind(n),once:n.once.bind(n),off:n.off.bind(n),removeAllListeners:n.removeAllListeners.bind(n),emit:n.emit.bind(n),safeEmit:n.safeEmit.bind(n)};return vT(vT({},i),s)}({__TRACK_LIST__:rl,VERSION:vo,BUILD:mr,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:(o,n,i)=>{I.debug("setParameter key:".concat(o,", value:").concat(JSON.stringify(n))),Nt(o,n,i)},getParameter:B,getSupportedCodec:function(){var o=x(function*(){let n={audio:[],video:[]};try{let i=new RTCPeerConnection;i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const s=(yield i.createOffer()).sdp;if(!s)return n;i.close(),i=null,n=function(c){const d={video:[],audio:[]};return c.match(/ VP8/i)&&d.video.push("VP8"),c.match(/ VP9/i)&&d.video.push("VP9"),c.match(/ AV1/i)&&d.video.push("AV1"),c.match(/ H264/i)&&d.video.push("H264"),c.match(/ H265/i)&&d.video.push("H265"),c.match(/ opus/i)&&d.audio.push("OPUS"),c.match(/ PCMU/i)&&d.audio.push("PCMU"),c.match(/ PCMA/i)&&d.audio.push("PCMA"),c.match(/ G722/i)&&d.audio.push("G722"),d}(s)}catch(i){throw new W(M.CREATE_OFFER_FAILED,i.toString&&i.toString()).print()}return n});return function(){return o.apply(this,arguments)}}(),checkSystemRequirements:function(){const o=ye.reportApiInvoke(null,{name:Rn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Je.TRACER});let n=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,p=window.WebSocket;n=!!(d&&h&&p)}catch(d){return I.error("check system requirement failed: ",d),!1}let i=!1;const s=Et();s.name===gt.CHROME&&Number(s.version)>=58&&(!function Xk(){return"WebKit"===Ca.engine.name}()||function $k(){const o=Et();if(Og()){if(o.os===ii.MAC_OS)return!0;if(o.os===ii.IOS){const n=Ca.os.version&&Ca.os.version.split(".");if(n&&14===Number(n[0])&&n[1]&&Number(n[1])>=3||n&&Number(n[0])>14)return!0}}return!1}())&&(i=!0),s.name===gt.FIREFOX&&Number(s.version)>=56&&(i=!0),s.name===gt.OPERA&&Number(s.version)>=45&&(i=!0),s.name===gt.SAFARI&&Number(s.version)>=11&&(i=!0),(ZS()||Et().name===gt.QQ)&&(i=!0),I.debug("checkSystemRequirements, api:",n,"browser",i);const c=n&&i;return o.onSuccess(c),c},getDevices:function(o){return ao.enumerateDevices(!0,!0,o)},getMicrophones:function(o){return ao.getRecordingDevices(o)},getCameras:function(o){return ao.getCamerasDevices(o)},getElectronScreenSources:rn,getPlaybackDevices:function(o){return ao.getSpeakers(o)},createClient:function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=ye.reportApiInvoke(null,{name:Rn.CREATE_CLIENT,options:[o],tag:Je.TRACER});try{Vn((i=o).codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Vn(i.mode,"config.mode",["rtc","live"]),void 0!==i.audioCodec&&Vn(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==i.proxyServer&&bi(i.proxyServer,"config.proxyServer",1,1e4),void 0!==i.turnServer&&Kw(i.turnServer),void 0!==i.httpRetryConfig&&tC(i.httpRetryConfig),void 0!==i.websocketRetryConfig&&tC(i.websocketRetryConfig)}catch(i){throw n.onError(i),i}var i;return void 0===o.audioCodec&&(o.audioCodec="opus"),n.onSuccess(),new Lt(Cm(Cm({forceWaitGatewayResponse:!0},o),{},{role:"rtc"===o.mode?"host":o.role||"audience"}))},createCameraVideoTrack:function(){var o=x(function*(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=ye.reportApiInvoke(null,{tag:Je.TRACER,name:Rn.CREATE_CAM_VIDEO_TRACK,options:[Dd({},n)]}),s=QC(n),c=Ot(8,"track-cam-");let d=null;I.info("start create camera video track with config",JSON.stringify(n),"trackId",c);try{d=(yield bo({video:s},c)).getVideoTracks()[0]||null}catch(p){throw i.onError(p),p}if(!d){const p=new Q(M.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(p),p.throw(I)}n.optimizationMode&&qo(c,d,n,wa(n.encoderConfig));const h=new Qs(d,n,s,n.scalabiltyMode?ph(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,c);return i.onSuccess(h.getTrackId()),I.info("create camera video success, trackId:",c),h});return function(){return o.apply(this,arguments)}}(),createCustomVideoTrack:function(o){const n=ye.reportApiInvoke(null,{tag:Je.TRACER,name:Rn.CREATE_CUSTOM_VIDEO_TRACK,options:[o]}),i=new We(o.mediaStreamTrack,{width:o.width,height:o.height,frameRate:o.frameRate,bitrateMax:o.bitrateMax,bitrateMin:o.bitrateMin},o.scalabiltyMode?ph(o.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},o.optimizationMode,Ot(8,"track-cus-"),[qt.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),I.info("create custom video track success with config",o,"trackId",i.getTrackId()),i},createScreenVideoTrack:function(){var o=x(function*(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const s=ye.reportApiInvoke(null,{tag:Je.TRACER,name:Rn.CREATE_SCREEN_VIDEO_TRACK,options:[Dd({},n),i]});n.encoderConfig?"string"==typeof n.encoderConfig||n.encoderConfig.width&&n.encoderConfig.height||(n.encoderConfig.width={max:1920},n.encoderConfig.height={max:1080}):n.encoderConfig="1080p_2";const c=function(y){const S={};y.screenSourceType&&(S.mediaSource=y.screenSourceType),y.extensionId&&XS()&&(S.extensionId=y.extensionId);const{displaySurface:T,selfBrowserSurface:O,surfaceSwitching:N,systemAudio:w}=y;(JS(107)||Vw(107)||Bw(93))&&(T&&(Vn(T,"displaySurface",["browser","window","monitor"]),S.displaySurface=T),O?(Vn(O,"selfBrowserSurface",["exclude","include"]),S.selfBrowserSurface=O):S.selfBrowserSurface="include",N&&(Vn(N,"surfaceSwitching",["exclude","include"]),S.surfaceSwitching=N)),(JS(105)||Vw(105)||Bw(91))&&w&&(Vn(w,"systemAudio",["exclude","include"]),S.systemAudio=w),y.electronScreenSourceId&&(S.sourceId=y.electronScreenSourceId);const k=y.encoderConfig?Af(y.encoderConfig):null;return S.mandatory={chromeMediaSource:"desktop",maxWidth:k?k.width:void 0,maxHeight:k?k.height:void 0},k&&(k.frameRate&&("number"==typeof k.frameRate?(S.mandatory.maxFrameRate=k.frameRate,S.mandatory.minFrameRate=k.frameRate):(S.mandatory.maxFrameRate=k.frameRate.max||k.frameRate.ideal||k.frameRate.exact||void 0,S.mandatory.minFrameRate=k.frameRate.min||k.frameRate.ideal||k.frameRate.exact||void 0),S.frameRate=k.frameRate),k.width&&(S.width=k.width),k.height&&(S.height=k.height)),S}(n),d=Ot(8,"track-scr-v-");let h=null,p=null;const m=Ut();if(!m.supportShareAudio&&"enable"===i){const y=new Q(M.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return s.onError(y),y.throw(I)}I.info("start create screen video track with config",n,"withAudio",i,"trackId",d);try{const y=yield bo({screen:c,screenAudio:"auto"===i?m.supportShareAudio:"enable"===i},d);h=y.getVideoTracks()[0]||null,p=y.getAudioTracks()[0]||null}catch(y){throw s.onError(y),y}if(!h){const y=new Q(M.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(y),y.throw(I)}if(!p&&"enable"===i){h&&h.stop();const y=new Q(M.SHARE_AUDIO_NOT_ALLOWED);return s.onError(y),y.throw(I)}n.optimizationMode||(n.optimizationMode="detail"),n.optimizationMode&&(qo(d,h,n,n.encoderConfig&&Af(n.encoderConfig)||void 0),n.encoderConfig&&"string"!=typeof n.encoderConfig&&(n.encoderConfig.bitrateMin=n.encoderConfig.bitrateMax));const _=new We(h,n.encoderConfig?Af(n.encoderConfig):{},n.scalabiltyMode?ph(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,d,[qt.SCREEN_TRACK]);if(!p)return s.onSuccess(_.getTrackId()),I.info("create screen video track success","video:",_.getTrackId()),_;const E=new ct(p,void 0,Ot(8,"track-scr-a-"),!1,!0);return s.onSuccess([_.getTrackId(),E.getTrackId()]),I.info("create screen video track success","video:",_.getTrackId(),"audio:",E.getTrackId()),[_,E]});return function(){return o.apply(this,arguments)}}(),createMicrophoneAndCameraTracks:function(){var o=x(function*(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=ye.reportApiInvoke(null,{tag:Je.TRACER,name:Rn.CREATE_MIC_AND_CAM_TRACKS,options:[n,i]}),c=QC(i),d=Q1(n),h=Ot(8,"track-mic-"),p=Ot(8,"track-cam-");let m=null,_=null;I.info("start create camera video track(".concat(p,") and microphone audio track(").concat(h,") with config, audio: ").concat(JSON.stringify(n),", video: ").concat(JSON.stringify(i)));try{const S=yield bo({audio:d,video:c},"".concat(h,"-").concat(p));m=S.getAudioTracks()[0],_=S.getVideoTracks()[0]}catch(S){throw s.onError(S),S}if(!m||!_){const S=new Q(M.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(S),S.throw(I)}i.optimizationMode&&qo(p,_,i,wa(i.encoderConfig));const E=new Qi(m,n,d,h),y=new Qs(_,i,c,i.scalabiltyMode?ph(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,p);return s.onSuccess([E.getTrackId(),y.getTrackId()]),I.info("create camera video track(".concat(p,") and microphone audio track(").concat(h,") success")),[E,y]});return function(){return o.apply(this,arguments)}}(),createMicrophoneAudioTrack:function(){var o=x(function*(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=ye.reportApiInvoke(null,{tag:Je.TRACER,name:Rn.CREATE_MIC_AUDIO_TRACK,options:[n]}),s=Q1(n),c=Ot(8,"track-mic-");let d=null;I.info("start create microphone audio track with config",JSON.stringify(n),"trackId",c);try{d=(yield bo({audio:s},c)).getAudioTracks()[0]||null}catch(p){throw i.onError(p),p}if(!d){const p=new Q(M.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(p),p.throw(I)}const h=new Qi(d,n,s,c);return i.onSuccess(h.getTrackId()),I.info("create microphone audio track success, trackId:",c),h});return function(){return o.apply(this,arguments)}}(),createCustomAudioTrack:function(o){const n=ye.reportApiInvoke(null,{tag:Je.TRACER,name:Rn.CREATE_CUSTOM_AUDIO_TRACK,options:[o]}),i=new ct(o.mediaStreamTrack,o.encoderConfig?fh(o.encoderConfig):{},Ot(8,"track-cus-"),!1,!0);return I.info("create custom audio track success with config",o,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:function(){var o=x(function*(n){var i;const{cacheOnlineFile:s,encoderConfig:c}=n;let{source:d}=n;const h={source:d instanceof AudioBuffer?"AudioBuffer":d instanceof File?null!==(i=File.name)&&void 0!==i?i:"File":d,cacheOnlineFile:s,encoderConfig:c},p=ye.reportApiInvoke(null,{tag:Je.TRACER,name:Rn.CREATE_BUFFER_AUDIO_TRACK,options:[h]});if(B("DISABLE_WEBAUDIO"))throw new Q(M.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const m=Ot(8,"track-buf-");I.info("start create buffer source audio track with config",JSON.stringify(h),"trackId",m);const _=d;if(!(d instanceof AudioBuffer))try{d=yield function pD(o,n){return ZC.apply(this,arguments)}(d,s)}catch(S){return p.onError(S),S.throw(I)}const E=new Z1(d),y=new Oa(_,E,c?fh(c):{},m);return I.info("create buffer source audio track success, trackId:",m),p.onSuccess(y.getTrackId()),y});return function(i){return o.apply(this,arguments)}}(),setAppType:function(o){if(I.debug("setAppType: ".concat(o)),!(Number.isInteger(o)&&o>=0))throw I.debug("Invalid appType"),new W(M.INVALID_PARAMS,"invalid app type",o);Nt("APP_TYPE",Math.floor(o))},setLogLevel:function(o){I.setLogLevel(o)},enableLogUpload:function(){B("USE_NEW_LOG")?Nt("UPLOAD_LOG",!0):I.enableLogUpload()},disableLogUpload:function(){B("USE_NEW_LOG")?Nt("UPLOAD_LOG",!1):I.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new jE},checkAudioTrackIsActive:function(){var o=x(function*(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const s=ye.reportApiInvoke(null,{tag:Je.TRACER,name:Rn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[i]});if(!(n instanceof ct||n instanceof ys)){const _=new W(M.INVALID_TRACK,"the parameter is not a audio track");return s.onError(_),_.throw()}i&&i<1e3&&(i=1e3);const c=n instanceof ct?n.getTrackLabel():"remote_track",d=n.getVolumeLevel();let h=d,p=d;const m=Date.now();return new z(_=>{const E=setInterval(()=>{const y=n.getVolumeLevel();h=y>h?y:h,p=y<p?y:p;const S=h-p>1e-4,T=Date.now()-m;if(S||T>i){clearInterval(E);const O=S,N={duration:T,deviceLabel:c,maxVolumeLevel:h,result:O};I.info("[track-".concat(n.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(N))),s.onSuccess(N),_(O)}},200)})});return function(i){return o.apply(this,arguments)}}(),checkVideoTrackIsActive:function(){var o=x(function*(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const s=ye.reportApiInvoke(null,{tag:Je.TRACER,name:Rn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[i]});if(!(n instanceof We||n instanceof Jt)){const S=new W(M.INVALID_TRACK,"the parameter is not a video track");return s.onError(S),S.throw()}i&&i<1e3&&(i=1e3);const c=n instanceof We?n.getTrackLabel():"remote_track",d=n.getMediaStreamTrack(!0),h=document.createElement("video");h.style.width="1px",h.style.height="1px",h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.controls=!1,(nr()||Og())&&(h.style.opacity="0.01",h.style.position="fixed",h.style.left="0",h.style.top="0",document.body.appendChild(h)),h.srcObject=new MediaStream([d]),h.play();const p=document.createElement("canvas");p.width=160,p.height=120;let m=0,_=0;try{const S=Date.now();m=yield function(T,O,N,w){let k,V=0,U=null;return new z((Y,re)=>{setTimeout(()=>{k&&(k(),Y(V))},O),k=oD(()=>{!function K(){V>4&&k&&(k(),Y(V));const $=N.getContext("2d");if(!$){const Ee=new W(M.UNEXPECTED_ERROR,"can not get canvas 2d context.");return I.error(Ee.toString()),void re(Ee)}$.drawImage(T,0,0,160,120);const X=$.getImageData(0,0,N.width,N.height),J=Math.floor(X.data.length/3);if(U){for(let Ee=0;Ee<J;Ee+=3)if(X.data[Ee]!==U[Ee])return V+=1,void(U=X.data);U=X.data}else U=X.data}()},30)})}(h,i,p),_=Date.now()-S}catch(S){throw s.onError(S),S}kx===gt.SAFARI&&(h.pause(),h.remove()),h.srcObject=null;const E=m>4,y={duration:_,changedPicNum:m,deviceLabel:c,result:E};return I.info("[track-".concat(n.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(y))),s.onSuccess(y),E});return function(i){return o.apply(this,arguments)}}(),setArea:Ob,audioElementPlayCenter:on,processExternalMediaAEC:function(o){EV.processExternalMediaAEC(o)},registerExtensions:function(o){o.forEach(n=>{const i=n;i.__registered__=!0,i.logger.hookLog=I.extLog,i.reporter.hookApiInvoke=ye.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(s=>{i.parameters[s]=B(s)})})},ChannelMediaRelayError:il,ChannelMediaRelayEvent:Ia,ChannelMediaRelayState:$n,RemoteStreamFallbackType:uE,RemoteStreamType:jC,ConnectionDisconnectedReason:Ke,AudienceLatencyLevelType:zw,AREAS:at});return Object.defineProperties(ai,{onAudioAutoplayFailed:{get:()=>_r.onAudioAutoplayFailed,set:o=>{_r.onAudioAutoplayFailed=o}},onAutoplayFailed:{get:()=>_r.onAutoplayFailed,set:o=>{_r.onAutoplayFailed=o}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>ai._onSecurityPolicyViolation,set(o){ai._onSecurityPolicyViolation=o,Bh(o)}},__CLIENT_LIST__:{get:()=>B("SHOW_GLOBAL_CLIENT_LIST")?Ed:[]}}),ao.on(zo.CAMERA_DEVICE_CHANGED,o=>{I.info("camera device changed",JSON.stringify(o)),ai.onCameraChanged&&ai.onCameraChanged(o),ai.safeEmit(gs.CAMERA_CHANGED,o)}),ao.on(zo.RECORDING_DEVICE_CHANGED,o=>{I.info("microphone device changed",JSON.stringify(o)),ai.onMicrophoneChanged&&ai.onMicrophoneChanged(o),ai.safeEmit(gs.MICROPHONE_CHANGED,o)}),ao.on(zo.PLAYOUT_DEVICE_CHANGED,o=>{I.debug("playout device changed",JSON.stringify(o)),ai.onPlaybackDeviceChanged&&ai.onPlaybackDeviceChanged(o),ai.safeEmit(gs.PLAYBACK_DEVICE_CHANGED,o)}),on.onAutoplayFailed=()=>{I.info("detect audio element autoplay failed"),_r.onAudioAutoplayFailed&&_r.onAudioAutoplayFailed()},Dt.on("autoplay-failed",()=>{I.info("detect webaudio autoplay failed"),_r.onAudioAutoplayFailed&&_r.onAudioAutoplayFailed(),ai.safeEmit(gs.AUTOPLAY_FAILED)}),Bn.on(ba.NETWORK_STATE_CHANGE,(o,n)=>{I.info("[network-indicator] network state changed, ".concat(n," => ").concat(o))}),window&&(window.__ARTC__=ai),ai}()},156:xc=>{function xm(x,Fc,Zi,is,rs,ur,Ka){try{var iu=x[ur](Ka),os=iu.value}catch(Cn){return void Zi(Cn)}iu.done?Fc(os):Promise.resolve(os).then(is,rs)}xc.exports=function Fm(x){return function(){var Fc=this,Zi=arguments;return new Promise(function(is,rs){var ur=x.apply(Fc,Zi);function Ka(os){xm(ur,is,rs,Ka,iu,"next",os)}function iu(os){xm(ur,is,rs,Ka,iu,"throw",os)}Ka(void 0)})}},xc.exports.__esModule=!0,xc.exports.default=xc.exports}},xc=>{xc(xc.s=149)}]);