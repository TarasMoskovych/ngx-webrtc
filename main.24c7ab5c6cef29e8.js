"use strict";(self.webpackChunkngx_webrtc=self.webpackChunkngx_webrtc||[]).push([[792],{829:()=>{function Hp(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(l){return void n(l)}a.done?t(c):Promise.resolve(c).then(i,r)}function C(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){var o=e.apply(t,n);function s(c){Hp(o,i,r,s,a,"next",c)}function a(c){Hp(o,i,r,s,a,"throw",c)}s(void 0)})}}let ci=null,R_=1;const Ol=Symbol("SIGNAL");function ut(e){const t=ci;return ci=e,t}function s1(e){if((!Wp(e)||e.dirty)&&(e.dirty||e.lastCleanEpoch!==R_)){if(!e.producerMustRecompute(e)&&!AC(e))return e.dirty=!1,void(e.lastCleanEpoch=R_);e.producerRecomputeValue(e),e.dirty=!1,e.lastCleanEpoch=R_}}function AC(e){qd(e);for(let t=0;t<e.producerNode.length;t++){const n=e.producerNode[t],i=e.producerLastReadVersion[t];if(i!==n.version||(s1(n),i!==n.version))return!0}return!1}function A_(e,t){if(function f1(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}(e),qd(e),1===e.liveConsumerNode.length)for(let i=0;i<e.producerNode.length;i++)A_(e.producerNode[i],e.producerIndexOfThis[i]);const n=e.liveConsumerNode.length-1;if(e.liveConsumerNode[t]=e.liveConsumerNode[n],e.liveConsumerIndexOfThis[t]=e.liveConsumerIndexOfThis[n],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,t<e.liveConsumerNode.length){const i=e.liveConsumerIndexOfThis[t],r=e.liveConsumerNode[t];qd(r),r.producerIndexOfThis[i]=t}}function Wp(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function qd(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}let m1=null;function Ft(e){return"function"==typeof e}function NC(e){const n=e(i=>{Error.call(i),i.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const PC=NC(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function D_(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class li{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const o of n)o.remove(this);else n.remove(this);const{initialTeardown:i}=this;if(Ft(i))try{i()}catch(o){t=o instanceof PC?o.errors:[o]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const o of r)try{E1(o)}catch(s){t=t??[],s instanceof PC?t=[...t,...s.errors]:t.push(s)}}if(t)throw new PC(t)}}add(t){var n;if(t&&t!==this)if(this.closed)E1(t);else{if(t instanceof li){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&D_(n,t)}remove(t){const{_finalizers:n}=this;n&&D_(n,t),t instanceof li&&t._removeParent(this)}}li.EMPTY=(()=>{const e=new li;return e.closed=!0,e})();const _1=li.EMPTY;function v1(e){return e instanceof li||e&&"closed"in e&&Ft(e.remove)&&Ft(e.add)&&Ft(e.unsubscribe)}function E1(e){Ft(e)?e():e.unsubscribe()}const Nl={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},O_={setTimeout(e,t,...n){const{delegate:i}=O_;return i?.setTimeout?i.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=O_;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function b1(e){O_.setTimeout(()=>{const{onUnhandledError:t}=Nl;if(!t)throw e;t(e)})}function N_(){}const AJ=MC("C",void 0,void 0);function MC(e,t,n){return{kind:e,value:t,error:n}}let Pl=null;function P_(e){if(Nl.useDeprecatedSynchronousErrorHandling){const t=!Pl;if(t&&(Pl={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:i}=Pl;if(Pl=null,n)throw i}}else e()}class xC extends li{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,v1(t)&&t.add(this)):this.destination=kJ}static create(t,n,i){return new zp(t,n,i)}next(t){this.isStopped?LC(function OJ(e){return MC("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?LC(function DJ(e){return MC("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?LC(AJ,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const PJ=Function.prototype.bind;function kC(e,t){return PJ.call(e,t)}class MJ{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(i){M_(i)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(i){M_(i)}else M_(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){M_(n)}}}class zp extends xC{constructor(t,n,i){let r;if(super(),Ft(t)||!t)r={next:t??void 0,error:n??void 0,complete:i??void 0};else{let o;this&&Nl.useDeprecatedNextContext?(o=Object.create(t),o.unsubscribe=()=>this.unsubscribe(),r={next:t.next&&kC(t.next,o),error:t.error&&kC(t.error,o),complete:t.complete&&kC(t.complete,o)}):r=t}this.destination=new MJ(r)}}function M_(e){Nl.useDeprecatedSynchronousErrorHandling?function NJ(e){Nl.useDeprecatedSynchronousErrorHandling&&Pl&&(Pl.errorThrown=!0,Pl.error=e)}(e):b1(e)}function LC(e,t){const{onStoppedNotification:n}=Nl;n&&O_.setTimeout(()=>n(e,t))}const kJ={closed:!0,next:N_,error:function xJ(e){throw e},complete:N_},FC="function"==typeof Symbol&&Symbol.observable||"@@observable";function Sc(e){return e}function y1(e){return 0===e.length?Sc:1===e.length?e[0]:function(n){return e.reduce((i,r)=>r(i),n)}}let Gn=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const i=new e;return i.source=this,i.operator=n,i}subscribe(n,i,r){const o=function UJ(e){return e&&e instanceof xC||function FJ(e){return e&&Ft(e.next)&&Ft(e.error)&&Ft(e.complete)}(e)&&v1(e)}(n)?n:new zp(n,i,r);return P_(()=>{const{operator:s,source:a}=this;o.add(s?s.call(o,a):a?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(n){try{return this._subscribe(n)}catch(i){n.error(i)}}forEach(n,i){return new(i=S1(i))((r,o)=>{const s=new zp({next:a=>{try{n(a)}catch(c){o(c),s.unsubscribe()}},error:o,complete:r});this.subscribe(s)})}_subscribe(n){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(n)}[FC](){return this}pipe(...n){return y1(n)(this)}toPromise(n){return new(n=S1(n))((i,r)=>{let o;this.subscribe(s=>o=s,s=>r(s),()=>i(o))})}}return e.create=t=>new e(t),e})();function S1(e){var t;return null!==(t=e??Nl.Promise)&&void 0!==t?t:Promise}const VJ=NC(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let vt=(()=>{class e extends Gn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const i=new C1(this,this);return i.operator=n,i}_throwIfClosed(){if(this.closed)throw new VJ}next(n){P_(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(n)}})}error(n){P_(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:i}=this;for(;i.length;)i.shift().error(n)}})}complete(){P_(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:i,isStopped:r,observers:o}=this;return i||r?_1:(this.currentObservers=null,o.push(n),new li(()=>{this.currentObservers=null,D_(o,n)}))}_checkFinalizedStatuses(n){const{hasError:i,thrownError:r,isStopped:o}=this;i?n.error(r):o&&n.complete()}asObservable(){const n=new Gn;return n.source=this,n}}return e.create=(t,n)=>new C1(t,n),e})();class C1 extends vt{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===i||i.call(n,t)}error(t){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===i||i.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,i;return null!==(i=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==i?i:_1}}class Sr extends vt{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:i}=this;if(t)throw n;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}function T1(e){return Ft(e?.lift)}function Jn(e){return t=>{if(T1(t))return t.lift(function(n){try{return e(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Un(e,t,n,i,r){return new BJ(e,t,n,i,r)}class BJ extends xC{constructor(t,n,i,r,o,s){super(t),this.onFinalize=o,this.shouldUnsubscribe=s,this._next=n?function(a){try{n(a)}catch(c){t.error(c)}}:super._next,this._error=r?function(a){try{r(a)}catch(c){t.error(c)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(a){t.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function Nt(e,t){return Jn((n,i)=>{let r=0;n.subscribe(Un(i,o=>{i.next(e.call(t,o,r++))}))})}const w1="https://g.co/ng/security#xss";class W extends Error{constructor(t,n){super(function Yd(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,n)),this.code=t}}function Va(e){return{toString:e}.toString()}const Xd="__parameters__";function Jd(e,t,n){return Va(()=>{const i=function UC(e){return function(...n){if(e){const i=e(...n);for(const r in i)this[r]=i[r]}}}(t);function r(...o){if(this instanceof r)return i.apply(this,o),this;const s=new r(...o);return a.annotation=s,a;function a(c,l,d){const u=c.hasOwnProperty(Xd)?c[Xd]:Object.defineProperty(c,Xd,{value:[]})[Xd];for(;u.length<=d;)u.push(null);return(u[d]=u[d]||[]).push(s),c}}return n&&(r.prototype=Object.create(n.prototype)),r.prototype.ngMetadataName=e,r.annotationCls=r,r})}const Zt=globalThis;function rn(e){for(let t in e)if(e[t]===rn)return t;throw Error("Could not find renamed property on target object.")}function jJ(e,t){for(const n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function Ai(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Ai).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function VC(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const HJ=rn({__forward_ref__:rn});function pn(e){return e.__forward_ref__=pn,e.toString=function(){return Ai(this())},e}function Ve(e){return k_(e)?e():e}function k_(e){return"function"==typeof e&&e.hasOwnProperty(HJ)&&e.__forward_ref__===pn}function ae(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function In(e){return{providers:e.providers||[],imports:e.imports||[]}}function L_(e){return D1(e,U_)||D1(e,O1)}function D1(e,t){return e.hasOwnProperty(t)?e[t]:null}function F_(e){return e&&(e.hasOwnProperty(BC)||e.hasOwnProperty(YJ))?e[BC]:null}const U_=rn({\u0275prov:rn}),BC=rn({\u0275inj:rn}),O1=rn({ngInjectableDef:rn}),YJ=rn({ngInjectorDef:rn});class re{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=ae({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function zC(e){return e&&!!e.\u0275providers}const Kp=rn({\u0275cmp:rn}),KC=rn({\u0275dir:rn}),qC=rn({\u0275pipe:rn}),P1=rn({\u0275mod:rn}),Ba=rn({\u0275fac:rn}),qp=rn({__NG_ELEMENT_ID__:rn}),M1=rn({__NG_ENV_ID__:rn});function Ke(e){return"string"==typeof e?e:null==e?"":String(e)}function YC(e,t){throw new W(-201,!1)}var bt=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(bt||{});let $C;function x1(){return $C}function Vr(e){const t=$C;return $C=e,t}function k1(e,t,n){const i=L_(e);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:n&bt.Optional?null:void 0!==t?t:void YC()}const Yp={},XC="__NG_DI_FLAG__",V_="ngTempTokenPath",eQ=/\n/gm,L1="__source";let Qd;function Tc(e){const t=Qd;return Qd=e,t}function iQ(e,t=bt.Default){if(void 0===Qd)throw new W(-203,!1);return null===Qd?k1(e,void 0,t):Qd.get(e,t&bt.Optional?null:void 0,t)}function Z(e,t=bt.Default){return(x1()||iQ)(Ve(e),t)}function J(e,t=bt.Default){return Z(e,B_(t))}function B_(e){return typeof e>"u"||"number"==typeof e?e:(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function ZC(e){const t=[];for(let n=0;n<e.length;n++){const i=Ve(e[n]);if(Array.isArray(i)){if(0===i.length)throw new W(900,!1);let r,o=bt.Default;for(let s=0;s<i.length;s++){const a=i[s],c=rQ(a);"number"==typeof c?-1===c?r=a.token:o|=c:r=a}t.push(Z(r,o))}else t.push(Z(i))}return t}function $p(e,t){return e[XC]=t,e.prototype[XC]=t,e}function rQ(e){return e[XC]}const j_=$p(Jd("Optional"),8),H_=$p(Jd("SkipSelf"),4);function Ml(e,t){return e.hasOwnProperty(Ba)?e[Ba]:null}function eu(e,t){e.forEach(n=>Array.isArray(n)?eu(n,t):t(n))}function U1(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function G_(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function ho(e,t,n){let i=tu(e,t);return i>=0?e[1|i]=n:(i=~i,function V1(e,t,n,i){let r=e.length;if(r==t)e.push(n,i);else if(1===r)e.push(i,e[0]),e[0]=n;else{for(r--,e.push(e[r-1],e[r]);r>t;)e[r]=e[r-2],r--;e[t]=n,e[t+1]=i}}(e,i,t,n)),i}function QC(e,t){const n=tu(e,t);if(n>=0)return e[1|n]}function tu(e,t){return function B1(e,t,n){let i=0,r=e.length>>n;for(;r!==i;){const o=i+(r-i>>1),s=e[o<<n];if(t===s)return o<<n;s>t?r=o:i=o+1}return~(r<<n)}(e,t,1)}const zs={},Pt=[],xl=new re(""),j1=new re("",-1),eT=new re("");class z_{get(t,n=Yp){if(n===Yp){const i=new Error(`NullInjectorError: No provider for ${Ai(t)}!`);throw i.name="NullInjectorError",i}return n}}var K_=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(K_||{}),fs=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(fs||{}),we=function(e){return e[e.None=0]="None",e[e.SignalBased=1]="SignalBased",e[e.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",e}(we||{});function uQ(e,t,n){let i=e.length;for(;;){const r=e.indexOf(t,n);if(-1===r)return r;if(0===r||e.charCodeAt(r-1)<=32){const o=t.length;if(r+o===i||e.charCodeAt(r+o)<=32)return r}n=r+1}}function tT(e,t,n){let i=0;for(;i<n.length;){const r=n[i];if("number"==typeof r){if(0!==r)break;i++;const o=n[i++],s=n[i++],a=n[i++];e.setAttribute(t,s,a,o)}else{const o=r,s=n[++i];G1(o)?e.setProperty(t,o,s):e.setAttribute(t,o,s),i++}}return i}function H1(e){return 3===e||4===e||6===e}function G1(e){return 64===e.charCodeAt(0)}function Xp(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let i=0;i<t.length;i++){const r=t[i];"number"==typeof r?n=r:0===n||W1(e,n,r,null,-1===n||2===n?t[++i]:null)}}return e}function W1(e,t,n,i,r){let o=0,s=e.length;if(-1===t)s=-1;else for(;o<e.length;){const a=e[o++];if("number"==typeof a){if(a===t){s=-1;break}if(a>t){s=o-1;break}}}for(;o<e.length;){const a=e[o];if("number"==typeof a)break;if(a===n){if(null===i)return void(null!==r&&(e[o+1]=r));if(i===e[o+1])return void(e[o+2]=r)}o++,null!==i&&o++,null!==r&&o++}-1!==s&&(e.splice(s,0,t),o=s+1),e.splice(o++,0,n),null!==i&&e.splice(o++,0,i),null!==r&&e.splice(o++,0,r)}const z1="ng-template";function hQ(e,t,n,i){let r=0;if(i){for(;r<t.length&&"string"==typeof t[r];r+=2)if("class"===t[r]&&-1!==uQ(t[r+1].toLowerCase(),n,0))return!0}else if(nT(e))return!1;if(r=t.indexOf(1,r),r>-1){let o;for(;++r<t.length&&"string"==typeof(o=t[r]);)if(o.toLowerCase()===n)return!0}return!1}function nT(e){return 4===e.type&&e.value!==z1}function pQ(e,t,n){return t===(4!==e.type||n?e.value:z1)}function fQ(e,t,n){let i=4;const r=e.attrs,o=null!==r?function _Q(e){for(let t=0;t<e.length;t++)if(H1(e[t]))return t;return e.length}(r):0;let s=!1;for(let a=0;a<t.length;a++){const c=t[a];if("number"!=typeof c){if(!s)if(4&i){if(i=2|1&i,""!==c&&!pQ(e,c,n)||""===c&&1===t.length){if(ms(i))return!1;s=!0}}else if(8&i){if(null===r||!hQ(e,r,c,n)){if(ms(i))return!1;s=!0}}else{const l=t[++a],d=mQ(c,r,nT(e),n);if(-1===d){if(ms(i))return!1;s=!0;continue}if(""!==l){let u;if(u=d>o?"":r[d+1].toLowerCase(),2&i&&l!==u){if(ms(i))return!1;s=!0}}}}else{if(!s&&!ms(i)&&!ms(c))return!1;if(s&&ms(c))continue;s=!1,i=c|1&i}}return ms(i)||s}function ms(e){return!(1&e)}function mQ(e,t,n,i){if(null===t)return-1;let r=0;if(i||!n){let o=!1;for(;r<t.length;){const s=t[r];if(s===e)return r;if(3===s||6===s)o=!0;else{if(1===s||2===s){let a=t[++r];for(;"string"==typeof a;)a=t[++r];continue}if(4===s)break;if(0===s){r+=4;continue}}r+=o?1:2}return-1}return function vQ(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const i=e[n];if("number"==typeof i)return-1;if(i===t)return n;n++}return-1}(t,e)}function K1(e,t,n=!1){for(let i=0;i<t.length;i++)if(fQ(e,t[i],n))return!0;return!1}function EQ(e,t){e:for(let n=0;n<t.length;n++){const i=t[n];if(e.length===i.length){for(let r=0;r<e.length;r++)if(e[r]!==i[r])continue e;return!0}}return!1}function q1(e,t){return e?":not("+t.trim()+")":t}function bQ(e){let t=e[0],n=1,i=2,r="",o=!1;for(;n<e.length;){let s=e[n];if("string"==typeof s)if(2&i){const a=e[++n];r+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else 8&i?r+="."+s:4&i&&(r+=" "+s);else""!==r&&!ms(s)&&(t+=q1(o,r),r=""),i=s,o=o||!ms(i);n++}return""!==r&&(t+=q1(o,r)),t}function sr(e){return Va(()=>{const t=$1(e),n={...t,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===K_.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||fs.Emulated,styles:e.styles||Pt,_:null,schemas:e.schemas||null,tView:null,id:""};X1(n);const i=e.dependencies;return n.directiveDefs=q_(i,!1),n.pipeDefs=q_(i,!0),n.id=function IQ(e){let t=0;const n=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const r of n)t=Math.imul(31,t)+r.charCodeAt(0)|0;return t+=2147483648,"c"+t}(n),n})}function CQ(e){return mt(e)||Di(e)}function TQ(e){return null!==e}function xn(e){return Va(()=>({type:e.type,bootstrap:e.bootstrap||Pt,declarations:e.declarations||Pt,imports:e.imports||Pt,exports:e.exports||Pt,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function Y1(e,t){if(null==e)return zs;const n={};for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];let o,s,a=we.None;Array.isArray(r)?(a=r[0],o=r[1],s=r[2]??o):(o=r,s=r),t?(n[o]=a!==we.None?[i,a]:i,t[o]=s):n[o]=i}return n}function ye(e){return Va(()=>{const t=$1(e);return X1(t),t})}function jr(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function mt(e){return e[Kp]||null}function Di(e){return e[KC]||null}function er(e){return e[qC]||null}function ar(e,t){const n=e[P1]||null;if(!n&&!0===t)throw new Error(`Type ${Ai(e)} does not have '\u0275mod' property.`);return n}function $1(e){const t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputTransforms:null,inputConfig:e.inputs||zs,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||Pt,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Y1(e.inputs,t),outputs:Y1(e.outputs),debugInfo:null}}function X1(e){e.features?.forEach(t=>t(e))}function q_(e,t){if(!e)return null;const n=t?er:CQ;return()=>("function"==typeof e?e():e).map(i=>n(i)).filter(TQ)}function RQ(...e){return{\u0275providers:iT(0,e),\u0275fromNgModule:!0}}function iT(e,...t){const n=[],i=new Set;let r;const o=s=>{n.push(s)};return eu(t,s=>{const a=s;$_(a,o,[],i)&&(r||=[],r.push(a))}),void 0!==r&&Z1(r,o),n}function Z1(e,t){for(let n=0;n<e.length;n++){const{ngModule:i,providers:r}=e[n];rT(r,o=>{t(o,i)})}}function $_(e,t,n,i){if(!(e=Ve(e)))return!1;let r=null,o=F_(e);const s=!o&&mt(e);if(o||s){if(s&&!s.standalone)return!1;r=e}else{const c=e.ngModule;if(o=F_(c),!o)return!1;r=c}const a=i.has(r);if(s){if(a)return!1;if(i.add(r),s.dependencies){const c="function"==typeof s.dependencies?s.dependencies():s.dependencies;for(const l of c)$_(l,t,n,i)}}else{if(!o)return!1;{if(null!=o.imports&&!a){let l;i.add(r);try{eu(o.imports,d=>{$_(d,t,n,i)&&(l||=[],l.push(d))})}finally{}void 0!==l&&Z1(l,t)}if(!a){const l=Ml(r)||(()=>new r);t({provide:r,useFactory:l,deps:Pt},r),t({provide:eT,useValue:r,multi:!0},r),t({provide:xl,useValue:()=>Z(r),multi:!0},r)}const c=o.providers;if(null!=c&&!a){const l=e;rT(c,d=>{t(d,l)})}}}return r!==e&&void 0!==e.providers}function rT(e,t){for(let n of e)zC(n)&&(n=n.\u0275providers),Array.isArray(n)?rT(n,t):t(n)}const AQ=rn({provide:String,useValue:rn});function oT(e){return null!==e&&"object"==typeof e&&AQ in e}function kl(e){return"function"==typeof e}const sT=new re(""),X_={},OQ={};let aT;function Z_(){return void 0===aT&&(aT=new z_),aT}class Hr{}class nu extends Hr{get destroyed(){return this._destroyed}constructor(t,n,i,r){super(),this.parent=n,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,lT(t,s=>this.processProvider(s)),this.records.set(j1,iu(void 0,this)),r.has("environment")&&this.records.set(Hr,iu(void 0,this));const o=this.records.get(sT);null!=o&&"string"==typeof o.value&&this.scopes.add(o.value),this.injectorDefTypes=new Set(this.get(eT,Pt,bt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;const t=ut(null);try{for(const i of this._ngOnDestroyHooks)i.ngOnDestroy();const n=this._onDestroyHooks;this._onDestroyHooks=[];for(const i of n)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),ut(t)}}onDestroy(t){return this.assertNotDestroyed(),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){this.assertNotDestroyed();const n=Tc(this),i=Vr(void 0);try{return t()}finally{Tc(n),Vr(i)}}get(t,n=Yp,i=bt.Default){if(this.assertNotDestroyed(),t.hasOwnProperty(M1))return t[M1](this);i=B_(i);const o=Tc(this),s=Vr(void 0);try{if(!(i&bt.SkipSelf)){let c=this.records.get(t);if(void 0===c){const l=function kQ(e){return"function"==typeof e||"object"==typeof e&&e instanceof re}(t)&&L_(t);c=l&&this.injectableDefInScope(l)?iu(cT(t),X_):null,this.records.set(t,c)}if(null!=c)return this.hydrate(t,c)}return(i&bt.Self?Z_():this.parent).get(t,n=i&bt.Optional&&n===Yp?null:n)}catch(a){if("NullInjectorError"===a.name){if((a[V_]=a[V_]||[]).unshift(Ai(t)),o)throw a;return function oQ(e,t,n,i){const r=e[V_];throw t[L1]&&r.unshift(t[L1]),e.message=function sQ(e,t,n,i=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let r=Ai(t);if(Array.isArray(t))r=t.map(Ai).join(" -> ");else if("object"==typeof t){let o=[];for(let s in t)if(t.hasOwnProperty(s)){let a=t[s];o.push(s+":"+("string"==typeof a?JSON.stringify(a):Ai(a)))}r=`{${o.join(", ")}}`}return`${n}${i?"("+i+")":""}[${r}]: ${e.replace(eQ,"\n  ")}`}("\n"+e.message,r,n,i),e.ngTokenPath=r,e[V_]=null,e}(a,t,"R3InjectorError",this.source)}throw a}finally{Vr(s),Tc(o)}}resolveInjectorInitializers(){const t=ut(null),n=Tc(this),i=Vr(void 0);try{const o=this.get(xl,Pt,bt.Self);for(const s of o)s()}finally{Tc(n),Vr(i),ut(t)}}toString(){const t=[],n=this.records;for(const i of n.keys())t.push(Ai(i));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new W(205,!1)}processProvider(t){let n=kl(t=Ve(t))?t:Ve(t&&t.provide);const i=function PQ(e){return oT(e)?iu(void 0,e.useValue):iu(ex(e),X_)}(t);if(!kl(t)&&!0===t.multi){let r=this.records.get(n);r||(r=iu(void 0,X_,!0),r.factory=()=>ZC(r.multi),this.records.set(n,r)),n=t,r.multi.push(t)}this.records.set(n,i)}hydrate(t,n){const i=ut(null);try{return n.value===X_&&(n.value=OQ,n.value=n.factory()),"object"==typeof n.value&&n.value&&function xQ(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}finally{ut(i)}}injectableDefInScope(t){if(!t.providedIn)return!1;const n=Ve(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}removeOnDestroy(t){const n=this._onDestroyHooks.indexOf(t);-1!==n&&this._onDestroyHooks.splice(n,1)}}function cT(e){const t=L_(e),n=null!==t?t.factory:Ml(e);if(null!==n)return n;if(e instanceof re)throw new W(204,!1);if(e instanceof Function)return function NQ(e){if(e.length>0)throw new W(204,!1);const n=function qJ(e){return e&&(e[U_]||e[O1])||null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new W(204,!1)}function ex(e,t,n){let i;if(kl(e)){const r=Ve(e);return Ml(r)||cT(r)}if(oT(e))i=()=>Ve(e.useValue);else if(function Q1(e){return!(!e||!e.useFactory)}(e))i=()=>e.useFactory(...ZC(e.deps||[]));else if(function J1(e){return!(!e||!e.useExisting)}(e))i=()=>Z(Ve(e.useExisting));else{const r=Ve(e&&(e.useClass||e.provide));if(!function MQ(e){return!!e.deps}(e))return Ml(r)||cT(r);i=()=>new r(...ZC(e.deps))}return i}function iu(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function lT(e,t){for(const n of e)Array.isArray(n)?lT(n,t):n&&zC(n)?lT(n.\u0275providers,t):t(n)}function ja(e,t){e instanceof nu&&e.assertNotDestroyed();const i=Tc(e),r=Vr(void 0);try{return t()}finally{Tc(i),Vr(r)}}function tx(){return void 0!==x1()||null!=function nQ(){return Qd}()}const Vn=0,se=1,Se=2,di=3,gs=4,cr=5,po=6,ou=7,Rn=8,Ei=9,_s=10,je=11,Jp=12,ix=13,su=14,Wn=15,Qp=16,au=17,Ha=18,ef=19,rx=20,Ic=21,ev=22,Ll=23,qe=25,uT=1,Ks=7,cu=9,ui=10;var hT=function(e){return e[e.None=0]="None",e[e.HasTransplantedViews=2]="HasTransplantedViews",e}(hT||{});function lr(e){return Array.isArray(e)&&"object"==typeof e[uT]}function dr(e){return Array.isArray(e)&&!0===e[uT]}function pT(e){return!!(4&e.flags)}function Fl(e){return e.componentOffset>-1}function nv(e){return!(1&~e.flags)}function vs(e){return!!e.template}function fT(e){return!!(512&e[Se])}class YQ{constructor(t,n,i){this.previousValue=t,this.currentValue=n,this.firstChange=i}isFirstChange(){return this.firstChange}}function cx(e,t,n,i){null!==t?t.applyValueToInputSignal(t,i):e[n]=i}function Gr(){return lx}function lx(e){return e.type.prototype.ngOnChanges&&(e.setInput=XQ),$Q}function $Q(){const e=ux(this),t=e?.current;if(t){const n=e.previous;if(n===zs)e.previous=t;else for(let i in t)n[i]=t[i];e.current=null,this.ngOnChanges(t)}}function XQ(e,t,n,i,r){const o=this.declaredInputs[i],s=ux(e)||function ZQ(e,t){return e[dx]=t}(e,{previous:zs,current:null}),a=s.current||(s.current={}),c=s.previous,l=c[o];a[o]=new YQ(l&&l.currentValue,n,c===zs),cx(e,t,r,n)}Gr.ngInherit=!0;const dx="__ngSimpleChanges__";function ux(e){return e[dx]||null}const qs=function(e,t,n){},hx="svg";let fx=!1;function fn(e){for(;Array.isArray(e);)e=e[Vn];return e}function nf(e,t){return fn(t[e])}function Cr(e,t){return fn(t[e.index])}function rf(e,t){return e.data[t]}function lu(e,t){return e[t]}function fo(e,t){const n=t[e];return lr(n)?n:n[Vn]}function ET(e){return!(128&~e[Se])}function Ys(e,t){return null==t?null:e[t]}function mx(e){e[au]=0}function iee(e){1024&e[Se]||(e[Se]|=1024,ET(e)&&sf(e))}function bT(e){return!!(9216&e[Se]||e[Ll]?.dirty)}function yT(e){e[_s].changeDetectionScheduler?.notify(1),bT(e)?sf(e):64&e[Se]&&(function QQ(){return fx}()?(e[Se]|=1024,sf(e)):e[_s].changeDetectionScheduler?.notify())}function sf(e){e[_s].changeDetectionScheduler?.notify();let t=Ul(e);for(;null!==t&&!(8192&t[Se])&&(t[Se]|=8192,ET(t));)t=Ul(t)}function iv(e,t){if(!(256&~e[Se]))throw new W(911,!1);null===e[Ic]&&(e[Ic]=[]),e[Ic].push(t)}function Ul(e){const t=e[di];return dr(t)?t[di]:t}const He={lFrame:wx(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function vx(){return He.bindingsEnabled}function du(){return null!==He.skipHydrationRootTNode}function K(){return He.lFrame.lView}function yt(){return He.lFrame.tView}function Wr(e){return He.lFrame.contextLView=e,e[Rn]}function zr(e){return He.lFrame.contextLView=null,e}function on(){let e=Ex();for(;null!==e&&64===e.type;)e=e.parent;return e}function Ex(){return He.lFrame.currentTNode}function $s(e,t){const n=He.lFrame;n.currentTNode=e,n.isParent=t}function CT(){return He.lFrame.isParent}function TT(){He.lFrame.isParent=!1}function Tr(){const e=He.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function Es(){return He.lFrame.bindingIndex++}function Wa(e){const t=He.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}function fee(e,t){const n=He.lFrame;n.bindingIndex=n.bindingRootIndex=e,wT(t)}function wT(e){He.lFrame.currentDirectiveIndex=e}function RT(){return He.lFrame.currentQueryIndex}function rv(e){He.lFrame.currentQueryIndex=e}function gee(e){const t=e[se];return 2===t.type?t.declTNode:1===t.type?e[cr]:null}function Cx(e,t,n){if(n&bt.SkipSelf){let r=t,o=e;for(;!(r=r.parent,null!==r||n&bt.Host||(r=gee(o),null===r||(o=o[su],10&r.type))););if(null===r)return!1;t=r,e=o}const i=He.lFrame=Tx();return i.currentTNode=t,i.lView=e,!0}function AT(e){const t=Tx(),n=e[se];He.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function Tx(){const e=He.lFrame,t=null===e?null:e.child;return null===t?wx(e):t}function wx(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function Ix(){const e=He.lFrame;return He.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Rx=Ix;function DT(){const e=Ix();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function ur(){return He.lFrame.selectedIndex}function Vl(e){He.lFrame.selectedIndex=e}function An(){const e=He.lFrame;return rf(e.tView,e.selectedIndex)}function bs(){He.lFrame.currentNamespace=hx}function Rc(){!function Eee(){He.lFrame.currentNamespace=null}()}let Dx=!0;function cf(){return Dx}function Xs(e){Dx=e}function ov(e,t){for(let n=t.directiveStart,i=t.directiveEnd;n<i;n++){const o=e.data[n].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:c,ngAfterViewChecked:l,ngOnDestroy:d}=o;s&&(e.contentHooks??=[]).push(-n,s),a&&((e.contentHooks??=[]).push(n,a),(e.contentCheckHooks??=[]).push(n,a)),c&&(e.viewHooks??=[]).push(-n,c),l&&((e.viewHooks??=[]).push(n,l),(e.viewCheckHooks??=[]).push(n,l)),null!=d&&(e.destroyHooks??=[]).push(n,d)}}function sv(e,t,n){Ox(e,t,3,n)}function av(e,t,n,i){(3&e[Se])===n&&Ox(e,t,n,i)}function OT(e,t){let n=e[Se];(3&n)===t&&(n&=16383,n+=1,e[Se]=n)}function Ox(e,t,n,i){const o=i??-1,s=t.length-1;let a=0;for(let c=void 0!==i?65535&e[au]:0;c<s;c++)if("number"==typeof t[c+1]){if(a=t[c],null!=i&&a>=i)break}else t[c]<0&&(e[au]+=65536),(a<o||-1==o)&&(yee(e,n,t,c),e[au]=(4294901760&e[au])+c+2),c++}function Nx(e,t){qs(4,e,t);const n=ut(null);try{t.call(e)}finally{ut(n),qs(5,e,t)}}function yee(e,t,n,i){const r=n[i]<0,o=n[i+1],a=e[r?-n[i]:n[i]];r?e[Se]>>14<e[au]>>16&&(3&e[Se])===t&&(e[Se]+=16384,Nx(a,o)):Nx(a,o)}const uu=-1;class lf{constructor(t,n,i){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=i}}function PT(e){return e!==uu}function df(e){return 32767&e}function uf(e,t){let n=function Iee(e){return e>>16}(e),i=t;for(;n>0;)i=i[su],n--;return i}let MT=!0;function cv(e){const t=MT;return MT=e,t}const Px=255,Mx=5;let Ree=0;const Zs={};function lv(e,t){const n=xx(e,t);if(-1!==n)return n;const i=t[se];i.firstCreatePass&&(e.injectorIndex=t.length,xT(i.data,e),xT(t,null),xT(i.blueprint,null));const r=dv(e,t),o=e.injectorIndex;if(PT(r)){const s=df(r),a=uf(r,t),c=a[se].data;for(let l=0;l<8;l++)t[o+l]=a[s+l]|c[s+l]}return t[o+8]=r,o}function xT(e,t){e.push(0,0,0,0,0,0,0,0,t)}function xx(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function dv(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,i=null,r=t;for(;null!==r;){if(i=jx(r),null===i)return uu;if(n++,r=r[su],-1!==i.injectorIndex)return i.injectorIndex|n<<16}return uu}function kT(e,t,n){!function Aee(e,t,n){let i;"string"==typeof n?i=n.charCodeAt(0)||0:n.hasOwnProperty(qp)&&(i=n[qp]),null==i&&(i=n[qp]=Ree++);const r=i&Px;t.data[e+(r>>Mx)]|=1<<r}(e,t,n)}function kx(e,t,n){if(n&bt.Optional||void 0!==e)return e;YC()}function Lx(e,t,n,i){if(n&bt.Optional&&void 0===i&&(i=null),!(n&(bt.Self|bt.Host))){const r=e[Ei],o=Vr(void 0);try{return r?r.get(t,i,n&bt.Optional):k1(t,i,n&bt.Optional)}finally{Vr(o)}}return kx(i,0,n)}function Fx(e,t,n,i=bt.Default,r){if(null!==e){if(2048&t[Se]&&!(i&bt.Self)){const s=function Mee(e,t,n,i,r){let o=e,s=t;for(;null!==o&&null!==s&&2048&s[Se]&&!(512&s[Se]);){const a=Ux(o,s,n,i|bt.Self,Zs);if(a!==Zs)return a;let c=o.parent;if(!c){const l=s[rx];if(l){const d=l.get(n,Zs,i);if(d!==Zs)return d}c=jx(s),s=s[su]}o=c}return r}(e,t,n,i,Zs);if(s!==Zs)return s}const o=Ux(e,t,n,i,Zs);if(o!==Zs)return o}return Lx(t,n,i,r)}function Ux(e,t,n,i,r){const o=function Nee(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(qp)?e[qp]:void 0;return"number"==typeof t?t>=0?t&Px:Pee:t}(n);if("function"==typeof o){if(!Cx(t,e,i))return i&bt.Host?kx(r,0,i):Lx(t,n,i,r);try{let s;if(s=o(i),null!=s||i&bt.Optional)return s;YC()}finally{Rx()}}else if("number"==typeof o){let s=null,a=xx(e,t),c=uu,l=i&bt.Host?t[Wn][cr]:null;for((-1===a||i&bt.SkipSelf)&&(c=-1===a?dv(e,t):t[a+8],c!==uu&&Bx(i,!1)?(s=t[se],a=df(c),t=uf(c,t)):a=-1);-1!==a;){const d=t[se];if(Vx(o,a,d.data)){const u=Oee(a,t,n,s,i,l);if(u!==Zs)return u}c=t[a+8],c!==uu&&Bx(i,t[se].data[a+8]===l)&&Vx(o,a,t)?(s=d,a=df(c),t=uf(c,t)):a=-1}}return r}function Oee(e,t,n,i,r,o){const s=t[se],a=s.data[e+8],d=uv(a,s,n,null==i?Fl(a)&&MT:i!=s&&!!(3&a.type),r&bt.Host&&o===a);return null!==d?Bl(t,s,d,a):Zs}function uv(e,t,n,i,r){const o=e.providerIndexes,s=t.data,a=1048575&o,c=e.directiveStart,d=o>>20,h=r?a+d:e.directiveEnd;for(let p=i?a:a+d;p<h;p++){const m=s[p];if(p<c&&n===m||p>=c&&m.type===n)return p}if(r){const p=s[c];if(p&&vs(p)&&p.type===n)return c}return null}function Bl(e,t,n,i){let r=e[n];const o=t.data;if(function See(e){return e instanceof lf}(r)){const s=r;s.resolving&&function ZJ(e,t){throw t&&t.join(" > "),new W(-200,e)}(function Gt(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Ke(e)}(o[n]));const a=cv(s.canSeeViewProviders);s.resolving=!0;const l=s.injectImpl?Vr(s.injectImpl):null;Cx(e,i,bt.Default);try{r=e[n]=s.factory(void 0,o,e,i),t.firstCreatePass&&n>=i.directiveStart&&function bee(e,t,n){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:o}=t.type.prototype;if(i){const s=lx(t);(n.preOrderHooks??=[]).push(e,s),(n.preOrderCheckHooks??=[]).push(e,s)}r&&(n.preOrderHooks??=[]).push(0-e,r),o&&((n.preOrderHooks??=[]).push(e,o),(n.preOrderCheckHooks??=[]).push(e,o))}(n,o[n],t)}finally{null!==l&&Vr(l),cv(a),s.resolving=!1,Rx()}}return r}function Vx(e,t,n){return!!(n[t+(e>>Mx)]&1<<e)}function Bx(e,t){return!(e&bt.Self||e&bt.Host&&t)}class Ni{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,i){return Fx(this._tNode,this._lView,t,B_(i),n)}}function Pee(){return new Ni(on(),K())}function bi(e){return Va(()=>{const t=e.prototype.constructor,n=t[Ba]||LT(t),i=Object.prototype;let r=Object.getPrototypeOf(e.prototype).constructor;for(;r&&r!==i;){const o=r[Ba]||LT(r);if(o&&o!==n)return o;r=Object.getPrototypeOf(r)}return o=>new o})}function LT(e){return k_(e)?()=>{const t=LT(Ve(e));return t&&t()}:Ml(e)}function jx(e){const t=e[se],n=t.type;return 2===n?t.declTNode:1===n?e[cr]:null}function Kx(e,t=null,n=null,i){const r=qx(e,t,n,i);return r.resolveInjectorInitializers(),r}function qx(e,t=null,n=null,i,r=new Set){const o=[n||Pt,RQ(e)];return i=i||("object"==typeof e?void 0:Ai(e)),new nu(o,t||Z_(),i||null,r)}let Bi=(()=>{class e{static{this.THROW_IF_NOT_FOUND=Yp}static{this.NULL=new z_}static create(n,i){if(Array.isArray(n))return Kx({name:""},i,n,"");{const r=n.name??"";return Kx({name:r},n.parent,n.providers,r)}}static{this.\u0275prov=ae({token:e,providedIn:"any",factory:()=>Z(j1)})}static{this.__NG_ELEMENT_ID__=-1}}return e})();function UT(e){return e.ngOriginalError}class Js{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t);this._console.error("ERROR",t),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&UT(t);for(;n&&UT(n);)n=UT(n);return n||null}}const $x=new re("",{providedIn:"root",factory:()=>J(Js).handleError.bind(void 0)});let mu=(()=>{class e{static{this.__NG_ELEMENT_ID__=Hee}static{this.__NG_ENV_ID__=n=>n}}return e})();class jee extends mu{constructor(t){super(),this._lView=t}onDestroy(t){return iv(this._lView,t),()=>function ST(e,t){if(null===e[Ic])return;const n=e[Ic].indexOf(t);-1!==n&&e[Ic].splice(n,1)}(this._lView,t)}}function Hee(){return new jee(K())}function Gee(){return gu(on(),K())}function gu(e,t){return new sn(Cr(e,t))}let sn=(()=>{class e{constructor(n){this.nativeElement=n}static{this.__NG_ELEMENT_ID__=Gee}}return e})();function Zx(e){return e instanceof sn?e.nativeElement:e}function VT(e){return t=>{setTimeout(e,void 0,t)}}const Wt=class Wee extends vt{constructor(t=!1){super(),this.destroyRef=void 0,this.__isAsync=t,tx()&&(this.destroyRef=J(mu,{optional:!0})??void 0)}emit(t){const n=ut(null);try{super.next(t)}finally{ut(n)}}subscribe(t,n,i){let r=t,o=n||(()=>null),s=i;if(t&&"object"==typeof t){const c=t;r=c.next?.bind(c),o=c.error?.bind(c),s=c.complete?.bind(c)}this.__isAsync&&(o=VT(o),r&&(r=VT(r)),s&&(s=VT(s)));const a=super.subscribe({next:r,error:o,complete:s});return t instanceof li&&t.add(a),a}};function zee(){return this._results[Symbol.iterator]()}class hf{get changes(){return this._changes??=new Wt}constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;const n=hf.prototype;n[Symbol.iterator]||(n[Symbol.iterator]=zee)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,n){return this._results.reduce(t,n)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,n){this.dirty=!1;const i=function Br(e){return e.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function dQ(e,t,n){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++){let r=e[i],o=t[i];if(n&&(r=n(r),o=n(o)),o!==r)return!1}return!0}(this._results,i,n))&&(this._results=i,this.length=i.length,this.last=i[this.length-1],this.first=i[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(t){this._onDirty=t}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}}function pv(e){return!(128&~e.flags)}const BT=new Map;let qee=0;const HT="__ngContext__";function hr(e,t){lr(t)?(e[HT]=t[ef],function $ee(e){BT.set(e[ef],e)}(t)):e[HT]=t}function ak(e){return lk(e[Jp])}function ck(e){return lk(e[gs])}function lk(e){for(;null!==e&&!dr(e);)e=e[gs];return e}let GT;const mf=new re("",{providedIn:"root",factory:()=>pte}),pte="ng",_k=new re(""),Dc=new re("",{providedIn:"platform",factory:()=>"unknown"}),za=new re(""),WT=new re("",{providedIn:"root",factory:()=>function Ac(){if(void 0!==GT)return GT;if(typeof document<"u")return document;throw new W(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let vk=()=>null;function JT(e,t,n=!1){return vk(e,t,n)}const Ck=new re("",{providedIn:"root",factory:()=>!1});class Ak{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${w1})`}}function Oc(e){return e instanceof Ak?e.changingThisBreaksApplicationSecurity:e}const Lte=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var bu=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(bu||{});function l0(e){const t=function Sf(){const e=K();return e&&e[_s].sanitizer}();return t?t.sanitize(bu.URL,e)||"":function bf(e,t){const n=function Pte(e){return e instanceof Ak&&e.getTypeName()||null}(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${n} (see ${w1})`)}return n===t}(e,"URL")?Oc(e):function o0(e){return(e=String(e)).match(Lte)?e:"unsafe:"+e}(Ke(e))}const Jte=/^>|^->|<!--|-->|--!>|<!-$/g,Qte=/(<|>)/g,ene="\u200b$1\u200b";function mo(e){return e instanceof Function?e():e}var Nc=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(Nc||{});let p0;function f0(e,t){return p0(e,t)}function Su(e,t,n,i,r){if(null!=i){let o,s=!1;dr(i)?o=i:lr(i)&&(s=!0,i=i[Vn]);const a=fn(i);0===e&&null!==n?null==r?Xk(t,n,a):jl(t,n,a,r||null,!0):1===e&&null!==n?jl(t,n,a,r||null,!0):2===e?function wf(e,t,n){const i=Dv(e,t);i&&function Ene(e,t,n,i){e.removeChild(t,n,i)}(e,i,t,n)}(t,a,s):3===e&&t.destroyNode(a),null!=o&&function Sne(e,t,n,i,r){const o=n[Ks];o!==fn(n)&&Su(t,e,i,o,r);for(let a=ui;a<n.length;a++){const c=n[a];Nv(c[se],c,e,t,i,o)}}(t,e,o,n,r)}}function g0(e,t){return e.createComment(function Vk(e){return e.replace(Jte,t=>t.replace(Qte,ene))}(t))}function Rv(e,t,n){return e.createElement(t,n)}function qk(e,t){t[_s].changeDetectionScheduler?.notify(1),Nv(e,t,t[je],2,null,null)}function Yk(e,t){const n=e[cu],i=n.indexOf(t);n.splice(i,1)}function Cf(e,t){if(e.length<=ui)return;const n=ui+t,i=e[n];if(i){const r=i[Qp];null!==r&&r!==e&&Yk(r,i),t>0&&(e[n-1][gs]=i[gs]);const o=G_(e,ui+t);!function hne(e,t){qk(e,t),t[Vn]=null,t[cr]=null}(i[se],i);const s=o[Ha];null!==s&&s.detachView(o[se]),i[di]=null,i[gs]=null,i[Se]&=-129}return i}function Av(e,t){if(!(256&t[Se])){const n=t[je];n.destroyNode&&Nv(e,t,n,3,null,null),function fne(e){let t=e[Jp];if(!t)return _0(e[se],e);for(;t;){let n=null;if(lr(t))n=t[Jp];else{const i=t[ui];i&&(n=i)}if(!n){for(;t&&!t[gs]&&t!==e;)lr(t)&&_0(t[se],t),t=t[di];null===t&&(t=e),lr(t)&&_0(t[se],t),n=t&&t[gs]}t=n}}(t)}}function _0(e,t){if(256&t[Se])return;const n=ut(null);try{t[Se]&=-129,t[Se]|=256,t[Ll]&&function h1(e){if(qd(e),Wp(e))for(let t=0;t<e.producerNode.length;t++)A_(e.producerNode[t],e.producerIndexOfThis[t]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}(t[Ll]),function vne(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let i=0;i<n.length;i+=2){const r=t[n[i]];if(!(r instanceof lf)){const o=n[i+1];if(Array.isArray(o))for(let s=0;s<o.length;s+=2){const a=r[o[s]],c=o[s+1];qs(4,a,c);try{c.call(a)}finally{qs(5,a,c)}}else{qs(4,r,o);try{o.call(r)}finally{qs(5,r,o)}}}}}(e,t),function _ne(e,t){const n=e.cleanup,i=t[ou];if(null!==n)for(let o=0;o<n.length-1;o+=2)if("string"==typeof n[o]){const s=n[o+3];s>=0?i[s]():i[-s].unsubscribe(),o+=2}else n[o].call(i[n[o+1]]);null!==i&&(t[ou]=null);const r=t[Ic];if(null!==r){t[Ic]=null;for(let o=0;o<r.length;o++)(0,r[o])()}}(e,t),1===t[se].type&&t[je].destroy();const i=t[Qp];if(null!==i&&dr(t[di])){i!==t[di]&&Yk(i,t);const r=t[Ha];null!==r&&r.detachView(e)}!function Xee(e){BT.delete(e[ef])}(t)}finally{ut(n)}}function v0(e,t,n){return function $k(e,t,n){let i=t;for(;null!==i&&40&i.type;)i=(t=i).parent;if(null===i)return n[Vn];{const{componentOffset:r}=i;if(r>-1){const{encapsulation:o}=e.data[i.directiveStart+r];if(o===fs.None||o===fs.Emulated)return null}return Cr(i,n)}}(e,t.parent,n)}function jl(e,t,n,i,r){e.insertBefore(t,n,i,r)}function Xk(e,t,n){e.appendChild(t,n)}function Zk(e,t,n,i,r){null!==i?jl(e,t,n,i,r):Xk(e,t,n)}function Dv(e,t){return e.parentNode(t)}function Jk(e,t,n){return eL(e,t,n)}let E0,eL=function Qk(e,t,n){return 40&e.type?Cr(e,n):null};function Ov(e,t,n,i){const r=v0(e,i,t),o=t[je],a=Jk(i.parent||t[cr],i,t);if(null!=r)if(Array.isArray(n))for(let c=0;c<n.length;c++)Zk(o,r,n[c],a,!1);else Zk(o,r,n,a,!1);void 0!==E0&&E0(o,i,t,n,r)}function Tf(e,t){if(null!==t){const n=t.type;if(3&n)return Cr(t,e);if(4&n)return b0(-1,e[t.index]);if(8&n){const i=t.child;if(null!==i)return Tf(e,i);{const r=e[t.index];return dr(r)?b0(-1,r):fn(r)}}if(32&n)return f0(t,e)()||fn(e[t.index]);{const i=nL(e,t);return null!==i?Array.isArray(i)?i[0]:Tf(Ul(e[Wn]),i):Tf(e,t.next)}}return null}function nL(e,t){return null!==t?e[Wn][cr].projection[t.projection]:null}function b0(e,t){const n=ui+e+1;if(n<t.length){const i=t[n],r=i[se].firstChild;if(null!==r)return Tf(i,r)}return t[Ks]}function y0(e,t,n,i,r,o,s){for(;null!=n;){const a=i[n.index],c=n.type;if(s&&0===t&&(a&&hr(fn(a),i),n.flags|=2),32&~n.flags)if(8&c)y0(e,t,n.child,i,r,o,!1),Su(t,e,r,a,o);else if(32&c){const l=f0(n,i);let d;for(;d=l();)Su(t,e,r,d,o);Su(t,e,r,a,o)}else 16&c?rL(e,t,i,n,r,o):Su(t,e,r,a,o);n=s?n.projectionNext:n.next}}function Nv(e,t,n,i,r,o){y0(n,i,e.firstChild,t,r,o,!1)}function rL(e,t,n,i,r,o){const s=n[Wn],c=s[cr].projection[i.projection];if(Array.isArray(c))for(let l=0;l<c.length;l++)Su(t,e,r,c[l],o);else{let l=c;const d=s[di];pv(i)&&(l.flags|=128),y0(e,t,l,d,r,o,!0)}}function oL(e,t,n){""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n)}function sL(e,t,n){const{mergedAttrs:i,classes:r,styles:o}=n;null!==i&&tT(e,t,i),null!==r&&oL(e,t,r),null!==o&&function Tne(e,t,n){e.setAttribute(t,"style",n)}(e,t,o)}const Je={};function Re(e=1){aL(yt(),K(),ur()+e,!1)}function aL(e,t,n,i){if(!i)if(3&~t[Se]){const o=e.preOrderHooks;null!==o&&av(t,o,0,n)}else{const o=e.preOrderCheckHooks;null!==o&&sv(t,o,n)}Vl(n)}function H(e,t=bt.Default){const n=K();return null===n?Z(e,t):Fx(on(),n,Ve(e),t)}function S0(){throw new Error("invalid")}function cL(e,t,n,i,r,o){const s=ut(null);try{let a=null;r&we.SignalBased&&(a=t[i][Ol]),null!==a&&void 0!==a.transformFn&&(o=a.transformFn(o)),r&we.HasDecoratorInputTransform&&(o=e.inputTransforms[i].call(t,o)),null!==e.setInput?e.setInput(t,a,o,n,i):cx(t,a,i,o)}finally{ut(s)}}function Pv(e,t,n,i,r,o,s,a,c,l,d){const u=t.blueprint.slice();return u[Vn]=r,u[Se]=204|i,(null!==l||e&&2048&e[Se])&&(u[Se]|=2048),mx(u),u[di]=u[su]=e,u[Rn]=n,u[_s]=s||e&&e[_s],u[je]=a||e&&e[je],u[Ei]=c||e&&e[Ei]||null,u[cr]=o,u[ef]=function Yee(){return qee++}(),u[po]=d,u[rx]=l,u[Wn]=2==t.type?e[Wn]:u,u}function Cu(e,t,n,i,r){let o=e.data[t];if(null===o)o=function C0(e,t,n,i,r){const o=Ex(),s=CT(),c=e.data[t]=function Pne(e,t,n,i,r,o){let s=t?t.injectorIndex:-1,a=0;return du()&&(a|=128),{type:n,index:i,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:r,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,s?o:o&&o.parent,n,t,i,r);return null===e.firstChild&&(e.firstChild=c),null!==o&&(s?null==o.child&&null!==c.parent&&(o.child=c):null===o.next&&(o.next=c,c.prev=o)),c}(e,t,n,i,r),function pee(){return He.lFrame.inI18n}()&&(o.flags|=32);else if(64&o.type){o.type=n,o.value=i,o.attrs=r;const s=function af(){const e=He.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();o.injectorIndex=null===s?-1:s.injectorIndex}return $s(o,!0),o}function If(e,t,n,i){if(0===n)return-1;const r=t.length;for(let o=0;o<n;o++)t.push(i),e.blueprint.push(i),e.data.push(null);return r}function lL(e,t,n,i,r){const o=ur(),s=2&i;try{Vl(-1),s&&t.length>qe&&aL(e,t,qe,!1),qs(s?2:0,r),n(i,r)}finally{Vl(o),qs(s?3:1,r)}}function T0(e,t,n){if(pT(t)){const i=ut(null);try{const o=t.directiveEnd;for(let s=t.directiveStart;s<o;s++){const a=e.data[s];a.contentQueries&&a.contentQueries(1,n[s],s)}}finally{ut(i)}}}function w0(e,t,n){vx()&&(function Vne(e,t,n,i){const r=n.directiveStart,o=n.directiveEnd;Fl(n)&&function Kne(e,t,n){const i=Cr(t,e),r=dL(n);let s=16;n.signals?s=4096:n.onPush&&(s=64);const a=Mv(e,Pv(e,r,null,s,i,t,null,e[_s].rendererFactory.createRenderer(i,n),null,null,null));e[t.index]=a}(t,n,e.data[r+n.componentOffset]),e.firstCreatePass||lv(n,t),hr(i,t);const s=n.initialInputs;for(let a=r;a<o;a++){const c=e.data[a],l=Bl(t,e,a,n);hr(l,t),null!==s&&qne(0,a-r,l,c,0,s),vs(c)&&(fo(n.index,t)[Rn]=Bl(t,e,a,n))}}(e,t,n,Cr(n,t)),!(64&~n.flags)&&mL(e,t,n))}function I0(e,t,n=Cr){const i=t.localNames;if(null!==i){let r=t.index+1;for(let o=0;o<i.length;o+=2){const s=i[o+1],a=-1===s?n(t,e):e[s];e[r++]=a}}}function dL(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=R0(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}function R0(e,t,n,i,r,o,s,a,c,l,d){const u=qe+i,h=u+r,p=function Ine(e,t){const n=[];for(let i=0;i<t;i++)n.push(i<e?null:Je);return n}(u,h),m="function"==typeof l?l():l;return p[se]={type:e,blueprint:p,template:n,queries:null,viewQuery:a,declTNode:t,data:p.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof s?s():s,firstChild:null,schemas:c,consts:m,incompleteFirstPass:!1,ssrId:d}}let uL=()=>null;function hL(e,t,n,i,r){for(let o in t){if(!t.hasOwnProperty(o))continue;const s=t[o];if(void 0===s)continue;i??={};let a,c=we.None;Array.isArray(s)?(a=s[0],c=s[1]):a=s;let l=o;if(null!==r){if(!r.hasOwnProperty(o))continue;l=r[o]}0===e?pL(i,n,l,a,c):pL(i,n,l,a)}return i}function pL(e,t,n,i,r){let o;e.hasOwnProperty(n)?(o=e[n]).push(t,i):o=e[n]=[t,i],void 0!==r&&o.push(r)}function qr(e,t,n,i,r,o,s,a){const c=Cr(t,n);let d,l=t.inputs;!a&&null!=l&&(d=l[i])?(P0(e,n,d,i,r),Fl(t)&&function kne(e,t){const n=fo(t,e);16&n[Se]||(n[Se]|=64)}(n,t.index)):3&t.type&&(i=function xne(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(i),r=null!=s?s(r,t.value||"",i):r,o.setProperty(c,i,r))}function A0(e,t,n,i){if(vx()){const r=null===i?null:{"":-1},o=function jne(e,t){const n=e.directiveRegistry;let i=null,r=null;if(n)for(let o=0;o<n.length;o++){const s=n[o];if(K1(t,s.selectors,!1))if(i||(i=[]),vs(s))if(null!==s.findHostDirectiveDefs){const a=[];r=r||new Map,s.findHostDirectiveDefs(s,a,r),i.unshift(...a,s),D0(e,t,a.length)}else i.unshift(s),D0(e,t,0);else r=r||new Map,s.findHostDirectiveDefs?.(s,i,r),i.push(s)}return null===i?null:[i,r]}(e,n);let s,a;null===o?s=a=null:[s,a]=o,null!==s&&fL(e,t,n,s,r,a),r&&function Hne(e,t,n){if(t){const i=e.localNames=[];for(let r=0;r<t.length;r+=2){const o=n[t[r+1]];if(null==o)throw new W(-301,!1);i.push(t[r],o)}}}(n,i,r)}n.mergedAttrs=Xp(n.mergedAttrs,n.attrs)}function fL(e,t,n,i,r,o){for(let l=0;l<i.length;l++)kT(lv(n,t),e,i[l].type);!function Wne(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}(n,e.data.length,i.length);for(let l=0;l<i.length;l++){const d=i[l];d.providersResolver&&d.providersResolver(d)}let s=!1,a=!1,c=If(e,t,i.length,null);for(let l=0;l<i.length;l++){const d=i[l];n.mergedAttrs=Xp(n.mergedAttrs,d.hostAttrs),zne(e,n,t,c,d),Gne(c,d,r),null!==d.contentQueries&&(n.flags|=4),(null!==d.hostBindings||null!==d.hostAttrs||0!==d.hostVars)&&(n.flags|=64);const u=d.type.prototype;!s&&(u.ngOnChanges||u.ngOnInit||u.ngDoCheck)&&((e.preOrderHooks??=[]).push(n.index),s=!0),!a&&(u.ngOnChanges||u.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(n.index),a=!0),c++}!function Mne(e,t,n){const r=t.directiveEnd,o=e.data,s=t.attrs,a=[];let c=null,l=null;for(let d=t.directiveStart;d<r;d++){const u=o[d],h=n?n.get(u):null,m=h?h.outputs:null;c=hL(0,u.inputs,d,c,h?h.inputs:null),l=hL(1,u.outputs,d,l,m);const f=null===c||null===s||nT(t)?null:Yne(c,d,s);a.push(f)}null!==c&&(c.hasOwnProperty("class")&&(t.flags|=8),c.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=a,t.inputs=c,t.outputs=l}(e,n,o)}function mL(e,t,n){const i=n.directiveStart,r=n.directiveEnd,o=n.index,s=function mee(){return He.lFrame.currentDirectiveIndex}();try{Vl(o);for(let a=i;a<r;a++){const c=e.data[a],l=t[a];wT(a),(null!==c.hostBindings||0!==c.hostVars||null!==c.hostAttrs)&&Bne(c,l)}}finally{Vl(-1),wT(s)}}function Bne(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function D0(e,t,n){t.componentOffset=n,(e.components??=[]).push(t.index)}function Gne(e,t,n){if(n){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)n[t.exportAs[i]]=e;vs(t)&&(n[""]=e)}}function zne(e,t,n,i,r){e.data[i]=r;const o=r.factory||(r.factory=Ml(r.type)),s=new lf(o,vs(r),H);e.blueprint[i]=s,n[i]=s,function Fne(e,t,n,i,r){const o=r.hostBindings;if(o){let s=e.hostBindingOpCodes;null===s&&(s=e.hostBindingOpCodes=[]);const a=~t.index;(function Une(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(s)!=a&&s.push(a),s.push(n,i,o)}}(e,t,i,If(e,n,r.hostVars,Je),r)}function Qs(e,t,n,i,r,o){const s=Cr(e,t);!function O0(e,t,n,i,r,o,s){if(null==o)e.removeAttribute(t,r,n);else{const a=null==s?Ke(o):s(o,i||"",r);e.setAttribute(t,r,a,n)}}(t[je],s,o,e.value,n,i,r)}function qne(e,t,n,i,r,o){const s=o[t];if(null!==s)for(let a=0;a<s.length;)cL(i,n,s[a++],s[a++],s[a++],s[a++])}function Yne(e,t,n){let i=null,r=0;for(;r<n.length;){const o=n[r];if(0!==o)if(5!==o){if("number"==typeof o)break;if(e.hasOwnProperty(o)){null===i&&(i=[]);const s=e[o];for(let a=0;a<s.length;a+=3)if(s[a]===t){i.push(o,s[a+1],s[a+2],n[r+1]);break}}r+=2}else r+=2;else r+=4}return i}function gL(e,t,n,i){return[e,!0,0,t,null,i,null,n,null,null]}function _L(e,t){const n=e.contentQueries;if(null!==n){const i=ut(null);try{for(let r=0;r<n.length;r+=2){const s=n[r+1];if(-1!==s){const a=e.data[s];rv(n[r]),a.contentQueries(2,t[s],s)}}}finally{ut(i)}}}function Mv(e,t){return e[Jp]?e[ix][gs]=t:e[Jp]=t,e[ix]=t,t}function N0(e,t,n){rv(0);const i=ut(null);try{t(e,n)}finally{ut(i)}}function vL(e){return e[ou]||(e[ou]=[])}function EL(e){return e.cleanup||(e.cleanup=[])}function xv(e,t){const n=e[Ei],i=n?n.get(Js,null):null;i&&i.handleError(t)}function P0(e,t,n,i,r){for(let o=0;o<n.length;){const s=n[o++],a=n[o++],c=n[o++];cL(e.data[s],t[s],i,a,c,r)}}function $ne(e,t){const n=fo(t,e),i=n[se];!function Xne(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])}(i,n);const r=n[Vn];null!==r&&null===n[po]&&(n[po]=JT(r,n[Ei])),M0(i,n,n[Rn])}function M0(e,t,n){AT(t);try{const i=e.viewQuery;null!==i&&N0(1,i,n);const r=e.template;null!==r&&lL(e,t,r,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),t[Ha]?.finishViewCreation(e),e.staticContentQueries&&_L(e,t),e.staticViewQueries&&N0(2,e.viewQuery,n);const o=e.components;null!==o&&function Zne(e,t){for(let n=0;n<t.length;n++)$ne(e,t[n])}(t,o)}catch(i){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),i}finally{t[Se]&=-5,DT()}}function Rf(e,t,n,i){const r=ut(null);try{const o=t.tView,c=Pv(e,o,n,4096&e[Se]?4096:16,null,t,null,null,i?.injector??null,i?.embeddedViewInjector??null,i?.dehydratedView??null);c[Qp]=e[t.index];const d=e[Ha];return null!==d&&(c[Ha]=d.createEmbeddedView(o)),M0(o,c,n),c}finally{ut(r)}}function Tu(e,t){return!t||null===t.firstChild||pv(e)}function Af(e,t,n,i=!0){const r=t[se];if(function mne(e,t,n,i){const r=ui+i,o=n.length;i>0&&(n[r-1][gs]=t),i<o-ui?(t[gs]=n[r],U1(n,ui+i,t)):(n.push(t),t[gs]=null),t[di]=n;const s=t[Qp];null!==s&&n!==s&&function gne(e,t){const n=e[cu];t[Wn]!==t[di][di][Wn]&&(e[Se]|=hT.HasTransplantedViews),null===n?e[cu]=[t]:n.push(t)}(s,t);const a=t[Ha];null!==a&&a.insertView(e),yT(t),t[Se]|=128}(r,t,e,n),i){const s=b0(n,e),a=t[je],c=Dv(a,e[Ks]);null!==c&&function pne(e,t,n,i,r,o){i[Vn]=r,i[cr]=t,Nv(e,i,n,1,r,o)}(r,e[cr],a,t,c,s)}const o=t[po];null!==o&&null!==o.firstChild&&(o.firstChild=null)}function Df(e,t,n,i,r=!1){for(;null!==n;){const o=t[n.index];null!==o&&i.push(fn(o)),dr(o)&&SL(o,i);const s=n.type;if(8&s)Df(e,t,n.child,i);else if(32&s){const a=f0(n,t);let c;for(;c=a();)i.push(c)}else if(16&s){const a=nL(t,n);if(Array.isArray(a))i.push(...a);else{const c=Ul(t[Wn]);Df(c[se],c,a,i,!0)}}n=r?n.projectionNext:n.next}return i}function SL(e,t){for(let n=ui;n<e.length;n++){const i=e[n],r=i[se].firstChild;null!==r&&Df(i[se],i,r,t)}e[Ks]!==e[Vn]&&t.push(e[Ks])}let CL=[];const tie={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{},consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{sf(e.lView)},consumerOnSignalRead(){this.lView[Ll]=this}},TL=100;function kv(e,t=!0,n=0){const i=e[_s],r=i.rendererFactory;r.begin?.();try{!function nie(e,t){k0(e,t);let n=0;for(;bT(e);){if(n===TL)throw new W(103,!1);n++,k0(e,1)}}(e,n)}catch(s){throw t&&xv(e,s),s}finally{r.end?.(),i.inlineEffectRunner?.flush()}}function iie(e,t,n,i){const r=t[Se];if(!(256&~r))return;t[_s].inlineEffectRunner?.flush(),AT(t);let s=null,a=null;(function rie(e){return 2!==e.type})(e)&&(a=function Jne(e){return e[Ll]??function Qne(e){const t=CL.pop()??Object.create(tie);return t.lView=e,t}(e)}(t),s=function d1(e){return e&&(e.nextProducerIndex=0),ut(e)}(a));try{mx(t),function yx(e){return He.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&lL(e,t,n,2,i);const c=!(3&~r);if(c){const u=e.preOrderCheckHooks;null!==u&&sv(t,u,null)}else{const u=e.preOrderHooks;null!==u&&av(t,u,0,null),OT(t,0)}if(function oie(e){for(let t=ak(e);null!==t;t=ck(t)){if(!(t[Se]&hT.HasTransplantedViews))continue;const n=t[cu];for(let i=0;i<n.length;i++){iee(n[i])}}}(t),wL(t,0),null!==e.contentQueries&&_L(e,t),c){const u=e.contentCheckHooks;null!==u&&sv(t,u)}else{const u=e.contentHooks;null!==u&&av(t,u,1),OT(t,1)}!function wne(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let i=0;i<n.length;i++){const r=n[i];if(r<0)Vl(~r);else{const o=r,s=n[++i],a=n[++i];fee(s,o),a(2,t[o])}}}finally{Vl(-1)}}(e,t);const l=e.components;null!==l&&RL(t,l,0);const d=e.viewQuery;if(null!==d&&N0(2,d,i),c){const u=e.viewCheckHooks;null!==u&&sv(t,u)}else{const u=e.viewHooks;null!==u&&av(t,u,2),OT(t,2)}if(!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[ev]){for(const u of t[ev])u();t[ev]=null}t[Se]&=-73}catch(c){throw sf(t),c}finally{null!==a&&(function u1(e,t){if(ut(t),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(Wp(e))for(let n=e.nextProducerIndex;n<e.producerNode.length;n++)A_(e.producerNode[n],e.producerIndexOfThis[n]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}(a,s),function eie(e){e.lView[Ll]!==e&&(e.lView=null,CL.push(e))}(a)),DT()}}function wL(e,t){for(let n=ak(e);null!==n;n=ck(n))for(let i=ui;i<n.length;i++)IL(n[i],t)}function sie(e,t,n){IL(fo(t,e),n)}function IL(e,t){ET(e)&&k0(e,t)}function k0(e,t){const i=e[se],r=e[Se],o=e[Ll];let s=!!(0===t&&16&r);if(s||=!!(64&r&&0===t),s||=!!(1024&r),s||=!(!o?.dirty||!AC(o)),o&&(o.dirty=!1),e[Se]&=-9217,s)iie(i,e,i.template,e[Rn]);else if(8192&r){wL(e,1);const a=i.components;null!==a&&RL(e,a,1)}}function RL(e,t,n){for(let i=0;i<t.length;i++)sie(e,t[i],n)}function Of(e){for(e[_s].changeDetectionScheduler?.notify();e;){e[Se]|=64;const t=Ul(e);if(fT(e)&&!t)return e;e=t}return null}class Nf{get rootNodes(){const t=this._lView,n=t[se];return Df(n,t,n.firstChild,[])}constructor(t,n,i=!0){this._lView=t,this._cdRefInjectingView=n,this.notifyErrorHandler=i,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Rn]}set context(t){this._lView[Rn]=t}get destroyed(){return!(256&~this._lView[Se])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[di];if(dr(t)){const n=t[8],i=n?n.indexOf(this):-1;i>-1&&(Cf(t,i),G_(n,i))}this._attachedToViewContainer=!1}Av(this._lView[se],this._lView)}onDestroy(t){iv(this._lView,t)}markForCheck(){Of(this._cdRefInjectingView||this._lView)}detach(){this._lView[Se]&=-129}reattach(){yT(this._lView),this._lView[Se]|=128}detectChanges(){this._lView[Se]|=1024,kv(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new W(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,qk(this._lView[se],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new W(902,!1);this._appRef=t,yT(this._lView)}}let Ya=(()=>{class e{static{this.__NG_ELEMENT_ID__=lie}}return e})();const aie=Ya,cie=class extends aie{constructor(t,n,i){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=i}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,n){return this.createEmbeddedViewImpl(t,n)}createEmbeddedViewImpl(t,n,i){const r=Rf(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:n,dehydratedView:i});return new Nf(r)}};function lie(){return Lv(on(),K())}function Lv(e,t){return 4&e.type?new cie(t,e,gu(e,t)):null}let ML=()=>null;function wu(e,t){return ML(e,t)}class jv{}class Mie{}class xL{}class kie{resolveComponentFactory(t){throw function xie(e){const t=Error(`No component factory found for ${Ai(e)}.`);return t.ngComponent=e,t}(t)}}let Iu=(()=>{class e{static{this.NULL=new kie}}return e})();class j0{}let ea=(()=>{class e{constructor(){this.destroyNode=null}static{this.__NG_ELEMENT_ID__=()=>function Lie(){const e=K(),n=fo(on().index,e);return(lr(n)?n:e)[je]}()}}return e})(),Fie=(()=>{class e{static{this.\u0275prov=ae({token:e,providedIn:"root",factory:()=>null})}}return e})();const H0={},LL=new Set;function ta(e){LL.has(e)||(LL.add(e),performance?.mark?.("mark_feature_usage",{detail:{feature:e}}))}function FL(...e){}class Le{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Wt(!1),this.onMicrotaskEmpty=new Wt(!1),this.onStable=new Wt(!1),this.onError=new Wt(!1),typeof Zone>"u")throw new W(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&n,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function Uie(){const e="function"==typeof Zt.requestAnimationFrame;let t=Zt[e?"requestAnimationFrame":"setTimeout"],n=Zt[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&t&&n){const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i);const r=n[Zone.__symbol__("OriginalDelegate")];r&&(n=r)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function jie(e){const t=()=>{!function Bie(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Zt,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,W0(e),e.isCheckStableRunning=!0,G0(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),W0(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,i,r,o,s,a)=>{if(function Hie(e){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0].data?.__ignore_ng_zone__}(a))return n.invokeTask(r,o,s,a);try{return UL(e),n.invokeTask(r,o,s,a)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||e.shouldCoalesceRunChangeDetection)&&t(),VL(e)}},onInvoke:(n,i,r,o,s,a,c)=>{try{return UL(e),n.invoke(r,o,s,a,c)}finally{e.shouldCoalesceRunChangeDetection&&t(),VL(e)}},onHasTask:(n,i,r,o)=>{n.hasTask(r,o),i===r&&("microTask"==o.change?(e._hasPendingMicrotasks=o.microTask,W0(e),G0(e)):"macroTask"==o.change&&(e.hasPendingMacrotasks=o.macroTask))},onHandleError:(n,i,r,o)=>(n.handleError(r,o),e.runOutsideAngular(()=>e.onError.emit(o)),!1)})}(r)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Le.isInAngularZone())throw new W(909,!1)}static assertNotInAngularZone(){if(Le.isInAngularZone())throw new W(909,!1)}run(t,n,i){return this._inner.run(t,n,i)}runTask(t,n,i,r){const o=this._inner,s=o.scheduleEventTask("NgZoneEvent: "+r,t,Vie,FL,FL);try{return o.runTask(s,n,i)}finally{o.cancelTask(s)}}runGuarded(t,n,i){return this._inner.runGuarded(t,n,i)}runOutsideAngular(t){return this._outer.run(t)}}const Vie={};function G0(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function W0(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function UL(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function VL(e){e._nesting--,G0(e)}class BL{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Wt,this.onMicrotaskEmpty=new Wt,this.onStable=new Wt,this.onError=new Wt}run(t,n,i){return t.apply(n,i)}runGuarded(t,n,i){return t.apply(n,i)}runOutsideAngular(t){return t()}runTask(t,n,i,r){return t.apply(n,i)}}var Hl=function(e){return e[e.EarlyRead=0]="EarlyRead",e[e.Write=1]="Write",e[e.MixedReadWrite=2]="MixedReadWrite",e[e.Read=3]="Read",e}(Hl||{});const jL={destroy(){}};function K0(e,t){!t&&function J_(e){if(!tx())throw new W(-203,!1)}();const n=t?.injector??J(Bi);if(!function ys(e){return"browser"===(e??J(Bi)).get(Dc)}(n))return jL;ta("NgAfterNextRender");const i=n.get(Lf),r=i.handler??=new GL,o=t?.phase??Hl.MixedReadWrite,s=()=>{r.unregister(c),a()},a=n.get(mu).onDestroy(s),c=ja(n,()=>new HL(o,()=>{s(),e()}));return r.register(c),{destroy:s}}class HL{constructor(t,n){this.phase=t,this.callbackFn=n,this.zone=J(Le),this.errorHandler=J(Js,{optional:!0}),J(jv,{optional:!0})?.notify(1)}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(t){this.errorHandler?.handleError(t)}}}class GL{constructor(){this.executingCallbacks=!1,this.buckets={[Hl.EarlyRead]:new Set,[Hl.Write]:new Set,[Hl.MixedReadWrite]:new Set,[Hl.Read]:new Set},this.deferredCallbacks=new Set}register(t){(this.executingCallbacks?this.deferredCallbacks:this.buckets[t.phase]).add(t)}unregister(t){this.buckets[t.phase].delete(t),this.deferredCallbacks.delete(t)}execute(){this.executingCallbacks=!0;for(const t of Object.values(this.buckets))for(const n of t)n.invoke();this.executingCallbacks=!1;for(const t of this.deferredCallbacks)this.buckets[t.phase].add(t);this.deferredCallbacks.clear()}destroy(){for(const t of Object.values(this.buckets))t.clear();this.deferredCallbacks.clear()}}let Lf=(()=>{class e{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){const n=[...this.internalCallbacks];this.internalCallbacks.length=0;for(const i of n)i()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}static{this.\u0275prov=ae({token:e,providedIn:"root",factory:()=>new e})}}return e})();function Gv(e,t,n){let i=n?e.styles:null,r=n?e.classes:null,o=0;if(null!==t)for(let s=0;s<t.length;s++){const a=t[s];"number"==typeof a?o=a:1==o?r=VC(r,a):2==o&&(i=VC(i,a+": "+t[++s]+";"))}n?e.styles=i:e.stylesWithoutHost=i,n?e.classes=r:e.classesWithoutHost=r}class KL extends Iu{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=mt(t);return new Vf(n,this.ngModule)}}function qL(e){const t=[];for(const n in e){if(!e.hasOwnProperty(n))continue;const i=e[n];void 0!==i&&t.push({propName:Array.isArray(i)?i[0]:i,templateName:n})}return t}class Wv{constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,i){i=B_(i);const r=this.injector.get(t,H0,i);return r!==H0||n===H0?r:this.parentInjector.get(t,n,i)}}class Vf extends xL{get inputs(){const t=this.componentDef,n=t.inputTransforms,i=qL(t.inputs);if(null!==n)for(const r of i)n.hasOwnProperty(r.propName)&&(r.transform=n[r.propName]);return i}get outputs(){return qL(this.componentDef.outputs)}constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function yQ(e){return e.map(bQ).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}create(t,n,i,r){const o=ut(null);try{let s=(r=r||this.ngModule)instanceof Hr?r:r?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const a=s?new Wv(t,s):t,c=a.get(j0,null);if(null===c)throw new W(407,!1);const l=a.get(Fie,null),h={rendererFactory:c,sanitizer:l,inlineEffectRunner:null,afterRenderEventManager:a.get(Lf,null),changeDetectionScheduler:a.get(jv,null)},p=c.createRenderer(null,this.componentDef),m=this.componentDef.selectors[0][0]||"div",f=i?function Rne(e,t,n,i){const o=i.get(Ck,!1)||n===fs.ShadowDom,s=e.selectRootElement(t,o);return function Ane(e){uL(e)}(s),s}(p,i,this.componentDef.encapsulation,a):Rv(p,m,function qie(e){const t=e.toLowerCase();return"svg"===t?hx:"math"===t?"math":null}(m));let g=512;this.componentDef.signals?g|=4096:this.componentDef.onPush||(g|=16);let E=null;null!==f&&(E=JT(f,a,!0));const b=R0(0,null,null,1,0,null,null,null,null,null,null),T=Pv(null,b,null,g,null,null,h,p,a,null,E);let I,D;AT(T);try{const O=this.componentDef;let k,L=null;O.findHostDirectiveDefs?(k=[],L=new Map,O.findHostDirectiveDefs(O,k,L),k.push(O)):k=[O];const V=function $ie(e,t){const n=e[se],i=qe;return e[i]=t,Cu(n,i,2,"#host",null)}(T,f),ee=function Xie(e,t,n,i,r,o,s){const a=r[se];!function Zie(e,t,n,i){for(const r of e)t.mergedAttrs=Xp(t.mergedAttrs,r.hostAttrs);null!==t.mergedAttrs&&(Gv(t,t.mergedAttrs,!0),null!==n&&sL(i,n,t))}(i,e,t,s);let c=null;null!==t&&(c=JT(t,r[Ei]));const l=o.rendererFactory.createRenderer(t,n);let d=16;n.signals?d=4096:n.onPush&&(d=64);const u=Pv(r,dL(n),null,d,r[e.index],e,o,l,null,null,c);return a.firstCreatePass&&D0(a,e,i.length-1),Mv(r,u),r[e.index]=u}(V,f,O,k,T,h,p);D=rf(b,qe),f&&function Qie(e,t,n,i){if(i)tT(e,n,["ng-version","17.3.12"]);else{const{attrs:r,classes:o}=function SQ(e){const t=[],n=[];let i=1,r=2;for(;i<e.length;){let o=e[i];if("string"==typeof o)2===r?""!==o&&t.push(o,e[++i]):8===r&&n.push(o);else{if(!ms(r))break;r=o}i++}return{attrs:t,classes:n}}(t.selectors[0]);r&&tT(e,n,r),o&&o.length>0&&oL(e,n,o.join(" "))}}(p,O,f,i),void 0!==n&&function ere(e,t,n){const i=e.projection=[];for(let r=0;r<t.length;r++){const o=n[r];i.push(null!=o?Array.from(o):null)}}(D,this.ngContentSelectors,n),I=function Jie(e,t,n,i,r,o){const s=on(),a=r[se],c=Cr(s,r);fL(a,r,s,n,null,i);for(let d=0;d<n.length;d++)hr(Bl(r,a,s.directiveStart+d,s),r);mL(a,r,s),c&&hr(c,r);const l=Bl(r,a,s.directiveStart+s.componentOffset,s);if(e[Rn]=r[Rn]=l,null!==o)for(const d of o)d(l,t);return T0(a,s,r),l}(ee,O,k,L,T,[tre]),M0(b,T,null)}finally{DT()}return new Yie(this.componentType,I,gu(D,T),T,D)}finally{ut(o)}}}class Yie extends Mie{constructor(t,n,i,r,o){super(),this.location=i,this._rootLView=r,this._tNode=o,this.previousInputValues=null,this.instance=n,this.hostView=this.changeDetectorRef=new Nf(r,void 0,!1),this.componentType=t}setInput(t,n){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),n))return;const o=this._rootLView;P0(o[se],o,r,t,n),this.previousInputValues.set(t,n),Of(fo(this._tNode.index,o))}}get injector(){return new Ni(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function tre(){const e=on();ov(K()[se],e)}let Vo=(()=>{class e{static{this.__NG_ELEMENT_ID__=nre}}return e})();function nre(){return XL(on(),K())}const ire=Vo,YL=class extends ire{constructor(t,n,i){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=i}get element(){return gu(this._hostTNode,this._hostLView)}get injector(){return new Ni(this._hostTNode,this._hostLView)}get parentInjector(){const t=dv(this._hostTNode,this._hostLView);if(PT(t)){const n=uf(t,this._hostLView),i=df(t);return new Ni(n[se].data[i+8],n)}return new Ni(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=$L(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-ui}createEmbeddedView(t,n,i){let r,o;"number"==typeof i?r=i:null!=i&&(r=i.index,o=i.injector);const s=wu(this._lContainer,t.ssrId),a=t.createEmbeddedViewImpl(n||{},o,s);return this.insertImpl(a,r,Tu(this._hostTNode,s)),a}createComponent(t,n,i,r,o){const s=t&&!function Zp(e){return"function"==typeof e}(t);let a;if(s)a=n;else{const m=n||{};a=m.index,i=m.injector,r=m.projectableNodes,o=m.environmentInjector||m.ngModuleRef}const c=s?t:new Vf(mt(t)),l=i||this.parentInjector;if(!o&&null==c.ngModule){const f=(s?l:this.parentInjector).get(Hr,null);f&&(o=f)}const d=mt(c.componentType??{}),u=wu(this._lContainer,d?.id??null),p=c.create(l,r,u?.firstChild??null,o);return this.insertImpl(p.hostView,a,Tu(this._hostTNode,u)),p}insert(t,n){return this.insertImpl(t,n,!0)}insertImpl(t,n,i){const r=t._lView;if(function nee(e){return dr(e[di])}(r)){const a=this.indexOf(t);if(-1!==a)this.detach(a);else{const c=r[di],l=new YL(c,c[cr],c[di]);l.detach(l.indexOf(t))}}const o=this._adjustIndex(n),s=this._lContainer;return Af(s,r,o,i),t.attachToViewContainerRef(),U1($0(s),o,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=$L(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),i=Cf(this._lContainer,n);i&&(G_($0(this._lContainer),n),Av(i[se],i))}detach(t){const n=this._adjustIndex(t,-1),i=Cf(this._lContainer,n);return i&&null!=G_($0(this._lContainer),n)?new Nf(i):null}_adjustIndex(t,n=0){return t??this.length+n}};function $L(e){return e[8]}function $0(e){return e[8]||(e[8]=[])}function XL(e,t){let n;const i=t[e.index];return dr(i)?n=i:(n=gL(i,t,null,e),t[e.index]=n,Mv(t,n)),ZL(n,t,e,i),new YL(n,e,t)}let ZL=function QL(e,t,n,i){if(e[Ks])return;let r;r=8&n.type?fn(i):function rre(e,t){const n=e[je],i=n.createComment(""),r=Cr(t,e);return jl(n,Dv(n,r),i,function bne(e,t){return e.nextSibling(t)}(n,r),!1),i}(t,n),e[Ks]=r},X0=()=>!1;class Z0{constructor(t){this.queryList=t,this.matches=null}clone(){return new Z0(this.queryList)}setDirty(){this.queryList.setDirty()}}class J0{constructor(t=[]){this.queries=t}createEmbeddedView(t){const n=t.queries;if(null!==n){const i=null!==t.contentQueries?t.contentQueries[0]:n.length,r=[];for(let o=0;o<i;o++){const s=n.getByIndex(o);r.push(this.queries[s.indexInDeclarationView].clone())}return new J0(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}finishViewCreation(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let n=0;n<this.queries.length;n++)null!==iw(t,n).matches&&this.queries[n].setDirty()}}class e2{constructor(t,n,i=null){this.flags=n,this.read=i,this.predicate="string"==typeof t?function hre(e){return e.split(",").map(t=>t.trim())}(t):t}}class Q0{constructor(t=[]){this.queries=t}elementStart(t,n){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,n)}elementEnd(t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(t)}embeddedTView(t){let n=null;for(let i=0;i<this.length;i++){const r=null!==n?n.length:0,o=this.getByIndex(i).embeddedTView(t,r);o&&(o.indexInDeclarationView=i,null!==n?n.push(o):n=[o])}return null!==n?new Q0(n):null}template(t,n){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,n)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class ew{constructor(t,n=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(t,n){this.isApplyingToNode(n)&&this.matchTNode(t,n)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,n){this.elementStart(t,n)}embeddedTView(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new ew(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1&~this.metadata.flags){const n=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==n;)i=i.parent;return n===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,n){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const o=i[r];this.matchTNodeWithReadOption(t,n,cre(n,o)),this.matchTNodeWithReadOption(t,n,uv(n,t,o,!1,!1))}else i===Ya?4&n.type&&this.matchTNodeWithReadOption(t,n,-1):this.matchTNodeWithReadOption(t,n,uv(n,t,i,!1,!1))}matchTNodeWithReadOption(t,n,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===sn||r===Vo||r===Ya&&4&n.type)this.addMatch(n.index,-2);else{const o=uv(n,t,r,!1,!1);null!==o&&this.addMatch(n.index,o)}else this.addMatch(n.index,i)}}addMatch(t,n){null===this.matches?this.matches=[t,n]:this.matches.push(t,n)}}function cre(e,t){const n=e.localNames;if(null!==n)for(let i=0;i<n.length;i+=2)if(n[i]===t)return n[i+1];return null}function dre(e,t,n,i){return-1===n?function lre(e,t){return 11&e.type?gu(e,t):4&e.type?Lv(e,t):null}(t,e):-2===n?function ure(e,t,n){return n===sn?gu(t,e):n===Ya?Lv(t,e):n===Vo?XL(t,e):void 0}(e,t,i):Bl(e,e[se],n,t)}function t2(e,t,n,i){const r=t[Ha].queries[i];if(null===r.matches){const o=e.data,s=n.matches,a=[];for(let c=0;null!==s&&c<s.length;c+=2){const l=s[c];a.push(l<0?null:dre(t,o[l],s[c+1],n.metadata.read))}r.matches=a}return r.matches}function tw(e,t,n,i){const r=e.queries.getByIndex(n),o=r.matches;if(null!==o){const s=t2(e,t,r,n);for(let a=0;a<o.length;a+=2){const c=o[a];if(c>0)i.push(s[a/2]);else{const l=o[a+1],d=t[-c];for(let u=ui;u<d.length;u++){const h=d[u];h[Qp]===h[di]&&tw(h[se],h,l,i)}if(null!==d[cu]){const u=d[cu];for(let h=0;h<u.length;h++){const p=u[h];tw(p[se],p,l,i)}}}}}return i}function n2(e,t,n){const i=new hf(!(4&~n));return function Nne(e,t,n,i){const r=vL(t);r.push(n),e.firstCreatePass&&EL(e).push(i,r.length-1)}(e,t,i,i.destroy),(t[Ha]??=new J0).queries.push(new Z0(i))-1}function s2(e,t,n){null===e.queries&&(e.queries=new Q0),e.queries.track(new ew(t,n))}function iw(e,t){return e.queries.getByIndex(t)}function a2(e,t){const n=e[se],i=iw(n,t);return i.crossesNgTemplate?tw(n,e,t,[]):t2(n,e,i,t)}function Mt(e){let t=function b2(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),n=!0;const i=[e];for(;t;){let r;if(vs(e))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new W(903,!1);r=t.\u0275dir}if(r){if(n){i.push(r);const s=e;s.inputs=qv(e.inputs),s.inputTransforms=qv(e.inputTransforms),s.declaredInputs=qv(e.declaredInputs),s.outputs=qv(e.outputs);const a=r.hostBindings;a&&Are(e,a);const c=r.viewQuery,l=r.contentQueries;if(c&&Ire(e,c),l&&Rre(e,l),Tre(e,r),jJ(e.outputs,r.outputs),vs(r)&&r.data.animation){const d=e.data;d.animation=(d.animation||[]).concat(r.data.animation)}}const o=r.features;if(o)for(let s=0;s<o.length;s++){const a=o[s];a&&a.ngInherit&&a(e),a===Mt&&(n=!1)}}t=Object.getPrototypeOf(t)}!function wre(e){let t=0,n=null;for(let i=e.length-1;i>=0;i--){const r=e[i];r.hostVars=t+=r.hostVars,r.hostAttrs=Xp(r.hostAttrs,n=Xp(n,r.hostAttrs))}}(i)}function Tre(e,t){for(const n in t.inputs){if(!t.inputs.hasOwnProperty(n)||e.inputs.hasOwnProperty(n))continue;const i=t.inputs[n];if(void 0!==i&&(e.inputs[n]=i,e.declaredInputs[n]=t.declaredInputs[n],null!==t.inputTransforms)){const r=Array.isArray(i)?i[0]:i;if(!t.inputTransforms.hasOwnProperty(r))continue;e.inputTransforms??={},e.inputTransforms[r]=t.inputTransforms[r]}}}function qv(e){return e===zs?{}:e===Pt?[]:e}function Ire(e,t){const n=e.viewQuery;e.viewQuery=n?(i,r)=>{t(i,r),n(i,r)}:t}function Rre(e,t){const n=e.contentQueries;e.contentQueries=n?(i,r,o)=>{t(i,r,o),n(i,r,o)}:t}function Are(e,t){const n=e.hostBindings;e.hostBindings=n?(i,r)=>{t(i,r),n(i,r)}:t}function Yv(e){const t=e.inputConfig,n={};for(const i in t)if(t.hasOwnProperty(i)){const r=t[i];Array.isArray(r)&&r[3]&&(n[i]=r[3])}e.inputTransforms=n}class Gl{}class T2{}class ow extends Gl{constructor(t,n,i){super(),this._parent=n,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new KL(this);const r=ar(t);this._bootstrapComponents=mo(r.bootstrap),this._r3Injector=qx(t,n,[{provide:Gl,useValue:this},{provide:Iu,useValue:this.componentFactoryResolver},...i],Ai(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class sw extends T2{constructor(t){super(),this.moduleType=t}create(t){return new ow(this.moduleType,t,[])}}class w2 extends Gl{constructor(t){super(),this.componentFactoryResolver=new KL(this),this.instance=null;const n=new nu([...t.providers,{provide:Gl,useValue:this},{provide:Iu,useValue:this.componentFactoryResolver}],t.parent||Z_(),t.debugName,new Set(["environment"]));this.injector=n,t.runEnvironmentInitializers&&n.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function $v(e,t,n=null){return new w2({providers:e,parent:t,debugName:n,runEnvironmentInitializers:!0}).injector}let Au=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Sr(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const n=this.taskId++;return this.pendingTasks.add(n),n}remove(n){this.pendingTasks.delete(n),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Zv(e){return!!function aw(e){return null!==e&&("function"==typeof e||"object"==typeof e)}(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function na(e,t,n){return e[t]=n}function hi(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function Wl(e,t,n,i){const r=hi(e,t,n);return hi(e,t+1,i)||r}function an(e,t,n,i,r,o,s,a){const c=K(),l=yt(),d=e+qe,u=l.firstCreatePass?function jre(e,t,n,i,r,o,s,a,c){const l=t.consts,d=Cu(t,e,4,s||null,Ys(l,a));A0(t,n,d,Ys(l,c)),ov(t,d);const u=d.tView=R0(2,d,i,r,o,t.directiveRegistry,t.pipeRegistry,null,t.schemas,l,null);return null!==t.queries&&(t.queries.template(t,d),u.queries=t.queries.embeddedTView(d)),d}(d,l,c,t,n,i,r,o,s):l.data[d];$s(u,!1);const h=I2(l,c,u,e);cf()&&Ov(l,c,h,u),hr(h,c);const p=gL(h,c,h,u);return c[d]=p,Mv(c,p),function JL(e,t,n){return X0(e,t,n)}(p,u,c),nv(u)&&w0(l,c,u),null!=s&&I0(c,u,a),an}let I2=function R2(e,t,n,i){return Xs(!0),t[je].createComment("")};function yi(e,t,n,i){const r=K();return hi(r,Es(),t)&&(yt(),Qs(An(),r,e,t,n,i)),yi}function rE(e,t){return e<<17|t<<2}function kc(e){return e>>17&32767}function _w(e){return 2|e}function Kl(e){return(131068&e)>>2}function vw(e,t){return-131069&e|t<<2}function Ew(e){return 1|e}function rF(e,t,n,i){const r=e[n+1],o=null===t;let s=i?kc(r):Kl(r),a=!1;for(;0!==s&&(!1===a||o);){const l=e[s+1];Roe(e[s],t)&&(a=!0,e[s+1]=i?Ew(l):_w(l)),s=i?kc(l):Kl(l)}a&&(e[n+1]=i?_w(r):Ew(r))}function Roe(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&tu(e,t)>=0}const Pi={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function oF(e){return e.substring(Pi.key,Pi.keyEnd)}function sF(e,t){const n=Pi.textEnd;return n===t?-1:(t=Pi.keyEnd=function Noe(e,t,n){for(;t<n&&e.charCodeAt(t)>32;)t++;return t}(e,Pi.key=t,n),Wu(e,t,n))}function Wu(e,t,n){for(;t<n&&e.charCodeAt(t)<=32;)t++;return t}function ht(e,t,n){const i=K();return hi(i,Es(),t)&&qr(yt(),An(),i,e,t,i[je],n,!1),ht}function bw(e,t,n,i,r){const s=r?"class":"style";P0(e,n,t.inputs[s],s,i)}function yw(e,t,n){return Ss(e,t,n,!1),yw}function wt(e,t){return Ss(e,t,null,!0),wt}function Sw(e){!function Cs(e,t,n,i){const r=yt(),o=Wa(2);r.firstUpdatePass&&hF(r,null,o,i);const s=K();if(n!==Je&&hi(s,o,n)){const a=r.data[ur()];if(gF(a,i)&&!uF(r,o)){let c=i?a.classesWithoutHost:a.stylesWithoutHost;null!==c&&(n=VC(c,n||"")),bw(r,a,s,n,i)}else!function joe(e,t,n,i,r,o,s,a){r===Je&&(r=Pt);let c=0,l=0,d=0<r.length?r[0]:null,u=0<o.length?o[0]:null;for(;null!==d||null!==u;){const h=c<r.length?r[c+1]:void 0,p=l<o.length?o[l+1]:void 0;let f,m=null;d===u?(c+=2,l+=2,h!==p&&(m=u,f=p)):null===u||null!==d&&d<u?(c+=2,m=d):(l+=2,m=u,f=p),null!==m&&fF(e,t,n,i,m,f,s,a),d=c<r.length?r[c]:null,u=l<o.length?o[l]:null}}(r,a,s,s[je],s[o+1],s[o+1]=function Voe(e,t,n){if(null==n||""===n)return Pt;const i=[],r=Oc(n);if(Array.isArray(r))for(let o=0;o<r.length;o++)e(i,r[o],!0);else if("object"==typeof r)for(const o in r)r.hasOwnProperty(o)&&e(i,o,r[o]);else"string"==typeof r&&t(i,r);return i}(e,t,n),i,o)}}(Boe,ra,e,!0)}function ra(e,t){for(let n=function Doe(e){return function cF(e){Pi.key=0,Pi.keyEnd=0,Pi.value=0,Pi.valueEnd=0,Pi.textEnd=e.length}(e),sF(e,Wu(e,0,Pi.textEnd))}(t);n>=0;n=sF(t,n))ho(e,oF(t),!0)}function Ss(e,t,n,i){const r=K(),o=yt(),s=Wa(2);o.firstUpdatePass&&hF(o,e,s,i),t!==Je&&hi(r,s,t)&&fF(o,o.data[ur()],r,r[je],e,r[s+1]=function Hoe(e,t){return null==e||""===e||("string"==typeof t?e+=t:"object"==typeof e&&(e=Ai(Oc(e)))),e}(t,n),i,s)}function uF(e,t){return t>=e.expandoStartIndex}function hF(e,t,n,i){const r=e.data;if(null===r[n+1]){const o=r[ur()],s=uF(e,n);gF(o,i)&&null===t&&!s&&(t=!1),t=function koe(e,t,n,i){const r=function IT(e){const t=He.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let o=i?t.residualClasses:t.residualStyles;if(null===r)0===(i?t.classBindings:t.styleBindings)&&(n=Kf(n=Cw(null,e,t,n,i),t.attrs,i),o=null);else{const s=t.directiveStylingLast;if(-1===s||e[s]!==r)if(n=Cw(r,e,t,n,i),null===o){let c=function Loe(e,t,n){const i=n?t.classBindings:t.styleBindings;if(0!==Kl(i))return e[kc(i)]}(e,t,i);void 0!==c&&Array.isArray(c)&&(c=Cw(null,e,t,c[1],i),c=Kf(c,t.attrs,i),function Foe(e,t,n,i){e[kc(n?t.classBindings:t.styleBindings)]=i}(e,t,i,c))}else o=function Uoe(e,t,n){let i;const r=t.directiveEnd;for(let o=1+t.directiveStylingLast;o<r;o++)i=Kf(i,e[o].hostAttrs,n);return Kf(i,t.attrs,n)}(e,t,i)}return void 0!==o&&(i?t.residualClasses=o:t.residualStyles=o),n}(r,o,t,i),function woe(e,t,n,i,r,o){let s=o?t.classBindings:t.styleBindings,a=kc(s),c=Kl(s);e[i]=n;let d,l=!1;if(Array.isArray(n)?(d=n[1],(null===d||tu(n,d)>0)&&(l=!0)):d=n,r)if(0!==c){const h=kc(e[a+1]);e[i+1]=rE(h,a),0!==h&&(e[h+1]=vw(e[h+1],i)),e[a+1]=function Coe(e,t){return 131071&e|t<<17}(e[a+1],i)}else e[i+1]=rE(a,0),0!==a&&(e[a+1]=vw(e[a+1],i)),a=i;else e[i+1]=rE(c,0),0===a?a=i:e[c+1]=vw(e[c+1],i),c=i;l&&(e[i+1]=_w(e[i+1])),rF(e,d,i,!0),rF(e,d,i,!1),function Ioe(e,t,n,i,r){const o=r?e.residualClasses:e.residualStyles;null!=o&&"string"==typeof t&&tu(o,t)>=0&&(n[i+1]=Ew(n[i+1]))}(t,d,e,i,o),s=rE(a,c),o?t.classBindings=s:t.styleBindings=s}(r,o,t,n,s,i)}}function Cw(e,t,n,i,r){let o=null;const s=n.directiveEnd;let a=n.directiveStylingLast;for(-1===a?a=n.directiveStart:a++;a<s&&(o=t[a],i=Kf(i,o.hostAttrs,r),o!==e);)a++;return null!==e&&(n.directiveStylingLast=a),i}function Kf(e,t,n){const i=n?1:2;let r=-1;if(null!==t)for(let o=0;o<t.length;o++){const s=t[o];"number"==typeof s?r=s:r===i&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),ho(e,s,!!n||t[++o]))}return void 0===e?null:e}function Boe(e,t,n){const i=String(t);""!==i&&!i.includes(" ")&&ho(e,i,n)}function fF(e,t,n,i,r,o,s,a){if(!(3&t.type))return;const c=e.data,l=c[a+1],d=function Toe(e){return!(1&~e)}(l)?mF(c,t,n,r,Kl(l),s):void 0;oE(d)||(oE(o)||function Soe(e){return!(2&~e)}(l)&&(o=mF(c,null,n,r,a,s)),function Cne(e,t,n,i,r){if(t)r?e.addClass(n,i):e.removeClass(n,i);else{let o=-1===i.indexOf("-")?void 0:Nc.DashCase;null==r?e.removeStyle(n,i,o):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),o|=Nc.Important),e.setStyle(n,i,r,o))}}(i,s,nf(ur(),n),r,o))}function mF(e,t,n,i,r,o){const s=null===t;let a;for(;r>0;){const c=e[r],l=Array.isArray(c),d=l?c[1]:c,u=null===d;let h=n[r+1];h===Je&&(h=u?Pt:void 0);let p=u?QC(h,i):d===i?h:void 0;if(l&&!oE(p)&&(p=QC(c,i)),oE(p)&&(a=p,s))return a;const m=e[r+1];r=s?kc(m):Kl(m)}if(null!==t){let c=o?t.residualClasses:t.residualStyles;null!=c&&(a=QC(c,i))}return a}function oE(e){return void 0!==e}function gF(e,t){return!!(e.flags&(t?8:16))}function wr(e,t,n){ta("NgControlFlow");const i=K(),r=Es(),o=function Iw(e,t){return e[t]}(i,qe+e);if(hi(i,r,t)){const a=ut(null);try{if(function x0(e,t){const n=Cf(e,t);return void 0!==n&&Av(n[se],n),n}(o,0),-1!==t){const c=function Rw(e,t){return rf(e,t)}(i[se],qe+t),l=wu(o,c.tView.ssrId);Af(o,Rf(i,c,n,{dehydratedView:l}),0,Tu(c,l))}}finally{ut(a)}}else{const a=function yL(e,t){const n=ui+t;if(n<e.length)return e[n]}(o,0);void 0!==a&&(a[Rn]=n)}}function ue(e,t,n,i){const r=K(),o=yt(),s=qe+e,a=r[je],c=o.firstCreatePass?function dse(e,t,n,i,r,o){const s=t.consts,c=Cu(t,e,2,i,Ys(s,r));return A0(t,n,c,Ys(s,o)),null!==c.attrs&&Gv(c,c.attrs,!1),null!==c.mergedAttrs&&Gv(c,c.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,c),c}(s,o,r,t,n,i):o.data[s],l=bF(o,r,c,a,t,e);r[s]=l;const d=nv(c);return $s(c,!0),sL(a,l,c),!function Hf(e){return!(32&~e.flags)}(c)&&cf()&&Ov(o,r,l,c),0===function ree(){return He.lFrame.elementDepthCount}()&&hr(l,r),function oee(){He.lFrame.elementDepthCount++}(),d&&(w0(o,r,c),T0(o,c,r)),null!==i&&I0(r,c),ue}function ve(){let e=on();CT()?TT():(e=e.parent,$s(e,!1));const t=e;(function aee(e){return He.skipHydrationRootTNode===e})(t)&&function uee(){He.skipHydrationRootTNode=null}(),function see(){He.lFrame.elementDepthCount--}();const n=yt();return n.firstCreatePass&&(ov(n,e),pT(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function Tee(e){return!!(8&e.flags)}(t)&&bw(n,t,K(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function wee(e){return!!(16&e.flags)}(t)&&bw(n,t,K(),t.stylesWithoutHost,!1),ve}function pt(e,t,n,i){return ue(e,t,n,i),ve(),pt}let bF=(e,t,n,i,r,o)=>(Xs(!0),Rv(i,r,function Ax(){return He.lFrame.currentNamespace}()));function qf(e,t,n){const i=K(),r=yt(),o=e+qe,s=r.firstCreatePass?function pse(e,t,n,i,r){const o=t.consts,s=Ys(o,i),a=Cu(t,e,8,"ng-container",s);return null!==s&&Gv(a,s,!0),A0(t,n,a,Ys(o,r)),null!==t.queries&&t.queries.elementStart(t,a),a}(o,r,i,t,n):r.data[o];$s(s,!0);const a=SF(r,i,s,e);return i[o]=a,cf()&&Ov(r,i,a,s),hr(a,i),nv(s)&&(w0(r,i,s),T0(r,s,i)),null!=n&&I0(i,s),qf}function Yf(){let e=on();const t=yt();return CT()?TT():(e=e.parent,$s(e,!1)),t.firstCreatePass&&(ov(t,e),pT(e)&&t.queries.elementEnd(e)),Yf}let SF=(e,t,n,i)=>(Xs(!0),g0(t[je],""));function $a(){return K()}function $f(e,t,n){const i=K();return hi(i,Es(),t)&&qr(yt(),An(),i,e,t,i[je],n,!0),$f}const Ku="en-US";let IF=Ku;function zt(e,t,n,i){const r=K(),o=yt(),s=on();return function Ow(e,t,n,i,r,o,s){const a=nv(i),l=e.firstCreatePass&&EL(e),d=t[Rn],u=vL(t);let h=!0;if(3&i.type||s){const f=Cr(i,t),g=s?s(f):f,E=u.length,b=s?I=>s(fn(I[i.index])):i.index;let T=null;if(!s&&a&&(T=function fae(e,t,n,i){const r=e.cleanup;if(null!=r)for(let o=0;o<r.length-1;o+=2){const s=r[o];if(s===n&&r[o+1]===i){const a=t[ou],c=r[o+2];return a.length>c?a[c]:null}"string"==typeof s&&(o+=2)}return null}(e,t,r,i.index)),null!==T)(T.__ngLastListenerFn__||T).__ngNextListenerFn__=o,T.__ngLastListenerFn__=o,h=!1;else{o=eU(i,t,d,o,!1);const I=n.listen(g,r,o);u.push(o,I),l&&l.push(r,b,E,E+1)}}else o=eU(i,t,d,o,!1);const p=i.outputs;let m;if(h&&null!==p&&(m=p[r])){const f=m.length;if(f)for(let g=0;g<f;g+=2){const D=t[m[g]][m[g+1]].subscribe(o),O=u.length;u.push(o,D),l&&l.push(r,i.index,O,-(O+1))}}}(o,r,r[je],s,e,t,i),zt}function QF(e,t,n,i){const r=ut(null);try{return qs(6,t,n),!1!==n(i)}catch(o){return xv(e,o),!1}finally{qs(7,t,n),ut(r)}}function eU(e,t,n,i,r){return function o(s){if(s===Function)return i;Of(e.componentOffset>-1?fo(e.index,t):t);let c=QF(t,n,i,s),l=o.__ngNextListenerFn__;for(;l;)c=QF(t,n,l,s)&&c,l=l.__ngNextListenerFn__;return r&&!1===c&&s.preventDefault(),c}}function Kt(e=1){return function _ee(e){return(He.lFrame.contextLView=function gx(e,t){for(;e>0;)t=t[su],e--;return t}(e,He.lFrame.contextLView))[Rn]}(e)}function mae(e,t){let n=null;const i=function gQ(e){const t=e.attrs;if(null!=t){const n=t.indexOf(5);if(!(1&n))return t[n+1]}return null}(e);for(let r=0;r<t.length;r++){const o=t[r];if("*"!==o){if(null===i?K1(e,o,!0):EQ(i,o))return r}else n=r}return n}function qu(e){const t=K()[Wn][cr];if(!t.projection){const i=t.projection=function W_(e,t){const n=[];for(let i=0;i<e;i++)n.push(t);return n}(e?e.length:1,null),r=i.slice();let o=t.child;for(;null!==o;){const s=e?mae(o,e):0;null!==s&&(r[s]?r[s].projectionNext=o:i[s]=o,r[s]=o),o=o.next}}}function pr(e,t=0,n){const i=K(),r=yt(),o=Cu(r,qe+e,16,null,n||null);null===o.projection&&(o.projection=t),TT(),(!i[po]||du())&&32&~o.flags&&function yne(e,t,n){rL(t[je],0,t,n,v0(e,n,t),Jk(n.parent||t[cr],n,t))}(r,i,o)}function Xa(e,t,n,i){!function o2(e,t,n,i){const r=yt();if(r.firstCreatePass){const o=on();s2(r,new e2(t,n,i),o.index),function pre(e,t){const n=e.contentQueries||(e.contentQueries=[]);t!==(n.length?n[n.length-1]:-1)&&n.push(e.queries.length-1,t)}(r,e),!(2&~n)&&(r.staticContentQueries=!0)}return n2(r,K(),n)}(e,t,n,i)}function oa(e,t,n){!function r2(e,t,n){const i=yt();return i.firstCreatePass&&(s2(i,new e2(e,t,n),-1),!(2&~t)&&(i.staticViewQueries=!0)),n2(i,K(),t)}(e,t,n)}function ji(e){const t=K(),n=yt(),i=RT();rv(i+1);const r=iw(n,i);if(e.dirty&&function tee(e){return!(4&~e[Se])}(t)===!(2&~r.metadata.flags)){if(null===r.matches)e.reset([]);else{const o=a2(t,i);e.reset(o,Zx),e.notifyOnChanges()}return!0}return!1}function Hi(){return function nw(e,t){return e[Ha].queries[t].queryList}(K(),RT())}function nm(e){return lu(function hee(){return He.lFrame.contextLView}(),qe+e)}function fr(e,t=""){const n=K(),i=yt(),r=e+qe,o=i.firstCreatePass?Cu(i,r,1,t,null):i.data[r],s=EU(i,n,o,t,e);n[r]=s,cf()&&Ov(i,n,s,o),$s(o,!1)}let EU=(e,t,n,i,r)=>(Xs(!0),function m0(e,t){return e.createText(t)}(t[je],i));function Yl(e){return im("",e,""),Yl}function im(e,t,n){const i=K(),r=function Lu(e,t,n,i){return hi(e,Es(),n)?t+Ke(n)+i:Je}(i,e,t,n);return r!==Je&&function qa(e,t,n){const i=nf(t,e);!function Kk(e,t,n){e.setValue(t,n)}(e[je],i,n)}(i,ur(),r),im}function Pw(e,t,n,i,r){if(e=Ve(e),Array.isArray(e))for(let o=0;o<e.length;o++)Pw(e[o],t,n,i,r);else{const o=yt(),s=K(),a=on();let c=kl(e)?e:Ve(e.provide);const l=ex(e),d=1048575&a.providerIndexes,u=a.directiveStart,h=a.providerIndexes>>20;if(kl(e)||!e.multi){const p=new lf(l,r,H),m=xw(c,t,r?d:d+h,u);-1===m?(kT(lv(a,s),o,c),Mw(o,e,t.length),t.push(c),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),n.push(p),s.push(p)):(n[m]=p,s[m]=p)}else{const p=xw(c,t,d+h,u),m=xw(c,t,d,d+h),g=m>=0&&n[m];if(r&&!g||!r&&!(p>=0&&n[p])){kT(lv(a,s),o,c);const E=function kae(e,t,n,i,r){const o=new lf(e,n,H);return o.multi=[],o.index=t,o.componentProviders=0,OU(o,r,i&&!n),o}(r?xae:Mae,n.length,r,i,l);!r&&g&&(n[m].providerFactory=E),Mw(o,e,t.length,0),t.push(c),a.directiveStart++,a.directiveEnd++,r&&(a.providerIndexes+=1048576),n.push(E),s.push(E)}else Mw(o,e,p>-1?p:m,OU(n[r?m:p],l,!r&&i));!r&&i&&g&&n[m].componentProviders++}}}function Mw(e,t,n,i){const r=kl(t),o=function DQ(e){return!!e.useClass}(t);if(r||o){const c=(o?Ve(t.useClass):t).prototype.ngOnDestroy;if(c){const l=e.destroyHooks||(e.destroyHooks=[]);if(!r&&t.multi){const d=l.indexOf(n);-1===d?l.push(n,[i,c]):l[d+1].push(i,c)}else l.push(n,c)}}}function OU(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function xw(e,t,n,i){for(let r=n;r<i;r++)if(t[r]===e)return r;return-1}function Mae(e,t,n,i){return kw(this.multi,[])}function xae(e,t,n,i){const r=this.multi;let o;if(this.providerFactory){const s=this.providerFactory.componentProviders,a=Bl(n,n[se],this.providerFactory.index,i);o=a.slice(0,s),kw(r,o);for(let c=s;c<a.length;c++)o.push(a[c])}else o=[],kw(r,o);return o}function kw(e,t){for(let n=0;n<e.length;n++)t.push((0,e[n])());return t}function mn(e,t=[]){return n=>{n.providersResolver=(i,r)=>function Pae(e,t,n){const i=yt();if(i.firstCreatePass){const r=vs(e);Pw(n,i.data,i.blueprint,r,!0),Pw(t,i.data,i.blueprint,r,!1)}}(i,r?r(e):e,t)}}let Lae=(()=>{class e{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n)){const i=iT(0,n.type),r=i.length>0?$v([i],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n,r)}return this.cachedInjectors.get(n)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}static{this.\u0275prov=ae({token:e,providedIn:"environment",factory:()=>new e(Z(Hr))})}}return e})();function Lc(e){ta("NgStandalone"),e.getStandaloneInjector=t=>t.get(Lae).getOrCreateStandaloneInjector(e)}function PU(e,t,n,i,r,o,s){return function LU(e,t,n,i,r,o,s,a,c){const l=t+n;return function Bo(e,t,n,i,r,o){const s=Wl(e,t,n,i);return Wl(e,t+2,r,o)||s}(e,l,r,o,s,a)?na(e,l+4,c?i.call(c,r,o,s,a):i(r,o,s,a)):rm(e,l+4)}(K(),Tr(),e,t,n,i,r,o,s)}function rm(e,t){const n=e[t];return n===Je?void 0:n}function uE(e,t){const n=yt();let i;const r=e+qe;n.firstCreatePass?(i=function Yae(e,t){if(t)for(let n=t.length-1;n>=0;n--){const i=t[n];if(e===i.name)return i}}(t,n.pipeRegistry),n.data[r]=i,i.onDestroy&&(n.destroyHooks??=[]).push(r,i.onDestroy)):i=n.data[r];const o=i.factory||(i.factory=Ml(i.type)),a=Vr(H);try{const c=cv(!1),l=o();return cv(c),function Eae(e,t,n,i){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=i}(n,K(),r,l),l}finally{Vr(a)}}function hE(e,t,n){const i=e+qe,r=K(),o=lu(r,i);return function om(e,t){return e[se].data[t].pure}(r,i)?function MU(e,t,n,i,r,o){const s=t+n;return hi(e,s,r)?na(e,s+1,o?i.call(o,r):i(r)):rm(e,s+1)}(r,Tr(),t,o.transform,n,o):o.transform(n)}function Lw(e,t){return Lv(e,t)}let QU=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"platform"})}}return e})();const rV=new re(""),mE=new re("");let Ww,Hw=(()=>{class e{constructor(n,i,r){this._ngZone=n,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._callbacks=[],this.taskTrackingZone=null,Ww||(function zce(e){Ww=e}(r),r.addToWindow(i)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Le.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb()}});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(n)||(clearTimeout(i.timeoutId),!1))}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,i,r){let o=-1;i&&i>0&&(o=setTimeout(()=>{this._callbacks=this._callbacks.filter(s=>s.timeoutId!==o),n()},i)),this._callbacks.push({doneCb:n,timeoutId:o,updateCb:r})}whenStable(n,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,i,r){return[]}static{this.\u0275fac=function(i){return new(i||e)(Z(Le),Z(Gw),Z(mE))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac})}}return e})(),Gw=(()=>{class e{constructor(){this._applications=new Map}registerApplication(n,i){this._applications.set(n,i)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,i=!0){return Ww?.findTestabilityInTree(this,n,i)??null}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"platform"})}}return e})();function cm(e){return!!e&&"function"==typeof e.then}function oV(e){return!!e&&"function"==typeof e.subscribe}const zw=new re("");let Kw=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((n,i)=>{this.resolve=n,this.reject=i}),this.appInits=J(zw,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const n=[];for(const r of this.appInits){const o=r();if(cm(o))n.push(o);else if(oV(o)){const s=new Promise((a,c)=>{o.subscribe({complete:a,error:c})});n.push(s)}}const i=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{i()}).catch(r=>{this.reject(r)}),0===n.length&&i(),this.initialized=!0}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const qw=new re("");function cV(e,t){return Array.isArray(t)?t.reduce(cV,e):{...e,...t}}let sa=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=J($x),this.afterRenderEffectManager=J(Lf),this.externalTestViews=new Set,this.beforeRender=new vt,this.afterTick=new vt,this.componentTypes=[],this.components=[],this.isStable=J(Au).hasPendingTasks.pipe(Nt(n=>!n)),this._injector=J(Hr)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,i){const r=n instanceof xL;if(!this._injector.get(Kw).done)throw!r&&function wc(e){const t=mt(e)||Di(e)||er(e);return null!==t&&t.standalone}(n),new W(405,!1);let s;s=r?n:this._injector.get(Iu).resolveComponentFactory(n),this.componentTypes.push(s.componentType);const a=function Kce(e){return e.isBoundToModule}(s)?void 0:this._injector.get(Gl),l=s.create(Bi.NULL,[],i||s.selector,a),d=l.location.nativeElement,u=l.injector.get(rV,null);return u?.registerApplication(d),l.onDestroy(()=>{this.detachView(l.hostView),gE(this.components,l),u?.unregisterApplication(d)}),this._loadComponent(l),l}tick(){this._tick(!0)}_tick(n){if(this._runningTick)throw new W(101,!1);const i=ut(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(n)}catch(r){this.internalErrorHandler(r)}finally{this.afterTick.next(),this._runningTick=!1,ut(i)}}detectChangesInAttachedViews(n){let i=0;const r=this.afterRenderEffectManager;for(;;){if(i===TL)throw new W(103,!1);if(n){const o=0===i;this.beforeRender.next(o);for(let{_lView:s,notifyErrorHandler:a}of this._views)Yce(s,o,a)}if(i++,r.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:o})=>Yw(o))&&(r.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:o})=>Yw(o))))break}}attachView(n){const i=n;this._views.push(i),i.attachToAppRef(this)}detachView(n){const i=n;gE(this._views,i),i.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);const i=this._injector.get(qw,[]);[...this._bootstrapListeners,...i].forEach(r=>r(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>gE(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new W(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function gE(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function Yce(e,t,n){!t&&!Yw(e)||function $ce(e,t,n){let i;n?(i=0,e[Se]|=1024):i=64&e[Se]?0:1,kv(e,t,i)}(e,n,t)}function Yw(e){return bT(e)}class Xce{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let lV=(()=>{class e{compileModuleSync(n){return new sw(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const i=this.compileModuleSync(n),o=mo(ar(n).declarations).reduce((s,a)=>{const c=mt(a);return c&&s.push(new Vf(c)),s},[]);return new Xce(i,o)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Qce=(()=>{class e{constructor(){this.zone=J(Le),this.applicationRef=J(sa)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function ele(){const e=J(Le),t=J(Js);return n=>e.runOutsideAngular(()=>t.handleError(n))}let nle=(()=>{class e{constructor(){this.subscription=new li,this.initialized=!1,this.zone=J(Le),this.pendingTasks=J(Au)}initialize(){if(this.initialized)return;this.initialized=!0;let n=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(n=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Le.assertNotInAngularZone(),queueMicrotask(()=>{null!==n&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(n),n=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Le.assertInAngularZone(),n??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const aa=new re("",{providedIn:"root",factory:()=>J(aa,bt.Optional|bt.SkipSelf)||function ile(){return typeof $localize<"u"&&$localize.locale||Ku}()}),$w=new re("");let pV=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,i){const r=function Gie(e="zone.js",t){return"noop"===e?new BL:"zone.js"===e?new Le(t):e}(i?.ngZone,function hV(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:i?.ngZoneEventCoalescing,runCoalescing:i?.ngZoneRunCoalescing}));return r.run(()=>{const o=function kre(e,t,n){return new ow(e,t,n)}(n.moduleType,this.injector,function uV(e){return[{provide:Le,useFactory:e},{provide:xl,multi:!0,useFactory:()=>{const t=J(Qce,{optional:!0});return()=>t.initialize()}},{provide:xl,multi:!0,useFactory:()=>{const t=J(nle);return()=>{t.initialize()}}},{provide:$x,useFactory:ele}]}(()=>r)),s=o.injector.get(Js,null);return r.runOutsideAngular(()=>{const a=r.onError.subscribe({next:c=>{s.handleError(c)}});o.onDestroy(()=>{gE(this._modules,o),a.unsubscribe()})}),function aV(e,t,n){try{const i=n();return cm(i)?i.catch(r=>{throw t.runOutsideAngular(()=>e.handleError(r)),r}):i}catch(i){throw t.runOutsideAngular(()=>e.handleError(i)),i}}(s,r,()=>{const a=o.injector.get(Kw);return a.runInitializers(),a.donePromise.then(()=>(function RF(e){"string"==typeof e&&(IF=e.toLowerCase().replace(/_/g,"-"))}(o.injector.get(aa,Ku)||Ku),this._moduleDoBootstrap(o),o))})})}bootstrapModule(n,i=[]){const r=cV({},i);return function Jce(e,t,n){const i=new sw(n);return Promise.resolve(i)}(0,0,n).then(o=>this.bootstrapModuleFactory(o,r))}_moduleDoBootstrap(n){const i=n.injector.get(sa);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!n.instance.ngDoBootstrap)throw new W(-403,!1);n.instance.ngDoBootstrap(i)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new W(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const n=this._injector.get($w,null);n&&(n.forEach(i=>i()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static{this.\u0275fac=function(i){return new(i||e)(Z(Bi))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"platform"})}}return e})(),Fc=null;const fV=new re("");function mV(e,t,n=[]){const i=`Platform: ${t}`,r=new re(i);return(o=[])=>{let s=Xw();if(!s||s.injector.get(fV,!1)){const a=[...n,...o,{provide:r,useValue:!0}];e?e(a):function sle(e){if(Fc&&!Fc.get(fV,!1))throw new W(400,!1);(function sV(){!function SJ(e){m1=e}(()=>{throw new W(600,!1)})})(),Fc=e;const t=e.get(pV);(function _V(e){e.get(_k,null)?.forEach(n=>n())})(e)}(function gV(e=[],t){return Bi.create({name:t,providers:[{provide:sT,useValue:"platform"},{provide:$w,useValue:new Set([()=>Fc=null])},...e]})}(a,i))}return function ale(e){const t=Xw();if(!t)throw new W(401,!1);return t}()}}function Xw(){return Fc?.get(pV)??null}let Ts=(()=>{class e{static{this.__NG_ELEMENT_ID__=lle}}return e})();function lle(e){return function dle(e,t,n){if(Fl(e)&&!n){const i=fo(e.index,t);return new Nf(i,i)}return 47&e.type?new Nf(t[Wn],t):null}(on(),K(),!(16&~e))}class SV{constructor(){}supports(t){return Zv(t)}create(t){return new mle(t)}}const fle=(e,t)=>t;class mle{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||fle}forEachItem(t){let n;for(n=this._itHead;null!==n;n=n._next)t(n)}forEachOperation(t){let n=this._itHead,i=this._removalsHead,r=0,o=null;for(;n||i;){const s=!i||n&&n.currentIndex<TV(i,r,o)?n:i,a=TV(s,r,o),c=s.currentIndex;if(s===i)r--,i=i._nextRemoved;else if(n=n._next,null==s.previousIndex)r++;else{o||(o=[]);const l=a-r,d=c-r;if(l!=d){for(let h=0;h<l;h++){const p=h<o.length?o[h]:o[h]=0,m=p+h;d<=m&&m<l&&(o[h]=p+1)}o[s.previousIndex]=d-l}}a!==c&&t(s,a,c)}}forEachPreviousItem(t){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachMovedItem(t){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}forEachIdentityChange(t){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)t(n)}diff(t){if(null==t&&(t=[]),!Zv(t))throw new W(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r,o,s,n=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let a=0;a<this.length;a++)o=t[a],s=this._trackByFn(a,o),null!==n&&Object.is(n.trackById,s)?(i&&(n=this._verifyReinsertion(n,o,s,a)),Object.is(n.item,o)||this._addIdentityChange(n,o)):(n=this._mismatch(n,o,s,a),i=!0),n=n._next}else r=0,function Vre(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[Symbol.iterator]();let i;for(;!(i=n.next()).done;)t(i.value)}}(t,a=>{s=this._trackByFn(r,a),null!==n&&Object.is(n.trackById,s)?(i&&(n=this._verifyReinsertion(n,a,s,r)),Object.is(n.item,a)||this._addIdentityChange(n,a)):(n=this._mismatch(n,a,s,r),i=!0),n=n._next,r++}),this.length=r;return this._truncate(n),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,n,i,r){let o;return null===t?o=this._itTail:(o=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._reinsertAfter(t,o,r)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._moveAfter(t,o,r)):t=this._addAfter(new gle(n,i),o,r),t}_verifyReinsertion(t,n,i,r){let o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==o?t=this._reinsertAfter(o,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const n=t._next;this._addToRemovals(this._unlink(t)),t=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,n,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,o=t._nextRemoved;return null===r?this._removalsHead=o:r._nextRemoved=o,null===o?this._removalsTail=r:o._prevRemoved=r,this._insertAfter(t,n,i),this._addToMoves(t,i),t}_moveAfter(t,n,i){return this._unlink(t),this._insertAfter(t,n,i),this._addToMoves(t,i),t}_addAfter(t,n,i){return this._insertAfter(t,n,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,n,i){const r=null===n?this._itHead:n._next;return t._next=r,t._prev=n,null===r?this._itTail=t:r._prev=t,null===n?this._itHead=t:n._next=t,null===this._linkedRecords&&(this._linkedRecords=new CV),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const n=t._prev,i=t._next;return null===n?this._itHead=i:n._next=i,null===i?this._itTail=n:i._prev=n,t}_addToMoves(t,n){return t.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new CV),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,n){return t.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class gle{constructor(t,n){this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class _le{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,n){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===n||n<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const n=t._prevDup,i=t._nextDup;return null===n?this._head=i:n._nextDup=i,null===i?this._tail=n:i._prevDup=n,null===this._head}}class CV{constructor(){this.map=new Map}put(t){const n=t.trackById;let i=this.map.get(n);i||(i=new _le,this.map.set(n,i)),i.add(t)}get(t,n){const r=this.map.get(t);return r?r.get(t,n):null}remove(t){const n=t.trackById;return this.map.get(n).remove(t)&&this.map.delete(n),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function TV(e,t,n){const i=e.previousIndex;if(null===i)return i;let r=0;return n&&i<n.length&&(r=n[i]),i+t+r}function IV(){return new tI([new SV])}let tI=(()=>{class e{static{this.\u0275prov=ae({token:e,providedIn:"root",factory:IV})}constructor(n){this.factories=n}static create(n,i){if(null!=i){const r=i.factories.slice();n=n.concat(r)}return new e(n)}static extend(n){return{provide:e,useFactory:i=>e.create(n,i||IV()),deps:[[e,new H_,new j_]]}}find(n){const i=this.factories.find(r=>r.supports(n));if(null!=i)return i;throw new W(901,!1)}}return e})();const Sle=mV(null,"core",[]);let Cle=(()=>{class e{constructor(n){}static{this.\u0275fac=function(i){return new(i||e)(Z(sa))}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({})}}return e})();function Ar(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}function $V(e){const t=ut(null);try{return e()}finally{ut(t)}}let ZV=null;function Uc(){return ZV}class sde{}const Ut=new re("");let rI=(()=>{class e{historyGo(n){throw new Error("")}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:()=>J(cde),providedIn:"platform"})}}return e})();const ade=new re("");let cde=(()=>{class e extends rI{constructor(){super(),this._doc=J(Ut),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Uc().getBaseHref(this._doc)}onPopState(n){const i=Uc().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",n,!1),()=>i.removeEventListener("popstate",n)}onHashChange(n){const i=Uc().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",n,!1),()=>i.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,i,r){this._history.pushState(n,i,r)}replaceState(n,i,r){this._history.replaceState(n,i,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:()=>new e,providedIn:"platform"})}}return e})();function oI(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function JV(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Za(e){return e&&"?"!==e[0]?"?"+e:e}let Zl=(()=>{class e{historyGo(n){throw new Error("")}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:()=>J(eB),providedIn:"root"})}}return e})();const QV=new re("");let eB=(()=>{class e extends Zl{constructor(n,i){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??J(Ut).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return oI(this._baseHref,n)}path(n=!1){const i=this._platformLocation.pathname+Za(this._platformLocation.search),r=this._platformLocation.hash;return r&&n?`${i}${r}`:i}pushState(n,i,r,o){const s=this.prepareExternalUrl(r+Za(o));this._platformLocation.pushState(n,i,s)}replaceState(n,i,r,o){const s=this.prepareExternalUrl(r+Za(o));this._platformLocation.replaceState(n,i,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}static{this.\u0275fac=function(i){return new(i||e)(Z(rI),Z(QV,8))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),lde=(()=>{class e extends Zl{constructor(n,i){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){const i=this._platformLocation.hash??"#";return i.length>0?i.substring(1):i}prepareExternalUrl(n){const i=oI(this._baseHref,n);return i.length>0?"#"+i:i}pushState(n,i,r,o){let s=this.prepareExternalUrl(r+Za(o));0==s.length&&(s=this._platformLocation.pathname),this._platformLocation.pushState(n,i,s)}replaceState(n,i,r,o){let s=this.prepareExternalUrl(r+Za(o));0==s.length&&(s=this._platformLocation.pathname),this._platformLocation.replaceState(n,i,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}static{this.\u0275fac=function(i){return new(i||e)(Z(rI),Z(QV,8))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac})}}return e})(),Zu=(()=>{class e{constructor(n){this._subject=new Wt,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const i=this._locationStrategy.getBaseHref();this._basePath=function hde(e){if(new RegExp("^(https?:)?//").test(e)){const[,n]=e.split(/\/\/[^\/]+/);return n}return e}(JV(tB(i))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,i=""){return this.path()==this.normalize(n+Za(i))}normalize(n){return e.stripTrailingSlash(function ude(e,t){if(!e||!t.startsWith(e))return t;const n=t.substring(e.length);return""===n||["/",";","?","#"].includes(n[0])?n:t}(this._basePath,tB(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,i="",r=null){this._locationStrategy.pushState(r,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Za(i)),r)}replaceState(n,i="",r=null){this._locationStrategy.replaceState(r,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Za(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{const i=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",i){this._urlChangeListeners.forEach(r=>r(n,i))}subscribe(n,i,r){return this._subject.subscribe({next:n,error:i,complete:r})}static{this.normalizeQueryParams=Za}static{this.joinWithSlash=oI}static{this.stripTrailingSlash=JV}static{this.\u0275fac=function(i){return new(i||e)(Z(Zl))}}static{this.\u0275prov=ae({token:e,factory:()=>function dde(){return new Zu(Z(Zl))}(),providedIn:"root"})}}return e})();function tB(e){return e.replace(/\/index.html$/,"")}const mI=/\s+/,dB=[];let gI=(()=>{class e{constructor(n,i){this._ngEl=n,this._renderer=i,this.initialClasses=dB,this.stateMap=new Map}set klass(n){this.initialClasses=null!=n?n.trim().split(mI):dB}set ngClass(n){this.rawClass="string"==typeof n?n.trim().split(mI):n}ngDoCheck(){for(const i of this.initialClasses)this._updateState(i,!0);const n=this.rawClass;if(Array.isArray(n)||n instanceof Set)for(const i of n)this._updateState(i,!0);else if(null!=n)for(const i of Object.keys(n))this._updateState(i,!!n[i]);this._applyStateDiff()}_updateState(n,i){const r=this.stateMap.get(n);void 0!==r?(r.enabled!==i&&(r.changed=!0,r.enabled=i),r.touched=!0):this.stateMap.set(n,{enabled:i,changed:!0,touched:!0})}_applyStateDiff(){for(const n of this.stateMap){const i=n[0],r=n[1];r.changed?(this._toggleClass(i,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(i,!1),this.stateMap.delete(i)),r.touched=!1}}_toggleClass(n,i){(n=n.trim()).length>0&&n.split(mI).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}static{this.\u0275fac=function(i){return new(i||e)(H(sn),H(ea))}}static{this.\u0275dir=ye({type:e,selectors:[["","ngClass",""]],inputs:{klass:[we.None,"class","klass"],ngClass:"ngClass"},standalone:!0})}}return e})();class Jde{constructor(t,n,i,r){this.$implicit=t,this.ngForOf=n,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let hB=(()=>{class e{set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}constructor(n,i,r){this._viewContainer=n,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const i=this._viewContainer;n.forEachOperation((r,o,s)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new Jde(r.item,this._ngForOf,-1,-1),null===s?void 0:s);else if(null==s)i.remove(null===o?void 0:o);else if(null!==o){const a=i.get(o);i.move(a,s),pB(a,r)}});for(let r=0,o=i.length;r<o;r++){const a=i.get(r).context;a.index=r,a.count=o,a.ngForOf=this._ngForOf}n.forEachIdentityChange(r=>{pB(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(n,i){return!0}static{this.\u0275fac=function(i){return new(i||e)(H(Vo),H(Ya),H(tI))}}static{this.\u0275dir=ye({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}}return e})();function pB(e,t){e.context.$implicit=t.item}let hm=(()=>{class e{constructor(n,i){this._viewContainer=n,this._context=new Qde,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){fB("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){fB("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,i){return!0}static{this.\u0275fac=function(i){return new(i||e)(H(Vo),H(Ya))}}static{this.\u0275dir=ye({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}}return e})();class Qde{constructor(){this.$implicit=null,this.ngIf=null}}function fB(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${Ai(t)}'.`)}let gB=(()=>{class e{constructor(n){this._viewContainerRef=n,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(n){if(this._shouldRecreateView(n)){const i=this._viewContainerRef;if(this._viewRef&&i.remove(i.indexOf(this._viewRef)),!this.ngTemplateOutlet)return void(this._viewRef=null);const r=this._createContextForwardProxy();this._viewRef=i.createEmbeddedView(this.ngTemplateOutlet,r,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(n){return!!n.ngTemplateOutlet||!!n.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(n,i,r)=>!!this.ngTemplateOutletContext&&Reflect.set(this.ngTemplateOutletContext,i,r),get:(n,i,r)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,i,r)}})}static{this.\u0275fac=function(i){return new(i||e)(H(Vo))}}static{this.\u0275dir=ye({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[Gr]})}}return e})();class oue{createSubscription(t,n){return $V(()=>t.subscribe({next:n,error:i=>{throw i}}))}dispose(t){$V(()=>t.unsubscribe())}}class sue{createSubscription(t,n){return t.then(n,i=>{throw i})}dispose(t){}}const aue=new sue,cue=new oue;let EI=(()=>{class e{constructor(n){this._latestValue=null,this.markForCheckOnValueUpdate=!0,this._subscription=null,this._obj=null,this._strategy=null,this._ref=n}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(n){if(!this._obj){if(n)try{this.markForCheckOnValueUpdate=!1,this._subscribe(n)}finally{this.markForCheckOnValueUpdate=!0}return this._latestValue}return n!==this._obj?(this._dispose(),this.transform(n)):this._latestValue}_subscribe(n){this._obj=n,this._strategy=this._selectStrategy(n),this._subscription=this._strategy.createSubscription(n,i=>this._updateLatestValue(n,i))}_selectStrategy(n){if(cm(n))return aue;if(oV(n))return cue;throw function Is(e,t){return new W(2100,!1)}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(n,i){n===this._obj&&(this._latestValue=i,this.markForCheckOnValueUpdate&&this._ref?.markForCheck())}static{this.\u0275fac=function(i){return new(i||e)(H(Ts,16))}}static{this.\u0275pipe=jr({name:"async",type:e,pure:!1,standalone:!0})}}return e})(),FE=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({})}}return e})();const vB="browser";function EB(e){return e===vB}function bB(e){return"server"===e}let Due=(()=>{class e{static{this.\u0275prov=ae({token:e,providedIn:"root",factory:()=>EB(J(Dc))?new Oue(J(Ut),window):new Pue})}}return e})();class Oue{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(t){this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){const n=function Nue(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const i=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const o=r.shadowRoot;if(o){const s=o.getElementById(t)||o.querySelector(`[name="${t}"]`);if(s)return s}r=i.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){this.window.history.scrollRestoration=t}scrollToElement(t){const n=t.getBoundingClientRect(),i=n.left+this.window.pageXOffset,r=n.top+this.window.pageYOffset,o=this.offset();this.window.scrollTo(i-o[0],r-o[1])}}class Pue{setOffset(t){}getScrollPosition(){return[0,0]}scrollToPosition(t){}scrollToAnchor(t){}setHistoryScrollRestoration(t){}}class ahe extends sde{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class CI extends ahe{static makeCurrent(){!function ode(e){ZV??=e}(new CI)}onAndCancel(t,n,i){return t.addEventListener(n,i),()=>{t.removeEventListener(n,i)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function che(){return mm=mm||document.querySelector("base"),mm?mm.getAttribute("href"):null}();return null==n?null:function lhe(e){return new URL(e,document.baseURI).pathname}(n)}resetBaseElement(){mm=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return function Xde(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const i=n.indexOf("="),[r,o]=-1==i?[n,""]:[n.slice(0,i),n.slice(i+1)];if(r.trim()===t)return decodeURIComponent(o)}return null}(document.cookie,t)}}let mm=null,uhe=(()=>{class e{build(){return new XMLHttpRequest}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac})}}return e})();const TI=new re("");let DB=(()=>{class e{constructor(n,i){this._zone=i,this._eventNameToPlugin=new Map,n.forEach(r=>{r.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,i,r){return this._findPluginFor(i).addEventListener(n,i,r)}getZone(){return this._zone}_findPluginFor(n){let i=this._eventNameToPlugin.get(n);if(i)return i;if(i=this._plugins.find(o=>o.supports(n)),!i)throw new W(5101,!1);return this._eventNameToPlugin.set(n,i),i}static{this.\u0275fac=function(i){return new(i||e)(Z(TI),Z(Le))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac})}}return e})();class OB{constructor(t){this._doc=t}}const wI="ng-app-id";let NB=(()=>{class e{constructor(n,i,r,o={}){this.doc=n,this.appId=i,this.nonce=r,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=bB(o),this.resetHostNodes()}addStyles(n){for(const i of n)1===this.changeUsageCount(i,1)&&this.onStyleAdded(i)}removeStyles(n){for(const i of n)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){const n=this.styleNodesInDOM;n&&(n.forEach(i=>i.remove()),n.clear());for(const i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(const i of this.getAllStyles())this.addStyleToHost(n,i)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(const i of this.hostNodes)this.addStyleToHost(i,n)}onStyleRemoved(n){const i=this.styleRef;i.get(n)?.elements?.forEach(r=>r.remove()),i.delete(n)}collectServerRenderedStyles(){const n=this.doc.head?.querySelectorAll(`style[${wI}="${this.appId}"]`);if(n?.length){const i=new Map;return n.forEach(r=>{null!=r.textContent&&i.set(r.textContent,r)}),i}return null}changeUsageCount(n,i){const r=this.styleRef;if(r.has(n)){const o=r.get(n);return o.usage+=i,o.usage}return r.set(n,{usage:i,elements:[]}),i}getStyleElement(n,i){const r=this.styleNodesInDOM,o=r?.get(i);if(o?.parentNode===n)return r.delete(i),o.removeAttribute(wI),o;{const s=this.doc.createElement("style");return this.nonce&&s.setAttribute("nonce",this.nonce),s.textContent=i,this.platformIsServer&&s.setAttribute(wI,this.appId),n.appendChild(s),s}}addStyleToHost(n,i){const r=this.getStyleElement(n,i),o=this.styleRef,s=o.get(i)?.elements;s?s.push(r):o.set(i,{elements:[r],usage:1})}resetHostNodes(){const n=this.hostNodes;n.clear(),n.add(this.doc.head)}static{this.\u0275fac=function(i){return new(i||e)(Z(Ut),Z(mf),Z(WT,8),Z(Dc))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac})}}return e})();const II={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},RI=/%COMP%/g,mhe=new re("",{providedIn:"root",factory:()=>!0});function MB(e,t){return t.map(n=>n.replace(RI,e))}let AI=(()=>{class e{constructor(n,i,r,o,s,a,c,l=null){this.eventManager=n,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestroy=o,this.doc=s,this.platformId=a,this.ngZone=c,this.nonce=l,this.rendererByCompId=new Map,this.platformIsServer=bB(a),this.defaultRenderer=new DI(n,s,c,this.platformIsServer)}createRenderer(n,i){if(!n||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===fs.ShadowDom&&(i={...i,encapsulation:fs.Emulated});const r=this.getOrCreateRenderer(n,i);return r instanceof kB?r.applyToHost(n):r instanceof OI&&r.applyStyles(),r}getOrCreateRenderer(n,i){const r=this.rendererByCompId;let o=r.get(i.id);if(!o){const s=this.doc,a=this.ngZone,c=this.eventManager,l=this.sharedStylesHost,d=this.removeStylesOnCompDestroy,u=this.platformIsServer;switch(i.encapsulation){case fs.Emulated:o=new kB(c,l,i,this.appId,d,s,a,u);break;case fs.ShadowDom:return new Ehe(c,l,n,i,s,a,this.nonce,u);default:o=new OI(c,l,i,d,s,a,u)}r.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(i){return new(i||e)(Z(DB),Z(NB),Z(mf),Z(mhe),Z(Ut),Z(Dc),Z(Le),Z(WT))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac})}}return e})();class DI{constructor(t,n,i,r){this.eventManager=t,this.doc=n,this.ngZone=i,this.platformIsServer=r,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(t,n){return n?this.doc.createElementNS(II[n]||n,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,n){(xB(t)?t.content:t).appendChild(n)}insertBefore(t,n,i){t&&(xB(t)?t.content:t).insertBefore(n,i)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let i="string"==typeof t?this.doc.querySelector(t):t;if(!i)throw new W(-5104,!1);return n||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,i,r){if(r){n=r+":"+n;const o=II[r];o?t.setAttributeNS(o,n,i):t.setAttribute(n,i)}else t.setAttribute(n,i)}removeAttribute(t,n,i){if(i){const r=II[i];r?t.removeAttributeNS(r,n):t.removeAttribute(`${i}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,i,r){r&(Nc.DashCase|Nc.Important)?t.style.setProperty(n,i,r&Nc.Important?"important":""):t.style[n]=i}removeStyle(t,n,i){i&Nc.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,i){null!=t&&(t[n]=i)}setValue(t,n){t.nodeValue=n}listen(t,n,i){if("string"==typeof t&&!(t=Uc().getGlobalEventTarget(this.doc,t)))throw new Error(`Unsupported event target ${t} for event ${n}`);return this.eventManager.addEventListener(t,n,this.decoratePreventDefault(i))}decoratePreventDefault(t){return n=>{if("__ngUnwrap__"===n)return t;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>t(n)):t(n))&&n.preventDefault()}}}function xB(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class Ehe extends DI{constructor(t,n,i,r,o,s,a,c){super(t,o,s,c),this.sharedStylesHost=n,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const l=MB(r.id,r.styles);for(const d of l){const u=document.createElement("style");a&&u.setAttribute("nonce",a),u.textContent=d,this.shadowRoot.appendChild(u)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,i){return super.insertBefore(this.nodeOrShadowRoot(t),n,i)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class OI extends DI{constructor(t,n,i,r,o,s,a,c){super(t,o,s,a),this.sharedStylesHost=n,this.removeStylesOnCompDestroy=r,this.styles=c?MB(c,i.styles):i.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class kB extends OI{constructor(t,n,i,r,o,s,a,c){const l=r+"-"+i.id;super(t,n,i,o,s,a,c,l),this.contentAttr=function ghe(e){return"_ngcontent-%COMP%".replace(RI,e)}(l),this.hostAttr=function _he(e){return"_nghost-%COMP%".replace(RI,e)}(l)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,n){const i=super.createElement(t,n);return super.setAttribute(i,this.contentAttr,""),i}}let bhe=(()=>{class e extends OB{constructor(n){super(n)}supports(n){return!0}addEventListener(n,i,r){return n.addEventListener(i,r,!1),()=>this.removeEventListener(n,i,r)}removeEventListener(n,i,r){return n.removeEventListener(i,r)}static{this.\u0275fac=function(i){return new(i||e)(Z(Ut))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac})}}return e})();const LB=["alt","control","meta","shift"],yhe={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},She={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let Che=(()=>{class e extends OB{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,i,r){const o=e.parseEventName(i),s=e.eventCallback(o.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Uc().onAndCancel(n,o.domEventName,s))}static parseEventName(n){const i=n.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const o=e._normalizeKey(i.pop());let s="",a=i.indexOf("code");if(a>-1&&(i.splice(a,1),s="code."),LB.forEach(l=>{const d=i.indexOf(l);d>-1&&(i.splice(d,1),s+=l+".")}),s+=o,0!=i.length||0===o.length)return null;const c={};return c.domEventName=r,c.fullKey=s,c}static matchEventFullKeyCode(n,i){let r=yhe[n.key]||n.key,o="";return i.indexOf("code.")>-1&&(r=n.code,o="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),LB.forEach(s=>{s!==r&&(0,She[s])(n)&&(o+=s+".")}),o+=r,o===i)}static eventCallback(n,i,r){return o=>{e.matchEventFullKeyCode(o,n)&&r.runGuarded(()=>i(o))}}static _normalizeKey(n){return"esc"===n?"escape":n}static{this.\u0275fac=function(i){return new(i||e)(Z(Ut))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac})}}return e})();const UB=[{provide:Dc,useValue:vB},{provide:_k,useValue:function The(){CI.makeCurrent()},multi:!0},{provide:Ut,useFactory:function Ihe(){return function hte(e){GT=e}(document),document},deps:[]}],Rhe=mV(Sle,"browser",UB),Ahe=new re(""),VB=[{provide:mE,useClass:class dhe{addToWindow(t){Zt.getAngularTestability=(i,r=!0)=>{const o=t.findTestabilityInTree(i,r);if(null==o)throw new W(5103,!1);return o},Zt.getAllAngularTestabilities=()=>t.getAllTestabilities(),Zt.getAllAngularRootElements=()=>t.getAllRootElements(),Zt.frameworkStabilizers||(Zt.frameworkStabilizers=[]),Zt.frameworkStabilizers.push(i=>{const r=Zt.getAllAngularTestabilities();let o=r.length;const s=function(){o--,0==o&&i()};r.forEach(a=>{a.whenStable(s)})})}findTestabilityInTree(t,n,i){return null==n?null:t.getTestability(n)??(i?Uc().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null)}},deps:[]},{provide:rV,useClass:Hw,deps:[Le,Gw,mE]},{provide:Hw,useClass:Hw,deps:[Le,Gw,mE]}],BB=[{provide:sT,useValue:"root"},{provide:Js,useFactory:function whe(){return new Js},deps:[]},{provide:TI,useClass:bhe,multi:!0,deps:[Ut,Le,Dc]},{provide:TI,useClass:Che,multi:!0,deps:[Ut]},AI,NB,DB,{provide:j0,useExisting:AI},{provide:class Mue{},useClass:uhe,deps:[]},[]];let jB=(()=>{class e{constructor(n){}static withServerTransition(n){return{ngModule:e,providers:[{provide:mf,useValue:n.appId}]}}static{this.\u0275fac=function(i){return new(i||e)(Z(Ahe,12))}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({providers:[...BB,...VB],imports:[FE,Cle]})}}return e})(),Dhe=(()=>{class e{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}static{this.\u0275fac=function(i){return new(i||e)(Z(Ut))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Vc(e){return this instanceof Vc?(this.v=e,this):new Vc(e)}function YB(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function xI(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(o){n[o]=e[o]&&function(s){return new Promise(function(a,c){!function r(o,s,a,c){Promise.resolve(c).then(function(l){o({value:l,done:a})},s)}(a,c,(s=e[o](s)).done,s.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const kI=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function $B(e){return Ft(e?.then)}function XB(e){return Ft(e[FC])}function ZB(e){return Symbol.asyncIterator&&Ft(e?.[Symbol.asyncIterator])}function JB(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const QB=function ope(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function e3(e){return Ft(e?.[QB])}function t3(e){return function qB(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function s(p){return function(m){return Promise.resolve(m).then(p,u)}}),r[Symbol.asyncIterator]=function(){return this},r;function a(p,m){i[p]&&(r[p]=function(f){return new Promise(function(g,E){o.push([p,f,g,E])>1||c(p,f)})},m&&(r[p]=m(r[p])))}function c(p,m){try{!function l(p){p.value instanceof Vc?Promise.resolve(p.value.v).then(d,u):h(o[0][2],p)}(i[p](m))}catch(f){h(o[0][3],f)}}function d(p){c("next",p)}function u(p){c("throw",p)}function h(p,m){p(m),o.shift(),o.length&&c(o[0][0],o[0][1])}}(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:i,done:r}=yield Vc(n.read());if(r)return yield Vc(void 0);yield yield Vc(i)}}finally{n.releaseLock()}})}function n3(e){return Ft(e?.getReader)}function mr(e){if(e instanceof Gn)return e;if(null!=e){if(XB(e))return function spe(e){return new Gn(t=>{const n=e[FC]();if(Ft(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(kI(e))return function ape(e){return new Gn(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if($B(e))return function cpe(e){return new Gn(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,b1)})}(e);if(ZB(e))return i3(e);if(e3(e))return function lpe(e){return new Gn(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(n3(e))return function dpe(e){return i3(t3(e))}(e)}throw JB(e)}function i3(e){return new Gn(t=>{(function upe(e,t){var n,i,r,o;return function zB(e,t,n,i){return new(n||(n=Promise))(function(o,s){function a(d){try{l(i.next(d))}catch(u){s(u)}}function c(d){try{l(i.throw(d))}catch(u){s(u)}}function l(d){d.done?o(d.value):function r(o){return o instanceof n?o:new n(function(s){s(o)})}(d.value).then(a,c)}l((i=i.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=YB(e);!(i=yield n.next()).done;)if(t.next(i.value),t.closed)return}catch(s){r={error:s}}finally{try{i&&!i.done&&(o=n.return)&&(yield o.call(n))}finally{if(r)throw r.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function ec(e,t,n,i=0,r=!1){const o=t.schedule(function(){n(),r?e.add(this.schedule(null,i)):this.unsubscribe()},i);if(e.add(o),!r)return o}function r3(e,t=0){return Jn((n,i)=>{n.subscribe(Un(i,r=>ec(i,e,()=>i.next(r),t),()=>ec(i,e,()=>i.complete(),t),r=>ec(i,e,()=>i.error(r),t)))})}function o3(e,t=0){return Jn((n,i)=>{i.add(e.schedule(()=>n.subscribe(i),t))})}function s3(e,t){if(!e)throw new Error("Iterable cannot be null");return new Gn(n=>{ec(n,t,()=>{const i=e[Symbol.asyncIterator]();ec(n,t,()=>{i.next().then(r=>{r.done?n.complete():n.next(r.value)})},0,!0)})})}function xi(e,t){return t?function _pe(e,t){if(null!=e){if(XB(e))return function hpe(e,t){return mr(e).pipe(o3(t),r3(t))}(e,t);if(kI(e))return function fpe(e,t){return new Gn(n=>{let i=0;return t.schedule(function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||this.schedule())})})}(e,t);if($B(e))return function ppe(e,t){return mr(e).pipe(o3(t),r3(t))}(e,t);if(ZB(e))return s3(e,t);if(e3(e))return function mpe(e,t){return new Gn(n=>{let i;return ec(n,t,()=>{i=e[QB](),ec(n,t,()=>{let r,o;try{({value:r,done:o}=i.next())}catch(s){return void n.error(s)}o?n.complete():n.next(r)},0,!0)}),()=>Ft(i?.return)&&i.return()})}(e,t);if(n3(e))return function gpe(e,t){return s3(t3(e),t)}(e,t)}throw JB(e)}(e,t):mr(e)}const{isArray:vpe}=Array,{getPrototypeOf:Epe,prototype:bpe,keys:ype}=Object;function a3(e){if(1===e.length){const t=e[0];if(vpe(t))return{args:t,keys:null};if(function Spe(e){return e&&"object"==typeof e&&Epe(e)===bpe}(t)){const n=ype(t);return{args:n.map(i=>t[i]),keys:n}}}return{args:e,keys:null}}function c3(e){return e&&Ft(e.schedule)}function LI(e){return e[e.length-1]}function l3(e){return Ft(LI(e))?e.pop():void 0}function _m(e){return c3(LI(e))?e.pop():void 0}const{isArray:Tpe}=Array;function FI(e){return Nt(t=>function wpe(e,t){return Tpe(t)?e(...t):e(t)}(e,t))}function d3(e,t){return e.reduce((n,i,r)=>(n[i]=t[r],n),{})}let u3=(()=>{class e{constructor(n,i){this._renderer=n,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(n,i){this._renderer.setProperty(this._elementRef.nativeElement,n,i)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}static{this.\u0275fac=function(i){return new(i||e)(H(ea),H(sn))}}static{this.\u0275dir=ye({type:e})}}return e})(),Jl=(()=>{class e extends u3{static{this.\u0275fac=(()=>{let n;return function(r){return(n||(n=bi(e)))(r||e)}})()}static{this.\u0275dir=ye({type:e,features:[Mt]})}}return e})();const Rs=new re(""),Ape={provide:Rs,useExisting:pn(()=>jE),multi:!0},Ope=new re("");let jE=(()=>{class e extends u3{constructor(n,i,r){super(n,i),this._compositionMode=r,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function Dpe(){const e=Uc()?Uc().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(n){this.setProperty("value",n??"")}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}static{this.\u0275fac=function(i){return new(i||e)(H(ea),H(sn),H(Ope,8))}}static{this.\u0275dir=ye({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,r){1&i&&zt("input",function(s){return r._handleInput(s.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(s){return r._compositionEnd(s.target.value)})},features:[mn([Ape]),Mt]})}}return e})();function Bc(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}function p3(e){return null!=e&&"number"==typeof e.length}const Gi=new re(""),jc=new re(""),Npe=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class f3{static min(t){return function m3(e){return t=>{if(Bc(t.value)||Bc(e))return null;const n=parseFloat(t.value);return!isNaN(n)&&n<e?{min:{min:e,actual:t.value}}:null}}(t)}static max(t){return function g3(e){return t=>{if(Bc(t.value)||Bc(e))return null;const n=parseFloat(t.value);return!isNaN(n)&&n>e?{max:{max:e,actual:t.value}}:null}}(t)}static required(t){return function _3(e){return Bc(e.value)?{required:!0}:null}(t)}static requiredTrue(t){return function v3(e){return!0===e.value?null:{required:!0}}(t)}static email(t){return function E3(e){return Bc(e.value)||Npe.test(e.value)?null:{email:!0}}(t)}static minLength(t){return function b3(e){return t=>Bc(t.value)||!p3(t.value)?null:t.value.length<e?{minlength:{requiredLength:e,actualLength:t.value.length}}:null}(t)}static maxLength(t){return function y3(e){return t=>p3(t.value)&&t.value.length>e?{maxlength:{requiredLength:e,actualLength:t.value.length}}:null}(t)}static pattern(t){return function S3(e){if(!e)return HE;let t,n;return"string"==typeof e?(n="","^"!==e.charAt(0)&&(n+="^"),n+=e,"$"!==e.charAt(e.length-1)&&(n+="$"),t=new RegExp(n)):(n=e.toString(),t=e),i=>{if(Bc(i.value))return null;const r=i.value;return t.test(r)?null:{pattern:{requiredPattern:n,actualValue:r}}}}(t)}static nullValidator(t){return null}static compose(t){return A3(t)}static composeAsync(t){return D3(t)}}function HE(e){return null}function C3(e){return null!=e}function T3(e){return cm(e)?xi(e):e}function w3(e){let t={};return e.forEach(n=>{t=null!=n?{...t,...n}:t}),0===Object.keys(t).length?null:t}function I3(e,t){return t.map(n=>n(e))}function R3(e){return e.map(t=>function Ppe(e){return!e.validate}(t)?t:n=>t.validate(n))}function A3(e){if(!e)return null;const t=e.filter(C3);return 0==t.length?null:function(n){return w3(I3(n,t))}}function UI(e){return null!=e?A3(R3(e)):null}function D3(e){if(!e)return null;const t=e.filter(C3);return 0==t.length?null:function(n){return function Ipe(...e){const t=l3(e),{args:n,keys:i}=a3(e),r=new Gn(o=>{const{length:s}=n;if(!s)return void o.complete();const a=new Array(s);let c=s,l=s;for(let d=0;d<s;d++){let u=!1;mr(n[d]).subscribe(Un(o,h=>{u||(u=!0,l--),a[d]=h},()=>c--,void 0,()=>{(!c||!u)&&(l||o.next(i?d3(i,a):a),o.complete())}))}});return t?r.pipe(FI(t)):r}(I3(n,t).map(T3)).pipe(Nt(w3))}}function VI(e){return null!=e?D3(R3(e)):null}function O3(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}function N3(e){return e._rawValidators}function P3(e){return e._rawAsyncValidators}function BI(e){return e?Array.isArray(e)?e:[e]:[]}function GE(e,t){return Array.isArray(e)?e.includes(t):e===t}function M3(e,t){const n=BI(t);return BI(e).forEach(r=>{GE(n,r)||n.push(r)}),n}function x3(e,t){return BI(t).filter(n=>!GE(e,n))}class k3{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=UI(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=VI(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,n){return!!this.control&&this.control.hasError(t,n)}getError(t,n){return this.control?this.control.getError(t,n):null}}class Or extends k3{get formDirective(){return null}get path(){return null}}class tc extends k3{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class L3{constructor(t){this._cd=t}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let F3=(()=>{class e extends L3{constructor(n){super(n)}static{this.\u0275fac=function(i){return new(i||e)(H(tc,2))}}static{this.\u0275dir=ye({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,r){2&i&&wt("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},features:[Mt]})}}return e})(),U3=(()=>{class e extends L3{constructor(n){super(n)}static{this.\u0275fac=function(i){return new(i||e)(H(Or,10))}}static{this.\u0275dir=ye({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,r){2&i&&wt("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)("ng-submitted",r.isSubmitted)},features:[Mt]})}}return e})();const vm="VALID",zE="INVALID",Qu="PENDING",Em="DISABLED";function GI(e){return(KE(e)?e.validators:e)||null}function WI(e,t){return(KE(t)?t.asyncValidators:e)||null}function KE(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function B3(e,t,n){const i=e.controls;if(!(t?Object.keys(i):i).length)throw new W(1e3,"");if(!i[n])throw new W(1001,"")}function j3(e,t,n){e._forEachChild((i,r)=>{if(void 0===n[r])throw new W(1002,"")})}class qE{constructor(t,n){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(t),this._assignAsyncValidators(n)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===vm}get invalid(){return this.status===zE}get pending(){return this.status==Qu}get disabled(){return this.status===Em}get enabled(){return this.status!==Em}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(M3(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(M3(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(x3(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(x3(t,this._rawAsyncValidators))}hasValidator(t){return GE(this._rawValidators,t)}hasAsyncValidator(t){return GE(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(n=>{n.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(n=>{n.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=Qu,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const n=this._parentMarkedDirty(t.onlySelf);this.status=Em,this.errors=null,this._forEachChild(i=>{i.disable({...t,onlySelf:!0})}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...t,skipPristineCheck:n}),this._onDisabledChange.forEach(i=>i(!0))}enable(t={}){const n=this._parentMarkedDirty(t.onlySelf);this.status=vm,this._forEachChild(i=>{i.enable({...t,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors({...t,skipPristineCheck:n}),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===vm||this.status===Qu)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(n=>n._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Em:vm}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=Qu,this._hasOwnPendingAsyncValidator=!0;const n=T3(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,n={}){this.errors=t,this._updateControlsErrors(!1!==n.emitEvent)}get(t){let n=t;return null==n||(Array.isArray(n)||(n=n.split(".")),0===n.length)?null:n.reduce((i,r)=>i&&i._find(r),this)}getError(t,n){const i=n?this.get(n):this;return i&&i.errors?i.errors[t]:null}hasError(t,n){return!!this.getError(t,n)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new Wt,this.statusChanges=new Wt}_calculateStatus(){return this._allControlsDisabled()?Em:this.errors?zE:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Qu)?Qu:this._anyControlsHaveStatus(zE)?zE:vm}_anyControlsHaveStatus(t){return this._anyControls(n=>n.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){KE(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=function Lpe(e){return Array.isArray(e)?UI(e):e||null}(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=function Fpe(e){return Array.isArray(e)?VI(e):e||null}(this._rawAsyncValidators)}}class bm extends qE{constructor(t,n,i){super(GI(n),WI(i,n)),this.controls=t,this._initObservables(),this._setUpdateStrategy(n),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,n){return this.controls[t]?this.controls[t]:(this.controls[t]=n,n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange),n)}addControl(t,n,i={}){this.registerControl(t,n),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,n={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}setControl(t,n,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],n&&this.registerControl(t,n),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,n={}){j3(this,0,t),Object.keys(t).forEach(i=>{B3(this,!0,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}patchValue(t,n={}){null!=t&&(Object.keys(t).forEach(i=>{const r=this.controls[i];r&&r.patchValue(t[i],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}reset(t={},n={}){this._forEachChild((i,r)=>{i.reset(t?t[r]:null,{onlySelf:!0,emitEvent:n.emitEvent})}),this._updatePristine(n),this._updateTouched(n),this.updateValueAndValidity(n)}getRawValue(){return this._reduceChildren({},(t,n,i)=>(t[i]=n.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(n,i)=>!!i._syncPendingControls()||n);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(n=>{const i=this.controls[n];i&&t(i,n)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const[n,i]of Object.entries(this.controls))if(this.contains(n)&&t(i))return!0;return!1}_reduceValue(){return this._reduceChildren({},(n,i,r)=>((i.enabled||this.disabled)&&(n[r]=i.value),n))}_reduceChildren(t,n){let i=t;return this._forEachChild((r,o)=>{i=n(i,r,o)}),i}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}}class H3 extends bm{}const eh=new re("CallSetDisabledState",{providedIn:"root",factory:()=>YE}),YE="always";function ym(e,t,n=YE){zI(e,t),t.valueAccessor.writeValue(e.value),(e.disabled||"always"===n)&&t.valueAccessor.setDisabledState?.(e.disabled),function Vpe(e,t){t.valueAccessor.registerOnChange(n=>{e._pendingValue=n,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&G3(e,t)})}(e,t),function jpe(e,t){const n=(i,r)=>{t.valueAccessor.writeValue(i),r&&t.viewToModelUpdate(i)};e.registerOnChange(n),t._registerOnDestroy(()=>{e._unregisterOnChange(n)})}(e,t),function Bpe(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&G3(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function Upe(e,t){if(t.valueAccessor.setDisabledState){const n=i=>{t.valueAccessor.setDisabledState(i)};e.registerOnDisabledChange(n),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(n)})}}(e,t)}function XE(e,t,n=!0){const i=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(i),t.valueAccessor.registerOnTouched(i)),JE(e,t),e&&(t._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function ZE(e,t){e.forEach(n=>{n.registerOnValidatorChange&&n.registerOnValidatorChange(t)})}function zI(e,t){const n=N3(e);null!==t.validator?e.setValidators(O3(n,t.validator)):"function"==typeof n&&e.setValidators([n]);const i=P3(e);null!==t.asyncValidator?e.setAsyncValidators(O3(i,t.asyncValidator)):"function"==typeof i&&e.setAsyncValidators([i]);const r=()=>e.updateValueAndValidity();ZE(t._rawValidators,r),ZE(t._rawAsyncValidators,r)}function JE(e,t){let n=!1;if(null!==e){if(null!==t.validator){const r=N3(e);if(Array.isArray(r)&&r.length>0){const o=r.filter(s=>s!==t.validator);o.length!==r.length&&(n=!0,e.setValidators(o))}}if(null!==t.asyncValidator){const r=P3(e);if(Array.isArray(r)&&r.length>0){const o=r.filter(s=>s!==t.asyncValidator);o.length!==r.length&&(n=!0,e.setAsyncValidators(o))}}}const i=()=>{};return ZE(t._rawValidators,i),ZE(t._rawAsyncValidators,i),n}function G3(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function W3(e,t){zI(e,t)}function z3(e,t){e._syncPendingControls(),t.forEach(n=>{const i=n.control;"submit"===i.updateOn&&i._pendingChange&&(n.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}const Kpe={provide:Or,useExisting:pn(()=>QE)},Sm=Promise.resolve();let QE=(()=>{class e extends Or{constructor(n,i,r){super(),this.callSetDisabledState=r,this.submitted=!1,this._directives=new Set,this.ngSubmit=new Wt,this.form=new bm({},UI(n),VI(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(n){Sm.then(()=>{const i=this._findContainer(n.path);n.control=i.registerControl(n.name,n.control),ym(n.control,n,this.callSetDisabledState),n.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(n)})}getControl(n){return this.form.get(n.path)}removeControl(n){Sm.then(()=>{const i=this._findContainer(n.path);i&&i.removeControl(n.name),this._directives.delete(n)})}addFormGroup(n){Sm.then(()=>{const i=this._findContainer(n.path),r=new bm({});W3(r,n),i.registerControl(n.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(n){Sm.then(()=>{const i=this._findContainer(n.path);i&&i.removeControl(n.name)})}getFormGroup(n){return this.form.get(n.path)}updateModel(n,i){Sm.then(()=>{this.form.get(n.path).setValue(i)})}setValue(n){this.control.setValue(n)}onSubmit(n){return this.submitted=!0,z3(this.form,this._directives),this.ngSubmit.emit(n),"dialog"===n?.target?.method}onReset(){this.resetForm()}resetForm(n=void 0){this.form.reset(n),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(n){return n.pop(),n.length?this.form.get(n):this.form}static{this.\u0275fac=function(i){return new(i||e)(H(Gi,10),H(jc,10),H(eh,8))}}static{this.\u0275dir=ye({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,r){1&i&&zt("submit",function(s){return r.onSubmit(s)})("reset",function(){return r.onReset()})},inputs:{options:[we.None,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[mn([Kpe]),Mt]})}}return e})();function K3(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function q3(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const Cm=class extends qE{constructor(t=null,n,i){super(GI(n),WI(i,n)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(n),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),KE(n)&&(n.nonNullable||n.initialValueIsDefault)&&(this.defaultValue=q3(t)?t.value:t)}setValue(t,n={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==n.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==n.emitViewToModelChange)),this.updateValueAndValidity(n)}patchValue(t,n={}){this.setValue(t,n)}reset(t=this.defaultValue,n={}){this._applyFormState(t),this.markAsPristine(n),this.markAsUntouched(n),this.setValue(this.value,n),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){K3(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){K3(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){q3(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}};Promise.resolve();let J3=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275dir=ye({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return e})();const $I=new re(""),tfe={provide:Or,useExisting:pn(()=>Tm)};let Tm=(()=>{class e extends Or{constructor(n,i,r){super(),this.callSetDisabledState=r,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Wt,this._setValidators(n),this._setAsyncValidators(i)}ngOnChanges(n){this._checkFormPresent(),n.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(JE(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(n){const i=this.form.get(n.path);return ym(i,n,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(n),i}getControl(n){return this.form.get(n.path)}removeControl(n){XE(n.control||null,n,!1),function zpe(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}(this.directives,n)}addFormGroup(n){this._setUpFormContainer(n)}removeFormGroup(n){this._cleanUpFormContainer(n)}getFormGroup(n){return this.form.get(n.path)}addFormArray(n){this._setUpFormContainer(n)}removeFormArray(n){this._cleanUpFormContainer(n)}getFormArray(n){return this.form.get(n.path)}updateModel(n,i){this.form.get(n.path).setValue(i)}onSubmit(n){return this.submitted=!0,z3(this.form,this.directives),this.ngSubmit.emit(n),"dialog"===n?.target?.method}onReset(){this.resetForm()}resetForm(n=void 0){this.form.reset(n),this.submitted=!1}_updateDomValue(){this.directives.forEach(n=>{const i=n.control,r=this.form.get(n.path);i!==r&&(XE(i||null,n),(e=>e instanceof Cm)(r)&&(ym(r,n,this.callSetDisabledState),n.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(n){const i=this.form.get(n.path);W3(i,n),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(n){if(this.form){const i=this.form.get(n.path);i&&function Hpe(e,t){return JE(e,t)}(i,n)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){zI(this.form,this),this._oldForm&&JE(this._oldForm,this)}_checkFormPresent(){}static{this.\u0275fac=function(i){return new(i||e)(H(Gi,10),H(jc,10),H(eh,8))}}static{this.\u0275dir=ye({type:e,selectors:[["","formGroup",""]],hostBindings:function(i,r){1&i&&zt("submit",function(s){return r.onSubmit(s)})("reset",function(){return r.onReset()})},inputs:{form:[we.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[mn([tfe]),Mt,Gr]})}}return e})();const rfe={provide:tc,useExisting:pn(()=>JI)};let JI=(()=>{class e extends tc{set isDisabled(n){}static{this._ngModelWarningSentOnce=!1}constructor(n,i,r,o,s){super(),this._ngModelWarningConfig=s,this._added=!1,this.name=null,this.update=new Wt,this._ngModelWarningSent=!1,this._parent=n,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=function YI(e,t){if(!t)return null;let n,i,r;return Array.isArray(t),t.forEach(o=>{o.constructor===jE?n=o:function Wpe(e){return Object.getPrototypeOf(e.constructor)===Jl}(o)?i=o:r=o}),r||i||n||null}(0,o)}ngOnChanges(n){this._added||this._setUpControl(),function qI(e,t){if(!e.hasOwnProperty("model"))return!1;const n=e.model;return!!n.isFirstChange()||!Object.is(t,n.currentValue)}(n,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}get path(){return function $E(e,t){return[...t.path,e]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static{this.\u0275fac=function(i){return new(i||e)(H(Or,13),H(Gi,10),H(jc,10),H(Rs,10),H($I,8))}}static{this.\u0275dir=ye({type:e,selectors:[["","formControlName",""]],inputs:{name:[we.None,"formControlName","name"],isDisabled:[we.None,"disabled","isDisabled"],model:[we.None,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[mn([rfe]),Mt,Gr]})}}return e})(),Efe=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({})}}return e})();class fj extends qE{constructor(t,n,i){super(GI(n),WI(i,n)),this.controls=t,this._initObservables(),this._setUpdateStrategy(n),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(t){return this.controls[this._adjustIndex(t)]}push(t,n={}){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}insert(t,n,i={}){this.controls.splice(t,0,n),this._registerControl(n),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(t,n={}){let i=this._adjustIndex(t);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),this.updateValueAndValidity({emitEvent:n.emitEvent})}setControl(t,n,i={}){let r=this._adjustIndex(t);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),n&&(this.controls.splice(r,0,n),this._registerControl(n)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,n={}){j3(this,0,t),t.forEach((i,r)=>{B3(this,!1,r),this.at(r).setValue(i,{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}patchValue(t,n={}){null!=t&&(t.forEach((i,r)=>{this.at(r)&&this.at(r).patchValue(i,{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}reset(t=[],n={}){this._forEachChild((i,r)=>{i.reset(t[r],{onlySelf:!0,emitEvent:n.emitEvent})}),this._updatePristine(n),this._updateTouched(n),this.updateValueAndValidity(n)}getRawValue(){return this.controls.map(t=>t.getRawValue())}clear(t={}){this.controls.length<1||(this._forEachChild(n=>n._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:t.emitEvent}))}_adjustIndex(t){return t<0?t+this.length:t}_syncPendingControls(){let t=this.controls.reduce((n,i)=>!!i._syncPendingControls()||n,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){this.controls.forEach((n,i)=>{t(n,i)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(n=>n.enabled&&t(n))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_allControlsDisabled(){for(const t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}_find(t){return this.at(t)??null}}function mj(e){return!!e&&(void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn)}let iR,bfe=(()=>{class e{constructor(){this.useNonNullable=!1}get nonNullable(){const n=new e;return n.useNonNullable=!0,n}group(n,i=null){const r=this._reduceControls(n);let o={};return mj(i)?o=i:null!==i&&(o.validators=i.validator,o.asyncValidators=i.asyncValidator),new bm(r,o)}record(n,i=null){const r=this._reduceControls(n);return new H3(r,i)}control(n,i,r){let o={};return this.useNonNullable?(mj(i)?o=i:(o.validators=i,o.asyncValidators=r),new Cm(n,{...o,nonNullable:!0})):new Cm(n,i,r)}array(n,i,r){const o=n.map(s=>this._createControl(s));return new fj(o,i,r)}_reduceControls(n){const i={};return Object.keys(n).forEach(r=>{i[r]=this._createControl(n[r])}),i}_createControl(n){return n instanceof Cm||n instanceof qE?n:Array.isArray(n)?this.control(n[0],n.length>1?n[1]:null,n.length>2?n[2]:null):this.control(n)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),yfe=(()=>{class e extends bfe{group(n,i=null){return super.group(n,i)}control(n,i,r){return super.control(n,i,r)}array(n,i,r){return super.array(n,i,r)}static{this.\u0275fac=(()=>{let n;return function(r){return(n||(n=bi(e)))(r||e)}})()}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Sfe=(()=>{class e{static withConfig(n){return{ngModule:e,providers:[{provide:$I,useValue:n.warnOnNgModelWithFormControl??"always"},{provide:eh,useValue:n.callSetDisabledState??YE}]}}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({imports:[Efe]})}}return e})();try{iR=typeof Intl<"u"&&Intl.v8BreakIterator}catch{iR=!1}let th,tr=(()=>{class e{constructor(n){this._platformId=n,this.isBrowser=this._platformId?EB(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!iR)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}static{this.\u0275fac=function(i){return new(i||e)(Z(Dc))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const gj=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function _j(){if(th)return th;if("object"!=typeof document||!document)return th=new Set(gj),th;let e=document.createElement("input");return th=new Set(gj.filter(t=>(e.setAttribute("type",t),e.type===t))),th}let wm,ed,rR;function nh(e){return function Cfe(){if(null==wm&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>wm=!0}))}finally{wm=wm||!1}return wm}()?e:!!e.capture}function Tfe(){if(null==ed){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return ed=!1,ed;if("scrollBehavior"in document.documentElement.style)ed=!0;else{const e=Element.prototype.scrollTo;ed=!!e&&!/\{\s*\[native code\]\s*\}/.test(e.toString())}}return ed}function Hc(e){return e.composedPath?e.composedPath()[0]:e.target}function oR(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function Be(...e){return xi(e,_m(e))}function Wi(e,t,n){const i=Ft(e)||t||n?{next:e,error:t,complete:n}:e;return i?Jn((r,o)=>{var s;null===(s=i.subscribe)||void 0===s||s.call(i);let a=!0;r.subscribe(Un(o,c=>{var l;null===(l=i.next)||void 0===l||l.call(i,c),o.next(c)},()=>{var c;a=!1,null===(c=i.complete)||void 0===c||c.call(i),o.complete()},c=>{var l;a=!1,null===(l=i.error)||void 0===l||l.call(i,c),o.error(c)},()=>{var c,l;a&&(null===(c=i.unsubscribe)||void 0===c||c.call(i)),null===(l=i.finalize)||void 0===l||l.call(i)}))}):Sc}class Kfe extends li{constructor(t,n){super()}schedule(t,n=0){return this}}const tb={setInterval(e,t,...n){const{delegate:i}=tb;return i?.setInterval?i.setInterval(e,t,...n):setInterval(e,t,...n)},clearInterval(e){const{delegate:t}=tb;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};class sR extends Kfe{constructor(t,n){super(t,n),this.scheduler=t,this.work=n,this.pending=!1}schedule(t,n=0){var i;if(this.closed)return this;this.state=t;const r=this.id,o=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(o,r,n)),this.pending=!0,this.delay=n,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(o,this.id,n),this}requestAsyncId(t,n,i=0){return tb.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,n,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return n;null!=n&&tb.clearInterval(n)}execute(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,n);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,n){let r,i=!1;try{this.work(t)}catch(o){i=!0,r=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:t,scheduler:n}=this,{actions:i}=n;this.work=this.state=this.scheduler=null,this.pending=!1,D_(i,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,super.unsubscribe()}}}const aR={now:()=>(aR.delegate||Date).now(),delegate:void 0};class Rm{constructor(t,n=Rm.now){this.schedulerActionCtor=t,this.now=n}schedule(t,n=0,i){return new this.schedulerActionCtor(this,t).schedule(i,n)}}Rm.now=aR.now;class cR extends Rm{constructor(t,n=Rm.now){super(t,n),this.actions=[],this._active=!1}flush(t){const{actions:n}=this;if(this._active)return void n.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=n.shift());if(this._active=!1,i){for(;t=n.shift();)t.unsubscribe();throw i}}}const Am=new cR(sR),qfe=Am;function $r(e,t){return Jn((n,i)=>{let r=0;n.subscribe(Un(i,o=>e.call(t,o,r++)&&i.next(o)))})}const Go=new Gn(e=>e.complete());function Ti(e){return e<=0?()=>Go:Jn((t,n)=>{let i=0;t.subscribe(Un(n,r=>{++i<=e&&(n.next(r),e<=i&&n.complete())}))})}function bj(e){return $r((t,n)=>e<=n)}function Xfe(e,t){return e===t}function gr(e){return Jn((t,n)=>{mr(e).subscribe(Un(n,()=>n.complete(),N_)),!n.closed&&t.subscribe(n)})}let Zfe=(()=>{class e{create(n){return typeof MutationObserver>"u"?null:new MutationObserver(n)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),yj=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({providers:[Zfe]})}}return e})();function ih(e){return null!=e&&"false"!=`${e}`}function Sj(e,t=0){return function Jfe(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}(e)?Number(e):t}function nb(e){return Array.isArray(e)?e:[e]}function wi(e){return null==e?"":"string"==typeof e?e:`${e}px`}function Gc(e){return e instanceof sn?e.nativeElement:e}function ib(...e){const t=_m(e),n=l3(e),{args:i,keys:r}=a3(e);if(0===i.length)return xi([],t);const o=new Gn(function Qfe(e,t,n=Sc){return i=>{Cj(t,()=>{const{length:r}=e,o=new Array(r);let s=r,a=r;for(let c=0;c<r;c++)Cj(t,()=>{const l=xi(e[c],t);let d=!1;l.subscribe(Un(i,u=>{o[c]=u,d||(d=!0,a--),a||i.next(n(o.slice()))},()=>{--s||i.complete()}))},i)},i)}}(i,t,r?s=>d3(r,s):Sc));return n?o.pipe(FI(n)):o}function Cj(e,t,n){e?ec(n,e,t):t()}function zi(e,t,n=1/0){return Ft(t)?zi((i,r)=>Nt((o,s)=>t(i,o,r,s))(mr(e(i,r))),n):("number"==typeof t&&(n=t),Jn((i,r)=>function eme(e,t,n,i,r,o,s,a){const c=[];let l=0,d=0,u=!1;const h=()=>{u&&!c.length&&!l&&t.complete()},p=f=>l<i?m(f):c.push(f),m=f=>{o&&t.next(f),l++;let g=!1;mr(n(f,d++)).subscribe(Un(t,E=>{r?.(E),o?p(E):t.next(E)},()=>{g=!0},void 0,()=>{if(g)try{for(l--;c.length&&l<i;){const E=c.shift();s?ec(t,s,()=>m(E)):m(E)}h()}catch(E){t.error(E)}}))};return e.subscribe(Un(t,p,()=>{u=!0,h()})),()=>{a?.()}}(i,r,e,n)))}function rh(e=1/0){return zi(Sc,e)}function Dm(...e){return function tme(){return rh(1)}()(xi(e,_m(e)))}function Tj(...e){const t=_m(e);return Jn((n,i)=>{(t?Dm(e,n,t):Dm(e,n)).subscribe(i)})}const wj=new Set;let td,nme=(()=>{class e{constructor(n,i){this._platform=n,this._nonce=i,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):rme}matchMedia(n){return(this._platform.WEBKIT||this._platform.BLINK)&&function ime(e,t){if(!wj.has(e))try{td||(td=document.createElement("style"),t&&td.setAttribute("nonce",t),td.setAttribute("type","text/css"),document.head.appendChild(td)),td.sheet&&(td.sheet.insertRule(`@media ${e} {body{ }}`,0),wj.add(e))}catch(n){console.error(n)}}(n,this._nonce),this._matchMedia(n)}static{this.\u0275fac=function(i){return new(i||e)(Z(tr),Z(WT,8))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function rme(e){return{matches:"all"===e||""===e,media:e,addListener:()=>{},removeListener:()=>{}}}let ome=(()=>{class e{constructor(n,i){this._mediaMatcher=n,this._zone=i,this._queries=new Map,this._destroySubject=new vt}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(n){return Ij(nb(n)).some(r=>this._registerQuery(r).mql.matches)}observe(n){let o=ib(Ij(nb(n)).map(s=>this._registerQuery(s).observable));return o=Dm(o.pipe(Ti(1)),o.pipe(bj(1),function Ej(e,t=Am){return Jn((n,i)=>{let r=null,o=null,s=null;const a=()=>{if(r){r.unsubscribe(),r=null;const l=o;o=null,i.next(l)}};function c(){const l=s+e,d=t.now();if(d<l)return r=this.schedule(void 0,l-d),void i.add(r);a()}n.subscribe(Un(i,l=>{o=l,s=t.now(),r||(r=t.schedule(c,e),i.add(r))},()=>{a(),i.complete()},void 0,()=>{o=r=null}))})}(0))),o.pipe(Nt(s=>{const a={matches:!1,breakpoints:{}};return s.forEach(({matches:c,query:l})=>{a.matches=a.matches||c,a.breakpoints[l]=c}),a}))}_registerQuery(n){if(this._queries.has(n))return this._queries.get(n);const i=this._mediaMatcher.matchMedia(n),o={observable:new Gn(s=>{const a=c=>this._zone.run(()=>s.next(c));return i.addListener(a),()=>{i.removeListener(a)}}).pipe(Tj(i),Nt(({matches:s})=>({query:n,matches:s})),gr(this._destroySubject)),mql:i};return this._queries.set(n,o),o}static{this.\u0275fac=function(i){return new(i||e)(Z(nme),Z(Le))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Ij(e){return e.map(t=>t.split(",")).reduce((t,n)=>t.concat(n)).map(t=>t.trim())}function rb(e,t){return e.getAttribute(t)?.match(/\S+/g)??[]}const Aj="cdk-describedby-message",ob="cdk-describedby-host";let lR=0,cme=(()=>{class e{constructor(n,i){this._platform=i,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+lR++,this._document=n,this._id=J(mf)+"-"+lR++}describe(n,i,r){if(!this._canBeDescribed(n,i))return;const o=dR(i,r);"string"!=typeof i?(Dj(i,this._id),this._messageRegistry.set(o,{messageElement:i,referenceCount:0})):this._messageRegistry.has(o)||this._createMessageElement(i,r),this._isElementDescribedByMessage(n,o)||this._addMessageReference(n,o)}removeDescription(n,i,r){if(!i||!this._isElementNode(n))return;const o=dR(i,r);if(this._isElementDescribedByMessage(n,o)&&this._removeMessageReference(n,o),"string"==typeof i){const s=this._messageRegistry.get(o);s&&0===s.referenceCount&&this._deleteMessageElement(o)}0===this._messagesContainer?.childNodes.length&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){const n=this._document.querySelectorAll(`[${ob}="${this._id}"]`);for(let i=0;i<n.length;i++)this._removeCdkDescribedByReferenceIds(n[i]),n[i].removeAttribute(ob);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(n,i){const r=this._document.createElement("div");Dj(r,this._id),r.textContent=n,i&&r.setAttribute("role",i),this._createMessagesContainer(),this._messagesContainer.appendChild(r),this._messageRegistry.set(dR(n,i),{messageElement:r,referenceCount:0})}_deleteMessageElement(n){this._messageRegistry.get(n)?.messageElement?.remove(),this._messageRegistry.delete(n)}_createMessagesContainer(){if(this._messagesContainer)return;const n="cdk-describedby-message-container",i=this._document.querySelectorAll(`.${n}[platform="server"]`);for(let o=0;o<i.length;o++)i[o].remove();const r=this._document.createElement("div");r.style.visibility="hidden",r.classList.add(n),r.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&r.setAttribute("platform","server"),this._document.body.appendChild(r),this._messagesContainer=r}_removeCdkDescribedByReferenceIds(n){const i=rb(n,"aria-describedby").filter(r=>0!=r.indexOf(Aj));n.setAttribute("aria-describedby",i.join(" "))}_addMessageReference(n,i){const r=this._messageRegistry.get(i);(function sme(e,t,n){const i=rb(e,t);n=n.trim(),!i.some(r=>r.trim()===n)&&(i.push(n),e.setAttribute(t,i.join(" ")))})(n,"aria-describedby",r.messageElement.id),n.setAttribute(ob,this._id),r.referenceCount++}_removeMessageReference(n,i){const r=this._messageRegistry.get(i);r.referenceCount--,function ame(e,t,n){const i=rb(e,t);n=n.trim();const r=i.filter(o=>o!==n);r.length?e.setAttribute(t,r.join(" ")):e.removeAttribute(t)}(n,"aria-describedby",r.messageElement.id),n.removeAttribute(ob)}_isElementDescribedByMessage(n,i){const r=rb(n,"aria-describedby"),o=this._messageRegistry.get(i),s=o&&o.messageElement.id;return!!s&&-1!=r.indexOf(s)}_canBeDescribed(n,i){if(!this._isElementNode(n))return!1;if(i&&"object"==typeof i)return!0;const r=null==i?"":`${i}`.trim(),o=n.getAttribute("aria-label");return!(!r||o&&o.trim()===r)}_isElementNode(n){return n.nodeType===this._document.ELEMENT_NODE}static{this.\u0275fac=function(i){return new(i||e)(Z(Ut),Z(tr))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function dR(e,t){return"string"==typeof e?`${t||""}/${e}`:e}function Dj(e,t){e.id||(e.id=`${Aj}-${t}-${lR++}`)}function Nj(e){return 0===e.buttons||0===e.detail}function Pj(e){const t=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}const gme=new re("cdk-input-modality-detector-options"),_me={ignoreKeys:[18,17,224,91,16]},oh=nh({passive:!0,capture:!0});let vme=(()=>{class e{get mostRecentModality(){return this._modality.value}constructor(n,i,r,o){this._platform=n,this._mostRecentTarget=null,this._modality=new Sr(null),this._lastTouchMs=0,this._onKeydown=s=>{this._options?.ignoreKeys?.some(a=>a===s.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Hc(s))},this._onMousedown=s=>{Date.now()-this._lastTouchMs<650||(this._modality.next(Nj(s)?"keyboard":"mouse"),this._mostRecentTarget=Hc(s))},this._onTouchstart=s=>{Pj(s)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Hc(s))},this._options={..._me,...o},this.modalityDetected=this._modality.pipe(bj(1)),this.modalityChanged=this.modalityDetected.pipe(function $fe(e,t=Sc){return e=e??Xfe,Jn((n,i)=>{let r,o=!0;n.subscribe(Un(i,s=>{const a=t(s);(o||!e(r,a))&&(o=!1,r=a,i.next(s))}))})}()),n.isBrowser&&i.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,oh),r.addEventListener("mousedown",this._onMousedown,oh),r.addEventListener("touchstart",this._onTouchstart,oh)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,oh),document.removeEventListener("mousedown",this._onMousedown,oh),document.removeEventListener("touchstart",this._onTouchstart,oh))}static{this.\u0275fac=function(i){return new(i||e)(Z(tr),Z(Le),Z(Ut),Z(gme,8))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var sb=function(e){return e[e.IMMEDIATE=0]="IMMEDIATE",e[e.EVENTUAL=1]="EVENTUAL",e}(sb||{});const bme=new re("cdk-focus-monitor-default-options"),ab=nh({passive:!0,capture:!0});let uR=(()=>{class e{constructor(n,i,r,o,s){this._ngZone=n,this._platform=i,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new vt,this._rootNodeFocusAndBlurListener=a=>{for(let l=Hc(a);l;l=l.parentElement)"focus"===a.type?this._onFocus(a,l):this._onBlur(a,l)},this._document=o,this._detectionMode=s?.detectionMode||sb.IMMEDIATE}monitor(n,i=!1){const r=Gc(n);if(!this._platform.isBrowser||1!==r.nodeType)return Be();const o=function Ife(e){if(function wfe(){if(null==rR){const e=typeof document<"u"?document.head:null;rR=!(!e||!e.createShadowRoot&&!e.attachShadow)}return rR}()){const t=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(r)||this._getDocument(),s=this._elementInfo.get(r);if(s)return i&&(s.checkChildren=!0),s.subject;const a={checkChildren:i,subject:new vt,rootNode:o};return this._elementInfo.set(r,a),this._registerGlobalListeners(a),a.subject}stopMonitoring(n){const i=Gc(n),r=this._elementInfo.get(i);r&&(r.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(r))}focusVia(n,i,r){const o=Gc(n);o===this._getDocument().activeElement?this._getClosestElementsInfo(o).forEach(([a,c])=>this._originChanged(a,i,c)):(this._setOrigin(i),"function"==typeof o.focus&&o.focus(r))}ngOnDestroy(){this._elementInfo.forEach((n,i)=>this.stopMonitoring(i))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(n){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(n)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:n&&this._isLastInteractionFromInputLabel(n)?"mouse":"program"}_shouldBeAttributedToTouch(n){return this._detectionMode===sb.EVENTUAL||!!n?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(n,i){n.classList.toggle("cdk-focused",!!i),n.classList.toggle("cdk-touch-focused","touch"===i),n.classList.toggle("cdk-keyboard-focused","keyboard"===i),n.classList.toggle("cdk-mouse-focused","mouse"===i),n.classList.toggle("cdk-program-focused","program"===i)}_setOrigin(n,i=!1){this._ngZone.runOutsideAngular(()=>{this._origin=n,this._originFromTouchInteraction="touch"===n&&i,this._detectionMode===sb.IMMEDIATE&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(n,i){const r=this._elementInfo.get(i),o=Hc(n);!r||!r.checkChildren&&i!==o||this._originChanged(i,this._getFocusOrigin(o),r)}_onBlur(n,i){const r=this._elementInfo.get(i);!r||r.checkChildren&&n.relatedTarget instanceof Node&&i.contains(n.relatedTarget)||(this._setClasses(i),this._emitOrigin(r,null))}_emitOrigin(n,i){n.subject.observers.length&&this._ngZone.run(()=>n.subject.next(i))}_registerGlobalListeners(n){if(!this._platform.isBrowser)return;const i=n.rootNode,r=this._rootNodeFocusListenerCount.get(i)||0;r||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,ab),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,ab)}),this._rootNodeFocusListenerCount.set(i,r+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(gr(this._stopInputModalityDetector)).subscribe(o=>{this._setOrigin(o,!0)}))}_removeGlobalListeners(n){const i=n.rootNode;if(this._rootNodeFocusListenerCount.has(i)){const r=this._rootNodeFocusListenerCount.get(i);r>1?this._rootNodeFocusListenerCount.set(i,r-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,ab),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,ab),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(n,i,r){this._setClasses(n,i),this._emitOrigin(r,i),this._lastFocusOrigin=i}_getClosestElementsInfo(n){const i=[];return this._elementInfo.forEach((r,o)=>{(o===n||r.checkChildren&&o.contains(n))&&i.push([o,r])}),i}_isLastInteractionFromInputLabel(n){const{_mostRecentTarget:i,mostRecentModality:r}=this._inputModalityDetector;if("mouse"!==r||!i||i===n||"INPUT"!==n.nodeName&&"TEXTAREA"!==n.nodeName||n.disabled)return!1;const o=n.labels;if(o)for(let s=0;s<o.length;s++)if(o[s].contains(i))return!0;return!1}static{this.\u0275fac=function(i){return new(i||e)(Z(Le),Z(tr),Z(vme),Z(Ut,8),Z(bme,8))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var nd=function(e){return e[e.NONE=0]="NONE",e[e.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",e[e.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",e}(nd||{});const xj="cdk-high-contrast-black-on-white",kj="cdk-high-contrast-white-on-black",hR="cdk-high-contrast-active";let Lj=(()=>{class e{constructor(n,i){this._platform=n,this._document=i,this._breakpointSubscription=J(ome).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return nd.NONE;const n=this._document.createElement("div");n.style.backgroundColor="rgb(1,2,3)",n.style.position="absolute",this._document.body.appendChild(n);const i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(n):null,o=(r&&r.backgroundColor||"").replace(/ /g,"");switch(n.remove(),o){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return nd.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return nd.BLACK_ON_WHITE}return nd.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const n=this._document.body.classList;n.remove(hR,xj,kj),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();i===nd.BLACK_ON_WHITE?n.add(hR,xj):i===nd.WHITE_ON_BLACK&&n.add(hR,kj)}}static{this.\u0275fac=function(i){return new(i||e)(Z(tr),Z(Ut))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),yme=(()=>{class e{constructor(n){n._applyBodyHighContrastModeCssClasses()}static{this.\u0275fac=function(i){return new(i||e)(Z(Lj))}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({imports:[yj]})}}return e})();const Sme=new re("cdk-dir-doc",{providedIn:"root",factory:function Cme(){return J(Ut)}}),Tme=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let pR=(()=>{class e{constructor(n){this.value="ltr",this.change=new Wt,n&&(this.value=function wme(e){const t=e?.toLowerCase()||"";return"auto"===t&&typeof navigator<"u"&&navigator?.language?Tme.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((n.body?n.body.dir:null)||(n.documentElement?n.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}static{this.\u0275fac=function(i){return new(i||e)(Z(Sme,8))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Om=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({})}}return e})();const Ime=["mat-internal-form-field",""],Rme=["*"],Dme=new re("mat-sanity-checks",{providedIn:"root",factory:function Ame(){return!0}});let Wo=(()=>{class e{constructor(n,i,r){this._sanityChecks=i,this._document=r,this._hasDoneGlobalChecks=!1,n._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(n){return!oR()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[n])}static{this.\u0275fac=function(i){return new(i||e)(Z(Lj),Z(Dme,8),Z(Ut))}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({imports:[Om,Om]})}}return e})();class Vj{constructor(t,n,i,r,o){this._defaultMatcher=t,this.ngControl=n,this._parentFormGroup=i,this._parentForm=r,this._stateChanges=o,this.errorState=!1}updateErrorState(){const t=this.errorState,n=this._parentFormGroup||this._parentForm,i=this.matcher||this._defaultMatcher,r=this.ngControl?this.ngControl.control:null,o=i?.isErrorState(r,n)??!1;o!==t&&(this.errorState=o,this._stateChanges.next())}}let kme=(()=>{class e{isErrorState(n,i){return!!(n&&n.invalid&&(n.touched||i&&i.submitted))}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var zo=function(e){return e[e.FADING_IN=0]="FADING_IN",e[e.VISIBLE=1]="VISIBLE",e[e.FADING_OUT=2]="FADING_OUT",e[e.HIDDEN=3]="HIDDEN",e}(zo||{});class Lme{constructor(t,n,i,r=!1){this._renderer=t,this.element=n,this.config=i,this._animationForciblyDisabledThroughCss=r,this.state=zo.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}}const Bj=nh({passive:!0,capture:!0});class Fme{constructor(){this._events=new Map,this._delegateEventHandler=t=>{const n=Hc(t);n&&this._events.get(t.type)?.forEach((i,r)=>{(r===n||r.contains(n))&&i.forEach(o=>o.handleEvent(t))})}}addHandler(t,n,i,r){const o=this._events.get(n);if(o){const s=o.get(i);s?s.add(r):o.set(i,new Set([r]))}else this._events.set(n,new Map([[i,new Set([r])]])),t.runOutsideAngular(()=>{document.addEventListener(n,this._delegateEventHandler,Bj)})}removeHandler(t,n,i){const r=this._events.get(t);if(!r)return;const o=r.get(n);o&&(o.delete(i),0===o.size&&r.delete(n),0===r.size&&(this._events.delete(t),document.removeEventListener(t,this._delegateEventHandler,Bj)))}}const jj={enterDuration:225,exitDuration:150},Hj=nh({passive:!0,capture:!0}),Gj=["mousedown","touchstart"],Wj=["mouseup","mouseleave","touchend","touchcancel"];class cb{static{this._eventManager=new Fme}constructor(t,n,i,r){this._target=t,this._ngZone=n,this._platform=r,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,r.isBrowser&&(this._containerElement=Gc(i))}fadeInRipple(t,n,i={}){const r=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),o={...jj,...i.animation};i.centered&&(t=r.left+r.width/2,n=r.top+r.height/2);const s=i.radius||function Vme(e,t,n){const i=Math.max(Math.abs(e-n.left),Math.abs(e-n.right)),r=Math.max(Math.abs(t-n.top),Math.abs(t-n.bottom));return Math.sqrt(i*i+r*r)}(t,n,r),a=t-r.left,c=n-r.top,l=o.enterDuration,d=document.createElement("div");d.classList.add("mat-ripple-element"),d.style.left=a-s+"px",d.style.top=c-s+"px",d.style.height=2*s+"px",d.style.width=2*s+"px",null!=i.color&&(d.style.backgroundColor=i.color),d.style.transitionDuration=`${l}ms`,this._containerElement.appendChild(d);const u=window.getComputedStyle(d),p=u.transitionDuration,m="none"===u.transitionProperty||"0s"===p||"0s, 0s"===p||0===r.width&&0===r.height,f=new Lme(this,d,i,m);d.style.transform="scale3d(1, 1, 1)",f.state=zo.FADING_IN,i.persistent||(this._mostRecentTransientRipple=f);let g=null;return!m&&(l||o.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const E=()=>this._finishRippleTransition(f),b=()=>this._destroyRipple(f);d.addEventListener("transitionend",E),d.addEventListener("transitioncancel",b),g={onTransitionEnd:E,onTransitionCancel:b}}),this._activeRipples.set(f,g),(m||!l)&&this._finishRippleTransition(f),f}fadeOutRipple(t){if(t.state===zo.FADING_OUT||t.state===zo.HIDDEN)return;const n=t.element,i={...jj,...t.config.animation};n.style.transitionDuration=`${i.exitDuration}ms`,n.style.opacity="0",t.state=zo.FADING_OUT,(t._animationForciblyDisabledThroughCss||!i.exitDuration)&&this._finishRippleTransition(t)}fadeOutAll(){this._getActiveRipples().forEach(t=>t.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(t=>{t.config.persistent||t.fadeOut()})}setupTriggerEvents(t){const n=Gc(t);!this._platform.isBrowser||!n||n===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=n,Gj.forEach(i=>{cb._eventManager.addHandler(this._ngZone,i,n,this)}))}handleEvent(t){"mousedown"===t.type?this._onMousedown(t):"touchstart"===t.type?this._onTouchStart(t):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{Wj.forEach(n=>{this._triggerElement.addEventListener(n,this,Hj)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(t){t.state===zo.FADING_IN?this._startFadeOutTransition(t):t.state===zo.FADING_OUT&&this._destroyRipple(t)}_startFadeOutTransition(t){const n=t===this._mostRecentTransientRipple,{persistent:i}=t.config;t.state=zo.VISIBLE,!i&&(!n||!this._isPointerDown)&&t.fadeOut()}_destroyRipple(t){const n=this._activeRipples.get(t)??null;this._activeRipples.delete(t),this._activeRipples.size||(this._containerRect=null),t===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),t.state=zo.HIDDEN,null!==n&&(t.element.removeEventListener("transitionend",n.onTransitionEnd),t.element.removeEventListener("transitioncancel",n.onTransitionCancel)),t.element.remove()}_onMousedown(t){const n=Nj(t),i=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!n&&!i&&(this._isPointerDown=!0,this.fadeInRipple(t.clientX,t.clientY,this._target.rippleConfig))}_onTouchStart(t){if(!this._target.rippleDisabled&&!Pj(t)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const n=t.changedTouches;if(n)for(let i=0;i<n.length;i++)this.fadeInRipple(n[i].clientX,n[i].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(t=>{!t.config.persistent&&(t.state===zo.VISIBLE||t.config.terminateOnPointerUp&&t.state===zo.FADING_IN)&&t.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const t=this._triggerElement;t&&(Gj.forEach(n=>cb._eventManager.removeHandler(n,t,this)),this._pointerUpEventsRegistered&&(Wj.forEach(n=>t.removeEventListener(n,this,Hj)),this._pointerUpEventsRegistered=!1))}}const zj=new re("mat-ripple-global-options");let Kj=(()=>{class e{get disabled(){return this._disabled}set disabled(n){n&&this.fadeOutAllNonPersistent(),this._disabled=n,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(n){this._trigger=n,this._setupTriggerEventsIfEnabled()}constructor(n,i,r,o,s){this._elementRef=n,this._animationMode=s,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=o||{},this._rippleRenderer=new cb(this,i,n,r)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(n,i=0,r){return"number"==typeof n?this._rippleRenderer.fadeInRipple(n,i,{...this.rippleConfig,...r}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...n})}static{this.\u0275fac=function(i){return new(i||e)(H(sn),H(Le),H(tr),H(zj,8),H(za,8))}}static{this.\u0275dir=ye({type:e,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(i,r){2&i&&wt("mat-ripple-unbounded",r.unbounded)},inputs:{color:[we.None,"matRippleColor","color"],unbounded:[we.None,"matRippleUnbounded","unbounded"],centered:[we.None,"matRippleCentered","centered"],radius:[we.None,"matRippleRadius","radius"],animation:[we.None,"matRippleAnimation","animation"],disabled:[we.None,"matRippleDisabled","disabled"],trigger:[we.None,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0})}}return e})(),Bme=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({imports:[Wo,Wo]})}}return e})();const qj={capture:!0},Yj=["focus","click","mouseenter","touchstart"],fR="mat-ripple-loader-uninitialized",mR="mat-ripple-loader-class-name",$j="mat-ripple-loader-centered",lb="mat-ripple-loader-disabled";let jme=(()=>{class e{constructor(){this._document=J(Ut,{optional:!0}),this._animationMode=J(za,{optional:!0}),this._globalRippleOptions=J(zj,{optional:!0}),this._platform=J(tr),this._ngZone=J(Le),this._hosts=new Map,this._onInteraction=n=>{if(!(n.target instanceof HTMLElement))return;const r=n.target.closest(`[${fR}]`);r&&this._createRipple(r)},this._ngZone.runOutsideAngular(()=>{for(const n of Yj)this._document?.addEventListener(n,this._onInteraction,qj)})}ngOnDestroy(){const n=this._hosts.keys();for(const i of n)this.destroyRipple(i);for(const i of Yj)this._document?.removeEventListener(i,this._onInteraction,qj)}configureRipple(n,i){n.setAttribute(fR,""),(i.className||!n.hasAttribute(mR))&&n.setAttribute(mR,i.className||""),i.centered&&n.setAttribute($j,""),i.disabled&&n.setAttribute(lb,"")}getRipple(n){return this._hosts.get(n)||this._createRipple(n)}setDisabled(n,i){const r=this._hosts.get(n);r?r.disabled=i:i?n.setAttribute(lb,""):n.removeAttribute(lb)}_createRipple(n){if(!this._document)return;const i=this._hosts.get(n);if(i)return i;n.querySelector(".mat-ripple")?.remove();const r=this._document.createElement("span");r.classList.add("mat-ripple",n.getAttribute(mR)),n.append(r);const o=new Kj(new sn(r),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return o._isInitialized=!0,o.trigger=n,o.centered=n.hasAttribute($j),o.disabled=n.hasAttribute(lb),this.attachRipple(n,o),o}attachRipple(n,i){n.removeAttribute(fR),this._hosts.set(n,i)}destroyRipple(n){const i=this._hosts.get(n);i&&(i.ngOnDestroy(),this._hosts.delete(n))}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Hme=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=sr({type:e,selectors:[["div","mat-internal-form-field",""]],hostAttrs:[1,"mdc-form-field","mat-internal-form-field"],hostVars:2,hostBindings:function(i,r){2&i&&wt("mdc-form-field--align-end","before"===r.labelPosition)},inputs:{labelPosition:"labelPosition"},standalone:!0,features:[Lc],attrs:Ime,ngContentSelectors:Rme,decls:1,vars:0,template:function(i,r){1&i&&(qu(),pr(0))},styles:[".mdc-form-field{display:inline-flex;align-items:center;vertical-align:middle}.mdc-form-field[hidden]{display:none}.mdc-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{margin-left:auto;margin-right:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{padding-left:0;padding-right:4px}.mdc-form-field--nowrap>label{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{margin-left:0;margin-right:auto}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{padding-left:4px;padding-right:0}.mdc-form-field--space-between{justify-content:space-between}.mdc-form-field--space-between>label{margin:0}[dir=rtl] .mdc-form-field--space-between>label,.mdc-form-field--space-between>label[dir=rtl]{margin:0}.mdc-form-field{font-family:var(--mdc-form-field-label-text-font);line-height:var(--mdc-form-field-label-text-line-height);font-size:var(--mdc-form-field-label-text-size);font-weight:var(--mdc-form-field-label-text-weight);letter-spacing:var(--mdc-form-field-label-text-tracking);color:var(--mdc-form-field-label-text-color)}.mat-internal-form-field{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}"],encapsulation:2,changeDetection:0})}}return e})();const Gme=["mat-button",""],Wme=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],zme=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"],Kme=new re("MAT_BUTTON_CONFIG"),qme=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}];let Yme=(()=>{class e{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(n){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,n)}get disableRipple(){return this._disableRipple}set disableRipple(n){this._disableRipple=n,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(n){this._disabled=n,this._updateRippleDisabled()}constructor(n,i,r,o){this._elementRef=n,this._platform=i,this._ngZone=r,this._animationMode=o,this._focusMonitor=J(uR),this._rippleLoader=J(jme),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;const s=J(Kme,{optional:!0}),a=n.nativeElement,c=a.classList;this.disabledInteractive=s?.disabledInteractive??!1,this._rippleLoader?.configureRipple(a,{className:"mat-mdc-button-ripple"});for(const{attribute:l,mdcClasses:d}of qme)a.hasAttribute(l)&&c.add(...d)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(n="program",i){n?this._focusMonitor.focusVia(this._elementRef.nativeElement,n,i):this._elementRef.nativeElement.focus(i)}_getAriaDisabled(){return null!=this.ariaDisabled?this.ariaDisabled:!(!this.disabled||!this.disabledInteractive)||null}_getDisabledAttribute(){return!(this.disabledInteractive||!this.disabled)||null}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}static{this.\u0275fac=function(i){S0()}}static{this.\u0275dir=ye({type:e,inputs:{color:"color",disableRipple:[we.HasDecoratorInputTransform,"disableRipple","disableRipple",Ar],disabled:[we.HasDecoratorInputTransform,"disabled","disabled",Ar],ariaDisabled:[we.HasDecoratorInputTransform,"aria-disabled","ariaDisabled",Ar],disabledInteractive:[we.HasDecoratorInputTransform,"disabledInteractive","disabledInteractive",Ar]},features:[Yv]})}}return e})(),$me=(()=>{class e extends Yme{constructor(n,i,r,o){super(n,i,r,o)}static{this.\u0275fac=function(i){return new(i||e)(H(sn),H(tr),H(Le),H(za,8))}}static{this.\u0275cmp=sr({type:e,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(i,r){2&i&&(yi("disabled",r._getDisabledAttribute())("aria-disabled",r._getAriaDisabled()),Sw(r.color?"mat-"+r.color:""),wt("mat-mdc-button-disabled",r.disabled)("mat-mdc-button-disabled-interactive",r.disabledInteractive)("_mat-animation-noopable","NoopAnimations"===r._animationMode)("mat-unthemed",!r.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[Mt,Lc],attrs:Gme,ngContentSelectors:zme,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(i,r){1&i&&(qu(Wme),pt(0,"span",0),pr(1),ue(2,"span",1),pr(3,1),ve(),pr(4,2),pt(5,"span",2)(6,"span",3)),2&i&&wt("mdc-button__ripple",!r._isFab)("mdc-fab__ripple",r._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px);display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{font-family:var(--mdc-text-button-label-text-font);font-size:var(--mdc-text-button-label-text-size);letter-spacing:var(--mdc-text-button-label-text-tracking);font-weight:var(--mdc-text-button-label-text-weight);text-transform:var(--mdc-text-button-label-text-transform);height:var(--mdc-text-button-container-height);border-radius:var(--mdc-text-button-container-shape);padding:0 var(--mat-text-button-horizontal-padding, 8px)}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 8px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color)}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color)}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity)}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity)}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity)}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display)}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{font-family:var(--mdc-filled-button-label-text-font);font-size:var(--mdc-filled-button-label-text-size);letter-spacing:var(--mdc-filled-button-label-text-tracking);font-weight:var(--mdc-filled-button-label-text-weight);text-transform:var(--mdc-filled-button-label-text-transform);height:var(--mdc-filled-button-container-height);border-radius:var(--mdc-filled-button-container-shape);padding:0 var(--mat-filled-button-horizontal-padding, 16px)}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color)}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color)}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity)}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity)}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity)}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display)}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{font-family:var(--mdc-protected-button-label-text-font);font-size:var(--mdc-protected-button-label-text-size);letter-spacing:var(--mdc-protected-button-label-text-tracking);font-weight:var(--mdc-protected-button-label-text-weight);text-transform:var(--mdc-protected-button-label-text-transform);height:var(--mdc-protected-button-container-height);border-radius:var(--mdc-protected-button-container-shape);padding:0 var(--mat-protected-button-horizontal-padding, 16px);box-shadow:var(--mdc-protected-button-container-elevation-shadow)}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color)}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color)}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color)}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity)}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity)}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity)}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display)}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow)}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow)}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow)}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow)}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{font-family:var(--mdc-outlined-button-label-text-font);font-size:var(--mdc-outlined-button-label-text-size);letter-spacing:var(--mdc-outlined-button-label-text-tracking);font-weight:var(--mdc-outlined-button-label-text-weight);text-transform:var(--mdc-outlined-button-label-text-transform);height:var(--mdc-outlined-button-container-height);border-radius:var(--mdc-outlined-button-container-shape);padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width);padding:0 var(--mat-outlined-button-horizontal-padding, 15px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color)}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape)}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color)}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width))}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color)}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity)}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity)}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity)}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display)}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button-base{text-decoration:none}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0})}}return e})(),Zme=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({imports:[Wo,Bme,Wo]})}}return e})();const Xj=nh({passive:!0});let Jme=(()=>{class e{constructor(n,i){this._platform=n,this._ngZone=i,this._monitoredElements=new Map}monitor(n){if(!this._platform.isBrowser)return Go;const i=Gc(n),r=this._monitoredElements.get(i);if(r)return r.subject;const o=new vt,s="cdk-text-field-autofilled",a=c=>{"cdk-text-field-autofill-start"!==c.animationName||i.classList.contains(s)?"cdk-text-field-autofill-end"===c.animationName&&i.classList.contains(s)&&(i.classList.remove(s),this._ngZone.run(()=>o.next({target:c.target,isAutofilled:!1}))):(i.classList.add(s),this._ngZone.run(()=>o.next({target:c.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{i.addEventListener("animationstart",a,Xj),i.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(i,{subject:o,unlisten:()=>{i.removeEventListener("animationstart",a,Xj)}}),o}stopMonitoring(n){const i=Gc(n),r=this._monitoredElements.get(i);r&&(r.unlisten(),r.subject.complete(),i.classList.remove("cdk-text-field-autofill-monitored"),i.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(i))}ngOnDestroy(){this._monitoredElements.forEach((n,i)=>this.stopMonitoring(i))}static{this.\u0275fac=function(i){return new(i||e)(Z(tr),Z(Le))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Qme=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({})}}return e})();function Zj(...e){const t=_m(e),n=function Cpe(e,t){return"number"==typeof LI(e)?e.pop():t}(e,1/0),i=e;return i.length?1===i.length?mr(i[0]):rh(n)(xi(i,t)):Go}class ege extends vt{constructor(t=1/0,n=1/0,i=aR){super(),this._bufferSize=t,this._windowTime=n,this._timestampProvider=i,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=n===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,n)}next(t){const{isStopped:n,_buffer:i,_infiniteTimeWindow:r,_timestampProvider:o,_windowTime:s}=this;n||(i.push(t),!r&&i.push(o.now()+s)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();const n=this._innerSubscribe(t),{_infiniteTimeWindow:i,_buffer:r}=this,o=r.slice();for(let s=0;s<o.length&&!t.closed;s+=i?1:2)t.next(o[s]);return this._checkFinalizedStatuses(t),n}_trimBuffer(){const{_bufferSize:t,_timestampProvider:n,_buffer:i,_infiniteTimeWindow:r}=this,o=(r?1:2)*t;if(t<1/0&&o<i.length&&i.splice(0,i.length-o),!r){const s=n.now();let a=0;for(let c=1;c<i.length&&i[c]<=s;c+=2)a=c;a&&i.splice(0,a+1)}}}function gR(e,t,...n){if(!0===t)return void e();if(!1===t)return;const i=new zp({next:()=>{i.unsubscribe(),e()}});return mr(t(...n)).subscribe(i)}class ige{constructor(t){this._box=t,this._destroyed=new vt,this._resizeSubject=new vt,this._elementObservables=new Map,typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(n=>this._resizeSubject.next(n)))}observe(t){return this._elementObservables.has(t)||this._elementObservables.set(t,new Gn(n=>{const i=this._resizeSubject.subscribe(n);return this._resizeObserver?.observe(t,{box:this._box}),()=>{this._resizeObserver?.unobserve(t),i.unsubscribe(),this._elementObservables.delete(t)}}).pipe($r(n=>n.some(i=>i.target===t)),function nge(e,t,n){let i,r=!1;return e&&"object"==typeof e?({bufferSize:i=1/0,windowTime:t=1/0,refCount:r=!1,scheduler:n}=e):i=e??1/0,function tge(e={}){const{connector:t=(()=>new vt),resetOnError:n=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=e;return o=>{let s,a,c,l=0,d=!1,u=!1;const h=()=>{a?.unsubscribe(),a=void 0},p=()=>{h(),s=c=void 0,d=u=!1},m=()=>{const f=s;p(),f?.unsubscribe()};return Jn((f,g)=>{l++,!u&&!d&&h();const E=c=c??t();g.add(()=>{l--,0===l&&!u&&!d&&(a=gR(m,r))}),E.subscribe(g),!s&&l>0&&(s=new zp({next:b=>E.next(b),error:b=>{u=!0,h(),a=gR(p,n,b),E.error(b)},complete:()=>{d=!0,h(),a=gR(p,i),E.complete()}}),mr(f).subscribe(s))})(o)}}({connector:()=>new ege(i,t,n),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:r})}({bufferSize:1,refCount:!0}),gr(this._destroyed))),this._elementObservables.get(t)}destroy(){this._destroyed.next(),this._destroyed.complete(),this._resizeSubject.complete(),this._elementObservables.clear()}}let rge=(()=>{class e{constructor(){this._observers=new Map,this._ngZone=J(Le)}ngOnDestroy(){for(const[,n]of this._observers)n.destroy();this._observers.clear()}observe(n,i){const r=i?.box||"content-box";return this._observers.has(r)||this._observers.set(r,new ige(r)),this._observers.get(r).observe(n)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var Ge=function(e){return e[e.State=0]="State",e[e.Transition=1]="Transition",e[e.Sequence=2]="Sequence",e[e.Group=3]="Group",e[e.Animate=4]="Animate",e[e.Keyframes=5]="Keyframes",e[e.Style=6]="Style",e[e.Trigger=7]="Trigger",e[e.Reference=8]="Reference",e[e.AnimateChild=9]="AnimateChild",e[e.AnimateRef=10]="AnimateRef",e[e.Query=11]="Query",e[e.Stagger=12]="Stagger",e}(Ge||{});const nc="*";function _R(e,t){return{type:Ge.Trigger,name:e,definitions:t,options:{}}}function Pm(e,t=null){return{type:Ge.Animate,styles:t,timings:e}}function ca(e){return{type:Ge.Style,styles:e,offset:null}}function vR(e,t,n){return{type:Ge.State,name:e,styles:t,options:n}}function Mm(e,t,n=null){return{type:Ge.Transition,expr:e,animation:t,options:n}}class xm{constructor(t=0,n=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+n}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const n="start"==t?this._onStartFns:this._onDoneFns;n.forEach(i=>i()),n.length=0}}class Jj{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let n=0,i=0,r=0;const o=this.players.length;0==o?queueMicrotask(()=>this._onFinish()):this.players.forEach(s=>{s.onDone(()=>{++n==o&&this._onFinish()}),s.onDestroy(()=>{++i==o&&this._onDestroy()}),s.onStart(()=>{++r==o&&this._onStart()})}),this.totalTime=this.players.reduce((s,a)=>Math.max(s,a.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const n=t*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,n/i.totalTime):1;i.setPosition(r)})}getPosition(){const t=this.players.reduce((n,i)=>null===n||i.totalTime>n.totalTime?i:n,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const n="start"==t?this._onStartFns:this._onDoneFns;n.forEach(i=>i()),n.length=0}}const dge=["notch"],uge=["matFormFieldNotchedOutline",""],hge=["*"],pge=["textField"],fge=["iconPrefixContainer"],mge=["textPrefixContainer"],gge=["*",[["mat-label"]],[["","matPrefix",""],["","matIconPrefix",""]],[["","matTextPrefix",""]],[["","matTextSuffix",""]],[["","matSuffix",""],["","matIconSuffix",""]],[["mat-error"],["","matError",""]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],_ge=["*","mat-label","[matPrefix], [matIconPrefix]","[matTextPrefix]","[matTextSuffix]","[matSuffix], [matIconSuffix]","mat-error, [matError]","mat-hint:not([align='end'])","mat-hint[align='end']"];function vge(e,t){1&e&&pt(0,"span",17)}function Ege(e,t){if(1&e&&(ue(0,"label",16),pr(1,1),an(2,vge,1,0,"span",17),ve()),2&e){const n=Kt(2);ht("floating",n._shouldLabelFloat())("monitorResize",n._hasOutline())("id",n._labelId),yi("for",n._control.disableAutomaticLabeling?null:n._control.id),Re(2),wr(2,!n.hideRequiredMarker&&n._control.required?2:-1)}}function bge(e,t){1&e&&an(0,Ege,3,5,"label",16),2&e&&wr(0,Kt()._hasFloatingLabel()?0:-1)}function yge(e,t){1&e&&pt(0,"div",5)}function Sge(e,t){}function Cge(e,t){1&e&&an(0,Sge,0,0,"ng-template",11),2&e&&(Kt(2),ht("ngTemplateOutlet",nm(1)))}function Tge(e,t){if(1&e&&(ue(0,"div",7),an(1,Cge,1,1,null,11),ve()),2&e){const n=Kt();ht("matFormFieldNotchedOutlineOpen",n._shouldLabelFloat()),Re(),wr(1,n._forceDisplayInfixLabel()?-1:1)}}function wge(e,t){1&e&&(ue(0,"div",8,2),pr(2,2),ve())}function Ige(e,t){1&e&&(ue(0,"div",9,3),pr(2,3),ve())}function Rge(e,t){}function Age(e,t){1&e&&an(0,Rge,0,0,"ng-template",11),2&e&&(Kt(),ht("ngTemplateOutlet",nm(1)))}function Dge(e,t){1&e&&(ue(0,"div",12),pr(1,4),ve())}function Oge(e,t){1&e&&(ue(0,"div",13),pr(1,5),ve())}function Nge(e,t){1&e&&pt(0,"div",14)}function Pge(e,t){1&e&&(ue(0,"div",18),pr(1,6),ve()),2&e&&ht("@transitionMessages",Kt()._subscriptAnimationState)}function Mge(e,t){if(1&e&&(ue(0,"mat-hint",20),fr(1),ve()),2&e){const n=Kt(2);ht("id",n._hintLabelId),Re(),Yl(n.hintLabel)}}function xge(e,t){if(1&e&&(ue(0,"div",19),an(1,Mge,2,2,"mat-hint",20),pr(2,7),pt(3,"div",21),pr(4,8),ve()),2&e){const n=Kt();ht("@transitionMessages",n._subscriptAnimationState),Re(),wr(1,n.hintLabel?1:-1)}}let bR=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275dir=ye({type:e,selectors:[["mat-label"]],standalone:!0})}}return e})();const kge=new re("MatError");let Lge=0,Qj=(()=>{class e{constructor(){this.align="start",this.id="mat-mdc-hint-"+Lge++}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275dir=ye({type:e,selectors:[["mat-hint"]],hostAttrs:[1,"mat-mdc-form-field-hint","mat-mdc-form-field-bottom-align"],hostVars:4,hostBindings:function(i,r){2&i&&($f("id",r.id),yi("align",null),wt("mat-mdc-form-field-hint-end","end"===r.align))},inputs:{align:"align",id:"id"},standalone:!0})}}return e})();const Fge=new re("MatPrefix"),Uge=new re("MatSuffix"),e4=new re("FloatingLabelParent");let t4=(()=>{class e{get floating(){return this._floating}set floating(n){this._floating=n,this.monitorResize&&this._handleResize()}get monitorResize(){return this._monitorResize}set monitorResize(n){this._monitorResize=n,this._monitorResize?this._subscribeToResize():this._resizeSubscription.unsubscribe()}constructor(n){this._elementRef=n,this._floating=!1,this._monitorResize=!1,this._resizeObserver=J(rge),this._ngZone=J(Le),this._parent=J(e4),this._resizeSubscription=new li}ngOnDestroy(){this._resizeSubscription.unsubscribe()}getWidth(){return function Vge(e){if(null!==e.offsetParent)return e.scrollWidth;const n=e.cloneNode(!0);n.style.setProperty("position","absolute"),n.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(n);const i=n.scrollWidth;return n.remove(),i}(this._elementRef.nativeElement)}get element(){return this._elementRef.nativeElement}_handleResize(){setTimeout(()=>this._parent._handleLabelResized())}_subscribeToResize(){this._resizeSubscription.unsubscribe(),this._ngZone.runOutsideAngular(()=>{this._resizeSubscription=this._resizeObserver.observe(this._elementRef.nativeElement,{box:"border-box"}).subscribe(()=>this._handleResize())})}static{this.\u0275fac=function(i){return new(i||e)(H(sn))}}static{this.\u0275dir=ye({type:e,selectors:[["label","matFormFieldFloatingLabel",""]],hostAttrs:[1,"mdc-floating-label","mat-mdc-floating-label"],hostVars:2,hostBindings:function(i,r){2&i&&wt("mdc-floating-label--float-above",r.floating)},inputs:{floating:"floating",monitorResize:"monitorResize"},standalone:!0})}}return e})();const n4="mdc-line-ripple--active",db="mdc-line-ripple--deactivating";let i4=(()=>{class e{constructor(n,i){this._elementRef=n,this._handleTransitionEnd=r=>{const o=this._elementRef.nativeElement.classList,s=o.contains(db);"opacity"===r.propertyName&&s&&o.remove(n4,db)},i.runOutsideAngular(()=>{n.nativeElement.addEventListener("transitionend",this._handleTransitionEnd)})}activate(){const n=this._elementRef.nativeElement.classList;n.remove(db),n.add(n4)}deactivate(){this._elementRef.nativeElement.classList.add(db)}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._handleTransitionEnd)}static{this.\u0275fac=function(i){return new(i||e)(H(sn),H(Le))}}static{this.\u0275dir=ye({type:e,selectors:[["div","matFormFieldLineRipple",""]],hostAttrs:[1,"mdc-line-ripple"],standalone:!0})}}return e})(),r4=(()=>{class e{constructor(n,i){this._elementRef=n,this._ngZone=i,this.open=!1}ngAfterViewInit(){const n=this._elementRef.nativeElement.querySelector(".mdc-floating-label");n?(this._elementRef.nativeElement.classList.add("mdc-notched-outline--upgraded"),"function"==typeof requestAnimationFrame&&(n.style.transitionDuration="0s",this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>n.style.transitionDuration="")}))):this._elementRef.nativeElement.classList.add("mdc-notched-outline--no-label")}_setNotchWidth(n){this._notch.nativeElement.style.width=this.open&&n?`calc(${n}px * var(--mat-mdc-form-field-floating-label-scale, 0.75) + 9px)`:""}static{this.\u0275fac=function(i){return new(i||e)(H(sn),H(Le))}}static{this.\u0275cmp=sr({type:e,selectors:[["div","matFormFieldNotchedOutline",""]],viewQuery:function(i,r){if(1&i&&oa(dge,5),2&i){let o;ji(o=Hi())&&(r._notch=o.first)}},hostAttrs:[1,"mdc-notched-outline"],hostVars:2,hostBindings:function(i,r){2&i&&wt("mdc-notched-outline--notched",r.open)},inputs:{open:[we.None,"matFormFieldNotchedOutlineOpen","open"]},standalone:!0,features:[Lc],attrs:uge,ngContentSelectors:hge,decls:5,vars:0,consts:[["notch",""],[1,"mdc-notched-outline__leading"],[1,"mdc-notched-outline__notch"],[1,"mdc-notched-outline__trailing"]],template:function(i,r){1&i&&(qu(),pt(0,"div",1),ue(1,"div",2,0),pr(3),ve(),pt(4,"div",3))},encapsulation:2,changeDetection:0})}}return e})();const Bge={transitionMessages:_R("transitionMessages",[vR("enter",ca({opacity:1,transform:"translateY(0%)"})),Mm("void => enter",[ca({opacity:0,transform:"translateY(-5px)"}),Pm("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])};let o4=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275dir=ye({type:e})}}return e})();const s4=new re("MatFormField"),jge=new re("MAT_FORM_FIELD_DEFAULT_OPTIONS");let a4=0,Wge=(()=>{class e{get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(n){this._hideRequiredMarker=ih(n)}get floatLabel(){return this._floatLabel||this._defaults?.floatLabel||"auto"}set floatLabel(n){n!==this._floatLabel&&(this._floatLabel=n,this._changeDetectorRef.markForCheck())}get appearance(){return this._appearance}set appearance(n){const i=this._appearance;this._appearance=n||this._defaults?.appearance||"fill","outline"===this._appearance&&this._appearance!==i&&(this._needsOutlineLabelOffsetUpdateOnStable=!0)}get subscriptSizing(){return this._subscriptSizing||this._defaults?.subscriptSizing||"fixed"}set subscriptSizing(n){this._subscriptSizing=n||this._defaults?.subscriptSizing||"fixed"}get hintLabel(){return this._hintLabel}set hintLabel(n){this._hintLabel=n,this._processHints()}get _control(){return this._explicitFormFieldControl||this._formFieldControl}set _control(n){this._explicitFormFieldControl=n}constructor(n,i,r,o,s,a,c,l){this._elementRef=n,this._changeDetectorRef=i,this._ngZone=r,this._dir=o,this._platform=s,this._defaults=a,this._animationMode=c,this._hideRequiredMarker=!1,this.color="primary",this._appearance="fill",this._subscriptSizing=null,this._hintLabel="",this._hasIconPrefix=!1,this._hasTextPrefix=!1,this._hasIconSuffix=!1,this._hasTextSuffix=!1,this._labelId="mat-mdc-form-field-label-"+a4++,this._hintLabelId="mat-mdc-hint-"+a4++,this._subscriptAnimationState="",this._destroyed=new vt,this._isFocused=null,this._needsOutlineLabelOffsetUpdateOnStable=!1,a&&(a.appearance&&(this.appearance=a.appearance),this._hideRequiredMarker=!!a?.hideRequiredMarker,a.color&&(this.color=a.color))}ngAfterViewInit(){this._updateFocusState(),this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngAfterContentInit(){this._assertFormFieldControl(),this._initializeControl(),this._initializeSubscript(),this._initializePrefixAndSuffix(),this._initializeOutlineLabelOffsetSubscriptions()}ngAfterContentChecked(){this._assertFormFieldControl()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._textField||this._elementRef}_animateAndLockLabel(){this._hasFloatingLabel()&&(this.floatLabel="always")}_initializeControl(){const n=this._control;n.controlType&&this._elementRef.nativeElement.classList.add(`mat-mdc-form-field-type-${n.controlType}`),n.stateChanges.subscribe(()=>{this._updateFocusState(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),n.ngControl&&n.ngControl.valueChanges&&n.ngControl.valueChanges.pipe(gr(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck())}_checkPrefixAndSuffixTypes(){this._hasIconPrefix=!!this._prefixChildren.find(n=>!n._isText),this._hasTextPrefix=!!this._prefixChildren.find(n=>n._isText),this._hasIconSuffix=!!this._suffixChildren.find(n=>!n._isText),this._hasTextSuffix=!!this._suffixChildren.find(n=>n._isText)}_initializePrefixAndSuffix(){this._checkPrefixAndSuffixTypes(),Zj(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._checkPrefixAndSuffixTypes(),this._changeDetectorRef.markForCheck()})}_initializeSubscript(){this._hintChildren.changes.subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._validateHints(),this._syncDescribedByIds()}_assertFormFieldControl(){}_updateFocusState(){this._control.focused&&!this._isFocused?(this._isFocused=!0,this._lineRipple?.activate()):!this._control.focused&&(this._isFocused||null===this._isFocused)&&(this._isFocused=!1,this._lineRipple?.deactivate()),this._textField?.nativeElement.classList.toggle("mdc-text-field--focused",this._control.focused)}_initializeOutlineLabelOffsetSubscriptions(){this._prefixChildren.changes.subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(gr(this._destroyed)).subscribe(()=>{this._needsOutlineLabelOffsetUpdateOnStable&&(this._needsOutlineLabelOffsetUpdateOnStable=!1,this._updateOutlineLabelOffset())})}),this._dir.change.pipe(gr(this._destroyed)).subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0)}_shouldAlwaysFloat(){return"always"===this.floatLabel}_hasOutline(){return"outline"===this.appearance}_forceDisplayInfixLabel(){return!this._platform.isBrowser&&this._prefixChildren.length&&!this._shouldLabelFloat()}_hasFloatingLabel(){return!!this._labelChildNonStatic||!!this._labelChildStatic}_shouldLabelFloat(){return this._control.shouldLabelFloat||this._shouldAlwaysFloat()}_shouldForward(n){const i=this._control?this._control.ngControl:null;return i&&i[n]}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_handleLabelResized(){this._refreshOutlineNotchWidth()}_refreshOutlineNotchWidth(){this._hasOutline()&&this._floatingLabel&&this._shouldLabelFloat()?this._notchedOutline?._setNotchWidth(this._floatingLabel.getWidth()):this._notchedOutline?._setNotchWidth(0)}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){}_syncDescribedByIds(){if(this._control){let n=[];if(this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&n.push(...this._control.userAriaDescribedBy.split(" ")),"hint"===this._getDisplayedMessages()){const i=this._hintChildren?this._hintChildren.find(o=>"start"===o.align):null,r=this._hintChildren?this._hintChildren.find(o=>"end"===o.align):null;i?n.push(i.id):this._hintLabel&&n.push(this._hintLabelId),r&&n.push(r.id)}else this._errorChildren&&n.push(...this._errorChildren.map(i=>i.id));this._control.setDescribedByIds(n)}}_updateOutlineLabelOffset(){if(!this._platform.isBrowser||!this._hasOutline()||!this._floatingLabel)return;const n=this._floatingLabel.element;if(!this._iconPrefixContainer&&!this._textPrefixContainer)return void(n.style.transform="");if(!this._isAttachedToDom())return void(this._needsOutlineLabelOffsetUpdateOnStable=!0);const i=this._iconPrefixContainer?.nativeElement,r=this._textPrefixContainer?.nativeElement,o=i?.getBoundingClientRect().width??0,s=r?.getBoundingClientRect().width??0;n.style.transform=`var(\n        --mat-mdc-form-field-label-transform,\n        translateY(-50%) translateX(calc(${"rtl"===this._dir.value?"-1":"1"} * (${o+s}px + var(--mat-mdc-form-field-label-offset-x, 0px))))\n    )`}_isAttachedToDom(){const n=this._elementRef.nativeElement;if(n.getRootNode){const i=n.getRootNode();return i&&i!==n}return document.documentElement.contains(n)}static{this.\u0275fac=function(i){return new(i||e)(H(sn),H(Ts),H(Le),H(pR),H(tr),H(jge,8),H(za,8),H(Ut))}}static{this.\u0275cmp=sr({type:e,selectors:[["mat-form-field"]],contentQueries:function(i,r,o){if(1&i&&(Xa(o,bR,5),Xa(o,bR,7),Xa(o,o4,5),Xa(o,Fge,5),Xa(o,Uge,5),Xa(o,kge,5),Xa(o,Qj,5)),2&i){let s;ji(s=Hi())&&(r._labelChildNonStatic=s.first),ji(s=Hi())&&(r._labelChildStatic=s.first),ji(s=Hi())&&(r._formFieldControl=s.first),ji(s=Hi())&&(r._prefixChildren=s),ji(s=Hi())&&(r._suffixChildren=s),ji(s=Hi())&&(r._errorChildren=s),ji(s=Hi())&&(r._hintChildren=s)}},viewQuery:function(i,r){if(1&i&&(oa(pge,5),oa(fge,5),oa(mge,5),oa(t4,5),oa(r4,5),oa(i4,5)),2&i){let o;ji(o=Hi())&&(r._textField=o.first),ji(o=Hi())&&(r._iconPrefixContainer=o.first),ji(o=Hi())&&(r._textPrefixContainer=o.first),ji(o=Hi())&&(r._floatingLabel=o.first),ji(o=Hi())&&(r._notchedOutline=o.first),ji(o=Hi())&&(r._lineRipple=o.first)}},hostAttrs:[1,"mat-mdc-form-field"],hostVars:42,hostBindings:function(i,r){2&i&&wt("mat-mdc-form-field-label-always-float",r._shouldAlwaysFloat())("mat-mdc-form-field-has-icon-prefix",r._hasIconPrefix)("mat-mdc-form-field-has-icon-suffix",r._hasIconSuffix)("mat-form-field-invalid",r._control.errorState)("mat-form-field-disabled",r._control.disabled)("mat-form-field-autofilled",r._control.autofilled)("mat-form-field-no-animations","NoopAnimations"===r._animationMode)("mat-form-field-appearance-fill","fill"==r.appearance)("mat-form-field-appearance-outline","outline"==r.appearance)("mat-form-field-hide-placeholder",r._hasFloatingLabel()&&!r._shouldLabelFloat())("mat-focused",r._control.focused)("mat-primary","accent"!==r.color&&"warn"!==r.color)("mat-accent","accent"===r.color)("mat-warn","warn"===r.color)("ng-untouched",r._shouldForward("untouched"))("ng-touched",r._shouldForward("touched"))("ng-pristine",r._shouldForward("pristine"))("ng-dirty",r._shouldForward("dirty"))("ng-valid",r._shouldForward("valid"))("ng-invalid",r._shouldForward("invalid"))("ng-pending",r._shouldForward("pending"))},inputs:{hideRequiredMarker:"hideRequiredMarker",color:"color",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",hintLabel:"hintLabel"},exportAs:["matFormField"],standalone:!0,features:[mn([{provide:s4,useExisting:e},{provide:e4,useExisting:e}]),Lc],ngContentSelectors:_ge,decls:18,vars:21,consts:[["labelTemplate",""],["textField",""],["iconPrefixContainer",""],["textPrefixContainer",""],[1,"mat-mdc-text-field-wrapper","mdc-text-field",3,"click"],[1,"mat-mdc-form-field-focus-overlay"],[1,"mat-mdc-form-field-flex"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen"],[1,"mat-mdc-form-field-icon-prefix"],[1,"mat-mdc-form-field-text-prefix"],[1,"mat-mdc-form-field-infix"],[3,"ngTemplateOutlet"],[1,"mat-mdc-form-field-text-suffix"],[1,"mat-mdc-form-field-icon-suffix"],["matFormFieldLineRipple",""],[1,"mat-mdc-form-field-subscript-wrapper","mat-mdc-form-field-bottom-align"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id"],["aria-hidden","true",1,"mat-mdc-form-field-required-marker","mdc-floating-label--required"],[1,"mat-mdc-form-field-error-wrapper"],[1,"mat-mdc-form-field-hint-wrapper"],[3,"id"],[1,"mat-mdc-form-field-hint-spacer"]],template:function(i,r){if(1&i){const o=$a();qu(gge),an(0,bge,1,1,"ng-template",null,0,Lw),ue(2,"div",4,1),zt("click",function(a){return Wr(o),zr(r._control.onContainerClick(a))}),an(4,yge,1,0,"div",5),ue(5,"div",6),an(6,Tge,2,2,"div",7)(7,wge,3,0,"div",8)(8,Ige,3,0,"div",9),ue(9,"div",10),an(10,Age,1,1,null,11),pr(11),ve(),an(12,Dge,2,0,"div",12)(13,Oge,2,0,"div",13),ve(),an(14,Nge,1,0,"div",14),ve(),ue(15,"div",15),an(16,Pge,2,1)(17,xge,5,2),ve()}if(2&i){let o;Re(2),wt("mdc-text-field--filled",!r._hasOutline())("mdc-text-field--outlined",r._hasOutline())("mdc-text-field--no-label",!r._hasFloatingLabel())("mdc-text-field--disabled",r._control.disabled)("mdc-text-field--invalid",r._control.errorState),Re(2),wr(4,r._hasOutline()||r._control.disabled?-1:4),Re(2),wr(6,r._hasOutline()?6:-1),Re(),wr(7,r._hasIconPrefix?7:-1),Re(),wr(8,r._hasTextPrefix?8:-1),Re(2),wr(10,!r._hasOutline()||r._forceDisplayInfixLabel()?10:-1),Re(2),wr(12,r._hasTextSuffix?12:-1),Re(),wr(13,r._hasIconSuffix?13:-1),Re(),wr(14,r._hasOutline()?-1:14),Re(),wt("mat-mdc-form-field-subscript-dynamic-size","dynamic"===r.subscriptSizing),Re(),wr(16,"error"===(o=r._getDisplayedMessages())?16:"hint"===o?17:-1)}},dependencies:[t4,r4,gB,i4,Qj],styles:['.mdc-text-field{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:0;border-bottom-left-radius:0;display:inline-flex;align-items:baseline;padding:0 16px;position:relative;box-sizing:border-box;overflow:hidden;will-change:opacity,transform,color}.mdc-text-field .mdc-floating-label{top:50%;transform:translateY(-50%);pointer-events:none}.mdc-text-field__input{height:28px;width:100%;min-width:0;border:none;border-radius:0;background:none;appearance:none;padding:0}.mdc-text-field__input::-ms-clear{display:none}.mdc-text-field__input::-webkit-calendar-picker-indicator{display:none}.mdc-text-field__input:focus{outline:none}.mdc-text-field__input:invalid{box-shadow:none}@media all{.mdc-text-field__input::placeholder{opacity:0}}@media all{.mdc-text-field__input:-ms-input-placeholder{opacity:0}}@media all{.mdc-text-field--no-label .mdc-text-field__input::placeholder,.mdc-text-field--focused .mdc-text-field__input::placeholder{opacity:1}}@media all{.mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{opacity:1}}.mdc-text-field__affix{height:28px;opacity:0;white-space:nowrap}.mdc-text-field--label-floating .mdc-text-field__affix,.mdc-text-field--no-label .mdc-text-field__affix{opacity:1}@supports(-webkit-hyphens: none){.mdc-text-field--outlined .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field__affix--prefix,.mdc-text-field__affix--prefix[dir=rtl]{padding-left:2px;padding-right:0}.mdc-text-field--end-aligned .mdc-text-field__affix--prefix{padding-left:0;padding-right:12px}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--end-aligned .mdc-text-field__affix--prefix[dir=rtl]{padding-left:12px;padding-right:0}.mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field__affix--suffix,.mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:12px}.mdc-text-field--end-aligned .mdc-text-field__affix--suffix{padding-left:2px;padding-right:0}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--end-aligned .mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:2px}.mdc-text-field--filled{height:56px}.mdc-text-field--filled::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}.mdc-text-field--filled .mdc-floating-label{left:16px;right:initial}[dir=rtl] .mdc-text-field--filled .mdc-floating-label,.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:16px}.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{height:100%}.mdc-text-field--filled.mdc-text-field--no-label .mdc-floating-label{display:none}.mdc-text-field--filled.mdc-text-field--no-label::before{display:none}@supports(-webkit-hyphens: none){.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field--outlined{height:56px;overflow:visible}.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) scale(1)}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) scale(0.75)}.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--outlined .mdc-text-field__input{height:100%}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px,var(--mdc-shape-small, 4px))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px,var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px,var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px,var(--mdc-shape-small, 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px,var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:1px}.mdc-text-field--outlined .mdc-floating-label{left:4px;right:initial}[dir=rtl] .mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:4px}.mdc-text-field--outlined .mdc-text-field__input{display:flex;border:none !important;background-color:rgba(0,0,0,0)}.mdc-text-field--outlined .mdc-notched-outline{z-index:1}.mdc-text-field--textarea{flex-direction:column;align-items:center;width:auto;height:auto;padding:0}.mdc-text-field--textarea .mdc-floating-label{top:19px}.mdc-text-field--textarea .mdc-floating-label:not(.mdc-floating-label--float-above){transform:none}.mdc-text-field--textarea .mdc-text-field__input{flex-grow:1;height:auto;min-height:1.5rem;overflow-x:hidden;overflow-y:auto;box-sizing:border-box;resize:none;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--filled::before{display:none}.mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-10.25px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--filled .mdc-text-field__input{margin-top:23px;margin-bottom:9px}.mdc-text-field--textarea.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-27.25px) scale(1)}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-24.75px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label{top:18px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field__input{margin-bottom:2px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter{align-self:flex-end;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::after{display:inline-block;width:0;height:16px;content:"";vertical-align:-16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::before{display:none}.mdc-text-field__resizer{align-self:stretch;display:inline-flex;flex-direction:column;flex-grow:1;max-height:100%;max-width:100%;min-height:56px;min-width:fit-content;min-width:-moz-available;min-width:-webkit-fill-available;overflow:hidden;resize:both}.mdc-text-field--filled .mdc-text-field__resizer{transform:translateY(-1px)}.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateY(1px)}.mdc-text-field--outlined .mdc-text-field__resizer{transform:translateX(-1px) translateY(-1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer,.mdc-text-field--outlined .mdc-text-field__resizer[dir=rtl]{transform:translateX(1px) translateY(-1px)}.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateX(1px) translateY(1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input[dir=rtl],.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter[dir=rtl]{transform:translateX(-1px) translateY(1px)}.mdc-text-field--with-leading-icon{padding-left:0;padding-right:16px}[dir=rtl] .mdc-text-field--with-leading-icon,.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:16px;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 48px);left:48px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:48px}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 64px/0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label{left:36px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:36px}.mdc-text-field--with-leading-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) translateX(-32px) scale(1)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-37.25px) translateX(32px) scale(1)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) translateX(-32px) scale(0.75)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl],.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-34.75px) translateX(32px) scale(0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--with-trailing-icon{padding-left:16px;padding-right:0}[dir=rtl] .mdc-text-field--with-trailing-icon,.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0;padding-right:16px}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 64px)}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 64px/0.75)}.mdc-text-field--with-trailing-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 96px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 96px/0.75)}.mdc-text-field-helper-line{display:flex;justify-content:space-between;box-sizing:border-box}.mdc-text-field+.mdc-text-field-helper-line{padding-right:16px;padding-left:16px}.mdc-form-field>.mdc-text-field+label{align-self:flex-start}.mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--focused .mdc-notched-outline__trailing{border-width:2px}.mdc-text-field--focused+.mdc-text-field-helper-line .mdc-text-field-helper-text:not(.mdc-text-field-helper-text--validation-msg){opacity:1}.mdc-text-field--focused.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:2px}.mdc-text-field--focused.mdc-text-field--outlined.mdc-text-field--textarea .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--invalid+.mdc-text-field-helper-line .mdc-text-field-helper-text--validation-msg{opacity:1}.mdc-text-field--disabled{pointer-events:none}@media screen and (forced-colors: active){.mdc-text-field--disabled .mdc-text-field__input{background-color:Window}.mdc-text-field--disabled .mdc-floating-label{z-index:1}}.mdc-text-field--disabled .mdc-floating-label{cursor:default}.mdc-text-field--disabled.mdc-text-field--filled .mdc-text-field__ripple{display:none}.mdc-text-field--disabled .mdc-text-field__input{pointer-events:auto}.mdc-text-field--end-aligned .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--end-aligned .mdc-text-field__input[dir=rtl]{text-align:left}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix{direction:ltr}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--leading,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--leading{order:1}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{order:2}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input{order:3}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{order:4}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--trailing,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--trailing{order:5}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--prefix{padding-right:12px}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--suffix{padding-left:2px}.mdc-floating-label{position:absolute;left:0;-webkit-transform-origin:left top;transform-origin:left top;line-height:1.15rem;text-align:left;text-overflow:ellipsis;white-space:nowrap;cursor:text;overflow:hidden;will-change:transform}[dir=rtl] .mdc-floating-label,.mdc-floating-label[dir=rtl]{right:0;left:auto;-webkit-transform-origin:right top;transform-origin:right top;text-align:right}.mdc-floating-label--float-above{cursor:auto}.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:1px;margin-right:0px;content:"*"}[dir=rtl] .mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after,.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)[dir=rtl]::after{margin-left:0;margin-right:1px}.mdc-notched-outline{display:flex;position:absolute;top:0;right:0;left:0;box-sizing:border-box;width:100%;max-width:100%;height:100%;text-align:left;pointer-events:none}[dir=rtl] .mdc-notched-outline,.mdc-notched-outline[dir=rtl]{text-align:right}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{box-sizing:border-box;height:100%;pointer-events:none}.mdc-notched-outline__trailing{flex-grow:1}.mdc-notched-outline__notch{flex:0 0 auto;width:auto}.mdc-notched-outline .mdc-floating-label{display:inline-block;position:relative;max-width:100%}.mdc-notched-outline .mdc-floating-label--float-above{text-overflow:clip}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:133.3333333333%}.mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:0;padding-right:8px;border-top:none}[dir=rtl] .mdc-notched-outline--notched .mdc-notched-outline__notch,.mdc-notched-outline--notched .mdc-notched-outline__notch[dir=rtl]{padding-left:8px;padding-right:0}.mdc-notched-outline--no-label .mdc-notched-outline__notch{display:none}.mdc-line-ripple::before,.mdc-line-ripple::after{position:absolute;bottom:0;left:0;width:100%;border-bottom-style:solid;content:""}.mdc-line-ripple::before{z-index:1}.mdc-line-ripple::after{transform:scaleX(0);opacity:0;z-index:2}.mdc-line-ripple--active::after{transform:scaleX(1);opacity:1}.mdc-line-ripple--deactivating::after{opacity:0}.mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{border-top:1px solid;border-bottom:1px solid}.mdc-notched-outline__leading{border-left:1px solid;border-right:none;width:12px}[dir=rtl] .mdc-notched-outline__leading,.mdc-notched-outline__leading[dir=rtl]{border-left:none;border-right:1px solid}.mdc-notched-outline__trailing{border-left:none;border-right:1px solid}[dir=rtl] .mdc-notched-outline__trailing,.mdc-notched-outline__trailing[dir=rtl]{border-left:1px solid;border-right:none}.mdc-notched-outline__notch{max-width:calc(100% - 12px*2)}.mdc-line-ripple::before{border-bottom-width:1px}.mdc-line-ripple::after{border-bottom-width:2px}.mdc-text-field--filled{border-top-left-radius:var(--mdc-filled-text-field-container-shape);border-top-right-radius:var(--mdc-filled-text-field-container-shape);border-bottom-right-radius:0;border-bottom-left-radius:0}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-caret-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-error-caret-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-filled-text-field-input-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-filled-text-field-disabled-input-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-focus-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-hover-label-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-disabled-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-focus-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-hover-label-text-color)}.mdc-text-field--filled .mdc-floating-label{font-family:var(--mdc-filled-text-field-label-text-font);font-size:var(--mdc-filled-text-field-label-text-size);font-weight:var(--mdc-filled-text-field-label-text-weight);letter-spacing:var(--mdc-filled-text-field-label-text-tracking)}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}.mdc-text-field--filled:not(.mdc-text-field--disabled){background-color:var(--mdc-filled-text-field-container-color)}.mdc-text-field--filled.mdc-text-field--disabled{background-color:var(--mdc-filled-text-field-disabled-container-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-hover-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-focus-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-disabled-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-hover-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-error-focus-active-indicator-color)}.mdc-text-field--filled .mdc-line-ripple::before{border-bottom-width:var(--mdc-filled-text-field-active-indicator-height)}.mdc-text-field--filled .mdc-line-ripple::after{border-bottom-width:var(--mdc-filled-text-field-focus-active-indicator-height)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-caret-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-error-caret-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-outlined-text-field-input-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-outlined-text-field-disabled-input-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-focus-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-hover-label-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-disabled-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-focus-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-hover-label-text-color)}.mdc-text-field--outlined .mdc-floating-label{font-family:var(--mdc-outlined-text-field-label-text-font);font-size:var(--mdc-outlined-text-field-label-text-size);font-weight:var(--mdc-outlined-text-field-label-text-weight);letter-spacing:var(--mdc-outlined-text-field-label-text-tracking)}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(.75*var(--mdc-outlined-text-field-label-text-size))}.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mdc-outlined-text-field-label-text-size)}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px,var(--mdc-outlined-text-field-container-shape))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px,var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-hover-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-focus-outline-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-disabled-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-hover-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-focus-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-outline-width)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-focus-outline-width)}.mat-mdc-form-field-textarea-control{vertical-align:middle;resize:vertical;box-sizing:border-box;height:auto;margin:0;padding:0;border:none;overflow:auto}.mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:inherit;letter-spacing:inherit;text-decoration:inherit;text-transform:inherit;border:none}.mat-mdc-form-field .mat-mdc-floating-label.mdc-floating-label{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;line-height:normal;pointer-events:all;will-change:auto}.mat-mdc-form-field:not(.mat-form-field-disabled) .mat-mdc-floating-label.mdc-floating-label{cursor:inherit}.mdc-text-field--no-label:not(.mdc-text-field--textarea) .mat-mdc-form-field-input-control.mdc-text-field__input,.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control{height:auto}.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control.mdc-text-field__input[type=color]{height:23px}.mat-mdc-text-field-wrapper{height:auto;flex:auto;will-change:auto}.mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-left:0;--mat-mdc-form-field-label-offset-x: -16px}.mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-right:0}[dir=rtl] .mat-mdc-text-field-wrapper{padding-left:16px;padding-right:16px}[dir=rtl] .mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-left:0}[dir=rtl] .mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-right:0}.mat-form-field-disabled .mdc-text-field__input::placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-moz-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-webkit-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input:-ms-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-mdc-form-field-label-always-float .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms;opacity:1}.mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-floating-label{left:auto;right:auto}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-text-field__input{display:inline-block}.mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field .mdc-notched-outline__notch{padding-top:0}.mat-mdc-text-field-wrapper::before{content:none}.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:1px solid rgba(0,0,0,0)}[dir=rtl] .mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:none;border-right:1px solid rgba(0,0,0,0)}.mat-mdc-form-field-infix{min-height:var(--mat-form-field-container-height);padding-top:var(--mat-form-field-filled-with-label-container-padding-top);padding-bottom:var(--mat-form-field-filled-with-label-container-padding-bottom)}.mdc-text-field--outlined .mat-mdc-form-field-infix,.mdc-text-field--no-label .mat-mdc-form-field-infix{padding-top:var(--mat-form-field-container-vertical-padding);padding-bottom:var(--mat-form-field-container-vertical-padding)}.mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-floating-label{top:calc(var(--mat-form-field-container-height)/2)}.mdc-text-field--filled .mat-mdc-floating-label{display:var(--mat-form-field-filled-label-display, block)}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{--mat-mdc-form-field-label-transform: translateY(calc(calc(6.75px + var(--mat-form-field-container-height) / 2) * -1)) scale(var(--mat-mdc-form-field-floating-label-scale, 0.75));transform:var(--mat-mdc-form-field-label-transform)}.mat-mdc-form-field-subscript-wrapper{box-sizing:border-box;width:100%;position:relative}.mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-error-wrapper{position:absolute;top:0;left:0;right:0;padding:0 16px}.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-error-wrapper{position:static}.mat-mdc-form-field-bottom-align::before{content:"";display:inline-block;height:16px}.mat-mdc-form-field-bottom-align.mat-mdc-form-field-subscript-dynamic-size::before{content:unset}.mat-mdc-form-field-hint-end{order:1}.mat-mdc-form-field-hint-wrapper{display:flex}.mat-mdc-form-field-hint-spacer{flex:1 0 1em}.mat-mdc-form-field-error{display:block;color:var(--mat-form-field-error-text-color)}.mat-mdc-form-field-subscript-wrapper,.mat-mdc-form-field-bottom-align::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-subscript-text-font);line-height:var(--mat-form-field-subscript-text-line-height);font-size:var(--mat-form-field-subscript-text-size);letter-spacing:var(--mat-form-field-subscript-text-tracking);font-weight:var(--mat-form-field-subscript-text-weight)}.mat-mdc-form-field-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;opacity:0;pointer-events:none;background-color:var(--mat-form-field-state-layer-color)}.mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-hover-state-layer-opacity)}.mat-mdc-form-field.mat-focused .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-focus-state-layer-opacity)}select.mat-mdc-form-field-input-control{-moz-appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box}select.mat-mdc-form-field-input-control:not(:disabled){cursor:pointer}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option{color:var(--mat-form-field-select-option-text-color)}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option:disabled{color:var(--mat-form-field-select-disabled-option-text-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;right:0;top:50%;margin-top:-2.5px;pointer-events:none;color:var(--mat-form-field-enabled-select-arrow-color)}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{right:auto;left:0}.mat-mdc-form-field-type-mat-native-select.mat-focused .mat-mdc-form-field-infix::after{color:var(--mat-form-field-focus-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select.mat-form-field-disabled .mat-mdc-form-field-infix::after{color:var(--mat-form-field-disabled-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:15px}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:0;padding-left:15px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-mdc-text-field-wrapper{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-mdc-text-field-wrapper{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-mdc-text-field-wrapper{outline:dashed 3px}.cdk-high-contrast-active .mat-mdc-form-field.mat-focused .mdc-notched-outline{border:dashed 3px}.mat-mdc-form-field-input-control[type=date],.mat-mdc-form-field-input-control[type=datetime],.mat-mdc-form-field-input-control[type=datetime-local],.mat-mdc-form-field-input-control[type=month],.mat-mdc-form-field-input-control[type=week],.mat-mdc-form-field-input-control[type=time]{line-height:1}.mat-mdc-form-field-input-control::-webkit-datetime-edit{line-height:1;padding:0;margin-bottom:-2px}.mat-mdc-form-field{--mat-mdc-form-field-floating-label-scale: 0.75;display:inline-flex;flex-direction:column;min-width:0;text-align:left;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-container-text-font);line-height:var(--mat-form-field-container-text-line-height);font-size:var(--mat-form-field-container-text-size);letter-spacing:var(--mat-form-field-container-text-tracking);font-weight:var(--mat-form-field-container-text-weight)}[dir=rtl] .mat-mdc-form-field{text-align:right}.mat-mdc-form-field .mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(var(--mat-form-field-outlined-label-text-populated-size)*var(--mat-mdc-form-field-floating-label-scale))}.mat-mdc-form-field .mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mat-form-field-outlined-label-text-populated-size)}.mat-mdc-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-mdc-text-field-wrapper{width:100%;z-index:0}.mat-mdc-form-field-icon-prefix,.mat-mdc-form-field-icon-suffix{align-self:center;line-height:0;pointer-events:auto;position:relative;z-index:1}.mat-mdc-form-field-icon-prefix>.mat-icon,.mat-mdc-form-field-icon-suffix>.mat-icon{padding:0 12px;box-sizing:content-box}.mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-leading-icon-color)}.mat-form-field-disabled .mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-disabled-leading-icon-color)}.mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-trailing-icon-color)}.mat-form-field-disabled .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-disabled-trailing-icon-color)}.mat-form-field-invalid .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-trailing-icon-color)}.mat-form-field-invalid:not(.mat-focused):not(.mat-form-field-disabled) .mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-hover-trailing-icon-color)}.mat-form-field-invalid.mat-focused .mat-mdc-text-field-wrapper .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-focus-trailing-icon-color)}.mat-mdc-form-field-icon-prefix,[dir=rtl] .mat-mdc-form-field-icon-suffix{padding:0 4px 0 0}.mat-mdc-form-field-icon-suffix,[dir=rtl] .mat-mdc-form-field-icon-prefix{padding:0 0 0 4px}.mat-mdc-form-field-subscript-wrapper .mat-icon,.mat-mdc-form-field label .mat-icon{width:1em;height:1em;font-size:inherit}.mat-mdc-form-field-infix{flex:auto;min-width:0;width:180px;position:relative;box-sizing:border-box}.mat-mdc-form-field .mdc-notched-outline__notch{margin-left:-1px;-webkit-clip-path:inset(-9em -999em -9em 1px);clip-path:inset(-9em -999em -9em 1px)}[dir=rtl] .mat-mdc-form-field .mdc-notched-outline__notch{margin-left:0;margin-right:-1px;-webkit-clip-path:inset(-9em 1px -9em -999em);clip-path:inset(-9em 1px -9em -999em)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition-delay:40ms;transition-duration:110ms}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__affix{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled.mdc-ripple-upgraded--background-focused .mdc-text-field__ripple::before,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled:not(.mdc-ripple-upgraded):focus .mdc-text-field__ripple::before{transition-duration:75ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea{transition:none}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-filled 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-filled{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon{0%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}[dir=rtl] .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined[dir=rtl] .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon-rtl{0%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-floating-label{transition:transform 150ms cubic-bezier(0.4, 0, 0.2, 1),color 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-standard 250ms 1}@keyframes mdc-floating-label-shake-float-above-standard{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-line-ripple::after{transition:transform 180ms cubic-bezier(0.4, 0, 0.2, 1),opacity 180ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-notched-outline .mdc-floating-label{max-width:calc(100% + 1px)}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:calc(133.3333333333% + 1px)}'],encapsulation:2,data:{animation:[Bge.transitionMessages]},changeDetection:0})}}return e})(),d4=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({imports:[Wo,FE,yj,Wo]})}}return e})();const zge=new re("MAT_INPUT_VALUE_ACCESSOR"),Kge=["button","checkbox","file","hidden","image","radio","range","reset","submit"];let qge=0,Yge=(()=>{class e{get disabled(){return this._disabled}set disabled(n){this._disabled=ih(n),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(n){this._id=n||this._uid}get required(){return this._required??this.ngControl?.control?.hasValidator(f3.required)??!1}set required(n){this._required=ih(n)}get type(){return this._type}set type(n){this._type=n||"text",this._validateType(),!this._isTextarea&&_j().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(n){this._errorStateTracker.matcher=n}get value(){return this._inputValueAccessor.value}set value(n){n!==this.value&&(this._inputValueAccessor.value=n,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(n){this._readonly=ih(n)}get errorState(){return this._errorStateTracker.errorState}set errorState(n){this._errorStateTracker.errorState=n}constructor(n,i,r,o,s,a,c,l,d,u){this._elementRef=n,this._platform=i,this.ngControl=r,this._autofillMonitor=l,this._formField=u,this._uid="mat-input-"+qge++,this.focused=!1,this.stateChanges=new vt,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(m=>_j().has(m)),this._iOSKeyupListener=m=>{const f=m.target;!f.value&&0===f.selectionStart&&0===f.selectionEnd&&(f.setSelectionRange(1,1),f.setSelectionRange(0,0))};const h=this._elementRef.nativeElement,p=h.nodeName.toLowerCase();this._inputValueAccessor=c||h,this._previousNativeValue=this.value,this.id=this.id,i.IOS&&d.runOutsideAngular(()=>{n.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._errorStateTracker=new Vj(a,r,s,o,this.stateChanges),this._isServer=!this._platform.isBrowser,this._isNativeSelect="select"===p,this._isTextarea="textarea"===p,this._isInFormField=!!u,this._isNativeSelect&&(this.controlType=h.multiple?"mat-native-select-multiple":"mat-native-select")}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(n=>{this.autofilled=n.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngDoCheck(){this.ngControl&&(this.updateErrorState(),null!==this.ngControl.disabled&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(n){this._elementRef.nativeElement.focus(n)}updateErrorState(){this._errorStateTracker.updateErrorState()}_focusChanged(n){n!==this.focused&&(this.focused=n,this.stateChanges.next())}_onInput(){}_dirtyCheckNativeValue(){const n=this._elementRef.nativeElement.value;this._previousNativeValue!==n&&(this._previousNativeValue=n,this.stateChanges.next())}_dirtyCheckPlaceholder(){const n=this._getPlaceholder();if(n!==this._previousPlaceholder){const i=this._elementRef.nativeElement;this._previousPlaceholder=n,n?i.setAttribute("placeholder",n):i.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){Kge.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let n=this._elementRef.nativeElement.validity;return n&&n.badInput}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}get shouldLabelFloat(){if(this._isNativeSelect){const n=this._elementRef.nativeElement,i=n.options[0];return this.focused||n.multiple||!this.empty||!!(n.selectedIndex>-1&&i&&i.label)}return this.focused||!this.empty}setDescribedByIds(n){n.length?this._elementRef.nativeElement.setAttribute("aria-describedby",n.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){const n=this._elementRef.nativeElement;return this._isNativeSelect&&(n.multiple||n.size>1)}static{this.\u0275fac=function(i){return new(i||e)(H(sn),H(tr),H(tc,10),H(QE,8),H(Tm,8),H(kme),H(zge,10),H(Jme),H(Le),H(s4,8))}}static{this.\u0275dir=ye({type:e,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:18,hostBindings:function(i,r){1&i&&zt("focus",function(){return r._focusChanged(!0)})("blur",function(){return r._focusChanged(!1)})("input",function(){return r._onInput()}),2&i&&($f("id",r.id)("disabled",r.disabled)("required",r.required),yi("name",r.name||null)("readonly",r.readonly&&!r._isNativeSelect||null)("aria-invalid",r.empty&&r.required?null:r.errorState)("aria-required",r.required)("id",r.id),wt("mat-input-server",r._isServer)("mat-mdc-form-field-textarea-control",r._isInFormField&&r._isTextarea)("mat-mdc-form-field-input-control",r._isInFormField)("mdc-text-field__input",r._isInFormField)("mat-mdc-native-select-inline",r._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:[we.None,"aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["matInput"],standalone:!0,features:[mn([{provide:o4,useExisting:e}]),Gr]})}}return e})(),$ge=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({imports:[Wo,d4,d4,Qme,Wo]})}}return e})();const Xge=["switch"],Zge=["*"];function Jge(e,t){1&e&&(ue(0,"div",10),bs(),ue(1,"svg",12),pt(2,"path",13),ve(),ue(3,"svg",14),pt(4,"path",15),ve()())}const Qge=new re("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1})}),e_e={provide:Rs,useExisting:pn(()=>yR),multi:!0};class u4{constructor(t,n){this.source=t,this.checked=n}}let t_e=0,yR=(()=>{class e{_createChangeEvent(n){return new u4(this,n)}get buttonId(){return`${this.id||this._uniqueId}-button`}focus(){this._switchElement.nativeElement.focus()}get checked(){return this._checked}set checked(n){this._checked=n,this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(n,i,r,o,s,a){this._elementRef=n,this._focusMonitor=i,this._changeDetectorRef=r,this.defaults=s,this._onChange=c=>{},this._onTouched=()=>{},this._validatorOnChange=()=>{},this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.disabled=!1,this.disableRipple=!1,this.tabIndex=0,this.change=new Wt,this.toggleChange=new Wt,this.tabIndex=parseInt(o)||0,this.color=s.color||"accent",this._noopAnimations="NoopAnimations"===a,this.id=this._uniqueId="mat-mdc-slide-toggle-"+ ++t_e,this.hideIcon=s.hideIcon??!1,this._labelId=this._uniqueId+"-label"}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(n=>{"keyboard"===n||"program"===n?(this._focused=!0,this._changeDetectorRef.markForCheck()):n||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnChanges(n){n.required&&this._validatorOnChange()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(n){this.checked=!!n}registerOnChange(n){this._onChange=n}registerOnTouched(n){this._onTouched=n}validate(n){return this.required&&!0!==n.value?{required:!0}:null}registerOnValidatorChange(n){this._validatorOnChange=n}setDisabledState(n){this.disabled=n,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}_handleClick(){this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new u4(this,this.checked)))}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}static{this.\u0275fac=function(i){return new(i||e)(H(sn),H(uR),H(Ts),function fu(e){return function Dee(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const i=n.length;let r=0;for(;r<i;){const o=n[r];if(H1(o))break;if(0===o)r+=2;else if("number"==typeof o)for(r++;r<i&&"string"==typeof n[r];)r++;else{if(o===t)return n[r+1];r+=2}}}return null}(on(),e)}("tabindex"),H(Qge),H(za,8))}}static{this.\u0275cmp=sr({type:e,selectors:[["mat-slide-toggle"]],viewQuery:function(i,r){if(1&i&&oa(Xge,5),2&i){let o;ji(o=Hi())&&(r._switchElement=o.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:13,hostBindings:function(i,r){2&i&&($f("id",r.id),yi("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),Sw(r.color?"mat-"+r.color:""),wt("mat-mdc-slide-toggle-focused",r._focused)("mat-mdc-slide-toggle-checked",r.checked)("_mat-animation-noopable",r._noopAnimations))},inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:[we.None,"aria-label","ariaLabel"],ariaLabelledby:[we.None,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[we.None,"aria-describedby","ariaDescribedby"],required:[we.HasDecoratorInputTransform,"required","required",Ar],color:"color",disabled:[we.HasDecoratorInputTransform,"disabled","disabled",Ar],disableRipple:[we.HasDecoratorInputTransform,"disableRipple","disableRipple",Ar],tabIndex:[we.HasDecoratorInputTransform,"tabIndex","tabIndex",n=>null==n?0:function Jle(e,t=NaN){return isNaN(parseFloat(e))||isNaN(Number(e))?t:Number(e)}(n)],checked:[we.HasDecoratorInputTransform,"checked","checked",Ar],hideIcon:[we.HasDecoratorInputTransform,"hideIcon","hideIcon",Ar]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],standalone:!0,features:[mn([e_e,{provide:Gi,useExisting:e,multi:!0}]),Yv,Gr,Lc],ngContentSelectors:Zge,decls:13,vars:24,consts:[["switch",""],["mat-internal-form-field","",3,"labelPosition"],["role","switch","type","button",1,"mdc-switch",3,"click","tabIndex","disabled"],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-switch__icons"],[1,"mdc-label",3,"click","for"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(i,r){if(1&i){const o=$a();qu(),ue(0,"div",1)(1,"button",2,0),zt("click",function(){return Wr(o),zr(r._handleClick())}),pt(3,"div",3),ue(4,"div",4)(5,"div",5)(6,"div",6),pt(7,"div",7),ve(),ue(8,"div",8),pt(9,"div",9),ve(),an(10,Jge,5,0,"div",10),ve()()(),ue(11,"label",11),zt("click",function(a){return Wr(o),zr(a.stopPropagation())}),pr(12),ve()()}if(2&i){const o=nm(2);ht("labelPosition",r.labelPosition),Re(),wt("mdc-switch--selected",r.checked)("mdc-switch--unselected",!r.checked)("mdc-switch--checked",r.checked)("mdc-switch--disabled",r.disabled),ht("tabIndex",r.disabled?-1:r.tabIndex)("disabled",r.disabled),yi("id",r.buttonId)("name",r.name)("aria-label",r.ariaLabel)("aria-labelledby",r._getAriaLabelledBy())("aria-describedby",r.ariaDescribedby)("aria-required",r.required||null)("aria-checked",r.checked),Re(8),ht("matRippleTrigger",o)("matRippleDisabled",r.disableRipple||r.disabled)("matRippleCentered",!0),Re(),wr(10,r.hideIcon?-1:10),Re(),ht("for",r.buttonId),yi("id",r._labelId)}},dependencies:[Kj,Hme],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1);background-color:var(--mdc-elevation-overlay-color)}.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative}.mdc-switch[hidden]{display:none}.mdc-switch:disabled{cursor:default;pointer-events:none}.mdc-switch__track{overflow:hidden;position:relative;width:100%}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%}@media screen and (forced-colors: active){.mdc-switch__track::before,.mdc-switch__track::after{border-color:currentColor}}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(-100%)}[dir=rtl] .mdc-switch__track::after,.mdc-switch__track[dir=rtl]::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track[dir=rtl]::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::after{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0)}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0)}[dir=rtl] .mdc-switch__handle-track,.mdc-switch__handle-track[dir=rtl]{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track,.mdc-switch--selected .mdc-switch__handle-track[dir=rtl]{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto}[dir=rtl] .mdc-switch__handle,.mdc-switch__handle[dir=rtl]{left:auto;right:0}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}@media screen and (forced-colors: active){.mdc-switch__handle::before,.mdc-switch__handle::after{border-color:currentColor}}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-elevation-overlay{bottom:0;left:0;right:0;top:0}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1}.mdc-switch:disabled .mdc-switch__ripple{display:none}.mdc-switch__icons{height:100%;position:relative;width:100%;z-index:1}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle .mdc-switch--disabled+label{color:var(--mdc-switch-disabled-label-text-color)}.mdc-switch{width:var(--mdc-switch-track-width)}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color)}.mdc-switch.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color)}.mdc-switch .mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation)}.mdc-switch .mdc-switch__focus-ring-wrapper,.mdc-switch .mdc-switch__handle{height:var(--mdc-switch-handle-height)}.mdc-switch .mdc-switch__handle{border-radius:var(--mdc-switch-handle-shape)}.mdc-switch .mdc-switch__handle{width:var(--mdc-switch-handle-width)}.mdc-switch .mdc-switch__handle-track{width:calc(100% - var(--mdc-switch-handle-width))}.mdc-switch.mdc-switch--selected:enabled .mdc-switch__icon{fill:var(--mdc-switch-selected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color)}.mdc-switch.mdc-switch--unselected:enabled .mdc-switch__icon{fill:var(--mdc-switch-unselected-icon-color)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color)}.mdc-switch.mdc-switch--selected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity)}.mdc-switch.mdc-switch--unselected:disabled .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity)}.mdc-switch.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size);height:var(--mdc-switch-selected-icon-size)}.mdc-switch.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size);height:var(--mdc-switch-unselected-icon-size)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-hover-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-focus-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-selected-pressed-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-hover-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-focus-state-layer-color)}.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background-color:var(--mdc-switch-unselected-pressed-state-layer-color)}.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-selected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--selected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-selected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--selected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--selected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-selected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus):hover .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:hover:not(:focus).mdc-ripple-surface--hover .mdc-switch__ripple::before{opacity:var(--mdc-switch-unselected-hover-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:focus.mdc-ripple-upgraded--background-focused .mdc-switch__ripple::before,.mdc-switch.mdc-switch--unselected:enabled:focus:not(.mdc-ripple-upgraded):focus .mdc-switch__ripple::before{transition-duration:75ms;opacity:var(--mdc-switch-unselected-focus-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded) .mdc-switch__ripple::after{transition:opacity 150ms linear}.mdc-switch.mdc-switch--unselected:enabled:active:not(.mdc-ripple-upgraded):active .mdc-switch__ripple::after{transition-duration:75ms;opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch.mdc-switch--unselected:enabled:active.mdc-ripple-upgraded{--mdc-ripple-fg-opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity)}.mdc-switch .mdc-switch__ripple{height:var(--mdc-switch-state-layer-size);width:var(--mdc-switch-state-layer-size)}.mdc-switch .mdc-switch__track{height:var(--mdc-switch-track-height)}.mdc-switch:disabled .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity)}.mdc-switch:enabled .mdc-switch__track::after{background:var(--mdc-switch-selected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color)}.mdc-switch:enabled .mdc-switch__track::before{background:var(--mdc-switch-unselected-track-color)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color)}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color)}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color)}.mdc-switch:disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color)}.mdc-switch .mdc-switch__track{border-radius:var(--mdc-switch-track-shape)}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mdc-switch:disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mat-mdc-slide-toggle{display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle .mdc-switch__ripple::after{content:"";opacity:0}.mat-mdc-slide-toggle .mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:opacity 75ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-mdc-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-elevation-overlay,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}.mdc-switch__handle{transition:width 75ms cubic-bezier(0.4, 0, 0.2, 1),height 75ms cubic-bezier(0.4, 0, 0.2, 1),margin 75ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-switch--selected .mdc-switch__track::before{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mdc-switch--selected .mdc-switch__track::after{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch--unselected .mdc-switch__track::before{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch--unselected .mdc-switch__track::after{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{width:var(--mat-switch-unselected-handle-size);height:var(--mat-switch-unselected-handle-size)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{width:var(--mat-switch-selected-handle-size);height:var(--mat-switch-selected-handle-size)}.mat-mdc-slide-toggle .mdc-switch__handle:has(.mdc-switch__icons){width:var(--mat-switch-with-icon-handle-size);height:var(--mat-switch-with-icon-handle-size)}.mat-mdc-slide-toggle:active .mdc-switch:not(.mdc-switch--disabled) .mdc-switch__handle{width:var(--mat-switch-pressed-handle-size);height:var(--mat-switch-pressed-handle-size)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{margin:var(--mat-switch-selected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-selected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{margin:var(--mat-switch-unselected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-unselected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle:active .mdc-switch--selected:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-selected-pressed-handle-horizontal-margin)}.mat-mdc-slide-toggle:active .mdc-switch--unselected:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-unselected-pressed-handle-horizontal-margin)}.mdc-switch__track::after,.mdc-switch__track::before{border-width:var(--mat-switch-track-outline-width);border-color:var(--mat-switch-track-outline-color)}.mdc-switch--selected .mdc-switch__track::after,.mdc-switch--selected .mdc-switch__track::before{border-width:var(--mat-switch-selected-track-outline-width)}.mdc-switch--disabled .mdc-switch__track::after,.mdc-switch--disabled .mdc-switch__track::before{border-width:var(--mat-switch-disabled-unselected-track-outline-width);border-color:var(--mat-switch-disabled-unselected-track-outline-color)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-selected-handle-opacity)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-unselected-handle-opacity)}'],encapsulation:2,changeDetection:0})}}return e})(),r_e=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({imports:[yR,Wo,Wo]})}}return e})();const o_e=["addListener","removeListener"],s_e=["addEventListener","removeEventListener"],a_e=["on","off"];function SR(e,t,n,i){if(Ft(n)&&(i=n,n=void 0),i)return SR(e,t,n).pipe(FI(i));const[r,o]=function d_e(e){return Ft(e.addEventListener)&&Ft(e.removeEventListener)}(e)?s_e.map(s=>a=>e[s](t,a,n)):function c_e(e){return Ft(e.addListener)&&Ft(e.removeListener)}(e)?o_e.map(h4(e,t)):function l_e(e){return Ft(e.on)&&Ft(e.off)}(e)?a_e.map(h4(e,t)):[];if(!r&&kI(e))return zi(s=>SR(s,t,n))(mr(e));if(!r)throw new TypeError("Invalid event target");return new Gn(s=>{const a=(...c)=>s.next(1<c.length?c:c[0]);return r(a),()=>o(a)})}function h4(e,t){return n=>i=>e[n](t,i)}const km={schedule(e){let t=requestAnimationFrame,n=cancelAnimationFrame;const{delegate:i}=km;i&&(t=i.requestAnimationFrame,n=i.cancelAnimationFrame);const r=t(o=>{n=void 0,e(o)});return new li(()=>n?.(r))},requestAnimationFrame(...e){const{delegate:t}=km;return(t?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:t}=km;return(t?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0};new class h_e extends cR{flush(t){this._active=!0;const n=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===n&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===n&&i.shift();)t.unsubscribe();throw r}}}(class u_e extends sR{constructor(t,n){super(t,n),this.scheduler=t,this.work=n}requestAsyncId(t,n,i=0){return null!==i&&i>0?super.requestAsyncId(t,n,i):(t.actions.push(this),t._scheduled||(t._scheduled=km.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,n,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,n,i);const{actions:o}=t;null!=n&&(null===(r=o[o.length-1])||void 0===r?void 0:r.id)!==n&&(km.cancelAnimationFrame(n),t._scheduled=void 0)}});let CR,f_e=1;const ub={};function p4(e){return e in ub&&(delete ub[e],!0)}const m_e={setImmediate(e){const t=f_e++;return ub[t]=!0,CR||(CR=Promise.resolve()),CR.then(()=>p4(t)&&e()),t},clearImmediate(e){p4(e)}},{setImmediate:g_e,clearImmediate:__e}=m_e,hb={setImmediate(...e){const{delegate:t}=hb;return(t?.setImmediate||g_e)(...e)},clearImmediate(e){const{delegate:t}=hb;return(t?.clearImmediate||__e)(e)},delegate:void 0};new class E_e extends cR{flush(t){this._active=!0;const n=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;t=t||i.shift();do{if(r=t.execute(t.state,t.delay))break}while((t=i[0])&&t.id===n&&i.shift());if(this._active=!1,r){for(;(t=i[0])&&t.id===n&&i.shift();)t.unsubscribe();throw r}}}(class v_e extends sR{constructor(t,n){super(t,n),this.scheduler=t,this.work=n}requestAsyncId(t,n,i=0){return null!==i&&i>0?super.requestAsyncId(t,n,i):(t.actions.push(this),t._scheduled||(t._scheduled=hb.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,n,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(t,n,i);const{actions:o}=t;null!=n&&(null===(r=o[o.length-1])||void 0===r?void 0:r.id)!==n&&(hb.clearImmediate(n),t._scheduled===n&&(t._scheduled=void 0))}});function pb(e=0,t,n=qfe){let i=-1;return null!=t&&(c3(t)?n=t:i=t),new Gn(r=>{let o=function S_e(e){return e instanceof Date&&!isNaN(e)}(e)?+e-n.now():e;o<0&&(o=0);let s=0;return n.schedule(function(){r.closed||(r.next(s++),0<=i?this.schedule(void 0,i):r.complete())},o)})}function f4(e,t=Am){return function y_e(e){return Jn((t,n)=>{let i=!1,r=null,o=null,s=!1;const a=()=>{if(o?.unsubscribe(),o=null,i){i=!1;const l=r;r=null,n.next(l)}s&&n.complete()},c=()=>{o=null,s&&n.complete()};t.subscribe(Un(n,l=>{i=!0,r=l,o||mr(e(l)).subscribe(o=Un(n,a,c))},()=>{s=!0,(!i||!o||o.closed)&&n.complete()}))})}(()=>pb(e,t))}let m4=(()=>{class e{constructor(n,i,r){this._ngZone=n,this._platform=i,this._scrolled=new vt,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(n){this.scrollContainers.has(n)||this.scrollContainers.set(n,n.elementScrolled().subscribe(()=>this._scrolled.next(n)))}deregister(n){const i=this.scrollContainers.get(n);i&&(i.unsubscribe(),this.scrollContainers.delete(n))}scrolled(n=20){return this._platform.isBrowser?new Gn(i=>{this._globalSubscription||this._addGlobalListener();const r=n>0?this._scrolled.pipe(f4(n)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):Be()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((n,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(n,i){const r=this.getAncestorScrollContainers(n);return this.scrolled(i).pipe($r(o=>!o||r.indexOf(o)>-1))}getAncestorScrollContainers(n){const i=[];return this.scrollContainers.forEach((r,o)=>{this._scrollableContainsElement(o,n)&&i.push(o)}),i}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(n,i){let r=Gc(i),o=n.getElementRef().nativeElement;do{if(r==o)return!0}while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>SR(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}static{this.\u0275fac=function(i){return new(i||e)(Z(Le),Z(tr),Z(Ut,8))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),g4=(()=>{class e{constructor(n,i,r){this._platform=n,this._change=new vt,this._changeListener=o=>{this._change.next(o)},this._document=r,i.runOutsideAngular(()=>{if(n.isBrowser){const o=this._getWindow();o.addEventListener("resize",this._changeListener),o.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const n=this._getWindow();n.removeEventListener("resize",this._changeListener),n.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const n={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),n}getViewportRect(){const n=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:n.top,left:n.left,bottom:n.top+r,right:n.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const n=this._document,i=this._getWindow(),r=n.documentElement,o=r.getBoundingClientRect();return{top:-o.top||n.body.scrollTop||i.scrollY||r.scrollTop||0,left:-o.left||n.body.scrollLeft||i.scrollX||r.scrollLeft||0}}change(n=20){return n>0?this._change.pipe(f4(n)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const n=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:n.innerWidth,height:n.innerHeight}:{width:0,height:0}}static{this.\u0275fac=function(i){return new(i||e)(Z(tr),Z(Le),Z(Ut,8))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),TR=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({})}}return e})(),_4=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({imports:[Om,TR,Om,TR]})}}return e})();class wR{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class v4 extends wR{constructor(t,n,i,r,o){super(),this.component=t,this.viewContainerRef=n,this.injector=i,this.componentFactoryResolver=r,this.projectableNodes=o}}class w_e extends wR{constructor(t,n,i,r){super(),this.templateRef=t,this.viewContainerRef=n,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(t,n=this.context){return this.context=n,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class I_e extends wR{constructor(t){super(),this.element=t instanceof sn?t.nativeElement:t}}class R_e{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof v4?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof w_e?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof I_e?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class A_e extends R_e{constructor(t,n,i,r,o){super(),this.outletElement=t,this._componentFactoryResolver=n,this._appRef=i,this._defaultInjector=r,this.attachDomPortal=s=>{const a=s.element,c=this._document.createComment("dom-portal");a.parentNode.insertBefore(c,a),this.outletElement.appendChild(a),this._attachedPortal=s,super.setDisposeFn(()=>{c.parentNode&&c.parentNode.replaceChild(a,c)})},this._document=o}attachComponentPortal(t){const i=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let r;return t.viewContainerRef?(r=t.viewContainerRef.createComponent(i,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector,t.projectableNodes||void 0),this.setDisposeFn(()=>r.destroy())):(r=i.create(t.injector||this._defaultInjector||Bi.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=t,r}attachTemplatePortal(t){let n=t.viewContainerRef,i=n.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=n.indexOf(i);-1!==r&&n.remove(r)}),this._attachedPortal=t,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let D_e=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({})}}return e})();const E4=Tfe();class O_e{constructor(t,n){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=n}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=wi(-this._previousScrollPosition.left),t.style.top=wi(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,i=t.style,r=this._document.body.style,o=i.scrollBehavior||"",s=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),E4&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),E4&&(i.scrollBehavior=o,r.scrollBehavior=s)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const n=this._document.body,i=this._viewportRuler.getViewportSize();return n.scrollHeight>i.height||n.scrollWidth>i.width}}class N_e{constructor(t,n,i,r){this._scrollDispatcher=t,this._ngZone=n,this._viewportRuler=i,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0).pipe($r(n=>!n||!this._overlayRef.overlayElement.contains(n.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const n=this._viewportRuler.getViewportScrollPosition().top;Math.abs(n-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class b4{enable(){}disable(){}attach(){}}function IR(e,t){return t.some(n=>e.bottom<n.top||e.top>n.bottom||e.right<n.left||e.left>n.right)}function y4(e,t){return t.some(n=>e.top<n.top||e.bottom>n.bottom||e.left<n.left||e.right>n.right)}class P_e{constructor(t,n,i,r){this._scrollDispatcher=t,this._viewportRuler=n,this._ngZone=i,this._config=r,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const n=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();IR(n,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let M_e=(()=>{class e{constructor(n,i,r,o){this._scrollDispatcher=n,this._viewportRuler=i,this._ngZone=r,this.noop=()=>new b4,this.close=s=>new N_e(this._scrollDispatcher,this._ngZone,this._viewportRuler,s),this.block=()=>new O_e(this._viewportRuler,this._document),this.reposition=s=>new P_e(this._scrollDispatcher,this._viewportRuler,this._ngZone,s),this._document=o}static{this.\u0275fac=function(i){return new(i||e)(Z(m4),Z(g4),Z(Le),Z(Ut))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();class x_e{constructor(t){if(this.scrollStrategy=new b4,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const n=Object.keys(t);for(const i of n)void 0!==t[i]&&(this[i]=t[i])}}}class k_e{constructor(t,n){this.connectionPair=t,this.scrollableViewProperties=n}}let S4=(()=>{class e{constructor(n){this._attachedOverlays=[],this._document=n}ngOnDestroy(){this.detach()}add(n){this.remove(n),this._attachedOverlays.push(n)}remove(n){const i=this._attachedOverlays.indexOf(n);i>-1&&this._attachedOverlays.splice(i,1),0===this._attachedOverlays.length&&this.detach()}static{this.\u0275fac=function(i){return new(i||e)(Z(Ut))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),L_e=(()=>{class e extends S4{constructor(n,i){super(n),this._ngZone=i,this._keydownListener=r=>{const o=this._attachedOverlays;for(let s=o.length-1;s>-1;s--)if(o[s]._keydownEvents.observers.length>0){const a=o[s]._keydownEvents;this._ngZone?this._ngZone.run(()=>a.next(r)):a.next(r);break}}}add(n){super.add(n),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}static{this.\u0275fac=function(i){return new(i||e)(Z(Ut),Z(Le,8))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),F_e=(()=>{class e extends S4{constructor(n,i,r){super(n),this._platform=i,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=o=>{this._pointerDownEventTarget=Hc(o)},this._clickListener=o=>{const s=Hc(o),a="click"===o.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:s;this._pointerDownEventTarget=null;const c=this._attachedOverlays.slice();for(let l=c.length-1;l>-1;l--){const d=c[l];if(d._outsidePointerEvents.observers.length<1||!d.hasAttached())continue;if(d.overlayElement.contains(s)||d.overlayElement.contains(a))break;const u=d._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>u.next(o)):u.next(o)}}}add(n){if(super.add(n),!this._isAttached){const i=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(i)):this._addEventListeners(i),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const n=this._document.body;n.removeEventListener("pointerdown",this._pointerDownListener,!0),n.removeEventListener("click",this._clickListener,!0),n.removeEventListener("auxclick",this._clickListener,!0),n.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(n.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(n){n.addEventListener("pointerdown",this._pointerDownListener,!0),n.addEventListener("click",this._clickListener,!0),n.addEventListener("auxclick",this._clickListener,!0),n.addEventListener("contextmenu",this._clickListener,!0)}static{this.\u0275fac=function(i){return new(i||e)(Z(Ut),Z(tr),Z(Le,8))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),C4=(()=>{class e{constructor(n,i){this._platform=i,this._document=n}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const n="cdk-overlay-container";if(this._platform.isBrowser||oR()){const r=this._document.querySelectorAll(`.${n}[platform="server"], .${n}[platform="test"]`);for(let o=0;o<r.length;o++)r[o].remove()}const i=this._document.createElement("div");i.classList.add(n),oR()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}static{this.\u0275fac=function(i){return new(i||e)(Z(Ut),Z(tr))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();class U_e{constructor(t,n,i,r,o,s,a,c,l,d=!1){this._portalOutlet=t,this._host=n,this._pane=i,this._config=r,this._ngZone=o,this._keyboardDispatcher=s,this._document=a,this._location=c,this._outsideClickDispatcher=l,this._animationsDisabled=d,this._backdropElement=null,this._backdropClick=new vt,this._attachments=new vt,this._detachments=new vt,this._locationChanges=li.EMPTY,this._backdropClickHandler=u=>this._backdropClick.next(u),this._backdropTransitionendHandler=u=>{this._disposeBackdrop(u.target)},this._keydownEvents=new vt,this._outsidePointerEvents=new vt,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const n=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Ti(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof n?.onDestroy&&n.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),n}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){const t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,t&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config={...this._config,...t},this._updateElementSize()}setDirection(t){this._config={...this._config,direction:t},this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=wi(this._config.width),t.height=wi(this._config.height),t.minWidth=wi(this._config.minWidth),t.minHeight=wi(this._config.minHeight),t.maxWidth=wi(this._config.maxWidth),t.maxHeight=wi(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})}):this._backdropElement.classList.add(t)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,n,i){const r=nb(n||[]).filter(o=>!!o);r.length&&(i?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(gr(Zj(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const T4="cdk-overlay-connected-position-bounding-box",V_e=/([A-Za-z%]+)$/;class B_e{get positions(){return this._preferredPositions}constructor(t,n,i,r,o){this._viewportRuler=n,this._document=i,this._platform=r,this._overlayContainer=o,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new vt,this._resizeSubscription=li.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}attach(t){this._validatePositions(),t.hostElement.classList.add(T4),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,n=this._overlayRect,i=this._viewportRect,r=this._containerRect,o=[];let s;for(let a of this._preferredPositions){let c=this._getOriginPoint(t,r,a),l=this._getOverlayPoint(c,n,a),d=this._getOverlayFit(l,n,i,a);if(d.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(a,c);this._canFitWithFlexibleDimensions(d,l,i)?o.push({position:a,origin:c,overlayRect:n,boundingBoxRect:this._calculateBoundingBoxRect(c,a)}):(!s||s.overlayFit.visibleArea<d.visibleArea)&&(s={overlayFit:d,overlayPoint:l,originPoint:c,position:a,overlayRect:n})}if(o.length){let a=null,c=-1;for(const l of o){const d=l.boundingBoxRect.width*l.boundingBoxRect.height*(l.position.weight||1);d>c&&(c=d,a=l)}return this._isPushed=!1,void this._applyPosition(a.position,a.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(s.position,s.originPoint);this._applyPosition(s.position,s.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&id(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(T4),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const n=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,n)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,n,i){let r,o;if("center"==i.originX)r=t.left+t.width/2;else{const s=this._isRtl()?t.right:t.left,a=this._isRtl()?t.left:t.right;r="start"==i.originX?s:a}return n.left<0&&(r-=n.left),o="center"==i.originY?t.top+t.height/2:"top"==i.originY?t.top:t.bottom,n.top<0&&(o-=n.top),{x:r,y:o}}_getOverlayPoint(t,n,i){let r,o;return r="center"==i.overlayX?-n.width/2:"start"===i.overlayX?this._isRtl()?-n.width:0:this._isRtl()?0:-n.width,o="center"==i.overlayY?-n.height/2:"top"==i.overlayY?0:-n.height,{x:t.x+r,y:t.y+o}}_getOverlayFit(t,n,i,r){const o=I4(n);let{x:s,y:a}=t,c=this._getOffset(r,"x"),l=this._getOffset(r,"y");c&&(s+=c),l&&(a+=l);let h=0-a,p=a+o.height-i.height,m=this._subtractOverflows(o.width,0-s,s+o.width-i.width),f=this._subtractOverflows(o.height,h,p),g=m*f;return{visibleArea:g,isCompletelyWithinViewport:o.width*o.height===g,fitsInViewportVertically:f===o.height,fitsInViewportHorizontally:m==o.width}}_canFitWithFlexibleDimensions(t,n,i){if(this._hasFlexibleDimensions){const r=i.bottom-n.y,o=i.right-n.x,s=w4(this._overlayRef.getConfig().minHeight),a=w4(this._overlayRef.getConfig().minWidth);return(t.fitsInViewportVertically||null!=s&&s<=r)&&(t.fitsInViewportHorizontally||null!=a&&a<=o)}return!1}_pushOverlayOnScreen(t,n,i){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const r=I4(n),o=this._viewportRect,s=Math.max(t.x+r.width-o.width,0),a=Math.max(t.y+r.height-o.height,0),c=Math.max(o.top-i.top-t.y,0),l=Math.max(o.left-i.left-t.x,0);let d=0,u=0;return d=r.width<=o.width?l||-s:t.x<this._viewportMargin?o.left-i.left-t.x:0,u=r.height<=o.height?c||-a:t.y<this._viewportMargin?o.top-i.top-t.y:0,this._previousPushAmount={x:d,y:u},{x:t.x+d,y:t.y+u}}_applyPosition(t,n){if(this._setTransformOrigin(t),this._setOverlayElementStyles(n,t),this._setBoundingBoxStyles(n,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._positionChanges.observers.length){const i=this._getScrollVisibility();if(t!==this._lastPosition||!this._lastScrollVisibility||!function j_e(e,t){return e===t||e.isOriginClipped===t.isOriginClipped&&e.isOriginOutsideView===t.isOriginOutsideView&&e.isOverlayClipped===t.isOverlayClipped&&e.isOverlayOutsideView===t.isOverlayOutsideView}(this._lastScrollVisibility,i)){const r=new k_e(t,i);this._positionChanges.next(r)}this._lastScrollVisibility=i}this._lastPosition=t,this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const n=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,r=t.overlayY;i="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let o=0;o<n.length;o++)n[o].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(t,n){const i=this._viewportRect,r=this._isRtl();let o,s,a,d,u,h;if("top"===n.overlayY)s=t.y,o=i.height-s+this._viewportMargin;else if("bottom"===n.overlayY)a=i.height-t.y+2*this._viewportMargin,o=i.height-a+this._viewportMargin;else{const p=Math.min(i.bottom-t.y+i.top,t.y),m=this._lastBoundingBoxSize.height;o=2*p,s=t.y-p,o>m&&!this._isInitialRender&&!this._growAfterOpen&&(s=t.y-m/2)}if("end"===n.overlayX&&!r||"start"===n.overlayX&&r)h=i.width-t.x+2*this._viewportMargin,d=t.x-this._viewportMargin;else if("start"===n.overlayX&&!r||"end"===n.overlayX&&r)u=t.x,d=i.right-t.x;else{const p=Math.min(i.right-t.x+i.left,t.x),m=this._lastBoundingBoxSize.width;d=2*p,u=t.x-p,d>m&&!this._isInitialRender&&!this._growAfterOpen&&(u=t.x-m/2)}return{top:s,left:u,bottom:a,right:h,width:d,height:o}}_setBoundingBoxStyles(t,n){const i=this._calculateBoundingBoxRect(t,n);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const o=this._overlayRef.getConfig().maxHeight,s=this._overlayRef.getConfig().maxWidth;r.height=wi(i.height),r.top=wi(i.top),r.bottom=wi(i.bottom),r.width=wi(i.width),r.left=wi(i.left),r.right=wi(i.right),r.alignItems="center"===n.overlayX?"center":"end"===n.overlayX?"flex-end":"flex-start",r.justifyContent="center"===n.overlayY?"center":"bottom"===n.overlayY?"flex-end":"flex-start",o&&(r.maxHeight=wi(o)),s&&(r.maxWidth=wi(s))}this._lastBoundingBoxSize=i,id(this._boundingBox.style,r)}_resetBoundingBoxStyles(){id(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){id(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,n){const i={},r=this._hasExactPosition(),o=this._hasFlexibleDimensions,s=this._overlayRef.getConfig();if(r){const d=this._viewportRuler.getViewportScrollPosition();id(i,this._getExactOverlayY(n,t,d)),id(i,this._getExactOverlayX(n,t,d))}else i.position="static";let a="",c=this._getOffset(n,"x"),l=this._getOffset(n,"y");c&&(a+=`translateX(${c}px) `),l&&(a+=`translateY(${l}px)`),i.transform=a.trim(),s.maxHeight&&(r?i.maxHeight=wi(s.maxHeight):o&&(i.maxHeight="")),s.maxWidth&&(r?i.maxWidth=wi(s.maxWidth):o&&(i.maxWidth="")),id(this._pane.style,i)}_getExactOverlayY(t,n,i){let r={top:"",bottom:""},o=this._getOverlayPoint(n,this._overlayRect,t);return this._isPushed&&(o=this._pushOverlayOnScreen(o,this._overlayRect,i)),"bottom"===t.overlayY?r.bottom=this._document.documentElement.clientHeight-(o.y+this._overlayRect.height)+"px":r.top=wi(o.y),r}_getExactOverlayX(t,n,i){let s,r={left:"",right:""},o=this._getOverlayPoint(n,this._overlayRect,t);return this._isPushed&&(o=this._pushOverlayOnScreen(o,this._overlayRect,i)),s=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===s?r.right=this._document.documentElement.clientWidth-(o.x+this._overlayRect.width)+"px":r.left=wi(o.x),r}_getScrollVisibility(){const t=this._getOriginRect(),n=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:y4(t,i),isOriginOutsideView:IR(t,i),isOverlayClipped:y4(n,i),isOverlayOutsideView:IR(n,i)}}_subtractOverflows(t,...n){return n.reduce((i,r)=>i-Math.max(r,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,n=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+t-this._viewportMargin,bottom:i.top+n-this._viewportMargin,width:t-2*this._viewportMargin,height:n-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,n){return"x"===n?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&nb(t).forEach(n=>{""!==n&&-1===this._appliedPanelClasses.indexOf(n)&&(this._appliedPanelClasses.push(n),this._pane.classList.add(n))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof sn)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const n=t.width||0,i=t.height||0;return{top:t.y,bottom:t.y+i,left:t.x,right:t.x+n,height:i,width:n}}}function id(e,t){for(let n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function w4(e){if("number"!=typeof e&&null!=e){const[t,n]=e.split(V_e);return n&&"px"!==n?null:parseFloat(t)}return e||null}function I4(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}const R4="cdk-global-overlay-wrapper";class H_e{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const n=t.getConfig();this._overlayRef=t,this._width&&!n.width&&t.updateSize({width:this._width}),this._height&&!n.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(R4),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,n=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:o,maxWidth:s,maxHeight:a}=i,c=!("100%"!==r&&"100vw"!==r||s&&"100%"!==s&&"100vw"!==s),l=!("100%"!==o&&"100vh"!==o||a&&"100%"!==a&&"100vh"!==a),d=this._xPosition,u=this._xOffset,h="rtl"===this._overlayRef.getConfig().direction;let p="",m="",f="";c?f="flex-start":"center"===d?(f="center",h?m=u:p=u):h?"left"===d||"end"===d?(f="flex-end",p=u):("right"===d||"start"===d)&&(f="flex-start",m=u):"left"===d||"start"===d?(f="flex-start",p=u):("right"===d||"end"===d)&&(f="flex-end",m=u),t.position=this._cssPosition,t.marginLeft=c?"0":p,t.marginTop=l?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=c?"0":m,n.justifyContent=f,n.alignItems=l?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,n=this._overlayRef.hostElement,i=n.style;n.classList.remove(R4),i.justifyContent=i.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let G_e=(()=>{class e{constructor(n,i,r,o){this._viewportRuler=n,this._document=i,this._platform=r,this._overlayContainer=o}global(){return new H_e}flexibleConnectedTo(n){return new B_e(n,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static{this.\u0275fac=function(i){return new(i||e)(Z(g4),Z(Ut),Z(tr),Z(C4))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),W_e=0,sh=(()=>{class e{constructor(n,i,r,o,s,a,c,l,d,u,h,p){this.scrollStrategies=n,this._overlayContainer=i,this._componentFactoryResolver=r,this._positionBuilder=o,this._keyboardDispatcher=s,this._injector=a,this._ngZone=c,this._document=l,this._directionality=d,this._location=u,this._outsideClickDispatcher=h,this._animationsModuleType=p}create(n){const i=this._createHostElement(),r=this._createPaneElement(i),o=this._createPortalOutlet(r),s=new x_e(n);return s.direction=s.direction||this._directionality.value,new U_e(o,i,r,s,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(n){const i=this._document.createElement("div");return i.id="cdk-overlay-"+W_e++,i.classList.add("cdk-overlay-pane"),n.appendChild(i),i}_createHostElement(){const n=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(n),n}_createPortalOutlet(n){return this._appRef||(this._appRef=this._injector.get(sa)),new A_e(n,this._componentFactoryResolver,this._appRef,this._injector,this._document)}static{this.\u0275fac=function(i){return new(i||e)(Z(M_e),Z(C4),Z(Iu),Z(G_e),Z(L_e),Z(Bi),Z(Le),Z(Ut),Z(pR),Z(Zu),Z(F_e),Z(za,8))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const z_e=new re("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{const e=J(sh);return()=>e.scrollStrategies.reposition()}}),q_e={provide:z_e,deps:[sh],useFactory:function K_e(e){return()=>e.scrollStrategies.reposition()}};let Y_e=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({providers:[sh,q_e],imports:[Om,D_e,_4,_4]})}}return e})();const $_e=["tooltip"],D4=new re("mat-tooltip-scroll-strategy",{providedIn:"root",factory:()=>{const e=J(sh);return()=>e.scrollStrategies.reposition({scrollThrottle:20})}}),Z_e={provide:D4,deps:[sh],useFactory:function X_e(e){return()=>e.scrollStrategies.reposition({scrollThrottle:20})}},Q_e=new re("mat-tooltip-default-options",{providedIn:"root",factory:function J_e(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}}),O4="tooltip-panel",N4=nh({passive:!0});let rve=(()=>{class e{get position(){return this._position}set position(n){n!==this._position&&(this._position=n,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(n){this._positionAtOrigin=ih(n),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(n){this._disabled=ih(n),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(n){this._showDelay=Sj(n)}get hideDelay(){return this._hideDelay}set hideDelay(n){this._hideDelay=Sj(n),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(n){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=null!=n?String(n).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(n){this._tooltipClass=n,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}constructor(n,i,r,o,s,a,c,l,d,u,h,p){this._overlay=n,this._elementRef=i,this._scrollDispatcher=r,this._viewContainerRef=o,this._ngZone=s,this._platform=a,this._ariaDescriber=c,this._focusMonitor=l,this._dir=u,this._defaultOptions=h,this._position="below",this._positionAtOrigin=!1,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._tooltipComponent=ove,this._viewportMargin=8,this._cssClassPrefix="mat-mdc",this.touchGestures="auto",this._message="",this._passiveListeners=[],this._destroyed=new vt,this._scrollStrategy=d,this._document=p,h&&(this._showDelay=h.showDelay,this._hideDelay=h.hideDelay,h.position&&(this.position=h.position),h.positionAtOrigin&&(this.positionAtOrigin=h.positionAtOrigin),h.touchGestures&&(this.touchGestures=h.touchGestures)),u.change.pipe(gr(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)}),this._viewportMargin=8}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(gr(this._destroyed)).subscribe(n=>{n?"keyboard"===n&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const n=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([i,r])=>{n.removeEventListener(i,r,N4)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(n,this.message,"tooltip"),this._focusMonitor.stopMonitoring(n)}show(n=this.showDelay,i){if(this.disabled||!this.message||this._isTooltipVisible())return void this._tooltipInstance?._cancelPendingAnimations();const r=this._createOverlay(i);this._detach(),this._portal=this._portal||new v4(this._tooltipComponent,this._viewContainerRef);const o=this._tooltipInstance=r.attach(this._portal).instance;o._triggerElement=this._elementRef.nativeElement,o._mouseLeaveHideDelay=this._hideDelay,o.afterHidden().pipe(gr(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),o.show(n)}hide(n=this.hideDelay){const i=this._tooltipInstance;i&&(i.isVisible()?i.hide(n):(i._cancelPendingAnimations(),this._detach()))}toggle(n){this._isTooltipVisible()?this.hide():this.show(void 0,n)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(n){if(this._overlayRef){const o=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!n)&&o._origin instanceof sn)return this._overlayRef;this._detach()}const i=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),r=this._overlay.position().flexibleConnectedTo(this.positionAtOrigin&&n||this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(i);return r.positionChanges.pipe(gr(this._destroyed)).subscribe(o=>{this._updateCurrentPositionClass(o.connectionPair),this._tooltipInstance&&o.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:r,panelClass:`${this._cssClassPrefix}-${O4}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(gr(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(gr(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(gr(this._destroyed)).subscribe(o=>{this._isTooltipVisible()&&27===o.keyCode&&!function vj(e,...t){return t.length?t.some(n=>e[n]):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}(o)&&(o.preventDefault(),o.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(n){const i=n.getConfig().positionStrategy,r=this._getOrigin(),o=this._getOverlayPosition();i.withPositions([this._addOffset({...r.main,...o.main}),this._addOffset({...r.fallback,...o.fallback})])}_addOffset(n){const r=!this._dir||"ltr"==this._dir.value;return"top"===n.originY?n.offsetY=-8:"bottom"===n.originY?n.offsetY=8:"start"===n.originX?n.offsetX=r?-8:8:"end"===n.originX&&(n.offsetX=r?8:-8),n}_getOrigin(){const n=!this._dir||"ltr"==this._dir.value,i=this.position;let r;"above"==i||"below"==i?r={originX:"center",originY:"above"==i?"top":"bottom"}:"before"==i||"left"==i&&n||"right"==i&&!n?r={originX:"start",originY:"center"}:("after"==i||"right"==i&&n||"left"==i&&!n)&&(r={originX:"end",originY:"center"});const{x:o,y:s}=this._invertPosition(r.originX,r.originY);return{main:r,fallback:{originX:o,originY:s}}}_getOverlayPosition(){const n=!this._dir||"ltr"==this._dir.value,i=this.position;let r;"above"==i?r={overlayX:"center",overlayY:"bottom"}:"below"==i?r={overlayX:"center",overlayY:"top"}:"before"==i||"left"==i&&n||"right"==i&&!n?r={overlayX:"end",overlayY:"center"}:("after"==i||"right"==i&&n||"left"==i&&!n)&&(r={overlayX:"start",overlayY:"center"});const{x:o,y:s}=this._invertPosition(r.overlayX,r.overlayY);return{main:r,fallback:{overlayX:o,overlayY:s}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(Ti(1),gr(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(n){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=n,this._tooltipInstance._markForCheck())}_invertPosition(n,i){return"above"===this.position||"below"===this.position?"top"===i?i="bottom":"bottom"===i&&(i="top"):"end"===n?n="start":"start"===n&&(n="end"),{x:n,y:i}}_updateCurrentPositionClass(n){const{overlayY:i,originX:r,originY:o}=n;let s;if(s="center"===i?this._dir&&"rtl"===this._dir.value?"end"===r?"left":"right":"start"===r?"left":"right":"bottom"===i&&"top"===o?"above":"below",s!==this._currentPosition){const a=this._overlayRef;if(a){const c=`${this._cssClassPrefix}-${O4}-`;a.removePanelClass(c+this._currentPosition),a.addPanelClass(c+s)}this._currentPosition=s}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",n=>{let i;this._setupPointerExitEventsIfNeeded(),void 0!==n.x&&void 0!==n.y&&(i=n),this.show(void 0,i)}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",n=>{const i=n.targetTouches?.[0],r=i?{x:i.clientX,y:i.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(void 0,r),this._defaultOptions.touchLongPressShowDelay??500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const n=[];if(this._platformSupportsMouseEvents())n.push(["mouseleave",i=>{const r=i.relatedTarget;(!r||!this._overlayRef?.overlayElement.contains(r))&&this.hide()}],["wheel",i=>this._wheelListener(i)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const i=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};n.push(["touchend",i],["touchcancel",i])}this._addListeners(n),this._passiveListeners.push(...n)}_addListeners(n){n.forEach(([i,r])=>{this._elementRef.nativeElement.addEventListener(i,r,N4)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(n){if(this._isTooltipVisible()){const i=this._document.elementFromPoint(n.clientX,n.clientY),r=this._elementRef.nativeElement;i!==r&&!r.contains(i)&&this.hide()}}_disableNativeGesturesIfNecessary(){const n=this.touchGestures;if("off"!==n){const i=this._elementRef.nativeElement,r=i.style;("on"===n||"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName)&&(r.userSelect=r.msUserSelect=r.webkitUserSelect=r.MozUserSelect="none"),("on"===n||!i.draggable)&&(r.webkitUserDrag="none"),r.touchAction="none",r.webkitTapHighlightColor="transparent"}}static{this.\u0275fac=function(i){return new(i||e)(H(sh),H(sn),H(m4),H(Vo),H(Le),H(tr),H(cme),H(uR),H(D4),H(pR),H(Q_e,8),H(Ut))}}static{this.\u0275dir=ye({type:e,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],hostVars:2,hostBindings:function(i,r){2&i&&wt("mat-mdc-tooltip-disabled",r.disabled)},inputs:{position:[we.None,"matTooltipPosition","position"],positionAtOrigin:[we.None,"matTooltipPositionAtOrigin","positionAtOrigin"],disabled:[we.None,"matTooltipDisabled","disabled"],showDelay:[we.None,"matTooltipShowDelay","showDelay"],hideDelay:[we.None,"matTooltipHideDelay","hideDelay"],touchGestures:[we.None,"matTooltipTouchGestures","touchGestures"],message:[we.None,"matTooltip","message"],tooltipClass:[we.None,"matTooltipClass","tooltipClass"]},exportAs:["matTooltip"],standalone:!0})}}return e})(),ove=(()=>{class e{constructor(n,i,r){this._changeDetectorRef=n,this._elementRef=i,this._isMultiline=!1,this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new vt,this._showAnimation="mat-mdc-tooltip-show",this._hideAnimation="mat-mdc-tooltip-hide",this._animationsDisabled="NoopAnimations"===r}show(n){null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},n)}hide(n){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},n)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:n}){(!n||!this._triggerElement.contains(n))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){const n=this._elementRef.nativeElement.getBoundingClientRect();return n.height>24&&n.width>=200}_handleAnimationEnd({animationName:n}){(n===this._showAnimation||n===this._hideAnimation)&&this._finalizeAnimation(n===this._showAnimation)}_cancelPendingAnimations(){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(n){n?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(n){const i=this._tooltip.nativeElement,r=this._showAnimation,o=this._hideAnimation;if(i.classList.remove(n?o:r),i.classList.add(n?r:o),this._isVisible!==n&&(this._isVisible=n,this._changeDetectorRef.markForCheck()),n&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const s=getComputedStyle(i);("0s"===s.getPropertyValue("animation-duration")||"none"===s.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}n&&this._onShow(),this._animationsDisabled&&(i.classList.add("_mat-animation-noopable"),this._finalizeAnimation(n))}static{this.\u0275fac=function(i){return new(i||e)(H(Ts),H(sn),H(za,8))}}static{this.\u0275cmp=sr({type:e,selectors:[["mat-tooltip-component"]],viewQuery:function(i,r){if(1&i&&oa($_e,7),2&i){let o;ji(o=Hi())&&(r._tooltip=o.first)}},hostAttrs:["aria-hidden","true"],hostVars:2,hostBindings:function(i,r){1&i&&zt("mouseleave",function(s){return r._handleMouseLeave(s)}),2&i&&yw("zoom",r.isVisible()?1:null)},standalone:!0,features:[Lc],decls:4,vars:4,consts:[["tooltip",""],[1,"mdc-tooltip","mdc-tooltip--shown","mat-mdc-tooltip",3,"animationend","ngClass"],[1,"mdc-tooltip__surface","mdc-tooltip__surface-animation"]],template:function(i,r){if(1&i){const o=$a();ue(0,"div",1,0),zt("animationend",function(a){return Wr(o),zr(r._handleAnimationEnd(a))}),ue(2,"div",2),fr(3),ve()()}2&i&&(wt("mdc-tooltip--multiline",r._isMultiline),ht("ngClass",r.tooltipClass),Re(3),Yl(r.message))},dependencies:[gI],styles:['.mdc-tooltip__surface{word-break:break-all;word-break:var(--mdc-tooltip-word-break, normal);overflow-wrap:anywhere}.mdc-tooltip--showing-transition .mdc-tooltip__surface-animation{transition:opacity 150ms 0ms cubic-bezier(0, 0, 0.2, 1),transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-tooltip--hide-transition .mdc-tooltip__surface-animation{transition:opacity 75ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-tooltip{position:fixed;display:none;z-index:9}.mdc-tooltip-wrapper--rich{position:relative}.mdc-tooltip--shown,.mdc-tooltip--showing,.mdc-tooltip--hide{display:inline-flex}.mdc-tooltip--shown.mdc-tooltip--rich,.mdc-tooltip--showing.mdc-tooltip--rich,.mdc-tooltip--hide.mdc-tooltip--rich{display:inline-block;left:-320px;position:absolute}.mdc-tooltip__surface{line-height:16px;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center}.mdc-tooltip__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-tooltip__surface::before{border-color:CanvasText}}.mdc-tooltip--rich .mdc-tooltip__surface{align-items:flex-start;display:flex;flex-direction:column;min-height:24px;min-width:40px;max-width:320px;position:relative}.mdc-tooltip--multiline .mdc-tooltip__surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mdc-tooltip__surface,.mdc-tooltip--multiline .mdc-tooltip__surface[dir=rtl]{text-align:right}.mdc-tooltip__surface .mdc-tooltip__title{margin:0 8px}.mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(200px - 2*8px);margin:8px;text-align:left}[dir=rtl] .mdc-tooltip__surface .mdc-tooltip__content,.mdc-tooltip__surface .mdc-tooltip__content[dir=rtl]{text-align:right}.mdc-tooltip--rich .mdc-tooltip__surface .mdc-tooltip__content{max-width:calc(320px - 2*8px);align-self:stretch}.mdc-tooltip__surface .mdc-tooltip__content-link{text-decoration:none}.mdc-tooltip--rich-actions,.mdc-tooltip__content,.mdc-tooltip__title{z-index:1}.mdc-tooltip__surface-animation{opacity:0;transform:scale(0.8);will-change:transform,opacity}.mdc-tooltip--shown .mdc-tooltip__surface-animation{transform:scale(1);opacity:1}.mdc-tooltip--hide .mdc-tooltip__surface-animation{transform:scale(1)}.mdc-tooltip__caret-surface-top,.mdc-tooltip__caret-surface-bottom{position:absolute;height:24px;width:24px;transform:rotate(35deg) skewY(20deg) scaleX(0.9396926208)}.mdc-tooltip__caret-surface-top .mdc-elevation-overlay,.mdc-tooltip__caret-surface-bottom .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-tooltip__caret-surface-bottom{box-shadow:0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12);outline:1px solid rgba(0,0,0,0);z-index:-1}@media screen and (forced-colors: active){.mdc-tooltip__caret-surface-bottom{outline-color:CanvasText}}.mat-mdc-tooltip .mdc-tooltip__surface{background-color:var(--mdc-plain-tooltip-container-color)}.mat-mdc-tooltip .mdc-tooltip__surface{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__caret-surface-top,.mat-mdc-tooltip .mdc-tooltip__caret-surface-bottom{border-radius:var(--mdc-plain-tooltip-container-shape)}.mat-mdc-tooltip .mdc-tooltip__surface{color:var(--mdc-plain-tooltip-supporting-text-color)}.mat-mdc-tooltip .mdc-tooltip__surface{font-family:var(--mdc-plain-tooltip-supporting-text-font);line-height:var(--mdc-plain-tooltip-supporting-text-line-height);font-size:var(--mdc-plain-tooltip-supporting-text-size);font-weight:var(--mdc-plain-tooltip-supporting-text-weight);letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking)}.mat-mdc-tooltip{position:relative;transform:scale(0)}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-panel.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}'],encapsulation:2,changeDetection:0})}}return e})(),sve=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({providers:[Z_e],imports:[yme,FE,Y_e,Wo,Wo,TR]})}}return e})();function P4(e){return new W(3e3,!1)}function Wc(e){switch(e.length){case 0:return new xm;case 1:return e[0];default:return new Jj(e)}}function M4(e,t,n=new Map,i=new Map){const r=[],o=[];let s=-1,a=null;if(t.forEach(c=>{const l=c.get("offset"),d=l==s,u=d&&a||new Map;c.forEach((h,p)=>{let m=p,f=h;if("offset"!==p)switch(m=e.normalizePropertyName(m,r),f){case"!":f=n.get(p);break;case nc:f=i.get(p);break;default:f=e.normalizeStyleValue(p,m,f,r)}u.set(m,f)}),d||o.push(u),a=u,s=l}),r.length)throw function Dve(e){return new W(3502,!1)}();return o}function RR(e,t,n,i){switch(t){case"start":e.onStart(()=>i(n&&AR(n,"start",e)));break;case"done":e.onDone(()=>i(n&&AR(n,"done",e)));break;case"destroy":e.onDestroy(()=>i(n&&AR(n,"destroy",e)))}}function AR(e,t,n){const o=DR(e.element,e.triggerName,e.fromState,e.toState,t||e.phaseName,n.totalTime??e.totalTime,!!n.disabled),s=e._data;return null!=s&&(o._data=s),o}function DR(e,t,n,i,r="",o=0,s){return{element:e,triggerName:t,fromState:n,toState:i,phaseName:r,totalTime:o,disabled:!!s}}function vo(e,t,n){let i=e.get(t);return i||e.set(t,i=n),i}function x4(e){const t=e.indexOf(":");return[e.substring(1,t),e.slice(t+1)]}const jve=typeof document>"u"?null:document.documentElement;function OR(e){const t=e.parentNode||e.host||null;return t===jve?null:t}let rd=null,k4=!1;function L4(e,t){for(;t;){if(t===e)return!0;t=OR(t)}return!1}function F4(e,t,n){if(n)return Array.from(e.querySelectorAll(t));const i=e.querySelector(t);return i?[i]:[]}let NR=(()=>{class e{validateStyleProperty(n){return function Gve(e){rd||(rd=function Wve(){return typeof document<"u"?document.body:null}()||{},k4=!!rd.style&&"WebkitAppearance"in rd.style);let t=!0;return rd.style&&!function Hve(e){return"ebkit"==e.substring(1,6)}(e)&&(t=e in rd.style,!t&&k4&&(t="Webkit"+e.charAt(0).toUpperCase()+e.slice(1)in rd.style)),t}(n)}matchesElement(n,i){return!1}containsElement(n,i){return L4(n,i)}getParentElement(n){return OR(n)}query(n,i,r){return F4(n,i,r)}computeStyle(n,i,r){return r||""}animate(n,i,r,o,s,a=[],c){return new xm(r,o)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac})}}return e})();class PR{static{this.NOOP=new NR}}class MR{}const Kve=1e3,xR="ng-enter",fb="ng-leave",mb="ng-trigger",gb=".ng-trigger",V4="ng-animating",kR=".ng-animating";function ic(e){if("number"==typeof e)return e;const t=e.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:LR(parseFloat(t[1]),t[2])}function LR(e,t){return"s"===t?e*Kve:e}function _b(e,t,n){return e.hasOwnProperty("duration")?e:function Yve(e,t,n){let r,o=0,s="";if("string"==typeof e){const a=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===a)return t.push(P4()),{duration:0,delay:0,easing:""};r=LR(parseFloat(a[1]),a[2]);const c=a[3];null!=c&&(o=LR(parseFloat(c),a[4]));const l=a[5];l&&(s=l)}else r=e;if(!n){let a=!1,c=t.length;r<0&&(t.push(function ave(){return new W(3100,!1)}()),a=!0),o<0&&(t.push(function cve(){return new W(3101,!1)}()),a=!0),a&&t.splice(c,0,P4())}return{duration:r,delay:o,easing:s}}(e,t,n)}function la(e,t,n){t.forEach((i,r)=>{const o=UR(r);n&&!n.has(r)&&n.set(r,e.style[o]),e.style[o]=i})}function od(e,t){t.forEach((n,i)=>{const r=UR(i);e.style[r]=""})}function Lm(e){return Array.isArray(e)?1==e.length?e[0]:function oge(e,t=null){return{type:Ge.Sequence,steps:e,options:t}}(e):e}const FR=new RegExp("{{\\s*(.+?)\\s*}}","g");function j4(e){let t=[];if("string"==typeof e){let n;for(;n=FR.exec(e);)t.push(n[1]);FR.lastIndex=0}return t}function Fm(e,t,n){const i=`${e}`,r=i.replace(FR,(o,s)=>{let a=t[s];return null==a&&(n.push(function dve(e){return new W(3003,!1)}()),a=""),a.toString()});return r==i?e:r}const Zve=/-+([a-z0-9])/g;function UR(e){return e.replace(Zve,(...t)=>t[1].toUpperCase())}function Eo(e,t,n){switch(t.type){case Ge.Trigger:return e.visitTrigger(t,n);case Ge.State:return e.visitState(t,n);case Ge.Transition:return e.visitTransition(t,n);case Ge.Sequence:return e.visitSequence(t,n);case Ge.Group:return e.visitGroup(t,n);case Ge.Animate:return e.visitAnimate(t,n);case Ge.Keyframes:return e.visitKeyframes(t,n);case Ge.Style:return e.visitStyle(t,n);case Ge.Reference:return e.visitReference(t,n);case Ge.AnimateChild:return e.visitAnimateChild(t,n);case Ge.AnimateRef:return e.visitAnimateRef(t,n);case Ge.Query:return e.visitQuery(t,n);case Ge.Stagger:return e.visitStagger(t,n);default:throw function uve(e){return new W(3004,!1)}()}}function VR(e,t){return window.getComputedStyle(e)[t]}const eEe=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class H4 extends MR{normalizePropertyName(t,n){return UR(t)}normalizeStyleValue(t,n,i,r){let o="";const s=i.toString().trim();if(eEe.has(n)&&0!==i&&"0"!==i)if("number"==typeof i)o="px";else{const a=i.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&0==a[1].length&&r.push(function hve(e,t){return new W(3005,!1)}())}return s+o}}const vb="*";const Eb=new Set(["true","1"]),bb=new Set(["false","0"]);function G4(e,t){const n=Eb.has(e)||bb.has(e),i=Eb.has(t)||bb.has(t);return(r,o)=>{let s=e==vb||e==r,a=t==vb||t==o;return!s&&n&&"boolean"==typeof r&&(s=r?Eb.has(e):bb.has(e)),!a&&i&&"boolean"==typeof o&&(a=o?Eb.has(t):bb.has(t)),s&&a}}const rEe=new RegExp("s*:selfs*,?","g");function BR(e,t,n,i){return new oEe(e).build(t,n,i)}class oEe{constructor(t){this._driver=t}build(t,n,i){const r=new cEe(n);return this._resetContextStyleTimingState(r),Eo(this,Lm(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,n){let i=n.queryCount=0,r=n.depCount=0;const o=[],s=[];return"@"==t.name.charAt(0)&&n.errors.push(function pve(){return new W(3006,!1)}()),t.definitions.forEach(a=>{if(this._resetContextStyleTimingState(n),a.type==Ge.State){const c=a,l=c.name;l.toString().split(/\s*,\s*/).forEach(d=>{c.name=d,o.push(this.visitState(c,n))}),c.name=l}else if(a.type==Ge.Transition){const c=this.visitTransition(a,n);i+=c.queryCount,r+=c.depCount,s.push(c)}else n.errors.push(function fve(){return new W(3007,!1)}())}),{type:Ge.Trigger,name:t.name,states:o,transitions:s,queryCount:i,depCount:r,options:null}}visitState(t,n){const i=this.visitStyle(t.styles,n),r=t.options&&t.options.params||null;if(i.containsDynamicStyles){const o=new Set,s=r||{};i.styles.forEach(a=>{a instanceof Map&&a.forEach(c=>{j4(c).forEach(l=>{s.hasOwnProperty(l)||o.add(l)})})}),o.size&&n.errors.push(function mve(e,t){return new W(3008,!1)}(0,o.values()))}return{type:Ge.State,name:t.name,style:i,options:r?{params:r}:null}}visitTransition(t,n){n.queryCount=0,n.depCount=0;const i=Eo(this,Lm(t.animation),n),r=function tEe(e,t){const n=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(i=>function nEe(e,t,n){if(":"==e[0]){const c=function iEe(e,t){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(n,i)=>parseFloat(i)>parseFloat(n);case":decrement":return(n,i)=>parseFloat(i)<parseFloat(n);default:return t.push(function wve(e){return new W(3016,!1)}()),"* => *"}}(e,n);if("function"==typeof c)return void t.push(c);e=c}const i=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return n.push(function Tve(e){return new W(3015,!1)}()),t;const r=i[1],o=i[2],s=i[3];t.push(G4(r,s)),"<"==o[0]&&(r!=vb||s!=vb)&&t.push(G4(s,r))}(i,n,t)):n.push(e),n}(t.expr,n.errors);return{type:Ge.Transition,matchers:r,animation:i,queryCount:n.queryCount,depCount:n.depCount,options:sd(t.options)}}visitSequence(t,n){return{type:Ge.Sequence,steps:t.steps.map(i=>Eo(this,i,n)),options:sd(t.options)}}visitGroup(t,n){const i=n.currentTime;let r=0;const o=t.steps.map(s=>{n.currentTime=i;const a=Eo(this,s,n);return r=Math.max(r,n.currentTime),a});return n.currentTime=r,{type:Ge.Group,steps:o,options:sd(t.options)}}visitAnimate(t,n){const i=function dEe(e,t){if(e.hasOwnProperty("duration"))return e;if("number"==typeof e)return jR(_b(e,t).duration,0,"");const n=e;if(n.split(/\s+/).some(o=>"{"==o.charAt(0)&&"{"==o.charAt(1))){const o=jR(0,0,"");return o.dynamic=!0,o.strValue=n,o}const r=_b(n,t);return jR(r.duration,r.delay,r.easing)}(t.timings,n.errors);n.currentAnimateTimings=i;let r,o=t.styles?t.styles:ca({});if(o.type==Ge.Keyframes)r=this.visitKeyframes(o,n);else{let s=t.styles,a=!1;if(!s){a=!0;const l={};i.easing&&(l.easing=i.easing),s=ca(l)}n.currentTime+=i.duration+i.delay;const c=this.visitStyle(s,n);c.isEmptyStep=a,r=c}return n.currentAnimateTimings=null,{type:Ge.Animate,timings:i,style:r,options:null}}visitStyle(t,n){const i=this._makeStyleAst(t,n);return this._validateStyleAst(i,n),i}_makeStyleAst(t,n){const i=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let a of r)"string"==typeof a?a===nc?i.push(a):n.errors.push(new W(3002,!1)):i.push(new Map(Object.entries(a)));let o=!1,s=null;return i.forEach(a=>{if(a instanceof Map&&(a.has("easing")&&(s=a.get("easing"),a.delete("easing")),!o))for(let c of a.values())if(c.toString().indexOf("{{")>=0){o=!0;break}}),{type:Ge.Style,styles:i,easing:s,offset:t.offset,containsDynamicStyles:o,options:null}}_validateStyleAst(t,n){const i=n.currentAnimateTimings;let r=n.currentTime,o=n.currentTime;i&&o>0&&(o-=i.duration+i.delay),t.styles.forEach(s=>{"string"!=typeof s&&s.forEach((a,c)=>{const l=n.collectedStyles.get(n.currentQuerySelector),d=l.get(c);let u=!0;d&&(o!=r&&o>=d.startTime&&r<=d.endTime&&(n.errors.push(function _ve(e,t,n,i,r){return new W(3010,!1)}()),u=!1),o=d.startTime),u&&l.set(c,{startTime:o,endTime:r}),n.options&&function Xve(e,t,n){const i=t.params||{},r=j4(e);r.length&&r.forEach(o=>{i.hasOwnProperty(o)||n.push(function lve(e){return new W(3001,!1)}())})}(a,n.options,n.errors)})})}visitKeyframes(t,n){const i={type:Ge.Keyframes,styles:[],options:null};if(!n.currentAnimateTimings)return n.errors.push(function vve(){return new W(3011,!1)}()),i;let o=0;const s=[];let a=!1,c=!1,l=0;const d=t.steps.map(E=>{const b=this._makeStyleAst(E,n);let T=null!=b.offset?b.offset:function lEe(e){if("string"==typeof e)return null;let t=null;if(Array.isArray(e))e.forEach(n=>{if(n instanceof Map&&n.has("offset")){const i=n;t=parseFloat(i.get("offset")),i.delete("offset")}});else if(e instanceof Map&&e.has("offset")){const n=e;t=parseFloat(n.get("offset")),n.delete("offset")}return t}(b.styles),I=0;return null!=T&&(o++,I=b.offset=T),c=c||I<0||I>1,a=a||I<l,l=I,s.push(I),b});c&&n.errors.push(function Eve(){return new W(3012,!1)}()),a&&n.errors.push(function bve(){return new W(3200,!1)}());const u=t.steps.length;let h=0;o>0&&o<u?n.errors.push(function yve(){return new W(3202,!1)}()):0==o&&(h=1/(u-1));const p=u-1,m=n.currentTime,f=n.currentAnimateTimings,g=f.duration;return d.forEach((E,b)=>{const T=h>0?b==p?1:h*b:s[b],I=T*g;n.currentTime=m+f.delay+I,f.duration=I,this._validateStyleAst(E,n),E.offset=T,i.styles.push(E)}),i}visitReference(t,n){return{type:Ge.Reference,animation:Eo(this,Lm(t.animation),n),options:sd(t.options)}}visitAnimateChild(t,n){return n.depCount++,{type:Ge.AnimateChild,options:sd(t.options)}}visitAnimateRef(t,n){return{type:Ge.AnimateRef,animation:this.visitReference(t.animation,n),options:sd(t.options)}}visitQuery(t,n){const i=n.currentQuerySelector,r=t.options||{};n.queryCount++,n.currentQuery=t;const[o,s]=function sEe(e){const t=!!e.split(/\s*,\s*/).find(n=>":self"==n);return t&&(e=e.replace(rEe,"")),e=e.replace(/@\*/g,gb).replace(/@\w+/g,n=>gb+"-"+n.slice(1)).replace(/:animating/g,kR),[e,t]}(t.selector);n.currentQuerySelector=i.length?i+" "+o:o,vo(n.collectedStyles,n.currentQuerySelector,new Map);const a=Eo(this,Lm(t.animation),n);return n.currentQuery=null,n.currentQuerySelector=i,{type:Ge.Query,selector:o,limit:r.limit||0,optional:!!r.optional,includeSelf:s,animation:a,originalSelector:t.selector,options:sd(t.options)}}visitStagger(t,n){n.currentQuery||n.errors.push(function Sve(){return new W(3013,!1)}());const i="full"===t.timings?{duration:0,delay:0,easing:"full"}:_b(t.timings,n.errors,!0);return{type:Ge.Stagger,animation:Eo(this,Lm(t.animation),n),timings:i,options:null}}}class cEe{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function sd(e){return e?(e={...e}).params&&(e.params=function aEe(e){return e?{...e}:null}(e.params)):e={},e}function jR(e,t,n){return{duration:e,delay:t,easing:n}}function HR(e,t,n,i,r,o,s=null,a=!1){return{type:1,element:e,keyframes:t,preStyleProps:n,postStyleProps:i,duration:r,delay:o,totalTime:r+o,easing:s,subTimeline:a}}class yb{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,n){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...n)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const pEe=new RegExp(":enter","g"),mEe=new RegExp(":leave","g");function GR(e,t,n,i,r,o=new Map,s=new Map,a,c,l=[]){return(new gEe).buildKeyframes(e,t,n,i,r,o,s,a,c,l)}class gEe{buildKeyframes(t,n,i,r,o,s,a,c,l,d=[]){l=l||new yb;const u=new WR(t,n,l,r,o,d,[]);u.options=c;const h=c.delay?ic(c.delay):0;u.currentTimeline.delayNextStep(h),u.currentTimeline.setStyles([s],null,u.errors,c),Eo(this,i,u);const p=u.timelines.filter(m=>m.containsAnimation());if(p.length&&a.size){let m;for(let f=p.length-1;f>=0;f--){const g=p[f];if(g.element===n){m=g;break}}m&&!m.allowOnlyTimelineStyles()&&m.setStyles([a],null,u.errors,c)}return p.length?p.map(m=>m.buildKeyframes()):[HR(n,[],[],[],0,h,"",!1)]}visitTrigger(t,n){}visitState(t,n){}visitTransition(t,n){}visitAnimateChild(t,n){const i=n.subInstructions.get(n.element);if(i){const r=n.createSubContext(t.options),o=n.currentTimeline.currentTime,s=this._visitSubInstructions(i,r,r.options);o!=s&&n.transformIntoNewTimeline(s)}n.previousNode=t}visitAnimateRef(t,n){const i=n.createSubContext(t.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],n,i),this.visitReference(t.animation,i),n.transformIntoNewTimeline(i.currentTimeline.currentTime),n.previousNode=t}_applyAnimationRefDelays(t,n,i){for(const r of t){const o=r?.delay;if(o){const s="number"==typeof o?o:ic(Fm(o,r?.params??{},n.errors));i.delayNextStep(s)}}}_visitSubInstructions(t,n,i){let o=n.currentTimeline.currentTime;const s=null!=i.duration?ic(i.duration):null,a=null!=i.delay?ic(i.delay):null;return 0!==s&&t.forEach(c=>{const l=n.appendInstructionToTimeline(c,s,a);o=Math.max(o,l.duration+l.delay)}),o}visitReference(t,n){n.updateOptions(t.options,!0),Eo(this,t.animation,n),n.previousNode=t}visitSequence(t,n){const i=n.subContextCount;let r=n;const o=t.options;if(o&&(o.params||o.delay)&&(r=n.createSubContext(o),r.transformIntoNewTimeline(),null!=o.delay)){r.previousNode.type==Ge.Style&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=Sb);const s=ic(o.delay);r.delayNextStep(s)}t.steps.length&&(t.steps.forEach(s=>Eo(this,s,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),n.previousNode=t}visitGroup(t,n){const i=[];let r=n.currentTimeline.currentTime;const o=t.options&&t.options.delay?ic(t.options.delay):0;t.steps.forEach(s=>{const a=n.createSubContext(t.options);o&&a.delayNextStep(o),Eo(this,s,a),r=Math.max(r,a.currentTimeline.currentTime),i.push(a.currentTimeline)}),i.forEach(s=>n.currentTimeline.mergeTimelineCollectedStyles(s)),n.transformIntoNewTimeline(r),n.previousNode=t}_visitTiming(t,n){if(t.dynamic){const i=t.strValue;return _b(n.params?Fm(i,n.params,n.errors):i,n.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,n){const i=n.currentAnimateTimings=this._visitTiming(t.timings,n),r=n.currentTimeline;i.delay&&(n.incrementTime(i.delay),r.snapshotCurrentStyles());const o=t.style;o.type==Ge.Keyframes?this.visitKeyframes(o,n):(n.incrementTime(i.duration),this.visitStyle(o,n),r.applyStylesToKeyframe()),n.currentAnimateTimings=null,n.previousNode=t}visitStyle(t,n){const i=n.currentTimeline,r=n.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const o=r&&r.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(o):i.setStyles(t.styles,o,n.errors,n.options),n.previousNode=t}visitKeyframes(t,n){const i=n.currentAnimateTimings,r=n.currentTimeline.duration,o=i.duration,a=n.createSubContext().currentTimeline;a.easing=i.easing,t.styles.forEach(c=>{a.forwardTime((c.offset||0)*o),a.setStyles(c.styles,c.easing,n.errors,n.options),a.applyStylesToKeyframe()}),n.currentTimeline.mergeTimelineCollectedStyles(a),n.transformIntoNewTimeline(r+o),n.previousNode=t}visitQuery(t,n){const i=n.currentTimeline.currentTime,r=t.options||{},o=r.delay?ic(r.delay):0;o&&(n.previousNode.type===Ge.Style||0==i&&n.currentTimeline.hasCurrentStyleProperties())&&(n.currentTimeline.snapshotCurrentStyles(),n.previousNode=Sb);let s=i;const a=n.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,n.errors);n.currentQueryTotal=a.length;let c=null;a.forEach((l,d)=>{n.currentQueryIndex=d;const u=n.createSubContext(t.options,l);o&&u.delayNextStep(o),l===n.element&&(c=u.currentTimeline),Eo(this,t.animation,u),u.currentTimeline.applyStylesToKeyframe(),s=Math.max(s,u.currentTimeline.currentTime)}),n.currentQueryIndex=0,n.currentQueryTotal=0,n.transformIntoNewTimeline(s),c&&(n.currentTimeline.mergeTimelineCollectedStyles(c),n.currentTimeline.snapshotCurrentStyles()),n.previousNode=t}visitStagger(t,n){const i=n.parentContext,r=n.currentTimeline,o=t.timings,s=Math.abs(o.duration),a=s*(n.currentQueryTotal-1);let c=s*n.currentQueryIndex;switch(o.duration<0?"reverse":o.easing){case"reverse":c=a-c;break;case"full":c=i.currentStaggerTime}const d=n.currentTimeline;c&&d.delayNextStep(c);const u=d.currentTime;Eo(this,t.animation,n),n.previousNode=t,i.currentStaggerTime=r.currentTime-u+(r.startTime-i.currentTimeline.startTime)}}const Sb={};class WR{constructor(t,n,i,r,o,s,a,c){this._driver=t,this.element=n,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=o,this.errors=s,this.timelines=a,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Sb,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=c||new Cb(this._driver,n,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,n){if(!t)return;const i=t;let r=this.options;null!=i.duration&&(r.duration=ic(i.duration)),null!=i.delay&&(r.delay=ic(i.delay));const o=i.params;if(o){let s=r.params;s||(s=this.options.params={}),Object.keys(o).forEach(a=>{(!n||!s.hasOwnProperty(a))&&(s[a]=Fm(o[a],s,this.errors))})}}_copyOptions(){const t={};if(this.options){const n=this.options.params;if(n){const i=t.params={};Object.keys(n).forEach(r=>{i[r]=n[r]})}}return t}createSubContext(t=null,n,i){const r=n||this.element,o=new WR(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return o.previousNode=this.previousNode,o.currentAnimateTimings=this.currentAnimateTimings,o.options=this._copyOptions(),o.updateOptions(t),o.currentQueryIndex=this.currentQueryIndex,o.currentQueryTotal=this.currentQueryTotal,o.parentContext=this,this.subContextCount++,o}transformIntoNewTimeline(t){return this.previousNode=Sb,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,n,i){const r={duration:n??t.duration,delay:this.currentTimeline.currentTime+(i??0)+t.delay,easing:""},o=new _Ee(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(o),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,n,i,r,o,s){let a=[];if(r&&a.push(this.element),t.length>0){t=(t=t.replace(pEe,"."+this._enterClassName)).replace(mEe,"."+this._leaveClassName);let l=this._driver.query(this.element,t,1!=i);0!==i&&(l=i<0?l.slice(l.length+i,l.length):l.slice(0,i)),a.push(...l)}return!o&&0==a.length&&s.push(function Cve(e){return new W(3014,!1)}()),a}}class Cb{constructor(t,n,i,r){this._driver=t,this.element=n,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(n),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(n,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const n=1===this._keyframes.size&&this._pendingStyles.size;this.duration||n?(this.forwardTime(this.currentTime+t),n&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,n){return this.applyStylesToKeyframe(),new Cb(this._driver,t,n||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,n){this._localTimelineStyles.set(t,n),this._globalTimelineStyles.set(t,n),this._styleSummary.set(t,{time:this.currentTime,value:n})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[n,i]of this._globalTimelineStyles)this._backFill.set(n,i||nc),this._currentKeyframe.set(n,nc);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,n,i,r){n&&this._previousKeyframe.set("easing",n);const o=r&&r.params||{},s=function vEe(e,t){const n=new Map;let i;return e.forEach(r=>{if("*"===r){i??=t.keys();for(let o of i)n.set(o,nc)}else for(let[o,s]of r)n.set(o,s)}),n}(t,this._globalTimelineStyles);for(let[a,c]of s){const l=Fm(c,o,i);this._pendingStyles.set(a,l),this._localTimelineStyles.has(a)||this._backFill.set(a,this._globalTimelineStyles.get(a)??nc),this._updateStyle(a,l)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,n)=>{this._currentKeyframe.set(n,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,n)=>{this._currentKeyframe.has(n)||this._currentKeyframe.set(n,t)}))}snapshotCurrentStyles(){for(let[t,n]of this._localTimelineStyles)this._pendingStyles.set(t,n),this._updateStyle(t,n)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let n in this._currentKeyframe)t.push(n);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((n,i)=>{const r=this._styleSummary.get(i);(!r||n.time>r.time)&&this._updateStyle(i,n.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,n=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((a,c)=>{const l=new Map([...this._backFill,...a]);l.forEach((d,u)=>{"!"===d?t.add(u):d===nc&&n.add(u)}),i||l.set("offset",c/this.duration),r.push(l)});const o=[...t.values()],s=[...n.values()];if(i){const a=r[0],c=new Map(a);a.set("offset",0),c.set("offset",1),r=[a,c]}return HR(this.element,r,o,s,this.duration,this.startTime,this.easing,!1)}}class _Ee extends Cb{constructor(t,n,i,r,o,s,a=!1){super(t,n,s.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=o,this._stretchStartingKeyframe=a,this.timings={duration:s.duration,delay:s.delay,easing:s.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:n,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&n){const o=[],s=i+n,a=n/s,c=new Map(t[0]);c.set("offset",0),o.push(c);const l=new Map(t[0]);l.set("offset",K4(a)),o.push(l);const d=t.length-1;for(let u=1;u<=d;u++){let h=new Map(t[u]);const p=h.get("offset");h.set("offset",K4((n+p*i)/s)),o.push(h)}i=s,n=0,r="",t=o}return HR(this.element,t,this.preStyleProps,this.postStyleProps,i,n,r,!0)}}function K4(e,t=3){const n=Math.pow(10,t-1);return Math.round(e*n)/n}function q4(e,t,n,i,r,o,s,a,c,l,d,u,h){return{type:0,element:e,triggerName:t,isRemovalTransition:r,fromState:n,fromStyles:o,toState:i,toStyles:s,timelines:a,queriedElements:c,preStyleProps:l,postStyleProps:d,totalTime:u,errors:h}}const zR={};class Y4{constructor(t,n,i){this._triggerName=t,this.ast=n,this._stateStyles=i}match(t,n,i,r){return function EEe(e,t,n,i,r){return e.some(o=>o(t,n,i,r))}(this.ast.matchers,t,n,i,r)}buildStyles(t,n,i){let r=this._stateStyles.get("*");return void 0!==t&&(r=this._stateStyles.get(t?.toString())||r),r?r.buildStyles(n,i):new Map}build(t,n,i,r,o,s,a,c,l,d){const u=[],h=this.ast.options&&this.ast.options.params||zR,m=this.buildStyles(i,a&&a.params||zR,u),f=c&&c.params||zR,g=this.buildStyles(r,f,u),E=new Set,b=new Map,T=new Map,I="void"===r,D={params:$4(f,h),delay:this.ast.options?.delay},O=d?[]:GR(t,n,this.ast.animation,o,s,m,g,D,l,u);let k=0;return O.forEach(L=>{k=Math.max(L.duration+L.delay,k)}),u.length?q4(n,this._triggerName,i,r,I,m,g,[],[],b,T,k,u):(O.forEach(L=>{const V=L.element,ee=vo(b,V,new Set);L.preStyleProps.forEach(Ie=>ee.add(Ie));const oe=vo(T,V,new Set);L.postStyleProps.forEach(Ie=>oe.add(Ie)),V!==n&&E.add(V)}),q4(n,this._triggerName,i,r,I,m,g,O,[...E.values()],b,T,k))}}function $4(e,t){const n={...t};return Object.entries(e).forEach(([i,r])=>{null!=r&&(n[i]=r)}),n}class bEe{constructor(t,n,i){this.styles=t,this.defaultParams=n,this.normalizer=i}buildStyles(t,n){const i=new Map,r=$4(t,this.defaultParams);return this.styles.styles.forEach(o=>{"string"!=typeof o&&o.forEach((s,a)=>{s&&(s=Fm(s,r,n));const c=this.normalizer.normalizePropertyName(a,n);s=this.normalizer.normalizeStyleValue(a,c,s,n),i.set(a,s)})}),i}}class SEe{constructor(t,n,i){this.name=t,this.ast=n,this._normalizer=i,this.transitionFactories=[],this.states=new Map,n.states.forEach(r=>{this.states.set(r.name,new bEe(r.style,r.options&&r.options.params||{},i))}),X4(this.states,"true","1"),X4(this.states,"false","0"),n.transitions.forEach(r=>{this.transitionFactories.push(new Y4(t,r,this.states))}),this.fallbackTransition=function CEe(e,t,n){return new Y4(e,{type:Ge.Transition,animation:{type:Ge.Sequence,steps:[],options:null},matchers:[(s,a)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,n,i,r){return this.transitionFactories.find(s=>s.match(t,n,i,r))||null}matchStyles(t,n,i){return this.fallbackTransition.buildStyles(t,n,i)}}function X4(e,t,n){e.has(t)?e.has(n)||e.set(n,e.get(t)):e.has(n)&&e.set(t,e.get(n))}const TEe=new yb;class wEe{constructor(t,n,i){this.bodyNode=t,this._driver=n,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,n){const i=[],o=BR(this._driver,n,i,[]);if(i.length)throw function Ove(e){return new W(3503,!1)}();this._animations.set(t,o)}_buildPlayer(t,n,i){const r=t.element,o=M4(this._normalizer,t.keyframes,n,i);return this._driver.animate(r,o,t.duration,t.delay,t.easing,[],!0)}create(t,n,i={}){const r=[],o=this._animations.get(t);let s;const a=new Map;if(o?(s=GR(this._driver,n,o,xR,fb,new Map,new Map,i,TEe,r),s.forEach(d=>{const u=vo(a,d.element,new Map);d.postStyleProps.forEach(h=>u.set(h,null))})):(r.push(function Nve(){return new W(3300,!1)}()),s=[]),r.length)throw function Pve(e){return new W(3504,!1)}();a.forEach((d,u)=>{d.forEach((h,p)=>{d.set(p,this._driver.computeStyle(u,p,nc))})});const l=Wc(s.map(d=>{const u=a.get(d.element);return this._buildPlayer(d,new Map,u)}));return this._playersById.set(t,l),l.onDestroy(()=>this.destroy(t)),this.players.push(l),l}destroy(t){const n=this._getPlayer(t);n.destroy(),this._playersById.delete(t);const i=this.players.indexOf(n);i>=0&&this.players.splice(i,1)}_getPlayer(t){const n=this._playersById.get(t);if(!n)throw function Mve(e){return new W(3301,!1)}();return n}listen(t,n,i,r){const o=DR(n,"","","");return RR(this._getPlayer(t),i,o,r),()=>{}}command(t,n,i,r){if("register"==i)return void this.register(t,r[0]);if("create"==i)return void this.create(t,n,r[0]||{});const o=this._getPlayer(t);switch(i){case"play":o.play();break;case"pause":o.pause();break;case"reset":o.reset();break;case"restart":o.restart();break;case"finish":o.finish();break;case"init":o.init();break;case"setPosition":o.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t)}}}const Z4="ng-animate-queued",KR="ng-animate-disabled",OEe=[],J4={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},NEe={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},As="__ng_removed";class qR{get params(){return this.options.params}constructor(t,n=""){this.namespaceId=n;const i=t&&t.hasOwnProperty("value");if(this.value=function kEe(e){return e??null}(i?t.value:t),i){const{value:o,...s}=t;this.options=s}else this.options={};this.options.params||(this.options.params={})}absorbOptions(t){const n=t.params;if(n){const i=this.options.params;Object.keys(n).forEach(r=>{null==i[r]&&(i[r]=n[r])})}}}const Um="void",YR=new qR(Um);class PEe{constructor(t,n,i){this.id=t,this.hostElement=n,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,Ko(n,this._hostClassName)}listen(t,n,i,r){if(!this._triggers.has(n))throw function xve(e,t){return new W(3302,!1)}();if(null==i||0==i.length)throw function kve(e){return new W(3303,!1)}();if(!function LEe(e){return"start"==e||"done"==e}(i))throw function Lve(e,t){return new W(3400,!1)}();const o=vo(this._elementListeners,t,[]),s={name:n,phase:i,callback:r};o.push(s);const a=vo(this._engine.statesByElement,t,new Map);return a.has(n)||(Ko(t,mb),Ko(t,mb+"-"+n),a.set(n,YR)),()=>{this._engine.afterFlush(()=>{const c=o.indexOf(s);c>=0&&o.splice(c,1),this._triggers.has(n)||a.delete(n)})}}register(t,n){return!this._triggers.has(t)&&(this._triggers.set(t,n),!0)}_getTrigger(t){const n=this._triggers.get(t);if(!n)throw function Fve(e){return new W(3401,!1)}();return n}trigger(t,n,i,r=!0){const o=this._getTrigger(n),s=new $R(this.id,n,t);let a=this._engine.statesByElement.get(t);a||(Ko(t,mb),Ko(t,mb+"-"+n),this._engine.statesByElement.set(t,a=new Map));let c=a.get(n);const l=new qR(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&c&&l.absorbOptions(c.options),a.set(n,l),c||(c=YR),l.value!==Um&&c.value===l.value){if(!function VEe(e,t){const n=Object.keys(e),i=Object.keys(t);if(n.length!=i.length)return!1;for(let r=0;r<n.length;r++){const o=n[r];if(!t.hasOwnProperty(o)||e[o]!==t[o])return!1}return!0}(c.params,l.params)){const f=[],g=o.matchStyles(c.value,c.params,f),E=o.matchStyles(l.value,l.params,f);f.length?this._engine.reportError(f):this._engine.afterFlush(()=>{od(t,g),la(t,E)})}return}const h=vo(this._engine.playersByElement,t,[]);h.forEach(f=>{f.namespaceId==this.id&&f.triggerName==n&&f.queued&&f.destroy()});let p=o.matchTransition(c.value,l.value,t,l.params),m=!1;if(!p){if(!r)return;p=o.fallbackTransition,m=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:n,transition:p,fromState:c,toState:l,player:s,isFallbackTransition:m}),m||(Ko(t,Z4),s.onStart(()=>{ah(t,Z4)})),s.onDone(()=>{let f=this.players.indexOf(s);f>=0&&this.players.splice(f,1);const g=this._engine.playersByElement.get(t);if(g){let E=g.indexOf(s);E>=0&&g.splice(E,1)}}),this.players.push(s),h.push(s),s}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(n=>n.delete(t)),this._elementListeners.forEach((n,i)=>{this._elementListeners.set(i,n.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const n=this._engine.playersByElement.get(t);n&&(n.forEach(i=>i.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,n){const i=this._engine.driver.query(t,gb,!0);i.forEach(r=>{if(r[As])return;const o=this._engine.fetchNamespacesByElement(r);o.size?o.forEach(s=>s.triggerLeaveAnimation(r,n,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,n,i,r){const o=this._engine.statesByElement.get(t),s=new Map;if(o){const a=[];if(o.forEach((c,l)=>{if(s.set(l,c.value),this._triggers.has(l)){const d=this.trigger(t,l,Um,r);d&&a.push(d)}}),a.length)return this._engine.markElementAsRemoved(this.id,t,!0,n,s),i&&Wc(a).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const n=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(n&&i){const r=new Set;n.forEach(o=>{const s=o.name;if(r.has(s))return;r.add(s);const c=this._triggers.get(s).fallbackTransition,l=i.get(s)||YR,d=new qR(Um),u=new $R(this.id,s,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:s,transition:c,fromState:l,toState:d,player:u,isFallbackTransition:!0})})}}removeNode(t,n){const i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,n),this.triggerLeaveAnimation(t,n,!0))return;let r=!1;if(i.totalAnimations){const o=i.players.length?i.playersByQueriedElement.get(t):[];if(o&&o.length)r=!0;else{let s=t;for(;s=s.parentNode;)if(i.statesByElement.get(s)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)i.markElementAsRemoved(this.id,t,!1,n);else{const o=t[As];(!o||o===J4)&&(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,n))}}insertNode(t,n){Ko(t,this._hostClassName)}drainQueuedTransitions(t){const n=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const o=i.element,s=this._elementListeners.get(o);s&&s.forEach(a=>{if(a.name==i.triggerName){const c=DR(o,i.triggerName,i.fromState.value,i.toState.value);c._data=t,RR(i.player,a.phase,c,a.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):n.push(i)}),this._queue=[],n.sort((i,r)=>{const o=i.transition.ast.depCount,s=r.transition.ast.depCount;return 0==o||0==s?o-s:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(t){this.players.forEach(n=>n.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}}class MEe{_onRemovalComplete(t,n){this.onRemovalComplete(t,n)}constructor(t,n,i,r){this.bodyNode=t,this.driver=n,this._normalizer=i,this.scheduler=r,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(o,s)=>{}}get queuedPlayers(){const t=[];return this._namespaceList.forEach(n=>{n.players.forEach(i=>{i.queued&&t.push(i)})}),t}createNamespace(t,n){const i=new PEe(t,n,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,n)?this._balanceNamespaceList(i,n):(this.newHostElements.set(n,i),this.collectEnterElement(n)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,n){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let s=!1,a=this.driver.getParentElement(n);for(;a;){const c=r.get(a);if(c){const l=i.indexOf(c);i.splice(l+1,0,t),s=!0;break}a=this.driver.getParentElement(a)}s||i.unshift(t)}else i.push(t);return r.set(n,t),t}register(t,n){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,n)),i}registerTrigger(t,n,i){let r=this._namespaceLookup[t];r&&r.register(n,i)&&this.totalAnimations++}destroy(t,n){t&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const i=this._fetchNamespace(t);this.namespacesByHostElement.delete(i.hostElement);const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1),i.destroy(n),delete this._namespaceLookup[t]}))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const n=new Set,i=this.statesByElement.get(t);if(i)for(let r of i.values())if(r.namespaceId){const o=this._fetchNamespace(r.namespaceId);o&&n.add(o)}return n}trigger(t,n,i,r){if(Tb(n)){const o=this._fetchNamespace(t);if(o)return o.trigger(n,i,r),!0}return!1}insertNode(t,n,i,r){if(!Tb(n))return;const o=n[As];if(o&&o.setForRemoval){o.setForRemoval=!1,o.setForMove=!0;const s=this.collectedLeaveElements.indexOf(n);s>=0&&this.collectedLeaveElements.splice(s,1)}if(t){const s=this._fetchNamespace(t);s&&s.insertNode(n,i)}r&&this.collectEnterElement(n)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,n){n?this.disabledNodes.has(t)||(this.disabledNodes.add(t),Ko(t,KR)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),ah(t,KR))}removeNode(t,n,i){if(Tb(n)){this.scheduler?.notify();const r=t?this._fetchNamespace(t):null;r?r.removeNode(n,i):this.markElementAsRemoved(t,n,!1,i);const o=this.namespacesByHostElement.get(n);o&&o.id!==t&&o.removeNode(n,i)}else this._onRemovalComplete(n,i)}markElementAsRemoved(t,n,i,r,o){this.collectedLeaveElements.push(n),n[As]={namespaceId:t,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:o}}listen(t,n,i,r,o){return Tb(n)?this._fetchNamespace(t).listen(n,i,r,o):()=>{}}_buildInstruction(t,n,i,r,o){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,r,t.fromState.options,t.toState.options,n,o)}destroyInnerAnimations(t){let n=this.driver.query(t,gb,!0);n.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(n=this.driver.query(t,kR,!0),n.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(t){const n=this.playersByElement.get(t);n&&n.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(t){const n=this.playersByQueriedElement.get(t);n&&n.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return Wc(this.players).onDone(()=>t());t()})}processLeaveNode(t){const n=t[As];if(n&&n.setForRemoval){if(t[As]=J4,n.namespaceId){this.destroyInnerAnimations(t);const i=this._fetchNamespace(n.namespaceId);i&&i.clearElementCache(t)}this._onRemovalComplete(t,n.setForRemoval)}t.classList?.contains(KR)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(i=>{this.markElementAsDisabled(i,!1)})}flush(t=-1){let n=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)Ko(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{n=this._flushAnimations(i,t)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],n.length?Wc(n).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(t){throw function Uve(e){return new W(3402,!1)}()}_flushAnimations(t,n){const i=new yb,r=[],o=new Map,s=[],a=new Map,c=new Map,l=new Map,d=new Set;this.disabledNodes.forEach(me=>{d.add(me);const P=this.driver.query(me,".ng-animate-queued",!0);for(let F=0;F<P.length;F++)d.add(P[F])});const u=this.bodyNode,h=Array.from(this.statesByElement.keys()),p=t5(h,this.collectedEnterElements),m=new Map;let f=0;p.forEach((me,P)=>{const F=xR+f++;m.set(P,F),me.forEach(G=>Ko(G,F))});const g=[],E=new Set,b=new Set;for(let me=0;me<this.collectedLeaveElements.length;me++){const P=this.collectedLeaveElements[me],F=P[As];F&&F.setForRemoval&&(g.push(P),E.add(P),F.hasAnimation?this.driver.query(P,".ng-star-inserted",!0).forEach(G=>E.add(G)):b.add(P))}const T=new Map,I=t5(h,Array.from(E));I.forEach((me,P)=>{const F=fb+f++;T.set(P,F),me.forEach(G=>Ko(G,F))}),t.push(()=>{p.forEach((me,P)=>{const F=m.get(P);me.forEach(G=>ah(G,F))}),I.forEach((me,P)=>{const F=T.get(P);me.forEach(G=>ah(G,F))}),g.forEach(me=>{this.processLeaveNode(me)})});const D=[],O=[];for(let me=this._namespaceList.length-1;me>=0;me--)this._namespaceList[me].drainQueuedTransitions(n).forEach(F=>{const G=F.player,U=F.element;if(D.push(G),this.collectedEnterElements.length){const nt=U[As];if(nt&&nt.setForMove){if(nt.previousTriggersValues&&nt.previousTriggersValues.has(F.triggerName)){const Hn=nt.previousTriggersValues.get(F.triggerName),ai=this.statesByElement.get(F.element);if(ai&&ai.has(F.triggerName)){const yc=ai.get(F.triggerName);yc.value=Hn,ai.set(F.triggerName,yc)}}return void G.destroy()}}const v=!u||!this.driver.containsElement(u,U),w=T.get(U),A=m.get(U),B=this._buildInstruction(F,i,A,w,v);if(B.errors&&B.errors.length)return void O.push(B);if(v)return G.onStart(()=>od(U,B.fromStyles)),G.onDestroy(()=>la(U,B.toStyles)),void r.push(G);if(F.isFallbackTransition)return G.onStart(()=>od(U,B.fromStyles)),G.onDestroy(()=>la(U,B.toStyles)),void r.push(G);const ge=[];B.timelines.forEach(nt=>{nt.stretchStartingKeyframe=!0,this.disabledNodes.has(nt.element)||ge.push(nt)}),B.timelines=ge,i.append(U,B.timelines),s.push({instruction:B,player:G,element:U}),B.queriedElements.forEach(nt=>vo(a,nt,[]).push(G)),B.preStyleProps.forEach((nt,Hn)=>{if(nt.size){let ai=c.get(Hn);ai||c.set(Hn,ai=new Set),nt.forEach((yc,Rl)=>ai.add(Rl))}}),B.postStyleProps.forEach((nt,Hn)=>{let ai=l.get(Hn);ai||l.set(Hn,ai=new Set),nt.forEach((yc,Rl)=>ai.add(Rl))})});if(O.length){const me=[];O.forEach(P=>{me.push(function Vve(e,t){return new W(3505,!1)}())}),D.forEach(P=>P.destroy()),this.reportError(me)}const k=new Map,L=new Map;s.forEach(me=>{const P=me.element;i.has(P)&&(L.set(P,P),this._beforeAnimationBuild(me.player.namespaceId,me.instruction,k))}),r.forEach(me=>{const P=me.element;this._getPreviousPlayers(P,!1,me.namespaceId,me.triggerName,null).forEach(G=>{vo(k,P,[]).push(G),G.destroy()})});const V=g.filter(me=>r5(me,c,l)),ee=new Map;e5(ee,this.driver,b,l,nc).forEach(me=>{r5(me,c,l)&&V.push(me)});const Ie=new Map;p.forEach((me,P)=>{e5(Ie,this.driver,new Set(me),c,"!")}),V.forEach(me=>{const P=ee.get(me),F=Ie.get(me);ee.set(me,new Map([...P?.entries()??[],...F?.entries()??[]]))});const Ue=[],Dt=[],dt={};s.forEach(me=>{const{element:P,player:F,instruction:G}=me;if(i.has(P)){if(d.has(P))return F.onDestroy(()=>la(P,G.toStyles)),F.disabled=!0,F.overrideTotalTime(G.totalTime),void r.push(F);let U=dt;if(L.size>1){let w=P;const A=[];for(;w=w.parentNode;){const B=L.get(w);if(B){U=B;break}A.push(w)}A.forEach(B=>L.set(B,U))}const v=this._buildAnimation(F.namespaceId,G,k,o,Ie,ee);if(F.setRealPlayer(v),U===dt)Ue.push(F);else{const w=this.playersByElement.get(U);w&&w.length&&(F.parentPlayer=Wc(w)),r.push(F)}}else od(P,G.fromStyles),F.onDestroy(()=>la(P,G.toStyles)),Dt.push(F),d.has(P)&&r.push(F)}),Dt.forEach(me=>{const P=o.get(me.element);if(P&&P.length){const F=Wc(P);me.setRealPlayer(F)}}),r.forEach(me=>{me.parentPlayer?me.syncPlayerEvents(me.parentPlayer):me.destroy()});for(let me=0;me<g.length;me++){const P=g[me],F=P[As];if(ah(P,fb),F&&F.hasAnimation)continue;let G=[];if(a.size){let v=a.get(P);v&&v.length&&G.push(...v);let w=this.driver.query(P,kR,!0);for(let A=0;A<w.length;A++){let B=a.get(w[A]);B&&B.length&&G.push(...B)}}const U=G.filter(v=>!v.destroyed);U.length?FEe(this,P,U):this.processLeaveNode(P)}return g.length=0,Ue.forEach(me=>{this.players.push(me),me.onDone(()=>{me.destroy();const P=this.players.indexOf(me);this.players.splice(P,1)}),me.play()}),Ue}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,n,i,r,o){let s=[];if(n){const a=this.playersByQueriedElement.get(t);a&&(s=a)}else{const a=this.playersByElement.get(t);if(a){const c=!o||o==Um;a.forEach(l=>{l.queued||!c&&l.triggerName!=r||s.push(l)})}}return(i||r)&&(s=s.filter(a=>!(i&&i!=a.namespaceId||r&&r!=a.triggerName))),s}_beforeAnimationBuild(t,n,i){const o=n.element,s=n.isRemovalTransition?void 0:t,a=n.isRemovalTransition?void 0:n.triggerName;for(const c of n.timelines){const l=c.element,d=l!==o,u=vo(i,l,[]);this._getPreviousPlayers(l,d,s,a,n.toState).forEach(p=>{const m=p.getRealPlayer();m.beforeDestroy&&m.beforeDestroy(),p.destroy(),u.push(p)})}od(o,n.fromStyles)}_buildAnimation(t,n,i,r,o,s){const a=n.triggerName,c=n.element,l=[],d=new Set,u=new Set,h=n.timelines.map(m=>{const f=m.element;d.add(f);const g=f[As];if(g&&g.removedBeforeQueried)return new xm(m.duration,m.delay);const E=f!==c,b=function UEe(e){const t=[];return n5(e,t),t}((i.get(f)||OEe).map(k=>k.getRealPlayer())).filter(k=>!!k.element&&k.element===f),T=o.get(f),I=s.get(f),D=M4(this._normalizer,m.keyframes,T,I),O=this._buildPlayer(m,D,b);if(m.subTimeline&&r&&u.add(f),E){const k=new $R(t,a,f);k.setRealPlayer(O),l.push(k)}return O});l.forEach(m=>{vo(this.playersByQueriedElement,m.element,[]).push(m),m.onDone(()=>function xEe(e,t,n){let i=e.get(t);if(i){if(i.length){const r=i.indexOf(n);i.splice(r,1)}0==i.length&&e.delete(t)}return i}(this.playersByQueriedElement,m.element,m))}),d.forEach(m=>Ko(m,V4));const p=Wc(h);return p.onDestroy(()=>{d.forEach(m=>ah(m,V4)),la(c,n.toStyles)}),u.forEach(m=>{vo(r,m,[]).push(p)}),p}_buildPlayer(t,n,i){return n.length>0?this.driver.animate(t.element,n,t.duration,t.delay,t.easing,i):new xm(t.duration,t.delay)}}class $R{constructor(t,n,i){this.namespaceId=t,this.triggerName=n,this.element=i,this._player=new xm,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((n,i)=>{n.forEach(r=>RR(t,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const n=this._player;n.triggerCallback&&t.onStart(()=>n.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,n){vo(this._queuedCallbacks,t,[]).push(n)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const n=this._player;n.triggerCallback&&n.triggerCallback(t)}}function Tb(e){return e&&1===e.nodeType}function Q4(e,t){const n=e.style.display;return e.style.display=t??"none",n}function e5(e,t,n,i,r){const o=[];n.forEach(c=>o.push(Q4(c)));const s=[];i.forEach((c,l)=>{const d=new Map;c.forEach(u=>{const h=t.computeStyle(l,u,r);d.set(u,h),(!h||0==h.length)&&(l[As]=NEe,s.push(l))}),e.set(l,d)});let a=0;return n.forEach(c=>Q4(c,o[a++])),s}function t5(e,t){const n=new Map;if(e.forEach(a=>n.set(a,[])),0==t.length)return n;const r=new Set(t),o=new Map;function s(a){if(!a)return 1;let c=o.get(a);if(c)return c;const l=a.parentNode;return c=n.has(l)?l:r.has(l)?1:s(l),o.set(a,c),c}return t.forEach(a=>{const c=s(a);1!==c&&n.get(c).push(a)}),n}function Ko(e,t){e.classList?.add(t)}function ah(e,t){e.classList?.remove(t)}function FEe(e,t,n){Wc(n).onDone(()=>e.processLeaveNode(t))}function n5(e,t){for(let n=0;n<e.length;n++){const i=e[n];i instanceof Jj?n5(i.players,t):t.push(i)}}function r5(e,t,n){const i=n.get(e);if(!i)return!1;let r=t.get(e);return r?i.forEach(o=>r.add(o)):t.set(e,i),n.delete(e),!0}class Vm{constructor(t,n,i,r){this._driver=n,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(o,s)=>{},this._transitionEngine=new MEe(t.body,n,i,r),this._timelineEngine=new wEe(t.body,n,i),this._transitionEngine.onRemovalComplete=(o,s)=>this.onRemovalComplete(o,s)}registerTrigger(t,n,i,r,o){const s=t+"-"+r;let a=this._triggerCache[s];if(!a){const c=[],d=BR(this._driver,o,c,[]);if(c.length)throw function Ave(e,t){return new W(3404,!1)}();a=function yEe(e,t,n){return new SEe(e,t,n)}(r,d,this._normalizer),this._triggerCache[s]=a}this._transitionEngine.registerTrigger(n,r,a)}register(t,n){this._transitionEngine.register(t,n)}destroy(t,n){this._transitionEngine.destroy(t,n)}onInsert(t,n,i,r){this._transitionEngine.insertNode(t,n,i,r)}onRemove(t,n,i){this._transitionEngine.removeNode(t,n,i)}disableAnimations(t,n){this._transitionEngine.markElementAsDisabled(t,n)}process(t,n,i,r){if("@"==i.charAt(0)){const[o,s]=x4(i);this._timelineEngine.command(o,n,s,r)}else this._transitionEngine.trigger(t,n,i,r)}listen(t,n,i,r,o){if("@"==i.charAt(0)){const[s,a]=x4(i);return this._timelineEngine.listen(s,n,a,o)}return this._transitionEngine.listen(t,n,i,r,o)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(t){this._transitionEngine.afterFlushAnimationsDone(t)}}class Bm{static{this.initialStylesByElement=new WeakMap}constructor(t,n,i){this._element=t,this._startStyles=n,this._endStyles=i,this._state=0;let r=Bm.initialStylesByElement.get(t);r||Bm.initialStylesByElement.set(t,r=new Map),this._initialStyles=r}start(){this._state<1&&(this._startStyles&&la(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(la(this._element,this._initialStyles),this._endStyles&&(la(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(Bm.initialStylesByElement.delete(this._element),this._startStyles&&(od(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(od(this._element,this._endStyles),this._endStyles=null),la(this._element,this._initialStyles),this._state=3)}}function XR(e){let t=null;return e.forEach((n,i)=>{(function jEe(e){return"display"===e||"position"===e})(i)&&(t=t||new Map,t.set(i,n))}),t}class o5{constructor(t,n,i,r){this.element=t,this.keyframes=n,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map;const n=()=>this._onFinish();this.domPlayer.addEventListener("finish",n),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",n)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const n=[];return t.forEach(i=>{n.push(Object.fromEntries(i))}),n}_triggerWebAnimation(t,n,i){return t.animate(this._convertKeyframesToObject(n),i)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&t.set(r,this._finished?i:VR(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){const n="start"===t?this._onStartFns:this._onDoneFns;n.forEach(i=>i()),n.length=0}}class s5{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,n){return!1}containsElement(t,n){return L4(t,n)}getParentElement(t){return OR(t)}query(t,n,i){return F4(t,n,i)}computeStyle(t,n,i){return VR(t,n)}animate(t,n,i,r,o,s=[]){const c={duration:i,delay:r,fill:0==r?"both":"forwards"};o&&(c.easing=o);const l=new Map,d=s.filter(p=>p instanceof o5);(function Jve(e,t){return 0===e||0===t})(i,r)&&d.forEach(p=>{p.currentSnapshot.forEach((m,f)=>l.set(f,m))});let u=function $ve(e){return e.length?e[0]instanceof Map?e:e.map(t=>new Map(Object.entries(t))):[]}(n).map(p=>new Map(p));u=function Qve(e,t,n){if(n.size&&t.length){let i=t[0],r=[];if(n.forEach((o,s)=>{i.has(s)||r.push(s),i.set(s,o)}),r.length)for(let o=1;o<t.length;o++){let s=t[o];r.forEach(a=>s.set(a,VR(e,a)))}}return t}(t,u,l);const h=function BEe(e,t){let n=null,i=null;return Array.isArray(t)&&t.length?(n=XR(t[0]),t.length>1&&(i=XR(t[t.length-1]))):t instanceof Map&&(n=XR(t)),n||i?new Bm(e,n,i):null}(t,u);return new o5(t,u,c,h)}}const a5="@.disabled";class c5{constructor(t,n,i,r){this.namespaceId=t,this.delegate=n,this.engine=i,this._onDestroy=r,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(t){this.delegate.destroyNode?.(t)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(t,n){return this.delegate.createElement(t,n)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,n){this.delegate.appendChild(t,n),this.engine.onInsert(this.namespaceId,n,t,!1)}insertBefore(t,n,i,r=!0){this.delegate.insertBefore(t,n,i),this.engine.onInsert(this.namespaceId,n,t,r)}removeChild(t,n,i){this.engine.onRemove(this.namespaceId,n,this.delegate)}selectRootElement(t,n){return this.delegate.selectRootElement(t,n)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,n,i,r){this.delegate.setAttribute(t,n,i,r)}removeAttribute(t,n,i){this.delegate.removeAttribute(t,n,i)}addClass(t,n){this.delegate.addClass(t,n)}removeClass(t,n){this.delegate.removeClass(t,n)}setStyle(t,n,i,r){this.delegate.setStyle(t,n,i,r)}removeStyle(t,n,i){this.delegate.removeStyle(t,n,i)}setProperty(t,n,i){"@"==n.charAt(0)&&n==a5?this.disableAnimations(t,!!i):this.delegate.setProperty(t,n,i)}setValue(t,n){this.delegate.setValue(t,n)}listen(t,n,i){return this.delegate.listen(t,n,i)}disableAnimations(t,n){this.engine.disableAnimations(t,n)}}class HEe extends c5{constructor(t,n,i,r,o){super(n,i,r,o),this.factory=t,this.namespaceId=n}setProperty(t,n,i){"@"==n.charAt(0)?"."==n.charAt(1)&&n==a5?this.disableAnimations(t,i=void 0===i||!!i):this.engine.process(this.namespaceId,t,n.slice(1),i):this.delegate.setProperty(t,n,i)}listen(t,n,i){if("@"==n.charAt(0)){const r=function GEe(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(t);let o=n.slice(1),s="";return"@"!=o.charAt(0)&&([o,s]=function WEe(e){const t=e.indexOf(".");return[e.substring(0,t),e.slice(t+1)]}(o)),this.engine.listen(this.namespaceId,r,o,s,a=>{this.factory.scheduleListenerCallback(a._data||-1,i,a)})}return this.delegate.listen(t,n,i)}}class zEe{constructor(t,n,i){this.delegate=t,this.engine=n,this._zone=i,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,n.onRemovalComplete=(r,o)=>{const s=o?.parentNode(r);s&&o.removeChild(s,r)}}createRenderer(t,n){const r=this.delegate.createRenderer(t,n);if(!t||!n?.data?.animation){const l=this._rendererCache;let d=l.get(r);return d||(d=new c5("",r,this.engine,()=>l.delete(r)),l.set(r,d)),d}const o=n.id,s=n.id+"-"+this._currentId;this._currentId++,this.engine.register(s,t);const a=l=>{Array.isArray(l)?l.forEach(a):this.engine.registerTrigger(o,s,t,l.name,l)};return n.data.animation.forEach(a),new HEe(this,s,r,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(t,n,i){if(t>=0&&t<this._microtaskId)return void this._zone.run(()=>n(i));const r=this._animationCallbacksBuffer;0==r.length&&queueMicrotask(()=>{this._zone.run(()=>{r.forEach(o=>{const[s,a]=o;s(a)}),this._animationCallbacksBuffer=[]})}),r.push([n,i])}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}let KEe=(()=>{class e extends Vm{constructor(n,i,r){super(n,i,r,J(jv,{optional:!0}))}ngOnDestroy(){this.flush()}static{this.\u0275fac=function(i){return new(i||e)(Z(Ut),Z(PR),Z(MR))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac})}}return e})();const l5=[{provide:MR,useFactory:function qEe(){return new H4}},{provide:Vm,useClass:KEe},{provide:j0,useFactory:function YEe(e,t,n){return new zEe(e,t,n)},deps:[AI,Vm,Le]}],ZR=[{provide:PR,useFactory:()=>new s5},{provide:za,useValue:"BrowserAnimations"},...l5],d5=[{provide:PR,useClass:NR},{provide:za,useValue:"NoopAnimations"},...l5];let $Ee=(()=>{class e{static withConfig(n){return{ngModule:e,providers:n.disableAnimations?d5:ZR}}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({providers:ZR,imports:[jB]})}}return e})();const Ib=NC(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function u5(e){return new Gn(t=>{mr(e()).subscribe(t)})}function Rb(e,t){const n=Ft(e)?e:()=>e,i=r=>r.error(n());return new Gn(t?r=>t.schedule(i,0,r):i)}function JR(){return Jn((e,t)=>{let n=null;e._refCount++;const i=Un(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const r=e._connection,o=n;n=null,r&&(!o||r===o)&&r.unsubscribe(),t.unsubscribe()});e.subscribe(i),i.closed||(n=e.connect())})}class h5 extends Gn{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,T1(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new li;const n=this.getSubject();t.add(this.source.subscribe(Un(n,void 0,()=>{this._teardown(),n.complete()},i=>{this._teardown(),n.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=li.EMPTY)}return t}refCount(){return JR()(this)}}function Ds(e,t){return Jn((n,i)=>{let r=null,o=0,s=!1;const a=()=>s&&!r&&i.complete();n.subscribe(Un(i,c=>{r?.unsubscribe();let l=0;const d=o++;mr(e(c,d)).subscribe(r=Un(i,u=>i.next(t?t(c,u,d,l++):u),()=>{r=null,a()}))},()=>{s=!0,a()}))})}function Ab(e){return Jn((t,n)=>{let i=!1;t.subscribe(Un(n,r=>{i=!0,n.next(r)},()=>{i||n.next(e),n.complete()}))})}function p5(e=ZEe){return Jn((t,n)=>{let i=!1;t.subscribe(Un(n,r=>{i=!0,n.next(r)},()=>i?n.complete():n.error(e())))})}function ZEe(){return new Ib}function ad(e,t){const n=arguments.length>=2;return i=>i.pipe(e?$r((r,o)=>e(r,o,i)):Sc,Ti(1),n?Ab(t):p5(()=>new Ib))}function jm(e,t){return Ft(t)?zi(e,t,1):zi(e,1)}function ch(e){return Jn((t,n)=>{let o,i=null,r=!1;i=t.subscribe(Un(n,void 0,void 0,s=>{o=mr(e(s,ch(e)(t))),i?(i.unsubscribe(),i=null,o.subscribe(n)):r=!0})),r&&(i.unsubscribe(),i=null,o.subscribe(n))})}function QR(e){return e<=0?()=>Go:Jn((t,n)=>{let i=[];t.subscribe(Un(n,r=>{i.push(r),e<i.length&&i.shift()},()=>{for(const r of i)n.next(r);n.complete()},void 0,()=>{i=null}))})}function f5(e){return Nt(()=>e)}function eA(e){return Jn((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}const at="primary",Hm=Symbol("RouteTitle");class tbe{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function lh(e){return new tbe(e)}function nbe(e,t,n){const i=n.path.split("/");if(i.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||i.length<e.length))return null;const r={};for(let o=0;o<i.length;o++){const s=i[o],a=e[o];if(s.startsWith(":"))r[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:e.slice(0,i.length),posParams:r}}function da(e,t){const n=e?tA(e):void 0,i=t?tA(t):void 0;if(!n||!i||n.length!=i.length)return!1;let r;for(let o=0;o<n.length;o++)if(r=n[o],!m5(e[r],t[r]))return!1;return!0}function tA(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function m5(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),i=[...t].sort();return n.every((r,o)=>i[o]===r)}return e===t}function g5(e){return e.length>0?e[e.length-1]:null}function zc(e){return function XEe(e){return!!e&&(e instanceof Gn||Ft(e.lift)&&Ft(e.subscribe))}(e)?e:cm(e)?xi(Promise.resolve(e)):Be(e)}const rbe={exact:function E5(e,t,n){if(!cd(e.segments,t.segments)||!Db(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!e.children[i]||!E5(e.children[i],t.children[i],n))return!1;return!0},subset:b5},_5={exact:function obe(e,t){return da(e,t)},subset:function sbe(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>m5(e[n],t[n]))},ignored:()=>!0};function v5(e,t,n){return rbe[n.paths](e.root,t.root,n.matrixParams)&&_5[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function b5(e,t,n){return y5(e,t,t.segments,n)}function y5(e,t,n,i){if(e.segments.length>n.length){const r=e.segments.slice(0,n.length);return!(!cd(r,n)||t.hasChildren()||!Db(r,n,i))}if(e.segments.length===n.length){if(!cd(e.segments,n)||!Db(e.segments,n,i))return!1;for(const r in t.children)if(!e.children[r]||!b5(e.children[r],t.children[r],i))return!1;return!0}{const r=n.slice(0,e.segments.length),o=n.slice(e.segments.length);return!!(cd(e.segments,r)&&Db(e.segments,r,i)&&e.children[at])&&y5(e.children[at],t,o,i)}}function Db(e,t,n){return t.every((i,r)=>_5[n](e[r].parameters,i.parameters))}class dh{constructor(t=new gn([],{}),n={},i=null){this.root=t,this.queryParams=n,this.fragment=i}get queryParamMap(){return this._queryParamMap??=lh(this.queryParams),this._queryParamMap}toString(){return lbe.serialize(this)}}class gn{constructor(t,n){this.segments=t,this.children=n,this.parent=null,Object.values(n).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Ob(this)}}class Gm{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap??=lh(this.parameters),this._parameterMap}toString(){return T5(this)}}function cd(e,t){return e.length===t.length&&e.every((n,i)=>n.path===t[i].path)}let uh=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:()=>new nA,providedIn:"root"})}}return e})();class nA{parse(t){const n=new bbe(t);return new dh(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${Wm(t.root,!0)}`,i=function hbe(e){const t=Object.entries(e).map(([n,i])=>Array.isArray(i)?i.map(r=>`${Nb(n)}=${Nb(r)}`).join("&"):`${Nb(n)}=${Nb(i)}`).filter(n=>n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${i}${"string"==typeof t.fragment?`#${function dbe(e){return encodeURI(e)}(t.fragment)}`:""}`}}const lbe=new nA;function Ob(e){return e.segments.map(t=>T5(t)).join("/")}function Wm(e,t){if(!e.hasChildren())return Ob(e);if(t){const n=e.children[at]?Wm(e.children[at],!1):"",i=[];return Object.entries(e.children).forEach(([r,o])=>{r!==at&&i.push(`${r}:${Wm(o,!1)}`)}),i.length>0?`${n}(${i.join("//")})`:n}{const n=function cbe(e,t){let n=[];return Object.entries(e.children).forEach(([i,r])=>{i===at&&(n=n.concat(t(r,i)))}),Object.entries(e.children).forEach(([i,r])=>{i!==at&&(n=n.concat(t(r,i)))}),n}(e,(i,r)=>r===at?[Wm(e.children[at],!1)]:[`${r}:${Wm(i,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[at]?`${Ob(e)}/${n[0]}`:`${Ob(e)}/(${n.join("//")})`}}function S5(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Nb(e){return S5(e).replace(/%3B/gi,";")}function iA(e){return S5(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Pb(e){return decodeURIComponent(e)}function C5(e){return Pb(e.replace(/\+/g,"%20"))}function T5(e){return`${iA(e.path)}${function ube(e){return Object.entries(e).map(([t,n])=>`;${iA(t)}=${iA(n)}`).join("")}(e.parameters)}`}const pbe=/^[^\/()?;#]+/;function rA(e){const t=e.match(pbe);return t?t[0]:""}const fbe=/^[^\/()?;=#]+/,gbe=/^[^=?&#]+/,vbe=/^[^&#]+/;class bbe{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new gn([],{}):new gn([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(i[at]=new gn(t,n)),i}parseSegment(){const t=rA(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new W(4009,!1);return this.capture(t),new Gm(Pb(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=function mbe(e){const t=e.match(fbe);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const r=rA(this.remaining);r&&(i=r,this.capture(i))}t[Pb(n)]=Pb(i)}parseQueryParam(t){const n=function _be(e){const t=e.match(gbe);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const s=function Ebe(e){const t=e.match(vbe);return t?t[0]:""}(this.remaining);s&&(i=s,this.capture(i))}const r=C5(n),o=C5(i);if(t.hasOwnProperty(r)){let s=t[r];Array.isArray(s)||(s=[s],t[r]=s),s.push(o)}else t[r]=o}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=rA(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new W(4010,!1);let o;i.indexOf(":")>-1?(o=i.slice(0,i.indexOf(":")),this.capture(o),this.capture(":")):t&&(o=at);const s=this.parseChildren();n[o]=1===Object.keys(s).length?s[at]:new gn([],s),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new W(4011,!1)}}function w5(e){return e.segments.length>0?new gn([],{[at]:e}):e}function I5(e){const t={};for(const[i,r]of Object.entries(e.children)){const o=I5(r);if(i===at&&0===o.segments.length&&o.hasChildren())for(const[s,a]of Object.entries(o.children))t[s]=a;else(o.segments.length>0||o.hasChildren())&&(t[i]=o)}return function ybe(e){if(1===e.numberOfChildren&&e.children[at]){const t=e.children[at];return new gn(e.segments.concat(t.segments),t.children)}return e}(new gn(e.segments,t))}function hh(e){return e instanceof dh}function R5(e){let t;const r=w5(function n(o){const s={};for(const c of o.children){const l=n(c);s[c.outlet]=l}const a=new gn(o.url,s);return o===e&&(t=a),a}(e.root));return t??r}function A5(e,t,n,i){let r=e;for(;r.parent;)r=r.parent;if(0===t.length)return oA(r,r,r,n,i);const o=function Cbe(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new O5(!0,0,e);let t=0,n=!1;const i=e.reduce((r,o,s)=>{if("object"==typeof o&&null!=o){if(o.outlets){const a={};return Object.entries(o.outlets).forEach(([c,l])=>{a[c]="string"==typeof l?l.split("/"):l}),[...r,{outlets:a}]}if(o.segmentPath)return[...r,o.segmentPath]}return"string"!=typeof o?[...r,o]:0===s?(o.split("/").forEach((a,c)=>{0==c&&"."===a||(0==c&&""===a?n=!0:".."===a?t++:""!=a&&r.push(a))}),r):[...r,o]},[]);return new O5(n,t,i)}(t);if(o.toRoot())return oA(r,r,new gn([],{}),n,i);const s=function Tbe(e,t,n){if(e.isAbsolute)return new xb(t,!0,0);if(!n)return new xb(t,!1,NaN);if(null===n.parent)return new xb(n,!0,0);const i=Mb(e.commands[0])?0:1;return function wbe(e,t,n){let i=e,r=t,o=n;for(;o>r;){if(o-=r,i=i.parent,!i)throw new W(4005,!1);r=i.segments.length}return new xb(i,!1,r-o)}(n,n.segments.length-1+i,e.numberOfDoubleDots)}(o,r,e),a=s.processChildren?Km(s.segmentGroup,s.index,o.commands):N5(s.segmentGroup,s.index,o.commands);return oA(r,s.segmentGroup,a,n,i)}function Mb(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function zm(e){return"object"==typeof e&&null!=e&&e.outlets}function oA(e,t,n,i,r){let s,o={};i&&Object.entries(i).forEach(([c,l])=>{o[c]=Array.isArray(l)?l.map(d=>`${d}`):`${l}`}),s=e===t?n:D5(e,t,n);const a=w5(I5(s));return new dh(a,o,r)}function D5(e,t,n){const i={};return Object.entries(e.children).forEach(([r,o])=>{i[r]=o===t?n:D5(o,t,n)}),new gn(e.segments,i)}class O5{constructor(t,n,i){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=i,t&&i.length>0&&Mb(i[0]))throw new W(4003,!1);const r=i.find(zm);if(r&&r!==g5(i))throw new W(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class xb{constructor(t,n,i){this.segmentGroup=t,this.processChildren=n,this.index=i}}function N5(e,t,n){if(e??=new gn([],{}),0===e.segments.length&&e.hasChildren())return Km(e,t,n);const i=function Rbe(e,t,n){let i=0,r=t;const o={match:!1,pathIndex:0,commandIndex:0};for(;r<e.segments.length;){if(i>=n.length)return o;const s=e.segments[r],a=n[i];if(zm(a))break;const c=`${a}`,l=i<n.length-1?n[i+1]:null;if(r>0&&void 0===c)break;if(c&&l&&"object"==typeof l&&void 0===l.outlets){if(!M5(c,l,s))return o;i+=2}else{if(!M5(c,{},s))return o;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(e,t,n),r=n.slice(i.commandIndex);if(i.match&&i.pathIndex<e.segments.length){const o=new gn(e.segments.slice(0,i.pathIndex),{});return o.children[at]=new gn(e.segments.slice(i.pathIndex),e.children),Km(o,0,r)}return i.match&&0===r.length?new gn(e.segments,{}):i.match&&!e.hasChildren()?sA(e,t,n):i.match?Km(e,0,r):sA(e,t,n)}function Km(e,t,n){if(0===n.length)return new gn(e.segments,{});{const i=function Ibe(e){return zm(e[0])?e[0].outlets:{[at]:e}}(n),r={};if(Object.keys(i).some(o=>o!==at)&&e.children[at]&&1===e.numberOfChildren&&0===e.children[at].segments.length){const o=Km(e.children[at],t,n);return new gn(e.segments,o.children)}return Object.entries(i).forEach(([o,s])=>{"string"==typeof s&&(s=[s]),null!==s&&(r[o]=N5(e.children[o],t,s))}),Object.entries(e.children).forEach(([o,s])=>{void 0===i[o]&&(r[o]=s)}),new gn(e.segments,r)}}function sA(e,t,n){const i=e.segments.slice(0,t);let r=0;for(;r<n.length;){const o=n[r];if(zm(o)){const c=Abe(o.outlets);return new gn(i,c)}if(0===r&&Mb(n[0])){i.push(new Gm(e.segments[t].path,P5(n[0]))),r++;continue}const s=zm(o)?o.outlets[at]:`${o}`,a=r<n.length-1?n[r+1]:null;s&&a&&Mb(a)?(i.push(new Gm(s,P5(a))),r+=2):(i.push(new Gm(s,{})),r++)}return new gn(i,{})}function Abe(e){const t={};return Object.entries(e).forEach(([n,i])=>{"string"==typeof i&&(i=[i]),null!==i&&(t[n]=sA(new gn([],{}),0,i))}),t}function P5(e){const t={};return Object.entries(e).forEach(([n,i])=>t[n]=`${i}`),t}function M5(e,t,n){return e==n.path&&da(t,n.parameters)}const qm="imperative";var It=function(e){return e[e.NavigationStart=0]="NavigationStart",e[e.NavigationEnd=1]="NavigationEnd",e[e.NavigationCancel=2]="NavigationCancel",e[e.NavigationError=3]="NavigationError",e[e.RoutesRecognized=4]="RoutesRecognized",e[e.ResolveStart=5]="ResolveStart",e[e.ResolveEnd=6]="ResolveEnd",e[e.GuardsCheckStart=7]="GuardsCheckStart",e[e.GuardsCheckEnd=8]="GuardsCheckEnd",e[e.RouteConfigLoadStart=9]="RouteConfigLoadStart",e[e.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",e[e.ChildActivationStart=11]="ChildActivationStart",e[e.ChildActivationEnd=12]="ChildActivationEnd",e[e.ActivationStart=13]="ActivationStart",e[e.ActivationEnd=14]="ActivationEnd",e[e.Scroll=15]="Scroll",e[e.NavigationSkipped=16]="NavigationSkipped",e}(It||{});class ua{constructor(t,n){this.id=t,this.url=n}}class kb extends ua{constructor(t,n,i="imperative",r=null){super(t,n),this.type=It.NavigationStart,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class rc extends ua{constructor(t,n,i){super(t,n),this.urlAfterRedirects=i,this.type=It.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var bo=function(e){return e[e.Redirect=0]="Redirect",e[e.SupersededByNewNavigation=1]="SupersededByNewNavigation",e[e.NoDataFromResolver=2]="NoDataFromResolver",e[e.GuardRejected=3]="GuardRejected",e}(bo||{}),Lb=function(e){return e[e.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",e[e.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",e}(Lb||{});class ph extends ua{constructor(t,n,i,r){super(t,n),this.reason=i,this.code=r,this.type=It.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class fh extends ua{constructor(t,n,i,r){super(t,n),this.reason=i,this.code=r,this.type=It.NavigationSkipped}}class Fb extends ua{constructor(t,n,i,r){super(t,n),this.error=i,this.target=r,this.type=It.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class x5 extends ua{constructor(t,n,i,r){super(t,n),this.urlAfterRedirects=i,this.state=r,this.type=It.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Dbe extends ua{constructor(t,n,i,r){super(t,n),this.urlAfterRedirects=i,this.state=r,this.type=It.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Obe extends ua{constructor(t,n,i,r,o){super(t,n),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=o,this.type=It.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Nbe extends ua{constructor(t,n,i,r){super(t,n),this.urlAfterRedirects=i,this.state=r,this.type=It.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Pbe extends ua{constructor(t,n,i,r){super(t,n),this.urlAfterRedirects=i,this.state=r,this.type=It.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Mbe{constructor(t){this.route=t,this.type=It.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class xbe{constructor(t){this.route=t,this.type=It.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class kbe{constructor(t){this.snapshot=t,this.type=It.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Lbe{constructor(t){this.snapshot=t,this.type=It.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Fbe{constructor(t){this.snapshot=t,this.type=It.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ube{constructor(t){this.snapshot=t,this.type=It.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class k5{constructor(t,n,i){this.routerEvent=t,this.position=n,this.anchor=i,this.type=It.Scroll}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class aA{}class cA{constructor(t){this.url=t}}class Vbe{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Ym,this.attachRef=null}}let Ym=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(n,i){const r=this.getOrCreateContext(n);r.outlet=i,this.contexts.set(n,r)}onChildOutletDestroyed(n){const i=this.getContext(n);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let i=this.getContext(n);return i||(i=new Vbe,this.contexts.set(n,i)),i}getContext(n){return this.contexts.get(n)||null}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();class L5{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=lA(t,this._root);return n?n.children.map(i=>i.value):[]}firstChild(t){const n=lA(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=dA(t,this._root);return n.length<2?[]:n[n.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return dA(t,this._root).map(n=>n.value)}}function lA(e,t){if(e===t.value)return t;for(const n of t.children){const i=lA(e,n);if(i)return i}return null}function dA(e,t){if(e===t.value)return[t];for(const n of t.children){const i=dA(e,n);if(i.length)return i.unshift(t),i}return[]}class Os{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function mh(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class F5 extends L5{constructor(t,n){super(t),this.snapshot=n,pA(this,t)}toString(){return this.snapshot.toString()}}function U5(e){const t=function Bbe(e){const o=new hA([],{},{},"",{},at,e,null,{});return new V5("",new Os(o,[]))}(e),n=new Sr([new Gm("",{})]),i=new Sr({}),r=new Sr({}),o=new Sr({}),s=new Sr(""),a=new ld(n,i,o,s,r,at,e,t.root);return a.snapshot=t.root,new F5(new Os(a,[]),t)}class ld{constructor(t,n,i,r,o,s,a,c){this.urlSubject=t,this.paramsSubject=n,this.queryParamsSubject=i,this.fragmentSubject=r,this.dataSubject=o,this.outlet=s,this.component=a,this._futureSnapshot=c,this.title=this.dataSubject?.pipe(Nt(l=>l[Hm]))??Be(void 0),this.url=t,this.params=n,this.queryParams=i,this.fragment=r,this.data=o}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Nt(t=>lh(t))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Nt(t=>lh(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function uA(e,t,n="emptyOnly"){let i;const{routeConfig:r}=e;return i=null===t||"always"!==n&&""!==r?.path&&(t.component||t.routeConfig?.loadComponent)?{params:{...e.params},data:{...e.data},resolve:{...e.data,...e._resolvedData??{}}}:{params:{...t.params,...e.params},data:{...t.data,...e.data},resolve:{...e.data,...t.data,...r?.data,...e._resolvedData}},r&&j5(r)&&(i.resolve[Hm]=r.title),i}class hA{get title(){return this.data?.[Hm]}constructor(t,n,i,r,o,s,a,c,l){this.url=t,this.params=n,this.queryParams=i,this.fragment=r,this.data=o,this.outlet=s,this.component=a,this.routeConfig=c,this._resolve=l}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=lh(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=lh(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class V5 extends L5{constructor(t,n){super(n),this.url=t,pA(this,n)}toString(){return B5(this._root)}}function pA(e,t){t.value._routerState=e,t.children.forEach(n=>pA(e,n))}function B5(e){const t=e.children.length>0?` { ${e.children.map(B5).join(", ")} } `:"";return`${e.value}${t}`}function fA(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,da(t.queryParams,n.queryParams)||e.queryParamsSubject.next(n.queryParams),t.fragment!==n.fragment&&e.fragmentSubject.next(n.fragment),da(t.params,n.params)||e.paramsSubject.next(n.params),function ibe(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!da(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.urlSubject.next(n.url),da(t.data,n.data)||e.dataSubject.next(n.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function mA(e,t){const n=da(e.params,t.params)&&function abe(e,t){return cd(e,t)&&e.every((n,i)=>da(n.parameters,t[i].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||mA(e.parent,t.parent))}function j5(e){return"string"==typeof e.title||null===e.title}let gA=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=at,this.activateEvents=new Wt,this.deactivateEvents=new Wt,this.attachEvents=new Wt,this.detachEvents=new Wt,this.parentContexts=J(Ym),this.location=J(Vo),this.changeDetector=J(Ts),this.environmentInjector=J(Hr),this.inputBinder=J(Ub,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){const{firstChange:i,previousValue:r}=n.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new W(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new W(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new W(4012,!1);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,i){this.activated=n,this._activatedRoute=i,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,i){if(this.isActivated)throw new W(4013,!1);this._activatedRoute=n;const r=this.location,s=n.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,c=new _A(n,a,r.injector);this.activated=r.createComponent(s,{index:r.length,injector:c,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275dir=ye({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Gr]})}}return e})();class _A{__ngOutletInjector(t){return new _A(this.route,this.childContexts,t)}constructor(t,n,i){this.route=t,this.childContexts=n,this.parent=i}get(t,n){return t===ld?this.route:t===Ym?this.childContexts:this.parent.get(t,n)}}const Ub=new re("");let H5=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(n){this.unsubscribeFromRouteData(n),this.subscribeToRouteData(n)}unsubscribeFromRouteData(n){this.outletDataSubscriptions.get(n)?.unsubscribe(),this.outletDataSubscriptions.delete(n)}subscribeToRouteData(n){const{activatedRoute:i}=n,r=ib([i.queryParams,i.params,i.data]).pipe(Ds(([o,s,a],c)=>(a={...o,...s,...a},0===c?Be(a):Promise.resolve(a)))).subscribe(o=>{if(!n.isActivated||!n.activatedComponentRef||n.activatedRoute!==i||null===i.component)return void this.unsubscribeFromRouteData(n);const s=function rde(e){const t=mt(e);if(!t)return null;const n=new Vf(t);return{get selector(){return n.selector},get type(){return n.componentType},get inputs(){return n.inputs},get outputs(){return n.outputs},get ngContentSelectors(){return n.ngContentSelectors},get isStandalone(){return t.standalone},get isSignal(){return t.signals}}}(i.component);if(s)for(const{templateName:a}of s.inputs)n.activatedComponentRef.setInput(a,o[a]);else this.unsubscribeFromRouteData(n)});this.outletDataSubscriptions.set(n,r)}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac})}}return e})();function $m(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const i=n.value;i._futureSnapshot=t.value;const r=function Hbe(e,t,n){return t.children.map(i=>{for(const r of n.children)if(e.shouldReuseRoute(i.value,r.value.snapshot))return $m(e,i,r);return $m(e,i)})}(e,t,n);return new Os(i,r)}{if(e.shouldAttach(t.value)){const o=e.retrieve(t.value);if(null!==o){const s=o.route;return s.value._futureSnapshot=t.value,s.children=t.children.map(a=>$m(e,a)),s}}const i=function Gbe(e){return new ld(new Sr(e.url),new Sr(e.params),new Sr(e.queryParams),new Sr(e.fragment),new Sr(e.data),e.outlet,e.component,e)}(t.value),r=t.children.map(o=>$m(e,o));return new Os(i,r)}}const G5="ngNavigationCancelingError";function W5(e,t){const{redirectTo:n,navigationBehaviorOptions:i}=hh(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=z5(!1,bo.Redirect);return r.url=n,r.navigationBehaviorOptions=i,r}function z5(e,t){const n=new Error(`NavigationCancelingError: ${e||""}`);return n[G5]=!0,n.cancellationCode=t,n}function K5(e){return!!e&&e[G5]}let q5=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=sr({type:e,selectors:[["ng-component"]],standalone:!0,features:[Lc],decls:1,vars:0,template:function(i,r){1&i&&pt(0,"router-outlet")},dependencies:[gA],encapsulation:2})}}return e})();function vA(e){const t=e.children&&e.children.map(vA),n=t?{...e,children:t}:{...e};return!n.component&&!n.loadComponent&&(t||n.loadChildren)&&n.outlet&&n.outlet!==at&&(n.component=q5),n}function ha(e){return e.outlet||at}function Xm(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}class Zbe{constructor(t,n,i,r,o){this.routeReuseStrategy=t,this.futureState=n,this.currState=i,this.forwardEvent=r,this.inputBindingEnabled=o}activate(t){const n=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,i,t),fA(this.futureState.root),this.activateChildRoutes(n,i,t)}deactivateChildRoutes(t,n,i){const r=mh(n);t.children.forEach(o=>{const s=o.value.outlet;this.deactivateRoutes(o,r[s],i),delete r[s]}),Object.values(r).forEach(o=>{this.deactivateRouteAndItsChildren(o,i)})}deactivateRoutes(t,n,i){const r=t.value,o=n?n.value:null;if(r===o)if(r.component){const s=i.getContext(r.outlet);s&&this.deactivateChildRoutes(t,n,s.children)}else this.deactivateChildRoutes(t,n,i);else o&&this.deactivateRouteAndItsChildren(n,i)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const i=n.getContext(t.value.outlet),r=i&&t.value.component?i.children:n,o=mh(t);for(const s of Object.values(o))this.deactivateRouteAndItsChildren(s,r);if(i&&i.outlet){const s=i.outlet.detach(),a=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:s,route:t,contexts:a})}}deactivateRouteAndOutlet(t,n){const i=n.getContext(t.value.outlet),r=i&&t.value.component?i.children:n,o=mh(t);for(const s of Object.values(o))this.deactivateRouteAndItsChildren(s,r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(t,n,i){const r=mh(n);t.children.forEach(o=>{this.activateRoutes(o,r[o.value.outlet],i),this.forwardEvent(new Ube(o.value.snapshot))}),t.children.length&&this.forwardEvent(new Lbe(t.value.snapshot))}activateRoutes(t,n,i){const r=t.value,o=n?n.value:null;if(fA(r),r===o)if(r.component){const s=i.getOrCreateContext(r.outlet);this.activateChildRoutes(t,n,s.children)}else this.activateChildRoutes(t,n,i);else if(r.component){const s=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),fA(a.route.value),this.activateChildRoutes(t,null,s.children)}else{const a=Xm(r.snapshot);s.attachRef=null,s.route=r,s.injector=a,s.outlet&&s.outlet.activateWith(r,s.injector),this.activateChildRoutes(t,null,s.children)}}else this.activateChildRoutes(t,null,i)}}class Y5{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Vb{constructor(t,n){this.component=t,this.route=n}}function Jbe(e,t,n){const i=e._root;return Zm(i,t?t._root:null,n,[i.value])}function gh(e,t){const n=Symbol(),i=t.get(e,n);return i===n?"function"!=typeof e||function KJ(e){return null!==L_(e)}(e)?t.get(e):e:i}function Zm(e,t,n,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const o=mh(t);return e.children.forEach(s=>{(function eye(e,t,n,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const o=e.value,s=t?t.value:null,a=n?n.getContext(e.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){const c=function tye(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!cd(e.url,t.url);case"pathParamsOrQueryParamsChange":return!cd(e.url,t.url)||!da(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!mA(e,t)||!da(e.queryParams,t.queryParams);default:return!mA(e,t)}}(s,o,o.routeConfig.runGuardsAndResolvers);c?r.canActivateChecks.push(new Y5(i)):(o.data=s.data,o._resolvedData=s._resolvedData),Zm(e,t,o.component?a?a.children:null:n,i,r),c&&a&&a.outlet&&a.outlet.isActivated&&r.canDeactivateChecks.push(new Vb(a.outlet.component,s))}else s&&Jm(t,a,r),r.canActivateChecks.push(new Y5(i)),Zm(e,null,o.component?a?a.children:null:n,i,r)})(s,o[s.value.outlet],n,i.concat([s.value]),r),delete o[s.value.outlet]}),Object.entries(o).forEach(([s,a])=>Jm(a,n.getContext(s),r)),r}function Jm(e,t,n){const i=mh(e),r=e.value;Object.entries(i).forEach(([o,s])=>{Jm(s,r.component?t?t.children.getContext(o):null:t,n)}),n.canDeactivateChecks.push(new Vb(r.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,r))}function Qm(e){return"function"==typeof e}function $5(e){return e instanceof Ib||"EmptyError"===e?.name}const Bb=Symbol("INITIAL_VALUE");function _h(){return Ds(e=>ib(e.map(t=>t.pipe(Ti(1),Tj(Bb)))).pipe(Nt(t=>{for(const n of t)if(!0!==n){if(n===Bb)return Bb;if(!1===n||n instanceof dh)return n}return!0}),$r(t=>t!==Bb),Ti(1)))}function X5(e){return function LJ(...e){return y1(e)}(Wi(t=>{if(hh(t))throw W5(0,t)}),Nt(t=>!0===t))}class EA{constructor(t){this.segmentGroup=t||null}}class bA extends Error{constructor(t){super(),this.urlTree=t}}function vh(e){return Rb(new EA(e))}class bye{constructor(t,n){this.urlSerializer=t,this.urlTree=n}lineralizeSegments(t,n){let i=[],r=n.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return Be(i);if(r.numberOfChildren>1||!r.children[at])return Rb(new W(4e3,!1));r=r.children[at]}}applyRedirectCommands(t,n,i){const r=this.applyRedirectCreateUrlTree(n,this.urlSerializer.parse(n),t,i);if(n.startsWith("/"))throw new bA(r);return r}applyRedirectCreateUrlTree(t,n,i,r){const o=this.createSegmentGroup(t,n.root,i,r);return new dh(o,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const i={};return Object.entries(t).forEach(([r,o])=>{if("string"==typeof o&&o.startsWith(":")){const a=o.substring(1);i[r]=n[a]}else i[r]=o}),i}createSegmentGroup(t,n,i,r){const o=this.createSegments(t,n.segments,i,r);let s={};return Object.entries(n.children).forEach(([a,c])=>{s[a]=this.createSegmentGroup(t,c,i,r)}),new gn(o,s)}createSegments(t,n,i,r){return n.map(o=>o.path.startsWith(":")?this.findPosParam(t,o,r):this.findOrReturn(o,i))}findPosParam(t,n,i){const r=i[n.path.substring(1)];if(!r)throw new W(4001,!1);return r}findOrReturn(t,n){let i=0;for(const r of n){if(r.path===t.path)return n.splice(i),r;i++}return t}}const yA={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function yye(e,t,n,i,r){const o=SA(e,t,n);return o.matched?(i=function zbe(e,t){return e.providers&&!e._injector&&(e._injector=$v(e.providers,t,`Route: ${e.path}`)),e._injector??t}(t,i),function _ye(e,t,n,i){const r=t.canMatch;return r&&0!==r.length?Be(r.map(s=>{const a=gh(s,e);return zc(function aye(e){return e&&Qm(e.canMatch)}(a)?a.canMatch(t,n):ja(e,()=>a(t,n)))})).pipe(_h(),X5()):Be(!0)}(i,t,n).pipe(Nt(s=>!0===s?o:{...yA}))):Be(o)}function SA(e,t,n){if("**"===t.path)return function Sye(e){return{matched:!0,parameters:e.length>0?g5(e).parameters:{},consumedSegments:e,remainingSegments:[],positionalParamSegments:{}}}(n);if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{...yA}:{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const r=(t.matcher||nbe)(n,e,t);if(!r)return{...yA};const o={};Object.entries(r.posParams??{}).forEach(([a,c])=>{o[a]=c.path});const s=r.consumed.length>0?{...o,...r.consumed[r.consumed.length-1].parameters}:o;return{matched:!0,consumedSegments:r.consumed,remainingSegments:n.slice(r.consumed.length),parameters:s,positionalParamSegments:r.posParams??{}}}function Z5(e,t,n,i){return n.length>0&&function wye(e,t,n){return n.some(i=>jb(e,t,i)&&ha(i)!==at)}(e,n,i)?{segmentGroup:new gn(t,Tye(i,new gn(n,e.children))),slicedSegments:[]}:0===n.length&&function Iye(e,t,n){return n.some(i=>jb(e,t,i))}(e,n,i)?{segmentGroup:new gn(e.segments,Cye(e,n,i,e.children)),slicedSegments:n}:{segmentGroup:new gn(e.segments,e.children),slicedSegments:n}}function Cye(e,t,n,i){const r={};for(const o of n)if(jb(e,t,o)&&!i[ha(o)]){const s=new gn([],{});r[ha(o)]=s}return{...i,...r}}function Tye(e,t){const n={};n[at]=t;for(const i of e)if(""===i.path&&ha(i)!==at){const r=new gn([],{});n[ha(i)]=r}return n}function jb(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}class Dye{}class Pye{constructor(t,n,i,r,o,s,a){this.injector=t,this.configLoader=n,this.rootComponentType=i,this.config=r,this.urlTree=o,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new bye(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(t){return new W(4002,`'${t.segmentGroup}'`)}recognize(){const t=Z5(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(t).pipe(Nt(n=>{const i=new hA([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},at,this.rootComponentType,null,{}),r=new Os(i,n),o=new V5("",r),s=function Sbe(e,t,n=null,i=null){return A5(R5(e),t,n,i)}(i,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,o.url=this.urlSerializer.serialize(s),this.inheritParamsAndData(o._root,null),{state:o,tree:s}}))}match(t){return this.processSegmentGroup(this.injector,this.config,t,at).pipe(ch(i=>{if(i instanceof bA)return this.urlTree=i.urlTree,this.match(i.urlTree.root);throw i instanceof EA?this.noMatchError(i):i}))}inheritParamsAndData(t,n){const i=t.value,r=uA(i,n,this.paramsInheritanceStrategy);i.params=Object.freeze(r.params),i.data=Object.freeze(r.data),t.children.forEach(o=>this.inheritParamsAndData(o,i))}processSegmentGroup(t,n,i,r){return 0===i.segments.length&&i.hasChildren()?this.processChildren(t,n,i):this.processSegment(t,n,i,i.segments,r,!0).pipe(Nt(o=>o instanceof Os?[o]:[]))}processChildren(t,n,i){const r=[];for(const o of Object.keys(i.children))"primary"===o?r.unshift(o):r.push(o);return xi(r).pipe(jm(o=>{const s=i.children[o],a=function $be(e,t){const n=e.filter(i=>ha(i)===t);return n.push(...e.filter(i=>ha(i)!==t)),n}(n,o);return this.processSegmentGroup(t,a,s,o)}),function QEe(e,t){return Jn(function JEe(e,t,n,i,r){return(o,s)=>{let a=n,c=t,l=0;o.subscribe(Un(s,d=>{const u=l++;c=a?e(c,d,u):(a=!0,d),i&&s.next(c)},r&&(()=>{a&&s.next(c),s.complete()})))}}(e,t,arguments.length>=2,!0))}((o,s)=>(o.push(...s),o)),Ab(null),function ebe(e,t){const n=arguments.length>=2;return i=>i.pipe(e?$r((r,o)=>e(r,o,i)):Sc,QR(1),n?Ab(t):p5(()=>new Ib))}(),zi(o=>{if(null===o)return vh(i);const s=J5(o);return function Mye(e){e.sort((t,n)=>t.value.outlet===at?-1:n.value.outlet===at?1:t.value.outlet.localeCompare(n.value.outlet))}(s),Be(s)}))}processSegment(t,n,i,r,o,s){return xi(n).pipe(jm(a=>this.processSegmentAgainstRoute(a._injector??t,n,a,i,r,o,s).pipe(ch(c=>{if(c instanceof EA)return Be(null);throw c}))),ad(a=>!!a),ch(a=>{if($5(a))return function Aye(e,t,n){return 0===t.length&&!e.children[n]}(i,r,o)?Be(new Dye):vh(i);throw a}))}processSegmentAgainstRoute(t,n,i,r,o,s,a){return function Rye(e,t,n,i){return!!(ha(e)===i||i!==at&&jb(t,n,e))&&SA(t,e,n).matched}(i,r,o,s)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(t,r,i,o,s):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(t,r,n,i,o,s):vh(r):vh(r)}expandSegmentAgainstRouteUsingRedirect(t,n,i,r,o,s){const{matched:a,consumedSegments:c,positionalParamSegments:l,remainingSegments:d}=SA(n,r,o);if(!a)return vh(n);r.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const u=this.applyRedirects.applyRedirectCommands(c,r.redirectTo,l);return this.applyRedirects.lineralizeSegments(r,u).pipe(zi(h=>this.processSegment(t,i,n,h.concat(d),s,!1)))}matchSegmentAgainstRoute(t,n,i,r,o){const s=yye(n,i,r,t);return"**"===i.path&&(n.children={}),s.pipe(Ds(a=>a.matched?this.getChildConfig(t=i._injector??t,i,r).pipe(Ds(({routes:c})=>{const l=i._loadedInjector??t,{consumedSegments:d,remainingSegments:u,parameters:h}=a,p=new hA(d,h,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,function kye(e){return e.data||{}}(i),ha(i),i.component??i._loadedComponent??null,i,function Lye(e){return e.resolve||{}}(i)),{segmentGroup:m,slicedSegments:f}=Z5(n,d,u,c);if(0===f.length&&m.hasChildren())return this.processChildren(l,c,m).pipe(Nt(E=>null===E?null:new Os(p,E)));if(0===c.length&&0===f.length)return Be(new Os(p,[]));const g=ha(i)===o;return this.processSegment(l,c,m,f,g?at:o,!0).pipe(Nt(E=>new Os(p,E instanceof Os?[E]:[])))})):vh(n)))}getChildConfig(t,n,i){return n.children?Be({routes:n.children,injector:t}):n.loadChildren?void 0!==n._loadedRoutes?Be({routes:n._loadedRoutes,injector:n._loadedInjector}):function gye(e,t,n,i){const r=t.canLoad;return void 0===r||0===r.length?Be(!0):Be(r.map(s=>{const a=gh(s,e);return zc(function iye(e){return e&&Qm(e.canLoad)}(a)?a.canLoad(t,n):ja(e,()=>a(t,n)))})).pipe(_h(),X5())}(t,n,i).pipe(zi(r=>r?this.configLoader.loadChildren(t,n).pipe(Wi(o=>{n._loadedRoutes=o.routes,n._loadedInjector=o.injector})):function Eye(e){return Rb(z5(!1,bo.GuardRejected))}())):Be({routes:[],injector:t})}}function xye(e){const t=e.value.routeConfig;return t&&""===t.path}function J5(e){const t=[],n=new Set;for(const i of e){if(!xye(i)){t.push(i);continue}const r=t.find(o=>i.value.routeConfig===o.value.routeConfig);void 0!==r?(r.children.push(...i.children),n.add(r)):t.push(i)}for(const i of n){const r=J5(i.children);t.push(new Os(i.value,r))}return t.filter(i=>!n.has(i))}function Q5(e){const t=e.children.map(n=>Q5(n)).flat();return[e,...t]}function CA(e){return Ds(t=>{const n=e(t);return n?xi(n).pipe(Nt(()=>t)):Be(t)})}let eH=(()=>{class e{buildTitle(n){let i,r=n.root;for(;void 0!==r;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(o=>o.outlet===at);return i}getResolvedTitleForRoute(n){return n.data[Hm]}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:()=>J(Hye),providedIn:"root"})}}return e})(),Hye=(()=>{class e extends eH{constructor(n){super(),this.title=n}updateTitle(n){const i=this.buildTitle(n);void 0!==i&&this.title.setTitle(i)}static{this.\u0275fac=function(i){return new(i||e)(Z(Dhe))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const Eh=new re("",{providedIn:"root",factory:()=>({})}),bh=new re("");let TA=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=J(lV)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Be(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const i=zc(n.loadComponent()).pipe(Nt(tH),Wi(o=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=o}),eA(()=>{this.componentLoaders.delete(n)})),r=new h5(i,()=>new vt).pipe(JR());return this.componentLoaders.set(n,r),r}loadChildren(n,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return Be({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const o=function Gye(e,t,n,i){return zc(e.loadChildren()).pipe(Nt(tH),zi(r=>r instanceof T2||Array.isArray(r)?Be(r):xi(t.compileModuleAsync(r))),Nt(r=>{i&&i(e);let o,s,a=!1;return Array.isArray(r)?(s=r,!0):(o=r.create(n).injector,s=o.get(bh,[],{optional:!0,self:!0}).flat()),{routes:s.map(vA),injector:o}}))}(i,this.compiler,n,this.onLoadEndListener).pipe(eA(()=>{this.childrenLoaders.delete(i)})),s=new h5(o,()=>new vt).pipe(JR());return this.childrenLoaders.set(i,s),s}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function tH(e){return function Wye(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let wA=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:()=>J(zye),providedIn:"root"})}}return e})(),zye=(()=>{class e{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,i){return n}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const nH=new re(""),iH=new re("");function Kye(e,t,n){const i=e.get(iH),r=e.get(Ut);return e.get(Le).runOutsideAngular(()=>{if(!r.startViewTransition||i.skipNextTransition)return i.skipNextTransition=!1,new Promise(l=>setTimeout(l));let o;const s=new Promise(l=>{o=l}),a=r.startViewTransition(()=>(o(),function qye(e){return new Promise(t=>{K0(t,{injector:e})})}(e))),{onViewTransitionCreated:c}=i;return c&&ja(e,()=>c({transition:a,from:t,to:n})),s})}let Hb=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new vt,this.transitionAbortSubject=new vt,this.configLoader=J(TA),this.environmentInjector=J(Hr),this.urlSerializer=J(uh),this.rootContexts=J(Ym),this.location=J(Zu),this.inputBindingEnabled=null!==J(Ub,{optional:!0}),this.titleStrategy=J(eH),this.options=J(Eh,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=J(wA),this.createViewTransition=J(nH,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Be(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=r=>this.events.next(new xbe(r)),this.configLoader.onLoadStartListener=r=>this.events.next(new Mbe(r))}complete(){this.transitions?.complete()}handleNavigationRequest(n){const i=++this.navigationId;this.transitions?.next({...this.transitions.value,...n,id:i})}setupNavigations(n,i,r){return this.transitions=new Sr({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:qm,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe($r(o=>0!==o.id),Nt(o=>({...o,extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),Ds(o=>{let s=!1,a=!1;return Be(o).pipe(Ds(c=>{if(this.navigationId>o.id)return this.cancelNavigationTransition(o,"",bo.SupersededByNewNavigation),Go;this.currentTransition=o,this.currentNavigation={id:c.id,initialUrl:c.rawUrl,extractedUrl:c.extractedUrl,trigger:c.source,extras:c.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null};const l=!n.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!l&&"reload"!==(c.extras.onSameUrlNavigation??n.onSameUrlNavigation)){const u="";return this.events.next(new fh(c.id,this.urlSerializer.serialize(c.rawUrl),u,Lb.IgnoredSameUrlNavigation)),c.resolve(null),Go}if(this.urlHandlingStrategy.shouldProcessUrl(c.rawUrl))return Be(c).pipe(Ds(u=>{const h=this.transitions?.getValue();return this.events.next(new kb(u.id,this.urlSerializer.serialize(u.extractedUrl),u.source,u.restoredState)),h!==this.transitions?.getValue()?Go:Promise.resolve(u)}),function Fye(e,t,n,i,r,o){return zi(s=>function Oye(e,t,n,i,r,o,s="emptyOnly"){return new Pye(e,t,n,i,r,s,o).recognize()}(e,t,n,i,s.extractedUrl,r,o).pipe(Nt(({state:a,tree:c})=>({...s,targetSnapshot:a,urlAfterRedirects:c}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,this.paramsInheritanceStrategy),Wi(u=>{o.targetSnapshot=u.targetSnapshot,o.urlAfterRedirects=u.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:u.urlAfterRedirects};const h=new x5(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(h)}));if(l&&this.urlHandlingStrategy.shouldProcessUrl(c.currentRawUrl)){const{id:u,extractedUrl:h,source:p,restoredState:m,extras:f}=c,g=new kb(u,this.urlSerializer.serialize(h),p,m);this.events.next(g);const E=U5(this.rootComponentType).snapshot;return this.currentTransition=o={...c,targetSnapshot:E,urlAfterRedirects:h,extras:{...f,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=h,Be(o)}{const u="";return this.events.next(new fh(c.id,this.urlSerializer.serialize(c.extractedUrl),u,Lb.IgnoredByUrlHandlingStrategy)),c.resolve(null),Go}}),Wi(c=>{const l=new Dbe(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}),Nt(c=>(this.currentTransition=o={...c,guards:Jbe(c.targetSnapshot,c.currentSnapshot,this.rootContexts)},o)),function cye(e,t){return zi(n=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:o,canDeactivateChecks:s}}=n;return 0===s.length&&0===o.length?Be({...n,guardsResult:!0}):function lye(e,t,n,i){return xi(e).pipe(zi(r=>function mye(e,t,n,i,r){const o=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return o&&0!==o.length?Be(o.map(a=>{const c=Xm(t)??r,l=gh(a,c);return zc(function sye(e){return e&&Qm(e.canDeactivate)}(l)?l.canDeactivate(e,t,n,i):ja(c,()=>l(e,t,n,i))).pipe(ad())})).pipe(_h()):Be(!0)}(r.component,r.route,n,t,i)),ad(r=>!0!==r,!0))}(s,i,r,e).pipe(zi(a=>a&&function nye(e){return"boolean"==typeof e}(a)?function dye(e,t,n,i){return xi(t).pipe(jm(r=>Dm(function hye(e,t){return null!==e&&t&&t(new kbe(e)),Be(!0)}(r.route.parent,i),function uye(e,t){return null!==e&&t&&t(new Fbe(e)),Be(!0)}(r.route,i),function fye(e,t,n){const i=t[t.length-1],o=t.slice(0,t.length-1).reverse().map(s=>function Qbe(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(s)).filter(s=>null!==s).map(s=>u5(()=>Be(s.guards.map(c=>{const l=Xm(s.node)??n,d=gh(c,l);return zc(function oye(e){return e&&Qm(e.canActivateChild)}(d)?d.canActivateChild(i,e):ja(l,()=>d(i,e))).pipe(ad())})).pipe(_h())));return Be(o).pipe(_h())}(e,r.path,n),function pye(e,t,n){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return Be(!0);const r=i.map(o=>u5(()=>{const s=Xm(t)??n,a=gh(o,s);return zc(function rye(e){return e&&Qm(e.canActivate)}(a)?a.canActivate(t,e):ja(s,()=>a(t,e))).pipe(ad())}));return Be(r).pipe(_h())}(e,r.route,n))),ad(r=>!0!==r,!0))}(i,o,e,t):Be(a)),Nt(a=>({...n,guardsResult:a})))})}(this.environmentInjector,c=>this.events.next(c)),Wi(c=>{if(o.guardsResult=c.guardsResult,hh(c.guardsResult))throw W5(0,c.guardsResult);const l=new Obe(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot,!!c.guardsResult);this.events.next(l)}),$r(c=>!!c.guardsResult||(this.cancelNavigationTransition(c,"",bo.GuardRejected),!1)),CA(c=>{if(c.guards.canActivateChecks.length)return Be(c).pipe(Wi(l=>{const d=new Nbe(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(d)}),Ds(l=>{let d=!1;return Be(l).pipe(function Uye(e,t){return zi(n=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=n;if(!r.length)return Be(n);const o=new Set(r.map(c=>c.route)),s=new Set;for(const c of o)if(!s.has(c))for(const l of Q5(c))s.add(l);let a=0;return xi(s).pipe(jm(c=>o.has(c)?function Vye(e,t,n,i){const r=e.routeConfig,o=e._resolve;return void 0!==r?.title&&!j5(r)&&(o[Hm]=r.title),function Bye(e,t,n,i){const r=tA(e);if(0===r.length)return Be({});const o={};return xi(r).pipe(zi(s=>function jye(e,t,n,i){const r=Xm(t)??i,o=gh(e,r);return zc(o.resolve?o.resolve(t,n):ja(r,()=>o(t,n)))}(e[s],t,n,i).pipe(ad(),Wi(a=>{o[s]=a}))),QR(1),f5(o),ch(s=>$5(s)?Go:Rb(s)))}(o,e,t,i).pipe(Nt(s=>(e._resolvedData=s,e.data=uA(e,e.parent,n).resolve,null)))}(c,i,e,t):(c.data=uA(c,c.parent,e).resolve,Be(void 0))),Wi(()=>a++),QR(1),zi(c=>a===s.size?Be(n):Go))})}(this.paramsInheritanceStrategy,this.environmentInjector),Wi({next:()=>d=!0,complete:()=>{d||this.cancelNavigationTransition(l,"",bo.NoDataFromResolver)}}))}),Wi(l=>{const d=new Pbe(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(d)}))}),CA(c=>{const l=d=>{const u=[];d.routeConfig?.loadComponent&&!d.routeConfig._loadedComponent&&u.push(this.configLoader.loadComponent(d.routeConfig).pipe(Wi(h=>{d.component=h}),Nt(()=>{})));for(const h of d.children)u.push(...l(h));return u};return ib(l(c.targetSnapshot.root)).pipe(Ab(null),Ti(1))}),CA(()=>this.afterPreactivation()),Ds(()=>{const{currentSnapshot:c,targetSnapshot:l}=o,d=this.createViewTransition?.(this.environmentInjector,c.root,l.root);return d?xi(d).pipe(Nt(()=>o)):Be(o)}),Nt(c=>{const l=function jbe(e,t,n){const i=$m(e,t._root,n?n._root:void 0);return new F5(i,t)}(n.routeReuseStrategy,c.targetSnapshot,c.currentRouterState);return this.currentTransition=o={...c,targetRouterState:l},this.currentNavigation.targetRouterState=l,o}),Wi(()=>{this.events.next(new aA)}),((e,t,n,i)=>Nt(r=>(new Zbe(t,r.targetRouterState,r.currentRouterState,n,i).activate(e),r)))(this.rootContexts,n.routeReuseStrategy,c=>this.events.next(c),this.inputBindingEnabled),Ti(1),Wi({next:c=>{s=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new rc(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects))),this.titleStrategy?.updateTitle(c.targetRouterState.snapshot),c.resolve(!0)},complete:()=>{s=!0}}),gr(this.transitionAbortSubject.pipe(Wi(c=>{throw c}))),eA(()=>{!s&&!a&&this.cancelNavigationTransition(o,"",bo.SupersededByNewNavigation),this.currentTransition?.id===o.id&&(this.currentNavigation=null,this.currentTransition=null)}),ch(c=>{if(a=!0,K5(c))this.events.next(new ph(o.id,this.urlSerializer.serialize(o.extractedUrl),c.message,c.cancellationCode)),function Wbe(e){return K5(e)&&hh(e.url)}(c)?this.events.next(new cA(c.url)):o.resolve(!1);else{this.events.next(new Fb(o.id,this.urlSerializer.serialize(o.extractedUrl),c,o.targetSnapshot??void 0));try{o.resolve(n.errorHandler(c))}catch(l){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(l)}}return Go}))}))}cancelNavigationTransition(n,i,r){const o=new ph(n.id,this.urlSerializer.serialize(n.extractedUrl),i,r);this.events.next(o),n.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Yye(e){return e!==qm}let $ye=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:()=>J(Zye),providedIn:"root"})}}return e})();class Xye{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}let Zye=(()=>{class e extends Xye{static{this.\u0275fac=(()=>{let n;return function(r){return(n||(n=bi(e)))(r||e)}})()}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),rH=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:()=>J(Jye),providedIn:"root"})}}return e})(),Jye=(()=>{class e extends rH{constructor(){super(...arguments),this.location=J(Zu),this.urlSerializer=J(uh),this.options=J(Eh,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=J(wA),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new dh,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=U5(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(n){return this.location.subscribe(i=>{"popstate"===i.type&&n(i.url,i.state)})}handleRouterEvent(n,i){if(n instanceof kb)this.stateMemento=this.createStateMemento();else if(n instanceof fh)this.rawUrlTree=i.initialUrl;else if(n instanceof x5){if("eager"===this.urlUpdateStrategy&&!i.extras.skipLocationChange){const r=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(r,i)}}else n instanceof aA?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,"deferred"===this.urlUpdateStrategy&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):n instanceof ph&&(n.code===bo.GuardRejected||n.code===bo.NoDataFromResolver)?this.restoreHistory(i):n instanceof Fb?this.restoreHistory(i,!0):n instanceof rc&&(this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId)}setBrowserUrl(n,i){const r=this.urlSerializer.serialize(n);if(this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl){const s={...i.extras.state,...this.generateNgRouterState(i.id,this.browserPageId)};this.location.replaceState(r,"",s)}else{const o={...i.extras.state,...this.generateNgRouterState(i.id,this.browserPageId+1)};this.location.go(r,"",o)}}restoreHistory(n,i=!1){if("computed"===this.canceledNavigationResolution){const o=this.currentPageId-this.browserPageId;0!==o?this.location.historyGo(o):this.currentUrlTree===n.finalUrl&&0===o&&(this.resetState(n),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,i){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:i}:{navigationId:n}}static{this.\u0275fac=(()=>{let n;return function(r){return(n||(n=bi(e)))(r||e)}})()}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var eg=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(eg||{});function oH(e,t){e.events.pipe($r(n=>n instanceof rc||n instanceof ph||n instanceof Fb||n instanceof fh),Nt(n=>n instanceof rc||n instanceof fh?eg.COMPLETE:n instanceof ph&&(n.code===bo.Redirect||n.code===bo.SupersededByNewNavigation)?eg.REDIRECTING:eg.FAILED),$r(n=>n!==eg.REDIRECTING),Ti(1)).subscribe(()=>{t()})}function Qye(e){throw e}const eSe={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},tSe={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let yo=(()=>{class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=J(QU),this.stateManager=J(rH),this.options=J(Eh,{optional:!0})||{},this.pendingTasks=J(Au),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=J(Hb),this.urlSerializer=J(uh),this.location=J(Zu),this.urlHandlingStrategy=J(wA),this._events=new vt,this.errorHandler=this.options.errorHandler||Qye,this.navigated=!1,this.routeReuseStrategy=J($ye),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=J(bh,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!J(Ub,{optional:!0}),this.eventsSubscription=new li,this.isNgZoneEnabled=J(Le)instanceof Le&&Le.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:n=>{this.console.warn(n)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const n=this.navigationTransitions.events.subscribe(i=>{try{const r=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(null!==r&&null!==o)if(this.stateManager.handleRouterEvent(i,o),i instanceof ph&&i.code!==bo.Redirect&&i.code!==bo.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof rc)this.navigated=!0;else if(i instanceof cA){const s=this.urlHandlingStrategy.merge(i.url,r.currentRawUrl),a={info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Yye(r.source)};this.scheduleNavigation(s,qm,null,a,{resolve:r.resolve,reject:r.reject,promise:r.promise})}(function iSe(e){return!(e instanceof aA||e instanceof cA)})(i)&&this._events.next(i)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(n)}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),qm,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((n,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(n,"popstate",i)},0)})}navigateToSyncWithBrowser(n,i,r){const o={replaceUrl:!0},s=r?.navigationId?r:null;if(r){const c={...r};delete c.navigationId,delete c.\u0275routerPageId,0!==Object.keys(c).length&&(o.state=c)}const a=this.parseUrl(n);this.scheduleNavigation(a,i,s,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(vA),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(n,i={}){const{relativeTo:r,queryParams:o,fragment:s,queryParamsHandling:a,preserveFragment:c}=i,l=c?this.currentUrlTree.fragment:s;let u,d=null;switch(a){case"merge":d={...this.currentUrlTree.queryParams,...o};break;case"preserve":d=this.currentUrlTree.queryParams;break;default:d=o||null}null!==d&&(d=this.removeEmptyProps(d));try{u=R5(r?r.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof n[0]||!n[0].startsWith("/"))&&(n=[]),u=this.currentUrlTree.root}return A5(u,n,d,l??null)}navigateByUrl(n,i={skipLocationChange:!1}){const r=hh(n)?n:this.parseUrl(n),o=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(o,qm,null,i)}navigate(n,i={skipLocationChange:!1}){return function nSe(e){for(let t=0;t<e.length;t++)if(null==e[t])throw new W(4008,!1)}(n),this.navigateByUrl(this.createUrlTree(n,i),i)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){try{return this.urlSerializer.parse(n)}catch{return this.urlSerializer.parse("/")}}isActive(n,i){let r;if(r=!0===i?{...eSe}:!1===i?{...tSe}:i,hh(n))return v5(this.currentUrlTree,n,r);const o=this.parseUrl(n);return v5(this.currentUrlTree,o,r)}removeEmptyProps(n){return Object.entries(n).reduce((i,[r,o])=>(null!=o&&(i[r]=o),i),{})}scheduleNavigation(n,i,r,o,s){if(this.disposed)return Promise.resolve(!1);let a,c,l;s?(a=s.resolve,c=s.reject,l=s.promise):l=new Promise((u,h)=>{a=u,c=h});const d=this.pendingTasks.add();return oH(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(d))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:o,resolve:a,reject:c,promise:l,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),l.catch(u=>Promise.reject(u))}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();class sH{}let sSe=(()=>{class e{constructor(n,i,r,o,s){this.router=n,this.injector=r,this.preloadingStrategy=o,this.loader=s}setUpPreloading(){this.subscription=this.router.events.pipe($r(n=>n instanceof rc),jm(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,i){const r=[];for(const o of i){o.providers&&!o._injector&&(o._injector=$v(o.providers,n,`Route: ${o.path}`));const s=o._injector??n,a=o._loadedInjector??s;(o.loadChildren&&!o._loadedRoutes&&void 0===o.canLoad||o.loadComponent&&!o._loadedComponent)&&r.push(this.preloadConfig(s,o)),(o.children||o._loadedRoutes)&&r.push(this.processRoutes(a,o.children??o._loadedRoutes))}return xi(r).pipe(rh())}preloadConfig(n,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(n,i):Be(null);const o=r.pipe(zi(s=>null===s?Be(void 0):(i._loadedRoutes=s.routes,i._loadedInjector=s.injector,this.processRoutes(s.injector??n,s.routes))));return i.loadComponent&&!i._loadedComponent?xi([o,this.loader.loadComponent(i)]).pipe(rh()):o})}static{this.\u0275fac=function(i){return new(i||e)(Z(yo),Z(lV),Z(Hr),Z(sH),Z(TA))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const RA=new re("");let aH=(()=>{class e{constructor(n,i,r,o,s={}){this.urlSerializer=n,this.transitions=i,this.viewportScroller=r,this.zone=o,this.options=s,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},this.environmentInjector=J(Hr),s.scrollPositionRestoration||="disabled",s.anchorScrolling||="disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof kb?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof rc?(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment)):n instanceof fh&&n.code===Lb.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof k5&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,i){var r=this;this.zone.runOutsideAngular(C(function*(){yield new Promise(o=>{setTimeout(()=>{o()}),K0(()=>{o()},{injector:r.environmentInjector})}),r.zone.run(()=>{r.transitions.events.next(new k5(n,"popstate"===r.lastSource?r.store[r.restoredId]:null,i))})}))}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static{this.\u0275fac=function(i){S0()}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac})}}return e})();function pa(e,t){return{\u0275kind:e,\u0275providers:t}}function lH(){const e=J(Bi);return t=>{const n=e.get(sa);if(t!==n.components[0])return;const i=e.get(yo),r=e.get(dH);1===e.get(AA)&&i.initialNavigation(),e.get(uH,null,bt.Optional)?.setUpPreloading(),e.get(RA,null,bt.Optional)?.init(),i.resetRootComponentType(n.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}const dH=new re("",{factory:()=>new vt}),AA=new re("",{providedIn:"root",factory:()=>1}),uH=new re("");function dSe(e){return pa(0,[{provide:uH,useExisting:sSe},{provide:sH,useExisting:e}])}function hSe(e){return pa(9,[{provide:nH,useValue:Kye},{provide:iH,useValue:{skipNextTransition:!!e?.skipInitialTransition,...e}}])}const hH=new re("ROUTER_FORROOT_GUARD"),pSe=[Zu,{provide:uh,useClass:nA},yo,Ym,{provide:ld,useFactory:function cH(e){return e.routerState.root},deps:[yo]},TA,[]];let fSe=(()=>{class e{constructor(n){}static forRoot(n,i){return{ngModule:e,providers:[pSe,[],{provide:bh,multi:!0,useValue:n},{provide:hH,useFactory:vSe,deps:[[yo,new j_,new H_]]},{provide:Eh,useValue:i||{}},i?.useHash?{provide:Zl,useClass:lde}:{provide:Zl,useClass:eB},{provide:RA,useFactory:()=>{const e=J(Due),t=J(Le),n=J(Eh),i=J(Hb),r=J(uh);return n.scrollOffset&&e.setOffset(n.scrollOffset),new aH(r,i,e,t,n)}},i?.preloadingStrategy?dSe(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?ESe(i):[],i?.bindToComponentInputs?pa(8,[H5,{provide:Ub,useExisting:H5}]).\u0275providers:[],i?.enableViewTransitions?hSe().\u0275providers:[],[{provide:pH,useFactory:lH},{provide:qw,multi:!0,useExisting:pH}]]}}static forChild(n){return{ngModule:e,providers:[{provide:bh,multi:!0,useValue:n}]}}static{this.\u0275fac=function(i){return new(i||e)(Z(hH,8))}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({})}}return e})();function vSe(e){return"guarded"}function ESe(e){return["disabled"===e.initialNavigation?pa(3,[{provide:zw,multi:!0,useFactory:()=>{const t=J(yo);return()=>{t.setUpLocationChangeListener()}}},{provide:AA,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?pa(2,[{provide:AA,useValue:0},{provide:zw,multi:!0,deps:[Bi],useFactory:t=>{const n=t.get(ade,Promise.resolve());return()=>n.then(()=>new Promise(i=>{const r=t.get(yo),o=t.get(dH);oH(r,()=>{i(!0)}),t.get(Hb).afterPreactivation=()=>(i(!0),o.closed?Be(void 0):o),r.initialNavigation()}))}}]).\u0275providers:[]]}const pH=new re(""),fH_configs={AppID:"67f11adf2f054480b431c8447ff85d91"};let SSe=(()=>{class e{constructor(){this.appVersion="17.1.0"}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=sr({type:e,selectors:[["app-root"]],hostVars:1,hostBindings:function(i,r){2&i&&yi("app-version",r.appVersion)},decls:1,vars:0,template:function(i,r){1&i&&pt(0,"router-outlet")},dependencies:[gA],changeDetection:0})}}return e})();function DA(e=0,t=Am){return e<0&&(e=0),pb(e,e,t)}function mH(e,t){return t?n=>Dm(t.pipe(Ti(1),function CSe(){return Jn((e,t)=>{e.subscribe(Un(t,N_))})}()),n.pipe(mH(e))):zi((n,i)=>mr(e(n,i)).pipe(Ti(1),f5(n)))}var yh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Sn=function(e){try{return!!e()}catch{return!0}},Gb=!Sn(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}),gH=Gb,_H=Function.prototype,OA=_H.call,ISe=gH&&_H.bind.bind(OA,OA),_n=gH?ISe:function(e){return function(){return OA.apply(e,arguments)}},Ki=_n({}.isPrototypeOf),Wb=function(e){return e&&e.Math==Math&&e},Pn=Wb("object"==typeof globalThis&&globalThis)||Wb("object"==typeof window&&window)||Wb("object"==typeof self&&self)||Wb("object"==typeof yh&&yh)||function(){return this}()||yh||Function("return this")(),vH=Function.prototype,EH=vH.apply,bH=vH.call,zb="object"==typeof Reflect&&Reflect.apply||(Gb?bH.bind(EH):function(){return bH.apply(EH,arguments)}),yH=_n,ASe=yH({}.toString),DSe=yH("".slice),fa=function(e){return DSe(ASe(e),8,-1)},OSe=fa,NSe=_n,tg=function(e){if("Function"===OSe(e))return NSe(e)},NA="object"==typeof document&&document.all,Kb={all:NA,IS_HTMLDDA:void 0===NA&&void 0!==NA},PSe=Kb.all,zn=Kb.IS_HTMLDDA?function(e){return"function"==typeof e||e===PSe}:function(e){return"function"==typeof e},ng={},So=!Sn(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),qb=Function.prototype.call,Qn=Gb?qb.bind(qb):function(){return qb.apply(qb,arguments)},Yb={},SH={}.propertyIsEnumerable,CH=Object.getOwnPropertyDescriptor,xSe=CH&&!SH.call({1:2},1);Yb.f=xSe?function(e){var t=CH(this,e);return!!t&&t.enumerable}:SH;var Kc,$b,qc=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},kSe=Sn,LSe=fa,PA=Object,FSe=_n("".split),Xb=kSe(function(){return!PA("z").propertyIsEnumerable(0)})?function(e){return"String"==LSe(e)?FSe(e,""):PA(e)}:PA,Sh=function(e){return null==e},USe=Sh,VSe=TypeError,Ch=function(e){if(USe(e))throw VSe("Can't call method on "+e);return e},BSe=Xb,jSe=Ch,Yc=function(e){return BSe(jSe(e))},TH=zn,HSe=Kb.all,Xr=Kb.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:TH(e)||e===HSe}:function(e){return"object"==typeof e?null!==e:TH(e)},Co={},MA=Co,xA=Pn,GSe=zn,wH=function(e){return GSe(e)?e:void 0},Nr=function(e,t){return arguments.length<2?wH(MA[e])||wH(xA[e]):MA[e]&&MA[e][t]||xA[e]&&xA[e][t]},$c=typeof navigator<"u"&&String(navigator.userAgent)||"",kA=$c,RH=Pn.process,AH=Pn.Deno,DH=RH&&RH.versions||AH&&AH.version,OH=DH&&DH.v8;OH&&($b=(Kc=OH.split("."))[0]>0&&Kc[0]<4?1:+(Kc[0]+Kc[1])),!$b&&kA&&(!(Kc=kA.match(/Edge\/(\d+)/))||Kc[1]>=74)&&(Kc=kA.match(/Chrome\/(\d+)/))&&($b=+Kc[1]);var dd=$b,NH=dd,zSe=Pn.String,Th=!!Object.getOwnPropertySymbols&&!Sn(function(){var e=Symbol();return!zSe(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&NH&&NH<41}),PH=Th&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,KSe=Nr,qSe=zn,YSe=Ki,$Se=Object,ig=PH?function(e){return"symbol"==typeof e}:function(e){var t=KSe("Symbol");return qSe(t)&&YSe(t.prototype,$Se(e))},XSe=String,wh=function(e){try{return XSe(e)}catch{return"Object"}},ZSe=zn,JSe=wh,QSe=TypeError,To=function(e){if(ZSe(e))return e;throw QSe(JSe(e)+" is not a function")},eCe=To,tCe=Sh,Zb=function(e,t){var n=e[t];return tCe(n)?void 0:eCe(n)},LA=Qn,FA=zn,UA=Xr,nCe=TypeError,MH={exports:{}},xH=Pn,iCe=Object.defineProperty,kH="__core-js_shared__",VA=Pn[kH]||function(e,t){try{iCe(xH,e,{value:t,configurable:!0,writable:!0})}catch{xH[e]=t}return t}(kH,{}),LH=VA;(MH.exports=function(e,t){return LH[e]||(LH[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Ih=MH.exports,oCe=Ch,sCe=Object,ma=function(e){return sCe(oCe(e))},aCe=ma,cCe=_n({}.hasOwnProperty),mi=Object.hasOwn||function(e,t){return cCe(aCe(e),t)},lCe=_n,dCe=0,uCe=Math.random(),hCe=lCe(1..toString),BA=function(e){return"Symbol("+(void 0===e?"":e)+")_"+hCe(++dCe+uCe,36)},FH=mi,fCe=BA,mCe=Th,gCe=PH,Rh=Pn.Symbol,jA=Ih("wks"),_Ce=gCe?Rh.for||Rh:Rh&&Rh.withoutSetter||fCe,cn=function(e){return FH(jA,e)||(jA[e]=mCe&&FH(Rh,e)?Rh[e]:_Ce("Symbol."+e)),jA[e]},vCe=Qn,UH=Xr,VH=ig,ECe=Zb,yCe=TypeError,SCe=cn("toPrimitive"),TCe=ig,Jb=function(e){var t=function(e,t){if(!UH(e)||VH(e))return e;var n,i=ECe(e,SCe);if(i){if(void 0===t&&(t="default"),n=vCe(i,e,t),!UH(n)||VH(n))return n;throw yCe("Can't convert object to primitive value")}return void 0===t&&(t="number"),function(e,t){var n,i;if("string"===t&&FA(n=e.toString)&&!UA(i=LA(n,e))||FA(n=e.valueOf)&&!UA(i=LA(n,e))||"string"!==t&&FA(n=e.toString)&&!UA(i=LA(n,e)))return i;throw nCe("Can't convert object to primitive value")}(e,t)}(e,"string");return TCe(t)?t:t+""},BH=Xr,HA=Pn.document,wCe=BH(HA)&&BH(HA.createElement),GA=function(e){return wCe?HA.createElement(e):{}},ICe=GA,jH=!So&&!Sn(function(){return 7!=Object.defineProperty(ICe("div"),"a",{get:function(){return 7}}).a}),ACe=Qn,DCe=Yb,OCe=qc,NCe=Yc,PCe=Jb,MCe=mi,xCe=jH,HH=Object.getOwnPropertyDescriptor;ng.f=So?HH:function(e,t){if(e=NCe(e),t=PCe(t),xCe)try{return HH(e,t)}catch{}if(MCe(e,t))return OCe(!ACe(DCe.f,e,t),e[t])};var kCe=Sn,LCe=zn,FCe=/#|\.prototype\./,rg=function(e,t){var n=VCe[UCe(e)];return n==jCe||n!=BCe&&(LCe(t)?kCe(t):!!t)},UCe=rg.normalize=function(e){return String(e).replace(FCe,".").toLowerCase()},VCe=rg.data={},BCe=rg.NATIVE="N",jCe=rg.POLYFILL="P",GH=rg,HCe=To,GCe=Gb,WCe=tg(tg.bind),Xc=function(e,t){return HCe(e),void 0===t?e:GCe?WCe(e,t):function(){return e.apply(t,arguments)}},qo={},WH=So&&Sn(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),zCe=Xr,KCe=String,qCe=TypeError,_r=function(e){if(zCe(e))return e;throw qCe(KCe(e)+" is not an object")},$Ce=jH,Qb=_r,zH=Jb,ZCe=TypeError,WA=Object.defineProperty,JCe=Object.getOwnPropertyDescriptor,zA="enumerable",KA="configurable",qA="writable";qo.f=So?WH?function(e,t,n){if(Qb(e),t=zH(t),Qb(n),"function"==typeof e&&"prototype"===t&&"value"in n&&qA in n&&!n[qA]){var i=JCe(e,t);i&&i[qA]&&(e[t]=n.value,n={configurable:KA in n?n[KA]:i[KA],enumerable:zA in n?n[zA]:i[zA],writable:!1})}return WA(e,t,n)}:WA:function(e,t,n){if(Qb(e),t=zH(t),Qb(n),$Ce)try{return WA(e,t,n)}catch{}if("get"in n||"set"in n)throw ZCe("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var QCe=qo,eTe=qc,Zc=So?function(e,t,n){return QCe.f(e,t,eTe(1,n))}:function(e,t,n){return e[t]=n,e},ey=Pn,tTe=zb,nTe=tg,iTe=zn,rTe=ng.f,oTe=GH,Ah=Co,sTe=Xc,Dh=Zc,KH=mi,aTe=function(e){var t=function(n,i,r){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,i)}return new e(n,i,r)}return tTe(e,this,arguments)};return t.prototype=e.prototype,t},it=function(e,t){var n,i,r,o,s,a,c,l,d,u=e.target,h=e.global,p=e.stat,m=e.proto,f=h?ey:p?ey[u]:(ey[u]||{}).prototype,g=h?Ah:Ah[u]||Dh(Ah,u,{})[u],E=g.prototype;for(o in t)i=!(n=oTe(h?o:u+(p?".":"#")+o,e.forced))&&f&&KH(f,o),a=g[o],i&&(c=e.dontCallGetSet?(d=rTe(f,o))&&d.value:f[o]),s=i&&c?c:t[o],i&&typeof a==typeof s||(l=e.bind&&i?sTe(s,ey):e.wrap&&i?aTe(s):m&&iTe(s)?nTe(s):s,(e.sham||s&&s.sham||a&&a.sham)&&Dh(l,"sham",!0),Dh(g,o,l),m&&(KH(Ah,r=u+"Prototype")||Dh(Ah,r,{}),Dh(Ah[r],o,s),e.real&&E&&(n||!E[o])&&Dh(E,o,s)))},cTe=Math.ceil,lTe=Math.floor,dTe=Math.trunc||function(e){var t=+e;return(t>0?lTe:cTe)(t)},uTe=dTe,YA=function(e){var t=+e;return t!=t||0===t?0:uTe(t)},hTe=YA,pTe=Math.max,fTe=Math.min,$A=function(e,t){var n=hTe(e);return n<0?pTe(n+t,0):fTe(n,t)},mTe=YA,gTe=Math.min,qH=function(e){return e>0?gTe(mTe(e),9007199254740991):0},_Te=qH,oc=function(e){return _Te(e.length)},vTe=Yc,ETe=$A,bTe=oc,YH=function(e){return function(t,n,i){var r,o=vTe(t),s=bTe(o),a=ETe(i,s);if(e&&n!=n){for(;s>a;)if((r=o[a++])!=r)return!0}else for(;s>a;a++)if((e||a in o)&&o[a]===n)return e||a||0;return!e&&-1}},XA={includes:YH(!0),indexOf:YH(!1)},yTe=XA.includes;it({target:"Array",proto:!0,forced:Sn(function(){return!Array(1).includes()})},{includes:function(e){return yTe(this,e,arguments.length>1?arguments[1]:void 0)}});var STe=Co,Yo=function(e){return STe[e+"Prototype"]},CTe=Yo("Array").includes,TTe=Xr,wTe=fa,ITe=cn("match"),$H=function(e){var t;return TTe(e)&&(void 0!==(t=e[ITe])?!!t:"RegExp"==wTe(e))},RTe=$H,ATe=TypeError,XH={};XH[cn("toStringTag")]="z";var ZA="[object z]"===String(XH),DTe=ZA,OTe=zn,ty=fa,NTe=cn("toStringTag"),PTe=Object,MTe="Arguments"==ty(function(){return arguments}()),ga=DTe?ty:function(e){var t,n,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(r,o){try{return r[o]}catch{}}(t=PTe(e),NTe))?n:MTe?ty(t):"Object"==(i=ty(t))&&OTe(t.callee)?"Arguments":i},xTe=ga,kTe=String,wo=function(e){if("Symbol"===xTe(e))throw TypeError("Cannot convert a Symbol value to a string");return kTe(e)},LTe=cn("match"),FTe=it,VTe=Ch,ZH=wo,jTe=_n("".indexOf);FTe({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[LTe]=!1,"/./"[e](t)}catch{}}return!1}("includes")},{includes:function(e){return!!~jTe(ZH(VTe(this)),ZH(function(e){if(RTe(e))throw ATe("The method doesn't accept regular expressions");return e}(e)),arguments.length>1?arguments[1]:void 0)}});var HTe=Yo("String").includes,JH=Ki,GTe=CTe,WTe=HTe,JA=Array.prototype,QA=String.prototype,Y=Vt(function(e){var t=e.includes;return e===JA||JH(JA,e)&&t===JA.includes?GTe:"string"==typeof e||e===QA||JH(QA,e)&&t===QA.includes?WTe:t}),KTe=To,qTe=ma,YTe=Xb,$Te=oc,XTe=TypeError,QH=function(e){return function(t,n,i,r){KTe(n);var o=qTe(t),s=YTe(o),a=$Te(o),c=e?a-1:0,l=e?-1:1;if(i<2)for(;;){if(c in s){r=s[c],c+=l;break}if(c+=l,e?c<0:a<=c)throw XTe("Reduce of empty array with no initial value")}for(;e?c>=0:a>c;c+=l)c in s&&(r=n(r,s[c],c,o));return r}},ZTe={left:QH(!1),right:QH(!0)},JTe=Sn,ny=function(e,t){var n=[][e];return!!n&&JTe(function(){n.call(null,t||function(){return 1},1)})},Oh=typeof process<"u"&&"process"==fa(process),QTe=ZTe.left;it({target:"Array",proto:!0,forced:!Oh&&dd>79&&dd<83||!ny("reduce")},{reduce:function(e){var t=arguments.length;return QTe(this,e,t,t>1?arguments[1]:void 0)}});var e0e=Yo("Array").reduce,t0e=Ki,n0e=e0e,eD=Array.prototype,e6=function(e){var t=e.reduce;return e===eD||t0e(eD,e)&&t===eD.reduce?n0e:t},Ns=Vt(e6);let t6=!0,n6=!0;function iy(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function ud(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(s,a){if(s!==t)return r.apply(this,arguments);const c=l=>{const d=n(l);d&&(a.handleEvent?a.handleEvent(d):a(d))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(a,c),r.apply(this,[s,c])};const o=i.removeEventListener;i.removeEventListener=function(s,a){if(s!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(a))return o.apply(this,arguments);const c=this._eventMap[t].get(a);return this._eventMap[t].delete(a),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[s,c])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(s){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),s&&this.addEventListener(t,this["_on"+t]=s)},enumerable:!0,configurable:!0})}function r0e(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(t6=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function o0e(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n6=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function i6(){if("object"==typeof window){if(t6)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function tD(e,t){n6&&console.warn(e+" is deprecated, please use "+t+" instead.")}function r6(e){return"[object Object]"===Object.prototype.toString.call(e)}function o6(e){var t;return r6(e)?Ns(t=Object.keys(e)).call(t,function(n,i){const r=r6(e[i]),o=r?o6(e[i]):e[i],s=r&&!Object.keys(o).length;return void 0===o||s?n:Object.assign(n,{[i]:o})},{}):e}function nD(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?nD(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(r=>{nD(e,e.get(r),n)})}))}function s6(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const o=[];return e.forEach(s=>{"track"===s.type&&s.trackIdentifier===t.id&&o.push(s)}),o.forEach(s=>{e.forEach(a=>{a.type===i&&a.trackId===s.id&&nD(e,a,r)})}),r}var s0e=BA,a6=Ih("keys"),ry=function(e){return a6[e]||(a6[e]=s0e(e))},a0e=!Sn(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),c0e=mi,l0e=zn,d0e=ma,u0e=a0e,c6=ry("IE_PROTO"),iD=Object,h0e=iD.prototype,rD=u0e?iD.getPrototypeOf:function(e){var t=d0e(e);if(c0e(t,c6))return t[c6];var n=t.constructor;return l0e(n)&&t instanceof n?n.prototype:t instanceof iD?h0e:null},p0e=_n,f0e=To,m0e=zn,g0e=String,_0e=TypeError,E0e=_r,y0e=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=function(e,t,n){try{return p0e(f0e(Object.getOwnPropertyDescriptor(e,"__proto__").set))}catch{}}(Object.prototype))(n,[]),t=n instanceof Array}catch{}return function(i,r){return E0e(i),function(e){if("object"==typeof e||m0e(e))return e;throw _0e("Can't set "+g0e(e)+" as a prototype")}(r),t?e(i,r):i.__proto__=r,i}}():void 0),oy={},sy={},oD=mi,S0e=Yc,C0e=XA.indexOf,T0e=sy,l6=_n([].push),d6=function(e,t){var n,i=S0e(e),r=0,o=[];for(n in i)!oD(T0e,n)&&oD(i,n)&&l6(o,n);for(;t.length>r;)oD(i,n=t[r++])&&(~C0e(o,n)||l6(o,n));return o},sD=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],w0e=d6,I0e=sD.concat("length","prototype");oy.f=Object.getOwnPropertyNames||function(e){return w0e(e,I0e)};var og={};og.f=Object.getOwnPropertySymbols;var R0e=Nr,A0e=oy,D0e=og,O0e=_r,N0e=_n([].concat),P0e=R0e("Reflect","ownKeys")||function(e){var t=A0e.f(O0e(e)),n=D0e.f;return n?N0e(t,n(e)):t},u6=mi,M0e=P0e,x0e=ng,k0e=qo,aD={},L0e=d6,F0e=sD,ay=Object.keys||function(e){return L0e(e,F0e)},B0e=qo,j0e=_r,H0e=Yc,G0e=ay;aD.f=So&&!WH?Object.defineProperties:function(e,t){j0e(e);for(var n,i=H0e(t),r=G0e(t),o=r.length,s=0;o>s;)B0e.f(e,n=r[s++],i[n]);return e};var cy,h6=Nr("document","documentElement"),W0e=_r,z0e=aD,p6=sD,K0e=sy,q0e=h6,Y0e=GA,cD="prototype",f6=ry("IE_PROTO"),dD=function(){},m6=function(e){return"<script>"+e+"<\/script>"},g6=function(e){e.write(m6("")),e.close();var t=e.parentWindow.Object;return e=null,t},ly=function(){try{cy=new ActiveXObject("htmlfile")}catch{}var e,t;ly=typeof document<"u"?document.domain&&cy?g6(cy):((t=Y0e("iframe")).style.display="none",q0e.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(m6("document.F=Object")),e.close(),e.F):g6(cy);for(var i=p6.length;i--;)delete ly[cD][p6[i]];return ly()};K0e[f6]=!0;var sg=Object.create||function(e,t){var n;return null!==e?(dD[cD]=W0e(e),n=new dD,dD[cD]=null,n[f6]=e):n=ly(),void 0===t?n:z0e.f(n,t)},$0e=Xr,X0e=Zc,_6=Error,Z0e=_n("".replace),J0e=String(_6("zxcasd").stack),v6=/\n\s*at [^:]*:[^\n]*/,Q0e=v6.test(J0e),ewe=qc,twe=!Sn(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",ewe(1,7)),7!==e.stack)}),nwe=Zc,rwe=twe,E6=Error.captureStackTrace,hd={},owe=hd,swe=cn("iterator"),awe=Array.prototype,b6=function(e){return void 0!==e&&(owe.Array===e||awe[swe]===e)},cwe=ga,y6=Zb,lwe=Sh,dwe=hd,uwe=cn("iterator"),dy=function(e){if(!lwe(e))return y6(e,uwe)||y6(e,"@@iterator")||dwe[cwe(e)]},hwe=Qn,pwe=To,fwe=_r,mwe=wh,gwe=dy,_we=TypeError,uD=function(e,t){var n=arguments.length<2?gwe(e):t;if(pwe(n))return fwe(hwe(n,e));throw _we(mwe(e)+" is not iterable")},vwe=Qn,S6=_r,Ewe=Zb,C6=function(e,t,n){var i,r;S6(e);try{if(!(i=Ewe(e,"return"))){if("throw"===t)throw n;return n}i=vwe(i,e)}catch(o){r=!0,i=o}if("throw"===t)throw n;if(r)throw i;return S6(i),n},bwe=Xc,ywe=Qn,Swe=_r,Cwe=wh,Twe=b6,wwe=oc,T6=Ki,Iwe=uD,Rwe=dy,w6=C6,Awe=TypeError,uy=function(e,t){this.stopped=e,this.result=t},I6=uy.prototype,ag=function(e,t,n){var i,r,o,s,a,c,l,u=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),m=!(!n||!n.INTERRUPTED),f=bwe(t,n&&n.that),g=function(b){return i&&w6(i,"normal",b),new uy(!0,b)},E=function(b){return u?(Swe(b),m?f(b[0],b[1],g):f(b[0],b[1])):m?f(b,g):f(b)};if(h)i=e.iterator;else if(p)i=e;else{if(!(r=Rwe(e)))throw Awe(Cwe(e)+" is not iterable");if(Twe(r)){for(o=0,s=wwe(e);s>o;o++)if((a=E(e[o]))&&T6(I6,a))return a;return new uy(!1)}i=Iwe(e,r)}for(c=h?e.next:i.next;!(l=ywe(c,i)).done;){try{a=E(l.value)}catch(b){w6(i,"throw",b)}if("object"==typeof a&&a&&T6(I6,a))return a}return new uy(!1)},Dwe=wo,Owe=it,Nwe=Ki,Pwe=rD,hy=y0e,R6=sg,hD=Zc,pD=qc,Lwe=ag,Uwe=cn("toStringTag"),py=Error,Vwe=[].push,Nh=function(e,t){var n,i=Nwe(fD,this);hy?n=hy(py(),i?Pwe(this):fD):(n=i?this:R6(fD),hD(n,Uwe,"Error")),void 0!==t&&hD(n,"message",function(e,t){return void 0===e?arguments.length<2?"":t:Dwe(e)}(t)),function(e,t,n,i){rwe&&(E6?E6(e,t):nwe(e,"stack",function(e,t){if(Q0e&&"string"==typeof e&&!_6.prepareStackTrace)for(;t--;)e=Z0e(e,v6,"");return e}(n,i)))}(n,Nh,n.stack,1),arguments.length>2&&function(e,t){$0e(t)&&"cause"in t&&X0e(e,"cause",t.cause)}(n,arguments[2]);var r=[];return Lwe(e,Vwe,{that:r}),hD(n,"errors",r),n};hy?hy(Nh,py):function(e,t,n){for(var i=M0e(t),r=k0e.f,o=x0e.f,s=0;s<i.length;s++){var a=i[s];u6(e,a)||n&&u6(n,a)||r(e,a,o(t,a))}}(Nh,py,{name:!0});var fD=Nh.prototype=R6(py.prototype,{constructor:pD(1,Nh),message:pD(1,""),name:pD(1,"AggregateError")});Owe({global:!0,constructor:!0,arity:2},{AggregateError:Nh});var fy,cg,my,A6=Pn.WeakMap,jwe=zn(A6)&&/native code/.test(String(A6)),Hwe=Xr,Gwe=Zc,mD=mi,Wwe=ry,zwe=sy,O6="Object already initialized",_D=Pn.TypeError;if(jwe||VA.state){var _a=VA.state||(VA.state=new(0,Pn.WeakMap));_a.get=_a.get,_a.has=_a.has,_a.set=_a.set,fy=function(e,t){if(_a.has(e))throw _D(O6);return t.facade=e,_a.set(e,t),t},cg=function(e){return _a.get(e)||{}},my=function(e){return _a.has(e)}}else{var Ph=Wwe("state");zwe[Ph]=!0,fy=function(e,t){if(mD(e,Ph))throw _D(O6);return t.facade=e,Gwe(e,Ph,t),t},cg=function(e){return mD(e,Ph)?e[Ph]:{}},my=function(e){return mD(e,Ph)}}var pd,N6,P6,fd={set:fy,get:cg,has:my,enforce:function(e){return my(e)?cg(e):fy(e,{})},getterFor:function(e){return function(t){var n;if(!Hwe(t)||(n=cg(t)).type!==e)throw _D("Incompatible receiver, "+e+" required");return n}}},vD=So,M6=Function.prototype,Ywe=vD&&Object.getOwnPropertyDescriptor,ED=mi(M6,"name"),x6={EXISTS:ED,PROPER:ED&&"something"===function(){}.name,CONFIGURABLE:ED&&(!vD||vD&&Ywe(M6,"name").configurable)},$we=Zc,Jc=function(e,t,n,i){return i&&i.enumerable?e[t]=n:$we(e,t,n),e},Xwe=Sn,Zwe=zn,Jwe=Xr,Qwe=sg,k6=rD,eIe=Jc,bD=cn("iterator"),L6=!1;[].keys&&("next"in(P6=[].keys())?(N6=k6(k6(P6)))!==Object.prototype&&(pd=N6):L6=!0);var tIe=!Jwe(pd)||Xwe(function(){var e={};return pd[bD].call(e)!==e});Zwe((pd=tIe?{}:Qwe(pd))[bD])||eIe(pd,bD,function(){return this});var F6={IteratorPrototype:pd,BUGGY_SAFARI_ITERATORS:L6},nIe=ga,rIe=ZA,oIe=qo.f,sIe=Zc,aIe=mi,cIe=ZA?{}.toString:function(){return"[object "+nIe(this)+"]"},U6=cn("toStringTag"),Qc=function(e,t,n,i){if(e){var r=n?e:e.prototype;aIe(r,U6)||oIe(r,U6,{configurable:!0,value:t}),i&&!rIe&&sIe(r,"toString",cIe)}},lIe=F6.IteratorPrototype,dIe=sg,uIe=qc,hIe=Qc,pIe=hd,fIe=function(){return this},yD=function(e,t,n,i){var r=t+" Iterator";return e.prototype=dIe(lIe,{next:uIe(+!i,n)}),hIe(e,r,!1,!0),pIe[r]=fIe,e},mIe=it,gIe=Qn,vIe=yD,EIe=rD,bIe=Qc,V6=Jc,B6=hd,SIe=x6.PROPER,gy=F6.BUGGY_SAFARI_ITERATORS,SD=cn("iterator"),_y="values",H6="entries",CIe=function(){return this},G6=function(e,t,n,i,r,o,s){vIe(n,t,i);var a,c,l,d=function(E){if(E===r&&f)return f;if(!gy&&E in p)return p[E];switch(E){case"keys":case _y:case H6:return function(){return new n(this,E)}}return function(){return new n(this)}},u=t+" Iterator",h=!1,p=e.prototype,m=p[SD]||p["@@iterator"]||r&&p[r],f=!gy&&m||d(r),g="Array"==t&&p.entries||m;if(g&&(a=EIe(g.call(new e)))!==Object.prototype&&a.next&&(bIe(a,u,!0,!0),B6[u]=CIe),SIe&&r==_y&&m&&m.name!==_y&&(h=!0,f=function(){return gIe(m,this)}),r)if(c={values:d(_y),keys:o?f:d("keys"),entries:d(H6)},s)for(l in c)(gy||h||!(l in p))&&V6(p,l,c[l]);else mIe({target:t,proto:!0,forced:gy||h},c);return s&&p[SD]!==f&&V6(p,SD,f,{name:r}),B6[t]=f,c},CD=function(e,t){return{value:e,done:t}},TIe=Yc,W6=hd,wIe=G6,K6=CD,q6="Array Iterator",IIe=fd.set,RIe=fd.getterFor(q6);wIe(Array,"Array",function(e,t){IIe(this,{type:q6,target:TIe(e),index:0,kind:t})},function(){var e=RIe(this),t=e.target,n=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,K6(void 0,!0)):K6("keys"==n?i:"values"==n?t[i]:[i,t[i]],!1)},"values"),W6.Arguments=W6.Array;var AIe=qo,vy=function(e,t,n){return AIe.f(e,t,n)},DIe=Nr,OIe=vy,NIe=So,Y6=cn("species"),PIe=Ki,MIe=TypeError,TD=function(e,t){if(PIe(t,e))return e;throw MIe("Incorrect invocation")},xIe=zn,wD=VA,kIe=_n(Function.toString);xIe(wD.inspectSource)||(wD.inspectSource=function(e){return kIe(e)});var $6=wD.inspectSource,LIe=_n,FIe=Sn,X6=zn,UIe=ga,VIe=$6,Z6=function(){},BIe=[],J6=Nr("Reflect","construct"),ID=/^\s*(?:class|function)\b/,jIe=LIe(ID.exec),HIe=!ID.exec(Z6),lg=function(e){if(!X6(e))return!1;try{return J6(Z6,BIe,e),!0}catch{return!1}},Q6=function(e){if(!X6(e))return!1;switch(UIe(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return HIe||!!jIe(ID,VIe(e))}catch{return!0}};Q6.sham=!0;var dg,Mh,e8,RD,Ey=!J6||FIe(function(){var e;return lg(lg.call)||!lg(Object)||!lg(function(){e=!0})||e})?Q6:lg,GIe=Ey,WIe=wh,zIe=TypeError,t8=_r,qIe=Sh,YIe=cn("species"),AD=function(e,t){var n,i=t8(e).constructor;return void 0===i||qIe(n=t8(i)[YIe])?t:function(e){if(GIe(e))return e;throw zIe(WIe(e)+" is not a constructor")}(n)},by=_n([].slice),$Ie=TypeError,xh=function(e,t){if(e<t)throw $Ie("Not enough arguments");return e},n8=/(?:ipad|iphone|ipod).*applewebkit/i.test($c),Io=Pn,XIe=zb,ZIe=Xc,i8=zn,JIe=mi,r8=Sn,o8=h6,QIe=by,s8=GA,eRe=xh,tRe=n8,nRe=Oh,DD=Io.setImmediate,OD=Io.clearImmediate,iRe=Io.process,ND=Io.Dispatch,rRe=Io.Function,a8=Io.MessageChannel,oRe=Io.String,PD=0,ug={},c8="onreadystatechange";r8(function(){dg=Io.location});var MD=function(e){if(JIe(ug,e)){var t=ug[e];delete ug[e],t()}},xD=function(e){return function(){MD(e)}},l8=function(e){MD(e.data)},d8=function(e){Io.postMessage(oRe(e),dg.protocol+"//"+dg.host)};DD&&OD||(DD=function(e){eRe(arguments.length,1);var t=i8(e)?e:rRe(e),n=QIe(arguments,1);return ug[++PD]=function(){XIe(t,void 0,n)},Mh(PD),PD},OD=function(e){delete ug[e]},nRe?Mh=function(e){iRe.nextTick(xD(e))}:ND&&ND.now?Mh=function(e){ND.now(xD(e))}:a8&&!tRe?(RD=(e8=new a8).port2,e8.port1.onmessage=l8,Mh=ZIe(RD.postMessage,RD)):Io.addEventListener&&i8(Io.postMessage)&&!Io.importScripts&&dg&&"file:"!==dg.protocol&&!r8(d8)?(Mh=d8,Io.addEventListener("message",l8,!1)):Mh=c8 in s8("script")?function(e){o8.appendChild(s8("script"))[c8]=function(){o8.removeChild(this),MD(e)}}:function(e){setTimeout(xD(e),0)});var yy={set:DD,clear:OD},u8=function(){this.head=null,this.tail=null};u8.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var kh,kD,LD,FD,h8,p8=u8,sRe=/ipad|iphone|ipod/i.test($c)&&typeof Pebble<"u",aRe=/web0s(?!.*chrome)/i.test($c),md=Pn,f8=Xc,UD=yy.set,lRe=p8,dRe=n8,uRe=sRe,hRe=aRe,VD=Oh,m8=md.MutationObserver||md.WebKitMutationObserver,g8=md.document,_8=md.process,Sy=md.Promise,v8=(0,ng.f)(md,"queueMicrotask"),BD=v8&&v8.value;if(!BD){var Cy=new lRe,Ty=function(){var e,t;for(VD&&(e=_8.domain)&&e.exit();t=Cy.get();)try{t()}catch(n){throw Cy.head&&kh(),n}e&&e.enter()};dRe||VD||hRe||!m8||!g8?!uRe&&Sy&&Sy.resolve?((FD=Sy.resolve(void 0)).constructor=Sy,h8=f8(FD.then,FD),kh=function(){h8(Ty)}):VD?kh=function(){_8.nextTick(Ty)}:(UD=f8(UD,md),kh=function(){UD(Ty)}):(kD=!0,LD=g8.createTextNode(""),new m8(Ty).observe(LD,{characterData:!0}),kh=function(){LD.data=kD=!kD}),BD=function(e){Cy.head||kh(),Cy.add(e)}}var E8=BD,Lh=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},gd=Pn.Promise,b8="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,pRe=!b8&&!Oh&&"object"==typeof window&&"object"==typeof document,fRe=Pn,hg=gd,mRe=zn,gRe=GH,_Re=$6,ERe=pRe,bRe=b8,jD=dd,y8=hg&&hg.prototype,yRe=cn("species"),S8=!1,C8=mRe(fRe.PromiseRejectionEvent),SRe=gRe("Promise",function(){var e=_Re(hg),t=e!==String(hg);if(!t&&66===jD||!y8.catch||!y8.finally)return!0;if(!jD||jD<51||!/native code/.test(e)){var n=new hg(function(r){r(1)}),i=function(r){r(function(){},function(){})};if((n.constructor={})[yRe]=i,!(S8=n.then(function(){})instanceof i))return!0}return!t&&(ERe||bRe)&&!C8}),pg={CONSTRUCTOR:SRe,REJECTION_EVENT:C8,SUBCLASSING:S8},va={},T8=To,CRe=TypeError,TRe=function(e){var t,n;this.promise=new e(function(i,r){if(void 0!==t||void 0!==n)throw CRe("Bad Promise constructor");t=i,n=r}),this.resolve=T8(t),this.reject=T8(n)};va.f=function(e){return new TRe(e)};var HD,w8,t,wRe=it,wy=Oh,el=Pn,fg=Qn,IRe=Jc,RRe=Qc,DRe=To,GD=zn,ORe=Xr,NRe=TD,PRe=AD,I8=yy.set,WD=E8,xRe=Lh,kRe=p8,R8=fd,zD=gd,D8=va,Iy="Promise",O8=pg.CONSTRUCTOR,LRe=pg.REJECTION_EVENT,KD=R8.getterFor(Iy),FRe=R8.set,mg=zD,qD=zD&&zD.prototype,N8=el.TypeError,YD=el.document,$D=el.process,XD=D8.f,VRe=XD,BRe=!!(YD&&YD.createEvent&&el.dispatchEvent),P8="unhandledrejection",M8=function(e){var t;return!(!ORe(e)||!GD(t=e.then))&&t},x8=function(e,t){var n,i,r,o=t.value,s=1==t.state,a=s?e.ok:e.fail,c=e.resolve,l=e.reject,d=e.domain;try{a?(s||(2===t.rejection&&HRe(t),t.rejection=1),!0===a?n=o:(d&&d.enter(),n=a(o),d&&(d.exit(),r=!0)),n===e.promise?l(N8("Promise-chain cycle")):(i=M8(n))?fg(i,n,c,l):c(n)):l(o)}catch(u){d&&!r&&d.exit(),l(u)}},k8=function(e,t){e.notified||(e.notified=!0,WD(function(){for(var n,i=e.reactions;n=i.get();)x8(n,e);e.notified=!1,t&&!e.rejection&&jRe(e)}))},L8=function(e,t,n){var i,r;BRe?((i=YD.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),el.dispatchEvent(i)):i={promise:t,reason:n},!LRe&&(r=el["on"+e])?r(i):e===P8&&function(e,t){try{1==arguments.length?console.error(e):console.error(e,t)}catch{}}("Unhandled promise rejection",n)},jRe=function(e){fg(I8,el,function(){var t,n=e.facade,i=e.value;if(F8(e)&&(t=xRe(function(){wy?$D.emit("unhandledRejection",i,n):L8(P8,n,i)}),e.rejection=wy||F8(e)?2:1,t.error))throw t.value})},F8=function(e){return 1!==e.rejection&&!e.parent},HRe=function(e){fg(I8,el,function(){var t=e.facade;wy?$D.emit("rejectionHandled",t):L8("rejectionhandled",t,e.value)})},Fh=function(e,t,n){return function(i){e(t,i,n)}},Uh=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,k8(e,!0))},ZD=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw N8("Promise can't be resolved itself");var i=M8(t);i?WD(function(){var r={done:!1};try{fg(i,t,Fh(ZD,r,e),Fh(Uh,r,e))}catch(o){Uh(r,o,e)}}):(e.value=t,e.state=1,k8(e,!1))}catch(r){Uh({done:!1},r,e)}}};O8&&(qD=(mg=function(e){NRe(this,qD),DRe(e),fg(HD,this);var t=KD(this);try{e(Fh(ZD,t),Fh(Uh,t))}catch(n){Uh(t,n)}}).prototype,(HD=function(e){FRe(this,{type:Iy,done:!1,notified:!1,parent:!1,reactions:new kRe,rejection:!1,state:0,value:void 0})}).prototype=IRe(qD,"then",function(e,t){var n=KD(this),i=XD(PRe(this,mg));return n.parent=!0,i.ok=!GD(e)||e,i.fail=GD(t)&&t,i.domain=wy?$D.domain:void 0,0==n.state?n.reactions.add(i):WD(function(){x8(i,n)}),i.promise}),w8=function(){var e=new HD,t=KD(e);this.promise=e,this.resolve=Fh(ZD,t),this.reject=Fh(Uh,t)},D8.f=XD=function(e){return e===mg||void 0===e?new w8(e):VRe(e)}),wRe({global:!0,constructor:!0,wrap:!0,forced:O8},{Promise:mg}),RRe(mg,Iy,!1,!0),t=DIe(Iy),NIe&&t&&!t[Y6]&&OIe(t,Y6,{configurable:!0,get:function(){return this}});var U8=cn("iterator"),V8=!1;try{var GRe=0,B8={next:function(){return{done:!!GRe++}},return:function(){V8=!0}};B8[U8]=function(){return this},Array.from(B8,function(){throw 2})}catch{}var WRe=gd,Ry=pg.CONSTRUCTOR||!function(e,t){if(!V8)return!1;var n=!1;try{var i={};i[U8]=function(){return{next:function(){return{done:n=!0}}}},function(e){WRe.all(e).then(void 0,function(){})}(i)}catch{}return n}(),KRe=Qn,qRe=To,YRe=va,$Re=Lh,XRe=ag;it({target:"Promise",stat:!0,forced:Ry},{all:function(e){var t=this,n=YRe.f(t),i=n.resolve,r=n.reject,o=$Re(function(){var s=qRe(t.resolve),a=[],c=0,l=1;XRe(e,function(d){var u=c++,h=!1;l++,KRe(s,t,d).then(function(p){h||(h=!0,a[u]=p,--l||i(a))},r)}),--l||i(a)});return o.error&&r(o.value),n.promise}}),it({target:"Promise",proto:!0,forced:pg.CONSTRUCTOR,real:!0},{catch:function(e){return this.then(void 0,e)}});var QRe=Qn,eAe=To,tAe=va,nAe=Lh,iAe=ag;it({target:"Promise",stat:!0,forced:Ry},{race:function(e){var t=this,n=tAe.f(t),i=n.reject,r=nAe(function(){var o=eAe(t.resolve);iAe(e,function(s){QRe(o,t,s).then(n.resolve,i)})});return r.error&&i(r.value),n.promise}});var rAe=Qn,oAe=va;it({target:"Promise",stat:!0,forced:pg.CONSTRUCTOR},{reject:function(e){var t=oAe.f(this);return rAe(t.reject,void 0,e),t.promise}});var sAe=_r,aAe=Xr,cAe=va,j8=function(e,t){if(sAe(e),aAe(t)&&t.constructor===e)return t;var n=cAe.f(e);return(0,n.resolve)(t),n.promise},lAe=it,dAe=gd,uAe=pg.CONSTRUCTOR,hAe=j8,pAe=Nr("Promise"),fAe=!uAe;lAe({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return hAe(fAe&&this===pAe?dAe:this,e)}});var mAe=Qn,gAe=To,_Ae=va,vAe=Lh,EAe=ag;it({target:"Promise",stat:!0,forced:Ry},{allSettled:function(e){var t=this,n=_Ae.f(t),i=n.resolve,r=n.reject,o=vAe(function(){var s=gAe(t.resolve),a=[],c=0,l=1;EAe(e,function(d){var u=c++,h=!1;l++,mAe(s,t,d).then(function(p){h||(h=!0,a[u]={status:"fulfilled",value:p},--l||i(a))},function(p){h||(h=!0,a[u]={status:"rejected",reason:p},--l||i(a))})}),--l||i(a)});return o.error&&r(o.value),n.promise}});var bAe=Qn,yAe=To,SAe=Nr,CAe=va,TAe=Lh,wAe=ag,H8="No one promise resolved";it({target:"Promise",stat:!0,forced:Ry},{any:function(e){var t=this,n=SAe("AggregateError"),i=CAe.f(t),r=i.resolve,o=i.reject,s=TAe(function(){var a=yAe(t.resolve),c=[],l=0,d=1,u=!1;wAe(e,function(h){var p=l++,m=!1;d++,bAe(a,t,h).then(function(f){m||u||(u=!0,r(f))},function(f){m||u||(m=!0,c[p]=f,--d||o(new n(c,H8)))})}),--d||o(new n(c,H8))});return s.error&&o(s.value),i.promise}});var AAe=Nr,DAe=zn,OAe=AD,G8=j8,NAe=gd&&gd.prototype;it({target:"Promise",proto:!0,real:!0,forced:!!gd&&Sn(function(){NAe.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=OAe(this,AAe("Promise")),n=DAe(e);return this.then(n?function(i){return G8(t,e()).then(function(){return i})}:e,n?function(i){return G8(t,e()).then(function(){throw i})}:e)}});var QD=_n,PAe=YA,MAe=wo,xAe=Ch,kAe=QD("".charAt),W8=QD("".charCodeAt),LAe=QD("".slice),z8=function(e){return function(t,n){var i,r,o=MAe(xAe(t)),s=PAe(n),a=o.length;return s<0||s>=a?e?"":void 0:(i=W8(o,s))<55296||i>56319||s+1===a||(r=W8(o,s+1))<56320||r>57343?e?kAe(o,s):i:e?LAe(o,s,s+2):r-56320+(i-55296<<10)+65536}},eO={codeAt:z8(!1),charAt:z8(!0)},FAe=eO.charAt,UAe=wo,VAe=G6,q8=CD,Y8="String Iterator",BAe=fd.set,jAe=fd.getterFor(Y8);VAe(String,"String",function(e){BAe(this,{type:Y8,string:UAe(e),index:0})},function(){var e,t=jAe(this),n=t.string,i=t.index;return i>=n.length?q8(void 0,!0):(e=FAe(n,i),t.index+=e.length,q8(e,!1))});var HAe=Co.Promise,WAe=Pn,zAe=ga,KAe=Zc,$8=hd,X8=cn("toStringTag");for(var tO in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var Z8=WAe[tO],nO=Z8&&Z8.prototype;nO&&zAe(nO)!==X8&&KAe(nO,X8,tO),$8[tO]=$8.Array}var J8=HAe,q=Vt(J8);const Q8=i6;function eG(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(s){if("object"!=typeof s||s.mandatory||s.optional)return s;const a={};return Object.keys(s).forEach(c=>{if("require"===c||"advanced"===c||"mediaSource"===c)return;const l="object"==typeof s[c]?s[c]:{ideal:s[c]};void 0!==l.exact&&"number"==typeof l.exact&&(l.min=l.max=l.exact);const d=function(u,h){return u?u+h.charAt(0).toUpperCase()+h.slice(1):"deviceId"===h?"sourceId":h};if(void 0!==l.ideal){a.optional=a.optional||[];let u={};"number"==typeof l.ideal?(u[d("min",c)]=l.ideal,a.optional.push(u),u={},u[d("max",c)]=l.ideal,a.optional.push(u)):(u[d("",c)]=l.ideal,a.optional.push(u))}void 0!==l.exact&&"number"!=typeof l.exact?(a.mandatory=a.mandatory||{},a.mandatory[d("",c)]=l.exact):["min","max"].forEach(u=>{void 0!==l[u]&&(a.mandatory=a.mandatory||{},a.mandatory[d(u,c)]=l[u])})}),s.advanced&&(a.optional=(a.optional||[]).concat(s.advanced)),a},r=function(s,a){if(t.version>=61)return a(s);if((s=JSON.parse(JSON.stringify(s)))&&"object"==typeof s.audio){const c=function(l,d,u){d in l&&!(u in l)&&(l[u]=l[d],delete l[d])};c((s=JSON.parse(JSON.stringify(s))).audio,"autoGainControl","googAutoGainControl"),c(s.audio,"noiseSuppression","googNoiseSuppression"),s.audio=i(s.audio)}if(s&&"object"==typeof s.video){let c=s.video.facingMode;c=c&&("object"==typeof c?c:{ideal:c});const l=t.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||l)){let d;if(delete s.video.facingMode,"environment"===c.exact||"environment"===c.ideal?d=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(u=>{let h=(u=u.filter(p=>"videoinput"===p.kind)).find(p=>d.some(m=>{var f;return Y(f=p.label.toLowerCase()).call(f,m)}));return!h&&u.length&&Y(d).call(d,"back")&&(h=u[u.length-1]),h&&(s.video.deviceId=c.exact?{exact:h.deviceId}:{ideal:h.deviceId}),s.video=i(s.video),Q8("chrome: "+JSON.stringify(s)),a(s)})}s.video=i(s.video)}return Q8("chrome: "+JSON.stringify(s)),a(s)},o=function(s){return t.version>=64?s:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[s.name]||s.name,message:s.message,constraint:s.constraint||s.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(s,a,c){r(s,l=>{n.webkitGetUserMedia(l,a,d=>{c&&c(o(d))})})}.bind(n),n.mediaDevices.getUserMedia){const s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(a){return r(a,c=>s(c).then(l=>{if(c.audio&&!l.getAudioTracks().length||c.video&&!l.getVideoTracks().length)throw l.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return l},l=>q.reject(o(l))))}}}function tG(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function nG(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(s=>s.track&&s.track.id===i.track.id):{track:i.track};const o=new Event("track");o.track=i.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[n.stream],this.dispatchEvent(o)}),n.stream.getTracks().forEach(i=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(s=>s.track&&s.track.id===i.id):{track:i};const o=new Event("track");o.track=i,o.receiver=r,o.transceiver={receiver:r},o.streams=[n.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else ud(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function iG(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(r,o){return{track:o,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===o.kind?r.createDTMFSender(o):null),this._dtmf},_pc:r}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,a){let c=r.apply(this,arguments);return c||(c=t(this,s),this._senders.push(c)),c};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){o.apply(this,arguments);const a=this._senders.indexOf(s);-1!==a&&this._senders.splice(a,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(o=>{this._senders.push(t(this,o))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(o=>{const s=this._senders.find(a=>a.track===o);s&&this._senders.splice(this._senders.indexOf(s),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function rG(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,i,r]=arguments;if(arguments.length>0&&"function"==typeof n)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof n))return t.apply(this,[]);const o=function(a){const c={};return a.result().forEach(l=>{const d={id:l.id,timestamp:l.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[l.type]||l.type};l.names().forEach(u=>{d[u]=l.stat(u)}),c[d.id]=d}),c},s=function(a){return new Map(Object.keys(a).map(c=>[c,a[c]]))};return arguments.length>=2?t.apply(this,[function(c){i(s(o(c)))},n]):new q((a,c)=>{t.apply(this,[function(l){a(s(o(l)))},c])}).then(i,r)}}function oG(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>s6(o,r.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(r=>r._pc=this),i}),ud(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(r=>s6(r,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let i,r,o;return this.getSenders().forEach(s=>{s.track===n&&(i?o=!0:i=s)}),this.getReceivers().forEach(s=>(s.track===n&&(r?o=!0:r=s),s.track===n)),o||i&&r?q.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():r?r.getStats():q.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function sG(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,s){if(!s)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const a=t.apply(this,arguments);return this._shimmedLocalStreams[s.id]?-1===this._shimmedLocalStreams[s.id].indexOf(a)&&this._shimmedLocalStreams[s.id].push(a):this._shimmedLocalStreams[s.id]=[s,a],a};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(d=>d.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const s=this.getSenders();n.apply(this,arguments);const a=this.getSenders().filter(c=>-1===s.indexOf(c));this._shimmedLocalStreams[o.id]=[o].concat(a)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(s=>{const a=this._shimmedLocalStreams[s].indexOf(o);-1!==a&&this._shimmedLocalStreams[s].splice(a,1),1===this._shimmedLocalStreams[s].length&&delete this._shimmedLocalStreams[s]}),r.apply(this,arguments)}}function aG(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return sG(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const c=n.apply(this);return this._reverseStreams=this._reverseStreams||{},c.map(l=>this._reverseStreams[l.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.getTracks().forEach(l=>{if(this.getSenders().find(u=>u.track===l))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c.id]){const l=new e.MediaStream(c.getTracks());this._streams[c.id]=l,this._reverseStreams[l.id]=c,c=l}i.apply(this,[c])};const r=e.RTCPeerConnection.prototype.removeStream;function o(c,l){let d=l.sdp;return Object.keys(c._reverseStreams||[]).forEach(u=>{const h=c._reverseStreams[u];d=d.replace(new RegExp(c._streams[h.id].id,"g"),h.id)}),new RTCSessionDescription({type:l.type,sdp:d})}e.RTCPeerConnection.prototype.removeStream=function(c){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[c.id]||c]),delete this._reverseStreams[this._streams[c.id]?this._streams[c.id].id:c.id],delete this._streams[c.id]},e.RTCPeerConnection.prototype.addTrack=function(c,l){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const d=[].slice.call(arguments,1);if(1!==d.length||!d[0].getTracks().find(p=>p===c))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(p=>p.track===c))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const h=this._streams[l.id];if(h)h.addTrack(c),q.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const p=new e.MediaStream([c]);this._streams[l.id]=p,this._reverseStreams[p.id]=l,this.addStream(p)}return this.getSenders().find(p=>p.track===c)},["createOffer","createAnswer"].forEach(function(c){const l=e.RTCPeerConnection.prototype[c],d={[c](){const u=arguments;return arguments.length&&"function"==typeof arguments[0]?l.apply(this,[h=>{const p=o(this,h);u[0].apply(null,[p])},h=>{u[1]&&u[1].apply(null,h)},arguments[2]]):l.apply(this,arguments).then(h=>o(this,h))}};e.RTCPeerConnection.prototype[c]=d[c]});const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(c,l){let d=l.sdp;return Object.keys(c._reverseStreams||[]).forEach(u=>{const h=c._reverseStreams[u],p=c._streams[h.id];d=d.replace(new RegExp(h.id,"g"),p.id)}),new RTCSessionDescription({type:l.type,sdp:d})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const c=a.get.apply(this);return""===c.type?c:o(this,c)}}),e.RTCPeerConnection.prototype.removeTrack=function(c){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(c._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let l;this._streams=this._streams||{},Object.keys(this._streams).forEach(d=>{this._streams[d].getTracks().find(u=>c.track===u)&&(l=this._streams[d])}),l&&(1===l.getTracks().length?this.removeStream(this._reverseStreams[l.id]):l.removeTrack(c.track),this.dispatchEvent(new Event("negotiationneeded")))}}function iO(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=e.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new("addIceCandidate"===n?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=r[n]})}function cG(e,t){ud(e,"negotiationneeded",n=>{const i=n.target;if(!(t.version<72||i.getConfiguration&&"plan-b"===i.getConfiguration().sdpSemantics)||"stable"===i.signalingState)return n})}var lG=Object.freeze({__proto__:null,fixNegotiationNeeded:cG,shimAddTrackRemoveTrack:aG,shimAddTrackRemoveTrackWithNative:sG,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(i=>{const r=n.video&&n.video.width,o=n.video&&n.video.height;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:n.video&&n.video.frameRate||3}},r&&(n.video.mandatory.maxWidth=r),o&&(n.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:iG,shimGetStats:rG,shimGetUserMedia:eG,shimMediaStream:tG,shimOnTrack:nG,shimPeerConnection:iO,shimSenderReceiverGetStats:oG});function dG(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(r,o,s){tD("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(o,s)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(s,a,c){a in s&&!(c in s)&&(s[c]=s[a],delete s[a])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(s){return"object"==typeof s&&"object"==typeof s.audio&&(s=JSON.parse(JSON.stringify(s)),r(s.audio,"autoGainControl","mozAutoGainControl"),r(s.audio,"noiseSuppression","mozNoiseSuppression")),o(s)},i&&i.prototype.getSettings){const s=i.prototype.getSettings;i.prototype.getSettings=function(){const a=s.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const s=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return"audio"===this.kind&&"object"==typeof a&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[a])}}}}function uG(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function rO(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const o=e.RTCPeerConnection.prototype[r],s={[r](){return arguments[0]=new("addIceCandidate"===r?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=s[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,o,s]=arguments;return i.apply(this,[r||null]).then(a=>{if(t.version<53&&!o)try{a.forEach(c=>{c.type=n[c.type]||c.type})}catch(c){if("TypeError"!==c.name)throw c;a.forEach((l,d)=>{a.set(d,Object.assign({},l,{type:n[l.type]||l.type}))})}return a}).then(o,s)}}function hG(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(r=>r._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):q.resolve(new Map)}}function pG(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n}),ud(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function fG(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){tD("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&Y(i=t.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function mG(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function gG(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;void 0===n&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=t.apply(this,arguments);if(i){const{sender:o}=r,s=o.getParameters();(!("encodings"in s)||1===s.encodings.length&&0===Object.keys(s.encodings[0]).length)&&(s.encodings=n,o.sendEncodings=n,this.setParametersPromises.push(o.setParameters(s).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return r})}function _G(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function vG(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?q.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function EG(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?q.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var bG=Object.freeze({__proto__:null,shimAddTransceiver:gG,shimCreateAnswer:EG,shimCreateOffer:vG,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,q.reject(i)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:_G,shimGetUserMedia:dG,shimOnTrack:uG,shimPeerConnection:rO,shimRTCDataChannel:mG,shimReceiverGetStats:pG,shimRemoveStream:fG,shimSenderGetStats:hG});function yG(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),Y(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>t.call(this,r,n)),n.getVideoTracks().forEach(r=>t.call(this,r,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return r&&r.forEach(s=>{var a;this._localStreams?Y(a=this._localStreams).call(a,s)||this._localStreams.push(s):this._localStreams=[s]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(-1===n)return;this._localStreams.splice(n,1);const i=t.getTracks();this.getSenders().forEach(r=>{Y(i).call(i,r.track)&&this.removeTrack(r)})})}}function SG(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{var o;if(this._remoteStreams||(this._remoteStreams=[]),Y(o=this._remoteStreams).call(o,r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(r=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(r)>=0)return;n._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,n.dispatchEvent(o)})}),t.apply(n,arguments)}}}function CG(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(c,l){const u=n.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return l?(u.then(c,l),q.resolve()):u},t.createAnswer=function(c,l){const u=i.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return l?(u.then(c,l),q.resolve()):u};let a=function(c,l,d){const u=r.apply(this,[c]);return d?(u.then(l,d),q.resolve()):u};t.setLocalDescription=a,a=function(c,l,d){const u=o.apply(this,[c]);return d?(u.then(l,d),q.resolve()):u},t.setRemoteDescription=a,a=function(c,l,d){const u=s.apply(this,[c]);return d?(u.then(l,d),q.resolve()):u},t.addIceCandidate=a}function TG(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=r=>i(wG(r))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(n,i,r){t.mediaDevices.getUserMedia(n).then(i,r)}.bind(t))}function wG(e){return e&&void 0!==e.video?Object.assign({},e,{video:o6(e.video)}):e}function IG(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const r=[];for(let o=0;o<n.iceServers.length;o++){let s=n.iceServers[o];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(tD("RTCIceServer.url","RTCIceServer.urls"),s=JSON.parse(JSON.stringify(s)),s.urls=s.url,delete s.url,r.push(s)):r.push(n.iceServers[o])}n.iceServers=r}return new t(n,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function RG(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function AG(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){void 0!==n.offerToReceiveAudio&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(o=>"audio"===o.receiver.track.kind);!1===n.offerToReceiveAudio&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==n.offerToReceiveAudio||i||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==n.offerToReceiveVideo&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const r=this.getTransceivers().find(o=>"video"===o.receiver.track.kind);!1===n.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==n.offerToReceiveVideo||r||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function DG(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var e,OG=Object.freeze({__proto__:null,shimAudioContext:DG,shimCallbacksAPI:CG,shimConstraints:wG,shimCreateOfferLegacy:AG,shimGetUserMedia:TG,shimLocalStreamsAPI:yG,shimRTCIceServerUrls:IG,shimRemoteStreamsAPI:SG,shimTrackEventTransceiver:RG}),NG="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",qAe=Ch,YAe=wo,oO=NG,PG=_n("".replace),$Ae=RegExp("^["+oO+"]+"),XAe=RegExp("(^|[^"+oO+"])["+oO+"]+$"),sO=function(e){return function(t){var n=YAe(qAe(t));return 1&e&&(n=PG(n,$Ae,"")),2&e&&(n=PG(n,XAe,"$1")),n}},ZAe={start:sO(1),end:sO(2),trim:sO(3)},JAe=x6.PROPER,MG=NG,eDe=ZAe.trim;it({target:"String",proto:!0,forced:(e="trim",Sn(function(){return!!MG[e]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[e]()||JAe&&MG[e].name!==e}))},{trim:function(){return eDe(this)}});var tDe=Yo("String").trim,nDe=Ki,iDe=tDe,aO=String.prototype,ki=Vt(function(e){var t=e.trim;return"string"==typeof e||e===aO||nDe(aO,e)&&t===aO.trim?iDe:t}),xG={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split("\n").map(i=>i.trim())},t.splitSections=function(n){return n.split("\nm=").map((i,r)=>(r>0?"m="+i:i).trim()+"\r\n")},t.getDescription=function(n){const i=t.splitSections(n);return i&&i[0]},t.getMediaSections=function(n){const i=t.splitSections(n);return i.shift(),i},t.matchPrefix=function(n,i){return t.splitLines(n).filter(r=>0===r.indexOf(i))},t.parseCandidate=function(n){let i;i=0===n.indexOf("a=candidate:")?n.substring(12).split(" "):n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let o=8;o<i.length;o+=2)switch(i[o]){case"raddr":r.relatedAddress=i[o+1];break;case"rport":r.relatedPort=parseInt(i[o+1],10);break;case"tcptype":r.tcpType=i[o+1];break;case"ufrag":r.ufrag=i[o+1],r.usernameFragment=i[o+1];break;default:void 0===r[i[o]]&&(r[i[o]]=i[o+1])}return r},t.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;i.push("rtp"===r?1:"rtcp"===r?2:r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const o=n.type;return i.push("typ"),i.push(o),"host"!==o&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&"tcp"===n.protocol.toLowerCase()&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=3===i.length?parseInt(i[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(n){let i=n.payloadType;void 0!==n.preferredPayloadType&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(1!==r?"/"+r:"")+"\r\n"},t.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&"sendrecv"!==n.direction?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+"\r\n"},t.parseFmtp=function(n){const i={};let r;const o=n.substring(n.indexOf(" ")+1).split(";");for(let s=0;s<o.length;s++)r=o[s].trim().split("="),i[r[0].trim()]=r[1];return i},t.writeFmtp=function(n){let i="",r=n.payloadType;if(void 0!==n.preferredPayloadType&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const o=[];Object.keys(n.parameters).forEach(s=>{o.push(void 0!==n.parameters[s]?s+"="+n.parameters[s]:s)}),i+="a=fmtp:"+r+" "+o.join(";")+"\r\n"}return i},t.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(n){let i="",r=n.payloadType;return void 0!==n.preferredPayloadType&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(o=>{i+="a=rtcp-fb:"+r+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+"\r\n"}),i},t.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},o=n.indexOf(":",i);return o>-1?(r.attribute=n.substring(i+1,o),r.value=n.substring(o+1)):r.attribute=n.substring(i+1),r},t.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},t.getMid=function(n){const i=t.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:t.matchPrefix(n+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,i){let r="a=setup:"+i+"\r\n";return n.fingerprints.forEach(o=>{r+="a=fingerprint:"+o.algorithm+" "+o.value+"\r\n"}),r},t.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+("object"==typeof n.keyParams?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(n){if(0!==n.indexOf("inline:"))return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,i){return t.matchPrefix(n+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,i){const r=t.matchPrefix(n+i,"a=ice-ufrag:")[0],o=t.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substring(12),password:o.substring(10)}:null},t.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+"\r\na=ice-pwd:"+n.password+"\r\n";return n.iceLite&&(i+="a=ice-lite\r\n"),i},t.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(n)[0].split(" ");i.profile=r[2];for(let s=3;s<r.length;s++){const a=r[s],c=t.matchPrefix(n,"a=rtpmap:"+a+" ")[0];if(c){const l=t.parseRtpMap(c),d=t.matchPrefix(n,"a=fmtp:"+a+" ");switch(l.parameters=d.length?t.parseFmtp(d[0]):{},l.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+a+" ").map(t.parseRtcpFb),i.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(l.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(s=>{i.headerExtensions.push(t.parseExtmap(s))});const o=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(s=>{o.forEach(a=>{s.rtcpFeedback.find(c=>c.type===a.type&&c.parameter===a.parameter)||s.rtcpFeedback.push(a)})}),i},t.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(s=>void 0!==s.preferredPayloadType?s.preferredPayloadType:s.payloadType).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",i.codecs.forEach(s=>{r+=t.writeRtpMap(s),r+=t.writeFmtp(s),r+=t.writeRtcpFb(s)});let o=0;return i.codecs.forEach(s=>{s.maxptime>o&&(o=s.maxptime)}),o>0&&(r+="a=maxptime:"+o+"\r\n"),i.headerExtensions&&i.headerExtensions.forEach(s=>{r+=t.writeExtmap(s)}),r},t.parseRtpEncodingParameters=function(n){const i=[],r=t.parseRtpParameters(n),o=-1!==r.fecMechanisms.indexOf("RED"),s=-1!==r.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(n,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>"cname"===h.attribute),c=a.length>0&&a[0].ssrc;let l;const d=t.matchPrefix(n,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(p=>parseInt(p,10)));d.length>0&&d[0].length>1&&d[0][0]===c&&(l=d[0][1]),r.codecs.forEach(h=>{if("RTX"===h.name.toUpperCase()&&h.parameters.apt){let p={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&l&&(p.rtx={ssrc:l}),i.push(p),o&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},i.push(p))}}),0===i.length&&c&&i.push({ssrc:c});let u=t.matchPrefix(n,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,i.forEach(h=>{h.maxBitrate=u})),i},t.parseRtcpParameters=function(n){const i={},r=t.matchPrefix(n,"a=ssrc:").map(a=>t.parseSsrcMedia(a)).filter(a=>"cname"===a.attribute)[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const o=t.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=o.length>0,i.compound=0===o.length;const s=t.matchPrefix(n,"a=rtcp-mux");return i.mux=s.length>0,i},t.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+="a=rtcp-rsize\r\n"),n.mux&&(i+="a=rtcp-mux\r\n"),void 0!==n.ssrc&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+"\r\n"),i},t.parseMsid=function(n){let i;const r=t.matchPrefix(n,"a=msid:");if(1===r.length)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const o=t.matchPrefix(n,"a=ssrc:").map(s=>t.parseSsrcMedia(s)).filter(s=>"msid"===s.attribute);return o.length>0?(i=o[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(n){const i=t.parseMLine(n),r=t.matchPrefix(n,"a=max-message-size:");let o;r.length>0&&(o=parseInt(r[0].substring(19),10)),isNaN(o)&&(o=65536);const s=t.matchPrefix(n,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:i.fmt,maxMessageSize:o};const a=t.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},t.writeSctpDescription=function(n,i){let r=[];return r="DTLS/SCTP"!==n.protocol?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+i.port+"\r\n"]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+i.port+" "+i.protocol+" 65535\r\n"],void 0!==i.maxMessageSize&&r.push("a=max-message-size:"+i.maxMessageSize+"\r\n"),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,i,r){let o;const s=void 0!==i?i:2;return o=n||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+o+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(n,i){const r=t.splitLines(n);for(let o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return"0"===n.split(" ",2)[1]},t.parseMLine=function(n){const i=t.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if("string"!=typeof n||0===n.length)return!1;const i=t.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||"="!==i[r].charAt(1))return!1;return!0},e.exports=t}(xG);var kG=xG.exports,Vh=Vt(kG),oDe=function wSe(e,t){return t.forEach(function(n){n&&"string"!=typeof n&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if("default"!==i&&!(i in e)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(e)}({__proto__:null,default:Vh},[kG]);function Ay(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if("object"==typeof n&&n.candidate&&0===n.candidate.indexOf("a=")&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new t(n),r=Vh.parseCandidate(n.candidate),o=Object.assign(i,r);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,ud(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function cO(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||ud(e,"icecandidate",t=>{if(t.candidate){const n=Vh.parseCandidate(t.candidate.candidate);"relay"===n.type&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function Dy(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:a}=this.getConfiguration();"plan-b"===a&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(a){if(!a||!a.sdp)return!1;const c=Vh.splitSections(a.sdp);return c.shift(),c.some(l=>{const d=Vh.parseMLine(l);return d&&"application"===d.kind&&-1!==d.protocol.indexOf("SCTP")})}(arguments[0])){const a=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===c||c.length<2)return-1;const l=parseInt(c[1],10);return l!=l?-1:l}(arguments[0]),c=function(a){let c=65536;return"firefox"===t.browser&&(c=t.version<57?-1===a?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),c}(a),l=function(a,c){let l=65536;"firefox"===t.browser&&57===t.version&&(l=65535);const d=Vh.matchPrefix(a.sdp,"a=max-message-size:");return d.length>0?l=parseInt(d[0].substr(19),10):"firefox"===t.browser&&-1!==c&&(l=2147483637),l}(arguments[0],a);let d;d=0===c&&0===l?Number.POSITIVE_INFINITY:0===c||0===l?Math.max(c,l):Math.min(c,l);const u={};Object.defineProperty(u,"maxMessageSize",{get:()=>d}),this._sctp=u}return s.apply(this,arguments)}}function Oy(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,r){const o=i.send;i.send=function(){const s=arguments[0];if("open"===i.readyState&&r.sctp&&(s.length||s.size||s.byteLength)>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return o.apply(i,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},ud(e,"datachannel",i=>(t(i.channel,i.target),i))}function lO(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const o=r.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const s=new Event("connectionstatechange",r);o.dispatchEvent(s)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function dO(e,t){if(!e.RTCPeerConnection||"chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&-1!==i.sdp.indexOf("\na=extmap-allow-mixed")){const r=i.sdp.split("\n").filter(o=>"a=extmap-allow-mixed"!==ki(o).call(o)).join("\n");e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:r}):i.sdp=r}return n.apply(this,arguments)}}function Ny(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?q.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),q.resolve())})}function Py(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if("object"!=typeof i||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||"offer"!==i.type&&"answer"!==i.type?n.apply(this,[i]):("offer"===i.type?this.createOffer:this.createAnswer).apply(this).then(r=>n.apply(this,[r]))})}var sDe=Object.freeze({__proto__:null,removeExtmapAllowMixed:dO,shimAddIceCandidateNullOrEmpty:Ny,shimConnectionState:lO,shimMaxMessageSize:Dy,shimParameterlessSetLocalDescription:Py,shimRTCIceCandidate:Ay,shimRTCIceCandidateRelayProtocol:cO,shimSendThrowTypeError:Oy});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=i6,i=function(o){const s={browser:null,version:null};if(void 0===o||!o.navigator)return s.browser="Not a browser.",s;const{navigator:a}=o;if(a.mozGetUserMedia)s.browser="firefox",s.version=iy(a.userAgent,/Firefox\/(\d+)\./,1);else if(a.webkitGetUserMedia||!1===o.isSecureContext&&o.webkitRTCPeerConnection)s.browser="chrome",s.version=iy(a.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!o.RTCPeerConnection||!a.userAgent.match(/AppleWebKit\/(\d+)\./))return s.browser="Not a supported browser.",s;s.browser="safari",s.version=iy(a.userAgent,/AppleWebKit\/(\d+)\./,1),s.supportsUnifiedPlan=o.RTCRtpTransceiver&&"currentDirection"in o.RTCRtpTransceiver.prototype}return s}(e),r={browserDetails:i,commonShim:sDe,extractVersion:iy,disableLog:r0e,disableWarnings:o0e,sdp:oDe};switch(i.browser){case"chrome":if(!lG||!iO||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=lG,Ny(e,i),Py(e),eG(e,i),tG(e),iO(e,i),nG(e),aG(e,i),iG(e),rG(e),oG(e),cG(e,i),Ay(e),cO(e),lO(e),Dy(e,i),Oy(e),dO(e,i);break;case"firefox":if(!bG||!rO||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=bG,Ny(e,i),Py(e),dG(e,i),rO(e,i),uG(e),fG(e),hG(e),pG(e),mG(e),gG(e),_G(e),vG(e),EG(e),Ay(e),lO(e),Dy(e,i),Oy(e);break;case"safari":if(!OG||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=OG,Ny(e,i),Py(e),IG(e),AG(e),CG(e),yG(e),SG(e),RG(e),TG(e),DG(e),Ay(e),cO(e),Dy(e,i),Oy(e),dO(e,i);break;default:n("Unsupported browser!")}}({window:typeof window>"u"?void 0:window});var aDe=Yo("Array").keys,cDe=ga,lDe=mi,dDe=Ki,uDe=aDe,uO=Array.prototype,hDe={DOMTokenList:!0,NodeList:!0},Zr=Vt(function(e){var t=e.keys;return e===uO||dDe(uO,e)&&t===uO.keys||lDe(hDe,cDe(e))?uDe:t}),LG=wh,fDe=TypeError,mDe=Jb,gDe=qo,_De=qc,My=function(e,t,n){var i=mDe(t);i in e?gDe.f(e,i,_De(0,n)):e[i]=n},FG=$A,vDe=oc,EDe=My,bDe=Array,yDe=Math.max,hO=function(e,t,n){for(var i=vDe(e),r=FG(t,i),o=FG(void 0===n?i:n,i),s=bDe(yDe(o-r,0)),a=0;r<o;r++,a++)EDe(s,a,e[r]);return s.length=a,s},UG=hO,SDe=Math.floor,pO=function(e,t){var n=e.length,i=SDe(n/2);return n<8?CDe(e,t):TDe(e,pO(UG(e,0,i),t),pO(UG(e,i),t),t)},CDe=function(e,t){for(var n,i,r=e.length,o=1;o<r;){for(i=o,n=e[o];i&&t(e[i-1],n)>0;)e[i]=e[--i];i!==o++&&(e[i]=n)}return e},TDe=function(e,t,n,i){for(var r=t.length,o=n.length,s=0,a=0;s<r||a<o;)e[s+a]=s<r&&a<o?i(t[s],n[a])<=0?t[s++]:n[a++]:s<r?t[s++]:n[a++];return e},VG=pO,BG=$c.match(/firefox\/(\d+)/i),wDe=!!BG&&+BG[1],IDe=/MSIE|Trident/.test($c),jG=$c.match(/AppleWebKit\/(\d+)\./),ADe=it,HG=_n,DDe=To,ODe=ma,GG=oc,NDe=function(e,t){if(!delete e[t])throw fDe("Cannot delete property "+LG(t)+" of "+LG(e))},WG=wo,fO=Sn,PDe=VG,MDe=ny,zG=wDe,xDe=IDe,KG=dd,qG=!!jG&&+jG[1],tl=[],YG=HG(tl.sort),kDe=HG(tl.push),LDe=fO(function(){tl.sort(void 0)}),FDe=fO(function(){tl.sort(null)}),UDe=MDe("sort"),$G=!fO(function(){if(KG)return KG<70;if(!(zG&&zG>3)){if(xDe)return!0;if(qG)return qG<603;var e,t,n,i,r="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)tl.push({k:t+i,v:n})}for(tl.sort(function(o,s){return s.v-o.v}),i=0;i<tl.length;i++)t=tl[i].k.charAt(0),r.charAt(r.length-1)!==t&&(r+=t);return"DGBEFHACIJK"!==r}});ADe({target:"Array",proto:!0,forced:LDe||!FDe||!UDe||!$G},{sort:function(e){void 0!==e&&DDe(e);var t=ODe(this);if($G)return void 0===e?YG(t):YG(t,e);var n,i,r=[],o=GG(t);for(i=0;i<o;i++)i in t&&kDe(r,t[i]);for(PDe(r,function(s){return function(a,c){return void 0===c?-1:void 0===a?1:void 0!==s?+s(a,c)||0:WG(a)>WG(c)?1:-1}}(e)),n=GG(r),i=0;i<n;)t[i]=r[i++];for(;i<o;)NDe(t,i++);return t}});var mO,gO,VDe=Yo("Array").sort,BDe=Ki,jDe=VDe,_O=Array.prototype,gg=Vt(function(e){var t=e.sort;return e===_O||BDe(_O,e)&&t===_O.sort?jDe:t}),vO={exports:{}};mO=vO,gO=vO.exports,function(e,t){var n="function",i="undefined",r="object",o="string",s="major",a="model",c="name",l="type",d="vendor",u="version",h="architecture",p="console",m="mobile",f="tablet",g="smarttv",E="wearable",b="embedded",T="Amazon",I="Apple",D="ASUS",O="BlackBerry",k="Browser",L="Chrome",V="Firefox",ee="Google",Ue="Microsoft",Dt="Motorola",dt="Opera",me="Samsung",P="Sharp",F="Sony",G="Xiaomi",U="Zebra",v="Facebook",w="Chromium OS",A="Mac OS",B=function(tn){for(var bn={},Tt=0;Tt<tn.length;Tt++)bn[tn[Tt].toUpperCase()]=tn[Tt];return bn},ge=function(tn,bn){return typeof tn===o&&-1!==Ze(bn).indexOf(Ze(tn))},Ze=function(tn){return tn.toLowerCase()},nt=function(tn,bn){if(typeof tn===o)return tn=tn.replace(/^\s\s*/,""),typeof bn===i?tn:tn.substring(0,350)},Hn=function(tn,bn){for(var Tt,Ur,Ua,nn,ze,yr,Dl=0;Dl<bn.length&&!ze;){var Ws=bn[Dl],fJ=bn[Dl+1];for(Tt=Ur=0;Tt<Ws.length&&!ze&&Ws[Tt];)if(ze=Ws[Tt++].exec(tn))for(Ua=0;Ua<fJ.length;Ua++)yr=ze[++Ur],typeof(nn=fJ[Ua])===r&&nn.length>0?2===nn.length?this[nn[0]]=typeof nn[1]==n?nn[1].call(this,yr):nn[1]:3===nn.length?this[nn[0]]=typeof nn[1]!==n||nn[1].exec&&nn[1].test?yr?yr.replace(nn[1],nn[2]):t:yr?nn[1].call(this,yr,nn[2]):t:4===nn.length&&(this[nn[0]]=yr?nn[3].call(this,yr.replace(nn[1],nn[2])):t):this[nn]=yr||t;Dl+=2}},ai=function(tn,bn){for(var Tt in bn)if(typeof bn[Tt]===r&&bn[Tt].length>0){for(var Ur=0;Ur<bn[Tt].length;Ur++)if(ge(bn[Tt][Ur],tn))return"?"===Tt?t:Tt}else if(ge(bn[Tt],tn))return"?"===Tt?t:Tt;return tn},yc={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Rl={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[u,[c,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[u,[c,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[c,u],[/opios[\/ ]+([\w\.]+)/i],[u,[c,dt+" Mini"]],[/\bopr\/([\w\.]+)/i],[u,[c,dt]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[c,u],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[u,[c,"UC"+k]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[u,[c,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[u,[c,"WeChat"]],[/konqueror\/([\w\.]+)/i],[u,[c,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[u,[c,"IE"]],[/yabrowser\/([\w\.]+)/i],[u,[c,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[c,/(.+)/,"$1 Secure "+k],u],[/\bfocus\/([\w\.]+)/i],[u,[c,V+" Focus"]],[/\bopt\/([\w\.]+)/i],[u,[c,dt+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[u,[c,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[u,[c,"Dolphin"]],[/coast\/([\w\.]+)/i],[u,[c,dt+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[u,[c,"MIUI "+k]],[/fxios\/([-\w\.]+)/i],[u,[c,V]],[/\bqihu|(qi?ho?o?|360)browser/i],[[c,"360 "+k]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[c,/(.+)/,"$1 "+k],u],[/(comodo_dragon)\/([\w\.]+)/i],[[c,/_/g," "],u],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[c,u],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[c],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[c,v],u],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[c,u],[/\bgsa\/([\w\.]+) .*safari\//i],[u,[c,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[u,[c,L+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[c,L+" WebView"],u],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[u,[c,"Android "+k]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[c,u],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[u,[c,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[u,c],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[c,[u,ai,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[c,u],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[c,"Netscape"],u],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[u,[c,V+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[c,u],[/(cobalt)\/([\w\.]+)/i],[c,[u,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[h,"amd64"]],[/(ia32(?=;))/i],[[h,Ze]],[/((?:i[346]|x)86)[;\)]/i],[[h,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[h,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[h,"armhf"]],[/windows (ce|mobile); ppc;/i],[[h,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[h,/ower/,"",Ze]],[/(sun4\w)[;\)]/i],[[h,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[h,Ze]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[a,[d,me],[l,f]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[a,[d,me],[l,m]],[/\((ip(?:hone|od)[\w ]*);/i],[a,[d,I],[l,m]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[a,[d,I],[l,f]],[/(macintosh);/i],[a,[d,I]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[a,[d,P],[l,m]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[a,[d,"Huawei"],[l,f]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[a,[d,"Huawei"],[l,m]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[a,/_/g," "],[d,G],[l,m]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[a,/_/g," "],[d,G],[l,f]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[a,[d,"OPPO"],[l,m]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[a,[d,"Vivo"],[l,m]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[a,[d,"Realme"],[l,m]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[a,[d,Dt],[l,m]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[a,[d,Dt],[l,f]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[a,[d,"LG"],[l,f]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[a,[d,"LG"],[l,m]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[a,[d,"Lenovo"],[l,f]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[a,/_/g," "],[d,"Nokia"],[l,m]],[/(pixel c)\b/i],[a,[d,ee],[l,f]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[a,[d,ee],[l,m]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[a,[d,F],[l,m]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[a,"Xperia Tablet"],[d,F],[l,f]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[a,[d,"OnePlus"],[l,m]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[a,[d,T],[l,f]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[a,/(.+)/g,"Fire Phone $1"],[d,T],[l,m]],[/(playbook);[-\w\),; ]+(rim)/i],[a,d,[l,f]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[a,[d,O],[l,m]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[a,[d,D],[l,f]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[a,[d,D],[l,m]],[/(nexus 9)/i],[a,[d,"HTC"],[l,f]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[d,[a,/_/g," "],[l,m]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[a,[d,"Acer"],[l,f]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[a,[d,"Meizu"],[l,m]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[d,a,[l,m]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[d,a,[l,f]],[/(surface duo)/i],[a,[d,Ue],[l,f]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[a,[d,"Fairphone"],[l,m]],[/(u304aa)/i],[a,[d,"AT&T"],[l,m]],[/\bsie-(\w*)/i],[a,[d,"Siemens"],[l,m]],[/\b(rct\w+) b/i],[a,[d,"RCA"],[l,f]],[/\b(venue[\d ]{2,7}) b/i],[a,[d,"Dell"],[l,f]],[/\b(q(?:mv|ta)\w+) b/i],[a,[d,"Verizon"],[l,f]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[a,[d,"Barnes & Noble"],[l,f]],[/\b(tm\d{3}\w+) b/i],[a,[d,"NuVision"],[l,f]],[/\b(k88) b/i],[a,[d,"ZTE"],[l,f]],[/\b(nx\d{3}j) b/i],[a,[d,"ZTE"],[l,m]],[/\b(gen\d{3}) b.+49h/i],[a,[d,"Swiss"],[l,m]],[/\b(zur\d{3}) b/i],[a,[d,"Swiss"],[l,f]],[/\b((zeki)?tb.*\b) b/i],[a,[d,"Zeki"],[l,f]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[d,"Dragon Touch"],a,[l,f]],[/\b(ns-?\w{0,9}) b/i],[a,[d,"Insignia"],[l,f]],[/\b((nxa|next)-?\w{0,9}) b/i],[a,[d,"NextBook"],[l,f]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[d,"Voice"],a,[l,m]],[/\b(lvtel\-)?(v1[12]) b/i],[[d,"LvTel"],a,[l,m]],[/\b(ph-1) /i],[a,[d,"Essential"],[l,m]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[a,[d,"Envizen"],[l,f]],[/\b(trio[-\w\. ]+) b/i],[a,[d,"MachSpeed"],[l,f]],[/\btu_(1491) b/i],[a,[d,"Rotor"],[l,f]],[/(shield[\w ]+) b/i],[a,[d,"Nvidia"],[l,f]],[/(sprint) (\w+)/i],[d,a,[l,m]],[/(kin\.[onetw]{3})/i],[[a,/\./g," "],[d,Ue],[l,m]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[a,[d,U],[l,f]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[a,[d,U],[l,m]],[/smart-tv.+(samsung)/i],[d,[l,g]],[/hbbtv.+maple;(\d+)/i],[[a,/^/,"SmartTV"],[d,me],[l,g]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[d,"LG"],[l,g]],[/(apple) ?tv/i],[d,[a,I+" TV"],[l,g]],[/crkey/i],[[a,L+"cast"],[d,ee],[l,g]],[/droid.+aft(\w)( bui|\))/i],[a,[d,T],[l,g]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[a,[d,P],[l,g]],[/(bravia[\w ]+)( bui|\))/i],[a,[d,F],[l,g]],[/(mitv-\w{5}) bui/i],[a,[d,G],[l,g]],[/Hbbtv.*(technisat) (.*);/i],[d,a,[l,g]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[d,nt],[a,nt],[l,g]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[l,g]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[d,a,[l,p]],[/droid.+; (shield) bui/i],[a,[d,"Nvidia"],[l,p]],[/(playstation [345portablevi]+)/i],[a,[d,F],[l,p]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[a,[d,Ue],[l,p]],[/((pebble))app/i],[d,a,[l,E]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[a,[d,I],[l,E]],[/droid.+; (glass) \d/i],[a,[d,ee],[l,E]],[/droid.+; (wt63?0{2,3})\)/i],[a,[d,U],[l,E]],[/(quest( 2| pro)?)/i],[a,[d,v],[l,E]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[d,[l,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[a,[l,m]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[a,[l,f]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[l,f]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[l,m]],[/(android[-\w\. ]{0,9});.+buil/i],[a,[d,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[u,[c,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[u,[c,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[c,u],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[u,c]],os:[[/microsoft (windows) (vista|xp)/i],[c,u],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[c,[u,ai,yc]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[c,"Windows"],[u,ai,yc]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[u,/_/g,"."],[c,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[c,A],[u,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[u,c],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[c,u],[/\(bb(10);/i],[u,[c,O]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[u,[c,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[u,[c,V+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[u,[c,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[u,[c,"watchOS"]],[/crkey\/([\d\.]+)/i],[u,[c,L+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[c,w],u],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[c,u],[/(sunos) ?([\w\.\d]*)/i],[[c,"Solaris"],u],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[c,u]]},Uo=function(tn,bn){if(typeof tn===r&&(bn=tn,tn=t),!(this instanceof Uo))return new Uo(tn,bn).getResult();var Tt=typeof e!==i&&e.navigator?e.navigator:t,Ur=tn||(Tt&&Tt.userAgent?Tt.userAgent:""),Ua=Tt&&Tt.userAgentData?Tt.userAgentData:t,nn=bn?function(ze,yr){var Dl={};for(var Ws in ze)Dl[Ws]=yr[Ws]&&yr[Ws].length%2==0?yr[Ws].concat(ze[Ws]):ze[Ws];return Dl}(Rl,bn):Rl;return this.getBrowser=function(){var yr,ze={};return ze[c]=t,ze[u]=t,Hn.call(ze,Ur,nn.browser),ze[s]=typeof(yr=ze[u])===o?yr.replace(/[^\d\.]/g,"").split(".")[0]:t,Tt&&Tt.brave&&typeof Tt.brave.isBrave==n&&(ze[c]="Brave"),ze},this.getCPU=function(){var ze={};return ze[h]=t,Hn.call(ze,Ur,nn.cpu),ze},this.getDevice=function(){var ze={};return ze[d]=t,ze[a]=t,ze[l]=t,Hn.call(ze,Ur,nn.device),!ze[l]&&Ua&&Ua.mobile&&(ze[l]=m),"Macintosh"==ze[a]&&Tt&&typeof Tt.standalone!==i&&Tt.maxTouchPoints&&Tt.maxTouchPoints>2&&(ze[a]="iPad",ze[l]=f),ze},this.getEngine=function(){var ze={};return ze[c]=t,ze[u]=t,Hn.call(ze,Ur,nn.engine),ze},this.getOS=function(){var ze={};return ze[c]=t,ze[u]=t,Hn.call(ze,Ur,nn.os),!ze[c]&&Ua&&"Unknown"!=Ua.platform&&(ze[c]=Ua.platform.replace(/chrome os/i,w).replace(/macos/i,A)),ze},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ur},this.setUA=function(ze){return Ur=typeof ze===o&&ze.length>350?nt(ze,350):ze,this},this.setUA(Ur),this};Uo.VERSION="0.7.34",Uo.BROWSER=B([c,u,s]),Uo.CPU=B([h]),Uo.DEVICE=B([a,d,l,p,m,g,f,E,b]),Uo.ENGINE=Uo.OS=B([c,u]),mO.exports&&(gO=mO.exports=Uo),gO.UAParser=Uo;var Al=typeof e!==i&&(e.jQuery||e.Zepto);if(Al&&!Al.ua){var Bp=new Uo;Al.ua=Bp.getResult(),Al.ua.get=function(){return Bp.getUA()},Al.ua.set=function(tn){Bp.setUA(tn);var bn=Bp.getResult();for(var Tt in bn)Al.ua[Tt]=bn[Tt]}}}("object"==typeof window?window:yh);var GDe=Vt(vO.exports),WDe=ga,zDe=mi,KDe=Sh,qDe=hd,YDe=cn("iterator"),$De=Object,ZDe=Vt(function(e){if(KDe(e))return!1;var t=$De(e);return void 0!==t[YDe]||"@@iterator"in t||zDe(qDe,WDe(t))});it({global:!0,forced:Pn.globalThis!==Pn},{globalThis:Pn});var XG=Vt(Pn),ZG=yy.clear;it({global:!0,bind:!0,enumerable:!0,forced:Pn.clearImmediate!==ZG},{clearImmediate:ZG});var JDe="function"==typeof Bun&&Bun&&"string"==typeof Bun.version,JG=Pn,QDe=zb,eOe=zn,tOe=JDe,iOe=by,rOe=xh,oOe=JG.Function,sOe=/MSIE .\./.test($c)||tOe&&function(){var e=JG.Bun.version.split(".");return e.length<3||0==e[0]&&(e[1]<3||3==e[1]&&0==e[2])}(),aOe=it,QG=Pn,eW=yy.set,tW=QG.setImmediate?function(e,t){return sOe?function(i,r){var o=rOe(arguments.length,1)>1,s=eOe(i)?i:oOe(i),a=o?iOe(arguments,1):[],c=o?function(){QDe(s,this,a)}:s;return e(c)}:e}(eW):eW;aOe({global:!0,bind:!0,enumerable:!0,forced:QG.setImmediate!==tW},{setImmediate:tW});var nW=Vt(Co.setImmediate),dOe=E8,uOe=To,hOe=xh,pOe=Oh,fOe=Pn.process;it({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(e){hOe(arguments.length,1),uOe(e);var t=pOe&&fOe.domain;dOe(t?t.bind(e):e)}});var iW=Vt(Co.queueMicrotask);function rW(e,t){return function(){return e.apply(t,arguments)}}const{toString:mOe}=Object.prototype,{getPrototypeOf:bO}=Object,xy=(yO=Object.create(null),e=>{const t=mOe.call(e);return yO[t]||(yO[t]=t.slice(8,-1).toLowerCase())});var yO;const Ps=e=>(e=e.toLowerCase(),t=>xy(t)===e),ky=e=>t=>typeof t===e,{isArray:Bh}=Array,_g=ky("undefined"),oW=Ps("ArrayBuffer"),gOe=ky("string"),Ro=ky("function"),sW=ky("number"),Ly=e=>null!==e&&"object"==typeof e,Fy=e=>{if("object"!==xy(e))return!1;const t=bO(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||ZDe(e))},_Oe=Ps("Date"),vOe=Ps("File"),EOe=Ps("Blob"),bOe=Ps("FileList"),yOe=Ps("URLSearchParams"),[SOe,COe,TOe,wOe]=["ReadableStream","Request","Response","Headers"].map(Ps);function vg(e,t){let n,i,{allOwnKeys:r=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=e)if("object"!=typeof e&&(e=[e]),Bh(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const o=r?Object.getOwnPropertyNames(e):Object.keys(e),s=o.length;let a;for(n=0;n<s;n++)a=o[n],t.call(null,e[a],a,e)}}function aW(e,t){t=t.toLowerCase();const n=Object.keys(e);let i,r=n.length;for(;r-- >0;)if(i=n[r],t===i.toLowerCase())return i;return null}const _d=void 0!==XG?XG:typeof self<"u"?self:typeof window<"u"?window:global,cW=e=>!_g(e)&&e!==_d,IOe=(SO=typeof Uint8Array<"u"&&bO(Uint8Array),e=>SO&&e instanceof SO);var SO;const ROe=Ps("HTMLFormElement"),lW=(e=>{let{hasOwnProperty:t}=e;return(n,i)=>t.call(n,i)})(Object.prototype),AOe=Ps("RegExp"),dW=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),i={};vg(n,(r,o)=>{let s;!1!==(s=t(r,o,e))&&(i[o]=s||r)}),Object.defineProperties(e,i)},CO="abcdefghijklmnopqrstuvwxyz",uW="0123456789",hW={DIGIT:uW,ALPHA:CO,ALPHA_DIGIT:CO+CO.toUpperCase()+uW},DOe=Ps("AsyncFunction"),pW=(fW="function"==typeof nW,mW=Ro(_d.postMessage),fW?nW:mW?(TO="axios@".concat(Math.random()),Uy=[],_d.addEventListener("message",e=>{let{source:t,data:n}=e;t===_d&&n===TO&&Uy.length&&Uy.shift()()},!1),e=>{Uy.push(e),_d.postMessage(TO,"*")}):e=>setTimeout(e));var fW,mW,TO,Uy;const OOe=void 0!==iW?iW.bind(_d):typeof process<"u"&&process.nextTick||pW;var z={isArray:Bh,isArrayBuffer:oW,isBuffer:function(e){return null!==e&&!_g(e)&&null!==e.constructor&&!_g(e.constructor)&&Ro(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||Ro(e.append)&&("formdata"===(t=xy(e))||"object"===t&&Ro(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&oW(e.buffer),t},isString:gOe,isNumber:sW,isBoolean:e=>!0===e||!1===e,isObject:Ly,isPlainObject:Fy,isReadableStream:SOe,isRequest:COe,isResponse:TOe,isHeaders:wOe,isUndefined:_g,isDate:_Oe,isFile:vOe,isBlob:EOe,isRegExp:AOe,isFunction:Ro,isStream:e=>Ly(e)&&Ro(e.pipe),isURLSearchParams:yOe,isTypedArray:IOe,isFileList:bOe,forEach:vg,merge:function e(){const{caseless:t}=cW(this)&&this||{},n={},i=(r,o)=>{const s=t&&aW(n,o)||o;n[s]=Fy(n[s])&&Fy(r)?e(n[s],r):Fy(r)?e({},r):Bh(r)?r.slice():r};for(let r=0,o=arguments.length;r<o;r++)arguments[r]&&vg(arguments[r],i);return n},extend:function(e,t,n){let{allOwnKeys:i}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return vg(t,(r,o)=>{e[o]=n&&Ro(r)?rW(r,n):r},{allOwnKeys:i}),e},trim:e=>ki(e)?ki(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,i)=>{let r,o,s;const a={};if(t=t||{},null==e)return t;do{for(r=Object.getOwnPropertyNames(e),o=r.length;o-- >0;)s=r[o],i&&!i(s,e,t)||a[s]||(t[s]=e[s],a[s]=!0);e=!1!==n&&bO(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:xy,kindOfTest:Ps,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length);const i=e.indexOf(t,n-=t.length);return-1!==i&&i===n},toArray:e=>{if(!e)return null;if(Bh(e))return e;let t=e.length;if(!sW(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let i;for(;(i=n.next())&&!i.done;){const r=i.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let n;const i=[];for(;null!==(n=e.exec(t));)i.push(n);return i},isHTMLForm:ROe,hasOwnProperty:lW,hasOwnProp:lW,reduceDescriptors:dW,freezeMethods:e=>{dW(e,(t,n)=>{if(Ro(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;Ro(e[n])&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},i=r=>{r.forEach(o=>{n[o]=!0})};return Bh(e)?i(e):i(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:aW,global:_d,isContextDefined:cW,ALPHABET:hW,generateString:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:hW.ALPHA_DIGIT,n="";const{length:i}=t;for(;e--;)n+=t[Math.random()*i|0];return n},isSpecCompliantForm:function(e){return!!(e&&Ro(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(i,r)=>{if(Ly(i)){if(t.indexOf(i)>=0)return;if(!("toJSON"in i)){t[r]=i;const o=Bh(i)?[]:{};return vg(i,(s,a)=>{const c=n(s,r+1);!_g(c)&&(o[a]=c)}),t[r]=void 0,o}}return i};return n(e,0)},isAsyncFn:DOe,isThenable:e=>e&&(Ly(e)||Ro(e))&&Ro(e.then)&&Ro(e.catch),setImmediate:pW,asap:OOe};function rt(e,t,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}z.inherits(rt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:z.toJSONObject(this.config),code:this.code,status:this.status}}});const gW=rt.prototype,_W={};function wO(e){return z.isPlainObject(e)||z.isArray(e)}function vW(e){return z.endsWith(e,"[]")?e.slice(0,-2):e}function EW(e,t,n){return e?e.concat(t).map(function(i,r){return i=vW(i),!n&&r?"["+i+"]":i}).join(n?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{_W[e]={value:e}}),Object.defineProperties(rt,_W),Object.defineProperty(gW,"isAxiosError",{value:!0}),rt.from=(e,t,n,i,r,o)=>{const s=Object.create(gW);return z.toFlatObject(e,s,function(a){return a!==Error.prototype},a=>"isAxiosError"!==a),rt.call(s,e.message,t,n,i,r),s.cause=e,s.name=e.name,o&&Object.assign(s,o),s};const NOe=z.toFlatObject(z,{},null,function(e){return/^is[A-Z]/.test(e)});function Vy(e,t,n){if(!z.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const i=(n=z.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(h,p){return!z.isUndefined(p[h])})).metaTokens,r=n.visitor||l,o=n.dots,s=n.indexes,a=(n.Blob||typeof Blob<"u"&&Blob)&&z.isSpecCompliantForm(t);if(!z.isFunction(r))throw new TypeError("visitor must be a function");function c(h){if(null===h)return"";if(z.isDate(h))return h.toISOString();if(!a&&z.isBlob(h))throw new rt("Blob is not supported. Use a Buffer instead.");return z.isArrayBuffer(h)||z.isTypedArray(h)?a&&"function"==typeof Blob?new Blob([h]):Buffer.from(h):h}function l(h,p,m){let f=h;if(h&&!m&&"object"==typeof h)if(z.endsWith(p,"{}"))p=i?p:p.slice(0,-2),h=JSON.stringify(h);else if(z.isArray(h)&&z.isArray(g=h)&&!g.some(wO)||(z.isFileList(h)||z.endsWith(p,"[]"))&&(f=z.toArray(h)))return p=vW(p),f.forEach(function(g,E){!z.isUndefined(g)&&null!==g&&t.append(!0===s?EW([p],E,o):null===s?p:p+"[]",c(g))}),!1;var g;return!!wO(h)||(t.append(EW(m,p,o),c(h)),!1)}const d=[],u=Object.assign(NOe,{defaultVisitor:l,convertValue:c,isVisitable:wO});if(!z.isObject(e))throw new TypeError("data must be an object");return function h(p,m){if(!z.isUndefined(p)){if(-1!==d.indexOf(p))throw Error("Circular reference detected in "+m.join("."));d.push(p),z.forEach(p,function(f,g){!0===(!(z.isUndefined(f)||null===f)&&r.call(t,f,z.isString(g)?ki(g).call(g):g,m,u))&&h(f,m?m.concat(g):[g])}),d.pop()}}(e),t}function bW(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function IO(e,t){this._pairs=[],e&&Vy(e,this,t)}const yW=IO.prototype;function POe(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function SW(e,t,n){if(!t)return e;const i=n&&n.encode||POe,r=n&&n.serialize;let o;if(o=r?r(t,n):z.isURLSearchParams(t)?t.toString():new IO(t,n).toString(i),o){const s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}yW.append=function(e,t){this._pairs.push([e,t])},yW.toString=function(e){const t=e?function(n){return e.call(this,n,bW)}:bW;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var CW=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){z.forEach(this.handlers,function(t){null!==t&&e(t)})}},TW={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wW={exports:{}},IW=qo.f;it({target:"Object",stat:!0,forced:Object.defineProperty!==IW,sham:!So},{defineProperty:IW});var RW=Co.Object,kOe=wW.exports=function(e,t,n){return RW.defineProperty(e,t,n)};RW.defineProperty.sham&&(kOe.sham=!0);var AW=Vt(wW.exports),LOe=fa,Eg=Array.isArray||function(e){return"Array"==LOe(e)},FOe=TypeError,DW=Eg,UOe=Ey,VOe=Xr,BOe=cn("species"),OW=Array,NW=function(e,t){return new(function(e){var t;return DW(e)&&(UOe(t=e.constructor)&&(t===OW||DW(t.prototype))||VOe(t)&&null===(t=t[BOe]))&&(t=void 0),void 0===t?OW:t}(e))(0===t?0:t)},HOe=Sn,GOe=dd,WOe=cn("species"),PW=function(e){return GOe>=51||!HOe(function(){var t=[];return(t.constructor={})[WOe]=function(){return{foo:1}},1!==t[e](Boolean).foo})},zOe=it,KOe=Sn,qOe=Eg,YOe=Xr,$Oe=ma,XOe=oc,MW=function(e){if(e>9007199254740991)throw FOe("Maximum allowed index exceeded");return e},xW=My,ZOe=NW,JOe=PW,QOe=dd,kW=cn("isConcatSpreadable"),eNe=QOe>=51||!KOe(function(){var e=[];return e[kW]=!1,e.concat()[0]!==e}),tNe=function(e){if(!YOe(e))return!1;var t=e[kW];return void 0!==t?!!t:qOe(e)};zOe({target:"Array",proto:!0,arity:1,forced:!eNe||!JOe("concat")},{concat:function(e){var t,n,i,r,o,s=$Oe(this),a=ZOe(s,0),c=0;for(t=-1,i=arguments.length;t<i;t++)if(tNe(o=-1===t?s:arguments[t]))for(r=XOe(o),MW(c+r),n=0;n<r;n++,c++)n in o&&xW(a,c,o[n]);else MW(c+1),xW(a,c++,o);return a.length=c,a}});var LW={},nNe=fa,iNe=Yc,FW=oy.f,rNe=hO,UW="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];LW.f=function(e){return UW&&"Window"==nNe(e)?function(t){try{return FW(t)}catch{return rNe(UW)}}(e):FW(iNe(e))};var jh={};jh.f=cn;var VW=Co,sNe=mi,aNe=jh,cNe=qo.f,ei=function(e){var t=VW.Symbol||(VW.Symbol={});sNe(t,e)||cNe(t,e,{value:aNe.f(e)})},lNe=Qn,dNe=Nr,uNe=cn,hNe=Jc,BW=function(){var e=dNe("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,i=uNe("toPrimitive");t&&!t[i]&&hNe(t,i,function(r){return lNe(n,this)},{arity:1})},pNe=Xc,fNe=Xb,mNe=ma,gNe=oc,_Ne=NW,jW=_n([].push),nl=function(e){var t=1==e,n=2==e,i=3==e,r=4==e,o=6==e,s=7==e,a=5==e||o;return function(c,l,d,u){for(var h,p,m=mNe(c),f=fNe(m),g=pNe(l,d),E=gNe(f),b=0,T=u||_Ne,I=t?T(c,E):n||s?T(c,0):void 0;E>b;b++)if((a||b in f)&&(p=g(h=f[b],b,m),e))if(t)I[b]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return b;case 2:jW(I,h)}else switch(e){case 4:return!1;case 7:jW(I,h)}return o?-1:i||r?r:I}},HW={forEach:nl(0),map:nl(1),filter:nl(2),some:nl(3),every:nl(4),find:nl(5),findIndex:nl(6),filterReject:nl(7)},By=it,RO=Pn,AO=Qn,vNe=_n,Hh=So,Gh=Th,ENe=Sn,qi=mi,bNe=Ki,DO=_r,jy=Yc,OO=Jb,yNe=wo,NO=qc,bg=sg,GW=ay,SNe=oy,WW=LW,CNe=og,zW=ng,KW=qo,TNe=aD,qW=Yb,YW=Jc,wNe=vy,PO=Ih,$W=sy,XW=BA,INe=cn,RNe=jh,ANe=ei,DNe=BW,ONe=Qc,ZW=fd,Hy=HW.forEach,Jr=ry("hidden"),Gy="Symbol",yg="prototype",NNe=ZW.set,JW=ZW.getterFor(Gy),Ms=Object[yg],Wh=RO.Symbol,Wy=Wh&&Wh[yg],PNe=RO.TypeError,MO=RO.QObject,QW=zW.f,vd=KW.f,ez=WW.f,MNe=qW.f,tz=vNe([].push),sc=PO("symbols"),Sg=PO("op-symbols"),xNe=PO("wks"),xO=!MO||!MO[yg]||!MO[yg].findChild,kO=Hh&&ENe(function(){return 7!=bg(vd({},"a",{get:function(){return vd(this,"a",{value:7}).a}})).a})?function(e,t,n){var i=QW(Ms,t);i&&delete Ms[t],vd(e,t,n),i&&e!==Ms&&vd(Ms,t,i)}:vd,LO=function(e,t){var n=sc[e]=bg(Wy);return NNe(n,{type:Gy,tag:e,description:t}),Hh||(n.description=t),n},zy=function(e,t,n){e===Ms&&zy(Sg,t,n),DO(e);var i=OO(t);return DO(n),qi(sc,i)?(n.enumerable?(qi(e,Jr)&&e[Jr][i]&&(e[Jr][i]=!1),n=bg(n,{enumerable:NO(0,!1)})):(qi(e,Jr)||vd(e,Jr,NO(1,{})),e[Jr][i]=!0),kO(e,i,n)):vd(e,i,n)},FO=function(e,t){DO(e);var n=jy(t),i=GW(n).concat(oz(n));return Hy(i,function(r){Hh&&!AO(nz,n,r)||zy(e,r,n[r])}),e},nz=function(e){var t=OO(e),n=AO(MNe,this,t);return!(this===Ms&&qi(sc,t)&&!qi(Sg,t))&&(!(n||!qi(this,t)||!qi(sc,t)||qi(this,Jr)&&this[Jr][t])||n)},iz=function(e,t){var n=jy(e),i=OO(t);if(n!==Ms||!qi(sc,i)||qi(Sg,i)){var r=QW(n,i);return!r||!qi(sc,i)||qi(n,Jr)&&n[Jr][i]||(r.enumerable=!0),r}},rz=function(e){var t=ez(jy(e)),n=[];return Hy(t,function(i){qi(sc,i)||qi($W,i)||tz(n,i)}),n},oz=function(e){var t=e===Ms,n=ez(t?Sg:jy(e)),i=[];return Hy(n,function(r){!qi(sc,r)||t&&!qi(Ms,r)||tz(i,sc[r])}),i};Gh||(YW(Wy=(Wh=function(){if(bNe(Wy,this))throw PNe("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?yNe(arguments[0]):void 0,t=XW(e),n=function(i){this===Ms&&AO(n,Sg,i),qi(this,Jr)&&qi(this[Jr],t)&&(this[Jr][t]=!1),kO(this,t,NO(1,i))};return Hh&&xO&&kO(Ms,t,{configurable:!0,set:n}),LO(t,e)})[yg],"toString",function(){return JW(this).tag}),YW(Wh,"withoutSetter",function(e){return LO(XW(e),e)}),qW.f=nz,KW.f=zy,TNe.f=FO,zW.f=iz,SNe.f=WW.f=rz,CNe.f=oz,RNe.f=function(e){return LO(INe(e),e)},Hh&&wNe(Wy,"description",{configurable:!0,get:function(){return JW(this).description}})),By({global:!0,constructor:!0,wrap:!0,forced:!Gh,sham:!Gh},{Symbol:Wh}),Hy(GW(xNe),function(e){ANe(e)}),By({target:Gy,stat:!0,forced:!Gh},{useSetter:function(){xO=!0},useSimple:function(){xO=!1}}),By({target:"Object",stat:!0,forced:!Gh,sham:!Hh},{create:function(e,t){return void 0===t?bg(e):FO(bg(e),t)},defineProperty:zy,defineProperties:FO,getOwnPropertyDescriptor:iz}),By({target:"Object",stat:!0,forced:!Gh},{getOwnPropertyNames:rz}),DNe(),ONe(Wh,Gy),$W[Jr]=!0;var sz=Th&&!!Symbol.for&&!!Symbol.keyFor,kNe=it,LNe=Nr,FNe=mi,UNe=wo,az=Ih,VNe=sz,UO=az("string-to-symbol-registry"),BNe=az("symbol-to-string-registry");kNe({target:"Symbol",stat:!0,forced:!VNe},{for:function(e){var t=UNe(e);if(FNe(UO,t))return UO[t];var n=LNe("Symbol")(t);return UO[t]=n,BNe[n]=t,n}});var jNe=it,HNe=mi,GNe=ig,WNe=wh,zNe=sz,cz=Ih("symbol-to-string-registry");jNe({target:"Symbol",stat:!0,forced:!zNe},{keyFor:function(e){if(!GNe(e))throw TypeError(WNe(e)+" is not a symbol");if(HNe(cz,e))return cz[e]}});var lz=Eg,KNe=zn,dz=fa,qNe=wo,uz=_n([].push),YNe=it,hz=Nr,pz=zb,$Ne=Qn,Cg=_n,fz=Sn,mz=zn,gz=ig,_z=by,ZNe=Th,JNe=String,il=hz("JSON","stringify"),Ky=Cg(/./.exec),vz=Cg("".charAt),QNe=Cg("".charCodeAt),ePe=Cg("".replace),tPe=Cg(1..toString),nPe=/[\uD800-\uDFFF]/g,Ez=/^[\uD800-\uDBFF]$/,bz=/^[\uDC00-\uDFFF]$/,yz=!ZNe||fz(function(){var e=hz("Symbol")();return"[null]"!=il([e])||"{}"!=il({a:e})||"{}"!=il(Object(e))}),Sz=fz(function(){return'"\\udf06\\ud834"'!==il("\udf06\ud834")||'"\\udead"'!==il("\udead")}),iPe=function(e,t){var n=_z(arguments),i=function(e){if(KNe(e))return e;if(lz(e)){for(var t=e.length,n=[],i=0;i<t;i++){var r=e[i];"string"==typeof r?uz(n,r):"number"!=typeof r&&"Number"!=dz(r)&&"String"!=dz(r)||uz(n,qNe(r))}var o=n.length,s=!0;return function(a,c){if(s)return s=!1,c;if(lz(this))return c;for(var l=0;l<o;l++)if(n[l]===a)return c}}}(t);if(mz(i)||void 0!==e&&!gz(e))return n[1]=function(r,o){if(mz(i)&&(o=$Ne(i,this,JNe(r),o)),!gz(o))return o},pz(il,null,n)},rPe=function(e,t,n){var i=vz(n,t-1),r=vz(n,t+1);return Ky(Ez,e)&&!Ky(bz,r)||Ky(bz,e)&&!Ky(Ez,i)?"\\u"+tPe(QNe(e,0),16):e};il&&YNe({target:"JSON",stat:!0,arity:3,forced:yz||Sz},{stringify:function(e,t,n){var i=_z(arguments),r=pz(yz?iPe:il,null,i);return Sz&&"string"==typeof r?ePe(r,nPe,rPe):r}});var Cz=og,oPe=ma;it({target:"Object",stat:!0,forced:!Th||Sn(function(){Cz.f(1)})},{getOwnPropertySymbols:function(e){var t=Cz.f;return t?t(oPe(e)):[]}}),ei("asyncIterator"),ei("hasInstance"),ei("isConcatSpreadable"),ei("iterator"),ei("match"),ei("matchAll"),ei("replace"),ei("search"),ei("species"),ei("split");var sPe=BW;ei("toPrimitive"),sPe();var aPe=Nr,cPe=Qc;ei("toStringTag"),cPe(aPe("Symbol"),"Symbol"),ei("unscopables"),Qc(Pn.JSON,"JSON",!0);var lPe=Co.Symbol,uPe=qo.f,Tz=cn("metadata"),wz=Function.prototype;void 0===wz[Tz]&&uPe(wz,Tz,{value:null}),ei("dispose"),ei("metadata");var hPe=lPe;ei("asyncDispose");var pPe=_n,VO=Nr("Symbol"),fPe=VO.keyFor,mPe=pPe(VO.prototype.valueOf),Iz=VO.isRegisteredSymbol||function(e){try{return void 0!==fPe(mPe(e))}catch{return!1}};it({target:"Symbol",stat:!0},{isRegisteredSymbol:Iz});for(var gPe=Ih,Rz=Nr,_Pe=_n,vPe=ig,EPe=cn,qy=Rz("Symbol"),Az=qy.isWellKnownSymbol,Dz=Rz("Object","getOwnPropertyNames"),bPe=_Pe(qy.prototype.valueOf),Oz=gPe("wks"),BO=0,Nz=Dz(qy),yPe=Nz.length;BO<yPe;BO++)try{var Pz=Nz[BO];vPe(qy[Pz])&&EPe(Pz)}catch{}var Mz=function(e){if(Az&&Az(e))return!0;try{for(var t=bPe(e),n=0,i=Dz(Oz),r=i.length;n<r;n++)if(Oz[i[n]]==t)return!0}catch{}return!1};it({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Mz}),ei("matcher"),ei("observable"),it({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:Iz}),it({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:Mz}),ei("metadataKey"),ei("patternMatch"),ei("replaceAll");var zh=Vt(hPe),xz=Vt(jh.f("iterator"));function Tg(e){return Tg="function"==typeof zh&&"symbol"==typeof xz?function(t){return typeof t}:function(t){return t&&"function"==typeof zh&&t.constructor===zh&&t!==zh.prototype?"symbol":typeof t},Tg(e)}var SPe=Vt(jh.f("toPrimitive"));function y(e,t,n){return(t=function CPe(e){var t=function(n,i){if("object"!==Tg(n)||null===n)return n;var r=n[SPe];if(void 0!==r){var o=r.call(n,"string");if("object"!==Tg(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(e);return"symbol"===Tg(t)?t:String(t)}(t))in e?AW(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var TPe=Sn,wPe=cn("iterator"),jO=!TPe(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2"),i="";return e.pathname="c%20d",t.forEach(function(r,o){t.delete("b"),i+=o+r}),n.delete("a",2),!e.toJSON||!n.has("a",1)||n.has("a",2)||!t.size&&!0||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[wPe]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("http://a#\u0431").hash||"a1c3"!==i||"x"!==new URL("http://x",void 0).host}),IPe=Jc,HO=it,Kh=Pn,Yy=Qn,Ea=_n,qh=So,kz=jO,Lz=Jc,RPe=vy,DPe=Qc,OPe=yD,GO=fd,Fz=TD,WO=zn,NPe=mi,PPe=Xc,MPe=ga,xPe=_r,Uz=Xr,Pr=wo,kPe=sg,Vz=qc,zO=uD,LPe=dy,Yh=xh,FPe=VG,UPe=cn("iterator"),wg="URLSearchParams",Bz=wg+"Iterator",jz=GO.set,$o=GO.getterFor(wg),VPe=GO.getterFor(Bz),BPe=Object.getOwnPropertyDescriptor,KO=function(e){if(!qh)return Kh[e];var t=BPe(Kh,e);return t&&t.value},Hz=KO("fetch"),$y=KO("Request"),Ig=KO("Headers"),qO=$y&&$y.prototype,Gz=Ig&&Ig.prototype,jPe=Kh.RegExp,HPe=Kh.TypeError,Wz=Kh.decodeURIComponent,GPe=Kh.encodeURIComponent,WPe=Ea("".charAt),zz=Ea([].join),Ed=Ea([].push),YO=Ea("".replace),zPe=Ea([].shift),Kz=Ea([].splice),qz=Ea("".split),KPe=Ea("".slice),qPe=/\+/g,Yz=Array(4),YPe=function(e){return Yz[e-1]||(Yz[e-1]=jPe("((?:%[\\da-f]{2}){"+e+"})","gi"))},$Pe=function(e){try{return Wz(e)}catch{return e}},$z=function(e){var t=YO(e,qPe," "),n=4;try{return Wz(t)}catch{for(;n;)t=YO(t,YPe(n--),$Pe);return t}},XPe=/[!'()~]|%20/g,ZPe={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},JPe=function(e){return ZPe[e]},Xz=function(e){return YO(GPe(e),XPe,JPe)},$O=OPe(function(e,t){jz(this,{type:Bz,iterator:zO($o(e).entries),kind:t})},"Iterator",function(){var e=VPe(this),t=e.kind,n=e.iterator.next(),i=n.value;return n.done||(n.value="keys"===t?i.key:"values"===t?i.value:[i.key,i.value]),n},!0),Zz=function(e){this.entries=[],this.url=null,void 0!==e&&(Uz(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===WPe(e,0)?KPe(e,1):e:Pr(e)))};Zz.prototype={type:wg,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,i,r,o,s,a,c=LPe(e);if(c)for(n=(t=zO(e,c)).next;!(i=Yy(n,t)).done;){if(o=(r=zO(xPe(i.value))).next,(s=Yy(o,r)).done||(a=Yy(o,r)).done||!Yy(o,r).done)throw HPe("Expected sequence with length 2");Ed(this.entries,{key:Pr(s.value),value:Pr(a.value)})}else for(var l in e)NPe(e,l)&&Ed(this.entries,{key:l,value:Pr(e[l])})},parseQuery:function(e){if(e)for(var t,n,i=qz(e,"&"),r=0;r<i.length;)(t=i[r++]).length&&(n=qz(t,"="),Ed(this.entries,{key:$z(zPe(n)),value:$z(zz(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],i=0;i<t.length;)e=t[i++],Ed(n,Xz(e.key)+"="+Xz(e.value));return zz(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Xy=function(){Fz(this,$h);var e=jz(this,new Zz(arguments.length>0?arguments[0]:void 0));qh||(this.size=e.entries.length)},$h=Xy.prototype;if(function(e,t,n){for(var i in t)n&&n.unsafe&&e[i]?e[i]=t[i]:IPe(e,i,t[i],n)}($h,{append:function(e,t){var n=$o(this);Yh(arguments.length,2),Ed(n.entries,{key:Pr(e),value:Pr(t)}),qh||this.length++,n.updateURL()},delete:function(e){for(var t=$o(this),n=Yh(arguments.length,1),i=t.entries,r=Pr(e),o=n<2?void 0:arguments[1],s=void 0===o?o:Pr(o),a=0;a<i.length;){var c=i[a];if(c.key!==r||void 0!==s&&c.value!==s)a++;else if(Kz(i,a,1),void 0!==s)break}qh||(this.size=i.length),t.updateURL()},get:function(e){var t=$o(this).entries;Yh(arguments.length,1);for(var n=Pr(e),i=0;i<t.length;i++)if(t[i].key===n)return t[i].value;return null},getAll:function(e){var t=$o(this).entries;Yh(arguments.length,1);for(var n=Pr(e),i=[],r=0;r<t.length;r++)t[r].key===n&&Ed(i,t[r].value);return i},has:function(e){for(var t=$o(this).entries,n=Yh(arguments.length,1),i=Pr(e),r=n<2?void 0:arguments[1],o=void 0===r?r:Pr(r),s=0;s<t.length;){var a=t[s++];if(a.key===i&&(void 0===o||a.value===o))return!0}return!1},set:function(e,t){var n=$o(this);Yh(arguments.length,1);for(var i,r=n.entries,o=!1,s=Pr(e),a=Pr(t),c=0;c<r.length;c++)(i=r[c]).key===s&&(o?Kz(r,c--,1):(o=!0,i.value=a));o||Ed(r,{key:s,value:a}),qh||(this.size=r.length),n.updateURL()},sort:function(){var e=$o(this);FPe(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=$o(this).entries,i=PPe(e,arguments.length>1?arguments[1]:void 0),r=0;r<n.length;)i((t=n[r++]).value,t.key,this)},keys:function(){return new $O(this,"keys")},values:function(){return new $O(this,"values")},entries:function(){return new $O(this,"entries")}},{enumerable:!0}),Lz($h,UPe,$h.entries,{name:"entries"}),Lz($h,"toString",function(){return $o(this).serialize()},{enumerable:!0}),qh&&RPe($h,"size",{get:function(){return $o(this).entries.length},configurable:!0,enumerable:!0}),DPe(Xy,wg),HO({global:!0,constructor:!0,forced:!kz},{URLSearchParams:Xy}),!kz&&WO(Ig)){var QPe=Ea(Gz.has),eMe=Ea(Gz.set),Jz=function(e){if(Uz(e)){var t,n=e.body;if(MPe(n)===wg)return t=e.headers?new Ig(e.headers):new Ig,QPe(t,"content-type")||eMe(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),kPe(e,{body:Vz(0,Pr(n)),headers:Vz(0,t)})}return e};if(WO(Hz)&&HO({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return Hz(e,arguments.length>1?Jz(arguments[1]):{})}}),WO($y)){var XO=function(e){return Fz(this,qO),new $y(e,arguments.length>1?Jz(arguments[1]):{})};qO.constructor=XO,XO.prototype=qO,HO({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:XO})}}var tMe={URLSearchParams:Xy,getState:$o},Qz=Vt(Co.URLSearchParams),nMe={isBrowser:!0,classes:{URLSearchParams:void 0!==Qz?Qz:IO,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const ZO=typeof window<"u"&&typeof document<"u",JO="object"==typeof navigator&&navigator||void 0,iMe=ZO&&(!JO||["ReactNative","NativeScript","NS"].indexOf(JO.product)<0),rMe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,oMe=ZO&&window.location.href||"http://localhost";function e9(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function t9(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?e9(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e9(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var Qr=t9(t9({},Object.freeze({__proto__:null,hasBrowserEnv:ZO,hasStandardBrowserEnv:iMe,hasStandardBrowserWebWorkerEnv:rMe,navigator:JO,origin:oMe})),nMe),sMe=_r,aMe=Qn,cMe=mi,lMe=Ki,dMe=function(){var e=sMe(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},n9=RegExp.prototype,i9=function(e){var t=e.flags;return void 0!==t||"flags"in n9||cMe(e,"flags")||!lMe(n9,e)?t:aMe(dMe,e)},uMe=eO.charAt,r9=Qn,hMe=_r,pMe=zn,fMe=fa,mMe=/./.exec,gMe=TypeError,_Me=it,o9=Qn,s9=tg,vMe=yD,Zy=CD,a9=Ch,c9=qH,Rg=wo,EMe=_r,bMe=Sh,yMe=fa,SMe=$H,l9=i9,CMe=Zb,TMe=Sn,wMe=AD,d9=fd,AMe=cn("matchAll"),u9="RegExp String",h9=u9+" Iterator",DMe=d9.set,OMe=d9.getterFor(h9),NMe=TypeError,QO=s9("".indexOf),Jy=s9("".matchAll),eN=!!Jy&&!TMe(function(){Jy("a",/./)}),PMe=vMe(function(e,t,n,i){DMe(this,{type:h9,regexp:e,string:t,global:n,unicode:i,done:!1})},u9,function(){var e=OMe(this);if(e.done)return Zy(void 0,!0);var t=e.regexp,n=e.string,i=function(e,t){var n=e.exec;if(pMe(n)){var i=r9(n,e,t);return null!==i&&hMe(i),i}if("RegExp"===fMe(e))return r9(mMe,e,t);throw gMe("RegExp#exec called on incompatible receiver")}(t,n);return null===i?(e.done=!0,Zy(void 0,!0)):e.global?(""===Rg(i[0])&&(t.lastIndex=function(e,t,n){return t+(n?uMe(e,t).length:1)}(n,c9(t.lastIndex),e.unicode)),Zy(i,!1)):(e.done=!0,Zy(i,!1))}),p9=function(e){var t,n,i,r=EMe(this),o=Rg(e),s=wMe(r,RegExp),a=Rg(l9(r));return t=new s(s===RegExp?r.source:r,a),n=!!~QO(a,"g"),i=!!~QO(a,"u"),t.lastIndex=c9(r.lastIndex),new PMe(t,o,n,i)};_Me({target:"String",proto:!0,forced:eN},{matchAll:function(e){var t,n,i,r,o=a9(this);if(bMe(e)){if(eN)return Jy(o,e)}else{if(SMe(e)&&(t=Rg(a9(l9(e))),!~QO(t,"g")))throw NMe("`.matchAll` does not allow non-global regexes");if(eN)return Jy(o,e);if(void 0===(i=CMe(e,AMe))&&"RegExp"==yMe(e)&&(i=p9),i)return o9(i,e,o)}return n=Rg(o),r=new RegExp(e,"g"),o9(p9,r,n)}});var MMe=Yo("String").matchAll,xMe=Ki,kMe=MMe,tN=String.prototype,FMe=Vt(function(e){var t=e.matchAll;return"string"==typeof e||e===tN||xMe(tN,e)&&t===tN.matchAll?kMe:t});function f9(e){function t(n,i,r,o){let s=n[o++];if("__proto__"===s)return!0;const a=Number.isFinite(+s),c=o>=n.length;return s=!s&&z.isArray(r)?r.length:s,c?(r[s]=z.hasOwnProp(r,s)?[r[s],i]:i,!a):(r[s]&&z.isObject(r[s])||(r[s]=[]),t(n,i,r[s],o)&&z.isArray(r[s])&&(r[s]=function(l){const d={},u=Object.keys(l);let h;const p=u.length;let m;for(h=0;h<p;h++)m=u[h],d[m]=l[m];return d}(r[s])),!a)}if(z.isFormData(e)&&z.isFunction(e.entries)){const n={};return z.forEachEntry(e,(i,r)=>{var o;t((o=i,FMe(z).call(z,/\w+|\[(\w*)]/g,o).map(s=>"[]"===s[0]?"":s[1]||s[0])),r,n,0)}),n}return null}const nN={transitional:TW,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,r=z.isObject(e);if(r&&z.isHTMLForm(e)&&(e=new FormData(e)),z.isFormData(e))return i?JSON.stringify(f9(e)):e;if(z.isArrayBuffer(e)||z.isBuffer(e)||z.isStream(e)||z.isFile(e)||z.isBlob(e)||z.isReadableStream(e))return e;if(z.isArrayBufferView(e))return e.buffer;if(z.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return(s=e,a=this.formSerializer,Vy(s,new Qr.classes.URLSearchParams,Object.assign({visitor:function(c,l,d,u){return Qr.isNode&&z.isBuffer(c)?(this.append(l,c.toString("base64")),!1):u.defaultVisitor.apply(this,arguments)}},a))).toString();if((o=z.isFileList(e))||n.indexOf("multipart/form-data")>-1){const s=this.env&&this.env.FormData;return Vy(o?{"files[]":e}:e,s&&new s,this.formSerializer)}}var s,a;return r||i?(t.setContentType("application/json",!1),function(s,a,c){if(z.isString(s))try{return(0,JSON.parse)(s),ki(z).call(z,s)}catch(l){if("SyntaxError"!==l.name)throw l}return(0,JSON.stringify)(s)}(e)):e}],transformResponse:[function(e){const t=this.transitional||nN.transitional,n=t&&t.forcedJSONParsing,i="json"===this.responseType;if(z.isResponse(e)||z.isReadableStream(e))return e;if(e&&z.isString(e)&&(n&&!this.responseType||i)){const r=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(o){if(r)throw"SyntaxError"===o.name?rt.from(o,rt.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Qr.classes.FormData,Blob:Qr.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};z.forEach(["delete","get","head","post","put","patch"],e=>{nN.headers[e]={}});var iN=nN;const UMe=z.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),m9=Symbol("internals");function Ag(e){var t;return e&&ki(t=String(e)).call(t).toLowerCase()}function Qy(e){return!1===e||null==e?e:z.isArray(e)?e.map(Qy):String(e)}function rN(e,t,n,i,r){return z.isFunction(i)?i.call(this,t,n):(r&&(t=n),z.isString(t)?z.isString(i)?-1!==t.indexOf(i):z.isRegExp(i)?i.test(t):void 0:void 0)}class eS{constructor(t){t&&this.set(t)}set(t,n,i){const r=this;function o(c,l,d){const u=Ag(l);if(!u)throw new Error("header name must be a non-empty string");const h=z.findKey(r,u);(!h||void 0===r[h]||!0===d||void 0===d&&!1!==r[h])&&(r[h||l]=Qy(c))}const s=(c,l)=>z.forEach(c,(d,u)=>o(d,u,l));if(z.isPlainObject(t)||t instanceof this.constructor)s(t,n);else if(z.isString(t)&&(t=ki(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ki(a=t).call(a)))s((c=>{const l={};let d,u,h;return c&&c.split("\n").forEach(function(p){var m,f;h=p.indexOf(":"),d=ki(m=p.substring(0,h)).call(m).toLowerCase(),u=ki(f=p.substring(h+1)).call(f),!d||l[d]&&UMe[d]||("set-cookie"===d?l[d]?l[d].push(u):l[d]=[u]:l[d]=l[d]?l[d]+", "+u:u)}),l})(t),n);else if(z.isHeaders(t))for(const[c,l]of t.entries())o(l,c,i);else null!=t&&o(n,t,i);var a;return this}get(t,n){if(t=Ag(t)){const i=z.findKey(this,t);if(i){const r=this[i];if(!n)return r;if(!0===n)return function(o){const s=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let c;for(;c=a.exec(o);)s[c[1]]=c[2];return s}(r);if(z.isFunction(n))return n.call(this,r,i);if(z.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=Ag(t)){const i=z.findKey(this,t);return!(!i||void 0===this[i]||n&&!rN(0,this[i],i,n))}return!1}delete(t,n){const i=this;let r=!1;function o(s){if(s=Ag(s)){const a=z.findKey(i,s);!a||n&&!rN(0,i[a],a,n)||(delete i[a],r=!0)}}return z.isArray(t)?t.forEach(o):o(t),r}clear(t){const n=Object.keys(this);let i=n.length,r=!1;for(;i--;){const o=n[i];t&&!rN(0,this[o],o,t,!0)||(delete this[o],r=!0)}return r}normalize(t){const n=this,i={};return z.forEach(this,(r,o)=>{var s;const a=z.findKey(i,o);if(a)return n[a]=Qy(r),void delete n[o];const c=t?ki(l=o).call(l).toLowerCase().replace(/([a-z\d])(\w*)/g,(d,u,h)=>u.toUpperCase()+h):ki(s=String(o)).call(s);var l;c!==o&&delete n[o],n[c]=Qy(r),i[c]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return z.forEach(this,(i,r)=>{null!=i&&!1!==i&&(n[r]=t&&z.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,i]=t;return n+": "+i}).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];return r.forEach(s=>n.set(s)),n}static accessor(t){const n=(this[m9]=this[m9]={accessors:{}}).accessors,i=this.prototype;function r(o){const s=Ag(o);n[s]||(function(a,c){const l=z.toCamelCase(" "+c);["get","set","has"].forEach(d=>{Object.defineProperty(a,d+l,{value:function(u,h,p){return this[d].call(this,c,u,h,p)},configurable:!0})})}(i,o),n[s]=!0)}return z.isArray(t)?t.forEach(r):r(t),this}}eS.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),z.reduceDescriptors(eS.prototype,(e,t)=>{let{value:n}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(r){this[i]=r}}}),z.freezeMethods(eS);var xs=eS;function oN(e,t){const n=this||iN,i=t||n,r=xs.from(i.headers);let o=i.data;return z.forEach(e,function(s){o=s.call(n,o,r.normalize(),t?t.status:void 0)}),r.normalize(),o}function g9(e){return!(!e||!e.__CANCEL__)}function Xh(e,t,n){rt.call(this,e??"canceled",rt.ERR_CANCELED,t,n),this.name="CanceledError"}function _9(e,t,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new rt("Request failed with status code "+n.status,[rt.ERR_BAD_REQUEST,rt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}z.inherits(Xh,rt,{__CANCEL__:!0});const tS=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,i=0;const r=function(o,s){o=o||10;const a=new Array(o),c=new Array(o);let l,d=0,u=0;return s=void 0!==s?s:1e3,function(h){const p=Date.now(),m=c[u];l||(l=p),a[d]=h,c[d]=p;let f=u,g=0;for(;f!==d;)g+=a[f++],f%=o;if(d=(d+1)%o,d===u&&(u=(u+1)%o),p-l<s)return;const E=m&&p-m;return E?Math.round(1e3*g/E):void 0}}(50,250);return function(o,s){let a,c,l=0,d=1e3/s;const u=function(h){l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),a=null,c&&(clearTimeout(c),c=null),o.apply(null,h)};return[function(){const h=Date.now(),p=h-l;for(var m=arguments.length,f=new Array(m),g=0;g<m;g++)f[g]=arguments[g];p>=d?u(f,h):(a=f,c||(c=setTimeout(()=>{c=null,u(a)},d-p)))},()=>a&&u(a)]}(o=>{const s=o.loaded,a=o.lengthComputable?o.total:void 0,c=s-i,l=r(c);i=s,e({loaded:s,total:a,progress:a?s/a:void 0,bytes:c,rate:l||void 0,estimated:l&&a&&s<=a?(a-s)/l:void 0,event:o,lengthComputable:null!=a,[t?"download":"upload"]:!0})},n)},v9=(e,t)=>{const n=null!=e;return[i=>t[0]({lengthComputable:n,total:e,loaded:i}),t[1]]},E9=e=>function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return z.asap(()=>e(...n))};var VMe=Qr.hasStandardBrowserEnv?function(){const e=Qr.navigator&&/(msie|trident)/i.test(Qr.navigator.userAgent),t=document.createElement("a");let n;function i(r){let o=r;return e&&(t.setAttribute("href",o),o=t.href),t.setAttribute("href",o),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=i(window.location.href),function(r){const o=z.isString(r)?i(r):r;return o.protocol===n.protocol&&o.host===n.host}}():function(){return!0},BMe=Qr.hasStandardBrowserEnv?{write(e,t,n,i,r,o){const s=[e+"="+encodeURIComponent(t)];z.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),z.isString(i)&&s.push("path="+i),z.isString(r)&&s.push("domain="+r),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function b9(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?(n=e,(i=t)?n.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):n):t;var n,i}function y9(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}const S9=e=>e instanceof xs?function(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?y9(Object(i),!0).forEach(function(r){y(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):y9(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}({},e):e;function bd(e,t){t=t||{};const n={};function i(l,d,u){return z.isPlainObject(l)&&z.isPlainObject(d)?z.merge.call({caseless:u},l,d):z.isPlainObject(d)?z.merge({},d):z.isArray(d)?d.slice():d}function r(l,d,u){return z.isUndefined(d)?z.isUndefined(l)?void 0:i(void 0,l,u):i(l,d,u)}function o(l,d){if(!z.isUndefined(d))return i(void 0,d)}function s(l,d){return z.isUndefined(d)?z.isUndefined(l)?void 0:i(void 0,l):i(void 0,d)}function a(l,d,u){return u in t?i(l,d):u in e?i(void 0,l):void 0}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(l,d)=>r(S9(l),S9(d),!0)};return z.forEach(Object.keys(Object.assign({},e,t)),function(l){const d=c[l]||r,u=d(e[l],t[l],l);z.isUndefined(u)&&d!==a||(n[l]=u)}),n}var C9=e=>{const t=bd({},e);let n,{data:i,withXSRFToken:r,xsrfHeaderName:o,xsrfCookieName:s,headers:a,auth:c}=t;if(t.headers=a=xs.from(a),t.url=SW(b9(t.baseURL,t.url),e.params,e.paramsSerializer),c&&a.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),z.isFormData(i))if(Qr.hasStandardBrowserEnv||Qr.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(!1!==(n=a.getContentType())){const[l,...d]=n?n.split(";").map(u=>ki(u).call(u)).filter(Boolean):[];a.setContentType([l||"multipart/form-data",...d].join("; "))}if(Qr.hasStandardBrowserEnv&&(r&&z.isFunction(r)&&(r=r(t)),r||!1!==r&&VMe(t.url))){const l=o&&s&&BMe.read(s);l&&a.set(o,l)}return t},jMe=typeof XMLHttpRequest<"u"&&function(e){return new q(function(t,n){const i=C9(e);let r=i.data;const o=xs.from(i.headers).normalize();let s,a,c,l,d,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=i;function m(){l&&l(),d&&d(),i.cancelToken&&i.cancelToken.unsubscribe(s),i.signal&&i.signal.removeEventListener("abort",s)}let f=new XMLHttpRequest;function g(){if(!f)return;const b=xs.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());_9(function(T){t(T),m()},function(T){n(T),m()},{data:u&&"text"!==u&&"json"!==u?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:b,config:e,request:f}),f=null}f.open(i.method.toUpperCase(),i.url,!0),f.timeout=i.timeout,"onloadend"in f?f.onloadend=g:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(g)},f.onabort=function(){f&&(n(new rt("Request aborted",rt.ECONNABORTED,e,f)),f=null)},f.onerror=function(){n(new rt("Network Error",rt.ERR_NETWORK,e,f)),f=null},f.ontimeout=function(){let b=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";i.timeoutErrorMessage&&(b=i.timeoutErrorMessage),n(new rt(b,(i.transitional||TW).clarifyTimeoutError?rt.ETIMEDOUT:rt.ECONNABORTED,e,f)),f=null},void 0===r&&o.setContentType(null),"setRequestHeader"in f&&z.forEach(o.toJSON(),function(b,T){f.setRequestHeader(T,b)}),z.isUndefined(i.withCredentials)||(f.withCredentials=!!i.withCredentials),u&&"json"!==u&&(f.responseType=i.responseType),p&&([c,d]=tS(p,!0),f.addEventListener("progress",c)),h&&f.upload&&([a,l]=tS(h),f.upload.addEventListener("progress",a),f.upload.addEventListener("loadend",l)),(i.cancelToken||i.signal)&&(s=b=>{f&&(n(!b||b.type?new Xh(null,e,f):b),f.abort(),f=null)},i.cancelToken&&i.cancelToken.subscribe(s),i.signal&&(i.signal.aborted?s():i.signal.addEventListener("abort",s)));const E=function(b){const T=/^([-+\w]{1,25})(:?\/\/|:)/.exec(b);return T&&T[1]||""}(i.url);E&&-1===Qr.protocols.indexOf(E)?n(new rt("Unsupported protocol "+E+":",rt.ERR_BAD_REQUEST,e)):f.send(r||null)})},HMe=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let i,r=new AbortController;const o=function(l){if(!i){i=!0,a();const d=l instanceof Error?l:this.reason;r.abort(d instanceof rt?d:new Xh(d instanceof Error?d.message:d))}};let s=t&&setTimeout(()=>{s=null,o(new rt("timeout ".concat(t," of ms exceeded"),rt.ETIMEDOUT))},t);const a=()=>{e&&(s&&clearTimeout(s),s=null,e.forEach(l=>{l.unsubscribe?l.unsubscribe(o):l.removeEventListener("abort",o)}),e=null)};e.forEach(l=>l.addEventListener("abort",o));const{signal:c}=r;return c.unsubscribe=()=>z.asap(a),c}},GMe=J8,WMe=va;it({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=WMe.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var zMe=va,KMe=Lh;it({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=zMe.f(this),n=KMe(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var sN=Vt(GMe),T9=jh.f("asyncIterator"),qMe=Vt(T9);function aN(e,t){this.v=e,this.k=t}function Dg(e){var t,n;function i(o,s){try{var a=e[o](s),c=a.value,l=c instanceof aN;sN.resolve(l?c.v:c).then(function(d){if(l){var u="return"===o?"return":"next";if(!c.k||d.done)return i(u,d);d=e[u](d).value}r(a.done?"return":"normal",d)},function(d){i("throw",d)})}catch(d){r("throw",d)}}function r(o,s){switch(o){case"return":t.resolve({value:s,done:!0});break;case"throw":t.reject(s);break;default:t.resolve({value:s,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(o,s){return new sN(function(a,c){var l={key:o,arg:s,resolve:a,reject:c,next:null};n?n=n.next=l:(t=n=l,i(o,s))})},"function"!=typeof e.return&&(this.return=void 0)}function Ao(e){return function(){return new Dg(e.apply(this,arguments))}}function Ne(e){return new aN(e,0)}function nS(e){var t={},n=!1;function i(r,o){return n=!0,{done:!1,value:new aN(o=new sN(function(s){s(e[r](o))}),1)}}return t[void 0!==zh&&xz||"@@iterator"]=function(){return this},t.next=function(r){return n?(n=!1,r):i("next",r)},"function"==typeof e.throw&&(t.throw=function(r){if(n)throw n=!1,r;return i("throw",r)}),"function"==typeof e.return&&(t.return=function(r){return n?(n=!1,r):i("return",r)}),t}Dg.prototype["function"==typeof zh&&qMe||"@@asyncIterator"]=function(){return this},Dg.prototype.next=function(e){return this._invoke("next",e)},Dg.prototype.throw=function(e){return this._invoke("throw",e)},Dg.prototype.return=function(e){return this._invoke("return",e)};var cN=Vt(T9);function lN(e){var t,n,i,r=2;for(typeof Symbol<"u"&&(n=cN,i=Symbol.iterator);r--;){if(n&&null!=(t=e[n]))return t.call(e);if(i&&null!=(t=e[i]))return new iS(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function iS(e){function t(n){if(Object(n)!==n)return q.reject(new TypeError(n+" is not an object."));var i=n.done;return q.resolve(n.value).then(function(r){return{value:r,done:i}})}return(iS=function(n){this.s=n,this.n=n.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return void 0===i?q.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return void 0===i?q.reject(n):t(i.apply(this.s,arguments))}},new iS(e)}const YMe=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let i,r=0;for(;r<n;)i=r+t,yield e.slice(r,i),r=i},$Me=function(){var e=Ao(function*(t,n){var i,r=!1,o=!1;try{for(var s,a=lN(XMe(t));r=!(s=yield Ne(a.next())).done;r=!1){const c=s.value;yield*nS(lN(YMe(c,n)))}}catch(c){o=!0,i=c}finally{try{r&&null!=a.return&&(yield Ne(a.return()))}finally{if(o)throw i}}});return function(t,n){return e.apply(this,arguments)}}(),XMe=function(){var e=Ao(function*(t){if(t[cN])return void(yield*nS(lN(t)));const n=t.getReader();try{for(;;){const{done:i,value:r}=yield Ne(n.read());if(i)break;yield r}}finally{yield Ne(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),w9=(e,t,n,i)=>{const r=$Me(e,t);let o,s=0,a=c=>{o||(o=!0,i&&i(c))};return new ReadableStream({pull:c=>C(function*(){try{const{done:l,value:d}=yield r.next();if(l)return a(),void c.close();if(n){let h=s+=d.byteLength;n(h)}c.enqueue(new Uint8Array(d))}catch(l){throw a(l),l}})(),cancel:c=>(a(c),r.return())},{highWaterMark:2})};function I9(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function R9(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I9(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I9(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const rS="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,A9=rS&&"function"==typeof ReadableStream,ZMe=rS&&("function"==typeof TextEncoder?(D9=new TextEncoder,e=>D9.encode(e)):function(){var e=C(function*(t){return new Uint8Array(yield new Response(t).arrayBuffer())});return function(t){return e.apply(this,arguments)}}());var D9;const O9=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return!!e(...n)}catch{return!1}},JMe=A9&&O9(()=>{let e=!1;const t=new Request(Qr.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),dN=A9&&O9(()=>z.isReadableStream(new Response("").body)),oS={stream:dN&&(e=>e.body)};var N9;rS&&(N9=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!oS[e]&&(oS[e]=z.isFunction(N9[e])?t=>t[e]():(t,n)=>{throw new rt("Response type '".concat(e,"' is not supported"),rt.ERR_NOT_SUPPORT,n)})}));const QMe=function(){var e=C(function*(t,n){return z.toFiniteNumber(t.getContentLength())??(r=C(function*(o){return null==o?0:z.isBlob(o)?o.size:z.isSpecCompliantForm(o)?(yield new Request(Qr.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:z.isArrayBufferView(o)||z.isArrayBuffer(o)?o.byteLength:(z.isURLSearchParams(o)&&(o+=""),z.isString(o)?(yield ZMe(o)).byteLength:void 0)}),function(o){return r.apply(this,arguments)})(n);var r});return function(n,i){return e.apply(this,arguments)}}();var e1e=rS&&function(){var e=C(function*(t){let{url:n,method:i,data:r,signal:o,cancelToken:s,timeout:a,onDownloadProgress:c,onUploadProgress:l,responseType:d,headers:u,withCredentials:h="same-origin",fetchOptions:p}=C9(t);d=d?(d+"").toLowerCase():"text";let m,f=HMe([o,s&&s.toAbortSignal()],a);const g=f&&f.unsubscribe&&(()=>{f.unsubscribe()});let E;try{if(l&&JMe&&"get"!==i&&"head"!==i&&0!==(E=yield QMe(u,r))){let O,k=new Request(n,{method:"POST",body:r,duplex:"half"});if(z.isFormData(r)&&(O=k.headers.get("content-type"))&&u.setContentType(O),k.body){const[L,V]=v9(E,tS(E9(l)));r=w9(k.body,65536,L,V)}}z.isString(h)||(h=h?"include":"omit");const b="credentials"in Request.prototype;m=new Request(n,R9(R9({},p),{},{signal:f,method:i.toUpperCase(),headers:u.normalize().toJSON(),body:r,duplex:"half",credentials:b?h:void 0}));let T=yield fetch(m);const I=dN&&("stream"===d||"response"===d);if(dN&&(c||I&&g)){const O={};["status","statusText","headers"].forEach(ee=>{O[ee]=T[ee]});const k=z.toFiniteNumber(T.headers.get("content-length")),[L,V]=c&&v9(k,tS(E9(c),!0))||[];T=new Response(w9(T.body,65536,L,()=>{V&&V(),g&&g()}),O)}d=d||"text";let D=yield oS[z.findKey(oS,d)||"text"](T,t);return!I&&g&&g(),yield new q((O,k)=>{_9(O,k,{data:D,headers:xs.from(T.headers),status:T.status,statusText:T.statusText,config:t,request:m})})}catch(b){throw g&&g(),b&&"TypeError"===b.name&&/fetch/i.test(b.message)?Object.assign(new rt("Network Error",rt.ERR_NETWORK,t,m),{cause:b.cause||b}):rt.from(b,b&&b.code,t,m)}});return function(t){return e.apply(this,arguments)}}();const uN={http:null,xhr:jMe,fetch:e1e};z.forEach(uN,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const P9=e=>"- ".concat(e),t1e=e=>z.isFunction(e)||null===e||!1===e;var M9_getAdapter=e=>{e=z.isArray(e)?e:[e];const{length:t}=e;let n,i;const r={};for(let o=0;o<t;o++){let s;if(n=e[o],i=n,!t1e(n)&&(i=uN[(s=String(n)).toLowerCase()],void 0===i))throw new rt("Unknown adapter '".concat(s,"'"));if(i)break;r[s||"#"+o]=i}if(!i){const o=Object.entries(r).map(s=>{let[a,c]=s;return"adapter ".concat(a," ")+(!1===c?"is not supported by the environment":"is not available in the build")});throw new rt("There is no suitable adapter to dispatch the request "+(t?o.length>1?"since :\n"+o.map(P9).join("\n"):" "+P9(o[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i};function hN(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Xh(null,e)}function x9(e){return hN(e),e.headers=xs.from(e.headers),e.data=oN.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),M9_getAdapter(e.adapter||iN.adapter)(e).then(function(t){return hN(e),t.data=oN.call(e,e.transformResponse,t),t.headers=xs.from(t.headers),t},function(t){return g9(t)||(hN(e),t&&t.response&&(t.response.data=oN.call(e,e.transformResponse,t.response),t.response.headers=xs.from(t.response.headers))),q.reject(t)})}const pN={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{pN[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const L9={};pN.transitional=function(e,t,n){function i(r,o){return"[Axios v1.7.7] Transitional option '"+r+"'"+o+(n?". "+n:"")}return(r,o,s)=>{if(!1===e)throw new rt(i(o," has been removed"+(t?" in "+t:"")),rt.ERR_DEPRECATED);return t&&!L9[o]&&(L9[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,o,s)}};var fN={assertOptions:function(e,t,n){if("object"!=typeof e)throw new rt("options must be an object",rt.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let r=i.length;for(;r-- >0;){const o=i[r],s=t[o];if(s){const a=e[o],c=void 0===a||s(a,o,e);if(!0!==c)throw new rt("option "+o+" must be "+c,rt.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new rt("Unknown option "+o,rt.ERR_BAD_OPTION)}},validators:pN};const rl=fN.validators;let sS=class{constructor(e){this.defaults=e,this.interceptors={request:new CW,response:new CW}}request(e,t){var n=this;return C(function*(){try{return yield n._request(e,t)}catch(i){if(i instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const o=r.stack?r.stack.replace(/^.+\n/,""):"";try{i.stack?o&&!String(i.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(i.stack+="\n"+o):i.stack=o}catch{}}throw i}})()}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=bd(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:r}=t;void 0!==n&&fN.assertOptions(n,{silentJSONParsing:rl.transitional(rl.boolean),forcedJSONParsing:rl.transitional(rl.boolean),clarifyTimeoutError:rl.transitional(rl.boolean)},!1),null!=i&&(z.isFunction(i)?t.paramsSerializer={serialize:i}:fN.assertOptions(i,{encode:rl.function,serialize:rl.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=r&&z.merge(r.common,r[t.method]);r&&z.forEach(["delete","get","head","post","put","patch","common"],p=>{delete r[p]}),t.headers=xs.concat(o,r);const s=[];let a=!0;this.interceptors.request.forEach(function(p){"function"==typeof p.runWhen&&!1===p.runWhen(t)||(a=a&&p.synchronous,s.unshift(p.fulfilled,p.rejected))});const c=[];let l;this.interceptors.response.forEach(function(p){c.push(p.fulfilled,p.rejected)});let d,u=0;if(!a){const p=[x9.bind(this),void 0];for(p.unshift.apply(p,s),p.push.apply(p,c),d=p.length,l=q.resolve(t);u<d;)l=l.then(p[u++],p[u++]);return l}d=s.length;let h=t;for(u=0;u<d;){const p=s[u++],m=s[u++];try{h=p(h)}catch(f){m.call(this,f);break}}try{l=x9.call(this,h)}catch(p){return q.reject(p)}for(u=0,d=c.length;u<d;)l=l.then(c[u++],c[u++]);return l}getUri(e){return SW(b9((e=bd(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};z.forEach(["delete","get","head","options"],function(e){sS.prototype[e]=function(t,n){return this.request(bd(n||{},{method:e,url:t,data:(n||{}).data}))}}),z.forEach(["post","put","patch"],function(e){function t(n){return function(i,r,o){return this.request(bd(o||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:r}))}}sS.prototype[e]=t(),sS.prototype[e+"Form"]=t(!0)});var aS=sS;class mN{constructor(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");let n;this.promise=new q(function(r){n=r});const i=this;this.promise.then(r=>{if(!i._listeners)return;let o=i._listeners.length;for(;o-- >0;)i._listeners[o](r);i._listeners=null}),this.promise.then=r=>{let o;const s=new q(a=>{i.subscribe(a),o=a}).then(r);return s.cancel=function(){i.unsubscribe(o)},s},t(function(r,o,s){i.reason||(i.reason=new Xh(r,o,s),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);-1!==n&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=i=>{t.abort(i)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new mN(function(n){t=n}),cancel:t}}}var n1e=mN;const gN={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(gN).forEach(e=>{let[t,n]=e;gN[n]=t});var i1e=gN;const Ii=function e(t){const n=new aS(t),i=rW(aS.prototype.request,n);return z.extend(i,aS.prototype,n,{allOwnKeys:!0}),z.extend(i,n,null,{allOwnKeys:!0}),i.create=function(r){return e(bd(t,r))},i}(iN);Ii.Axios=aS,Ii.CanceledError=Xh,Ii.CancelToken=n1e,Ii.isCancel=g9,Ii.VERSION="1.7.7",Ii.toFormData=Vy,Ii.AxiosError=rt,Ii.Cancel=Ii.CanceledError,Ii.all=function(e){return q.all(e)},Ii.spread=function(e){return function(t){return e.apply(null,t)}},Ii.isAxiosError=function(e){return z.isObject(e)&&!0===e.isAxiosError},Ii.mergeConfig=bd,Ii.AxiosHeaders=xs,Ii.formToJSON=e=>f9(z.isHTMLForm(e)?new FormData(e):e),Ii.getAdapter=M9_getAdapter,Ii.HttpStatusCode=i1e,Ii.default=Ii;var nr=Ii;const r1e=()=>{};function Og(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:r1e};return e.promise=new q((t,n)=>{e.resolve=i=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(i),e.value=i)},e.reject=i=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(i))}}),e}const cS=new Map,lS=new Map,ba=new Map;let kn=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Ye=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const _N=new GDe;let ks=_N.getResult(),vN=null;function xe(e){if(!vN){e&&_N.setUA(e),ks=_N.getResult();const t=function(a){if("Blink"===a.engine.name&&"WeChat"!==a.browser.name)return Ye.CHROME;switch(a.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ye.CHROME;case"Safari":case"Mobile Safari":return Ye.SAFARI;case"Edge":return Ye.EDGE;case"Firefox":return Ye.FIREFOX;case"QQ":case"QQBrowser":return Ye.QQ;case"Opera":return Ye.OPERA;case"WeChat":return Ye.WECHAT;default:return a.browser.name||""}}(ks),n=F9(ks),i="Windows"===(a=ks).os.name?a.os.version?a.os.name+" "+a.os.version:a.os.name:a.os.name||"",r=ks.os.version,o=F9(ks,!1),s=ks.device.type;if(!(t&&n&&i&&r))return{name:t,version:n,os:i,osVersion:r,browserVersion:o,deviceType:s};vN={name:t,version:n,os:i,osVersion:r,browserVersion:o,deviceType:s}}var a;return vN}function F9(e){let t;return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?t:t.split(".")[0]}function dS(){return xe().os}function U9(){const e=xe();return"".concat(e.os," ").concat(e.osVersion)}function uS(){const e=xe();return!!("WebKit"===ks.engine.name&&e.os===kn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Ye.SAFARI||Yi()&&e.name!==Ye.SAFARI)}function ol(){return xe().name===Ye.CHROME}function ti(){return xe().name===Ye.SAFARI}function V9(){return xe().name===Ye.EDGE}function Bt(){return xe().name===Ye.FIREFOX}function Yi(){return xe().os===kn.IOS}function EN(e){const t=xe();return!(t.name!==Ye.CHROME||!t.osVersion)&&Number(t.version)>=e}function B9(e){const t=xe();return!(t.name!==Ye.CHROME||!t.osVersion)&&Number(t.version)<e}function j9(e){const t=xe();return!(t.name!==Ye.EDGE||!t.osVersion)&&Number(t.version)>=e}function H9(e){const t=xe();return!(t.name!==Ye.SAFARI||!t.osVersion)&&Number(t.version)>=e}function G9(e,t,n){const i=xe();if(i.os!==kn.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return n?t&&Number(r[0])===e&&Number(r[1])<t||Number(r[0])<e:t?Number(r[0])===e&&Number(r[1])<=t||Number(r[0])<e:Number(r[0])<=e}function W9(e,t,n){const i=xe();if(i.name!==Ye.SAFARI||!i.osVersion||!i.browserVersion)return!1;const r=i.browserVersion.split(".");return n?t&&Number(r[0])===e&&Number(r[1])<t||Number(r[0])<e:t?Number(r[0])===e&&Number(r[1])<=t||Number(r[0])<e:Number(r[0])<=e}function z9(e){const t=xe();return!(t.name!==Ye.OPERA||!t.osVersion)&&Number(t.version)>=e}function K9(){const e=xe();if(e.os!==kn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function Zh(){const e=xe();if(e.os!==kn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])}function bN(){const e=xe();if(e.os!==kn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 16===Number(t[0])}function q9(){const e=xe();if(e.os!==kn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function Xo(){return ti()&&navigator.maxTouchPoints>0}function Y9(){return xe().name===Ye.WECHAT}function $9(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function yN(){const e=dS();return function(){const{deviceType:t}=xe();return"mobile"===t||"tablet"===t}()||e===kn.ANDROID||e===kn.IOS||e===kn.HARMONY_OS}function sl(){const e=xe();return e.name!==Ye.EDGE&&e.name!==Ye.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function hS(){return dS()===kn.ANDROID}function Ng(){const e=xe();return hS()&&(e.name===Ye.CHROME||e.name===Ye.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Ct(e,t,n){return(t="symbol"==typeof(r=function(o,s){if("object"!=typeof o||!o)return o;var a=o[Symbol.toPrimitive];if(void 0!==a){var c=a.call(o,"string");if("object"!=typeof c)return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(t))?r:r+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e;var r}function X9(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X9(Object(n),!0).forEach(function(i){Ct(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X9(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let S=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),M=class extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),Ct(this,"code",void 0),Ct(this,"message",void 0),Ct(this,"data",void 0),Ct(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function ac(e,t){if("boolean"!=typeof e)throw new M(S.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Mn(e,t,n){if(!Y(n).call(n,e))throw new M(S.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function ot(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<n||e>i||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&("number"!=typeof(r=e)||r%1!=0))throw new M(S.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(i,"]. integer only"));var r}function SN(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new M(S.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&ot(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&ot(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&ot(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&ot(e.ideal,"".concat(t,".ideal"),1,1/0)}else ot(e,t,1,1/0)}function Kn(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new M(S.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!Z9(e,n,i,r))throw new M(S.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(r?" ASCII characters only.":""))}function cc(e,t){if(!Array.isArray(e))throw new M(S.INVALID_PARAMS,"".concat(t," should be an array"))}function xt(e){return null==e}function Z9(e){return"string"==typeof e&&e.length<=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:255)&&e.length>=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)&&(!(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])||function(r){if("string"!=typeof r)return!1;for(let o=0;o<r.length;o+=1){const s=r.charCodeAt(o);if(s<0||s>255)return!1}return!0}(e))}var Pg=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Pg||{}),CN=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(CN||{});const J9=new class{constructor(){Ct(this,"_clientSize",null),Ct(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Ct(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Ct(this,"getStyle",e=>window.getComputedStyle(e,null)),Ct(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const i=this.getStyle(e),{display:r,visibility:o,opacity:s,filter:a}=i;return("none"===r||Y(t=["hidden","collapse"]).call(t,o)||Number(s)<.1)&&(n=!1),!!n&&(a&&a.split(" ").filter(c=>{var l;const d=c.split("(")[0];return Y(l=["brightness","blur","opacity"]).call(l,d)}).map(c=>{const[l,d]=c.split(/\(|\)/);return[l,Number(d.match(/^[0-9\.]+/))]}).forEach(c=>{const[l,d]=c;switch(l){case"brightness":(d<.1||d>3)&&(n=!1);break;case"blur":d>3&&(n=!1);break;case"opacity":d<.1&&(n=!1)}}),n)}),Ct(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,i=!0,o=e;for(;o&&i;)t(o)||(n=!1,i=!1),o=o.parentElement,o||(i=!1);return n}),Ct(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Ct(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:i,right:r,top:o,bottom:s}=e.getBoundingClientRect(),a=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:n,left:i,right:r,top:o,bottom:s,clientWidth:a,clientHeight:c,clientMin:Math.min(a,c)}}),Ct(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),Ct(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),Ct(this,"checkCoverForAPoint",(e,t,n)=>{const i=this.elementFromPoint(e,t);return null!==i&&i!==n}),Ct(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:i}=this._clientSize,r=e/6,o=t/6,s=[],a=10**6;for(let c=0;c<5;c++)for(let l=0;l<5;l++)s.push({x:(n*a+(0===c?.1:4===c?(r*c*a-1e5)/a:r*c)*a)/a,y:(i*a+(0===l?.1:4===l?(o*l*a-1e5)/a:o*l)*a)/a});return[...s]}),Ct(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),Ct(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),Ct(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:i,clientHeight:r,clientWidth:o,clientMin:s}=this._clientSize;let a,c,l,d;if(e<0)a=0;else{if(!(e<o))return!1;a=e}if(t<0)return!1;if(c=t<o?t:o,n<0)l=0;else{if(!(n<r))return!1;l=n}return!(i<0)&&(d=i<r?i:r,this.checkSizeIsVisible(c-a,d-l,s))}),Ct(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Ct(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Pg.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(Pg.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Pg.SIZE)}}return this.returnHiddenResult(Pg.STYLE)}return this.returnHiddenResult(CN.UNMOUNTED)}return this.returnHiddenResult(CN.INVALID_HTML_ELEMENT)}),Ct(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>"HTML"!==t.nodeName.toUpperCase()?null!==t.parentElement:!!document.documentElement))}};function TN(e){return(new TextEncoder).encode(e)}const Q9=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},wN=function(){var e=C(function*(t){return function(n,i){let r="";return new Uint8Array(n).forEach(o=>{r+=o.toString(16).padStart(2,"0")}),r}(yield crypto.subtle.digest("SHA-256",TN(t)))});return function(n){return e.apply(this,arguments)}}();class kt{constructor(){Ct(this,"_events",{}),Ct(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(n=>n.listener):[]}on(t,n){this._events[t]||(this._events[t]=[]);const i=this._events[t];-1===this._indexOfListener(i,n)&&i.push({listener:n,once:!1})}once(t,n){this._events[t]||(this._events[t]=[]);const i=this._events[t];-1===this._indexOfListener(i,n)&&i.push({listener:n,once:!0})}off(t,n){if(!this._events[t])return;const i=this._events[t],r=this._indexOfListener(i,n);-1!==r&&i.splice(r,1),0===this._events[t].length&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const n=this._events[t].map(s=>s);for(var i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];for(let s=0;s<n.length;s+=1){const a=n[s];a.once&&this.off(t,a.listener),a.listener.apply(this,r||[])}}safeEmit(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];[...this._events[t]||[]].forEach(o=>{o.once&&this.off(t,o.listener);try{o.listener.apply(this,i)}catch(s){console.error("safeEmit event:".concat(t," error ").concat(s?.toString()))}})}_indexOfListener(t,n){let i=t.length;for(;i--;)if(t[i].listener===n)return i;return-1}}let Mg=null;function e7(){if(Mg)return Mg;if(window.electron)return Mg=window.electron;if(!window.require)return null;try{return Mg=window.require("electron"),Mg}catch{return null}}let Cn=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e}({}),jt=function(e){return e.TRACER="tracer",e}({});function t7(e){return ot(e.timeout,"config.timeout",0,1e5),ot(e.timeoutFactor,"config.timeoutFactor",0,100,!1),ot(e.maxRetryCount,"config.maxRetryConfig",0,1/0),ot(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let o1e=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Qe=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function pS(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function n7(e){return Kn(e.turnServerURL,"turnServerURL"),Kn(e.username,"username"),Kn(e.password,"password"),e.udpport&&ot(e.udpport,"udpport",1,99999,!0),e.forceturn&&ac(e.forceturn,"forceturn"),e.security&&ac(e.security,"security"),e.tcpport&&ot(e.tcpport,"tcpport",1,99999,!0),!0}function i7(e){return void 0!==e.level&&Mn(e.level,"level",[1,2,3]),void 0!==e.delay&&ot(e.delay,"delay",0,3e3,!0),!0}let Ae=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),ni=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),Mr=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Jh=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function ii(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return 0===e.getListeners(t).length?q.reject(new M(S.UNEXPECTED_ERROR,"can not emit promise")):new q((o,s)=>{e.emit(t,...i,o,s)})}function ct(e,t){if(0===e.getListeners(t).length)return q.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return ii(e,t,...i)}function Do(e,t){if(0===e.getListeners(t).length)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return xg(e,t,...i)}function xg(e,t){let n=null,i=null;for(var r=arguments.length,o=new Array(r>2?r-2:0),s=2;s<r;s++)o[s-2]=arguments[s];if(e.emit(t,...o,a=>{n=a},a=>{i=a}),null!==i)throw i;if(null===n)throw new M(S.UNEXPECTED_ERROR,"handler is not sync");return n}const ln=new class extends kt{set networkState(e){this.emit(Jh.NETWORK_STATE_CHANGE,e,this._networkState),e===Mr.ONLINE?this.emit(Jh.ONLINE):e===Mr.OFFLINE&&(this.onlineWaiter=new q(t=>{this.once(Jh.ONLINE,()=>{this.onlineWaiter=void 0,t(Mr.ONLINE)})}),this.emit(Jh.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Mr.ONLINE}constructor(){super(),Ct(this,"_moduleName","network-indicator"),Ct(this,"_networkState",Mr.ONLINE),Ct(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Mr.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Mr.OFFLINE})}};function fS(e,t){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}function Qh(e){const t=[];return e.forEach(n=>{-1===t.indexOf(n)&&t.push(n)}),t}function mS(e){void 0!==q?q.resolve().then(e):setTimeout(e,0)}function dn(e){return JSON.parse(JSON.stringify(e))}function yd(e){try{return dn(e)}catch{return e}}const r7={};function al(e,t){r7[t]||(r7[t]=!0,e())}function Sd(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)n[i]=t.charCodeAt(i);return n}function cl(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function o7(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=(new TextEncoder).encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const i=new Uint8Array(t);i.set(n),n=i}return n}function s7(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=Ns(t).call(t,(s,a)=>s+a.length,0),r=new Uint8Array(new ArrayBuffer(i));let o=0;return t.forEach(s=>{r.set(s,o),o+=s.length}),r}function ya(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function a7(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+="string"==typeof n?ya(n):n.size}),t+138}function s1e(e){const t=new M(S.TIMEOUT,"timeout");return new q((n,i)=>{window.setTimeout(()=>i(t),e)})}function qn(e){return new q(t=>{window.setTimeout(t,e)})}function gt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+gt(e-n.length,"")}function ep(){return gt(32,"").toUpperCase()}const gS=()=>{},c7=new class{constructor(){Ct(this,"fnMap",new Map)}throttleByKey(e,t,n,i){for(var r=arguments.length,o=new Array(r>4?r-4:0),s=4;s<r;s++)o[s-4]=arguments[s];if(this.fnMap.has(t)){const a=this.fnMap.get(t);if(a.threshold!==n){a.fn(...a.args),clearTimeout(a.timer);const c=window.setTimeout(()=>{const l=this.fnMap.get(t);l&&l.fn(...l.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:c,args:o,skipFn:i})}else a.skipFn&&a.skipFn(...a.args),this.fnMap.set(t,te(te({},a),{},{fn:e,args:o,skipFn:i}))}else{const a=window.setTimeout(()=>{const c=this.fnMap.get(t);c&&c.fn(...c.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:a,args:o,skipFn:i})}}},l7=c7.throttleByKey.bind(c7);function d7(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function IN(e,t){if(!d7(e)||!d7(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let i=0;i<t.length;i++)n[i]=IN(e[i],t[i]);return n}{const n=te({},e);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=Object.prototype.hasOwnProperty.call(e,i)?IN(e[i],t[i]):t[i]);return n}}function u7(e,t){let n=[0];if(t&&(n=new Array(t).fill(0)),0===e)return n;let i=0;for(;e>0&&(n[i]=255&e,e>>=8,i++,!t||i!==t););return n}function RN(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function h7(e){const t="0123456789abcdef";function n(T){let I,D="";for(I=0;I<=3;I++)D+=t.charAt(T>>8*I+4&15)+t.charAt(T>>8*I&15);return D}function i(T,I){const D=(65535&T)+(65535&I);return(T>>16)+(I>>16)+(D>>16)<<16|65535&D}function r(T,I,D,O,k,L){return i((V=i(i(I,T),i(O,L)))<<(ee=k)|V>>>32-ee,D);var V,ee}function o(T,I,D,O,k,L,V){return r(I&D|~I&O,T,I,k,L,V)}function s(T,I,D,O,k,L,V){return r(I&O|D&~O,T,I,k,L,V)}function a(T,I,D,O,k,L,V){return r(I^D^O,T,I,k,L,V)}function c(T,I,D,O,k,L,V){return r(D^(I|~O),T,I,k,L,V)}const l=function(T){let I;const D=1+(T.length+8>>6),O=new Array(16*D);for(I=0;I<16*D;I++)O[I]=0;for(I=0;I<T.length;I++)O[I>>2]|=T.charCodeAt(I)<<I%4*8;return O[I>>2]|=128<<I%4*8,O[16*D-2]=8*T.length,O}(e);let d,u,h,p,m,f=1732584193,g=-271733879,E=-1732584194,b=271733878;for(d=0;d<l.length;d+=16)u=f,h=g,p=E,m=b,f=o(f,g,E,b,l[d+0],7,-680876936),b=o(b,f,g,E,l[d+1],12,-389564586),E=o(E,b,f,g,l[d+2],17,606105819),g=o(g,E,b,f,l[d+3],22,-1044525330),f=o(f,g,E,b,l[d+4],7,-176418897),b=o(b,f,g,E,l[d+5],12,1200080426),E=o(E,b,f,g,l[d+6],17,-1473231341),g=o(g,E,b,f,l[d+7],22,-45705983),f=o(f,g,E,b,l[d+8],7,1770035416),b=o(b,f,g,E,l[d+9],12,-1958414417),E=o(E,b,f,g,l[d+10],17,-42063),g=o(g,E,b,f,l[d+11],22,-1990404162),f=o(f,g,E,b,l[d+12],7,1804603682),b=o(b,f,g,E,l[d+13],12,-40341101),E=o(E,b,f,g,l[d+14],17,-1502002290),g=o(g,E,b,f,l[d+15],22,1236535329),f=s(f,g,E,b,l[d+1],5,-165796510),b=s(b,f,g,E,l[d+6],9,-1069501632),E=s(E,b,f,g,l[d+11],14,643717713),g=s(g,E,b,f,l[d+0],20,-373897302),f=s(f,g,E,b,l[d+5],5,-701558691),b=s(b,f,g,E,l[d+10],9,38016083),E=s(E,b,f,g,l[d+15],14,-660478335),g=s(g,E,b,f,l[d+4],20,-405537848),f=s(f,g,E,b,l[d+9],5,568446438),b=s(b,f,g,E,l[d+14],9,-1019803690),E=s(E,b,f,g,l[d+3],14,-187363961),g=s(g,E,b,f,l[d+8],20,1163531501),f=s(f,g,E,b,l[d+13],5,-1444681467),b=s(b,f,g,E,l[d+2],9,-51403784),E=s(E,b,f,g,l[d+7],14,1735328473),g=s(g,E,b,f,l[d+12],20,-1926607734),f=a(f,g,E,b,l[d+5],4,-378558),b=a(b,f,g,E,l[d+8],11,-2022574463),E=a(E,b,f,g,l[d+11],16,1839030562),g=a(g,E,b,f,l[d+14],23,-35309556),f=a(f,g,E,b,l[d+1],4,-1530992060),b=a(b,f,g,E,l[d+4],11,1272893353),E=a(E,b,f,g,l[d+7],16,-155497632),g=a(g,E,b,f,l[d+10],23,-1094730640),f=a(f,g,E,b,l[d+13],4,681279174),b=a(b,f,g,E,l[d+0],11,-358537222),E=a(E,b,f,g,l[d+3],16,-722521979),g=a(g,E,b,f,l[d+6],23,76029189),f=a(f,g,E,b,l[d+9],4,-640364487),b=a(b,f,g,E,l[d+12],11,-421815835),E=a(E,b,f,g,l[d+15],16,530742520),g=a(g,E,b,f,l[d+2],23,-995338651),f=c(f,g,E,b,l[d+0],6,-198630844),b=c(b,f,g,E,l[d+7],10,1126891415),E=c(E,b,f,g,l[d+14],15,-1416354905),g=c(g,E,b,f,l[d+5],21,-57434055),f=c(f,g,E,b,l[d+12],6,1700485571),b=c(b,f,g,E,l[d+3],10,-1894986606),E=c(E,b,f,g,l[d+10],15,-1051523),g=c(g,E,b,f,l[d+1],21,-2054922799),f=c(f,g,E,b,l[d+8],6,1873313359),b=c(b,f,g,E,l[d+15],10,-30611744),E=c(E,b,f,g,l[d+6],15,-1560198380),g=c(g,E,b,f,l[d+13],21,1309151649),f=c(f,g,E,b,l[d+4],6,-145523070),b=c(b,f,g,E,l[d+11],10,-1120210379),E=c(E,b,f,g,l[d+2],15,718787259),g=c(g,E,b,f,l[d+9],21,-343485551),f=i(f,u),g=i(g,h),E=i(E,p),b=i(b,m);return n(f)+n(g)+n(E)+n(b)}let a1e=1,_S=console,gi=class{static setLogger(e){_S=e}constructor(e){Ct(this,"lockingPromise",q.resolve()),Ct(this,"locks",0),Ct(this,"name",""),Ct(this,"lockId",void 0),this.lockId=a1e++,e&&(this.name=e),_S.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,_S.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:""));const n=new q(r=>{t=()=>{this.locks-=1,_S.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:"")),r()}}),i=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function tp(e,t){return function(n,i,r){const o=r.value;if("function"!=typeof o)throw new Error("Cannot use mutex on object property.");return r.value=C(function*(){const s=this[t];if(!s)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const a=yield s.lock("From ".concat(e,".").concat(i));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return yield o.apply(this,l)}finally{a()}}),r}}const vn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function AN(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Ls(e,t,n,i){const r=Object.assign({},vn,i);let o=r.timeout;const s=function(){var l=C(function*(){var d;yield(d=o,new q(u=>{window.setTimeout(u,d)})),o*=r.timeoutFactor,o=Math.min(r.maxRetryTimeout,o)});return function(){return l.apply(this,arguments)}}();let a=!1;const c=new q(function(){var l=C(function*(d,u){t=t||(()=>!1),n=n||(()=>!0);for(let h=0;h<r.maxRetryCount;h+=1){if(a)return u(new M(S.OPERATION_ABORTED));try{const p=yield e();if(!t(p,h)||h+1===r.maxRetryCount)return d(p);yield s()}catch(p){if(!n(p,h)||h+1===r.maxRetryCount)return u(p);yield s()}}});return function(d,u){return l.apply(this,arguments)}}());return c.cancel=()=>a=!0,c}class p7{constructor(t){Ct(this,"input",[]),Ct(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return 0===this.input.length?0:Ns(t=this.input).call(t,(n,i)=>n+i)/this.input.length}}let vS,ES=0,DN=0;function ON(e,t,n,i){return new q((r,o)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),ES+=ya(t.data)):n&&(t.data.size?ES+=t.data.size:t.data instanceof FormData?ES+=a7(t.data):ES+=ya(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,nr.request(t).then(s=>{"string"==typeof s.data?DN+=ya(s.data):s.data instanceof ArrayBuffer||s.data instanceof Uint8Array?DN+=s.data.byteLength:DN+=ya(JSON.stringify(s.data)),i&&r({data:s.data,headers:s.headers}),r(s.data)}).catch(s=>{nr.isCancel(s)?o(new M(S.OPERATION_ABORTED,"cancel token canceled")):o("ECONNABORTED"===s.code?new M(S.NETWORK_TIMEOUT,s.message):s.response?new M(S.NETWORK_RESPONSE_ERROR,s.response.status):new M(S.NETWORK_ERROR,s.message))})})}function c1e(e,t){return NN.apply(this,arguments)}function NN(){return NN=C(function*(e,t){const n=new Blob([t.data],{type:"buffer"});return yield ON(e,te(te({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}),NN.apply(this,arguments)}const f7=()=>void 0!==window.isSecureContext,Oo=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const i=t[2];return"".concat(t[1],".").concat(i)}return"4.0.0.999"}("4.22.1"),PN=function(){try{return!0===JSON.parse("true")}catch{return!0}}();let Cd=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const ri=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),r=[];for(let a=0;a<6;a++)r.push("1");const o=r.join(""),s={};return s[e]=i,s[t]=o,Object.assign(s,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=ri;const MN={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},xN="v4.22.1-0-g1c8e27e9(9/19/2024, 2:23:30 PM)",Jt=te(te({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:MN,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0,DISABLE_SCREEN_SHARE_REMB:!1},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0});function st(e,t,n){var i,r,o;Y(i=Object.keys(Jt)).call(i,e)&&(!n&&Y(r=Object.keys(ll)).call(r,e)||(Jt[e]=t,"ENABLE_VIDEO_SEI"===e&&!0===t&&(Jt.ENABLE_ENCODED_TRANSFORM=!0),"USE_NEW_NETWORK_CONFIG"===e&&t&&(Jt.USE_NEW_NETWORK_CONFIG=o=!!t,o&&(Jt.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Jt.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Jt.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Jt.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Jt.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Jt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Jt.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),"ENABLE_PRE_SUB"===e&&t&&(Jt.ENABLE_INSTANT_VIDEO=!0,Jt.ENABLE_PREALLOC_PC=!0),"ENABLE_SVC"===e&&t&&(Jt.ENABLE_AUT_CC=!0)))}function R(e){return Jt[e]}PN||(Jt.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Jt.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Jt.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Jt.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Jt.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Jt.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Jt.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Jt.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Jt.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Jt.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Jt.AREAS=["NORTH_AMERICA","OVERSEA"]);const ll={};var Ce=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(Ce||{});class l1e{constructor(t,n,i,r){Ct(this,"state",void 0),this.state={codec:t,audioCodec:n,mode:i,clientId:r,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Cd.Default}}dispatch(t){this.state=function(n,i){switch(i.type){case Ce.SET_SESSION_ID:return te(te({},n),{},{sessionId:i.sessionId});case Ce.SET_P2P_ID:return te(te({},n),{},{p2pId:i.p2pId});case Ce.SET_UID:return te(te({},n),{},{uid:i.uid});case Ce.SET_INT_UID:return te(te({},n),{},{intUid:i.intUid});case Ce.SET_PUB_ID:return te(te({},n),{},{pubId:i.pubId});case Ce.KEY_METRIC_CLIENT_CREATED:return te(te({},n),{},{keyMetrics:te(te({},n.keyMetrics),{},{clientCreated:i.metric})});case Ce.KEY_METRIC_JOIN_START:return te(te({},n),{},{keyMetrics:te(te({},n.keyMetrics),{},{joinStart:i.metric})});case Ce.AVOID_JOIN_START:return te(te({},n),{},{avoidJoinStart:i.avoidJoinStart});case Ce.KEY_METRIC_JOIN_END:return te(te({},n),{},{keyMetrics:te(te({},n.keyMetrics),{},{joinEnd:i.metric})});case Ce.KEY_METRIC_REQUEST_AP_START:return te(te({},n),{},{keyMetrics:te(te({},n.keyMetrics),{},{requestAPStart:i.metric})});case Ce.KEY_METRIC_REQUEST_AP_END:return te(te({},n),{},{keyMetrics:te(te({},n.keyMetrics),{},{requestAPEnd:i.metric})});case Ce.KEY_METRIC_JOIN_GATEWAY_START:return te(te({},n),{},{keyMetrics:te(te({},n.keyMetrics),{},{joinGatewayStart:i.metric})});case Ce.KEY_METRIC_JOIN_GATEWAY_END:return te(te({},n),{},{keyMetrics:te(te({},n.keyMetrics),{},{joinGatewayEnd:i.metric})});case Ce.KEY_METRIC_PEER_CONNECTION_START:return te(te({},n),{},{keyMetrics:te(te({},n.keyMetrics),{},{peerConnectionStart:i.metric})});case Ce.KEY_METRIC_PEER_CONNECTION_END:return te(te({},n),{},{keyMetrics:te(te({},n.keyMetrics),{},{peerConnectionEnd:i.metric})});case Ce.KEY_METRIC_DESCRIPTION_START:return te(te({},n),{},{keyMetrics:te(te({},n.keyMetrics),{},{descriptionStart:i.metric})});case Ce.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return te(te({},n),{},{keyMetrics:te(te({},n.keyMetrics),{},{signalChannelOpen:i.metric})});case Ce.KEY_METRIC_ICE_CONNECTION_END:return te(te({},n),{},{keyMetrics:te(te({},n.keyMetrics),{},{iceConnectionEnd:i.metric})});case Ce.KEY_METRIC_PUBLISH:{const r=n.keyMetrics.publish,o=r.findIndex(s=>s.trackId===i.metric.trackId);return-1!==o?(r[o]=te(te({},r[o]),i.metric),te(te({},n),{},{keyMetrics:te(te({},n.keyMetrics),{},{publish:[...r]})})):te(te({},n),{},{keyMetrics:te(te({},n.keyMetrics),{},{publish:[...n.keyMetrics.publish,i.metric]})})}case Ce.KEY_METRIC_SUBSCRIBE:{const r=n.keyMetrics.subscribe,o=r.findIndex(s=>s.userId===i.metric.userId&&s.type===i.metric.type);return-1!==o?(r[o]=te(te({},r[o]),i.metric),te(te({},n),{},{keyMetrics:te(te({},n.keyMetrics),{},{subscribe:[...r]})})):te(te({},n),{},{keyMetrics:te(te({},n.keyMetrics),{},{subscribe:[...n.keyMetrics.subscribe,i.metric]})})}case Ce.SET_CLOUD_PROXY_SERVER_MODE:return n.cloudProxyServerMode=i.mode,n;case Ce.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof i.index?n.joinChannelServiceRecords=[...n.joinChannelServiceRecords,i.record]:(n.joinChannelServiceRecords[i.index]=te(te({},n.joinChannelServiceRecords[i.index]),i.record),n.joinChannelServiceRecords=[...n.joinChannelServiceRecords]),n;case Ce.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return n.joinChannelServiceRecords=[],n;case Ce.RESET_KEY_METRICS:return n.keyMetrics={publish:[],subscribe:[]},n;case Ce.SET_USE_P2P:return te(te({},n),{},{useP2P:i.val});case Ce.SET_TRANSPORT_TYPE:return te(te({},n),{},{p2pTransport:i.val});default:return n}}(this.state,t)}set sessionId(t){this.dispatch({type:Ce.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}set codec(t){this.state.codec=t}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:Ce.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:Ce.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:Ce.SET_UID,uid:t})}get uid(){return this.state.uid}set intUid(t){this.dispatch({type:Ce.SET_INT_UID,intUid:t})}get intUid(){return this.state.intUid}set pubId(t){this.dispatch({type:Ce.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:Ce.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(t){this.dispatch({type:Ce.SET_USE_P2P,val:t})}get useP2P(){return this.state.useP2P}set p2pTransport(t){this.dispatch({type:Ce.SET_TRANSPORT_TYPE,val:t})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:Ce.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Ce.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Ce.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Ce.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Ce.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Ce.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Ce.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Ce.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Ce.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Ce.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Ce.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Ce.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,n,i,r){this.dispatch({type:Ce.KEY_METRIC_PUBLISH,metric:te(te({trackId:t,type:n},i&&{publishStart:i}),r&&{publishEnd:r})})}subscribe(t,n,i,r,o,s,a){this.dispatch({type:Ce.KEY_METRIC_SUBSCRIBE,metric:te(te(te(te(te({userId:t,type:n},i&&{subscribeStart:i}),r&&{subscribeEnd:r}),o&&{firstFrame:o}),s&&{streamAdded:s}),a&&{firstDecoded:a})})}massSubscribe(t,n,i,r){t.forEach(o=>{this.dispatch({type:Ce.KEY_METRIC_SUBSCRIBE,metric:te(te(te({userId:o.userId,type:o.type},n&&{subscribeStart:n}),i&&{subscribeEnd:i}),r&&{firstFrame:r})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,n){"gateway"===t.service&&Array.isArray(t.urls)&&(t.urls=t.urls.map(i=>i.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof n?(this.dispatch({type:Ce.RECORD_JOIN_CHANNEL_SERVICE,record:te(te({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(n<0||n>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Ce.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:n}),n)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Ce.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Ce.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:Ce.AVOID_JOIN_START,avoidJoinStart:t})}}let bS=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});!function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"}({});let u1e=0;function $t(e,t,n){return(t="symbol"==typeof(r=function(o,s){if("object"!=typeof o||!o)return o;var a=o[Symbol.toPrimitive];if(void 0!==a){var c=a.call(o,"string");if("object"!=typeof c)return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(t))?r:r+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e;var r}function _7(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function _e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_7(Object(n),!0).forEach(function(i){$t(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_7(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const v7=new class extends kt{constructor(){super(...arguments),$t(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class h1e{constructor(t){$t(this,"logger",void 0),$t(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function kN(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function E7(){const e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?t?.[0]+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const No={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},yS=Date.now(),kg=e=>{for(const t in No)if(Object.prototype.hasOwnProperty.call(No,t)&&No[t]===e)return t;return"DEFAULT"},_=new class{constructor(){$t(this,"proxyServerURL",void 0),$t(this,"logLevel",No.DEBUG),$t(this,"uploadState","collecting"),$t(this,"uploadLogWaitingList",[]),$t(this,"uploadLogUploadingList",[]),$t(this,"uploadErrorCount",0),$t(this,"currentLogID",0),$t(this,"url",void 0),$t(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[No.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[No.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[No.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[No.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[No.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){st("UPLOAD_LOG",!0)}disableLogUpload(){st("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new h1e(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-yS<100)return void setTimeout(()=>{this.log(...t)},Date.now()-yS);const i=Math.max(0,Math.min(4,t[0]));if(t[0]=kN()+" Agora-SDK [".concat(kg(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;const r=kN()+" %cAgora-SDK [".concat(kg(i),"]:");let o=[];if(!R("USE_NEW_LOG"))switch(i){case No.DEBUG:o=[r,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,o);break;case No.INFO:o=[r,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,o);break;case No.WARNING:o=[r,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,o);break;case No.ERROR:o=[r,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-yS<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-yS);const i=Math.max(0,Math.min(4,t[0]));t[0]=kN()+" Agora-SDK [".concat(kg(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!R("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=E7()+" Agora-SDK [".concat(kg(e),"]:"):n[0]=E7()+" Agora-SDK [".concat(kg(e),"]:");let r="";n.forEach(o=>{"object"==typeof o&&(o=JSON.stringify(o)),r+="".concat(o," ")}),this.uploadLogWaitingList.push({payload_str:r,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}uploadLogs(){var e=this;return C(function*(){const t=e.uploadLogUploadingList,n={sdk_version:Oo,process_id:R("PROCESS_ID"),payload:JSON.stringify(t)};return Ls(C(function*(){const i=yield nr.post(e.url||(e.proxyServerURL?"https://".concat(e.proxyServerURL,"/ls/?h=").concat(R("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(R("LOG_UPLOAD_SERVER"),"/upload/v1")),n,{responseType:"text"});if("OK"!==i.data){const r=new Error("unexpected upload log response");throw r.response=i,r}}),()=>(e.uploadLogUploadingList=[],!1),i=>{const r={status:-1,message:i.message,errorRange:t.map(o=>o.log_item_id)};return i.response?(r.status=i.response.status,r.data=i.response.data,r.headers=i.response.headers):i.request&&(r.status=i.request.status),v7.reportLogUploadError(r),!0},{timeout:R("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:R("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})})()}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,R("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),R("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),R("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),R("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var b7;function p1e(e){return Kn(e.reportId,"params.reportId",0,100,!1),Kn(e.category,"params.category",0,100,!1),Kn(e.event,"params.event",0,100,!1),Kn(e.label,"params.label",0,100,!1),ot(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(b7={}).FREE="free",b7.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const f1e={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Yn=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e}({}),Lt=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e}({});!function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}({});let m1e=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function le(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n,i){const r=i.value;if("function"==typeof r){const o=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);i.value=function(){for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];let l=a;if(e.argsMap)try{l=e.argsMap(this,...a)}catch(u){_.warning(u),l=[]}try{JSON.stringify(l)}catch{_.warning("arguments for method ".concat(o,".").concat(String(n)," not serializable for apiInvoke.")),l=[]}const d=(e.report||ne).reportApiInvoke(this._sessionId||null,{name:"".concat(o,".").concat(String(n)),options:l,tag:jt.TRACER,reportResult:e.reportResult},e.throttleTime);try{const u=r.apply(this,a);return u instanceof q?u.then(h=>(d.onSuccess(e.reportResult&&h),h)).catch(h=>{throw d.onError(h),h}):(d.onSuccess(e.reportResult&&u),u)}catch(u){throw d.onError(u),u}}}return i}}const ne=new class{constructor(){var e=this;$t(this,"baseInfoMap",new Map),$t(this,"proxyServer",void 0),$t(this,"eventUploadTimer",void 0),$t(this,"setSessionIdTimer",void 0),$t(this,"url",void 0),$t(this,"sids",new Set),$t(this,"backupUrl",void 0),$t(this,"_appId",void 0),$t(this,"keyEventUploadPendingItems",[]),$t(this,"normalEventUploadPendingItems",[]),$t(this,"apiInvokeUploadPendingItems",[]),$t(this,"apiInvokeCount",0),$t(this,"ltsList",[]),$t(this,"lastSendNormalEventTime",Date.now()),$t(this,"customReportCounterTimer",void 0),$t(this,"customReportCount",0),$t(this,"extApiInvoke",function(){var t=C(function*(n){for(const i of n){const r=_e(_e({},i),{},{sid:null,invokeId:++e.apiInvokeCount,tag:jt.TRACER});e.sendApiInvoke(r)}});return function(n){return t.apply(this,arguments)}}()),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),R("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),R("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void _.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));const t=this.baseInfoMap.get(e),n=Date.now(),i=t.startTime;t.startTime=n,_.debug("rewrite session ".concat(e," startTime: ").concat(n," , ").concat(n-i,"ms")),this.baseInfoMap.set(e,t)}setAppId(e){this._appId=e}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;const i=Date.now();this.apiInvokeCount+=1;const r=this.apiInvokeCount,o=()=>({tag:t.tag,invokeId:r,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null}),s=!!R("SHOW_REPORT_INVOKER_LOG");s&&_.info("".concat(t.name," start"),t.options);let a=!1;qn(t.timeout).then(()=>{a||(this.sendApiInvoke(_e(_e({},o()),{},{error:S.API_INVOKE_TIMEOUT,success:!1})),_.debug("".concat(t.name," timeout")))});const c=new M(S.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:l=>{const d=()=>{if(a)throw c;return a=!0,this.sendApiInvoke(_e(_e({},o()),{},{success:!0},t.reportResult&&{result:l})),s&&_.info("".concat(t.name," onSuccess")),l};return n?l7(d,t.name+"Success",n,()=>a=!0):d()},onError:l=>{const d=()=>{if(a)throw l;a=!0,this.sendApiInvoke(_e(_e({},o()),{},{success:!1,error:l})),s&&_.info("".concat(t.name," onFailure"),l.toString())};return n?l7(d,t.name+"Error",n,()=>a=!0):d()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),i=this.createBaseInfo(e,n);i.cname=t.cname;const r=Object.assign({},{willUploadConsoleLog:R("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:PN?"global":"oversea",areas:R("AREAS")&&R("AREAS").join(",")},t.extend),{stringUid:o,channelProfile:s,channelMode:a,isABTestSuccess:c,lsid:l,clientRole:d}=t,u=Date.now(),h=_e(_e({},i),{},{eventType:Yn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:xN,lts:u,elapse:u-n,extend:JSON.stringify(r),mode:t.mode,process:R("PROCESS_ID"),appType:R("APP_TYPE"),success:!0,version:Oo,stringUid:o,channelProfile:s,channelMode:a,isABTestSuccess:c,lsid:l,clientType:Y(p=window.navigator.userAgent).call(p,"AgoraWebView")?42:20,clientRole:d,serviceId:R("PROCESS_ID"),extensionID:R("PLUGIN_INFO").join(",")||""});var p;this.send({type:Lt.SESSION,data:h},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),o=_e(_e({},i),{},{eventType:Yn.JOIN_CHOOSE_SERVER,lts:r,eventElapse:t.elapse||r-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:r-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:Lt.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),o=_e(_e({},i),{},{eventType:Yn.REQ_USER_ACCOUNT,lts:r,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||r-n.startTime,eventElapse:r-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Lt.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;const r=Date.now(),{firstSuccess:o,avoidJoinStartTime:s}=t,a=r-(o&&s?s:n.startTime),c=_e(_e({},i),{},{eventType:Yn.JOIN_GATEWAY,lts:r,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:a,eventElapse:r-t.lts,firstSuccess:o,signalChannel:t.signalChannel,preload:t.preload?1:0});t.succ&&(n.lastJoinSuccessTime=r),this.send({type:Lt.JOIN_GATEWAY,data:c},!0)}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=Date.now(),r=_e(_e({},n.info),{},{lts:i,timeout:t,elapse:i-n.startTime});this.send({type:Lt.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),o=_e(_e({},i),{},{eventType:Yn.PUBLISH,lts:r,eventElapse:t.eventElapse,elapse:r-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Lt.PUBLISH,data:o},!0)}subscribe(e,t,n){const i=this.baseInfoMap.get(e);if(!i)return;const r=i.info,o=Date.now(),s=_e(_e({},r),{},{eventType:Yn.SUBSCRIBE,lts:o,eventElapse:t.eventElapse,elapse:o-i.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?s.peerSuid=t.peerid:s.peer=t.peerid,this.send({type:Lt.SUBSCRIBE,data:s},!0)}wsCompressorInit(e){var t;const n=[...Zr(t=this.baseInfoMap).call(t)],r=this.baseInfoMap.get(n.length?n[0]:"UnableToGetSid");if(!r)return;const o=r.info,s=Date.now(),a=_e(_e({},o),{},{eventType:Yn.WS_COMPRESSOR_INIT,lts:s,eventElapse:e.eventElapse,elapse:s-r.startTime,status:e.status?1:2});this.send({type:Lt.WS_COMPRESSOR_INIT,data:a},!0)}firstRemoteVideoDecode(e,t,n,i){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,s=Date.now(),a=_e(_e(_e({},o),i),{},{elapse:s-r.startTime,eventType:t,lts:s,firstDecodeFrame:Math.max((i.firstFrame||s)-r.startTime,0),apEnd:Math.max(i.apEnd-r.startTime,0),apStart:Math.max(i.apStart-r.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-r.startTime,0),joinGwStart:Math.max(i.joinGwStart-r.startTime,0),pcEnd:Math.max(i.pcEnd-r.startTime,0),pcStart:Math.max(i.pcStart-r.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-r.startTime,0),subscriberStart:Math.max(i.subscriberStart-r.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-r.startTime,0)});this.send({type:n,data:a},!0)}firstRemoteFrame(e,t,n,i){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,s=Date.now(),a=_e(_e(_e({},o),i),{},{elapse:s-r.startTime,eventType:t,lts:s});this.send({type:n,data:a},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),o=_e(_e(_e({},i),t),{},{vid:void 0===i.vid?0:Number(i.vid),elapse:r-n.startTime,eventType:Yn.PC_STATS,lts:r,preallocation:t.preallocation?1:0});this.send({type:Lt.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),o=_e(_e(_e({},i),t),{},{vid:void 0===i.vid?0:Number(i.vid),eventType:Yn.UPDATE_REMOTE_RTPCAPABILITIES,lts:r});this.send({type:Lt.UPDATE_REMOTE_RTPCAPABILITIES,data:o},!0)}}onGatewayStream(e,t,n,i){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,s=Date.now(),a=_e(_e(_e({},o),i),{},{eventType:t,lts:s});this.send({type:n,data:a},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),o=_e(_e({},i),{},{eventType:Yn.STREAM_SWITCH,lts:r,isDual:t.isdual,elapse:r-n.startTime,success:t.succ});this.send({type:Lt.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),o=_e(_e({},i),{},{eventType:Yn.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-t.lts,elapse:r-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Lt.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),o=_e(_e({},i),{},{eventType:Yn.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-t.lts,elapse:r-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Lt.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(e){this.proxyServer=e,_.debug(e?"reportProxyServerurl: ".concat(e):"disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),o=_e(_e({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:r,elapse:r-n.startTime,joinChannelSuccessElapse:r-(n.lastJoinSuccessTime||r),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Lt.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now();(function(o,s,a){const c=o[s];if(!c||"string"!=typeof c)return[o];o[s]="";const l=ya(JSON.stringify(o));let d=0;const u=[];let h=0;for(let p=0;p<c.length;p++)h+=c.charCodeAt(p)<=127?1:3,h<=1300-l||(u[u.length]=te(te({},o),{},{[s]:c.substring(d,p)}),d=p,h=c.charCodeAt(p)<=127?1:3);return d!==c.length-1&&(u[u.length]=te(te({},o),{},{[s]:c.substring(d)})),u})(_e(_e(_e({},i),t),{},{elapse:r-n.startTime,lts:r,productType:"WebRTC"}),"payload").forEach(o=>this.send({type:Lt.WORKER_EVENT,data:o},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),o=_e(_e(_e({},i),t),{},{elapse:r-n.startTime,lts:r});this.send({type:Lt.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),o=_e(_e(_e({},i),t),{},{elapse:r-n.startTime,lts:r,extend:t.extend||void 0});this.send({type:Lt.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,r=Date.now(),o=_e(_e(_e({},i),t),{},{elapse:r-n.startTime,lts:r});this.send({type:Lt.WEBSOCKET_QUIT,data:o},!0)}sendCustomReportMessage(e,t){var n=this;return C(function*(){if(n.customReportCount+=t.length,n.customReportCount>R("CUSTOM_REPORT_LIMIT"))throw new M(S.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);n.customReportCounterTimer||(n.customReportCounterTimer=window.setInterval(()=>{n.customReportCount=0},5e3));const i=Date.now(),r=t.map(o=>({type:Lt.USER_ANALYTICS,data:_e(_e({sid:e},o),{},{lts:i})}));try{R("NEW_REPORT_SERVER")?yield n.postDataToStatsCollector2(r):yield n.postDataToStatsCollector(r)}catch(o){throw _.error("send custom report message failed",o.toString()),new M(S.CUSTOM_REPORT_SEND_FAILED,o.message)}})()}sendApiInvoke(e){const t=R("NOT_REPORT_EVENT");if(e.tag&&Y(t)&&Y(t).call(t,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:r,cid:o}=n.info;let s;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof M){const{code:c,message:l}=e.error;s=c||l||e.error.toString()}else s=e.error.toString();const a={invokeId:e.invokeId,sid:e.sid,cname:i,cid:o,uid:r,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?s:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Lt.API_INVOKE,data:a},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(0===e.length)return;const t=Array.from(this.sids).find(n=>null!==n);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>R("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],i=[];for(;e.length;){const o=e.shift();n.length<20?n.push(o):i.push(o)}e.push(...i);for(const o of[...n]){var r;-1!==this.ltsList.indexOf(o.data.lts)?(o.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o.data.lts)):(this.ltsList.push(o.data.lts),gg(r=this.ltsList).call(r,(s,a)=>s-a))}return t||(this.lastSendNormalEventTime=Date.now()),R("ENABLE_EVENT_REPORT")&&n.length&&(R("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((o=>s=>{R("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(o):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(o),this.normalEventUploadPendingItems.length>R("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-R("NORMAL_EVENT_QUEUE_CAPACITY")),_.warning("report: drop normal events"))))})(n)),e}postDataToStatsCollector2(e){var t=this;return C(function*(){ln.networkState===Mr.OFFLINE&&(yield q.race([ln.onlineWaiter,qn(2*vn.maxRetryTimeout)]));const n=o=>{let s=new Uint8Array;return o.forEach(a=>{const c=TN(JSON.stringify(a.data)),l=new ArrayBuffer(5),d=(h=>{let p=0;return Object.entries(Lt).forEach(m=>{let[f,g]=m;g===h.type&&(p=m1e[f])}),p})(a),u=new DataView(l);u.setUint16(0,c.byteLength,!0),u.setUint8(2,255&d),u.setUint8(3,d>>>8&255),u.setUint8(4,d>>>16&255),s=Q9(s,new Uint8Array(l)),s=Q9(s,c)}),s},i="event";let r=t.proxyServer?"https://".concat(t.proxyServer,"/rs/?h=").concat(R("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(R("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let o=0;o<2;o+=1){1===o&&(r=t.proxyServer?"https://".concat(t.proxyServer,"/rs/?h=").concat(R("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(R("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{yield ON(r,{timeout:1e4,data:n(e),headers:_e(_e({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},t._appId&&{appid:t._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(1===o)throw s;continue}return}})()}postDataToStatsCollector(e){var t=arguments,n=this;return C(function*(){let i=t.length>1&&void 0!==t[1]&&t[1];const r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(a=>JSON.stringify(a)),vid:(a=>{const c=a&&a.data.sid&&n.baseInfoMap.get(a.data.sid);return c&&c.info.vid&&+c.info.vid||0})(e[0])};ln.networkState===Mr.OFFLINE&&(yield q.race([ln.onlineWaiter,qn(2*vn.maxRetryTimeout)]));const o=i?"/events/proto-raws":"/events/messages";let s=n.url||(n.proxyServer?"https://".concat(n.proxyServer,"/rs/?h=").concat(R("EVENT_REPORT_DOMAIN"),"&p=").concat(R("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(R("EVENT_REPORT_DOMAIN"),":").concat(R("STATS_COLLECTOR_PORT")).concat(o));for(let a=0;a<2;a+=1){1===a&&(s=n.backupUrl||(n.proxyServer?"https://".concat(n.proxyServer,"/rs/?h=").concat(R("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(R("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(R("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(R("STATS_COLLECTOR_PORT")).concat(o)));try{i?yield c1e(s,{timeout:1e4,data:r}):yield ON(s,{timeout:1e4,data:r})}catch(c){if(1===a)throw c;continue}return}})()}createBaseInfo(e,t){const n=Object.assign({},f1e);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),i=n[n.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:jt.TRACER}).onSuccess()}};v7.on("REPORT_LOG_UPLOAD",e=>{e.networkState=ln.networkState,ne.reportApiInvoke(null,{name:"logUploadError",options:e,tag:jt.TRACER}).onSuccess("logUploadError")});class N extends M{constructor(t){super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),$t(this,"name","AgoraRTCException")}print(){return super.print(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",_)}throw(){super.throw(_)}}const g1e=["CHINA","GLOBAL"],y7=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Td=[];function wd(e,t){return!!t&&Td.some(n=>n.uid===e&&n.channelName===t)}var _1e=HW.forEach,S7=ny("forEach")?[].forEach:function(e){return _1e(this,e,arguments.length>1?arguments[1]:void 0)};it({target:"Array",proto:!0,forced:[].forEach!=S7},{forEach:S7});var v1e=Yo("Array").forEach,E1e=ga,b1e=mi,y1e=Ki,S1e=v1e,LN=Array.prototype,C1e={DOMTokenList:!0,NodeList:!0},w1e=Vt(function(e){var t=e.forEach;return e===LN||y1e(LN,e)&&t===LN.forEach||b1e(C1e,E1e(e))?S1e:t}),I1e=ma,C7=ay;it({target:"Object",stat:!0,forced:Sn(function(){C7(1)})},{keys:function(e){return C7(I1e(e))}});var T7=Vt(Co.Object.keys),R1e=Vt(e6),A1e=it,D1e=Eg,O1e=_n([].reverse),w7=[1,2];A1e({target:"Array",proto:!0,forced:String(w7)===String(w7.reverse())},{reverse:function(){return D1e(this)&&(this.length=this.length),O1e(this)}});var N1e=Yo("Array").reverse,P1e=Ki,M1e=N1e,FN=Array.prototype,I7=function(e){var t=e.reverse;return e===FN||P1e(FN,e)&&t===FN.reverse?M1e:t},k1e=Vt(I7),L1e=it,R7=Eg,F1e=Ey,U1e=Xr,A7=$A,V1e=oc,B1e=Yc,j1e=My,H1e=cn,G1e=by,W1e=PW("slice"),z1e=H1e("species"),UN=Array,K1e=Math.max;L1e({target:"Array",proto:!0,forced:!W1e},{slice:function(e,t){var n,i,r,o=B1e(this),s=V1e(o),a=A7(e,s),c=A7(void 0===t?s:t,s);if(R7(o)&&((F1e(n=o.constructor)&&(n===UN||R7(n.prototype))||U1e(n)&&null===(n=n[z1e]))&&(n=void 0),n===UN||void 0===n))return G1e(o,a,c);for(i=new(void 0===n?UN:n)(K1e(c-a,0)),r=0;a<c;a++,r++)a in o&&j1e(i,r,o[a]);return i.length=r,i}});var q1e=Yo("Array").slice,Y1e=Ki,$1e=q1e,VN=Array.prototype,Z1e=Vt(function(e){var t=e.slice;return e===VN||Y1e(VN,e)&&t===VN.slice?$1e:t});function Q(e,t,n,i,r){var o,s,a,c={};return w1e(o=T7(i)).call(o,function(l){c[l]=i[l]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=R1e(s=k1e(a=Z1e(n).call(n)).call(a)).call(s,function(l,d){return d(e,t,l)||l},c),r&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(r):void 0,c.initializer=void 0),void 0===c.initializer&&(AW(e,t,c),c=null),c}let BN=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),eo=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),SS=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),jN=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Zo=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),$i=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),ce=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),_t=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),he=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),pe=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),Lg=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Te=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Xi=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),fe=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function CS(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw _.error("Invalid Channel Name ".concat(e)),new N(S.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function TS(e){if(!function(t){return"number"==typeof t&&Math.floor(t)===t&&0<=t&&t<=4294967295}(e)&&!Z9(e,1,255))throw new N(S.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");"string"==typeof e&&_.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Sa=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const J1e={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},HN={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function GN(e,t){Kn(e.url,"".concat(t,".url"),1,1e3,!1),xt(e.x)||ot(e.x,"".concat(t,".x"),0,1e4),xt(e.y)||ot(e.y,"".concat(t,".y"),0,1e4),xt(e.width)||ot(e.width,"".concat(t,".width"),0,1e4),xt(e.height)||ot(e.height,"".concat(t,".height"),0,1e4),xt(e.zOrder)||ot(e.zOrder,"".concat(t,".zOrder"),0,255),xt(e.alpha)||ot(e.alpha,"".concat(t,".alpha"),0,1,!1)}const Q1e={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let dl=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),WN=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Tn=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function D7(e){if(!e.channelName)throw new N(S.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new N(S.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Kn(e.token,"info.token",1,2047),TS(e.uid),CS(e.channelName),!0}let Zi=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),lc=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),vr=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),ip=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),$e=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),oi=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e}({}),wS=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Ln=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),We=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const O7=[We.AFRICA,We.ASIA,We.CHINA,We.EUROPE,We.GLOBAL,We.INDIA,We.JAPAN,We.NORTH_AMERICA,We.OCEANIA,We.OVERSEA,We.SOUTH_AMERICA];let _i=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const IS={CHINA:{},ASIA:{CODE:_i.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:_i.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:_i.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:_i.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:_i.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:_i.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:_i.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:_i.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:_i.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:_i.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:_i.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:_i.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:_i.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};PN&&(IS.CHINA={CODE:_i.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let zN=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e}({});class N7 extends kt{constructor(t,n){super(),y(this,"onICEConnectionStateChange",void 0),y(this,"onConnectionStateChange",void 0),y(this,"onDTLSTransportStateChange",void 0),y(this,"onDTLSTransportError",void 0),y(this,"onICETransportStateChange",void 0),y(this,"onFirstAudioReceived",void 0),y(this,"onFirstVideoReceived",void 0),y(this,"onFirstAudioDecoded",void 0),y(this,"onFirstVideoDecoded",void 0),y(this,"onFirstVideoDecodedTimeout",void 0),y(this,"onSelectedLocalCandidateChanged",void 0),y(this,"onSelectedRemoteCandidateChanged",void 0),y(this,"getLocalVideoStats",void 0)}}class P7 extends N7{constructor(t,n){super(t,n),y(this,"establishPromise",void 0)}}let ie=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),xr=function(e){return e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY",e}({}),dc=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),j=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Xe=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),de=function(e){return e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Jo=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Qo=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Bn=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),M7=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Ca=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Po=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Fs=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),rp=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Qt=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),op=function(e){return e.ABORT="abort",e}({}),ul=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),exe=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const txe={[SS.ACCESS_POINT]:{[$i.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[$i.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[$i.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[$i.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[$i.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[$i.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[$i.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[SS.UNILBS]:{[Zo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Zo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Zo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Zo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Zo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Zo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Zo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Zo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Zo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Zo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Zo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Zo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[SS.STRING_UID_ALLOCATOR]:{[jN.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[jN.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[jN.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function sp(e){const t=txe[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===SS.ACCESS_POINT){const i=e%1e4;if("1"===i.toString()[0])return{desc:e.toString(),retry:!1};if("2"===i.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const nxe={[ce.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[ce.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[ce.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[ce.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[ce.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[ce.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[ce.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[ce.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[ce.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[ce.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[ce.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[ce.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[ce.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[ce.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[ce.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[ce.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[ce.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[ce.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[ce.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[ce.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[ce.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[ce.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[ce.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[ce.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[ce.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[ce.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[ce.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[ce.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[ce.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[ce.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[ce.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[ce.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[ce.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[ce.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[ce.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[ce.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[ce.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[ce.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[ce.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[ce.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[ce.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ce.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ce.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[ce.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[ce.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[ce.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[ce.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[ce.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[ce.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[ce.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[ce.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[ce.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[ce.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[ce.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[ce.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[ce.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[ce.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[ce.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[ce.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[ce.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[ce.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[ce.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[ce.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Fg(e){return nxe[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function x7(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function KN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x7(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x7(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function k7(e){return e.every(t=>t.readyState===WebSocket.CLOSED||t.readyState===WebSocket.CLOSING)}function L7(e,t){if("string"==typeof e)return e;const{proxy:n,host:i,port:r}=e;if(t){const o=R("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===o?"wss://".concat(i,"/ws/?p=").concat(Number(r)+150):"wss://".concat(i,":").concat(o,"/ws/?p=").concat(Number(r)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(r):"wss://".concat(i,":").concat(r)}const ixe=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,rxe=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,oxe=/wss:\/\/(.+):([0-9]+)\/?/,sxe=/wss:\/\/(.[^\/]+)\/?/;let axe=0;class cxe{constructor(t,n){y(this,"id",0),y(this,"store",void 0),y(this,"recordIndex",void 0),y(this,"websockets",[]),y(this,"try443PortDuration",2e3),y(this,"forceCloseWSDuration",5e3),y(this,"try443PortTimeout",null),y(this,"forceCloseTimeout",null),y(this,"isTry443PortFailed",!1),y(this,"isNormalPortFailed",!1),y(this,"useDoubleDomain",!1),y(this,"useProxy",!1),y(this,"startTime",Date.now()),this.id=++axe,this.try443PortDuration=R("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var t;const n=Date.now()-this.startTime;for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];_.debug("[choose-best-ws ".concat(null===(t=this.store)||void 0===t?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...r)}createWebSocket(t,n,i){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:i});const r=R("GATEWAY_DOMAINS"),o=Date.now(),s=[],a=r.find(d=>{var u;return Y(u=t.host).call(u,d)});a||(this.useDoubleDomain=!1);const c=[];if(this.useDoubleDomain)r.forEach(d=>{c.push(L7(KN(KN({},t),{},{host:t.host.replace(a,d)}),n))});else{const d=KN({},t);if(n&&a){const u=r.find(h=>h!==a);u&&(d.host=d.host.replace(a,u))}c.push(L7(d,n))}try{c.forEach(d=>{const u=new WebSocket(d);u.binaryType="arraybuffer",s.push(u),this.logger("ws is connecting:",u.url)})}catch(d){if(this.logger("ws create failed"),s.forEach(u=>u.close()),s.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,i);if(!n&&443!==Number(t.port))return this.createWebSocket(t,!0,i);throw new N(S.WS_ERR,"init websocket failed! Error: ".concat(d.toString()))}const l=Og();return this.store&&this.store.recordJoinChannelService({urls:s.map(d=>d.url),service:"gateway"},this.recordIndex),s.forEach(d=>{d.onopen=()=>{this.logger("onopen: ws ".concat(d.url," open cost ").concat(Date.now()-o,"ms")),this.websockets.forEach(u=>{u!==d&&(u.onopen=null,u.onclose=null,u.onmessage=null,u.close(),this.logger("close backup websocket: ".concat(u.url)))}),this.websockets.length=0,l.resolve(d)},d.onclose=u=>{this.logger("onclose: ws ".concat(d.url," closed cost ").concat(Date.now()-o,"ms state: ").concat(d.readyState)),n?this.isTry443PortFailed=k7(s):this.isNormalPortFailed=k7(s),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(n&&this.isTry443PortFailed||!n&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(u.reason)),l.reject({code:u.code,reason:wS.A_ROUND_WS_FAILED}))},d.onmessage=u=>this.logger("".concat(d.url," onmessage: ").concat(u.data))}),this.websockets.push(...s),i||(()=>{const d=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",l.isResolved),this.websockets.forEach(u=>u.readyState!==WebSocket.OPEN&&u.close())};if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(d,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",l.isResolved),l.isResolved)return d();xe().os===kn.MAC_OS&&Bt()&&d(),this.createWebSocket(t,!0,!0).then(u=>l.resolve(u)).catch(u=>{this.isNormalPortFailed&&l.reject(u),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(d,this.forceCloseWSDuration)},this.try443PortDuration)})(),l.promise}chooseBestWebsocket(t,n,i,r){return this.useDoubleDomain=!!n,"string"==typeof t&&(t=function(o){let s,a,c;return[,s,a,c]=o.match(ixe)||[],s||([,a,c]=o.match(rxe)||[]),a&&c||([,a,c]=o.match(oxe)||[]),a&&c||([,a]=o.match(sxe)||[]),a||_.warning("un-destructible url: ",o),{proxy:s,host:a,port:c||"443"}}(t)),this.recordIndex=r,this.useProxy=!!t.proxy,i&&this.useProxy&&(_.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(t,!!i,!1).finally(()=>this.clearTimeout())}}function F7(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}class U7 extends kt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;Y(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,"reconnecting"===this._state?this.emit(fe.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(fe.CONNECTED):"closed"===this._state?this.emit(fe.CLOSED):"failed"===this._state&&this.emit(fe.FAILED))}resetReconnectCount(t){_.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0;super(),y(this,"connectionID",0),y(this,"currentURLIndex",0),y(this,"urls",[]),y(this,"_reconnectMode","tryNext"),y(this,"reconnectReason",void 0),y(this,"_initMutex",new gi("websocket")),y(this,"name",void 0),y(this,"_state","closed"),y(this,"reconnectInterrupter",void 0),y(this,"websocket",void 0),y(this,"retryConfig",void 0),y(this,"reconnectCount",0),y(this,"forceCloseTimeout",5e3),y(this,"onlineReconnectListener",void 0),y(this,"useCompress",void 0),y(this,"tryDoubleDomain",!1),y(this,"use443PortOnly",!1),y(this,"wsInflateLength",0),y(this,"wsDeflateLength",0),y(this,"closeEstablishingWs",()=>{}),y(this,"store",void 0),y(this,"joinGatewayRecordIndex",void 0),this.store=s,this.name=t,this.retryConfig=function(u){for(var h=1;h<arguments.length;h++){var p=null!=arguments[h]?arguments[h]:{};h%2?F7(Object(p),!0).forEach(function(m){y(u,m,p[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(p)):F7(Object(p)).forEach(function(m){Object.defineProperty(u,m,Object.getOwnPropertyDescriptor(p,m))})}return u}({},n),this.useCompress=i,this.tryDoubleDomain=r,this.use443PortOnly=o;const{timeout:a,timeoutFactor:c}=n,l=Math.max(300,Math.floor(3*a/5)),d=Math.max(1.2,Math.floor(8*c)/10);Mr.ONLINE&&(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=d),ln.on(Jh.NETWORK_STATE_CHANGE,(u,h)=>{u!==h&&(this.resetReconnectCount("network state change: ".concat(h," -> ").concat(u)),u===Mr.ONLINE?(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=d):(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=c))})}getConnection(){return this.websocket||void 0}init(t){var n=arguments,i=this;return C(function*(){let r=n.length>1&&void 0!==n[1]?n[1]:5e3;const o=yield i._initMutex.lock();i.forceCloseTimeout=r,i.urls=t,i.state="connecting";try{const s=Og(),a=i.urls[i.currentURLIndex];R("ENABLE_PREALLOC_PC")&&i.emit(M7.PRE_CONNECT_PC),i.createWebSocketConnection(a).then(s.resolve).catch(s.reject),i.once(fe.CLOSED,()=>{s.reject(new M(S.WS_DISCONNECT))}),i.once(fe.CONNECTED,s.resolve),yield s.promise}catch{}finally{o()}})()}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void _.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==t&&(this.reconnectMode=t),_.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new M(S.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new M(S.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}createWebSocketConnection(t){var n=this;return C(function*(){var i;const r=Og();n.connectionID+=1,n.joinGatewayRecordIndex=void 0;const o=u=>{var h;null===(h=n.store)||void 0===h||h.signalChannelOpen(),_.debug("[".concat(n.name,"] websocket opened:"),u),n.reconnectMode="retry",n.state="connected",n.resetReconnectCount("opened"),r.resolve()},s=function(){var u=C(function*(h){var p;if(_.debug("[".concat(n.name,"] websocket close ").concat(null===(p=n.websocket)||void 0===p?void 0:p.url,", code: ").concat(h.code,", reason: ").concat(h.reason,", current mode: ").concat(n.reconnectMode)),n.reconnectCount>=n.retryConfig.maxRetryCount)r.reject(new M(S.WS_DISCONNECT,"websocket close: ".concat(h.code))),n.close();else{"connected"===n.state&&(n.reconnectReason=h.reason,n.state="reconnecting");const m=Do(n,fe.WILL_RECONNECT,n.reconnectMode,h.reason)||n.reconnectMode,f=yield n.reconnectWithAction(m);if("closed"===n.state)return void _.debug("[".concat(n.connectionID,"] ws is closed, no need to reconnect"));if(!f)return r.reject(new M(S.WS_DISCONNECT,"websocket reconnect failed: ".concat(h.code))),n.close(!0);r.resolve()}});return function(p){return u.apply(this,arguments)}}(),a=u=>{n.emit(fe.ON_MESSAGE,u)},c=u=>{_.warn("[".concat(n.connectionID,"] ws open error ").concat(u))};n.websocket&&(n.websocket.onclose=null,n.websocket.close()),R("GATEWAY_WSS_ADDRESS")&&n.name.startsWith("gateway")&&(t=R("GATEWAY_WSS_ADDRESS")),_.debug("[".concat(n.name,"] start connect, url:"),t);const l=null===(i=n.store)||void 0===i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var d;const u=yield n.chooseBestWebsocketConnection(t);n.websocket=u,o&&o(n.websocket.url),n.websocket.onclose=s,n.websocket.onmessage=a,n.websocket.onerror=c,null===(d=n.store)||void 0===d||d.recordJoinChannelService({endTs:Date.now(),status:"success"},l),n.joinGatewayRecordIndex=l}catch(u){const h="closed"===n.state,p=u instanceof M,m=p&&u.code===S.WS_ABORT,f=p&&u.code===S.WS_ERR,g=p?u.message:u&&(u.reason||u.toString());_.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(g)),n.store&&n.store.recordJoinChannelService({endTs:Date.now(),status:m?"aborted":"error",errors:[u]},l),h||f?(r.reject(h?new M(S.WS_DISCONNECT,"websocket is closed: ".concat(g)):new M(S.WS_ERR,"init websocket failed: ".concat(g))),f&&_.error("[".concat(n.name,"] init websocket failed: ").concat(g))):s&&s(u)}return r.promise})()}reconnectWithAction(t){var n=arguments,i=this;return C(function*(){let r=!(n.length>1&&void 0!==n[1])||n[1];if(i.reconnectCount>=i.retryConfig.maxRetryCount||0===i.urls.length||"closed"===i.state)return!1;_.warning("[choose-best-ws] action: =>",t),i.onlineReconnectListener||ln.isOnline||!ln.onlineWaiter||(i.onlineReconnectListener=ln.onlineWaiter.then(()=>{i.onlineReconnectListener=void 0}));let o=!0;if(i.reconnectInterrupter=()=>o=!1,r){const c=AN(i.reconnectCount,i.retryConfig);_.debug("[".concat(i.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(t)),yield q.race([qn(c),i.onlineReconnectListener||new q(()=>{})])}if("closed"===i._state||!o)return!1;i.reconnectCount+=1;const s=function(){var c=C(function*(l,d){i.emit(fe.RECONNECT_CREATE_CONNECTION,d),yield i.createWebSocketConnection(l)});return function(d,u){return c.apply(this,arguments)}}();try{if("retry"===t)i.emit(fe.RECONNECT_WAITTING_FINISH,t),yield s(i.urls[i.currentURLIndex],t);else if("tryNext"===t){if(i.currentURLIndex+=1,i.currentURLIndex>=i.urls.length)return i.reconnectWithAction("recover",!1);_.debug("[".concat(i.name,"] websocket url length: ").concat(i.urls.length," current index: ").concat(i.currentURLIndex)),i.emit(fe.RECONNECT_WAITTING_FINISH,t),yield s(i.urls[i.currentURLIndex],t)}else"recover"===t&&(_.debug("[".concat(i.name,"] request new urls")),i.resetReconnectCount("recover mode"),i.emit(fe.RECONNECT_WAITTING_FINISH,t),i.urls=yield ii(i,fe.REQUEST_NEW_URLS),i.currentURLIndex=0,yield s(i.urls[i.currentURLIndex],t))}catch(c){var a;_.error("[".concat(i.name,"] reconnect failed ").concat(c&&c.toString()));const l=null==c||null===(a=c.data)||void 0===a?void 0:a.desc;return Array.isArray(l)&&Y(l).call(l,"dynamic key expired")?(i.emit(fe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):i.reconnectWithAction(t,r)}return!0})()}}class qN extends U7{constructor(t,n){super(t,n,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(t,n){var i=this;return C(function*(){const r=Og(),o=new cxe(i.forceCloseTimeout,i.store);i.closeEstablishingWs=()=>{_.debug("[choose-best-ws] close establishing websockets"),o.closeAllWebsockets(),r.reject(new M(S.WS_ABORT,"choose best websocket aborted"))};const s=R("GATEWAY_DOMAINS");return _.debug("[choose-best-ws] currentDomain: ",t,", domains: ",s,"total: ".concat(i.urls.length),"current: ".concat(i.currentURLIndex+1)),o.chooseBestWebsocket(t,i.tryDoubleDomain,i.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally(()=>{i.closeEstablishingWs=void 0})})()}}class Ug extends U7{constructor(t,n){super(t,n,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(t,n){var i=this;return C(function*(){return new q((r,o)=>{let s=!1;const a=[];i.closeEstablishingWs=()=>{_.debug("[choose-best-ws] close establishing websockets"),a.forEach(f=>{f.onclose=null,f.onopen=null,f.onmessage=null,f.close()}),o(new M(S.WS_ABORT,"choose best websocket aborted"))};const c=R("GATEWAY_DOMAINS");let l;const d=t.indexOf("?h="),u=c.find(f=>-1!==d?Y(t).call(t,f,d):Y(t).call(t,f));_.debug("[choose-best-ws] currentDomain: ",u,", domains: ",c);let h=!i.tryDoubleDomain||!u;if(!h&&u){var p;const f=Date.now();try{c.forEach(g=>{const E=-1===d?t.replace(u,g):t.substr(0,d)+t.substr(d).replace(u,g),b=new WebSocket(E);b.binaryType="arraybuffer",a.push(b),_.debug("[choose-best-ws] ws is connecting:",b.url)})}catch{for(_.debug("[choose-best-ws] ws create failed, fallback to single url"),a.forEach(E=>E.close());a.length;)a.pop();h=!0}null===(p=i.store)||void 0===p||p.recordJoinChannelService({urls:a.map(g=>g.url),service:"gateway"},n),a.forEach(g=>{g.onopen=()=>{if(s)return;const E=Date.now()-f;_.debug("[choose-best-ws] ws open cost ".concat(E,"ms")),a.filter(b=>b!==g).forEach(b=>{_.debug("[choose-best-ws]close backup websocket: ".concat(b.url)),b.close()}),s=!0,r(g)},g.onclose=E=>{l=E,!s&&(a.find(b=>!(b.readyState===WebSocket.CLOSED||b.readyState===WebSocket.CLOSING))||(_.debug("[choose-best-ws] all websocket is closed"),s=!0,o(l)))},g.onmessage=E=>{_.debug("[choose-best-ws]".concat(g.url," onmessage: ").concat(E.data))}}),qn(i.forceCloseTimeout).then(()=>{a.forEach(g=>{g.readyState!==WebSocket.OPEN&&g.close()})})}if(h){var m;let f;_.debug("[choose-best-ws] use single url: ",t),null===(m=i.store)||void 0===m||m.recordJoinChannelService({urls:[t],service:"gateway"},n);try{f=new WebSocket(t),a.push(f),f.binaryType="arraybuffer"}catch(g){const E=new M(S.WS_ERR,"init websocket failed! Error: ".concat(g.toString()));return _.error("[".concat(i.name,"]").concat(E)),void o(E)}f.onopen=()=>{r(f)},f.onclose=g=>{o(g)},f.onmessage=g=>{_.debug("[choose-best-ws]".concat(f.url," onmessage: ").concat(g.data))},qn(i.forceCloseTimeout).then(()=>{f&&f.readyState!==WebSocket.OPEN&&f.close()})}}).then(r=>(i.closeEstablishingWs=void 0,r)).catch(r=>{throw i.closeEstablishingWs=void 0,r})})()}}class lxe extends kt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===_t.CONNECTED?this.emit(he.WS_CONNECTED):t===_t.RECONNECTING?this.emit(he.WS_RECONNECTING,this._websocketReconnectReason):t===_t.CLOSED&&this.emit(he.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),y(this,"_disconnectedReason",void 0),y(this,"_websocketReconnectReason",void 0),y(this,"_connectionState",_t.CLOSED),y(this,"reconnectToken",void 0),y(this,"websocket",void 0),y(this,"openConnectionTime",void 0),y(this,"clientId",void 0),y(this,"lastMsgTime",Date.now()),y(this,"uploadCache",[]),y(this,"uploadCacheInterval",void 0),y(this,"rttRolling",new p7(5)),y(this,"pingpongTimer",void 0),y(this,"wsInflateDataTimer",void 0),y(this,"pingpongTimeoutCount",0),y(this,"joinResponse",void 0),y(this,"multiIpOption",void 0),y(this,"initError",void 0),y(this,"spec",void 0),y(this,"store",void 0),y(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(he.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const o="res-@".concat(r._id);this.emit(o,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){if(this.emit(r._type,r._message),r._type===Te.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===Te.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Qe.UID_BANNED);break;case 15:this.close(Qe.IP_BANNED);break;case 16:this.close(Qe.CHANNEL_BANNED)}if(r._type===Te.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case ce.ERR_LICENSE_MISSING:this.close(Qe.LICENSE_MISSING);break;case ce.ERR_LICENSE_EXPIRED:this.close(Qe.LICENSE_EXPIRED);break;case ce.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Qe.LICENSE_MINUTES_EXCEEDED);break;case ce.ERR_LICENSE_PERIOD_INVALID:this.close(Qe.LICENSE_PERIOD_INVALID);break;case ce.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Qe.LICENSE_MULTIPLE_SDK_SERVICE);break;case ce.ERR_LICENSE_ILLEGAL:this.close(Qe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new qN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,R("JOIN_GATEWAY_USE_DUAL_DOMAIN"),R("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===_t.CONNECTED&&this.reconnect("retry",ni.OFFLINE)})}request(t,n,i,r){var o=this;return C(function*(){const s=gt(6,""),a={_id:s,_type:t,_message:n},c=o.websocket.connectionID,l=()=>new q((f,g)=>{if(o.connectionState===_t.CONNECTED)return f();const E=()=>{o.off(he.WS_CLOSED,b),f()},b=()=>{o.off(he.WS_CONNECTED,E),g(new N(S.WS_ABORT))};o.once(he.WS_CONNECTED,E),o.once(he.WS_CLOSED,b),t!==pe.PUBLISH&&t!==pe.PUBLISH_DATASTREAM&&t!==pe.SUBSCRIBE&&t!==pe.SUBSCRIBE_DATASTREAM&&t!==pe.UNSUBSCRIBE&&t!==pe.UNSUBSCRIBE_DATASTREAM&&t!==pe.UNPUBLISH&&t!==pe.UNPUBLISH_DATASTREAM&&t!==pe.CONTROL&&t!==pe.RESTART_ICE||o.once(he.DISCONNECT_P2P,()=>{g(new N(S.DISCONNECT_P2P))}),t!==pe.PUBLISH&&t!==pe.RESTART_ICE||o.once(he.ABORT_P2P_EXECUTION,()=>{g(new N(S.DISCONNECT_P2P))})});if(o.connectionState!==_t.CONNECTING&&o.connectionState!==_t.RECONNECTING||t===pe.JOIN||t===pe.REJOIN||(yield l()),o.websocket.sendMessage(a,!0),r)return;const d=new q((f,g)=>{let E=!1;const b=(I,D)=>{E=!0,f({isSuccess:"success"===I,message:D||{}}),o.off(he.WS_CLOSED,T),o.off(he.WS_RECONNECTING,T),o.emit(he.REQUEST_SUCCESS,t,n)};o.once("res-@".concat(s),b);const T=()=>{g(new N(S.WS_ABORT,"type: ".concat(t))),o.off(he.WS_CLOSED,T),o.off(he.WS_RECONNECTING,T),o.off("res-@".concat(s),b)};o.once(he.WS_CLOSED,T),o.once(he.WS_RECONNECTING,T),qn(R("SIGNAL_REQUEST_TIMEOUT")).then(()=>{o.websocket.connectionID!==c||E||(_.warning("[".concat(o.clientId,"] ws request timeout, type: ").concat(t)),o.emit(he.REQUEST_TIMEOUT,t,n))})});let u=null;try{u=yield d}catch(f){if(o.connectionState===_t.CLOSED||t===pe.LEAVE)throw new N(S.WS_ABORT);return!o.spec.forceWaitGatewayResponse||i?f.throw():t===pe.JOIN||t===pe.REJOIN?null:(yield l(),yield o.request(t,n))}if(u.isSuccess)return u.message;const h=Number(u.message.error_code||u.message.code),p=Fg(h),m=new N(S.UNEXPECTED_RESPONSE,"".concat(p.desc,": ").concat(u.message.error_str),{code:h,data:u.message,desc:p.desc});return"success"===p.action?u.message:(_.warning("[".concat(o.clientId,"] [").concat(o.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(h,", message: ").concat(p.desc,", action: ").concat(p.action)),h===ce.ERR_TOO_MANY_BROADCASTERS?((t===pe.JOIN||t===pe.REJOIN)&&(o.initError=m,o.close()),m.throw()):"failed"===p.action?m.throw():"quit"===p.action?(o.initError=m,o.close(),m.throw()):(h===ce.ERR_JOIN_BY_MULTI_IP?(o.multiIpOption=u.message.option,_.warning("[".concat(o.clientId,"] detect multi ip, recover")),o.reconnect("recover",ni.MULTI_IP)):o.reconnect(p.action,ni.SERVER_ERROR),t===pe.JOIN||t===pe.REJOIN?null:yield o.request(t,n)))})()}waitMessage(t,n){return new q(i=>{const r=o=>{(!n||n(o))&&(this.off(t,r),i(o))};this.on(t,r)})}uploadWRTCStats(t){if(!this.store.sessionId)return void _.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Lg.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const o=R("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==_t.CONNECTED)return;const s=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(s._type,s._message)},R("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){this.websocket.sendMessage({_type:t,_message:n})}init(t,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new q((i,r)=>{this.once(he.WS_CONNECTED,()=>i(this.joinResponse)),this.once(he.WS_CLOSED,()=>r(this.initError||new N(S.WS_ABORT))),this.connectionState=_t.CONNECTING,this.websocket.init(t).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Qe.LEAVE,this.connectionState=_t.CLOSED,_.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}join(){var t=this;return C(function*(){if(!t.joinResponse){t.emit(he.ABORT_P2P_EXECUTION);const n=yield ii(t,he.REQUEST_JOIN_INFO),i=yield t.request(pe.JOIN,n);if(!i)return t.emit(he.REPORT_JOIN_GATEWAY,wS.TIMEOUT,t.url||""),!1;t.joinResponse=i,t.emit(he.JOIN_RESPONSE,t.joinResponse),t.reconnectToken=t.joinResponse.rejoin_token}return t.connectionState=_t.CONNECTED,t.pingpongTimer&&window.clearInterval(t.pingpongTimer),t.pingpongTimer=window.setInterval(t.handlePingPong.bind(t),3e3),!0})()}rejoin(){var t=this;return C(function*(){if(!t.reconnectToken)throw new N(S.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const n=xg(t,he.REQUEST_REJOIN_INFO);n.token=t.reconnectToken;const i=yield t.request(pe.REJOIN,n);return!!i&&(t.connectionState=_t.CONNECTED,t.pingpongTimer&&window.clearInterval(t.pingpongTimer),t.pingpongTimer=window.setInterval(t.handlePingPong.bind(t),3e3),i.peers&&i.peers.forEach(r=>{t.emit(Te.ON_USER_ONLINE,{uid:r.uid}),r.audio&&t.emit(Te.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&t.emit(Te.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),t.emit(r.audio_mute?Te.MUTE_AUDIO:Te.UNMUTE_AUDIO,{uid:r.uid}),t.emit(r.video_mute?Te.MUTE_VIDEO:Te.UNMUTE_VIDEO,{uid:r.uid}),t.emit(r.audio_enable_local?Te.ENABLE_LOCAL_AUDIO:Te.DISABLE_LOCAL_AUDIO,{uid:r.uid}),t.emit(r.video_enable_local?Te.ENABLE_LOCAL_VIDEO:Te.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||t.emit(Te.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)})()}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){_.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Fg(t.code);if(28===t.code&&"detail"in t&&(_.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(he.RECOVER_NOTIFICATION,t.detail)),"success"!==n.action){if("failed"!==n.action)return"quit"===n.action?("ERR_REPEAT_JOIN_CHANNEL"===n.desc&&this.close(Qe.UID_BANNED),void this.close()):void this.reconnect(n.action,ni.SERVER_ERROR);_.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=R("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(_.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>R("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ni.TIMEOUT):this.request(pe.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),R("REPORT_STATS")&&this.send(pe.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();0!==t&&0!==n&&this.upload(Lg.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(fe.RECONNECT_WAITTING_FINISH,t=>{this.emit(he.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(fe.RECONNECT_CREATE_CONNECTION,t=>{this.emit(he.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(fe.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(fe.CLOSED,()=>{this.connectionState=_t.CLOSED}),this.websocket.on(fe.FAILED,()=>{this._disconnectedReason=Qe.NETWORK_ERROR,this.connectionState=_t.CLOSED}),this.websocket.on(fe.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState=this.connectionState===_t.CONNECTED?_t.RECONNECTING:_t.CONNECTING}),this.websocket.on(fe.WILL_RECONNECT,(t,n,i)=>{const r=xg(this,he.IS_P2P_DISCONNECTED),o=r||"retry"!==t;r&&"retry"===t&&(_.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=wS.P2P_DISCONNECTED),o&&(_.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(he.REPORT_JOIN_GATEWAY,n||wS.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(he.DISCONNECT_P2P)),i(t)}),this.websocket.on(fe.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{_.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",ni.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(he.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof N){if(t.code===S.UNEXPECTED_RESPONSE&&t.data.code===ce.ERR_NO_AUTHORIZED)return this.initError=new N(S.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),_.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ni.SERVER_ERROR);_.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ni.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(fe.REQUEST_NEW_URLS,(t,n)=>{ii(this,he.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(fe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Te.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(M7.PRE_CONNECT_PC,()=>{this.emit(he.PRE_CONNECT_PC)})}}let un=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function V7(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function RS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V7(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V7(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function ap(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(R("TURN_DOMAIN")):(_.info("Unidentified as ip: ".concat(e,", use as host")),e)}function YN(e,t){e.addresses||(e.addresses=[]);const n=function(a,c){if(R("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return a.map(u=>{let{ip:h,port:p}=u;return{address:"".concat(h,":").concat(p)}});const l=R("GATEWAY_DOMAINS");let d=l[1]&&Y(c).call(c,l[1])?1:0;return a.map(u=>{let{domain_prefix:h,port:p,ip:m}=u;if(h)return{address:"".concat(h,".").concat(l[d++%l.length],":").concat(p)};const f=/^[\.\:\d]+$/.test(m),g=f?"".concat(m.replace(/[^\d]/g,"-"),".").concat(l[d++%l.length],":").concat(p):"".concat(m,":").concat(p);return f||_.info("Unidentified as ip: ".concat(m,", use as host")),{ip:m,port:p,address:g}})}(e.addresses,t),i=Array.isArray(e.detail)&&e.detail[18];if(i&&"string"==typeof i){const a=i.split(";");for(let c=0;c<a.length;c++){var r;const l=ki(r=a[c]).call(r);n[c]&&l&&(n[c].ip6=l)}}const o=e.detail&&e.detail.candidate;let s;if(o){const[a,c]=o.split(":");a&&c&&(s={port:Number(c),ip:a,address:"".concat(a,":").concat(c)})}return{gatewayAddrs:n,apGatewayAddress:s,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function kr(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function B7(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(kr(t.width),"x").concat(kr(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function j7(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Vg(e,t){let n,i,r;switch(t){case un.CHOOSE_SERVER:i=4096,r="choose server";break;case un.CLOUD_PROXY:i=1048576,r="proxy";break;case un.CLOUD_PROXY_5:i=4194304,r="proxy5";break;case un.CLOUD_PROXY_FALLBACK:i=4194310,r="proxy fallback";break;default:throw new N(S.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(o=>{o.buffer&&o.buffer.flag===i&&(n={code:o.buffer.code,addresses:(o.buffer.edges_services||[]).map(s=>RS(RS({},s),{},{ticket:o.buffer.cert})),server_ts:e.enter_ts,uid:o.buffer.uid,cid:o.buffer.cid,cname:o.buffer.cname,detail:RS(RS({},o.buffer.detail),e.detail),flag:o.buffer.flag,opid:e.opid,cert:o.buffer.cert})}),!n)throw new N(S.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}function H7(e,t){return $N.apply(this,arguments)}function $N(){return $N=C(function*(e,t){return yield q.all(e.addresses.map(function(){var n=C(function*(i){return{address:ap(i.ip),tcpport:i.port,udpport:i.port,username:t&&R("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():ri.username,password:t&&R("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?yield wN(t.toString()):ri.password}});return function(i){return n.apply(this,arguments)}}()))}),$N.apply(this,arguments)}function XN(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),i=t.videoHeight||n.height,r=t.videoWidth||n.width;return i&&r?Math.max(Math.min(i,r)/Math.min(kr(e.height),kr(e.width)),1):(_.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function hl(e){let{candidateType:t,relayProtocol:n,type:i,address:r,port:o,protocol:s}=e;return"local-candidate"===i?{candidateType:t,relayProtocol:n,protocol:s}:{candidateType:t,relayProtocol:n,address:r,port:o,protocol:s}}var es,dxe=Vt(I7),uxe=Yo("Array").values,hxe=ga,pxe=mi,fxe=Ki,mxe=uxe,ZN=Array.prototype,gxe={DOMTokenList:!0,NodeList:!0},uc=Vt(function(e){var t=e.values;return e===ZN||fxe(ZN,e)&&t===ZN.values||pxe(gxe,hxe(e))?mxe:t}),G7=So,Exe=Qn,bxe=Sn,JN=ay,yxe=og,Sxe=Yb,Cxe=ma,Txe=Xb,cp=Object.assign,W7=Object.defineProperty,wxe=_n([].concat),Ixe=!cp||bxe(function(){if(G7&&1!==cp({b:1},cp(W7({},"a",{enumerable:!0,get:function(){W7(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach(function(r){t[r]=r}),7!=cp({},e)[n]||JN(cp({},t)).join("")!=i})?function(e,t){for(var n=Cxe(e),i=arguments.length,r=1,o=yxe.f,s=Sxe.f;i>r;)for(var a,c=Txe(arguments[r++]),l=o?wxe(JN(c),o(c)):JN(c),d=l.length,u=0;d>u;)a=l[u++],G7&&!Exe(s,c,a)||(n[a]=c[a]);return n}:cp,Rxe=_r,Axe=C6,Dxe=Xc,Oxe=Qn,Nxe=ma,Pxe=function(e,t,n,i){try{return i?t(Rxe(n)[0],n[1]):t(n)}catch(r){Axe(e,"throw",r)}},Mxe=b6,xxe=Ey,kxe=oc,z7=My,Lxe=uD,Fxe=dy,K7=Array,Id=_n,QN=2147483647,Uxe=/[^\0-\u007E]/,q7=/[.\u3002\uFF0E\uFF61]/g,Y7="Overflow: input needs wider integers to process",$7=RangeError,Vxe=Id(q7.exec),lp=Math.floor,eP=String.fromCharCode,X7=Id("".charCodeAt),Z7=Id([].join),pl=Id([].push),Bxe=Id("".replace),jxe=Id("".split),Hxe=Id("".toLowerCase),J7=function(e){return e+22+75*(e<26)},Gxe=function(e,t,n){var i=0;for(e=n?lp(e/700):e>>1,e+=lp(e/t);e>455;)e=lp(e/35),i+=36;return lp(i+36*e/(e+38))},Wxe=function(e){var n,i,t=[],r=(e=function(E){for(var b=[],T=0,I=E.length;T<I;){var D=X7(E,T++);if(D>=55296&&D<=56319&&T<I){var O=X7(E,T++);56320==(64512&O)?pl(b,((1023&D)<<10)+(1023&O)+65536):(pl(b,D),T--)}else pl(b,D)}return b}(e)).length,o=128,s=0,a=72;for(n=0;n<e.length;n++)(i=e[n])<128&&pl(t,eP(i));var c=t.length,l=c;for(c&&pl(t,"-");l<r;){var d=QN;for(n=0;n<e.length;n++)(i=e[n])>=o&&i<d&&(d=i);var u=l+1;if(d-o>lp((QN-s)/u))throw $7(Y7);for(s+=(d-o)*u,o=d,n=0;n<e.length;n++){if((i=e[n])<o&&++s>QN)throw $7(Y7);if(i==o){for(var h=s,p=36;;){var m=p<=a?1:p>=a+26?26:p-a;if(h<m)break;var f=h-m,g=36-m;pl(t,eP(J7(m+f%g))),h=lp(f/g),p+=36}pl(t,eP(J7(h))),a=Gxe(s,u,l==c),s=0,l++}}s++,o++}return Z7(t,"")},zxe=it,tP=So,Kxe=jO,nP=Pn,Q7=Xc,ts=_n,AS=Jc,ns=vy,qxe=TD,iP=mi,rP=Ixe,dp=function(e){var t=Nxe(e),n=xxe(this),i=arguments.length,r=i>1?arguments[1]:void 0,o=void 0!==r;o&&(r=Dxe(r,i>2?arguments[2]:void 0));var s,a,c,l,d,u,h=Fxe(t),p=0;if(!h||this===K7&&Mxe(h))for(s=kxe(t),a=n?new this(s):K7(s);s>p;p++)u=o?r(t[p],p):t[p],z7(a,p,u);else for(d=(l=Lxe(t,h)).next,a=n?new this:[];!(c=Oxe(d,l)).done;p++)u=o?Pxe(l,r,[c.value,p],!0):c.value,z7(a,p,u);return a.length=p,a},Us=hO,Yxe=eO.codeAt,hc=wo,Xxe=Qc,Zxe=xh,eK=tMe,Jxe=fd.set,DS=fd.getterFor("URL"),Qxe=eK.URLSearchParams,eke=eK.getState,Bg=nP.URL,oP=nP.TypeError,OS=nP.parseInt,tke=Math.floor,nK=Math.pow,is=ts("".charAt),Vs=ts(/./.exec),jg=ts([].join),nke=ts(1..toString),ike=ts([].pop),up=ts([].push),sP=ts("".replace),rke=ts([].shift),oke=ts("".split),Hg=ts("".slice),NS=ts("".toLowerCase),ske=ts([].unshift),aP="Invalid scheme",Rd="Invalid host",iK="Invalid port",rK=/[a-z]/i,ake=/[\d+-.a-z]/i,cP=/\d/,cke=/^0x/i,lke=/^[0-7]+$/,dke=/^\d+$/,oK=/^[\da-f]+$/i,uke=/[\0\t\n\r #%/:<>?@[\\\]^|]/,hke=/[\0\t\n\r #/:<>?@[\\\]^|]/,pke=/^[\u0000-\u0020]+/,fke=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,mke=/[\t\n\r]/g,Gg=function(e){var t,n,i,r;if("number"==typeof e){for(t=[],n=0;n<4;n++)ske(t,e%256),e=tke(e/256);return jg(t,".")}if("object"==typeof e){for(t="",i=function(o){for(var s=null,a=1,c=null,l=0,d=0;d<8;d++)0!==o[d]?(l>a&&(s=c,a=l),c=null,l=0):(null===c&&(c=d),++l);return l>a&&(s=c,a=l),s}(e),n=0;n<8;n++)r&&0===e[n]||(r&&(r=!1),i===n?(t+=n?":":"::",r=!0):(t+=nke(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},PS={},sK=rP({},PS,{" ":1,'"':1,"<":1,">":1,"`":1}),aK=rP({},sK,{"#":1,"?":1,"{":1,"}":1}),lP=rP({},aK,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),fl=function(e,t){var n=Yxe(e,0);return n>32&&n<127&&!iP(t,e)?e:encodeURIComponent(e)},MS={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Wg=function(e,t){var n;return 2==e.length&&Vs(rK,is(e,0))&&(":"==(n=is(e,1))||!t&&"|"==n)},cK=function(e){var t;return e.length>1&&Wg(Hg(e,0,2))&&(2==e.length||"/"===(t=is(e,2))||"\\"===t||"?"===t||"#"===t)},gke=function(e){return"."===e||"%2e"===NS(e)},dP={},lK={},uP={},dK={},uK={},hP={},hK={},pK={},xS={},kS={},pP={},fP={},mP={},gP={},fK={},_P={},hp={},Ta={},mK={},Ad={},pc={},vP=function(e,t,n){var i,r,o,s=hc(e);if(t){if(r=this.parse(s))throw oP(r);this.searchParams=null}else{if(void 0!==n&&(i=new vP(n,!0)),r=this.parse(s,null,i))throw oP(r);(o=eke(new Qxe)).bindURL(this),this.searchParams=o}};vP.prototype={type:"URL",parse:function(e,t,n){var i,r,o,s,a,c=this,l=t||dP,d=0,u="",h=!1,p=!1,m=!1;for(e=hc(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=sP(e,pke,""),e=sP(e,fke,"$1")),e=sP(e,mke,""),i=dp(e);d<=i.length;){switch(r=i[d],l){case dP:if(!r||!Vs(rK,r)){if(t)return aP;l=uP;continue}u+=NS(r),l=lK;break;case lK:if(r&&(Vs(ake,r)||"+"==r||"-"==r||"."==r))u+=NS(r);else{if(":"!=r){if(t)return aP;u="",l=uP,d=0;continue}if(t&&(c.isSpecial()!=iP(MS,u)||"file"==u&&(c.includesCredentials()||null!==c.port)||"file"==c.scheme&&!c.host))return;if(c.scheme=u,t)return void(c.isSpecial()&&MS[c.scheme]==c.port&&(c.port=null));u="","file"==c.scheme?l=gP:c.isSpecial()&&n&&n.scheme==c.scheme?l=dK:c.isSpecial()?l=pK:"/"==i[d+1]?(l=uK,d++):(c.cannotBeABaseURL=!0,up(c.path,""),l=mK)}break;case uP:if(!n||n.cannotBeABaseURL&&"#"!=r)return aP;if(n.cannotBeABaseURL&&"#"==r){c.scheme=n.scheme,c.path=Us(n.path),c.query=n.query,c.fragment="",c.cannotBeABaseURL=!0,l=pc;break}l="file"==n.scheme?gP:hP;continue;case dK:if("/"!=r||"/"!=i[d+1]){l=hP;continue}l=xS,d++;break;case uK:if("/"==r){l=kS;break}l=Ta;continue;case hP:if(c.scheme=n.scheme,r==es)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Us(n.path),c.query=n.query;else if("/"==r||"\\"==r&&c.isSpecial())l=hK;else if("?"==r)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Us(n.path),c.query="",l=Ad;else{if("#"!=r){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Us(n.path),c.path.length--,l=Ta;continue}c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Us(n.path),c.query=n.query,c.fragment="",l=pc}break;case hK:if(!c.isSpecial()||"/"!=r&&"\\"!=r){if("/"!=r){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,l=Ta;continue}l=kS}else l=xS;break;case pK:if(l=xS,"/"!=r||"/"!=is(u,d+1))continue;d++;break;case xS:if("/"!=r&&"\\"!=r){l=kS;continue}break;case kS:if("@"==r){h&&(u="%40"+u),h=!0,o=dp(u);for(var f=0;f<o.length;f++){var g=o[f];if(":"!=g||m){var E=fl(g,lP);m?c.password+=E:c.username+=E}else m=!0}u=""}else if(r==es||"/"==r||"?"==r||"#"==r||"\\"==r&&c.isSpecial()){if(h&&""==u)return"Invalid authority";d-=dp(u).length+1,u="",l=pP}else u+=r;break;case pP:case fP:if(t&&"file"==c.scheme){l=_P;continue}if(":"!=r||p){if(r==es||"/"==r||"?"==r||"#"==r||"\\"==r&&c.isSpecial()){if(c.isSpecial()&&""==u)return Rd;if(t&&""==u&&(c.includesCredentials()||null!==c.port))return;if(s=c.parseHost(u))return s;if(u="",l=hp,t)return;continue}"["==r?p=!0:"]"==r&&(p=!1),u+=r}else{if(""==u)return Rd;if(s=c.parseHost(u))return s;if(u="",l=mP,t==fP)return}break;case mP:if(!Vs(cP,r)){if(r==es||"/"==r||"?"==r||"#"==r||"\\"==r&&c.isSpecial()||t){if(""!=u){var b=OS(u,10);if(b>65535)return iK;c.port=c.isSpecial()&&b===MS[c.scheme]?null:b,u=""}if(t)return;l=hp;continue}return iK}u+=r;break;case gP:if(c.scheme="file","/"==r||"\\"==r)l=fK;else{if(!n||"file"!=n.scheme){l=Ta;continue}if(r==es)c.host=n.host,c.path=Us(n.path),c.query=n.query;else if("?"==r)c.host=n.host,c.path=Us(n.path),c.query="",l=Ad;else{if("#"!=r){cK(jg(Us(i,d),""))||(c.host=n.host,c.path=Us(n.path),c.shortenPath()),l=Ta;continue}c.host=n.host,c.path=Us(n.path),c.query=n.query,c.fragment="",l=pc}}break;case fK:if("/"==r||"\\"==r){l=_P;break}n&&"file"==n.scheme&&!cK(jg(Us(i,d),""))&&(Wg(n.path[0],!0)?up(c.path,n.path[0]):c.host=n.host),l=Ta;continue;case _P:if(r==es||"/"==r||"\\"==r||"?"==r||"#"==r){if(!t&&Wg(u))l=Ta;else if(""==u){if(c.host="",t)return;l=hp}else{if(s=c.parseHost(u))return s;if("localhost"==c.host&&(c.host=""),t)return;u="",l=hp}continue}u+=r;break;case hp:if(c.isSpecial()){if(l=Ta,"/"!=r&&"\\"!=r)continue}else if(t||"?"!=r)if(t||"#"!=r){if(r!=es&&(l=Ta,"/"!=r))continue}else c.fragment="",l=pc;else c.query="",l=Ad;break;case Ta:if(r==es||"/"==r||"\\"==r&&c.isSpecial()||!t&&("?"==r||"#"==r)){if(".."===(a=NS(a=u))||"%2e."===a||".%2e"===a||"%2e%2e"===a?(c.shortenPath(),"/"==r||"\\"==r&&c.isSpecial()||up(c.path,"")):gke(u)?"/"==r||"\\"==r&&c.isSpecial()||up(c.path,""):("file"==c.scheme&&!c.path.length&&Wg(u)&&(c.host&&(c.host=""),u=is(u,0)+":"),up(c.path,u)),u="","file"==c.scheme&&(r==es||"?"==r||"#"==r))for(;c.path.length>1&&""===c.path[0];)rke(c.path);"?"==r?(c.query="",l=Ad):"#"==r&&(c.fragment="",l=pc)}else u+=fl(r,aK);break;case mK:"?"==r?(c.query="",l=Ad):"#"==r?(c.fragment="",l=pc):r!=es&&(c.path[0]+=fl(r,PS));break;case Ad:t||"#"!=r?r!=es&&("'"==r&&c.isSpecial()?c.query+="%27":c.query+="#"==r?"%23":fl(r,PS)):(c.fragment="",l=pc);break;case pc:r!=es&&(c.fragment+=fl(r,sK))}d++}},parseHost:function(e){var t,n,i;if("["==is(e,0)){if("]"!=is(e,e.length-1)||!(t=function(r){var o,s,a,c,l,d,u,h=[0,0,0,0,0,0,0,0],p=0,m=null,f=0,g=function(){return is(r,f)};if(":"==g()){if(":"!=is(r,1))return;f+=2,m=++p}for(;g();){if(8==p)return;if(":"!=g()){for(o=s=0;s<4&&Vs(oK,g());)o=16*o+OS(g(),16),f++,s++;if("."==g()){if(0==s||(f-=s,p>6))return;for(a=0;g();){if(c=null,a>0){if(!("."==g()&&a<4))return;f++}if(!Vs(cP,g()))return;for(;Vs(cP,g());){if(l=OS(g(),10),null===c)c=l;else{if(0==c)return;c=10*c+l}if(c>255)return;f++}h[p]=256*h[p]+c,2!=++a&&4!=a||p++}if(4!=a)return;break}if(":"==g()){if(f++,!g())return}else if(g())return;h[p++]=o}else{if(null!==m)return;f++,m=++p}}if(null!==m)for(d=p-m,p=7;0!=p&&d>0;)u=h[p],h[p--]=h[m+d-1],h[m+--d]=u;else if(8!=p)return;return h}(Hg(e,1,-1))))return Rd;this.host=t}else if(this.isSpecial()){if(e=function(e){var t,n,i=[],r=jxe(Bxe(Hxe(e),q7,"."),".");for(t=0;t<r.length;t++)pl(i,Vxe(Uxe,n=r[t])?"xn--"+Wxe(n):n);return Z7(i,".")}(e),Vs(uke,e)||null===(t=function(r){var o,s,a,c,l,d,u,h=oke(r,".");if(h.length&&""==h[h.length-1]&&h.length--,(o=h.length)>4)return r;for(s=[],a=0;a<o;a++){if(""==(c=h[a]))return r;if(l=10,c.length>1&&"0"==is(c,0)&&(l=Vs(cke,c)?16:8,c=Hg(c,8==l?1:2)),""===c)d=0;else{if(!Vs(10==l?dke:8==l?lke:oK,c))return r;d=OS(c,l)}up(s,d)}for(a=0;a<o;a++)if(d=s[a],a==o-1){if(d>=nK(256,5-o))return null}else if(d>255)return null;for(u=ike(s),a=0;a<s.length;a++)u+=s[a]*nK(256,3-a);return u}(e)))return Rd;this.host=t}else{if(Vs(hke,e))return Rd;for(t="",n=dp(e),i=0;i<n.length;i++)t+=fl(n[i],PS);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return iP(MS,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&Wg(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,i=e.password,r=e.host,o=e.port,s=e.path,a=e.query,c=e.fragment,l=t+":";return null!==r?(l+="//",e.includesCredentials()&&(l+=n+(i?":"+i:"")+"@"),l+=Gg(r),null!==o&&(l+=":"+o)):"file"==t&&(l+="//"),l+=e.cannotBeABaseURL?s[0]:s.length?"/"+jg(s,"/"):"",null!==a&&(l+="?"+a),null!==c&&(l+="#"+c),l},setHref:function(e){var t=this.parse(e);if(t)throw oP(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new pp(e.path[0]).origin}catch{return"null"}return"file"!=e&&this.isSpecial()?e+"://"+Gg(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(hc(e)+":",dP)},getUsername:function(){return this.username},setUsername:function(e){var t=dp(hc(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=fl(t[n],lP)}},getPassword:function(){return this.password},setPassword:function(e){var t=dp(hc(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=fl(t[n],lP)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?Gg(e):Gg(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,pP)},getHostname:function(){var e=this.host;return null===e?"":Gg(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,fP)},getPort:function(){var e=this.port;return null===e?"":hc(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=hc(e))?this.port=null:this.parse(e,mP))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+jg(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,hp))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=hc(e))?this.query=null:("?"==is(e,0)&&(e=Hg(e,1)),this.query="",this.parse(e,Ad)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=hc(e))?("#"==is(e,0)&&(e=Hg(e,1)),this.fragment="",this.parse(e,pc)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var pp=function(e){var t=qxe(this,Lr),n=Zxe(arguments.length,1)>1?arguments[1]:void 0,i=Jxe(t,new vP(e,!1,n));tP||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},Lr=pp.prototype,rs=function(e,t){return{get:function(){return DS(this)[e]()},set:t&&function(n){return DS(this)[t](n)},configurable:!0,enumerable:!0}};if(tP&&(ns(Lr,"href",rs("serialize","setHref")),ns(Lr,"origin",rs("getOrigin")),ns(Lr,"protocol",rs("getProtocol","setProtocol")),ns(Lr,"username",rs("getUsername","setUsername")),ns(Lr,"password",rs("getPassword","setPassword")),ns(Lr,"host",rs("getHost","setHost")),ns(Lr,"hostname",rs("getHostname","setHostname")),ns(Lr,"port",rs("getPort","setPort")),ns(Lr,"pathname",rs("getPathname","setPathname")),ns(Lr,"search",rs("getSearch","setSearch")),ns(Lr,"searchParams",rs("getSearchParams")),ns(Lr,"hash",rs("getHash","setHash"))),AS(Lr,"toJSON",function(){return DS(this).serialize()},{enumerable:!0}),AS(Lr,"toString",function(){return DS(this).serialize()},{enumerable:!0}),Bg){var gK=Bg.createObjectURL,_K=Bg.revokeObjectURL;gK&&AS(pp,"createObjectURL",Q7(gK,Bg)),_K&&AS(pp,"revokeObjectURL",Q7(_K,Bg))}Xxe(pp,"URL"),zxe({global:!0,constructor:!0,forced:!Kxe,sham:!tP},{URL:pp});var _ke=it,vke=Sn,Eke=xh,vK=wo,bke=jO,EK=Nr("URL");_ke({target:"URL",stat:!0,forced:!(bke&&vke(function(){EK.canParse()}))},{canParse:function(e){var t=Eke(arguments.length,1),n=vK(e),i=t<2||void 0===arguments[1]?void 0:vK(arguments[1]);try{return!!new EK(n,i)}catch{return!1}}});var bK=Vt(Co.URL);const $n={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Fe(){return $n}function yK(){return"setSinkId"in HTMLAudioElement.prototype&&(!R("RESTRICTION_SET_PLAYBACK_DEVICE")||(ol()||V9())&&!yN())}function SK(){return!$n.supportUnifiedPlan||R("CHROME_FORCE_PLAN_B")&&sl()}let Xn=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function fp(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Pe(e,t,n,i,r){return{width:e,height:t,frameRate:n,bitrateMin:i,bitrateMax:r}}function os(e,t,n,i,r){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:i,bitrateMax:r}}function EP(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const yke={"90p":Pe(160,90),"90p_1":Pe(160,90),"120p":Pe(160,120,15,30,65),"120p_1":Pe(160,120,15,30,65),"120p_3":Pe(120,120,15,30,50),"120p_4":Pe(212,120),"180p":Pe(320,180,15,30,140),"180p_1":Pe(320,180,15,30,140),"180p_3":Pe(180,180,15,30,100),"180p_4":Pe(240,180,15,30,120),"240p":Pe(320,240,15,40,200),"240p_1":Pe(320,240,15,40,200),"240p_3":Pe(240,240,15,40,140),"240p_4":Pe(424,240,15,40,220),"360p":Pe(640,360,15,80,400),"360p_1":Pe(640,360,15,80,400),"360p_3":Pe(360,360,15,80,260),"360p_4":Pe(640,360,30,80,600),"360p_6":Pe(360,360,30,80,400),"360p_7":Pe(480,360,15,80,320),"360p_8":Pe(480,360,30,80,490),"360p_9":Pe(640,360,15,80,800),"360p_10":Pe(640,360,24,80,800),"360p_11":Pe(640,360,24,80,1e3),"480p":Pe(640,480,15,100,500),"480p_1":Pe(640,480,15,100,500),"480p_2":Pe(640,480,30,100,1e3),"480p_3":Pe(480,480,15,100,400),"480p_4":Pe(640,480,30,100,750),"480p_6":Pe(480,480,30,100,600),"480p_8":Pe(848,480,15,100,610),"480p_9":Pe(848,480,30,100,930),"480p_10":Pe(640,480,10,100,400),"720p":Pe(1280,720,15,120,1130),"720p_auto":Pe(1280,720,30,900,3e3),"720p_1":Pe(1280,720,15,120,1130),"720p_2":Pe(1280,720,30,120,2e3),"720p_3":Pe(1280,720,30,120,1710),"720p_5":Pe(960,720,15,120,910),"720p_6":Pe(960,720,30,120,1380),"1080p":Pe(1920,1080,15,120,2080),"1080p_1":Pe(1920,1080,15,120,2080),"1080p_2":Pe(1920,1080,30,120,3e3),"1080p_3":Pe(1920,1080,30,120,3150),"1080p_5":Pe(1920,1080,60,120,4780),"1440p":Pe(2560,1440,30,120,4850),"1440p_1":Pe(2560,1440,30,120,4850),"1440p_2":Pe(2560,1440,60,120,7350),"4k":Pe(3840,2160,30,120,8910),"4k_1":Pe(3840,2160,30,120,8910),"4k_3":Pe(3840,2160,60,120,13500)},Ske={"480p":os(640,480,5),"480p_1":os(640,480,5),"480p_2":os(640,480,30),"480p_3":os(640,480,15),"720p":os(1280,720,5),"720p_auto":Pe(1280,720,30,900,3e3),"720p_1":os(1280,720,5),"720p_2":os(1280,720,30),"720p_3":os(1280,720,15),"1080p":os(1920,1080,5),"1080p_1":os(1920,1080,5),"1080p_2":os(1920,1080,30),"1080p_3":os(1920,1080,15)},Cke={"1SL1TL":EP(1,1),"3SL3TL":EP(3,3),"2SL3TL":EP(2,3)};function wa(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},yke[e]):e}function bP(e){return"string"==typeof e?Object.assign({},Ske[e]):e}function LS(e){return"string"==typeof e?Object.assign({},Cke[e]):e}const Tke={speech_low_quality:fp(16e3,!1),speech_standard:fp(32e3,!1,18),music_standard:fp(48e3,!1),standard_stereo:fp(48e3,!0,56),high_quality:fp(48e3,!1,128),high_quality_stereo:fp(48e3,!0,192)};function FS(e){return"string"==typeof e?Object.assign({},Tke[e]):e}const mp=[];function CK(e){return Mn(e,"mediaSource",["screen","window","application"]),!0}let X=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),ft=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),gp=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),wke=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),Ike=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),Dd=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),_p=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),vp=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),Ep=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),to=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});const yP={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},SP={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},TK={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Rke={uplinkNetworkQuality:0,downlinkNetworkQuality:0},wK={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Ji=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),no=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),zg=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Od=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Li=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Ia=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const CP={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let US=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Me(e,t,n,i,r){var o,s,a={};return Object.keys(i).forEach(function(c){a[c]=i[c]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=Ns(o=dxe(s=n.slice()).call(s)).call(o,function(c,l){return l(e,t,c)||c},a),r&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(r):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}function x(e,t,n){return(t="symbol"==typeof(r=function(o,s){if("object"!=typeof o||!o)return o;var a=o[Symbol.toPrimitive];if(void 0!==a){var c=a.call(o,"string");if("object"!=typeof c)return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(t))?r:r+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e;var r}function IK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?IK(Object(n),!0).forEach(function(i){x(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):IK(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class RK extends kt{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Dd.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),x(this,"trackMediaType",void 0),x(this,"_ID",void 0),x(this,"_rtpTransceiver",void 0),x(this,"_lowRtpTransceiver",void 0),x(this,"_hints",[]),x(this,"_isClosed",!1),x(this,"_originMediaStreamTrack",void 0),x(this,"mediaStreamTrack",void 0),x(this,"_external",{}),this._ID=n||gt(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,Y(mp).call(mp,this)||mp.push(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||al(()=>{var n;ne.reportApiInvoke(null,{name:Cn.GET_MEDIA_STREAM_TRACK,options:[],tag:jt.TRACER}).onSuccess((null===(n=this._mediaStreamTrack)||void 0===n?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===gp.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=mp.indexOf(t);-1!==n&&mp.splice(n,1)}(this),this.emit(_p.CLOSED),this.removeAllListeners(Dd.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===gp.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Dd.TRANSCEIVER_UPDATED,t,n)}}class bp extends RK{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),x(this,"_enabled",!0),x(this,"_muted",!1),x(this,"_isExternalTrack",!1),x(this,"_isClosed",!1),x(this,"_enabledMutex",void 0),x(this,"processor",void 0),x(this,"_processorContext",void 0),x(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new gi("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return null!==(t=null===(n=this._originMediaStreamTrack)||void 0===n?void 0:n.label)&&void 0!==t?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,_.debug("[".concat(this.getTrackId(),"] close")),this.emit(X.NEED_CLOSE),super.close())}_updateOriginMediaStreamTrack(t,n){var i=arguments,r=this;return C(function*(){r._isExternalTrack=i.length>2&&void 0!==i[2]&&i[2],t!==r._originMediaStreamTrack&&(r._originMediaStreamTrack&&(r._originMediaStreamTrack.removeEventListener("ended",r._handleTrackEnded),n&&r._originMediaStreamTrack.stop()),t.addEventListener("ended",r._handleTrackEnded),r._originMediaStreamTrack=t,r._muted&&(r._originMediaStreamTrack.enabled=!1),r._mediaStreamTrack=r._originMediaStreamTrack,r._updatePlayerSource(),yield ct(r,X.NEED_REPLACE_TRACK,r),r.processor&&r._processorContext&&r.processor.updateInput({track:r._originMediaStreamTrack,context:r._processorContext}))})()}_getDefaultPlayerConfig(){return{}}onTrackEnded(){_.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(_p.TRACK_ENDED)}stateCheck(t,n){if(_.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),ac(n,t),this._enabled&&this._muted&&"enabled"===t&&!1===n)throw new M(S.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",_);if(!this._enabled&&!this._muted&&"muted"===t&&!0===n)throw new M(S.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",_)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():q.resolve([])}}const AK=window.AudioContext||window.webkitAudioContext;let io=null;const tt=new class extends kt{constructor(){var e;super(...arguments),e=this,x(this,"prevState",void 0),x(this,"curState",void 0),x(this,"currentTime",void 0),x(this,"currentTimeStuckAt",void 0),x(this,"interruptDetectorTrack",void 0),x(this,"onLocalAudioTrackMute",()=>{_.info("ios15-interruption-start"),this.emit(Xn.IOS_15_16_INTERRUPTION_START)}),x(this,"onLocalAudioTrackUnmute",C(function*(){_.info("ios15-interruption-end"),"running"!==e.curState||e.duringInterruption?_.info("ios15-interruption-end-canceled"):(io&&(yield io.suspend()),e.emit(Xn.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(e){_.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){_.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function yp(){if(!io){if(function(){if(!AK)return void _.error("your browser is not support web audio");_.info("create audio context");const e=Rt({},R("WEBAUDIO_INIT_OPTIONS"));_.debug("audio context init option:",JSON.stringify(e)),io=new AK(e),tt.curState=io.state,io.onstatechange=()=>{tt.prevState=tt.curState,tt.curState=io?io.state:void 0;const{prevState:t,curState:n}=tt,i="running"===n,r="interrupted"===n,o="running"===t,s="suspended"===t,a="interrupted"===t,c=xe().osVersion;(Yi()||Xo())&&o&&r&&(_.info("ios".concat(c,"-interruption-start")),tt.emit(Xn.IOS_INTERRUPTION_START)),(Yi()||Xo())&&(s||a)&&i&&(_.info("ios".concat(c,"-interruption-end")),tt.emit(Xn.IOS_INTERRUPTION_END)),t!==n&&tt.emit(Xn.STATE_CHANGE,n,t)},setInterval(()=>{var t;const n=null===(t=io)||void 0===t?void 0:t.currentTime;tt.currentTime!==n?(tt.currentTimeStuckAt&&(_.debug("AudioContext current time resume at ".concat(n)),tt.currentTimeStuckAt=void 0),tt.currentTime=n):(n!==tt.currentTimeStuckAt&&(ne.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:jt.TRACER}).onSuccess(),_.warning("AudioContext current time stuck at ".concat(n))),tt.currentTimeStuckAt=n)},5e3),function(){var t=C(function*(n){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,o=!1,s=!1,a=!1;function c(g){"running"===n.state?l(!1):Yi()||Xo()?"suspended"===n.state&&(l(!0),g&&n.resume().then(d,d)):"closed"!==n.state&&(l(!0),g&&n.resume().then(d,d))}function l(g){if(o!==g){o=g;for(let E=0,b=i;E<b.length;E+=1){const T=b[E];g?window.addEventListener(T,u,{capture:!0,passive:!0}):window.removeEventListener(T,u,{capture:!0,passive:!0})}}}function d(){c(!1)}function u(){c(!0)}function h(g){if(!a)if(r.paused)if(g){let E;p(!1),a=!0;try{E=r.play(),E?E.then(m,m):(r.addEventListener("playing",m),r.addEventListener("abort",m),r.addEventListener("error",m))}catch{m()}}else p(!0);else p(!1)}function p(g){if(s!==g){s=g;for(let E=0,b=i;E<b.length;E++){const T=b[E];g?window.addEventListener(T,f,{capture:!0,passive:!0}):window.removeEventListener(T,f,{capture:!0,passive:!0})}}}function m(){r.removeEventListener("playing",m),r.removeEventListener("abort",m),r.removeEventListener("error",m),a=!1,h(!1)}function f(){h(!0)}if(Yi()){const g=n.createMediaStreamDestination(),E=document.createElement("div");E.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=E.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=g.stream,h(!0)}tt.on(Xn.STATE_CHANGE,function(){c(!0)}),c(!1)});return function(n){return t.apply(this,arguments)}}()(io)}(),!io)throw new M(S.NOT_SUPPORTED,"can not create audio context");return io}return io}function Nd(e){if(function(){if(null!==TP)return TP;const i=yp(),r=i.createBufferSource(),o=i.createGain(),s=i.createGain();r.connect(o),r.connect(s),r.disconnect(o);let a=!1;try{r.disconnect(o)}catch{a=!0}return r.disconnect(),TP=a,a}())return;const t=e.connect,n=e.disconnect;e.connect=(i,r,o)=>{var s;return e._inputNodes||(e._inputNodes=[]),Y(s=e._inputNodes).call(s,i)||(i instanceof AudioNode?(e._inputNodes.push(i),t.call(e,i,r,o)):t.call(e,i,r)),e},e.disconnect=(i,r,o)=>{n.call(e),i?fS(e._inputNodes,i):e._inputNodes=[];for(const s of e._inputNodes)t.call(e,s)}}let TP=null;function wP(e,t){let n=!1;const i=1/t;if(R("DISABLE_WEBAUDIO")){const r=window.setInterval(()=>{n?window.clearInterval(r):e(performance.now()/1e3)},1e3*i)}else{const r=yp();let o=r.createGain();o.gain.value=0,o.connect(r.destination);const s=()=>{if(n)return void(o=null);const a=r.createOscillator();a.onended=s,a.connect(o),a.start(0),a.stop(r.currentTime+i),e(r.currentTime)};s()}return()=>{n=!0}}class DK{constructor(){x(this,"context",void 0),x(this,"analyserNode",void 0),x(this,"sourceNode",void 0),this.context=yp(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Yi()||Xo()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let r=0;r<t.length;++r)t[r]=i[r]/128-1}const n=Ns(t).call(t,(i,r)=>i+r*r,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;null===(t=this.sourceNode)||void 0===t||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(n=this.sourceNode)||void 0===n||n.connect(this.analyserNode)}catch{_.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class OK extends kt{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var i;null===(i=this.sourceNode)||void 0===i||i.disconnect(this.outputNode)}catch{}null===(n=this._processedNode)||void 0===n||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),x(this,"outputNode",void 0),x(this,"outputTrack",void 0),x(this,"isPlayed",!1),x(this,"sourceNode",void 0),x(this,"context",void 0),x(this,"audioBufferNode",void 0),x(this,"destNode",void 0),x(this,"audioOutputLevel",0),x(this,"volumeLevelAnalyser",void 0),x(this,"_processedNode",void 0),x(this,"playNode",void 0),x(this,"isDestroyed",!1),x(this,"onNoAudioInput",void 0),x(this,"isNoAudioInput",!1),x(this,"_noAudioInputCount",0),this.context=yp(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Nd(this.outputNode),this.volumeLevelAnalyser=new DK}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(to.ON_AUDIO_BUFFER,function(i){for(let r=0;r<i.outputBuffer.numberOfChannels;r+=1){const o=i.outputBuffer.getChannelData(r);for(let s=0;s<o.length;s+=1)o[s]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Fe().webAudioMediaStreamDest)throw new M(S.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){"running"!==this.context.state&&mS(()=>{tt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}checkHasAudioInput(){var t=arguments,n=this;return C(function*(){let i=t.length>0&&void 0!==t[0]?t[0]:0;if(i>5)return n.isNoAudioInput=!0,n.onNoAudioInput&&n.onNoAudioInput(),!1;Yi()||Xo()?"suspended"===n.context.state&&n.context.resume():"running"!==n.context.state&&n.context.resume();const r=n.volumeLevelAnalyser.getAnalyserNode();let o;r.getFloatTimeDomainData?(o=new Float32Array(r.fftSize),r.getFloatTimeDomainData(o)):(o=new Uint8Array(r.fftSize),r.getByteTimeDomainData(o));let s=!1;for(let a=0;a<o.length;a++)0!==o[a]&&(s=!0);return s?(n.isNoAudioInput=!1,!0):(yield qn(200),(yield n.checkHasAudioInput(i?i+1:1))&&s)})()}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;null===(t=this.processedNode)||void 0===t||t.disconnect(),null===(n=this.sourceNode)||void 0===n||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?null===(t=this.processedNode)||void 0===t||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class NK extends OK{get isFreeze(){return!1}constructor(t,n,i){var r,o;if(super(),r=this,x(this,"sourceNode",void 0),x(this,"track",void 0),x(this,"clonedTrack",void 0),x(this,"audioElement",void 0),x(this,"isCurrentTrackCloned",!1),x(this,"isRemoteTrack",!1),x(this,"originVolumeLevelAnalyser",void 0),x(this,"rebuildWebAudio",C(function*(){if(_.debug("ready to rebuild web audio, state:",r.context.state),r.isNoAudioInput&&(yield r.checkHasAudioInput()),!r.isNoAudioInput||r.isDestroyed)return document.body.removeEventListener("click",r.rebuildWebAudio,!0),void _.debug("rebuild web audio success, current volume status",r.getAccurateVolumeLevel());r.context.resume().then(()=>_.info("resume success")),_.debug("rebuild web audio because of ios 12 bugs"),r.disconnect();const c=r.track;r.track=r.track.clone(),r.isCurrentTrackCloned?c.stop():r.isCurrentTrackCloned=!0;const l=new MediaStream([r.track]);r.sourceNode=r.context.createMediaStreamSource(l),Nd(r.sourceNode),r.volumeLevelAnalyser.rebuildAnalyser();const d=r.outputNode.gain.value;r.outputNode=r.context.createGain(),r.outputNode.gain.setValueAtTime(d,r.context.currentTime),Nd(r.outputNode),r.emit(to.UPDATE_SOURCE),r.connect(),r.audioElement.srcObject=l,r.isPlayed&&r.play(r.playNode),r.checkHasAudioInput()})),"audio"!==t.kind)throw new M(S.UNEXPECTED_ERROR);this.track=t;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(s),Nd(this.sourceNode),i){const c=i.clone();c.enabled=!0,this.clonedTrack=c,_.debug("create an unmuted track ".concat(c.id," from the original track ").concat(i.id," to get the volume"));const l=this.context.createMediaStreamSource(new MediaStream([c]));Nd(l),this.originVolumeLevelAnalyser=new DK,this.originVolumeLevelAnalyser.updateSource(l)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const a=xe();n&&a.os===kn.IOS&&Number(null===(o=a.osVersion)||void 0===o?void 0:o.split(".")[0])<15&&(tt.on(Xn.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(c=>{c||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Nd(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(to.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),tt.off("state-change",this.rebuildWebAudio),null===(t=this.originVolumeLevelAnalyser)||void 0===t||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),_.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));Nd(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}function PK(e,t,n){return IP.apply(this,arguments)}function IP(){return IP=C(function*(e,t,n){const i=(o,s)=>o?"number"!=typeof o?o.max||o.exact||o.ideal||o.min||s:o:s,r={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&"number"!=typeof t.frameRate?(r.video.mandatory.maxFrameRate=t.frameRate.max,r.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(r.video.mandatory.maxFrameRate=t.frameRate),yield navigator.mediaDevices.getUserMedia(r)}),IP.apply(this,arguments)}function RP(){return RP=C(function*(e,t){const n=yield MK(e.mediaSource),{sourceId:i,audio:r}=yield function(o){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new q((a,c)=>{const l=document.createElement("div");l.innerText="share screen",l.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const d=document.createElement("div");d.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const u=document.createElement("div");u.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",u.setAttribute("style","height: 12%;");const h=document.createElement("div");h.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const p=document.createElement("div");p.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const m=document.createElement("button");m.innerHTML="cancel",m.setAttribute("style","width: 85px;"),m.onclick=()=>{document.body.removeChild(E);const b=new Error("NotAllowedError");b.name="NotAllowedError",c(b)};let f=s;const g=document.createElement("div");if(s){const b=document.createElement("input");b.setAttribute("type","checkbox");const T=document.createElement("span");b.setAttribute("style","margin-right: 6px;"),T.innerText="Share audio",b.checked=f,b.onchange=()=>{f=b.checked},g.appendChild(b),g.appendChild(T)}p.appendChild(g),p.appendChild(m),d.appendChild(u),d.appendChild(h),d.appendChild(p);const E=document.createElement("div");E.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),E.appendChild(l),E.appendChild(d),document.body.appendChild(E),o.map(b=>{if(b.id){const T=document.createElement("div");T.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let I=b.thumbnail;try{const{width:D}=I.getSize();D>1920&&(I=I.resize({width:1920}))}catch(D){throw D&&D.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),D}T.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+I.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+b.name.replace(/[\u00A0-\u9999<>\&]/g,function(D){return"&#"+D.charCodeAt(0)+";"})+"</span>",T.onclick=()=>{document.body.removeChild(E),a({sourceId:b.id,audio:f})},h.appendChild(T)}})})}(n,t);return yield PK(i,e,r)}),RP.apply(this,arguments)}function MK(e){return AP.apply(this,arguments)}function AP(){return AP=C(function*(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);const n=e7();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new M(S.ELECTRON_IS_NULL);let i=null;try{var r;i=(null===(r=n.desktopCapturer)||void 0===r?void 0:r.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new q((o,s)=>{n.desktopCapturer.getSources({types:t},(a,c)=>{a?s(a):o(c)})}));try{return yield i}catch(o){throw new M(S.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,o.toString())}}),AP.apply(this,arguments)}const DP=new gi("safari");let xK=!1,kK=!1;function ro(e,t){return OP.apply(this,arguments)}function OP(){return OP=C(function*(e,t){let n=0,i=null;for(;n<2;)try{i=yield Dke(e,t,n>0);break}catch(r){if(r instanceof M)throw _.error("[".concat(t,"] ").concat(r.toString())),r;const o=VS(r.name||r.code||r,r.message);if(o.code===S.MEDIA_OPTION_INVALID){_.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,yield qn(500);continue}throw _.error("[".concat(t,"] ").concat(o.toString())),o}if(!i)throw new M(S.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}),OP.apply(this,arguments)}function Dke(e,t,n){return NP.apply(this,arguments)}function NP(){return NP=C(function*(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new M(S.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const i=Fe(),r=new MediaStream;if(e.audioSource&&r.addTrack(e.audioSource),e.videoSource&&r.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return _.debug("Using Video Source/ Audio Source"),r;if(e.screen)if(e7())Sp(r,e.screen.sourceId?yield PK(e.screen.sourceId,e.screen,e.screenAudio):yield function Ake(e,t){return RP.apply(this,arguments)}(e.screen,e.screenAudio));else if(ol()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new M(S.NOT_SUPPORTED,"This browser does not support screen sharing");_.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const h=yield(s=e.screen.extensionId,a=t,new q((p,m)=>{try{chrome.runtime.sendMessage(s,{getStream:!0},f=>{if(!f||!f.streamId)return _.error("[".concat(a,"] No response from Chrome Plugin. Plugin not installed properly"),f),void m(new M(S.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));p(f.streamId)})}catch(f){_.error("[".concat(a,"] AgoraRTC screensharing plugin is not accessible(").concat(s,")"),f.toString()),m(new M(S.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=h,Sp(r,yield navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){var o;e.screen.mediaSource&&CK(e.screen.mediaSource);const h={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:null!==(o=e.screen.displaySurface)&&void 0!==o?o:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},{selfBrowserSurface:p,surfaceSwitching:m,systemAudio:f}=e.screen,g={selfBrowserSurface:p,surfaceSwitching:m,systemAudio:f};!p&&delete g.selfBrowserSurface,!m&&delete g.surfaceSwitching,!f&&delete g.systemAudio,_.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:h,audio:!!e.screenAudio,controls:g})),Sp(r,yield navigator.mediaDevices.getDisplayMedia(Rt({video:h,audio:!!e.screenAudio},g)))}else{if(!Bt())throw _.error("[".concat(t,"] This browser does not support screenSharing")),new M(S.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&CK(e.screen.mediaSource);const h={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};_.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(h))),Sp(r,yield navigator.mediaDevices.getUserMedia(h))}}var s,a;if(!e.video&&!e.audio)return r;let c={video:e.video,audio:e.audio},l=R("MEDIA_DEVICE_CONSTRAINTS");if(l)try{"string"==typeof l&&(l=JSON.parse(l)),c=IN(c,l)}catch{}_.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(c)),xe();let d,u=null;(ti()||Yi()||uS())&&(u=yield DP.lock());try{d=yield navigator.mediaDevices.getUserMedia(c)}catch(h){throw u&&u(),h}return c.audio&&(xK=!0),c.video&&(kK=!0),Sp(r,d),u&&u(),r}),NP.apply(this,arguments)}function VS(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new M(S.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new M(S.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new M(S.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new M(S.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new M(S.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new M(S.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return _.error("getUserMedia unexpected error",e),new M(S.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Sp(e,t){const n=e.getVideoTracks()[0],i=e.getAudioTracks()[0],r=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(i&&e.removeTrack(i),e.addTrack(o)),r&&(n&&e.removeTrack(n),e.addTrack(r))}const oo=new class extends kt{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Od.STATE_CHANGE,e),this._state=e)}constructor(){super(),x(this,"_state",zg.IDLE),x(this,"isAccessMicrophonePermission",!1),x(this,"isAccessCameraPermission",!1),x(this,"lastAccessMicrophonePermission",!1),x(this,"lastAccessCameraPermission",!1),x(this,"checkdeviceMatched",!1),x(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(R("ENUMERATE_DEVICES_INTERVAL")||(hS()||dS()===kn.HARMONY_OS)&&sl())&&this.updateDevicesInfo()},R("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>_.error(e.toString()))}enumerateDevices(e,t){var n=arguments,i=this;return C(function*(){let r=n.length>2&&void 0!==n[2]&&n[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new M(S.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=yield navigator.mediaDevices.enumerateDevices(),s=i.checkMediaDeviceInfoIsOk(o);let a=!i.isAccessMicrophonePermission&&e,c=!i.isAccessCameraPermission&&t;s.audio&&(a=!1),s.video&&(c=!1);let l=null,d=null,u=null;if(!r&&(a||c)){if(DP.isLocked&&(_.debug("[device manager] wait GUM lock"),(yield DP.lock())(),_.debug("[device manager] GUM unlock")),xK&&(a=!1,i.isAccessMicrophonePermission=!0),kK&&(c=!1,i.isAccessCameraPermission=!0),_.debug("[device manager] check media device permissions",e,t,a,c),a&&c){try{u=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(h){const p=VS(h.name||h.code||h,h.message);if(p.code===S.PERMISSION_DENIED)throw p;_.warning("getUserMedia failed in getDevices",p)}i.isAccessCameraPermission=!0,i.isAccessMicrophonePermission=!0}else if(a){try{l=yield navigator.mediaDevices.getUserMedia({audio:e})}catch(h){const p=VS(h.name||h.code||h,h.message);if(p.code===S.PERMISSION_DENIED)throw p;_.warning("getUserMedia failed in getDevices",p)}i.isAccessMicrophonePermission=!0}else if(c){try{d=yield navigator.mediaDevices.getUserMedia({video:t})}catch(h){const p=VS(h.name||h.code||h,h.message);if(p.code===S.PERMISSION_DENIED)throw p;_.warning("getUserMedia failed in getDevices",p)}i.isAccessCameraPermission=!0}_.debug("[device manager] mic permission",e,"cam permission",t)}try{const h=yield navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(p=>p.stop()),d&&d.getTracks().forEach(p=>p.stop()),u&&u.getTracks().forEach(p=>p.stop()),l=null,d=null,u=null,h}catch(h){return l&&l.getTracks().forEach(p=>p.stop()),d&&d.getTracks().forEach(p=>p.stop()),u&&u.getTracks().forEach(p=>p.stop()),l=null,d=null,u=null,new M(S.ENUMERATE_DEVICES_FAILED,h.toString()).throw()}})()}getRecordingDevices(){var e=arguments,t=this;return C(function*(){let n=e.length>0&&void 0!==e[0]&&e[0];return(yield t.enumerateDevices(!0,!1,n)).filter(i=>"audioinput"===i.kind)})()}getCamerasDevices(){var e=arguments,t=this;return C(function*(){let n=e.length>0&&void 0!==e[0]&&e[0];return(yield t.enumerateDevices(!1,!0,n)).filter(i=>"videoinput"===i.kind)})()}getSpeakers(){var e=arguments,t=this;return C(function*(){let n=e.length>0&&void 0!==e[0]&&e[0];return(yield t.enumerateDevices(!0,!1,n)).filter(i=>"audiooutput"===i.kind)})()}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}getDeviceById(e){var t=this;return C(function*(){const n=(yield t.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!n)throw new M(S.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return n})()}init(){var e=this;return C(function*(){e.state=zg.INITING;try{yield e.updateDevicesInfo(),e.state=zg.INITEND}catch(t){throw _.warning("Device Detection functionality cannot start properly.",t.toString()),e.state=zg.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new M(S.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}})()}updateDevicesInfo(){var e=this;return C(function*(){const t=yield e.enumerateDevices(!0,!0,!0),n=Date.now(),i=[];if(t[0]&&t[0].label&&!1===e.checkdeviceMatched){e.checkdeviceMatched=!0;const o=t.find(a=>"audioinput"===a.kind&&"default"===a.deviceId),s=t.find(a=>"audiooutput"===a.kind&&"default"===a.deviceId);o&&s?s.groupId===o.groupId?_.debug("[device-check] default input ".concat(o.label," and output ").concat(s.label," is the same group")):_.warning("[device-check] default input ".concat(o.label," and output ").concat(s.label," is not the same group")):_.debug("[device-check] default input or output not found")}const r=e.checkMediaDeviceInfoIsOk(t);if(t.forEach(o=>{if(!o.deviceId)return;const s=e.deviceInfoMap.get("".concat(o.kind,"_").concat(o.deviceId));if("ACTIVE"!==(s?s.state:"INACTIVE")){const a={initAt:n,updateAt:n,device:o,state:"ACTIVE"};e.deviceInfoMap.set("".concat(o.kind,"_").concat(o.deviceId),a),i.push(a)}s&&(s.updateAt=n)}),e.deviceInfoMap.forEach((o,s)=>{"ACTIVE"===o.state&&o.updateAt!==n&&(o.state="INACTIVE",i.push(o))}),e.state!==zg.INITEND)return r.audio&&(e.lastAccessMicrophonePermission=!0,e.isAccessMicrophonePermission=!0),void(r.video&&(e.lastAccessCameraPermission=!0,e.isAccessCameraPermission=!0));i.forEach(o=>{switch(o.device.kind){case"audioinput":e.lastAccessMicrophonePermission&&e.isAccessMicrophonePermission&&e.emit(Od.RECORDING_DEVICE_CHANGED,o);break;case"videoinput":e.lastAccessCameraPermission&&e.isAccessCameraPermission&&e.emit(Od.CAMERA_DEVICE_CHANGED,o);break;case"audiooutput":e.lastAccessMicrophonePermission&&e.isAccessMicrophonePermission&&e.emit(Od.PLAYOUT_DEVICE_CHANGED,o)}}),r.audio&&(e.lastAccessMicrophonePermission=!0,e.isAccessMicrophonePermission=!0),r.video&&(e.lastAccessCameraPermission=!0,e.isAccessCameraPermission=!0)})()}checkMediaDeviceInfoIsOk(e){const t=e.filter(r=>"audioinput"===r.kind),n=e.filter(r=>"videoinput"===r.kind),i={audio:!1,video:!1};for(const r of t)if(r.label&&r.deviceId){i.audio=!0;break}for(const r of n)if(r.label&&r.deviceId){i.video=!0;break}return i}};let PP=!1;const so=new class extends kt{constructor(){super(...arguments),x(this,"onAutoplayFailed",void 0),x(this,"onAudioAutoplayFailed",void 0)}};function LK(){if(xe(),!PP){const e=t=>{t.preventDefault(),PP=!1,Ng()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};PP=!0,Ng()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),_.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),so.onAutoplayFailed?so.onAutoplayFailed():_.warning(so.onAudioAutoplayFailed?"AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .":"We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),so.emit("autoplay-failed")}}function FK(e,t,n,i){if(!e)return;const r=ne.getBaseInfoBySessionId(e);if(!r)return;const o=r.info,s=Date.now(),a=Rt(Rt({},o),{},{vid:void 0===o.vid?0:Number(o.vid),lts:s,elapse:s-r.startTime,cbRegistered:so.onAutoplayFailed||so.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:i,extend:void 0});ne.send({type:Lt.AUTOPLAY_FAILED,data:a},!0)}const Oke=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],ir=new class{constructor(){x(this,"onAutoplayFailed",void 0),x(this,"elementMap",new Map),x(this,"elementStateMap",new Map),x(this,"elementsNeedToResume",[]),x(this,"sinkIdMap",new Map),x(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,i]=t;const r=this.elementStateMap.get(n),o=i.srcObject.getAudioTracks()[0],s=o&&o.readyState;if(_.debug("resume after interrupted, ele: ".concat(r," audio: ").concat(s," ").concat(e)),"live"===s){if(e)return i.pause(),void i.play();if("running"===tt.curState)return Zh()?(i.pause(),void i.play()):void(r&&"paused"===r&&i.play())}})}),x(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const i=n.srcObject.getAudioTracks()[0];i&&"live"===i.readyState&&(_.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),tt.on(Xn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tt.on(Xn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),tt.on(Xn.STATE_CHANGE,()=>{Yi()&&"suspended"===tt.prevState&&"running"===tt.curState&&this.autoResumeAfterInterruption()})}setSinkID(e,t){var n=this;return C(function*(){const i=n.elementMap.get(e);if(n.sinkIdMap.set(e,t),i)try{yield i.setSinkId(t)}catch(r){throw new M(S.PERMISSION_DENIED,"can not set sink id: "+r.toString())}})()}play(e,t,n,i){if(this.elementMap.has(t))return;const r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,r),this.elementMap.set(t,r),this.elementStateMap.set(t,Li.INIT),this.setVolume(t,n);const o=this.sinkIdMap.get(t);if(o)try{r.setSinkId(o).catch(a=>{_.warning("[".concat(t,"] set sink id failed"),a.toString())})}catch(a){_.warning("[".concat(t,"] set sink id failed"),a.toString())}const s=r.play();s&&s.then&&s.catch(a=>{i&&FK(i,"audio",a.message,t),_.warning("audio element play warning",a.toString()),this.elementMap.has(t)&&"NotAllowedError"===a.name&&(_.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),mS(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),LK()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){Oke.forEach(n=>{t.addEventListener(n,i=>{const r=this.elementStateMap.get(e),o="pause"===i.type?"paused":i.type;if(_.debug("[".concat(e,"] audio-element-status change ").concat(r," => ").concat(o)),"error"===i.type){const s=t?.error;s&&_.error("[".concat(e,"] media error, code: ").concat(s.code,", message: ").concat(s.message))}this.elementStateMap.set(e,o)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{_.debug("Auto resume audio element success")}).catch(n=>{_.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new q(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Ng()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function en(){return function(e,t,n){const i=n.value;return"function"==typeof i&&(n.value=function(){this._isClosed&&new M(S.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",_);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];const a=i.apply(this,o);return a instanceof q?new q((c,l)=>{a.then(c).catch(l)}):a}),n}}class UK extends kt{constructor(t){super(),x(this,"name","VideoProcessorDestination"),x(this,"ID","0"),x(this,"_source",void 0),x(this,"videoContext",void 0),x(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new M(S.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new M(S.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(Ji.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Ji.ON_TRACK,void 0)}}class VK extends kt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),x(this,"constraintsMap",new Map),x(this,"statsRegistry",[]),x(this,"usageRegistry",[]),x(this,"trackId",void 0),x(this,"direction",void 0),x(this,"_chained",!1),this.trackId=t,this.direction=n}getConstraints(){var t=this;return C(function*(){return yield ii(t,no.REQUEST_CONSTRAINTS)})()}requestApplyConstraints(t,n){var i=this;return C(function*(){var r;return _.info("processor ".concat(n.name," requestApplyConstraints for ").concat(i.trackId)),t&&i.constraintsMap.set(n,t),ct(i,no.REQUEST_UPDATE_CONSTRAINTS,Array.from(uc(r=i.constraintsMap).call(r)))})()}requestRevertConstraints(t){var n=this;return C(function*(){var i;if(n.constraintsMap.has(t))return _.info("processor ".concat(t.name," requestRevertConstraints for ").concat(n.trackId)),n.constraintsMap.delete(t),ct(n,no.REQUEST_UPDATE_CONSTRAINTS,Array.from(uc(i=n.constraintsMap).call(i)))})()}registerStats(t,n,i){this.statsRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name&&r.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name&&r.type===n);-1!==i&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:r,cb:o}of this.statsRegistry)try{const s=o();t.push({processorID:n,processorName:i,type:r,stats:s})}catch(s){_.error(new M(S.UNEXPECTED_ERROR,s.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);-1!==n&&this.usageRegistry.splice(n,1)}gatherUsage(){var t=this;return C(function*(){const n=[];if(!t.chained)return[];for(const{cb:i}of t.usageRegistry)try{let r=i();r instanceof q&&(r=yield r),n.push(Rt(Rt({},r),{},{direction:t.direction}))}catch(r){_.error("gather extension usage error",r)}return n})()}getDirection(){return this.direction}}class BK extends kt{constructor(t){super(),x(this,"name","AudioProcessorDestination"),x(this,"ID","0"),x(this,"inputTrack",void 0),x(this,"inputNode",void 0),x(this,"audioProcessorContext",void 0),x(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new M(S.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new M(S.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Ji.ON_TRACK,void 0),this.emit(Ji.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(Ji.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(Ji.ON_NODE,this.inputNode))}}class jK extends kt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,i){super(),x(this,"constraintsMap",new Map),x(this,"statsRegistry",[]),x(this,"audioContext",void 0),x(this,"trackId",void 0),x(this,"direction",void 0),x(this,"usageRegistry",[]),x(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=i}getConstraints(){var t=this;return C(function*(){return ii(t,no.REQUEST_CONSTRAINTS)})()}getAudioContext(){return this.audioContext}requestApplyConstraints(t,n){var i=this;return C(function*(){var r;return _.info("processor ".concat(n.name," requestApplyConstraints for ").concat(i.trackId)),t&&i.constraintsMap.set(n,t),ct(i,no.REQUEST_UPDATE_CONSTRAINTS,Array.from(uc(r=i.constraintsMap).call(r)))})()}requestRevertConstraints(t){var n=this;return C(function*(){var i;if(n.constraintsMap.has(t))return n.constraintsMap.delete(t),ct(n,no.REQUEST_UPDATE_CONSTRAINTS,Array.from(uc(i=n.constraintsMap).call(i)))})()}registerStats(t,n,i){this.statsRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name&&r.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name&&r.type===n);-1!==i&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:r,cb:o}of this.statsRegistry)try{const s=o();t.push({processorID:n,processorName:i,type:r,stats:s})}catch(s){_.error(new M(S.UNEXPECTED_ERROR,s.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);-1!==n&&this.usageRegistry.splice(n,1)}gatherUsage(){var t=this;return C(function*(){const n=[];if(!t.chained)return[];for(const{cb:i}of t.usageRegistry)try{let r=i();r instanceof q&&(r=yield r),n.push(Rt(Rt({},r),{},{direction:t.direction}))}catch(r){_.error("gather extension usage error",r)}return n})()}getDirection(){return this.direction}}class MP extends kt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),x(this,"context",void 0),x(this,"processSourceNode",void 0),x(this,"outputTrack",void 0),x(this,"processedNode",void 0),x(this,"clonedTrack",void 0),x(this,"outputNode",void 0),this.outputNode=new Nke}setVolume(){}createOutputTrack(){throw new M(S.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Nke{disconnect(){}connect(){}}function HK(e){return new q((t,n)=>{let i=!1;const r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r);const o=Yi()?"canplay":"playing";r.addEventListener(o,()=>{const s=r.videoWidth,a=r.videoHeight;!s&&Bt()||(i=!0,r.srcObject=null,r.remove(),t([s,a]))}),r.srcObject=new MediaStream([e]),r.play().catch(gS),setTimeout(()=>{i||(r.srcObject=null,r.remove(),t([r.videoWidth,r.videoHeight]))},4e3)})}function BS(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=wa(e.encoderConfig);return null!=n.width&&(t.width=n.width),null!=n.height&&(t.height=n.height),!$9()&&n.frameRate&&(t.frameRate=n.frameRate),V9()&&"object"==typeof t.frameRate&&(t.frameRate.max=60),Bt()&&(t.frameRate={ideal:30,max:30}),t}function GK(e){const t={};if($9()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,ol()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){const n=FS(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),hS()&&(t.sampleRate=void 0),t}const WK=function(){var e=C(function*(t,n,i){return yield(r=C(function*(o,s,a){const c=function(u){const h=[];for(let p=0;p<u.length;p+=2)h.push(parseInt(u.slice(p,p+2),16));return Uint8Array.from(h)}(h7(""+s+a)).slice(0,16),l=c.slice(0,12),d=yield window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},d,o))}),function(o,s,a){return r.apply(this,arguments)})(t.buffer,n,i);var r});return function(n,i,r){return e.apply(this,arguments)}}(),xP=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new q((n,i)=>{t.toBlob(function(){var r=C(function*(o){if(t.remove(),o){const s=yield zK(o);n({buffer:s,width:t.width,height:t.height})}else i(new M(S.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(o){return r.apply(this,arguments)}}(),e,1)})},zK=function(){var e=C(function*(t){const n=yield t.arrayBuffer();return new Uint8Array(n)});return function(n){return e.apply(this,arguments)}}();var KK,qK,YK,$K,XK,ZK,JK,QK,eq,tq,nq,iq,rq,oq,sq,aq,cq,lq,Ot,dq,uq,hq,pq,fq,mq,Ra,gq,_q,vq,Eq,bq,yq,Sq,Cq,Tq,wq,Iq,Rq,Aq,si;let Ht=(KK=le({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),qK=le({argsMap:(e,t)=>[e.getTrackId(),t]}),YK=en(),$K=tp("LocalAudioTrack","_enabledMutex"),XK=le({argsMap:(e,t)=>[e.getTrackId(),t]}),ZK=en(),JK=tp("LocalAudioTrack","_enabledMutex"),QK=le({argsMap:(e,t)=>[e.getTrackId(),t]}),eq=en(),tq=en(),nq=en(),iq=le({argsMap:e=>[e.getTrackId()]}),rq=en(),oq=le({argsMap:e=>[e.getTrackId()]}),sq=en(),aq=le({argsMap:e=>[e.getTrackId()]}),cq=le({argsMap:(e,t)=>[e.getTrackId(),t.name]}),lq=le({argsMap:e=>[e.getTrackId()]}),Me((Ot=class extends bp{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?ir.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,i){super(e,n),x(this,"trackMediaType",Ep.AUDIO),x(this,"_encoderConfig",void 0),x(this,"_trackSource",void 0),x(this,"_enabled",!0),x(this,"_volume",100),x(this,"_useAudioElement",!0),x(this,"_bypassWebAudio",!1),x(this,"processor",void 0),x(this,"_processorContext",void 0),x(this,"_processorDestination",void 0),x(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i,this._trackSource=new MP,R("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),R("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),ti()&&!io?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){ot(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&ir.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void _.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,ct(this,X.NEED_REPLACE_TRACK,this).then(()=>{_.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{_.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}setPlaybackDevice(e){var t=this;return C(function*(){if(!t._useAudioElement||!yK())throw new M(S.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield ir.setSinkID(t.getTrackId(),e)})()}setEnabled(e,t,n){var i=this;return C(function*(){return i._setEnabled(e,t,n)})()}_setEnabled(e,t,n){var i=this;return C(function*(){if(!n){if(e===i._enabled)return;i.stateCheck("enabled",e)}if(_.info("[".concat(i.getTrackId(),"] start setEnabled"),e),e){i._originMediaStreamTrack.enabled=!0;try{n||(i._enabled=!0),yield ct(i,X.NEED_ENABLE_TRACK,i),_.info("[".concat(i.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw n||(i._enabled=!1),_.error("[".concat(i.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{i._originMediaStreamTrack.enabled=!1,n||(i._enabled=!1);try{yield ct(i,X.NEED_DISABLE_TRACK,i)}catch(r){throw n||(i._enabled=!0),_.error("[".concat(i.getTrackId(),"] setEnabled to false error"),r.toString()),r}}})()}setMuted(e){var t=this;return C(function*(){e!==t._muted&&(t.stateCheck("muted",e),t._muted=e,t._originMediaStreamTrack.enabled=!e,_.debug("[".concat(t.getTrackId(),"] start set muted: ").concat(e)),e?yield ct(t,X.NEED_MUTE_TRACK,t):yield ct(t,X.NEED_UNMUTE_TRACK,t))})()}getStats(){return al(()=>{_.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Do(this,X.GET_STATS)||Rt({},yP)}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(to.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(to.ON_AUDIO_BUFFER),this._source.on(to.ON_AUDIO_BUFFER,n=>e(n))}play(){_.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(_.debug("[".concat(this.getTrackId(),"] start audio playback in element")),ir.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){_.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?ir.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];_.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ir.updateTrack(this.getTrackId(),this._mediaStreamTrack)}_updateOriginMediaStreamTrack(e,t){var n=this;return C(function*(){n._originMediaStreamTrack!==e&&(n._originMediaStreamTrack&&(n._originMediaStreamTrack.removeEventListener("ended",n._handleTrackEnded),t&&n._originMediaStreamTrack.stop()),e.addEventListener("ended",n._handleTrackEnded),n._originMediaStreamTrack=e,n._muted&&(n._originMediaStreamTrack.enabled=!1),n.processor&&n._processorContext&&n.processor.updateInput({track:e,context:n._processorContext}),n._mediaStreamTrack!==n._source.outputTrack?(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource(),yield ct(n,X.NEED_REPLACE_TRACK,n)):n._source.updateTrack(n._originMediaStreamTrack),n._getOriginVolumeLevel&&n._source.updateOriginTrack(e))})()}renewMediaStreamTrack(e){return q.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new M(S.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new M(S.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){var t=this;e.on(Ji.ON_TRACK,function(){var n=C(function*(i){i?i!==t._mediaStreamTrack&&(t._mediaStreamTrack=i,t._updatePlayerSource(!1),t._source.processedNode=t._source.createMediaStreamSourceNode(i),yield ct(t,X.NEED_REPLACE_TRACK,t)):t._mediaStreamTrack!==t._originMediaStreamTrack&&(t._mediaStreamTrack=t._originMediaStreamTrack,t._updatePlayerSource(),yield ct(t,X.NEED_REPLACE_TRACK,t))});return function(i){return n.apply(this,arguments)}}()),e.on(Ji.ON_NODE,n=>{this._source.processedNode=n})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Ji.ON_TRACK),e.removeAllListeners(Ji.ON_NODE)}bindProcessorContextEvents(e){var t=this;e.on(no.REQUEST_CONSTRAINTS,function(){var n=C(function*(i){i(t._originMediaStreamTrack.getSettings())});return function(i){return n.apply(this,arguments)}}())}unbindProcessorContextEvents(e){e.removeAllListeners(no.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof MP&&(this._trackSource=new NK(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new jK(this._source.context,this.getTrackId(),"local"),t=new BK(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(to.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(ir.stop(this.getTrackId()),this._source.play()),ct(this,X.NEED_REPLACE_MIXING_TRACK,this).then(()=>{_.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{_.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[KK],Object.getOwnPropertyDescriptor(Ot.prototype,"setVolume"),Ot.prototype),Me(Ot.prototype,"setPlaybackDevice",[qK,YK],Object.getOwnPropertyDescriptor(Ot.prototype,"setPlaybackDevice"),Ot.prototype),Me(Ot.prototype,"setEnabled",[$K,XK,ZK],Object.getOwnPropertyDescriptor(Ot.prototype,"setEnabled"),Ot.prototype),Me(Ot.prototype,"setMuted",[JK,QK,eq],Object.getOwnPropertyDescriptor(Ot.prototype,"setMuted"),Ot.prototype),Me(Ot.prototype,"getStats",[tq],Object.getOwnPropertyDescriptor(Ot.prototype,"getStats"),Ot.prototype),Me(Ot.prototype,"setAudioFrameCallback",[nq],Object.getOwnPropertyDescriptor(Ot.prototype,"setAudioFrameCallback"),Ot.prototype),Me(Ot.prototype,"play",[iq,rq],Object.getOwnPropertyDescriptor(Ot.prototype,"play"),Ot.prototype),Me(Ot.prototype,"stop",[oq,sq],Object.getOwnPropertyDescriptor(Ot.prototype,"stop"),Ot.prototype),Me(Ot.prototype,"close",[aq],Object.getOwnPropertyDescriptor(Ot.prototype,"close"),Ot.prototype),Me(Ot.prototype,"pipe",[cq],Object.getOwnPropertyDescriptor(Ot.prototype,"pipe"),Ot.prototype),Me(Ot.prototype,"unpipe",[lq],Object.getOwnPropertyDescriptor(Ot.prototype,"unpipe"),Ot.prototype),Ot),jS=(dq=le({argsMap:(e,t)=>[e.getTrackId(),t]}),uq=en(),hq=tp("MicrophoneAudioTrack","_enabledMutex"),pq=le({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),fq=en(),mq=le({argsMap:e=>[e.getTrackId()]}),Me((Ra=class extends Ht{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,i){super(e,t.encoderConfig?FS(t.encoderConfig):{},i,R("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),x(this,"_config",void 0),x(this,"_deviceName","default"),x(this,"_constraints",void 0),x(this,"_originalConstraints",void 0),x(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,"boolean"==typeof t.bypassWebAudio&&(this._bypassWebAudio=t.bypassWebAudio),(Zh()||bN())&&tt.bindInterruptDetectorTrack(this)}setDevice(e){var t=this;return C(function*(){if(_.info("[".concat(t.getTrackId(),"] start set device to ").concat(e)),t._enabled)try{const n=yield oo.getDeviceById(e),i={};i.audio=Rt({},t._constraints),i.audio.deviceId={exact:e},t._originMediaStreamTrack.stop();let r=null;try{r=yield ro(i,t.getTrackId())}catch(o){throw _.error("[".concat(t.getTrackId(),"] setDevice failed"),o.toString()),r=yield ro({audio:t._constraints},t.getTrackId()),yield t._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),o}yield t._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),t._deviceName=n.label,t._config.microphoneId=e,t._constraints.deviceId={exact:e}}catch(n){throw _.error("[".concat(t.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=yield oo.getDeviceById(e);t._deviceName=n.label,t._config.microphoneId=e,t._constraints.deviceId={exact:e}}catch(n){throw _.error("[".concat(t.getTrackId(),"] setDevice error"),n.toString()),n}_.info("[".concat(t.getTrackId(),"] set device to ").concat(e," success"))})()}setEnabled(e,t,n){var i=()=>super._setEnabled,r=this;return C(function*(){if(t)return _.debug("[".concat(r.getTrackId(),"] setEnabled false (do not close microphone)")),yield i().call(r,e);if(!n){if(e===r._enabled)return;r.stateCheck("enabled",e)}if(_.info("[".concat(r.getTrackId(),"] start setEnabled"),e),R("AUTO_RESET_AUDIO_ROUTE")&&(Yi()||Xo())){const c=navigator.audioSession;c&&(e||(c.type="playback"),c.type="auto")}if(!e){var o;r._originMediaStreamTrack.onended=null,r._originMediaStreamTrack.stop(),null===(o=r._source.clonedTrack)||void 0===o||o.stop(),n||(r._enabled=!1);try{yield ct(r,X.NEED_DISABLE_TRACK,r)}catch(c){throw _.error("[".concat(r.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const s=Rt({},r._constraints),a=oo.searchDeviceIdByName(r._deviceName);a&&!s.deviceId&&(s.deviceId=a);try{n||(r._enabled=!0);const c=yield ro({audio:r._constraints},r.getTrackId());yield r._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),yield ct(r,X.NEED_ENABLE_TRACK,r)}catch(c){throw n||(r._enabled=!1),_.error("[".concat(r.getTrackId(),"] setEnabled true failed"),c.toString()),c}_.info("[".concat(r.getTrackId(),"] setEnabled success"))})()}close(){super.close(),(Zh()||bN())&&tt.unbindInterruptDetectorTrack(this)}onTrackEnded(){var e=this;if((Yi()||Xo())&&this._enabled&&!this._isClosed&&tt.duringInterruption){const t=function(){var n=C(function*(){tt.off(Xn.IOS_INTERRUPTION_END,t),e._enabled&&!e._isClosed&&(_.debug("[".concat(e.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),yield e.setEnabled(!1),yield e.setEnabled(!0))});return function(){return n.apply(this,arguments)}}();tt.on(Xn.IOS_INTERRUPTION_END,t)}else _.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(_p.TRACK_ENDED)}renewMediaStreamTrack(e){var t=this;return C(function*(){const n=e||t._constraints,i=oo.searchDeviceIdByName(t._deviceName);if(i&&!n.deviceId&&(n.deviceId=i),t._constraints=n,t._enabled){t._originMediaStreamTrack.stop();const r=yield ro({audio:t._constraints},t.getTrackId());yield t._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}})()}bindProcessorContextEvents(e){var t=this;super.bindProcessorContextEvents(e),e.on(no.REQUEST_UPDATE_CONSTRAINTS,function(){var n=C(function*(i,r,o){try{const s=Object.assign({},t._originalConstraints,...i);yield t.renewMediaStreamTrack(s),r()}catch(s){o(s)}});return function(i,r,o){return n.apply(this,arguments)}}())}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(no.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[dq,uq],Object.getOwnPropertyDescriptor(Ra.prototype,"setDevice"),Ra.prototype),Me(Ra.prototype,"setEnabled",[hq,pq,fq],Object.getOwnPropertyDescriptor(Ra.prototype,"setEnabled"),Ra.prototype),Me(Ra.prototype,"close",[mq],Object.getOwnPropertyDescriptor(Ra.prototype,"close"),Ra.prototype),Ra),Mke=(gq=le({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),_q=en(),vq=le({argsMap:e=>[e.getTrackId()]}),Eq=en(),bq=le({argsMap:e=>[e.getTrackId()]}),yq=en(),Sq=le({argsMap:e=>[e.getTrackId()]}),Cq=en(),Tq=le({argsMap:e=>[e.getTrackId()]}),wq=en(),Iq=le({argsMap:e=>[e.getTrackId()]}),Rq=le({argsMap:e=>[e.getTrackId()]}),Aq=en(),Me((si=class extends Ht{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,i){super(t.createOutputTrack(),n,i),x(this,"source",void 0),x(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(to.AUDIO_SOURCE_STATE_CHANGE,r=>{this.safeEmit(_p.SOURCE_STATE_CHANGE,r)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){ot(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[gq,_q],Object.getOwnPropertyDescriptor(si.prototype,"startProcessAudioBuffer"),si.prototype),Me(si.prototype,"pauseProcessAudioBuffer",[vq,Eq],Object.getOwnPropertyDescriptor(si.prototype,"pauseProcessAudioBuffer"),si.prototype),Me(si.prototype,"seekAudioBuffer",[bq,yq],Object.getOwnPropertyDescriptor(si.prototype,"seekAudioBuffer"),si.prototype),Me(si.prototype,"resumeProcessAudioBuffer",[Sq,Cq],Object.getOwnPropertyDescriptor(si.prototype,"resumeProcessAudioBuffer"),si.prototype),Me(si.prototype,"stopProcessAudioBuffer",[Tq,wq],Object.getOwnPropertyDescriptor(si.prototype,"stopProcessAudioBuffer"),si.prototype),Me(si.prototype,"close",[Iq],Object.getOwnPropertyDescriptor(si.prototype,"close"),si.prototype),Me(si.prototype,"setAudioBufferPlaybackSpeed",[Rq,Aq],Object.getOwnPropertyDescriptor(si.prototype,"setAudioBufferPlaybackSpeed"),si.prototype),si);class wn extends Ht{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=yp().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,gt(8,"track-mix-")),x(this,"trackList",void 0),x(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return-1!==this.trackList.indexOf(t)}addAudioTrack(t){-1===this.trackList.indexOf(t)?(_.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):_.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(-1!==this.trackList.indexOf(t)){_.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}fS(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof wn?n.emit(Dd.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class xke extends OK{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(to.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),x(this,"audioBuffer",void 0),x(this,"sourceNode",void 0),x(this,"startPlayTime",0),x(this,"startPlayOffset",0),x(this,"pausePlayTime",0),x(this,"options",void 0),x(this,"currentLoopCount",0),x(this,"currentPlaybackSpeed",100),x(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:(this.playbackSpeed/100*(this.context.currentTime-this.startPlayTime)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){"stopped"===this.currentState?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):_.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=t,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Dq=new Map;class kP{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/(this.renderStats.curTs-this.renderStats.lastTs);return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(_.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,null===(n=this.onVideoStateChanged)||void 0===n||n.call(this,this.videoState))}constructor(t){x(this,"trackId",void 0),x(this,"config",void 0),x(this,"onFirstVideoFrameDecoded",void 0),x(this,"onVideoStateChanged",void 0),x(this,"freezeTimeCounterList",[]),x(this,"renderFreezeAccTime",0),x(this,"isKeepLastFrame",!1),x(this,"timeUpdatedCount",0),x(this,"freezeTime",0),x(this,"playbackTime",0),x(this,"lastTimeUpdatedTime",0),x(this,"autoplayFailed",!1),x(this,"videoTrack",void 0),x(this,"videoElement",void 0),x(this,"cacheVideoElement",void 0),x(this,"renderStats",void 0),x(this,"_videoState",Ia.VideoStateStopped),x(this,"videoElementCheckInterval",void 0),x(this,"videoElementFreezeTimeout",void 0),x(this,"_videoElementStatus",Li.NONE),x(this,"isGettingVideoDimensions",!1),x(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return _.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),x(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===tt.curState&&(_.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(U9())),q9()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),x(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Li.PLAYING;break;case"loadeddata":if(this.videoState=Ia.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Li.CANPLAY;break;case"stalled":this.videoElementStatus=Li.STALLED;break;case"suspend":this.videoElementStatus=Li.SUSPEND;break;case"pause":this.videoElementStatus=Li.PAUSED,Yi()||Xo()||ti()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(_.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Li.WAITING;break;case"abort":this.videoElementStatus=Li.ABORT;break;case"ended":this.videoElementStatus=Li.ENDED;break;case"emptied":this.videoElementStatus=Li.EMPTIED;break;case"error":{const i=this.videoElement.error,r=i?"".concat(i.message," (").concat(i.code,")"):"";i&&(this.videoElementStatus=Li.ERROR),_.error("[".concat(this.trackId,"] media error: ").concat(r," "));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const r=i-this.lastTimeUpdatedTime,o=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,fc.lastVisibleTime<fc.lastHiddenTime||o<fc.lastHiddenTime||o<fc.lastVisibleTime)return;for(r>R("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=r),this.playbackTime+=r;this.playbackTime>=6e3;){this.playbackTime-=6e3;const s=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(s),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),x(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(_.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(U9())),q9()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,this.videoElement=t.element instanceof HTMLVideoElement?t.element:document.createElement("video"),tt.on(Xn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tt.on(Xn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return null!==(t=this.videoElement.parentElement)&&void 0!==t?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(r=>{t&&FK(t,"video",r.message,this.trackId),"NotAllowedError"===r.name?(_.warning("detected video element autoplay failed",r),this.autoplayFailed=!0,this.handleAutoPlayFailed()):_.warning("[".concat(this.trackId,"] play warning: "),r)});const i=xe();if(("Safari"===i.name&&15===Number(i.version)||Zh())&&n&&n.then){const r=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(r).catch(r)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return _.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height);return t.remove(),i}getCurrentFrameToUint8Array(t){var n=arguments,i=this;return C(function*(){let r=n.length>1&&void 0!==n[1]?n[1]:1;const o=document.createElement("canvas");o.width=i.videoElement.videoWidth,o.height=i.videoElement.videoHeight;const s=o.getContext("2d");return s?(s.drawImage(i.videoElement,0,0,o.width,o.height),new q((a,c)=>{o.toBlob(function(){var l=C(function*(d){if(o.remove(),d){const u=yield zK(d);a({buffer:u,width:o.width,height:o.height})}else c(new M(S.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(d){return l.apply(this,arguments)}}(),t,r<0?.1:r>1?1:r)})):yield xP(t)})()}destroy(){this.renderStats=void 0,tt.off(Xn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tt.off(Xn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Ia.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Li.INIT,!this.videoElementCheckInterval&&(Oq.forEach(o=>{this.videoElement.addEventListener(o,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{var o;(o=this.videoElement)!==document.body&&document.body.contains(o)||(this.videoElementStatus=Li.DESTROYED)},1e3),R("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let o;const s=()=>{"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",s),this.videoElementFreezeTimeout=window.setTimeout(a,R("VIDEO_FREEZE_DURATION")))},a=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Ia.VideoStateDecoding&&("visible"===document.visibilityState?this.videoState=Ia.VideoStateFrozen:document.addEventListener("visibilitychange",s))},c=(l,d)=>{if(this.videoElementStatus===Li.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=d.mediaTime):this.renderStats={lastTs:d.mediaTime,curTs:d.mediaTime,lastRenderNum:0,renderNum:0},o){const p=d.presentationTime-o.presentationTime;this.videoState===Ia.VideoStateStarting&&(this.videoState=Ia.VideoStateDecoding),this.videoState===Ia.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(a,R("VIDEO_FREEZE_DURATION"))),p<R("VIDEO_FREEZE_DURATION")&&this.videoState===Ia.VideoStateFrozen&&(this.videoState=Ia.VideoStateDecoding),p>R("VIDEO_FREEZE_DURATION")&&fc.lastVisibleTime>=fc.lastHiddenTime&&o.timestamp>fc.lastVisibleTime&&o.timestamp>fc.lastHiddenTime&&(this.renderFreezeAccTime+=p)}o=Rt(Rt({},d),{},{timestamp:l})}var u,h;R("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(u=(h=this.videoElement).requestVideoFrameCallback)||void 0===u||u.call(h,c))};null===(t=(n=this.videoElement).requestVideoFrameCallback)||void 0===t||t.call(n,c)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),hS()&&!R("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=xe();"Safari"===i.name&&15===Number(i.version)||Zh()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.videoElement.style.objectFit=this.config.fit?this.config.fit:"cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Bt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Bt()&&this.videoElement.load());const r=this.videoElement.play();void 0!==r&&r.catch(o=>{_.debug("[".concat(this.trackId,"] playback interrupted"),o.toString())})}resetVideoElement(){Oq.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Li.NONE}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{_.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{_.error(i)}),this.autoplayFailed=!1,Ng()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Ng()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),LK()}}const Oq=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Nq extends kP{constructor(t){super(t),x(this,"container",void 0),x(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}getCurrentFrameToUint8Array(t){var n=arguments,i=()=>super.getCurrentFrameToUint8Array,r=this;return C(function*(){var o;let s=n.length>1&&void 0!==n[1]?n[1]:1;return null!==(o=r.container)&&void 0!==o&&o.contains(r.videoElement)?yield i().call(r,t,s):yield xP(t)})()}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",R("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if(null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Pq,Mq,xq,kq,Lq,Fq,Uq,Vq,Bq,jq,Hq,Gq,Wq,zq,Kq,qq,Yq,$q,Xq,Zq,Jq,Qq,eY,tY,De,nY,iY,rY,oY,sY,aY,cY,lY,ao;let St=(Pq=le({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Mq=en(),xq=le({argsMap:e=>[e.getTrackId()]}),kq=tp("LocalVideoTrack","_enabledMutex"),Lq=le({argsMap:(e,t)=>[e.getTrackId(),t]}),Fq=en(),Uq=tp("LocalVideoTrack","_enabledMutex"),Vq=le({argsMap:(e,t)=>[e.getTrackId(),t]}),Bq=en(),jq=le({argsMap:(e,t)=>[e.getTrackId(),t]}),Hq=en(),Gq=en(),Wq=le({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),zq=en(),Kq=en(),qq=en(),Yq=en(),$q=en(),Xq=en(),Zq=en(),Jq=le({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Qq=le({argsMap:e=>[e.getTrackId()]}),eY=le({argsMap:e=>[e.getTrackId()]}),tY=le({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),De=class mJ extends bp{get videoHeight(){if(ti()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(ti()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Li.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,i,r,o,s){if(super(t,o),x(this,"trackMediaType",Ep.VIDEO),x(this,"_player",void 0),x(this,"isUseScaleResolutionDownBy",!1),x(this,"_videoVisibleTimer",null),x(this,"_previousVideoVisibleStatus",void 0),x(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),x(this,"_encoderConfig",void 0),x(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),x(this,"_optimizationMode",void 0),x(this,"_videoHeight",void 0),x(this,"_videoWidth",void 0),x(this,"_forceBitrateLimit",void 0),x(this,"_enabled",!0),x(this,"_processorDestination",void 0),x(this,"_processorContext",void 0),ti()){const{width:a,height:c}=t.getSettings();this._videoWidth=a,this._videoHeight=c}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=i,this._optimizationMode=r,this._hints=s||[],-1===this._hints.indexOf(ft.SCREEN_TRACK))this.updateBitrateFromProfile();else if(function(a,c,l){const d=xe();return!(d.name!==a||!d.osVersion)&&115===Number(d.version)}(Ye.CHROME)&&-1!==dS().indexOf("Windows")){const a=function(c,l){if("VideoFrame"in window&&"TransformStream"in window&&Fe().supportWebRTCInsertableStream){const d=new MediaStreamTrackProcessor(c),u=new MediaStreamTrackGenerator({kind:"video"});let h,p,m=Date.now();const f=()=>{g&&(clearInterval(g),g=void 0),h&&(h.close(),h=void 0),c.stop(),p=void 0,u.removeEventListener("ended",f)};let g=window.setInterval(()=>{if(p&&h&&Date.now()-m>1e3)try{"live"===u.readyState?p.enqueue(h.clone()):f()}catch{f()}},1e3);const E=new TransformStream({transform:(b,T)=>{"live"===u.readyState?(p=T,m=Date.now(),void 0===h?(h=b,T.enqueue(b.clone())):(T.enqueue(h),h=b)):b.close()}});return u.addEventListener("ended",f),d.readable.pipeThrough(E).pipeTo(u.writable),u}}(t);a&&(_.info("local screen video track begin to inject frame"),this._mediaStreamTrack=a)}n&&-1!==this._hints.indexOf(ft.CUSTOM_TRACK)&&this.setEncoderConfiguration(n),this._processorContext=new VK(this.getTrackId(),"local"),this._processorDestination=new UK(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof t){const r=document.getElementById(t);r?t=r:(_.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}_.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=Rt(Rt(Rt({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(this._player=t instanceof HTMLVideoElement?new kP(i):new Nq(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(_p.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},R("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,_.debug("[".concat(this.getTrackId(),"] stop video playback")))}setEnabled(t,n){var i=this;return C(function*(){if(!n){if(t===i._enabled)return;i.stateCheck("enabled",t)}if(_.info("[".concat(i.getTrackId(),"] start setEnabled"),t),!t){i._originMediaStreamTrack.enabled=!1;try{yield ct(i,X.NEED_DISABLE_TRACK,i)}catch(r){throw _.error("[".concat(i.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(i._enabled=!1),void _.info("[".concat(i.getTrackId(),"] setEnabled to false success"))}i._originMediaStreamTrack.enabled=!0;try{yield ct(i,X.NEED_ENABLE_TRACK,i)}catch(r){throw _.error("[".concat(i.getTrackId(),"] setEnabled to true error"),r.toString()),r}_.info("[".concat(i.getTrackId(),"] setEnabled to true success")),n||(i._enabled=!0)})()}setMuted(t){var n=this;return C(function*(){t!==n._muted&&(n.stateCheck("muted",t),n._muted=t,n._originMediaStreamTrack.enabled=!t,_.debug("[".concat(n.getTrackId(),"] start set muted: ").concat(t)),t?yield ct(n,X.NEED_MUTE_TRACK,n):yield ct(n,X.NEED_UNMUTE_TRACK,n))})()}setEncoderConfiguration(t,n){var i=this;return C(function*(){if(!i._enabled)throw new M(S.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=wa(t),i._forceBitrateLimit&&(t.bitrateMax=i._forceBitrateLimit.max_bitrate?i._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=i._forceBitrateLimit.min_bitrate?i._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const r=BS({encoderConfig:t});(ti()||Yi()||Xo())&&(r.deviceId=void 0),_.debug("[".concat(i.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{yield i._originMediaStreamTrack.applyConstraints(r),i.updateMediaStreamTrackResolution()}catch(o){const s=new M(S.UNEXPECTED_ERROR,o.toString());throw _.error("[".concat(i.getTrackId(),"] applyConstraints error"),s.toString()),s}}i._encoderConfig=t,-1===i._hints.indexOf(ft.SCREEN_TRACK)&&i.updateBitrateFromProfile();try{yield ct(i,X.NEED_UPDATE_VIDEO_ENCODER,i)}catch(r){return r.throw(_)}})()}getStats(){return al(()=>{_.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Do(this,X.GET_STATS)||Rt({},SP)}setBeautyEffect(t){return C(function*(){_.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")})()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}getCurrentFrameImage(t){var n=arguments,i=this;return C(function*(){return i._player?i._player.getCurrentFrameToUint8Array(t,n.length>1&&void 0!==n[1]?n[1]:1):yield xP(t)})()}setBitrateLimit(t){var n=this;return C(function*(){if(_.debug("[".concat(n.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){n._forceBitrateLimit=t,n._encoderConfig&&(n._encoderConfig.bitrateMax=n._encoderConfig.bitrateMax&&n._encoderConfig.bitrateMax<t.max_bitrate?n._encoderConfig.bitrateMax:t.max_bitrate,n._encoderConfig.bitrateMin=t.min_bitrate);try{yield ct(n,X.NEED_UPDATE_VIDEO_ENCODER,n)}catch(i){return i.throw(_)}}})()}setOptimizationMode(t){var n=this;return C(function*(){if("motion"!==t&&"detail"!==t&&"balanced"!==t)return void _.error(S.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=n._optimizationMode;try{n._optimizationMode=t,yield ct(n,X.NEED_UPDATE_VIDEO_SEND_PARAMETERS,n)}catch(r){throw n._optimizationMode=i,_.error("[".concat(n.getTrackId(),"] set optimization mode failed"),r.toString()),r}_.info("[".concat(n.getTrackId(),"] set optimization mode success (").concat(t,")"))})()}setScalabiltyMode(t){if(1===t.numSpatialLayers&&1!==t.numTemporalLayers)return _.error(S.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,_.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){HK(this._originMediaStreamTrack).then(t=>{let[n,i]=t;this._videoHeight=i,this._videoWidth=n}).catch(gS)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}setSenderConfiguration(t){var n=this;return C(function*(){if(!n._enabled)throw new M(S.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");_.debug("[".concat(n.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=wa(t),n._forceBitrateLimit&&(t.bitrateMax=n._forceBitrateLimit.max_bitrate?n._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=n._forceBitrateLimit.min_bitrate?n._forceBitrateLimit.min_bitrate:t.bitrateMin),n._encoderConfig=t,-1===n._hints.indexOf(ft.SCREEN_TRACK)&&n.updateBitrateFromProfile();try{yield ct(n,X.NEED_UPDATE_VIDEO_ENCODER,n)}catch(i){return i.throw(_)}})()}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!n||!i)return;const{bitrateMax:r,bitrateMin:o}=this._encoderConfig;if(null==o||null==r){const{max:s,min:a}=function(c,l,d,u,h){const p=R("BITRATE_ADAPTER_TYPE");if("DEFAULT_BITRATE"===p)return{min:u,max:h};if(void 0===h){var m;const g=Math.floor(200*Math.pow(d/15,.6)*Math.pow(c*l/640/360,.75));h="STANDARD_BITRATE"===p?4*g:2*g,u=null!==(m=u)&&void 0!==m?m:g}else{var f;u=null!==(f=u)&&void 0!==f?f:Math.floor(h/10)}return{min:u,max:h}}(t,n,i,o,r);this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=s,_.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(s,", brMin: ").concat(a,"]"))}}getVideoElementVisibleStatus(){try{var t,n;const i=null==this||null===(t=this._player)||void 0===t?void 0:t.getContainerElement(),r={track:this,element:null==this||null===(n=this._player)||void 0===n?void 0:n.getVideoElement(),slot:i?.parentElement},{element:o,slot:s}=r;if(this.isPlaying&&o instanceof HTMLVideoElement&&s instanceof HTMLElement){const a=J9.checkOneElementVisible(o),c=Object.assign({},a);if(c.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c.visible;ne.reportApiInvoke(null,{tag:jt.TRACER,name:Cn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(c.visible?"Video is visible":"Invisible because of ".concat(c.reason))}return c}return}catch(i){throw new M(S.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}renewMediaStreamTrack(t){return C(function*(){})()}pipe(t){if(this.processor===t)return t;if(t._source)throw new M(S.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this._encoderConfig;t&&(i=Rt(Rt({},i),wa(t))),i=yd(i);const r=gt(8,"track-video-cloned-"),o=new mJ(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,yd(this._scalabilityMode),this._optimizationMode,r,yd(this._hints));return t&&i&&o.setEncoderConfiguration(i),_.debug("clone video track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),o}replaceTrack(t,n){var i=this;return C(function*(){if(!(t instanceof MediaStreamTrack))throw new M(S.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==t.kind)throw new M(S.INVALID_PARAMS,"track should be a video MediaStreamTrack");yield i._updateOriginMediaStreamTrack(t,n,!0),i.updateMediaStreamTrackResolution()})()}sendSeiData(t){if(al(()=>{ne.reportApiInvoke(null,{name:Cn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:jt.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!R("ENABLE_VIDEO_SEI")||!R("ENABLE_ENCODED_TRANSFORM"))return void _.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new M(S.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void _.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(0===i.codecs.length)return;const r=i.codecs[0].mimeType.toLocaleLowerCase();"video/h264"===r?this.safeEmit("sei-to-send",t):_.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){var t=this;this.processorDestination.on(Ji.ON_TRACK,function(){var n=C(function*(i){i?i!==t._mediaStreamTrack&&(t._mediaStreamTrack=i,t._updatePlayerSource(),yield ct(t,X.NEED_REPLACE_TRACK,t)):t._mediaStreamTrack!==t._originMediaStreamTrack&&(t._mediaStreamTrack=t._originMediaStreamTrack,t._updatePlayerSource(),yield ct(t,X.NEED_REPLACE_TRACK,t))});return function(i){return n.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ji.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(no.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(no.REQUEST_CONSTRAINTS)}},Me(De.prototype,"play",[Pq,Mq],Object.getOwnPropertyDescriptor(De.prototype,"play"),De.prototype),Me(De.prototype,"stop",[xq],Object.getOwnPropertyDescriptor(De.prototype,"stop"),De.prototype),Me(De.prototype,"setEnabled",[kq,Lq,Fq],Object.getOwnPropertyDescriptor(De.prototype,"setEnabled"),De.prototype),Me(De.prototype,"setMuted",[Uq,Vq,Bq],Object.getOwnPropertyDescriptor(De.prototype,"setMuted"),De.prototype),Me(De.prototype,"setEncoderConfiguration",[jq,Hq],Object.getOwnPropertyDescriptor(De.prototype,"setEncoderConfiguration"),De.prototype),Me(De.prototype,"getStats",[Gq],Object.getOwnPropertyDescriptor(De.prototype,"getStats"),De.prototype),Me(De.prototype,"setBeautyEffect",[Wq,zq],Object.getOwnPropertyDescriptor(De.prototype,"setBeautyEffect"),De.prototype),Me(De.prototype,"getCurrentFrameData",[Kq],Object.getOwnPropertyDescriptor(De.prototype,"getCurrentFrameData"),De.prototype),Me(De.prototype,"getCurrentFrameImage",[qq],Object.getOwnPropertyDescriptor(De.prototype,"getCurrentFrameImage"),De.prototype),Me(De.prototype,"setBitrateLimit",[Yq],Object.getOwnPropertyDescriptor(De.prototype,"setBitrateLimit"),De.prototype),Me(De.prototype,"setOptimizationMode",[$q],Object.getOwnPropertyDescriptor(De.prototype,"setOptimizationMode"),De.prototype),Me(De.prototype,"setScalabiltyMode",[Xq],Object.getOwnPropertyDescriptor(De.prototype,"setScalabiltyMode"),De.prototype),Me(De.prototype,"updateMediaStreamTrackResolution",[Zq],Object.getOwnPropertyDescriptor(De.prototype,"updateMediaStreamTrackResolution"),De.prototype),Me(De.prototype,"pipe",[Jq],Object.getOwnPropertyDescriptor(De.prototype,"pipe"),De.prototype),Me(De.prototype,"unpipe",[Qq],Object.getOwnPropertyDescriptor(De.prototype,"unpipe"),De.prototype),Me(De.prototype,"close",[eY],Object.getOwnPropertyDescriptor(De.prototype,"close"),De.prototype),Me(De.prototype,"replaceTrack",[tY],Object.getOwnPropertyDescriptor(De.prototype,"replaceTrack"),De.prototype),De),LP=(nY=le({argsMap:(e,t)=>[e.getTrackId(),t]}),iY=en(),rY=tp("CameraVideoTrack","_enabledMutex"),oY=le({argsMap:(e,t)=>[e.getTrackId(),t]}),sY=en(),aY=le({argsMap:(e,t)=>[e.getTrackId(),t]}),cY=en(),lY=le({argsMap:e=>[e.getTrackId()]}),ao=class gJ extends St{get __className__(){return"CameraVideoTrack"}constructor(t,n,i,r,o,s){var a;super(t,wa(n.encoderConfig),r,o,s),a=this,x(this,"_config",void 0),x(this,"_originalConstraints",void 0),x(this,"_constraints",void 0),x(this,"_enabled",!0),x(this,"_deviceName","default"),x(this,"tryResumeVideoForIOS15_16WeChat",C(function*(){(Zh()||bN())&&!function(){const c=xe();if(c.os!==kn.IOS||!c.osVersion)return!1;const l=c.osVersion.split(".");return 15===Number(l[0])&&Number(l[1])>=2}()&&Y9()&&a._enabled&&!a._isClosed&&(_.debug("[".concat(a.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),yield a.renewMediaStreamTrack())})),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=t.label,this._encoderConfig=wa(this._config.encoderConfig),tt.on(Xn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),tt.on(Xn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}setDevice(t){var n=this;return C(function*(){return"string"==typeof t?n._setDeviceById(t):t.deviceId?n._setDeviceById(t.deviceId):t.facingMode?n._setDeviceByFacingModel(t.facingMode):void 0})()}_setDeviceById(t){var n=this;return C(function*(){if(_.info("[".concat(n.getTrackId(),"] set device to ").concat(t)),n._enabled)try{const i=yield oo.getDeviceById(t),r={};r.video=Rt({},n._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,n._originMediaStreamTrack.stop();let o=null;try{o=yield ro(r,n.getTrackId())}catch(s){throw _.error("[".concat(n.getTrackId(),"] setDevice failed"),s.toString()),o=yield ro({video:n._constraints},n.getTrackId()),yield n._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),s}yield n._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),n.updateMediaStreamTrackResolution(),n._deviceName=i.label,n._config.cameraId=t,n._constraints.deviceId={exact:t}}catch(i){throw _.error("[".concat(n.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=yield oo.getDeviceById(t);n._deviceName=i.label,n._config.cameraId=t,n._constraints.deviceId={exact:t}}catch(i){throw _.error("[".concat(n.getTrackId(),"] setDevice error"),i.toString()),i}_.info("[".concat(n.getTrackId(),"] setDevice success"))})()}_setDeviceByFacingModel(t){var n=this;return C(function*(){_.info("[".concat(n.getTrackId(),"] set facingMode ").concat(t));const i={video:Rt(Rt({},n._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(n._enabled){n._originMediaStreamTrack.stop();let r=null;try{r=yield ro(i,n.getTrackId())}catch(o){throw _.error("[".concat(n.getTrackId(),"] setDeviceByFacingModel failed"),o.toString()),r=yield ro({video:n._constraints},n.getTrackId()),yield n._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),o}yield n._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),n.updateMediaStreamTrackResolution()}n._deviceName="",n._config.facingMode=t,n._config.cameraId=void 0,n._constraints=Rt({},i.video),_.info("[".concat(n.getTrackId(),"] setDeviceByFacingModel success"))})()}setEnabled(t,n){var i=this;return C(function*(){if(!n){if(t===i._enabled)return;i.stateCheck("enabled",t)}if(_.info("[".concat(i.getTrackId(),"] start setEnabled"),t),t){try{if(i.isExternalTrack)i._originMediaStreamTrack.enabled=!0;else{const r=yield ro({video:i._constraints},i.getTrackId());yield i._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}yield ct(i,X.NEED_ENABLE_TRACK,i)}catch(r){throw _.error("[".concat(i.getTrackId(),"] setEnabled true error"),r.toString()),r}i.updateMediaStreamTrackResolution(),_.info("[".concat(i.getTrackId(),"] setEnabled to true success")),n||(i._enabled=!0)}else{i.isExternalTrack?i._originMediaStreamTrack.enabled=!1:(i._originMediaStreamTrack.onended=null,i._originMediaStreamTrack.stop()),n||(i._enabled=!1);try{yield ct(i,X.NEED_DISABLE_TRACK,i)}catch(r){throw _.error("[".concat(i.getTrackId(),"] setEnabled to false error"),r.toString()),r}_.info("[".concat(i.getTrackId(),"] setEnabled to false success"))}})()}setEncoderConfiguration(t,n){var i=this;return C(function*(){if(!i._enabled)throw new M(S.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=wa(t),i._forceBitrateLimit&&(t.bitrateMax=i._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=i._forceBitrateLimit.min_bitrate||t.bitrateMin);const r=dn(i._config);r.encoderConfig=t;const o=BS(r);(ti()||Yi()||Xo())&&(o.deviceId=void 0),_.debug("[".concat(i.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(o));try{yield i._originMediaStreamTrack.applyConstraints(o),i.updateMediaStreamTrackResolution()}catch(s){const a=new M(S.UNEXPECTED_ERROR,s.toString());throw _.error("[".concat(i.getTrackId(),"] applyConstraints error"),a.toString()),a}i._config=r,i._constraints=o,i._originalConstraints=o,i._encoderConfig=t,-1===i._hints.indexOf(ft.SCREEN_TRACK)&&i.updateBitrateFromProfile();try{yield ct(i,X.NEED_UPDATE_VIDEO_ENCODER,i)}catch(s){return s.throw(_)}})()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){var t=this;if((Yi()||Xo())&&this._enabled&&!this._isClosed&&tt.duringInterruption){const n=function(){var i=C(function*(){tt.off(Xn.IOS_INTERRUPTION_END,n),t._enabled&&!t._isClosed&&(_.debug("[".concat(t.getTrackId(),"] try capture camera media device for interrupted iOS device.")),yield t.setEnabled(!1),yield t.setEnabled(!0))});return function(){return i.apply(this,arguments)}}();tt.on(Xn.IOS_INTERRUPTION_END,n)}else _.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(_p.TRACK_ENDED)}renewMediaStreamTrack(t){var n=this;return C(function*(){const i=t||n._constraints,r=oo.searchDeviceIdByName(n._deviceName);if(r&&!i.deviceId&&(i.deviceId={exact:r}),n._enabled){const o=yield ro({video:i},n.getTrackId());n._constraints=i,yield n._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!0),n.updateMediaStreamTrackResolution()}})()}close(){super.close(),tt.off(Xn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),tt.off(Xn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this._encoderConfig;t&&(i=Rt(Rt({},i),wa(t))),i=yd(i);const r=gt(8,"track-cam-cloned-"),o=new gJ(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,yd(Rt(Rt({},this._config),{},{encoderConfig:i})),yd(this._constraints),yd(this._scalabilityMode),this._optimizationMode,r);return t&&i&&o.setEncoderConfiguration(i),_.debug("clone track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),o}bindProcessorContextEvents(){var t=this;this.processorContext.on(no.REQUEST_UPDATE_CONSTRAINTS,function(){var n=C(function*(i,r,o){try{const s=Object.assign({},t._originalConstraints,...i);yield t.renewMediaStreamTrack(s),r()}catch(s){o(s)}});return function(i,r,o){return n.apply(this,arguments)}}()),this.processorContext.on(no.REQUEST_CONSTRAINTS,function(){var n=C(function*(i){i(t._originMediaStreamTrack.getSettings())});return function(i){return n.apply(this,arguments)}}())}},Me(ao.prototype,"setDevice",[nY,iY],Object.getOwnPropertyDescriptor(ao.prototype,"setDevice"),ao.prototype),Me(ao.prototype,"setEnabled",[rY,oY,sY],Object.getOwnPropertyDescriptor(ao.prototype,"setEnabled"),ao.prototype),Me(ao.prototype,"setEncoderConfiguration",[aY,cY],Object.getOwnPropertyDescriptor(ao.prototype,"setEncoderConfiguration"),ao.prototype),Me(ao.prototype,"close",[lY],Object.getOwnPropertyDescriptor(ao.prototype,"close"),ao.prototype),ao);function FP(e,t,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=Rt(Rt({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?_.debug("[".concat(e,"] set content hint to"),n.optimizationMode):_.debug("[".concat(e,"] set content hint failed")))):_.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var dY,uY,hY,pY,Mo,fY,mY,gY,_Y,vY,EY,Fi;class bY extends RK{getUserId(){return this._userId}constructor(t,n,i,r){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(r.clientId,"_").concat(gt(5,""))),x(this,"_userId",void 0),x(this,"_uintId",void 0),x(this,"_isDestroyed",!1),x(this,"store",void 0),x(this,"processor",void 0),x(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=r}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,_.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Cp=(dY=le({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),uY=le({argsMap:e=>[e.getTrackId()]}),hY=le({argsMap:(e,t)=>[e.getTrackId(),t.name]}),pY=le({argsMap:e=>[e.getTrackId()]}),Me((Mo=class extends bY{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Li.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,i){super(e,t,n,i),x(this,"_videoVisibleTimer",null),x(this,"_previousVideoVisibleStatus",void 0),x(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),x(this,"trackMediaType",Ep.VIDEO),x(this,"_videoWidth",void 0),x(this,"_videoHeight",void 0),x(this,"_player",void 0),x(this,"processorDestination",void 0),x(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new VK(this.getTrackId(),"remote"),this.processorDestination=new UK(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return al(()=>{_.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Do(this,X.GET_STATS)||Rt({},wK)}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const i=document.getElementById(e);i?e=i:(_.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}_.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=Rt(Rt({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(this._player=e instanceof HTMLVideoElement?new kP(n):new Nq(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(vp.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=i=>{this.safeEmit(vp.VIDEO_STATE_CHANGED,i)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(vp.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},R("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,_.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){HK(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(gS)}_updatePlayerSource(){_.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),i={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:n?.parentElement},{element:r,slot:o}=i;if(this.isPlaying&&r instanceof HTMLVideoElement&&o instanceof HTMLElement){const s=J9.checkOneElementVisible(r),a=Object.assign({},s);if(a.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=a.visible;ne.reportApiInvoke(null,{tag:jt.TRACER,name:Cn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(a.visible?"Video is visible":"Invisible because of ".concat(a.reason))}return a}return}catch(n){throw new M(S.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new M(S.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){var e=this;this.processorDestination.on(Ji.ON_TRACK,function(){var t=C(function*(n){n?n!==e._mediaStreamTrack&&(e._mediaStreamTrack=n,e._updatePlayerSource()):e._mediaStreamTrack!==e._originMediaStreamTrack&&(e._mediaStreamTrack=e._originMediaStreamTrack,e._updatePlayerSource())});return function(n){return t.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ji.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Dd.SEI_RECEIVED,e)}}).prototype,"play",[dY],Object.getOwnPropertyDescriptor(Mo.prototype,"play"),Mo.prototype),Me(Mo.prototype,"stop",[uY],Object.getOwnPropertyDescriptor(Mo.prototype,"stop"),Mo.prototype),Me(Mo.prototype,"pipe",[hY],Object.getOwnPropertyDescriptor(Mo.prototype,"pipe"),Mo.prototype),Me(Mo.prototype,"unpipe",[pY],Object.getOwnPropertyDescriptor(Mo.prototype,"unpipe"),Mo.prototype),Mo),Tp=(fY=le({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),mY=le({argsMap:(e,t)=>[e.getTrackId(),t]}),gY=le({argsMap:e=>[e.getTrackId()]}),_Y=le({argsMap:e=>[e.getTrackId()]}),vY=le({argsMap:(e,t)=>[e.getTrackId(),t.name]}),EY=le({argsMap:e=>[e.getTrackId()]}),Me((Fi=class extends bY{get isPlaying(){return this._useAudioElement?ir.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,i){super(e,t,n,i),x(this,"trackMediaType",Ep.AUDIO),x(this,"_source",void 0),x(this,"_useAudioElement",!0),x(this,"_volume",100),x(this,"processorContext",void 0),x(this,"processorDestination",void 0),x(this,"_played",!1),x(this,"_bypassWebAudio",!1),R("DISABLE_WEBAUDIO")?(this._source=new MP,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new NK(e,!0),R("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(to.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(vp.FIRST_FRAME_DECODED)}),this.processorContext=new jK(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new BK(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(to.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(to.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(to.ON_AUDIO_BUFFER),this._source.on(to.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?ir.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}setPlaybackDevice(e){var t=this;return C(function*(){if(!t._useAudioElement||!yK())throw new M(S.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield ir.setSinkID(t.getTrackId(),e)})()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return al(()=>{_.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Do(this,X.GET_STATS)||Rt({},TK)}play(){_.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(_.debug("[".concat(this.getTrackId(),"] use audio element to play")),ir.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){_.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?ir.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];_.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ir.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new M(S.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new M(S.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new M(S.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){var e=this;this.processorDestination.on(Ji.ON_TRACK,function(){var t=C(function*(n){n?n!==e._mediaStreamTrack&&(e._mediaStreamTrack=n,e._updatePlayerSource(!1),e._source.processedNode=e._source.createMediaStreamSourceNode(n)):e._mediaStreamTrack!==e._originMediaStreamTrack&&(e._mediaStreamTrack=e._originMediaStreamTrack,e._updatePlayerSource())});return function(n){return t.apply(this,arguments)}}()),this.processorDestination.on(Ji.ON_NODE,t=>{this._source.processedNode=t;const n=!t;this._useAudioElement!==n&&(this._played?(this.stop(),this._useAudioElement=n,this.play()):this._useAudioElement=n)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ji.ON_TRACK),this.processorDestination.removeAllListeners(Ji.ON_NODE)}}).prototype,"setVolume",[fY],Object.getOwnPropertyDescriptor(Fi.prototype,"setVolume"),Fi.prototype),Me(Fi.prototype,"setPlaybackDevice",[mY],Object.getOwnPropertyDescriptor(Fi.prototype,"setPlaybackDevice"),Fi.prototype),Me(Fi.prototype,"play",[gY],Object.getOwnPropertyDescriptor(Fi.prototype,"play"),Fi.prototype),Me(Fi.prototype,"stop",[_Y],Object.getOwnPropertyDescriptor(Fi.prototype,"stop"),Fi.prototype),Me(Fi.prototype,"pipe",[vY],Object.getOwnPropertyDescriptor(Fi.prototype,"pipe"),Fi.prototype),Me(Fi.prototype,"unpipe",[EY],Object.getOwnPropertyDescriptor(Fi.prototype,"unpipe"),Fi.prototype),Fi);const fc=new class extends kt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),x(this,"_lastHiddenTime",0),x(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),_.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class yY extends kt{constructor(t,n){super(),x(this,"trackMediaType",Ep.DATA),x(this,"_version",1),x(this,"_type",3),x(this,"_config",void 0),x(this,"_originDataChannel",void 0),x(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),x(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),x(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return R("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return null!==(t=null===(n=this._originDataChannel)||void 0===n?void 0:n.readyState)&&void 0!==t?t:"connecting"}get _originDataChannelId(){var t,n;return null!==(t=null===(n=this._originDataChannel)||void 0===n?void 0:n.id)&&void 0!==t?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}_waitTillOpen(){var t=this;return C(function*(){return new q((n,i)=>{if(t._originDataChannel){"open"===t._originDataChannel.readyState&&n();const r=setTimeout(()=>{var o;i(new M(S.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(o=t._originDataChannel)||void 0===o?void 0:o.id)))},1e4);t._originDataChannel.onopen=()=>{clearTimeout(r),t._originDataChannel&&t._bandDataChannelEvents(t._originDataChannel),n()},t._originDataChannel.onerror=()=>{throw clearTimeout(r),new M(S.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new M(S.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})})()}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[US.OPEN,US.CLOSE,US.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),t.addEventListener(n,i)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,r]=n;t.removeEventListener(i,r)}),this._datachannelEventMap.clear()}}class kke extends yY{constructor(t){super(t),x(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),r=new DataView(i).getUint8(3);if(r!==this.id)return void(R("SHOW_DATASTREAM2_LOG")&&_.debug("invalid datachannel id: ".concat(r," !== ").concat(this.id)));let o=n.data.slice(this._dataStreamPacketHeader.byteLength);o=this._dataStreamPacketHandler.deserialize(o),this.emit(US.MESSAGE,o)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Lke extends yY{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function HS(){const e=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>bK.revokeObjectURL(e),0),new Worker(bK.createObjectURL(e))}const GS=new Map,WS=new Map;function Fke(e,t,n){let i=new Uint8Array(e,t,n),r=[],o=0;for(;r.length<n;)o+3<n&&0===i[o]&&0===i[o+1]&&3===i[o+2]&&(0===i[o+3]||1===i[o+3]||2===i[o+3]||3===i[o+3])?(r.push(i[o],i[o+1],i[o+3]),o+=4):(r.push(i[o]),o++);return new Uint8Array(r)}const zS=new Map;function UP(){return UP=C(function*(e,t){if(!Fe().supportWebRTCEncodedTransform)return void _.warning("browser not support video encoded transform");if(zS.has(e)||!e.track)return;const n={track:e.track};if(ol()){if(!e.createEncodedStreams)return void _.warning("browser not support createEncodedStreams() API");let r=null;try{r=e.createEncodedStreams()}catch(a){return void _.error("create video-encoded-streams error",a&&a.message)}let o=[];t.on("sei-to-send",a=>{o.push(a)});const s=new TransformStream({transform(a,c){n.controller||(n.controller=c),e.track&&e.track.id!==n.track.id&&(_.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const l=o.shift();l&&(a.data=function(d,u){const h=function(b){const T=b.length;let I=[],D=0;for(;D<T;)D+2<T&&0===b[D]&&0===b[D+1]&&(0===b[D+2]||1===b[D+2]||2===b[D+2]||3===b[D+2])?(I.push(b[D],b[D+1],3,b[D+2]),D+=3):(I.push(b[D]),D++);return new Uint8Array(I)}(u),p=h.length,m=Math.floor(p/255),f=p%255,g=new Uint8Array(6+m+1+p+d.byteLength);g[0]=0,g[1]=0,g[2]=0,g[3]=1,g[4]=6,g[5]=101;let E=0;for(;E<m;)g[6+E]=255,E++;return g[6+E]=f,E++,g.set(h,6+E),g.set(new Uint8Array(d),6+E+p),g.buffer}(a.data,l)),c.enqueue(a)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else{if(!ti())return;{if(typeof RTCRtpScriptTransform>"u")return void _.warning("browser not support RTCRtpScriptTransform");const r=HS(),o=new MessageChannel;yield new q(a=>r.onmessage=c=>{"registered"===c.data&&a(void 0)});const s=new RTCRtpScriptTransform(r,{name:"tx",port:o.port2},[o.port2]);e.transform=s,yield new q(a=>r.onmessage=c=>{"started"===c.data&&a(void 0)}),t.on("sei-to-send",a=>{o.port1.postMessage({sei:a})}),o.port1.onmessage=a=>{var c;a.data.transformed&&e.track&&(null===(c=e.track)||void 0===c?void 0:c.id)!==n.track.id&&(_.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i))},n.worker=r}}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const r=zS.get(e);if(r){zS.delete(e);try{var o,s;null===(o=r.controller)||void 0===o||o.terminate(),null===(s=r.worker)||void 0===s||s.terminate()}catch(a){_.warning(a&&a.message)}}}zS.set(e,n),e.track.addEventListener("ended",i)}),UP.apply(this,arguments)}const Kg=new Map;!function(){const e=xe();$n.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),$n.getStreamFromExtension=e.name===Ye.CHROME&&Number(e.version)>34,$n.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),$n.supportMinBitrate=e.name===Ye.CHROME||e.name===Ye.EDGE,$n.supportSetRtpSenderParameters=function(){const t=xe();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!sl()||!(!ti()&&!uS())||t.name===Ye.FIREFOX&&Number(t.version)>=64)}(),e.name===Ye.SAFARI&&($n.supportDualStream=Number(e.version)>=14),$n.webAudioMediaStreamDest=function(){const t=xe();return!(t.name===Ye.SAFARI&&Number(t.version)<12)}(),$n.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,$n.supportWebGL=typeof WebGLRenderingContext<"u",$n.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,sl()||($n.webAudioWithAEC=!0),$n.supportShareAudio=function(){const t=xe();return(t.os===kn.WIN_10||t.os===kn.WIN_81||t.os===kn.WIN_7||t.os===kn.LINUX||t.os===kn.MAC_OS||t.os===kn.CHROMIUM_OS)&&t.name===Ye.CHROME&&Number(t.version)>=74}(),$n.supportDataChannel=!!(EN(76)||function(t){const n=xe();return!(n.name!==Ye.FIREFOX||!n.osVersion)&&Number(n.version)>=68}()||H9(14)),$n.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!Bt()&&!!t&&t.prototype.setConfiguration instanceof Function}(),$n.supportWebRTCEncodedTransform=function(){const t=xe();return"Chrome"===t.name&&Number(t.version)>=86||"Safari"===t.name&&Number(t.version)>=15}(),$n.supportWebRTCInsertableStream=function(){const t=xe();return(t.name===Ye.CHROME||t.name===Ye.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),$n.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,$n.supportWebCrypto=typeof window<"u"&&void 0!==window.crypto&&void 0!==window.crypto.subtle,mS(()=>{$n.supportDualStreamEncoding=function(){const t=xe();return!!R("DISABLE_WEBAUDIO")||"Safari"===t.name&&Number(t.version)>=14||!!("Chrome"===t.name&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&R("CHROME_DUAL_STREAM_USE_ENCODING"))}(),_.info("browser compatibility",JSON.stringify($n),JSON.stringify(e))})}();class Pd extends kt{constructor(t,n){super(),y(this,"signal",void 0),y(this,"token",void 0),y(this,"tokenTimeout",void 0),y(this,"tokenInterval",void 0),y(this,"_sequence",0),y(this,"userMap",new Map),y(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const i=()=>{this.signal.connectionState===_t.CONNECTED&&this.check(),this.tokenInterval=0===this.userMap.size?window.setTimeout(i,1e3):window.setTimeout(i,3*R("P2P_TOKEN_INTERVAL"))};i()}send(t,n,i,r,o){var s=this;return C(function*(){var a,c,l;if(0===s.userMap.size)return;const d=Array.from(uc(a=s.userMap).call(a))[0].token;"string"!=typeof n&&(n=JSON.stringify(n)),r=null!==(c=r)&&void 0!==c?c:gt(6,""),o=null!==(l=o)&&void 0!==l?l:s._sequence++;const u={_id:r,_type:t,_seq:o,_message:n,token:"".concat(s.token,"_").concat(d)};R("SHOW_P2P_LOG")&&_.debug("send message",u,"noNeedResponse : ".concat(i)),s.splitMessage(JSON.stringify(u)).forEach(p=>{s.signal.request(pe.DATA_STREAM,{payload:cl(s.encoder.encode(p))})});const h=new q((p,m)=>{const f=window.setTimeout(()=>{s.off("res-@".concat(r,"_ack"),g),s.off("res-@".concat(r),b),s.off(op.ABORT,E),_.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(r)),m(new M(0===s.userMap.size?S.INVALID_REMOTE_USER:S.TIMEOUT))},R("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),g=()=>{f&&window.clearTimeout(f),s.off(op.ABORT,E),i&&p()},E=()=>{f&&window.clearTimeout(f),s.off("res-@".concat(r,"_ack"),g),s.off("res-@".concat(r),b),m(new M(S.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(r)))};s.once(op.ABORT,E),s.once("res-@".concat(r,"_ack"),g);const b=(I,D)=>{T=!0,f&&window.clearTimeout(f),s.off("res-@".concat(r,"_ack"),g),s.off(op.ABORT,E),"success"===I?p(D):m(new M(S.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(r)))};let T=!1;i||(s.once("res-@".concat(r),b),qn(R("SIGNAL_REQUEST_TIMEOUT")).then(()=>{T||_.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(r,", ").concat(u))}))});try{return yield h}catch(p){if(p.code===S.TIMEOUT)return yield s.send(t,n,i,r,o);throw p}})()}onMessage(t){var n;const{_uid:i}=t;let r,o=this.userMap.get(i);if(o)r=o.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Qt.CHECK)return;const{token:l}=t;r=new Map,o={uid:i,isStart:!0,token:l,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,o),this.signal.emit(Te.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in t&&"total"in t){var s;const{id:l,total:d}=t,u=null!==(s=r.get(l))&&void 0!==s?s:[];if(u.push(t),r.has(l)||r.set(l,u),u.length!==d)return;{const h=gg(u).call(u,(p,m)=>p.index-m.index).map(p=>p.payload).join("");r.delete(l),(t=JSON.parse(h))._uid=i}}const{_type:a,token:c}=t;if(Y(n=[Qt.ACK,Qt.CHECK]).call(n,a))return a===Qt.CHECK&&this.handleCheckToken(o,c),void this.receiveMessage(t);c==="".concat(o.token,"_").concat(this.token)?this.handleReceivedMessage(t):_.debug('Receive unexpected message", '.concat(c,", cur_token: ").concat(o.token,"_").concat(this.token),t)}check(){const t={_id:gt(6,""),token:this.token,_type:Qt.CHECK};R("SHOW_P2P_LOG")&&_.debug("send message",t),this.signal.request(pe.DATA_STREAM,{payload:cl(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:Qt.ACK,token:this.token};R("SHOW_P2P_LOG")&&_.debug("send message",n),this.signal.request(pe.DATA_STREAM,{payload:cl(this.encoder.encode(JSON.stringify(n)))})}response(t,n,i){this.send(Qt.RESPONSE,JSON.stringify({success:!i,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach(l=>{const{receivedMessagesMap:d,nextExpectedSequenceNumber:u}=l;for(;d.has(u);){const h=d.get(u);d.delete(u),this.receiveMessage(h),l.nextExpectedSequenceNumber++}})};if(!t)return void n();const{_uid:i,_seq:r}=t,o=this.userMap.get(i),{receivedMessagesMap:s,isStart:a,nextExpectedSequenceNumber:c}=o;if(r<c)return this.ack(t._id),void _.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(t._message));s.set(r,t),a&&r===c&&(this.receiveMessage(t),s.delete(c),o.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:i,_message:r,_uid:o}=t;if(R("SHOW_P2P_LOG")&&_.debug("receive message",t),n){let s;switch(t._type!==Qt.ACK&&(r&&(s=JSON.parse(r)),this.ack(t._id)),t._type){case Qt.CANDIDATE:case Qt.CONTROL:this.signal.emit(i,s,o);break;case Qt.PUBLISH:case Qt.UNPUBLISH:case Qt.RESTART_ICE:case Qt.CALL:s.uid=o,ii(this.signal,i,s).then(a=>{this.response(t._id,a)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Qt.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Qt.RESPONSE:{const{success:a,message:c}=s;this.emit("res-@".concat(n),a?"success":"failed",c);break}}}}splitMessage(t){if(t.length<Pd.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:i}=JSON.parse(t),r=gt(6,"");let o=0,s=800;const a=Math.ceil(t.length/s);for(;t.length>0;){o++;const c={id:r,index:o,total:a,payload:t.slice(0,s),token:"".concat(this.token,"_").concat(i)};JSON.stringify(c).length>Pd.MAX_MESSAGE_SIZE?s-=50:(n.push(c),t=t.slice(s))}return n.map(c=>JSON.stringify(c))}handleCheckToken(t,n){return t.token!==n?(_.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{_.debug("token timeout, ".concat(n)),this.reset(t.uid)},R("MAX_P2P_TIMEOUT")),!0)}handleUserOnline(){var t=this;return C(function*(){const n=yield ii(t.signal,Qt.CALL,void 0),i=yield t.send(Qt.CALL,n);t.signal.emit(he.P2P_CONNECTION,i,!0)})()}reset(t,n){var i=this;return C(function*(){const r=i.userMap.get(t);r&&(i.emit(op.ABORT),i.signal.emit(Te.ON_USER_OFFLINE,{uid:r.uid,reason:exe.P2P_TOKEN_CHANGED}),i._sequence=0,i.userMap.clear(),n||(_.debug("change local token from ".concat(n," to ").concat(n)),i.token=gt(6,"")))})()}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(op.ABORT)}}y(Pd,"MAX_SIZE",1),y(Pd,"MAX_MESSAGE_SIZE",1024);class SY extends kt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===_t.CONNECTED?this.emit(he.WS_CONNECTED):t===_t.RECONNECTING?this.emit(he.WS_RECONNECTING,this._websocketReconnectReason):t===_t.CLOSED&&this.emit(he.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),y(this,"_disconnectedReason",void 0),y(this,"_websocketReconnectReason",void 0),y(this,"_connectionState",_t.CLOSED),y(this,"reconnectToken",void 0),y(this,"p2pToken",void 0),y(this,"websocket",void 0),y(this,"openConnectionTime",void 0),y(this,"clientId",void 0),y(this,"lastMsgTime",Date.now()),y(this,"uploadCache",[]),y(this,"uploadCacheInterval",void 0),y(this,"rttRolling",new p7(5)),y(this,"pingpongTimer",void 0),y(this,"pingpongTimeoutCount",0),y(this,"joinResponse",void 0),y(this,"multiIpOption",void 0),y(this,"initError",void 0),y(this,"spec",void 0),y(this,"store",void 0),y(this,"_external_signal",void 0),y(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(he.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const o="res-@".concat(r._id);this.emit(o,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){switch(r._type){case Te.ON_DATA_STREAM:return void this.handleDataStream(r._message);case Te.MUTE_AUDIO:case Te.MUTE_VIDEO:case Te.ON_P2P_LOST:case Te.ON_USER_ONLINE:return;case Te.ON_USER_OFFLINE:const{uid:o}=r._message;return _.debug("[".concat(this.clientId,"] user-offline uid: ").concat(o)),void this._external_signal.reset(o)}if(this.emit(r._type,r._message),r._type===Te.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===Te.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(Qe.UID_BANNED);break;case 15:this.close(Qe.IP_BANNED);break;case 16:this.close(Qe.CHANNEL_BANNED)}if(r._type===Te.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case ce.ERR_LICENSE_MISSING:this.close(Qe.LICENSE_MISSING);break;case ce.ERR_LICENSE_EXPIRED:this.close(Qe.LICENSE_EXPIRED);break;case ce.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Qe.LICENSE_MINUTES_EXCEEDED);break;case ce.ERR_LICENSE_PERIOD_INVALID:this.close(Qe.LICENSE_PERIOD_INVALID);break;case ce.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Qe.LICENSE_MULTIPLE_SDK_SERVICE);break;case ce.ERR_LICENSE_ILLEGAL:this.close(Qe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new qN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,R("JOIN_GATEWAY_USE_DUAL_DOMAIN"),R("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===_t.CONNECTED&&this.reconnect("retry",ni.OFFLINE)}),this.p2pToken=gt(6,""),this._external_signal=new Pd(this,this.p2pToken)}request(t,n,i,r){var o=this;return C(function*(){const s=gt(6,""),a={_id:s,_type:t,_message:n},c=o.websocket.connectionID,l=()=>new q((f,g)=>{if(o.connectionState===_t.CONNECTED)return f();const E=()=>{o.off(he.WS_CLOSED,b),f()},b=()=>{o.off(he.WS_CONNECTED,E),g(new M(S.WS_ABORT))};o.once(he.WS_CONNECTED,E),o.once(he.WS_CLOSED,b)});if(o.connectionState!==_t.CONNECTING&&o.connectionState!==_t.RECONNECTING||t===pe.JOIN||t===pe.REJOIN||(yield l()),o.websocket.sendMessage(a,!0),r)return;const d=new q((f,g)=>{let E=!1;const b=(I,D)=>{E=!0,f({isSuccess:"success"===I,message:D||{}}),o.off(he.WS_CLOSED,T),o.off(he.WS_RECONNECTING,T),o.emit(he.REQUEST_SUCCESS,t,n)};o.once("res-@".concat(s),b);const T=()=>{g(new M(S.WS_ABORT,"type: ".concat(t))),o.off(he.WS_CLOSED,T),o.off(he.WS_RECONNECTING,T),o.off("res-@".concat(s),b)};o.once(he.WS_CLOSED,T),o.once(he.WS_RECONNECTING,T),qn(R("SIGNAL_REQUEST_TIMEOUT")).then(()=>{o.websocket.connectionID!==c||E||(_.warning("[".concat(o.clientId,"] ws request timeout, type: ").concat(t)),o.emit(he.REQUEST_TIMEOUT,t,n))})});let u=null;try{u=yield d}catch(f){if(o.connectionState===_t.CLOSED||t===pe.LEAVE)throw new M(S.WS_ABORT);return!o.spec.forceWaitGatewayResponse||i?f.throw():t===pe.JOIN||t===pe.REJOIN?null:(yield l(),yield o.request(t,n))}if(u.isSuccess)return u.message;const h=Number(u.message.error_code||u.message.code),p=Fg(h),m=new M(S.UNEXPECTED_RESPONSE,"".concat(p.desc,": ").concat(u.message.error_str),{code:h,data:u.message,desc:p.desc});return"success"===p.action?u.message:(_.warning("[".concat(o.clientId,"] [").concat(o.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(h,", message: ").concat(p.desc,", action: ").concat(p.action)),h===ce.ERR_TOO_MANY_BROADCASTERS?((t===pe.JOIN||t===pe.REJOIN)&&(o.initError=m,o.close()),m.throw()):"failed"===p.action?m.throw():"quit"===p.action?(o.initError=m,o.close(),m.throw()):(h===ce.ERR_JOIN_BY_MULTI_IP?(o.multiIpOption=u.message.option,_.warning("[".concat(o.clientId,"] detect multi ip, recover")),o.reconnect("recover",ni.MULTI_IP)):o.reconnect(p.action,ni.SERVER_ERROR),t===pe.JOIN||t===pe.REJOIN?null:yield o.request(t,n)))})()}waitMessage(t,n){return new q(i=>{const r=o=>{(!n||n(o))&&(this.off(t,r),i(o))};this.on(t,r)})}uploadWRTCStats(t){if(!this.store.sessionId)return void _.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Lg.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const o=R("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==_t.CONNECTED)return;const s=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(s._type,s._message)},R("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){this.websocket.sendMessage({_type:t,_message:n})}sendExtensionMessage(t,n,i){var r=this;return C(function*(){return yield r._external_signal.send(t,n,i)})()}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new q((n,i)=>{this.once(he.WS_CONNECTED,()=>n(this.joinResponse)),this.once(he.WS_CLOSED,()=>i(this.initError||new M(S.WS_ABORT))),this.connectionState=_t.CONNECTING,this.websocket.init(t).catch(i)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Qe.LEAVE,this.connectionState=_t.CLOSED,_.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=gt(6,""),this._external_signal.clear(),this._external_signal=new Pd(this,this.p2pToken)}join(){var t=this;return C(function*(){if(!t.joinResponse){t.emit(he.ABORT_P2P_EXECUTION);const n=yield ii(t,he.REQUEST_JOIN_INFO),i=yield t.request(pe.JOIN,n);if(!i)return t.emit(he.REPORT_JOIN_GATEWAY,S.TIMEOUT,t.url||""),!1;t.joinResponse=i,t.emit(he.JOIN_RESPONSE,t.joinResponse),t.reconnectToken=t.joinResponse.rejoin_token}return t.connectionState=_t.CONNECTED,t.pingpongTimer&&window.clearInterval(t.pingpongTimer),t.pingpongTimer=window.setInterval(t.handlePingPong.bind(t),3e3),!0})()}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleDataStream(t){try{var n;const i=Sd(t.payload),r=(new TextDecoder).decode(i),o=JSON.parse(r);"total"in o&&"id"in o||Y(n=Object.values(Qt)).call(n,o._type)?(o._uid=t.uid,this._external_signal.onMessage(o)):this.emit(Te.ON_DATA_STREAM,t)}catch{this.emit(Te.ON_DATA_STREAM,t)}}handleNotification(t){_.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Fg(t.code);if("success"!==n.action){if("failed"!==n.action)return"quit"===n.action?("ERR_REPEAT_JOIN_CHANNEL"===n.desc&&this.close(Qe.UID_BANNED),void this.close()):void this.reconnect(n.action,ni.SERVER_ERROR);_.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=R("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(_.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>R("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ni.TIMEOUT):this.request(pe.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),R("REPORT_STATS")&&this.send(pe.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(fe.RECONNECT_WAITTING_FINISH,t=>{this.emit(he.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(fe.RECONNECT_CREATE_CONNECTION,t=>{this.emit(he.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(fe.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(fe.CLOSED,()=>{this.connectionState=_t.CLOSED}),this.websocket.on(fe.FAILED,()=>{this._disconnectedReason=Qe.NETWORK_ERROR,this.connectionState=_t.CLOSED}),this.websocket.on(fe.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState=this.connectionState===_t.CONNECTED?_t.RECONNECTING:_t.CONNECTING}),this.websocket.on(fe.WILL_RECONNECT,(t,n,i)=>{"retry"!==t?(_.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):_.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(t)}),this.websocket.on(fe.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(he.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof M&&t.code===S.UNEXPECTED_RESPONSE&&t.data.code===ce.ERR_NO_AUTHORIZED)return _.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ni.SERVER_ERROR);_.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ni.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(fe.REQUEST_NEW_URLS,(t,n)=>{ii(this,he.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(fe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Te.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var CY={exports:{}};CY.exports=(()=>{var e={8:(i,r,o)=>{o.r(r),o.d(r,{Parser:()=>V,Printer:()=>Dt,parse:()=>F,print:()=>G});const s="\n",a="".concat("\r").concat(s),c=" ";let l;function d(U){return U>="0"&&U<="9"}function u(U){return U>="!"&&U<="~"}function h(U){return u(U)||U>="\x80"&&U<="\xff"}function p(U){return"!"===U||U>="#"&&U<="'"||U>="*"&&U<="+"||U>="-"&&U<="."||U>="0"&&U<="9"||U>="A"&&U<="Z"||U>="^"&&U<="~"}function m(U){return U>="1"&&U<="9"}function f(U){return U>="A"&&U<="Z"||U>="a"&&U<="z"}function g(U){return"d"===U||"h"===U||"m"===U||"s"===U}function E(U){return U>"\x01"&&U<"\t"||U>"\v"&&U<"\f"||U>"\x0e"&&U<"\xff"}function b(U){return f(U)||d(U)||"+"===U||"/"===U}function T(U){return d(U)||f(U)||"+"===U||"/"===U||"-"===U||"_"===U}function I(U){return f(U)||d(U)||"+"===U||"/"===U}function D(U,v){var w=Object.keys(U);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(U);v&&(A=A.filter(function(B){return Object.getOwnPropertyDescriptor(U,B).enumerable})),w.push.apply(w,A)}return w}function O(U){for(var v=1;v<arguments.length;v++){var w=null!=arguments[v]?arguments[v]:{};v%2?D(Object(w),!0).forEach(function(A){k(U,A,w[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(U,Object.getOwnPropertyDescriptors(w)):D(Object(w)).forEach(function(A){Object.defineProperty(U,A,Object.getOwnPropertyDescriptor(w,A))})}return U}function k(U,v,w){return v in U?Object.defineProperty(U,v,{value:w,enumerable:!0,configurable:!0,writable:!0}):U[v]=w,U}var U;(U=l||(l={})).VERSION="v",U.ORIGIN="o",U.SESSION_NAME="s",U.INFORMATION="i",U.URI="u",U.EMAIL="e",U.PHONE="p",U.CONNECTION="c",U.BANDWIDTH="b",U.TIME="t",U.REPEAT="r",U.ZONE_ADJUSTMENTS="z",U.KEY="k",U.ATTRIBUTE="a",U.MEDIA="m";class L{consumeText(v,w){let A=w;for(;A<v.length;){const B=v[A];if("\0"===B||"\r"===B||B===s)break;A+=1}if(A-w==0)throw new Error("Invalid text, at ".concat(v));return A}consumeUnicastAddress(v,w,A){return this.consumeTill(v,w,c)}consumeOneOrMore(v,w,A){let B=w;for(;A(v[B]);)B++;if(B-w==0)throw new Error("Invalid rule at ".concat(w,"."));return B}consumeSpace(v,w){if(v[w]===c)return w+1;throw new Error("Invalid space at ".concat(w,"."))}consumeIP4Address(v,w){let A=w;for(let B=0;B<4;B++)if(A=this.consumeDecimalUChar(v,A),3!==B){if("."!==v[A])throw new Error("Invalid IP4 address.");A++}return A}consumeDecimalUChar(v,w){let A=w;for(let ge=0;ge<3&&d(v[A]);ge++,A++);if(A-w==0)throw new Error("Invalid decimal uchar.");const B=parseInt(v.slice(w,A));if(B>=0&&B<=255)return A;throw new Error("Invalid decimal uchar")}consumeIP6Address(v,w){let A=this.consumeHexpart(v,w);return":"===v[A]&&(A+=1,A=this.consumeIP4Address(v,A)),A}consumeHexpart(v,w){let A=w;if(":"===v[A]&&":"===v[A+1]){A+=2;try{A=this.consumeHexseq(v,A)}catch{}return A}if(A=this.consumeHexseq(v,A),":"===v[A]&&":"===v[A+1]){A+=2;try{A=this.consumeHexseq(v,A)}catch{}return A}return A}consumeHexseq(v,w){let A=w;for(;A=this.consumeHex4(v,A),":"===v[A]&&":"!==v[A+1];)A+=1;return A}consumeHex4(v,w){let A=0;for(;A<4;A++)if(!((B=v[w+A])>="0"&&B<="9"||B>="a"&&B<="f"||B>="A"&&B<="F")){if(0===A)throw new Error("Invalid hex 4");break}var B;return w+A}consumeFQDN(v,w){let A=w;for(;d(v[A])||f(v[A])||"-"===v[A]||"."===v[A];)A+=1;if(A-w<4)throw new Error("Invalid FQDN");return A}consumeExtnAddr(v,w){return this.consumeOneOrMore(v,w,h)}consumeMulticastAddress(v,w,A){switch(A){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(v,w);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(v,w);default:try{return this.consumeFQDN(v,w)}catch{return this.consumeExtnAddr(v,w)}}}consumeIP6MulticastAddress(v,w){const A=this.consumeHexpart(v,w);return"/"===v[A]?this.consumeInteger(v,A+1):A}consumeIP4MulticastAddress(v,w){let A=w+3;const B=v.slice(w,A),ge=parseInt(B);if(ge<224||ge>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Ze=0;Ze<3;Ze++){if("."!==v[A])throw new Error("Invalid IP4 multicast address.");A+=1,A=this.consumeDecimalUChar(v,A)}return"/"===v[A]&&(A+=1),A=this.consumeTTL(v,A),"/"===v[A]&&(A=this.consumeInteger(v,A)),A}consumeInteger(v,w){if(!m(v[w]))throw new Error("Invalid integer.");for(w+=1;d(v[w]);)w+=1;return w}consumeTTL(v,w){if("0"===v[w])return w+1;if(!m(v[w]))throw new Error("Invalid TTL.");w+=1;for(let A=0;A<2&&d(v[w]);A++)w+=1;return w}consumeToken(v,w){return this.consumeOneOrMore(v,w,p)}consumeTime(v,w){let A=w;if("0"===v[A])return A+1;for(m(v[A])&&(A+=1);d(v[A]);)A++;if(A-w<10)throw new Error("Invalid time");return A}consumeAddress(v,w){return this.consumeTill(v,w,c)}consumeTypedTime(v,w){let A=w;return A=this.consumeOneOrMore(v,A,d),g(v[A])?A+1:A}consumeRepeatInterval(v,w){if(!m(v[w]))throw new Error("Invalid repeat interval");for(w+=1;d(v[w]);)w+=1;return g(v[w])&&(w+=1),w}consumePort(v,w){return this.consumeOneOrMore(v,w,d)}consume(v,w,A){for(let B=0;B<A.length;B++){if(w+B>=v.length)throw new Error("consume exceeding value length");if(v[w+B]!==A[B])throw new Error("consume ".concat(A," failed at ").concat(B))}return w+A.length}consumeTill(v,w,A){let B=w;for(;B<v.length&&("string"!=typeof A||v[B]!==A)&&("function"!=typeof A||!A(v[B]));)B++;return B}}class V extends L{constructor(){super(),k(this,"records",[]),k(this,"currentLine",0)}parse(v){const w=this.probeEOL(v);this.records=v.split(w).filter(bn=>!!ki(bn).call(bn)).map(this.parseLine),this.currentLine=0;const A=this.parseVersion(),B=this.parseOrigin(),ge=this.parseSessionName(),Ze=this.parseInformation(),nt=this.parseUri(),Hn=this.parseEmail(),ai=this.parsePhone(),yc=this.parseConnection(),Rl=this.parseBandWidth(),Uo=this.parseTimeFields(),Al=this.parseKey(),Bp=this.parseSessionAttribute(),tn=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:A,origin:B,sessionName:ge,information:Ze,uri:nt,emails:Hn,phones:ai,connection:yc,bandwidths:Rl,timeFields:Uo,key:Al,attributes:Bp,mediaDescriptions:tn}}getCurrentRecord(){const v=this.records[this.currentLine];if(!v)throw new Error("Record doesn't exit.");return v}probeEOL(v){for(let w=0;w<v.length;w++)if(v[w]===s)return"\r"===v[w-1]?a:s;throw new Error("Invalid newline character.")}parseLine(v,w){if(v.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const A=v[0];if("="!==v[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:A,value:v.slice(2),line:w,cur:0}}parseSessionAttribute(){const v=new oe;for(;this.currentLine<this.records.length;){const w=this.getCurrentRecord();if(w.type!==l.ATTRIBUTE)break;const A={attField:this.extractOneOrMore(w,B=>p(B)&&":"!==B),_cur:0};":"===w.value[w.cur]&&(w.cur+=1,A.attValue=this.extractOneOrMore(w,E)),v.parse(A),this.currentLine++}return v.digest()}parseMediaAttributes(v){const w=new Ie(v);for(;this.currentLine<this.records.length;){const A=this.getCurrentRecord();if(A.type!==l.ATTRIBUTE)break;const B={attField:this.extractOneOrMore(A,ge=>p(ge)&&":"!==ge),_cur:0};":"===A.value[A.cur]&&(A.cur+=1,B.attValue=this.extractOneOrMore(A,E)),w.parse(B),this.currentLine++}return w.digest()}parseKey(){const v=this.getCurrentRecord();if(v.type===l.KEY){if("prompt"===v.value||"clear:"===v.value||"base64:"===v.value||"uri:"===v.value)return v.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const v=this.getCurrentRecord();if(v.type===l.ZONE_ADJUSTMENTS){const w=[];for(;;)try{const A=this.extract(v,this.consumeTime);this.consumeSpaceForRecord(v);let B=!1;"-"===v.value[v.cur]&&(B=!0,v.cur+=1);const ge=this.extract(v,this.consumeTypedTime);w.push({time:A,typedTime:ge,back:B})}catch{break}if(0===w.length)throw new Error("Invalid zone adjustments");return this.currentLine++,w}return[]}parseRepeat(){const v=[];for(;;){const w=this.getCurrentRecord();if(w.type!==l.REPEAT)break;{const A=this.extract(w,this.consumeRepeatInterval),B=this.parseTypedTime(w);v.push({repeatInterval:A,typedTimes:B}),this.currentLine++}}return v}parseTypedTime(v){const w=[];for(;;)try{this.consumeSpaceForRecord(v),w.push(this.extract(v,this.consumeTypedTime))}catch{break}if(0===w.length)throw new Error("Invalid typed time.");return w}parseTime(){const v=this.getCurrentRecord(),w=this.extract(v,this.consumeTime);this.consumeSpaceForRecord(v);const A=this.extract(v,this.consumeTime);return this.currentLine++,{startTime:w,stopTime:A}}parseBandWidth(){const v=[];for(;this.currentLine<this.records.length;){const w=this.getCurrentRecord();if(w.type!==l.BANDWIDTH)break;{const A=this.extractOneOrMore(w,p);if(":"!==w.value[w.cur])throw new Error("Invalid bandwidth field.");w.cur++;const B=this.extractOneOrMore(w,d);v.push({bwtype:A,bandwidth:B}),this.currentLine++}}return v}parseVersion(){const v=this.getCurrentRecord();if(v.type!==l.VERSION)throw new Error("first sdp record must be version");const w=v.value.slice(0,this.consumeOneOrMore(v.value,0,d));if(w.length!==v.value.length)throw new Error('invalid proto version, "v='.concat(v.value,'"'));return this.currentLine++,w}parseOrigin(){const v=this.getCurrentRecord();if(v.type!==l.ORIGIN)throw new Error("second line of sdp must be origin");const w=this.extractOneOrMore(v,h);this.consumeSpaceForRecord(v);const A=this.extractOneOrMore(v,d);this.consumeSpaceForRecord(v);const B=this.extractOneOrMore(v,d);this.consumeSpaceForRecord(v);const ge=this.extractOneOrMore(v,p);this.consumeSpaceForRecord(v);const Ze=this.extractOneOrMore(v,p);this.consumeSpaceForRecord(v);const nt=this.extract(v,this.consumeUnicastAddress);return this.currentLine++,{username:w,sessId:A,sessVersion:B,nettype:ge,addrtype:Ze,unicastAddress:nt}}parseSessionName(){const v=this.getCurrentRecord();if(v.type===l.SESSION_NAME){const w=this.extract(v,this.consumeText);return this.currentLine++,w}}parseInformation(){const v=this.getCurrentRecord();if(v.type!==l.INFORMATION)return;const w=this.extract(v,this.consumeText);return this.currentLine++,w}parseUri(){const v=this.getCurrentRecord();if(v.type===l.URI)return this.currentLine++,v.value}parseEmail(){const v=[];for(;;){const w=this.getCurrentRecord();if(w.type!==l.EMAIL)break;v.push(w.value),this.currentLine++}return v}parsePhone(){const v=[];for(;;){const w=this.getCurrentRecord();if(w.type!==l.PHONE)break;v.push(w.value),this.currentLine++}return v}parseConnection(){const v=this.getCurrentRecord();if(v.type===l.CONNECTION){const w=this.extractOneOrMore(v,p);this.consumeSpaceForRecord(v);const A=this.extractOneOrMore(v,p);this.consumeSpaceForRecord(v);const B=this.extract(v,this.consumeAddress);return this.currentLine++,{nettype:w,addrtype:A,address:B}}}parseMedia(){const v=this.getCurrentRecord(),w=this.extract(v,this.consumeToken);this.consumeSpaceForRecord(v);let A=this.extract(v,this.consumePort);"/"===v.value[v.cur]&&(v.cur+=1,A+=this.extract(v,this.consumeInteger)),this.consumeSpaceForRecord(v);const B=[];for(B.push(this.extract(v,this.consumeToken));"/"===v.value[v.cur];)v.cur+=1,B.push(this.extract(v,this.consumeToken));if(0===B.length)throw new Error("Invalid proto");const ge=this.parseFmt(v);return this.currentLine++,{mediaType:w,port:A,protos:B,fmts:ge}}parseTimeFields(){const v=[];for(;this.getCurrentRecord().type===l.TIME;){const w=this.parseTime(),A=this.parseRepeat(),B=this.parseZone();v.push({time:w,repeats:A,zones:B})}return v}parseMediaDescription(){const v=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===l.MEDIA;){const w=this.parseMedia(),A=this.parseInformation(),B=this.parseConnections(),ge=this.parseBandWidth(),Ze=this.parseKey(),nt=this.parseMediaAttributes(w);v.push({media:w,information:A,connections:B,bandwidths:ge,key:Ze,attributes:nt})}return v}parseConnections(){const v=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===l.CONNECTION;)v.push(this.parseConnection());return v}parseFmt(v){const w=[];for(;;)try{this.consumeSpaceForRecord(v),w.push(this.extract(v,this.consumeToken))}catch{break}if(0===w.length)throw new Error("Invalid fmts");return w}extract(v,w){for(var A=arguments.length,B=new Array(A>2?A-2:0),ge=2;ge<A;ge++)B[ge-2]=arguments[ge];const Ze=w.call(this,v.value,v.cur,...B),nt=v.value.slice(v.cur,Ze);return v.cur=Ze,nt}extractOneOrMore(v,w){const A=this.consumeOneOrMore(v.value,v.cur,w),B=v.value.slice(v.cur,A);return v.cur=A,B}consumeSpaceForRecord(v){if(v.value[v.cur]!==c)throw new Error("Invalid space at ".concat(v.cur,"."));v.cur+=1}}class ee extends L{constructor(){super(...arguments),k(this,"attributes",void 0),k(this,"digested",!1)}extractOneOrMore(v,w,A){const B=this.consumeOneOrMore(v.attValue,v._cur,w),ge=v.attValue.slice(v._cur,B),[Ze,nt]=A||[];if("number"==typeof Ze&&ge.length<Ze)throw new Error("error in length, should be more or equal than ".concat(Ze," characters."));if("number"==typeof nt&&ge.length>nt)throw new Error("error in length, should be less or equal than ".concat(nt," characters."));return v._cur=B,ge}consumeAttributeSpace(v){if(v.attValue[v._cur]!==c)throw new Error("Invalid space at ".concat(v._cur,"."));v._cur+=1}extract(v,w){if(!v.attValue)throw new Error("Nothing to extract from attValue.");for(var A=arguments.length,B=new Array(A>2?A-2:0),ge=2;ge<A;ge++)B[ge-2]=arguments[ge];const Ze=w.call(this,v.attValue,v._cur,...B),nt=v.attValue.slice(v._cur,Ze);return v._cur=Ze,nt}atEnd(v){if(!v.attValue)throw new Error;return v._cur>=v.attValue.length}peekChar(v){if(!v.attValue)throw new Error;return v.attValue[v._cur]}peek(v,w){if(!v.attValue)throw new Error;for(let A=0;A<w.length;A++)if(w[A]!==v.attValue[v._cur+A])return!1;return!0}parseIceUfrag(v){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(v,b,[4,256])}parseIcePwd(v){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(v,b,[22,256])}parseIceOptions(v){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const w=[];for(;!this.atEnd(v);){w.push(this.extractOneOrMore(v,b));try{this.consumeAttributeSpace(v)}catch(A){if(this.atEnd(v))break;throw A}}this.attributes.iceOptions=w}parseFingerprint(v){const w=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const A=this.extract(v,this.consumeTill);this.attributes.fingerprints.push({hashFunction:w,fingerprint:A})}parseExtmap(v){const w=this.extractOneOrMore(v,d);let A;"/"===this.peekChar(v)&&(this.extract(v,this.consume,"/"),A=this.extract(v,this.consumeToken)),this.consumeAttributeSpace(v);const B=this.extract(v,this.consumeTill,c),ge=O(O({entry:parseInt(w,10)},A&&{direction:A}),{},{extensionName:B});this.peekChar(v)===c&&(this.consumeAttributeSpace(v),ge.extensionAttributes=this.extract(v,this.consumeTill)),this.attributes.extmaps.push(ge)}parseSetup(v){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const w=this.extract(v,this.consumeTill);if("active"!==w&&"passive"!==w&&"actpass"!==w&&"holdconn"!==w)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=w}}class oe extends ee{constructor(){super(...arguments),k(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(v){if(this.digested)throw new Error("already digested");try{switch(v.attField){case"group":this.parseGroup(v);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(v);break;case"ice-pwd":this.parseIcePwd(v);break;case"ice-options":this.parseIceOptions(v);break;case"fingerprint":this.parseFingerprint(v);break;case"setup":this.parseSetup(v);break;case"tls-id":this.parseTlsId(v);break;case"identity":this.parseIdentity(v);break;case"extmap":this.parseExtmap(v);break;case"msid-semantic":this.parseMsidSemantic(v);break;default:v.ignored=!0,this.attributes.unrecognized.push(v)}}catch(w){throw console.error("parsing session attribute ".concat(v.attField,' error, "a=').concat(v.attField,":").concat(v.attValue,'"')),w}if(!v.ignored&&v.attValue&&!this.atEnd(v))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(v){const w=this.extract(v,this.consumeToken),A=[];for(;!this.atEnd(v)&&this.peekChar(v)===c;)this.consumeAttributeSpace(v),A.push(this.extract(v,this.consumeToken));this.attributes.groups.push({semantic:w,identificationTag:A})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(v){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(v,T)}parseIdentity(v){const w=this.extractOneOrMore(v,I),A=[];for(;!this.atEnd(v)&&this.peekChar(v)===c;){this.consumeAttributeSpace(v);const B=this.extract(v,this.consumeToken);this.extract(v,this.consume,"=");const ge=this.extractOneOrMore(v,Ze=>Ze!==c&&E(Ze));A.push({name:B,value:ge})}this.attributes.identities.push({assertionValue:w,extensions:A})}parseMsidSemantic(v){this.peekChar(v)===c&&this.consumeAttributeSpace(v);const w={semantic:this.extract(v,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(v)}catch{break}if("*"===this.peekChar(v)){this.extract(v,this.consume,"*"),w.applyForAll=!0;break}{const A=this.extract(v,this.consumeTill,c);w.identifierList.push(A)}}this.attributes.msidSemantic=w}}class Ie extends ee{constructor(v){super(),k(this,"attributes",void 0),-1!==v.protos.indexOf("RTP")||v.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(v){if(this.digested)throw new Error("already digested");try{switch(v.attField){case"extmap":this.parseExtmap(v);break;case"setup":this.parseSetup(v);break;case"ice-ufrag":this.parseIceUfrag(v);break;case"ice-pwd":this.parseIcePwd(v);break;case"ice-options":this.parseIceOptions(v);break;case"candidate":this.parseCandidate(v);break;case"remote-candidate":this.parseRemoteCandidate(v);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(v);break;case"rtpmap":this.parseRtpmap(v);break;case"ptime":this.parsePtime(v);break;case"maxptime":this.parseMaxPtime(v);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(v);break;case"ssrc":this.parseSSRC(v);break;case"fmtp":this.parseFmtp(v);break;case"rtcp-fb":this.parseRtcpFb(v);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(v);break;case"mid":this.parseMid(v);break;case"msid":this.parseMsid(v);break;case"imageattr":this.parseImageAttr(v);break;case"rid":this.parseRid(v);break;case"simulcast":this.parseSimulcast(v);break;case"sctp-port":this.parseSctpPort(v);break;case"max-message-size":this.parseMaxMessageSize(v);break;case"ssrc-group":this.parseSSRCGroup(v);break;default:v.ignored=!0,this.attributes.unrecognized.push(v)}}catch(w){throw console.error("parsing media attribute ".concat(v.attField,' error, "a=').concat(v.attField,":").concat(v.attValue,'"')),w}if(!v.ignored&&v.attValue&&!this.atEnd(v))throw new Error("attribute parsing error")}parseCandidate(v){const w=this.extractOneOrMore(v,b,[1,32]);this.consumeAttributeSpace(v);const A=this.extractOneOrMore(v,d,[1,5]);this.consumeAttributeSpace(v);const B=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const ge=this.extractOneOrMore(v,d,[1,10]);this.consumeAttributeSpace(v);const Ze=this.extract(v,this.consumeAddress);this.consumeAttributeSpace(v);const nt=this.extract(v,this.consumePort);this.consumeAttributeSpace(v),this.extract(v,this.consume,"typ"),this.consumeAttributeSpace(v);const Hn={foundation:w,componentId:A,transport:B,priority:ge,connectionAddress:Ze,port:nt,type:this.extract(v,this.consumeToken),extension:{}};for(this.peek(v," raddr")&&(this.extract(v,this.consume," raddr"),this.consumeAttributeSpace(v),Hn.relAddr=this.extract(v,this.consumeAddress)),this.peek(v," rport")&&(this.extract(v,this.consume," rport"),this.consumeAttributeSpace(v),Hn.relPort=this.extract(v,this.consumePort));this.peekChar(v)===c;){this.consumeAttributeSpace(v);const ai=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v),Hn.extension[ai]=this.extractOneOrMore(v,u)}this.attributes.candidates.push(Hn)}parseRemoteCandidate(v){const w=[];for(;;){const A=this.extractOneOrMore(v,d,[1,5]);this.consumeAttributeSpace(v);const B=this.extract(v,this.consumeAddress);this.consumeAttributeSpace(v);const ge=this.extract(v,this.consumePort);w.push({componentId:A,connectionAddress:B,port:ge});try{this.consumeAttributeSpace(v)}catch{break}}this.attributes.remoteCandidatesList.push(w)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(v){const w=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const A=this.extract(v,this.consumeTill,"/");this.extract(v,this.consume,"/");const B={encodingName:A,clockRate:this.extractOneOrMore(v,d)};this.atEnd(v)||"/"!==this.peekChar(v)||(this.extract(v,this.consume,"/"),B.encodingParameters=parseInt(this.extract(v,this.consumeTill),10));const ge=this.attributes.payloads.find(Ze=>Ze.payloadType===parseInt(w,10));ge?ge.rtpMap=B:this.attributes.payloads.push({payloadType:parseInt(w,10),rtpMap:B,rtcpFeedbacks:[]})}parsePtime(v){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(v,this.consumeTill)}parseMaxPtime(v){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(v,this.consumeTill)}parseDirection(v){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=v.attField}parseSSRC(v){const w=this.extractOneOrMore(v,d);this.consumeAttributeSpace(v);const A=this.extract(v,this.consumeTill,":");let B;":"===this.peekChar(v)&&(this.extract(v,this.consume,":"),B=this.extract(v,this.consumeTill));const ge=this.attributes.ssrcs.find(Ze=>Ze.ssrcId===parseInt(w,10));ge?ge.attributes[A]=B:this.attributes.ssrcs.push({ssrcId:parseInt(w,10),attributes:{[A]:B}})}parseFmtp(v){const w=this.extract(v,this.consumeTill,c);this.consumeAttributeSpace(v);const A=this.extract(v,this.consumeTill),B={};A.split(";").forEach(Ze=>{let[nt,Hn]=Ze.split("=");nt=ki(nt).call(nt);const ai="string"==typeof Hn?ki(Hn).call(Hn):null;"string"==typeof nt&&nt.length>0&&(B[nt]=ai)});const ge=this.attributes.payloads.find(Ze=>Ze.payloadType===parseInt(w,10));ge?ge.fmtp={parameters:B}:this.attributes.payloads.push({payloadType:parseInt(w,10),rtcpFeedbacks:[],fmtp:{parameters:B}})}parseFmtParameters(v){const w={},A=this.extract(v,this.consumeTill,"=");v._cur++;const B=this.extract(v,this.consumeTill,";");for(w[A]=B;";"===v.attValue[v._cur];){const ge=this.extract(v,this.consumeTill,"=");v._cur++;const Ze=this.extract(v,this.consumeTill,";");w[ge]=Ze}return w}parseRtcpFb(v){let w="";w="*"===this.peekChar(v)?this.extract(v,this.consume,"*"):this.extract(v,this.consumeTill,c),this.consumeAttributeSpace(v);const A=this.extract(v,this.consumeTill,c);let B;if("trr-int"===A)B={type:A,interval:this.extract(v,this.consumeTill)};else{const ge={type:A};this.peekChar(v)===c&&(this.consumeAttributeSpace(v),ge.parameter=this.extract(v,this.consumeToken),this.peekChar(v)===c&&(ge.additional=this.extract(v,this.consumeTill))),B=ge}if("*"===w)this.attributes.rtcpFeedbackWildcards.push(B);else{const ge=this.attributes.payloads.find(Ze=>Ze.payloadType===parseInt(w,10));ge?ge.rtcpFeedbacks.push(B):this.attributes.payloads.push({payloadType:parseInt(w,10),rtcpFeedbacks:[B]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(v){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const w={port:this.extract(v,this.consumePort)};this.peekChar(v)===c&&(this.consumeAttributeSpace(v),w.netType=this.extractOneOrMore(v,p),this.consumeAttributeSpace(v),w.addressType=this.extractOneOrMore(v,p),this.consumeAttributeSpace(v),w.address=this.extract(v,this.consumeAddress)),this.attributes.rtcp=w}parseMsid(v){const w={id:this.extractOneOrMore(v,p,[1,64])};this.peekChar(v)===c&&(this.consumeAttributeSpace(v),w.appdata=this.extractOneOrMore(v,p,[1,64])),this.attributes.msids.push(w)}parseImageAttr(v){this.attributes.imageattr.push(v.attValue)}parseRid(v){const w=this.extractOneOrMore(v,B=>f(B)||d(B)||"_"===B||"-"===B);this.consumeAttributeSpace(v);const A={id:w,direction:this.extract(v,this.consumeToken),params:[]};if(this.peekChar(v)===c){if(this.consumeAttributeSpace(v),this.peek(v,"pt=")){this.extract(v,this.consume,"pt=");const B=[];for(;;){const ge=this.extract(v,this.consumeToken);B.push(ge);try{this.extract(v,this.consume,",")}catch{break}}A.payloads=B,this.peekChar(v)===c&&this.extract(v,this.consume,c)}for(;;){const B=this.extract(v,this.consumeToken);switch(B){case"depend":{const ge={type:B,rids:this.extract(v,this.consume,"=").split(",")};A.params.push(ge);break}default:{const ge={type:B};"="===this.peekChar(v)&&(this.extract(v,this.consume,"="),ge.val=this.extract(v,this.consumeTill,";")),A.params.push(ge)}}try{this.extract(v,this.consume,";")}catch{break}}}this.attributes.rids.push(A)}parseSimulcast(v){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=v.attValue,this.extract(v,this.consumeTill)}parseSctpPort(v){this.attributes.sctpPort=this.extractOneOrMore(v,d,[1,5])}parseMaxMessageSize(v){this.attributes.maxMessageSize=this.extractOneOrMore(v,d,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(v){this.attributes.mid=this.extract(v,this.consumeToken)}parseSSRCGroup(v){const w=this.extract(v,this.consumeToken),A=[];for(;;)try{this.consumeAttributeSpace(v);const B=this.extract(v,this.consumeInteger);A.push(parseInt(B,10))}catch{break}this.attributes.ssrcGroups.push({semantic:w,ssrcIds:A})}}function Ue(U,v,w){return v in U?Object.defineProperty(U,v,{value:w,enumerable:!0,configurable:!0,writable:!0}):U[v]=w,U}class Dt{constructor(){Ue(this,"eol",a)}print(v,w){let A="";return w&&(this.eol=w),A+=this.printVersion(v.version),A+=this.printOrigin(v.origin),A+=this.printSessionName(v.sessionName),A+=this.printInformation(v.information),A+=this.printUri(v.uri),A+=this.printEmail(v.emails),A+=this.printPhone(v.phones),A+=this.printConnection(v.connection),A+=this.printBandwidth(v.bandwidths),A+=this.printTimeFields(v.timeFields),A+=this.printKey(v.key),A+=this.printSessionAttributes(v.attributes),A+=this.printMediaDescription(v.mediaDescriptions),A}printVersion(v){return"v=".concat(v).concat(this.eol)}printOrigin(v){return"o=".concat(v.username," ").concat(v.sessId," ").concat(v.sessVersion," ").concat(v.nettype," ").concat(v.addrtype," ").concat(v.unicastAddress).concat(this.eol)}printSessionName(v){return v?"s=".concat(v).concat(this.eol):""}printInformation(v){return v?"i=".concat(v).concat(this.eol):""}printUri(v){return v?"u=".concat(v).concat(this.eol):""}printEmail(v){let w="";for(const A of v)w+="e=".concat(A).concat(this.eol);return w}printPhone(v){let w="";for(const A of v)w+="e=".concat(A).concat(this.eol);return w}printConnection(v){return v?"c=".concat(v.nettype," ").concat(v.addrtype," ").concat(v.address).concat(this.eol):""}printBandwidth(v){let w="";for(const A of v)w+="b=".concat(A.bwtype,":").concat(A.bandwidth).concat(this.eol);return w}printTimeFields(v){let w="";for(const A of v){w+="t=".concat(A.time.startTime," ").concat(A.time.startTime).concat(this.eol);for(const B of A.repeats)w+="r=".concat(B.repeatInterval," ").concat(B.typedTimes.join(" ")).concat(this.eol);A.zoneAdjustments&&(w+="z=",w+="z=".concat(A.zoneAdjustments.map(B=>"".concat(B.time," ").concat(B.back?"-":""," ").concat(B.typedTime)).join(" ")).concat(this.eol),w+=this.eol)}return w}printKey(v){return v?"k=".concat(v).concat(this.eol):""}printAttributes(v){let w="";for(const A of v)w+="a=".concat(A.attField).concat(A.attValue?":".concat(A.attValue):"").concat(this.eol);return w}printMediaDescription(v){let w="";for(const A of v)w+=this.printMedia(A.media),w+=this.printInformation(A.information),w+=this.printConnections(A.connections),w+=this.printBandwidth(A.bandwidths),w+=this.printKey(A.key),w+=this.printMediaAttributes(A);return w}printConnections(v){let w="";for(const A of v)w+=this.printConnection(A);return w}printMedia(v){return"m=".concat(v.mediaType," ").concat(v.port," ").concat(v.protos.join("/")," ").concat(v.fmts.join(" ")).concat(this.eol)}printSessionAttributes(v){return new me(this.eol).print(v)}printMediaAttributes(v){return new P(this.eol).print(v)}}class dt{constructor(v){Ue(this,"eol",void 0),this.eol=v}printIceUfrag(v){return void 0===v?"":"a=ice-ufrag:".concat(v).concat(this.eol)}printIcePwd(v){return void 0===v?"":"a=ice-pwd:".concat(v).concat(this.eol)}printIceOptions(v){return void 0===v?"":"a=ice-options:".concat(v.join(c)).concat(this.eol)}printFingerprints(v){return v.length>0?v.map(w=>"a=fingerprint:".concat(w.hashFunction).concat(c).concat(w.fingerprint)).join(this.eol)+this.eol:""}printExtmap(v){return v.map(w=>"a=extmap:".concat(w.entry).concat(w.direction?"/".concat(w.direction):"").concat(c).concat(w.extensionName).concat(w.extensionAttributes?"".concat(c).concat(w.extensionAttributes):"").concat(this.eol)).join("")}printSetup(v){return void 0===v?"":"a=setup:".concat(v).concat(this.eol)}printUnrecognized(v){return v.map(w=>"a=".concat(w.attField).concat(w.attValue?":".concat(w.attValue):"").concat(this.eol)).join("")}}class me extends dt{print(v){let w="";return w+=this.printGroups(v.groups),w+=this.printMsidSemantic(v.msidSemantic),w+=this.printIceLite(v.iceLite),w+=this.printIceUfrag(v.iceUfrag),w+=this.printIcePwd(v.icePwd),w+=this.printIceOptions(v.iceOptions),w+=this.printFingerprints(v.fingerprints),w+=this.printSetup(v.setup),w+=this.printTlsId(v.tlsId),w+=this.printIdentity(v.identities),w+=this.printExtmap(v.extmaps),w+=this.printUnrecognized(v.unrecognized),w}printGroups(v){let w="";return v.length>0&&(w+=v.map(A=>"a=group:".concat(A.semantic).concat(A.identificationTag.map(B=>"".concat(c).concat(B)).join("")).concat(this.eol)).join("")),w}printIceLite(v){return void 0===v?"":"a=ice-lite"+this.eol}printTlsId(v){return v?"a=tls-id:".concat(v).concat(this.eol):""}printIdentity(v){return 0===v.length?"":v.map(w=>"a=identity:".concat(w.assertionValue).concat(w.extensions.map(A=>"".concat(c).concat(A.name).concat(A.value?"=".concat(A.value):"")))).join(this.eol)+this.eol}printMsidSemantic(v){if(!v)return"";let w="a=msid-semantic:".concat(v.semantic);return v.applyForAll?w+="".concat(c,"*"):v.identifierList.length>0&&(w+=v.identifierList.map(A=>"".concat(c).concat(A))),w+this.eol}}class P extends dt{print(v){const w=v.attributes;let A="";return A+=this.printRTCP(w.rtcp),A+=this.printIceUfrag(w.iceUfrag),A+=this.printIcePwd(w.icePwd),A+=this.printIceOptions(w.iceOptions),A+=this.printCandidates(w.candidates),A+=this.printRemoteCandidatesList(w.remoteCandidatesList),A+=this.printEndOfCandidates(w.endOfCandidates),A+=this.printFingerprints(w.fingerprints),A+=this.printSetup(w.setup),A+=this.printMid(w.mid),A+=this.printExtmap(w.extmaps),A+=this.printRTPRelated(w),A+=this.printPtime(w.ptime),A+=this.printMaxPtime(w.maxPtime),A+=this.printDirection(w.direction),A+=this.printSSRCGroups(w.ssrcGroups),A+=this.printSSRC(w.ssrcs),A+=this.printRTCPMux(w.rtcpMux),A+=this.printRTCPMuxOnly(w.rtcpMuxOnly),A+=this.printRTCPRsize(w.rtcpRsize),A+=this.printMSId(w.msids),A+=this.printImageattr(w.imageattr),A+=this.printRid(w.rids),A+=this.printSimulcast(w.simulcast),A+=this.printSCTPPort(w.sctpPort),A+=this.printMaxMessageSize(w.maxMessageSize),A+=this.printUnrecognized(w.unrecognized),A}printCandidates(v){return v.map(w=>"a=candidate:".concat(w.foundation).concat(c).concat(w.componentId).concat(c).concat(w.transport).concat(c).concat(w.priority).concat(c).concat(w.connectionAddress).concat(c).concat(w.port).concat(c,"typ").concat(c).concat(w.type).concat(w.relAddr?"".concat(c,"raddr").concat(c).concat(w.relAddr):"").concat(w.relPort?"".concat(c,"rport").concat(c).concat(w.relPort):"").concat(Object.keys(w.extension).map(A=>"".concat(c).concat(A).concat(c).concat(w.extension[A])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(v){return v.map(w=>"a=remote-candidates:".concat(w.join(c)).concat(this.eol)).join("")}printEndOfCandidates(v){return void 0===v?"":"a=end-of-candidates"+this.eol}printRTPRelated(v){if(!v.payloads)return"";const w=v.payloads;let A="";A+=v.rtcpFeedbackWildcards.map(B=>this.printRTCPFeedback("*",B)).join("");for(const B of w)A+=this.printRtpMap(B.payloadType,B.rtpMap),A+=this.printFmtp(B.payloadType,B.fmtp),A+=B.rtcpFeedbacks.map(ge=>this.printRTCPFeedback(B.payloadType,ge)).join("");return A}printFmtp(v,w){if(!w)return"";const A=Object.keys(w.parameters);return 1===A.length&&null===w.parameters[A[0]]?"a=fmtp:".concat(v).concat(c).concat(A[0]).concat(this.eol):"a=fmtp:".concat(v).concat(c).concat(Object.keys(w.parameters).map(B=>"".concat(B,"=").concat(w.parameters[B])).join(";")).concat(this.eol)}printRtpMap(v,w){return w?"a=rtpmap:".concat(v).concat(c).concat(w.encodingName,"/").concat(w.clockRate).concat(w.encodingParameters?"/".concat(w.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(v,w){let A="a=rtcp-fb:".concat(v).concat(c),B=w;return"trr-int"===B.type?A+="ttr-int".concat(c).concat(B.interval):(A+="".concat(B.type),B.parameter&&(A+="".concat(c).concat(B.parameter),B.additional&&(A+="".concat(c).concat(B.additional)))),A+this.eol}printPtime(v){return void 0===v?"":"a=ptime:".concat(v).concat(this.eol)}printMaxPtime(v){return void 0===v?"":"a=maxptime:".concat(v).concat(this.eol)}printDirection(v){return void 0===v?"":"a=".concat(v).concat(this.eol)}printSSRC(v){return v.map(w=>Object.keys(w.attributes).map(A=>"a=ssrc:".concat(w.ssrcId.toString(10)).concat(c).concat(A).concat(w.attributes[A]?":".concat(w.attributes[A]):"").concat(this.eol)).join("")).join("")}printRTCPMux(v){return void 0===v?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(v){return void 0===v?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(v){return void 0===v?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(v){if(void 0===v)return"";let w="a=rtcp:".concat(v.port);return v.netType&&(w+="".concat(c).concat(v.netType)),v.addressType&&(w+="".concat(c).concat(v.addressType)),v.address&&(w+="".concat(c).concat(v.address)),w+this.eol}printMSId(v){return v.map(w=>"a=msid:".concat(w.id).concat(w.appdata?"".concat(c).concat(w.appdata):"").concat(this.eol)).join("")}printImageattr(v){return v.map(w=>"a=imageattr:".concat(w).concat(this.eol)).join("")}printRid(v){return v.map(w=>{let A="a=rid:".concat(w.id).concat(c).concat(w.direction);return w.payloads&&(A+="".concat(c,"pt=").concat(w.payloads.join(","))),w.params.length>0&&(A+="".concat(c).concat(w.params.map(B=>"depend"===B.type?"depend=".concat(B.rids.join(",")):"".concat(B.type,"=").concat(B.val)).join(";"))),A+this.eol}).join("")}printSimulcast(v){return void 0===v?"":"a=simulcast:".concat(v).concat(this.eol)}printSCTPPort(v){return void 0===v?"":"a=sctp-port:".concat(v).concat(this.eol)}printMaxMessageSize(v){return void 0===v?"":"a=max-message-size:".concat(v).concat(this.eol)}printMid(v){return void 0===v?"":"a=mid:".concat(v).concat(this.eol)}printSSRCGroups(v){return v.map(w=>"a=ssrc-group:".concat(w.semantic).concat(w.ssrcIds.map(A=>"".concat(c).concat(A.toString(10))).join("")).concat(this.eol)).join("")}}function F(U){return(new V).parse(U)}function G(U,v){return(new Dt).print(U,v)}}},t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}return n.d=(i,r)=>{for(var o in r)n.o(r,o)&&!n.o(i,o)&&Object.defineProperty(i,o,{enumerable:!0,get:r[o]})},n.o=(i,r)=>Object.prototype.hasOwnProperty.call(i,r),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();var Zn=CY.exports;function VP(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R("SVC_MODE");if(R("ENABLE_SVC"))return function(t){return t in BN}(e)?e:BN.L1T3}function TY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function wY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?TY(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TY(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function qg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:r,filterVideoFec:o,filterAudioFec:s,filterAudioCodec:a,filterVideoCodec:c}=t,{useXR:l}=n;let d=[],u=[],h=[],p=[],m=!1,f=!1;if(Zn.parse(e).mediaDescriptions.forEach(E=>{i&&i!==E.attributes.direction||("video"!==E.media.mediaType||m||(u=E.attributes.payloads,p=E.attributes.extmaps,m=!0),"audio"!==E.media.mediaType||f||(d=E.attributes.payloads,h=E.attributes.extmaps,f=!0))}),!p||0===u.length)throw new Error("Cannot get video capabilities from SDP.");if(!h||0===d.length)throw new Error("Cannot get audio capabilities from SDP.");if(u.forEach(E=>{var b;null!==(b=E.rtpMap)&&void 0!==b&&b.clockRate&&(E.rtpMap.clockRate=parseInt(E.rtpMap.clockRate)),l&&E.rtcpFeedbacks.push({type:"rrtr"})}),d.forEach(E=>{var b;null!==(b=E.rtpMap)&&void 0!==b&&b.clockRate&&(E.rtpMap.clockRate=parseInt(E.rtpMap.clockRate)),l&&E.rtcpFeedbacks.push({type:"rrtr"})}),r&&(d=d.filter(E=>{var b;return"rtx"!==(null===(b=E.rtpMap)||void 0===b?void 0:b.encodingName.toLowerCase())}),u=u.filter(E=>{var b;return"rtx"!==(null===(b=E.rtpMap)||void 0===b?void 0:b.encodingName.toLowerCase())})),o&&(u=u.filter(E=>{var b;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(b=E.rtpMap)||void 0===b?void 0:b.encodingName)||"")})),s&&(d=d.filter(E=>{var b;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(b=E.rtpMap)||void 0===b?void 0:b.encodingName)||"")})),a&&a?.length>0&&(d=d.filter(E=>{var b;return Y(a).call(a,(null===(b=E.rtpMap)||void 0===b?void 0:b.encodingName.toLowerCase())||"")})),c&&c?.length>0){const E=u.filter(b=>{var T;return Y(c).call(c,(null===(T=b.rtpMap)||void 0===T?void 0:T.encodingName.toLowerCase())||"")});u=E.concat(r?[]:GP(E,u))}const g=R("UNSUPPORTED_VIDEO_CODEC");return g&&g.length>0&&(u=u.filter(E=>!(E.rtpMap&&Y(g).call(g,E.rtpMap.encodingName.toLowerCase())))),{audioCodecs:d,videoCodecs:u,audioExtensions:h,videoExtensions:p}}function ml(e){const t=Zn.parse(e);let n,i;for(const r of t.mediaDescriptions){if(!n){const o=r.attributes.iceUfrag,s=r.attributes.icePwd;if(!o||!s)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:o,icePwd:s}}if(!i){const o=r.attributes.fingerprints;o.length>0&&(i={fingerprints:o})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function IY(e,t){const n=[],i=e.attributes.ssrcGroups.filter(s=>"FID"===s.semantic),r=e.attributes.ssrcGroups.find(s=>"SIM"===s.semantic),o=e.attributes.ssrcs;if(r)r.ssrcIds.forEach(s=>{var a;const c=null===(a=i.find(l=>l.ssrcIds[0]===s))||void 0===a?void 0:a.ssrcIds[1];n.push({ssrcId:s,rtx:t?c:void 0})});else if(i.length>0)n.push({ssrcId:i[0].ssrcIds[0],rtx:t?i[0].ssrcIds[1]:void 0});else{if(0===o.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:o[0].ssrcId})}return n}function RY(e,t,n){const{cname:i}=e;let r=[];t&&(r=AY(t)),0===r.length&&(r=e.iceParameters.candidates.map(d=>({foundation:d.foundation,componentId:"1",transport:d.protocol,priority:d.priority.toString(),connectionAddress:d.ip,port:d.port.toString(),type:d.type,extension:{}})),_.debug("Using candidates from gateway."));const o={fingerprints:e.dtlsParameters.fingerprints.map(d=>({hashFunction:d.algorithm,fingerprint:d.fingerprint}))},s={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let a;switch(e.dtlsParameters.role){case"server":a="passive";break;case"client":a="active";break;case"auto":a="actpass"}const c=qS(e.rtpCapabilities),l=[];return Array.isArray(n)&&n.length>0&&n.forEach(d=>{l.push({kind:ie.VIDEO,ssrcId:d.v,rtx:d.v_rtx,mslabel:"".concat(d.v,"_").concat(d.a)},{kind:ie.AUDIO,ssrcId:d.a,mslabel:"".concat(d.v,"_").concat(d.a)})}),{dtlsParameters:o,iceParameters:s,candidates:r,rtpCapabilities:c,setup:a,cname:i,preSSRCs:l}}function AY(e){let t=[];return e.ip&&"number"==typeof e.port&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],_.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),_.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function Md(e,t,n){const i=[],r=[];return e.forEach(o=>{let{ssrcId:s,rtx:a}=o;const c=gt(8,"track-"),l={ssrcId:s,attributes:wY({label:c,mslabel:n=n||gt(10,""),msid:"".concat(n," ").concat(c)},t&&{cname:t})};if(i.push(l),void 0!==a){const d={ssrcId:a,attributes:wY({label:c,mslabel:n,msid:"".concat(n," ").concat(c)},t&&{cname:t})};i.push(d),r.push({semantic:"FID",ssrcIds:[s,a]})}}),e.length>1&&r.push({semantic:"SIM",ssrcIds:e.map(o=>{let{ssrcId:s}=o;return s})}),{ssrcs:i,ssrcGroups:r}}function wp(e,t){t instanceof Ht&&e.attributes.payloads.forEach(n=>{var i;const r=null===(i=n.rtpMap)||void 0===i?void 0:i.encodingName.toLowerCase();if(!r||-1===["opus","pcmu","pcma","g722"].indexOf(r))return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const o=t._encoderConfig;o&&"pcmu"!==r&&"pcma"!==r&&"g722"!==r&&(o.bitrate&&!Bt()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*o.bitrate))),o.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(o.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(o.sampleRate)),o.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function BP(e){const t=e.attributes.unrecognized.findIndex(n=>"x-google-flag"===n.attField&&"conference"===n.attValue);-1!==t&&e.attributes.unrecognized.splice(t,1)}function jP(e,t){var n;if(!(t instanceof St&&t._encoderConfig&&-1===t._hints.indexOf(ft.SCREEN_TRACK)))return;const i=t._encoderConfig;Fe().supportMinBitrate&&i.bitrateMin&&e.attributes.payloads.forEach(r=>{var o,s;Y(o=["h264","h265","vp8","vp9","av1"]).call(o,(null===(s=r.rtpMap)||void 0===s?void 0:s.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),Fe().supportMinBitrate&&!Y(n=t._hints).call(n,ft.LOW_STREAM)&&i.bitrateMax&&e.attributes.payloads.forEach(r=>{var o,s;Y(o=["h264","h265","vp8","vp9","av1"]).call(o,(null===(s=r.rtpMap)||void 0===s?void 0:s.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-start-bitrate"]="".concat(R("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function DY(e){if("video"!==e.media.mediaType)return;const t=xe();if(t.name!==Ye.SAFARI&&t.os!==kn.IOS)return;const n=e.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));-1!==n&&e.attributes.extmaps.splice(n,1)}function KS(e,t,n){if(!t)return;let i,r;if("video"===e.media.mediaType?(i=n.videoExtensions,r=n.videoCodecs):(i=n.audioExtensions,r=n.audioCodecs),!0===t.twcc){const o=i.find(s=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===s.extensionName);o&&(e.attributes.extmaps.find(a=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===a.extensionName)||e.attributes.extmaps.push({entry:o.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),(a=r,c=e.attributes.payloads,c.filter(l=>!!a.find(d=>d.payloadType===l.payloadType&&!!d.rtcpFeedbacks.find(u=>"transport-cc"===u.type)))).forEach(a=>{a.rtcpFeedbacks.find(c=>"transport-cc"===c.type)||a.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(!1===t.twcc){const o=e.attributes.extmaps.findIndex(s=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===s.extensionName);-1!==o&&e.attributes.extmaps.splice(o,1),e.attributes.payloads.forEach(s=>{const a=s.rtcpFeedbacks.findIndex(c=>"transport-cc"===c.type);-1!==a&&s.rtcpFeedbacks.splice(a,1)})}var a,c;if(!0===t.remb){const o=i.find(s=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===s.extensionName);o&&(e.attributes.extmaps.find(a=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===a.extensionName)||e.attributes.extmaps.push({entry:o.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(a,c){return c.filter(l=>!!a.find(d=>d.payloadType===l.payloadType&&!!d.rtcpFeedbacks.find(u=>"goog-remb"===u.type)))}(r,e.attributes.payloads).forEach(a=>{a.rtcpFeedbacks.find(c=>"goog-remb"===c.type)||a.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(!1===t.remb){const o=e.attributes.extmaps.findIndex(s=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===s.extensionName);-1!==o&&e.attributes.extmaps.splice(o,1),e.attributes.payloads.forEach(s=>{const a=s.rtcpFeedbacks.findIndex(c=>"goog-remb"===c.type);-1!==a&&s.rtcpFeedbacks.splice(a,1)})}}function OY(e,t,n){if(Bt()||"video"!==e.media.mediaType||!(t instanceof St)||"vp9"!==n&&"vp8"!==n||"vp8"===n&&!R("SIMULCAST")||"vp9"===n&&R("ENABLE_SVC")||void 0===t._scalabilityMode||t._scalabilityMode.numSpatialLayers<=1)return;const i="vp8"===n?2:t._scalabilityMode.numSpatialLayers,r=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find(a=>"FID"===a.semantic&&a.ssrcIds[0]===r.ssrcId),s={semantic:"SIM",ssrcIds:[r.ssrcId]};for(let a=1;a<i;a++)e.attributes.ssrcs.push({ssrcId:r.ssrcId+a,attributes:dn(r.attributes)}),s.ssrcIds.push(r.ssrcId+a),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+a,attributes:dn(r.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[r.ssrcId+a,o.ssrcIds[1]+a]}));e.attributes.ssrcGroups.unshift(s)}function NY(){return HP.apply(this,arguments)}function HP(){return HP=C(function*(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(yield n.createOffer()).sdp,{send:r,recv:o,sendrecv:s}=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;const d=qg(l,a,c,"sendonly"),u=qg(l,a,c,"recvonly"),h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ss(d,u,"videoExtensions",h,p,m),ss(d,u,"videoCodecs",h,p,m),ss(d,u,"audioExtensions",h,p,m),ss(d,u,"audioCodecs",h,p,m),R("RAISE_H264_BASELINE_PRIORITY")){const f=m.videoCodecs.findIndex(g=>{var E,b;return"h264"===(null===(E=g.rtpMap)||void 0===E?void 0:E.encodingName.toLocaleLowerCase())&&"42001f"===(null===(b=g.fmtp)||void 0===b?void 0:b.parameters["profile-level-id"])});if(-1!==f){const g=m.videoCodecs.findIndex(E=>{var b;return"h264"===(null===(b=E.rtpMap)||void 0===b?void 0:b.encodingName.toLocaleLowerCase())});if(g<f){_.debug("raising H264 baseline profile priority");const E=m.videoCodecs[f];m.videoCodecs.splice(f,1),m.videoCodecs.splice(g,0,E)}-1!==g&&(p.videoCodecs=p.videoCodecs.filter(E=>{var b,T;return!("h264"===(null===(b=E.rtpMap)||void 0===b?void 0:b.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(T=E.fmtp)||void 0===T?void 0:T.parameters["profile-level-id"]))})),-1!==g&&R("FILTER_SEND_H264_BASELINE")&&(h.videoCodecs=h.videoCodecs.filter(E=>{var b,T;return!("h264"===(null===(b=E.rtpMap)||void 0===b?void 0:b.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(T=E.fmtp)||void 0===T?void 0:T.parameters["profile-level-id"]))}))}}return{send:h,recv:p,sendrecv:m}}(e,t,i);try{n.close()}catch{}return{send:r,recv:o,sendrecv:s}}),HP.apply(this,arguments)}function PY(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=qg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ss(e,t,"videoExtensions",n,i,r),ss(e,t,"videoCodecs",n,i,r),ss(e,t,"audioExtensions",n,i,r),ss(e,t,"audioCodecs",n,i,r),R("RAISE_H264_BASELINE_PRIORITY")){const o=r.videoCodecs.findIndex(s=>s.rtpMap&&"h264"===s.rtpMap.encodingName.toLocaleLowerCase()&&s.fmtp&&"42001f"===s.fmtp.parameters["profile-level-id"]);if(-1!==o){const s=r.videoCodecs.findIndex(a=>a.rtpMap&&"h264"===a.rtpMap.encodingName.toLocaleLowerCase());if(s<o){_.debug("raising H264 baseline profile priority");const a=r.videoCodecs[o];r.videoCodecs.splice(o,1),r.videoCodecs.splice(s,0,a)}-1!==s&&(i.videoCodecs=i.videoCodecs.filter(a=>!(a.rtpMap&&"h264"===a.rtpMap.encodingName.toLocaleLowerCase()&&a.fmtp&&"42001f"!==a.fmtp.parameters["profile-level-id"])))}}return{send:n,recv:i,sendrecv:r}}function ss(e,t,n,i,r,o){if("videoExtensions"===n||"audioExtensions"===n){const s=[];return e[n].forEach(a=>{t[n].some((c,l)=>{if(a.entry===c.entry&&a.extensionName===c.extensionName)return s.push(l),!0})?o[n].push(a):i[n].push(a)}),void t[n].forEach((a,c)=>{-1===s.indexOf(c)&&r[n].push(a)})}if("videoCodecs"===n||"audioCodecs"===n){const s=[];return e[n].forEach(a=>{t[n].some((c,l)=>{if(a.payloadType===c.payloadType&&JSON.stringify(a)===JSON.stringify(c))return s.push(l),!0})?o[n].push(a):i[n].push(a)}),void t[n].forEach((a,c)=>{-1===s.indexOf(c)&&r[n].push(a)})}}function qS(e){const{send:t,recv:n,sendrecv:i}=e;if(!i){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let r,o;return t?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...t.audioCodecs,...i.audioCodecs],r.videoCodecs=[...t.videoCodecs,...i.videoCodecs],r.audioExtensions=[...t.audioExtensions,...i.audioExtensions],r.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):r=i,n?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...n.audioCodecs,...i.audioCodecs],o.videoCodecs=[...n.videoCodecs,...i.videoCodecs],o.audioExtensions=[...n.audioExtensions,...i.audioExtensions],o.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):o=i,{send:r,recv:o}}function Ip(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter(t=>{var n;return"opus"===(null===(n=t.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Yg(e,t,n,i){let r=[];if(e===ie.VIDEO){if(R("H264_PROFILE_LEVEL_ID")&&"h264"===i&&(r=t.videoCodecs.filter(o=>{var s;return Y(s=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(s,i)&&o&&o.fmtp&&o.fmtp.parameters["profile-level-id"]===R("H264_PROFILE_LEVEL_ID")})),!Array.isArray(r)||0===r.length){let o=[];const s=[],a=[],c=[];if(n.videoCodecs.forEach(l=>{const d=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"";Y(d).call(d,i)?o.push(l):Y(d).call(d,"vp9")?s.push(l):Y(d).call(d,"vp8")?a.push(l):Y(d).call(d,"h264")&&c.push(l)}),0===o.length){let l="";0!==s.length?(o=s,l="vp9"):0!==a.length?(o=a,l="vp8"):0!==c.length&&(o=c,l="h264"),_.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(l))}0!==o.length&&(r=t.videoCodecs.filter(l=>o.some(d=>d.payloadType===l.payloadType)))}if(0===r.length&&(_.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),r=t.videoCodecs),R("USE_PUB_RTX")||R("USE_SUB_RTX")){const o=GP(r,t.videoCodecs);r=[...r,...o]}}else r=t.audioCodecs.filter(o=>{var s;return Y(s=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(s,i)}),0===r.length&&(_.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),r=t.audioCodecs.filter(o=>{var s;return Y(s=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(s,"opus")}));return r}function GP(e,t){const n=e.map(i=>i.payloadType.toString());return t.filter(i=>i.rtpMap&&"rtx"===i.rtpMap.encodingName&&i.fmtp&&i.fmtp.parameters.apt&&Y(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}function YS(e,t,n){return WP.apply(this,arguments)}function WP(){return WP=C(function*(e,t,n){const i=t.toString(),r=xY(i,"offer","remote","exchangeSDP");yield e.setRemoteDescription({type:"offer",sdp:i});const o=yield e.createAnswer();if(!o.sdp)throw new Error("cannot get answer sdp");let s=o.sdp;s=MY(s,n||{}),r?.(s||""),yield e.setLocalDescription({type:"answer",sdp:s})}),WP.apply(this,arguments)}function MY(e,t,n){const i=Zn.parse(e),{useXR:r}=t;return i.mediaDescriptions.forEach(o=>{var s;o.attributes.mid&&(Array.isArray(n)&&!Y(n).call(n,o.attributes.mid)||("audio"===o.media.mediaType&&Ip(o),r&&Y(s=["audio","video"]).call(s,o.media.mediaType)&&o.attributes.payloads.forEach(a=>{-1===a.rtcpFeedbacks.findIndex(c=>"rrtr"===c.type)&&a.rtcpFeedbacks.push({type:"rrtr"})})))}),Zn.print(i)}function xY(e,t,n,i){if(R("SDP_LOGGING"))return _.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(i,"\n"),e),"offer"===t?r=>{xY(r,"answer","local"===n?"remote":"local",i)}:void 0}function Aa(e,t){return typeof R(e)===t?R(e):void 0}function kY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function gl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kY(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kY(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const zP=new Map;class Vke extends kt{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,"DISCONNECTED"===t&&this._disconnectedReason?this.emit(oi.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(oi.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){_.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){super(),y(this,"store",void 0),y(this,"joinInfo",void 0),y(this,"key",void 0),y(this,"ntpOffset",0),y(this,"signal",void 0),y(this,"role",void 0),y(this,"inChannelInfo",{joinAt:null,duration:0}),y(this,"spec",void 0),y(this,"_state","DISCONNECTED"),y(this,"_statsCollector",void 0),y(this,"_disconnectedReason",void 0),y(this,"isSignalRecover",!1),y(this,"hasChangeBGPAddress",!1),y(this,"trafficStatsInterval",void 0),y(this,"networkQualityInterval",void 0),y(this,"_joinGatewayStartTime",0),y(this,"_signalTimeout",!1),y(this,"_clientRoleOptions",void 0),y(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?new SY(gl(gl({},n),{},{retryConfig:n.websocketRetryConfig}),t):new lxe(gl(gl({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}join(t,n,i){var r=this;return C(function*(){r.store.joinGatewayStart(),"disabled"!==t.cloudProxyServer&&(r.hasChangeBGPAddress=!0);const o=Date.now();let s=zP.get(t.cname);if(s||(s=new Map,zP.set(t.cname,s)),r._isProactiveJoin=!0,s.has(t.uid)){const d=new N(S.UID_CONFLICT);throw ne.joinGateway(t.sid,{lts:o,succ:!1,ec:d.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:r._isProactiveJoin,avoidJoinStartTime:r.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),r._isProactiveJoin=!1,d}s.set(t.uid,!0),r.joinInfo=t,r.key=n;let a=0;r.joinGatewayStartTime=o;const c=t.proxyServer;try{_.debug("[".concat(r.store.clientId,"] use websocket join uid ").concat(a));const d=t.gatewayAddrs.map(u=>{let{address:h}=u;const[p,m]=h.split(":"),f={host:p,port:m};return t.proxyServer&&(f.proxy=t.proxyServer),f});a=(yield r.signal.init(d,i)).uid,_.debug("[".concat(r.store.clientId,"] websocket join uid ").concat(a," cost ").concat(Date.now()-r.joinGatewayStartTime))}catch(d){var l;throw _.error("[".concat(r.store.clientId,"] User join failed"),d.toString()),ne.joinGateway(t.sid,{lts:o,succ:!1,ec:(null===(l=d.data)||void 0===l?void 0:l.desc)||d.code,errorMsg:d.message,addr:r.signal.url,uid:t.uid,cid:t.cid,firstSuccess:r._isProactiveJoin,avoidJoinStartTime:r.store.avoidJoinStart,isProxy:!!c,signalChannel:"0",preload:t.preload}),r._isProactiveJoin=!1,s.delete(t.uid),r.signal.close(),d}return r.state="CONNECTED",r.inChannelInfo.joinAt=Date.now(),_.debug("[".concat(r.store.clientId,"] Connected to gateway server")),r.trafficStatsInterval=window.setInterval(()=>{r.updateTrafficStats().catch(d=>{_.warning("[".concat(r.store.clientId,"] get traffic stats error"),d.toString())})},3e3),r.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?r.emit(oi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):r.emit(oi.NETWORK_QUALITY,r._signalTimeout?{downlinkNetworkQuality:5,uplinkNetworkQuality:5}:"CONNECTED"===r.state&&r._statsCollector.trafficStats?{uplinkNetworkQuality:j7(r._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:j7(r._statsCollector.trafficStats.B_dnq)}:{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),r.store.joinGatewayEnd(),a})()}leave(){var t=arguments,n=this;return C(function*(){let i=t.length>0&&void 0!==t[0]&&t[0],r=t.length>1?t[1]:void 0;if("DISCONNECTED"!==n.state){r!==Qe.FALLBACK&&(n.state="DISCONNECTING");try{i||n.signal.connectionState!==_t.CONNECTED||(yield(o=n.signal.request(pe.LEAVE,void 0,!0),q.race([o,s1e(3e3)])))}catch(o){_.warning("[".concat(n.store.clientId,"] leave request failed, ignore"),o)}n.signal.close(r),r!==Qe.FALLBACK&&(n.state="DISCONNECTED"),n.reset()}var o})()}publish(t,n,i){var r=this;return C(function*(){if("CONNECTED"!==r.state&&"RECONNECTING"!==r.state)throw new N(S.INVALID_OPERATION,"can not publish when connection state is ".concat(r.state));const o={state:"offer",p2p_id:r.store.p2pId,ortc:n,mode:r.spec.mode,extend:R("PUB_EXTEND"),twcc:!!R("PUBLISH_TWCC"),rtx:!!R("USE_PUB_RTX")};try{return(yield r.signal.request(pe.PUBLISH,o,!0))._message}catch(s){if(i&&s.data&&s.data.code===ce.ERR_PUBLISH_REQUEST_INVALID)return _.warning("[".concat(r.store.clientId,"] receive publish error code, retry"),s.toString()),yield r.tryUnpubBeforeRepub(t,n),r.publish(t,n,!1);throw s}})()}publishDataChannel(t,n,i){var r=this;return C(function*(){var o;if("CONNECTED"!==r.state&&"RECONNECTING"!==r.state)throw new N(S.INVALID_OPERATION,"can not publish when connection state is ".concat(r.state));const s={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:null!==(o=n.maxRetransmits)&&void 0!==o?o:10,channel_id:n.channelId,metadata:n.metadata};try{yield r.signal.request(pe.PUBLISH_DATASTREAM,s,!0)}catch(a){if(i&&a.data&&a.data.code===ce.ERR_PUBLISH_REQUEST_INVALID)return _.warning("[".concat(r.store.clientId,"] receive publish datachannels error code, retry"),a.toString()),yield r.tryUnpubDataChannelBeforeRepub(t,n),r.publishDataChannel(t,n,!1);throw a}})()}unpublish(t,n){var i=this;return C(function*(){try{if("CONNECTED"!==i.state&&"RECONNECTING"!==i.state)throw new N(S.INVALID_OPERATION,"can not publish when connection state is ".concat(i.state));yield i.signal.request(pe.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(r){_.warning("[".concat(i.store.clientId,"] unpublish warning: "),r)}})()}unpublishDataChannel(t){var n=this;return C(function*(){try{if("CONNECTED"!==n.state&&"RECONNECTING"!==n.state)throw new N(S.INVALID_OPERATION,"can not publish when connection state is ".concat(n.state));yield q.all(t.map(i=>n.signal.request(pe.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){_.warning("unpublish datachannels warning: ",i)}})()}presubscribe(t,n,i){var r=this;return C(function*(){if("CONNECTED"!==r.state&&"RECONNECTING"!==r.state)throw new N(S.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(r.state));const o={stream_id:t,stream_type:n,mode:r.spec.mode,codec:r.spec.codec,p2p_id:r.store.p2pId,twcc:!!R("SUBSCRIBE_TWCC"),rtx:!!R("USE_SUB_RTX")||void 0,extend:R("SUB_EXTEND"),svc:Array.isArray(R("SVC"))&&0!==R("SVC").length?R("SVC"):void 0};try{return yield r.signal.request(pe.PRE_SUBSCRIBE,o,!0)}catch(s){if(i&&s.data&&s.data.code===ce.ERR_SUBSCRIBE_REQUEST_INVALID)return _.warning("[".concat(r.store.clientId,"] pre-subscribe error, retry"),s.toString()),r.presubscribe(t,n,!1);throw s}})()}subscribe(t,n,i){var r=this;return C(function*(){if("CONNECTED"!==r.state&&"RECONNECTING"!==r.state)throw new N(S.INVALID_OPERATION,"can not subscribe when connection state is ".concat(r.state));const o={stream_id:t,stream_type:n.stream_type,mode:r.spec.mode,codec:r.spec.codec,p2p_id:r.store.p2pId,twcc:!!R("SUBSCRIBE_TWCC"),rtx:!!R("USE_SUB_RTX"),extend:R("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(R("SVC"))&&0!==R("SVC").length?R("SVC"):void 0};try{return(yield r.signal.request(pe.SUBSCRIBE,o,!0))._message}catch(s){if(i&&s.data&&s.data.code===ce.ERR_SUBSCRIBE_REQUEST_INVALID)return _.warning("[".concat(r.store.clientId,"] receiver subscribe error code, retry"),s.toString()),yield r.tryUnsubBeforeResub(t,n),yield r.subscribe(t,n,!1);throw s}})()}subscribeDataChannel(t,n,i){var r=this;return C(function*(){if("CONNECTED"!==r.state&&"RECONNECTING"!==r.state)throw new N(S.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(r.state));const o={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void(yield r.signal.request(pe.SUBSCRIBE_DATASTREAM,o,!0))}catch(s){if(i&&s.data&&s.data.code===ce.ERR_SUBSCRIBE_REQUEST_INVALID)return _.warning("[".concat(r.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),yield r.tryUnsubDataChannelBeforeResub(t,n),yield r.subscribeDataChannel(t,n,!1);throw s}})()}subscribeAll(t,n){var i=this;return C(function*(){if("CONNECTED"!==i.state&&"RECONNECTING"!==i.state)throw new N(S.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(i.state));const r={p2p_id:i.store.p2pId,users:t,dtx:!1,rtx:!!R("USE_SUB_RTX"),twcc:!!R("SUBSCRIBE_TWCC"),svc:Array.isArray(R("SVC"))&&0!==R("SVC").length?R("SVC"):void 0};try{return yield i.signal.request(pe.SUBSCRIBE_STREAMS,r,!0)}catch(o){if(n&&o.data&&o.data.code===ce.ERR_SUBSCRIBE_REQUEST_INVALID)return _.warning("[".concat(i.store.clientId,"] receiver massSubscribe error code, retry"),o.toString()),yield i.tryMassUnsubBeforeResub(t),yield i.subscribeAll(t,!1);throw o}})()}setVideoProfile(t){var n=this;return C(function*(){const i=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let o=r.frameRate,s=r.width,a=r.height,c=!0;return"number"!=typeof o&&(o=o.exact||o.ideal||o.max||o.min||0,o||(c=!1)),"number"!=typeof s&&(s=s.exact||s.ideal||s.max||s.min||0,s||(c=!1)),"number"!=typeof a&&(a=a.exact||a.ideal||a.max||a.min||0,o||(c=!1)),c?{stream_type:0,width:s,height:a,fps:o,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(t);if(i)return n.signal.request(pe.SET_VIDEO_PROFILE,i);_.debug("[".concat(n.store.clientId,"] encoder config is not complete, do not report to gateway"))})()}unsubscribe(t,n){var i=this;return C(function*(){try{yield i.signal.request(pe.UNSUBSCRIBE,{p2p_id:i.store.p2pId,ortc:t,stream_id:n},!0)}catch(r){_.warning("[".concat(i.store.clientId,"] unsubscribe warning: "),r)}})()}unsubscribeDataChannel(t,n){var i=this;return C(function*(){try{if("CONNECTED"!==i.state&&"RECONNECTING"!==i.state)throw new N(S.INVALID_OPERATION,"can not publish when connection state is ".concat(i.state));yield q.all(t.map(r=>i.signal.request(pe.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:n},!0)))}catch(r){_.warning("unsubscribeDataChannel warning: ",r)}})()}massUnsubscribe(t){var n=this;return C(function*(){try{yield n.signal.request(pe.UNSUBSCRIBE_STREAMS,t,!0)}catch(i){_.warning("[".concat(n.store.clientId,"] massUnsubscribeAll warning: "),i)}})()}reconnectPC(t){var n=this;return C(function*(){const{iceParameters:i,dtlsParameters:r,rtpCapabilities:o}=t;return{gatewayEstablishParams:yield n.signal.request(pe.CONNECT_PC,{p2p_id:n.store.p2pId,stream_id:n.store.uid,ortc:{iceParameters:i,dtlsParameters:r,rtpCapabilities:o}},!0),gatewayAddress:n.getCurrentGatewayAddress()}})()}getGatewayInfo(){return this.signal.request(pe.GATEWAY_INFO)}renewToken(t){var n=this;return C(function*(){yield n.signal.request(pe.RENEW_TOKEN,t),n.key=t.token})()}setClientRole(t,n){var i=this;return C(function*(){if(n&&(i._clientRoleOptions=Object.assign({},n)),"CONNECTED"!==i.state)return void(i.role=t);let r,o=0;"audience"===t?i._clientRoleOptions&&i._clientRoleOptions.delay?(r=i._clientRoleOptions.delay,o=1):o=i._clientRoleOptions&&i._clientRoleOptions.level?i._clientRoleOptions.level:2:o=0,yield i.signal.request(pe.SET_CLIENT_ROLE,{role:t,level:o,delay:r,client_ts:Date.now()}),i.role=t})()}setRemoteVideoStreamType(t,n){var i=this;return C(function*(){yield i.signal.request(pe.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})})()}setDefaultRemoteVideoStreamType(t){var n=this;return C(function*(){yield n.signal.request(pe.DEFAULT_VIDEO_STREAM,{stream_type:t})})()}setStreamFallbackOption(t,n){var i=this;return C(function*(){yield i.signal.request(pe.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})})()}pickSVCLayer(t,n){var i=this;return C(function*(){yield i.signal.request(pe.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})})()}setRTM2Flag(t){var n=this;return C(function*(){yield n.signal.request(pe.SET_RTM2_FLAG,{rtm2_flag:t})})()}sendExtensionMessage(t,n,i){var r=this;return C(function*(){if(r.signal instanceof SY)return r.signal.sendExtensionMessage(t,n,i)})()}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),gl({},this.inChannelInfo)}getGatewayVersion(){var t=this;return C(function*(){return(yield t.signal.request(pe.GATEWAY_INFO)).version})()}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=zP.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:ri.username,password:ri.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(gl(gl({},ri),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}updateTrafficStats(){var t=this;return C(function*(){if("CONNECTED"!==t.state)return;const n=yield t.signal.request(pe.TRAFFIC_STATS,void 0,!0);n.timestamp=Date.now(),null!=n.ntp_offset&&(t.ntpOffset=n.ntp_offset),n.peer_delay.forEach(i=>{const r=t._statsCollector.trafficStats&&t._statsCollector.trafficStats.peer_delay.find(o=>o.peer_uid===i.peer_uid);r&&r.B_st!==i.B_st&&mS(()=>{t.emit(oi.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),t._statsCollector.updateTrafficStats(n)})()}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new N(S.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let i=R("REPORT_APP_SCENARIO");if("string"!=typeof i)try{i=JSON.stringify(i)}catch{i=void 0}i&&i.length>128&&(i=void 0);const r=!(Bt()||B9(87)||SK())&&"boolean"==typeof R("ENABLE_PRE_SUB")&&R("ENABLE_PRE_SUB"),o=!SK()&&Aa("ENABLE_PREALLOC_PC","boolean"),s=gl({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Oo,browser:navigator.userAgent,process_id:R("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:R("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:{enablePublishedUserList:R("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:R("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof R("SUBSCRIBE_AUDIO_FILTER_TOPN")?R("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof R("ENABLE_PUBLISH_AUDIO_FILTER")?R("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof R("ENABLE_USER_LICENSE_CHECK")?R("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===R("USE_PUB_RTX")||!0===R("USE_SUB_RTX")||void 0,disableFEC:R("DISABLE_FEC"),enableNTPReport:!!R("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!R("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!R("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Aa("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!R("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!R("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Aa("USE_XR","boolean"),enableLossbasedBwe:Aa("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!R("ENABLE_AUT_CC")||void 0,enableCCFallback:Aa("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:o,preSubNum:r?Aa("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Aa("PUBLISH_TWCC","boolean"),enableSubTWCC:Aa("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Aa("USE_PUB_RTX","boolean"),enableSubRTX:Aa("USE_SUB_RTX","boolean"),enableSubSVC:R("ENABLE_SVC")?R("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(R("SVC"))&&0!==R("SVC").length?R("SVC"):void 0}},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(s.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(s.aes_mode=this.joinInfo.aesmode,R("ENCRYPT_AES")?(s.aes_secret=this.joinInfo.aespassword,s.aes_encrypt=!0):s.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(s.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(s.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),void 0!==this.joinInfo.defaultVideoStream&&(s.default_video_stream=this.joinInfo.defaultVideoStream),s}getRejoinMessage(){if(!this.joinInfo)throw new N(S.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){var t=this;this.signal.on(he.WS_RECONNECT_WAITTING_FINISH,n=>{var i;Y(i=["tryNext","recover"]).call(i,n)&&this.joinInfo&&ne.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(he.WS_RECONNECT_CREATE_CONNECTION,n=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(he.WS_RECONNECTING,n=>{this.joinInfo&&ne.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n||ni.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",ne.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1,buildFormat:2}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(he.WS_CLOSED,n=>{let i;switch(n){case Qe.LEAVE:i=ni.LEAVE;break;case Qe.UID_BANNED:case Qe.IP_BANNED:case Qe.CHANNEL_BANNED:case Qe.SERVER_ERROR:i=ni.SERVER_ERROR;break;case Qe.FALLBACK:i=ni.FALLBACK;break;case Qe.LICENSE_MISSING:case Qe.LICENSE_EXPIRED:case Qe.LICENSE_MINUTES_EXCEEDED:case Qe.LICENSE_PERIOD_INVALID:case Qe.LICENSE_MULTIPLE_SDK_SERVICE:case Qe.LICENSE_ILLEGAL:case Qe.TOKEN_EXPIRE:i=n;break;default:i=ni.NETWORK_ERROR}_.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+ni.NETWORK_ERROR)),this.joinInfo&&ne.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:n===Qe.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=n,n!==Qe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(he.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(_.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),ne.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const n=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!n)return void _.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(n));st("EVENT_REPORT_DOMAIN",n[1]),st("EVENT_REPORT_BACKUP_DOMAIN",n[1]),st("LOG_UPLOAD_SERVER","".concat(n[1],":6444"))}}),this.signal.on(Te.ON_UPLINK_STATS,n=>{this._statsCollector.updateUplinkStats(n)}),this.signal.on(he.REQUEST_RECOVER,(n,i,r)=>{if(!this.joinInfo)return r(new N(S.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));n&&(this.joinInfo.multiIP=n,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ii(this,oi.REQUEST_NEW_GATEWAY_LIST).then(i).catch(r)}),this.signal.on(he.REQUEST_JOIN_INFO,function(){var n=C(function*(i){var r;if(t.updateTurnConfigFromSignal(),t.store.useP2P)return void i(t.getJoinMessage({ortc:{}}));const{iceParameters:o,dtlsParameters:s,rtpCapabilities:a}=yield ii(t,oi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(r=t.joinInfo)||void 0===r?void 0:r.turnServer});i(t.getJoinMessage({ortc:{iceParameters:o,dtlsParameters:s,rtpCapabilities:a,version:"2"}}))});return function(i){return n.apply(this,arguments)}}()),this.signal.on(he.REQUEST_REJOIN_INFO,n=>{n(this.getRejoinMessage())}),this.signal.on(he.REPORT_JOIN_GATEWAY,(n,i)=>{if(!this.joinInfo)return;let r,o="";var s;n instanceof N?(r=(null===(s=n.data)||void 0===s?void 0:s.desc)||n.code,o=n.message):r=n,ne.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:o,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1}),this.signal.on(he.IS_P2P_DISCONNECTED,n=>{n(xg(this,oi.IS_P2P_DISCONNECTED))}),this.signal.on(he.DISCONNECT_P2P,()=>{this.emit(oi.DISCONNECT_P2P)}),this.signal.on(he.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(he.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(he.JOIN_RESPONSE,n=>{const i=this.getCurrentGatewayAddress();this.emit(oi.JOIN_RESPONSE,n,i)}),this.signal.on(he.PRE_CONNECT_PC,C(function*(){if(t.joinInfo){t.updateTurnConfigFromSignal();const n=t.getCurrentGatewayAddress(),i=R("FINGERPRINT")||t.joinInfo.apResponse.addresses[t.signal.currentURLIndex].fingerprint;if(n&&i){const r=AY(n);t.emit(oi.PRE_CONNECT_PC,{candidates:r,fingerprint:i})}}})),this.signal.on(he.RECOVER_NOTIFICATION,n=>{this.joinInfo&&"string"==typeof R("AP_REQUEST_DETAIL")&&(this.joinInfo.apRequestDetail="".concat(R("AP_REQUEST_DETAIL"),";").concat(n))})}tryUnsubBeforeResub(t,n){var i=this;return C(function*(){try{yield i.signal.request(pe.UNSUBSCRIBE,{p2p_id:i.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(r){throw _.warning("[".concat(i.store.clientId,"] tryUnsubBeforeResub warning"),r),r}})()}tryUnsubDataChannelBeforeResub(t,n){var i=this;return C(function*(){try{yield i.signal.request(pe.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(r){throw _.warning("unsubscribe datachannel warning",r),r}})()}tryUnpubBeforeRepub(t,n){var i=this;return C(function*(){try{yield i.signal.request(pe.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(r){throw _.warning("[".concat(i.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}})()}tryUnpubDataChannelBeforeRepub(t,n){var i=this;return C(function*(){try{yield i.signal.request(pe.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(r){throw _.warning("unpublish datastream warning: ",r),r}})()}tryMassUnsubBeforeResub(t){var n=this;return C(function*(){const i={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{yield n.signal.request(pe.UNSUBSCRIBE_STREAMS,i,!0)}catch(r){throw _.warning("[".concat(n.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}})()}muteLocal(t,n){var i=this;return C(function*(){const r={action:t.find(o=>o.stream_type===$e.Audio)?"mute_local_audio":"mute_local_video",p2p_id:i.store.p2pId,ortc:t,stream_id:n};try{yield i.signal.request(pe.CONTROL,r,!0,!0)}catch(o){throw _.warning("[".concat(i.store.clientId,"] gateway muteLocal warning: "),o),o}})()}unmuteLocal(t,n){var i=this;return C(function*(){const r={action:t.find(o=>o.stream_type===$e.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:i.store.p2pId,ortc:t,stream_id:n};try{yield i.signal.request(pe.CONTROL,r,!0,!0)}catch(o){throw _.warning("[".concat(i.store.clientId,"] gateway unmuteLocal warning: "),o),o}})()}muteRemote(t,n){var i=this;return C(function*(){const r={action:t===ie.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:i.store.p2pId,stream_id:n};try{yield i.signal.request(pe.CONTROL,r,!0,!0)}catch(o){throw _.warning("[".concat(i.store.clientId,"] gateway muteRemote warning: "),o),o}})()}unmuteRemote(t,n){var i=this;return C(function*(){const r={action:t===ie.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:i.store.p2pId,stream_id:n};try{yield i.signal.request(pe.CONTROL,r,!0,!0)}catch(o){throw _.warning("[".concat(i.store.clientId,"] gateway unmuteRemote warning: "),o),o}})()}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}restartICE(t){var n=this;return C(function*(){const i={p2p_id:n.store.p2pId,stream_id:n.store.uid,ortc:t};try{return yield n.signal.request(pe.RESTART_ICE,i,!0)}catch(r){throw _.warning("[".concat(n.store.clientId,"] P2PChannel.restartICE warning: "),r),r}})()}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,ni.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!R("GATEWAY_WSS_ADDRESS"))return R("USE_CANDIDATE_FROM_AP_DETAIL")&&null!==(t=this.joinInfo)&&void 0!==t&&t.apGatewayAddress?(_.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):null!==(n=this.joinInfo)&&void 0!==n&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}setPublishAudioFilterEnabled(t){var n=this;return C(function*(){yield n.signal.request(pe.SET_PARAMETER,{enablePublishAudioFilter:t})})()}}let $S=0,KP=0;function Bs(e,t,n,i){return new q((r,o)=>{t.timeout=t.timeout||R("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),$S+=ya(t.data)):n&&(t.data.size?$S+=t.data.size:t.data instanceof FormData?$S+=a7(t.data):$S+=ya(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,nr.request(t).then(s=>{"string"==typeof s.data?KP+=ya(s.data):s.data instanceof ArrayBuffer||s.data instanceof Uint8Array?KP+=s.data.byteLength:KP+=ya(JSON.stringify(s.data)),i&&r({data:s.data,headers:s.headers}),r(s.data)}).catch(s=>{nr.isCancel(s)?o(new N(S.OPERATION_ABORTED,"cancel token canceled")):o("ECONNABORTED"===s.code?new N(S.NETWORK_TIMEOUT,s.message):s.response?new N(S.NETWORK_RESPONSE_ERROR,s.response.status):new N(S.NETWORK_ERROR,s.message))})})}!function(){var e;function t(P){var F=0;return function(){return F<P.length?{done:!1,value:P[F++]}:{done:!0}}}var i,n="function"==typeof Object.defineProperties?Object.defineProperty:function(P,F,G){return P==Array.prototype||P==Object.prototype||(P[F]=G.value),P},r=function(P){P=["object"==typeof globalThis&&globalThis,P,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof yh&&yh];for(var F=0;F<P.length;++F){var G=P[F];if(G&&G.Math==Math)return G}throw Error("Cannot find global object")}(this);function o(P,F){if(F)e:{var G=r;P=P.split(".");for(var U=0;U<P.length-1;U++){var v=P[U];if(!(v in G))break e;G=G[v]}(F=F(U=G[P=P[P.length-1]]))!=U&&null!=F&&n(G,P,{configurable:!0,writable:!0,value:F})}}function s(P){return(P={next:P})[Symbol.iterator]=function(){return this},P}function a(P){var F=typeof Symbol<"u"&&Symbol.iterator&&P[Symbol.iterator];return F?F.call(P):{next:t(P)}}if(o("Symbol",function(P){function F(v,w){this.A=v,n(this,"description",{configurable:!0,writable:!0,value:w})}if(P)return P;F.prototype.toString=function(){return this.A};var G="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",U=0;return function v(w){if(this instanceof v)throw new TypeError("Symbol is not a constructor");return new F(G+(w||"")+"_"+U++,w)}}),o("Symbol.iterator",function(P){if(P)return P;P=Symbol("Symbol.iterator");for(var F="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),G=0;G<F.length;G++){var U=r[F[G]];"function"==typeof U&&"function"!=typeof U.prototype[P]&&n(U.prototype,P,{configurable:!0,writable:!0,value:function(){return s(t(this))}})}return P}),"function"==typeof Object.setPrototypeOf)i=Object.setPrototypeOf;else{var c;e:{var l={};try{l.__proto__={a:!0},c=l.a;break e}catch{}c=!1}i=c?function(P,F){if(P.__proto__=F,P.__proto__!==F)throw new TypeError(P+" is not extensible");return P}:null}var d=i;function u(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h(P){if(P.m)throw new TypeError("Generator is already running");P.m=!0}function p(P,F){return P.h=3,{value:F}}function m(P){this.g=new u,this.G=P}function f(P,F,G,U){try{var v=F.call(P.g.j,G);if(!(v instanceof Object))throw new TypeError("Iterator result "+v+" is not an object");if(!v.done)return P.g.m=!1,v;var w=v.value}catch(A){return P.g.j=null,P.g.s(A),g(P)}return P.g.j=null,U.call(P.g,w),g(P)}function g(P){for(;P.g.h;)try{var F=P.G(P.g);if(F)return P.g.m=!1,{value:F.value,done:!1}}catch(G){P.g.v=void 0,P.g.s(G)}if(P.g.m=!1,P.g.l){if(F=P.g.l,P.g.l=null,F.F)throw F.D;return{value:F.return,done:!0}}return{value:void 0,done:!0}}function E(P){this.next=function(F){return P.o(F)},this.throw=function(F){return P.s(F)},this.return=function(F){return function(G,U){h(G.g);var v=G.g.j;return v?f(G,"return"in v?v.return:function(w){return{value:w,done:!0}},U,G.g.return):(G.g.return(U),g(G))}(P,F)},this[Symbol.iterator]=function(){return this}}function b(P,F){return F=new E(new m(F)),d&&P.prototype&&d(F,P.prototype),F}if(u.prototype.o=function(P){this.v=P},u.prototype.s=function(P){this.l={D:P,F:!0},this.h=this.C||this.u},u.prototype.return=function(P){this.l={return:P},this.h=this.u},m.prototype.o=function(P){return h(this.g),this.g.j?f(this,this.g.j.next,P,this.g.o):(this.g.o(P),g(this))},m.prototype.s=function(P){return h(this.g),this.g.j?f(this,this.g.j.throw,P,this.g.o):(this.g.s(P),g(this))},o("Array.prototype.entries",function(P){return P||function(){return function(F,G){F instanceof String&&(F+="");var U=0,v=!1,w={next:function(){if(!v&&U<F.length){var A=U++;return{value:G(A,F[A]),done:!1}}return v=!0,{done:!0,value:void 0}}};return w[Symbol.iterator]=function(){return w},w}(this,function(F,G){return[F,G]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var T=function(P,F){for(var G=0;G<P.length;G++)F(P[G])},I=function(P){return P.replace(/\r?\n|\r/g,"\r\n")},D=function(P,F,G){return F instanceof Blob?(F.name===(G=void 0!==G?G+"":"string"==typeof F.name?F.name:"blob")&&"[object Blob]"!==Object.prototype.toString.call(F)||(F=new File([F],G)),[String(P),F]):[String(P),String(F)]},O=function(P,F){if(P.length<F)throw new TypeError(F+" argument required, but only "+P.length+" present.")},k="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,L=k.FormData,V=k.XMLHttpRequest&&k.XMLHttpRequest.prototype.send,ee=k.Request&&k.fetch,oe=k.navigator&&k.navigator.sendBeacon,Ie=k.Element&&k.Element.prototype,Ue=k.Symbol&&Symbol.toStringTag;Ue&&(Blob.prototype[Ue]||(Blob.prototype[Ue]="Blob"),"File"in k&&!File.prototype[Ue]&&(File.prototype[Ue]="File"));try{new File([],"")}catch{k.File=function(F,G,U){return F=new Blob(F,U||{}),Object.defineProperties(F,{name:{value:G},lastModified:{value:+(U&&void 0!==U.lastModified?new Date(U.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Ue&&Object.defineProperty(F,Ue,{value:"File"}),F}}var Dt=function(P){return P.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},dt=function(P){this.i=[];var F=this;P&&T(P.elements,function(G){if(G.name&&!G.disabled&&"submit"!==G.type&&"button"!==G.type&&!G.matches("form fieldset[disabled] *"))if("file"===G.type){var U=G.files&&G.files.length?G.files:[new File([],"",{type:"application/octet-stream"})];T(U,function(v){F.append(G.name,v)})}else"select-multiple"===G.type||"select-one"===G.type?T(G.options,function(v){!v.disabled&&v.selected&&F.append(G.name,v.value)}):"checkbox"===G.type||"radio"===G.type?G.checked&&F.append(G.name,G.value):(U="textarea"===G.type?I(G.value):G.value,F.append(G.name,U))})};if((e=dt.prototype).append=function(P,F,G){O(arguments,2),this.i.push(D(P,F,G))},e.delete=function(P){O(arguments,1);var F=[];P=String(P),T(this.i,function(G){G[0]!==P&&F.push(G)}),this.i=F},e.entries=function P(){var F,G=this;return b(P,function(U){if(1==U.h&&(F=0),3!=U.h)return F<G.i.length?U=p(U,G.i[F]):(U.h=0,U=void 0),U;F++,U.h=2})},e.forEach=function(P,F){O(arguments,1);for(var G=a(this),U=G.next();!U.done;U=G.next()){var v=a(U.value);U=v.next().value,v=v.next().value,P.call(F,v,U,this)}},e.get=function(P){O(arguments,1);var F=this.i;P=String(P);for(var G=0;G<F.length;G++)if(F[G][0]===P)return F[G][1];return null},e.getAll=function(P){O(arguments,1);var F=[];return P=String(P),T(this.i,function(G){G[0]===P&&F.push(G[1])}),F},e.has=function(P){O(arguments,1),P=String(P);for(var F=0;F<this.i.length;F++)if(this.i[F][0]===P)return!0;return!1},e.keys=function P(){var F,G,w=this;return b(P,function(A){if(1==A.h&&(F=a(w),G=F.next()),3!=A.h)return G.done?void(A.h=0):p(A,a(G.value).next().value);G=F.next(),A.h=2})},e.set=function(P,F,G){O(arguments,2),P=String(P);var U=[],v=D(P,F,G),w=!0;T(this.i,function(A){A[0]===P?w&&(w=!U.push(v)):U.push(A)}),w&&U.push(v),this.i=U},e.values=function P(){var F,G,v,w=this;return b(P,function(A){if(1==A.h&&(F=a(w),G=F.next()),3!=A.h)return G.done?void(A.h=0):((v=a(G.value)).next(),p(A,v.next().value));G=F.next(),A.h=2})},dt.prototype._asNative=function(){for(var P=new L,F=a(this),G=F.next();!G.done;G=F.next()){var U=a(G.value);G=U.next().value,U=U.next().value,P.append(G,U)}return P},dt.prototype._blob=function(){var P="----formdata-polyfill-"+Math.random(),F=[],G="--"+P+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(U,v){return"string"==typeof U?F.push(G+Dt(I(v))+'"\r\n\r\n'+I(U)+"\r\n"):F.push(G+Dt(I(v))+'"; filename="'+Dt(U.name)+'"\r\nContent-Type: '+(U.type||"application/octet-stream")+"\r\n\r\n",U,"\r\n")}),F.push("--"+P+"--"),new Blob(F,{type:"multipart/form-data; boundary="+P})},dt.prototype[Symbol.iterator]=function(){return this.entries()},dt.prototype.toString=function(){return"[object FormData]"},Ie&&!Ie.matches&&(Ie.matches=Ie.matchesSelector||Ie.mozMatchesSelector||Ie.msMatchesSelector||Ie.oMatchesSelector||Ie.webkitMatchesSelector||function(P){for(var F=(P=(this.document||this.ownerDocument).querySelectorAll(P)).length;0<=--F&&P.item(F)!==this;);return-1<F}),Ue&&(dt.prototype[Ue]="FormData"),V){var me=k.XMLHttpRequest.prototype.setRequestHeader;k.XMLHttpRequest.prototype.setRequestHeader=function(P,F){me.call(this,P,F),"content-type"===P.toLowerCase()&&(this.B=!0)},k.XMLHttpRequest.prototype.send=function(P){P instanceof dt?(P=P._blob(),this.B||this.setRequestHeader("Content-Type",P.type),V.call(this,P)):V.call(this,P)}}ee&&(k.fetch=function(P,F){return F&&F.body&&F.body instanceof dt&&(F.body=F.body._blob()),ee.call(this,P,F)}),oe&&(k.navigator.sendBeacon=function(P,F){return F instanceof dt&&(F=F._asNative()),oe.call(this,P,F)}),k.FormData=dt}}();const $g=()=>{const e=R("AREAS");return 0===e.length&&e.push(We.GLOBAL),Ns(e).call(e,(t,n,i)=>{const r=LY(n);return r?0===i?r:"".concat(t,",").concat(r):t},"")},LY=e=>e===We.OVERSEA?"".concat(_i.ASIA,",").concat(_i.EUROPE,",").concat(_i.AFRICA,",").concat(_i.NORTH_AMERICA,",").concat(_i.SOUTH_AMERICA,",").concat(_i.OCEANIA):_i[e],Bke=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const i=IS[n],r=Object.keys(i);r&&r.map(o=>{"CODE"!==o&&(t[o]=t[o].concat(i[o]))})}),t},XS={GLOBAL:{ASIA:[We.CHINA,We.JAPAN,We.INDIA,We.KOREA,We.HKMC],EUROPE:[],NORTH_AMERICA:[We.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},ZS=Object.keys(XS[We.GLOBAL]),qP=[We.CHINA,We.NORTH_AMERICA,We.EUROPE,We.ASIA,We.JAPAN,We.INDIA,We.OCEANIA,We.SOUTH_AMERICA,We.AFRICA,We.KOREA,We.HKMC,We.US],jke=function(e,t){let n=[];if(Y(e).call(e,We.GLOBAL)){const o=[We.GLOBAL,We.OVERSEA],s=Object.keys(IS);if(t===We.GLOBAL)throw new N(S.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===We.CHINA)n=[We.OVERSEA];else if(r=t,Y(ZS).call(ZS,r)){const a=XS[We.GLOBAL][t]||[],c=[...o,t,...a];n=s.filter(l=>!Y(c).call(c,l))}else if(function(a){let c=!1;return ZS.forEach(l=>{var d;Y(d=XS[We.GLOBAL][l]).call(d,a)&&(c=!0)}),c}(t)){const a=function(l){let d;return ZS.forEach(u=>{var h;Y(h=XS[We.GLOBAL][u]).call(h,l)&&(d=u)}),d}(t),c=[...o,a,t];n=s.filter(l=>!Y(c).call(c,l))}else n=e;n=function(a){const c=[];return qP.forEach(l=>{Y(a).call(a,l)&&c.push(l)}),c.concat(a.filter(l=>!Y(qP).call(qP,l)))}(n)}else n=e;var r;return n};function FY(e){var t,n;if(!e&&Y(t=R("AREAS")).call(t,We.EXTENSIONS))return _.debug("update area from ap : reset"),void YP(g1e,!0);if(!Y(n=R("AREAS")).call(n,We.GLOBAL)||!e)return;let i=IS.EXTENSIONS;i&&(i={CODE:LY(We.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},_.debug("update area from ap success: ".concat(e,",config is "),i),st("AREAS",[We.EXTENSIONS],!0),Object.keys(i).map(r=>{st(r,"LOG_UPLOAD_SERVER"===r||"EVENT_REPORT_DOMAIN"===r||"EVENT_REPORT_BACKUP_DOMAIN"===r||"PROXY_SERVER_TYPE3"===r?i[r][0]:i[r])}))}function YP(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=ne.reportApiInvoke(null,{name:Cn.SET_AREA,options:e,tag:jt.TRACER});try{let i=[];if("string"==typeof e&&(i=[e]),Array.isArray(e)&&(e.forEach(o=>{if(!Y(O7).call(O7,o))throw new N(S.INVALID_PARAMS,"invalid area code")}),i=e),"[object Object]"===Object.prototype.toString.call(e)){const{areaCode:o,excludedArea:s}=e;if(!o)throw new N(S.INVALID_PARAMS,"area code is needed");let a=o;"string"==typeof o&&(a=[o]),i=s?jke(a,s):a}if(!t){if(ll.AREAS){const o=new N(S.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(o),void _.warning("setArea is prohibited because of config-distribute")}if(Y(i).call(i,We.GLOBAL)&&R("AREAS")===We.EXTENSIONS){const o=new N(S.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(o),void _.warning("setArea is prohibited because of ap extensions")}}st("AREAS",i,t);const r=Bke(i);Object.keys(r).map(o=>{st(o,"LOG_UPLOAD_SERVER"===o||"EVENT_REPORT_DOMAIN"===o||"EVENT_REPORT_BACKUP_DOMAIN"===o||"PROXY_SERVER_TYPE3"===o?r[o][0]:r[o])}),_.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function UY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function JS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?UY(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UY(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let $P=1,XP=1;function VY(e,t,n,i){let{url:r,areaCode:o}=e;const{clientId:s,sid:a}=t,c=Date.now();let l;const[d,u]=JP(t,o,[un.CHOOSE_SERVER]);let h=ln.networkState;return Ls(C(function*(){h&&ln.networkState===Mr.OFFLINE&&ln.onlineWaiter&&(yield q.race([ln.onlineWaiter,qn(i&&i.maxRetryTimeout||vn.maxRetryTimeout)])),h=ln.networkState;const{data:p,headers:m}=yield Bs(r,{data:d,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l="1"===m.http3?1:-1,ne.reportResourceTiming(r,a),jY(p,r,t,c,[un.CHOOSE_SERVER],l);const f=Vg(p,un.CHOOSE_SERVER);return ZP(f),YN(f,r)}),p=>(p&&ne.joinChooseServer(a,{lts:c,succ:!0,csAddr:r,opid:u,serverList:p.gatewayAddrs.map(m=>m.address),ec:null,cid:p.cid.toString(),uid:p.uid.toString(),csIp:p.csIp,unilbsServerIds:[un.CHOOSE_SERVER].toString(),isHttp3:l,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:p.res.detail&&p.res.detail[38]}),!1),p=>p.code!==S.OPERATION_ABORTED&&(p.code===S.CAN_NOT_GET_GATEWAY_SERVER?p.data.retry:(ne.joinChooseServer(a,{lts:c,succ:!1,csAddr:r,serverList:null,opid:u,ec:p.code,csIp:p.data&&p.data.csIp,unilbsServerIds:[un.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:h}),isHttp3:l,corssRegionTagReq:t.apRequestDetail}),_.warning("[".concat(s||"sid-".concat(a.slice(0,6)),"] Choose server network error, retry"),p),!0)),i)}function BY(e,t,n,i){let r,{url:o,areaCode:s,serviceIds:a}=e;const c=Date.now(),[l,d]=JP(t,s,a);let u;return Ls(C(function*(){u&&ln.networkState===Mr.OFFLINE&&ln.onlineWaiter&&(yield q.race([ln.onlineWaiter,qn(i&&i.maxRetryTimeout||vn.maxRetryTimeout)])),u=ln.networkState;const{data:h,headers:p}=yield Bs(o,{data:l,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r="1"===p.http3?1:-1,ne.reportResourceTiming(o,t.sid),jY(h,o,t,c,a,r);const m=Vg(h,un.CHOOSE_SERVER),f=Vg(h,"proxy5"===t.cloudProxyServer?un.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?un.CLOUD_PROXY:un.CLOUD_PROXY_FALLBACK);return ZP(m),{gatewayInfo:YN(m,o),proxyInfo:f,url:o}}),h=>(h.gatewayInfo&&ne.joinChooseServer(t.sid,{lts:c,succ:!0,csAddr:o,serverList:h.gatewayInfo.gatewayAddrs.map(p=>p.address),ec:null,opid:d,cid:h.gatewayInfo.cid.toString(),uid:h.gatewayInfo.uid.toString(),csIp:h.gatewayInfo.csIp,unilbsServerIds:a.toString(),isHttp3:r,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:h.gatewayInfo.res.detail&&h.gatewayInfo.res.detail[38]}),h.proxyInfo&&ne.joinWebProxyAP(t.sid,{lts:c,sucess:1,apServerAddr:o,turnServerAddrList:h.proxyInfo.addresses.map(p=>p.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:a.toString()}),!1),h=>h.code!==S.OPERATION_ABORTED&&(h.code===S.CAN_NOT_GET_GATEWAY_SERVER?h.data.retry:(ne.joinWebProxyAP(t.sid,{lts:c,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:h.code,eventType:t.cloudProxyServer,unilbsServerIds:a.toString(),extend:JSON.stringify({networkState:u})}),_.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),h),!0)),i)}const jY=(e,t,n,i,r,o)=>{const{sid:s,clientId:a,cloudProxyServer:c}=n,l=[],d=u=>{4096===u.flag?ne.joinChooseServer(s,{lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:u.error.message,csIp:u.error.data&&u.error.data.csIp,unilbsServerIds:r.toString(),isHttp3:o,corssRegionTagReq:n.apRequestDetail}):1048576!==u.flag&&4194304!==u.flag&&4194310!==u.flag||ne.joinWebProxyAP(s,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:u.error.code,eventType:c,unilbsServerIds:r.toString()})};if(e.response_body.forEach(u=>{const h=u.buffer.code;if(23===u.uri&&0===h&&!u.buffer.edges_services)if(4194310===u.buffer.flag)_.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),u.buffer.edges_services=[];else{const p={error:new N(S.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:u.buffer.flag};l.push(p),d(p)}if(0!==h){const p=sp(h),m={error:new N(S.CAN_NOT_GET_GATEWAY_SERVER,p.desc,{desc:p.desc,retry:p.retry,csIp:e.detail[502]}),flag:u.buffer.flag};4194310===u.buffer.flag?_.warning(m.error.toString()):l.push(m),d(m)}}),l.length)throw _.warning("[".concat(a||"sid-".concat(s.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(l.map(u=>"flag: ".concat(u.flag,", message: ").concat(u.error.message,", retry: ").concat(u.error.data.retry)).join(" | "))),new N(S.CAN_NOT_GET_GATEWAY_SERVER,l.map(u=>"flag: ".concat(u.flag,", message: ").concat(u.error.message)).join(" | "),{retry:!!l.find(u=>u.error.data.retry),csIp:e.detail[502],desc:[...new Set(l.map(u=>{var h;return null==u||null===(h=u.error)||void 0===h||null===(h=h.data)||void 0===h?void 0:h.desc}).filter(u=>!!u))]})},ZP=e=>{var t,n,i,r;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new N(S.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(R("AP_AREA")&&(null!==(i=e.detail)&&void 0!==i&&i[23]&&"string"==typeof(null===(r=e.detail)||void 0===r?void 0:r[23])?FY(e.detail[23].toLowerCase()):FY()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[19])){const s=e.detail[19],a=s?.split(";");for(let c=0;c<a.length;c++){var o;const l=ki(o=a[c]).call(o);e.addresses[c]&&a&&(e.addresses[c].fingerprint=l)}}if(R("GATEWAY_ADDRESS")&&R("GATEWAY_ADDRESS").length>0){_.debug("assign gateway address to",R("GATEWAY_ADDRESS"));const s=R("GATEWAY_ADDRESS").map(a=>{var c,l;const d=null!==(c=null===(l=e.addresses.find(u=>u.ip===a.ip&&u.port===a.port))||void 0===l?void 0:l.fingerprint)&&void 0!==c?c:"";return{ip:a.ip,port:a.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:d}});e.addresses=s}},JP=(e,t,n)=>{const i=Math.floor(1e12*Math.random()),r={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:JS(JS({6:e.stringUid,11:t,12:R("USE_NEW_TOKEN")?"1":void 0,22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};r.request_bodies.forEach(s=>{e.multiIP&&e.multiIP.gateway_ip&&(s.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const o=new FormData;return o.append("request",JSON.stringify(r)),[o,i]};let Rp=0;function Ap(e){return q.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}const Xg=function(){var e=C(function*(t){let{fragementLength:n,referenceList:i,asyncMapHandler:r,allFailedhandler:o,promisesCollector:s}=t,a=0;const c=n;let l,d=0;const u=function(){var h=C(function*(){const p=(()=>{const m=a*c;return i.slice(m,m+c).map(r)})();s&&s.push(...p);try{l=yield Ap(p)}catch(m){if(d+=c,a++,!(d>=i.length))return void(yield u());o(m)}p.forEach(m=>m.cancel())});return function(){return h.apply(this,arguments)}}();return yield u(),l});return function(n){return e.apply(this,arguments)}}(),HY=function(){var e=C(function*(t){let{referenceList:n,asyncMapHandler:i,closeFn:r}=t;const o=n.length;let s=0;const a=function(){var c=C(function*(){const l=i(n.shift());try{return yield l}catch(d){if(s++,s>=o||null!=r&&r(d))throw d;return a()}});return function(){return c.apply(this,arguments)}}();return a()});return function(n){return e.apply(this,arguments)}}();function QP(e,t,n,i){return eM.apply(this,arguments)}function eM(){return eM=C(function*(e,t,n,i){return{gatewayInfo:yield(o=C(function*(s,a,c,l){let d=null;const u=[],h=function(){var m=C(function*(){const f=R("WEBCS_DOMAIN").slice(0,R("AJAX_REQUEST_CONCURRENT")).map(b=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(b+"/api/v2/transpond/webrtc?v=2"):"https://".concat(b,"/api/v2/transpond/webrtc?v=2"),areaCode:$g()})),g=l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:f.map(b=>b.url)}),E=yield Xg({fragementLength:R("FRAGEMENT_LENGTH"),referenceList:f,asyncMapHandler:b=>(_.debug("[".concat(s.clientId,"] Connect to choose_server:"),b.url),VY(b,s,a,c)),allFailedhandler:b=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:b},g),b[0]},promisesCollector:u});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},g),E});return function(){return m.apply(this,arguments)}}(),p=function(){var m=C(function*(){if(yield qn(1e3),null!==d)return d;const f=R("WEBCS_DOMAIN_BACKUP_LIST").map(b=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(b+"/api/v2/transpond/webrtc?v=2"):"https://".concat(b,"/api/v2/transpond/webrtc?v=2"),areaCode:$g()})),g=l.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:f.map(b=>b.url)}),E=yield Xg({fragementLength:R("FRAGEMENT_LENGTH"),referenceList:f,asyncMapHandler:b=>(_.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),b.url),VY(b,s,a,c)),allFailedhandler:b=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:b},g),b[0]},promisesCollector:u});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},g),E});return function(){return m.apply(this,arguments)}}();try{return d=yield Ap([h(),p()]),u.length&&u.forEach(m=>m.cancel&&"function"==typeof m.cancel&&m.cancel()),d}catch(m){throw m[0]}}),function(s,a,c,l){return o.apply(this,arguments)})(e,t,n,i)};var o}),eM.apply(this,arguments)}function GY(e,t,n,i,r){return tM.apply(this,arguments)}function tM(){return tM=C(function*(e,t,n,i,r){const o=e.cloudProxyServer;if("disabled"===o){if(!i)return;if(e.useLocalAccessPoint)return yield QP(e,t,n,r);if(R("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:h,proxyInfo:p}=yield KY(e,t,n,r);if(e.turnServer&&"auto"!==e.turnServer.mode)return{gatewayInfo:h};const m=p.map(f=>({turnServerURL:f.address,tcpport:f.tcpport||ri.tcpport,udpport:f.udpport||ri.udpport,username:f.username||ri.username,password:f.password||ri.password,forceturn:!1,security:!0}));if(r.useP2P){var s;const f=null!==(s=e.uid)&&void 0!==s?s:h.uid,g="glb:".concat(f.toString()),E=yield wN(g),b=p.map(T=>({turnServerURL:T.address,tcpport:T.tcpport||ri.tcpport,udpport:T.udpport||ri.udpport,username:g,password:E,forceturn:!1,security:!0}));m.push(...b)}return e.turnServer={mode:"manual",servers:m},{gatewayInfo:h}}return yield QP(e,t,n,r)}const{proxyInfo:a,gatewayInfo:c}=yield KY(e,t,n,r),l={gatewayInfo:c},d=a.map(h=>({turnServerURL:h.address,tcpport:"proxy3"===o?void 0:h.tcpport?h.tcpport:ri.tcpport,udpport:"proxy4"===o?void 0:h.udpport?h.udpport:ri.udpport,username:h.username||ri.username,password:h.password||ri.password,forceturn:"proxy4"!==o,security:"proxy5"===o}));if(r.useP2P){var u;const h=null!==(u=e.uid)&&void 0!==u?u:c.uid,p="glb:".concat(h.toString()),m=yield wN(p),f=a.map(g=>({turnServerURL:g.address,tcpport:"proxy3"===o?void 0:g.tcpport||ri.tcpport,udpport:"proxy4"===o?void 0:g.udpport||ri.udpport,username:p,password:m,forceturn:"proxy4"!==o,security:"proxy5"===o}));d.push(...f)}return e.turnServer={mode:"manual",servers:d},_.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(o)),l}),tM.apply(this,arguments)}function WY(e,t,n,i,r){return nM.apply(this,arguments)}function nM(){return nM=C(function*(e,t,n,i,r){let s=[];s=R("ACCOUNT_REGISTER").slice(0,R("AJAX_REQUEST_CONCURRENT")).map(t.proxyServer?c=>"https://".concat(t.proxyServer,"/ap/?url=").concat(c+"/api/v1"):c=>"https://".concat(c,"/api/v1"));const a=r?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:s});try{const c=yield(l=C(function*(d,u,h,p,m){const f=Date.now(),g={sid:h.sid,opid:10,appid:h.appId,string_uid:u};let E=d[0];const b=yield Ls(()=>Bs(E+"".concat(-1===E.indexOf("?")?"?":"&","action=stringuid"),{data:g,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(T,I)=>{if(0===T.code){if(T.uid<=0||T.uid>=Math.pow(2,32))throw _.error("Invalid Uint Uid ".concat(u," => ").concat(T.uid),T),ne.reqUserAccount(g.sid,{lts:f,success:!1,serverAddr:E,stringUid:g.string_uid,uid:T.uid,errorCode:S.INVALID_UINT_UID_FROM_STRING_UID,extend:g}),new N(S.INVALID_UINT_UID_FROM_STRING_UID);return ne.reqUserAccount(g.sid,{lts:f,success:!0,serverAddr:E,stringUid:g.string_uid,uid:T.uid,errorCode:null,extend:g}),!1}const D=sp(T.code);return D.retry&&(E=d[(I+1)%d.length]),ne.reqUserAccount(g.sid,{lts:f,success:!1,serverAddr:E,stringUid:g.string_uid,uid:T.uid,errorCode:D.desc,extend:g}),D.retry},(T,I)=>T.code!==S.OPERATION_ABORTED&&(ne.reqUserAccount(g.sid,{lts:f,success:!1,serverAddr:E,stringUid:g.string_uid,uid:null,errorCode:T.code,extend:g}),E=d[(I+1)%d.length],!0),m);if(0!==b.code){const T=sp(b.code);throw new N(S.UNEXPECTED_RESPONSE,T.desc)}return b}),function(d,u,h,p,m){return l.apply(this,arguments)})(s,e,t,n,i);return r?.recordJoinChannelService({status:"success",endTs:Date.now()},a),c.uid}catch(c){throw r?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[c]},a),c}var l}),nM.apply(this,arguments)}function zke(e,t,n){return iM.apply(this,arguments)}function iM(){return iM=C(function*(e,t,n){let r=[];r=R("ACCOUNT_REGISTER").map(t.proxyServer?o=>"https://".concat(t.proxyServer,"/ap/?url=").concat(o+"/api/v1"):o=>"https://".concat(o,"/api/v1"));try{return yield HY({referenceList:r,asyncMapHandler:s=>{return(a=C(function*(c,l,d,u){const h=Date.now(),p={sid:d.sid,opid:10,appid:d.appId,string_uid:l};try{const m=yield Bs(c+"".concat(-1===c.indexOf("?")?"?":"&","action=stringuid"),{data:p,cancelToken:u,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(0!==m.code){const f=sp(m.code);throw new N(S.UNEXPECTED_RESPONSE,"preload sua error:".concat(f.desc),f)}if(m.uid<=0||m.uid>=Math.pow(2,32))throw new N(S.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:h,url:c,req:p,uid:m.uid,elapse:Date.now()-h}}catch(m){throw m}}),function(c,l,d,u){return a.apply(this,arguments)})(s,e,t,n);var a},closeFn:s=>s.code===S.OPERATION_ABORTED||s.code===S.UNEXPECTED_RESPONSE&&!s.data.retry})}catch(o){throw o}}),iM.apply(this,arguments)}function rM(){return rM=C(function*(e,t,n){const r=R("CDS_AP").slice(0,R("AJAX_REQUEST_CONCURRENT")).map(c=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(c+"/api/v1"):"https://".concat(c,"/api/v1?action=config")).map(c=>function(l,d,u,h){const p=xe(),m={flag:64,cipher_method:0,features:{device:p.name,system:p.os,system_general:navigator.userAgent,vendor:d.appId,version:Oo,cname:d.cname,sid:d.sid,session_id:d.sid,detail:"",proxyServer:d.proxyServer}};return Ls(()=>Bs(l,{data:m,timeout:1e3,cancelToken:u,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,f=>f.code!==S.OPERATION_ABORTED,h)}(c,e,t,n));let o=null,s=null,a={};try{o=yield Ap(r)}catch(c){if(c.code===S.OPERATION_ABORTED)throw c;s=c}if(r.forEach(c=>c.cancel()),ne.reportApiInvoke(e.sid,{name:Cn.REQUEST_CONFIG_DISTRIBUTE,options:{error:s,res:o}}).onSuccess(),o&&o.test_tags)try{a=function(c){if(!c.test_tags)return{};const l=c.test_tags,d=Object.keys(l),u={};return d.forEach(h=>{var p;const m=ki(p=h.slice(4)).call(p),f=JSON.parse(l[h])[1];u[m]=f}),u}(o)}catch{}return a}),rM.apply(this,arguments)}function zY(e,t){return oM.apply(this,arguments)}function oM(){return oM=C(function*(e,t){const n=R("WEBCS_DOMAIN").concat(R("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:$g(),serviceIds:[un.CHOOSE_SERVER,un.CLOUD_PROXY_FALLBACK]}));try{return yield HY({referenceList:n,asyncMapHandler:r=>{return(o=C(function*(s,a,c){let l,{url:d,areaCode:u,serviceIds:h}=s;const p=Date.now(),[m,f]=JP(a,u,h);let g=ln.networkState;try{g&&ln.networkState===Mr.OFFLINE&&ln.onlineWaiter&&(yield q.race([ln.onlineWaiter,qn(vn.maxRetryTimeout)])),g=ln.networkState;const{data:E,headers:b}=yield Bs(d,{data:m,cancelToken:c,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l="1"===b.http3?1:-1,(O=>{const k=[];if(O.response_body.forEach(L=>{const V=L.buffer.code;if(23===L.uri&&0===V&&!L.buffer.edges_services)if(4194310===L.buffer.flag)L.buffer.edges_services=[];else{const ee={error:new N(S.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:O.detail[502]}),flag:L.buffer.flag};k.push(ee)}if(0!==V){const ee=sp(V),oe={error:new N(S.CAN_NOT_GET_GATEWAY_SERVER,ee.desc,{desc:ee.desc,retry:ee.retry,csIp:O.detail[502]}),flag:L.buffer.flag};4194310===L.buffer.flag?_.warning(oe.error.toString()):k.push(oe)}}),k.length)throw new N(S.CAN_NOT_GET_GATEWAY_SERVER,k.map(L=>"flag: ".concat(L.flag,", message: ").concat(L.error.message)).join(" | "),{retry:!!k.find(L=>L.error.data.retry),csIp:O.detail[502],desc:[...new Set(k.map(L=>{var V;return null==L||null===(V=L.error)||void 0===V||null===(V=V.data)||void 0===V?void 0:V.desc}).filter(L=>!!L))]})})(E);const I=Vg(E,un.CHOOSE_SERVER),D=Vg(E,un.CLOUD_PROXY_FALLBACK);return ZP(I),{gatewayInfo:YN(I,d),proxyInfo:D,opid:f,requestTime:p,url:d,isHttp3:l,elapse:Date.now()-p}}catch(E){throw E}}),function(s,a,c){return o.apply(this,arguments)})(r,e,t);var o},closeFn:r=>r.code===S.OPERATION_ABORTED||r.code===S.CAN_NOT_GET_GATEWAY_SERVER&&!r.data.retry})}catch(i){throw i}}),oM.apply(this,arguments)}function KY(e,t,n,i){return sM.apply(this,arguments)}function sM(){return sM=C(function*(e,t,n,i){const r=R("PROXY_SERVER_TYPE3"),o=(p,m,f)=>{let g=f||r;return Array.isArray(g)&&(g=m%2==0?r[1]:r[0]),"https://".concat(g,"/ap/?url=").concat(p)};let s=null;const a=[],c=function(){var p=C(function*(){const m=R("WEBCS_DOMAIN").slice(0,R("AJAX_REQUEST_CONCURRENT")).map((E,b)=>{let T;return T="disabled"===e.cloudProxyServer&&e.proxyServer?o("".concat(E,"/api/v2/transpond/webrtc?v=2"),b,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(E,"/api/v2/transpond/webrtc?v=2"):o("".concat(E,"/api/v2/transpond/webrtc?v=2"),b),{url:T,areaCode:$g(),serviceIds:[un.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?un.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?un.CLOUD_PROXY:un.CLOUD_PROXY_FALLBACK]}}),f=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:m.map(E=>E.url)}),g=yield Xg({fragementLength:R("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:E=>(_.debug("[".concat(e.clientId,"] Connect to choose_server:"),E.url),BY(E,e,t,n)),allFailedhandler:E=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:E},f),E[0]},promisesCollector:a});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},f),g});return function(){return p.apply(this,arguments)}}(),l=function(){var p=C(function*(){if(yield qn(1e3),null!==s)return s;const m=R("WEBCS_DOMAIN_BACKUP_LIST").map((E,b)=>{let T;return T="disabled"===e.cloudProxyServer&&e.proxyServer?o("".concat(E,"/api/v2/transpond/webrtc?v=2"),b,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(E,"/api/v2/transpond/webrtc?v=2"):o("".concat(E,"/api/v2/transpond/webrtc?v=2"),b),{url:T,areaCode:$g(),serviceIds:[un.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?un.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?un.CLOUD_PROXY:un.CLOUD_PROXY_FALLBACK]}}),f=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:m.map(E=>E.url)}),g=yield Xg({fragementLength:R("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:E=>(_.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),E.url),BY(E,e,t,n)),allFailedhandler:E=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:E},f),E[0]},promisesCollector:a});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},f),g});return function(){return p.apply(this,arguments)}}();let d,u,h;try{({gatewayInfo:d,proxyInfo:u,url:h}=yield Ap([c(),l()]))}catch(p){throw p[0]}if(a.length&&a.forEach(p=>p.cancel&&"function"==typeof p.cancel&&p.cancel()),!d||!u)throw new N(S.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=h,"disabled"!==e.cloudProxyServer&&Array.isArray(r)&&h){const p=/^https?:\/\/(.+?)(\/.*)?$/.exec(h)[1];Y(r).call(r,p)&&(e.proxyServer=p,_.setProxyServer(p),ne.setProxyServer(p))}return s={gatewayInfo:d,proxyInfo:yield H7(u,d.uid)},s}),sM.apply(this,arguments)}function aM(){return aM=C(function*(e,t,n){const r=R("UAP_AP").slice(0,R("AJAX_REQUEST_CONCURRENT")).map(o=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(o+"/api/v1?action=uap"):"https://".concat(o,"/api/v1?action=uap")).map(o=>function(s,a,c,l){const d={command:"convergeAllocateEdge",sid:a.sid,appId:a.appId,token:a.token,ts:Date.now(),version:Oo,cname:a.cname,uid:a.uid.toString(),requestId:XP,seq:XP};XP+=1;const u={service_name:"tele_channel",json_body:JSON.stringify(d)};return Ls(C(function*(){const h=yield Bs(s,{data:u,cancelToken:c,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==h.code){const m=new N(S.UNEXPECTED_RESPONSE,"cross channel ap error, code"+h.code,{retry:!0});throw _.error(m.toString()),m}const p=JSON.parse(h.json_body);if(200!==p.code){const m=new N(S.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(p.code,", reason: ").concat(p.reason));throw _.error(m.toString()),m}if(!p.servers||0===p.servers.length){const m=new N(S.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw _.error(m.toString()),m}return{vid:p.vid,workerToken:p.workerToken,addressList:(R("CHANNEL_MEDIA_RELAY_SERVERS")||p.servers).map(m=>"wss://".concat(m.address.replace(/\./g,"-"),".").concat(R("WORKER_DOMAIN"),":").concat(m.wss))}}),void 0,h=>!!(h.code!==S.OPERATION_ABORTED&&h.code!==S.UNEXPECTED_RESPONSE||h.data&&h.data.retry),l)}(o,e,t,n));try{const o=yield Ap(r);return r.forEach(s=>s.cancel()),o}catch(o){throw o[0]}}),aM.apply(this,arguments)}function cM(){return cM=C(function*(e,t,n){let i=null;const r=[],o=function(){var s=C(function*(a){const c=R(a?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v2/transpond/webrtc?v=2"):"https://".concat(l,"/api/v2/transpond/webrtc?v=2"));return a&&(yield qn(1e3),null!==i)?i:yield Xg({fragementLength:R("FRAGEMENT_LENGTH"),referenceList:c,asyncMapHandler:l=>(_.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(a?"backup":""," choose_server:"),l),function(d,u,h,p){const[m]=((e,t)=>{const n=Math.floor(1e12*Math.random()),i={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(o=>({ip:o.ip,port:o.port}))}}]},r=new FormData;return r.append("request",JSON.stringify(i)),[r,n]})(u,[un.CHOOSE_SERVER]);let f=ln.networkState;return Ls(C(function*(){f&&ln.networkState===Mr.OFFLINE&&ln.onlineWaiter&&(yield q.race([ln.onlineWaiter,qn(p&&p.maxRetryTimeout||vn.maxRetryTimeout)])),f=ln.networkState;return((e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(0!==n.buffer.code){const i=sp(n.buffer.code);throw new N(S.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw _.debug("update ticket request received ap response without response body:",t),new N(S.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})})(yield Bs(d,{data:m,cancelToken:h,headers:{"Content-Type":"multipart/form-data;"}},!0),d)}),()=>!1,g=>g.code!==S.OPERATION_ABORTED&&(g.code===S.UPDATE_TICKET_FAILED?g.data.retry:(_.warning("[".concat(u.clientId,"] update ticket network error, retry"),g),!0)),p)}(l,e,t,n)),allFailedhandler:l=>{throw l[0]},promisesCollector:r})});return function(c){return s.apply(this,arguments)}}();try{return i=yield Ap([o(!1),o(!0)]),r.length&&r.forEach(s=>s.cancel&&"function"==typeof s.cancel&&s.cancel()),i}catch(s){throw s[0]}}),cM.apply(this,arguments)}function qY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function YY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qY(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qY(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class $ke extends kt{get isSuccess(){return!!this.configs}constructor(){super(),y(this,"configs",void 0),y(this,"joinInfo",void 0),y(this,"cancelToken",void 0),y(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),y(this,"interval",void 0),y(this,"mutex",new gi("config-distribute")),y(this,"mutableParamsRead",!1)}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),R("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},R("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}awaitConfigDistributeComplete(){var t=this;return C(function*(){t.mutex.isLocked&&(yield t.mutex.lock())()})()}updateConfigDistribute(){var t=this;return C(function*(){if(t.mutableParamsRead||(t.mutableParamsRead=!0,ne.reportApiInvoke(null,{options:void 0,name:Cn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:jt.TRACER}).onSuccess(JSON.stringify(ll))),!t.joinInfo||!t.cancelToken||!t.retryConfig)return void _.debug("[config-distribute] get config distribute interrupted have no joininfo");let n;const i=yield t.mutex.lock();try{n=yield function Kke(e,t,n){return rM.apply(this,arguments)}(t.joinInfo,t.cancelToken,t.retryConfig),_.debug("[config-distribute] get config distribute",JSON.stringify(n)),n.limit_bitrate&&t.handleBitrateLimit(n.limit_bitrate),t.cacheGlobalParameterConfig(n),t.configs=n}catch(r){const o=new N(S.NETWORK_RESPONSE_ERROR,r);_.warning("[config-distribute] ".concat(o.toString()))}finally{i()}})()}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var n;(n=t)&&n.uplink&&n.id&&void 0!==n.uplink.max_bitrate&&void 0!==n.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(zN.UPDATE_BITRATE_LIMIT,t):this.emit(zN.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&YY({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var n;const i=gg(n=Object.keys(t).filter(o=>/^webrtc_ng_global_parameter/.test(o))).call(n);for(let o=0;o<i.length;o++)for(let s=i.length-1;s>o;s--){const a=i[s];if("number"==typeof t[a].__priority){const l=i[s-1];if("number"==typeof t[l].__priority){if(!(t[a].__priority>t[l].__priority))continue;{const d=a;i[s]=i[s-1],i[s-1]=d}}else{const d=a;i[s]=i[s-1],i[s-1]=d}}}const r={};i.forEach(o=>{const s=t[o],a=s.__expires;Object.keys(s).forEach(c=>{"__priority"===c||"__expires"===c||Object.prototype.hasOwnProperty.call(r,c)||(r[c]=YY({value:s[c]},a&&{expires:a}))})});try{!function(a){try{const c=Date.now();Object.keys(a).forEach(l=>{switch(l){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(Jt,l)){const{value:d,expires:u}=a[l];if(u&&u<=c)return;ll[l]=d,Jt[l]=d,_.debug("Update global parameters from config distribute",l,d)}}})}catch(c){_.error("Error update config immediately: ".concat(a),c.message)}}(r);const o=JSON.stringify(r),s=window.btoa(o);window.localStorage.setItem("websdk_ng_global_parameter",s),_.debug("Caching global parameters ".concat(o))}catch(o){_.error("Error caching global parameters:",o.message)}}}class Xke extends kt{constructor(){super(...arguments),y(this,"resultStorage",new Map)}setLocalAudioStats(t,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(t,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i))}setRemoteAudioStats(t,n){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(t,n,i){if(R("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(t);if(r&&(r.result.push(i),r.result.length>=5)){var o;const s=Y(o=r.result).call(o,!0);r.isPrevNormal&&!s&&this.emit("exception",$Y[t],t,n),!r.isPrevNormal&&s&&this.emit("exception",$Y[t]+2e3,t+"_RECOVER",n),r.isPrevNormal=s,r.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&0===t.receiveLevel)}checkAudioInputLevel(t,n){return n instanceof wn&&!n.isActive||!!n.muted||0!==t.sendVolumeLevel}checkFramerateInput(t,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=kr(n._encoderConfig.frameRate));const r=t.captureFrameRate;return!i||!r||!(i>10&&r<5||i<10&&i>=5&&r<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,n){return!!n.muted||0!==t.sendBitrate}checkSendAudioBitrate(t,n){return n instanceof wn&&!n.isActive||!!n.muted||0!==t.sendBitrate}checkVideoDecode(t){return 0===t.receiveBitrate||0!==t.decodeFrameRate}}const $Y={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},vi=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};var XY=Vt(Co.Object.getOwnPropertySymbols),Zke=it,Jke=XA.indexOf,Qke=ny,lM=tg([].indexOf),ZY=!!lM&&1/lM([1],1,-0)<0;Zke({target:"Array",proto:!0,forced:ZY||!Qke("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return ZY?lM(this,e,t)||0:Jke(this,e,t)}});var eLe=Yo("Array").indexOf,tLe=Ki,nLe=eLe,dM=Array.prototype,JY=Vt(function(e){var t=e.indexOf;return e===dM||tLe(dM,e)&&t===dM.indexOf?nLe:t});function as(e){if(Array.isArray(e))return e.map(n=>n);if(!QY(e))return e;const t={};for(const n in e){const i=e[n];t[n]=QY(i)||Array.isArray(i)?as(i):i}return t}function QY(e){return!("object"!=typeof e||Array.isArray(e)||!e)}class uM{constructor(t){y(this,"input",[]),y(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Da={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Zg={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Da,remoteCandidate:Da}},e$={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},t$={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},n$={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},i$={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function r$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function o$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r$(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r$(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class hM{constructor(t,n){var i=this;y(this,"onFirstVideoReceived",void 0),y(this,"onFirstVideoDecoded",void 0),y(this,"onFirstAudioReceived",void 0),y(this,"onFirstVideoDecodedTimeout",void 0),y(this,"onFirstAudioDecoded",void 0),y(this,"onSelectedLocalCandidateChanged",void 0),y(this,"onSelectedRemoteCandidateChanged",void 0),y(this,"videoIsReady",!1),y(this,"videoIsReady2",{}),y(this,"pc",void 0),y(this,"options",void 0),y(this,"intervalTimer",void 0),y(this,"stats",as(Zg)),y(this,"isFirstVideoReceived",{}),y(this,"isFirstVideoDecoded",{}),y(this,"isFirstAudioReceived",{}),y(this,"isFirstAudioDecoded",{}),y(this,"isFirstVideoDecodedTimeout",{}),y(this,"lossRateWindowStats",[]),this.pc=t,this.options=n,this.intervalTimer=window.setInterval(C(function*(){i.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new q(t=>{t({local:o$({},Da),remote:o$({},Da)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,n){this.videoIsReady2[t]=n}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,o=0,s=0,a=0;for(const c of i)t[c].forEach((l,d)=>{if(!this.lossRateWindowStats[n-1][c][d]||!this.lossRateWindowStats[0][c][d])return;const u=this.lossRateWindowStats[n-1][c][d].packets-this.lossRateWindowStats[0][c][d].packets,h=this.lossRateWindowStats[n-1][c][d].packetsLost-this.lossRateWindowStats[0][c][d].packetsLost;"videoSend"===c||"audioSend"===c?(r+=u,s+=h):(o+=u,a+=h),l.packetLostRate=Number.isNaN(u)||Number.isNaN(u)||u<=0||h<=0?0:h/(u+h)});t.sendPacketLossRate=r<=0||s<=0?0:s/(r+s),t.recvPacketLossRate=o<=0||a<=0?0:a/(o+a)}}function s$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function oLe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s$(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s$(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class sLe extends hM{constructor(){super(...arguments),y(this,"_stats",Zg),y(this,"lastDecodeVideoReceiverStats",new Map)}updateStats(){var t=this;return C(function*(){const n=yield t._getStats(),i=t.statsResponsesToObjects(n);t._stats=as(Zg);const r=i.filter(s=>"ssrc"===s.type);t.processSSRCStats(r);const o=i.find(s=>"VideoBwe"===s.type);o&&t.processBandwidthStats(o),t._stats.timestamp=Date.now(),t.calcLossRate(t._stats),t.stats=t._stats})()}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(n=>{var i;const r=Y(i=n.id).call(i,"send");switch("".concat(n.mediaType,"_").concat(r?"send":"recv")){case"video_send":{const o=as(t$);o.codec=n.googCodecName,o.adaptionChangeReason="none",n.googCpuLimitedResolution&&(o.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(o.adaptionChangeReason="bandwidth"),o.avgEncodeMs=Number(n.googAvgEncodeMs),o.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},o.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},o.firsCount=Number(n.googFirReceived),o.nacksCount=Number(n.googNacksReceived),o.plisCount=Number(n.googPlisReceived),o.frameCount=Number(n.framesEncoded),o.bytes=Number(n.bytesSent),o.packets=Number(n.packetsSent),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(o),this._stats.rtt=o.rttMs;break}case"video_recv":{const o=as(e$),s=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(o.codec=n.googCodecName,o.targetDelayMs=Number(n.googTargetDelayMs),o.renderDelayMs=Number(n.googRenderDelayMs),o.currentDelayMs=Number(n.googCurrentDelayMs),o.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),o.decodeMs=Number(n.googDecodeMs),o.maxDecodeMs=Number(n.googMaxDecodeMs),o.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},o.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},o.decodeFrameRate=Number(n.googFrameRateDecoded),o.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},o.jitterBufferMs=Number(n.googJitterBufferMs),o.firsCount=Number(n.googFirsSent),o.nacksCount=Number(n.googNacksSent),o.plisCount=Number(n.googPlisSent),o.framesDecodeCount=Number(n.framesDecoded),o.bytes=Number(n.bytesReceived),o.packets=Number(n.packetsReceived),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,o.decodedFrame.width,o.decodedFrame.height),this.isFirstVideoDecoded[o.ssrc]=!0),s){const a=s.stats,c=Date.now()-s.lts;o.framesDecodeFreezeTime=a.framesDecodeFreezeTime,o.framesDecodeInterval=a.framesDecodeInterval,o.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(s.lts=Date.now(),o.framesDecodeInterval=c,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):o.framesDecodeCount<s.stats.framesDecodeCount&&(o.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:oLe({},o),lts:Date.now()}),this._stats.videoRecv.push(o);break}case"audio_recv":{const o=as(i$);o.codec=n.googCodecName,o.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,o.decodingCNG=Number(n.googDecodingCNG),o.decodingCTN=Number(n.googDecodingCTN),o.decodingCTSG=Number(n.googDecodingCTSG),o.decodingNormal=Number(n.googDecodingNormal),o.decodingPLC=Number(n.googDecodingPLC),o.decodingPLCCNG=Number(n.googDecodingPLCCNG),o.expandRate=Number(n.googExpandRate),o.accelerateRate=Number(n.googAccelerateRate),o.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),o.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),o.speechExpandRate=Number(n.googSpeechExpandRate),o.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),o.jitterBufferMs=Number(n.googJitterBufferMs),o.jitterMs=Number(n.googJitterReceived),o.bytes=Number(n.bytesReceived),o.packets=Number(n.packetsReceived),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),o.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.decodingNormal>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),this._stats.audioRecv.push(o);break}case"audio_send":{const o=as(n$);o.codec=n.googCodecName,o.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,o.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),o.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),o.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),o.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),o.bytes=Number(n.bytesSent),o.packets=Number(n.packetsSent),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.rttMs=Number(n.googRtt||0),this._stats.rtt=o.rttMs,this._stats.audioSend.push(o);break}}})}_getStats(){return new q((t,n)=>{this.pc.getStats(t,n)})}statsResponsesToObjects(t){const n=[];return t.result().forEach(i=>{const r={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(o=>{r[o]=i.stat(o)}),n.push(r)}),n}}function a$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function xd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a$(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a$(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class c$ extends hM{constructor(){super(...arguments),y(this,"_stats",Zg),y(this,"report",void 0),y(this,"lastDecodeVideoReceiverStats",new Map),y(this,"lastVideoFramesRecv",new Map),y(this,"lastVideoFramesSent",new Map),y(this,"lastVideoFramesDecode",new Map),y(this,"lastVideoFramesOutput",new Map),y(this,"lastVideoJBDelay",new Map),y(this,"lastAudioJBDelay",new Map),y(this,"mediaBytesSent",new Map),y(this,"mediaBytesRetransmit",new Map),y(this,"mediaBytesTargetEncode",new Map),y(this,"lastEncoderMs",new Map)}updateStats(){var t=this;return C(function*(){t.report=yield t.pc.getStats(),t._stats=as(Zg),t.report.forEach(n=>{switch(n.type){case eo.OUTBOUND:case eo.INBOUND:{const i=n.mediaType||n.kind,r=!i&&"frameWidth"in n,o=!i&&!("frameWidth"in n);n.type===eo.OUTBOUND?"audio"===i||o?t.processAudioOutboundStats(n):("video"===i||r)&&t.processVideoOutboundStats(n):n.type===eo.INBOUND&&("audio"===i||o?t.processAudioInboundStats(n):("video"===i||r)&&t.processVideoInboundStats(n));break}case eo.TRANSPORT:{const i=t.report.get(n.selectedCandidatePairId);i&&t.processCandidatePairStats(i);break}case eo.CANDIDATE_PAIR:n.selected&&t.processCandidatePairStats(n)}}),t.updateSendBitrate(),t._stats.timestamp=Date.now(),t.calcLossRate(t._stats),t.stats=t._stats})()}getSelectedCandidatePair(){var t=this;return C(function*(){const n=yield t.pc.getStats(),i={local:xd({},Da),remote:xd({},Da)};return n.forEach(r=>{let o;if(r.type===eo.TRANSPORT&&(o=n.get(r.selectedCandidatePairId)),r.type===eo.CANDIDATE_PAIR&&r.selected&&(o=r),o){const s=(a,c)=>{a.type=c.type,a.id=c.id,c.address&&(a.address=c.address),c.candidateType&&(a.candidateType=c.candidateType),c.port&&(a.port=c.port),c.priority&&(a.priority=c.priority),c.protocol&&(a.protocol=c.protocol),c.relayProtocol&&(a.relayProtocol=c.relayProtocol)};if(o.localCandidateId){const a=n.get(o.localCandidateId);a&&s(i.local,a)}if(o.remoteCandidateId){const a=n.get(o.remoteCandidateId);a&&s(i.remote,a)}}}),i})()}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const n=this.report.get(t.localCandidateId);n&&this.processCandidateStats(n)}if(t.remoteCandidateId){const n=this.report.get(t.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(t){let n;t.type===eo.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),t.type===eo.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=t.type,n.id=t.id,t.address&&(n.address=t.address),t.candidateType&&(n.candidateType=t.candidateType),t.port&&(n.port=t.port),t.priority&&(n.priority=t.priority),t.protocol&&(n.protocol=t.protocol),t.relayProtocol&&(n.relayProtocol=t.relayProtocol),t.type===eo.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(xd({},n),xd({},this.stats.selectedCandidatePair.localCandidate)),t.type===eo.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(xd({},n),xd({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let n=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);n||(n=as(i$),this._stats.audioRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.packetsDiscarded=t.packetsDiscarded,n.bytes=t.bytesReceived,n.jitterMs=1e3*t.jitter,this.processAudioTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),n.receivedFrames||(n.receivedFrames=t.packetsReceived),n.droppedFrames||(n.droppedFrames=t.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),"number"==typeof t.concealedSamples&&(n.concealedSamples=t.concealedSamples)}processVideoInboundStats(t){let n=this._stats.videoRecv.find(a=>a.ssrc===t.ssrc);n||(n=as(e$),this._stats.videoRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.bytes=t.bytesReceived,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.framesDecodeCount=t.framesDecoded,n.framesDroppedCount=t.framesDropped,n.totalInterFrameDelay=t.totalInterFrameDelay,n.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,n.totalFreezesDuration=t.totalFreezesDuration;const i=this.lastDecodeVideoReceiverStats.get(n.ssrc),r=this.lastVideoFramesDecode.get(n.ssrc),o=this.lastVideoFramesOutput.get(n.ssrc),s=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,n.decodedFrame?n.decodedFrame.width:0,n.decodedFrame?n.decodedFrame.height:0),this.isFirstVideoDecoded[n.ssrc]=!0),i){const a=i.stats,c=s-i.lts;n.framesDecodeFreezeTime=a.framesDecodeFreezeTime,n.framesDecodeInterval=a.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&c>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(i.lts=Date.now(),n.framesDecodeInterval=c,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):n.framesDecodeCount<a.framesDecodeCount&&(n.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(n.qpSumPerFrame=i.stats.framesDecodeCount>t.framesDecoded?t.qpSum/t.framesDecoded:(t.qpSum-i.qpSum)/(t.framesDecoded-i.stats.framesDecodeCount))}r&&s-r.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:s,rate:n.decodeFrameRate})):r?n.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:s,rate:0}),n.framesDroppedCount&&t.framesReceived&&(o&&s-o.lts>=800?(n.outputFrameRate=Math.round((t.framesReceived-n.framesDroppedCount-o.count)/((s-o.lts)/1e3)),this.lastVideoFramesOutput.set(n.ssrc,{count:t.framesReceived-n.framesDroppedCount,lts:s,rate:Math.max(n.outputFrameRate,0)})):o?n.outputFrameRate=o.rate:this.lastVideoFramesOutput.set(n.ssrc,{count:t.framesReceived-n.framesDroppedCount,lts:s,rate:0})),t.totalDecodeTime&&(n.decodeMs=1e3*t.totalDecodeTime),this.processVideoTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(n.framesRateFirefox=t.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:xd({},n),lts:i?i.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let n=this._stats.videoSend.find(r=>r.ssrc===t.ssrc);n||(n=as(t$),this._stats.videoSend.push(n));const i=this.mediaBytesSent.get(t.ssrc);if(i)i.add(t.bytesSent);else{const r=new uM(10);r.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,r)}if(void 0!==t.retransmittedBytesSent){const r=this.mediaBytesRetransmit.get(t.ssrc);if(r)r.add(t.retransmittedBytesSent);else{const o=new uM(10);o.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,o)}}if(t.totalEncodedBytesTarget){const r=this.mediaBytesTargetEncode.get(t.ssrc);if(r)r.add(t.totalEncodedBytesTarget);else{const o=new uM(10);o.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,o)}}if(n.ssrc=t.ssrc,n.bytes=t.bytesSent,n.packets=t.packetsSent,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.frameCount=t.framesEncoded,n.adaptionChangeReason=t.qualityLimitationReason,n.scalabilityMode=t.scalabilityMode,t.totalEncodeTime&&t.framesEncoded){const r=this.lastEncoderMs.get(t.ssrc);n.avgEncodeMs=!r||r.lastFrameCount>t.framesEncoded?1e3*t.totalEncodeTime/t.framesEncoded:1e3*(t.totalEncodeTime-r.lastEncoderTime)/(t.framesEncoded-r.lastFrameCount)}if(t.framesEncoded&&t.qpSum){const r=this.lastEncoderMs.get(t.ssrc);n.qpSumPerFrame=!r||r.lastFrameCount>t.framesEncoded?t.qpSum/t.framesEncoded:(t.qpSum-r.lastQpSum)/(t.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,n),this.processVideoTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const r=this.findRemoteStatsId(t.ssrc,eo.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,n)}}processAudioOutboundStats(t){let n=this._stats.audioSend.find(i=>i.ssrc===t.ssrc);if(n||(n=as(n$),this._stats.audioSend.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsSent,n.bytes=t.bytesSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const i=this.findRemoteStatsId(t.ssrc,eo.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,n)}}findRemoteStatsId(t,n){var i;const r=Array.from(uc(i=this.report).call(i)).find(o=>o.type===n&&o.ssrc===t);return r?r.id:null}processVideoMediaSource(t,n){const i=this.report.get(t);i&&i.width&&i.height&&i.framesPerSecond&&(n.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(t,n){const i=this.report.get(t);i&&(n.inputLevel=i.audioLevel)}processVideoTrackSenderStats(t,n,i){var r,o,s,a;const c=n?this.report.get(n):void 0,l=null!==(r=c?.framesSent)&&void 0!==r?r:t.framesSent;if("number"!=typeof l)return;let d=null!==(o=c?.frameWidth)&&void 0!==o?o:t.frameWidth,u=null!==(s=c?.frameHeight)&&void 0!==s?s:t.frameHeight,h=null!==(a=c?.framesPerSecond)&&void 0!==a?a:t.framesPerSecond;if("number"==typeof d&&"number"==typeof u||(d=0,u=0),null==h){const p=Date.now(),m=this.lastVideoFramesSent.get(i.ssrc);m&&p-m.lts>=800?(h=Math.round((l-m.count)/((p-m.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:l,lts:p,rate:h})):m?h=m.rate:this.lastVideoFramesSent.set(i.ssrc,{count:l,lts:p,rate:0})}i.sentFrame={width:d,height:u,frameRate:Math.max(0,h)}}processVideoTrackReceiverStats(t,n,i){var r,o,s,a,c;const l=n?this.report.get(n):void 0,d=null!==(r=l?.framesReceived)&&void 0!==r?r:t.framesReceived,u=null!==(o=l?.frameWidth)&&void 0!==o?o:t.frameWidth,h=null!==(s=l?.frameHeight)&&void 0!==s?s:t.frameHeight,p=null!==(a=l?.jitterBufferDelay)&&void 0!==a?a:t.jitterBufferDelay,m=null!==(c=l?.jitterBufferEmittedCount)&&void 0!==c?c:t.jitterBufferEmittedCount;if("number"==typeof d){const f=this.lastVideoFramesRecv.get(i.ssrc),g=Date.now();i.framesReceivedCount=d;let E=0;f&&g-f.lts>=800?(E=Math.round((d-f.count)/((g-f.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:d,lts:g,rate:E})):f?E=f.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:d,lts:g,rate:0}),i.receivedFrame={width:u||0,height:h||0,frameRate:E||0},i.decodedFrame={width:u||0,height:h||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:u||0,height:h||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(p&&m){const f=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let g=f.jitterBufferMs;const E=m-f.jitterBufferEmittedCount;E>0&&(g=1e3*(p-f.jitterBufferDelay)/E),i.jitterBufferMs=g,i.currentDelayMs=Math.round(g),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:p,jitterBufferEmittedCount:m,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(t,n,i){var r,o,s,a;const c=n?this.report.get(n):void 0,l=null!==(r=null!==(o=c?.echoReturnLoss)&&void 0!==o?o:t.echoReturnLoss)&&void 0!==r?r:0,d=null!==(s=null!==(a=c?.echoReturnLossEnhancement)&&void 0!==a?a:t.echoReturnLossEnhancement)&&void 0!==s?s:0;i.aecReturnLoss=l,i.aecReturnLossEnhancement=d}processAudioTrackReceiverStats(t,n,i){var r,o,s,a,c,l,d;const u=n?this.report.get(n):void 0,h=null!==(r=u?.removedSamplesForAcceleration)&&void 0!==r?r:t.removedSamplesForAcceleration,p=null!==(o=u?.totalSamplesReceived)&&void 0!==o?o:t.totalSamplesReceived,m=null!==(s=u?.jitterBufferDelay)&&void 0!==s?s:t.jitterBufferDelay,f=null!==(a=u?.jitterBufferEmittedCount)&&void 0!==a?a:t.jitterBufferEmittedCount,g=null!==(c=u?.audioLevel)&&void 0!==c?c:t?.audioLevel,E=null!==(l=u?.totalSamplesDuration)&&void 0!==l?l:t?.totalSamplesDuration,b=null!==(d=u?.concealedSamples)&&void 0!==d?d:t.concealedSamples;if(h&&p&&(i.accelerateRate=h/p),m&&f){const I=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let D=I.jitterBufferMs;const O=f-I.jitterBufferEmittedCount;O>0&&(D=1e3*(m-I.jitterBufferDelay)/O),i.jitterBufferMs=Math.round(D),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:m,jitterBufferEmittedCount:f,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=g;let T=1920;E&&p&&(T=p/E/50,i.receivedFrames=Math.round(p/T)),b&&(i.droppedFrames=Math.round(b/T))}processRemoteInboundStats(t,n){const i=this.report.get(t);i&&(n.packetsLost=i.packetsLost,i.roundTripTime&&(n.rttMs=1e3*i.roundTripTime),i.jitter&&(n.jitterMs=1e3*i.jitter),i.timestamp&&(n.timestamp=i.timestamp))}getCodecFromCodecStats(t){const n=this.report.get(t);if(!n)return"";const i=n.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let t=0,n=null,i=null;this.mediaBytesSent.forEach(o=>{t+=o.diffMean()}),this.mediaBytesRetransmit.forEach(o=>{n=null===n?o.diffMean():n+o.diffMean()}),this.mediaBytesTargetEncode.forEach(o=>{i=null===i?o.diffMean():i+o.diffMean()}),this._stats.bitrate={actualEncoded:8*(null!==n?t-n:t)/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},null!==n&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),null!==i&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}}class aLe extends hM{updateStats(){return q.resolve()}}function pM(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const o=function(){const s=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return s&&s[0]?Number(s[0].split("/")[1]):null}();return o?o<76?new sLe(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new c$(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):function(s){if(!window.RTCStatsReport)return!1;const a=s.getStats();return!(!(a instanceof q)&&(c=a,!c||"object"!=typeof c&&"function"!=typeof c||"function"!=typeof c.then));var c}(e)?new c$(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new aLe(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r})}let l$=class{get localCapabilities(){return dn(this._localCapabilities)}get rtpCapabilities(){return dn(this._rtpCapabilities)}get candidates(){return dn(this._candidates)}get iceParameters(){return dn(this._iceParameters)}get dtlsParameters(){return dn(this._dtlsParameters)}constructor(e){y(this,"sessionDesc",void 0),y(this,"_localCapabilities",void 0),y(this,"_rtpCapabilities",void 0),y(this,"_candidates",void 0),y(this,"_iceParameters",void 0),y(this,"_dtlsParameters",void 0),y(this,"setup",void 0),y(this,"currentMidIndex",void 0),y(this,"cname","o/i14u9pJrxRKAsu"),y(this,"firefoxSsrcMidMap",new Map),e=dn(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:r,localCapabilities:o,direction:s,setup:a,videoCodec:c,audioCodec:l}=e;let d;this.setup=a,d=Zn.parse(s===Xi.RECEIVE_ONLY?"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n":"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=r,this._candidates=i,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=o;const u=s===Xi.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,h=s===Xi.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,p=s===Xi.RECEIVE_ONLY?r.send.videoCodecs:Yg(ie.VIDEO,u,h,c),m=s===Xi.RECEIVE_ONLY?r.send.audioCodecs:Yg(ie.AUDIO,u,h,l);for(const f of d.mediaDescriptions)f.attributes.iceUfrag=t.iceUfrag,f.attributes.icePwd=t.icePwd,f.attributes.fingerprints=n.fingerprints,f.attributes.candidates=i,f.attributes.setup=this.setup,"application"===f.media.mediaType&&(f.attributes.sctpPort="5000"),"video"===f.media.mediaType&&(f.media.fmts=p.map(g=>g.payloadType.toString(10)),f.attributes.payloads=p,f.attributes.extmaps=u.videoExtensions),"audio"===f.media.mediaType&&(f.media.fmts=m.map(g=>g.payloadType.toString(10)),f.attributes.payloads=m,f.attributes.extmaps=u.audioExtensions,Ip(f));this.sessionDesc=d,this.currentMidIndex=d.mediaDescriptions.length-1}toString(){return Zn.print(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,i,r){n=n.replace(/ /g,"-");const{ssrcs:o,ssrcGroups:s}=Md(t,this.cname,R("SYNC_GROUP")?n:void 0),a=this.findPreloadMediaDesc(o);if(a){if(Bt()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,a.attributes.mid),r&&(r.twcc||r.remb)){const c=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(a,r),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const c=this.findAvailableMediaIndex(e,o,i);let l;return-1===c?(l=this.createOrRecycleSendMedia(e,o,s,"sendonly",i,r),this.updateBundleMids()):(l=dn(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="sendonly",l.attributes.ssrcs=o,l.attributes.ssrcGroups=s,this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(l,r)),Bt()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,l.attributes.mid),{needExchangeSDP:!0,mid:l.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&-1!==e.indexOf(n.attributes.mid));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const i=[];return e.forEach(r=>{const s=this.findAvailableRecvMediaIndex(r._mediaStreamTrack.kind);let a,c=!1;-1===s?(c=!0,a=this.createOrRecycleRecvMedia(r,[],"recvonly",t,n),this.updateBundleMids()):(a=dn(this.sessionDesc.mediaDescriptions[s]),a.attributes.direction="recvonly"),i.push({mid:a.attributes.mid,needCreateTransceiver:c})}),i}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>-1!==e.indexOf(n.attributes.mid));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:i,port:r,type:o,relatedAddress:s,relatedPort:a,priority:c}=new RTCIceCandidate(e),l={foundation:t??"",componentId:"1",transport:n??"",priority:c?c+"":"",connectionAddress:i??"",port:r?r+"":"",type:o?o+"":"",relAddr:s??"",relPort:a?a+"":"",extension:{}};this.candidates.some(d=>d.priority===l.priority&&d.connectionAddress===l.connectionAddress&&d.port===l.port)||(this._candidates.push(l),this.sessionDesc.mediaDescriptions.forEach(d=>{d.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,i,r){const o=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,a=Yg(o,s,this.localCapabilities.send,o===ie.AUDIO?r:i),c=o===ie.VIDEO?s.videoExtensions:s.audioExtensions,l="".concat(++this.currentMidIndex);let d={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(h=>h.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungRecvMediaDsec(d,e);const u=this.findFirstClosedMedia(o);if(u){const h=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[h]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Y(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(n=>Y(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const r=i.media.mediaType===e&&"0"!==i.media.port&&("sendonly"===i.attributes.direction||"sendrecv"===i.attributes.direction)&&0===i.attributes.ssrcs.length;if(Bt()){if(r){const o=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(o||"0"!==i.attributes.mid&&"1"!==i.attributes.mid)||!(!o||o!==i.attributes.mid)}return!1}return r&&i.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>"0"!==t.attributes.mid&&"1"!==t.attributes.mid&&t.media.mediaType===e&&"0"!==t.media.port&&("recvonly"===t.attributes.direction||"sendrecv"===t.attributes.direction))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=dn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,i,r,o){const s=this.rtpCapabilities.send,a=e===ie.VIDEO?s.videoCodecs:s.audioCodecs,c=e===ie.VIDEO?s.videoExtensions:s.audioExtensions;Bt()&&(r="".concat(++this.currentMidIndex));let l={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(u=>u.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:r}};l=this.mungSendMediaDesc(l,o);const d=this.findFirstClosedMedia(e);if(d){const u=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[u]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}mungRecvMediaDsec(e,t,n){const i=dn(e);return BP(i),wp(i,t),jP(i,t),DY(i),KS(i,n,this.localCapabilities.send),i}mungSendMediaDesc(e,t){const n=dn(e);return KS(n,t,this.localCapabilities.recv),Ip(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(-1!==n){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>"0"!==e.media.port).map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Bt()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port)}};const cLe=["sdp"];var Et;function d$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function _l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d$(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d$(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let u$=(Et=class jp extends N7{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return null!==(t=null===(n=this.peerConnection.getReceivers()[0])||void 0===n||null===(n=n.transport)||void 0===n?void 0:n.state)&&void 0!==t?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,i){super(t,n),y(this,"direction",void 0),y(this,"name",void 0),y(this,"store",void 0),y(this,"spec",void 0),y(this,"peerConnection",void 0),y(this,"initialOffer",void 0),y(this,"transport",void 0),y(this,"statsFilter",void 0),y(this,"localCandidateCount",0),y(this,"_isInRestartIce",!1),y(this,"mutex",new gi("P2PConnection-mutex")),y(this,"onLocalCandidate",void 0),y(this,"remoteSDP",void 0),y(this,"pendingCandidates",[]),y(this,"localCapabilities",void 0),y(this,"isReady",!1),y(this,"restartCnt",0),y(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.peerConnection=new RTCPeerConnection(jp.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??Xi.SEND_ONLY,this.name=this.direction===Xi.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=pM(this.peerConnection,R("STATS_UPDATE_INTERVAL"),void 0,Bt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}establish(t){var n=this;return C(function*(){try{const i=yield NY();if(n.localCapabilities=qS(i),t){const{sdp:r}=t,o=function rLe(e,t){if(null==e)return{};var n,i,r=function(s,a){if(null==s)return{};var c,l,d={},u=T7(s);for(l=0;l<u.length;l++)c=u[l],JY(a).call(a,c)>=0||(d[c]=s[c]);return d}(e,t);if(XY){var o=XY(e);for(i=0;i<o.length;i++)n=o[i],JY(t).call(t,n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(t,cLe),s=function(){const u={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},h=qg(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},f={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ss(h,u,"videoExtensions",p,m,f),ss(h,u,"videoCodecs",p,m,f),ss(h,u,"audioExtensions",p,m,f),ss(h,u,"audioCodecs",p,m,f),R("RAISE_H264_BASELINE_PRIORITY")){const g=f.videoCodecs.findIndex(E=>E.rtpMap&&"h264"===E.rtpMap.encodingName.toLocaleLowerCase()&&E.fmtp&&"42001f"===E.fmtp.parameters["profile-level-id"]);if(-1!==g){const E=f.videoCodecs.findIndex(b=>b.rtpMap&&"h264"===b.rtpMap.encodingName.toLocaleLowerCase());if(E<g){_.debug("raising H264 baseline profile priority");const b=f.videoCodecs[g];f.videoCodecs.splice(g,1),f.videoCodecs.splice(E,0,b)}-1!==E&&R("FILTER_SEND_H264_BASELINE")&&(p.videoCodecs=p.videoCodecs.filter(b=>!(b.rtpMap&&"h264"===b.rtpMap.encodingName.toLocaleLowerCase()&&b.fmtp&&"42001f"!==b.fmtp.parameters["profile-level-id"])))}}return{send:p,recv:m,sendrecv:f}}({},{},r);n.remoteSDP=new l$({remoteIceParameters:o.iceParameters,remoteDtlsParameters:o.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:n.localCapabilities,direction:n.direction,setup:"actpass",videoCodec:n.store.codec,audioCodec:n.store.audioCodec}),yield n.setRemoteDescription({type:"offer",sdp:n.remoteSDP.toString()}),n.isReady=!0;const a=yield n.peerConnection.createAnswer();if(!a.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const c=ml(a.sdp);yield n.peerConnection.setLocalDescription(a);const l=yield PY({},{},a.sdp);n.localCapabilities=qS(l);const d=n.peerConnection.getTransceivers()[0];return null!=d&&d.receiver&&d.receiver.transport&&n.tryBindTransportEvents(d.receiver.transport),_l(_l({},c),{},{sdp:a.sdp})}{n.peerConnection.addTransceiver("video",{direction:"sendonly"}),n.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=yield n.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=ml(r.sdp);return n.initialOffer=r,_l(_l({},o),{},{sdp:r.sdp})}}catch(i){throw new M(S.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}})()}connect(t){var n=this;return C(function*(){try{if(!n.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");yield n.peerConnection.setLocalDescription(n.initialOffer);const{sdp:i,iceParameters:r,dtlsParameters:o}=t,s=yield PY({},{},i);n.remoteSDP=new l$({remoteIceParameters:r,remoteDtlsParameters:o,candidates:[],remoteRTPCapabilities:s,localCapabilities:n.localCapabilities,direction:n.direction,setup:"active",videoCodec:n.store.codec,audioCodec:n.store.audioCodec}),yield n.setRemoteDescription({type:"answer",sdp:n.remoteSDP.toString()});const a=n.peerConnection.getTransceivers()[0];null!=a&&a.sender&&a.sender.transport&&n.tryBindTransportEvents(a.sender.transport)}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}})()}addRemoteCandidate(t){var n=this;return C(function*(){try{t&&n.pendingCandidates.push(t),n.peerConnection.remoteDescription&&n.isReady&&(n.pendingCandidates.forEach(i=>{n.peerConnection.addIceCandidate(i)}),n.pendingCandidates=[])}catch(i){throw new M(S.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}})()}send(t,n,i){var r=this;return Ao(function*(){const o=yield Ne(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=[],a=r.remoteSDP.receive(t,n,i);t.forEach((g,E)=>{if(a[E].needCreateTransceiver){const b=r.peerConnection.addTransceiver(g._mediaStreamTrack,{direction:"sendonly"});s.push(b),g._updateRtpTransceiver(b)}else{const b=r.peerConnection.getTransceivers().find(T=>T.mid===a[E].mid);if(!b)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(a[E].mid));s.push(b),g._updateRtpTransceiver(b)}}),Bt()&&!0===R("SIMULCAST")&&(yield Ne(r.applySimulcastForFirefox(s,t)));const c=a.map(g=>g.mid),l=yield Ne(r.peerConnection.createOffer()),d=r.mungSendOfferSDP(l.sdp,t,c),u=Zn.parse(d),h=c.map(g=>{const E=u.mediaDescriptions.find(b=>b.attributes.mid===g);if(!E)throw new Error("Cannot extract ssrc from mediaDescription.");return IY(E,R("USE_PUB_RTX"))}),p=s.map((g,E)=>({localSSRC:h[E],id:c[E]}));yield Ne(r.peerConnection.setLocalDescription({type:"offer",sdp:d}));try{yield p}catch(g){const E=r.remoteSDP.toString();throw yield Ne(r.peerConnection.setLocalDescription({type:"offer",sdp:d})),yield Ne(r.peerConnection.setRemoteDescription({type:"answer",sdp:E})),yield Ne(r.stopSending(c,!0)),g}yield Ne(r.applySimulcastEncodings(s,t)),yield Ne(r.applySendEncodings(s,t));const m=r.remoteSDP.toString(),f=r.logSDPExchange(d,"offer","local","send");return f?.(m),yield Ne(r.setRemoteDescription({type:"answer",sdp:m})),s.map((g,E)=>({localSSRC:h[E],id:c[E]}))}catch(s){throw s instanceof M?s:new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{o()}})()}stopSending(t,n){var i=this;return C(function*(){const r=n?void 0:yield i.mutex.lock("From P2PConnection.stopSending");try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=i.peerConnection.getTransceivers().filter(l=>-1!==t.indexOf(l.mid));if(o.length!==t.length)throw new Error("Transceivers' length (".concat(o.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));o.map(l=>{var d;l.direction="inactive",null===(d=l.stop)||void 0===d||d.call(l)});const s=yield i.peerConnection.createOffer(),a=i.logSDPExchange(s.sdp||"","offer","local","stopSending");yield i.peerConnection.setLocalDescription(s),i.remoteSDP.stopReceiving(t);const c=i.remoteSDP.toString();a?.(c),yield i.setRemoteDescription({type:"answer",sdp:c})}catch(o){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{r&&r()}})()}receive(t,n,i,r){var o=this;return C(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:a}=o.remoteSDP.send(t,n,i,r);if(a){const l=o.remoteSDP.toString(),d=o.logSDPExchange(l,"offer","remote","receive");yield o.setRemoteDescription({type:"offer",sdp:l});const u=yield o.peerConnection.createAnswer(),h=o.mungReceiveAnswerSDP(u.sdp,s,t);d?.(h||""),yield o.peerConnection.setLocalDescription({type:"answer",sdp:h}),_.debug("[".concat(o.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else _.debug("[".concat(o.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const c=o.peerConnection.getTransceivers().find(l=>l.mid===s);if(!c||null===c.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,mid:c.mid,transceiver:c}}catch(s){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}})()}mockReceive(t,n,i,r){var o=this;return C(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:a}=o.remoteSDP.send(t,n,i,r);if(a){const c=o.remoteSDP.toString(),l=o.logSDPExchange(c,"offer","remote","receive");yield o.setRemoteDescription({type:"offer",sdp:c});const d=yield o.peerConnection.createAnswer(),u=o.mungReceiveAnswerSDP(d.sdp,s,t);l?.(u||""),yield o.peerConnection.setLocalDescription({type:"answer",sdp:u}),_.debug("[".concat(o.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else _.debug("[".concat(o.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(s){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}})()}stopReceiving(t){var n=this;return C(function*(){try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");n.remoteSDP.stopSending(t);const i=n.remoteSDP.toString(),r=n.logSDPExchange(i,"offer","remote","stopReceiving");yield n.setRemoteDescription({type:"offer",sdp:i});const o=yield n.peerConnection.createAnswer();r?.(o.sdp||""),yield n.peerConnection.setLocalDescription(o)}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}})()}restartICE(t){var n=this;return C(function*(){try{if(n.store.p2pTransport===Cd.Auto&&(n.store.p2pTransport=Cd.SdRtn,Fe().supportPCSetConfiguration&&n.peerConnection.setConfiguration(jp.resolvePCConfiguration(n.spec,n.store.p2pTransport))),n.restartCnt>3&&(n.restartCnt=0,Fe().supportPCSetConfiguration&&n.peerConnection.setConfiguration(jp.resolvePCConfiguration(n.spec,n.store.p2pTransport,++n.curTurnServerIndex))),!t){n.restartCnt++,n.isReady=!1;const i=yield n.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=ml(i.sdp);return n.store.descriptionStart(),n.direction===Xi.SEND_ONLY&&(yield n.peerConnection.setLocalDescription(i)),r}if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(n.remoteSDP.restartICE(t),n.store.descriptionStart(),n.direction===Xi.RECEIVE_ONLY){n.restartCnt++,yield n.setRemoteDescription({type:"offer",sdp:n.remoteSDP.toString()});const i=yield n.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=ml(i.sdp);return yield n.peerConnection.setLocalDescription(i),r}yield n.setRemoteDescription({type:"answer",sdp:n.remoteSDP.toString()}),n.isReady=!0}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}})()}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}updateEncoderConfig(t,n){var i=this;return C(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=yield i.peerConnection.createOffer(),o=i.mungSendOfferSDP(r.sdp,[n],[t]);i.remoteSDP.updateRecvMedia(t,n);const s=i.remoteSDP.toString(),a=i.logSDPExchange(o,"offer","local","updateEncoderConfig");yield i.peerConnection.setLocalDescription({type:"offer",sdp:o}),a?.(s),yield i.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new M(S.EXCHANGE_SDP_FAILED,r.toString())}})()}updateSendParameters(t,n){var i=this;return C(function*(){const r=i.peerConnection.getTransceivers().filter(o=>o.mid===t);1===r.length&&(i.isVP8Simulcast(n)?Bt()||(yield i.applySimulcastEncodings(r,[n])):yield i.applySendEncodings(r,[n]))})()}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}replaceTrack(t,n){var i=this;return C(function*(){const r=i.peerConnection.getTransceivers().find(o=>o.mid===n);r&&(yield r.sender.replaceTrack(t._mediaStreamTrack))})()}getSelectedCandidatePair(){var t=this;return C(function*(){const n=t.peerConnection.getReceivers();if(n.length>0&&n[0].transport&&n[0].transport.iceTransport&&n[0].transport.iceTransport.getSelectedCandidatePair&&n[0].transport.iceTransport.getSelectedCandidatePair()){const i=n[0].transport.iceTransport,{local:r,remote:o}=i.getSelectedCandidatePair();return{local:_l(_l({},Da),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:_l(_l({},Da),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return t.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;Y(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),null===(n=this.onICEConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;"connected"===this.peerConnection.connectionState&&(this.restartCnt=0),null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{var n;t.candidate?(t.candidate.candidate&&(null===(n=this.onLocalCandidate)||void 0===n||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1):_.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r={iceServers:[]};var o;return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(pS(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...jp.turnServerConfigToIceServers(t.turnServer.servers,n,i)),R("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...jp.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,i)),Y(o=[Cd.Relay,Cd.SdRtn]).call(o,n)&&(r.iceTransportPolicy="relay"),R("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(r.iceTransportPolicy="relay")}))),R("ENABLE_ENCODED_TRANSFORM")&&Fe().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),_.debug("P2PConnection p2pTransport is ".concat(n)),r}static turnServerConfigToIceServers(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=[],o=t.filter(a=>a.tcpport);_.debug("P2PConnection turnServers is ".concat(o,", current index is ").concat(i));const s=o.length>i?o[i]:o[0];switch(n){case Cd.SdRtn:const a=t.filter(l=>{var d;return Y(d=l.username).call(d,"glb:")&&l.turnServerURL==l.turnServerURL}),c=a.length>i?a[i]:a[0];c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(ap(c.turnServerURL),":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(ap(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;case Cd.Relay:s&&(r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=udp")}),r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(ap(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}));break;default:s&&(r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=udp")}),r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(ap(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}),r.push({username:s.username,credential:s.password,credentialType:"password",urls:"stun:".concat(s.turnServerURL,":").concat(s.tcpport)}))}return r}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var i;null!=t&&t.state&&(null===(i=this.onDTLSTransportStateChange)||void 0===i||i.call(this,t.state))},t.onerror=i=>{var r;null===(r=this.onDTLSTransportError)||void 0===r||r.call(this,"error"in i?i.error:i)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const i=t?.iceTransport.state;var r;i&&(null===(r=this.onICETransportStateChange)||void 0===r||r.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:r}=n.getSelectedCandidatePair();_.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(t,n){var i=this;return C(function*(){var r;if(n||(n=i.peerConnection.getSenders().find(u=>u.track===t._mediaStreamTrack)),!n)return _.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(i.isVP8Simulcast(t))return _.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Fe().supportSetRtpSenderParameters)return _.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const o={},s={};switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(t._encoderConfig){var a;const{bitrateMax:u,frameRate:h,scaleResolutionDownBy:p}=t._encoderConfig;u&&(s.maxBitrate=1e3*u),Y(a=t._hints).call(a,ft.LOW_STREAM)&&(h&&(s.maxFramerate=kr(h)),p&&p>=1&&(s.scaleResolutionDownBy=p))}if(R("DSCP_TYPE")&&sl()){var c;const u=R("DSCP_TYPE");Y(c=["very-low","low","medium","high"]).call(c,u)&&(s.networkPriority=u)}const l=n.getParameters(),d=null===(r=l.encodings)||void 0===r?void 0:r[0];Bt()&&!d&&(o.encodings=[s]),d&&Object.assign(d,s),Object.assign(l,o),_.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),yield n.setParameters(l)})()}applySendEncodings(t,n){var i=this;return C(function*(){try{if(!Fe().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const o=t[r],s=n[r];s instanceof St&&!i.isVP8Simulcast(s)&&(yield i.updateRtpSenderEncodings(s,o.sender))}}catch{_.debug("[".concat(i.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(t,n,i){const r=Zn.parse(t);return n.forEach((o,s)=>{const a=i[s],c=r.mediaDescriptions.find(l=>l.attributes.mid===a);c&&(wp(c,o),OY(c,o,this.store.codec))}),Zn.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;null===(n=this.onFirstAudioReceived)||void 0===n||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;null===(n=this.onFirstVideoReceived)||void 0===n||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;null===(n=this.onFirstAudioDecoded)||void 0===n||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;null===(i=this.onSelectedLocalCandidateChanged)||void 0===i||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;null===(i=this.onSelectedRemoteCandidateChanged)||void 0===i||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;null===(n=this.onFirstVideoDecodedTimeout)||void 0===n||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(t,n){var i=this;return C(function*(){if(t.length===n.length)for(let l=0;l<t.length;l++){var r,o,s,a,c;const d=t[l],u=n[l];if(u instanceof St&&!Y(r=u._hints).call(r,ft.LOW_STREAM)&&null!==(o=u._encoderConfig)&&void 0!==o&&o.bitrateMax&&(null===(s=u._encoderConfig)||void 0===s?void 0:s.bitrateMax)>200&&null!==(a=u._scalabilityMode)&&void 0!==a&&a.numSpatialLayers&&(null===(c=u._scalabilityMode)||void 0===c?void 0:c.numSpatialLayers)>1&&"vp8"===i.store.codec){const h={},p={high:1e3*(u._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{rid:"m",active:!0,maxBitrate:p.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:p.high}];const m=d.sender.getParameters();yield d.sender.setParameters(Object.assign(m,h))}}})()}applySimulcastEncodings(t,n){var i=this;return C(function*(){if(!Bt()&&t.length===n.length)for(let r=0;r<t.length;r++){const o=n[r];if(o instanceof St&&i.isVP8Simulcast(o)){const s=t[r],a={},c={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const l=s.sender.getParameters();yield s.sender.setParameters(Object.assign(l,a))}}})()}isVP8Simulcast(t){var n,i,r,o,s;return!!(t instanceof St&&R("SIMULCAST")&&"vp8"===this.store.codec&&!Y(n=t._hints).call(n,ft.LOW_STREAM)&&null!==(i=t._encoderConfig)&&void 0!==i&&i.bitrateMax&&(null===(r=t._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(o=t._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(s=t._scalabilityMode)||void 0===s?void 0:s.numSpatialLayers)>1)}logSDPExchange(t,n,i,r){if(R("SDP_LOGGING"))return _.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,"\n"),t),"offer"===n?o=>{this.logSDPExchange(o,"answer","local"===i?"remote":"local",r)}:void 0}muteLocal(t){var n=this;return C(function*(){try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=n.peerConnection.getTransceivers().filter(a=>a.mid&&-1!==t.indexOf(a.mid));if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(a=>{a.direction="inactive"});const r=yield n.peerConnection.createOffer(),o=n.logSDPExchange(r.sdp||"","offer","local","muteLocal");yield n.peerConnection.setLocalDescription(r),n.remoteSDP.muteRemote(t);const s=n.remoteSDP.toString();o?.(s),yield n.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}})()}unmuteLocal(t){var n=this;return C(function*(){try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=n.peerConnection.getTransceivers().filter(a=>a.mid&&-1!==t.indexOf(a.mid));if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(function(){var a=C(function*(c){c.direction="sendonly"});return function(c){return a.apply(this,arguments)}}());const r=yield n.peerConnection.createOffer(),o=n.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");yield n.peerConnection.setLocalDescription(r),n.remoteSDP.unmuteRemote(t);const s=n.remoteSDP.toString();o?.(s),yield n.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}})()}getRemoteSSRC(t,n){var i=this;return C(function*(){var r,o;if(n=null!==(r=n)&&void 0!==r?r:null===(o=i.currentRemoteDescription)||void 0===o?void 0:o.sdp){var s;const a=null===(s=Zn.parse(n).mediaDescriptions.find(c=>c.attributes.mid===t))||void 0===s?void 0:s.attributes.ssrcs;return a?.[0].ssrcId}})()}setRemoteDescription(t){var n=this;return C(function*(){var i;yield n.peerConnection.setRemoteDescription(t),Y(i=["connected","completed"]).call(i,n.peerConnection.iceConnectionState)||(n.isReady=!0,n.addRemoteCandidate())})()}mungReceiveAnswerSDP(t,n,i){const r=Zn.parse(t),o=r.mediaDescriptions.find(s=>s.attributes.mid===n);return o&&i===ie.AUDIO&&"audio"===o.media.mediaType&&Ip(o),Zn.print(r)}},Q(Et.prototype,"establish",[cs],Object.getOwnPropertyDescriptor(Et.prototype,"establish"),Et.prototype),Q(Et.prototype,"connect",[cs],Object.getOwnPropertyDescriptor(Et.prototype,"connect"),Et.prototype),Q(Et.prototype,"receive",[cs],Object.getOwnPropertyDescriptor(Et.prototype,"receive"),Et.prototype),Q(Et.prototype,"mockReceive",[cs],Object.getOwnPropertyDescriptor(Et.prototype,"mockReceive"),Et.prototype),Q(Et.prototype,"stopReceiving",[cs],Object.getOwnPropertyDescriptor(Et.prototype,"stopReceiving"),Et.prototype),Q(Et.prototype,"restartICE",[cs],Object.getOwnPropertyDescriptor(Et.prototype,"restartICE"),Et.prototype),Q(Et.prototype,"close",[cs],Object.getOwnPropertyDescriptor(Et.prototype,"close"),Et.prototype),Q(Et.prototype,"updateEncoderConfig",[cs],Object.getOwnPropertyDescriptor(Et.prototype,"updateEncoderConfig"),Et.prototype),Q(Et.prototype,"updateSendParameters",[cs],Object.getOwnPropertyDescriptor(Et.prototype,"updateSendParameters"),Et.prototype),Q(Et.prototype,"replaceTrack",[cs],Object.getOwnPropertyDescriptor(Et.prototype,"replaceTrack"),Et.prototype),Q(Et.prototype,"muteLocal",[cs],Object.getOwnPropertyDescriptor(Et.prototype,"muteLocal"),Et.prototype),Q(Et.prototype,"unmuteLocal",[cs],Object.getOwnPropertyDescriptor(Et.prototype,"unmuteLocal"),Et.prototype),Et);function cs(e,t,n){const i=e[t];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return n.value=C(function*(){const r=this.mutex,o=yield r.lock("From P2PConnection.".concat(t));try{for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];return yield i.apply(this,a)}finally{o()}}),n}function fM(e,t){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=kr(t.width),i.height=kr(t.height);const r=kr(t.framerate||15);document.body.append(n),document.body.append(i);let o=e._mediaStreamTrack;n.srcObject=new MediaStream([o]),n.play();const s=i.getContext("2d");if(!s)throw new N(S.UNEXPECTED_ERROR,"can not get canvas context");const a=Fe(),c=i.captureStream(a.supportRequestFrame?0:r).getVideoTracks()[0];c.canvas||(c.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const h=i.width*(n.videoHeight/n.videoWidth);Math.abs(h-i.height)>=2&&(_.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(h)),i.height=h)}s.drawImage(n,0,0,i.width,i.height),c.requestFrame&&c.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,n.srcObject=new MediaStream([o]))},i.stopCapture=wP(()=>i.startCapture&&i.startCapture(),r);const l=c.stop;return c.stop=()=>{l.call(c),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),_.debug("clean low stream renderer")},c}var QS=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(QS||{}),Fn=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e}(Fn||{}),kd=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(kd||{}),Ri=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e}(Ri||{}),Ld=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(Ld||{}),h$=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(h$||{}),mc=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e}(mc||{}),ls=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e}(ls||{}),p$=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(p$||{}),xo=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e}(xo||{});function Ee(e,t,n){null!=n&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function f$(e){const t={[xo.CONN_TYPE]:0,[xo.RTT]:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===n&&(t[xo.CONN_TYPE]=1),"tcp"===n&&(t[xo.CONN_TYPE]=3),"tls"===n&&(t[xo.CONN_TYPE]=4);break}case"srflx":t[xo.CONN_TYPE]=2}return t}function m$(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class g$ extends kt{constructor(t){super(),y(this,"store",void 0),y(this,"uploadWRTCStatsTimer",void 0),y(this,"uploadOutboundDenoiserStatsTimer",void 0),y(this,"uploadExtStatsTimer",void 0),y(this,"uploadExtUsageStatsTimer",void 0),y(this,"uploadInboundExtStatsTimer",void 0),y(this,"requestStats",void 0),y(this,"requestTransportStats",void 0),y(this,"requestLocalMedia",void 0),y(this,"requestRemoteMedia",void 0),y(this,"requestAllTracks",void 0),y(this,"requestVideoIsReady",void 0),y(this,"requestUploadStats",void 0),y(this,"requestUpload",void 0),y(this,"uploadOutboundStarted",!1),y(this,"uploadInboundStarted",!1),y(this,"uploadTransportStarted",!1),y(this,"uploadExtensionUsageStarted",!1),y(this,"lastRecvStats",void 0),y(this,"lastSendStats",void 0),y(this,"lastFullRecvStats",void 0),y(this,"lastFullSendStats",void 0),y(this,"needUploadRenderFreezeTime",!0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let n,i;if(this.uploadTransportStarted&&(n=this.requestStats(),this.store.useP2P&&(i=this.requestStats(!0))),!n&&this.uploadOutboundStarted&&(n=this.requestStats()),!i&&this.uploadInboundStarted&&(i=this.requestStats(!0)),n||i){const r={};if(this.uploadTransportStarted&&n){const o=this.getTransportStats(n,i,t);o&&(r.misc=[o])}if(this.uploadOutboundStarted&&n){const o=this.getOutboundStats(n,t?this.lastSendStats:this.lastFullSendStats,t);o&&(r.outbound=[o])}if(this.uploadInboundStarted&&i){const o=this.getInboundStats(i,t?this.lastRecvStats:this.lastFullRecvStats,t);o&&(r.inbound=o)}this.requestUploadStats(r)}this.lastRecvStats=i,this.lastSendStats=n,t||(this.lastFullRecvStats=i,this.lastFullSendStats=n)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(3!==t),4==++t&&(t=1)},1e3)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(t,n,i){if(!this.requestStats)return;if(i)return null==t.rtt?void 0:{addition:{[xo.RTT]:t.rtt,[xo.CONN_TYPE]:void 0}};const r=f$(t);if(this.store.useP2P){if(n){const o=f$(n);r[xo.CONN_TYPE]+=o[xo.CONN_TYPE]<<3}r[xo.CONN_TYPE]+=110}else r[xo.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(t,n,i){if(!this.requestUploadStats||!this.requestLocalMedia)return;const r=this.requestLocalMedia();if(!r||0===r.length)return;let o,s,a;return r.forEach(c=>{let[l,{track:d,ssrcs:u}]=c;switch(l){case j.LocalVideoLowTrack:case j.LocalVideoTrack:if(l===j.LocalVideoTrack){const h=function(f,g,E,b,T){const I=g.videoSend.find(ee=>ee.ssrc===f);if(!I)return;const D={},{sentFrame:O,inputFrame:k}=I;if(k&&O&&(D[Fn.FREEZE]=function(Ie,Ue){let Dt=!0;return Dt=!(Ie<=5)&&(Ie<=10?Ue<3:Ie<=20?Ue<4:Ue<5),Dt}(k.frameRate,O.frameRate)?1:0),Ee(D,Fn.QP_SUM,I.qpSumPerFrame),T)return D;switch(O&&(Ee(D,Fn.HEIGHT,O.height),Ee(D,Fn.WIDTH,O.width),Ee(D,Fn.FRAME_RATE,O.frameRate)),D[Fn.DISABLED]=b._originMediaStreamTrack&&!b._originMediaStreamTrack.enabled||b._mediaStreamTrack&&!b._mediaStreamTrack.enabled?1:0,I.adaptionChangeReason){case"none":D[Fn.ADAPTATION]=0;break;case"cpu":D[Fn.ADAPTATION]=1;break;case"bandwidth":D[Fn.ADAPTATION]=2;break;case"other":D[Fn.ADAPTATION]=3}let L=0;I.adaptionChangeReason&&(L+=m$(I.adaptionChangeReason)),g.qualityLimitationReason&&(L+=m$(g.qualityLimitationReason)<<3),D[Fn.ADAPTATION]=L,D[Fn.PLAYER_STATUS]=CP[b._player?b._player.videoElementStatus:"uninit"],Ee(D,Fn.NACKS,I.nacksCount),Ee(D,Fn.PLIS,I.plisCount),Ee(D,Fn.FIRS,I.firsCount),Ee(D,Fn.AVG_ENCODE,I.avgEncodeMs);const V=E&&E.videoSend.find(ee=>ee.ssrc===f);if(V){let ee=T?1e3:3e3;V.timestamp&&I.timestamp&&(ee=I.timestamp-V.timestamp),null!=V.packets&&null!=I.packets&&Ee(D,Fn.PACKAGE_RATE,1e3*(I.packets-V.packets)/ee),null!=I.packetsLost&&null!=V.packetsLost&&Ee(D,Fn.PACKAGE_LOST,I.packetsLost-V.packetsLost),null!=V.bytes&&null!=I.bytes&&Ee(D,Fn.BITRATE,8*(I.bytes-V.bytes)/ee)}return D}(u[0].ssrcId,t,n,d,i),p=i?null:function(f,g,E){const b=g.videoSend.find(L=>L.ssrc===f);if(!b)return null;const T={},I=b.inputFrame,O=I&&I.width||E&&E.videoWidth||0,k=I&&I.frameRate||0;return Ee(T,QS.HEIGHT,I&&I.height||E&&E.videoHeight||0),Ee(T,QS.WIDTH,O),Ee(T,QS.FRAME_RATE,k),T}(u[0].ssrcId,t,d),m=i?null:function(f){const g={};return Ee(g,Fn.RETRANSMIT,f.bitrate.retransmit),Ee(g,Fn.TARGET_ENCODED,f.bitrate.targetEncoded),Ee(g,Fn.ACTUAL_ENCODED,f.bitrate.actualEncoded),Ee(g,Fn.TRANSMIT,f.bitrate.transmit),Ee(g,Fn.BANDWIDTH,f.sendBandwidth),g}(t);s=Object.assign({},h,p,m)}else a=i?void 0:function(h,p,m){const f=p.videoSend.find(b=>b.ssrc===h);if(!f)return;const g={},E=f.sentFrame;if(E&&(Ee(g,kd.HEIGHT,E.height),Ee(g,kd.WIDTH,E.width),Ee(g,kd.FRAME_RATE,E.frameRate)),m){const b=m.videoSend.find(T=>T.ssrc===h);if(b){let T=3e3;b.timestamp&&f.timestamp&&(T=f.timestamp-b.timestamp),null!=b.packets&&null!=f.packets&&Ee(g,kd.PACKAGE_RATE,1e3*(f.packets-b.packets)/T),null!=f.packetsLost&&null!=b.packetsLost&&Ee(g,kd.PACKAGE_LOST,f.packetsLost-b.packetsLost),null!=b.bytes&&null!=f.bytes&&Ee(g,kd.BITRATE,8*(f.bytes-b.bytes)/T)}}return g}(u[0].ssrcId,t,n);break;case j.LocalAudioTrack:o=i?void 0:function(h,p,m,f){const g=p.audioSend.find(D=>D.ssrc===h);if(!g)return;const E={};E[mc.DISABLED]=f._originMediaStreamTrack&&!f._originMediaStreamTrack.enabled||f._mediaStreamTrack&&!f._mediaStreamTrack.enabled?1:0;const b=100*f._source.getAccurateVolumeLevel(),T=g.inputLevel;if(null!=T){const D=Math.ceil(50*Math.log10(100*T+1));Ee(E,mc.LEVEL,D)}else Ee(E,mc.LEVEL,b);Ee(E,h$.PCM_LEVEL,b),Ee(E,mc.AEC_RETURN_LOSS,g.aecReturnLoss),Ee(E,mc.AEC_RETURN_LOSS_ENH,g.aecReturnLossEnhancement),E[mc.FREEZE]=0;const I=m&&m.audioSend.find(D=>D.ssrc===h);if(I){let D=3e3;I.timestamp&&g.timestamp&&(D=g.timestamp-I.timestamp),null!=I.bytes&&null!=g.bytes&&Ee(E,mc.BITRATE,8*(g.bytes-I.bytes)/D),null!=I.packets&&null!=g.packets&&Ee(E,mc.PACKAGE_RATE,1e3*(g.packets-I.packets)/D)}return E}(u[0].ssrcId,t,n,d)}}),{high:s,low:a,audio:o}}getInboundStats(t,n,i){if(!this.requestRemoteMedia)return;const r=this.requestRemoteMedia()||[],o=[];return r.forEach(s=>{let[a,c]=s;const l={peer:a.uid};if(c.has(ie.VIDEO)&&a.videoTrack){const d=a._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(a._videoSSRC)||!1,u=a.videoTrack?function(h,p,m,f,g,E,b){var T;const I=p.videoRecv.find(oe=>oe.ssrc===h);if(!I)return;const D={},{receivedFrame:O,outputFrame:k,decodeFrameRate:L}=I,V=m&&m.videoRecv.find(oe=>oe.ssrc===h);if(D[Ri.FREEZE]=g&&Jg.isRemoteVideoFreeze(f,I,V)?1:0,Ee(D,Ld.FRAME_RATE_DECODE,L),Ee(D,Ri.QP_SUM,I.qpSumPerFrame),I.framesRateFirefox&&Ee(D,Ri.FRAME_RATE,I.framesRateFirefox),O&&Ee(D,Ri.FRAME_RATE,O.frameRate),V){const oe=p.timestamp-m.timestamp||(b?1e3:3e3);null!=I.packetsLost&&null!=V.packetsLost&&Ee(D,Ri.PACKAGE_LOST,I.packetsLost-V.packetsLost),null!=V.bytes&&null!=I.bytes&&Ee(D,Ri.BITRATE,8*(I.bytes-V.bytes)/oe),null!=V.packets&&null!=I.packets&&Ee(D,Ri.PACKAGE_RATE,1e3*(I.packets-V.packets)/oe)}if(b)return D;O?(Ee(D,Ri.HEIGHT,O.height),Ee(D,Ri.WIDTH,O.width)):f&&(Ee(D,Ri.HEIGHT,f._videoHeight||0),Ee(D,Ri.WIDTH,f._videoWidth||0)),k&&Ee(D,Ld.FRAME_RATE_OUTPUT,k.frameRate);const ee=null===(T=f._player)||void 0===T?void 0:T.rendFrameRate.toFixed(0);if(ee&&Ee(D,Ld.FRAME_RATE_RENDER,+ee),Ee(D,Ri.JITTER_BUFFER,I.jitterBufferMs),Ee(D,Ri.CURRENT_DELAY,I.currentDelayMs),Ee(D,Ri.FIRS,I.firsCount),Ee(D,Ri.NACKS,I.nacksCount),Ee(D,Ri.PLIS,I.plisCount),f){D[Ri.DISABLED]=f._originMediaStreamTrack.enabled&&f._mediaStreamTrack.enabled?0:1;const oe=f._player;if(oe){const{freezeTimeCounterList:Ie,renderFreezeAccTime:Ue,videoElementStatus:Dt}=oe;if(Ie&&Ie.length>0&&Ee(D,Ld.FREEZE_TIME,Ie.splice(0,1)[0]),E&&"visible"===fc.visibility&&Dt===Li.PLAYING&&Fe().supportRequestVideoFrameCallback){const dt=Math.min(6e3,Ue);oe.renderFreezeAccTime=Math.max(0,Ue-dt),Ee(D,Ld.FREEZE_TIME_RENDER,dt)}"number"==typeof I.totalFreezesDuration&&Ee(D,Ld.FREEZE_DURATION,1e3*(V&&V.totalFreezesDuration?I.totalFreezesDuration-V.totalFreezesDuration:I.totalFreezesDuration))}}if(D[Ri.PLAYER_STATUS]=CP[f._player?f._player.videoElementStatus:"uninit"],V&&void 0!==I.totalInterFrameDelay&&void 0!==I.totalSquaredInterFrameDelay&&void 0!==V.totalInterFrameDelay&&void 0!==V.totalSquaredInterFrameDelay){const oe=I.totalInterFrameDelay-V.totalInterFrameDelay,Ue=I.framesDecodeCount-V.framesDecodeCount,Dt=oe/Ue*1e3,dt=Math.round(1e3*Math.sqrt((I.totalSquaredInterFrameDelay-V.totalSquaredInterFrameDelay-Math.pow(oe,2)/Ue)/Ue));!isNaN(dt)&&Dt+dt>Math.max(3*Dt,Dt+150)&&(D[Ri.I_FRAME_DELAY]=dt)}return D}(a._videoSSRC,t,n,a.videoTrack,!0===d,this.needUploadRenderFreezeTime,i):void 0;u&&(l.video=u)}if(c.has(ie.AUDIO)&&a.audioTrack){const d=a.audioTrack?function(u,h,p,m,f){const g=h.audioRecv.find(V=>V.ssrc===u);if(!g)return;const E={},b=p&&p.audioRecv.find(V=>V.ssrc===u),{receivedFrames:T,droppedFrames:I}=g;var D;if(Ee(E,ls.JITTER,g.jitterMs),null!=T&&null!=I&&(E[ls.FREEZE]=0===(D=T)||100*I/D>20?1:0),b){const V=h.timestamp-p.timestamp||(f?1e3:3e3);null!=g.packets&&null!=b.packets&&Ee(E,ls.PACKAGE_RATE,1e3*(g.packets-b.packets)/V),null!=b.bytes&&null!=g.bytes&&Ee(E,ls.BITRATE,8*(g.bytes-b.bytes)/V),null!=g.packetsLost&&null!=b.packetsLost&&Ee(E,ls.PACKAGE_LOST,g.packetsLost-b.packetsLost)}if(f)return E;const k=100*m._source.getAccurateVolumeLevel(),L=g.outputLevel;if(null!=L){const V=Math.ceil(50*Math.log10(100*L+1));Ee(E,p$.LEVEL,V)}if(Ee(E,ls.PCM_LEVEL,k),m&&(E[ls.DISABLED]=m._originMediaStreamTrack.enabled&&m._mediaStreamTrack.enabled?0:1),Ee(E,ls.JITTER_BUFFER,g.jitterBufferMs),Ee(E,ls.CURRENT_DELAY,g.jitterBufferMs),E[ls.PLAYER_STATUS]=CP[ir.getPlayerState(m.getTrackId())],b){const V=g.concealedSamples-b.concealedSamples;V>0&&Ee(E,ls.CONCEALED_SAMPLES,V)}return E}(a._audioSSRC,t,n,a.audioTrack,i):void 0;d&&(l.audio=d)}(l.video||l.audio)&&o.push(l)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,o}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find(n=>n instanceof jS);if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(Lg.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,i]=t;i.has(ie.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)}),i.has(ie.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){var t=this;if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const n=new Map;this.uploadExtUsageStatsTimer=window.setInterval(C(function*(){const i=Date.now(),r={connectionInterval:R("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let o=[];const s=t.requestAllTracks&&t.requestAllTracks()||[];for(const d of s)!d.muted&&d.enabled&&(o=o.concat(yield d.getProcessorUsage()));const a=t.requestRemoteMedia&&t.requestRemoteMedia()||[];for(const[d,u]of a)u.has(ie.VIDEO)&&d.videoTrack&&(o=o.concat(yield d.videoTrack.getProcessorUsage())),u.has(ie.AUDIO)&&d.audioTrack&&(o=o.concat(yield d.audioTrack.getProcessorUsage()));if(0===o.length)return;r.details=function(d,u){const h={};for(const{id:g,value:E,level:b,direction:T}of d){var p;const I=null!==(p=u.get(g))&&void 0!==p?p:0,D=2===E?I+R("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:I;var m,f;u.set(g,D),h[g]?(2===E&&(h[g].value=E),b>h[g].level&&(h[g].level=b),"remote"===T&&(h[g].remoteUidCount+=1),h[g].totalTs=null!==(m=u.get(g))&&void 0!==m?m:0):h[g]={value:E,level:b,remoteUidCount:"local"===T?0:1,totalTs:null!==(f=u.get(g))&&void 0!==f?f:0}}return Object.keys(h).map(g=>{const{level:E,value:b,totalTs:T}=h[g];return{id:g,level:E,value:b,totalTs:T}})}(o,n);const c=Date.now();t.requestUpload&&t.requestUpload(Lg.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:c>i?c:i+1})}),R("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class vl{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){y(this,"uid",void 0),y(this,"_uintid",void 0),y(this,"_trust_in_room_",!0),y(this,"_trust_audio_enabled_state_",!0),y(this,"_trust_video_enabled_state_",!0),y(this,"_trust_audio_mute_state_",!0),y(this,"_trust_video_mute_state_",!0),y(this,"_audio_muted_",!1),y(this,"_video_muted_",!1),y(this,"_audio_enabled_",!0),y(this,"_video_enabled_",!0),y(this,"_audio_added_",!1),y(this,"_video_added_",!1),y(this,"_is_pre_created",!1),y(this,"_video_pre_subscribed",!1),y(this,"_audio_pre_subscribed",!1),y(this,"_trust_video_stream_added_state_",!0),y(this,"_trust_audio_stream_added_state_",!0),y(this,"_audioTrack",void 0),y(this,"_videoTrack",void 0),y(this,"_dataChannels",[]),y(this,"_audioSSRC",void 0),y(this,"_videoSSRC",void 0),y(this,"_audioOrtc",void 0),y(this,"_videoOrtc",void 0),y(this,"_cname",void 0),y(this,"_rtxSsrcId",void 0),y(this,"_videoMid",void 0),y(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}let js=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function lLe(e,t){var n;let i;switch(t){case j.LocalAudioTrack:i=$e.Audio;break;case j.LocalVideoTrack:i=Y(n=e._hints).call(n,ft.SCREEN_TRACK)?$e.Screen:$e.High;break;case j.LocalVideoLowTrack:i=$e.Low}return i}function mM(e){const t=Fe();if(e.some(n=>n._bypassWebAudio))throw new M(S.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new M(S.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function gM(e,t){mM(e);const n=t||new wn;return e.forEach(i=>n.addAudioTrack(i)),n}var _$,v$,E$,b$,y$,S$,C$,T$,w$,I$,R$,At;function A$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function eC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A$(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A$(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Fr=(_$=Hs(js.SEND_ONLY),v$=Hs(js.SEND_ONLY),E$=Hs(),b$=Hs(js.RECEIVE_ONLY),y$=Hs(js.RECEIVE_ONLY),S$=Hs(js.RECEIVE_ONLY),C$=Hs(js.RECEIVE_ONLY),T$=Hs(js.RECEIVE_ONLY),w$=Hs(js.RECEIVE_ONLY),I$=Hs(),R$=Hs(js.RECEIVE_ONLY),At=class extends kt{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(de.StateChange,t,this._state)}constructor(e,t){var n;super(),n=this,y(this,"isPlanB",!1),y(this,"store",void 0),y(this,"statsUploader",void 0),y(this,"sendConnection",void 0),y(this,"recvConnection",void 0),y(this,"localTrackMap",new Map),y(this,"remoteUserMap",new Map),y(this,"localDataChannels",[]),y(this,"pendingLocalTracks",[]),y(this,"pendingRemoteTracks",[]),y(this,"statsCollector",void 0),y(this,"dtlsFailedCount",0),y(this,"sendMutex",new gi("P2PChannel2-send-mutex")),y(this,"recvMutex",new gi("P2PChannel2-recv-mutex")),y(this,"_state",Xe.Disconnected),y(this,"_restartStates",["disconnected","failed"]),y(this,"reconnectInterval",void 0),y(this,"uploadUnplinkStarted",!1),y(this,"uploadDownlinkStarted",!1),y(this,"uplinkStateUploadInterval",void 0),y(this,"downlinkStatsUploadInterval",void 0),y(this,"handleMuteLocalTrack",function(){var i=C(function*(r,o,s){const a=yield n.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!n.sendConnection||n.state!==Xe.Connected)return void s(new M(S.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const d=n.filterTobeMutedTracks(r);if(0===d.length)return void o();const u=d.find(f=>"videoLowTrack"===f[0]);u&&u[1].track._originMediaStreamTrack.stop(),yield n.sendConnection.muteLocal(d.map(f=>{let[,{id:g}]=f;return g}));let h=!1;var c,l;h="video"===r.trackMediaType?!(null===(c=n.localTrackMap.get(j.LocalAudioTrack))||void 0===c||!c.track._muted):void 0===(null===(l=n.localTrackMap.get(j.LocalVideoTrack))||void 0===l?void 0:l.id);const p=n.createMuteMessage(d);yield ct(n,de.RequestMuteLocal,p);const m="video"===r.trackMediaType?ul.MUTE_LOCAL_VIDEO:ul.MUTE_LOCAL_AUDIO;yield ct(n,de.RequestP2PMuteLocal,{action:m,message:p,isMuteAll:h}),o()}catch(d){s(d)}finally{a()}});return function(r,o,s){return i.apply(this,arguments)}}()),y(this,"handleUnmuteLocalTrack",function(){var i=C(function*(r,o,s){const a=yield n.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!n.sendConnection||n.state!==Xe.Connected)return void s(new M(S.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const c=n.filterTobeUnmutedTracks(r);if(0===c.length)return void o();yield n.sendConnection.unmuteLocal(c.map(u=>{let[,{id:h}]=u;return h}));const l=n.createUnmuteMessage(c),d="video"===r.trackMediaType?ul.UNMUTE_LOCAL_VIDEO:ul.UNMUTE_LOCAL_AUDIO;yield ct(n,de.RequestP2PMuteLocal,{action:d,message:l}),o()}catch(c){s(c)}finally{a()}});return function(r,o,s){return i.apply(this,arguments)}}()),y(this,"handleUpdateVideoEncoder",function(){var i=C(function*(r,o,s){const a=yield n.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const c=n.localTrackMap.get(j.LocalVideoTrack);if(!n.sendConnection||!c||c.track!==r||n.state!==Xe.Connected)return void o();const{id:l,track:d}=c;l&&(yield n.sendConnection.updateSendParameters(l,d),yield n.sendConnection.updateEncoderConfig(l,d),n.emit(de.UpdateVideoEncoder,d)),o()}catch(c){s(c)}finally{a()}});return function(r,o,s){return i.apply(this,arguments)}}()),y(this,"handleUpdateVideoSendParameters",function(){var i=C(function*(r,o,s){const a=yield n.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const c=n.localTrackMap.get(j.LocalVideoTrack);if(!n.sendConnection||!c||c.track!==r||n.state!==Xe.Connected)return void o();const{id:l,track:d}=c;l&&(yield n.sendConnection.updateSendParameters(l,d)),o()}catch(c){s(c)}finally{a()}});return function(r,o,s){return i.apply(this,arguments)}}()),y(this,"handleReplaceTrack",function(){var i=C(function*(r,o,s,a){let c;_.debug("[".concat(n.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),"boolean"==typeof a&&a||(c=yield n.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;const u=Array.from(n.localTrackMap.entries()).find(h=>{let[,{track:p}]=h;return r===p});if(!n.sendConnection||!u||void 0===u[1].id||n.state!==Xe.Connected)return void o();if(yield null===(l=n.sendConnection)||void 0===l?void 0:l.replaceTrack(r,u[1].id),u[0]===j.LocalVideoTrack&&Fe().supportDualStreamEncoding){const h=n.localTrackMap.get(j.LocalVideoLowTrack);if(h){const p=r._mediaStreamTrack.clone();h.track._originMediaStreamTrack.stop(),h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p,yield new q((m,f)=>{n.handleReplaceTrack(h.track,m,f,!0)})}}o()}catch(u){s(u)}finally{var d;null===(d=c)||void 0===d||d()}});return function(r,o,s,a){return i.apply(this,arguments)}}()),y(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),y(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),y(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),y(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new g$(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&("disconnected"!==i.iceConnectionState&&"failed"!==i.iceConnectionState||this.handleDisconnect(i.direction))})},R("ICE_RESTART_INTERVAL"))}startP2PConnection(e,t){return C(function*(){throw new M(S.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")})()}connect(e){return C(function*(){throw new M(S.NOT_SUPPORTED,"p2p mode does not support connect.")})()}startP2P(e,t){var n=this;return C(function*(){let i;try{if(t){n.recvConnection&&(_.warning("[".concat(n.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),n.recvConnection.close(),n.unbindConnectionEvents(n.recvConnection)),i=yield n.recvMutex.lock("From P2PChannel.startP2P"),n.recvConnection=new u$(e,n.store,Xi.RECEIVE_ONLY),n.bindConnectionEvents(n.recvConnection);const r=yield n.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{n.state=Xe.New,n.sendConnection&&(_.warning("[".concat(n.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),n.sendConnection.close(),n.unbindConnectionEvents(n.sendConnection)),i=yield n.sendMutex.lock("From P2PChannel.startP2P"),n.sendConnection=new u$(e,n.store),n.store.peerConnectionStart(),n.bindConnectionEvents(n.sendConnection);const r=yield n.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{i&&i()}})()}p2pConnect(e){var t=this;return C(function*(){if(!t.sendConnection)throw new M(S.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");t.store.peerConnectionStart(),yield t.sendConnection.connect(e),t.statsUploader.startUploadTransportStats(),t.statsUploader.startUploadExtensionUsageStats(),t.state=Xe.Connected})()}addRemoteCandidate(e,t){var n=this;return C(function*(){if(t===Xi.RECEIVE_ONLY){if(!n.sendConnection)throw new M(S.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield n.sendConnection.addRemoteCandidate(e)}else{if(!n.recvConnection)throw new M(S.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield n.recvConnection.addRemoteCandidate(e)}})()}publish(e,t,n){var i=this;return Ao(function*(){const r=yield Ne(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==Xe.Connected){i.throwIfTrackTypeNotMatch(e);const l=e.filter(d=>-1===i.pendingLocalTracks.indexOf(d));return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(l))}i.store.pubId=i.store.pubId+1,vi.markPublishStart(i.store.clientId,i.store.pubId);const o=i.filterTobePublishedTracks(e,t,n);if(0===o.length)return void(yield Ne(i.tryToUnmuteAudio(e)));o.forEach(l=>{let{track:d,type:u}=l;const h=Date.now();i.store.publish(d.getTrackId(),u===j.LocalAudioTrack?"audio":"video",h)}),i.bindLocalTrackEvents(o);const s=yield Ne(i.sendConnection.send(o.map(l=>{let{track:d}=l;return d}),i.store.codec,i.store.audioCodec)),a=(yield Ne(s.next())).value,c=i.createGatewayPublishMessage(o,a);try{yield c}catch(l){throw s.throw(l),l?.code===S.WS_ABORT&&o.forEach(d=>{let{track:u}=d;-1===i.pendingLocalTracks.indexOf(u)&&i.pendingLocalTracks.push(u)}),i.unbindLocalTrackEvents(o),l}yield Ne(s.next()),o.forEach(l=>{let{type:d}=l;i.statsCollector.addLocalStats(d)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(o,a),o.forEach(l=>{let{track:d,type:u}=l;const h=Date.now();i.store.publish(d.getTrackId(),u===j.LocalAudioTrack?"audio":"video",void 0,h)}),i.startUploadUplinkState()}finally{r()}})()}unpublish(e){var t=this;return C(function*(){if(!t.sendConnection||t.state!==Xe.Connected)return void(0===e.length?t.pendingLocalTracks.length=0:t.pendingLocalTracks=t.pendingLocalTracks.filter(o=>!Y(e).call(e,o)));const n=t.filterTobeUnpublishedTracks(e);if(0===n.length)return;const i=n.find(o=>"videoLowTrack"===o[0]);i&&i[1].track.close();const r=t.createGatewayUnpublishMessage(n);if(yield t.sendConnection.stopSending(n.map(o=>{let[,{id:s}]=o;return s})),t.withdrawLocalTracks(n),t.unbindLocalTrackEvents(n.map(o=>{let[s,{track:a}]=o;return{type:s,track:a}})),n.forEach(o=>{let[s]=o;t.statsCollector.removeLocalStats(s)}),0===t.localTrackMap.size&&(t.statsUploader.stopUploadOutboundStats(),t.stopUploadUplinkState()),t.sendConnection&&t.state===Xe.Connected)return i&&i[1].track.close(),r;e.forEach(o=>{const s=t.pendingLocalTracks.indexOf(o);-1!==s&&t.pendingLocalTracks.splice(s,1)})})()}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:o,ssrcs:s}]=i;const a={stream_type:lLe(o,r),ssrcs:s};o._muted||!o._enabled?t.push(a):n.push(a)}),t.length>0&&t.forEach(i=>{ct(this,de.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{ct(this,de.RequestUnmuteLocal,[i])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Ao(function*(){throw new M(S.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}republish(){var e=this;return C(function*(){e.pendingLocalTracks.length>0&&(_.debug("[".concat(e.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield ii(e,de.RequestRePublish,e.pendingLocalTracks),e.emit(de.MediaReconnectEnd,e.store.uid),e.pendingLocalTracks=[])})()}unpublishLowStream(){return C(function*(){throw new M(S.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")})()}subscribe(e,t,n,i){var r=this;return C(function*(){var o;if(!r.recvConnection)throw new M(S.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(o=r.remoteUserMap.get(e))&&void 0!==o&&o.has(t))return;const{track:s,mid:a,transceiver:c}=yield r.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),i);t===ie.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new Tp(s,e.uid,e._uintid,r.store),_.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),r.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new Cp(s,e.uid,e._uintid,r.store),_.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),r.bindRemoteTrackEvents(e,e._videoTrack));const l=r.remoteUserMap.get(e);l?l.set(t,a):r.remoteUserMap.set(e,new Map([[t,a]])),r.statsCollector.addRemoteStats(e.uid),r.statsUploader.startUploadInboundStats(),r.startUploadDownlinkState();const d=r.pendingRemoteTracks.findIndex(u=>{let{user:h,kind:p}=u;return h.uid===e.uid&&t===p});-1!==d&&(r.pendingRemoteTracks.splice(d,1),r.emit(de.MediaReconnectEnd,e.uid))})()}mockSubscribe(e,t,n,i){var r=this;return C(function*(){if(!r.recvConnection)throw new M(S.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");yield r.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),i)})()}unsubscribe(e,t,n){var i=this;return C(function*(){const r=i.pendingRemoteTracks.filter(s=>{let{user:a,kind:c}=s;return void 0!==t?a.uid===e.uid&&t===c:a.uid===e.uid});if(r.forEach(s=>{const a=i.pendingRemoteTracks.indexOf(s);i.pendingRemoteTracks.splice(a,1)}),i.recvConnection||n||r.forEach(s=>{let{kind:a}=s;var c;if(a===ie.AUDIO)null===(c=e._audioTrack)||void 0===c||c._destroy(),e._audioTrack=void 0;else if(a===ie.VIDEO){var l;null===(l=e._videoTrack)||void 0===l||l._destroy(),e._videoTrack=void 0}}),!i.recvConnection)return;const o=i.filterTobeUnSubscribedTracks(e,t);0!==o.length&&(yield i.recvConnection.stopReceiving(o.map(s=>{let[,{id:a}]=s;return a})),i.withdrawRemoteTracks(o),0===i.remoteUserMap.size&&(i.statsUploader.stopUploadInboundStats(),i.stopUploadDownlinkState()),o.forEach(s=>{let[a,{kind:c}]=s;var l,d;if(c===ie.VIDEO&&a._videoSSRC&&(null===(l=i.recvConnection)||void 0===l||l.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),c===ie.VIDEO)i.unbindRemoteTrackEvents(a._videoTrack),n||(null===(d=a._videoTrack)||void 0===d||d._destroy(),a._videoTrack=void 0);else if(c===ie.AUDIO){var u;i.unbindRemoteTrackEvents(a._audioTrack),!n&&(null===(u=a._audioTrack)||void 0===u||u._destroy(),a._audioTrack=void 0)}}),o.forEach(s=>{let[,{kind:a}]=s;ct(i,de.RequestP2PMuteRemote,a)}))})()}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[ie.VIDEO,ie.AUDIO].forEach(i=>{n.has(i)?ct(this,de.RequestP2PUnmuteRemote,i):ct(this,de.RequestP2PMuteRemote,i)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}massSubscribe(e){return C(function*(){throw new M(S.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")})()}massSubscribeNoLock(e){return C(function*(){throw new M(S.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")})()}massUnsubscribe(e){return C(function*(){throw new M(S.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")})()}massUnsubscribeNoLock(e){return C(function*(){throw new M(S.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")})()}muteRemote(e,t){var n=this;return C(function*(){if(!n.recvConnection)return;const i=n.remoteUserMap.get(e);if(!i)return void _.warning("[".concat(n.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void _.warning("[".concat(n.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===ie.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&n.recvConnection.setStatsRemoteVideoIsReady(r,!1)})()}unmuteRemote(e,t){var n=this;return C(function*(){return n.unmuteRemoteNoLock(e,t)})()}unmuteRemoteNoLock(e,t){var n=this;return C(function*(){if(!n.recvConnection)return;const i=n.remoteUserMap.get(e);i?i.get(t)||_.warning("[".concat(n.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):_.warning("[".concat(n.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."))})()}getAllTracks(e){const t=this.localTrackMap.get(j.LocalAudioTrack);if(t?.track instanceof wn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==j.LocalAudioTrack}).filter(i=>{let[r]=i;return!(e&&r===j.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===j.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(e,t,n,i,r){if(e){const s=this.localTrackMap.get(j.LocalAudioTrack),a=this.localTrackMap.get(i?j.LocalVideoLowTrack:j.LocalVideoTrack);ne.publish(this.store.sessionId,{eventElapse:vi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:s?.track.getTrackLabel(),videoName:a?.track.getTrackLabel(),screenshare:-1!==a?.track._hints.indexOf(ft.SCREEN_TRACK),audio:!!s,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var o;n||(n=[]);const s=n.find(c=>c instanceof Ht),a=i?null===(o=this.localTrackMap.get(j.LocalVideoTrack))||void 0===o?void 0:o.track:n.find(c=>c instanceof St);ne.publish(this.store.sessionId,{eventElapse:vi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:s?.getTrackLabel(),videoName:a?.getTrackLabel(),screenshare:-1!==a?._hints.indexOf(ft.SCREEN_TRACK),audio:!!s,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(e,t,n,i){const r=i===ie.VIDEO?n._videoSSRC:n._audioSSRC;r&&ne.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===ie.VIDEO,audio:i===ie.AUDIO,peerid:n.uid,subscribeRequestid:i===ie.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:vi.measureFromSubscribeStart(this.store.clientId,r)})}reset(){_.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new gi("P2PChannel2-send-mutex"),this.sendMutex=new gi("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(j.LocalAudioTrack);if(e?.track instanceof wn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Xe.Disconnected}getStats(e){var t,n;return e?null===(n=this.recvConnection)||void 0===n?void 0:n.getStats():null===(t=this.sendConnection)||void 0===t?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.recvConnection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(j.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(j.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof St||t&&t.track instanceof Ht?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}hasRemoteMediaWithLock(e,t){var n=this;return C(function*(){if(!e)return n.remoteUserMap.size>0;const i=n.remoteUserMap.get(e);return!!i&&(!t||i.has(t))})()}getRemoteMedia(e){var t;const n=Array.from(Zr(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(j.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=gg(e).call(e,(n,i)=>n.level-i.level),e}disconnectForReconnect(){var e=this;return C(function*(){e.sendConnection&&e.recvConnection&&(_.debug("[".concat(e.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),e.state=Xe.Reconnecting,R("KEEP_LAST_FRAME")&&0!==e.remoteUserMap.size&&Array.from(e.remoteUserMap.entries()).forEach(t=>{let[n]=t;var i;n._videoTrack&&n._videoTrack._player&&(null===(i=n._videoTrack._player.getVideoElement())||void 0===i||i.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())}),e.sendConnection.close(),e.unbindConnectionEvents(e.sendConnection),e.sendConnection=void 0,e.recvConnection.close(),e.unbindConnectionEvents(e.recvConnection),e.recvConnection=void 0,0!==e.localTrackMap.size&&(Array.from(e.localTrackMap.entries()).forEach(t=>{var n;let[i,{track:r}]=t;switch(i){case j.LocalVideoTrack:Y(n=r._hints).call(n,ft.LOW_STREAM)?r.close():e.pendingLocalTracks.push(r);break;case j.LocalAudioTrack:r instanceof wn?e.pendingLocalTracks=e.pendingLocalTracks.concat(r.trackList):e.pendingLocalTracks.push(r)}}),e.emit(de.MediaReconnectStart,e.store.uid)),e.unbindLocalTrackEvents(),e.localTrackMap.clear(),0!==e.remoteUserMap.size&&Array.from(e.remoteUserMap.entries()).forEach(t=>{let[n,i]=t;Array.from(Zr(i).call(i)).forEach(r=>{e.setPendingRemoteMedia(n,r)}),e.emit(de.MediaReconnectStart,n.uid)}),e.unbindAllRemoteTrackEvents(),e.remoteUserMap.clear(),e.stopUploadUplinkState(),e.stopUploadDownlinkState(),e.statsUploader.stopUploadOutboundStats(),e.statsUploader.stopUploadInboundStats(),e.statsUploader.stopUploadTransportStats(),_.debug("[".concat(e.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))})()}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((e instanceof vl?e.uid:e)===i.uid&&t===r)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e,t){var n=this;return C(function*(){let i,r;if(e===Xi.SEND_ONLY){if(!n.sendConnection)throw new M(S.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=yield n.sendMutex.lock("From P2PChannel.restartICE"),r=n.sendConnection}else{if(!n.recvConnection)throw new M(S.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=yield n.recvMutex.lock("From P2PChannel.restartICE"),r=n.recvConnection}try{if(t){const o=yield r.restartICE(t);return r.isInRestartIce=!1,o}{const o=yield r.restartICE();if(o){const s=yield ii(n,de.RequestP2PRestartICE,{direction:Xi.RECEIVE_ONLY,iceParameter:o});yield r.restartICE(s),r.isInRestartIce=!1}}}finally{i()}})()}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(j.LocalVideoTrack),n=this.localTrackMap.get(j.LocalAudioTrack),i=e.videoSend.find(p=>{var m;return p.ssrc===(null==t||null===(m=t.ssrcs)||void 0===m?void 0:m[0].ssrcId)}),r=e.audioSend.find(p=>{var m;return p.ssrc===(null==n||null===(m=n.ssrcs)||void 0===m?void 0:m[0].ssrcId)});if(!i||!r)return 1;const o=Do(this,de.NeedSignalRTT),s=i?i.rttMs:void 0,a=r?r.rttMs:void 0,c=s&&a?(s+a)/2:s||a,d=100*e.sendPacketLossRate*.7/50+.3*((c&&o?(c+o)/2:c||o)||0)/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,h=t?.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(ft.SCREEN_TRACK)){const p=h._encoderConfig.bitrateMax,m=e.bitrate.actualEncoded;if(p&&m){const f=(1e3*p-m)/(1e3*p);return y7[f<.15?0:f<.3?1:f<.45?2:f<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,o=i._videoSSRC,s=e.audioRecv.find(m=>m.ssrc===r),a=e.videoRecv.find(m=>m.ssrc===o);if(!s&&!a)return void(t+=1);const c=Do(this,de.NeedSignalRTT),l=e.rtt,d=(l&&c?(l+c)/2:l||c)||0,u=s?s.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*d/1500;u&&(p=.6*h*100/50+.2*d/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}muteLocalTrack(e){var t=this;return C(function*(){return new q((n,i)=>{t.handleMuteLocalTrack(e,n,i)})})()}filterTobePublishedTracks(e,t,n){const i=[],r=Fe(),o=this.getAllTracks();e=Qh(e=e.filter(c=>-1===o.indexOf(c)));let s=!1,a=!1;for(const c of e){if(c instanceof St&&(this.localTrackMap.has(j.LocalVideoTrack)||s?new M(S.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:c,type:j.LocalVideoTrack}),s=!0),t)){const l=this.getLowVideoTrack(c,n);i.push({track:l,type:j.LocalVideoLowTrack})}if(c instanceof Ht){const l=this.localTrackMap.get(j.LocalAudioTrack);if(l){if(!(l.track instanceof wn))throw new M(S.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new M(S.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");l.track.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0)}else if(a){const d=i.find(u=>{let{type:h}=u;return h===j.LocalAudioTrack});if(!(d.track instanceof wn))throw new M(S.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new M(S.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");d.track.addAudioTrack(c)}else{if(!r.webAudioMediaStreamDest||c instanceof wn||c._bypassWebAudio)i.push({track:c,type:j.LocalAudioTrack});else{const d=new wn;d.addAudioTrack(c),i.push({track:d,type:j.LocalAudioTrack})}a=!0}}}return i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Qh(e=e.filter(i=>-1!==n.indexOf(i)));for(const i of e){if(i instanceof Ht){const r=this.localTrackMap.get(j.LocalAudioTrack);if(!r)continue;r.track instanceof wn?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),0===r.track.trackList.length&&(t.push([j.LocalAudioTrack,r]),r.track.close())):t.push([j.LocalAudioTrack,r])}if(i instanceof St){const r=this.localTrackMap.get(j.LocalVideoTrack);if(!r)continue;t.push([j.LocalVideoTrack,r]);const o=this.localTrackMap.get(j.LocalVideoLowTrack);o&&t.push([j.LocalVideoLowTrack,o])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case j.LocalVideoTrack:n.addListener(X.GET_STATS,this.handleGetLocalVideoStats),n.addListener(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(X.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(X.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(X.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case j.LocalAudioTrack:this.bindLocalAudioTrackEvents(n)}})}bindLocalAudioTrackEvents(e,t){e instanceof wn?e.trackList.forEach(n=>{n.addListener(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(X.GET_STATS,this.handleGetLocalAudioStats),n.addListener(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(X.GET_STATS,this.handleGetLocalAudioStats),e.addListener(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(X.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case j.LocalVideoTrack:n.off(X.GET_STATS,this.handleGetLocalVideoStats),n.off(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(X.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(X.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(X.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case j.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n)}})}unbindLocalAudioTrackEvents(e){e instanceof wn?e.trackList.forEach(t=>{t.off(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(X.GET_STATS,this.handleGetLocalAudioStats),t.off(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(X.GET_STATS,this.handleGetLocalAudioStats),e.off(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(X.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Cp&&t.addListener(X.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Tp&&t.addListener(X.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(X.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(ie.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(ie.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var r;let o,{track:s,type:a}=n;switch(a){case j.LocalAudioTrack:o=$e.Audio;break;case j.LocalVideoTrack:o=Y(r=s._hints).call(r,ft.SCREEN_TRACK)?$e.Screen:$e.High;break;case j.LocalVideoLowTrack:o=$e.Low}return{kind:a===j.LocalAudioTrack?ie.AUDIO:ie.VIDEO,stream_type:o,mid:t[i].id,ssrcs:t[i].localSSRC,isMuted:s.muted||!s.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[r,{track:o,ssrcs:s,id:a}]=t;switch(r){case j.LocalVideoTrack:i=Y(n=o._hints).call(n,ft.SCREEN_TRACK)?$e.Screen:$e.High;break;case j.LocalAudioTrack:i=$e.Audio;break;case j.LocalVideoLowTrack:i=$e.Low}return{stream_type:i,ssrcs:s,mid:a}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:r,type:o}=n;this.localTrackMap.set(o,{track:r,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){var t=this;e.onConnectionStateChange=function(){var n=C(function*(i){var r;_.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(i,")")),t.emit(de.PeerConnectionStateChange,i),"connected"!==i||t.store.keyMetrics.peerConnectionEnd||t.store.peerConnectionEnd(),"connected"===i&&(e.isInRestartIce=!1),Y(r=t._restartStates).call(r,i)&&!e.isInRestartIce&&("disconnected"===i&&(yield qn(800)),"disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||t.handleDisconnect(e.direction))});return function(i){return n.apply(this,arguments)}}(),e.onICEConnectionStateChange=n=>{"connected"!==n||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(n,")")),ne.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:n,tag:jt.TRACER}).onSuccess(),this.emit(de.IceConnectionStateChange,n)},e.onICETransportStateChange=n=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(n,")"))},e.onDTLSTransportStateChange=n=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(n,")"))},e.onDTLSTransportError=n=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(n,")"))},e.onFirstAudioDecoded=n=>{var i;const r=Array.from(Zr(i=this.remoteUserMap).call(i)).find(s=>s._audioSSRC===n);var o;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),null===(o=r.audioTrack)||void 0===o||o.emit(vp.FIRST_FRAME_DECODED),ne.firstRemoteFrame(this.store.sessionId,Yn.FIRST_AUDIO_DECODE,Lt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:vi.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=n=>{var i;const r=Array.from(Zr(i=this.remoteUserMap).call(i)).find(o=>o._audioSSRC===n);r&&ne.firstRemoteFrame(this.store.sessionId,Yn.FIRST_AUDIO_RECEIVED,Lt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:vi.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(n,i,r)=>{this.reportVideoFirstFrameDecoded(n,i,r)},e.onFirstVideoReceived=n=>{var i;const r=Array.from(Zr(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===n);r&&ne.firstRemoteFrame(this.store.sessionId,Yn.FIRST_VIDEO_RECEIVED,Lt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:vi.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(n,i)=>{const r="relay"===n.candidateType;"unknown"!==i.candidateType&&r===("relay"===i.candidateType)||this.emit(de.ConnectionTypeChange,r),_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(hl(i))," -> ").concat(JSON.stringify(hl(n)),")"))},e.onSelectedRemoteCandidateChanged=(n,i)=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(hl(i))," -> ").concat(JSON.stringify(hl(n)),")"))},e.onFirstVideoDecodedTimeout=n=>{this.reportVideoFirstFrameDecoded(n,void 0,void 0,!0)},e.onLocalCandidate=n=>{this.emit(de.LocalCandidate,{candidate:n,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}handleDisconnect(e){var t=this;return C(function*(){const n=e===Xi.SEND_ONLY?t.sendConnection:t.recvConnection;n&&!n.isInRestartIce&&(n.isInRestartIce=!0,_.debug("[".concat(t.store.clientId,"] [P2PChannel-").concat(n.name,"] start use restartICE")),e===Xi.SEND_ONLY?t.restartICE(e):ii(t,de.RequestP2PRestartICE,{direction:Xi.SEND_ONLY}))})()}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(j.LocalAudioTrack);if(e instanceof Ht&&n?.track instanceof wn)return n.track.isActive||t.push([j.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:o}]=r;return e===o});if(i&&(t.push(i),i[0]===j.LocalVideoTrack)){const r=this.localTrackMap.get(j.LocalVideoLowTrack);r&&t.push([j.LocalVideoLowTrack,r])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(j.LocalAudioTrack);if(e instanceof Ht&&n?.track instanceof wn)return n.track.isActive&&t.push([j.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:o}]=r;return e===o});if(i)if(i[0]===j.LocalVideoTrack){t.push(i);const r=this.localTrackMap.get(j.LocalVideoLowTrack);r&&t.push([j.LocalVideoLowTrack,r])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[r,{track:o,ssrcs:s,id:a}]=t;switch(r){case j.LocalAudioTrack:i=$e.Audio;break;case j.LocalVideoTrack:i=Y(n=o._hints).call(n,ft.SCREEN_TRACK)?$e.Screen:$e.High;break;case j.LocalVideoLowTrack:i=$e.Low}return{stream_type:i,ssrcs:s,mid:a}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[r,{track:o,ssrcs:s,id:a}]=t;switch(r){case j.LocalAudioTrack:i=$e.Audio;break;case j.LocalVideoTrack:i=Y(n=o._hints).call(n,ft.SCREEN_TRACK)?$e.Screen:$e.High;break;case j.LocalVideoLowTrack:i=$e.Low}return{stream_type:i,ssrcs:s,mid:a}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const r=i.get(t);if(!r)return n;n.push([e,{kind:t,id:r}])}else Array.from(i.entries()).forEach(r=>{let[o,s]=r;n.push([e,{kind:o,id:s}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:r}]=n;switch(r){case ie.VIDEO:return void(i._videoSSRC&&t.push({stream_type:ie.VIDEO,ssrcId:i._videoSSRC}));case ie.AUDIO:return void(i._audioSSRC&&t.push({stream_type:ie.AUDIO,ssrcId:i._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const r=this.remoteUserMap.get(n);r&&(r.delete(i),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(n))})}updateBitrateLimit(e){var t=this;return C(function*(){const n=t.localTrackMap.get(j.LocalVideoTrack),i=t.localTrackMap.get(j.LocalVideoLowTrack);n&&(yield n.track.setBitrateLimit(e.uplink)),i&&e.low_stream_uplink&&(yield i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.sendConnection||!this.recvConnection||"connected"!==this.sendConnection.peerConnectionState&&"connected"!==this.recvConnection.peerConnectionState}tryToUnmuteAudio(e){var t=this;return C(function*(){for(let n=0;n<e.length;n++)if(e[n]instanceof Ht){const i=t.filterTobeUnmutedTracks(e[n]);if(0===i.length)continue;const r=t.createUnmuteMessage(i);return void(yield ct(t,de.RequestUnmuteLocal,r))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.recvConnection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(de.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(de.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var e=this;return C(function*(){e.dtlsFailedCount+=1,yield qn(AN(e.dtlsFailedCount,vn)),e.emit(de.RequestReconnect)})()}reconnectP2P(){return C(function*(){})()}canPublishLowStream(){return this.localTrackMap.has(j.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof St)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof St).length>1)throw new M(S.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ht).length>1&&(e.some(t=>t instanceof Ht&&t._bypassWebAudio)||!Fe().webAudioMediaStreamDest))throw new M(S.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof St&&this.pendingLocalTracks.some(n=>n instanceof St))throw new M(S.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ht&&this.pendingLocalTracks.some(n=>n instanceof Ht)&&(!Fe().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Ht&&n._bypassWebAudio)))throw new M(S.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!R("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fe().supportDualStreamEncoding,i=eC(eC({},{width:160,height:120,framerate:15,bitrate:50}),t);let r;r=n?e._mediaStreamTrack.clone():fM(e,i);const o=gt(8,"track-low-"),s=new St(r,eC(eC({},n&&{scaleResolutionDownBy:XN(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return s.on(Dd.TRANSCEIVER_UPDATED,a=>{e._updateRtpTransceiver(a,gp.LOW_STREAM)}),s._hints.push(ft.LOW_STREAM),e.addListener(X.NEED_CLOSE,()=>{s.close()}),s}globalLock(){var e=this;return C(function*(){return e.recvMutex.lock("From P2PChannel2.globalLock")})()}reportVideoFirstFrameDecoded(e,t,n,i){var r;const o=Array.from(Zr(r=this.remoteUserMap).call(r)).find(s=>s._videoSSRC===e);if(o){i||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const s=this.store.keyMetrics,a=s.subscribe.find(c=>c.userId===o.uid&&"video"===c.type);ne.firstRemoteVideoDecode(this.store.sessionId,Yn.FIRST_VIDEO_DECODE,Lt.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:vi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:s.requestAPEnd||0,apStart:s.requestAPStart||0,joinGwEnd:s.joinGatewayEnd||0,joinGwStart:s.joinGatewayStart||0,pcEnd:s.peerConnectionEnd||0,pcStart:s.peerConnectionStart||0,subscriberEnd:a?.subscribeEnd||0,subscriberStart:a?.subscribeStart||0,videoAddNotify:a?.streamAdded||0,state:i?1:0})}}remoteMediaSsrcChanged(e,t,n){var i=this;return C(function*(){if(!i.recvConnection)return!1;const r=i.remoteUserMap.get(e);if(!r)return!1;const o=r.get(t);if(!o)return!1;const s=yield i.recvConnection.getRemoteSSRC(o);return void 0!==s&&s!==n})()}isPreSubScribe(e){return!1}publishDataChannel(e){return C(function*(){throw new M(S.NOT_SUPPORTED)})()}unpublishDataChannel(e){return C(function*(){throw new M(S.NOT_SUPPORTED)})()}subscribeDataChannel(e,t){return C(function*(){throw new M(S.NOT_SUPPORTED)})()}unsubscribeDataChannel(e,t){return C(function*(){throw new M(S.NOT_SUPPORTED)})()}hasPendingRemoteDataChannel(e,t){throw new M(S.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new M(S.NOT_SUPPORTED)}preConnect(e){return C(function*(){throw new M(S.NOT_SUPPORTED)})()}getEstablishParams(){throw new M(S.NOT_SUPPORTED)}reSubscribe(e){return C(function*(){throw new M(S.NOT_SUPPORTED)})()}updateVideoStreamParameter(e,t){return C(function*(){throw new M(S.NOT_SUPPORTED)})()}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===j.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,gp.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Q(At.prototype,"p2pConnect",[_$],Object.getOwnPropertyDescriptor(At.prototype,"p2pConnect"),At.prototype),Q(At.prototype,"unpublish",[v$],Object.getOwnPropertyDescriptor(At.prototype,"unpublish"),At.prototype),Q(At.prototype,"unpublishLowStream",[E$],Object.getOwnPropertyDescriptor(At.prototype,"unpublishLowStream"),At.prototype),Q(At.prototype,"subscribe",[b$],Object.getOwnPropertyDescriptor(At.prototype,"subscribe"),At.prototype),Q(At.prototype,"mockSubscribe",[y$],Object.getOwnPropertyDescriptor(At.prototype,"mockSubscribe"),At.prototype),Q(At.prototype,"unsubscribe",[S$],Object.getOwnPropertyDescriptor(At.prototype,"unsubscribe"),At.prototype),Q(At.prototype,"muteRemote",[C$],Object.getOwnPropertyDescriptor(At.prototype,"muteRemote"),At.prototype),Q(At.prototype,"unmuteRemote",[T$],Object.getOwnPropertyDescriptor(At.prototype,"unmuteRemote"),At.prototype),Q(At.prototype,"hasRemoteMediaWithLock",[w$],Object.getOwnPropertyDescriptor(At.prototype,"hasRemoteMediaWithLock"),At.prototype),Q(At.prototype,"disconnectForReconnect",[I$],Object.getOwnPropertyDescriptor(At.prototype,"disconnectForReconnect"),At.prototype),Q(At.prototype,"remoteMediaSsrcChanged",[R$],Object.getOwnPropertyDescriptor(At.prototype,"remoteMediaSsrcChanged"),At.prototype),At);function Hs(e){return function(t,n,i){const r=t[n];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return i.value=C(function*(){for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];switch(e){case js.SEND_ONLY:{const c=yield this.sendMutex.lock("From P2PChannel2.".concat(n));try{return yield r.apply(this,s)}finally{c()}}case js.RECEIVE_ONLY:{const c=yield this.recvMutex.lock("From P2PChannel2.".concat(n));try{return yield r.apply(this,s)}finally{c()}}default:{const c=yield this.sendMutex.lock("From P2PChannel2.".concat(n)),l=yield this.recvMutex.lock("From P2PChannel2.".concat(n));try{return yield r.apply(this,s)}finally{c(),l()}}}}),i}}function D$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Ud(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D$(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D$(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Jg{constructor(t){y(this,"store",void 0),y(this,"onStatsException",void 0),y(this,"onUploadPublishDuration",void 0),y(this,"onStatsChanged",void 0),y(this,"localStats",new Map),y(this,"remoteStats",new Map),y(this,"updateStatsInterval",void 0),y(this,"trafficStats",void 0),y(this,"trafficStatsPeerList",[]),y(this,"uplinkStats",void 0),y(this,"exceptionMonitor",void 0),y(this,"p2pChannel",void 0),y(this,"scalabilityMode",BN.L1T1),y(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new Xke,this.exceptionMonitor.on("exception",(n,i,r)=>{this.onStatsException&&this.onStatsException(n,i,r)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(j.LocalAudioTrack)||Ud({},yP)}getLocalVideoTrackStats(){return this.localStats.get(j.LocalVideoTrack)||Ud({},SP)}getRemoteAudioTrackStats(t){const n=(o,s)=>{if(!this.trafficStats)return s;const a=this.trafficStats.peer_delay.find(c=>c.peer_uid===o);return a&&(s.publishDuration=a.B_ppad+(Date.now()-this.trafficStats.timestamp)),s},i={};if(t){var r;const o=null===(r=this.remoteStats.get(t))||void 0===r?void 0:r.audioStats;o&&(i[t]=n(t,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[s,{audioStats:a}]=o;a&&(i[s]=n(s,a))});return i}getRemoteNetworkQualityStats(t){const n={};if(t){var i;const r=null===(i=this.remoteStats.get(t))||void 0===i?void 0:i.networkStats;r&&(n[t]=r)}else Array.from(this.remoteStats.entries()).forEach(r=>{let[o,{networkStats:s}]=r;s&&(n[o]=s)});return n}getRemoteVideoTrackStats(t){const n=(o,s)=>{if(!this.trafficStats)return s;const a=this.trafficStats.peer_delay.find(c=>c.peer_uid===o);return a&&(s.publishDuration=a.B_ppvd+(Date.now()-this.trafficStats.timestamp)),s},i={};if(t){var r;const o=null===(r=this.remoteStats.get(t))||void 0===r?void 0:r.videoStats;o&&(i[t]=n(t,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[s,{videoStats:a}]=o;a&&(i[s]=n(s,a))});return i}getRTCStats(){let t=0,n=0,i=0,r=0;const o=this.localStats.get(j.LocalAudioTrack);o&&(t+=o.sendBytes,n+=o.sendBitrate);const s=this.localStats.get(j.LocalVideoTrack);s&&(t+=s.sendBytes,n+=s.sendBitrate);const a=this.localStats.get(j.LocalVideoLowTrack);a&&(t+=a.sendBytes,n+=a.sendBitrate),this.remoteStats.forEach(l=>{let{audioStats:d,videoStats:u}=l;d&&(i+=d.receiveBytes,r+=d.receiveBitrate),u&&(i+=u.receiveBytes,r+=u.receiveBitrate)});let c=1;return this.trafficStats&&(c+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:c,SendBitrate:n,SendBytes:t,RecvBytes:i,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>void 0!==n.B_ppad||void 0!==n.B_ppvd),t.peer_delay.filter(n=>-1===this.trafficStatsPeerList.indexOf(n.peer_uid)).forEach(n=>{var i;const r=null===(i=this.p2pChannel)||void 0===i?void 0:i.getRemoteMedia(n.peer_uid),o=null!=r&&r.videoSSRC?vi.measureFromSubscribeStart(this.store.clientId,r.videoSSRC):0,s=null!=r&&r.audioSSRC?vi.measureFromSubscribeStart(this.store.clientId,r.audioSSRC):0;void 0!==n.B_ppad&&void 0!==n.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,o>s?o:s),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&_.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,i){return!!t&&(!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime||!(!i||n.framesDecodeCount>i.framesDecodeCount))}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[i,r]=n;switch(i){case j.LocalVideoTrack:case j.LocalVideoLowTrack:{const s=r,a=Ud({},SP),c=t.getStats(),l=t.getLocalMedia(i);if(c){const d=c.videoSend.find(u=>u.ssrc===l?.ssrcs[0].ssrcId);if(d){const u=t.getLocalVideoSize(),h=t.getEncoderConfig(j.LocalVideoTrack);"H264"!==d.codec&&"H265"!==d.codec&&"VP8"!==d.codec&&"VP9"!==d.codec&&"AV1X"!==d.codec&&"AV1"!==d.codec||(a.codecType=d.codec),a.sendBytes=d.bytes,a.sendBitrate=s?8*Math.max(0,a.sendBytes-s.sendBytes):0,d.inputFrame?(a.captureFrameRate=d.inputFrame.frameRate,a.captureResolutionHeight=d.inputFrame.height,a.captureResolutionWidth=d.inputFrame.width):u&&(a.captureResolutionWidth=u.width,a.captureResolutionHeight=u.height),d.sentFrame?(a.sendFrameRate=d.sentFrame.frameRate,a.sendResolutionHeight=d.sentFrame.height,a.sendResolutionWidth=d.sentFrame.width):u&&(a.sendResolutionWidth=u.width,a.sendResolutionHeight=u.height),d.avgEncodeMs&&(a.encodeDelay=d.avgEncodeMs),h&&h.bitrateMax&&(a.targetSendBitrate=1e3*h.bitrateMax),a.sendPackets=d.packets,a.sendPacketsLost=d.packetsLost,a.sendJitterMs=d.jitterMs,a.sendRttMs=d.rttMs,a.totalDuration=s?s.totalDuration+1:1,a.totalFreezeTime=s?s.totalFreezeTime:0,this.isLocalVideoFreeze(d)&&(a.totalFreezeTime+=1),d.scalabilityMode&&this.scalabilityMode!==d.scalabilityMode&&(_.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(d.scalabilityMode)),this.scalabilityMode=d.scalabilityMode)}this.trafficStats&&(a.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o;this.localStats.set(i,a),(s?.sendResolutionWidth!==a.sendResolutionWidth||s?.sendResolutionHeight!==a.sendResolutionHeight)&&(null===(o=this.onStatsChanged)||void 0===o||o.call(this,"resolution",{width:a.sendResolutionWidth,height:a.sendResolutionHeight})),a&&l&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,l.track,a);break}case j.LocalAudioTrack:{const s=r,a=Ud({},yP),c=t.getStats(),l=t.getLocalMedia(i);if(c){const d=c.audioSend.find(u=>u.ssrc===l?.ssrcs[0].ssrcId);if(d){if("opus"!==d.codec&&"aac"!==d.codec&&"PCMU"!==d.codec&&"PCMA"!==d.codec&&"G722"!==d.codec||(a.codecType=d.codec),d.inputLevel)a.sendVolumeLevel=Math.round(32767*d.inputLevel);else{const u=t.getLocalAudioVolume();u&&(a.sendVolumeLevel=Math.round(32767*u))}a.sendBytes=d.bytes,a.sendPackets=d.packets,a.sendPacketsLost=d.packetsLost,a.sendJitterMs=d.jitterMs,a.sendRttMs=d.rttMs,a.sendBitrate=s?8*Math.max(0,a.sendBytes-s.sendBytes):0}}this.trafficStats&&(a.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(j.LocalAudioTrack,a),a&&l&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,l.track,a);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var i,r;let[o,{videoStats:s,audioStats:a,videoPcStats:c}]=n;const l=a,d=s,u=c,h=Ud({},TK),p=Ud({},wK),m=Ud({},Rke),{audioTrack:f,videoTrack:g,audioSSRC:E,videoSSRC:b}=t.getRemoteMedia(o);let T;T=t instanceof Fr?t.getStats(!0):t.getStats();const I=null===(i=T)||void 0===i?void 0:i.audioRecv.find(k=>k.ssrc===E),D=null===(r=T)||void 0===r?void 0:r.videoRecv.find(k=>k.ssrc===b),O=this.trafficStats&&this.trafficStats.peer_delay.find(k=>k.peer_uid===o);if(I&&("opus"!==I.codec&&"aac"!==I.codec&&"PCMU"!==I.codec&&"PCMA"!==I.codec&&"G722"!==I.codec||(h.codecType=I.codec),I.outputLevel?h.receiveLevel=Math.round(32767*I.outputLevel):f&&(h.receiveLevel=Math.round(32767*f.getVolumeLevel())),h.receiveBytes=I.bytes,h.receivePackets=I.packets,h.receivePacketsLost=I.packetsLost,h.receivePacketsDiscarded=I.packetsDiscarded,h.packetLossRate=h.receivePacketsLost/(h.receivePackets+h.receivePacketsLost),h.receiveBitrate=l?8*Math.max(0,h.receiveBytes-l.receiveBytes):0,h.totalDuration=l?l.totalDuration+1:1,h.totalFreezeTime=l?l.totalFreezeTime:0,h.freezeRate=h.totalFreezeTime/h.totalDuration,h.receiveDelay=I.jitterBufferMs,h.totalDuration>10&&Jg.isRemoteAudioFreeze(f)&&(h.totalFreezeTime+=1)),D){"H264"!==D.codec&&"H265"!==D.codec&&"VP8"!==D.codec&&"VP9"!==D.codec&&"AV1X"!==D.codec&&"AV1"!==D.codec||(p.codecType=D.codec),p.receiveBytes=D.bytes,p.receiveBitrate=d?8*Math.max(0,p.receiveBytes-d.receiveBytes):0,p.decodeFrameRate=D.decodeFrameRate<0?0:D.decodeFrameRate,p.renderFrameRate=D.decodeFrameRate<0?0:D.decodeFrameRate,D.outputFrame&&(p.renderFrameRate=D.outputFrame.frameRate),D.receivedFrame?(p.receiveFrameRate=D.receivedFrame.frameRate,p.receiveResolutionHeight=D.receivedFrame.height,p.receiveResolutionWidth=D.receivedFrame.width):g&&(p.receiveResolutionHeight=g._videoHeight||0,p.receiveResolutionWidth=g._videoWidth||0),void 0!==D.framesRateFirefox&&(p.receiveFrameRate=Math.round(D.framesRateFirefox)),p.receivePackets=D.packets,p.receivePacketsLost=D.packetsLost,p.packetLossRate=p.receivePacketsLost/(p.receivePackets+p.receivePacketsLost),p.totalDuration=d?d.totalDuration+1:1,p.totalFreezeTime=d?d.totalFreezeTime:0,p.receiveDelay=D.jitterBufferMs||0;const k=!!b&&t.getRemoteVideoIsReady(b);g&&k&&Jg.isRemoteVideoFreeze(g,D,u)&&(p.totalFreezeTime+=1),p.freezeRate=p.totalFreezeTime/p.totalDuration}O&&(h.end2EndDelay=O.B_ad,p.end2EndDelay=O.B_vd,h.transportDelay=O.B_ed,p.transportDelay=O.B_ed,h.currentPacketLossRate=O.B_ealr4/100,p.currentPacketLossRate=O.B_evlr4/100,m.uplinkNetworkQuality=O.B_punq?O.B_punq:0,m.downlinkNetworkQuality=O.B_pdnq?O.B_pdnq:0),this.remoteStats.set(o,{audioStats:h,videoStats:p,videoPcStats:D,networkStats:m}),f&&this.exceptionMonitor.setRemoteAudioStats(f,h),g&&this.exceptionMonitor.setRemoteVideoStats(g,p)})}}class O${constructor(){y(this,"destChannelMediaInfos",new Map),y(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){D7(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){D7(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){CS(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function N$(e){if(!(e instanceof O$))return new N(S.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();return t?0===n.size?new N(S.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new N(S.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}function P$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function M$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P$(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P$(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var lt;function x$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function tC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x$(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x$(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Qg=(lt=class w_ extends P7{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Y(n=Object.keys(bS)).call(n,t)}))]}constructor(t,n){super(t,n),y(this,"store",void 0),y(this,"peerConnection",void 0),y(this,"remoteSDP",void 0),y(this,"initialOffer",void 0),y(this,"statsFilter",void 0),y(this,"useRTX",!1),y(this,"localCapabilities",void 0),y(this,"localCandidateCount",0),y(this,"allCandidatesReceived",!1),y(this,"establishPromise",void 0),y(this,"mutex",new gi("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(w_.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=pM(this.peerConnection,R("STATS_UPDATE_INTERVAL"),void 0,Bt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){var t=this;return C(function*(){try{const n=yield t.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=ml(n.sdp),r=qg(n.sdp,{filterRTX:!t.useRTX,filterVideoFec:R("FILTER_VIDEO_FEC"),filterAudioFec:R("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return t.localCapabilities=r,t.initialOffer=n,tC(tC({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:n.sdp})}catch(n){throw new M(S.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}})()}updateRemoteConnect(){return C(function*(){})()}connect(t){var n=this;return C(function*(){try{if(!n.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");n.remoteSDP=new class{constructor(r){y(this,"sessionDesc",void 0),y(this,"localCapabilities",void 0),y(this,"rtpCapabilities",void 0),y(this,"candidates",void 0),y(this,"iceParameters",void 0),y(this,"dtlsParameters",void 0),y(this,"setup",void 0),y(this,"currentMidIndex",void 0),y(this,"cname",void 0),r=dn(r);const{iceParameters:o,dtlsParameters:s,candidates:a,rtpCapabilities:c,setup:l,localCapabilities:d,sdkCodec:u,cname:h}=r,p=Zn.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=c,this.candidates=a,this.iceParameters=o,this.dtlsParameters=s,this.setup=l,this.localCapabilities=d,this.cname=h;for(let m=0;m<p.mediaDescriptions.length;m++){const f=p.mediaDescriptions[m];if(f.attributes.iceUfrag=o.iceUfrag,f.attributes.icePwd=o.icePwd,f.attributes.fingerprints=s.fingerprints,f.attributes.candidates=a,f.attributes.setup=l,"video"===f.media.mediaType){f.media.fmts=c.videoCodecs.map(E=>E.payloadType.toString(10));let g=c.videoCodecs.filter(E=>{var b,T;return null===(b=E.rtpMap)||void 0===b?void 0:Y(T=b.encodingName.toLowerCase()).call(T,u)});0===g.length&&(g=c.videoCodecs),f.attributes.payloads=g,f.attributes.extmaps=c.videoExtensions}"audio"===f.media.mediaType&&(f.media.fmts=c.audioCodecs.map(g=>g.payloadType.toString(10)),f.attributes.payloads=c.audioCodecs,f.attributes.extmaps=c.audioExtensions),p.mediaDescriptions[m]=this.mungMediaDesc(f)}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return Zn.print(this.sessionDesc)}send(r,o,s){const{ssrcs:a,ssrcGroups:c}=Md(o,this.cname),l=this.sessionDesc.mediaDescriptions.find(h=>r===ie.VIDEO?"video"===h.media.mediaType:"audio"===h.media.mediaType),d=a[0].attributes.label,u=a[0].attributes.mslabel;return l.attributes.ssrcs=l.attributes.ssrcs.concat(a),l.attributes.ssrcGroups=l.attributes.ssrcGroups.concat(c),{id:d,mslabel:u}}batchSend(r){return r.map(o=>{let{kind:s,ssrcMsg:a}=o;return this.send(s,a,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(o=>{const s=[],a=[],c=[];o.attributes.ssrcs.forEach(l=>{Y(r).call(r,l.attributes.label||"")?c.push(l):s.push(l)}),o.attributes.ssrcGroups.forEach(l=>{var d;Y(d=c.map(u=>u.ssrcId)).call(d,l.ssrcIds[0])||a.push(l)}),o.attributes.ssrcs=s,o.attributes.ssrcGroups=a})}mute(r){const o=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!o)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));o.attributes.direction="inactive"}unmute(r){const o=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!o)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));o.attributes.direction="sendonly"}receive(r,o,s){r.forEach((a,c)=>{const l=a._mediaStreamTrack,d=this.sessionDesc.mediaDescriptions.findIndex(h=>h.attributes.mid===l.kind),u=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[d],a);this.sessionDesc.mediaDescriptions[d]=u})}stopReceiving(r){}updateCandidates(r){r===xr.TCP?this.candidates.forEach(o=>{-1===this.candidates.findIndex(s=>"tcp"===s.transport&&s.connectionAddress===o.connectionAddress&&s.port===o.port)&&this.candidates.push(M$(M$({},o),{},{foundation:"tcpcandidate",priority:Number(o.priority)-1+"",transport:"tcp",port:Number(o.port)+90+""}))}):this.candidates=this.candidates.filter(o=>"tcp"!==o.transport);for(const o of this.sessionDesc.mediaDescriptions)o.attributes.candidates=this.candidates}restartICE(r){r=dn(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(o=>{o.attributes.iceUfrag=r.iceUfrag,o.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const o=[];for(let s=0;s<r;s++)o.push((this.currentMidIndex+s+1).toString(10));return o}mungRecvMediaDsec(r,o){const s=dn(r);return wp(s,o),jP(s,o),s}updateRecvMedia(r,o){const s=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===r);if(-1!==s){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],o);this.sessionDesc.mediaDescriptions[s]=a}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,o,s){const a=this.sessionDesc.mediaDescriptions.find(l=>r===ie.VIDEO?"video"===l.attributes.mid:"audio"===l.attributes.mid);if(a){const l=a.attributes.ssrcs.find(d=>d.attributes.label===o);var c;l&&(l.attributes.label=s,null===(c=l.attributes.msid)||void 0===c||c.replace(o,s))}}mungMediaDesc(r){const o=dn(r);return BP(o),function(s){const a=s.attributes.extmaps.find(c=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===c.extensionName);a&&s.attributes.extmaps.splice(s.attributes.extmaps.indexOf(a),1),s.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(d=>"transport-cc"===d.type);-1!==l&&c.rtcpFeedbacks.splice(l,1)})}(o),o}getSSRC(r){for(const o of this.sessionDesc.mediaDescriptions)for(const s of o.attributes.ssrcs)if(s.attributes.label===r)return[s]}}(tC(tC({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:n.localCapabilities,sdkCodec:n.store.codec}));const i=n.remoteSDP.toString();yield n.peerConnection.setLocalDescription(n.initialOffer),yield n.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}})()}updateRemoteRTPCapabilities(t,n){return C(function*(){throw new M(S.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")})()}getPreMedia(t){}send(t,n){var i=this;return Ao(function*(){const r=yield Ne(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=t.map(h=>i.peerConnection.addTrack(h._mediaStreamTrack)),s=yield Ne(i.peerConnection.createOffer()),a=Zn.parse(s.sdp),c=t.map(h=>{const p=h._mediaStreamTrack,m=a.mediaDescriptions.find(f=>f.attributes.mid===p.kind);if(!m)throw new Error("Cannot extract ssrc from mediaDescription.");return function(f,g,E){const b=f.attributes.ssrcs.filter(I=>I.attributes.label===g),T=f.attributes.ssrcGroups;if(0===b.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(T&&b.length>1){const I=T.find(D=>-1!==D.ssrcIds.indexOf(b[0].ssrcId));return I?[{ssrcId:I.ssrcIds[0],rtx:E?I.ssrcIds[1]:void 0}]:[{ssrcId:b[0].ssrcId}]}return[{ssrcId:b[0].ssrcId}]}(m,p.id,i.useRTX)});let l;try{l=yield c}catch(h){throw o.forEach(p=>{ti()&&p.replaceTrack(null),i.peerConnection.removeTrack(p)}),h}const d=i.mungSendOfferSDP(s.sdp,t);i.remoteSDP.receive(t,n,l);const u=i.remoteSDP.toString();return yield Ne(i.peerConnection.setLocalDescription({type:"offer",sdp:d})),yield Ne(i.applySendEncodings(o,t)),yield Ne(i.peerConnection.setRemoteDescription({type:"answer",sdp:u})),t.map((h,p)=>({localSSRC:c[p],id:h._mediaStreamTrack.id}))}catch(o){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{r()}})()}stopSending(t){var n=this;return C(function*(){try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=n.peerConnection.getSenders().filter(s=>{var a;return-1!==t.indexOf((null===(a=s.track)||void 0===a?void 0:a.id)||"")});if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(s=>{ti()&&s.replaceTrack(null),n.peerConnection.removeTrack(s)});const r=yield n.peerConnection.createOffer();yield n.peerConnection.setLocalDescription(r),n.remoteSDP.stopReceiving(t);const o=n.remoteSDP.toString();yield n.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}})()}receive(t,n,i,r){var o=this;return C(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:s,mslabel:a}=o.remoteSDP.send(t,n,r),c=new q((u,h)=>{const p=setTimeout(()=>{h(new Error("Cannot receive track, id: ".concat(s)))},1e4),m=f=>{const g=xe();if(("Safari"===g.name&&11===Number(g.version)||Yi())&&f.track.id!==s&&f.streams[0].id===a){var E;const b=f.streams[0].getTracks()[0];return null===(E=o.remoteSDP)||void 0===E||E.updateTrackLabel(t,s,f.track.id),o.peerConnection.removeEventListener("track",m),clearTimeout(p),void u(b)}if(f.track.id===s)return o.peerConnection.removeEventListener("track",m),clearTimeout(p),void u(f.track)};o.peerConnection.addEventListener("track",m)}),l=o.remoteSDP.toString();yield o.peerConnection.setRemoteDescription({type:"offer",sdp:l});const d=yield o.peerConnection.createAnswer();return yield o.peerConnection.setLocalDescription(d),{track:yield c,id:s}}catch(s){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}})()}stopReceiving(t){var n=this;return C(function*(){try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");n.remoteSDP.stopSending(t);const i=n.remoteSDP.toString();yield n.peerConnection.setRemoteDescription({type:"offer",sdp:i});const r=yield n.peerConnection.createAnswer();yield n.peerConnection.setLocalDescription(r)}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}})()}muteRemote(t){return C(function*(){})()}unmuteRemote(t){return C(function*(){})()}muteLocal(t){var n=this;return C(function*(){try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=n.peerConnection.getSenders().filter(r=>{var o;return-1!==t.indexOf((null===(o=r.track)||void 0===o?void 0:o.id)||"")});if(i.length!==t.length)throw new Error("sender' length doesn't match mids' length.");i.map(r=>{if(ti()&&r.track)r.track.enabled=!1;else{const o=r.getParameters();o.encodings.forEach(s=>s.active=!1),r.setParameters(o)}})}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}})()}unmuteLocal(t){var n=this;return C(function*(){try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=n.peerConnection.getSenders().filter(s=>{var a;return-1!==t.indexOf((null===(a=s.track)||void 0===a?void 0:a.id)||"")});if(i.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");i.map(function(){var s=C(function*(a){if(ti()&&a.track)a.track.enabled=!0;else{const c=a.getParameters();c.encodings.forEach(l=>l.active=!0),yield a.setParameters(c)}});return function(a){return s.apply(this,arguments)}}());const r=yield n.peerConnection.createOffer();yield n.peerConnection.setLocalDescription(r);const o=n.remoteSDP.toString();yield n.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}})()}restartICE(t){var n=this;return Ao(function*(){const i=yield Ne(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Fe().supportPCSetConfiguration){const c=n.peerConnection.getConfiguration(),l=t===xr.RELAY?"relay":"all";c.iceTransportPolicy!==l&&(_.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(c.iceTransportPolicy,"] to [").concat(l,"]")),c.iceTransportPolicy=l,n.peerConnection.setConfiguration(c))}else if(t===xr.RELAY)return;t!==xr.RELAY&&n.remoteSDP.updateCandidates(t);const r=yield Ne(n.peerConnection.createOffer({iceRestart:!0}));if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o=ml(r.sdp),{remoteIceParameters:s}=yield o.iceParameters;n.remoteSDP.restartICE(s);const a=n.remoteSDP.toString();yield Ne(n.peerConnection.setLocalDescription(r)),yield Ne(n.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(r){_.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}close(){var t;this.peerConnection.close(),null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}updateEncoderConfig(t,n){var i=this;return C(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=yield i.peerConnection.createOffer(),o=i.mungSendOfferSDP(r.sdp,[n]);i.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const s=i.remoteSDP.toString();yield i.peerConnection.setLocalDescription({type:"offer",sdp:o}),yield i.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new M(S.EXCHANGE_SDP_FAILED,r.toString())}})()}updateSendParameters(t,n){var i=this;return C(function*(){const r=i.peerConnection.getSenders().filter(o=>{var s;return(null===(s=o.track)||void 0===s?void 0:s.id)===t});1===r.length&&(yield i.applySendEncodings(r,[n]))})()}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}replaceTrack(t,n){var i=this;return C(function*(){const r=i.peerConnection.getSenders().find(o=>{var s;return(null===(s=o.track)||void 0===s?void 0:s.id)===n});r&&(yield r.replaceTrack(t._mediaStreamTrack))})()}createDataChannels(t,n){throw new M(S.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new M(S.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,_.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,_.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},R("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(pS(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...w_.turnServerConfigToIceServers(t.turnServer.servers)),R("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...w_.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}updateRtpSenderEncodings(t,n){var i=this;return C(function*(){var r;if(n||(n=i.peerConnection.getSenders().find(d=>{var u;return(null===(u=d.track)||void 0===u?void 0:u.id)===t._mediaStreamTrack.id})),!n)return _.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!Fe().supportSetRtpSenderParameters)return _.warn("Browser not support set rtp-sender parameters");const o={},s={};if(t instanceof St)switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(R("DSCP_TYPE")&&sl()){var a;const d=R("DSCP_TYPE");Y(a=["very-low","low","medium","high"]).call(a,d)&&(s.networkPriority=d)}const c=n.getParameters(),l=null===(r=c.encodings)||void 0===r?void 0:r[0];l&&Object.assign(l,s),Object.assign(c,o),_.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),yield n.setParameters(c)})()}applySendEncodings(t,n){var i=this;return C(function*(){try{if(!Fe().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const o=t[r],s=n[r];o&&s&&(yield i.updateRtpSenderEncodings(s,o))}}catch{_.debug("[".concat(i.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(t,n){const i=Zn.parse(t);return n.forEach((r,o)=>{const s=r._mediaStreamTrack,a=i.mediaDescriptions.find(c=>c.attributes.mid===s.kind);a&&wp(a,r)}),Zn.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;null===(n=this.onFirstAudioReceived)||void 0===n||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;null===(n=this.onFirstVideoReceived)||void 0===n||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;null===(n=this.onFirstAudioDecoded)||void 0===n||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;null===(i=this.onSelectedLocalCandidateChanged)||void 0===i||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;null===(i=this.onSelectedRemoteCandidateChanged)||void 0===i||i.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}batchReceive(t){var n=this;return C(function*(){try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=n.remoteSDP.batchSend(t).map((s,a)=>{let{id:c,mslabel:l}=s;const{kind:d}=t[a];return new q((u,h)=>{const p=setTimeout(()=>{h(new Error("Cannot receive track, id: ".concat(c)))},1e4),m=f=>{const g=xe();if("Safari"===g.name&&11===Number(g.version)&&f.track.id!==c&&f.streams[0].id===l){var E;const b=f.streams[0].getTracks()[0];return null===(E=n.remoteSDP)||void 0===E||E.updateTrackLabel(d,c,f.track.id),n.peerConnection.removeEventListener("track",m),clearTimeout(p),void u({track:b,id:c})}if(f.track.id===c)return n.peerConnection.removeEventListener("track",m),clearTimeout(p),void u({track:f.track,id:c})};n.peerConnection.addEventListener("track",m)})}),r=n.remoteSDP.toString();yield n.peerConnection.setRemoteDescription({type:"offer",sdp:r});const o=yield n.peerConnection.createAnswer();return yield n.peerConnection.setLocalDescription(o),yield q.all(i)}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}})()}getRemoteSSRC(t){var n=this;return C(function*(){if(!n.remoteSDP)return;const i=n.remoteSDP.getSSRC(t);return i?.[0].ssrcId})()}setConfiguration(t){if(Fe().supportPCSetConfiguration){const n=w_.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Q(lt.prototype,"connect",[ko],Object.getOwnPropertyDescriptor(lt.prototype,"connect"),lt.prototype),Q(lt.prototype,"stopSending",[ko],Object.getOwnPropertyDescriptor(lt.prototype,"stopSending"),lt.prototype),Q(lt.prototype,"receive",[ko],Object.getOwnPropertyDescriptor(lt.prototype,"receive"),lt.prototype),Q(lt.prototype,"stopReceiving",[ko],Object.getOwnPropertyDescriptor(lt.prototype,"stopReceiving"),lt.prototype),Q(lt.prototype,"muteRemote",[ko],Object.getOwnPropertyDescriptor(lt.prototype,"muteRemote"),lt.prototype),Q(lt.prototype,"unmuteRemote",[ko],Object.getOwnPropertyDescriptor(lt.prototype,"unmuteRemote"),lt.prototype),Q(lt.prototype,"muteLocal",[ko],Object.getOwnPropertyDescriptor(lt.prototype,"muteLocal"),lt.prototype),Q(lt.prototype,"unmuteLocal",[ko],Object.getOwnPropertyDescriptor(lt.prototype,"unmuteLocal"),lt.prototype),Q(lt.prototype,"close",[ko],Object.getOwnPropertyDescriptor(lt.prototype,"close"),lt.prototype),Q(lt.prototype,"updateEncoderConfig",[ko],Object.getOwnPropertyDescriptor(lt.prototype,"updateEncoderConfig"),lt.prototype),Q(lt.prototype,"updateSendParameters",[ko],Object.getOwnPropertyDescriptor(lt.prototype,"updateSendParameters"),lt.prototype),Q(lt.prototype,"replaceTrack",[ko],Object.getOwnPropertyDescriptor(lt.prototype,"replaceTrack"),lt.prototype),Q(lt.prototype,"getRemoteSSRC",[ko],Object.getOwnPropertyDescriptor(lt.prototype,"getRemoteSSRC"),lt.prototype),lt);function ko(e,t,n){const i=e[t];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return n.value=C(function*(){const r=this.mutex,o=yield r.lock("Locking from P2PConnection.".concat(t));try{for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];return yield i.apply(this,a)}finally{o()}}),n}function k$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function El(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k$(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k$(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class dLe{get localCapabilities(){return dn(this._localCapabilities)}get rtpCapabilities(){return dn(this._rtpCapabilities)}get candidates(){return dn(this._candidates)}get iceParameters(){return dn(this._iceParameters)}get dtlsParameters(){return dn(this._dtlsParameters)}constructor(t){y(this,"sessionDesc",void 0),y(this,"_localCapabilities",void 0),y(this,"_rtpCapabilities",void 0),y(this,"_candidates",void 0),y(this,"_iceParameters",void 0),y(this,"_dtlsParameters",void 0),y(this,"setup",void 0),y(this,"currentMidIndex",void 0),y(this,"cname",void 0),y(this,"firefoxSsrcMidMap",new Map),t=dn(t);const{iceParameters:n,dtlsParameters:i,candidates:r,rtpCapabilities:o,setup:s,localCapabilities:a,cname:c}=t;this._rtpCapabilities=o,this._candidates=r,this._iceParameters=n,this._dtlsParameters=i,this._localCapabilities=a,this.setup=s,this.cname=c,this.sessionDesc=this.updateRemoteRTPCapabilities(o),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(t){const n=this.candidates,i=this.dtlsParameters,r=this.iceParameters,o=this.rtpCapabilities.send;let s=this.sessionDesc.mediaDescriptions.length-1;for(let a=1;a<t;a++){const c=2*a+2e4,l=2*a+4e4,{ssrcs:d,ssrcGroups:u}=Md([{ssrcId:c}],this.cname),{ssrcs:h,ssrcGroups:p}=Md([{ssrcId:l,rtx:R("USE_SUB_RTX")?l+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:o.videoCodecs.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:n,extmaps:o.videoExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:o.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++s)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:o.audioCodecs.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:n,extmaps:o.audioExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d,ssrcGroups:u,rtcpFeedbackWildcards:[],payloads:o.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++s)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Zn.print(this.sessionDesc)}send(t,n,i,r){const{ssrcs:o,ssrcGroups:s}=Md(n,this.cname,R("SYNC_GROUP")?i:void 0),a=this.findPreloadMediaDesc(o);if(a){if(Bt()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,a.attributes.mid),r&&(r.twcc||r.remb)){const c=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(a,r),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const c=this.findAvailableMediaIndex(t,o);let l;return-1===c||1===c&&(ti()||function(){const d=xe();return!(d.name!==Ye.CHROME||!d.osVersion)&&Number(d.version)<=90}())||0===c&&R("USE_SUB_RTX")||K9()?(l=this.createOrRecycleSendMedia(t,o,s,"sendonly",r),this.updateBundleMids()):(l=dn(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="sendonly",l.attributes.ssrcs=o,l.attributes.ssrcGroups=s,this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(l,r)),Bt()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,l.attributes.mid),{mid:l.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:t,needExchangeSDP:n}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:t.attributes.mid,needExchangeSDP:n}}batchSend(t){const n=t.map(o=>{let{kind:s,ssrcMsg:a,mslabel:c}=o;return this.send(s,a,c)}),i=[];let r=!1;return n.forEach(o=>{let{mid:s,needExchangeSDP:a}=o;a&&(r=!0),i.push(s)}),{mids:i,needExchangeSDP:r}}stopSending(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&-1!==t.indexOf(i.attributes.mid));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(i=>{"0"===i.attributes.mid||Bt()||K9()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>Y(t).call(t,i.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>Y(t).call(t,i.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="recvonly"})}receive(t,n,i,r){t.forEach((o,s)=>{this.createOrRecycleRecvMedia(o,[],"recvonly",n,i,r[s])}),this.updateBundleMids()}stopReceiving(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>-1!==t.indexOf(i.attributes.mid));if(n.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(t){const n=this.sessionDesc||Zn.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=t;const i=this.rtpCapabilities.send,r=this.localCapabilities.send;for(const o of n.mediaDescriptions){if(o.attributes.iceUfrag=this._iceParameters.iceUfrag,o.attributes.icePwd=this._iceParameters.icePwd,o.attributes.fingerprints=this._dtlsParameters.fingerprints,o.attributes.candidates=this._candidates,o.attributes.setup=this.setup,"application"===o.media.mediaType&&(o.attributes.sctpPort="5000"),"video"===o.media.mediaType)if(0===i.videoCodecs.length){const s=r.videoCodecs.filter(a=>{var c,l;return null===(c=a.rtpMap)||void 0===c?void 0:Y(l=c.encodingName.toLowerCase()).call(l,"vp8")})||[r.videoCodecs[0]];o.media.fmts=s.map(a=>a.payloadType.toString(10)),o.attributes.payloads=s,o.attributes.extmaps=[]}else if(o.media.fmts=i.videoCodecs.map(s=>s.payloadType.toString(10)),o.attributes.payloads=i.videoCodecs,o.attributes.extmaps=i.videoExtensions,R("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:s,ssrcGroups:a}=Md([{ssrcId:4e4,rtx:R("USE_SUB_RTX")?40001:void 0}],this.cname);o.attributes.ssrcs=s,o.attributes.ssrcGroups=a}if("audio"===o.media.mediaType)if(0===i.audioCodecs.length){const s=r.audioCodecs.filter(a=>{var c,l;return null===(c=a.rtpMap)||void 0===c?void 0:Y(l=c.encodingName.toLowerCase()).call(l,"opus")})||[r.audioCodecs[0]];o.media.fmts=s.map(a=>a.payloadType.toString(10)),o.attributes.payloads=s,o.attributes.extmaps=[]}else if(o.media.fmts=i.audioCodecs.map(s=>s.payloadType.toString(10)),o.attributes.payloads=i.audioCodecs,o.attributes.extmaps=i.audioExtensions,Ip(o),R("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:s,ssrcGroups:a}=Md([{ssrcId:2e4}],this.cname);o.attributes.ssrcs=s,o.attributes.ssrcGroups=a}}return this.sessionDesc=n,this.currentMidIndex=n.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(t){const n=this._candidates.filter(i=>"udp"===i.transport);if(t===xr.TCP){if(0===n.length)return;if(R("TCP_CANDIDATE_ONLY")){const i=this._candidates.filter(r=>"tcp"===r.transport);n.forEach(r=>{-1===i.findIndex(o=>o.connectionAddress===r.connectionAddress)&&i.push(El(El({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),this._candidates=i}else{const i=[];n.forEach(r=>{i.push(El(El({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),this._candidates=[...n,...i]}}else if(t===xr.RELAY){if(0!==n.length)return;{const i=this._candidates.filter(r=>"tcp"===r.transport);i.forEach(r=>{n.push(El(El({},r),{},{foundation:"udpcandidate",priority:Number(r.priority)+1+"",transport:"udp",port:Number(r.port)-90+""}))}),this._candidates=[...n,...i]}}else 0===n.length?(this._candidates.filter(i=>"tcp"===i.transport).forEach(i=>{n.push(El(El({},i),{},{foundation:"udpcandidate",priority:Number(i.priority)+1+"",transport:"udp",port:Number(i.port)-90+""}))}),this._candidates=n):this._candidates=this._candidates.filter(i=>"tcp"!==i.transport);for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}restartICE(t){t=dn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}findAvailableMediaIndex(t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const r=i.media.mediaType===t&&"0"!==i.media.port&&("sendonly"===i.attributes.direction||"sendrecv"===i.attributes.direction)&&0===i.attributes.ssrcs.length;if(Bt()){if(r){const o=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(o||"0"!==i.attributes.mid&&"1"!==i.attributes.mid)||!(!o||o!==i.attributes.mid)}return!1}return r})}createOrRecycleDataChannel(){for(const i of this.sessionDesc.mediaDescriptions)if("application"===i.media.mediaType)return{mediaDesc:i,needExchangeSDP:!1};this.currentMidIndex+=1;const t="".concat(this.currentMidIndex),n={media:{mediaType:"application",port:"9",protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(t),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(n),{mediaDesc:n,needExchangeSDP:!0}}createOrRecycleRecvMedia(t,n,i,r,o,s){const a=t._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,l=Yg(a,c,this.localCapabilities.send,a===ie.VIDEO?r:o),d=a===ie.VIDEO?c.videoExtensions:c.audioExtensions;this.currentMidIndex+=1;const u="".concat(this.currentMidIndex);let h={media:{mediaType:a,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};h=this.mungRecvMediaDsec(h,t,s);const p=this.findFirstClosedMedia(a);if(p){const m=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[m]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}updateRemoteCodec(t,n,i){const r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(h=>h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").filter(h=>{var p;return Y(p=Object.keys(bS)).call(p,h)}))],o=new Set(n);if(r.every(h=>o.has(h)))return _.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(n)),!1;const s=this._rtpCapabilities.recv.videoCodecs.filter(h=>n.some(p=>{var m;return Y(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,p)}));if(0===s.length)return _.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(n)),!1;const a=[...new Set(s.map(h=>h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||""))];let c;if(_.debug("updateRemoteCodec, from ".concat(r," to ").concat(a)),0===t.length)c=this.sessionDesc.mediaDescriptions.filter(h=>"video"===h.media.mediaType&&"recvonly"===h.attributes.direction);else if(c=this.sessionDesc.mediaDescriptions.filter(h=>h.attributes.mid&&Y(t).call(t,h.attributes.mid)&&"recvonly"===h.attributes.direction),c.length!==t.length)return _.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t,", codecs: ").concat(n)),!1;if(R("USE_PUB_RTX")||R("USE_SUB_RTX")){const h=GP(s,this.rtpCapabilities.recv.videoCodecs);s.push(...h)}this._rtpCapabilities.recv.videoCodecs=s;const u=Yg(ie.VIDEO,this.rtpCapabilities.recv,this.localCapabilities.send,i);return c.forEach(h=>{const p=u.map(m=>m.payloadType.toString(10));_.debug("updateRemoteCodec mid: ".concat(h.attributes.mid,", from ").concat(h.attributes.payloads," to ").concat(u)),h.attributes.payloads=u,h.media.fmts=p}),!0}createOrRecycleSendMedia(t,n,i,r,o){const s=this.rtpCapabilities.send,a=t===ie.VIDEO?s.videoCodecs:s.audioCodecs,c=t===ie.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;const l="".concat(this.currentMidIndex);let d={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(h=>h.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungSendMediaDesc(d,o);const u=this.findFirstClosedMedia(t);if(u){const h=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[h]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>"0"!==t.media.port).map(t=>t.attributes.mid)}mungRecvMediaDsec(t,n,i){const r=dn(t);return BP(r),wp(r,n),jP(r,n),DY(r),KS(r,i,this.localCapabilities.send),r}mungSendMediaDesc(t,n){const i=dn(t);return KS(i,n,this.localCapabilities.recv),Ip(i),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===t);if(-1!==i){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=r}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(n=>Bt()?"0"===n.media.port&&n.media.mediaType===t:"0"===n.media.port)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(n=>{var i;return(null===(i=n.attributes)||void 0===i||null===(i=i.ssrcs[0])||void 0===i?void 0:i.ssrcId)===t[0].ssrcId})}getSSRC(t){var n;return null===(n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t))||void 0===n?void 0:n.attributes.ssrcs}}function F$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function _c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F$(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F$(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let t_=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({});var Dp=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Dp||{});const nC=new Map;function U$(e,t,n,i){let{scale:r}=e;if(0===r&&i===Dp.UP||r>=t.length-1&&i===Dp.DOWN)return e;let o=_c(_c({},e),{},{scale:i===Dp.DOWN?++r:--r});switch(n){case"maintain-framerate":o=_c(_c({},o),t[r].motion);break;case"maintain-resolution":o=_c(_c({},o),t[r].detail);break;case"balanced":o=_c(_c({},o),t[r].balanced)}return o}function V$(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:B$(t)};nC.set(e,n)}else nC.delete(e)}function B$(e){const t=_c({},e),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:r,bitrateMin:o}=t,{MIN_FRAME_RATE:s,MAX_THRESHOLD_FRAMERATE:a,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:l,BITRATE_MAX_THRESHOLD:d,BWE_SCALE_UP_THRESHOLD:u,BWE_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_DOWN_THRESHOLD:p,PERF_SCALE_UP_THRESHOLD:m,BALANCE_BITRATE_FACTOR:f,BALANCE_FRAMERATE_FACTOR:g,BALANCE_RESOLUTION_FACTOR:E,MOTION_RESOLUTION_FACTOR:b,MOTION_BITRATE_FACTOR:T,DETAIL_FRAMERATE_FACTOR:I,DETAIL_BITRATE_FACTOR:D}=MN,O=Math.min(t.frameRate,a),k=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(p,1)*O),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:o}}];for(let L=1;L<=c;L++){const V={bwe_up:Math.round(Math.pow(u,L)*n),bwe_down:Math.round(Math.pow(h,L+1)*n),fps_up:Math.round(Math.pow(m,L)*O),fps_down:Math.round(Math.pow(p,L+1)*O)},ee={scaleResolutionDownBy:r/Math.pow(E,L),frameRate:Math.max(Math.round(Math.pow(g,L)*i),s),bitrateMax:Math.max(Math.round(Math.pow(f,L)*n),d),bitrateMin:Math.max(Math.round(Math.pow(f,L)*o),l)},oe={scaleResolutionDownBy:r/Math.pow(b,L),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(T,L)*n),d),bitrateMin:Math.max(Math.round(Math.pow(T,L)*o),l)},Ie={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(I,L)*i),s),bitrateMax:Math.max(Math.round(Math.pow(D,L)*n),d),bitrateMin:Math.max(Math.round(Math.pow(D,L)*o),l)};k.push({scale:L,threshold:V,balanced:ee,motion:oe,detail:Ie})}return k}function j$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function _M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j$(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j$(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const iC=new Map;function rC(e,t){const n=iC.get(e);if(n){const{timer:i}=n;window.clearTimeout(i),iC.delete(e)}t.qualityLimitationReason=t_.NONE,V$(e)}var Oe;function H$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Oa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H$(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H$(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Gs=(Oe=class I_ extends P7{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return null!==(t=null===(n=this.peerConnection.getReceivers()[0])||void 0===n||null===(n=n.transport)||void 0===n?void 0:n.state)&&void 0!==t?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return Y(n=Object.keys(bS)).call(n,t)}))]}constructor(t,n){super(t,n),y(this,"store",void 0),y(this,"peerConnection",void 0),y(this,"id",gt(5,"connection-")),y(this,"remoteSDP",void 0),y(this,"initialOffer",void 0),y(this,"transportEventReceiver",void 0),y(this,"statsFilter",void 0),y(this,"extension",{useXR:R("USE_XR")}),y(this,"localCapabilities",void 0),y(this,"remoteCodecs",void 0),y(this,"localCandidateCount",0),y(this,"allCandidatesReceived",!1),y(this,"isPreallocation",!1),y(this,"preSSRCMap",new Map),y(this,"dataStreamChannelMap",new Map),y(this,"establishPromise",void 0),y(this,"recoveredDataChannelIds",[]),y(this,"currentDataChannelId",1),y(this,"mutex",new gi("P2PConnection-mutex")),y(this,"qualityLimitationReason",t_.NONE),this.store=n,this.peerConnection=new RTCPeerConnection(I_.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=pM(this.peerConnection,R("STATS_UPDATE_INTERVAL"),void 0,Bt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t){const n=this.preSSRCMap.get(t);if(void 0!==n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);if(i)return{transceiver:i,track:i.receiver.track,id:n}}}updateRemoteRTPCapabilities(t,n){var i=this;return C(function*(){if(i.remoteCodecs=n,i.remoteSDP)if(i.remoteSDP.updateRemoteCodec(t,n,i.store.codec)){const r=yield i.peerConnection.createOffer(),o=i.logSDPExchange(r.sdp||"","offer","local","muteLocal");yield i.peerConnection.setLocalDescription(r);const s=i.remoteSDP.toString();o?.(s),yield i.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else _.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else _.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(i.localCodecs,", codecs: ").concat(n))})()}establish(){var t=this;return C(function*(){try{t.peerConnection.addTransceiver("video",{direction:"recvonly"}),t.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=yield t.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=ml(n.sdp),r=yield NY({filterRTX:!R("USE_PUB_RTX")&&!R("USE_SUB_RTX"),filterVideoFec:R("FILTER_VIDEO_FEC"),filterAudioFec:R("FILTER_AUDIO_FEC"),filterVideoCodec:R("FILTER_VIDEO_CODEC")},t.extension);return t.localCapabilities=qS(r),t.initialOffer=n,Oa(Oa({},i),{},{rtpCapabilities:r,offerSDP:n.sdp})}catch(n){throw new M(S.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}})()}connect(t){var n=this;return C(function*(){try{if(!n.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");n.remoteSDP=new dLe(Oa(Oa({},t),{},{localCapabilities:n.localCapabilities})),t.preallocation&&(n.isPreallocation=!0),Array.isArray(n.remoteCodecs)&&n.remoteCodecs.length>0&&n.remoteSDP.updateRemoteCodec([],n.remoteCodecs,n.store.codec);const i=n.remoteSDP.toString(),r=MY(n.initialOffer.sdp,n.extension),o=n.logSDPExchange(r||"","offer","local","connect");n.store.descriptionStart(),yield n.peerConnection.setLocalDescription({type:"offer",sdp:r}),o?.(i),yield n.peerConnection.setRemoteDescription({type:"answer",sdp:i});const s=n.peerConnection.getTransceivers()[0];if(null!=s&&s.receiver&&n.tryBindTransportEvents(s.receiver),R("PRELOAD_MEDIA_COUNT")>0){n.remoteSDP.preloadRemoteMedia(R("PRELOAD_MEDIA_COUNT"));const c=n.remoteSDP.toString();yield n.peerConnection.setRemoteDescription({type:"offer",sdp:c});const l=yield n.peerConnection.createAnswer();yield n.peerConnection.setLocalDescription(l)}const{preSSRCs:a}=t;if(Array.isArray(a)&&a.length>0){const{mids:c}=n.remoteSDP.batchSend(a.map(l=>({kind:l.kind,ssrcMsg:[{ssrcId:l.ssrcId,rtx:l.rtx}],mslabel:l.mslabel})));c.forEach((l,d)=>{n.preSSRCMap.set(a[d].ssrcId,l)}),yield YS(n.peerConnection,n.remoteSDP,n.extension),_.debug("[".concat(n.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}})()}updateRemoteConnect(t){var n=this;return C(function*(){try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:i}=t;n.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(n.remoteCodecs)&&n.remoteCodecs.length>0&&n.remoteSDP.updateRemoteCodec([],n.remoteCodecs,n.store.codec);const{preSSRCs:r}=t;if(Array.isArray(r)&&r.length>0){const{mids:o}=n.remoteSDP.batchSend(r.map(s=>Object.assign({},{kind:s.kind,ssrcMsg:[{ssrcId:s.ssrcId,rtx:s.rtx}],mslabel:s.mslabel})));o.forEach((s,a)=>{n.preSSRCMap.set(r[a].ssrcId,s)})}yield YS(n.peerConnection,n.remoteSDP,n.extension),_.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}})()}send(t,n,i){var r=this;return Ao(function*(){const o=yield Ne(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=[];t.forEach(f=>{const g=r.peerConnection.addTransceiver(f._mediaStreamTrack,{direction:"sendonly"});s.push(g),f._updateRtpTransceiver(g)}),Bt()&&!0===R("SIMULCAST")&&(yield Ne(r.applySimulcastForFirefox(s,t)));const a=yield Ne(r.peerConnection.createOffer()),c=r.remoteSDP.predictReceivingMids(t.length),l=r.mungSendOfferSDP(a.sdp,t,c),d=Zn.parse(l),u=c.map(f=>{const g=d.mediaDescriptions.find(E=>E.attributes.mid===f);if(!g)throw new Error("Cannot extract ssrc from mediaDescription.");return IY(g,R("USE_PUB_RTX"))});let h;try{h=yield u}catch(f){h=[],r.remoteSDP.receive(t,n,i,h);const g=r.remoteSDP.toString();throw yield Ne(r.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield Ne(r.peerConnection.setRemoteDescription({type:"answer",sdp:g})),yield Ne(r.stopSending(c,!0)),f}r.remoteSDP.receive(t,n,i,h);const p=r.remoteSDP.toString(),m=r.logSDPExchange(l,"offer","local","send");return yield Ne(r.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield Ne(r.applySimulcastEncodings(s,t)),yield Ne(r.applySendEncodings(s,t)),m?.(p),yield Ne(r.peerConnection.setRemoteDescription({type:"answer",sdp:p})),s.map((f,g)=>({localSSRC:u[g],id:c[g],transceiver:f}))}catch(s){throw s instanceof M?s:new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{o()}})()}createDataChannels(t,n){var i=this;return C(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=i.dataStreamChannelMap.get(t);if(r&&"open"===r.readyState)_.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=i.currentDataChannelId<1023?i.currentDataChannelId++:i.recoveredDataChannelIds.shift();if("number"!=typeof s)throw new Error("create DataChannel error, because cannot get dc id");r=i.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:R("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",i.dataStreamChannelMap.set(t,r)}n.forEach(s=>{s._updateOriginDataChannel(r)});const{needExchangeSDP:o}=i.remoteSDP.sendDataChannel();if(o){const s=i.remoteSDP.toString();yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=yield i.peerConnection.createAnswer();yield i.peerConnection.setLocalDescription(a),_.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else _.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof M?r:new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}})()}stopDataChannels(t){var n=this;return C(function*(){try{const i=n.dataStreamChannelMap.get(t);return i&&(i.id&&n.recoveredDataChannelIds.push(i.id),i.close()),void n.dataStreamChannelMap.delete(t)}catch(i){throw i instanceof M?i:new M(S.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}})()}stopSending(t,n){var i=this;return C(function*(){const r=n?void 0:yield i.mutex.lock("From P2PConnection.stopSending");try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=i.peerConnection.getTransceivers().filter(l=>-1!==t.indexOf(l.mid));if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");o.map(l=>{var d;rC(i.id+l.mid,i),l.direction="inactive",null===(d=l.stop)||void 0===d||d.call(l)});const s=yield i.peerConnection.createOffer(),a=i.logSDPExchange(s.sdp||"","offer","local","stopSending");yield i.peerConnection.setLocalDescription(s),i.remoteSDP.stopReceiving(t);const c=i.remoteSDP.toString();a?.(c),yield i.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(o){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{r&&r()}})()}receive(t,n,i,r){var o=this;return C(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:s,needExchangeSDP:a}=o.remoteSDP.send(t,n,i,r);a&&(yield YS(o.peerConnection,o.remoteSDP,o.extension),_.debug("[".concat(o.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const c=o.peerConnection.getTransceivers().find(l=>l.mid===s);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:s,transceiver:c}}catch(s){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}})()}batchReceive(t){var n=this;return C(function*(){try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:r}=n.remoteSDP.batchSend(t);return r&&(yield YS(n.peerConnection,n.remoteSDP,n.extension),_.debug("[".concat(n.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(o=>{const s=n.peerConnection.getTransceivers().find(a=>a.mid===o);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:o,transceiver:s}})}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}})()}stopReceiving(t){var n=this;return C(function*(){try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(s=>{Array.from(n.preSSRCMap.entries()).some(a=>{let[c,l]=a;if(l===s)return n.preSSRCMap.delete(c),!0})}),n.remoteSDP.stopSending(t);const i=n.remoteSDP.toString(),r=n.logSDPExchange(i,"offer","remote","stopReceiving");yield n.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=yield n.peerConnection.createAnswer();r?.(o.sdp||""),yield n.peerConnection.setLocalDescription(o)}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}})()}muteRemote(t){var n=this;return C(function*(){try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));n.remoteSDP.mute(t);const i=n.remoteSDP.toString(),r=n.logSDPExchange(i,"offer","remote","muteRemote");yield n.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=yield n.peerConnection.createAnswer();r?.(o.sdp||""),yield n.peerConnection.setLocalDescription(o)}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}})()}unmuteRemote(t){var n=this;return C(function*(){try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));n.remoteSDP.unmute(t);const i=n.remoteSDP.toString(),r=n.logSDPExchange(i,"offer","remote","unmuteRemote");yield n.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=yield n.peerConnection.createAnswer();r?.(o.sdp||""),yield n.peerConnection.setLocalDescription(o)}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}})()}muteLocal(t){var n=this;return C(function*(){try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=n.peerConnection.getTransceivers().filter(a=>a.mid&&-1!==t.indexOf(a.mid));if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(a=>{a.direction="inactive"});const r=yield n.peerConnection.createOffer(),o=n.logSDPExchange(r.sdp||"","offer","local","muteLocal");yield n.peerConnection.setLocalDescription(r),n.remoteSDP.muteRemote(t);const s=n.remoteSDP.toString();o?.(s),yield n.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}})()}unmuteLocal(t){var n=this;return C(function*(){try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=n.peerConnection.getTransceivers().filter(a=>a.mid&&-1!==t.indexOf(a.mid));if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(function(){var a=C(function*(c,l){c.direction="sendonly"});return function(c,l){return a.apply(this,arguments)}}());const r=yield n.peerConnection.createOffer(),o=n.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");yield n.peerConnection.setLocalDescription(r),n.remoteSDP.unmuteRemote(t);const s=n.remoteSDP.toString();o?.(s),yield n.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new M(S.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}})()}restartICE(t){var n=this;return Ao(function*(){const i=yield Ne(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Fe().supportPCSetConfiguration){const l=n.peerConnection.getConfiguration(),d=t===xr.RELAY?"relay":"all";l.iceTransportPolicy!==d&&(_.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(l.iceTransportPolicy,"] to [").concat(d,"]")),l.iceTransportPolicy=d,n.peerConnection.setConfiguration(l))}else if(t===xr.RELAY)return;n.remoteSDP.updateCandidates(t);const r=yield Ne(n.peerConnection.createOffer({iceRestart:!0}));if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o=ml(r.sdp),{remoteIceParameters:s}=yield o.iceParameters;n.remoteSDP.restartICE(s);const a=n.remoteSDP.toString(),c=n.logSDPExchange(r.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Ne(n.peerConnection.setLocalDescription(r)),c?.(a),yield Ne(n.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(r){_.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{rC(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Oa(Oa({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}updateEncoderConfig(t,n){var i=this;return C(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=yield i.peerConnection.createOffer(),o=i.mungSendOfferSDP(r.sdp,[n],[t]);i.remoteSDP.updateRecvMedia(t,n);const s=i.remoteSDP.toString(),a=i.logSDPExchange(o,"offer","local","updateEncoderConfig");yield i.peerConnection.setLocalDescription({type:"offer",sdp:o}),a?.(s),yield i.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new M(S.EXCHANGE_SDP_FAILED,r.toString())}})()}updateSendParameters(t,n){var i=this;return C(function*(){const r=i.peerConnection.getTransceivers().filter(o=>o.mid===t);1===r.length&&(i.isVP8Simulcast(n)?Bt()||(yield i.applySimulcastEncodings(r,[n])):yield i.applySendEncodings(r,[n]))})()}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}replaceTrack(t,n){var i=this;return C(function*(){const r=i.peerConnection.getTransceivers().find(o=>o.mid===n);r&&(yield r.sender.replaceTrack(t._mediaStreamTrack))})()}getSelectedCandidatePair(){var t=this;return C(function*(){const n=t.peerConnection.getReceivers();if(n.length>0&&n[0].transport&&n[0].transport.iceTransport&&n[0].transport.iceTransport.getSelectedCandidatePair&&n[0].transport.iceTransport.getSelectedCandidatePair()){const i=n[0].transport.iceTransport,{local:r,remote:o}=i.getSelectedCandidatePair();return{local:Oa(Oa({},Da),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Oa(Oa({},Da),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return t.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,_.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,_.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},R("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(pS(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...I_.turnServerConfigToIceServers(t.turnServer.servers)),R("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...I_.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),R("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),R("ENABLE_ENCODED_TRANSFORM")&&Fe().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(ap(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!R("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var r;null!=n&&n.state&&(null===(r=this.onDTLSTransportStateChange)||void 0===r||r.call(this,n.state))},n.onerror=r=>{var o;null===(o=this.onDTLSTransportError)||void 0===o||o.call(this,"error"in r?r.error:r)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const r=n?.iceTransport.state;var o;r&&(null===(o=this.onICETransportStateChange)||void 0===o||o.call(this,r))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:r,remote:o}=i.getSelectedCandidatePair();_.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(t,n){var i=this;return C(function*(){var r,o;if(n||(n=i.peerConnection.getSenders().find(E=>E.track===t._mediaStreamTrack)),!n)return _.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(i.isVP8Simulcast(t))return _.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Fe().supportSetRtpSenderParameters)return _.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},a={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const c=(E=t._mediaStreamTrack,i.peerConnection.getTransceivers().find(b=>b.sender.track===E||b.receiver.track===E)),l=(e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:i,height:r}=e.getMediaStreamTrackSettings();let{frameRate:o=n,width:s=i,height:a=r}=t;if(!o||!s||!a)return;s=RN(s),a=RN(a),o=RN(o);const{max:c,min:l}=function(p,m,f){const g=200*Math.pow(f/15,.6)*Math.pow(p*m/640/360,.75);return{min:Math.floor(g),max:Math.floor(4*g)}}(s,a,o),{bitrateMax:d,bitrateMin:u}=t||{};d||_.debug("calculate bitrate: [w: ".concat(s,", h: ").concat(a,", fps: ").concat(o,"] => [brMax: ").concat(d,", brMin: ").concat(u,"]"));const{maxFramerate:h}=R("ENCODER_CONFIG_LIMIT");return h&&"number"==typeof h&&(o=Math.min(o,h)),{frameRate:o,bitrateMax:d||c,bitrateMin:u||l,scaleResolutionDownBy:1,scale:0}})(t);var E;if(function hLe(e){var t;return!(!R("ENABLE_AG_ADAPTATION")||!(e instanceof LP||Y(t=e._hints).call(t,ft.CUSTOM_TRACK))||!R("FORCE_SUPPORT_AG_ADAPTATION")&&!(function(n){const i=xe();if(i.os!==kn.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return Number(r[0])>=14}()&&G9(17,4,!0)||H9(14)&&W9(17,4,!0)))}(t)&&c&&n&&l&&i.getLocalVideoStats&&Y(r=["vp8","vp9"]).call(r,i.store.codec)){var d;const g=s.degradationPreference||(Y(d=t._hints).call(d,ft.CUSTOM_TRACK)?R("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");!function(E,b,T,I,D,O){if(rC(E,T),D(b),"balanced"!==I&&"maintain-framerate"!==I&&"maintain-resolution"!==I)return;let k=-1;V$(E,b);const L=window.setInterval(()=>{const ee=iC.get(E);if(!R("ENABLE_AG_ADAPTATION")||!ee)return rC(E,T),void D(b);const oe=O();if(oe.sendPackets>0&&oe.OutgoingAvailableBandwidth>0){if(-1===k)return void(k=Date.now());if(Date.now()-k<1e3)return;const Ie=oe.sendFrameRate,Ue=oe.OutgoingAvailableBandwidth,[Dt,dt]=function uLe(e,t,n,i,r,o){const s=nC.get(e)||{overUse:0,underUse:0,adaptationList:B$(r)},{adaptationList:a}=s;nC.set(e,s);const{OVERUSE_TIMES_THRESHOLD:c,UNDERUSE_TIMES_THRESHOLD:l}=MN,{scale:d}=i;let u,h;return"number"==typeof t&&t>0&&function(p,m,f,g){if(m>=f.length)return!1;let{threshold:{fps_down:E}}=f[m];return R("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===g&&(E=f[0].threshold.fps_down),p<E}(t,d,a,o)&&(s.overUse++,h=t_.CPU,s.overUse>c)||"number"==typeof n&&n>0&&function(p,m,f){if(m>=f.length)return!1;const{threshold:{bwe_down:g}}=f[m];return p<g}(n,d,a)&&(s.overUse++,h=t_.BANDWIDTH,s.overUse>c)?(s.overUse=0,s.underUse=0,u=U$(i,a,o,Dp.DOWN),[u,h]):("number"==typeof t&&t>0&&"number"==typeof n&&n>0&&function(p,m,f,g){if(0===m)return;let{threshold:{fps_up:E}}=f[m];return R("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===g&&(E=f[1].threshold.fps_up),p>E}(t,d,a,o)&&function(p,m,f){if(0===m)return;const{threshold:{bwe_up:g}}=f[m];return p>g}(n,d,a)&&(s.underUse++,s.underUse>l&&(s.overUse=0,s.underUse=0,u=U$(i,a,o,Dp.UP),0===u.scale&&(h=t_.NONE))),[u,h])}(E,Ie,Ue,ee.adaptationConfig,b,I);dt&&(T.qualityLimitationReason=dt),Dt&&ee.adaptationConfig.scale!==Dt.scale&&(_.debug("[".concat(E,"] applyAdaptation: ").concat(T.qualityLimitationReason,"\n           sendFps ").concat(Ie,", bwe ").concat(Ue,", switch from ").concat(ee.adaptationConfig.scale," to ").concat(Dt.scale," ")),ee.adaptationConfig=_M(_M({},ee.adaptationConfig),Dt),D(Dt))}},R("CHECK_LOCAL_STATS_INTERVAL")),V=_M({},b);iC.set(E,{timer:L,adaptationConfig:V,originConfig:b,adaptationFunc:D}),_.debug("[".concat(E,"] start adaptation, originConfig: ").concat(JSON.stringify(b),", degradationPreference: ").concat(I))}(i.id+c.mid,l,i,g,E=>{n&&i.updateAdaptation(n,E)},i.getLocalVideoStats.bind(i))}if(t._encoderConfig){var u;const{bitrateMax:g,frameRate:E,scaleResolutionDownBy:b}=t._encoderConfig;g&&(a.maxBitrate=1e3*g),(Y(u=t._hints).call(u,ft.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(E&&(a.maxFramerate=kr(E)),b&&b>=1&&(a.scaleResolutionDownBy=b))}const{maxFramerate:h}=R("ENCODER_CONFIG_LIMIT");if(h&&"number"==typeof h&&(a.maxFramerate=a.maxFramerate?Math.min(a.maxFramerate,h):h),R("DSCP_TYPE")&&sl()){var p;const g=R("DSCP_TYPE");Y(p=["very-low","low","medium","high"]).call(p,g)&&(a.networkPriority=g)}const m=n.getParameters(),f=null===(o=m.encodings)||void 0===o?void 0:o[0];var g;Bt()&&!f&&(s.encodings=[a]),f&&Object.assign(f,a),Object.assign(m,s),_.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),yield n.setParameters(m),yield(g=C(function*(E,b,T){try{var I;if(!Fe().supportSetRtpSenderParameters||!function(V){return"vp9"===V}(E)||!R("ENABLE_SVC"))return;const D={},O={},k=b.getParameters(),L=null===(I=k.encodings)||void 0===I?void 0:I[0];O.scalabilityMode=VP(T),L&&Object.assign(L,O),Object.assign(k,D),yield b.setParameters(k),_.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(k.encodings)))}catch(D){_.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",D)}}),function(E,b,T){return g.apply(this,arguments)})(i.store.codec,n,R("SVC_MODE"))})()}updateAdaptation(t,n){var i=this;return C(function*(){var r,o;if(!t)return _.debug("[updateAdaptation] no rtpSender found");if(!Fe().supportSetRtpSenderParameters)return _.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:a,frameRate:c,scaleResolutionDownBy:l}=n;a&&(s.maxBitrate=1e3*a),c&&(s.maxFramerate=kr(c)),l&&l>=1&&Y(r=["vp8","vp9"]).call(r,i.store.codec)&&(s.scaleResolutionDownBy=l);const d=t.getParameters(),u=null===(o=d.encodings)||void 0===o?void 0:o[0];u&&Object.assign(u,s),Object.assign(d,{});try{yield t.setParameters(d),_.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(d.encodings)))}catch(h){!("transport"in t)||t.transport&&"connected"===t.transport.state?"connected"!==i.peerConnectionState?_.debug("[updateAdaptation] peerConnection not connected}"):_.debug("[updateAdaptation] updateRtpSenderEncodings failed",h):_.debug("[updateAdaptation] rtpSender transport not connected}")}})()}applySendEncodings(t,n){var i=this;return C(function*(){try{if(!Fe().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){const o=t[r],s=n[r];s instanceof St&&!i.isVP8Simulcast(s)&&(yield i.updateRtpSenderEncodings(s,o.sender))}}catch{_.debug("[".concat(i.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(t,n,i){const r=Zn.parse(t);return n.forEach((o,s)=>{const a=i[s],c=r.mediaDescriptions.find(l=>l.attributes.mid===a);c&&(wp(c,o),OY(c,o,this.store.codec))}),Zn.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;null===(n=this.onFirstAudioReceived)||void 0===n||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;null===(n=this.onFirstVideoReceived)||void 0===n||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;null===(n=this.onFirstAudioDecoded)||void 0===n||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;null===(i=this.onSelectedLocalCandidateChanged)||void 0===i||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;null===(i=this.onSelectedRemoteCandidateChanged)||void 0===i||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;null===(n=this.onFirstVideoDecodedTimeout)||void 0===n||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(t,n){var i=this;return C(function*(){if(t.length===n.length)for(let l=0;l<t.length;l++){var r,o,s,a,c;const d=t[l],u=n[l];if(u instanceof St&&!Y(r=u._hints).call(r,ft.LOW_STREAM)&&null!==(o=u._encoderConfig)&&void 0!==o&&o.bitrateMax&&(null===(s=u._encoderConfig)||void 0===s?void 0:s.bitrateMax)>200&&null!==(a=u._scalabilityMode)&&void 0!==a&&a.numSpatialLayers&&(null===(c=u._scalabilityMode)||void 0===c?void 0:c.numSpatialLayers)>1&&"vp8"===i.store.codec){const h={},p={high:1e3*(u._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{rid:"m",active:!0,maxBitrate:p.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:p.high}];const m=d.sender.getParameters();yield d.sender.setParameters(Object.assign(m,h))}}})()}applySimulcastEncodings(t,n){var i=this;return C(function*(){if(!Bt()&&t.length===n.length)for(let r=0;r<t.length;r++){const o=n[r];if(o instanceof St&&i.isVP8Simulcast(o)){const s=t[r],a={},c={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};a.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];const l=s.sender.getParameters();yield s.sender.setParameters(Object.assign(l,a))}}})()}isVP8Simulcast(t){var n,i,r,o,s;return!!(t instanceof St&&R("SIMULCAST")&&"vp8"===this.store.codec&&!Y(n=t._hints).call(n,ft.LOW_STREAM)&&null!==(i=t._encoderConfig)&&void 0!==i&&i.bitrateMax&&(null===(r=t._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(o=t._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(s=t._scalabilityMode)||void 0===s?void 0:s.numSpatialLayers)>1)}logSDPExchange(t,n,i,r){if(R("SDP_LOGGING"))return _.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,"\n"),t),"offer"===n?o=>{this.logSDPExchange(o,"answer","local"===i?"remote":"local",r)}:void 0}getRemoteSSRC(t){var n=this;return C(function*(){if(!n.remoteSDP)return;const i=n.remoteSDP.getSSRC(t);return i&&0!==i.length?i[0].ssrcId:void 0})()}setConfiguration(t){if(Fe().supportPCSetConfiguration){const n=I_.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Q(Oe.prototype,"updateRemoteRTPCapabilities",[rr],Object.getOwnPropertyDescriptor(Oe.prototype,"updateRemoteRTPCapabilities"),Oe.prototype),Q(Oe.prototype,"connect",[rr],Object.getOwnPropertyDescriptor(Oe.prototype,"connect"),Oe.prototype),Q(Oe.prototype,"updateRemoteConnect",[rr],Object.getOwnPropertyDescriptor(Oe.prototype,"updateRemoteConnect"),Oe.prototype),Q(Oe.prototype,"createDataChannels",[rr],Object.getOwnPropertyDescriptor(Oe.prototype,"createDataChannels"),Oe.prototype),Q(Oe.prototype,"receive",[rr],Object.getOwnPropertyDescriptor(Oe.prototype,"receive"),Oe.prototype),Q(Oe.prototype,"batchReceive",[rr],Object.getOwnPropertyDescriptor(Oe.prototype,"batchReceive"),Oe.prototype),Q(Oe.prototype,"stopReceiving",[rr],Object.getOwnPropertyDescriptor(Oe.prototype,"stopReceiving"),Oe.prototype),Q(Oe.prototype,"muteRemote",[rr],Object.getOwnPropertyDescriptor(Oe.prototype,"muteRemote"),Oe.prototype),Q(Oe.prototype,"unmuteRemote",[rr],Object.getOwnPropertyDescriptor(Oe.prototype,"unmuteRemote"),Oe.prototype),Q(Oe.prototype,"muteLocal",[rr],Object.getOwnPropertyDescriptor(Oe.prototype,"muteLocal"),Oe.prototype),Q(Oe.prototype,"unmuteLocal",[rr],Object.getOwnPropertyDescriptor(Oe.prototype,"unmuteLocal"),Oe.prototype),Q(Oe.prototype,"close",[rr],Object.getOwnPropertyDescriptor(Oe.prototype,"close"),Oe.prototype),Q(Oe.prototype,"updateEncoderConfig",[rr],Object.getOwnPropertyDescriptor(Oe.prototype,"updateEncoderConfig"),Oe.prototype),Q(Oe.prototype,"updateSendParameters",[rr],Object.getOwnPropertyDescriptor(Oe.prototype,"updateSendParameters"),Oe.prototype),Q(Oe.prototype,"replaceTrack",[rr],Object.getOwnPropertyDescriptor(Oe.prototype,"replaceTrack"),Oe.prototype),Q(Oe.prototype,"updateAdaptation",[rr],Object.getOwnPropertyDescriptor(Oe.prototype,"updateAdaptation"),Oe.prototype),Q(Oe.prototype,"getRemoteSSRC",[rr],Object.getOwnPropertyDescriptor(Oe.prototype,"getRemoteSSRC"),Oe.prototype),Oe);function rr(e,t,n){const i=e[t];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return n.value=C(function*(){const r=this.mutex,o=yield r.lock("From P2PConnection.".concat(t));try{for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];return yield i.apply(this,a)}finally{o()}}),n}var be;function G$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Na(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G$(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G$(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function W$(e){var t,n,i,r=2;for(typeof Symbol<"u"&&(n=cN,i=Symbol.iterator);r--;){if(n&&null!=(t=e[n]))return t.call(e);if(i&&null!=(t=e[i]))return new oC(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function oC(e){function t(n){if(Object(n)!==n)return q.reject(new TypeError(n+" is not an object."));var i=n.done;return q.resolve(n.value).then(function(r){return{value:r,done:i}})}return(oC=function(n){this.s=n,this.n=n.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return void 0===i?q.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return void 0===i?q.reject(n):t(i.apply(this.s,arguments))}},new oC(e)}let sC=(be=class extends kt{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(de.StateChange,t,this._state)}constructor(e,t){var n;super(),n=this,y(this,"isPlanB",void 0),y(this,"store",void 0),y(this,"statsUploader",void 0),y(this,"connection",void 0),y(this,"localTrackMap",new Map),y(this,"remoteUserMap",new Map),y(this,"localDataChannels",[]),y(this,"remoteDataChannelMap",new Map),y(this,"pendingLocalTracks",[]),y(this,"pendingRemoteTracks",[]),y(this,"pendingLocalDataChannels",[]),y(this,"pendingRemoteDataChannels",[]),y(this,"statsCollector",void 0),y(this,"shouldForwardP2PCreation",void 0),y(this,"iceFailedCount",0),y(this,"dtlsFailedCount",0),y(this,"mutex",new gi("P2PChannel-mutex")),y(this,"_state",Xe.Disconnected),y(this,"_pcStatsUploadType",R("NEW_ICE_RESTART")?dc.FIRST_CONNECTION:dc.OLD_FIRST_CONNECTION),y(this,"_isInRestartIce",!1),y(this,"_isStartRestartIce",!1),y(this,"_restartStates",["disconnected","failed"]),y(this,"_restartTimer",void 0),y(this,"_isFirstConnected",!0),y(this,"handleMuteLocalTrack",function(){var i=C(function*(r,o,s){const a=yield n.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!n.connection||n.state!==Xe.Connected)return void s(new M(S.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=n.filterTobeMutedTracks(r);if(0===c.length)return void o();const l=c.find(u=>"videoLowTrack"===u[0]);l&&l[1].track._originMediaStreamTrack.stop(),yield n.connection.muteLocal(c.map(u=>{let[,{id:h}]=u;return h}));const d=n.createMuteMessage(c);yield ct(n,de.RequestMuteLocal,d),o()}catch(c){s(c)}finally{a()}});return function(r,o,s){return i.apply(this,arguments)}}()),y(this,"handleUnmuteLocalTrack",function(){var i=C(function*(r,o,s){const a=yield n.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!n.connection||n.state!==Xe.Connected)return void s(new M(S.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=n.filterTobeUnmutedTracks(r);if(0===c.length)return void o();const l=c.find(u=>"videoLowTrack"===u[0]);if(l){const u=l[1];if(u.track._originMediaStreamTrack.stop(),!R("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fe().supportDualStreamEncoding){const h=r._mediaStreamTrack.clone();u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h}else{const h=fM(r,xg(n,de.RequestLowStreamParameter));u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h}yield new q((h,p)=>{n.handleReplaceTrack(u.track,h,p,!0)})}yield n.connection.unmuteLocal(c.map(u=>{let[,{id:h}]=u;return h}));const d=n.createUnmuteMessage(c);yield ct(n,de.RequestUnmuteLocal,d),o()}catch(c){s(c)}finally{a()}});return function(r,o,s){return i.apply(this,arguments)}}()),y(this,"handleUpdateVideoEncoder",function(){var i=C(function*(r,o,s){const a=yield n.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const c=n.localTrackMap.get(j.LocalVideoTrack);if(!n.connection||!c||c.track!==r||n.state!==Xe.Connected)return void o();const{id:l,track:d}=c;yield n.connection.updateSendParameters(l,d),yield n.connection.updateEncoderConfig(l,d),n.emit(de.UpdateVideoEncoder,d),o()}catch(c){s(c)}finally{a()}});return function(r,o,s){return i.apply(this,arguments)}}()),y(this,"handleUpdateVideoSendParameters",function(){var i=C(function*(r,o,s){const a=yield n.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const c=n.localTrackMap.get(j.LocalVideoTrack);if(!n.connection||!c||c.track!==r||n.state!==Xe.Connected)return void o();const{id:l,track:d}=c;yield n.connection.updateSendParameters(l,d),o()}catch(c){s(c)}finally{a()}});return function(r,o,s){return i.apply(this,arguments)}}()),y(this,"handleReplaceMixingTrack",function(){var i=C(function*(r,o,s,a){if(!n.connection||n.state!==Xe.Connected)return void o();const c=gM([r]);let l;_.debug("[".concat(n.store.clientId,"] [p2pId: ").concat(n.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(c.getTrackId(),"]")),"boolean"==typeof a&&a||(l=yield n.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{yield n.replaceTrack(r,c),o()}catch(u){s(u)}finally{var d;null===(d=l)||void 0===d||d()}});return function(r,o,s,a){return i.apply(this,arguments)}}()),y(this,"handleReplaceTrack",function(){var i=C(function*(r,o,s,a){let c;_.debug("[".concat(n.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),"boolean"==typeof a&&a||(c=yield n.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;const u=Array.from(n.localTrackMap.entries()).find(h=>{let[,{track:p}]=h;return r===p});if(!n.connection||!u||n.state!==Xe.Connected)return void o();if(yield null===(l=n.connection)||void 0===l?void 0:l.replaceTrack(r,u[1].id),n.isPlanB){const h=u[1];h.id=r._mediaStreamTrack.id,n.localTrackMap.set(u[0],h)}if(u[0]===j.LocalVideoTrack&&!R("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fe().supportDualStreamEncoding){const h=n.localTrackMap.get(j.LocalVideoLowTrack);if(h){const p=r._mediaStreamTrack.clone();h.track._originMediaStreamTrack.stop(),h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p,yield new q((m,f)=>{n.handleReplaceTrack(h.track,m,f,!0)})}}o()}catch(u){s(u)}finally{var d;null===(d=c)||void 0===d||d()}});return function(r,o,s,a){return i.apply(this,arguments)}}()),y(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),y(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),y(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),y(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),y(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new g$(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!Fe().supportUnifiedPlan||R("CHROME_FORCE_PLAN_B")&&sl(),this.shouldForwardP2PCreation=R("FORWARD_P2P_CREATION")&&Fe().supportPCSetConfiguration&&yN(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Qg({},this.store):new Gs({},this.store),this.bindConnectionEvents(this.connection))}startP2PConnection(e){var t=this;return C(function*(){var n;t.state=Xe.New;const i=t.shouldForwardP2PCreation&&"closed"===(null===(n=t.connection)||void 0===n?void 0:n.peerConnectionState);if(t.shouldForwardP2PCreation&&!i||(i&&t.connection&&(_.warning("[".concat(t.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),t.connection.close(),t.unbindConnectionEvents(t.connection)),t.connection=t.isPlanB?new Qg(e,t.store):new Gs(e,t.store),t.bindConnectionEvents(t.connection)),!t.connection)throw new M(S.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return t._pcStatsUploadType=R("NEW_ICE_RESTART")?dc.FIRST_CONNECTION:dc.OLD_FIRST_CONNECTION,t._isFirstConnected=!0,t._isInRestartIce=!1,t._isStartRestartIce=!1,t.connection.setConfiguration(e),t.connection.establishPromise})()}connect(e){var t=this;return C(function*(){if(!t.connection)throw new M(S.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");R("ENABLE_PREALLOC_PC")&&t.state===Xe.Connected?yield t.connection.updateRemoteConnect(e):(t.store.peerConnectionStart(),yield t.connection.connect(e),t.statsUploader.startUploadTransportStats(),t.statsUploader.startUploadExtensionUsageStats(),t.state=Xe.Connected)})()}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(r=>{var o;let[s]=r;return Y(o=[j.LocalVideoLowTrack,j.LocalVideoTrack]).call(o,s)}),n=t.map(r=>{let[,{id:o}]=r;return o}),i=t.map(r=>{let[o]=r;return o});if(this.connection instanceof Gs){if(ne.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Y(e).call(e,this.store.codec)){const r=["vp9","vp8","h264"].find(o=>Y(e).call(e,o));r&&(this.store.codec=r,_.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(r,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}getEstablishParams(){var e=this;return C(function*(){var t;if(e.connection instanceof Gs&&"closed"!==e.connection.peerConnectionState&&Y(t=[Xe.New,Xe.Connected]).call(t,e.state))return e.connection.establishPromise})()}publishDataChannel(e){var t=this;return C(function*(){if(!t.connection||t.state!==Xe.Connected){if(t.state===Xe.Disconnected)throw new M(S.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var r;Y(r=t.pendingLocalDataChannels).call(r,i)||t.pendingLocalDataChannels.push(i)}),[]}const n=t.filterTobePublishedDataChannels(e);return 0===n.length?[]:(n.forEach(i=>{const r=Date.now();t.store.publish(i.id.toString(),"datachannel",r)}),yield t.connection.createDataChannels(t.store.uid,n),n.forEach(i=>{t.localDataChannels.push(i);const r=Date.now();t.store.publish(i.id+"","datachannel",void 0,r)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))})()}publish(e,t,n){var i=this;return Ao(function*(){const r=yield Ne(i.mutex.lock("From P2PChannel.publish"));try{if(!i.connection||i.state!==Xe.Connected){if(i.state===Xe.Disconnected)throw new M(S.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);const s=e.filter(a=>-1===i.pendingLocalTracks.indexOf(a));return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(s))}i.store.pubId=i.store.pubId+1,vi.markPublishStart(i.store.clientId,i.store.pubId);const o=i.filterTobePublishedTracks(e,t,n);if(0===o.length)return void(yield Ne(i.tryToUnmuteAudio(e)));yield*nS(W$(i.doPublish(i.connection,o)))}finally{r()}})()}doPublish(e,t){var n=this;return Ao(function*(){t.forEach(u=>{let{track:h,type:p}=u;const m=Date.now();n.store.publish(h.getTrackId(),p===j.LocalAudioTrack?"audio":"video",m)}),n.bindLocalTrackEvents(t);const i=t.map(u=>{let{track:h}=u;return h}),r=yield Ne(e.send(i,n.store.codec,n.store.audioCodec)),o=(yield Ne(r.next())).value,s=n.createGatewayPublishMessage(t,o);let a;try{a=yield s}catch(u){throw r.throw(u),u?.code===S.WS_ABORT&&t.forEach(h=>{let{track:p}=h;-1===n.pendingLocalTracks.indexOf(p)&&n.pendingLocalTracks.push(p)}),n.unbindLocalTrackEvents(t),u}const c=n.mapPubResToRemoteConfig(s,a,i),l=(yield Ne(r.next(c))).value,d=R("ENABLE_VIDEO_SEI");i.forEach(function(){var u=C(function*(h){const p=h.getRTCRtpTransceiver();var m;p&&d&&(h.trackMediaType===ie.VIDEO?yield function Uke(e,t){return UP.apply(this,arguments)}(p.sender,h):h.trackMediaType===ie.AUDIO&&(yield(m=C(function*(f){if(!Fe().supportWebRTCEncodedTransform)return void _.warning("browser not support audio encoded transform");if(GS.has(f)||!f.track)return;const g={track:f.track};if(ol()){if(!f.createEncodedStreams)return void _.warning("browser not support createEncodedStreams() API");let b=null;try{b=f.createEncodedStreams()}catch(I){return void _.error("create audio-encoded-streams error",I&&I.message)}const T=new TransformStream({transform(I,D){g.controller||(g.controller=D),f.track&&f.track.id!==g.track.id&&(_.debug("audio track changed: ".concat(g.track.id," => ").concat(f.track.id)),g.track.removeEventListener("ended",E),g.track=f.track,g.track.addEventListener("ended",E)),D.enqueue(I)}});b.readable.pipeThrough(T).pipeTo(b.writable)}else if(ti()){if(typeof RTCRtpScriptTransform>"u")return void _.warning("browser not support RTCRtpScriptTransform");const b=HS(),T=new MessageChannel;yield new q(D=>b.onmessage=O=>{"registered"===O.data&&D(void 0)});const I=new RTCRtpScriptTransform(b,{name:"tx",port:T.port2},[T.port2]);f.transform=I,yield new q(D=>b.onmessage=O=>{"started"===O.data&&D(void 0)}),T.port1.onmessage=D=>{var O;D.data.transformed&&f.track&&(null===(O=f.track)||void 0===O?void 0:O.id)!==g.track.id&&(_.debug("audio track changed: ".concat(g.track.id," => ").concat(f.track.id)),g.track.removeEventListener("ended",E),g.track=f.track,g.track.addEventListener("ended",E))},g.worker=b}function E(){if(f.track){if(this.id!==f.track.id)return;f.track.removeEventListener("ended",E)}const b=GS.get(f);if(b){GS.delete(f);try{var T,I;null===(T=b.controller)||void 0===T||T.terminate(),null===(I=b.worker)||void 0===I||I.terminate()}catch(D){_.warning(D&&D.message)}}}GS.set(f,g),f.track.addEventListener("ended",E)}),function(f){return m.apply(this,arguments)})(p.sender)))});return function(h){return u.apply(this,arguments)}}()),t.forEach(u=>{let{type:h}=u;n.statsCollector.addLocalStats(h)}),n.assignLocalTracks(t,l),n.statsUploader.startUploadOutboundStats(),t.forEach(u=>{let{track:h,type:p}=u;const m=Date.now();n.store.publish(h.getTrackId(),p===j.LocalAudioTrack?"audio":"video",void 0,m)})})()}updateVideoStreamParameter(e,t){var n=this;return C(function*(){const i=n.localTrackMap.get(t);if(!i)return;if(!(i.track instanceof St))return _.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(n.connection instanceof Gs||n.connection instanceof Qg))return _.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:r}=i,o=function(s,a){const c={};return s.height&&s.width&&(c.scaleResolutionDownBy=XN(s,a)),c.maxFramerate=s.framerate?kr(s.framerate):void 0,c.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,c}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==j.LocalVideoLowTrack||!R("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fe().supportDualStreamEncoding)null!=o.scaleResolutionDownBy&&(r._encoderConfig.scaleResolutionDownBy=o.scaleResolutionDownBy);else{const s=r._originMediaStreamTrack;if(!s.canvas)return _.warn("[".concat(r.getTrackId(),"] no canvas on track"));!function(a,c){const l=a.canvas;c.width&&(l.width=kr(c.width)),c.height&&(l.height=kr(c.height)),c.framerate&&(l.stopCapture&&l.stopCapture(),l.stopCapture=wP(()=>{!l.startCapture&&l.stopCapture&&l.stopCapture(),l.startCapture&&l.startCapture()},kr(c.framerate)))}(s,e)}null!=o.maxBitrate&&(r._encoderConfig.bitrateMax=o.maxBitrate/1e3),null!=o.maxFramerate&&(r._encoderConfig.frameRate&&"object"==typeof r._encoderConfig.frameRate?r._encoderConfig.frameRate.max=o.maxFramerate:r._encoderConfig.frameRate={max:o.maxFramerate}),_.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),yield n.connection.updateRtpSenderEncodings(r)})()}publishLowStream(e){var t=this;return Ao(function*(){if(!t.connection||t.state!==Xe.Connected)return;const n=yield Ne(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const r=t.localTrackMap.get(j.LocalVideoTrack);if(!r)throw new M(S.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(j.LocalVideoLowTrack))throw new M(S.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const o=[{track:t.getLowVideoTrack(r.track,e),type:j.LocalVideoLowTrack}];if(yield*nS(W$(t.doPublish(t.connection,o))),r.track.muted||!r.track.enabled){var i;const s=null===(i=t.localTrackMap.get(j.LocalVideoLowTrack))||void 0===i?void 0:i.id;void 0!==s&&(yield Ne(t.connection.muteLocal([s])))}}finally{n()}})()}republish(){var e=this;return C(function*(){e.pendingLocalTracks.length>0&&(_.debug("[".concat(e.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield ii(e,de.RequestRePublish,e.pendingLocalTracks),e.emit(de.MediaReconnectEnd,e.store.uid),e.pendingLocalTracks=[]),e.pendingLocalDataChannels.length>0&&(_.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),yield ii(e,de.RequestRePublishDataChannel,e.pendingLocalDataChannels),e.pendingLocalDataChannels=[])})()}reSubscribe(e){var t=this;return C(function*(){for(let n=t.pendingRemoteTracks.length-1;n>=0;n--){const{user:i,kind:r}=t.pendingRemoteTracks[n];(r!==ie.AUDIO||i._audio_added_&&i._audioSSRC)&&(r!==ie.VIDEO||i._video_added_&&i._videoSSRC)||t.pendingRemoteTracks.splice(n,1)}if(e)yield ii(t,de.RequestReSubscribe,t.pendingRemoteTracks);else for(const{user:n,kind:i}of t.pendingRemoteTracks)yield t.subscribe(n,i,i===ie.VIDEO?n._videoSSRC:n._audioSSRC);t.pendingRemoteTracks.forEach(n=>{let{user:i}=n;t.emit(de.MediaReconnectEnd,i.uid)}),t.pendingRemoteTracks=[]})()}unpublish(e){var t=this;return C(function*(){if(!t.connection||t.state!==Xe.Connected)return void e.forEach(r=>{const o=t.pendingLocalTracks.indexOf(r);-1!==o&&t.pendingLocalTracks.splice(o,1)});const n=t.filterTobeUnpublishedTracks(e);if(0===n.length)return;const i=n.find(r=>"videoLowTrack"===r[0]);return i&&i[1].track.close(),t.doUnpublish(t.connection,n)})()}unpublishDataChannel(e){var t=this;return C(function*(){if(!t.connection||t.state!==Xe.Connected)return void e.forEach(i=>{const r=t.pendingLocalDataChannels.indexOf(i);-1!==r&&t.pendingLocalDataChannels.splice(r,1)});const n=t.filterTobeUnpublishedDataChannels(e);return 0!==n.length?(n.forEach(i=>{const r=t.localDataChannels.indexOf(i);-1!==r&&t.localDataChannels.splice(r,1)}),0===t.localDataChannels.length&&(yield t.connection.stopDataChannels(t.store.uid)),n.map(i=>i.id)):void 0})()}unpublishLowStream(){var e=this;return C(function*(){if(!e.connection||e.state!==Xe.Connected)return;const t=e.localTrackMap.get(j.LocalVideoLowTrack);return t?(t.track.close(),e.doUnpublish(e.connection,[[j.LocalVideoLowTrack,t]])):void 0})()}doUnpublish(e,t){var n=this;return C(function*(){const i=n.createGatewayUnpublishMessage(t);return yield e.stopSending(t.map(r=>{let[,{id:o}]=r;return o})),n.withdrawLocalTracks(t),n.unbindLocalTrackEvents(t.map(r=>{let[o,{track:s}]=r;return{type:o,track:s}})),t.forEach(r=>{let[o]=r;n.statsCollector.removeLocalStats(o)}),0===n.localTrackMap.size&&n.statsUploader.stopUploadOutboundStats(),i})()}subscribeDataChannel(e,t){var n=this;return C(function*(){if(!n.connection||n.state!==Xe.Connected)throw new M(S.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=t.filter(r=>{var o;return!(null!==(o=n.remoteDataChannelMap.get(e))&&void 0!==o&&o.get(r.id))});if(0!==i.length)return yield n.connection.createDataChannels(e.uid,i),i.forEach(r=>{var o;n.remoteDataChannelMap.has(e)?null===(o=n.remoteDataChannelMap.get(e))||void 0===o||o.set(r.id,r):n.remoteDataChannelMap.set(e,new Map([[r.id,r]]));const s=n.pendingRemoteDataChannels.findIndex(a=>{let{user:c,id:l}=a;return c.uid===e.uid&&l===r.id});-1!==s&&n.pendingRemoteDataChannels.splice(s,1)}),i.map(r=>r.id)})()}subscribe(e,t,n,i,r){var o=this;return C(function*(){var s;if(!o.connection||o.state!==Xe.Connected)throw new M(S.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(s=o.remoteUserMap.get(e))&&void 0!==s&&s.has(t))return;let a,c,l;const d=o.connection.getPreMedia(n);if(d)_.debug("[".concat(o.store.clientId,"] [").concat(o.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),l=d.transceiver,a=d.track,c=d.id;else if(r){const p=r.find(f=>{let{stream_type:g}=f;return g===t});if(!p)throw new M(S.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const m=yield o.connection.receive(t,p.ssrcs,String(e._uintid),p.attributes);o.connection instanceof Gs&&(l=m.transceiver),a=m.track,c=m.id}else{const p=yield o.connection.receive(t,[{ssrcId:n,rtx:i}],String(e._uintid),void 0);o.connection instanceof Gs&&(l=p.transceiver),a=p.track,c=p.id}var p;t===ie.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new Tp(a,e.uid,e._uintid,o.store),_.info("[".concat(o.store.clientId,"] [").concat(o.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),l&&e._audioTrack._updateRtpTransceiver(l),o.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new Cp(a,e.uid,e._uintid,o.store),_.info("[".concat(o.store.clientId,"] [").concat(o.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),l&&e._videoTrack._updateRtpTransceiver(l),o.bindRemoteTrackEvents(e,e._videoTrack)),R("ENABLE_VIDEO_SEI")&&l&&(t==ie.VIDEO?yield(p=C(function*(m){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Fe().supportWebRTCEncodedTransform)return void _.warning("browser not support video encoded transform");if(!m.track)return;if(Kg.has(m)){const b=Kg.get(m);return void(b&&(b.onSei=f.onSei))}const g={track:m.track,onSei:f.onSei};if(ol()){if(!m.createEncodedStreams)return void _.warning("browser not support createEncodedStreams() API");let b=null;try{b=m.createEncodedStreams()}catch(I){return void _.error("create video-encoded-streams error",I&&I.message)}const T=new TransformStream({transform(I,D){g.controller||(g.controller=D),m.track&&m.track.id!==g.track.id&&(_.debug("video track changed: ".concat(g.track.id," => ").concat(m.track.id)),g.track.removeEventListener("ended",E),g.track=m.track,g.track.addEventListener("ended",E));const O=function(k){const L=new DataView(k.data);let V=0;for(;V+4<k.data.byteLength;){if(0===L.getUint8(V+0)&&0===L.getUint8(V+1)&&0===L.getUint8(V+2)&&1===L.getUint8(V+3)&&6===L.getUint8(V+4)){let ee=V+6,oe=0,Ie=0;for(;255===(Ie=L.getUint8(ee++));)oe+=255;oe+=Ie;const Ue=Fke(k.data,ee,oe);return new Uint8Array(Ue)}V++}return null}(I);O&&g.onSei&&g.onSei(O),D.enqueue(I)}});b.readable.pipeThrough(T).pipeTo(b.writable)}else if(ti()){if(typeof RTCRtpScriptTransform>"u")return void _.warning("browser not support RTCRtpScriptTransform");const b=HS(),T=new MessageChannel;yield new q(D=>b.onmessage=O=>{"registered"===O.data&&D(void 0)});const I=new RTCRtpScriptTransform(b,{name:"rx",port:T.port2},[T.port2]);m.transform=I,yield new q(D=>b.onmessage=O=>{"started"===O.data&&D(void 0)}),T.port1.onmessage=D=>{var O;D.data.transformed&&m.track&&(null===(O=m.track)||void 0===O?void 0:O.id)!==g.track.id?(_.debug("video track changed: ".concat(g.track.id," => ").concat(m.track.id)),g.track.removeEventListener("ended",E),g.track=m.track,g.track.addEventListener("ended",E)):D.data.sei&&g.onSei&&g.onSei(D.data.sei)},g.worker=b}function E(){if(m.track){if(this.id!==m.track.id)return;m.track.removeEventListener("ended",E)}!function(b){const T=Kg.get(b);if(T){Kg.delete(b);try{var I,D;null===(I=T.controller)||void 0===I||I.terminate(),null===(D=T.worker)||void 0===D||D.terminate()}catch(O){_.warning(O&&O.message)}}}(m)}Kg.set(m,g),m.track.addEventListener("ended",E)}),function(m){return p.apply(this,arguments)})(l.receiver,{onSei:p=>{var m;null===(m=e._videoTrack)||void 0===m||m._onSei(p)}}):t==ie.AUDIO&&(yield function(){var p=C(function*(m){if(!Fe().supportWebRTCEncodedTransform)return void _.warning("browser not support audio encoded transform");if(WS.has(m))return;const f={track:m.track};if(ol()){if(!m.createEncodedStreams)return void _.warning("browser not support createEncodedStreams() API");let E=null;try{E=m.createEncodedStreams()}catch(T){return void _.error("create audio-encoded-streams error",T&&T.message)}const b=new TransformStream({transform(T,I){f.controller||(f.controller=I),m.track&&m.track.id!==f.track.id&&(_.debug("audio track changed: ".concat(f.track.id," => ").concat(m.track.id)),f.track.removeEventListener("ended",g),f.track=m.track,f.track.addEventListener("ended",g)),I.enqueue(T)}});E.readable.pipeThrough(b).pipeTo(E.writable)}else if(ti()){if(typeof RTCRtpScriptTransform>"u")return void _.warning("browser not support RTCRtpScriptTransform");const E=HS(),b=new MessageChannel;yield new q(I=>E.onmessage=D=>{"registered"===D.data&&I(void 0)});const T=new RTCRtpScriptTransform(E,{name:"rx",port:b.port2},[b.port2]);m.transform=T,yield new q(I=>E.onmessage=D=>{"started"===D.data&&I(void 0)}),b.port1.onmessage=I=>{var D;I.data.transformed&&m.track&&(null===(D=m.track)||void 0===D?void 0:D.id)!==f.track.id&&(_.debug("audio track changed: ".concat(f.track.id," => ").concat(m.track.id)),f.track.removeEventListener("ended",g),f.track=m.track,f.track.addEventListener("ended",g))},f.worker=E}function g(){m.track.removeEventListener("ended",g),function(E){const b=WS.get(E);if(b){WS.delete(E);try{var T,I;null===(T=b.controller)||void 0===T||T.terminate(),null===(I=b.worker)||void 0===I||I.terminate()}catch(D){_.warning(D&&D.message)}}}(m)}WS.set(m,f),m.track.addEventListener("ended",g)});return function(m){return p.apply(this,arguments)}}()(l.receiver)));const u=o.remoteUserMap.get(e);u?u.set(t,c):o.remoteUserMap.set(e,new Map([[t,c]])),o.statsCollector.addRemoteStats(e.uid),o.statsUploader.startUploadInboundStats();const h=o.pendingRemoteTracks.findIndex(p=>{let{user:m,kind:f}=p;return m.uid===e.uid&&t===f});-1!==h&&(o.pendingRemoteTracks.splice(h,1),o.emit(de.MediaReconnectEnd,e.uid))})()}massSubscribe(e){var t=this;return C(function*(){return t.massSubscribeNoLock(e)})()}massSubscribeNoLock(e){var t=this;return C(function*(){if(!t.connection||t.state!==Xe.Connected)throw new M(S.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(o=>{var s;let{user:a,mediaType:c}=o;return!(null!==(s=t.remoteUserMap.get(a))&&void 0!==s&&s.has(c))});const n=[],i=new Map;e.forEach(o=>{if(!t.connection)return;const s=t.connection.getPreMedia(o.ssrcId);s?i.set(o.ssrcId,s):n.push(o)});const r=yield t.connection.batchReceive(n.map(o=>{let{user:s,mediaType:a,ssrcId:c,rtxSsrcId:l}=o;return{kind:a,ssrcMsg:[{ssrcId:c,rtx:l}],mslabel:String(s._uintid)}}));n.forEach((o,s)=>{i.set(o.ssrcId,r[s])}),e.forEach(o=>{let{user:s,mediaType:a,ssrcId:c}=o;const l=i.get(c);if(!l)return void _.debug("[".concat(t.store.clientId,"] [").concat(t.store.p2pId,"] cannot find ").concat(s.uid," subscribe data,").concat(a,", ").concat(c));const{track:d,id:u,transceiver:h}=l;a===ie.AUDIO?(s._audioTrack?s._audioTrack._updateOriginMediaStreamTrack(d):(s._audioTrack=new Tp(d,s.uid,s._uintid,t.store),_.info("[".concat(t.store.clientId,"] [").concat(t.store.p2pId,"] create remote audio track: ").concat(s._audioTrack.getTrackId()))),h&&s._audioTrack._updateRtpTransceiver(h),t.bindRemoteTrackEvents(s,s._audioTrack)):(s._videoTrack?s._videoTrack._updateOriginMediaStreamTrack(d):(s._videoTrack=new Cp(d,s.uid,s._uintid,t.store),_.info("[".concat(t.store.clientId,"] [").concat(t.store.p2pId,"] create remote video track: ").concat(s._videoTrack.getTrackId()))),h&&s._videoTrack._updateRtpTransceiver(h),t.bindRemoteTrackEvents(s,s._videoTrack));const p=t.remoteUserMap.get(s);p?p.set(a,u):t.remoteUserMap.set(s,new Map([[a,u]])),t.statsCollector.addRemoteStats(s.uid),t.statsUploader.startUploadInboundStats();const m=t.pendingRemoteTracks.findIndex(f=>{let{user:g,kind:E}=f;return g.uid===s.uid&&a===E});-1!==m&&(t.pendingRemoteTracks.splice(m,1),t.emit(de.MediaReconnectEnd,s.uid))})})()}unsubscribe(e,t,n){var i=this;return C(function*(){const r=i.pendingRemoteTracks.filter(a=>{let{user:c,kind:l}=a;return void 0!==t?c.uid===e.uid&&t===l:c.uid===e.uid});if(r.forEach(a=>{const c=i.pendingRemoteTracks.indexOf(a);i.pendingRemoteTracks.splice(c,1)}),i.connection&&i.state===Xe.Connected||n||r.forEach(a=>{let{kind:c}=a;var l;if(c===ie.AUDIO)null===(l=e._audioTrack)||void 0===l||l._destroy(),e._audioTrack=void 0;else if(c===ie.VIDEO){var d;null===(d=e._videoTrack)||void 0===d||d._destroy(),e._videoTrack=void 0}}),!i.connection||i.state!==Xe.Connected)return;const o=i.filterTobeUnSubscribedTracks(e,t);if(0===o.length)return;yield i.connection.stopReceiving(o.map(a=>{let[,{id:c}]=a;return c}));const s=i.createUnsubscribeMessage(o);return i.withdrawRemoteTracks(o),0===i.remoteUserMap.size&&i.statsUploader.stopUploadInboundStats(),o.forEach(a=>{let[c,{kind:l}]=a;var d,u;if(l===ie.VIDEO&&c._videoSSRC&&(null===(d=i.connection)||void 0===d||d.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===ie.VIDEO)i.unbindRemoteTrackEvents(c._videoTrack),n||(null===(u=c._videoTrack)||void 0===u||u._destroy(),c._videoTrack=void 0);else if(l===ie.AUDIO){var h;i.unbindRemoteTrackEvents(c._audioTrack),!n&&(null===(h=c._audioTrack)||void 0===h||h._destroy(),c._audioTrack=void 0)}}),s})()}unsubscribeDataChannel(e,t){var n=this;return C(function*(){if(t.forEach(o=>{const s=n.pendingRemoteDataChannels.findIndex(a=>a.id===o.id);-1!==s&&n.pendingRemoteDataChannels.splice(s,1)}),!n.connection)return;const i=n.filterTobeUnSubscribedDataChannels(e,t);if(0===i.length)return;t.forEach(o=>{o._close()});const r=n.remoteDataChannelMap.get(e);return i.forEach(o=>{r&&r.delete(o.id)}),r&&0===r.size&&(n.remoteDataChannelMap.delete(e),yield n.connection.stopDataChannels(e.uid)),i.map(o=>o.id)})()}massUnsubscribe(e){var t=this;return C(function*(){return t.massUnsubscribeNoLock(e)})()}massUnsubscribeNoLock(e){var t=this;return C(function*(){let n=[];for(const{user:o,mediaType:s}of e){const a=t.pendingRemoteTracks.filter(c=>{let{user:l,kind:d}=c;return void 0!==s?l.uid===o.uid&&s===d:l.uid===o.uid});a.forEach(c=>{const l=t.pendingRemoteTracks.indexOf(c);t.pendingRemoteTracks.splice(l,1)}),n=n.concat(a)}if(!t.connection||t.state!==Xe.Connected)return void n.forEach(o=>{let{user:s,kind:a}=o;var c;if(a===ie.AUDIO)null===(c=s._audioTrack)||void 0===c||c._destroy(),s._audioTrack=void 0;else if(a===ie.VIDEO){var l;null===(l=s._videoTrack)||void 0===l||l._destroy(),s._videoTrack=void 0}});const i=Ns(e).call(e,(o,s)=>{let{user:a,mediaType:c}=s;const l=t.filterTobeUnSubscribedTracks(a,c);return o.concat(l)},[]);if(0===i.length)return;yield t.connection.stopReceiving(i.map(o=>{let[,{id:s}]=o;return s}));const r=t.createUnsubscribeAllMessage(i);return t.withdrawRemoteTracks(i),0===t.remoteUserMap.size&&t.statsUploader.stopUploadInboundStats(),i.forEach(o=>{let[s,{kind:a}]=o;var c,l;if(a===ie.VIDEO&&s._videoSSRC&&(null===(c=t.connection)||void 0===c||c.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),a===ie.VIDEO)t.unbindRemoteTrackEvents(s._videoTrack),null===(l=s._videoTrack)||void 0===l||l._destroy(),s._videoTrack=void 0;else if(a===ie.AUDIO){var d;t.unbindRemoteTrackEvents(s._audioTrack),null===(d=s._audioTrack)||void 0===d||d._destroy(),s._audioTrack=void 0}}),r})()}isPreSubScribe(e){return!(!this.connection||this.state!==Xe.Connected||!this.connection.getPreMedia(e))}muteRemote(e,t){var n=this;return C(function*(){if(!n.connection)return;const i=n.remoteUserMap.get(e);if(!i)return void _.warning("[".concat(n.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void _.warning("[".concat(n.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===ie.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&n.connection.setStatsRemoteVideoIsReady(r,!1)})()}unmuteRemote(e,t){var n=this;return C(function*(){return n.unmuteRemoteNoLock(e,t)})()}unmuteRemoteNoLock(e,t){var n=this;return C(function*(){if(!n.connection)return;const i=n.remoteUserMap.get(e);i?i.get(t)||_.warning("[".concat(n.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):_.warning("[".concat(n.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."))})()}getAllTracks(e){const t=this.localTrackMap.get(j.LocalAudioTrack);if(t?.track instanceof wn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==j.LocalAudioTrack}).filter(i=>{let[r]=i;return!(e&&r===j.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===j.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,i,r){if(e){const s=this.localTrackMap.get(j.LocalAudioTrack),a=this.localTrackMap.get(i?j.LocalVideoLowTrack:j.LocalVideoTrack);ne.publish(this.store.sessionId,{eventElapse:vi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:s?.track.getTrackLabel(),videoName:a?.track.getTrackLabel(),screenshare:-1!==a?.track._hints.indexOf(ft.SCREEN_TRACK),audio:!!s,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var o;n||(n=[]);const s=n.find(c=>c instanceof Ht),a=i?null===(o=this.localTrackMap.get(j.LocalVideoTrack))||void 0===o?void 0:o.track:n.find(c=>c instanceof St);ne.publish(this.store.sessionId,{eventElapse:vi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:s?.getTrackLabel(),videoName:a?.getTrackLabel(),screenshare:-1!==a?._hints.indexOf(ft.SCREEN_TRACK),audio:!!s,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(e,t,n,i){const r=i===ie.VIDEO?n._videoSSRC:n._audioSSRC;r&&ne.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===ie.VIDEO,audio:i===ie.AUDIO,peerid:n.uid,subscribeRequestid:r,p2pid:this.store.p2pId,eventElapse:vi.measureFromSubscribeStart(this.store.clientId,r),preSsrc:this.isPreSubScribe(r)})}reset(){_.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new gi("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Qg({},this.store):new Gs({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(j.LocalAudioTrack);if(e?.track instanceof wn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Xe.Disconnected}getStats(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(j.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(j.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof St||t&&t.track instanceof Ht?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}hasRemoteMediaWithLock(e,t){var n=this;return C(function*(){if(!e)return n.remoteUserMap.size>0;const i=n.remoteUserMap.get(e);return!!i&&(!t||i.has(t))})()}getRemoteMedia(e){var t;const n=Array.from(Zr(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(j.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=gg(e).call(e,(n,i)=>n.level-i.level),e}disconnectForReconnect(){var e=this;return C(function*(){e.connection&&(_.debug("[".concat(e.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),e.state=Xe.Reconnecting,R("KEEP_LAST_FRAME")&&0!==e.remoteUserMap.size&&Array.from(e.remoteUserMap.entries()).forEach(t=>{let[n]=t;var i;n._videoTrack&&n._videoTrack._player&&(null===(i=n._videoTrack._player.getVideoElement())||void 0===i||i.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())}),e.connection.close(),e.unbindConnectionEvents(e.connection),e.connection=void 0,e.shouldForwardP2PCreation&&(e.connection=e.isPlanB?new Qg({},e.store):new Gs({},e.store),e.bindConnectionEvents(e.connection)),0!==e.localTrackMap.size&&(Array.from(e.localTrackMap.entries()).forEach(t=>{var n;let[i,{track:r}]=t;switch(i){case j.LocalVideoTrack:Y(n=r._hints).call(n,ft.LOW_STREAM)?r.close():e.pendingLocalTracks.push(r);break;case j.LocalAudioTrack:r instanceof wn?e.pendingLocalTracks=e.pendingLocalTracks.concat(r.trackList):e.pendingLocalTracks.push(r)}}),e.emit(de.MediaReconnectStart,e.store.uid)),e.unbindLocalTrackEvents(),e.localTrackMap.clear(),0!==e.remoteUserMap.size&&Array.from(e.remoteUserMap.entries()).forEach(t=>{let[n,i]=t;Array.from(Zr(i).call(i)).forEach(r=>{e.setPendingRemoteMedia(n,r)}),e.emit(de.MediaReconnectStart,n.uid)}),e.unbindAllRemoteTrackEvents(),e.remoteUserMap.clear(),0!==e.localDataChannels.length&&(e.localDataChannels.forEach(t=>{e.pendingLocalDataChannels.push(t)}),e.localDataChannels.length=0),0!==e.remoteDataChannelMap.size&&(Array.from(e.remoteDataChannelMap.entries()).forEach(t=>{let[n,i]=t;Array.from(Zr(i).call(i)).forEach(r=>{e.setPendingRemoteDataChannel(n,r)})}),e.remoteDataChannelMap.clear()),e.statsUploader.stopUploadOutboundStats(),e.statsUploader.stopUploadInboundStats(),e.statsUploader.stopUploadTransportStats(),_.debug("[".concat(e.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))})()}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:i,id:r}=n;if((e instanceof vl?e.uid:e)===i.uid&&r===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((e instanceof vl?e.uid:e)===i.uid&&t===r)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Ao(function*(){if(!t.connection||t.state!==Xe.Connected)return;const n=yield Ne(t.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield Ne(t.connection.restartICE(e));const o=yield Ne(i.next());if(o.done)return;const s=o.value,a=yield s;switch(t.reportPCDisconnectedOrFailed(e),e){case xr.TCP:t._pcStatsUploadType=dc.TCP_RESTART;break;case xr.RELAY:t._pcStatsUploadType=dc.RELAY_RESTART;break;default:t._pcStatsUploadType=dc.OLD_RESTART}t._isInRestartIce=!0,i.next(a)}catch(o){var r;null===(r=i)||void 0===r||r.throw(o)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(j.LocalVideoTrack),n=this.localTrackMap.get(j.LocalAudioTrack),i=e.videoSend.find(p=>p.ssrc===t?.ssrcs[0].ssrcId),r=e.audioSend.find(p=>p.ssrc===n?.ssrcs[0].ssrcId);if(!i||!r)return 1;const o=Do(this,de.NeedSignalRTT),s=i?i.rttMs:void 0,a=r?r.rttMs:void 0,c=s&&a?(s+a)/2:s||a,d=100*e.sendPacketLossRate*.7/50+.3*((c&&o?(c+o)/2:c||o)||0)/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,h=t?.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(ft.SCREEN_TRACK)){const p=h._encoderConfig.bitrateMax,m=e.bitrate.actualEncoded;if(p&&m){const f=(1e3*p-m)/(1e3*p);return y7[f<.15?0:f<.3?1:f<.45?2:f<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,o=i._videoSSRC,s=e.audioRecv.find(m=>m.ssrc===r),a=e.videoRecv.find(m=>m.ssrc===o);if(!s&&!a)return void(t+=1);const c=Do(this,de.NeedSignalRTT),l=e.rtt,d=(l&&c?(l+c)/2:l||c)||0,u=s?s.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*d/1500;u&&(p=.6*h*100/50+.2*d/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}muteLocalTrack(e){var t=this;return C(function*(){return new q((n,i)=>{t.handleMuteLocalTrack(e,n,i)})})()}replaceTrack(e,t){var n=this;return C(function*(){var i;if(_.debug("[".concat(n.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!n.connection||n.state!==Xe.Connected)return;const r=Array.from(n.localTrackMap.entries()).find(s=>{let[,{track:a}]=s;return e===a});if(!r)return;const o=r[0];if(e!==t&&(n.unbindLocalTrackEvents([{track:e,type:o}]),n.bindLocalTrackEvents([{track:t,type:o}]),r[1].track=t),yield null===(i=n.connection)||void 0===i?void 0:i.replaceTrack(t,r[1].id),n.isPlanB){const s=r[1];s.id=t._mediaStreamTrack.id,n.localTrackMap.set(o,s)}if(o===j.LocalVideoTrack&&!R("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fe().supportDualStreamEncoding){const s=n.localTrackMap.get(j.LocalVideoLowTrack);if(s){const a=e._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=a,s.track._originMediaStreamTrack=a,yield new q((c,l)=>{n.handleReplaceTrack(s.track,c,l,!0)})}}})()}filterTobePublishedTracks(e,t,n){const i=[],r=this.getAllTracks();e=Qh(e=e.filter(c=>-1===r.indexOf(c)));let o,s=!1;const a=this.localTrackMap.get(j.LocalAudioTrack);for(const c of e){if(c instanceof St&&(this.localTrackMap.has(j.LocalVideoTrack)||s?new M(S.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:c,type:j.LocalVideoTrack}),s=!0),t)){const l=this.getLowVideoTrack(c,n);i.push({track:l,type:j.LocalVideoLowTrack})}if(c instanceof Ht)if(a){const l=a.track;if(l instanceof wn)mM([c]),l.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0);else{const d=gM([l,c]);_.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(d.getTrackId(),"]")),this.replaceTrack(l,d)}}else o instanceof wn?(mM([c]),o.addAudioTrack(c)):o=o||!c._useAudioElement&&Fe().webAudioMediaStreamDest&&!c._bypassWebAudio?gM(o?[c,o]:[c]):c}return o&&(_.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),i.push({track:o,type:j.LocalAudioTrack})),i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Qh(e=e.filter(i=>-1!==n.indexOf(i)));for(const i of e){if(i instanceof Ht){const r=this.localTrackMap.get(j.LocalAudioTrack);if(!r)continue;r.track instanceof wn?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),0===r.track.trackList.length&&(t.push([j.LocalAudioTrack,r]),r.track.close())):t.push([j.LocalAudioTrack,r])}if(i instanceof St){const r=this.localTrackMap.get(j.LocalVideoTrack);if(!r)continue;t.push([j.LocalVideoTrack,r]);const o=this.localTrackMap.get(j.LocalVideoLowTrack);o&&t.push([j.LocalVideoLowTrack,o])}}return t}filterTobePublishedDataChannels(e){return(e=Qh(e)).filter(t=>-1===this.localDataChannels.findIndex(n=>n.id===t.id))}filterTobeUnpublishedDataChannels(e){return(e=(e=Qh(e)).filter(t=>-1!==this.localDataChannels.indexOf(t))).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case j.LocalVideoTrack:n.addListener(X.GET_STATS,this.handleGetLocalVideoStats),n.addListener(X.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(X.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(X.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(X.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case j.LocalAudioTrack:this.bindLocalAudioTrackEvents(n)}})}bindLocalAudioTrackEvents(e,t){e instanceof wn?e.trackList.forEach(n=>{n.addListener(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(X.GET_STATS,this.handleGetLocalAudioStats),n.addListener(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(X.GET_STATS,this.handleGetLocalAudioStats),e.addListener(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(X.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(X.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case j.LocalVideoTrack:n.off(X.GET_STATS,this.handleGetLocalVideoStats),n.off(X.GET_RTC_STATS,this.handleGetRTCStats),n.off(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(X.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(X.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(X.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case j.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n)}})}unbindLocalAudioTrackEvents(e){e instanceof wn?e.trackList.forEach(t=>{t.off(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(X.GET_STATS,this.handleGetLocalAudioStats),t.off(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(X.GET_STATS,this.handleGetLocalAudioStats),e.off(X.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(X.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(X.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(X.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(X.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(X.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Cp&&t.addListener(X.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Tp&&t.addListener(X.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(X.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(ie.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(ie.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{var r;let o,s,{track:a,type:c}=n;switch(c){case j.LocalAudioTrack:o=$e.Audio,s={dtx:a instanceof jS&&a._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case j.LocalVideoTrack:o=Y(r=a._hints).call(r,ft.SCREEN_TRACK)?$e.Screen:$e.High,s=Na(Na({},B7(a)),{},{codec:this.store.codec,svc_mode:VP()});break;case j.LocalVideoLowTrack:o=$e.Low,s=Na(Na({},B7(a)),{},{codec:this.store.codec,svc_mode:VP()})}return{stream_type:o,attributes:s,ssrcs:t[i]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let i,[r,{track:o,ssrcs:s,id:a}]=t;switch(r){case j.LocalVideoTrack:i=Y(n=o._hints).call(n,ft.SCREEN_TRACK)?$e.Screen:$e.High;break;case j.LocalAudioTrack:i=$e.Audio;break;case j.LocalVideoLowTrack:i=$e.Low}return{stream_type:i,ssrcs:s,mid:a}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:r,type:o}=n;this.localTrackMap.set(o,{track:r,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){var t=this;e.onConnectionStateChange=function(){var n=C(function*(i){if(_.info("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(i,")")),t.emit(de.PeerConnectionStateChange,i),"connected"!==i||t.store.keyMetrics.peerConnectionEnd||t.store.peerConnectionEnd(),"connected"===i&&(t._restartTimer&&(clearTimeout(t._restartTimer),t._restartTimer=void 0),(t._isFirstConnected||t._isInRestartIce)&&t.reportPCStats(Date.now(),!0,t._pcStatsUploadType),t._isInRestartIce=!1,t._isFirstConnected=!1,t._isStartRestartIce=!1),R("NEW_ICE_RESTART")){var r;if(Y(r=t._restartStates).call(r,i)){if(t._isStartRestartIce)return;t._isStartRestartIce=!0;const o=c=>{("disconnected"===e.iceConnectionState||"checking"===e.iceConnectionState||"failed"===e.iceConnectionState)&&(_.debug("[".concat(t.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(c)),"CONNECTED"===Do(t,de.QueryClientConnectionState)&&t.emit(de.RequestRestartICE,c))},s=()=>{"disconnected"!==e.iceConnectionState&&"checking"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||(t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),_.debug("[".concat(t.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>t.emit(de.P2PLost),0),t.iceFailedCount+=1,t.requestReconnect())},a=R("ICE_RESTART_INTERVAL");return void(t._restartTimer=window.setTimeout(()=>{if(R("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Fe().supportPCSetConfiguration)o(xr.RELAY),t._restartTimer=window.setTimeout(s,a);else if(Bt())o(xr.UDP),t._restartTimer=window.setTimeout(s,4e3);else{if(o(xr.TCP),Fe().supportPCSetConfiguration)return void(t._restartTimer=window.setTimeout(()=>{o(xr.RELAY),t._restartTimer=window.setTimeout(s,a)},a));t._restartTimer=window.setTimeout(s,a)}},800))}}else{if("disconnected"===i&&"disconnected"===e.iceConnectionState)return setTimeout(()=>{"disconnected"===e.iceConnectionState&&R("ICE_RESTART")&&"CONNECTED"===Do(t,de.QueryClientConnectionState)&&t.emit(de.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===e.peerConnectionState&&(_.debug("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),t._isInRestartIce=!1,setTimeout(()=>t.emit(de.P2PLost),0),t.iceFailedCount+=1,t.requestReconnect())},4e3);"failed"===i&&(_.debug("[".concat(t.store.clientId,"] [p2pId: ").concat(t.store.p2pId,"]: P2PConnection state failed, force reconnect")),t.reportPCDisconnectedOrFailed(),setTimeout(()=>t.emit(de.P2PLost),0),t.iceFailedCount+=1,yield t.requestReconnect())}});return function(i){return n.apply(this,arguments)}}(),e.onICEConnectionStateChange=n=>{"connected"!==n||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(n,")")),ne.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:n,tag:jt.TRACER}).onSuccess(),this.emit(de.IceConnectionStateChange,n)},e.onICETransportStateChange=n=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(n,")"))},e.onDTLSTransportStateChange=n=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(n,")"))},e.onDTLSTransportError=n=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(n,")"))},e.onFirstAudioDecoded=n=>{var i;const r=Array.from(Zr(i=this.remoteUserMap).call(i)).find(s=>s._audioSSRC===n);var o;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),null===(o=r.audioTrack)||void 0===o||o.emit(vp.FIRST_FRAME_DECODED),ne.firstRemoteFrame(this.store.sessionId,Yn.FIRST_AUDIO_DECODE,Lt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:vi.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=n=>{var i;const r=Array.from(Zr(i=this.remoteUserMap).call(i)).find(o=>o._audioSSRC===n);r&&ne.firstRemoteFrame(this.store.sessionId,Yn.FIRST_AUDIO_RECEIVED,Lt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:vi.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(n,i,r)=>{this.reportVideoFirstFrameDecoded(n,i,r)},e.onFirstVideoReceived=n=>{var i;const r=Array.from(Zr(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===n);r&&ne.firstRemoteFrame(this.store.sessionId,Yn.FIRST_VIDEO_RECEIVED,Lt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:vi.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(n,i)=>{const r="relay"===n.candidateType;"unknown"!==i.candidateType&&r===("relay"===i.candidateType)||this.emit(de.ConnectionTypeChange,r),_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(hl(i))," -> ").concat(JSON.stringify(hl(n)),")"))},e.onSelectedRemoteCandidateChanged=(n,i)=>{_.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(hl(i))," -> ").concat(JSON.stringify(hl(n)),")"))},e.onFirstVideoDecodedTimeout=n=>{this.reportVideoFirstFrameDecoded(n,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const n=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return Na(Na({},n),i)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(j.LocalAudioTrack);if(e instanceof Ht&&n?.track instanceof wn)return n.track.isActive||t.push([j.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:o}]=r;return e===o});if(i&&(t.push(i),i[0]===j.LocalVideoTrack)){const r=this.localTrackMap.get(j.LocalVideoLowTrack);r&&t.push([j.LocalVideoLowTrack,r])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(j.LocalAudioTrack);if(e instanceof Ht&&n?.track instanceof wn)return n.track.isActive&&t.push([j.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:o}]=r;return e===o});if(i)if(i[0]===j.LocalVideoTrack){t.push(i);const r=this.localTrackMap.get(j.LocalVideoLowTrack);r&&t.push([j.LocalVideoLowTrack,r])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{var n;let i,[r,{track:o,ssrcs:s,id:a}]=t;switch(r){case j.LocalAudioTrack:i=$e.Audio;break;case j.LocalVideoTrack:i=Y(n=o._hints).call(n,ft.SCREEN_TRACK)?$e.Screen:$e.High;break;case j.LocalVideoLowTrack:i=$e.Low}return{stream_type:i,ssrcs:s,mid:a}})}createUnmuteMessage(e){return e.map(t=>{var n;let i,[r,{track:o,ssrcs:s,id:a}]=t;switch(r){case j.LocalAudioTrack:i=$e.Audio;break;case j.LocalVideoTrack:i=Y(n=o._hints).call(n,ft.SCREEN_TRACK)?$e.Screen:$e.High;break;case j.LocalVideoLowTrack:i=$e.Low}return{stream_type:i,ssrcs:s,mid:a}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const r=i.get(t);if(!r)return n;n.push([e,{kind:t,id:r}])}else Array.from(i.entries()).forEach(r=>{let[o,s]=r;n.push([e,{kind:o,id:s}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(i=>{var r;null!==(r=this.remoteDataChannelMap.get(e))&&void 0!==r&&r.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:r}]=n;switch(r){case ie.VIDEO:return void(i._videoSSRC&&t.push({stream_type:ie.VIDEO,ssrcId:i._videoSSRC}));case ie.AUDIO:return void(i._audioSSRC&&t.push({stream_type:ie.AUDIO,ssrcId:i._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[i,{kind:r}]=n;if(t.has(i)){let o=t.get(i);o|=r===ie.VIDEO?Ln.Video:Ln.Audio,t.set(i,o)}else t.set(i,r===ie.VIDEO?Ln.Video:Ln.Audio)}),{users:Array.from(t.entries()).map(n=>{let[i,r]=n;return{stream_id:i.uid,stream_type:r}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const r=this.remoteUserMap.get(n);r&&(r.delete(i),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(n))})}updateBitrateLimit(e){var t=this;return C(function*(){const n=t.localTrackMap.get(j.LocalVideoTrack),i=t.localTrackMap.get(j.LocalVideoLowTrack);n&&(yield n.track.setBitrateLimit(e.uplink)),i&&e.low_stream_uplink&&(yield i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(e,t,n){return e.map((i,r)=>{var o;let{stream_type:s}=i;const a=null===(o=t.find(c=>{let{stream_type:l}=c;return s===l}))||void 0===o?void 0:o.attributes;if(a&&R("DISABLE_SCREEN_SHARE_REMB")){const c=n[r]._hints;(Y(c).call(c,ft.SCREEN_TRACK)||Y(c).call(c,ft.SCREEN_LOW_TRACK))&&(a.remb=!1,_.debug("disable remb for screen share, hints:",c))}return a})}tryToUnmuteAudio(e){var t=this;return C(function*(){for(let i=0;i<e.length;i++)if(e[i]instanceof Ht){var n;const r=t.filterTobeUnmutedTracks(e[i]);if(0===r.length)continue;yield null===(n=t.connection)||void 0===n?void 0:n.unmuteLocal(r.map(s=>{let[,{id:a}]=s;return a}));const o=t.createUnmuteMessage(r);return void(yield ct(t,de.RequestUnmuteLocal,o))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.connection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(de.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(de.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var e=this;return C(function*(){e.dtlsFailedCount+=1,yield qn(AN(e.dtlsFailedCount,vn)),e.emit(de.RequestReconnect)})()}reconnectP2P(){var e=this;return C(function*(){const t=Array.from(e.localTrackMap.entries()),n=e.createGatewayUnpublishMessage(t);Array.from(e.remoteUserMap.entries()),n.length>0&&(yield ii(e,de.RequestUnpublishForReconnectPC,n)),e.disconnectForReconnect(),e.emit(de.RequestReconnectPC)})()}canPublishLowStream(){return this.localTrackMap.has(j.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof St)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof St).length>1)throw new M(S.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ht).length>1&&(e.some(t=>t instanceof Ht&&t._bypassWebAudio)||!Fe().webAudioMediaStreamDest))throw new M(S.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof St&&this.pendingLocalTracks.some(n=>n instanceof St))throw new M(S.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ht&&this.pendingLocalTracks.some(n=>n instanceof Ht)&&(!Fe().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Ht&&n._bypassWebAudio)))throw new M(S.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const i=!R("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fe().supportDualStreamEncoding,r=Na(Na({},{width:160,height:120,framerate:15,bitrate:50}),t);let o;o=i?e._mediaStreamTrack.clone():fM(e,r);const s=gt(8,"track-low-"),a=new St(o,Na(Na({},i&&{scaleResolutionDownBy:XN(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return a.on(Dd.TRANSCEIVER_UPDATED,c=>{e._updateRtpTransceiver(c,gp.LOW_STREAM)}),a._hints.push(ft.LOW_STREAM),Y(n=e._hints).call(n,ft.SCREEN_TRACK)&&a._hints.push(ft.SCREEN_LOW_TRACK),e.on("sei-to-send",c=>{a.emit("sei-to-send",c)}),e.addListener(X.NEED_CLOSE,()=>{a.close()}),a}globalLock(){var e=this;return C(function*(){return e.mutex.lock("From P2PChannel.globalLock")})()}reportPCStats(e,t,n){var i=arguments,r=this;return C(function*(){let o=i.length>3&&void 0!==i[3]?i[3]:null;if(r.connection&&r.connection instanceof Gs){var s,a,c,l;const d=r.store.keyMetrics.descriptionStart||0,{iceConnectionState:u,dtlsTransportState:h,peerConnectionState:p}=r.connection,{local:m,remote:f}=yield r.connection.getSelectedCandidatePair();ne.pcStats(r.store.sessionId,{startTime:d,eventElapse:e-d||0,iceconnectionsate:u,dtlsstate:h,connectionstate:p,intSucc:t?1:2,error:o,selectedLocalCandidateProtocol:null!==(s=m?.protocol)&&void 0!==s?s:"",selectedLocalCandidateType:null!==(a=m.candidateType)&&void 0!==a?a:"",selectedLocalCandidateAddress:"".concat(m.address,":").concat(m.port),selectedRemoteCandidateProtocol:null!==(c=f.protocol)&&void 0!==c?c:"",selectedRemoteCandidateType:null!==(l=f.candidateType)&&void 0!==l?l:"",selectedRemoteCandidateAddress:"".concat(f.address,":").concat(f.port),restartCnt:n,preallocation:r.connection.isPreallocation})}})()}reportVideoFirstFrameDecoded(e,t,n,i){var r;const o=Array.from(Zr(r=this.remoteUserMap).call(r)).find(s=>s._videoSSRC===e);if(o){i||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const s=this.store.keyMetrics,a=s.subscribe.find(c=>c.userId===o.uid&&"video"===c.type);ne.firstRemoteVideoDecode(this.store.sessionId,Yn.FIRST_VIDEO_DECODE,Lt.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:vi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:s.requestAPEnd||0,apStart:s.requestAPStart||0,joinGwEnd:s.joinGatewayEnd||0,joinGwStart:s.joinGatewayStart||0,pcEnd:s.peerConnectionEnd||0,pcStart:s.peerConnectionStart||0,subscriberEnd:a?.subscribeEnd||0,subscriberStart:a?.subscribeStart||0,videoAddNotify:a?.streamAdded||0,state:i?1:0,firstFrame:a?.firstFrame||0})}}remoteMediaSsrcChanged(e,t,n){var i=this;return C(function*(){if(!i.connection)return!1;const r=i.remoteUserMap.get(e);if(!r)return!1;const o=r.get(t);if(!o)return!1;const s=yield i.connection.getRemoteSSRC(o);return void 0!==s&&s!==n})()}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===j.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,gp.LOW_STREAM):n._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof Gs&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this.reportPCStats(Date.now(),!1,this._pcStatsUploadType===dc.TCP_RESTART&&e===xr.RELAY?this._pcStatsUploadType:dc.DISCONNECTED_OR_FAILED)))}},Q(be.prototype,"startP2PConnection",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"startP2PConnection"),be.prototype),Q(be.prototype,"connect",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"connect"),be.prototype),Q(be.prototype,"updateRemoteRTPCapabilities",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"updateRemoteRTPCapabilities"),be.prototype),Q(be.prototype,"publishDataChannel",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"publishDataChannel"),be.prototype),Q(be.prototype,"unpublish",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"unpublish"),be.prototype),Q(be.prototype,"unpublishDataChannel",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"unpublishDataChannel"),be.prototype),Q(be.prototype,"unpublishLowStream",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"unpublishLowStream"),be.prototype),Q(be.prototype,"subscribeDataChannel",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"subscribeDataChannel"),be.prototype),Q(be.prototype,"subscribe",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"subscribe"),be.prototype),Q(be.prototype,"massSubscribe",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"massSubscribe"),be.prototype),Q(be.prototype,"unsubscribe",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"unsubscribe"),be.prototype),Q(be.prototype,"unsubscribeDataChannel",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"unsubscribeDataChannel"),be.prototype),Q(be.prototype,"massUnsubscribe",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"massUnsubscribe"),be.prototype),Q(be.prototype,"muteRemote",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"muteRemote"),be.prototype),Q(be.prototype,"unmuteRemote",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"unmuteRemote"),be.prototype),Q(be.prototype,"hasRemoteMediaWithLock",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"hasRemoteMediaWithLock"),be.prototype),Q(be.prototype,"disconnectForReconnect",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"disconnectForReconnect"),be.prototype),Q(be.prototype,"updateBitrateLimit",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"updateBitrateLimit"),be.prototype),Q(be.prototype,"remoteMediaSsrcChanged",[Ui],Object.getOwnPropertyDescriptor(be.prototype,"remoteMediaSsrcChanged"),be.prototype),be);function Ui(e,t,n){const i=e[t];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return n.value=C(function*(){const r=this.mutex,o=yield r.lock("From P2PChannel.".concat(t));try{for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];return yield i.apply(this,a)}finally{o()}}),n}const z$={};function n_(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&_.debug("install service ".concat(e.name)),z$[e.name]=e}function i_(e){const t=z$[e];if(!t)throw new M(S.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function K$(e,t){return i_("DataStream").create(e,t)}function q$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Y$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q$(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q$(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const pLe=Date.now(),fLe=20,vM=new Map,aC=new Map;function $$(e){return EM.apply(this,arguments)}function EM(){return EM=C(function*(e){const t=vM.get(e),n=Array.isArray(t)&&t[t.length-1],i=aC.get(e);if(!n)return void(i.isSyncing=!1);const r={uid:n.uid,payload:n.payload};0===i.firstRecvTs&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const o=n.sendTs-i.firstSendTs,s=o-(Date.now()-i.firstRecvTs);s>0&&(i.firstRecvTs=Date.now()-o);let a=n.mediaDelay+s;a<=0?(t.pop(),X$(n.context,r),a=0):a=Math.min(a,fLe),setTimeout(()=>t.length&&$$(e),a)}),EM.apply(this,arguments)}function X$(e,t){e.safeEmit(Ae.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}const gLe=xe().name;function Z$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function J$(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z$(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z$(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Op="websdk_ng_cache_parameter",_Le=R("MAX_PRELOAD_ASYNC_LENGTH"),vLe=1e4,Vd=new Map,Bd=[];let bM=null,yM=0,SM=0;const cC=new Map,ELe=function(e,t){const n=[];let i=0;const r=function(){var o=C(function*(){const s=n.shift();s&&(yield s()),n.length>0&&i<t?r():i--});return function(){return o.apply(this,arguments)}}();return C(function*(){for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return new q(function(){var c=C(function*(l,d){n.push(C(function*(){try{const u=yield e(...s);l(u)}catch(u){d(u)}})),i<t&&(i++,r())});return function(l,d){return c.apply(this,arguments)}}())})}(Q$,_Le),CM=nr.CancelToken.source();function Q$(e,t,n,i,r,o){return TM.apply(this,arguments)}function TM(){return TM=C(function*(e,t,n,i,r,o){try{if(!R("ENABLE_PRELOAD"))return;if(!Fe().supportWebCrypto)return void al(()=>{_.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&null!==n)throw new M(S.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Kn(n,"token",1,2047),Kn(e,"appid",1,2047),CS(t),i&&TS(i);const s=ep();_.debug("preload channel ".concat(t,", uid is ").concat(i));const a={appId:e,cname:t,token:n||e,uid:"string"!=typeof i?i:null,sid:s,proxyServer:r};let c,l;"string"==typeof i?(a.stringUid=i,[l,c]=yield q.all([zke(i,{sid:s,appId:e},CM.token),zY(J$(J$({},a),{},{token:n||e,uid:0}),CM.token)]),a.uid=l.uid,c.gatewayInfo.uid=a.uid,c.gatewayInfo.res.uid=a.uid):(o&&(a.stringUid=o),c=yield zY(a,CM.token));const d={sid:s,appId:e,cname:t,token:n||e,uid:a.stringUid||i,intUid:a.uid||c.gatewayInfo.uid,stringUid:a.stringUid,ts:Date.now(),sua:l,ap:c};yield(u=C(function*(h){let p;try{h.uid&&tX({appId:h.appId,cname:h.cname,token:h.token,uid:h.uid,stringUid:h.stringUid});const m=oX(h),f=yield(E=C(function*(b,T){try{const I=yield window.crypto.subtle.importKey("raw",o7(T),"AES-GCM",!1,["encrypt"]),D=yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},I,Sd(window.btoa(JSON.stringify(b))));return cl(new Uint8Array(D))}catch{return}}),function(b,T){return E.apply(this,arguments)})(h,h.token||h.appId);if(!f)return;p=rX(Op);const g=p?JSON.parse(p):[];g.push({[m]:f}),g.length>R("AP_CACHE_NUM")&&g.shift(),lC(Op,JSON.stringify(g))}catch(m){_.warn("Error caching server parameters:",m.message),lC(Op,"")}var E}),function(h){return u.apply(this,arguments)})(d),yM++}catch(s){throw SM++,function(a){bM||(bM=window.setTimeout(()=>{let l="";cC.forEach((d,u)=>{l+="".concat(u,": ").concat(d," ;")}),ne.reportApiInvoke(null,{name:Cn.PRELOAD,options:{success:yM,failed:SM,err:l}}).onError(a),yM=0,SM=0,cC.clear(),bM=null},vLe));const c=cC.get(a.code)||0;cC.set(a.code,c+1)}(s),s}var u}),TM.apply(this,arguments)}function eX(e){return wM.apply(this,arguments)}function wM(){return wM=C(function*(e){try{if(R("AP_REQUEST_DETAIL"))return;const t=tX(e);if(!t||"disabled"!==e.cloudProxyServer)return;const n=yield(i=C(function*(r,o){try{const s=yield window.crypto.subtle.importKey("raw",o7(o),"AES-GCM",!1,["decrypt"]),a=yield window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,Sd(r));return JSON.parse(window.atob(cl(new Uint8Array(a))))}catch{return}}),function(r,o){return i.apply(this,arguments)})(t,e.token||e.appId);if(!n||!function(i,r){return i.cname===r.cname&&i.appId===r.appId&&i.token===r.token&&(r.stringUid?i.stringUid===r.stringUid:"number"==typeof r.uid?i.uid===r.uid:i.uid==r.uid)}(n,e))return;if(n&&Date.now()-n.ts<R("AP_CACHE_LIFETIME"))return n}catch(t){_.warn("Error get preloadInfo",t.message)}var i}),wM.apply(this,arguments)}function tX(e){let t;try{if(t=rX(Op),!t)return;const n=JSON.parse(t),i=oX(e),r=function(s,a){for(let c=s.length-1;c>=0;c--)if(a(s[c]))return c;return-1}(n,s=>i in s);if(-1===r)return;const o=n.splice(r,1)[0];return lC(Op,JSON.stringify(n)),o[i]}catch(n){_.warn("Error delete preload info: ".concat(t),n.message),lC(Op,"")}}function IM(e){if(e){let t=Vd.get(e);t&&(window.clearTimeout(t),t=null,Vd.delete(e)),Y(Bd).call(Bd,e)||"disabled"!==e.cloudProxyServer||Bd.push(e)}if(Vd.size<R("AP_CACHE_NUM")&&Bd.length>0){const t=Bd.shift();Vd.set(t,window.setTimeout(C(function*(){const{appId:n,cname:i,token:r,stringUid:o,uid:s,proxyServer:a}=t;try{yield ELe(n,i,r,s,a,o),Vd.has(t)&&IM(t)}catch(c){_.warn("update preload failed",c.message),nX(t)}}),R("AP_UPDATE_INTERVAL")))}}function nX(e){const t=Bd.indexOf(e);-1!==t&&Bd.splice(t,1);let n=Vd.get(e);n&&(window.clearTimeout(n),n=null,Vd.delete(e),IM())}function iX(e,t){const n=e.sua,i=e.ap;t&&n&&ne.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),ne.reportResourceTiming(e.ap.url,e.sid),ne.joinWebProxyAP(e.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(r=>r.ip).join(","),eventType:"disabled",unilbsServerIds:[un.CHOOSE_SERVER,un.CLOUD_PROXY_FALLBACK].toString()}),ne.joinChooseServer(e.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(r=>r.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[un.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function rX(e){return window.atob(window.localStorage.getItem(e)||"")}function lC(e,t){window.localStorage.setItem(e,window.btoa(t))}function oX(e){let t="".concat(e.appId,"_").concat(e.cname);return"string"==typeof e.uid&&(t+="_s_".concat(e.uid)),"number"==typeof e.uid&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),h7(t)}function SLe(e,t){switch(t){case 0:for(;128&ds(e););break;case 2:RM(e,r_(e));break;case 5:RM(e,4);break;case 1:RM(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Np(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let CLe=[];function RM(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function TLe(e){return e.offset>=e.limit}function dC(e,t){let n=e.bytes,i=e.offset,r=e.limit,o=i+t;if(o>n.length){let s=new Uint8Array(2*o);s.set(n),e.bytes=s}return e.offset=o,o>r&&(e.limit=o),i}function sX(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function aX(e,t){let n=dC(e,t.length);e.bytes.set(t,n)}function cX(e,t){let n=sX(e,t),i=String.fromCharCode,r=e.bytes,o="\ufffd",s="";for(let a=0;a<t;a++){let c,l,d,u,h=r[a+n];128&h?192==(224&h)?a+1>=t?s+=o:(c=r[a+n+1],128!=(192&c)?s+=o:(u=(31&h)<<6|63&c,u<128?s+=o:(s+=i(u),a++))):224==(240&h)?a+2>=t?s+=o:(c=r[a+n+1],l=r[a+n+2],32896!=(49344&(c|l<<8))?s+=o:(u=(15&h)<<12|(63&c)<<6|63&l,u<2048||u>=55296&&u<=57343?s+=o:(s+=i(u),a+=2))):240==(248&h)?a+3>=t?s+=o:(c=r[a+n+1],l=r[a+n+2],d=r[a+n+3],8421504!=(12632256&(c|l<<8|d<<16))?s+=o:(u=(7&h)<<18|(63&c)<<12|(63&l)<<6|63&d,u<65536||u>1114111?s+=o:(u-=65536,s+=i(55296+(u>>10),56320+(1023&u)),a+=3))):s+=o:s+=i(h)}return s}function bl(e,t){let n=t.length,i=0;for(let s=0;s<n;s++){let a=t.charCodeAt(s);a>=55296&&a<=56319&&s+1<n&&(a=(a<<10)+t.charCodeAt(++s)-56613888),i+=a<128?1:a<2048?2:a<65536?3:4}hn(e,i);let r=dC(e,i),o=e.bytes;for(let s=0;s<n;s++){let a=t.charCodeAt(s);a>=55296&&a<=56319&&s+1<n&&(a=(a<<10)+t.charCodeAt(++s)-56613888),a<128?o[r++]=a:(a<2048?o[r++]=a>>6&31|192:(a<65536?o[r++]=a>>12&15|224:(o[r++]=a>>18&7|240,o[r++]=a>>12&63|128),o[r++]=a>>6&63|128),o[r++]=63&a|128)}}function ds(e){return e.bytes[sX(e,1)]}function lX(e,t){let n=dC(e,1);e.bytes[n]=t}function r_(e){let t,n=0,i=0;do{t=ds(e),n<32&&(i|=(127&t)<<n),n+=7}while(128&t);return i}function hn(e,t){for(t>>>=0;t>=128;)lX(e,127&t|128),t>>>=7;lX(e,t)}function wLe(e,t){let n,i=0,r=0,o=0;return n=ds(e),i=127&n,128&n&&(n=ds(e),i|=(127&n)<<7,128&n&&(n=ds(e),i|=(127&n)<<14,128&n&&(n=ds(e),i|=(127&n)<<21,128&n&&(n=ds(e),r=127&n,128&n&&(n=ds(e),r|=(127&n)<<7,128&n&&(n=ds(e),r|=(127&n)<<14,128&n&&(n=ds(e),r|=(127&n)<<21,128&n&&(n=ds(e),o=127&n,128&n&&(n=ds(e),o|=(127&n)<<7))))))))),{low:i|r<<28,high:r>>>4|o<<24,unsigned:t}}function yl(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,r=t.high>>>24,o=0===r?0===i?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,s=dC(e,o),a=e.bytes;switch(o){case 10:a[s+9]=r>>>7&1;case 9:a[s+8]=9!==o?128|r:127&r;case 8:a[s+7]=8!==o?i>>>21|128:i>>>21&127;case 7:a[s+6]=7!==o?i>>>14|128:i>>>14&127;case 6:a[s+5]=6!==o?i>>>7|128:i>>>7&127;case 5:a[s+4]=5!==o?128|i:127&i;case 4:a[s+3]=4!==o?n>>>21|128:n>>>21&127;case 3:a[s+2]=3!==o?n>>>14|128:n>>>14&127;case 2:a[s+1]=2!==o?n>>>7|128:n>>>7&127;case 1:a[s]=1!==o?128|n:127&n}}const dX={},uX={},uC=4294967296,hX=uC*uC,pX=hX/2,AM=mX(0,!0),fX=mX(0),ILe=Pp(0,-2147483648,!1),RLe=Pp(-1,2147483647,!1),ALe=Pp(-1,-1,!0);function mX(e,t){let n,i,r;return t?(r=0<=(e>>>=0)&&e<256)&&(i=uX[e],i)?i:(n=Pp(e,0,!0),r&&(uX[e]=n),n):(r=-128<=(e|=0)&&e<128)&&(i=dX[e],i)?i:(n=Pp(e,e<0?-1:0,!1),r&&(dX[e]=n),n)}function Pp(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function DLe(e,t){if(isNaN(e))return t?AM:fX;if(t){if(e<0)return AM;if(e>=hX)return ALe}else{if(e<=-pX)return ILe;if(e+1>=pX)return RLe}return e<0?t?AM:fX:Pp(e%uC|0,e/uC|0,t)}function gX(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}class DM extends kt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Fs.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),y(this,"name","AgoraRTCImageModeration"),y(this,"_connectionState",Po.CONNECTING),y(this,"_sequence",0),y(this,"_moderationStartTime",void 0),y(this,"_workerConnection",void 0),y(this,"_workerMessageLengthLimit",void 0),y(this,"_qualityRatio",void 0),y(this,"_connectInfo",void 0),y(this,"_cancelTokenSource",nr.CancelToken.source()),y(this,"_retryConfig",void 0),y(this,"_moderationInterval",void 0),y(this,"_moderationTimer",null),y(this,"_moderationMode",1),y(this,"_quality",1),y(this,"_qualityTimer",null),y(this,"_ticket",void 0),y(this,"_moderationIntervalMinimum",void 0),y(this,"_uploadFailedNum",0),y(this,"_uploadNum",0),y(this,"_uploadTimer",null),y(this,"_extraInfo",void 0),y(this,"_vendor",""),y(this,"_encoder",new TextEncoder),y(this,"_moderationId",void 0),y(this,"inspectImage",()=>{if(this.connectionState!==Po.CONNECTED)throw new N(S.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Po.CONNECTED?this.requestToInspectImage():_.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=gt(5,"image-moderation-"),this._workerMessageLengthLimit=R("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=R("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(n=t.interval)&&void 0!==n?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=R("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Ug("worker-"+this._moderationId,vn),this.on(Fs.STATE_CHANGE,(i,r)=>{_.debug("[".concat(this._moderationId,"] Moderation operation :").concat(rp[i]," ").concat(r||""))}),this.handleWorkerEvents()}init(t,n){var i=this;return C(function*(){i.emit(Fs.STATE_CHANGE,rp.CONNECT_AP),i._connectInfo=t;const r=i._cancelTokenSource.token;return i._retryConfig=n,new q((o,s)=>{i.on(Fs.CONNECTION_STATE_CHANGE,(a,c)=>{a===Po.CONNECTED&&o()}),i.requestAP(t,r,n).then(a=>{i.connectWorker(a)}).catch(a=>{s(a)})})})()}updateConfig(t){var n;this._moderationInterval=null!==(n=t.interval)&&void 0!==n?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),_.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===Po.CONNECTED&&this.inspectImage()}requestAP(t,n,i){var r=this;return C(function*(){const o=R("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),s=yield function(l,d,u,h){let{appId:p,areaCode:m,cname:f,sid:g,token:E,uid:b}=d;Rp++;const T="moderation_plugin",I={service_name:T,json_body:JSON.stringify({appId:p,areaCode:m,cname:f,command:"allocateEdge",requestId:Rp,seq:Rp,sid:g,appToken:E,ts:Date.now(),uid:b+""})};let D,O,k=l[0];return Ls(C(function*(){D=Date.now();const L=yield Bs(k,{data:I,cancelToken:u,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(O=Date.now()-D,0!==L.code){const oe=new N(S.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+L.code,{retry:!0,responseTime:O});throw _.error(oe.toString()),oe}const V=JSON.parse(L.json_body);if(200!==V.code){const oe=new N(S.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(V.code,", reason: ").concat(V.reason),{code:V.code,responseTime:O});throw _.error(oe.toString()),oe}if(!V.servers||!Array.isArray(V.servers)||0===V.servers.length){const oe=new N(S.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:V.code,responseTime:O});throw _.error(oe.toString()),oe}if(!V.servers.some(oe=>!!oe.wss)){const oe=new N(S.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:V.code,responseTime:O});throw _.error(oe.toString()),oe}const ee=R("IMAGE_MODERATION_WORKER_HOST");return{addressList:V.servers.map(oe=>{let{address:Ie,wss:Ue}=oe;if(Ie&&Ue)return"wss://".concat(Ie.replace(/\./g,"-"),".").concat(ee,":").concat(Ue,"/moderation")}).filter(oe=>!!oe),workerToken:V.workerToken,vid:V.vid,ticket:V.appTicket,responseTime:O}}),(L,V)=>(ne.apworkerEvent(g,{success:!0,sc:200,serviceName:T,responseDetail:JSON.stringify(L.addressList),firstSuccess:0===V,responseTime:O,serverIp:l[V%l.length]}),!1),(L,V)=>(ne.apworkerEvent(g,{success:!1,sc:L.data&&L.data.code||200,serviceName:T,responseTime:O,serverIp:l[V%l.length]}),!!(L.code!==S.OPERATION_ABORTED&&L.code!==S.UNEXPECTED_RESPONSE||L.data&&L.data.retry)&&(k=l[(V+1)%l.length],!0)),h)}(o,t,n,i);r.emit(Fs.STATE_CHANGE,rp.AP_CONNECTED);const{addressList:a,ticket:c}=s;return r._ticket=c,a})()}connectWorker(t){var n=this;return C(function*(){n.emit(Fs.STATE_CHANGE,rp.CONNECT_WORKER),yield n._workerConnection.init(t,1e4)})()}handleWorkerEvents(){var t=this;this._workerConnection.on(fe.CONNECTED,C(function*(){t.emit(Fs.STATE_CHANGE,rp.WORKER_CONNECTED,t._workerConnection.url),t.connectionState=Po.CONNECTED})),this._workerConnection.on(fe.CLOSED,()=>{this.connectionState=Po.CLOSED}),this._workerConnection.on(fe.FAILED,()=>{this.connectionState=Po.CLOSED}),this._workerConnection.on(fe.RECONNECTING,()=>{this.connectionState=this.connectionState===Po.CONNECTED?Po.RECONNECTING:Po.CONNECTING}),this._workerConnection.on(fe.ON_MESSAGE,function(){var n=C(function*(i){if(i.data instanceof ArrayBuffer){const r=function yLe(e){return function(n){let i={};e:for(;!TLe(n);){let r=r_(n);switch(r>>>3){case 0:break e;case 1:i.code=r_(n);break;case 2:i.msg=cX(n,r_(n));break;case 3:i.requestId=cX(n,r_(n));break;case 4:i.timestamp=wLe(n,!1);break;default:SLe(n,7&r)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}(new Uint8Array(i.data));R("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_.debug("[".concat(t._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r)),t._uploadNum++,void 0===r.code||0===r.code||(t._uploadFailedNum++,_.error("[".concat(t._moderationId,"] Error response from worke, code is ").concat(r.code,", msg is ").concat(r.msg)),t._uploadTimer||(t._uploadTimer=window.setTimeout(()=>{ne.reportApiInvoke(t._connectInfo.sid||null,{name:Cn.IMAGE_MODERATION_UPLOAD,options:[t._uploadFailedNum,t._uploadNum,r.code],tag:jt.TRACER}).onError(new N(S.IMAGE_MODERATION_UPLOAD_FAILED,r.msg)),t._uploadTimer=null},R("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else _.error("[".concat(t._moderationId,"] Unexpected message type from worker"))});return function(i){return n.apply(this,arguments)}}()),this._workerConnection.on(fe.WILL_RECONNECT,(n,i,r)=>{"recover"===n&&r(n),r("tryNext")}),this._workerConnection.on(fe.REQUEST_NEW_URLS,(n,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n).catch(i)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}requestToInspectImage(){var t=this;return C(function*(){const n=Do(t,Fs.CLIENT_LOCAL_VIDEO_TRACK),i={appId:t._connectInfo.appId,cname:t._connectInfo.cname,cid:t._connectInfo.cid,sid:t._connectInfo.sid,uid:t._connectInfo.uid,vid:t._connectInfo.vid};if(n){if(!n.isPlaying)return void(R("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_.debug("Only the track being played can be inspected"));t._sequence++;const r=yield t.generateRequestData(n,i);t._workerConnection.sendMessage(r,!0,!0)}else R("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_.debug("Only the track being published can be inspected")})()}generateRequestData(t,n){var i=this;return C(function*(){let{appId:r,cname:o,cid:s,vid:a,sid:c,uid:l}=n;const d=Date.now(),u=yield t.getCurrentFrameImage("image/jpeg",i.quality),h=yield WK(u,r,o),p=i._sequence+"-"+s+"-"+l+"-"+d+"-"+gt(12,""),m={appId:r,cid:s,cname:o,deviceId:"",elapse:DM.intToLong(Number(d-i._moderationStartTime)),fileSize:u.buffer.byteLength,height:u.height,width:u.width,jpg:h,networkType:6,osType:7,requestId:p,sdkVersion:"4.22.1",sequence:i._sequence,sid:c,timestamp:DLe(d),uid:l,vid:a,service:i._moderationMode,ticket:i._ticket,callbackData:i._extraInfo,vendorConfigs:i._vendor};void 0===i._extraInfo&&delete m.callbackData;const f=function bLe(e){let t=function(){const n=CLe.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let r=n.appId;void 0!==r&&(hn(i,10),bl(i,r));let o=n.cid;void 0!==o&&(hn(i,16),hn(i,o));let s=n.cname;void 0!==s&&(hn(i,26),bl(i,s));let a=n.deviceId;void 0!==a&&(hn(i,34),bl(i,a));let c=n.elapse;void 0!==c&&(hn(i,40),yl(i,c));let l=n.fileSize;void 0!==l&&(hn(i,48),yl(i,Np(l)));let d=n.height;void 0!==d&&(hn(i,56),yl(i,Np(d)));let u=n.jpg;void 0!==u&&(hn(i,66),hn(i,u.length),aX(i,u));let h=n.networkType;void 0!==h&&(hn(i,72),yl(i,Np(h)));let p=n.osType;void 0!==p&&(hn(i,80),yl(i,Np(p)));let m=n.requestId;void 0!==m&&(hn(i,90),bl(i,m));let f=n.sdkVersion;void 0!==f&&(hn(i,98),bl(i,f));let g=n.sequence;void 0!==g&&(hn(i,104),yl(i,Np(g)));let E=n.sid;void 0!==E&&(hn(i,114),bl(i,E));let b=n.timestamp;void 0!==b&&(hn(i,120),yl(i,b));let T=n.uid;void 0!==T&&(hn(i,128),hn(i,T));let I=n.vid;void 0!==I&&(hn(i,136),hn(i,I));let D=n.width;void 0!==D&&(hn(i,144),yl(i,Np(D)));let O=n.service;void 0!==O&&(hn(i,152),hn(i,O));let k=n.callbackData;void 0!==k&&(hn(i,162),hn(i,k.length),aX(i,k));let L=n.ticket;void 0!==L&&(hn(i,170),bl(i,L));let V=n.vendorConfigs;void 0!==V&&(hn(i,178),bl(i,V))}(e,t),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(t)}(m);if(f.byteLength<i._workerMessageLengthLimit){if(R("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const g=function(E){for(var b=1;b<arguments.length;b++){var T=null!=arguments[b]?arguments[b]:{};b%2?gX(Object(T),!0).forEach(function(I){y(E,I,T[I])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(T)):gX(Object(T)).forEach(function(I){Object.defineProperty(E,I,Object.getOwnPropertyDescriptor(T,I))})}return E}({},m);delete g.jpg,_.debug("[".concat(i._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(g))}return f}return i.quality=i.quality*i._qualityRatio,yield i.generateRequestData(t,{appId:r,cname:o,cid:s,vid:a,sid:c,uid:l})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=nr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Po.CLOSED,this.emit(Fs.STATE_CHANGE,rp.CLOSED)}}function _X(e){if(ot(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new N(S.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new N(S.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const OLe={name:"ImageModeration",create:function(e){let{config:t}=e;return _X(t),new DM(t)}};var vX,EX,bX,yX,SX,CX,TX,wX,IX,RX,AX,DX,OX,NX,PX,MX,xX,kX,LX,FX,UX,VX,BX,jX,HX,GX,WX,zX,KX,qX,YX,$X,XX,ZX,JX,QX,eZ,tZ,nZ,iZ,$;function rZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function us(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rZ(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rZ(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}gi.setLogger(_);let NLe=(vX=le(),EX=le({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof bp))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),bX=le({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Ep.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),yX=le({argsMap:(e,t,n,i)=>["object"==typeof t?t.uid:t,n,i]}),SX=le({argsMap:(e,t,n)=>[t,n]}),CX=le({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:r}=n;return[i?.uid,r]})}),TX=le({argsMap:(e,t,n,i)=>["object"==typeof t?t.uid:t,n,i]}),wX=le({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:r}=n;return{uid:i?.uid,mediaType:r}})}),IX=le(),RX=le(),AX=le(),DX=le(),OX=le(),NX=le(),PX=le(),MX=le(),xX=le(),kX=le(),LX=le(),FX=le(),UX=le(),VX=le(),BX=le({argsMap:(e,t)=>[t]}),jX=le(),HX=le(),GX=le(),WX=le(),zX=le(),KX=le(),qX=le(),YX=le(),$X=le({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),XX=le(),ZX=le(),JX=le(),QX=le(),eZ=le(),tZ=le(),nZ=le({reportResult:!0}),iZ=le(),$=class extends kt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){var t;let n;if(super(),t=this,y(this,"store",void 0),y(this,"_uid",void 0),y(this,"_channelName",void 0),y(this,"_uintUid",void 0),y(this,"_users",[]),y(this,"_config",void 0),y(this,"_clientId",void 0),y(this,"_appId",void 0),y(this,"_sessionId",null),y(this,"_key",void 0),y(this,"_rtmConfig",{}),y(this,"_joinInfo",void 0),y(this,"_gateway",void 0),y(this,"_statsCollector",void 0),y(this,"_configDistribute",void 0),y(this,"_leaveMutex",new gi("client-leave")),y(this,"_publishMutex",new gi("client-publish")),y(this,"_renewTokenMutex",new gi("client-renewtoken")),y(this,"_subscribeMutex",new gi("client-subscribe")),y(this,"_encryptionMode","none"),y(this,"_encryptionSecret",null),y(this,"_encryptionSalt",null),y(this,"_encryptDataStream",!1),y(this,"_encryptDataStreamKey",null),y(this,"_encryptDataStreamIv",null),y(this,"_proxyServer",void 0),y(this,"_turnServer",{servers:[],mode:"auto"}),y(this,"_cloudProxyServerMode","disabled"),y(this,"_isDualStreamEnabled",!1),y(this,"_defaultStreamFallbackType",void 0),y(this,"_lowStreamParameter",void 0),y(this,"_streamFallbackTypeCacheMap",new Map),y(this,"_remoteStreamTypeCacheMap",new Map),y(this,"_axiosCancelSource",nr.CancelToken.source()),y(this,"_audioVolumeIndicationInterval",void 0),y(this,"_networkQualityInterval",void 0),y(this,"_userOfflineTimeout",void 0),y(this,"_streamRemovedTimeout",void 0),y(this,"_liveTranscodeStreamingClient",void 0),y(this,"_liveRawStreamingClient",void 0),y(this,"_channelMediaRelayClient",void 0),y(this,"_networkQualitySensitivity","normal"),y(this,"_p2pChannel",void 0),y(this,"_useLocalAccessPoint",!1),y(this,"_setLocalAPVersion",void 0),y(this,"_joinAndNotLeaveYet",!1),y(this,"_numberOfJoinCount",0),y(this,"_remoteDefaultVideoStreamType",void 0),y(this,"_inspect",void 0),y(this,"_moderation",void 0),y(this,"_license",void 0),y(this,"_pendingPublishedUsers",[]),y(this,"ntpAlignErrorCount",0),y(this,"remoteInboundOffset",0),y(this,"_handleLocalTrackEnable",(i,r,o)=>{this.publish(i,!1).then(r).catch(o)}),y(this,"_handleLocalTrackDisable",(i,r,o)=>{this.unpublish(i).then(r).catch(o)}),y(this,"_handleUserOnline",i=>{if(R("BLOCK_LOCAL_CLIENT")&&wd(i.uid,this.channelName))return void _.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof i.uid&&_.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const r=this._users.find(o=>o.uid===i.uid);if(r)r._trust_in_room_=!0,r._is_pre_created&&(r._is_pre_created=!1,this.safeEmit(Ae.USER_JOINED,r));else{const o=new vl(i.uid,i.uint_id||i.uid);this._users.push(o),_.debug("[".concat(this._clientId,"] user online"),i.uid),this.safeEmit(Ae.USER_JOINED,o)}}),y(this,"_handleUserOffline",i=>{if(R("BLOCK_LOCAL_CLIENT")&&wd(i.uid,this.channelName))return;const r=this._users.find(o=>o.uid===i.uid);r&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),r._audio_pre_subscribed||r._video_pre_subscribed?r._is_pre_created=!0:fS(this._users,r),this._remoteStreamTypeCacheMap.delete(r.uid),this._streamFallbackTypeCacheMap.delete(r.uid),_.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(Ae.USER_LEAVED,r,i.reason))}),y(this,"_handleAddAudioOrVideoStream",(i,r,o,s,a,c,l)=>{if(R("BLOCK_LOCAL_CLIENT")&&wd(r,this.channelName))return;const d=this._users.find(h=>h.uid===r);if(!d)return void _.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));_.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(i)),this.store.subscribe(d.uid,i,void 0,void 0,void 0,Date.now());const u="audio"===i?d.hasAudio:d.hasVideo;d._uintid||(d._uintid=a||r),"audio"===i?d._trust_audio_stream_added_state_=!0:d._trust_video_stream_added_state_=!0,"audio"===i?(d._audio_added_=!0,void 0!==o&&(d._audioSSRC=o),void 0!==s&&(d._cname=s),c&&(d._audioOrtc=c)):(d._video_added_=!0,void 0!==o&&(d._videoSSRC=o),void 0!==s&&(d._cname=s),void 0!==l&&(d._rtxSsrcId=l),c&&(d._videoOrtc=c)),("audio"===i?d.hasAudio:d.hasVideo)&&!u&&(_.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published ").concat(i)),this.safeEmit(Ae.USER_PUBLISHED,d,i)),"video"===i?ne.onGatewayStream(this._sessionId,Yn.ON_ADD_VIDEO_STREAM,Lt.ON_ADD_VIDEO_STREAM,{peer:a||r,ssrc:d._videoSSRC}):ne.onGatewayStream(this._sessionId,Yn.ON_ADD_AUDIO_STREAM,Lt.ON_ADD_AUDIO_STREAM,{peer:a||r,ssrc:d._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(d,i,o).then(h=>{if(h&&(_.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(d.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof sC))return this._p2pChannel.unsubscribe(d,i,!0).then(()=>this._subscribe(d,i,!0).catch(p=>{_.error("[".concat(this._clientId,"] resubscribe error"),p.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(d,i)&&(_.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(d.uid," after reconnect.")),this._subscribe(d,i,!0).catch(h=>{_.error("[".concat(this._clientId,"] resubscribe error"),h.toString())}))}),y(this,"_handleRemoveStream",i=>{if(R("BLOCK_LOCAL_CLIENT")&&wd(i.uid,this.channelName))return;const r=this._users.find(s=>s.uid===i.uid);if(!r)return void _.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));_.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let o=()=>{};r.hasAudio&&r.hasVideo?o=()=>{_.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(Ae.USER_UNPUBLISHED,r,"audio"),_.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(Ae.USER_UNPUBLISHED,r,"video")}:r.hasVideo?o=()=>{_.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(Ae.USER_UNPUBLISHED,r,"video")}:r.hasAudio&&(o=()=>{_.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(Ae.USER_UNPUBLISHED,r,"audio")}),r._video_pre_subscribed||r._audio_pre_subscribed||(r._trust_audio_stream_added_state_=!0,r._trust_video_stream_added_state_=!0,r._audio_added_=!1,r._video_added_=!1,this._p2pChannel instanceof sC&&this._p2pChannel.unsubscribe(r).then(s=>{if(s)return this._gateway.unsubscribe(s,r.uid)}),r._audioSSRC=void 0,r._videoSSRC=void 0,r._audioOrtc=void 0,r._videoOrtc=void 0,r._rtxSsrcId=void 0),ne.onGatewayStream(this._sessionId,Yn.ON_REMOVE_STREAM,Lt.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),o()}),y(this,"_handleSetStreamLocalEnable",(i,r,o)=>{if(R("BLOCK_LOCAL_CLIENT")&&wd(r,this.channelName))return;const s=this._users.find(l=>l.uid===r);if(!s)return void _.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));_.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(o?"enabled":"disabled"," with uid ").concat(r));const a="audio"===i?s.hasAudio:s.hasVideo;if("audio"===i){s._trust_audio_enabled_state_=!0;const l=s._audio_enabled_;if(s._audio_enabled_=o,s._audio_enabled_===l)return;{const d=s._audio_enabled_?"enable-local-audio":"disable-local-audio";_.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(r,", msg: ").concat(d)),this.safeEmit(Ae.USER_INFO_UPDATED,r,d)}}else{s._trust_video_enabled_state_=!0;const l=s._video_enabled_;if(s._video_enabled_=o,s._video_enabled_===l)return;{const d=s._video_enabled_?"enable-local-video":"disable-local-video";_.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(d)),this.safeEmit(Ae.USER_INFO_UPDATED,r,d)}}const c="audio"===i?s.hasAudio:s.hasVideo;return a!==c?!a&&c?(_.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(i)),void this.safeEmit(Ae.USER_PUBLISHED,s,i)):("video"===i&&s._videoTrack&&s._videoTrack._destroy(),this._p2pChannel.muteRemote(s,i),_.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(i)),void this.safeEmit(Ae.USER_UNPUBLISHED,s,i)):void 0}),y(this,"_handleMuteStream",(i,r,o)=>{if(R("BLOCK_LOCAL_CLIENT")&&wd(i,this.channelName))return;_.debug("[".concat(this._clientId,"] receive mute message"),i,r,o);const s=this._users.find(l=>l.uid===i);if(!s)return void _.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));const a="audio"===r?s.hasAudio:s.hasVideo;if("audio"===r){s._trust_audio_mute_state_=!0;const l=s._audio_muted_;if(s._audio_muted_=o,s._audio_muted_===l)return;{const d=s._audio_muted_?"mute-audio":"unmute-audio";_.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(d)),this.safeEmit(Ae.USER_INFO_UPDATED,i,d)}}else{s._trust_video_mute_state_=!0;const l=s._video_muted_;if(s._video_muted_=o,s._video_muted_===l)return;{const d=s._video_muted_?"mute-video":"unmute-video";_.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(d)),this.safeEmit(Ae.USER_INFO_UPDATED,i,d)}}const c="audio"===r?s.hasAudio:s.hasVideo;if(a!==c){if(!a&&c)return("audio"===r?s._audioSSRC:s._videoSSRC)?(_.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(r)),void this.safeEmit(Ae.USER_PUBLISHED,s,r)):void _.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(r," unmute message  before add stream message, ").concat(r," SSRC doesn't exist yet."));"video"===r&&s._videoTrack&&!s._video_pre_subscribed&&s._videoTrack._destroy(),this._p2pChannel.muteRemote(s,r),_.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(r)),this.safeEmit(Ae.USER_UNPUBLISHED,s,r)}}),y(this,"_handleP2PLost",function(){var i=C(function*(r){_.debug("[".concat(t._clientId,"] receive p2p lost"),r),parseInt(r.p2pid,10)===t.store.p2pId?yield t._p2pChannel.requestReconnect():_.warning("[".concat(t._clientId,"] P2PLost stream not found"),r)});return function(r){return i.apply(this,arguments)}}()),y(this,"_handleTokenWillExpire",()=>{_.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Ae.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),y(this,"_handleBeforeUnload",i=>{"beforeunload"===i.type&&void 0!==i.returnValue&&""!==i.returnValue||(this.leave(),_.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),y(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(Ae.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Ae.NETWORK_QUALITY,i)}),y(this,"_handleP2PAddAudioOrVideoStream",(i,r,o,s)=>{const a=this._users.find(l=>l.uid===r);if(!a)return void _.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));_.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(i)),this.store.subscribe(a.uid,i,void 0,void 0,void 0,Date.now());const c="audio"===i?a.hasAudio:a.hasVideo;"audio"===i?a._trust_audio_stream_added_state_=!0:a._trust_video_stream_added_state_=!0,"audio"===i?(a._audio_added_=!0,void 0!==o&&(a._audioSSRC=o),void 0!==s&&(a._audioMid=s)):(a._video_added_=!0,void 0!==o&&(a._videoSSRC=o),void 0!==s&&(a._videoMid=s)),("audio"===i?a.hasAudio:a.hasVideo)&&!c&&(_.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published ").concat(i)),this.safeEmit(Ae.USER_PUBLISHED,a,i)),this._p2pChannel.hasPendingRemoteMedia(a,i)&&(_.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(a.uid," after reconnect.")),this._subscribe(a,i,!0).catch(l=>{_.error("[".concat(this._clientId,"] resubscribe error"),l.toString())}))}),this._config=e,this._clientId=gt(5,"client-"),this.store=new l1e(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),_.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Oo," build: ").concat(xN,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{i7(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(i){_.warning("[".concat(this._clientId,"] ").concat(i.toString()))}this._statsCollector=new Jg(this.store),this._statsCollector.onStatsException=(i,r,o)=>{_.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(r,", uid: ").concat(o)),this.safeEmit(Ae.EXCEPTION,{code:i,msg:r,uid:o})},this._statsCollector.onUploadPublishDuration=(i,r,o,s)=>{const a=this._users.find(c=>c.uid===i);a&&ne.peerPublishStatus(this._sessionId,{subscribeElapse:s,audioPublishDuration:r,videoPublishDuration:o,peer:a._uintid})},this.store.useP2P="p2p"===e.mode,this._gateway=new Vke(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||vn,httpRetryConfig:e.httpRetryConfig||vn,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new $ke,this.store.useP2P?(this._p2pChannel=new Fr(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new sC(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}joinMeta(e,t,n,i,r){var o=arguments,s=this;return C(function*(){let a=!(o.length>5&&void 0!==o[5])||o[5],c=o.length>6&&void 0!==o[6]&&o[6];st("JOIN_GATEWAY_USE_443PORT_ONLY",a),st("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);const l=s._gateway.signal.websocket;return l instanceof qN&&(l.use443PortOnly=a,l.tryDoubleDomain=c),(d=C(function*(u,h,p){cS.get(u)||cS.set(u,[]),lS.get(u)||lS.set(u,h),ba.get(u)||ba.set(u,0);const m=cS.get(u),f=lS.get(u);if(!m||!f)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(ba.get(u)===f){const I=Og();m.push(I),yield I.promise}ba.set(u,ba.get(u)+1);for(var g=arguments.length,E=new Array(g>3?g-3:0),b=3;b<g;b++)E[b-3]=arguments[b];const T=yield p(...E);return ba.set(u,ba.get(u)-1),ba.get(u)===f-1&&m.length>0&&(m[0].resolve(),m.shift()),0===ba.get(u)&&(cS.set(u,[]),lS.set(u,0),ba.set(u,0)),T}),function(u,h,p){return d.apply(this,arguments)})("client.join",R("JOIN_MAX_CONCURRENCY"),s.join.bind(s),e,t,n,i,r);var d})()}join(e,t,n,i,r){var o=this;return C(function*(){const s=++o._numberOfJoinCount;o.store.joinStart(),i&&(o.store.uid=i);const a="HTTPS"===(vS||vS||(vS=(window.location.protocol.split(":")[0]||"").toUpperCase(),vS)),c=f7()?window.isSecureContext:"Browser Not Support";(!f7()&&!a||!window.isSecureContext)&&_.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),"DISCONNECTED"===o.connectionState&&(o.store.avoidJoinStart=Math.round(Date.now()),_.debug("[".concat(o._clientId,"] set avoidJoinStart to ").concat(o.store.avoidJoinStart))),ne.setAppId(e);try{if(!n&&null!==n)throw new N(S.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Kn(n,"token",1,2047),Kn(e,"appid",1,2047),CS(t),i&&TS(i),r&&Kn(r,"optionalInfo",1,2047)}catch(g){throw ne.reportApiInvoke(ep(),{name:Cn.JOIN,options:[e,t,n,i],states:{isHttps:a,isSecureContext:c},tag:jt.TRACER}).onError(g),g}if(o._leaveMutex.isLocked&&(_.debug("[".concat(o._clientId,"] join: waiting leave operation")),(yield o._leaveMutex.lock())(),_.debug("[".concat(o._clientId,"] join: continue"))),o._joinAndNotLeaveYet=!0,"DISCONNECTED"!==o.connectionState){const g=new N(S.INVALID_OPERATION,"[".concat(o._clientId,"] Client already in connecting/connected state"));throw ne.reportApiInvoke(ep(),{name:Cn.JOIN,options:[e,t,n,i],states:{isHttps:a,isSecureContext:c},tag:jt.TRACER}).onError(g),g}o._gateway.state="CONNECTING";const l=yield eX({appId:e,cname:t,uid:i,stringUid:"string"==typeof i?i:void 0,token:n||e,cloudProxyServer:o._cloudProxyServerMode});if(!o._joinAndNotLeaveYet)throw new N(S.INVALID_OPERATION,"[".concat(o._clientId,"] Client already left"));const d=l?.sid||ep();_.info("[".concat(o._clientId,"] start join channel ").concat(t,", join number: ").concat(s)),o._sessionId||(o._sessionId=d,o.store.sessionId=o._sessionId);const u=ne.reportApiInvoke(d,{name:Cn.JOIN,options:[e,t,n,i],states:{isHttps:a,isSecureContext:c},tag:jt.TRACER}),h=us(us(us({},o._rtmConfig),{},{clientId:o._clientId,appId:e,sid:o._sessionId,cname:t,uid:"string"!=typeof i?i:null,turnServer:o._turnServer,proxyServer:o._proxyServer,token:n||e,cloudProxyServer:o._cloudProxyServerMode,optionalInfo:r,license:o._license,useLocalAccessPoint:o._useLocalAccessPoint,preload:!!l},void 0!==o._remoteDefaultVideoStreamType&&{defaultVideoStream:o._remoteDefaultVideoStreamType}),{},{apRequestDetail:R("AP_REQUEST_DETAIL")||void 0});if(o._useLocalAccessPoint&&(h.setLocalAPVersion=o._setLocalAPVersion),"string"==typeof i&&(h.stringUid=i,o._uintUid?(h.uid=o._uintUid,o._uintUid=void 0):h.uid=0),"none"!==o._encryptionMode&&o._encryptionSecret){if(h.aesmode=o._encryptionMode,h.aespassword=yield(g=C(function*(E){const b=function(O){const k=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),L=new Uint8Array(new ArrayBuffer(k.length));for(let V=0;V<k.length;V+=1)L[V]=k.charCodeAt(V);return L}(),T=yield window.crypto.subtle.importKey("spki",b,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),I=TN(E),D=yield window.crypto.subtle.encrypt({name:"RSA-OAEP"},T,I);return function(O){let k="";for(let L=0;L<O.length;L+=1)k+=String.fromCharCode(O[L]);return window.btoa(k)}(new Uint8Array(D))}),function(E){return g.apply(this,arguments)})(o._encryptionSecret),!o._joinAndNotLeaveYet)throw new N(S.INVALID_OPERATION,"[".concat(o._clientId,"] Client already left"));o._encryptionSalt&&(h.aessalt=o._encryptionSalt)}var g,b;if(o._encryptDataStream&&("aes-128-gcm2"===o._encryptionMode||"aes-256-gcm2"===o._encryptionMode))if(o._encryptionSalt&&o._encryptionSecret)if(window.crypto.subtle){const g=new TextEncoder,E=R("USE_PURE_ENCRYPTION_MASTER_KEY")?g.encode(h.appId+o._encryptionSecret+o._encryptionSecret):g.encode(h.appId+h.cname+o._encryptionSecret);o._encryptDataStreamIv=yield(b=C(function*(T,I,D){const O=yield window.crypto.subtle.importKey("raw",I,"PBKDF2",!1,["deriveBits","deriveKey"]),k="aes-128-gcm2"===T?128:256,L=yield window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:D},O,k+96);return new Uint8Array(L).subarray(k/8)}),function(T,I,D){return b.apply(this,arguments)})(o._encryptionMode,E,Sd(o._encryptionSalt)),o._encryptDataStreamKey=yield function(){var b=C(function*(T,I,D){const O=yield window.crypto.subtle.importKey("raw",I,"PBKDF2",!1,["deriveBits","deriveKey"]),k="aes-128-gcm2"===T?128:256;return yield window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:D},O,{name:"AES-GCM",length:k},!0,["encrypt","decrypt"])});return function(T,I,D){return b.apply(this,arguments)}}()(o._encryptionMode,E,Sd(o._encryptionSalt))}else _.warning("[".concat(o._clientId,c?"] encrypt datastream must be running in a secure context, fallback to plain data stream":"] current browser do not support WebCrypto ,fallback to plain data stream")),o._encryptDataStream=!1;else o._encryptDataStream=!1,_.debug("[".concat(o._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));o._startSession(o._sessionId,{channel:t,appId:e,stringUid:h.stringUid});const p=o._sessionId;setTimeout(()=>{"CONNECTING"===o.connectionState&&p===o._sessionId&&ne.joinChannelTimeout(o._sessionId,5)},5e3);try{var m;let g;const E=h.cloudProxyServer;if(Y(m=["proxy3","proxy4","proxy5"]).call(m,E)){const O=R("PROXY_SERVER_TYPE3");h.proxyServer=Array.isArray(O)?O[0]:O}if(ne.setProxyServer(h.proxyServer),_.setProxyServer(h.proxyServer),o.store.requestAPStart(),l){if(_.debug("[".concat(o._clientId,"] get serverInfo Success from Preload Cache ").concat(h.stringUid?", ".concat(h.stringUid," => ").concat(l.intUid):""," ")),h.stringUid&&!h.uid&&(h.uid=l.intUid),g={gatewayInfo:l.ap.gatewayInfo},R("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&"auto"===h.turnServer.mode)if(0===l.ap.proxyInfo.addresses.length)_.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const O=(yield H7(l.ap.proxyInfo,l.ap.gatewayInfo.uid)).map(k=>({turnServerURL:k.address,tcpport:k.tcpport||ri.tcpport,udpport:k.udpport||ri.udpport,username:k.username||ri.username,password:k.password||ri.password,forceturn:!1,security:!0}));h.turnServer={mode:"manual",servers:O}}iX(l,h.stringUid)}else{if(h.stringUid&&!h.uid){let O;[O,g]=yield q.all([WY(h.stringUid,h,o._axiosCancelSource.token,o._config.httpRetryConfig||vn,o.store),GY(h,o._axiosCancelSource.token,o._config.httpRetryConfig||vn,!0,o.store)]),_.debug("[".concat(o._clientId,"] getUserAccount Success ").concat(h.stringUid," => ").concat(O)),h.uid=O,g.gatewayInfo.uid=O,g.gatewayInfo.res.uid=O}else g=yield GY(h,o._axiosCancelSource.token,o._config.httpRetryConfig||vn,!0,o.store);if(!o._joinAndNotLeaveYet)throw new N(S.INVALID_OPERATION,"[".concat(o._clientId,"] Client already left"))}o.store.requestAPEnd(),setTimeout(()=>{o._configDistribute.startGetConfigDistribute(h,o._axiosCancelSource.token),o._configDistribute.on(zN.UPDATE_BITRATE_LIMIT,O=>{o._p2pChannel.updateBitrateLimit(O)})},0),o._key=n||e;const b=g.gatewayInfo,T=h.uid?h.uid:b.uid;o._joinInfo=us(us({},h),{},{cid:b.cid,uid:T,vid:b.vid,apResponse:b.res,apGatewayAddress:b.apGatewayAddress,uni_lbs_ip:b.uni_lbs_ip,gatewayAddrs:b.gatewayAddrs}),o.store.intUid=T;const I=yield o._joinGateway();if(!o._joinAndNotLeaveYet)throw new N(S.INVALID_OPERATION,"[".concat(o._clientId,"] Client already left"));u.onSuccess(I),o._appId=e,o._channelName=h.cname,o._uid=I,o.store.uid=I,setTimeout(()=>{o._networkQualityInterval&&window.clearInterval(o._networkQualityInterval),o._networkQualityInterval=window.setInterval(o._handleUpdateNetworkQuality,2e3),window.addEventListener(ti()?"beforeunload":"pagehide",o._handleBeforeUnload),o._statsCollector.startUpdateStats()},0);const D=h.stringUid?"string uid: ".concat(h.stringUid,",uid: ").concat(h.uid):"uid: ".concat(o._uid);return _.info("[".concat(o._clientId,"] Joining channel success: channel: ").concat(t,",").concat(D)),setTimeout(()=>{_.startUpload()},5e3),o.store.joinEnd(),f=o,Y(Td).call(Td,f)||Td.push(f),"disabled"===o._cloudProxyServerMode&&Fe().supportWebCrypto&&R("ENABLE_PRELOAD")&&IM(o._joinInfo),I}catch(g){const E=Array.isArray(g)?g[0]:g;throw E&&E.code===S.OPERATION_ABORTED?_.warning("[".concat(o._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),E):_.error("[".concat(o._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),E),E.code!==S.OPERATION_ABORTED&&o._numberOfJoinCount===s&&(o._gateway.state="DISCONNECTED",o._reset()),u.onError(E),E}var f})()}_joinGateway(){if(!this._joinInfo||!this._key)throw new N(S.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!R("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}leave(){var e=this;return C(function*(){_.info("[".concat(e._clientId,"] Leaving channel")),window.removeEventListener(ti()?"beforeunload":"pagehide",e._handleBeforeUnload),e._reset(),function(n){const i=Td.indexOf(n);-1!==i&&Td.splice(i,1)}(e),e._statsCollector.stopUpdateStats();const t=yield e._leaveMutex.lock();if("DISCONNECTED"===e.connectionState)return _.info("[".concat(e._clientId,"] Leaving channel repeated, success")),void t();yield e._gateway.leave("CONNECTED"!==e.connectionState),_.info("[".concat(e._clientId,"] Leaving channel success")),e._joinAndNotLeaveYet=!1,e.store.resetJoinChannelServiceRecords(),t()})()}publish(e){var t=arguments,n=this;return C(function*(){let i=!(t.length>1&&void 0!==t[1])||t[1];if(!Array.isArray(e)){if(!(e instanceof bp))return n._publishDataChannel(e);e=[e]}if(0===e.length)throw new N(S.INVALID_PARAMS,"param list is empty");const r=e;if("audience"===n._gateway.role)throw new N(S.INVALID_OPERATION,"audience can not publish stream");for(const s of r){if(!(s instanceof bp))throw new N(S.INVALID_PARAMS,"parameter is not local track");if(!s._enabled&&i)throw new N(S.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(s.getTrackId()))}_.info("[".concat(n._clientId,"] Publishing tracks, id ").concat(r.map(s=>"".concat(s.getTrackId()," "))));const o=yield n._publishMutex.lock();yield n._configDistribute.awaitConfigDistributeComplete(),i&&r.forEach(s=>{const a=n._configDistribute.getBitrateLimit();s instanceof St&&a&&s.setBitrateLimit(a.uplink)});try{yield n._publishHighStream(r),_.info("[".concat(n._clientId,"] Publish success, id ").concat(r.map(s=>"".concat(s.getTrackId()," "))))}catch(s){throw _.error("[".concat(n._clientId,"] publish error"),s.toString()),s}finally{o()}})()}_publishDataChannel(e){var t=this;return C(function*(){ot(e.id,"id",0,65535,!0),ac(e.ordered,"ordered"),Kn(e.metadata,"metadata",0,512),_.info("[".concat(t._clientId,"] Publishing datachannels, id ").concat(e.id));const n=yield t._publishMutex.lock();try{if(-1!==t._p2pChannel.getAllDataChannels().findIndex(o=>o.id===e.id))throw new N(S.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!t._joinInfo||void 0===t._uid)throw new N(S.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==t.connectionState&&"RECONNECTING"!==t.connectionState)throw new N(S.INVALID_OPERATION,"can not publish datachannel in ".concat(t.connectionState," state"));if("auto"===t._turnServer.mode&&R("FORCE_TURN")&&!R("TURN_ENABLE_TCP")&&!R("TURN_ENABLE_UDP"))throw new N(S.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=K$(o=e,!1),r=yield t._p2pChannel.publishDataChannel([i]);if(r.length>0){if("number"!=typeof i._originDataChannelId)throw _.error("[".concat(t._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new N(S.CREATE_DATACHANNEL_ERROR);try{yield q.all(r.map(o=>t._uid&&t._gateway.publishDataChannel(t._uid,o,!0))),yield i._waitTillOpen()}catch(o){if(o.code!==S.DISCONNECT_P2P)throw o}}return _.info("[".concat(t._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw _.error("[".concat(t._clientId,"] publish datachannels error"),i.toString()),i}finally{n()}var o})()}unpublish(e){var t=this;return C(function*(){if(!t._joinInfo||void 0===t._uid)throw new N(S.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let n=[];if(e)if(Array.isArray(e))n=e;else{if(!(e instanceof bp))return t._unpublishDataChannel([e]);n=[e]}else t.store.useP2P||(yield t._unpublishDataChannel()),n=t._p2pChannel.getAllTracks(!0);_.info("[".concat(t._clientId,"] Unpublish tracks, tracks ").concat(n.map(r=>"".concat(r.getTrackId()," "))," "));const i=yield t._publishMutex.lock();try{if(t._p2pChannel instanceof Fr){const r=yield t._p2pChannel.unpublish(n);r&&(yield t._gateway.sendExtensionMessage(Qt.UNPUBLISH,{unpubMsg:r},!0))}else{const r=yield t._p2pChannel.unpublish(n);r&&(yield t._gateway.unpublish(r,t._uid)),_.info("[".concat(t._clientId,"] Unpublish success,tracks ").concat(n.map(o=>"".concat(o.getTrackId()))))}}catch(r){throw _.error("[".concat(t._clientId,"] unpublish error"),r.toString()),r}finally{i&&i()}})()}_unpublishDataChannel(e){var t=this;return C(function*(){void 0!==e&&0!==e.length||(e=t._p2pChannel.getAllDataChannels()),_.info("[".concat(t._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));const n=yield t._publishMutex.lock();try{const i=yield t._p2pChannel.unpublishDataChannel(e);i&&(yield t._gateway.unpublishDataChannel(i)),_.info("[".concat(t._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(r=>"".concat(r.id))))}catch(i){throw _.error("[".concat(t._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{n&&n()}})()}subscribe(e,t,n){var i=this;return C(function*(){if(!(e instanceof vl)){const r=i.remoteUsers.find(o=>o.uid===e);if(!r)throw new N(S.INVALID_REMOTE_USER,"user is not in the channel");e=r}return"datachannel"===t?i._subscribeDataChannel(e,n):i._subscribe(e,t)})()}presubscribe(e,t){var n=this;return C(function*(){if(Mn(t,"mediaType",["audio","video"]),n._p2pChannel instanceof Fr)throw new N(S.INVALID_OPERATION,"can't presub at p2p mode");if(!n._joinInfo)throw new N(S.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==n.connectionState&&"RECONNECTING"!==n.connectionState)throw new N(S.INVALID_OPERATION,"can't presub in ".concat(n.connectionState," state"));const i=t===ie.AUDIO,r=t===ie.VIDEO,o=yield n._subscribeMutex.lock();try{const{ssrcId:s,ortc:a,rtxSsrcId:c,cname:l,uint_id:d}=yield n._gateway.presubscribe(e,t,!0);if(null==s)throw new N(S.UNEXPECTED_RESPONSE,"no ssrc id");let u=n._users.find(p=>p.uid===e);u||(u=new vl(e,d||e),u._is_pre_created=!0,n._users.push(u)),l&&(u._cname=l),u._uintid||(u._uintid=d||e),i&&(u._audioSSRC=s,u._audio_pre_subscribed=!0,a&&(u._audioOrtc=a)),r&&(u._videoSSRC=s,u._video_pre_subscribed=!0,a&&(u._videoOrtc=a),null!=c&&(u._rtxSsrcId=c)),_.info("[".concat(n._clientId,"] presub succeed ssrc: ").concat(s)),yield n._p2pChannel.subscribe(u,t,s,c,a);const h=i?u._audioTrack:u._videoTrack;if(!h)throw new N(S.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(u._trust_audio_stream_added_state_=!0,u._audio_added_=!0),r&&(u._trust_video_stream_added_state_=!0,u._video_added_=!0),h}catch(s){throw _.error("[".concat(n._clientId,"] presub user ").concat(e," error"),s),s}finally{o()}})()}_subscribeDataChannel(e,t){var n=this;return C(function*(){var i;if(ot(t,"channelId",0,65535,!0),!n._joinInfo)throw new N(S.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==n.connectionState&&"RECONNECTING"!==n.connectionState)throw new N(S.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(n.connectionState," state"));if(!n._users.find(c=>c===e))throw _.error("[".concat(n._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new N(S.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&0===e._dataChannels.length)throw _.error("[".concat(n._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new N(S.INVALID_REMOTE_USER,"user is not published");const o=null===(i=e._dataChannels)||void 0===i?void 0:i.find(c=>c.id===t);if(!o)throw _.error("[".concat(n._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new N(S.REMOTE_USER_IS_NOT_PUBLISHED);const s=yield n._subscribeMutex.lock();_.info("[".concat(n._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const c=yield n._p2pChannel.subscribeDataChannel(e,[o]);if(c&&Y(c).call(c,o.id))try{var a;if("number"!=typeof o._originDataChannelId)throw _.error("[".concat(n._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new N(S.CREATE_DATACHANNEL_ERROR);const l={id:o.id,datachannelId:o._originDataChannelId,ordered:o.ordered,maxRetransmits:o.maxRetransmits,metadata:null!==(a=o.metadata)&&void 0!==a?a:""};yield n._gateway.subscribeDataChannel(e.uid,l,!0),yield o._waitTillOpen()}catch(l){if(l?.code!==S.WS_ABORT)throw yield n._p2pChannel.unsubscribeDataChannel(e,[o]),l;yield n._p2pChannel.unsubscribeDataChannel(e,[o]),n._p2pChannel.setPendingRemoteDataChannel(e,o.id)}return _.info("[".concat(n._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),o}finally{s()}})()}_p2pSubscribe(e,t,n){var i=this;return C(function*(){if(Mn(t,"mediaType",["audio","video"]),!i._joinInfo)throw new N(S.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==i.connectionState&&"RECONNECTING"!==i.connectionState)throw new N(S.INVALID_OPERATION,"Can't subscribe stream in ".concat(i.connectionState," state"));if(!i._users.find(s=>s===e)){const s=new N(S.INVALID_REMOTE_USER,"user is not in the channel");throw _.error("[".concat(i._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),s}if(!e.hasAudio&&!e.hasVideo){const s=new N(S.INVALID_REMOTE_USER,"user is not published");throw _.error("[".concat(i._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),s}if(!n&&("audio"===t&&!e.hasAudio||"video"===t&&!e.hasVideo)){const s=new N(S.REMOTE_USER_IS_NOT_PUBLISHED);throw _.error("[".concat(i._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),s}const o=yield i._subscribeMutex.lock();_.info("[".concat(i._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(yield i._p2pChannel.hasRemoteMediaWithLock(e,t))yield i._p2pChannel.unmuteRemote(e,t);else try{const a="audio"===t?e._audioSSRC:e._videoSSRC,c="audio"===t?e._audioMid:e._videoMid;i.store.subscribe(e.uid,t,Date.now()),i._p2pChannel instanceof Fr&&(yield i._p2pChannel.subscribe(e,t,a,c))}catch(a){throw a}_.info("[".concat(i._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),i._defaultStreamFallbackType&&i.setStreamFallbackOption(e.uid,i._defaultStreamFallbackType).catch(a=>{_.warning("[".concat(i._clientId,"] auto set fallback failed"),a)});const s="audio"===t?e._audioTrack:e._videoTrack;if(!s)throw new N(S.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw _.error("[".concat(i._clientId,"] subscribe user ").concat(e.uid," error"),s),s}finally{o()}})()}_subscribe(e,t,n){var i=this;return C(function*(){if(i._p2pChannel instanceof Fr)return i._p2pSubscribe(e,t);if(Mn(t,"mediaType",["audio","video"]),!i._joinInfo)throw new N(S.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==i.connectionState&&"RECONNECTING"!==i.connectionState)throw new N(S.INVALID_OPERATION,"Can't subscribe stream in ".concat(i.connectionState," state"));if(!i._users.find(d=>d===e)){const d=new N(S.INVALID_REMOTE_USER,"user is not in the channel");throw _.error("[".concat(i._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),d}if(!e.hasAudio&&!e.hasVideo){const d=new N(S.INVALID_REMOTE_USER,"user is not published");throw _.error("[".concat(i._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),d}if(!(n||("audio"!==t||e.hasAudio&&void 0!==e._audioSSRC)&&("video"!==t||e.hasVideo&&void 0!==e._videoSSRC))){const d=new N(S.REMOTE_USER_IS_NOT_PUBLISHED);throw _.error("[".concat(i._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),d}let o="audio"===t?e._audioSSRC:e._videoSSRC,s="audio"===t?e._audioOrtc:e._videoOrtc,a="video"===t?e._rtxSsrcId:void 0,c={stream_type:"audio"===t?ie.AUDIO:ie.VIDEO,ssrcId:o};const l=yield i._subscribeMutex.lock();_.info("[".concat(i._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(yield i._p2pChannel.hasRemoteMediaWithLock(e,t))yield i._p2pChannel.unmuteRemote(e,t);else try{const u="audio"===t?e._audioSSRC:e._videoSSRC;void 0!==u&&u!==o&&(o=u,s="audio"===t?e._audioOrtc:e._videoOrtc,a="video"===t?e._rtxSsrcId:void 0,c={stream_type:"audio"===t?ie.AUDIO:ie.VIDEO,ssrcId:o}),vi.markSubscribeStart(i.store.clientId,o),i.store.subscribe(e.uid,t,Date.now()),yield i._p2pChannel.subscribe(e,t,o,a,s);try{i._p2pChannel.isPreSubScribe(o)||(yield i._gateway.subscribe(e.uid,c,!0))}catch(h){if(h?.code!==S.WS_ABORT)throw yield i._p2pChannel.unsubscribe(e,t),h;yield i._p2pChannel.unsubscribe(e,t,!0),i._p2pChannel.setPendingRemoteMedia(e,t)}i.store.subscribe(e.uid,t,void 0,Date.now()),i._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(u){throw i._p2pChannel.reportSubscribeEvent(!1,u?.code,e,t),u}_.info("[".concat(i._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),i._defaultStreamFallbackType&&i.setStreamFallbackOption(e.uid,i._defaultStreamFallbackType).catch(u=>{_.warning("[".concat(i._clientId,"] auto set fallback failed"),u)});const d="audio"===t?e._audioTrack:e._videoTrack;if(!d)throw new N(S.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw _.error("[".concat(i._clientId,"] subscribe user ").concat(e.uid," error"),d),d}finally{l()}})()}massSubscribe(e){var t=this;return C(function*(){if(cc(e,"subscribeList"),!t._joinInfo)throw new N(S.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==t.connectionState&&"RECONNECTING"!==t.connectionState)throw new N(S.INVALID_OPERATION,"Can't subscribe stream in ".concat(t.connectionState," state"));const n=Date.now(),i=new Map,r=yield t._subscribeMutex.lock();_.info("[".concat(t._clientId,"]start massSubscribe user ").concat(e.map(c=>{let{user:l,mediaType:d}=c;return"user: ".concat(l?.uid,", mediaType: ").concat(d)}).join("; ")));const o=(e=[...e]).map(c=>{let{user:l,mediaType:d}=c;return{user:l,mediaType:d}}),s=yield t._p2pChannel.globalLock();try{var a;for(let l=e.length-1;l>=0;l--){const d=e[l],{user:u,mediaType:h}=d;if(Mn(h,"mediaType",["audio","video"]),!u){const g=new N(S.INVALID_PARAMS,"user property does not exist in subscribeList item");throw _.error("[".concat(t._clientId,"] user property does not exist in subscribeList item")),g}if(!t._users.find(g=>g===u)){const g=new N(S.INVALID_REMOTE_USER,"user is not in the channel");_.error("[".concat(t._clientId,"] can not massSubscribe ").concat(u.uid,", this user is not in the channel")),o[l].error=g,e.splice(l,1);continue}if("audio"===h&&(!u.hasAudio||void 0===u._audioSSRC)||"video"===h&&(!u.hasVideo||void 0===u._videoSSRC)){const g=new N(S.REMOTE_USER_IS_NOT_PUBLISHED);_.error("[".concat(t._clientId,"] can not subscribe ").concat(u.uid," with mediaType ").concat(h,", remote user is not published")),o[l].error=g,e.splice(l,1);continue}const m=Ln.Video|Ln.LwoVideo,f=i.get(u);if(f){if("video"===h?f&m:f&Ln.Audio){e.splice(l,1),_.warning("[".concat(t._clientId,"] repeat massSubscribe user:").concat(u.uid,", mediaType:").concat(h," twice"));continue}i.set(u,f|("video"===h?m:Ln.Audio))}else i.set(u,"video"===h?m:Ln.Audio)}for(let l=e.length-1;l>=0;l--){const d=e[l],{user:u,mediaType:h}=d,p=Ln.Video|Ln.LwoVideo;if(t._p2pChannel.hasRemoteMedia(u,h)){yield t._p2pChannel.unmuteRemoteNoLock(u,h);const m=i.get(u);i.set(u,"video"===h?m^p:m^Ln.Audio),e.splice(l,1)}}t.store.massSubscribe(e.map(l=>({userId:l.user.uid,type:l.mediaType})),n);let c=Ns(a=Array.from(i.entries())).call(a,(l,d)=>{let[u,h]=d;if(0===h)return l;const p={stream_id:u.uid,stream_type:h};return h&Ln.Audio&&(p.audio_ssrc=u._audioSSRC),h&Ln.Video&&(p.video_ssrc=u._videoSSRC),l.push(p),l},[]);try{e.length>0&&(yield t._p2pChannel.massSubscribeNoLock(e.map(d=>{let{user:u,mediaType:h}=d;return{user:u,mediaType:h,ssrcId:h===ie.VIDEO?u._videoSSRC:u._audioSSRC,rtxSsrcId:h===ie.VIDEO?u._rtxSsrcId:void 0}})));const l=new Map;if(c=c.filter(d=>d.video_ssrc&&!t._p2pChannel.isPreSubScribe(d.video_ssrc)||d.audio_ssrc&&!t._p2pChannel.isPreSubScribe(d.audio_ssrc)||!d.video_ssrc&&!d.audio_ssrc),c.length>0){const d=yield t._gateway.subscribeAll(c,!0);(d?.users||[]).forEach(u=>{let{stream_id:h,video_error_code:p,audio_error_code:m,error_code:f}=u;(p||m||f)&&l.set(h,{video_error_code:p,audio_error_code:m,error_code:f})})}if(Array.from(l.entries()).length>0){const d=[];Array.from(l.entries()).forEach(u=>{let[h,p]=u;const m=t.remoteUsers.find(f=>f.uid===h);if(m){let f;p.error_code||p.video_error_code&&p.audio_error_code?f=void 0:p.video_error_code?f=ie.VIDEO:p.audio_error_code&&(f=ie.AUDIO),d.push({user:m,mediaType:f})}}),d.length>0&&(yield t._p2pChannel.massUnsubscribeNoLock(d))}for(const d of o){const u=l.get(d.user.uid);if(u){const h=u.error_code||"audio"===d.mediaType&&u.audio_error_code||"video"===d.mediaType&&u.video_error_code;if(h){const p=Fg(h);_.error("user:".concat(d.user.uid," mediaType:").concat(d.mediaType," has massSubscribe error ").concat(p.desc)),d.error=new N(S.SUBSCRIBE_FAILED,"code ".concat(h,": ").concat(p.desc))}}d.error||(d.track="video"===d.mediaType?d.user.videoTrack:d.user.audioTrack)}return t.store.massSubscribe(o.filter(d=>!d.error).map(d=>({userId:d.user.uid,type:d.mediaType})),void 0,Date.now()),o.forEach(d=>{var u;ne.subscribe(t.store.sessionId,{succ:!!d.error,ec:(null===(u=d.error)||void 0===u?void 0:u.code)||null,video:d.mediaType===ie.VIDEO,audio:d.mediaType===ie.AUDIO,peerid:d.user.uid,subscribeRequestid:d.mediaType===ie.VIDEO?d.user._videoSSRC:d.user._audioSSRC,p2pid:t.store.p2pId,eventElapse:Math.floor(performance.now()-n),preSsrc:t._p2pChannel.isPreSubScribe(d.user._videoSSRC)},!0)}),_.info("[".concat(t._clientId,"] massSubscribe success ").concat(e.map(d=>{let{user:u,mediaType:h}=d;return"user: ".concat(u?.uid,", mediaType: ").concat(h)}).join("; "))),o}catch(l){throw yield t._p2pChannel.massUnsubscribeNoLock(e),l}}finally{s(),r()}})()}unsubscribe(e,t,n){var i=this;return C(function*(){if(!(e instanceof vl)){const s=i.remoteUsers.find(a=>a.uid===e);if(!s)throw new N(S.INVALID_REMOTE_USER,"user is not in the channel");e=s}if(t||i.store.useP2P){if("datachannel"===t)return i._unsubscribeDataChannel(e,n)}else yield i._unsubscribeDataChannel(e,n);if(t&&Mn(t,"mediaType",["audio","video"]),!i._joinInfo)throw new N(S.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!i._users.find(s=>s===e)){const s=new N(S.INVALID_REMOTE_USER,"user is not in the channel");throw _.error("[".concat(i._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}_.info("[".concat(i._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const o=yield i._subscribeMutex.lock();try{if(i._p2pChannel instanceof Fr)yield i._p2pChannel.unsubscribe(e,t);else{const s=yield i._p2pChannel.unsubscribe(e,t);s&&(yield i._gateway.unsubscribe(s,e.uid)),t&&"audio"!==t||(e._audio_pre_subscribed=!1),t&&"video"!==t||(e._video_pre_subscribed=!1),e._is_pre_created&&fS(i._users,e),_.info("[".concat(i._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(s){if(s.code===S.DISCONNECT_P2P)return void _.warning("disconnecting p2p, abort unsubscribe request.");throw _.error("[".concat(i._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}finally{o()}})()}_unsubscribeDataChannel(e,t){var n=this;return C(function*(){if(t&&ot(t,"id",0,65535,!0),!n._joinInfo)throw new N(S.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!n._users.find(o=>o===e)){const o=new N(S.INVALID_REMOTE_USER,"user is not in the channel");throw _.error("[".concat(n._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),o}let r;if("number"==typeof t){const o=e._dataChannels.find(s=>s.id===t);o&&(r=[o])}else r=e._dataChannels;if(void 0===r){const o=new N(S.REMOTE_USER_IS_NOT_PUBLISHED);throw _.error("[".concat(n._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),o}_.info("[".concat(n._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(o=>o.id)));try{const o=yield n._p2pChannel.unsubscribeDataChannel(e,r);o&&(yield n._gateway.unsubscribeDataChannel(o,e.uid)),_.info("[".concat(n._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o))}catch(o){if(o.code===S.DISCONNECT_P2P)return void _.warning("disconnecting p2p, abort unsubscribe request.");throw _.error("[".concat(n._clientId,"] unsubscribe user ").concat(e.uid," error"),o.toString()),o}})()}massUnsubscribe(e){var t=this;return C(function*(){if(cc(e,"unsubscribeList"),!t._joinInfo)throw new N(S.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");_.info("[".concat(t._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:r,mediaType:o}=i;return"user: ".concat(r?.uid,", mediaType: ").concat(o,";")}).join())),e=[...e];const n=new Map;for(let i=e.length-1;i>=0;i--){const{user:r,mediaType:o}=e[i];if(!r){const c=new N(S.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw _.error("[".concat(t._clientId,"] user property does not exist in unsubscribeList item")),c}if(Mn(o,"mediaType",["video","audio",void 0]),!t._users.find(c=>c===r)){_.warning("[".concat(t._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(i,1);continue}const a=Ln.Video|Ln.LwoVideo;if(n.has(r)){const c=n.get(r);let l;switch(o){case"video":l=c&a;break;case"audio":l=c&Ln.Audio;break;default:l=c&(Ln.Audio|a)}if(l){_.warning("[".concat(t._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(o," twice.")),e.splice(i,1);continue}o?"audio"===o?n.set(r,c|Ln.Audio):"video"===o&&n.set(r,c|a):n.set(r,c|Ln.Audio|a)}else o?"audio"===o?n.set(r,Ln.Audio):"video"===o&&n.set(r,a):n.set(r,Ln.Audio|a)}try{const i=yield t._p2pChannel.massUnsubscribe(e);i&&(yield t._gateway.massUnsubscribe(i)),_.info("[".concat(t._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:o,mediaType:s}=r;return"user: ".concat(o?.uid,", mediaType: ").concat(s,";")}).join()))}catch(i){if(i.code===S.DISCONNECT_P2P)return void _.warning("[".concat(t._clientId,"] disconnecting p2p, abort unsubscribe request."));throw _.error("[".concat(t._clientId,"] massUnsubscribe error"),i.toString()),i}})()}setLowStreamParameter(e){var t=this;return C(function*(){(function(i){if(!i)throw new M(S.INVALID_PARAMS);xt(i.width)||SN(i.width,"streamParameter.width"),xt(i.height)||SN(i.height,"streamParameter.height"),xt(i.framerate)||SN(i.framerate,"streamParameter.framerate"),xt(i.bitrate)||ot(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&_.warning("[".concat(t._clientId,"] The width and height parameters take effect only when both are set")),_.info("[".concat(t._clientId,"] set low stream parameter to"),JSON.stringify(e));const n=t._configDistribute.getLowStreamConfigDistribute();if(n&&n.bitrate&&e.bitrate&&n.bitrate<e.bitrate&&(e.bitrate=n.bitrate),t._lowStreamParameter=e,t._isDualStreamEnabled)return t._p2pChannel.updateVideoStreamParameter(e,j.LocalVideoLowTrack)})()}enableDualStream(){var e=this;return C(function*(){if(!Fe().supportDualStream)throw ne.streamSwitch(e._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new N(S.NOT_SUPPORTED,"Your browser is not support dual stream");if(e._isDualStreamEnabled)throw new N(S.INVALID_OPERATION,"Dual stream is already enabled");if(e._p2pChannel.canPublishLowStream())try{yield e._publishLowStream()}catch(t){throw ne.streamSwitch(e._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}e._isDualStreamEnabled=!0,ne.streamSwitch(e._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),_.info("[".concat(e._clientId,"] enable dual stream"))})()}disableDualStream(){var e=this;return C(function*(){if(e._isDualStreamEnabled){if(!e._joinInfo)throw new N(S.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(e._p2pChannel.getLocalMedia(j.LocalVideoLowTrack))try{const t=yield e._p2pChannel.unpublishLowStream();t&&(yield e._gateway.unpublish(t,e._joinInfo.stringUid||e._joinInfo.uid))}catch(t){throw ne.streamSwitch(e._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}e._isDualStreamEnabled=!1,ne.streamSwitch(e._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),_.info("[".concat(e._clientId,"] disable dual stream"))}})()}setClientRole(e,t){var n=this;return C(function*(){if(Mn(e,"role",["audience","host"]),t&&i7(t),"rtc"===n.mode||"p2p"===n.mode)throw _.warning("[".concat(n._clientId,"]").concat(n.mode," mode can not use setClientRole")),new N(S.INVALID_OPERATION,"".concat(n.mode," mode can not use setClientRole"));if(t&&t.level&&"host"===e)throw new N(S.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===e&&n._p2pChannel.hasLocalMedia())throw new N(S.INVALID_OPERATION,"can not set client role to audience when publishing stream");yield n._gateway.setClientRole(e,t),n._config.role=e,_.info("[".concat(n._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))})()}getRemoteInboundOffset(){var e;const t=null===(e=this._p2pChannel.getStats())||void 0===e?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Kn(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new N(S.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new N(S.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,ne.setProxyServer(this._proxyServer),_.setProxyServer(this._proxyServer),_.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new N(S.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new N(S.INVALID_OPERATION,"You have already set the proxy")}if(pS(e))return this._turnServer={servers:e,mode:"original-manual"},void _.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>n7(n)),this._turnServer={servers:e,mode:"manual"},_.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if("DISCONNECTED"!==this.connectionState)throw new N(S.INVALID_OPERATION,"you should set license before join channel");if(Kn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new N(S.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,_.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if("DISCONNECTED"!==this.connectionState)throw new N(S.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new N(S.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(void 0===e&&(e=3),e){case 1:case 2:throw new N(S.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new N(S.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,_.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new N(S.INVALID_OPERATION,"Stop proxy server after leave channel");ne.setProxyServer(),_.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",_.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new N(S.INVALID_PARAMS,"accessPoints is required.");cc(e.accessPoints.serverList,"accessPoints.serverList"),Kn(e.accessPoints.domain,"accessPoints.domain");const t=(h,p)=>{ot(h,p,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new N(S.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");R("CLOSE_AFB_FOR_LOCAL_AP")&&(st("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),st("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=e.accessPoints.domain,o=e.accessPoints.serverList.map(h=>i.test(h)?"".concat(h.replace(/\./g,"-"),".").concat(r):h),s=o.map(h=>"".concat(h,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,st("WEBCS_DOMAIN",s),st("WEBCS_DOMAIN_BACKUP_LIST",s),st("GATEWAY_DOMAINS",[r]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(cc(e.report.hostname,"report.hostname"),st("EVENT_REPORT_DOMAIN",e.report.hostname[0]),st("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(st("EVENT_REPORT_DOMAIN",o[0]),st("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let a=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),a=e.report.port),st("STATS_COLLECTOR_PORT",a),st("ENABLE_EVENT_REPORT",!!e.report);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(cc(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=o[0];let l=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),l=e.log.port),st("LOG_UPLOAD_SERVER","".concat(c,":").concat(l));let d=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(cc(e.cds.hostname,"cds.hostname"),d=e.cds.hostname):d=o;let u=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),u=e.cds.port),st("CDS_AP",d.map(h=>"".concat(h,":").concat(u))),st("ENABLE_CONFIG_DISTRIBUTE",!!e.cds),_.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(cc(e,"serverList"),Kn(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new N(S.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(t):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,st("WEBCS_DOMAIN",e),st("WEBCS_DOMAIN_BACKUP_LIST",e),st("GATEWAY_DOMAINS",[t]),st("EVENT_REPORT_DOMAIN",e[0]),st("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),st("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),_.info("[".concat(this._clientId,"] set local access point success"))}setRemoteDefaultVideoStreamType(e){var t=this;return C(function*(){if(Mn(e,"streamType",[0,1,4,5,6,7,8,9]),t._remoteDefaultVideoStreamType=e,t._joinInfo)try{yield t._gateway.setDefaultRemoteVideoStreamType(e),t._joinInfo.defaultVideoStream=t._remoteDefaultVideoStreamType}catch(n){throw _.error("[".concat(t._clientId,"] set default remote video stream type error"),n.toString()),n}else _.debug("[".concat(t._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))})()}setRemoteVideoStreamType(e,t){var n=this;return C(function*(){Mn(t,"streamType",[0,1,4,5,6,7,8,9]);try{yield n._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const i=n._users.find(r=>r.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw _.error("[".concat(n._clientId,"] set remote video stream type error"),i.toString()),i}_.info("[".concat(n._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),n._remoteStreamTypeCacheMap.set(e,t)})()}setStreamFallbackOption(e,t){var n=this;return C(function*(){Mn(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{yield n._gateway.setStreamFallbackOption(e,t)}catch(i){throw _.error("[".concat(n._clientId,"] set stream fallback option"),i.toString()),i}_.info("[".concat(n._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),n._streamFallbackTypeCacheMap.set(e,t)})()}setEncryptionConfig(e,t,n,i){Mn(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"]),Kn(t,"secret");const r=["aes-128-gcm2","aes-256-gcm2"];if(Y(r).call(r,e)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new N(S.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new N(S.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(ac(i,"encryptDataStream"),!Y(r).call(r,e))throw new N(S.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||_.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=cl(n))}renewToken(e){var t=this;return C(function*(){if(Kn(e,"token",1,2047),!t._key||!t._joinInfo)throw new N(S.INVALID_OPERATION,"renewToken should not be called before user join");const n=t._key;t._key=e,t._joinInfo&&(t._joinInfo.token=e);const i=yield t._renewTokenMutex.lock();try{if(R("USE_NEW_TOKEN")){_.debug("[".concat(t._clientId,"] start renew token with ticket from unilbs"));const r=yield function Yke(e,t,n){return cM.apply(this,arguments)}(t._joinInfo,t._axiosCancelSource.token,t._config.httpRetryConfig||vn);_.debug("[".concat(t._clientId,"] get ticket from unilbs success")),yield t._gateway.renewToken({token:e,ticket:r})}else _.debug("[".concat(t._clientId,"] start renew token without ticket")),yield t._gateway.renewToken({token:e});_.debug("[".concat(t._clientId,"] renewToken success"))}catch(r){throw t._key=n,t._joinInfo.token=n,_.error("[".concat(t._clientId,"] renewToken failed"),r.toString()),r}finally{i()}})()}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?_.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Ae.VOLUME_INDICATOR,e)},R("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}startLiveStreaming(e,t){var n=this;return C(function*(){if(!t){if("h264"!==n.codec)throw new N(S.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!n._p2pChannel.hasLocalMedia())throw new N(S.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(n._liveRawStreamingClient&&n._liveRawStreamingClient.hasUrl(e)||n._liveTranscodeStreamingClient&&n._liveTranscodeStreamingClient.hasUrl(e))throw new N(S.LIVE_STREAMING_TASK_CONFLICT);const i=t?Sa.TRANSCODE:Sa.RAW;return n._createLiveStreamingClient(i).startLiveStreamingTask(e,i)})()}setLiveTranscoding(e){return this._createLiveStreamingClient(Sa.TRANSCODE).setTranscodingConfig(e)}stopLiveStreaming(e){var t=this;return C(function*(){const n=[t._liveRawStreamingClient,t._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!n.length)throw new N(S.INVALID_PARAMS,"can not find live streaming url to stop");yield q.all(n.map(i=>i&&i.stopLiveStreamingTask(e)))})()}startChannelMediaRelay(e){var t=this;return C(function*(){N$(e),yield t._createChannelMediaRelayClient().startChannelMediaRelay(e)})()}updateChannelMediaRelay(e){var t=this;return C(function*(){N$(e),yield t._createChannelMediaRelayClient().updateChannelMediaRelay(e)})()}stopChannelMediaRelay(){var e=this;return C(function*(){yield e._createChannelMediaRelayClient().stopChannelMediaRelay(),e._statsCollector.onStatsChanged&&(e._statsCollector.onStatsChanged=void 0)})()}sendStreamMessage(e){var t=arguments,n=this;return C(function*(){var i;let r=!(t.length>1&&void 0!==t[1])||t[1];if(!n._joinInfo)throw new N(S.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof e||e instanceof Uint8Array)&&(e={payload:e}),"string"==typeof e.payload){const s=new TextEncoder;e.payload=s.encode(e.payload)}let o=!1;if(n._encryptDataStream&&n._encryptDataStreamIv&&n._encryptDataStreamKey&&window.crypto.subtle&&Y(i=["aes-128-gcm2","aes-256-gcm2"]).call(i,n._encryptionMode)&&(o=!0,e.payload=yield(s=C(function*(a,c,l){var d;const u=Ns(d=Array.from(l)).call(d,(b,T)=>b+T,0),h={serverTs:0,seq:u1e++,length:l.length,checkSum:u},p=new Uint8Array(u7(u,2)),m=new ArrayBuffer(10),f=new DataView(m);f.setUint32(0,h.serverTs),f.setUint16(4,h.seq),f.setUint16(6,h.length),f.setUint16(8,h.checkSum),l=s7(l,new Uint8Array(16-l.length%16));const E=yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:a,tagLength:128,additionalData:p},c,l);return s7(new Uint8Array(m),new Uint8Array(E))}),function(a,c,l){return s.apply(this,arguments)})(n._encryptDataStreamIv,n._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new N(S.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");var s;return n._gateway.signal.request(pe.DATA_STREAM,{payload:cl(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-pLe},!r)})()}sendMetadata(e){if(!this._joinInfo)throw new N(S.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new N(S.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(pe.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:cl(e)})}sendCustomReportMessage(e){var t=this;return C(function*(){if(Array.isArray(e)||(e=[e]),e.forEach(p1e),!t._joinInfo)throw new N(S.INVALID_OPERATION,"can not send custom report, not joined");yield ne.sendCustomReportMessage(t._joinInfo.sid,e)})()}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}pickSVCLayer(e,t){var n=this;return C(function*(){Mn(t.spatialLayer,"spatialLayer",[0,1,2,3]),Mn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{yield n._gateway.pickSVCLayer(e,t)}catch(i){throw _.error("[".concat(n._clientId,"] pick SVC layer failed"),i.toString()),i}})()}setRTMConfig(e){var t=this;return C(function*(){const{apRTM:n=!1,rtmFlag:i}=e;if(ac(n,"apRTM"),ot(i,"rtmFlag",0),t._rtmConfig.apRTM=n,t._rtmConfig.rtmFlag=i,_.debug("[".concat(t._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(t.connectionState," state")),("CONNECTED"===t.connectionState||"RECONNECTING"===t.connectionState)&&t._joinInfo)return t._joinInfo.apRTM=n,t._joinInfo.rtmFlag=i,t._gateway.setRTM2Flag(i)})()}_reset(){if(_.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=nr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&nX(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&ne.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new gi("client-publish"),this._subscribeMutex=new gi("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const i=e||ep();_.debug(e?"[".concat(this._clientId,"] new Session ").concat(i):"[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const r=e?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,ne.addSid(i);const o={lts:(new Date).getTime(),mode:this.mode,buildFormat:2,stringUid:t?.stringUid||(null===(n=this._joinInfo)||void 0===n?void 0:n.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:r,clientRole:"audience"===this.role?2:1};ne.sessionInit(this._sessionId,us({cname:t.channel,appid:t.appId},o)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}_publishHighStream(e){var t=this;return C(function*(){if(!t._joinInfo||void 0===t._uid)throw new N(S.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==t.connectionState&&"RECONNECTING"!==t.connectionState)throw new N(S.INVALID_OPERATION,"can not publish stream in ".concat(t.connectionState," state"));if("auto"===t._turnServer.mode&&R("FORCE_TURN")&&!R("TURN_ENABLE_TCP")&&!R("TURN_ENABLE_UDP"))throw new N(S.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");_.debug("[".concat(t._clientId,"] publish high stream"));try{const i=yield t._p2pChannel.publish(e,t._isDualStreamEnabled,t._lowStreamParameter);if(t._p2pChannel instanceof Fr){const r=(yield i.next()).value;if(r){try{yield t._gateway.sendExtensionMessage(Qt.PUBLISH,r,!0)}catch(o){throw i.throw(o),o}yield i.next()}t._p2pChannel.reportPublishEvent(!0,null)}else{const r=(yield i.next()).value;if(r){var n;let o;try{o=yield t._gateway.publish(t._uid,r,!0)}catch(s){if(s.code!==S.DISCONNECT_P2P)throw i.throw(s),s}yield i.next((null===(n=o)||void 0===n?void 0:n.ortc)||[])}t._p2pChannel.reportPublishEvent(!0,null);for(const o of e)o instanceof St&&o._encoderConfig&&t._gateway.setVideoProfile(o._encoderConfig),!o.muted&&o.enabled||(yield t._p2pChannel.muteLocalTrack(o))}}catch(i){if(t._p2pChannel.reportPublishEvent(!1,i?.code,e),i?.code===S.WS_ABORT)return;throw i}})()}_publishLowStream(){var e=this;return C(function*(){if(!e._joinInfo||void 0===e._uid)throw new N(S.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==e.connectionState&&"RECONNECTING"!==e.connectionState)throw new N(S.INVALID_OPERATION,"can not publish stream in ".concat(e.connectionState," state"));_.debug("[".concat(e._clientId,"] publish low stream"));const t=e._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(e._lowStreamParameter||(e._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),e._lowStreamParameter&&e._lowStreamParameter.bitrate&&t.bitrate<e._lowStreamParameter.bitrate&&(e._lowStreamParameter.bitrate=t.bitrate));try{const i=yield e._p2pChannel.publishLowStream(e._lowStreamParameter),r=(yield i.next()).value;if(r){var n;let o;try{o=yield e._gateway.publish(e._uid,r,!0)}catch(s){if(s.code!==S.DISCONNECT_P2P)throw i.throw(s),s}i.next((null===(n=o)||void 0===n?void 0:n.ortc)||[]),e._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(e._p2pChannel.reportPublishEvent(!1,i?.code,void 0,!0),i?.code===S.WS_ABORT)return;throw i}})()}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new N(S.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},i_("LiveStreaming").create(i));var i;return n.onLiveStreamError=(r,o)=>{ne.reportApiInvoke(this._sessionId,{name:Cn.ON_LIVE_STREAM_ERROR,options:[r,o],tag:jt.TRACER}).onSuccess(),this.safeEmit(Ae.LIVE_STREAMING_ERROR,r,o)},n.onLiveStreamWarning=(r,o)=>{ne.reportApiInvoke(this._sessionId,{name:Cn.ON_LIVE_STREAM_WARNING,options:[r,o],tag:jt.TRACER}).onSuccess(),this.safeEmit(Ae.LIVE_STREAMING_WARNING,r,o)},n.on(WN.REQUEST_WORKER_MANAGER_LIST,(r,o,s)=>{if(!this._joinInfo)return s(new N(S.INVALID_OPERATION,"can not find join info to get worker manager"));var a;(a=C(function*(c,l,d,u){const h=R("UAP_AP").slice(0,R("AJAX_REQUEST_CONCURRENT")).map(p=>l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(p+"/api/v1?action=uap"):"https://".concat(p,"/api/v1?action=uap"));return yield function Hke(e,t,n,i,r){$P+=1;const o={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:$P,requestId:$P,version:Oo,cname:n.cname},s={service_name:t,json_body:JSON.stringify(o)};let a,c,l=e[0];return Ls(C(function*(){a=Date.now();const d=yield Bs(l,{data:s,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-a,0!==d.code){const p=new N(S.UNEXPECTED_RESPONSE,"live streaming ap error, code"+d.code,{retry:!0,responseTime:c});throw _.error(p.toString()),p}const u=JSON.parse(d.json_body);if(200!==u.code){const p=new N(S.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(u.code,", reason: ").concat(u.reason),{code:u.code,responseTime:c});throw _.error(p.toString()),p}if(!u.servers||0===u.servers.length){const p=new N(S.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:u.code,responseTime:c});throw _.error(p.toString()),p}const h=(m=t,{addressList:(p=u).servers.map(f=>"wss://".concat(f.address.replace(/\./g,"-"),".").concat(R("WORKER_DOMAIN"),":").concat(f.wss,"?serviceName=").concat(encodeURIComponent(m))),workerToken:p.workerToken,vid:p.vid});var p,m;return R("LIVE_STREAMING_ADDRESS")&&(h.addressList=R("LIVE_STREAMING_ADDRESS")instanceof Array?R("LIVE_STREAMING_ADDRESS"):[R("LIVE_STREAMING_ADDRESS")]),JS(JS({},h),{},{responseTime:c})}),(d,u)=>(ne.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(d.addressList),firstSuccess:0===u,responseTime:c,serverIp:e[u%e.length]}),!1),(d,u)=>(ne.apworkerEvent(n.sid,{success:!1,sc:d.data&&d.data.code||200,serviceName:t,responseTime:c,serverIp:e[u%e.length]}),!!(d.code!==S.OPERATION_ABORTED&&d.code!==S.UNEXPECTED_RESPONSE||d.data&&d.data.retry)&&(l=e[(u+1)%e.length],!0)),r)}(h,c,l,d,u)}),function(c,l,d,u){return a.apply(this,arguments)})(r,this._joinInfo,this._axiosCancelSource.token,vn).then(o).catch(s)}),n};return e===Sa.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new N(S.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},i_("ChannelMediaRelay").create(e));i.on("state",r=>{r===vr.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(Ae.CHANNEL_MEDIA_RELAY_STATE,r)}),i.on("event",r=>{this.safeEmit(Ae.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(r,o)=>{var s;"resolution"===r&&(null===(s=this._channelMediaRelayClient)||void 0===s||s.setVideoProfile(o))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:i}=e,r=[];if(t){const o=[];this._users.forEach(s=>{s._dataChannels.forEach(a=>{n.every(c=>c.uid!==s._uintid||c.stream_id!==a.id)&&o.push({uid:s._uintid,stream_id:a.id,ordered:a.ordered,max_retrans_times:a.maxRetransmits,metadata:a.metadata})})}),o.length>0&&this._handleUpdateDataChannel({added:[],deleted:o})}Array.isArray(n)&&n.length>0&&n.forEach(o=>{const{uid:s,stream_id:a,ordered:c,max_retrans_times:l,metadata:d}=o,u=this._users.find(h=>h._uintid===s);if(u){if(_.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(s)),Y(r).call(r,u)||r.push(u),u._uintid||(u._uintid=s),-1===u._dataChannels.findIndex(h=>h.id===o.stream_id)){const h={id:a,ordered:!!c,maxRetransmits:l,metadata:d},p=K$(h,!0);u._dataChannels.push(p),_.info("[".concat(this._clientId,"] remote user ").concat(u.uid," published datachannel")),t||this.safeEmit(Ae.USER_PUBLISHED,u,"datachannel",h)}this._p2pChannel.hasPendingRemoteDataChannel(u,o.stream_id)&&(_.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(u.uid," after reconnect.")),this._subscribeDataChannel(u,o.stream_id).catch(h=>{_.error("[".concat(this._clientId,"] resubscribe datachannel error"),h.toString())}))}else _.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))}),t&&(this.safeEmit(Ae.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(o=>{const{uid:s}=o,c=this._users.find(d=>d._uintid===s);if(!c)return void _.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const l=c._dataChannels.find(d=>d.id===o.stream_id);l&&(_.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(s)),this._p2pChannel.unsubscribeDataChannel(c,[l]).then(d=>{if(c._dataChannels=c._dataChannels.filter(u=>u!==l),d)return this._gateway.unsubscribeDataChannel(d,c.uid)}),_.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished datachannel ,id:").concat(l.id)),this.safeEmit(Ae.USER_UNPUBLISHED,c,"datachannel",l._config))})}_handleRemoveDataChannels(e){const t=this._users.find(n=>n.uid===e.uid);if(t){if(void 0!==t._dataChannels&&t._dataChannels.length>0){_.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{_.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(i=>{this.safeEmit(Ae.USER_UNPUBLISHED,t,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,t.uid)}),n()}}else _.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){var e=this;this._gateway.on(oi.DISCONNECT_P2P,C(function*(){yield e._p2pChannel.disconnectForReconnect()})),this._gateway.on(oi.CONNECTION_STATE_CHANGE,(t,n,i)=>{var r;if(i===Qe.FALLBACK)return;const o=()=>{this.safeEmit(Ae.CONNECTION_STATE_CHANGE,t,n,i)};if(ne.reportApiInvoke(this._sessionId||(null===(r=this._gateway.joinInfo)||void 0===r?void 0:r.sid)||null,{name:Cn.CONNECTION_STATE_CHANGE,options:[t,n,i],tag:jt.TRACER}).onSuccess(JSON.stringify({cur:t,prev:n,reason:i})),_.info("[".concat(this._clientId,"] connection state change: ").concat(n," -> ").concat(t)),"DISCONNECTED"===t)return this._reset(),void o();if("RECONNECTING"===t)this._users.forEach(a=>{a._trust_in_room_=!1,a._trust_audio_enabled_state_=!1,a._trust_video_enabled_state_=!1,a._trust_audio_mute_state_=!1,a._trust_video_mute_state_=!1,a._trust_audio_stream_added_state_=!1,a._trust_video_stream_added_state_=!1,a._is_pre_created||(a._audio_pre_subscribed||(a._audioSSRC=void 0,a._audioOrtc=void 0),a._video_pre_subscribed||(a._videoSSRC=void 0,a._videoOrtc=void 0,a._rtxSsrcId=void 0),a._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===t){var s;this._streamFallbackTypeCacheMap.forEach((a,c)=>{this._gateway.setStreamFallbackOption(c,a).catch(l=>{_.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),l)})}),this._remoteStreamTypeCacheMap.forEach((a,c)=>{this._gateway.setRemoteVideoStreamType(c,a).catch(l=>{_.warning("[".concat(this._clientId,"] auto set remote stream type failed"),l)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(s=this._joinInfo)||void 0===s?void 0:s.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{_.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(a=>{_.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(a))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(a=>!a._trust_in_room_).forEach(a=>{_.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(a.uid)),this._handleUserOffline({uid:a.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(a=>{a._trust_audio_mute_state_||(_.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(a.uid)),this._handleMuteStream(a.uid,ie.AUDIO,!1)),a._trust_video_mute_state_||(_.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(a.uid)),this._handleMuteStream(a.uid,ie.VIDEO,!1)),a._trust_audio_enabled_state_||(_.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(a.uid)),this._handleSetStreamLocalEnable("audio",a.uid,!0)),a._trust_video_enabled_state_||(_.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(a.uid)),this._handleSetStreamLocalEnable("video",a.uid,!0)),a._trust_video_stream_added_state_||(_.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(a.uid)),this._handleResetAddStream(a,"video")),a._trust_audio_stream_added_state_||(_.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(a.uid)),this._handleResetAddStream(a,"audio")),a._video_added_||a._audio_added_||(_.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(a.uid)),this._handleRemoveStream({uid:a.uid,uint_id:a._uintid}))}))},1e3))}o()}),this._gateway.on(oi.REQUEST_NEW_GATEWAY_LIST,function(){var t=C(function*(n,i){if(!e._joinInfo)return i(new N(S.UNEXPECTED_ERROR,"can not recover, no join info"));try{let r;const o=yield eX(us(us({},e._joinInfo),{},{uid:e._joinInfo.uid,stringUid:void 0}));o?(r=o.ap,iX(o),e._joinInfo.preload=!0):(r=yield QP(e._joinInfo,e._axiosCancelSource.token,e._config.httpRetryConfig||vn,e.store),e._joinInfo.preload=!1),e._joinInfo&&(e._joinInfo.apResponse=r.gatewayInfo.res,e._joinInfo.gatewayAddrs=r.gatewayInfo.gatewayAddrs,e._joinInfo.uni_lbs_ip=r.gatewayInfo.uni_lbs_ip);const s=[];r.gatewayInfo.gatewayAddrs.forEach(a=>{let{address:c}=a;const[l,d]=c.split(":");s.push(e._joinInfo&&e._joinInfo.proxyServer?{proxy:e._joinInfo.proxyServer,host:l,port:d}:{host:l,port:d})}),n(s)}catch(r){i(r)}});return function(n,i){return t.apply(this,arguments)}}()),this._gateway.on(oi.NETWORK_QUALITY,t=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(Ae.NETWORK_QUALITY,t)}),this._gateway.on(oi.STREAM_TYPE_CHANGE,(t,n)=>{this.safeEmit(Ae.STREAM_TYPE_CHANGED,t,n),ne.reportApiInvoke(this._sessionId,{name:Cn.STREAM_TYPE_CHANGE,options:[t,n],tag:jt.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:n}))}),this._gateway.on(oi.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(oi.REQUEST_P2P_CONNECTION_PARAMS,function(){var t=C(function*(n,i,r){try{let o=yield e._p2pChannel.getEstablishParams();R("ENABLE_PREALLOC_PC")&&o||(o=yield e._p2pChannel.startP2PConnection(n)),i(o)}catch(o){r(o)}});return function(n,i,r){return t.apply(this,arguments)}}()),this._gateway.on(oi.JOIN_RESPONSE,(t,n)=>{if(this.store.useP2P)return;const i=RY(t.ortc,n,t.attributes.userAttributes.preSubSsrcs);this._p2pChannel.connect(i)}),this._gateway.on(oi.PRE_CONNECT_PC,function(){var t=C(function*(n){const{candidates:i,fingerprint:r}=n;if(e._joinInfo&&i.length>0&&!e._p2pChannel.isPlanB){var o;yield e._p2pChannel.startP2PConnection({turnServer:e._joinInfo.turnServer});const{cert:s,cid:a}=e._joinInfo.apResponse;yield e._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(a,"_").concat(s),icePwd:"".concat(a,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(o=R("FINGERPRINT"))&&void 0!==o?o:r}]},candidates:i,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}});return function(n){return t.apply(this,arguments)}}())}_handleGatewaySignalEvents(){var e=this;this._gateway.signal.on(Te.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Te.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Te.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(Te.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(Te.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(Te.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Te.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Te.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Te.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,ie.AUDIO,!0)),this._gateway.signal.on(Te.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,ie.AUDIO,!1)),this._gateway.signal.on(Te.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,ie.VIDEO,!0)),this._gateway.signal.on(Te.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,ie.VIDEO,!1)),this._gateway.signal.on(Te.RECEIVE_METADATA,t=>{const n=Sd(t.metadata);this.safeEmit(Ae.RECEIVE_METADATA,t.uid,n)}),this._gateway.signal.on(Te.ON_DATA_STREAM,function(){var t=C(function*(n){var i;if(!n)return;let r=Sd(n.payload);if(e._encryptDataStream&&e._encryptDataStreamIv&&e._encryptDataStreamKey&&window.crypto.subtle&&Y(i=["aes-128-gcm2","aes-256-gcm2"]).call(i,e._encryptionMode)){if(n.payload.length<10)throw new N(S.UNEXPECTED_RESPONSE,"payload length ".concat(n.payload.length," is less than header length ").concat(10));r=yield(a=C(function*(c,l,d){const u=d.subarray(0,10),h=u.slice(8,10),p=(h[0]<<8)+h[1],m=(u[6]<<8)+u[7],f=yield window.crypto.subtle.decrypt({name:"AES-GCM",iv:c,tagLength:128,additionalData:new Uint8Array(u7(p,2))},l,d.subarray(10));return new Uint8Array(f).subarray(0,m)}),function(c,l,d){return a.apply(this,arguments)})(e._encryptDataStreamIv,e._encryptDataStreamKey,r)}var a;let o=0;if(n.ordered||n.syncWithAudio){const s=e._p2pChannel.getStats(),a=e.remoteUsers.find(l=>l.uid===n.uid),c=s?.audioRecv.find(l=>l.ssrc===a?._audioSSRC);o=c?.jitterBufferMs}null==o&&(o=0),function mLe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return X$(n,{uid:e.uid,payload:e.payload});const i="".concat(n.id,"-").concat(e.uid),r=vM.get(i)||[],o=r.findIndex(l=>e.sendTs>=l.sendTs),s=Y$(Y$({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});-1===o?r.push(s):r.splice(o,0,s),vM.set(i,r);let a=!1;var c;aC.has(i)?a=!(null===(c=aC.get(i))||void 0===c||!c.isSyncing):aC.set(i,{isSyncing:a,firstRecvTs:0,firstSendTs:0}),a||$$(i)}(us(us({},n),{},{payload:r}),o,{id:e._clientId,onStreamMessage:"function"==typeof e.onStreamMessage?e.onStreamMessage.bind(e):void 0,safeEmit:e.safeEmit.bind(e)})});return function(n){return t.apply(this,arguments)}}()),this._gateway.signal.on(Te.ON_CRYPT_ERROR,()=>{al(()=>{_.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Ae.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Te.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Te.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{_.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Qe.TOKEN_EXPIRE),this.safeEmit(Ae.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Te.ON_STREAM_FALLBACK_UPDATE,t=>{_.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(Ae.STREAM_FALLBACK,t.stream_id,1===t.stream_type?"fallback":"recover")}),this._gateway.signal.on(Te.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),_.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(Te.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(Te.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(he.REQUEST_TIMEOUT,(t,n)=>{if(this._joinInfo)switch(t){case pe.PUBLISH:{if(!n)return;const o=n.ortc;if(o){var i,r;const s=o.some(l=>{let{stream_type:d}=l;return d===$e.Audio}),a=o.some(l=>{let{stream_type:d}=l;return d!==$e.Audio}),c=o.some(l=>{let{stream_type:d}=l;return d===$e.Screen||d===$e.ScreenLow});"offer"===n.state&&ne.publish(this._joinInfo.sid,{eventElapse:vi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:S.TIMEOUT,audio:s,video:a,p2pid:n.p2p_id,publishRequestid:this.store.pubId,screenshare:c,audioName:s?null===(i=o.find(l=>{let{stream_type:d}=l;return d===$e.Audio}))||void 0===i||null===(i=i.ssrcs[0])||void 0===i?void 0:i.ssrcId.toString():void 0,videoName:a?null===(r=o.find(l=>{let{stream_type:d}=l;return d!==$e.Audio}))||void 0===r||null===(r=r.ssrcs[0])||void 0===r?void 0:r.ssrcId.toString():void 0})}break}case pe.SUBSCRIBE:n&&ne.subscribe(this._joinInfo.sid,{succ:!1,ec:S.TIMEOUT,audio:n.stream_type===ie.AUDIO,video:n.stream_type===ie.VIDEO,peerid:n.stream_id,subscribeRequestid:n.ssrcId,p2pid:this.store.p2pId,eventElapse:vi.measureFromSubscribeStart(this.store.clientId,n.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(n.ssrcId)})}}),this._gateway.signal.on(Te.ON_P2P_OK,t=>{}),this._gateway.signal.on(Te.ON_PUBLISHED_USER_LIST,t=>{if(null==t||!t.users)return;R("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(r=>!wd(r.string_id||r.stream_id,this.channelName)));const n=[],i=[];for(const r of t.users){let o=this._users.find(u=>u._uintid===r.stream_id);o?o._trust_in_room_=!0:(o=new vl(r.string_id||r.stream_id,r.stream_id),this._users.push(o),0===this.getListeners(Ae.PUBLISHED_USER_LIST).length&&(_.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Ae.USER_JOINED,o)));const s=Ln.Audio&r.stream_type,a=(Ln.Video|Ln.LwoVideo)&r.stream_type,c=!!(65280&r.stream_type),l=s&&o.hasAudio,d=a&&o.hasVideo;a&&(o._trust_video_stream_added_state_=!0,o._video_added_=!0,o._videoSSRC=r.video_ssrc,o._rtxSsrcId=r.video_rtx),s&&(o._trust_audio_stream_added_state_=!0,o._audio_added_=!0,o._audioSSRC=r.audio_ssrc),s&&!l&&0===this.getListeners(Ae.PUBLISHED_USER_LIST).length&&(_.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published audio")),this.safeEmit(Ae.USER_PUBLISHED,o,"audio")),a&&!d&&0===this.getListeners(Ae.PUBLISHED_USER_LIST).length&&(_.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published video")),this.safeEmit(Ae.USER_PUBLISHED,o,"video")),(s&&!l||a&&!d||c)&&n.push(o),a&&this._p2pChannel.hasPendingRemoteMedia(o,"video")&&i.push({user:o,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(o,"audio")&&i.push({user:o,mediaType:"audio"})}i.length>0&&(_.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(r=>{_.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(Ae.PUBLISHED_USER_LIST).length>0?R("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=n:(_.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(n.map(r=>r.uid).join(", "))),this.safeEmit(Ae.PUBLISHED_USER_LIST,n)):_.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(n.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(Te.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:n}=t;this._p2pChannel instanceof sC&&this._p2pChannel.updateRemoteRTPCapabilities(n.map(i=>i.toLowerCase()).filter(i=>{var r;return Y(r=Object.keys(bS)).call(r,i)}))})}_handleP2PEvents(){var e=this;this._gateway.signal.on(Te.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Qt.PUBLISH,(t,n,i)=>{const{uid:r}=t;t.forEach(o=>{const{kind:s,ssrcs:a,mid:c,isMuted:l}=o;this._handleP2PAddAudioOrVideoStream(s,r,a[0].ssrcId,c);const d=this._users.find(u=>u.uid===r);return d&&this._p2pChannel instanceof Fr?this._p2pChannel.mockSubscribe(d,s,a[0].ssrcId,c).then(()=>{n()}).catch(i):n(),this._handleMuteStream(r,s,!!l)})}),this._gateway.signal.on(Qt.CALL,function(){var t=C(function*(n,i,r){if(e._p2pChannel instanceof Fr)try{var o;i(yield e._p2pChannel.startP2P({turnServer:null===(o=e._joinInfo)||void 0===o?void 0:o.turnServer},n))}catch(s){r(s)}});return function(n,i,r){return t.apply(this,arguments)}}()),this._gateway.signal.on(he.P2P_CONNECTION,function(){var t=C(function*(n){e._p2pChannel instanceof Fr&&(yield e._p2pChannel.p2pConnect(n))});return function(n){return t.apply(this,arguments)}}()),this._gateway.signal.on(Qt.UNPUBLISH,function(){var t=C(function*(n,i,r){if(e._p2pChannel instanceof Fr){const{unpubMsg:o,uid:s}=n,a=e._users.find(c=>c.uid===s);if(!a)return _.warning("[".concat(e._clientId,"] can not find remote user, ignore mute event, uid: ").concat(s)),void i();try{o.forEach(function(){var c=C(function*(l){let{stream_type:d}=l;const u=d===$e.Audio?ie.AUDIO:ie.VIDEO;yield e._p2pChannel.unsubscribe(a,u),e._handleMuteStream(s,u,!0)});return function(l){return c.apply(this,arguments)}}()),i()}catch(c){r(c)}}});return function(n,i,r){return t.apply(this,arguments)}}()),this._gateway.signal.on(Qt.CONTROL,function(){var t=C(function*(n,i){const{action:r}=n;switch(r){case ul.MUTE_LOCAL_VIDEO:e._handleMuteStream(i,ie.VIDEO,!0);break;case ul.MUTE_LOCAL_AUDIO:e._handleMuteStream(i,ie.AUDIO,!0);break;case ul.UNMUTE_LOCAL_VIDEO:e._handleP2PAddAudioOrVideoStream("video",i),e._handleMuteStream(i,ie.VIDEO,!1);break;case ul.UNMUTE_LOCAL_AUDIO:e._handleP2PAddAudioOrVideoStream("audio",i),e._handleMuteStream(i,ie.AUDIO,!1)}});return function(n,i){return t.apply(this,arguments)}}()),this._gateway.signal.on(Qt.RESTART_ICE,function(){var t=C(function*(n,i,r){if(e._p2pChannel instanceof Fr)try{const{direction:o,iceParameter:s}=n;o!==Xi.SEND_ONLY||s?i(yield e._p2pChannel.restartICE(o,s)):(e._p2pChannel.handleDisconnect(o),i())}catch(o){r(o)}});return function(n,i,r){return t.apply(this,arguments)}}()),this._gateway.signal.on(Qt.CANDIDATE,t=>{if(this._p2pChannel instanceof Fr){const{candidate:n,direction:i}=t;this._p2pChannel.addRemoteCandidate(n,i)}}),this._p2pChannel.on(de.RequestP2PRestartICE,function(){var t=C(function*(n,i,r){try{const{direction:o}=n;i(yield e._gateway.sendExtensionMessage(Qt.RESTART_ICE,n,o===Xi.SEND_ONLY))}catch(o){r(o)}});return function(n,i,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(de.LocalCandidate,t=>{this._gateway.sendExtensionMessage(Qt.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(de.RequestP2PMuteLocal,function(){var t=C(function*(n,i,r){try{yield e._gateway.sendExtensionMessage(Qt.CONTROL,n,!0),i()}catch(o){r(o)}});return function(n,i,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(de.RequestP2PUnmuteRemote,function(){var t=C(function*(n,i,r){if(e._joinInfo)try{yield e._gateway.unmuteRemote(n,e._joinInfo.stringUid||e._joinInfo.uid),i()}catch(o){o.code===S.DISCONNECT_P2P?i():r(o)}else i()});return function(n,i,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(de.RequestP2PMuteRemote,function(){var t=C(function*(n,i,r){if(e._joinInfo)try{yield e._gateway.muteRemote(n,e._joinInfo.stringUid||e._joinInfo.uid),i()}catch(o){o.code===S.DISCONNECT_P2P?i():r(o)}else i()});return function(n,i,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(de.StateChange,(t,n)=>{n===Xe.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){var e=this;this._p2pChannel.on(de.RequestMuteLocal,function(){var t=C(function*(n,i,r){if(e._joinInfo)try{yield e._gateway.muteLocal(n,e._joinInfo.stringUid||e._joinInfo.uid),i()}catch(o){o.code===S.DISCONNECT_P2P?i():r(o)}else i()});return function(n,i,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(de.RequestUnmuteLocal,function(){var t=C(function*(n,i,r){if(e._joinInfo)try{yield e._gateway.unmuteLocal(n,e._joinInfo.stringUid||e._joinInfo.uid),i()}catch(o){o.code===S.DISCONNECT_P2P?i():r(o)}else i()});return function(n,i,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(de.RequestRePublish,(t,n,i)=>{this.publish(t,!1).then(n).catch(i)}),this._p2pChannel.on(de.RequestRePublishDataChannel,(t,n,i)=>{q.all(t.map(function(){var r=C(function*(o){const s=yield e._p2pChannel.publishDataChannel([o]);try{s.forEach(a=>{e._uid&&e._gateway.publishDataChannel(e._uid,a,!0)})}catch(a){if(a.code!==S.DISCONNECT_P2P)throw a}});return function(o){return r.apply(this,arguments)}}())).then(n).catch(i)}),this._p2pChannel.on(de.RequestReSubscribe,function(){var t=C(function*(n,i,r){try{for(const{user:o,kind:s}of n)s===ie.VIDEO?yield e.subscribe(o,"video"):yield e.subscribe(o,"audio");i()}catch(o){r(o)}});return function(n,i,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(de.RequestUpload,(t,n)=>{this._gateway.upload(t,n)}),this._p2pChannel.on(de.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(de.MediaReconnectStart,t=>{this.safeEmit(Ae.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(de.MediaReconnectEnd,t=>{this.safeEmit(Ae.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(de.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(de.RequestRestartICE,function(){var t=C(function*(n){if(e._p2pChannel instanceof Fr)return;const i=yield e._p2pChannel.restartICE(n),r=yield i.next();if(r.done)return;const o=r.value;let s;try{s=yield e._gateway.restartICE({iceParameters:o})}catch(c){return void i.throw(c)}const{iceParameters:a}=function(c){const l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(s);yield i.next({remoteIceParameters:a})});return function(n){return t.apply(this,arguments)}}()),this._p2pChannel.on(de.RequestReconnect,C(function*(){e._gateway.reconnect()})),this._p2pChannel.on(de.RequestReconnectPC,C(function*(){var t;const{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}=yield e._p2pChannel.startP2PConnection({turnServer:null===(t=e._joinInfo)||void 0===t?void 0:t.turnServer}),{gatewayEstablishParams:o,gatewayAddress:s}=yield e._gateway.reconnectPC({iceParameters:n,dtlsParameters:i,rtpCapabilities:r}),a=RY(o,s);yield e._p2pChannel.connect(a),yield e._p2pChannel.republish(),yield e._p2pChannel.reSubscribe()})),this._p2pChannel.on(de.RequestUnpublishForReconnectPC,function(){var t=C(function*(n,i,r){e._joinInfo&&void 0!==e._uid?(yield e._gateway.unpublish(n,e._uid),i()):r()});return function(n,i,r){return t.apply(this,arguments)}}()),this._p2pChannel.on(de.P2PLost,()=>{this.safeEmit(Ae.P2P_LOST,this.store.uid)}),this._p2pChannel.on(de.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(de.ConnectionTypeChange,t=>{this.safeEmit(Ae.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(de.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(de.QueryClientConnectionState,t=>{t(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}enableContentInspect(e){var t=this;return C(function*(){if(!t._joinInfo||"CONNECTED"!==t.connectionState)throw new N(S.INVALID_OPERATION,"[".concat(t._clientId,"] can not create content inspect, please join channel first"));if(t._inspect)throw new N(S.INVALID_OPERATION,"[".concat(t._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(n={config:e},i_("ContentInspect").create(n));t._inspect=i,t.handleVideoInspectEvents(i);const{appId:r,cname:o,sid:s,token:a,uid:c,cid:l,vid:d}=t._joinInfo;yield i.init({appId:r,areaCode:"",cname:o,sid:s,token:a,uid:c,cid:l,vid:d?Number(d):0},vn)}catch(i){throw Array.isArray(i)?i[0]:i}var n})()}handleVideoInspectEvents(e){e.on(Bn.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Ae.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Jo.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(Ae.CONTENT_INSPECT_ERROR,new N(S.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Bn.INSPECT_RESULT,(t,n)=>{var i;if(n?.code===S.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return _.debug("Stop inspect content because that has left channel"),null==this||null===(i=this._inspect)||void 0===i||i.close(),void(this._inspect=void 0);this.safeEmit(Ae.CONTENT_INSPECT_RESULT,t,n)}),e.on(Bn.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>"video"===n.trackMediaType)[0])})}disableContentInspect(){var e=this;return C(function*(){if(!e._inspect)throw new N(S.INVALID_OPERATION,"[".concat(e._clientId,"] inspectVideoContent not started"));try{e._inspect.close(),e._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}})()}setImageModeration(e,t){var n=this;return C(function*(){if(ac(e,"enabled"),e){if(!t)throw new N(S.INVALID_PARAMS,"config is required");if(_X(t),!n._joinInfo)throw new N(S.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(n._moderation)n._moderation.updateConfig(t);else{const r=(i={config:t},i_("ImageModeration").create(i));n._moderation=r,n.handleImageModerationEvents(r);const{appId:o,cname:s,sid:a,token:c,uid:l,cid:d,vid:u}=n._joinInfo;yield r.init({appId:o,areaCode:"",cname:s,sid:a,token:c,uid:l,cid:d,vid:u?Number(u):0},vn)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var i;if(!n._moderation)throw new N(S.INVALID_OPERATION,"[".concat(n._clientId,"] image moderation not started"));try{n._moderation.close(),n._moderation.removeAllListeners(),n._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}})()}handleImageModerationEvents(e){e.on(Fs.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Ae.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===Po.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new N(S.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Fs.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>"video"===n.trackMediaType)[0])})}setP2PTransport(e){if(function(t){Mn(t,"transport",["default","auto","relay","sd-rtn"])}(e),"p2p"!==this.mode)throw new N(S.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,_.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return _.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}setPublishAudioFilterEnabled(e){var t=this;return C(function*(){ac(e,"enabled"),st("ENABLE_PUBLISH_AUDIO_FILTER",e),t._joinInfo&&(yield t._gateway.setPublishAudioFilterEnabled(e))})()}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Q($.prototype,"leave",[vX],Object.getOwnPropertyDescriptor($.prototype,"leave"),$.prototype),Q($.prototype,"publish",[EX],Object.getOwnPropertyDescriptor($.prototype,"publish"),$.prototype),Q($.prototype,"unpublish",[bX],Object.getOwnPropertyDescriptor($.prototype,"unpublish"),$.prototype),Q($.prototype,"subscribe",[yX],Object.getOwnPropertyDescriptor($.prototype,"subscribe"),$.prototype),Q($.prototype,"presubscribe",[SX],Object.getOwnPropertyDescriptor($.prototype,"presubscribe"),$.prototype),Q($.prototype,"massSubscribe",[CX],Object.getOwnPropertyDescriptor($.prototype,"massSubscribe"),$.prototype),Q($.prototype,"unsubscribe",[TX],Object.getOwnPropertyDescriptor($.prototype,"unsubscribe"),$.prototype),Q($.prototype,"massUnsubscribe",[wX],Object.getOwnPropertyDescriptor($.prototype,"massUnsubscribe"),$.prototype),Q($.prototype,"setLowStreamParameter",[IX],Object.getOwnPropertyDescriptor($.prototype,"setLowStreamParameter"),$.prototype),Q($.prototype,"enableDualStream",[RX],Object.getOwnPropertyDescriptor($.prototype,"enableDualStream"),$.prototype),Q($.prototype,"disableDualStream",[AX],Object.getOwnPropertyDescriptor($.prototype,"disableDualStream"),$.prototype),Q($.prototype,"setClientRole",[DX],Object.getOwnPropertyDescriptor($.prototype,"setClientRole"),$.prototype),Q($.prototype,"setProxyServer",[OX],Object.getOwnPropertyDescriptor($.prototype,"setProxyServer"),$.prototype),Q($.prototype,"setTurnServer",[NX],Object.getOwnPropertyDescriptor($.prototype,"setTurnServer"),$.prototype),Q($.prototype,"setLicense",[PX],Object.getOwnPropertyDescriptor($.prototype,"setLicense"),$.prototype),Q($.prototype,"startProxyServer",[MX],Object.getOwnPropertyDescriptor($.prototype,"startProxyServer"),$.prototype),Q($.prototype,"stopProxyServer",[xX],Object.getOwnPropertyDescriptor($.prototype,"stopProxyServer"),$.prototype),Q($.prototype,"setLocalAccessPointsV2",[kX],Object.getOwnPropertyDescriptor($.prototype,"setLocalAccessPointsV2"),$.prototype),Q($.prototype,"setLocalAccessPoints",[LX],Object.getOwnPropertyDescriptor($.prototype,"setLocalAccessPoints"),$.prototype),Q($.prototype,"setRemoteDefaultVideoStreamType",[FX],Object.getOwnPropertyDescriptor($.prototype,"setRemoteDefaultVideoStreamType"),$.prototype),Q($.prototype,"setRemoteVideoStreamType",[UX],Object.getOwnPropertyDescriptor($.prototype,"setRemoteVideoStreamType"),$.prototype),Q($.prototype,"setStreamFallbackOption",[VX],Object.getOwnPropertyDescriptor($.prototype,"setStreamFallbackOption"),$.prototype),Q($.prototype,"setEncryptionConfig",[BX],Object.getOwnPropertyDescriptor($.prototype,"setEncryptionConfig"),$.prototype),Q($.prototype,"renewToken",[jX],Object.getOwnPropertyDescriptor($.prototype,"renewToken"),$.prototype),Q($.prototype,"enableAudioVolumeIndicator",[HX],Object.getOwnPropertyDescriptor($.prototype,"enableAudioVolumeIndicator"),$.prototype),Q($.prototype,"startLiveStreaming",[GX],Object.getOwnPropertyDescriptor($.prototype,"startLiveStreaming"),$.prototype),Q($.prototype,"setLiveTranscoding",[WX],Object.getOwnPropertyDescriptor($.prototype,"setLiveTranscoding"),$.prototype),Q($.prototype,"stopLiveStreaming",[zX],Object.getOwnPropertyDescriptor($.prototype,"stopLiveStreaming"),$.prototype),Q($.prototype,"startChannelMediaRelay",[KX],Object.getOwnPropertyDescriptor($.prototype,"startChannelMediaRelay"),$.prototype),Q($.prototype,"updateChannelMediaRelay",[qX],Object.getOwnPropertyDescriptor($.prototype,"updateChannelMediaRelay"),$.prototype),Q($.prototype,"stopChannelMediaRelay",[YX],Object.getOwnPropertyDescriptor($.prototype,"stopChannelMediaRelay"),$.prototype),Q($.prototype,"sendCustomReportMessage",[$X],Object.getOwnPropertyDescriptor($.prototype,"sendCustomReportMessage"),$.prototype),Q($.prototype,"pickSVCLayer",[XX],Object.getOwnPropertyDescriptor($.prototype,"pickSVCLayer"),$.prototype),Q($.prototype,"setRTMConfig",[ZX],Object.getOwnPropertyDescriptor($.prototype,"setRTMConfig"),$.prototype),Q($.prototype,"enableContentInspect",[JX],Object.getOwnPropertyDescriptor($.prototype,"enableContentInspect"),$.prototype),Q($.prototype,"disableContentInspect",[QX],Object.getOwnPropertyDescriptor($.prototype,"disableContentInspect"),$.prototype),Q($.prototype,"setImageModeration",[eZ],Object.getOwnPropertyDescriptor($.prototype,"setImageModeration"),$.prototype),Q($.prototype,"setP2PTransport",[tZ],Object.getOwnPropertyDescriptor($.prototype,"setP2PTransport"),$.prototype),Q($.prototype,"getJoinChannelServiceRecords",[nZ],Object.getOwnPropertyDescriptor($.prototype,"getJoinChannelServiceRecords"),$.prototype),Q($.prototype,"setPublishAudioFilterEnabled",[iZ],Object.getOwnPropertyDescriptor($.prototype,"setPublishAudioFilterEnabled"),$.prototype),$);class o_{constructor(t,n){y(this,"id",0),y(this,"element",void 0),y(this,"peerPair",void 0),y(this,"context",void 0),y(this,"audioPlayerElement",void 0),y(this,"audioTrack",void 0),o_.count+=1,this.id=o_.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}switchSdp(){var t=this;return C(function*(){if(!t.peerPair)return;const n=function(){var r=C(function*(o,s){const a="offer"===s?yield o.createOffer():yield o.createAnswer();return yield o.setLocalDescription(a),"complete"===o.iceGatheringState?o.localDescription:new q(c=>{o.onicegatheringstatechange=()=>{"complete"===o.iceGatheringState&&c(o.localDescription)}})});return function(s,a){return r.apply(this,arguments)}}(),i=function(){var r=C(function*(o,s){return yield o.setRemoteDescription(s)});return function(s,a){return r.apply(this,arguments)}}();try{const r=yield n(t.peerPair[0],"offer");yield i(t.peerPair[1],r);const o=yield n(t.peerPair[1],"answer");yield i(t.peerPair[0],o)}catch(r){throw new N(S.LOCAL_AEC_ERROR,r.toString()).print()}})()}getTracksFromMediaElement(t){var n=this;return C(function*(){if(n.audioTrack)return n.audioTrack;let i;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),i=n.context.createMediaStreamDestination(),n.context.createMediaElementSource(t).connect(i)}catch(o){throw new N(S.LOCAL_AEC_ERROR,o.toString()).print()}if(!i)throw new N(S.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=i.stream.getAudioTracks()[0];return n.audioTrack=r,r})()}getElement(){return this.element}startEchoCancellation(){var t=this;return C(function*(){t.context.resume(),t.peerPair&&t.close(),t.initPeers();const n=t.element,i=yield t.getTracksFromMediaElement(n);t.peerPair&&t.peerPair[0].addTrack(i),yield t.switchSdp()})()}close(){_.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var oZ,hC;y(o_,"count",0);const PLe=window.AudioContext||window.webkitAudioContext,MLe=new(oZ=le({report:ne}),Q((hC=class{constructor(){y(this,"units",[]),y(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return _.debug("the system does not need to process local aec"),-1;this.context||(this.context=new PLe);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new o_(e,this.context),this.units.push(t)),t.startEchoCancellation(),_.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return xe().name!==Ye.SAFARI}}).prototype,"processExternalMediaAEC",[oZ],Object.getOwnPropertyDescriptor(hC.prototype,"processExternalMediaAEC"),hC.prototype),hC);function sZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function aZ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sZ(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sZ(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const OM=window||document;function cZ(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!OM)return;const n=En._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const i=r=>{if(!(r&&r.blockedURI&&(En.onSecurityPolicyViolation||En.getListeners(Ca.SECURITY_POLICY_VIOLATION).length>0)))return;const o=r.blockedURI;R("CSP_DETECTED_HOSTNAME_LIST").some(s=>Y(o).call(o,s))&&(En.onSecurityPolicyViolation&&"function"==typeof En.onSecurityPolicyViolation&&En.onSecurityPolicyViolation(r),En.getListeners(Ca.SECURITY_POLICY_VIOLATION).length>0&&En.safeEmit(Ca.SECURITY_POLICY_VIOLATION,r))};n&&OM.removeEventListener("securitypolicyviolation",n),(t||e&&"function"==typeof e||En.getListeners(Ca.SECURITY_POLICY_VIOLATION).length>0)&&OM.addEventListener("securitypolicyviolation",i),En._cspEventHandlerPointer=i}var xLe=Ki,kLe=i9,lZ=RegExp.prototype,Vi=Vt(function(e){return e===lZ||xLe(lZ,e)?kLe(e):e.flags});function Mp(e){let t=e.length;for(;--t>=0;)e[t]=0}const PM=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),pC=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),FLe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),uZ=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vc=new Array(576);Mp(vc);const c_=new Array(60);Mp(c_);const l_=new Array(512);Mp(l_);const d_=new Array(256);Mp(d_);const MM=new Array(29);Mp(MM);const fC=new Array(30);function xM(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}let hZ,pZ,fZ;function kM(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Mp(fC);const mZ=e=>e<256?l_[e]:l_[256+(e>>>7)],u_=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},co=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,u_(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},Pa=(e,t,n)=>{co(e,n[2*t],n[2*t+1])},gZ=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},_Z=(e,t,n)=>{const i=new Array(16);let r,o,s=0;for(r=1;r<=15;r++)s=s+n[r-1]<<1,i[r]=s;for(o=0;o<=t;o++){let a=e[2*o+1];0!==a&&(e[2*o]=gZ(i[a]++,a))}},vZ=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},EZ=e=>{e.bi_valid>8?u_(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},bZ=(e,t,n,i)=>{const r=2*t,o=2*n;return e[r]<e[o]||e[r]===e[o]&&i[t]<=i[n]},LM=(e,t,n)=>{const i=e.heap[n];let r=n<<1;for(;r<=e.heap_len&&(r<e.heap_len&&bZ(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!bZ(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i},yZ=(e,t,n)=>{let i,r,o,s,a=0;if(0!==e.sym_next)do{i=255&e.pending_buf[e.sym_buf+a++],i+=(255&e.pending_buf[e.sym_buf+a++])<<8,r=e.pending_buf[e.sym_buf+a++],0===i?Pa(e,r,t):(o=d_[r],Pa(e,o+256+1,t),s=PM[o],0!==s&&(r-=MM[o],co(e,r,s)),i--,o=mZ(i),Pa(e,o,n),s=pC[o],0!==s&&(i-=fC[o],co(e,i,s)))}while(a<e.sym_next);Pa(e,256,t)},FM=(e,t)=>{const n=t.dyn_tree,i=t.stat_desc.static_tree,r=t.stat_desc.has_stree,o=t.stat_desc.elems;let s,a,c,l=-1;for(e.heap_len=0,e.heap_max=573,s=0;s<o;s++)0!==n[2*s]?(e.heap[++e.heap_len]=l=s,e.depth[s]=0):n[2*s+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=l<2?++l:0,n[2*c]=1,e.depth[c]=0,e.opt_len--,r&&(e.static_len-=i[2*c+1]);for(t.max_code=l,s=e.heap_len>>1;s>=1;s--)LM(e,n,s);c=o;do{s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],LM(e,n,1),a=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=a,n[2*c]=n[2*s]+n[2*a],e.depth[c]=(e.depth[s]>=e.depth[a]?e.depth[s]:e.depth[a])+1,n[2*s+1]=n[2*a+1]=c,e.heap[1]=c++,LM(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((d,u)=>{const h=u.dyn_tree,p=u.max_code,m=u.stat_desc.static_tree,f=u.stat_desc.has_stree,g=u.stat_desc.extra_bits,E=u.stat_desc.extra_base,b=u.stat_desc.max_length;let T,I,D,O,k,L,V=0;for(O=0;O<=15;O++)d.bl_count[O]=0;for(h[2*d.heap[d.heap_max]+1]=0,T=d.heap_max+1;T<573;T++)I=d.heap[T],O=h[2*h[2*I+1]+1]+1,O>b&&(O=b,V++),h[2*I+1]=O,I>p||(d.bl_count[O]++,k=0,I>=E&&(k=g[I-E]),L=h[2*I],d.opt_len+=L*(O+k),f&&(d.static_len+=L*(m[2*I+1]+k)));if(0!==V){do{for(O=b-1;0===d.bl_count[O];)O--;d.bl_count[O]--,d.bl_count[O+1]+=2,d.bl_count[b]--,V-=2}while(V>0);for(O=b;0!==O;O--)for(I=d.bl_count[O];0!==I;)D=d.heap[--T],D>p||(h[2*D+1]!==O&&(d.opt_len+=(O-h[2*D+1])*h[2*D],h[2*D+1]=O),I--)}})(e,t),_Z(n,l,e.bl_count)},SZ=(e,t,n)=>{let i,r,o=-1,s=t[1],a=0,c=7,l=4;for(0===s&&(c=138,l=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=s,s=t[2*(i+1)+1],++a<c&&r===s||(a<l?e.bl_tree[2*r]+=a:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,o=r,0===s?(c=138,l=3):r===s?(c=6,l=3):(c=7,l=4))},CZ=(e,t,n)=>{let i,r,o=-1,s=t[1],a=0,c=7,l=4;for(0===s&&(c=138,l=3),i=0;i<=n;i++)if(r=s,s=t[2*(i+1)+1],!(++a<c&&r===s)){if(a<l)do{Pa(e,r,e.bl_tree)}while(0!=--a);else 0!==r?(r!==o&&(Pa(e,r,e.bl_tree),a--),Pa(e,16,e.bl_tree),co(e,a-3,2)):a<=10?(Pa(e,17,e.bl_tree),co(e,a-3,3)):(Pa(e,18,e.bl_tree),co(e,a-11,7));a=0,o=r,0===s?(c=138,l=3):r===s?(c=6,l=3):(c=7,l=4)}};let TZ=!1;const wZ=(e,t,n,i)=>{co(e,0+(i?1:0),3),EZ(e),u_(e,n),u_(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var HLe={_tr_init:e=>{TZ||((()=>{let t,n,i,r,o;const s=new Array(16);for(i=0,r=0;r<28;r++)for(MM[r]=i,t=0;t<1<<PM[r];t++)d_[i++]=r;for(d_[i-1]=r,o=0,r=0;r<16;r++)for(fC[r]=o,t=0;t<1<<pC[r];t++)l_[o++]=r;for(o>>=7;r<30;r++)for(fC[r]=o<<7,t=0;t<1<<pC[r]-7;t++)l_[256+o++]=r;for(n=0;n<=15;n++)s[n]=0;for(t=0;t<=143;)vc[2*t+1]=8,t++,s[8]++;for(;t<=255;)vc[2*t+1]=9,t++,s[9]++;for(;t<=279;)vc[2*t+1]=7,t++,s[7]++;for(;t<=287;)vc[2*t+1]=8,t++,s[8]++;for(_Z(vc,287,s),t=0;t<30;t++)c_[2*t+1]=5,c_[2*t]=gZ(t,5);hZ=new xM(vc,PM,257,286,15),pZ=new xM(c_,pC,0,30,15),fZ=new xM(new Array(0),FLe,0,19,7)})(),TZ=!0),e.l_desc=new kM(e.dyn_ltree,hZ),e.d_desc=new kM(e.dyn_dtree,pZ),e.bl_desc=new kM(e.bl_tree,fZ),e.bi_buf=0,e.bi_valid=0,vZ(e)},_tr_stored_block:wZ,_tr_flush_block:(e,t,n,i)=>{let r,o,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(a=>{let c,l=4093624447;for(c=0;c<=31;c++,l>>>=1)if(1&l&&0!==a.dyn_ltree[2*c])return 0;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return 1;for(c=32;c<256;c++)if(0!==a.dyn_ltree[2*c])return 1;return 0})(e)),FM(e,e.l_desc),FM(e,e.d_desc),s=(a=>{let c;for(SZ(a,a.dyn_ltree,a.l_desc.max_code),SZ(a,a.dyn_dtree,a.d_desc.max_code),FM(a,a.bl_desc),c=18;c>=3&&0===a.bl_tree[2*uZ[c]+1];c--);return a.opt_len+=3*(c+1)+5+5+4,c})(e),r=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=r&&(r=o)):r=o=n+5,n+4<=r&&-1!==t?wZ(e,t,n,i):4===e.strategy||o===r?(co(e,2+(i?1:0),3),yZ(e,vc,c_)):(co(e,4+(i?1:0),3),((a,c,l,d)=>{let u;for(co(a,c-257,5),co(a,l-1,5),co(a,d-4,4),u=0;u<d;u++)co(a,a.bl_tree[2*uZ[u]+1],3);CZ(a,a.dyn_ltree,c-1),CZ(a,a.dyn_dtree,l-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),yZ(e,e.dyn_ltree,e.dyn_dtree)),vZ(e),i&&EZ(e)},_tr_tally:(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(d_[n]+256+1)]++,e.dyn_dtree[2*mZ(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{co(e,2,3),Pa(e,256,vc),(t=>{16===t.bi_valid?(u_(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)}},h_=(e,t,n,i)=>{let r=65535&e,o=e>>>16&65535,s=0;for(;0!==n;){s=n>2e3?2e3:n,n-=s;do{r=r+t[i++]|0,o=o+r|0}while(--s);r%=65521,o%=65521}return r|o<<16};const GLe=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Qi=(e,t,n,i)=>{const r=GLe,o=i+n;e^=-1;for(let s=i;s<o;s++)e=e>>>8^r[255&(e^t[s])];return~e},jd={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},xp={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:WLe,_tr_stored_block:UM,_tr_flush_block:zLe,_tr_tally:Sl,_tr_align:KLe}=HLe,{Z_NO_FLUSH:Cl,Z_PARTIAL_FLUSH:qLe,Z_FULL_FLUSH:YLe,Z_FINISH:hs,Z_BLOCK:IZ,Z_OK:or,Z_STREAM_END:RZ,Z_STREAM_ERROR:Ma,Z_DATA_ERROR:$Le,Z_BUF_ERROR:VM,Z_DEFAULT_COMPRESSION:XLe,Z_FILTERED:ZLe,Z_HUFFMAN_ONLY:mC,Z_RLE:JLe,Z_FIXED:QLe,Z_DEFAULT_STRATEGY:e2e,Z_UNKNOWN:t2e,Z_DEFLATED:gC}=xp,xa=262,Wd=(e,t)=>(e.msg=jd[t],t),AZ=e=>2*e-(e>4?9:0),Tl=e=>{let t=e.length;for(;--t>=0;)e[t]=0},s2e=e=>{let t,n,i,r=e.w_size;t=e.hash_size,i=t;do{n=e.head[--i],e.head[i]=n>=r?n-r:0}while(--t);t=r,i=t;do{n=e.prev[--i],e.prev[i]=n>=r?n-r:0}while(--t)};let wl=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const Lo=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},Fo=(e,t)=>{zLe(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Lo(e.strm)},Xt=(e,t)=>{e.pending_buf[e.pending++]=t},f_=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},jM=(e,t,n,i)=>{let r=e.avail_in;return r>i&&(r=i),0===r?0:(e.avail_in-=r,t.set(e.input.subarray(e.next_in,e.next_in+r),n),1===e.state.wrap?e.adler=h_(e.adler,t,r,n):2===e.state.wrap&&(e.adler=Qi(e.adler,t,r,n)),e.next_in+=r,e.total_in+=r,r)},DZ=(e,t)=>{let n,i,r=e.max_chain_length,o=e.strstart,s=e.prev_length,a=e.nice_match;const c=e.strstart>e.w_size-xa?e.strstart-(e.w_size-xa):0,l=e.window,d=e.w_mask,u=e.prev,h=e.strstart+258;let p=l[o+s-1],m=l[o+s];e.prev_length>=e.good_match&&(r>>=2),a>e.lookahead&&(a=e.lookahead);do{if(n=t,l[n+s]===m&&l[n+s-1]===p&&l[n]===l[o]&&l[++n]===l[o+1]){o+=2,n++;do{}while(l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&l[++o]===l[++n]&&o<h);if(i=258-(h-o),o=h-258,i>s){if(e.match_start=t,s=i,i>=a)break;p=l[o+s-1],m=l[o+s]}}}while((t=u[t&d])>c&&0!=--r);return s<=e.lookahead?s:e.lookahead},Lp=e=>{const t=e.w_size;let n,i,r;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-xa)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),s2e(e),i+=t),0===e.strm.avail_in)break;if(n=jM(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=wl(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=wl(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<xa&&0!==e.strm.avail_in)},OZ=(e,t)=>{let n,i,r,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,a=e.strm.avail_in;do{if(n=65535,r=e.bi_valid+42>>3,e.strm.avail_out<r||(r=e.strm.avail_out-r,i=e.strstart-e.block_start,n>i+e.strm.avail_in&&(n=i+e.strm.avail_in),n>r&&(n=r),n<o&&(0===n&&t!==hs||t===Cl||n!==i+e.strm.avail_in)))break;s=t===hs&&n===i+e.strm.avail_in?1:0,UM(e,0,0,s),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,Lo(e.strm),i&&(i>n&&(i=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,n-=i),n&&(jM(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===s);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==Cl&&t!==hs&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(r=e.window_size-e.strstart,e.strm.avail_in>r&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,r+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),r>e.strm.avail_in&&(r=e.strm.avail_in),r&&(jM(e.strm,e.window,e.strstart,r),e.strstart+=r,e.insert+=r>e.w_size-e.insert?e.w_size-e.insert:r),e.high_water<e.strstart&&(e.high_water=e.strstart),r=e.bi_valid+42>>3,r=e.pending_buf_size-r>65535?65535:e.pending_buf_size-r,o=r>e.w_size?e.w_size:r,i=e.strstart-e.block_start,(i>=o||(i||t===hs)&&t!==Cl&&0===e.strm.avail_in&&i<=r)&&(n=i>r?r:i,s=t===hs&&0===e.strm.avail_in&&n===i?1:0,UM(e,e.block_start,n,s),e.block_start+=n,Lo(e.strm)),s?3:1)},HM=(e,t)=>{let n,i;for(;;){if(e.lookahead<xa){if(Lp(e),e.lookahead<xa&&t===Cl)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=wl(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-xa&&(e.match_length=DZ(e,n)),e.match_length>=3)if(i=Sl(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=wl(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=wl(e,e.ins_h,e.window[e.strstart+1]);else i=Sl(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Fo(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===hs?(Fo(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Fo(e,!1),0===e.strm.avail_out)?1:2},Fp=(e,t)=>{let n,i,r;for(;;){if(e.lookahead<xa){if(Lp(e),e.lookahead<xa&&t===Cl)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=wl(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-xa&&(e.match_length=DZ(e,n),e.match_length<=5&&(e.strategy===ZLe||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,i=Sl(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=wl(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(Fo(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(i=Sl(e,0,e.window[e.strstart-1]),i&&Fo(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=Sl(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===hs?(Fo(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Fo(e,!1),0===e.strm.avail_out)?1:2};function ka(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}const m_=[new ka(0,0,0,0,OZ),new ka(4,4,8,4,HM),new ka(4,5,16,8,HM),new ka(4,6,32,32,HM),new ka(4,4,16,16,Fp),new ka(8,16,32,32,Fp),new ka(8,16,128,128,Fp),new ka(8,32,128,256,Fp),new ka(32,128,258,1024,Fp),new ka(32,258,258,4096,Fp)];function a2e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=gC,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Tl(this.dyn_ltree),Tl(this.dyn_dtree),Tl(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Tl(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Tl(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const g_=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||42!==t.status&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&113!==t.status&&666!==t.status?1:0},NZ=e=>{if(g_(e))return Wd(e,Ma);e.total_in=e.total_out=0,e.data_type=t2e;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=-2,WLe(t),or},PZ=e=>{const t=NZ(e);return t===or&&((n=e.state).window_size=2*n.w_size,Tl(n.head),n.max_lazy_match=m_[n.level].max_lazy,n.good_match=m_[n.level].good_length,n.nice_match=m_[n.level].nice_length,n.max_chain_length=m_[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t;var n},MZ=(e,t,n,i,r,o)=>{if(!e)return Ma;let s=1;if(t===XLe&&(t=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),r<1||r>9||n!==gC||i<8||i>15||t<0||t>9||o<0||o>QLe||8===i&&1!==s)return Wd(e,Ma);8===i&&(i=9);const a=new a2e;return e.state=a,a.strm=e,a.status=42,a.wrap=s,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=r+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<r+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=o,a.method=n,PZ(e)};var __={deflateInit:(e,t)=>MZ(e,t,gC,15,8,e2e),deflateInit2:MZ,deflateReset:PZ,deflateResetKeep:NZ,deflateSetHeader:(e,t)=>g_(e)||2!==e.state.wrap?Ma:(e.state.gzhead=t,or),deflate:(e,t)=>{if(g_(e)||t>IZ||t<0)return e?Wd(e,Ma):Ma;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||666===n.status&&t!==hs)return Wd(e,0===e.avail_out?VM:Ma);const i=n.last_flush;if(n.last_flush=t,0!==n.pending){if(Lo(e),0===e.avail_out)return n.last_flush=-1,or}else if(0===e.avail_in&&AZ(t)<=AZ(i)&&t!==hs)return Wd(e,VM);if(666===n.status&&0!==e.avail_in)return Wd(e,VM);if(42===n.status&&0===n.wrap&&(n.status=113),42===n.status){let r=gC+(n.w_bits-8<<4)<<8,o=-1;if(o=n.strategy>=mC||n.level<2?0:n.level<6?1:6===n.level?2:3,r|=o<<6,0!==n.strstart&&(r|=32),r+=31-r%31,f_(n,r),0!==n.strstart&&(f_(n,e.adler>>>16),f_(n,65535&e.adler)),e.adler=1,n.status=113,Lo(e),0!==n.pending)return n.last_flush=-1,or}if(57===n.status)if(e.adler=0,Xt(n,31),Xt(n,139),Xt(n,8),n.gzhead)Xt(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Xt(n,255&n.gzhead.time),Xt(n,n.gzhead.time>>8&255),Xt(n,n.gzhead.time>>16&255),Xt(n,n.gzhead.time>>24&255),Xt(n,9===n.level?2:n.strategy>=mC||n.level<2?4:0),Xt(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Xt(n,255&n.gzhead.extra.length),Xt(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Qi(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Xt(n,0),Xt(n,0),Xt(n,0),Xt(n,0),Xt(n,0),Xt(n,9===n.level?2:n.strategy>=mC||n.level<2?4:0),Xt(n,3),n.status=113,Lo(e),0!==n.pending)return n.last_flush=-1,or;if(69===n.status){if(n.gzhead.extra){let r=n.pending,o=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+o>n.pending_buf_size;){let a=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>r&&(e.adler=Qi(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex+=a,Lo(e),0!==n.pending)return n.last_flush=-1,or;r=0,o-=a}let s=new Uint8Array(n.gzhead.extra);n.pending_buf.set(s.subarray(n.gzindex,n.gzindex+o),n.pending),n.pending+=o,n.gzhead.hcrc&&n.pending>r&&(e.adler=Qi(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let r,o=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>o&&(e.adler=Qi(e.adler,n.pending_buf,n.pending-o,o)),Lo(e),0!==n.pending)return n.last_flush=-1,or;o=0}r=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Xt(n,r)}while(0!==r);n.gzhead.hcrc&&n.pending>o&&(e.adler=Qi(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let r,o=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>o&&(e.adler=Qi(e.adler,n.pending_buf,n.pending-o,o)),Lo(e),0!==n.pending)return n.last_flush=-1,or;o=0}r=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Xt(n,r)}while(0!==r);n.gzhead.hcrc&&n.pending>o&&(e.adler=Qi(e.adler,n.pending_buf,n.pending-o,o))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Lo(e),0!==n.pending))return n.last_flush=-1,or;Xt(n,255&e.adler),Xt(n,e.adler>>8&255),e.adler=0}if(n.status=113,Lo(e),0!==n.pending)return n.last_flush=-1,or}if(0!==e.avail_in||0!==n.lookahead||t!==Cl&&666!==n.status){let r=0===n.level?OZ(n,t):n.strategy===mC?((o,s)=>{let a;for(;;){if(0===o.lookahead&&(Lp(o),0===o.lookahead)){if(s===Cl)return 1;break}if(o.match_length=0,a=Sl(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++,a&&(Fo(o,!1),0===o.strm.avail_out))return 1}return o.insert=0,s===hs?(Fo(o,!0),0===o.strm.avail_out?3:4):o.sym_next&&(Fo(o,!1),0===o.strm.avail_out)?1:2})(n,t):n.strategy===JLe?((o,s)=>{let a,c,l,d;const u=o.window;for(;;){if(o.lookahead<=258){if(Lp(o),o.lookahead<=258&&s===Cl)return 1;if(0===o.lookahead)break}if(o.match_length=0,o.lookahead>=3&&o.strstart>0&&(l=o.strstart-1,c=u[l],c===u[++l]&&c===u[++l]&&c===u[++l])){d=o.strstart+258;do{}while(c===u[++l]&&c===u[++l]&&c===u[++l]&&c===u[++l]&&c===u[++l]&&c===u[++l]&&c===u[++l]&&c===u[++l]&&l<d);o.match_length=258-(d-l),o.match_length>o.lookahead&&(o.match_length=o.lookahead)}if(o.match_length>=3?(a=Sl(o,1,o.match_length-3),o.lookahead-=o.match_length,o.strstart+=o.match_length,o.match_length=0):(a=Sl(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++),a&&(Fo(o,!1),0===o.strm.avail_out))return 1}return o.insert=0,s===hs?(Fo(o,!0),0===o.strm.avail_out?3:4):o.sym_next&&(Fo(o,!1),0===o.strm.avail_out)?1:2})(n,t):m_[n.level].func(n,t);if(3!==r&&4!==r||(n.status=666),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),or;if(2===r&&(t===qLe?KLe(n):t!==IZ&&(UM(n,0,0,!1),t===YLe&&(Tl(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),Lo(e),0===e.avail_out))return n.last_flush=-1,or}return t!==hs?or:n.wrap<=0?RZ:(2===n.wrap?(Xt(n,255&e.adler),Xt(n,e.adler>>8&255),Xt(n,e.adler>>16&255),Xt(n,e.adler>>24&255),Xt(n,255&e.total_in),Xt(n,e.total_in>>8&255),Xt(n,e.total_in>>16&255),Xt(n,e.total_in>>24&255)):(f_(n,e.adler>>>16),f_(n,65535&e.adler)),Lo(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?or:RZ)},deflateEnd:e=>{if(g_(e))return Ma;const t=e.state.status;return e.state=null,113===t?Wd(e,$Le):or},deflateSetDictionary:(e,t)=>{let n=t.length;if(g_(e))return Ma;const i=e.state,r=i.wrap;if(2===r||1===r&&42!==i.status||i.lookahead)return Ma;if(1===r&&(e.adler=h_(e.adler,t,n,0)),i.wrap=0,n>=i.w_size){0===r&&(Tl(i.head),i.strstart=0,i.block_start=0,i.insert=0);let c=new Uint8Array(i.w_size);c.set(t.subarray(n-i.w_size,n),0),t=c,n=i.w_size}const o=e.avail_in,s=e.next_in,a=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Lp(i);i.lookahead>=3;){let c=i.strstart,l=i.lookahead-2;do{i.ins_h=wl(i,i.ins_h,i.window[c+3-1]),i.prev[c&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=c,c++}while(--l);i.strstart=c,i.lookahead=2,Lp(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=s,e.input=a,e.avail_in=o,i.wrap=r,or},deflateInfo:"pako deflate (from Nodeca project)"};const d2e=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var _C={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const i in n)d2e(n,i)&&(e[i]=n[i])}}return e},flattenChunks:e=>{let t=0;for(let i=0,r=e.length;i<r;i++)t+=e[i].length;const n=new Uint8Array(t);for(let i=0,r=0,o=e.length;i<o;i++){let s=e[i];n.set(s,r),r+=s.length}return n}};let xZ=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{xZ=!1}const v_=new Uint8Array(256);for(let e=0;e<256;e++)v_[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;v_[254]=v_[254]=1;var E_={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,i,r,o,s=e.length,a=0;for(r=0;r<s;r++)n=e.charCodeAt(r),55296==(64512&n)&&r+1<s&&(i=e.charCodeAt(r+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),r++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(a),o=0,r=0;o<a;r++)n=e.charCodeAt(r),55296==(64512&n)&&r+1<s&&(i=e.charCodeAt(r+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,r;const o=new Array(2*n);for(r=0,i=0;i<n;){let s=e[i++];if(s<128){o[r++]=s;continue}let a=v_[s];if(a>4)o[r++]=65533,i+=a-1;else{for(s&=2===a?31:3===a?15:7;a>1&&i<n;)s=s<<6|63&e[i++],a--;a>1?o[r++]=65533:s<65536?o[r++]=s:(s-=65536,o[r++]=55296|s>>10&1023,o[r++]=56320|1023&s)}}return((s,a)=>{if(a<65534&&s.subarray&&xZ)return String.fromCharCode.apply(null,s.length===a?s:s.subarray(0,a));let c="";for(let l=0;l<a;l++)c+=String.fromCharCode(s[l]);return c})(o,r)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+v_[e[n]]>t?n:t}},kZ=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const LZ=Object.prototype.toString,{Z_NO_FLUSH:u2e,Z_SYNC_FLUSH:h2e,Z_FULL_FLUSH:p2e,Z_FINISH:f2e,Z_OK:vC,Z_STREAM_END:m2e,Z_DEFAULT_COMPRESSION:g2e,Z_DEFAULT_STRATEGY:_2e,Z_DEFLATED:v2e}=xp;function b_(e){this.options=_C.assign({level:g2e,method:v2e,chunkSize:16384,windowBits:15,memLevel:8,strategy:_2e},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kZ,this.strm.avail_out=0;let n=__.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==vC)throw new Error(jd[n]);if(t.header&&__.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(i="string"==typeof t.dictionary?E_.string2buf(t.dictionary):"[object ArrayBuffer]"===LZ.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=__.deflateSetDictionary(this.strm,i),n!==vC)throw new Error(jd[n]);this._dict_set=!0}}function GM(e,t){const n=new b_(t);if(n.push(e,!0),n.err)throw n.msg||jd[n.err];return n.result}b_.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize;let r,o;if(this.ended)return!1;for(o=t===~~t?t:!0===t?f2e:u2e,n.input="string"==typeof e?E_.string2buf(e):"[object ArrayBuffer]"===LZ.call(e)?new Uint8Array(e):e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(o===h2e||o===p2e)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(r=__.deflate(n,o),r===m2e)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=__.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===vC;if(0!==n.avail_out){if(o>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},b_.prototype.onData=function(e){this.chunks.push(e)},b_.prototype.onEnd=function(e){e===vC&&(this.result=_C.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var E2e={Deflate:b_,deflate:GM,deflateRaw:function(e,t){return(t=t||{}).raw=!0,GM(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,GM(e,t)},constants:xp};const EC=16209;var b2e=function(e,t){let n,i,r,o,s,a,c,l,d,u,h,p,m,f,g,E,b,T,I,D,O,k,L,V;const ee=e.state;n=e.next_in,L=e.input,i=n+(e.avail_in-5),r=e.next_out,V=e.output,o=r-(t-e.avail_out),s=r+(e.avail_out-257),a=ee.dmax,c=ee.wsize,l=ee.whave,d=ee.wnext,u=ee.window,h=ee.hold,p=ee.bits,m=ee.lencode,f=ee.distcode,g=(1<<ee.lenbits)-1,E=(1<<ee.distbits)-1;e:do{p<15&&(h+=L[n++]<<p,p+=8,h+=L[n++]<<p,p+=8),b=m[h&g];t:for(;;){if(T=b>>>24,h>>>=T,p-=T,T=b>>>16&255,0===T)V[r++]=65535&b;else{if(!(16&T)){if(!(64&T)){b=m[(65535&b)+(h&(1<<T)-1)];continue t}if(32&T){ee.mode=16191;break e}e.msg="invalid literal/length code",ee.mode=EC;break e}I=65535&b,T&=15,T&&(p<T&&(h+=L[n++]<<p,p+=8),I+=h&(1<<T)-1,h>>>=T,p-=T),p<15&&(h+=L[n++]<<p,p+=8,h+=L[n++]<<p,p+=8),b=f[h&E];n:for(;;){if(T=b>>>24,h>>>=T,p-=T,T=b>>>16&255,!(16&T)){if(!(64&T)){b=f[(65535&b)+(h&(1<<T)-1)];continue n}e.msg="invalid distance code",ee.mode=EC;break e}if(D=65535&b,T&=15,p<T&&(h+=L[n++]<<p,p+=8,p<T&&(h+=L[n++]<<p,p+=8)),D+=h&(1<<T)-1,D>a){e.msg="invalid distance too far back",ee.mode=EC;break e}if(h>>>=T,p-=T,T=r-o,D>T){if(T=D-T,T>l&&ee.sane){e.msg="invalid distance too far back",ee.mode=EC;break e}if(O=0,k=u,0===d){if(O+=c-T,T<I){I-=T;do{V[r++]=u[O++]}while(--T);O=r-D,k=V}}else if(d<T){if(O+=c+d-T,T-=d,T<I){I-=T;do{V[r++]=u[O++]}while(--T);if(O=0,d<I){T=d,I-=T;do{V[r++]=u[O++]}while(--T);O=r-D,k=V}}}else if(O+=d-T,T<I){I-=T;do{V[r++]=u[O++]}while(--T);O=r-D,k=V}for(;I>2;)V[r++]=k[O++],V[r++]=k[O++],V[r++]=k[O++],I-=3;I&&(V[r++]=k[O++],I>1&&(V[r++]=k[O++]))}else{O=r-D;do{V[r++]=V[O++],V[r++]=V[O++],V[r++]=V[O++],I-=3}while(I>2);I&&(V[r++]=V[O++],I>1&&(V[r++]=V[O++]))}break}}break}}while(n<i&&r<s);I=p>>3,n-=I,p-=I<<3,h&=(1<<p)-1,e.next_in=n,e.next_out=r,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=r<s?s-r+257:257-(r-s),ee.hold=h,ee.bits=p};const y2e=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),S2e=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),C2e=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),T2e=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var y_=(e,t,n,i,r,o,s,a)=>{const c=a.bits;let l,d,u,h,p,m,f=0,g=0,E=0,b=0,T=0,I=0,D=0,O=0,k=0,L=0,V=null;const ee=new Uint16Array(16),oe=new Uint16Array(16);let Ie,Ue,Dt,dt=null;for(f=0;f<=15;f++)ee[f]=0;for(g=0;g<i;g++)ee[t[n+g]]++;for(T=c,b=15;b>=1&&0===ee[b];b--);if(T>b&&(T=b),0===b)return r[o++]=20971520,r[o++]=20971520,a.bits=1,0;for(E=1;E<b&&0===ee[E];E++);for(T<E&&(T=E),O=1,f=1;f<=15;f++)if(O<<=1,O-=ee[f],O<0)return-1;if(O>0&&(0===e||1!==b))return-1;for(oe[1]=0,f=1;f<15;f++)oe[f+1]=oe[f]+ee[f];for(g=0;g<i;g++)0!==t[n+g]&&(s[oe[t[n+g]]++]=g);if(0===e?(V=dt=s,m=20):1===e?(V=y2e,dt=S2e,m=257):(V=C2e,dt=T2e,m=0),L=0,g=0,f=E,p=o,I=T,D=0,u=-1,k=1<<T,h=k-1,1===e&&k>852||2===e&&k>592)return 1;for(;;){Ie=f-D,s[g]+1<m?(Ue=0,Dt=s[g]):s[g]>=m?(Ue=dt[s[g]-m],Dt=V[s[g]-m]):(Ue=96,Dt=0),l=1<<f-D,d=1<<I,E=d;do{d-=l,r[p+(L>>D)+d]=Ie<<24|Ue<<16|Dt}while(0!==d);for(l=1<<f-1;L&l;)l>>=1;if(0!==l?(L&=l-1,L+=l):L=0,g++,0==--ee[f]){if(f===b)break;f=t[n+s[g]]}if(f>T&&(L&h)!==u){for(0===D&&(D=T),p+=E,I=f-D,O=1<<I;I+D<b&&(O-=ee[I+D],!(O<=0));)I++,O<<=1;if(k+=1<<I,1===e&&k>852||2===e&&k>592)return 1;u=L&h,r[u]=T<<24|I<<16|p-o}}return 0!==L&&(r[p+L]=f-D<<24|64<<16),a.bits=T,0};const{Z_FINISH:FZ,Z_BLOCK:w2e,Z_TREES:yC,Z_OK:zd,Z_STREAM_END:I2e,Z_NEED_DICT:R2e,Z_STREAM_ERROR:ps,Z_DATA_ERROR:UZ,Z_MEM_ERROR:VZ,Z_BUF_ERROR:A2e,Z_DEFLATED:BZ}=xp,SC=16180,CC=16190,Ec=16191,TC=16199,wC=16200,jn=16209,jZ=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function D2e(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Kd=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<SC||t.mode>16211?1:0},HZ=e=>{if(Kd(e))return ps;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=SC,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,zd},GZ=e=>{if(Kd(e))return ps;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,HZ(e)},WZ=(e,t)=>{let n;if(Kd(e))return ps;const i=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ps:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,GZ(e))},zZ=(e,t)=>{if(!e)return ps;const n=new D2e;e.state=n,n.strm=e,n.window=null,n.mode=SC;const i=WZ(e,t);return i!==zd&&(e.state=null),i};let qM,YM,KZ=!0;const O2e=e=>{if(KZ){qM=new Int32Array(512),YM=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(y_(1,e.lens,0,288,qM,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;y_(2,e.lens,0,32,YM,0,e.work,{bits:5}),KZ=!1}e.lencode=qM,e.lenbits=9,e.distcode=YM,e.distbits=5},qZ=(e,t,n,i)=>{let r;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(t.subarray(n-o.wsize,n),0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>i&&(r=i),o.window.set(t.subarray(n-i,n-i+r),o.wnext),(i-=r)?(o.window.set(t.subarray(n-i,n),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0};var bc={inflateReset:GZ,inflateReset2:WZ,inflateResetKeep:HZ,inflateInit:e=>zZ(e,15),inflateInit2:zZ,inflate:(e,t)=>{let n,i,r,o,s,a,c,l,d,u,h,p,m,f,g,E,b,T,I,D,O,k,L=0;const V=new Uint8Array(4);let ee,oe;const Ie=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Kd(e)||!e.output||!e.input&&0!==e.avail_in)return ps;n=e.state,n.mode===Ec&&(n.mode=16192),s=e.next_out,r=e.output,c=e.avail_out,o=e.next_in,i=e.input,a=e.avail_in,l=n.hold,d=n.bits,u=a,h=c,k=zd;e:for(;;)switch(n.mode){case SC:if(0===n.wrap){n.mode=16192;break}for(;d<16;){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}if(2&n.wrap&&35615===l){0===n.wbits&&(n.wbits=15),n.check=0,V[0]=255&l,V[1]=l>>>8&255,n.check=Qi(n.check,V,2,0),l=0,d=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",n.mode=jn;break}if((15&l)!==BZ){e.msg="unknown compression method",n.mode=jn;break}if(l>>>=4,d-=4,O=8+(15&l),0===n.wbits&&(n.wbits=O),O>15||O>n.wbits){e.msg="invalid window size",n.mode=jn;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&l?16189:Ec,l=0,d=0;break;case 16181:for(;d<16;){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}if(n.flags=l,(255&Vi(n))!==BZ){e.msg="unknown compression method",n.mode=jn;break}if(57344&Vi(n)){e.msg="unknown header flags set",n.mode=jn;break}n.head&&(n.head.text=l>>8&1),512&Vi(n)&&4&n.wrap&&(V[0]=255&l,V[1]=l>>>8&255,n.check=Qi(n.check,V,2,0)),l=0,d=0,n.mode=16182;case 16182:for(;d<32;){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}n.head&&(n.head.time=l),512&Vi(n)&&4&n.wrap&&(V[0]=255&l,V[1]=l>>>8&255,V[2]=l>>>16&255,V[3]=l>>>24&255,n.check=Qi(n.check,V,4,0)),l=0,d=0,n.mode=16183;case 16183:for(;d<16;){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&Vi(n)&&4&n.wrap&&(V[0]=255&l,V[1]=l>>>8&255,n.check=Qi(n.check,V,2,0)),l=0,d=0,n.mode=16184;case 16184:if(1024&Vi(n)){for(;d<16;){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}n.length=l,n.head&&(n.head.extra_len=l),512&Vi(n)&&4&n.wrap&&(V[0]=255&l,V[1]=l>>>8&255,n.check=Qi(n.check,V,2,0)),l=0,d=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&Vi(n)&&(p=n.length,p>a&&(p=a),p&&(n.head&&(O=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(o,o+p),O)),512&Vi(n)&&4&n.wrap&&(n.check=Qi(n.check,i,p,o)),a-=p,o+=p,n.length-=p),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&Vi(n)){if(0===a)break e;p=0;do{O=i[o+p++],n.head&&O&&n.length<65536&&(n.head.name+=String.fromCharCode(O))}while(O&&p<a);if(512&Vi(n)&&4&n.wrap&&(n.check=Qi(n.check,i,p,o)),a-=p,o+=p,O)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&Vi(n)){if(0===a)break e;p=0;do{O=i[o+p++],n.head&&O&&n.length<65536&&(n.head.comment+=String.fromCharCode(O))}while(O&&p<a);if(512&Vi(n)&&4&n.wrap&&(n.check=Qi(n.check,i,p,o)),a-=p,o+=p,O)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&Vi(n)){for(;d<16;){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}if(4&n.wrap&&l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=jn;break}l=0,d=0}n.head&&(n.head.hcrc=Vi(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Ec;break;case 16189:for(;d<32;){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}e.adler=n.check=jZ(l),l=0,d=0,n.mode=CC;case CC:if(0===n.havedict)return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=l,n.bits=d,R2e;e.adler=n.check=1,n.mode=Ec;case Ec:if(t===w2e||t===yC)break e;case 16192:if(n.last){l>>>=7&d,d-=7&d,n.mode=16206;break}for(;d<3;){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}switch(n.last=1&l,l>>>=1,d-=1,3&l){case 0:n.mode=16193;break;case 1:if(O2e(n),n.mode=TC,t===yC){l>>>=2,d-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=jn}l>>>=2,d-=2;break;case 16193:for(l>>>=7&d,d-=7&d;d<32;){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=jn;break}if(n.length=65535&l,l=0,d=0,n.mode=16194,t===yC)break e;case 16194:n.mode=16195;case 16195:if(p=n.length,p){if(p>a&&(p=a),p>c&&(p=c),0===p)break e;r.set(i.subarray(o,o+p),s),a-=p,o+=p,c-=p,s+=p,n.length-=p;break}n.mode=Ec;break;case 16196:for(;d<14;){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}if(n.nlen=257+(31&l),l>>>=5,d-=5,n.ndist=1+(31&l),l>>>=5,d-=5,n.ncode=4+(15&l),l>>>=4,d-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=jn;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;d<3;){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}n.lens[Ie[n.have++]]=7&l,l>>>=3,d-=3}for(;n.have<19;)n.lens[Ie[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,ee={bits:n.lenbits},k=y_(0,n.lens,0,19,n.lencode,0,n.work,ee),n.lenbits=ee.bits,k){e.msg="invalid code lengths set",n.mode=jn;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;L=n.lencode[l&(1<<n.lenbits)-1],g=L>>>24,E=L>>>16&255,b=65535&L,!(g<=d);){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}if(b<16)l>>>=g,d-=g,n.lens[n.have++]=b;else{if(16===b){for(oe=g+2;d<oe;){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}if(l>>>=g,d-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=jn;break}O=n.lens[n.have-1],p=3+(3&l),l>>>=2,d-=2}else if(17===b){for(oe=g+3;d<oe;){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}l>>>=g,d-=g,O=0,p=3+(7&l),l>>>=3,d-=3}else{for(oe=g+7;d<oe;){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}l>>>=g,d-=g,O=0,p=11+(127&l),l>>>=7,d-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=jn;break}for(;p--;)n.lens[n.have++]=O}}if(n.mode===jn)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=jn;break}if(n.lenbits=9,ee={bits:n.lenbits},k=y_(1,n.lens,0,n.nlen,n.lencode,0,n.work,ee),n.lenbits=ee.bits,k){e.msg="invalid literal/lengths set",n.mode=jn;break}if(n.distbits=6,n.distcode=n.distdyn,ee={bits:n.distbits},k=y_(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,ee),n.distbits=ee.bits,k){e.msg="invalid distances set",n.mode=jn;break}if(n.mode=TC,t===yC)break e;case TC:n.mode=wC;case wC:if(a>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=l,n.bits=d,b2e(e,h),s=e.next_out,r=e.output,c=e.avail_out,o=e.next_in,i=e.input,a=e.avail_in,l=n.hold,d=n.bits,n.mode===Ec&&(n.back=-1);break}for(n.back=0;L=n.lencode[l&(1<<n.lenbits)-1],g=L>>>24,E=L>>>16&255,b=65535&L,!(g<=d);){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}if(E&&!(240&E)){for(T=g,I=E,D=b;L=n.lencode[D+((l&(1<<T+I)-1)>>T)],g=L>>>24,E=L>>>16&255,b=65535&L,!(T+g<=d);){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}l>>>=T,d-=T,n.back+=T}if(l>>>=g,d-=g,n.back+=g,n.length=b,0===E){n.mode=16205;break}if(32&E){n.back=-1,n.mode=Ec;break}if(64&E){e.msg="invalid literal/length code",n.mode=jn;break}n.extra=15&E,n.mode=16201;case 16201:if(n.extra){for(oe=n.extra;d<oe;){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;L=n.distcode[l&(1<<n.distbits)-1],g=L>>>24,E=L>>>16&255,b=65535&L,!(g<=d);){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}if(!(240&E)){for(T=g,I=E,D=b;L=n.distcode[D+((l&(1<<T+I)-1)>>T)],g=L>>>24,E=L>>>16&255,b=65535&L,!(T+g<=d);){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}l>>>=T,d-=T,n.back+=T}if(l>>>=g,d-=g,n.back+=g,64&E){e.msg="invalid distance code",n.mode=jn;break}n.offset=b,n.extra=15&E,n.mode=16203;case 16203:if(n.extra){for(oe=n.extra;d<oe;){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=jn;break}n.mode=16204;case 16204:if(0===c)break e;if(p=h-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=jn;break}p>n.wnext?(p-=n.wnext,m=n.wsize-p):m=n.wnext-p,p>n.length&&(p=n.length),f=n.window}else f=r,m=s-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do{r[s++]=f[m++]}while(--p);0===n.length&&(n.mode=wC);break;case 16205:if(0===c)break e;r[s++]=n.length,c--,n.mode=wC;break;case 16206:if(n.wrap){for(;d<32;){if(0===a)break e;a--,l|=i[o++]<<d,d+=8}if(h-=c,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=Vi(n)?Qi(n.check,r,h,s-h):h_(n.check,r,h,s-h)),h=c,4&n.wrap&&(Vi(n)?l:jZ(l))!==n.check){e.msg="incorrect data check",n.mode=jn;break}l=0,d=0}n.mode=16207;case 16207:if(n.wrap&&Vi(n)){for(;d<32;){if(0===a)break e;a--,l+=i[o++]<<d,d+=8}if(4&n.wrap&&l!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=jn;break}l=0,d=0}n.mode=16208;case 16208:k=I2e;break e;case jn:k=UZ;break e;case 16210:return VZ;default:return ps}return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=l,n.bits=d,(n.wsize||h!==e.avail_out&&n.mode<jn&&(n.mode<16206||t!==FZ))&&qZ(e,e.output,e.next_out,h-e.avail_out),u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=Vi(n)?Qi(n.check,r,h,e.next_out-h):h_(n.check,r,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Ec?128:0)+(n.mode===TC||16194===n.mode?256:0),(0===u&&0===h||t===FZ)&&k===zd&&(k=A2e),k},inflateEnd:e=>{if(Kd(e))return ps;let t=e.state;return t.window&&(t.window=null),e.state=null,zd},inflateGetHeader:(e,t)=>{if(Kd(e))return ps;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,zd):ps},inflateSetDictionary:(e,t)=>{const n=t.length;let i,r,o;return Kd(e)?ps:(i=e.state,0!==i.wrap&&i.mode!==CC?ps:i.mode===CC&&(r=1,r=h_(r,t,n,0),r!==i.check)?UZ:(o=qZ(e,t,n,n),o?(i.mode=16210,VZ):(i.havedict=1,zd)))},inflateInfo:"pako inflate (from Nodeca project)"},P2e=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const YZ=Object.prototype.toString,{Z_NO_FLUSH:M2e,Z_FINISH:x2e,Z_OK:S_,Z_STREAM_END:$M,Z_NEED_DICT:XM,Z_STREAM_ERROR:k2e,Z_DATA_ERROR:$Z,Z_MEM_ERROR:L2e}=xp;function C_(e){this.options=_C.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kZ,this.strm.avail_out=0;let n=bc.inflateInit2(this.strm,t.windowBits);if(n!==S_)throw new Error(jd[n]);if(this.header=new P2e,bc.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=E_.string2buf(t.dictionary):"[object ArrayBuffer]"===YZ.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=bc.inflateSetDictionary(this.strm,t.dictionary),n!==S_)))throw new Error(jd[n])}function ZM(e,t){const n=new C_(t);if(n.push(e),n.err)throw n.msg||jd[n.err];return n.result}C_.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let o,s,a;if(this.ended)return!1;for(s=t===~~t?t:!0===t?x2e:M2e,n.input="[object ArrayBuffer]"===YZ.call(e)?new Uint8Array(e):e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),o=bc.inflate(n,s),o===XM&&r&&(o=bc.inflateSetDictionary(n,r),o===S_?o=bc.inflate(n,s):o===$Z&&(o=XM));n.avail_in>0&&o===$M&&n.state.wrap>0&&0!==e[n.next_in];)bc.inflateReset(n),o=bc.inflate(n,s);switch(o){case k2e:case $Z:case XM:case L2e:return this.onEnd(o),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||o===$M))if("string"===this.options.to){let c=E_.utf8border(n.output,n.next_out),l=n.next_out-c,d=E_.buf2string(n.output,c);n.next_out=l,n.avail_out=i-l,l&&n.output.set(n.output.subarray(c,c+l),0),this.onData(d)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(o!==S_||0!==a){if(o===$M)return o=bc.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},C_.prototype.onData=function(e){this.chunks.push(e)},C_.prototype.onEnd=function(e){e===S_&&(this.result="string"===this.options.to?this.chunks.join(""):_C.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var F2e={Inflate:C_,inflate:ZM,inflateRaw:function(e,t){return(t=t||{}).raw=!0,ZM(e,t)},ungzip:ZM,constants:xp};const{deflate:U2e}=E2e,{inflate:V2e}=F2e;var B2e=U2e,j2e=V2e,XZ=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(XZ||{});class H2e{constructor(){y(this,"_sequence",0),y(this,"_startTime",Date.now()),y(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const a=new Uint8Array(4);a.set([1,0,0,0]);const l={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[{id:0,length:4,data:a.buffer}]};n.commonPacketHeader.extension=1,n.extension=l,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;R("SHOW_DATASTREAM2_LOG")&&_.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),r=new Uint8Array(i),o=new DataView(i);let s=0;if(o.setUint16(s,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),s+=2,o.setUint32(s,n.commonPacketHeader.sequence,!0),s+=4,o.setUint16(s,n.commonStreamHeader,!0),s+=2,n.extension){const a=this.serializeExtension(n.extension);r.set(new Uint8Array(a),s),s+=a.byteLength}if(r.set(new Uint8Array(n.payload),s),s+=n.payload.byteLength,s!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let i=0;const r=n.getUint16(i,!0);i+=2;const o={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let s,a;if(i+=4,R("SHOW_DATASTREAM2_LOG")&&_.debug("receive data header: ".concat(JSON.stringify(o))),n.getUint16(i,!0),i+=2,o.extension){a=this.deserializeExtension(t.slice(i)),i+=2+a.length,s=t.slice(i);let c=!1;if(a.datas.length>0){const l=a.datas.find(d=>0===d.id);l&&(c=!(1&~new DataView(l.data).getUint32(0,!0)))}s=c?this.decompress(s):s}else s=t.slice(8);return s}serializeExtension(t){const{profile:n,length:i,datas:r}=t,o=new ArrayBuffer(i+2),s=new Uint8Array(o),a=new DataView(o);let c=0;if(a.setUint8(c++,n),a.setUint8(c++,i),r.forEach(l=>{n?(a.setUint8(c++,l.id),a.setUint8(c++,l.length),s.set(new Uint8Array(l.data),c),c+=l.data.byteLength):(a.setUint8(c++,l.id|l.length<<4),s.set(new Uint8Array(l.data),c),c+=l.data.byteLength)}),c!==i+2)throw Error("serialize extension error, is ".concat(c,"!==").concat(i+2));return o}deserializeExtension(t){const n=new DataView(t);let i=0;const r=n.getUint8(i);i++;const o=n.getUint8(i);i++;const s=r===XZ.TWO_BYTE,a=[],c=new DataView(t,2);let l=0;for(;l<o;){let d=0,u=0,h=new ArrayBuffer(0);s?(d=c.getUint8(l),l++,u=c.getUint8(l),l++):(d=15&c.getUint8(l),u=c.getUint8(l)>>4,l++),u>0&&(h=c.buffer.slice(l+2,l+2+u),l+=h.byteLength),a.push({id:d,length:u,data:h})}if(l!==o)throw Error("parse error");return{profile:r,length:o,datas:a}}decompress(t){return j2e(new Uint8Array(t))}compress(t){return B2e(new Uint8Array(t))}}const G2e={name:"DataStream",create:(e,t)=>{const n=t?new kke(e):new Lke(e);return n.useDataStream(new H2e),n}};class W2e extends kt{constructor(t,n,i){super(),y(this,"ws",void 0),y(this,"requestId",1),y(this,"heartBeatTimer",void 0),y(this,"joinInfo",void 0),y(this,"clientId",void 0),y(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),y(this,"onClose",r=>{this.emit("close"),this.dispose()}),y(this,"onMessage",r=>{const o=JSON.parse(r.data);if(!o||"serverResponse"!==o.command||!o.requestId)return o&&"serverStatus"===o.command&&o.serverStatus&&o.serverStatus.command?(this.emit("status",o.serverStatus),void this.emit(o.serverStatus.command,o.serverStatus)):void 0;this.emit("req_".concat(o.requestId),o)}),this.joinInfo=t,this.clientId=n,this.ws=new Ug("cross-channel-".concat(this.clientId),i),this.ws.on(fe.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(fe.CONNECTED,this.onOpen),this.ws.on(fe.ON_MESSAGE,this.onMessage),this.ws.on(fe.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new q((n,i)=>{const r=window.setTimeout(()=>{i(new N(S.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,o=>{window.clearTimeout(r),o.state&&0!==o.state?i(new N(S.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),i(new N(S.WS_ABORT))})})}request(t){var n=this;return C(function*(){if("closed"===n.ws.state)throw new N(S.WS_DISCONNECT);"connected"!==n.ws.state&&(yield new q((a,c)=>{n.ws.once(fe.CLOSED,()=>c(new N(S.WS_ABORT))),n.ws.once(fe.CONNECTED,a)}));const r=n.sendMessage(t),o=new q((a,c)=>{const l=()=>{c(new N(S.WS_ABORT))};n.ws.once(fe.RECONNECTING,l),n.ws.once(fe.CLOSED,l),n.once("req_".concat(r),a),qn(3e3).then(()=>{n.removeAllListeners("req_".concat(r)),n.ws.off(fe.RECONNECTING,l),n.ws.off(fe.CLOSED,l),c(new N(S.TIMEOUT,"cross channel ws request timeout"))})}),s=yield o;if(!s||200!==s.code)throw new N(S.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s})()}connect(t){var n=this;return C(function*(){n.ws.removeAllListeners(fe.REQUEST_NEW_URLS),n.ws.on(fe.REQUEST_NEW_URLS,i=>{i(t)}),yield n.ws.init(t)})()}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class z2e extends kt{set state(t){t!==this._state&&(t!==vr.RELAY_STATE_FAILURE&&(this.errorCode=ip.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,i,r,o){var s;super(),s=this,y(this,"joinInfo",void 0),y(this,"sid",void 0),y(this,"clientId",void 0),y(this,"cancelToken",nr.CancelToken.source()),y(this,"workerToken",void 0),y(this,"requestId",0),y(this,"signal",void 0),y(this,"prevChannelMediaConfig",void 0),y(this,"httpRetryConfig",void 0),y(this,"_resolution",void 0),y(this,"_state",vr.RELAY_STATE_IDLE),y(this,"errorCode",ip.RELAY_OK),y(this,"onStatus",a=>{_.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(a))),a&&a.command&&("onAudioPacketReceived"===a.command&&this.emit("event",lc.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===a.command&&this.emit("event",lc.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===a.command&&(this.errorCode=ip.SRC_TOKEN_EXPIRED,this.state=vr.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===a.command&&(this.errorCode=ip.DEST_TOKEN_EXPIRED,this.state=vr.RELAY_STATE_FAILURE))}),y(this,"onReconnect",C(function*(){_.debug("[".concat(s.clientId,"] ChannelMediaSocket disconnect, reconnecting")),s.emit("event",lc.NETWORK_DISCONNECTED),s.state=vr.RELAY_STATE_IDLE,s.prevChannelMediaConfig&&s.sendStartRelayMessage(s.prevChannelMediaConfig).catch(a=>{s.state!==vr.RELAY_STATE_IDLE&&(_.error("auto restart channel media relay failed",a.toString()),s.errorCode=ip.SERVER_CONNECTION_LOST,s.state=vr.RELAY_STATE_FAILURE)})})),this.joinInfo=t,this.clientId=n,this.sid=ep(),this.signal=new W2e(this.joinInfo,this.clientId,i),this.httpRetryConfig=r,this._resolution=o}startChannelMediaRelay(t){var n=this;return C(function*(){if(n.state!==vr.RELAY_STATE_IDLE)throw new N(S.INVALID_OPERATION);n.state=vr.RELAY_STATE_CONNECTING,yield n.connect(),_.debug("[".concat(n.clientId,"] startChannelMediaRelay: connect success"));try{yield n.sendStartRelayMessage(t)}catch(i){throw i.data&&i.data.serverResponse&&"SetSourceChannel"===i.data.serverResponse.command?new N(S.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&"SetDestChannelStatus"===i.serverResponse.command?new N(S.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&"StartPacketTransfer"===i.serverResponse.command?new N(S.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}n.prevChannelMediaConfig=t})()}updateChannelMediaRelay(t){var n=this;return C(function*(){if(n.state!==vr.RELAY_STATE_RUNNING)throw new N(S.INVALID_OPERATION);yield n.sendUpdateMessage(t),n.prevChannelMediaConfig=t})()}setVideoProfile(t){var n=this;return C(function*(){if(n._resolution=t,n.state!==vr.RELAY_STATE_RUNNING)throw new N(S.INVALID_OPERATION);const i=n.genMessage(Zi.SetVideoProfile);yield n.signal.request(i),_.debug("[".concat(n.clientId,"] startChannelMediaRelay: setVideoProfile success"))})()}stopChannelMediaRelay(){var t=this;return C(function*(){yield t.sendStopRelayMessage(),_.debug("[".concat(t.clientId,"] stopChannelMediaRelay: send stop message success")),t.state=vr.RELAY_STATE_IDLE,t.dispose()})()}dispose(){_.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=nr.CancelToken.source(),this.state=vr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}connect(){var t=this;return C(function*(){const n=yield function qke(e,t,n){return aM.apply(this,arguments)}(t.joinInfo,t.cancelToken.token,t.httpRetryConfig);t.workerToken=n.workerToken,yield t.signal.connect(n.addressList),t.emit("event",lc.NETWORK_CONNECTED),t.signal.on("status",t.onStatus),t.signal.on("reconnecting",t.onReconnect)})()}sendStartRelayMessage(t){var n=this;return C(function*(){const i=n.genMessage(Zi.StopPacketTransfer);yield n.signal.request(i),yield n.signal.waitStatus("Normal Quit"),_.debug("[".concat(n.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r=n.genMessage(Zi.SetSdkProfile,t);yield n.signal.request(r),_.debug("[".concat(n.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const o=n.genMessage(Zi.SetSourceChannel,t);yield n.signal.request(o),yield n.signal.waitStatus("SetSourceChannelStatus"),n.emit("event",lc.PACKET_JOINED_SRC_CHANNEL),_.debug("[".concat(n.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=n.genMessage(Zi.SetSourceUserId,t);yield n.signal.request(s),_.debug("[".concat(n.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const a=n.genMessage(Zi.SetDestChannel,t);yield n.signal.request(a),yield n.signal.waitStatus("SetDestChannelStatus"),n.emit("event",lc.PACKET_JOINED_DEST_CHANNEL),_.debug("[".concat(n.clientId,"] startChannelMediaRelay: SetDestChannel success"));const c=n.genMessage(Zi.StartPacketTransfer,t);yield n.signal.request(c),n.emit("event",lc.PACKET_SENT_TO_DEST_CHANNEL),n.state=vr.RELAY_STATE_RUNNING,_.debug("[".concat(n.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),n.setVideoProfile(n._resolution)})()}sendUpdateMessage(t){var n=this;return C(function*(){const i=n.genMessage(Zi.UpdateDestChannel,t);yield n.signal.request(i),n.emit("event",lc.PACKET_UPDATE_DEST_CHANNEL),_.debug("[".concat(n.clientId,"] sendUpdateMessage: UpdateDestChannel success"))})()}sendStopRelayMessage(){var t=this;return C(function*(){const n=t.genMessage(Zi.StopPacketTransfer);yield t.signal.request(n),_.debug("[".concat(t.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))})()}genMessage(t,n){const i=[],r=[],o=[];this.requestId+=1;const s={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Oo,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.22.1"===s.sdkVersion&&(s.sdkVersion="0.0.1");let a=null,c=null;switch(t){case Zi.SetSdkProfile:return s.clientRequest={command:"SetSdkProfile",type:"multi_channel"},s;case Zi.SetSourceChannel:if(c=n&&n.getSrcChannelMediaInfo(),!c)throw new N(S.UNEXPECTED_ERROR,"can not find source config");return s.clientRequest={command:"SetSourceChannel",uid:"0",channelName:c.channelName,token:c.token||this.joinInfo.appId},s;case Zi.SetSourceUserId:if(c=n&&n.getSrcChannelMediaInfo(),!c)throw new N(S.UNEXPECTED_ERROR,"can not find source config");return s.clientRequest={command:"SetSourceUserId",uid:c.uid+""},s;case Zi.SetDestChannel:if(a=n&&n.getDestChannelMediaInfo(),!a)throw new N(S.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(l=>{i.push(l.channelName),r.push(l.uid+""),o.push(l.token||this.joinInfo.appId)}),s.clientRequest={command:"SetDestChannel",channelName:i,uid:r,token:o},s;case Zi.StartPacketTransfer:return s.clientRequest={command:"StartPacketTransfer"},s;case Zi.Reconnect:return s.clientRequest={command:"Reconnect"},s;case Zi.StopPacketTransfer:return s.clientRequest={command:"StopPacketTransfer"},s;case Zi.UpdateDestChannel:if(a=n&&n.getDestChannelMediaInfo(),!a)throw new N(S.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(l=>{i.push(l.channelName),r.push(l.uid+""),o.push(l.token||this.joinInfo.appId)}),s.clientRequest={command:"UpdateDestChannel",channelName:i,uid:r,token:o},s;case Zi.SetVideoProfile:s.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return s}}const K2e={name:"ChannelMediaRelay",create:function(e){return new z2e(e.joinInfo,e.clientId,e.websocketRetryConfig||vn,e.httpRetryConfig||vn,e.resolution)}};function ZZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function T_(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ZZ(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZZ(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class q2e extends kt{constructor(t,n,i,r){super(),y(this,"spec",void 0),y(this,"token",void 0),y(this,"websocket",void 0),y(this,"pingpongTimer",void 0),y(this,"reconnectMode","retry"),y(this,"serviceMode",void 0),y(this,"reqId",0),y(this,"commandReqId",0),y(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),y(this,"handleWebSocketMessage",o=>{if(!o.data)return;const s=JSON.parse(o.data);s.requestId?this.emit("@".concat(s.requestId,"-").concat(s.sid),s):(ne.workerEvent(this.spec.sid,{actionType:"status",serverCode:s.code,workerType:this.serviceMode===Sa.TRANSCODE?1:2}),this.emit(dl.PUBLISH_STREAM_STATUS,s))}),this.spec=n,this.token=t,this.serviceMode=r,this.websocket=new Ug("live-streaming",i),this.websocket.on(fe.CONNECTED,this.handleWebSocketOpen),this.websocket.on(fe.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(fe.REQUEST_NEW_URLS,(o,s)=>{ii(this,dl.REQUEST_NEW_ADDRESS).then(o).catch(s)}),this.websocket.on(fe.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}request(t,n,i,r){var o=this;return C(function*(){o.reqId+=1,"request"===t&&(o.commandReqId+=1);const s=o.commandReqId,a=o.reqId;if(!a||!o.websocket)throw new N(S.UNEXPECTED_ERROR);const c=T_({command:t,sdkVersion:"4.22.1"===Oo?"0.0.1":Oo,seq:a,requestId:a,allocate:i,cname:o.spec.cname,appId:o.spec.appId,sid:o.spec.sid,uid:o.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if("closed"===o.websocket.state)throw new N(S.WS_DISCONNECT);const l=()=>new q((p,m)=>{o.websocket.once(fe.CLOSED,()=>m(new N(S.WS_ABORT))),o.websocket.once(fe.CONNECTED,p)});"connected"!==o.websocket.state&&(yield l()),c.clientRequest&&(c.clientRequest.workerToken=o.token);const d=new q((p,m)=>{const f=()=>{m(new N(S.WS_ABORT))};o.websocket.once(fe.RECONNECTING,f),o.websocket.once(fe.CLOSED,f),o.once("@".concat(a,"-").concat(o.spec.sid),g=>{p(g)})});r&&ne.workerEvent(o.spec.sid,T_(T_({},r),{},{requestId:s,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const u=Date.now();o.websocket.sendMessage(c);let h=null;try{h=yield d}catch(p){if("closed"===o.websocket.state)throw p;return yield l(),yield o.request(t,n,i)}return r&&ne.workerEvent(o.spec.sid,T_(T_({},r),{},{requestId:s,actionType:"response",payload:JSON.stringify(h.serverResponse),serverCode:h.code,success:200===h.code,responseTime:Date.now()-u})),200!==h.code&&o.handleResponseError(h),h})()}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t="4.22.1"===Oo?"0.0.1":Oo;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Tn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void _.warning("live stream response already exists stream");case Tn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Tn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Tn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new N(S.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Tn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===t.serverResponse.command)return;throw new N(S.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Tn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new N(S.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Tn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new N(S.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(dl.WARNING,n,t.serverResponse.url)}case Tn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new N(S.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(dl.WARNING,n,t.serverResponse.url)}case Tn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new N(S.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Tn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new N(S.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Tn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new N(S.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(dl.WARNING,n,t.serverResponse.url)}case Tn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new N(S.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Tn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new N(S.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Tn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Tn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===t.serverResponse.command)return;throw new N(S.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Tn.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===t.serverResponse.command)return;if("UpdateTranscoding"===t.serverResponse.command||"ControlStream"===t.serverResponse.command)return new N(S.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new N(S.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Tn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Tn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Tn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Tn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new N(S.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(gS)},6e3)}}function JZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Er(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?JZ(Object(n),!0).forEach(function(i){y(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JZ(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Y2e extends kt{constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:vn,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:vn;super(),y(this,"onLiveStreamWarning",void 0),y(this,"onLiveStreamError",void 0),y(this,"spec",void 0),y(this,"retryTimeout",1e4),y(this,"connection",void 0),y(this,"httpRetryConfig",void 0),y(this,"wsRetryConfig",void 0),y(this,"streamingTasks",new Map),y(this,"isStartingStreamingTask",!1),y(this,"taskMutex",new gi("live-streaming")),y(this,"cancelToken",nr.CancelToken.source()),y(this,"transcodingConfig",void 0),y(this,"uapResponse",void 0),y(this,"lastTaskId",1),y(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=n}setTranscodingConfig(t){var n=this;return C(function*(){const i=Er(Er({},Q1e),t);var a;66!==i.videoCodecProfile&&77!==i.videoCodecProfile&&100!==i.videoCodecProfile&&(_.debug("[".concat(n.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(a=>Er(Er(Er({},J1e),a),{},{zOrder:a.zOrder?a.zOrder+1:1}))),xt((a=i).width)||ot(a.width,"config.width",0,1e4),xt(a.height)||ot(a.height,"config.height",0,1e4),xt(a.videoBitrate)||ot(a.videoBitrate,"config.videoBitrate",1,1e6),xt(a.videoFrameRate)||ot(a.videoFrameRate,"config.videoFrameRate"),xt(a.lowLatency)||ac(a.lowLatency,"config.lowLatency"),xt(a.audioSampleRate)||Mn(a.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),xt(a.audioBitrate)||ot(a.audioBitrate,"config.audioBitrate",1,128),xt(a.audioChannels)||Mn(a.audioChannels,"config.audioChannels",[1,2,3,4,5]),xt(a.videoGop)||ot(a.videoGop,"config.videoGop"),xt(a.videoCodecProfile)||Mn(a.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),xt(a.userCount)||ot(a.userCount,"config.userCount",0,17),xt(a.backgroundColor)||ot(a.backgroundColor,"config.backgroundColor",0,16777215),xt(a.userConfigExtraInfo)||Kn(a.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),a.transcodingUsers&&!xt(a.transcodingUsers)&&(cc(a.transcodingUsers,"config.transcodingUsers"),a.transcodingUsers.forEach((c,l)=>{TS(c.uid),xt(c.x)||ot(c.x,"transcodingUser[".concat(l,"].x"),0,1e4),xt(c.y)||ot(c.y,"transcodingUser[".concat(l,"].y"),0,1e4),xt(c.width)||ot(c.width,"transcodingUser[".concat(l,"].width"),0,1e4),xt(c.height)||ot(c.height,"transcodingUser[".concat(l,"].height"),0,1e4),xt(c.zOrder)||ot(c.zOrder-1,"transcodingUser[".concat(l,"].zOrder"),0,100),xt(c.alpha)||ot(c.alpha,"transcodingUser[".concat(l,"].alpha"),0,1,!1)})),xt(a.watermark)||GN(a.watermark,"watermark"),xt(a.backgroundImage)||GN(a.backgroundImage,"backgroundImage"),a.images&&!xt(a.images)&&(cc(a.images,"config.images"),a.images.forEach((c,l)=>{GN(c,"images[".concat(l,"]"))}));const r=[];i.images&&r.push(...i.images.map(a=>Er(Er(Er({},HN),a),{},{zOrder:255}))),i.backgroundImage&&(r.push(Er(Er(Er({},HN),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(r.push(Er(Er(Er({},HN),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=r,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(a=>Er({},a)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const o=(i.userConfigs||[]).map(a=>"number"==typeof a.uid?q.resolve(a.uid):WY(a.uid,n.spec,n.cancelToken.token,n.httpRetryConfig));if((yield q.all(o)).forEach((a,c)=>{i.userConfigs&&i.userConfigs[c]&&(i.userConfigs[c].uid=a)}),n.transcodingConfig=i,n.connection)try{var s;const a=yield n.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:n.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(uc(s=n.streamingTasks).call(s)).map(c=>c.taskId).join("#")});_.debug("[".concat(n.spec.clientId,"] update live transcoding config success, code: ").concat(a.code,", config:"),JSON.stringify(n.transcodingConfig))}catch(a){if(!a.data||!a.data.retry)throw a;a.data.changeAddress&&n.connection.tryNextAddress(),n.streamingTasks.forEach(c=>{_.warning("[".concat(n.spec.clientId,"] live streaming receive error"),a.toString(),"try to republish",c.url),n.startLiveStreamingTask(c.url,c.mode,a).then(()=>{_.debug("[".concat(n.spec.clientId,"] live streaming republish ").concat(c.url," success"))}).catch(l=>{_.error("[".concat(n.spec.clientId,"] live streaming republish failed"),c.url,l.toString()),n.onLiveStreamError&&n.onLiveStreamError(c.url,l)})})}})()}startLiveStreamingTask(t,n,i){var r=this;return C(function*(){if(!r.transcodingConfig&&n===Sa.TRANSCODE)throw new N(S.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const o={command:"PublishStream",ts:Date.now(),url:t,uid:r.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};_.debug("[".concat(r.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const s=yield r.taskMutex.lock();if(!r.connection&&i)return void s();if(r.streamingTasks.get(t)&&!i)return s(),new N(S.LIVE_STREAMING_TASK_CONFLICT).throw();try{r.connection||(r.connection=yield r.connect(n))}catch(c){throw s(),c}n===Sa.TRANSCODE&&(o.transcodingConfig=Er({},r.transcodingConfig)),r.uapResponse&&r.uapResponse.vid&&(o.vid=r.uapResponse.vid),r.isStartingStreamingTask=!0;const a=r.lastTaskId++;try{const c=new q((d,u)=>{qn(r.retryTimeout).then(()=>{if(i)return u(i);const h=r.statusError.get(t);return h?(r.statusError.delete(t),u(h)):void 0})}),l=yield q.race([r.connection.request("request",{clientRequest:o},!0,{url:t,command:"PublishStream",workerType:n===Sa.TRANSCODE?1:2,requestByUser:!i,tid:a.toString()}),c]);r.isStartingStreamingTask=!1,_.debug("[".concat(r.spec.clientId,"] live streaming started, code: ").concat(l.code)),r.streamingTasks.set(t,{clientRequest:o,mode:n,url:t,taskId:a}),s()}catch(c){if(s(),r.isStartingStreamingTask=!1,!c.data||!c.data.retry||i)throw c;return c.data.changeAddress?(r.connection.tryNextAddress(),yield r.startLiveStreamingTask(t,n,c)):yield r.startLiveStreamingTask(t,n,c)}})()}stopLiveStreamingTask(t){return new q((n,i)=>{const r=this.streamingTasks.get(t);if(!r||!this.connection)return new N(S.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const o=r.mode;r.abortTask=()=>{_.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:t,command:"UnPublishStream",workerType:o===Sa.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(s=>{_.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(s.code)),this.streamingTasks.delete(t),0===this.streamingTasks.size&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var t;const n=Array.from(uc(t=this.streamingTasks).call(t));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(r=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,r)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=nr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}connect(t){var n=this;return C(function*(){if(n.connection)throw new N(S.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=yield ii(n,WN.REQUEST_WORKER_MANAGER_LIST,t);return n.uapResponse=i,n.connection=new q2e(i.workerToken,n.spec,n.wsRetryConfig,t),n.connection.on(dl.WARNING,(r,o)=>n.onLiveStreamWarning&&n.onLiveStreamWarning(o,r)),n.connection.on(dl.PUBLISH_STREAM_STATUS,r=>n.handlePublishStreamServer(r)),n.connection.on(dl.REQUEST_NEW_ADDRESS,(r,o)=>{if(!n.connection)return o(new N(S.UNEXPECTED_ERROR,"can not get new live streaming address list"));ii(n,WN.REQUEST_WORKER_MANAGER_LIST,t).then(s=>{n.uapResponse=s,r(s.addressList)}).catch(o)}),yield n.connection.init(i.addressList),n.connection})()}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),r=t.reason;switch(t.code){case Tn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Tn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Tn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Tn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const s=new N(S.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return _.error(s.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,s);if(!this.isStartingStreamingTask)return;this.statusError.set(n,s)}case Tn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new N(S.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,s)}case Tn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Tn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var o;if(!this.connection)return;this.connection.tryNextAddress();const s=Array.from(uc(o=this.streamingTasks).call(o));for(const a of s)a.abortTask?a.abortTask():(_.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",a.url),this.startLiveStreamingTask(a.url,a.mode,new N(S.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{_.debug("[".concat(this.spec.clientId,"] republish live stream success"),a.url)}).catch(c=>{_.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(a.url,c)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const $2e={name:"LiveStreaming",create:function(e){return new Y2e(e.joinInfo,e.websocketRetryConfig||vn,e.httpRetryConfig||vn)}};function J2e(e){let t={};e:for(;!nJ(e);){let n=Fa(e);switch(n>>>3){case 0:break e;case 1:t.requestId=iJ(e,Fa(e));break;case 2:t.requestType=Fa(e)>>>0;break;case 3:t.scorePorn=t1(e);break;case 4:t.scoreSexy=t1(e);break;case 5:t.scoreNeutral=t1(e);break;case 6:t.requestScene=Fa(e)>>>0;break;case 7:t.scene=Fa(e)>>>0;break;default:QZ(e,7&n)}}return t}function Q2e(e,t){let n=e.service;void 0!==n&&(et(t,8),et(t,n));let i=e.vendor;void 0!==i&&(et(t,16),et(t,i));let r=e.token;void 0!==r&&(et(t,26),La(t,r));let o=e.callbackUrl;void 0!==o&&(et(t,34),La(t,o))}function eFe(e){let t=Fa(e),n=e.limit;return e.limit=e.offset+t,n}function QZ(e,t){switch(t){case 0:for(;128&rJ(e););break;case 2:QM(e,Fa(e));break;case 5:QM(e,4);break;case 1:QM(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let tFe=new Float32Array(1);new Uint8Array(tFe.buffer);let JM=new Float64Array(1),br=new Uint8Array(JM.buffer);function Up(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let eJ=[];function tJ(){const e=eJ.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function nFe(e){eJ.push(e)}function QM(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function nJ(e){return e.offset>=e.limit}function Vp(e,t){let n=e.bytes,i=e.offset,r=e.limit,o=i+t;if(o>n.length){let s=new Uint8Array(2*o);s.set(n),e.bytes=s}return e.offset=o,o>r&&(e.limit=o),i}function e1(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function iJ(e,t){let n=e1(e,t),i=String.fromCharCode,r=e.bytes,o="\ufffd",s="";for(let a=0;a<t;a++){let c,l,d,u,h=r[a+n];128&h?192==(224&h)?a+1>=t?s+=o:(c=r[a+n+1],128!=(192&c)?s+=o:(u=(31&h)<<6|63&c,u<128?s+=o:(s+=i(u),a++))):224==(240&h)?a+2>=t?s+=o:(c=r[a+n+1],l=r[a+n+2],32896!=(49344&(c|l<<8))?s+=o:(u=(15&h)<<12|(63&c)<<6|63&l,u<2048||u>=55296&&u<=57343?s+=o:(s+=i(u),a+=2))):240==(248&h)?a+3>=t?s+=o:(c=r[a+n+1],l=r[a+n+2],d=r[a+n+3],8421504!=(12632256&(c|l<<8|d<<16))?s+=o:(u=(7&h)<<18|(63&c)<<12|(63&l)<<6|63&d,u<65536||u>1114111?s+=o:(u-=65536,s+=i(55296+(u>>10),56320+(1023&u)),a+=3))):s+=o:s+=i(h)}return s}function La(e,t){let n=t.length,i=0;for(let s=0;s<n;s++){let a=t.charCodeAt(s);a>=55296&&a<=56319&&s+1<n&&(a=(a<<10)+t.charCodeAt(++s)-56613888),i+=a<128?1:a<2048?2:a<65536?3:4}et(e,i);let r=Vp(e,i),o=e.bytes;for(let s=0;s<n;s++){let a=t.charCodeAt(s);a>=55296&&a<=56319&&s+1<n&&(a=(a<<10)+t.charCodeAt(++s)-56613888),a<128?o[r++]=a:(a<2048?o[r++]=a>>6&31|192:(a<65536?o[r++]=a>>12&15|224:(o[r++]=a>>18&7|240,o[r++]=a>>12&63|128),o[r++]=a>>6&63|128),o[r++]=63&a|128)}}function iFe(e,t){let n=Vp(e,t.limit),i=e.bytes,r=t.bytes;for(let o=0,s=t.limit;o<s;o++)i[o+n]=r[o]}function rJ(e){return e.bytes[e1(e,1)]}function oJ(e,t){let n=Vp(e,1);e.bytes[n]=t}function t1(e){let t=e1(e,8),n=e.bytes;return br[0]=n[t++],br[1]=n[t++],br[2]=n[t++],br[3]=n[t++],br[4]=n[t++],br[5]=n[t++],br[6]=n[t++],br[7]=n[t++],JM[0]}function n1(e,t){let n=Vp(e,8),i=e.bytes;JM[0]=t,i[n++]=br[0],i[n++]=br[1],i[n++]=br[2],i[n++]=br[3],i[n++]=br[4],i[n++]=br[5],i[n++]=br[6],i[n++]=br[7]}function Fa(e){let t,n=0,i=0;do{t=rJ(e),n<32&&(i|=(127&t)<<n),n+=7}while(128&t);return i}function et(e,t){for(t>>>=0;t>=128;)oJ(e,127&t|128),t>>>=7;oJ(e,t)}function Il(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,r=t.high>>>24,o=0===r?0===i?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,s=Vp(e,o),a=e.bytes;switch(o){case 10:a[s+9]=r>>>7&1;case 9:a[s+8]=9!==o?128|r:127&r;case 8:a[s+7]=8!==o?i>>>21|128:i>>>21&127;case 7:a[s+6]=7!==o?i>>>14|128:i>>>14&127;case 6:a[s+5]=6!==o?i>>>7|128:i>>>7&127;case 5:a[s+4]=5!==o?128|i:127&i;case 4:a[s+3]=4!==o?n>>>21|128:n>>>21&127;case 3:a[s+2]=3!==o?n>>>14|128:n>>>14&127;case 2:a[s+1]=2!==o?n>>>7|128:n>>>7&127;case 1:a[s]=1!==o?128|n:127&n}}function sJ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}const rFe=new Map([["moderation",1],["supervise",2]]);function aJ(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}class oFe extends kt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Bn.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=Ns(n=t.map(i=>rFe.get(i)||0)).call(n,(i,r)=>i+r),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),y(this,"name","AgoraRTCVideoContentInspect"),y(this,"_connectionState",Jo.CONNECTING),y(this,"_innerConnectionState",void 0),y(this,"sequence",0),y(this,"inspectStartTime",void 0),y(this,"workerManagerConnection",void 0),y(this,"workerConnection",void 0),y(this,"workerMessageLengthLimit",void 0),y(this,"inspectIntervalMinimum",void 0),y(this,"qualityRatio",void 0),y(this,"_connectInfo",void 0),y(this,"_cancelTokenSource",nr.CancelToken.source()),y(this,"_retryConfig",void 0),y(this,"wmSequence",0),y(this,"inspectInterval",void 0),y(this,"inspectTimer",null),y(this,"ossFilePrefix",void 0),y(this,"extraInfo",void 0),y(this,"_inspectType",void 0),y(this,"_inspectMode",void 0),y(this,"_quality",1),y(this,"qualityTimer",null),y(this,"_inspectId",void 0),y(this,"_needWorkUrlOnly",!1),y(this,"inspectImage",()=>{if(this.connectionState!==Jo.CONNECTED)throw new N(S.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Jo.CONNECTED?this.requestToInspectImage():_.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=gt(5,"inspect-"),this.workerMessageLengthLimit=R("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=R("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=R("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Ug("worker-manager-"+this._inspectId,vn),this.on(Bn.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,_.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Qo[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Ug("worker-"+this._inspectId,vn),this.handleWorkerEvents()}init(t,n){var i=this;return C(function*(){i.emit(Bn.STATE_CHANGE,Qo.CONNECT_AP),i._connectInfo=t;const r=i._cancelTokenSource.token;return i._retryConfig=n,new q((o,s)=>{i.on(Bn.CONNECTION_STATE_CHANGE,(a,c)=>{c===Jo.CONNECTED&&o()}),i.requestAP(t,r,n).then(a=>{i.connectWorkerManager(a)}).catch(a=>{s(a)})})})()}requestAP(t,n,i){var r=this;return C(function*(){const o=R("WEBCS_DOMAIN").map(c=>"https://".concat(c,"/api/v1")),s=yield function(c,l,d,u){let{appId:h,areaCode:p,cname:m,sid:f,token:g,uid:E}=l;Rp++;const b="image_moderation_api",T={service_name:b,json_body:JSON.stringify({appId:h,areaCode:p,cname:m,command:"allocateEdge",requestId:Rp,seq:Rp,sid:f,token:g,ts:Date.now(),uid:E+""})};let I,D,O=c[0];return Ls(C(function*(){I=Date.now();const k=yield Bs(O,{data:T,cancelToken:d,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(D=Date.now()-I,0!==k.code){const oe=new N(S.UNEXPECTED_RESPONSE,"image inspect ap error, code"+k.code,{retry:!0,responseTime:D});throw _.error(oe.toString()),oe}const L=JSON.parse(k.json_body);if(200!==L.code){const oe=new N(S.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(L.code,", reason: ").concat(L.reason),{code:L.code,responseTime:D});throw _.error(oe.toString()),oe}if(!L.servers||!Array.isArray(L.servers)||0===L.servers.length){const oe=new N(S.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:L.code,responseTime:D});throw _.error(oe.toString()),oe}const V=R("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ee=R("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:L.servers.map(oe=>{let{address:Ie,wss:Ue}=oe;if(Ie&&Ue)return"wss://".concat(Ie.replace(/\./g,"-"),".").concat(V,":").concat(ee||Ue)}).filter(oe=>!!oe),workerToken:L.workerToken,vid:L.vid,responseTime:D}}),(k,L)=>(ne.apworkerEvent(f,{success:!0,sc:200,serviceName:b,responseDetail:JSON.stringify(k.addressList),firstSuccess:0===L,responseTime:D,serverIp:c[L%c.length]}),!1),(k,L)=>(ne.apworkerEvent(f,{success:!1,sc:k.data&&k.data.code||200,serviceName:b,responseTime:D,serverIp:c[L%c.length]}),!!(k.code!==S.OPERATION_ABORTED&&k.code!==S.UNEXPECTED_RESPONSE||k.data&&k.data.retry)&&(O=c[(L+1)%c.length],!0)),u)}(o,t,n,i);r.emit(Bn.STATE_CHANGE,Qo.AP_CONNECTED);const{addressList:a}=s;return r.wmSequence++,a})()}connectWorkerManager(t){var n=arguments,i=this;return C(function*(){i._needWorkUrlOnly=n.length>1&&void 0!==n[1]&&n[1],i.emit(Bn.STATE_CHANGE,Qo.CONNECT_WORKER_MANAGER),yield i.workerManagerConnection.init(t,1e4)})()}connectWorker(t){var n=this;return C(function*(){yield n.workerConnection.init([t])})()}handleWorkerManagerEvents(){var t=this;this.workerManagerConnection.on(fe.CONNECTED,C(function*(){t.emit(Bn.STATE_CHANGE,Qo.WORKER_MANAGER_CONNECTED,t.workerManagerConnection.url),t.workerManagerConnection.sendMessage({appId:t._connectInfo.appId,cname:t._connectInfo.cname,uid:t._connectInfo.uid+"",sdkVersion:"4.22.1",sid:t._connectInfo.sid,seq:t.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(fe.CLOSED,()=>{this._innerConnectionState<Qo.GET_WORKER_MANAGER_RESPONSE&&_.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(fe.FAILED,()=>{this._innerConnectionState<Qo.GET_WORKER_MANAGER_RESPONSE&&_.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(fe.RECONNECTING,()=>{this._innerConnectionState<Qo.GET_WORKER_MANAGER_RESPONSE&&_.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(fe.ON_MESSAGE,function(){var n=C(function*(i){t.emit(Bn.STATE_CHANGE,Qo.GET_WORKER_MANAGER_RESPONSE);const r=t.workerManagerConnection.url;t.workerManagerConnection.close();const o=JSON.parse(i.data);if(200!==o.code)throw _.error("[".concat(t._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new N(S.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&r))throw _.error("[".concat(t._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new N(S.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const s=R("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,a=r.replace(/:\d+\/?$/,":".concat(s));t.emit(Bn.STATE_CHANGE,Qo.CONNECT_WORKER,a),t._needWorkUrlOnly?t.emit(Bn.REQUEST_NEW_WORKER_URL,a):yield t.connectWorker(a)}});return function(i){return n.apply(this,arguments)}}()),this.workerManagerConnection.on(fe.WILL_RECONNECT,(n,i,r)=>{r(n)}),this.workerManagerConnection.on(fe.REQUEST_NEW_URLS,(n,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n).catch(i)})}handleWorkerEvents(){var t=this;this.workerConnection.on(fe.CONNECTED,C(function*(){t.emit(Bn.STATE_CHANGE,Qo.WORKER_CONNECTED,t.workerConnection.url),t.connectionState=Jo.CONNECTED})),this.workerConnection.on(fe.ON_MESSAGE,function(){var n=C(function*(i){if(i.data instanceof ArrayBuffer){const o=function Z2e(e){return function(n){let i={};e:for(;!nJ(n);){let r=Fa(n);switch(r>>>3){case 0:break e;case 1:i.code=Fa(n);break;case 2:i.msg=iJ(n,Fa(n));break;case 3:{let o=eFe(n);i.data=J2e(n),n.limit=o;break}default:QZ(n,7&r)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}(new Uint8Array(i.data));if(R("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&_.debug("[".concat(t._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),200===o.code){if(Array.isArray(t.inspectType)&&1===t.inspectType.length&&"supervise"===t.inspectType[0])return void t.emit(Bn.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var r;const s={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},a=Ns(r=Object.keys(s)).call(r,(l,d)=>s[l]>s[d]?l:d,"porn"),c=Object.keys(s).find(l=>l===a);t.emit(Bn.INSPECT_RESULT,c)}else t.emit(Bn.INSPECT_RESULT,void 0,new N(S.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else t.emit(Bn.INSPECT_RESULT,void 0,new N(S.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else _.error("[".concat(t._inspectId,"] Unexpected message type from worker")),t.emit(Bn.INSPECT_RESULT,void 0,new N(S.UNEXPECTED_RESPONSE,"invalid worker message type"))});return function(i){return n.apply(this,arguments)}}()),this.workerConnection.on(fe.CLOSED,()=>{this.connectionState=Jo.CLOSED}),this.workerConnection.on(fe.FAILED,()=>{this.connectionState=Jo.CLOSED}),this.workerConnection.on(fe.RECONNECTING,()=>{this.connectionState=this.connectionState===Jo.CONNECTED?Jo.RECONNECTING:Jo.CONNECTING}),this.workerConnection.on(fe.WILL_RECONNECT,(n,i,r)=>{"recover"===n&&r(n),r("tryNext")}),this.workerConnection.on(fe.REQUEST_NEW_URLS,(n,i)=>{this.workerManagerConnection.close(),this.once(Bn.REQUEST_NEW_WORKER_URL,r=>{n([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{i(r)})})}requestToInspectImage(){var t=this;return C(function*(){t.sequence++;const n=Do(t,Bn.CLIENT_LOCAL_VIDEO_TRACK),i={appId:t._connectInfo.appId,cname:t._connectInfo.cname,cid:t._connectInfo.cid,sid:t._connectInfo.sid,uid:t._connectInfo.uid,vid:t._connectInfo.vid};if(n){if(!n.isPlaying)return void t.emit(Bn.INSPECT_RESULT,void 0,new N(S.INVALID_OPERATION,"Only the track being played can be inspected"));const r=yield t.generateRequestData(n,i);t.workerConnection.sendMessage(r,!0,!0)}else t.emit(Bn.INSPECT_RESULT,void 0,new N(S.INVALID_OPERATION,"Only the track being published can be inspected"))})()}generateRequestData(t,n){var i=this;return C(function*(){let{appId:r,cname:o,cid:s,vid:a,sid:c,uid:l}=n;const d=Date.now(),u=yield t.getCurrentFrameImage("image/jpeg",i.quality),h=yield WK(u,r,o),p=i.sequence+"-"+s+"-"+l+"-"+d+"-"+gt(12,""),m={appId:r,cid:s,cname:o,deviceId:"",elapse:aJ(Number(d-i.inspectStartTime)),fileSize:h.byteLength,jpgEncryption:2,height:u.height,width:u.width,jpg:h,networkType:6,osType:7,requestId:p,sdkVersion:"4.22.1",sequence:i.sequence,sid:c,timestamp:aJ(d),uid:l,vid:a,service:i._inspectMode,callbackData:i.extraInfo,ossFilePrefix:i.ossFilePrefix};void 0===i.extraInfo&&delete m.callbackData,void 0===i.ossFilePrefix&&delete m.ossFilePrefix;const f=function X2e(e){let t=tJ();return function(n,i){let r=n.appId;void 0!==r&&(et(i,10),La(i,r));let o=n.cid;void 0!==o&&(et(i,16),et(i,o));let s=n.cname;void 0!==s&&(et(i,26),La(i,s));let a=n.deviceId;void 0!==a&&(et(i,34),La(i,a));let c=n.elapse;void 0!==c&&(et(i,40),Il(i,c));let l=n.fileSize;void 0!==l&&(et(i,48),Il(i,Up(l)));let d=n.height;void 0!==d&&(et(i,56),Il(i,Up(d)));let u=n.jpg;void 0!==u&&(et(i,66),et(i,u.length),function(me,P){let F=Vp(me,P.length);me.bytes.set(P,F)}(i,u));let h=n.networkType;void 0!==h&&(et(i,72),Il(i,Up(h)));let p=n.osType;void 0!==p&&(et(i,80),Il(i,Up(p)));let m=n.requestId;void 0!==m&&(et(i,90),La(i,m));let f=n.sdkVersion;void 0!==f&&(et(i,98),La(i,f));let g=n.sequence;void 0!==g&&(et(i,104),Il(i,Up(g)));let E=n.sid;void 0!==E&&(et(i,114),La(i,E));let b=n.timestamp;void 0!==b&&(et(i,120),Il(i,b));let T=n.uid;void 0!==T&&(et(i,128),et(i,T));let I=n.vid;void 0!==I&&(et(i,136),et(i,I));let D=n.width;void 0!==D&&(et(i,144),Il(i,Up(D)));let O=n.service;void 0!==O&&(et(i,152),et(i,O));let k=n.callbackData;void 0!==k&&(et(i,162),La(i,k));let L=n.jpgEncryption;void 0!==L&&(et(i,168),et(i,L));let V=n.requestType;void 0!==V&&(et(i,176),et(i,V));let ee=n.scorePorn;void 0!==ee&&(et(i,185),n1(i,ee));let oe=n.scoreSexy;void 0!==oe&&(et(i,193),n1(i,oe));let Ie=n.scoreNeutral;void 0!==Ie&&(et(i,201),n1(i,Ie));let Ue=n.scene;void 0!==Ue&&(et(i,208),et(i,Ue));let Dt=n.ossFilePrefix;void 0!==Dt&&(et(i,218),La(i,Dt));let dt=n.serviceVendor;if(void 0!==dt)for(let me of dt){et(i,226);let P=tJ();Q2e(me,P),et(i,P.limit),iFe(i,P),nFe(P)}}(e,t),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(t)}(m);if(f.byteLength<i.workerMessageLengthLimit){if(R("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const g=function(E){for(var b=1;b<arguments.length;b++){var T=null!=arguments[b]?arguments[b]:{};b%2?sJ(Object(T),!0).forEach(function(I){y(E,I,T[I])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(T)):sJ(Object(T)).forEach(function(I){Object.defineProperty(E,I,Object.getOwnPropertyDescriptor(T,I))})}return E}({},m);delete g.jpg,_.debug("[".concat(i._inspectId,"] Request message for worker of inspect content "),JSON.stringify(g))}return f}return i.quality=i.quality*i.qualityRatio,yield i.generateRequestData(t,{appId:r,cname:o,cid:s,vid:a,sid:c,uid:l})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=nr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Jo.CLOSED,this.emit(Bn.STATE_CHANGE,Qo.CLOSED)}}const sFe={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new N(S.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new N(S.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(r=>{var o;if(!Y(o=["supervise","moderation"]).call(o,r))throw new N(S.INVALID_PARAMS,"".concat(r," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new N(S.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new oFe(t)}};st("PROCESS_ID","process-".concat(gt(8,""),"-").concat(gt(4,""),"-").concat(gt(4,""),"-").concat(gt(4,""),"-").concat(gt(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void _.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();_.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(Jt,i)){const{value:r,expires:o}=t[i];if(o&&o<=n)return;ll[i]=r,Jt[i]=r}})}catch(t){_.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(ll.AREAS)&&ll.AREAS.length>0&&YP(ll.AREAS,!0);const cJ=(e,t,n)=>{_.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),st(e,t,n)};n_(K2e,!1),n_($2e,!1),n_(OLe,!1),n_(sFe,!1),n_(G2e,!1);const En=function(e){const t=new kt,n=e,i={getListeners:t.getListeners.bind(t),on:(r,o)=>(r===Ca.SECURITY_POLICY_VIOLATION&&cZ(o,!0),t.on.bind(t)(r,o)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return aZ(aZ({},n),i)}({__TRACK_LIST__:mp,VERSION:Oo,BUILD:xN,ESM_BUNDLER:!1,ESM:!0,UMD:!1,DEV:!1,setParameter:cJ,getParameter:R,getSupportedCodec:function(){var e=C(function*(){let t={audio:[],video:[]};try{let n=new RTCPeerConnection;const i=yield(r=C(function*(o){let s;return Fe().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),s=(yield o.createOffer()).sdp):s=(yield o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,s}),function(o){return r.apply(this,arguments)})(n);if(!i)return t;n.close(),n=null,t=function(r){const o={video:[],audio:[]};return r.match(/ VP8/i)&&o.video.push("VP8"),r.match(/ VP9/i)&&o.video.push("VP9"),r.match(/ AV1/i)&&o.video.push("AV1"),r.match(/ H264/i)&&o.video.push("H264"),r.match(/ H265/i)&&o.video.push("H265"),r.match(/ opus/i)&&o.audio.push("OPUS"),r.match(/ PCMU/i)&&o.audio.push("PCMU"),r.match(/ PCMA/i)&&o.audio.push("PCMA"),r.match(/ G722/i)&&o.audio.push("G722"),o}(i)}catch(n){throw new N(S.CREATE_OFFER_FAILED,n.toString&&n.toString()).print()}var r;return t});return function(){return e.apply(this,arguments)}}(),checkSystemRequirements:function(){const e=ne.reportApiInvoke(null,{name:Cn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:jt.TRACER});let t=!1;try{const o=window.RTCPeerConnection,s=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,a=window.WebSocket;t=!!(o&&s&&a),t&&yN()&&B9(75)&&(new o).close()}catch(o){return _.error("check system requirement failed: ",o),!1}let n=!1;const i=xe();i.name===Ye.CHROME&&Number(i.version)>=58&&("WebKit"!==ks.engine.name||function(){const o=xe();if(uS()){if(o.os===kn.MAC_OS)return!0;if(o.os===kn.IOS){const s=ks.os.version&&ks.os.version.split(".");if(s&&14===Number(s[0])&&s[1]&&Number(s[1])>=3||s&&Number(s[0])>14)return!0}}return!1}())&&(n=!0),(i.name===Ye.FIREFOX&&Number(i.version)>=56||i.name===Ye.OPERA&&Number(i.version)>=45||i.name===Ye.SAFARI&&Number(i.version)>=11||"WebKit"===i.name&&(Yi()||Xo())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||Y9()||xe().name===Ye.QQ)&&(n=!0),_.debug("checkSystemRequirements, api:",t,"browser",n);const r=t&&n;return e.onSuccess(r),r},getDevices:function(e){return oo.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return oo.getRecordingDevices(e)},getCameras:function(e){return oo.getCamerasDevices(e)},getElectronScreenSources:MK,getPlaybackDevices:function(e){return oo.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=ne.reportApiInvoke(null,{name:Cn.CREATE_CLIENT,options:[t],tag:jt.TRACER});try{Mn((i=t).codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Mn(i.mode,"config.mode",["rtc","live","p2p"]),void 0!==i.audioCodec&&Mn(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==i.proxyServer&&Kn(i.proxyServer,"config.proxyServer",1,1e4),void 0!==i.turnServer&&n7(i.turnServer),void 0!==i.httpRetryConfig&&t7(i.httpRetryConfig),void 0!==i.websocketRetryConfig&&t7(i.websocketRetryConfig)}catch(i){throw n.onError(i),i}var i;return(G9(16,0,!0)||W9(16,0,!0))&&("vp9"===t.codec&&(t.codec="vp8",_.debug("browser not support vp9, force use vp8")),st("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===t.audioCodec&&(t.audioCodec="opus"),n.onSuccess(),new NLe(us(us({forceWaitGatewayResponse:!0},t),{},{role:Y(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}))},createCameraVideoTrack:function(){var e=C(function*(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=R("CAMERA_CAPTURE_CONFIG"),i=ne.reportApiInvoke(null,{tag:jt.TRACER,name:Cn.CREATE_CAM_VIDEO_TRACK,options:[Rt({},t),n]});n&&(t.encoderConfig=n);const r=BS(t),o=gt(8,"track-cam-");let s=null;_.info("start create camera video track with config",JSON.stringify(t),"trackId",o);try{s=(yield ro({video:r},o)).getVideoTracks()[0]||null}catch(c){throw i.onError(c),c}if(!s){const c=new M(S.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(c),c.throw(_)}t.optimizationMode&&FP(o,s,t,wa(t.encoderConfig));const a=new LP(s,t,r,t.scalabiltyMode?LS(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,o);return i.onSuccess(a.getTrackId()),_.info("create camera video success, trackId:",o),a});return function(){return e.apply(this,arguments)}}(),createCustomVideoTrack:function(e){const t=ne.reportApiInvoke(null,{tag:jt.TRACER,name:Cn.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new St(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?LS(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,gt(8,"track-cus-"),[ft.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),_.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:function(){var e=C(function*(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const i=ne.reportApiInvoke(null,{tag:jt.TRACER,name:Cn.CREATE_SCREEN_VIDEO_TRACK,options:[Rt({},t),n]});t.encoderConfig?"string"==typeof t.encoderConfig||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const r=function(u){const h={};u.screenSourceType&&(h.mediaSource=u.screenSourceType),u.extensionId&&ol()&&(h.extensionId=u.extensionId);const{displaySurface:p,selfBrowserSurface:m,surfaceSwitching:f,systemAudio:g}=u;(EN(107)||j9(107)||z9(93))&&(p&&(Mn(p,"displaySurface",["browser","window","monitor"]),h.displaySurface=p),m?(Mn(m,"selfBrowserSurface",["exclude","include"]),h.selfBrowserSurface=m):h.selfBrowserSurface="include",f&&(Mn(f,"surfaceSwitching",["exclude","include"]),h.surfaceSwitching=f)),(EN(105)||j9(105)||z9(91))&&g&&(Mn(g,"systemAudio",["exclude","include"]),h.systemAudio=g),u.electronScreenSourceId&&(h.sourceId=u.electronScreenSourceId);const E=u.encoderConfig?bP(u.encoderConfig):null;return h.mandatory={chromeMediaSource:"desktop",maxWidth:E?E.width:void 0,maxHeight:E?E.height:void 0},E&&(E.frameRate&&("number"==typeof E.frameRate?(h.mandatory.maxFrameRate=E.frameRate,h.mandatory.minFrameRate=E.frameRate):(h.mandatory.maxFrameRate=E.frameRate.max||E.frameRate.ideal||E.frameRate.exact||void 0,h.mandatory.minFrameRate=E.frameRate.min||E.frameRate.ideal||E.frameRate.exact||void 0),h.frameRate=E.frameRate),E.width&&(h.width=E.width),E.height&&(h.height=E.height)),h}(t),o=gt(8,"track-scr-v-");let s=null,a=null;const c=Fe();if(!c.supportShareAudio&&"enable"===n){const u=new M(S.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(u),u.throw(_)}_.info("start create screen video track with config",t,"withAudio",n,"trackId",o);try{const u=yield ro({screen:r,screenAudio:"auto"===n?c.supportShareAudio:"enable"===n},o);s=u.getVideoTracks()[0]||null,a=u.getAudioTracks()[0]||null}catch(u){throw i.onError(u),u}if(!s){const u=new M(S.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(u),u.throw(_)}if(!a&&"enable"===n){s&&s.stop();const u=new M(S.SHARE_AUDIO_NOT_ALLOWED);return i.onError(u),u.throw(_)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(FP(o,s,t,t.encoderConfig&&bP(t.encoderConfig)||void 0),t.encoderConfig&&"string"!=typeof t.encoderConfig&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const l=new St(s,t.encoderConfig?bP(t.encoderConfig):{},t.scalabiltyMode?LS(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,o,[ft.SCREEN_TRACK]);if(!a)return i.onSuccess(l.getTrackId()),_.info("create screen video track success","video:",l.getTrackId()),l;const d=new Ht(a,void 0,gt(8,"track-scr-a-"),!1);return i.onSuccess([l.getTrackId(),d.getTrackId()]),_.info("create screen video track success","video:",l.getTrackId(),"audio:",d.getTrackId()),[l,d]});return function(){return e.apply(this,arguments)}}(),createMicrophoneAndCameraTracks:function(){var e=C(function*(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=R("CAMERA_CAPTURE_CONFIG"),r=ne.reportApiInvoke(null,{tag:jt.TRACER,name:Cn.CREATE_MIC_AND_CAM_TRACKS,options:[t,n,i]});i&&(n.encoderConfig=i);const o=BS(n),s=GK(t),a=gt(8,"track-mic-"),c=gt(8,"track-cam-");let l=null,d=null;_.info("start create camera video track(".concat(c,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(n)));try{const p=yield ro({audio:s,video:o},"".concat(a,"-").concat(c));l=p.getAudioTracks()[0],d=p.getVideoTracks()[0]}catch(p){throw r.onError(p),p}if(!l||!d){const p=new M(S.UNEXPECTED_ERROR,"can not find tracks in media stream");return r.onError(p),p.throw(_)}n.optimizationMode&&FP(c,d,n,wa(n.encoderConfig));const u=new jS(l,t,s,a),h=new LP(d,n,o,n.scalabiltyMode?LS(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,c);return r.onSuccess([u.getTrackId(),h.getTrackId()]),_.info("create camera video track(".concat(c,") and microphone audio track(").concat(a,") success")),[u,h]});return function(){return e.apply(this,arguments)}}(),createMicrophoneAudioTrack:function(){var e=C(function*(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=ne.reportApiInvoke(null,{tag:jt.TRACER,name:Cn.CREATE_MIC_AUDIO_TRACK,options:[t]}),i=GK(t),r=gt(8,"track-mic-");let o=null;_.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{o=(yield ro({audio:i},r)).getAudioTracks()[0]||null}catch(a){throw n.onError(a),a}if(!o){const a=new M(S.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(a),a.throw(_)}const s=new jS(o,t,i,r);return n.onSuccess(s.getTrackId()),_.info("create microphone audio track success, trackId:",r),s});return function(){return e.apply(this,arguments)}}(),createCustomAudioTrack:function(e){const t=ne.reportApiInvoke(null,{tag:jt.TRACER,name:Cn.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new Ht(e.mediaStreamTrack,e.encoderConfig?FS(e.encoderConfig):{},gt(8,"track-cus-"),!1);return _.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:function(){var e=C(function*(t){var n;const{cacheOnlineFile:i,encoderConfig:r}=t;let{source:o}=t;const s={source:o instanceof AudioBuffer?"AudioBuffer":o instanceof File?null!==(n=File.name)&&void 0!==n?n:"File":o,cacheOnlineFile:i,encoderConfig:r},a=ne.reportApiInvoke(null,{tag:jt.TRACER,name:Cn.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(R("DISABLE_WEBAUDIO"))throw new M(S.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const c=gt(8,"track-buf-");_.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",c);const l=o;if(!(o instanceof AudioBuffer))try{o=yield(h=C(function*(p,m){let f=null;if("string"==typeof p){const E=Dq.get(p);if(E)return _.debug("use cached audio resource: ",p),E;try{f=(yield Ls(()=>nr.get(p,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(b){throw new M(S.FETCH_AUDIO_FILE_FAILED,b.toString())}}else f=yield new q((b,T)=>{const I=new FileReader;I.onload=D=>{D.target?b(D.target.result):T(new M(S.READ_LOCAL_AUDIO_FILE_ERROR))},I.onerror=()=>{T(new M(S.READ_LOCAL_AUDIO_FILE_ERROR))},I.readAsArrayBuffer(p)});const g=yield function(E){const b=yp();return new q((T,I)=>{b.decodeAudioData(E,D=>{T(D)},D=>{I(new M(S.DECODE_AUDIO_FILE_FAILED,D.toString()))})})}(f);return"string"==typeof p&&m&&Dq.set(p,g),g}),function(p,m){return h.apply(this,arguments)})(o,i)}catch(h){return a.onError(h),h.throw(_)}var h;const d=new xke(o),u=new Mke(l,d,r?FS(r):{},c);return _.info("create buffer source audio track success, trackId:",c),a.onSuccess(u.getTrackId()),u});return function(n){return e.apply(this,arguments)}}(),setAppType:function(e){if(_.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw _.debug("Invalid appType"),new N(S.INVALID_PARAMS,"invalid app type",e);st("APP_TYPE",Math.floor(e))},setLogLevel:function(e){_.setLogLevel(e)},enableLogUpload:function(){R("USE_NEW_LOG")?st("UPLOAD_LOG",!0):_.enableLogUpload()},disableLogUpload:function(){R("USE_NEW_LOG")?st("UPLOAD_LOG",!1):_.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new O$},checkAudioTrackIsActive:function(){var e=C(function*(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const i=ne.reportApiInvoke(null,{tag:jt.TRACER,name:Cn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[n]});if(!(t instanceof Ht||t instanceof Tp)){const l=new N(S.INVALID_TRACK,"the parameter is not a audio track");return i.onError(l),l.throw()}n&&n<1e3&&(n=1e3);const r=t instanceof Ht?t.getTrackLabel():"remote_track",o=t.getVolumeLevel();let s=o,a=o;const c=Date.now();return new q(l=>{const d=setInterval(()=>{const u=t.getVolumeLevel();s=u>s?u:s,a=u<a?u:a;const h=s-a>1e-4,p=Date.now()-c;if(h||p>n){clearInterval(d);const m=h,f={duration:p,deviceLabel:r,maxVolumeLevel:s,result:m};_.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(f))),i.onSuccess(f),l(m)}},200)})});return function(n){return e.apply(this,arguments)}}(),checkVideoTrackIsActive:function(){var e=C(function*(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const i=ne.reportApiInvoke(null,{tag:jt.TRACER,name:Cn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[n]});if(!(t instanceof St||t instanceof Cp)){const h=new N(S.INVALID_TRACK,"the parameter is not a video track");return i.onError(h),h.throw()}n&&n<1e3&&(n=1e3);const r=t instanceof St?t.getTrackLabel():"remote_track",o=t.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(ti()||uS())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([o]),s.play();const a=document.createElement("canvas");a.width=160,a.height=120;let c=0,l=0;try{const h=Date.now();c=yield function(p,m,f,g){let E,b=0,T=null;return new q((I,D)=>{setTimeout(()=>{E&&(E(),I(b))},m),E=wP(()=>{!function O(){b>4&&E&&(E(),I(b));const k=f.getContext("2d");if(!k){const ee=new N(S.UNEXPECTED_ERROR,"can not get canvas 2d context.");return _.error(ee.toString()),void D(ee)}k.drawImage(p,0,0,160,120);const L=k.getImageData(0,0,f.width,f.height),V=Math.floor(L.data.length/3);if(T){for(let ee=0;ee<V;ee+=3)if(L.data[ee]!==T[ee])return b+=1,void(T=L.data);T=L.data}else T=L.data}()},30)})}(s,n,a),l=Date.now()-h}catch(h){throw i.onError(h),h}gLe===Ye.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const d=c>4,u={duration:l,changedPicNum:c,deviceLabel:r,result:d};return _.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(u))),i.onSuccess(u),d});return function(n){return e.apply(this,arguments)}}(),setArea:YP,audioElementPlayCenter:ir,resumeAudioContext:function(){ir.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){MLe.processExternalMediaAEC(e)},registerExtensions:function(e){const t=R("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!Y(t).call(t,n.name)&&t.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=_.extLog,i.reporter.hookApiInvoke=ne.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(r=>{i.parameters[r]=R(r)})}),cJ("PLUGIN_INFO",t)},ChannelMediaRelayError:ip,ChannelMediaRelayEvent:lc,ChannelMediaRelayState:vr,RemoteStreamFallbackType:Ike,RemoteStreamType:wke,ConnectionDisconnectedReason:Qe,AudienceLatencyLevelType:o1e,AREAS:We,preload:function(){var e=C(function*(t,n,i,r){return Q$(t,n,i,r)});return function(n,i,r,o){return e.apply(this,arguments)}}()});function aFe(e,t){if(1&e){const n=$a();ue(0,"div",1)(1,"button",2),zt("click",function(){return Wr(n),zr(Kt().onToggleFullScreen())}),ue(2,"div",3),bs(),ue(3,"svg",4)(4,"g",26)(5,"g",6)(6,"g",7)(7,"g",11),pt(8,"path",27)(9,"path",28)(10,"path",29)(11,"path",30),ve()()()(),ue(12,"g",31)(13,"g",6)(14,"g",32)(15,"g",7),pt(16,"path",33)(17,"path",34)(18,"path",35)(19,"path",36),ve()()()()()(),Rc(),ue(20,"p"),fr(21),ve()()()}if(2&e){const n=Kt();Re(),wt("controls__button--active",n.fullScreenEnabled),Re(3),wt("controls__icon--shown",!n.fullScreenEnabled),Re(8),wt("controls__icon--shown",n.fullScreenEnabled),Re(9),Yl(n.fullScreenEnabled?"Exit fullscreen":"Fullscreen")}}function cFe(e,t){if(1&e){const n=$a();ue(0,"div",1)(1,"button",37),zt("click",function(){return Wr(n),zr(Kt().onToggleSmallScreen())}),ue(2,"div",3),bs(),ue(3,"svg",4)(4,"g",38),pt(5,"path",39),ve(),ue(6,"defs")(7,"filter",40),pt(8,"feFlood",41)(9,"feColorMatrix",42)(10,"feOffset",43)(11,"feGaussianBlur",44)(12,"feComposite",45)(13,"feColorMatrix",46)(14,"feBlend",47)(15,"feBlend",48),ve()()()(),Rc(),ue(16,"p"),fr(17,"Minimize"),ve()()()}if(2&e){const n=Kt();Re(),wt("controls__button--active",n.smallScreenEnabled)}}Object.defineProperties(En,{onAudioAutoplayFailed:{get:()=>so.onAudioAutoplayFailed,set:e=>{so.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>so.onAutoplayFailed,set:e=>{so.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>En._onSecurityPolicyViolation,set(e){En._onSecurityPolicyViolation=e,cZ(e)}},__CLIENT_LIST__:{get:()=>R("SHOW_GLOBAL_CLIENT_LIST")?Td:[]}}),oo.on(Od.CAMERA_DEVICE_CHANGED,e=>{_.info("camera device changed",JSON.stringify(e)),En.onCameraChanged&&En.onCameraChanged(e),En.safeEmit(Ca.CAMERA_CHANGED,e)}),oo.on(Od.RECORDING_DEVICE_CHANGED,e=>{_.info("microphone device changed",JSON.stringify(e)),En.onMicrophoneChanged&&En.onMicrophoneChanged(e),En.safeEmit(Ca.MICROPHONE_CHANGED,e)}),oo.on(Od.PLAYOUT_DEVICE_CHANGED,e=>{_.debug("playout device changed",JSON.stringify(e)),En.onPlaybackDeviceChanged&&En.onPlaybackDeviceChanged(e),En.safeEmit(Ca.PLAYBACK_DEVICE_CHANGED,e)}),ir.onAutoplayFailed=()=>{_.info("detect audio element autoplay failed"),so.onAudioAutoplayFailed&&so.onAudioAutoplayFailed()},tt.on("autoplay-failed",()=>{_.info("detect webaudio autoplay failed"),so.onAudioAutoplayFailed&&so.onAudioAutoplayFailed(),En.safeEmit(Ca.AUTOPLAY_FAILED)}),tt.on(Xn.STATE_CHANGE,(e,t)=>{_.info("audio context state changed: ".concat(t," => ").concat(e)),En.onAudioContextStateChanged&&En.onAudioContextStateChanged(e,t),En.safeEmit(Ca.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),ln.on(Jh.NETWORK_STATE_CHANGE,(e,t)=>{_.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=En);const lFe=(e,t,n,i)=>({"spinner--connected":e,"spinner--ended":t,"spinner--small":n,"spinner--error":i});function dFe(e,t){if(1&e&&(ue(0,"div",8),fr(1),ve()),2&e){const n=Kt();Re(),Yl(n.text)}}function uFe(e,t){if(1&e&&(qf(0),fr(1),Yf()),2&e){const n=Kt(2);Re(),im(" Calling to ",n.data.user.name," ")}}function hFe(e,t){1&e&&fr(0),2&e&&im(" ",Kt(2).data.user.name," is calling ")}function pFe(e,t){if(1&e){const n=$a();qf(0),ue(1,"button",11),zt("click",function(){return Wr(n),zr(Kt(2).onAcceptCall())}),ve(),Yf()}}function fFe(e,t){if(1&e){const n=$a();ue(0,"div",2)(1,"div",3)(2,"div",4),pt(3,"img",5),ve(),ue(4,"p",6),an(5,uFe,2,1,"ng-container",7)(6,hFe,1,1,"ng-template",null,0,Lw),ve()(),ue(8,"div",8),an(9,pFe,2,0,"ng-container",9),ue(10,"span")(11,"button",10),zt("click",function(){return Wr(n),zr(Kt().onDeclineCall())}),ve()()()()}if(2&e){const n=nm(7),i=Kt();wt("video-call--full-screen",i.fullScreen),ht("@fade",void 0),Re(3),ht("src",i.data.user.photoURL,l0),Re(2),ht("ngIf",i.data.outcome)("ngIfElse",n),Re(4),ht("ngIf",!i.data.outcome)}}function mFe(e,t){if(1&e&&pt(0,"ngx-spinner",15),2&e){const n=Kt().ngIf,i=Kt(2);ht("error",n.error)("text",n.statusText)("connected",n.connected)("ended",n.ended)("small",i.smallScreenEnabled)}}function gFe(e,t){1&e&&pt(0,"ngx-timer",16),2&e&&ht("started",Kt().ngIf.started)}function _Fe(e,t){if(1&e&&(pt(0,"div",17),uE(1,"async")),2&e){const n=t.$implicit;wt("hidden",!1===hE(1,3,Kt(3).remoteStreamVideoToggle$)),ht("id",n)}}function vFe(e,t){if(1&e){const n=$a();ue(0,"ngx-controls",18),zt("toggleCamera",function(r){return Wr(n),zr(Kt(3).onToggleCamera(r))})("toggleMicrophone",function(r){return Wr(n),zr(Kt(3).onToggleMicrophone(r))})("toggleFullScreen",function(r){return Wr(n),zr(Kt(3).onToggleFullScreen(r))})("toggleSmallScreen",function(r){return Wr(n),zr(Kt(3).onToggleSmallScreen(r))})("endCall",function(){return Wr(n),zr(Kt(3).onEndCall())}),ve()}if(2&e){const n=Kt(3);ht("cameraEnabled",n.cameraEnabled)("microphoneEnabled",n.microphoneEnabled)("fullScreenEnabled",n.fullScreenEnabled)("smallScreenEnabled",n.smallScreenEnabled)("displaySmallScreen",n.displaySmallScreen)}}function EFe(e,t){if(1&e&&(ue(0,"div",2),an(1,mFe,1,5,"ngx-spinner",3)(2,gFe,1,1,"ngx-timer",4),pt(3,"div",5),an(4,_Fe,2,5,"div",6),ue(5,"div",7),bs(),ue(6,"svg",8)(7,"g",9),pt(8,"path",10)(9,"path",11),ve(),ue(10,"defs")(11,"clipPath",12),pt(12,"rect",13),ve()()()(),an(13,vFe,1,5,"ngx-controls",14),ve()),2&e){const n=t.ngIf,i=Kt(2);Re(),ht("ngIf",n.loading),Re(),ht("ngIf",n.started),Re(),wt("hidden",!i.cameraEnabled||i.smallScreenEnabled),ht("id",i.localContainerId),Re(),ht("ngForOf",i.remoteCalls),Re(9),ht("ngIf",n.connected&&!n.ended)}}function bFe(e,t){if(1&e&&(ue(0,"div"),an(1,EFe,14,7,"div",1),uE(2,"async"),ve()),2&e){const n=Kt();ht("@fade",void 0)("@.disabled",!n.animate),Re(),ht("ngIf",hE(2,3,n.streamState$))}}class lJ{constructor(t){this.cdr=t,this.afterClosed=new vt,this.shown=!0}closeDialog(t){this.onAfterClosed(t)}onAfterClosed(t){this.shown=!1,this.cdr.markForCheck(),this.afterClosed.next(t)}}let yFe=(()=>{class e{constructor(){this.cameraEnabled=!0,this.microphoneEnabled=!0,this.fullScreenEnabled=!1,this.smallScreenEnabled=!1,this.displaySmallScreen=!1,this.toggleCamera=new Wt,this.toggleMicrophone=new Wt,this.toggleFullScreen=new Wt,this.toggleSmallScreen=new Wt,this.endCall=new Wt}onToggleCamera(){this.toggleCamera.emit(this.cameraEnabled)}onToggleMicrophone(){this.toggleMicrophone.emit(this.microphoneEnabled)}onToggleFullScreen(){this.toggleFullScreen.emit(this.fullScreenEnabled)}onToggleSmallScreen(){this.toggleSmallScreen.emit(this.smallScreenEnabled)}onEndCall(){this.endCall.emit()}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=sr({type:e,selectors:[["ngx-controls"]],inputs:{cameraEnabled:"cameraEnabled",microphoneEnabled:"microphoneEnabled",fullScreenEnabled:"fullScreenEnabled",smallScreenEnabled:"smallScreenEnabled",displaySmallScreen:"displaySmallScreen"},outputs:{toggleCamera:"toggleCamera",toggleMicrophone:"toggleMicrophone",toggleFullScreen:"toggleFullScreen",toggleSmallScreen:"toggleSmallScreen",endCall:"endCall"},decls:43,vars:16,consts:[[1,"controls"],[1,"controls__item"],[1,"controls__button",3,"click"],[1,"controls__icon-wrapper"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","video-camera",1,"controls__icon"],["id","Group"],["id","Group_2"],["id","Vector","d","M63.4134 16.2294C63.0454 15.9814 62.5787 15.928 62.1707 16.096L50.6668 20.6986V20C50.6668 16.3226 47.6748 13.3334 44.0001 13.3334H6.66663C2.992 13.3334 0 16.3226 0 20V44C0 47.6774 2.992 50.6666 6.66663 50.6666H44C47.6746 50.6666 50.6666 47.6772 50.6666 44V43.3014L62.1706 47.904C62.5812 48.072 63.048 48.0186 63.4132 47.7706C63.7786 47.5226 63.9999 47.1093 63.9999 46.6666V17.3334C64 16.8906 63.7786 16.4774 63.4134 16.2294Z","fill","white"],["id","no-camera",1,"controls__icon"],["id","Vector","d","M44.0002 13.3325H6.66735C2.99276 13.3325 0.000793457 16.3218 0.000793457 19.999V43.9988C0.000793457 47.6761 2.99276 50.6654 6.66735 50.6654H7.67797L44.9176 13.4257C44.6162 13.3832 44.315 13.3325 44.0002 13.3325Z","fill","white"],["id","Group_3"],["id","Group_4"],["id","Vector_2","d","M63.4134 16.2285C63.0454 15.9805 62.5788 15.9271 62.1708 16.0951L50.6669 20.6977V19.9991C50.6669 18.6417 50.2535 17.3831 49.5549 16.3297L63.608 2.2766C64.128 1.75661 64.128 0.911242 63.608 0.391247C63.088 -0.128748 62.2426 -0.128748 61.7226 0.391247L0.389996 61.724C-0.129999 62.244 -0.129999 63.0894 0.389996 63.6094C0.651369 63.868 0.992615 63.9988 1.33399 63.9988C1.67536 63.9988 2.01661 63.8681 2.27798 63.6094L15.2192 50.6655H44.0003C47.6749 50.6655 50.6669 47.6762 50.6669 43.9989V43.3003L62.1708 47.9029C62.5814 48.0709 63.0481 48.0175 63.4134 47.7695C63.7788 47.5215 64 47.1082 64 46.6655V17.3325C64 16.8898 63.7788 16.4765 63.4134 16.2285Z","fill","white"],["id","microphone",1,"controls__icon"],["id","Vector"],["fill-rule","evenodd","clip-rule","evenodd","d","M44.3474 12.1407L44.3468 17.2309V33.8672C44.3468 40.6024 38.9004 46.0823 32.206 46.0823C27.8366 46.0787 23.8059 43.7286 21.6503 39.9279L20.4131 36.8161C20.1824 35.875 20.0659 34.9098 20.0659 33.941V12.1407C20.0659 5.43551 25.5014 0 32.2066 0C38.9118 0 44.3474 5.43551 44.3474 12.1407Z","fill","white"],["fill-rule","evenodd","clip-rule","evenodd","d","M15.0971 33.7512C15.0947 36.1345 15.5932 38.4912 16.5596 40.6697L18.1223 43.4553C22.3699 49.6259 30.1387 52.3143 37.292 50.089C44.4453 47.8638 49.318 41.2426 49.3156 33.7518C49.3156 32.9026 50.0039 32.2143 50.8532 32.2143C51.7018 32.2143 52.3907 32.9026 52.3907 33.7518C52.4051 44.4499 44.0585 53.2951 33.3778 53.9017V60.9246H39.8098C40.6584 60.9246 41.3473 61.6135 41.3473 62.4622C41.3473 63.3114 40.6584 63.9997 39.8098 63.9997H24.6029C23.7537 63.9997 23.0654 63.3114 23.0654 62.4622C23.0654 61.6135 23.7537 60.9246 24.6029 60.9246H30.3033V53.847C25.6228 53.4212 21.2413 51.3623 17.926 48.0313C17.1926 47.298 16.5163 46.51 15.9031 45.6739L14.2418 42.9874C12.7757 40.1297 12.0148 36.9633 12.022 33.7512C12.022 32.902 12.7103 32.2137 13.5595 32.2137C14.4088 32.2137 15.0971 32.902 15.0971 33.7512Z","fill","white"],["id","no-microphone",1,"controls__icon"],["id","Vector","d","M52.9733 4.25592L44.3474 12.8813V12.1407C44.3474 5.43551 38.9118 0 32.2066 0C25.5014 0 20.0659 5.43551 20.0659 12.1407V33.941C20.0659 34.9098 20.1824 35.875 20.4131 36.8161L16.5596 40.6697C15.5932 38.4912 15.0947 36.1345 15.0971 33.7512C15.0971 32.902 14.4088 32.2137 13.5595 32.2137C12.7103 32.2137 12.022 32.902 12.022 33.7512C12.0148 36.9633 12.7757 40.1297 14.2418 42.9874L8.81411 48.4151C8.4117 48.8007 8.24954 49.3731 8.39008 49.9124C8.53002 50.4518 8.95105 50.8728 9.4898 51.0133C10.0291 51.1539 10.6021 50.9917 10.9877 50.5899L15.9031 45.6739C16.5163 46.51 17.1926 47.298 17.926 48.0313C21.2413 51.3623 25.6228 53.4212 30.3033 53.847V60.9246H24.6029C23.7537 60.9246 23.0654 61.6135 23.0654 62.4622C23.0654 63.3114 23.7537 63.9997 24.6029 63.9997H39.8098C40.6584 63.9997 41.3473 63.3114 41.3473 62.4622C41.3473 61.6135 40.6584 60.9246 39.8098 60.9246H33.3778V53.9017C44.0585 53.2951 52.4051 44.4499 52.3907 33.7518C52.3907 32.9026 51.7018 32.2143 50.8532 32.2143C50.0039 32.2143 49.3156 32.9026 49.3156 33.7518C49.318 41.2426 44.4453 47.8638 37.292 50.089C30.1387 52.3143 22.3699 49.6259 18.1224 43.4553L21.6503 39.9279C23.8059 43.7286 27.8366 46.0787 32.206 46.0823C38.9004 46.0823 44.3468 40.6024 44.3468 33.8672V17.2309L55.1475 6.43072C55.7481 5.83071 55.7481 4.85713 55.1475 4.25652C54.5469 3.65591 53.5733 3.65591 52.9733 4.25652V4.25592Z","fill","white"],["class","controls__item",4,"ngIf"],[1,"controls__button","controls__button--danger",3,"click"],["id","phone"],["id","Vector","d","M51.7097 13.2478C51.2458 12.7839 50.4959 12.7839 50.032 13.2478L1.38351 61.8963C0.919568 62.3602 0.919568 63.1101 1.38351 63.574C1.61488 63.8054 1.91864 63.9217 2.2224 63.9217C2.52615 63.9217 2.82991 63.8054 3.06129 63.574L51.7097 14.9256C52.1737 14.4628 52.1737 13.7117 51.7097 13.2478Z","fill","white"],["id","Vector_2","d","M16.9605 42.9635L26.1159 33.8081L21.3365 29.0287C18.91 26.6022 18.6869 24.3679 20.5878 21.5629C20.8535 21.1951 22.5444 19.6941 23.992 18.4839C24.9151 17.9333 25.5487 17.1181 25.8264 16.1155C26.1954 14.783 25.9225 13.2156 25.0516 11.6885C24.8463 11.3373 19.9625 3.06229 15.4583 0.680892C14.6171 0.235937 13.6714 0.0010004 12.721 0.0010004C11.1571 0.0010004 9.68576 0.610886 8.58109 1.71556L5.57082 4.72702C-3.21082 13.5098 -1.58525 24.419 10.2719 36.2749L16.9605 42.9635Z","fill","white"],["id","Vector_3","d","M63.313 48.5357C60.9304 44.0328 52.6566 39.1478 52.2923 38.9342C51.2304 38.329 50.1209 38.0099 49.0839 38.0099C47.5402 38.0099 46.2753 38.717 45.51 40.0033C44.2986 41.452 42.7964 43.1429 42.4345 43.4051C39.6129 45.3154 37.4071 45.1007 34.9652 42.6588L31.148 38.8416L21.9926 47.997L27.7189 53.7233C34.5356 60.5412 41.0367 63.9976 47.0371 63.9976C47.0383 63.9976 47.0383 63.9976 47.0383 63.9976C51.4534 63.9976 55.5672 62.1217 59.2669 58.4232L62.2771 55.413C64.1068 53.5845 64.5233 50.821 63.313 48.5357Z","fill","white"],["id","fullscreen",1,"controls__icon"],["id","Vector","d","M57.8018 53.4382L44.3964 40.0328L40.0328 44.3964L53.4382 57.8018H43.0205V64H64V43.0205H57.8018V53.4382Z","fill","white"],["id","Vector_2","d","M44.3964 23.9803L57.8018 10.5618V20.9795H64V0H43.0205V6.1982H53.4382L40.0328 19.6036L44.3964 23.9803Z","fill","white"],["id","Vector_3","d","M19.6036 40.0328L6.1982 53.4382V43.0205H0V64H20.9795V57.8018H10.5618L23.9803 44.3964L19.6036 40.0328Z","fill","white"],["id","Vector_4","d","M20.9795 6.1982V0H0V20.9795H6.1982V10.5618L19.6036 23.9803L23.9803 19.6036L10.5618 6.1982H20.9795Z","fill","white"],["id","exit-full-screen",1,"controls__icon"],["id","fullscreen_x5F_exit"],["id","Vector","d","M49.172 54.828L58.344 64L64 58.344L54.828 49.172L64 40H40V64L49.172 54.828Z","fill","white"],["id","Vector_2","d","M0 24H24V0L14.828 9.172L5.75 0.086L0.094 5.742L9.172 14.828L0 24Z","fill","white"],["id","Vector_3","d","M0 58.344L5.656 64L14.828 54.828L24 64V40H0L9.172 49.172L0 58.344Z","fill","white"],["id","Vector_4","d","M40 24H64L54.828 14.828L63.922 5.742L58.266 0.086L49.172 9.172L40 0V24Z","fill","white"],[1,"controls__button","controls__button--rotate",3,"click"],["filter","url(#filter0_d_0_4)"],["d","M-4.81762e-07 34.7678V57.0215C-4.81762e-07 60.8696 3.13284 64 6.98275 64H57.016C60.8672 64 64 60.8696 64 57.0215V7.05508C64 3.20697 60.8672 0.0757321 57.016 0.0757321H34.6959C35.8972 1.3077 36.6961 2.93443 36.871 4.74067H57.0168C58.2942 4.74067 59.3335 5.77899 59.3335 7.05508V57.0216C59.3335 58.2969 58.2942 59.3352 57.0168 59.3352H6.98342C5.7062 59.3352 4.66761 58.2969 4.66761 57.0216V36.9389C2.90982 36.7703 1.27948 36.0149 -4.81762e-07 34.7678ZM10.7807 30.6654H26.0384L1.34093 5.97437C-0.02533 4.60686 -0.02533 2.39174 1.34093 1.02583C2.70813 -0.341677 4.92462 -0.341677 6.29089 1.02423L30.9883 25.7159V10.4614C30.9883 8.52907 32.5556 6.96139 34.4888 6.96139C35.4553 6.96139 36.3305 7.35214 36.9642 7.98612C37.5976 8.62116 37.9897 9.49543 37.9897 10.4613V34.1643C37.9897 36.0966 36.4228 37.6635 34.4896 37.6635H10.7807C8.84705 37.6635 7.28056 36.0974 7.28056 34.1643C7.28056 32.2312 8.84705 30.6654 10.7807 30.6654Z","fill","white"],["id","filter0_d_0_4","x","-4","y","0","width","72","height","72","filterUnits","userSpaceOnUse","color-interpolation-filters","sRGB"],["flood-opacity","0","result","BackgroundImageFix"],["in","SourceAlpha","type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0","result","hardAlpha"],["dy","4"],["stdDeviation","2"],["in2","hardAlpha","operator","out"],["type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"],["mode","normal","in2","BackgroundImageFix","result","effect1_dropShadow_0_4"],["mode","normal","in","SourceGraphic","in2","effect1_dropShadow_0_4","result","shape"]],template:function(i,r){1&i&&(ue(0,"div",0)(1,"div",1)(2,"button",2),zt("click",function(){return r.onToggleCamera()}),ue(3,"div",3),bs(),ue(4,"svg",4)(5,"g",5)(6,"g",6)(7,"g",7),pt(8,"path",8),ve()()(),ue(9,"g",9)(10,"g",6)(11,"g",7),pt(12,"path",10),ve()(),ue(13,"g",11)(14,"g",12),pt(15,"path",13),ve()()()()(),Rc(),ue(16,"p"),fr(17,"Camera"),ve()()(),ue(18,"div",1)(19,"button",2),zt("click",function(){return r.onToggleMicrophone()}),ue(20,"div",3),bs(),ue(21,"svg",4)(22,"g",14)(23,"g",15),pt(24,"path",16)(25,"path",17),ve()(),ue(26,"g",18),pt(27,"path",19),ve()()(),Rc(),ue(28,"p"),fr(29,"Mic"),ve()()(),an(30,aFe,22,7,"div",20)(31,cFe,18,2,"div",20),ue(32,"div",1)(33,"button",21),zt("click",function(){return r.onEndCall()}),ue(34,"div",3),bs(),ue(35,"svg",4)(36,"g",22)(37,"g",6),pt(38,"path",23)(39,"path",24)(40,"path",25),ve()()()(),Rc(),ue(41,"p"),fr(42,"End"),ve()()()()),2&i&&(wt("controls--small",r.smallScreenEnabled),Re(2),wt("controls__button--active",r.cameraEnabled),Re(3),wt("controls__icon--shown",r.cameraEnabled),Re(4),wt("controls__icon--shown",!r.cameraEnabled),Re(10),wt("controls__button--active",r.microphoneEnabled),Re(3),wt("controls__icon--shown",r.microphoneEnabled),Re(4),wt("controls__icon--shown",!r.microphoneEnabled),Re(4),ht("ngIf",!r.smallScreenEnabled),Re(),ht("ngIf",r.displaySmallScreen))},dependencies:[hm],styles:["[_nghost-%COMP%]{transition:.3s}.controls[_ngcontent-%COMP%]{background:#0000004d;bottom:0;display:flex;justify-content:center;padding:15px 0;position:absolute;left:0;width:100%}.controls--small[_ngcontent-%COMP%]{border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding:5px 0}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{height:32px;width:32px}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:16px;width:16px}.controls--small[_ngcontent-%COMP%]   .controls__item[_ngcontent-%COMP%]{margin:0}.controls--small[_ngcontent-%COMP%]   .controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:none}.controls__item[_ngcontent-%COMP%]{margin:0 5px;text-align:center}.controls__button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer}.controls__button[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#101316}.controls__button--active[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#0b73c9}.controls__button--active[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#158ef2}.controls__button--active.controls__button--rotate[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transform:translate(-50%,-50%) rotate(-180deg)}.controls__button--danger[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#d73b3d}.controls__button--danger[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#e06567}.controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;margin:8px 0 0}.controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#313a42;border-radius:50%;box-shadow:0 3px 8px #00000080;margin:auto;position:relative;height:60px;width:60px;transition:.3s}.controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%) rotate(0);height:32px;width:32px;transition:.3s}.controls__icon[_ngcontent-%COMP%]{opacity:0;transition:.3s}.controls__icon--shown[_ngcontent-%COMP%]{opacity:1}"],changeDetection:0})}}return e})(),SFe=(()=>{class e{constructor(){this.error=!1,this.connected=!0,this.ended=!1,this.small=!1}get color(){return this.ended?"#aaa":this.error?"#d73b3d":this.connected?"#37D425":"#1195E6"}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=sr({type:e,selectors:[["ngx-spinner"]],inputs:{text:"text",error:"error",connected:"connected",ended:"ended",small:"small"},decls:8,vars:9,consts:[[1,"spinner",3,"ngClass"],[1,"spinner__wrapper"],[1,"spinner__icon"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 32 32","fill","none"],["d","M5.25 5.5C3.45507 5.5 2 6.95508 2 8.75V19.25C2 21.0449 3.45507 22.5 5.25 22.5H14.75C16.5449 22.5 18 21.0449 18 19.25V8.75C18 6.95507 16.5449 5.5 14.75 5.5H5.25Z"],["d","M23.1232 20.6431L19.5 17.0935V10.9989L23.1121 7.3706C23.8988 6.58044 25.248 7.13753 25.248 8.25251V19.7502C25.248 20.8577 23.9143 21.4181 23.1232 20.6431Z"],[1,"spinner__cirle"],["class","spinner__text",4,"ngIf"],[1,"spinner__text"]],template:function(i,r){1&i&&(ue(0,"div",0)(1,"div",1)(2,"div",2),bs(),ue(3,"svg",3),pt(4,"path",4)(5,"path",5),ve()(),Rc(),pt(6,"div",6),an(7,dFe,2,1,"div",7),ve()()),2&i&&(ht("ngClass",PU(4,lFe,r.connected,r.ended,r.small,r.error)),Re(4),yi("fill",r.color),Re(),yi("fill",r.color),Re(2),ht("ngIf",!r.small))},dependencies:[gI,hm],styles:[".spinner[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;position:relative;transition:.3s}.spinner--connected[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#37d425}.spinner--ended[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:transparent}.spinner--error[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#d73b3d}.spinner--small[_ngcontent-%COMP%]{border-radius:10px;height:200px}.spinner--small[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-width:4px;height:80px;width:80px}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]{top:26px;transform:translate(-35%)}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.spinner__wrapper[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}.spinner__cirle[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 2s linear infinite;border:5px solid #1195E6;border-radius:50%;border-top-color:transparent;height:160px;margin:auto;width:160px;transition:.3s}.spinner__icon[_ngcontent-%COMP%]{left:50%;position:absolute;top:52px;transform:translate(-40%);transition:.3s}.spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px;transition:.3s}.spinner__text[_ngcontent-%COMP%]{color:#fff;font-size:1.3em;margin-top:25px;text-align:center}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"],changeDetection:0})}}return e})(),CFe=(()=>{class e{constructor(){this.started=Date.now()}ngOnInit(){this.time$=pb(0,1e3).pipe(Nt(()=>this.format(Date.now()-this.started)))}format(n){const i=Math.floor(n/1e3%60).toString().padStart(2,"0"),r=Math.floor(n/6e4%60).toString().padStart(2,"0");return[Math.floor(n/36e5%24).toString().padStart(2,"0"),r,i].join(":")}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=sr({type:e,selectors:[["ngx-timer"]],inputs:{started:"started"},decls:4,vars:3,consts:[[1,"timer"]],template:function(i,r){1&i&&(ue(0,"div",0)(1,"span"),fr(2),uE(3,"async"),ve()()),2&i&&(Re(2),Yl(hE(3,1,r.time$)))},dependencies:[EI],styles:[".timer[_ngcontent-%COMP%]{color:#fff;position:relative;text-align:center;z-index:1}.timer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#0000004d;border-radius:5px;padding:5px 10px}"],changeDetection:0})}}return e})();const IC_HIDDEN={opacity:0,"margin-top":"100%"},IC_SHOWN={opacity:1,"margin-top":0},dJ=_R("fade",[Mm(":enter",[ca(IC_HIDDEN),Pm("250ms ease-in-out",ca(IC_SHOWN))]),Mm(":leave",[ca(IC_SHOWN),Pm("250ms ease-in-out",ca(IC_HIDDEN))])]);let TFe=(()=>{class e extends lJ{constructor(n){super(n),this.fullScreen=!1}ngOnInit(){this.play(`assets/${this.data.outcome?"outcome":"income"}.mp3`)}ngOnDestroy(){this.stop()}onAcceptCall(){this.fullScreen=!0,this.cdr.markForCheck(),this.afterClosed.next(this.data)}onDeclineCall(){this.play("assets/cancel.mp3"),setTimeout(()=>this.closeDialog(null),200)}play(n,i=!0){this.audio&&this.stop(),this.audio=new Audio(n),this.audio.loop=i,this.audio.load(),this.audio.play()}stop(){this.audio.pause(),this.audio.remove()}static{this.\u0275fac=function(i){return new(i||e)(H(Ts))}}static{this.\u0275cmp=sr({type:e,selectors:[["ngx-video-call"]],inputs:{data:"data"},features:[Mt],decls:1,vars:1,consts:[["income",""],["class","video-call",3,"video-call--full-screen",4,"ngIf"],[1,"video-call"],[1,"video-call-user"],[1,"video-call-user__block","video-call-user__block--animated"],["alt","",1,"video-call-user__img",3,"src"],[1,"video-call-user__title"],[4,"ngIf","ngIfElse"],[1,"video-call__actions"],[4,"ngIf"],["aria-label","Decline",1,"video-call__button","video-call__button--decline",3,"click"],["aria-label","Accept",1,"video-call__button","video-call__button--accept",3,"click"]],template:function(i,r){1&i&&an(0,fFe,12,7,"div",1),2&i&&ht("ngIf",r.shown&&r.data)},dependencies:[hm],styles:['[_nghost-%COMP%]{display:block;height:100vh;position:relative}.video-call[_ngcontent-%COMP%]{background-image:linear-gradient(#3f51b5,#313a42);background-size:cover;border-radius:10px;box-shadow:0 5px 10px #0000001a;display:flex;flex-direction:column;height:100%;justify-content:flex-end;left:50%;max-height:400px;max-width:400px;position:absolute;top:50%;transform:translate(-50%,-50%);width:100%;z-index:5;transition:.3s}.video-call--full-screen[_ngcontent-%COMP%]{background-image:linear-gradient(#22292f);border-radius:0;max-height:100%;max-width:100%}.video-call-user[_ngcontent-%COMP%]{left:50%;position:absolute;text-align:center;top:50%;transform:translate(-50%,-55%);z-index:1}.video-call-user__block[_ngcontent-%COMP%]{background:#fff;border-radius:50%;border:solid 5px #fff;height:180px;margin:0 auto;transform:scale(1);width:180px}.video-call-user__block--animated[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_play 2s ease infinite;backface-visibility:hidden}.video-call-user__img[_ngcontent-%COMP%]{border-radius:50%;height:100%;left:0;object-fit:cover;position:absolute;top:0;width:100%}.video-call-user__title[_ngcontent-%COMP%]{color:#fff;font-size:1.2em;font-weight:700;margin:15px 0 0}.video-call__actions[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:10px 0}.video-call__button[_ngcontent-%COMP%]{border-radius:50%;box-shadow:0 0 #3f51b500,0 .05em .1em #0003;border:0;cursor:pointer;display:block;font-size:40px;height:1em;margin:0 5px;position:relative;transform:translateZ(0) scale(1);width:1em;transition:.3s}.video-call__button[_ngcontent-%COMP%]:before, .video-call__button[_ngcontent-%COMP%]:after{content:"";position:absolute}.video-call__button[_ngcontent-%COMP%]:before{background-color:#ffffff1a;border-radius:50%;height:1em;left:0;opacity:1;top:0;transform:translateZ(0) scale(0);width:1em}.video-call__button[_ngcontent-%COMP%]:after{background-position:50% 50%;background-repeat:no-repeat;background-size:cover;background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTYuNiAxMC44YzEuNCAyLjggMy44IDUuMSA2LjYgNi42bDIuMi0yLjJjLjMtLjMuNy0uNCAxLS4yIDEuMS40IDIuMy42IDMuNi42LjUgMCAxIC40IDEgMVYyMGMwIC41LS41IDEtMSAxLTkuNCAwLTE3LTcuNi0xNy0xNyAwLS42LjQtMSAxLTFoMy41Yy41IDAgMSAuNCAxIDEgMCAxLjIuMiAyLjUuNiAzLjYuMS40IDAgLjctLjIgMWwtMi4zIDIuMnoiIGZpbGw9IiNmZmZmZmYiLz48L3N2Zz4=);height:.5em;left:.25em;top:.25em;transform:translateZ(0);width:.5em;transition:.3s}.video-call__button--accept[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_phone-outer 3s infinite;background-color:#3f51b5}.video-call__button--accept[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_phone-inner 3s infinite}.video-call__button--accept[_ngcontent-%COMP%]:after{animation:_ngcontent-%COMP%_phone-icon 3s infinite}.video-call__button--decline[_ngcontent-%COMP%]{background-color:#d73b3d}.video-call__button--decline[_ngcontent-%COMP%]:hover{background-color:#ce2a2c}.video-call__button--decline[_ngcontent-%COMP%]:after{top:.28em;transform:translateZ(0) rotate(135deg)}@keyframes _ngcontent-%COMP%_play{0%{transform:scale(1)}15%{box-shadow:0 0 0 5px #9b9da466}25%{box-shadow:0 0 0 10px #9b9da466,0 0 0 20px #9b9da433}25%{box-shadow:0 0 0 15px #9b9da466,0 0 0 30px #9b9da433}}@keyframes _ngcontent-%COMP%_phone-outer{0%{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}33.3333%{box-shadow:0 0 #3f51b51a,0 .05em .1em #00000080;transform:translateZ(0) scale(1.1)}66.6666%{box-shadow:0 0 0 .5em #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}to{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}}@keyframes _ngcontent-%COMP%_phone-inner{0%{opacity:1;transform:translateZ(0) scale(0)}33.3333%{opacity:1;transform:translateZ(0) scale(.9)}66.6666%{opacity:0;transform:translateZ(0) scale(0)}to{opacity:0;transform:translateZ(0) scale(0)}}@keyframes _ngcontent-%COMP%_phone-icon{0%{transform:translateZ(0)}2%{transform:translate3d(.01em,0,0)}4%{transform:translate3d(-.01em,0,0)}6%{transform:translate3d(.01em,0,0)}8%{transform:translate3d(-.01em,0,0)}10%{transform:translate3d(.01em,0,0)}12%{transform:translate3d(-.01em,0,0)}14%{transform:translate3d(.01em,0,0)}16%{transform:translate3d(-.01em,0,0)}18%{transform:translate3d(.01em,0,0)}20%{transform:translate3d(-.01em,0,0)}22%{transform:translate3d(.01em,0,0)}24%{transform:translate3d(-.01em,0,0)}26%{transform:translate3d(.01em,0,0)}28%{transform:translate3d(-.01em,0,0)}30%{transform:translate3d(.01em,0,0)}32%{transform:translate3d(-.01em,0,0)}34%{transform:translate3d(.01em,0,0)}36%{transform:translate3d(-.01em,0,0)}38%{transform:translate3d(.01em,0,0)}40%{transform:translate3d(-.01em,0,0)}42%{transform:translate3d(.01em,0,0)}44%{transform:translate3d(-.01em,0,0)}46%{transform:translateZ(0)}}'],data:{animation:[dJ]},changeDetection:0})}}return e})(),wFe=(()=>{class e{constructor(n,i,r,o){this.document=n,this.componentFactoryResolver=i,this.appRef=r,this.injector=o,this.wrapperSelector="ngx-webrtc-wrapper"}open(n,i={}){return this.appendComponent(n,i)}appendComponent(n,i){const r=this.componentFactoryResolver.resolveComponentFactory(n).create(this.injector),{instance:o}=r;Object.keys(i).forEach(a=>o[a]=i[a]),this.appRef.attachView(r.hostView);const s=r.hostView.rootNodes[0];return this.getContainer().append(s),o.afterClosed.pipe(Ti(1),function TSe(e,t=Am){const n=pb(e,t);return mH(()=>n)}(250)).subscribe(()=>{this.appRef.detachView(r.hostView),r.destroy()}),o}getContainer(){let n=this.document.querySelector(`.${this.wrapperSelector}`);return n||(n=this.document.createElement("div"),n.setAttribute("class",this.wrapperSelector),n.setAttribute("style","position: fixed; top: 0; width: 100%; z-index: 1;"),this.document.body.appendChild(n)),n}static{this.\u0275fac=function(i){return new(i||e)(Z(Ut),Z(Iu),Z(sa),Z(Bi))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const uJ={connected:!1,loading:!0,statusText:"Initializing",started:null,ended:!1,error:!1},IFe={mode:"rtc",codec:"h264"};let hJ=(()=>{class e{constructor(n){this.config=n,this.agoraRTC=En,this.streamState=new Sr(uJ),this.remoteStreamVideoToggle=new Sr(!0),this.callEnd=new vt,this.localContainerId="local-video",this.remoteCalls=[],this.remoteStreamVideoToggle$=this.remoteStreamVideoToggle.asObservable(),this.streamState$=this.streamState.asObservable(),this.agoraRTC.checkSystemRequirements()||this.handleError(new Error("Web RTC is not supported in this browser"))}init(n,i,r,o=!1){return this.uid=n,this.agoraRTC.setLogLevel(o?0:4),this.client=this.agoraRTC.createClient(IFe),this.assignClientHandlers(),this.initLocalStream().then(()=>{this.client.join(this.config.AppID,i,r||null,this.uid).then(()=>{this.localTracks.videoTrack.play(this.localContainerId),this.client.publish(Object.values(this.localTracks)),this.streamState.next({...this.streamState.value,connected:!0,statusText:"Waiting others to join"})}).catch(s=>this.handleError(s))}),this.callEnd.asObservable()}deinit(){this.streamState.next(uJ)}endCall(){this.client.leave().then(()=>{this.stopLocalStream(),this.streamState.next({...this.streamState.value,started:null,loading:!0,statusText:"",ended:!0}),this.remoteCalls=[],DA(500).pipe(Ti(1)).subscribe(()=>this.callEnd.next())})}toggleVideo(n){this.localTracks&&this.localTracks.videoTrack.setMuted(n)}toggleAudio(n){this.localTracks&&this.localTracks.audioTrack.setMuted(n)}toggleFullScreen(n){n?document.exitFullscreen():document.documentElement.requestFullscreen()}isVideoEnabled(){return!!this.localTracks&&!this.localTracks.videoTrack.muted}isAudioEnabled(){return!!this.localTracks&&!this.localTracks.audioTrack.muted}assignClientHandlers(){this.client.on("user-joined",n=>{this.streamState.next({...this.streamState.value,started:Date.now(),loading:!1}),this.remoteCalls.length||this.remoteCalls.push(this.getRemoteId(n))}),this.client.on("user-published",(n,i)=>{const r=this.getRemoteId(n);this.client.subscribe(n,i).then(o=>{this.remoteCalls.includes(r)&&o.play(r)})}),this.client.on("user-info-updated",(n,i)=>{"mute-video"===i&&this.remoteStreamVideoToggle.next(!1),"unmute-video"===i&&this.remoteStreamVideoToggle.next(!0)}),this.client.on("user-left",()=>{this.endCall()})}initLocalStream(){return Promise.all([this.agoraRTC.createCameraVideoTrack(),this.agoraRTC.createMicrophoneAudioTrack()]).then(([n,i])=>{this.localTracks={audioTrack:i,videoTrack:n}}).catch(n=>{this.handleError(n)})}getRemoteId(n){return`remote_call-${n.uid}`}handleError(n){throw this.streamState.next({...this.streamState.value,statusText:n.message,error:!0}),this.stopLocalStream(),DA(5e3).pipe(Ti(1)).subscribe(()=>this.callEnd.next()),new Error(n.message)}stopLocalStream(){this.localTracks&&Object.values(this.localTracks).forEach(n=>{n.stop(),n.close()})}static{this.\u0275fac=function(i){return new(i||e)(Z("AgoraConfig"))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),RFe=(()=>{class e{onEnter(){this.subscription.unsubscribe(),this.setStyle(1)}onLeave(){this.hide()}constructor(n,i){this.renderer=n,this.el=i,this.subscription=new li,this.delay=5e3}ngOnInit(){this.hide()}hide(){this.subscription.unsubscribe(),this.subscription=DA(this.delay).pipe(Ti(1)).subscribe(()=>this.setStyle(0))}setStyle(n){this.renderer.setStyle(this.el.nativeElement,"opacity",n)}static{this.\u0275fac=function(i){return new(i||e)(H(ea),H(sn))}}static{this.\u0275dir=ye({type:e,selectors:[["","ngxToggle",""]],hostBindings:function(i,r){1&i&&zt("mouseenter",function(){return r.onEnter()})("mouseleave",function(){return r.onLeave()})}})}}return e})(),pJ=(()=>{class e extends lJ{constructor(n,i){super(i),this.webRtcService=n,this.animate=!0,this.displaySmallScreen=!1,this.debug=!1,this.callEnd=new Wt,this.smallScreenEnabled=!1,this.active=!1,this.streamState$=this.webRtcService.streamState$,this.remoteStreamVideoToggle$=this.webRtcService.remoteStreamVideoToggle$}ngOnInit(){this.webRtcService.init(this.uid,this.channel,this.token,this.debug).pipe(Ti(1)).subscribe(()=>{this.active=this.smallScreenEnabled,this.callEnd.emit(),this.closeDialog(!0)})}ngOnDestroy(){this.webRtcService.deinit()}get localContainerId(){return this.webRtcService.localContainerId}get remoteCalls(){return this.webRtcService.remoteCalls}get cameraEnabled(){return this.webRtcService.isVideoEnabled()}get microphoneEnabled(){return this.webRtcService.isAudioEnabled()}get fullScreenEnabled(){return!!document.fullscreenElement}onToggleCamera(n){this.webRtcService.toggleVideo(n)}onToggleMicrophone(n){this.webRtcService.toggleAudio(n)}onToggleFullScreen(n){this.webRtcService.toggleFullScreen(n)}onToggleSmallScreen(n){this.smallScreenEnabled=!n,this.active=!0}onEndCall(){this.webRtcService.endCall()}static{this.\u0275fac=function(i){return new(i||e)(H(hJ),H(Ts))}}static{this.\u0275cmp=sr({type:e,selectors:[["ngx-webrtc"]],hostVars:4,hostBindings:function(i,r){2&i&&wt("small-screen",r.smallScreenEnabled)("active",r.active)},inputs:{uid:"uid",token:"token",channel:"channel",animate:"animate",displaySmallScreen:"displaySmallScreen",debug:"debug"},outputs:{callEnd:"callEnd"},features:[Mt],decls:1,vars:1,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[1,"container"],[3,"error","text","connected","ended","small",4,"ngIf"],[3,"started",4,"ngIf"],[1,"container__local",3,"id"],["class","container__remote",3,"id","hidden",4,"ngFor","ngForOf"],[1,"container__user-icon"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","user","clip-path","url(#clip0)"],["id","Vector","d","M31.5439 30.829C35.7793 30.829 39.4468 29.3099 42.4434 26.3129C45.4399 23.3163 46.959 19.6498 46.959 15.414C46.959 11.1796 45.4399 7.51267 42.4429 4.51512C39.4458 1.51904 35.7788 0 31.5439 0C27.3081 0 23.6416 1.51904 20.645 4.51561C17.6484 7.51218 16.1289 11.1792 16.1289 15.414C16.1289 19.6498 17.6484 23.3168 20.6455 26.3134C23.6426 29.3095 27.3096 30.829 31.5439 30.829V30.829Z","fill","#0B73C9"],["id","Vector_2","d","M58.5161 49.2127C58.4297 47.9656 58.2549 46.6053 57.9976 45.1688C57.7378 43.7215 57.4033 42.3533 57.0029 41.1029C56.5894 39.8104 56.0269 38.534 55.3315 37.3109C54.6099 36.0414 53.7622 34.9359 52.811 34.0262C51.8164 33.0746 50.5986 32.3094 49.1904 31.7513C47.7871 31.1962 46.2319 30.9149 44.5684 30.9149C43.915 30.9149 43.2832 31.183 42.063 31.9774C41.312 32.4672 40.4336 33.0336 39.4531 33.66C38.6147 34.1942 37.479 34.6947 36.0762 35.1478C34.7075 35.5907 33.3179 35.8153 31.9463 35.8153C30.5747 35.8153 29.1855 35.5907 27.8154 35.1478C26.4141 34.6952 25.2783 34.1947 24.4409 33.6605C23.4697 33.0399 22.5908 32.4735 21.8286 31.9769C20.6099 31.1825 19.9775 30.9144 19.3242 30.9144C17.6602 30.9144 16.1055 31.1962 14.7026 31.7518C13.2954 32.309 12.0771 33.0741 11.0815 34.0267C10.1309 34.9369 9.28271 36.0419 8.56201 37.3109C7.86719 38.534 7.30469 39.8099 6.89062 41.1034C6.49072 42.3538 6.15625 43.7215 5.89648 45.1688C5.63916 46.6033 5.46436 47.9642 5.37793 49.2142C5.29297 50.4388 5.25 51.7098 5.25 52.9934C5.25 56.3343 6.31201 59.0388 8.40625 61.0335C10.4746 63.0017 13.2114 64.0002 16.5396 64.0002H47.356C50.6841 64.0002 53.4199 63.0022 55.4888 61.0335C57.5835 59.0403 58.6455 56.3352 58.6455 52.993C58.645 51.7034 58.6016 50.4314 58.5161 49.2127V49.2127Z","fill","#0B73C9"],["id","clip0"],["width","64","height","64","fill","#0B73C9"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall",4,"ngIf"],[3,"error","text","connected","ended","small"],[3,"started"],[1,"container__remote",3,"id"],["ngxToggle","",3,"toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall","cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen"]],template:function(i,r){1&i&&an(0,bFe,3,5,"div",0),2&i&&ht("ngIf",r.shown)},dependencies:[hB,hm,yFe,CFe,SFe,RFe,EI],styles:["ngx-timer[_ngcontent-%COMP%]{display:block;padding-top:25px}[_nghost-%COMP%]{bottom:0;max-width:100%;right:0;width:100%;transition:.3s}.active[_nghost-%COMP%]{position:fixed}.small-screen[_nghost-%COMP%]{max-width:210px}.small-screen[_nghost-%COMP%]   ngx-timer[_ngcontent-%COMP%]{padding-top:10px}.small-screen[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{border-radius:10px;box-shadow:#00000059 0 5px 15px;height:200px;max-width:200px;margin-right:10px;margin-bottom:10px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]{border-radius:10px;height:200px;width:200px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]    >div{border-radius:10px}.small-screen[_nghost-%COMP%]   .container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.container[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;max-width:100%;margin-left:auto;overflow:hidden;position:relative;transition:.3s}.container__local[_ngcontent-%COMP%]{border-radius:5px;height:20vh;opacity:1;overflow:hidden;position:absolute;right:1rem;top:1rem;width:20vw;z-index:1;transition:.3s}.container__local.hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden}.container__local[_ngcontent-%COMP%]:not(:empty){box-shadow:0 3px 8px #00000080}.container__remote[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;left:0;position:absolute;top:0;width:100vw;transition:.3s}.container__remote[_ngcontent-%COMP%]    >div{transition:.3s}.container__remote.hidden[_ngcontent-%COMP%]{display:none}.container__remote.hidden[_ngcontent-%COMP%] + .container__user-icon[_ngcontent-%COMP%]{display:block}.container__remote[_ngcontent-%COMP%]:empty{display:none}.container__user-icon[_ngcontent-%COMP%]{background:#0000004d;border-radius:50%;box-shadow:0 3px 8px #00000080;display:none;left:50%;padding:20px;position:absolute;top:50%;transform:translate(-50%,-50%)}.container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px}@media screen and (max-width: 769px){ngx-controls[_ngcontent-%COMP%]{opacity:1!important}}"],data:{animation:[dJ]},changeDetection:0})}}return e})(),AFe=(()=>{class e{constructor(n){this.dialog=n}open(n){const i=new vt,r=this.dialog.open(TFe,{data:n});return r.afterClosed.asObservable().pipe(Ds(o=>o?.channel?this.dialog.open(pJ,{uid:o.uid,token:o.token,channel:o.channel,debug:!!o.debug,displaySmallScreen:!0}).afterClosed.asObservable():Be(!1)),Ti(1),Wi(()=>i.next(!0))).subscribe(),{acceptCall:r.onAcceptCall.bind(r),close:r.closeDialog.bind(r),afterConfirmation:()=>r.afterClosed.asObservable().pipe(Ti(1)),afterCallEnd:()=>i.asObservable().pipe(Ti(1))}}static{this.\u0275fac=function(i){return new(i||e)(Z(wFe))}}static{this.\u0275prov=ae({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),DFe=(()=>{class e{static forRoot(n){return{ngModule:e,providers:[hJ,{provide:"AgoraConfig",useValue:n}]}}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e})}static{this.\u0275inj=In({imports:[FE]})}}return e})();const OFe=[{path:"",component:(()=>{class e{constructor(n,i,r,o,s){this.formBuilder=n,this.router=i,this.localStorage=r,this.videoCallDialogService=o,this.cdr=s,this.sessionKey="ngx-webrtc:channelId",this.outcome=!1}get channelId(){return this.localStorage.getItem(this.sessionKey)||"test-channel-ngx-webrtc"}get tooltipText(){return this.outcome?"Outcome":"Income"}ngOnInit(){this.form=this.formBuilder.group({channelId:[this.channelId,f3.required]})}onSubmit(){this.saveChannel(),this.router.navigate(["conference"],{queryParams:{...this.form.value}})}onModalOpen(){this.saveChannel(),this.dialog=this.videoCallDialogService.open({uid:String(Math.floor(100*Math.random())),channel:this.channelId,outcome:this.outcome,user:{name:"Test User",photoURL:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTvDtoEwuV9E2kHqNDi6MnBzXlefn8TfyrwgQ&usqp=CAU"},debug:!0});const n=setTimeout(()=>this.dialog?.close(),7e3);this.dialog.afterConfirmation().pipe($r(i=>!!i),Wi(()=>clearTimeout(n))).subscribe(),this.dialog.afterCallEnd().subscribe(()=>{clearTimeout(n),this.dialog=null,this.cdr.markForCheck()})}saveChannel(){const{channelId:n}=this.form.value;this.localStorage.setItem(this.sessionKey,n)}static{this.\u0275fac=function(i){return new(i||e)(H(yfe),H(yo),H(Storage),H(AFe),H(Ts))}}static{this.\u0275cmp=sr({type:e,selectors:[["app-home"]],decls:25,vars:8,consts:[[1,"home"],[1,"home__welcome"],[1,"home__form",3,"ngSubmit","formGroup"],[1,"home__wrapper","home__wrapper--center"],["src","assets/user.svg","alt","User",1,"user"],[1,"home__title"],["appearance","outline",1,"home__wrapper"],["matInput","","placeholder","Channel id","formControlName","channelId"],[1,"home__wrapper","home__wrapper--center","home__wrapper--buttons"],["mat-flat-button","","color","primary",1,"home__btn",3,"disabled"],["mat-raised-button","","type","button",1,"home__btn",3,"click","disabled"],[3,"change","click","checked","disabled","matTooltip"],[1,"home__footer"],["href","https://www.npmjs.com/package/ngx-webrtc-lib","target","_blank"],["viewBox","0 0 27.23 27.23"],["width","27.23","height","27.23","rx","2"],["fill","#fff","points","5.8 21.75 13.66 21.75 13.67 9.98 17.59 9.98 17.58 21.76 21.51 21.76 21.52 6.06 5.82 6.04 5.8 21.75"],["href","https://github.com/TarasMoskovych/ngx-webrtc","target","_blank"],["aria-hidden","true","role","img","viewBox","0 0 16 16","width","50","height","50",1,""],["fill-rule","evenodd","d","M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"]],template:function(i,r){1&i&&(ue(0,"div",0)(1,"div",1)(2,"form",2),zt("ngSubmit",function(){return!r.dialog&&r.onSubmit()}),ue(3,"div",3),pt(4,"img",4),ve(),ue(5,"h1",5),fr(6," Welcome "),ve(),ue(7,"mat-form-field",6)(8,"mat-label"),fr(9,"Channel Id"),ve(),pt(10,"input",7),ve(),ue(11,"div",8)(12,"button",9),fr(13,"Start / Join call"),ve(),ue(14,"button",10),zt("click",function(){return!r.dialog&&r.onModalOpen()}),fr(15,"Open Call Dialog "),ue(16,"mat-slide-toggle",11),zt("change",function(s){return r.outcome=s.checked})("click",function(s){return s.stopPropagation()}),ve()()()(),ue(17,"div",12)(18,"a",13),bs(),ue(19,"svg",14),pt(20,"rect",15)(21,"polygon",16),ve()(),Rc(),ue(22,"a",17),bs(),ue(23,"svg",18),pt(24,"path",19),ve()()()()()),2&i&&(Re(2),ht("formGroup",r.form),Re(5),wt("mat-focused",r.form.valid),Re(5),ht("disabled",r.form.invalid||!!r.dialog),Re(2),ht("disabled",r.form.invalid||!!r.dialog),Re(2),ht("checked",r.outcome)("disabled",!!r.dialog)("matTooltip",r.tooltipText))},dependencies:[J3,jE,F3,U3,Tm,JI,Yge,Wge,bR,$me,rve,yR],styles:[".home[_ngcontent-%COMP%]{align-items:center;background-color:#f2f2f2;display:flex;flex-wrap:wrap;justify-content:center;min-height:100vh;width:100%}.home__welcome[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 5px 10px #0000001a;overflow:hidden;padding:10px 35px;width:390px}.home__welcome[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{height:150px}.home__title[_ngcontent-%COMP%]{color:#333;display:block;font-size:30px;font-weight:500;margin:10px 0 60px;text-align:center}.home__wrapper[_ngcontent-%COMP%]{width:100%}.home__wrapper--center[_ngcontent-%COMP%]{text-align:center}.home__wrapper--buttons[_ngcontent-%COMP%]{align-items:center;display:flex}.home__btn[_ngcontent-%COMP%]{letter-spacing:normal}.home__btn[_ngcontent-%COMP%]:first-of-type{margin-right:5px}.home__btn[_ngcontent-%COMP%]:last-of-type{margin-left:5px}.home__footer[_ngcontent-%COMP%]{margin-top:30px;text-align:center}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:#333;cursor:pointer;height:24px;margin:0 5px;width:24px;transition:.3s}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]:hover{fill:#aaa}"],changeDetection:0})}}return e})()},{path:"conference",component:(()=>{class e{constructor(n,i){this.route=n,this.router=i,this.uid=String(Math.floor(100*Math.random()))}ngOnInit(){this.channel=this.route.snapshot.queryParams.channelId||"test-channel"}onCallEnd(){this.router.navigateByUrl("/")}static{this.\u0275fac=function(i){return new(i||e)(H(ld),H(yo))}}static{this.\u0275cmp=sr({type:e,selectors:[["app-conference"]],decls:1,vars:4,consts:[[3,"callEnd","animate","channel","debug","uid"]],template:function(i,r){1&i&&(ue(0,"ngx-webrtc",0),zt("callEnd",function(){return r.onCallEnd()}),ve()),2&i&&ht("animate",!1)("channel",r.channel)("debug",!0)("uid",r.uid)},dependencies:[pJ],changeDetection:0})}}return e})()},{path:"**",redirectTo:""}];let NFe=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=xn({type:e,bootstrap:[SSe]})}static{this.\u0275inj=In({providers:[{provide:Storage,useValue:window.localStorage}],imports:[jB,$Ee,DFe.forRoot(fH_configs),Sfe,fSe.forRoot(OFe),$ge,Zme,sve,r_e]})}}return e})();Rhe().bootstrapModule(NFe).catch(e=>console.error(e))}},Hp=>{Hp(Hp.s=829)}]);