(self.webpackChunkngx_webrtc=self.webpackChunkngx_webrtc||[]).push([[792],{803:(zl,uE,hE)=>{"use strict";function L(e,i){return Object.is(e,i)}let Ci=null,eo=!1,Gt=1;const Pt=Symbol("SIGNAL");function gt(e){const i=Ci;return Ci=e,i}const du={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function xn(e){if(eo)throw new Error("");if(null===Ci)return;Ci.consumerOnSignalRead(e);const i=Ci.nextProducerIndex++;gE(Ci),i<Ci.producerNode.length&&Ci.producerNode[i]!==e&&Go(Ci)&&mE(Ci.producerNode[i],Ci.producerIndexOfThis[i]),Ci.producerNode[i]!==e&&(Ci.producerNode[i]=e,Ci.producerIndexOfThis[i]=Go(Ci)?YO(e,Ci,i):0),Ci.producerLastReadVersion[i]=e.version}function Em(e){if((!Go(e)||e.dirty)&&(e.dirty||e.lastCleanEpoch!==Gt)){if(!e.producerMustRecompute(e)&&!Jh(e))return e.dirty=!1,void(e.lastCleanEpoch=Gt);e.producerRecomputeValue(e),e.dirty=!1,e.lastCleanEpoch=Gt}}function ti(e){if(void 0===e.liveConsumerNode)return;const i=eo;eo=!0;try{for(const t of e.liveConsumerNode)t.dirty||aT(t)}finally{eo=i}}function qO(){return!1!==Ci?.consumerAllowSignalWrites}function aT(e){e.dirty=!0,ti(e),e.consumerMarkedDirty?.(e)}function ym(e){return e&&(e.nextProducerIndex=0),gt(e)}function pE(e,i){if(gt(i),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(Go(e))for(let t=e.nextProducerIndex;t<e.producerNode.length;t++)mE(e.producerNode[t],e.producerIndexOfThis[t]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function Jh(e){gE(e);for(let i=0;i<e.producerNode.length;i++){const t=e.producerNode[i],s=e.producerLastReadVersion[i];if(s!==t.version||(Em(t),s!==t.version))return!0}return!1}function fE(e){if(gE(e),Go(e))for(let i=0;i<e.producerNode.length;i++)mE(e.producerNode[i],e.producerIndexOfThis[i]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function YO(e,i,t){if($O(e),0===e.liveConsumerNode.length&&Qh(e))for(let s=0;s<e.producerNode.length;s++)e.producerIndexOfThis[s]=YO(e.producerNode[s],e,s);return e.liveConsumerIndexOfThis.push(t),e.liveConsumerNode.push(i)-1}function mE(e,i){if($O(e),1===e.liveConsumerNode.length&&Qh(e))for(let s=0;s<e.producerNode.length;s++)mE(e.producerNode[s],e.producerIndexOfThis[s]);const t=e.liveConsumerNode.length-1;if(e.liveConsumerNode[i]=e.liveConsumerNode[t],e.liveConsumerIndexOfThis[i]=e.liveConsumerIndexOfThis[t],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,i<e.liveConsumerNode.length){const s=e.liveConsumerIndexOfThis[i],c=e.liveConsumerNode[i];gE(c),c.producerIndexOfThis[s]=i}}function Go(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function gE(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}function $O(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}function Qh(e){return void 0!==e.producerNode}function _E(e){const i=Object.create(bm);i.computation=e;const t=()=>{if(Em(i),xn(i),i.value===di)throw i.error;return i.value};return t[Pt]=i,t}const ep=Symbol("UNSET"),cT=Symbol("COMPUTING"),di=Symbol("ERRORED"),bm={...du,value:ep,dirty:!0,error:null,equal:L,producerMustRecompute:e=>e.value===ep||e.value===cT,producerRecomputeValue(e){if(e.value===cT)throw new Error("Detected cycle in computations.");const i=e.value;e.value=cT;const t=ym(e);let s;try{s=e.computation()}catch(c){s=di,e.error=c}finally{pE(e,t)}i!==ep&&i!==di&&s!==di&&e.equal(i,s)?e.value=i:(e.value=s,e.version++)}};let XO=function gs(){throw new Error};function Sm(){XO()}let uu=null;function jc(e,i){qO()||Sm(),e.equal(e.value,i)||(e.value=i,function $U(e){e.version++,function Ar(){Gt++}(),ti(e),uu?.()}(e))}const YU={...du,equal:L,value:void 0};function vn(e){return"function"==typeof e}function uT(e){const t=e(s=>{Error.call(s),s.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const ql=uT(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((s,c)=>`${c+1}) ${s.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function yE(e,i){if(e){const t=e.indexOf(i);0<=t&&e.splice(t,1)}}class Ri{constructor(i){this.initialTeardown=i,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let i;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const u of t)u.remove(this);else t.remove(this);const{initialTeardown:s}=this;if(vn(s))try{s()}catch(u){i=u instanceof ql?u.errors:[u]}const{_finalizers:c}=this;if(c){this._finalizers=null;for(const u of c)try{JO(u)}catch(f){i=i??[],f instanceof ql?i=[...i,...f.errors]:i.push(f)}}if(i)throw new ql(i)}}add(i){var t;if(i&&i!==this)if(this.closed)JO(i);else{if(i instanceof Ri){if(i.closed||i._hasParent(this))return;i._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(i)}}_hasParent(i){const{_parentage:t}=this;return t===i||Array.isArray(t)&&t.includes(i)}_addParent(i){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(i),t):t?[t,i]:i}_removeParent(i){const{_parentage:t}=this;t===i?this._parentage=null:Array.isArray(t)&&yE(t,i)}remove(i){const{_finalizers:t}=this;t&&yE(t,i),i instanceof Ri&&i._removeParent(this)}}Ri.EMPTY=(()=>{const e=new Ri;return e.closed=!0,e})();const Hc=Ri.EMPTY;function hT(e){return e instanceof Ri||e&&"closed"in e&&vn(e.remove)&&vn(e.add)&&vn(e.unsubscribe)}function JO(e){vn(e)?e():e.unsubscribe()}const or={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},to={setTimeout(e,i,...t){const{delegate:s}=to;return s?.setTimeout?s.setTimeout(e,i,...t):setTimeout(e,i,...t)},clearTimeout(e){const{delegate:i}=to;return(i?.clearTimeout||clearTimeout)(e)},delegate:void 0};function bE(e){to.setTimeout(()=>{const{onUnhandledError:i}=or;if(!i)throw e;i(e)})}function tp(){}const XU=tc("C",void 0,void 0);function tc(e,i,t){return{kind:e,value:i,error:t}}let Yl=null;function np(e){if(or.useDeprecatedSynchronousErrorHandling){const i=!Yl;if(i&&(Yl={errorThrown:!1,error:null}),e(),i){const{errorThrown:t,error:s}=Yl;if(Yl=null,t)throw s}}else e()}class SE extends Ri{constructor(i){super(),this.isStopped=!1,i?(this.destination=i,hT(i)&&i.add(this)):this.destination=nN}static create(i,t,s){return new ip(i,t,s)}next(i){this.isStopped?$l(function yo(e){return tc("N",e,void 0)}(i),this):this._next(i)}error(i){this.isStopped?$l(function QO(e){return tc("E",void 0,e)}(i),this):(this.isStopped=!0,this._error(i))}complete(){this.isStopped?$l(XU,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(i){this.destination.next(i)}_error(i){try{this.destination.error(i)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const tN=Function.prototype.bind;function CE(e,i){return tN.call(e,i)}class pu{constructor(i){this.partialObserver=i}next(i){const{partialObserver:t}=this;if(t.next)try{t.next(i)}catch(s){TE(s)}}error(i){const{partialObserver:t}=this;if(t.error)try{t.error(i)}catch(s){TE(s)}else TE(i)}complete(){const{partialObserver:i}=this;if(i.complete)try{i.complete()}catch(t){TE(t)}}}class ip extends SE{constructor(i,t,s){let c;if(super(),vn(i)||!i)c={next:i??void 0,error:t??void 0,complete:s??void 0};else{let u;this&&or.useDeprecatedNextContext?(u=Object.create(i),u.unsubscribe=()=>this.unsubscribe(),c={next:i.next&&CE(i.next,u),error:i.error&&CE(i.error,u),complete:i.complete&&CE(i.complete,u)}):c=i}this.destination=new pu(c)}}function TE(e){or.useDeprecatedSynchronousErrorHandling?function eN(e){or.useDeprecatedSynchronousErrorHandling&&Yl&&(Yl.errorThrown=!0,Yl.error=e)}(e):bE(e)}function $l(e,i){const{onStoppedNotification:t}=or;t&&to.setTimeout(()=>t(e,i))}const nN={closed:!0,next:tp,error:function ZU(e){throw e},complete:tp},pT="function"==typeof Symbol&&Symbol.observable||"@@observable";function Xl(e){return e}function iN(e){return 0===e.length?Xl:1===e.length?e[0]:function(t){return e.reduce((s,c)=>c(s),t)}}let ni=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const s=new e;return s.source=this,s.operator=t,s}subscribe(t,s,c){const u=function QU(e){return e&&e instanceof SE||function rp(e){return e&&vn(e.next)&&vn(e.error)&&vn(e.complete)}(e)&&hT(e)}(t)?t:new ip(t,s,c);return np(()=>{const{operator:f,source:_}=this;u.add(f?f.call(u,_):_?this._subscribe(u):this._trySubscribe(u))}),u}_trySubscribe(t){try{return this._subscribe(t)}catch(s){t.error(s)}}forEach(t,s){return new(s=rN(s))((c,u)=>{const f=new ip({next:_=>{try{t(_)}catch(E){u(E),f.unsubscribe()}},error:u,complete:c});this.subscribe(f)})}_subscribe(t){var s;return null===(s=this.source)||void 0===s?void 0:s.subscribe(t)}[pT](){return this}pipe(...t){return iN(t)(this)}toPromise(t){return new(t=rN(t))((s,c)=>{let u;this.subscribe(f=>u=f,f=>c(f),()=>s(u))})}}return e.create=i=>new e(i),e})();function rN(e){var i;return null!==(i=e??or.Promise)&&void 0!==i?i:Promise}const eV=uT(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Mt=(()=>{class e extends ni{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const s=new Wo(this,this);return s.operator=t,s}_throwIfClosed(){if(this.closed)throw new eV}next(t){np(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const s of this.currentObservers)s.next(t)}})}error(t){np(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:s}=this;for(;s.length;)s.shift().error(t)}})}complete(){np(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:s,isStopped:c,observers:u}=this;return s||c?Hc:(this.currentObservers=null,u.push(t),new Ri(()=>{this.currentObservers=null,yE(u,t)}))}_checkFinalizedStatuses(t){const{hasError:s,thrownError:c,isStopped:u}=this;s?t.error(c):u&&t.complete()}asObservable(){const t=new ni;return t.source=this,t}}return e.create=(i,t)=>new Wo(i,t),e})();class Wo extends Mt{constructor(i,t){super(),this.destination=i,this.source=t}next(i){var t,s;null===(s=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===s||s.call(t,i)}error(i){var t,s;null===(s=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===s||s.call(t,i)}complete(){var i,t;null===(t=null===(i=this.destination)||void 0===i?void 0:i.complete)||void 0===t||t.call(i)}_subscribe(i){var t,s;return null!==(s=null===(t=this.source)||void 0===t?void 0:t.subscribe(i))&&void 0!==s?s:Hc}}class bo extends Mt{constructor(i){super(),this._value=i}get value(){return this.getValue()}_subscribe(i){const t=super._subscribe(i);return!t.closed&&i.next(this._value),t}getValue(){const{hasError:i,thrownError:t,_value:s}=this;if(i)throw t;return this._throwIfClosed(),s}next(i){super.next(this._value=i)}}function oN(e){return vn(e?.lift)}function yi(e){return i=>{if(oN(i))return i.lift(function(t){try{return e(t,this)}catch(s){this.error(s)}});throw new TypeError("Unable to lift unknown Observable type")}}function ui(e,i,t,s,c){return new fT(e,i,t,s,c)}class fT extends SE{constructor(i,t,s,c,u,f){super(i),this.onFinalize=u,this.shouldUnsubscribe=f,this._next=t?function(_){try{t(_)}catch(E){i.error(E)}}:super._next,this._error=c?function(_){try{c(_)}catch(E){i.error(E)}finally{this.unsubscribe()}}:super._error,this._complete=s?function(){try{s()}catch(_){i.error(_)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var i;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(i=this.onFinalize)||void 0===i||i.call(this))}}}function Jt(e,i){return yi((t,s)=>{let c=0;t.subscribe(ui(s,u=>{s.next(e.call(i,u,c++))}))})}const mT="https://g.co/ng/security#xss";class se extends Error{constructor(i,t){super(function op(e,i){return`NG0${Math.abs(e)}${i?": "+i:""}`}(i,t)),this.code=i}}function Gc(e){return{toString:e}.toString()}function Wn(e){for(let i in e)if(e[i]===Wn)return i;throw Error("Could not find renamed property on target object.")}function lN(e,i){for(const t in i)i.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=i[t])}function mr(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(mr).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const i=e.toString();if(null==i)return""+i;const t=i.indexOf("\n");return-1===t?i:i.substring(0,t)}function _T(e,i){return null==e||""===e?null===i?"":i:null==i||""===i?e:e+" "+i}globalThis;const lp=Wn({__forward_ref__:Wn});function Fn(e){return e.__forward_ref__=Fn,e.toString=function(){return mr(this())},e}function ht(e){return En(e)?e():e}function En(e){return"function"==typeof e&&e.hasOwnProperty(lp)&&e.__forward_ref__===Fn}function Oe(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function qi(e){return{providers:e.providers||[],imports:e.imports||[]}}function RE(e){return hN(e,Jl)||hN(e,pN)}function hN(e,i){return e.hasOwnProperty(i)?e[i]:null}function AE(e){return e&&(e.hasOwnProperty(ET)||e.hasOwnProperty(sV))?e[ET]:null}const Jl=Wn({\u0275prov:Wn}),ET=Wn({\u0275inj:Wn}),pN=Wn({ngInjectableDef:Wn}),sV=Wn({ngInjectorDef:Wn});class Te{constructor(i,t){this._desc=i,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Oe({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Dr(e){return e&&!!e.\u0275providers}const Tm=Wn({\u0275cmp:Wn}),ST=Wn({\u0275dir:Wn}),CT=Wn({\u0275pipe:Wn}),Im=Wn({\u0275mod:Wn}),nc=Wn({\u0275fac:Wn}),wm=Wn({__NG_ELEMENT_ID__:Wn}),OE=Wn({__NG_ENV_ID__:Wn});function It(e){return"string"==typeof e?e:null==e?"":String(e)}function dp(e,i){throw new se(-201,!1)}var Yt=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Yt||{});let IT;function gN(){return IT}function Ko(e){const i=IT;return IT=e,i}function _N(e,i,t){const s=RE(e);return s&&"root"==s.providedIn?void 0===s.value?s.value=s.factory():s.value:t&Yt.Optional?null:void 0!==i?i:void dp()}const ic={},NE="__NG_DI_FLAG__",PE="ngTempTokenPath",lV=/\n/gm,vN="__source";let up;function td(e){const i=up;return up=e,i}function uV(e,i=Yt.Default){if(void 0===up)throw new se(-203,!1);return null===up?_N(e,void 0,i):up.get(e,i&Yt.Optional?null:void 0,i)}function ye(e,i=Yt.Default){return(gN()||uV)(ht(e),i)}function me(e,i=Yt.Default){return ye(e,kE(i))}function kE(e){return typeof e>"u"||"number"==typeof e?e:(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function LE(e){const i=[];for(let t=0;t<e.length;t++){const s=ht(e[t]);if(Array.isArray(s)){if(0===s.length)throw new se(900,!1);let c,u=Yt.Default;for(let f=0;f<s.length;f++){const _=s[f],E=Wc(_);"number"==typeof E?-1===E?c=_.token:u|=E:c=_}i.push(ye(c,u))}else i.push(ye(s))}return i}function Wc(e){return e[NE]}function Or(e,i){return e.hasOwnProperty(nc)?e[nc]:null}function hp(e,i){e.forEach(t=>Array.isArray(t)?hp(t,i):i(t))}function EN(e,i,t){i>=e.length?e.push(t):e.splice(i,0,t)}function Dm(e,i){return i>=e.length-1?e.pop():e.splice(i,1)[0]}function vs(e,i,t){let s=fp(e,i);return s>=0?e[1|s]=t:(s=~s,function UE(e,i,t,s){let c=e.length;if(c==i)e.push(t,s);else if(1===c)e.push(s,e[0]),e[0]=t;else{for(c--,e.push(e[c-1],e[c]);c>i;)e[c]=e[c-2],c--;e[i]=t,e[i+1]=s}}(e,s,i,t)),s}function pp(e,i){const t=fp(e,i);if(t>=0)return e[1|t]}function fp(e,i){return function yN(e,i,t){let s=0,c=e.length>>t;for(;c!==s;){const u=s+(c-s>>1),f=e[u<<t];if(i===f)return u<<t;f>i?c=u:s=u+1}return~(c<<t)}(e,i,1)}const gr={},dn=[],rc=new Te(""),Yo=new Te("",-1),OT=new Te("");class VE{get(i,t=ic){if(t===ic){const s=new Error(`NullInjectorError: No provider for ${mr(i)}!`);throw s.name="NullInjectorError",s}return t}}var BE=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(BE||{}),la=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(la||{}),zc=function(e){return e[e.None=0]="None",e[e.SignalBased=1]="SignalBased",e[e.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",e}(zc||{});function vV(e,i,t){let s=e.length;for(;;){const c=e.indexOf(i,t);if(-1===c)return c;if(0===c||e.charCodeAt(c-1)<=32){const u=i.length;if(c+u===s||e.charCodeAt(c+u)<=32)return c}t=c+1}}function NT(e,i,t){let s=0;for(;s<t.length;){const c=t[s];if("number"==typeof c){if(0!==c)break;s++;const u=t[s++],f=t[s++],_=t[s++];e.setAttribute(i,f,_,u)}else{const u=c,f=t[++s];PT(u)?e.setProperty(i,u,f):e.setAttribute(i,u,f),s++}}return s}function bN(e){return 3===e||4===e||6===e}function PT(e){return 64===e.charCodeAt(0)}function Om(e,i){if(null!==i&&0!==i.length)if(null===e||0===e.length)e=i.slice();else{let t=-1;for(let s=0;s<i.length;s++){const c=i[s];"number"==typeof c?t=c:0===t||SN(e,t,c,null,-1===t||2===t?i[++s]:null)}}return e}function SN(e,i,t,s,c){let u=0,f=e.length;if(-1===i)f=-1;else for(;u<e.length;){const _=e[u++];if("number"==typeof _){if(_===i){f=-1;break}if(_>i){f=u-1;break}}}for(;u<e.length;){const _=e[u];if("number"==typeof _)break;if(_===t){if(null===s)return void(null!==c&&(e[u+1]=c));if(s===e[u+1])return void(e[u+2]=c)}u++,null!==s&&u++,null!==c&&u++}-1!==f&&(e.splice(f,0,i),u=f+1),e.splice(u++,0,t),null!==s&&e.splice(u++,0,s),null!==c&&e.splice(u++,0,c)}const jE="ng-template";function MT(e,i,t,s){let c=0;if(s){for(;c<i.length&&"string"==typeof i[c];c+=2)if("class"===i[c]&&-1!==vV(i[c+1].toLowerCase(),t,0))return!0}else if(kT(e))return!1;if(c=i.indexOf(1,c),c>-1){let u;for(;++c<i.length&&"string"==typeof(u=i[c]);)if(u.toLowerCase()===t)return!0}return!1}function kT(e){return 4===e.type&&e.value!==jE}function he(e,i,t){return i===(4!==e.type||t?e.value:jE)}function EV(e,i,t){let s=4;const c=e.attrs,u=null!==c?function TN(e){for(let i=0;i<e.length;i++)if(bN(e[i]))return i;return e.length}(c):0;let f=!1;for(let _=0;_<i.length;_++){const E=i[_];if("number"!=typeof E){if(!f)if(4&s){if(s=2|1&s,""!==E&&!he(e,E,t)||""===E&&1===i.length){if(da(s))return!1;f=!0}}else if(8&s){if(null===c||!MT(e,c,E,t)){if(da(s))return!1;f=!0}}else{const S=i[++_],I=yV(E,c,kT(e),t);if(-1===I){if(da(s))return!1;f=!0;continue}if(""!==S){let P;if(P=I>u?"":c[I+1].toLowerCase(),2&s&&S!==P){if(da(s))return!1;f=!0}}}}else{if(!f&&!da(s)&&!da(E))return!1;if(f&&da(E))continue;f=!1,s=E|1&s}}return da(s)||f}function da(e){return!(1&e)}function yV(e,i,t,s){if(null===i)return-1;let c=0;if(s||!t){let u=!1;for(;c<i.length;){const f=i[c];if(f===e)return c;if(3===f||6===f)u=!0;else{if(1===f||2===f){let _=i[++c];for(;"string"==typeof _;)_=i[++c];continue}if(4===f)break;if(0===f){c+=4;continue}}c+=u?1:2}return-1}return function SV(e,i){let t=e.indexOf(4);if(t>-1)for(t++;t<e.length;){const s=e[t];if("number"==typeof s)return-1;if(s===i)return t;t++}return-1}(i,e)}function CN(e,i,t=!1){for(let s=0;s<i.length;s++)if(EV(e,i[s],t))return!0;return!1}function CV(e,i){e:for(let t=0;t<i.length;t++){const s=i[t];if(e.length===s.length){for(let c=0;c<e.length;c++)if(e[c]!==s[c])continue e;return!0}}return!1}function Nm(e,i){return e?":not("+i.trim()+")":i}function mp(e){let i=e[0],t=1,s=2,c="",u=!1;for(;t<e.length;){let f=e[t];if("string"==typeof f)if(2&s){const _=e[++t];c+="["+f+(_.length>0?'="'+_+'"':"")+"]"}else 8&s?c+="."+f:4&s&&(c+=" "+f);else""!==c&&!da(f)&&(i+=Nm(u,c),c=""),s=f,u=u||!da(s);t++}return""!==c&&(i+=Nm(u,c)),i}function no(e){return Gc(()=>{const i=FT(e),t={...i,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===BE.OnPush,directiveDefs:null,pipeDefs:null,dependencies:i.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||la.Emulated,styles:e.styles||dn,_:null,schemas:e.schemas||null,tView:null,id:""};HE(t);const s=e.dependencies;return t.directiveDefs=Pm(s,!1),t.pipeDefs=Pm(s,!0),t.id=function UT(e){let i=0;const t=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const c of t)i=Math.imul(31,i)+c.charCodeAt(0)|0;return i+=2147483648,"c"+i}(t),t})}function wV(e){return Wt(e)||Vi(e)}function LT(e){return null!==e}function sr(e){return Gc(()=>({type:e.type,bootstrap:e.bootstrap||dn,declarations:e.declarations||dn,imports:e.imports||dn,exports:e.exports||dn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function xT(e,i){if(null==e)return gr;const t={};for(const s in e)if(e.hasOwnProperty(s)){const c=e[s];let u,f,_=zc.None;Array.isArray(c)?(_=c[0],u=c[1],f=c[2]??u):(u=c,f=c),i?(t[u]=_!==zc.None?[s,_]:s,i[u]=f):t[u]=s}return t}function Ue(e){return Gc(()=>{const i=FT(e);return HE(i),i})}function To(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function Wt(e){return e[Tm]||null}function Vi(e){return e[ST]||null}function Di(e){return e[CT]||null}function io(e,i){const t=e[Im]||null;if(!t&&!0===i)throw new Error(`Type ${mr(e)} does not have '\u0275mod' property.`);return t}function FT(e){const i={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:i,inputTransforms:null,inputConfig:e.inputs||gr,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||dn,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:xT(e.inputs,i),outputs:xT(e.outputs),debugInfo:null}}function HE(e){e.features?.forEach(i=>i(e))}function Pm(e,i){if(!e)return null;const t=i?Di:wV;return()=>("function"==typeof e?e():e).map(s=>t(s)).filter(LT)}function mu(e){return{\u0275providers:e}}function RV(...e){return{\u0275providers:GE(0,e),\u0275fromNgModule:!0}}function GE(e,...i){const t=[],s=new Set;let c;const u=f=>{t.push(f)};return hp(i,f=>{const _=f;WE(_,u,[],s)&&(c||=[],c.push(_))}),void 0!==c&&Mm(c,u),t}function Mm(e,i){for(let t=0;t<e.length;t++){const{ngModule:s,providers:c}=e[t];VT(c,u=>{i(u,s)})}}function WE(e,i,t,s){if(!(e=ht(e)))return!1;let c=null,u=AE(e);const f=!u&&Wt(e);if(u||f){if(f&&!f.standalone)return!1;c=e}else{const E=e.ngModule;if(u=AE(E),!u)return!1;c=E}const _=s.has(c);if(f){if(_)return!1;if(s.add(c),f.dependencies){const E="function"==typeof f.dependencies?f.dependencies():f.dependencies;for(const S of E)WE(S,i,t,s)}}else{if(!u)return!1;{if(null!=u.imports&&!_){let S;s.add(c);try{hp(u.imports,I=>{WE(I,i,t,s)&&(S||=[],S.push(I))})}finally{}void 0!==S&&Mm(S,i)}if(!_){const S=Or(c)||(()=>new c);i({provide:c,useFactory:S,deps:dn},c),i({provide:OT,useValue:c,multi:!0},c),i({provide:rc,useValue:()=>ye(c),multi:!0},c)}const E=u.providers;if(null!=E&&!_){const S=e;VT(E,I=>{i(I,S)})}}}return c!==e&&void 0!==e.providers}function VT(e,i){for(let t of e)Dr(t)&&(t=t.\u0275providers),Array.isArray(t)?VT(t,i):i(t)}const AV=Wn({provide:String,useValue:Wn});function BT(e){return null!==e&&"object"==typeof e&&AV in e}function gu(e){return"function"==typeof e}const GT=new Te(""),KE={},DV={};let WT;function qE(){return void 0===WT&&(WT=new VE),WT}class $o{}class gp extends $o{get destroyed(){return this._destroyed}constructor(i,t,s,c){super(),this.parent=t,this.source=s,this.scopes=c,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,$E(i,f=>this.processProvider(f)),this.records.set(Yo,id(void 0,this)),c.has("environment")&&this.records.set($o,id(void 0,this));const u=this.records.get(GT);null!=u&&"string"==typeof u.value&&this.scopes.add(u.value),this.injectorDefTypes=new Set(this.get(OT,dn,Yt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;const i=gt(null);try{for(const s of this._ngOnDestroyHooks)s.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const s of t)s()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),gt(i)}}onDestroy(i){return this.assertNotDestroyed(),this._onDestroyHooks.push(i),()=>this.removeOnDestroy(i)}runInContext(i){this.assertNotDestroyed();const t=td(this),s=Ko(void 0);try{return i()}finally{td(t),Ko(s)}}get(i,t=ic,s=Yt.Default){if(this.assertNotDestroyed(),i.hasOwnProperty(OE))return i[OE](this);s=kE(s);const u=td(this),f=Ko(void 0);try{if(!(s&Yt.SkipSelf)){let E=this.records.get(i);if(void 0===E){const S=function MV(e){return"function"==typeof e||"object"==typeof e&&e instanceof Te}(i)&&RE(i);E=S&&this.injectableDefInScope(S)?id(zT(i),KE):null,this.records.set(i,E)}if(null!=E)return this.hydrate(i,E)}return(s&Yt.Self?qE():this.parent).get(i,t=s&Yt.Optional&&t===ic?null:t)}catch(_){if("NullInjectorError"===_.name){if((_[PE]=_[PE]||[]).unshift(mr(i)),u)throw _;return function hV(e,i,t,s){const c=e[PE];throw i[vN]&&c.unshift(i[vN]),e.message=function pV(e,i,t,s=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let c=mr(i);if(Array.isArray(i))c=i.map(mr).join(" -> ");else if("object"==typeof i){let u=[];for(let f in i)if(i.hasOwnProperty(f)){let _=i[f];u.push(f+":"+("string"==typeof _?JSON.stringify(_):mr(_)))}c=`{${u.join(", ")}}`}return`${t}${s?"("+s+")":""}[${c}]: ${e.replace(lV,"\n  ")}`}("\n"+e.message,c,t,s),e.ngTokenPath=c,e[PE]=null,e}(_,i,"R3InjectorError",this.source)}throw _}finally{Ko(f),td(u)}}resolveInjectorInitializers(){const i=gt(null),t=td(this),s=Ko(void 0);try{const u=this.get(rc,dn,Yt.Self);for(const f of u)f()}finally{td(t),Ko(s),gt(i)}}toString(){const i=[],t=this.records;for(const s of t.keys())i.push(mr(s));return`R3Injector[${i.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new se(205,!1)}processProvider(i){let t=gu(i=ht(i))?i:ht(i&&i.provide);const s=function YE(e){return BT(e)?id(void 0,e.useValue):id(km(e),KE)}(i);if(!gu(i)&&!0===i.multi){let c=this.records.get(t);c||(c=id(void 0,KE,!0),c.factory=()=>LE(c.multi),this.records.set(t,c)),t=i,c.multi.push(i)}this.records.set(t,s)}hydrate(i,t){const s=gt(null);try{return t.value===KE&&(t.value=DV,t.value=t.factory()),"object"==typeof t.value&&t.value&&function PV(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{gt(s)}}injectableDefInScope(i){if(!i.providedIn)return!1;const t=ht(i.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(i){const t=this._onDestroyHooks.indexOf(i);-1!==t&&this._onDestroyHooks.splice(t,1)}}function zT(e){const i=RE(e),t=null!==i?i.factory:Or(e);if(null!==t)return t;if(e instanceof Te)throw new se(204,!1);if(e instanceof Function)return function OV(e){if(e.length>0)throw new se(204,!1);const t=function oV(e){return e&&(e[Jl]||e[pN])||null}(e);return null!==t?()=>t.factory(e):()=>new e}(e);throw new se(204,!1)}function km(e,i,t){let s;if(gu(e)){const c=ht(e);return Or(c)||zT(c)}if(BT(e))s=()=>ht(e.useValue);else if(function zE(e){return!(!e||!e.useFactory)}(e))s=()=>e.useFactory(...LE(e.deps||[]));else if(function jT(e){return!(!e||!e.useExisting)}(e))s=()=>ye(ht(e.useExisting));else{const c=ht(e&&(e.useClass||e.provide));if(!function NV(e){return!!e.deps}(e))return Or(c)||zT(c);s=()=>new c(...LE(e.deps))}return s}function id(e,i,t=!1){return{factory:e,value:i,multi:t?[]:void 0}}function $E(e,i){for(const t of e)Array.isArray(t)?$E(t,i):t&&Dr(t)?$E(t.\u0275providers,i):i(t)}function Kc(e,i){e instanceof gp&&e.assertNotDestroyed();const s=td(e),c=Ko(void 0);try{return i()}finally{td(s),Ko(c)}}function XE(){return void 0!==gN()||null!=function wT(){return up}()}function KT(e){if(!XE())throw new se(-203,!1)}const ii=0,Ie=1,Ye=2,ar=3,ua=4,Fr=5,Io=6,qc=7,ri=8,cr=9,oc=10,pt=11,Fm=12,AN=13,vp=14,hi=15,Yc=16,_u=17,ha=18,vu=19,$T=20,pa=21,rd=22,Fs=23,He=25,JE=1,sc=7,Ep=9,Yi=10;var QE=function(e){return e[e.None=0]="None",e[e.HasTransplantedViews=2]="HasTransplantedViews",e}(QE||{});function vr(e){return Array.isArray(e)&&"object"==typeof e[JE]}function ro(e){return Array.isArray(e)&&!0===e[JE]}function XT(e){return!!(4&e.flags)}function od(e){return e.componentOffset>-1}function ac(e){return!(1&~e.flags)}function fa(e){return!!e.template}function Bm(e){return!!(512&e[Ye])}class HV{constructor(i,t,s){this.previousValue=i,this.currentValue=t,this.firstChange=s}isFirstChange(){return this.firstChange}}function n0(e,i,t,s){null!==i?i.applyValueToInputSignal(i,s):e[t]=s}function Xo(){return MN}function MN(e){return e.type.prototype.ngOnChanges&&(e.setInput=GV),kN}function kN(){const e=r0(this),i=e?.current;if(i){const t=e.previous;if(t===gr)e.previous=i;else for(let s in i)t[s]=i[s];e.current=null,this.ngOnChanges(i)}}function GV(e,i,t,s,c){const u=this.declaredInputs[s],f=r0(e)||function Hm(e,i){return e[jm]=i}(e,{previous:gr,current:null}),_=f.current||(f.current={}),E=f.previous,S=E[u];_[u]=new HV(S&&S.currentValue,t,E===gr),n0(e,i,c,t)}Xo.ngInherit=!0;const jm="__ngSimpleChanges__";function r0(e){return e[jm]||null}const cc=function(e,i,t){},LN="svg";function un(e){for(;Array.isArray(e);)e=e[ii];return e}function Eu(e,i){return un(i[e])}function Ur(e,i){return un(i[e.index])}function Wm(e,i){return e.data[i]}function yu(e,i){return e[i]}function Es(e,i){const t=i[e];return vr(t)?t:t[ii]}function yp(e){return!(128&~e[Ye])}function Vr(e,i){return null==i?null:e[i]}function ty(e){e[_u]=0}function zm(e){1024&e[Ye]||(e[Ye]|=1024,yp(e)&&Km(e))}function bu(e){return!!(9216&e[Ye]||e[Fs]?.dirty)}function s0(e){e[oc].changeDetectionScheduler?.notify(8),64&e[Ye]&&(e[Ye]|=1024),bu(e)&&Km(e)}function Km(e){e[oc].changeDetectionScheduler?.notify(0);let i=$c(e);for(;null!==i&&!(8192&i[Ye])&&(i[Ye]|=8192,yp(i));)i=$c(i)}function ny(e,i){if(!(256&~e[Ye]))throw new se(911,!1);null===e[pa]&&(e[pa]=[]),e[pa].push(i)}function $c(e){const i=e[ar];return ro(i)?i[ar]:i}const _t={lFrame:qN(null),bindingsEnabled:!0,skipHydrationRootTNode:null};let xN=!1;function ma(){return _t.bindingsEnabled}function Us(){return null!==_t.skipHydrationRootTNode}function ue(){return _t.lFrame.lView}function Bt(){return _t.lFrame.tView}function Zo(e){return _t.lFrame.contextLView=e,e[ri]}function oo(e){return _t.lFrame.contextLView=null,e}function Un(){let e=BN();for(;null!==e&&64===e.type;)e=e.parent;return e}function BN(){return _t.lFrame.currentTNode}function ga(e,i){const t=_t.lFrame;t.currentTNode=e,t.isParent=i}function l0(){return _t.lFrame.isParent}function d0(){_t.lFrame.isParent=!1}function u0(){return xN}function HN(e){xN=e}function so(){const e=_t.lFrame;let i=e.bindingRootIndex;return-1===i&&(i=e.bindingRootIndex=e.tView.bindingStartIndex),i}function _a(){return _t.lFrame.bindingIndex++}function Zc(e){const i=_t.lFrame,t=i.bindingIndex;return i.bindingIndex=i.bindingIndex+e,t}function ZV(e,i){const t=_t.lFrame;t.bindingIndex=t.bindingRootIndex=e,lc(i)}function lc(e){_t.lFrame.currentDirectiveIndex=e}function p0(){return _t.lFrame.currentQueryIndex}function oy(e){_t.lFrame.currentQueryIndex=e}function JV(e){const i=e[Ie];return 2===i.type?i.declTNode:1===i.type?e[Fr]:null}function KN(e,i,t){if(t&Yt.SkipSelf){let c=i,u=e;for(;!(c=c.parent,null!==c||t&Yt.Host||(c=JV(u),null===c||(u=u[vp],10&c.type))););if(null===c)return!1;i=c,e=u}const s=_t.lFrame=sy();return s.currentTNode=i,s.lView=e,!0}function f0(e){const i=sy(),t=e[Ie];_t.lFrame=i,i.currentTNode=t.firstChild,i.lView=e,i.tView=t,i.contextLView=e,i.bindingIndex=t.bindingStartIndex,i.inI18n=!1}function sy(){const e=_t.lFrame,i=null===e?null:e.child;return null===i?qN(e):i}function qN(e){const i={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=i),i}function YN(){const e=_t.lFrame;return _t.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const $N=YN;function m0(){const e=YN();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Br(){return _t.lFrame.selectedIndex}function sd(e){_t.lFrame.selectedIndex=e}function oi(){const e=_t.lFrame;return Wm(e.tView,e.selectedIndex)}function va(){_t.lFrame.currentNamespace=LN}function Ea(){!function g0(){_t.lFrame.currentNamespace=null}()}let Ym=!0;function Cp(){return Ym}function dc(e){Ym=e}function Tp(e,i){for(let t=i.directiveStart,s=i.directiveEnd;t<s;t++){const u=e.data[t].type.prototype,{ngAfterContentInit:f,ngAfterContentChecked:_,ngAfterViewInit:E,ngAfterViewChecked:S,ngOnDestroy:I}=u;f&&(e.contentHooks??=[]).push(-t,f),_&&((e.contentHooks??=[]).push(t,_),(e.contentCheckHooks??=[]).push(t,_)),E&&(e.viewHooks??=[]).push(-t,E),S&&((e.viewHooks??=[]).push(t,S),(e.viewCheckHooks??=[]).push(t,S)),null!=I&&(e.destroyHooks??=[]).push(t,I)}}function ay(e,i,t){ZN(e,i,3,t)}function $m(e,i,t,s){(3&e[Ye])===t&&ZN(e,i,t,s)}function cy(e,i){let t=e[Ye];(3&t)===i&&(t&=16383,t+=1,e[Ye]=t)}function ZN(e,i,t,s){const u=s??-1,f=i.length-1;let _=0;for(let E=void 0!==s?65535&e[_u]:0;E<f;E++)if("number"==typeof i[E+1]){if(_=i[E],null!=s&&_>=s)break}else i[E]<0&&(e[_u]+=65536),(_<u||-1==u)&&(JN(e,t,i,E),e[_u]=(4294901760&e[_u])+E+2),E++}function v0(e,i){cc(4,e,i);const t=gt(null);try{i.call(e)}finally{gt(t),cc(5,e,i)}}function JN(e,i,t,s){const c=t[s]<0,u=t[s+1],_=e[c?-t[s]:t[s]];c?e[Ye]>>14<e[_u]>>16&&(3&e[Ye])===i&&(e[Ye]+=16384,v0(_,u)):v0(_,u)}const Ip=-1;class Xm{constructor(i,t,s){this.factory=i,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=s}}const Zm={};class Tu{constructor(i,t){this.injector=i,this.parentInjector=t}get(i,t,s){s=kE(s);const c=this.injector.get(i,Zm,s);return c!==Zm||t===Zm?c:this.parentInjector.get(i,t,s)}}function Jm(e){return e!==Ip}function Qm(e){return 32767&e}function eg(e,i){let t=function tP(e){return e>>16}(e),s=i;for(;t>0;)s=s[vp],t--;return s}let ly=!0;function dy(e){const i=ly;return ly=e,i}const E0=255,nP=5;let iP=0;const Bs={};function uy(e,i){const t=y0(e,i);if(-1!==t)return t;const s=i[Ie];s.firstCreatePass&&(e.injectorIndex=i.length,Iu(s.data,e),Iu(i,null),Iu(s.blueprint,null));const c=ad(e,i),u=e.injectorIndex;if(Jm(c)){const f=Qm(c),_=eg(c,i),E=_[Ie].data;for(let S=0;S<8;S++)i[u+S]=_[f+S]|E[f+S]}return i[u+8]=c,u}function Iu(e,i){e.push(0,0,0,0,0,0,0,0,i)}function y0(e,i){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===i[e.injectorIndex+8]?-1:e.injectorIndex}function ad(e,i){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let t=0,s=null,c=i;for(;null!==c;){if(s=S0(c),null===s)return Ip;if(t++,c=c[vp],-1!==s.injectorIndex)return s.injectorIndex|t<<16}return Ip}function cd(e,i,t){!function oB(e,i,t){let s;"string"==typeof t?s=t.charCodeAt(0)||0:t.hasOwnProperty(wm)&&(s=t[wm]),null==s&&(s=t[wm]=iP++);const c=s&E0;i.data[e+(c>>nP)]|=1<<c}(e,i,t)}function hy(e,i,t){if(t&Yt.Optional||void 0!==e)return e;dp()}function tg(e,i,t,s){if(t&Yt.Optional&&void 0===s&&(s=null),!(t&(Yt.Self|Yt.Host))){const c=e[cr],u=Ko(void 0);try{return c?c.get(i,s,t&Yt.Optional):_N(i,s,t&Yt.Optional)}finally{Ko(u)}}return hy(s,0,t)}function oP(e,i,t,s=Yt.Default,c){if(null!==e){if(2048&i[Ye]&&!(s&Yt.Self)){const f=function cB(e,i,t,s,c){let u=e,f=i;for(;null!==u&&null!==f&&2048&f[Ye]&&!(512&f[Ye]);){const _=sP(u,f,t,s|Yt.Self,Bs);if(_!==Bs)return _;let E=u.parent;if(!E){const S=f[$T];if(S){const I=S.get(t,Bs,s);if(I!==Bs)return I}E=S0(f),f=f[vp]}u=E}return c}(e,i,t,s,Bs);if(f!==Bs)return f}const u=sP(e,i,t,s,Bs);if(u!==Bs)return u}return tg(i,t,s,c)}function sP(e,i,t,s,c){const u=function aB(e){if("string"==typeof e)return e.charCodeAt(0)||0;const i=e.hasOwnProperty(wm)?e[wm]:void 0;return"number"==typeof i?i>=0?i&E0:cP:i}(t);if("function"==typeof u){if(!KN(i,e,s))return s&Yt.Host?hy(c,0,s):tg(i,t,s,c);try{let f;if(f=u(s),null!=f||s&Yt.Optional)return f;dp()}finally{$N()}}else if("number"==typeof u){let f=null,_=y0(e,i),E=Ip,S=s&Yt.Host?i[hi][Fr]:null;for((-1===_||s&Yt.SkipSelf)&&(E=-1===_?ad(e,i):i[_+8],E!==Ip&&py(s,!1)?(f=i[Ie],_=Qm(E),i=eg(E,i)):_=-1);-1!==_;){const I=i[Ie];if(aP(u,_,I.data)){const P=sB(_,i,t,f,s,S);if(P!==Bs)return P}E=i[_+8],E!==Ip&&py(s,i[Ie].data[_+8]===S)&&aP(u,_,i)?(f=I,_=Qm(E),i=eg(E,i)):_=-1}}return c}function sB(e,i,t,s,c,u){const f=i[Ie],_=f.data[e+8],I=ng(_,f,t,null==s?od(_)&&ly:s!=f&&!!(3&_.type),c&Yt.Host&&u===_);return null!==I?wu(i,f,I,_):Bs}function ng(e,i,t,s,c){const u=e.providerIndexes,f=i.data,_=1048575&u,E=e.directiveStart,I=u>>20,U=c?_+I:e.directiveEnd;for(let B=s?_:_+I;B<U;B++){const G=f[B];if(B<E&&t===G||B>=E&&G.type===t)return B}if(c){const B=f[E];if(B&&fa(B)&&B.type===t)return E}return null}function wu(e,i,t,s){let c=e[t];const u=i.data;if(function tB(e){return e instanceof Xm}(c)){const f=c;f.resolving&&function cV(e,i){throw i&&i.join(" > "),new se(-200,e)}(function ln(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():It(e)}(u[t]));const _=dy(f.canSeeViewProviders);f.resolving=!0;const S=f.injectImpl?Ko(f.injectImpl):null;KN(e,s,Yt.Default);try{c=e[t]=f.factory(void 0,u,e,s),i.firstCreatePass&&t>=s.directiveStart&&function XN(e,i,t){const{ngOnChanges:s,ngOnInit:c,ngDoCheck:u}=i.type.prototype;if(s){const f=MN(i);(t.preOrderHooks??=[]).push(e,f),(t.preOrderCheckHooks??=[]).push(e,f)}c&&(t.preOrderHooks??=[]).push(0-e,c),u&&((t.preOrderHooks??=[]).push(e,u),(t.preOrderCheckHooks??=[]).push(e,u))}(t,u[t],i)}finally{null!==S&&Ko(S),dy(_),f.resolving=!1,$N()}}return c}function aP(e,i,t){return!!(t[i+(e>>nP)]&1<<e)}function py(e,i){return!(e&Yt.Self||e&Yt.Host&&i)}class Ti{constructor(i,t){this._tNode=i,this._lView=t}get(i,t,s){return oP(this._tNode,this._lView,i,kE(s),t)}}function cP(){return new Ti(Un(),ue())}function yn(e){return Gc(()=>{const i=e.prototype.constructor,t=i[nc]||b0(i),s=Object.prototype;let c=Object.getPrototypeOf(e.prototype).constructor;for(;c&&c!==s;){const u=c[nc]||b0(c);if(u&&u!==t)return u;c=Object.getPrototypeOf(c)}return u=>new u})}function b0(e){return En(e)?()=>{const i=b0(ht(e));return i&&i()}:Or(e)}function S0(e){const i=e[Ie],t=i.type;return 2===t?i.declTNode:1===t?e[Fr]:null}function gy(e,i=null,t=null,s){const c=Dp(e,i,t,s);return c.resolveInjectorInitializers(),c}function Dp(e,i=null,t=null,s,c=new Set){const u=[t||dn,RV(e)];return s=s||("object"==typeof e?void 0:mr(e)),new gp(u,i||qE(),s||null,c)}class Oi{static{this.THROW_IF_NOT_FOUND=ic}static{this.NULL=new VE}static create(i,t){if(Array.isArray(i))return gy({name:""},t,i,"");{const s=i.name??"";return gy({name:s},i.parent,i.providers,s)}}static{this.\u0275prov=Oe({token:Oi,providedIn:"any",factory:()=>ye(Yo)})}static{this.__NG_ELEMENT_ID__=-1}}new Te("").__NG_ELEMENT_ID__=e=>{const i=Un();if(null===i)throw new se(204,!1);if(2&i.type)return i.value;if(e&Yt.Optional)return null;throw new se(204,!1)};function _y(e){return e.ngOriginalError}const Ru=!0;let Au=(()=>{class e{static{this.__NG_ELEMENT_ID__=O0}static{this.__NG_ENV_ID__=t=>t}}return e})();class D0 extends Au{constructor(i){super(),this._lView=i}onDestroy(i){return ny(this._lView,i),()=>function iy(e,i){if(null===e[pa])return;const t=e[pa].indexOf(i);-1!==t&&e[pa].splice(t,1)}(this._lView,i)}}function O0(){return new D0(ue())}let ld=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new bo(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static{this.\u0275prov=Oe({token:e,providedIn:"root",factory:()=>new e})}}return e})();const Dn=class mB extends Mt{constructor(i=!1){super(),this.destroyRef=void 0,this.pendingTasks=void 0,this.__isAsync=i,XE()&&(this.destroyRef=me(Au,{optional:!0})??void 0,this.pendingTasks=me(ld,{optional:!0})??void 0)}emit(i){const t=gt(null);try{super.next(i)}finally{gt(t)}}subscribe(i,t,s){let c=i,u=t||(()=>null),f=s;if(i&&"object"==typeof i){const E=i;c=E.next?.bind(E),u=E.error?.bind(E),f=E.complete?.bind(E)}this.__isAsync&&(u=this.wrapInTimeout(u),c&&(c=this.wrapInTimeout(c)),f&&(f=this.wrapInTimeout(f)));const _=super.subscribe({next:c,error:u,complete:f});return i instanceof Ri&&i.add(_),_}wrapInTimeout(i){return t=>{const s=this.pendingTasks?.add();setTimeout(()=>{i(t),void 0!==s&&this.pendingTasks?.remove(s)})}}};function uc(...e){}function N0(e){let i,t;function s(){e=uc;try{void 0!==t&&"function"==typeof cancelAnimationFrame&&cancelAnimationFrame(t),void 0!==i&&clearTimeout(i)}catch{}}return i=setTimeout(()=>{e(),s()}),"function"==typeof requestAnimationFrame&&(t=requestAnimationFrame(()=>{e(),s()})),()=>s()}function pP(e){return queueMicrotask(()=>e()),()=>{e=uc}}const P0="isAngularZone",vy=P0+"_ID";let gB=0;class ft{constructor(i){this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Dn(!1),this.onMicrotaskEmpty=new Dn(!1),this.onStable=new Dn(!1),this.onError=new Dn(!1);const{enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:s=!1,shouldCoalesceRunChangeDetection:c=!1,scheduleInRootZone:u=Ru}=i;if(typeof Zone>"u")throw new se(908,!1);Zone.assertZonePatched();const f=this;f._nesting=0,f._outer=f._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(f._inner=f._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(f._inner=f._inner.fork(Zone.longStackTraceZoneSpec)),f.shouldCoalesceEventChangeDetection=!c&&s,f.shouldCoalesceRunChangeDetection=c,f.callbackScheduled=!1,f.scheduleInRootZone=u,function gP(e){const i=()=>{!function mP(e){function i(){N0(()=>{e.callbackScheduled=!1,Op(e),e.isCheckStableRunning=!0,Ey(e),e.isCheckStableRunning=!1})}e.isCheckStableRunning||e.callbackScheduled||(e.callbackScheduled=!0,e.scheduleInRootZone?Zone.root.run(()=>{i()}):e._outer.run(()=>{i()}),Op(e))}(e)},t=gB++;e._inner=e._inner.fork({name:"angular",properties:{[P0]:!0,[vy]:t,[vy+t]:!0},onInvokeTask:(s,c,u,f,_,E)=>{if(function by(e){return Du(e,"__ignore_ng_zone__")}(E))return s.invokeTask(u,f,_,E);try{return k0(e),s.invokeTask(u,f,_,E)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===f.type||e.shouldCoalesceRunChangeDetection)&&i(),yy(e)}},onInvoke:(s,c,u,f,_,E,S)=>{try{return k0(e),s.invoke(u,f,_,E,S)}finally{e.shouldCoalesceRunChangeDetection&&!e.callbackScheduled&&!function _P(e){return Du(e,"__scheduler_tick__")}(E)&&i(),yy(e)}},onHasTask:(s,c,u,f)=>{s.hasTask(u,f),c===u&&("microTask"==f.change?(e._hasPendingMicrotasks=f.microTask,Op(e),Ey(e)):"macroTask"==f.change&&(e.hasPendingMacrotasks=f.macroTask))},onHandleError:(s,c,u,f)=>(s.handleError(u,f),e.runOutsideAngular(()=>e.onError.emit(f)),!1)})}(f)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get(P0)}static assertInAngularZone(){if(!ft.isInAngularZone())throw new se(909,!1)}static assertNotInAngularZone(){if(ft.isInAngularZone())throw new se(909,!1)}run(i,t,s){return this._inner.run(i,t,s)}runTask(i,t,s,c){const u=this._inner,f=u.scheduleEventTask("NgZoneEvent: "+c,i,M0,uc,uc);try{return u.runTask(f,t,s)}finally{u.cancelTask(f)}}runGuarded(i,t,s){return this._inner.runGuarded(i,t,s)}runOutsideAngular(i){return this._outer.run(i)}}const M0={};function Ey(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Op(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&!0===e.callbackScheduled)}function k0(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function yy(e){e._nesting--,Ey(e)}class Np{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Dn,this.onMicrotaskEmpty=new Dn,this.onStable=new Dn,this.onError=new Dn}run(i,t,s){return i.apply(t,s)}runGuarded(i,t,s){return i.apply(t,s)}runOutsideAngular(i){return i()}runTask(i,t,s,c){return i.apply(t,s)}}function Du(e,i){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0]?.data?.[i]}class ya{constructor(){this._console=console}handleError(i){const t=this._findOriginalError(i);this._console.error("ERROR",i),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(i){let t=i&&_y(i);for(;t&&_y(t);)t=_y(t);return t||null}}const _B=new Te("",{providedIn:"root",factory:()=>{const e=me(ft),i=me(ya);return t=>e.runOutsideAngular(()=>i.handleError(t))}});function vB(){return Pp(Un(),ue())}function Pp(e,i){return new On(Ur(e,i))}let On=(()=>{class e{constructor(t){this.nativeElement=t}static{this.__NG_ELEMENT_ID__=vB}}return e})();function L0(e){return e instanceof On?e.nativeElement:e}function EB(){return this._results[Symbol.iterator]()}class Nu{get changes(){return this._changes??=new Dn}constructor(i=!1){this._emitDistinctChangesOnly=i,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;const t=Nu.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=EB)}get(i){return this._results[i]}map(i){return this._results.map(i)}filter(i){return this._results.filter(i)}find(i){return this._results.find(i)}reduce(i,t){return this._results.reduce(i,t)}forEach(i){this._results.forEach(i)}some(i){return this._results.some(i)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(i,t){this.dirty=!1;const s=function qo(e){return e.flat(Number.POSITIVE_INFINITY)}(i);(this._changesDetected=!function gV(e,i,t){if(e.length!==i.length)return!1;for(let s=0;s<e.length;s++){let c=e[s],u=i[s];if(t&&(c=t(c),u=t(u)),u!==c)return!1}return!0}(this._results,s,t))&&(this._results=s,this.length=s.length,this.last=s[this.length-1],this.first=s[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(i){this._onDirty=i}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}}function kp(e){return!(128&~e.flags)}const og=new Map;let yP=0;function Mu(e){og.delete(e[vu])}const Lp="__ngContext__";function ao(e,i){vr(i)?(e[Lp]=i[vu],function Cy(e){og.set(e[vu],e)}(i)):e[Lp]=i}function RP(e){return xp(e[Fm])}function AP(e){return xp(e[ua])}function xp(e){for(;null!==e&&!ro(e);)e=e[ua];return e}let sg;const Vp=new Te("",{providedIn:"root",factory:()=>MP}),MP="ng",kP=new Te(""),dd=new Te("",{providedIn:"platform",factory:()=>"unknown"}),tl=new Te(""),G0=new Te("",{providedIn:"root",factory:()=>function el(){if(void 0!==sg)return sg;if(typeof document<"u")return document;throw new se(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let LP=()=>null;function X0(e,i,t=!1){return LP(e,i,t)}const GP=new Te("",{providedIn:"root",factory:()=>!1});class XP{constructor(i){this.changingThisBreaksApplicationSecurity=i}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${mT})`}}function nl(e){return e instanceof XP?e.changingThisBreaksApplicationSecurity:e}const iM=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Wp=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(Wp||{});function pI(e){const i=function mg(){const e=ue();return e&&e[oc].sanitizer}();return i?i.sanitize(Wp.URL,e)||"":function le(e,i){const t=function eM(e){return e instanceof XP&&e.getTypeName()||null}(e);if(null!=t&&t!==i){if("ResourceURL"===t&&"URL"===i)return!0;throw new Error(`Required a safe ${i}, got a ${t} (see ${mT})`)}return t===i}(e,"URL")?nl(e):function Uy(e){return(e=String(e)).match(iM)?e:"unsafe:"+e}(It(e))}function Qo(e){return e instanceof Function?e():e}function ys(e){return"browser"===(e??me(Oi)).get(dd)}var ud=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(ud||{});let $y;function Xy(e,i){return $y(e,i)}function zp(e,i,t,s,c){if(null!=s){let u,f=!1;ro(s)?u=s:vr(s)&&(f=!0,s=s[ii]);const _=un(s);0===e&&null!==t?null==c?RM(i,t,_):Vu(i,t,_,c||null,!0):1===e&&null!==t?Vu(i,t,_,c||null,!0):2===e?function bg(e,i,t){e.removeChild(null,i,t)}(i,_,f):3===e&&i.destroyNode(_),null!=u&&function u3(e,i,t,s,c){const u=t[sc];u!==un(t)&&zp(i,e,s,u,c);for(let _=Yi;_<t.length;_++){const E=t[_];Qy(E[Ie],E,e,i,s,u)}}(i,e,u,t,c)}}function _g(e,i,t){return e.createElement(i,t)}function SI(e,i){i[oc].changeDetectionScheduler?.notify(9),Qy(e,i,i[pt],2,null,null)}function Jy(e,i){const t=e[Ep],s=i[ar];(vr(s)||i[hi]!==s[ar][hi])&&(e[Ye]|=QE.HasTransplantedViews),null===t?e[Ep]=[i]:t.push(i)}function CI(e,i){const t=e[Ep],s=t.indexOf(i);t.splice(s,1)}function vg(e,i){if(e.length<=Yi)return;const t=Yi+i,s=e[t];if(s){const c=s[Yc];null!==c&&c!==e&&CI(c,s),i>0&&(e[t-1][ua]=s[ua]);const u=Dm(e,Yi+i);!function a3(e,i){SI(e,i),i[ii]=null,i[Fr]=null}(s[Ie],s);const f=u[ha];null!==f&&f.detachView(u[Ie]),s[ar]=null,s[ua]=null,s[Ye]&=-129}return s}function Eg(e,i){if(!(256&i[Ye])){const t=i[pt];t.destroyNode&&Qy(e,i,t,3,null,null),function l3(e){let i=e[Fm];if(!i)return TI(e[Ie],e);for(;i;){let t=null;if(vr(i))t=i[Fm];else{const s=i[Yi];s&&(t=s)}if(!t){for(;i&&!i[ua]&&i!==e;)vr(i)&&TI(i[Ie],i),i=i[ar];null===i&&(i=e),vr(i)&&TI(i[Ie],i),t=i&&i[ua]}i=t}}(i)}}function TI(e,i){if(256&i[Ye])return;const t=gt(null);try{i[Ye]&=-129,i[Ye]|=256,i[Fs]&&fE(i[Fs]),function wM(e,i){let t;if(null!=e&&null!=(t=e.destroyHooks))for(let s=0;s<t.length;s+=2){const c=i[t[s]];if(!(c instanceof Xm)){const u=t[s+1];if(Array.isArray(u))for(let f=0;f<u.length;f+=2){const _=c[u[f]],E=u[f+1];cc(4,_,E);try{E.call(_)}finally{cc(5,_,E)}}else{cc(4,c,u);try{u.call(c)}finally{cc(5,c,u)}}}}}(e,i),function IM(e,i){const t=e.cleanup,s=i[qc];if(null!==t)for(let u=0;u<t.length-1;u+=2)if("string"==typeof t[u]){const f=t[u+3];f>=0?s[f]():s[-f].unsubscribe(),u+=2}else t[u].call(s[t[u+1]]);null!==s&&(i[qc]=null);const c=i[pa];if(null!==c){i[pa]=null;for(let u=0;u<c.length;u++)(0,c[u])()}}(e,i),1===i[Ie].type&&i[pt].destroy();const s=i[Yc];if(null!==s&&ro(i[ar])){s!==i[ar]&&CI(s,i);const c=i[ha];null!==c&&c.detachView(e)}Mu(i)}finally{gt(t)}}function pc(e,i,t){return function II(e,i,t){let s=i;for(;null!==s&&168&s.type;)s=(i=s).parent;if(null===s)return t[ii];{const{componentOffset:c}=s;if(c>-1){const{encapsulation:u}=e.data[s.directiveStart+c];if(u===la.None||u===la.Emulated)return null}return Ur(s,t)}}(e,i.parent,t)}function Vu(e,i,t,s,c){e.insertBefore(i,t,s,c)}function RM(e,i,t){e.appendChild(i,t)}function AM(e,i,t,s,c){null!==s?Vu(e,i,t,s,c):RM(e,i,t)}function wI(e,i){return e.parentNode(i)}function OM(e,i,t){return PM(e,i,t)}let yg,PM=function NM(e,i,t){return 40&e.type?Ur(e,t):null};function hd(e,i,t,s){const c=pc(e,s,i),u=i[pt],_=OM(s.parent||i[Fr],s,i);if(null!=c)if(Array.isArray(t))for(let E=0;E<t.length;E++)AM(u,c,t[E],_,!1);else AM(u,c,t,_,!1);void 0!==yg&&yg(u,s,i,t,c)}function rl(e,i){if(null!==i){const t=i.type;if(3&t)return Ur(i,e);if(4&t)return RI(-1,e[i.index]);if(8&t){const s=i.child;if(null!==s)return rl(e,s);{const c=e[i.index];return ro(c)?RI(-1,c):un(c)}}if(128&t)return rl(e,i.next);if(32&t)return Xy(i,e)()||un(e[i.index]);{const s=kM(e,i);return null!==s?Array.isArray(s)?s[0]:rl($c(e[hi]),s):rl(e,i.next)}}return null}function kM(e,i){return null!==i?e[hi][Fr].projection[i.projection]:null}function RI(e,i){const t=Yi+e+1;if(t<i.length){const s=i[t],c=s[Ie].firstChild;if(null!==c)return rl(s,c)}return i[sc]}function AI(e,i,t,s,c,u,f){for(;null!=t;){if(128===t.type){t=t.next;continue}const _=s[t.index],E=t.type;if(f&&0===i&&(_&&ao(un(_),s),t.flags|=2),32&~t.flags)if(8&E)AI(e,i,t.child,s,c,u,!1),zp(i,e,c,_,u);else if(32&E){const S=Xy(t,s);let I;for(;I=S();)zp(i,e,c,I,u);zp(i,e,c,_,u)}else 16&E?xM(e,i,s,t,c,u):zp(i,e,c,_,u);t=f?t.projectionNext:t.next}}function Qy(e,i,t,s,c,u){AI(t,s,e.firstChild,i,c,u,!1)}function xM(e,i,t,s,c,u){const f=t[hi],E=f[Fr].projection[s.projection];if(Array.isArray(E))for(let S=0;S<E.length;S++)zp(i,e,c,E[S],u);else{let S=E;const I=f[ar];kp(s)&&(S.flags|=128),AI(e,i,S,I,c,u,!0)}}function OI(e,i,t){""===t?e.removeAttribute(i,"class"):e.setAttribute(i,"class",t)}function UM(e,i,t){const{mergedAttrs:s,classes:c,styles:u}=t;null!==s&&NT(e,i,s),null!==c&&OI(e,i,c),null!==u&&function FM(e,i,t){e.setAttribute(i,"style",t)}(e,i,u)}const St={};function Ze(e=1){VM(Bt(),ue(),Br()+e,!1)}function VM(e,i,t,s){if(!s)if(3&~i[Ye]){const u=e.preOrderHooks;null!==u&&$m(i,u,0,t)}else{const u=e.preOrderCheckHooks;null!==u&&ay(i,u,t)}sd(t)}function re(e,i=Yt.Default){const t=ue();return null===t?ye(e,i):oP(Un(),t,ht(e),i)}function jM(e,i,t,s,c,u){const f=gt(null);try{let _=null;c&zc.SignalBased&&(_=i[s][Pt]),null!==_&&void 0!==_.transformFn&&(u=_.transformFn(u)),c&zc.HasDecoratorInputTransform&&(u=e.inputTransforms[s].call(i,u)),null!==e.setInput?e.setInput(i,_,u,t,s):n0(i,_,s,u)}finally{gt(f)}}function eb(e,i,t,s,c,u,f,_,E,S,I){const P=i.blueprint.slice();return P[ii]=c,P[Ye]=204|s,(null!==S||e&&2048&e[Ye])&&(P[Ye]|=2048),ty(P),P[ar]=P[vp]=e,P[ri]=t,P[oc]=f||e&&e[oc],P[pt]=_||e&&e[pt],P[cr]=E||e&&e[cr]||null,P[Fr]=u,P[vu]=function bB(){return yP++}(),P[Io]=I,P[$T]=S,P[hi]=2==i.type?e[hi]:P,P}function Bu(e,i,t,s,c){let u=e.data[i];if(null===u)u=function NI(e,i,t,s,c){const u=BN(),f=l0(),E=e.data[i]=function LI(e,i,t,s,c,u){let f=i?i.injectorIndex:-1,_=0;return Us()&&(_|=128),{type:t,index:s,insertBeforeIndex:null,injectorIndex:f,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:_,providerIndexes:0,value:c,attrs:u,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:i,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,f?u:u&&u.parent,t,i,s,c);return null===e.firstChild&&(e.firstChild=E),null!==u&&(f?null==u.child&&null!==E.parent&&(u.child=E):null===u.next&&(u.next=E,E.prev=u)),E}(e,i,t,s,c),function XV(){return _t.lFrame.inI18n}()&&(u.flags|=32);else if(64&u.type){u.type=t,u.value=s,u.attrs=c;const f=function Vs(){const e=_t.lFrame,i=e.currentTNode;return e.isParent?i:i.parent}();u.injectorIndex=null===f?-1:f.injectorIndex}return ga(u,!0),u}function Kp(e,i,t,s){if(0===t)return-1;const c=i.length;for(let u=0;u<t;u++)i.push(s),e.blueprint.push(s),e.data.push(null);return c}function PI(e,i,t,s,c){const u=Br(),f=2&s;try{sd(-1),f&&i.length>He&&VM(e,i,He,!1),cc(f?2:0,c),t(s,c)}finally{sd(u),cc(f?3:1,c)}}function MI(e,i,t){if(XT(i)){const s=gt(null);try{const u=i.directiveEnd;for(let f=i.directiveStart;f<u;f++){const _=e.data[f];_.contentQueries&&_.contentQueries(1,t[f],f)}}finally{gt(s)}}}function tb(e,i,t){ma()&&(function _3(e,i,t,s){const c=t.directiveStart,u=t.directiveEnd;od(t)&&function Tg(e,i,t){const s=Ur(i,e),c=HM(t);let f=16;t.signals?f=4096:t.onPush&&(f=64);const _=Ig(e,eb(e,c,null,f,s,i,null,e[oc].rendererFactory.createRenderer(s,t),null,null,null));e[i.index]=_}(i,t,e.data[c+t.componentOffset]),e.firstCreatePass||uy(t,i),ao(s,i);const f=t.initialInputs;for(let _=c;_<u;_++){const E=e.data[_],S=wu(i,e,_,t);ao(S,i),null!==f&&YM(0,_-c,S,E,0,f),fa(E)&&(Es(t.index,i)[ri]=wu(i,e,_,t))}}(e,i,t,Ur(t,i)),!(64&~t.flags)&&qM(e,i,t))}function nb(e,i,t=Ur){const s=i.localNames;if(null!==s){let c=i.index+1;for(let u=0;u<s.length;u+=2){const f=s[u+1],_=-1===f?t(i,e):e[f];e[c++]=_}}}function HM(e){const i=e.tView;return null===i||i.incompleteFirstPass?e.tView=kI(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):i}function kI(e,i,t,s,c,u,f,_,E,S,I){const P=He+s,U=P+c,B=function p3(e,i){const t=[];for(let s=0;s<i;s++)t.push(s<e?null:St);return t}(P,U),G="function"==typeof S?S():S;return B[Ie]={type:e,blueprint:B,template:t,queries:null,viewQuery:_,declTNode:i,data:B.slice().fill(null,P),bindingStartIndex:P,expandoStartIndex:U,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof u?u():u,pipeRegistry:"function"==typeof f?f():f,firstChild:null,schemas:E,consts:G,incompleteFirstPass:!1,ssrId:I}}let GM=()=>null;function Sg(e,i,t,s,c){for(let u in i){if(!i.hasOwnProperty(u))continue;const f=i[u];if(void 0===f)continue;s??={};let _,E=zc.None;Array.isArray(f)?(_=f[0],E=f[1]):_=f;let S=u;if(null!==c){if(!c.hasOwnProperty(u))continue;S=c[u]}0===e?ib(s,t,S,_,E):ib(s,t,S,_)}return s}function ib(e,i,t,s,c){let u;e.hasOwnProperty(t)?(u=e[t]).push(i,s):u=e[t]=[i,s],void 0!==c&&u.push(c)}function yr(e,i,t,s,c,u,f,_){const E=Ur(i,t);let I,S=i.inputs;!_&&null!=S&&(I=S[s])?(db(e,t,I,s,c),od(i)&&function Cg(e,i){const t=Es(i,e);16&t[Ye]||(t[Ye]|=64)}(t,i.index)):3&i.type&&(s=function rb(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(s),c=null!=f?f(c,i.value||"",s):c,u.setProperty(E,s,c))}function Ro(e,i,t,s){if(ma()){const c=null===s?null:{"":-1},u=function E3(e,i){const t=e.directiveRegistry;let s=null,c=null;if(t)for(let u=0;u<t.length;u++){const f=t[u];if(CN(i,f.selectors,!1))if(s||(s=[]),fa(f))if(null!==f.findHostDirectiveDefs){const _=[];c=c||new Map,f.findHostDirectiveDefs(f,_,c),s.unshift(..._,f),FI(e,i,_.length)}else s.unshift(f),FI(e,i,0);else c=c||new Map,f.findHostDirectiveDefs?.(f,s,c),s.push(f)}return null===s?null:[s,c]}(e,t);let f,_;null===u?f=_=null:[f,_]=u,null!==f&&xI(e,i,t,f,c,_),c&&function y3(e,i,t){if(i){const s=e.localNames=[];for(let c=0;c<i.length;c+=2){const u=t[i[c+1]];if(null==u)throw new se(-301,!1);s.push(i[c],u)}}}(t,s,c)}t.mergedAttrs=Om(t.mergedAttrs,t.attrs)}function xI(e,i,t,s,c,u){for(let S=0;S<s.length;S++)cd(uy(t,i),e,s[S].type);!function S3(e,i,t){e.flags|=1,e.directiveStart=i,e.directiveEnd=i+t,e.providerIndexes=i}(t,e.data.length,s.length);for(let S=0;S<s.length;S++){const I=s[S];I.providersResolver&&I.providersResolver(I)}let f=!1,_=!1,E=Kp(e,i,s.length,null);for(let S=0;S<s.length;S++){const I=s[S];t.mergedAttrs=Om(t.mergedAttrs,I.hostAttrs),C3(e,t,i,E,I),b3(E,I,c),null!==I.contentQueries&&(t.flags|=4),(null!==I.hostBindings||null!==I.hostAttrs||0!==I.hostVars)&&(t.flags|=64);const P=I.type.prototype;!f&&(P.ngOnChanges||P.ngOnInit||P.ngDoCheck)&&((e.preOrderHooks??=[]).push(t.index),f=!0),!_&&(P.ngOnChanges||P.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(t.index),_=!0),E++}!function Sa(e,i,t){const c=i.directiveEnd,u=e.data,f=i.attrs,_=[];let E=null,S=null;for(let I=i.directiveStart;I<c;I++){const P=u[I],U=t?t.get(P):null,G=U?U.outputs:null;E=Sg(0,P.inputs,I,E,U?U.inputs:null),S=Sg(1,P.outputs,I,S,G);const K=null===E||null===f||kT(i)?null:T3(E,I,f);_.push(K)}null!==E&&(E.hasOwnProperty("class")&&(i.flags|=8),E.hasOwnProperty("style")&&(i.flags|=16)),i.initialInputs=_,i.inputs=E,i.outputs=S}(e,t,u)}function qM(e,i,t){const s=t.directiveStart,c=t.directiveEnd,u=t.index,f=function zN(){return _t.lFrame.currentDirectiveIndex}();try{sd(u);for(let _=s;_<c;_++){const E=e.data[_],S=i[_];lc(_),(null!==E.hostBindings||0!==E.hostVars||null!==E.hostAttrs)&&v3(E,S)}}finally{sd(-1),lc(f)}}function v3(e,i){null!==e.hostBindings&&e.hostBindings(1,i)}function FI(e,i,t){i.componentOffset=t,(e.components??=[]).push(i.index)}function b3(e,i,t){if(t){if(i.exportAs)for(let s=0;s<i.exportAs.length;s++)t[i.exportAs[s]]=e;fa(i)&&(t[""]=e)}}function C3(e,i,t,s,c){e.data[s]=c;const u=c.factory||(c.factory=Or(c.type)),f=new Xm(u,fa(c),re);e.blueprint[s]=f,t[s]=f,function ob(e,i,t,s,c){const u=c.hostBindings;if(u){let f=e.hostBindingOpCodes;null===f&&(f=e.hostBindingOpCodes=[]);const _=~i.index;(function sb(e){let i=e.length;for(;i>0;){const t=e[--i];if("number"==typeof t&&t<0)return t}return 0})(f)!=_&&f.push(_),f.push(t,s,u)}}(e,i,s,Kp(e,t,c.hostVars,St),c)}function Ca(e,i,t,s,c,u){const f=Ur(e,i);!function ol(e,i,t,s,c,u,f){if(null==u)e.removeAttribute(i,c,t);else{const _=null==f?It(u):f(u,s||"",c);e.setAttribute(i,c,_,t)}}(i[pt],f,u,e.value,t,s,c)}function YM(e,i,t,s,c,u){const f=u[i];if(null!==f)for(let _=0;_<f.length;)jM(s,t,f[_++],f[_++],f[_++],f[_++])}function T3(e,i,t){let s=null,c=0;for(;c<t.length;){const u=t[c];if(0!==u)if(5!==u){if("number"==typeof u)break;if(e.hasOwnProperty(u)){null===s&&(s=[]);const f=e[u];for(let _=0;_<f.length;_+=3)if(f[_]===i){s.push(u,f[_+1],f[_+2],t[c+1]);break}}c+=2}else c+=2;else c+=4}return s}function ab(e,i,t,s){return[e,!0,0,i,null,s,null,t,null,null]}function $M(e,i){const t=e.contentQueries;if(null!==t){const s=gt(null);try{for(let c=0;c<t.length;c+=2){const f=t[c+1];if(-1!==f){const _=e.data[f];oy(t[c]),_.contentQueries(2,i[f],f)}}}finally{gt(s)}}}function Ig(e,i){return e[Fm]?e[AN][ua]=i:e[Fm]=i,e[AN]=i,i}function UI(e,i,t){oy(0);const s=gt(null);try{i(e,t)}finally{gt(s)}}function cb(e){return e[qc]??=[]}function VI(e){return e.cleanup??=[]}function lb(e,i){const t=e[cr],s=t?t.get(ya,null):null;s&&s.handleError(i)}function db(e,i,t,s,c){for(let u=0;u<t.length;){const f=t[u++],_=t[u++],E=t[u++];jM(e.data[f],i[f],s,_,E,c)}}function XM(e,i){const t=Es(i,e),s=t[Ie];!function jI(e,i){for(let t=i.length;t<e.blueprint.length;t++)i.push(e.blueprint[t])}(s,t);const c=t[ii];null!==c&&null===t[Io]&&(t[Io]=X0(c,t[cr])),qp(s,t,t[ri])}function qp(e,i,t){f0(i);try{const s=e.viewQuery;null!==s&&UI(1,s,t);const c=e.template;null!==c&&PI(e,i,c,1,t),e.firstCreatePass&&(e.firstCreatePass=!1),i[ha]?.finishViewCreation(e),e.staticContentQueries&&$M(e,i),e.staticViewQueries&&UI(2,e.viewQuery,t);const u=e.components;null!==u&&function w3(e,i){for(let t=0;t<i.length;t++)XM(e,i[t])}(i,u)}catch(s){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),s}finally{i[Ye]&=-5,m0()}}function ce(e,i,t,s){const c=gt(null);try{const u=i.tView,E=eb(e,u,t,4096&e[Ye]?4096:16,null,i,null,null,s?.injector??null,s?.embeddedViewInjector??null,s?.dehydratedView??null);E[Yc]=e[i.index];const I=e[ha];return null!==I&&(E[ha]=I.createEmbeddedView(u)),qp(u,E,t),E}finally{gt(c)}}function kt(e,i){const t=Yi+i;if(t<e.length)return e[t]}function pd(e,i){return!i||null===i.firstChild||kp(e)}function ju(e,i,t,s=!0){const c=i[Ie];if(function TM(e,i,t,s){const c=Yi+s,u=t.length;s>0&&(t[c-1][ua]=i),s<u-Yi?(i[ua]=t[c],EN(t,Yi+s,i)):(t.push(i),i[ua]=null),i[ar]=t;const f=i[Yc];null!==f&&t!==f&&Jy(f,i);const _=i[ha];null!==_&&_.insertView(e),s0(i),i[Ye]|=128}(c,i,e,t),s){const f=RI(t,e),_=i[pt],E=wI(_,e[sc]);null!==E&&function c3(e,i,t,s,c,u){s[ii]=c,s[Fr]=i,Qy(e,s,t,1,c,u)}(c,e[Fr],_,i,E,f)}const u=i[Io];null!==u&&null!==u.firstChild&&(u.firstChild=null)}function wg(e,i){const t=vg(e,i);return void 0!==t&&Eg(t[Ie],t),t}function Yp(e,i,t,s,c=!1){for(;null!==t;){if(128===t.type){t=c?t.projectionNext:t.next;continue}const u=i[t.index];null!==u&&s.push(un(u)),ro(u)&&HI(u,s);const f=t.type;if(8&f)Yp(e,i,t.child,s);else if(32&f){const _=Xy(t,i);let E;for(;E=_();)s.push(E)}else if(16&f){const _=kM(i,t);if(Array.isArray(_))s.push(..._);else{const E=$c(i[hi]);Yp(E[Ie],E,_,s,!0)}}t=c?t.projectionNext:t.next}return s}function HI(e,i){for(let t=Yi;t<e.length;t++){const s=e[t],c=s[Ie].firstChild;null!==c&&Yp(s[Ie],s,c,i)}e[sc]!==e[ii]&&i.push(e[sc])}let ZM=[];const QM={...du,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{Km(e.lView)},consumerOnSignalRead(){this.lView[Fs]=this}},ek={...du,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{let i=$c(e.lView);for(;i&&!WI(i[Ie]);)i=$c(i);i&&zm(i)},consumerOnSignalRead(){this.lView[Fs]=this}};function WI(e){return 2!==e.type}const tk=100;function Rg(e,i=!0,t=0){const s=e[oc],c=s.rendererFactory;c.begin?.();try{!function A3(e,i){const t=u0();try{HN(!0),Hu(e,i);let s=0;for(;bu(e);){if(s===tk)throw new se(103,!1);s++,Hu(e,1)}}finally{HN(t)}}(e,t)}catch(f){throw i&&lb(e,f),f}finally{c.end?.(),s.inlineEffectRunner?.flush()}}function ik(e,i,t,s){const c=i[Ye];if(!(256&~c))return;i[oc].inlineEffectRunner?.flush(),f0(i);let _=!0,E=null,S=null;WI(e)?(S=function ub(e){return e[Fs]??function JM(e){const i=ZM.pop()??Object.create(QM);return i.lView=e,i}(e)}(i),E=ym(S)):null===function ec(){return Ci}()?(_=!1,S=function R3(e){const i=e[Fs]??Object.create(ek);return i.lView=e,i}(i),E=ym(S)):i[Fs]&&(fE(i[Fs]),i[Fs]=null);try{ty(i),function GN(e){return _t.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==t&&PI(e,i,t,2,s);const I=!(3&~c);if(I){const B=e.preOrderCheckHooks;null!==B&&ay(i,B,null)}else{const B=e.preOrderHooks;null!==B&&$m(i,B,0,null),cy(i,0)}if(function D3(e){for(let i=RP(e);null!==i;i=AP(i)){if(!(i[Ye]&QE.HasTransplantedViews))continue;const t=i[Ep];for(let s=0;s<t.length;s++)zm(t[s])}}(i),zI(i,0),null!==e.contentQueries&&$M(e,i),I){const B=e.contentCheckHooks;null!==B&&ay(i,B)}else{const B=e.contentHooks;null!==B&&$m(i,B,1),cy(i,1)}!function h3(e,i){const t=e.hostBindingOpCodes;if(null!==t)try{for(let s=0;s<t.length;s++){const c=t[s];if(c<0)sd(~c);else{const u=c,f=t[++s],_=t[++s];ZV(f,u),_(2,i[u])}}}finally{sd(-1)}}(e,i);const P=e.components;null!==P&&sk(i,P,0);const U=e.viewQuery;if(null!==U&&UI(2,U,s),I){const B=e.viewCheckHooks;null!==B&&ay(i,B)}else{const B=e.viewHooks;null!==B&&$m(i,B,2),cy(i,2)}if(!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),i[rd]){for(const B of i[rd])B();i[rd]=null}i[Ye]&=-73}catch(I){throw Km(i),I}finally{null!==S&&(pE(S,E),_&&function GI(e){e.lView[Fs]!==e&&(e.lView=null,ZM.push(e))}(S)),m0()}}function zI(e,i){for(let t=RP(e);null!==t;t=AP(t))for(let s=Yi;s<t.length;s++)ok(t[s],i)}function rk(e,i,t){ok(Es(i,e),t)}function ok(e,i){yp(e)&&Hu(e,i)}function Hu(e,i){const s=e[Ie],c=e[Ye],u=e[Fs];let f=!!(0===i&&16&c);if(f||=!!(64&c&&0===i),f||=!!(1024&c),f||=!(!u?.dirty||!Jh(u)),f||=!1,u&&(u.dirty=!1),e[Ye]&=-9217,f)ik(s,e,s.template,e[ri]);else if(8192&c){zI(e,1);const _=s.components;null!==_&&sk(e,_,1)}}function sk(e,i,t){for(let s=0;s<i.length;s++)rk(e,i[s],t)}function $p(e,i){const t=u0()?64:1088;for(e[oc].changeDetectionScheduler?.notify(i);e;){e[Ye]|=t;const s=$c(e);if(Bm(e)&&!s)return e;e=s}return null}class Ag{get rootNodes(){const i=this._lView,t=i[Ie];return Yp(t,i,t.firstChild,[])}constructor(i,t,s=!0){this._lView=i,this._cdRefInjectingView=t,this.notifyErrorHandler=s,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[ri]}set context(i){this._lView[ri]=i}get destroyed(){return!(256&~this._lView[Ye])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const i=this._lView[ar];if(ro(i)){const t=i[8],s=t?t.indexOf(this):-1;s>-1&&(vg(i,s),Dm(t,s))}this._attachedToViewContainer=!1}Eg(this._lView[Ie],this._lView)}onDestroy(i){ny(this._lView,i)}markForCheck(){$p(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[Ye]&=-129}reattach(){s0(this._lView),this._lView[Ye]|=128}detectChanges(){this._lView[Ye]|=1024,Rg(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new se(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;const i=Bm(this._lView),t=this._lView[Yc];null!==t&&!i&&CI(t,this._lView),SI(this._lView[Ie],this._lView)}attachToAppRef(i){if(this._attachedToViewContainer)throw new se(902,!1);this._appRef=i;const t=Bm(this._lView),s=this._lView[Yc];null!==s&&!t&&Jy(s,this._lView),s0(this._lView)}}let sl=(()=>{class e{static{this.__NG_ELEMENT_ID__=N3}}return e})();const O3=sl,ak=class extends O3{constructor(i,t,s){super(),this._declarationLView=i,this._declarationTContainer=t,this.elementRef=s}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(i,t){return this.createEmbeddedViewImpl(i,t)}createEmbeddedViewImpl(i,t,s){const c=ce(this._declarationLView,this._declarationTContainer,i,{embeddedViewInjector:t,dehydratedView:s});return new Ag(c)}};function N3(){return Dg(Un(),ue())}function Dg(e,i){return 4&e.type?new ak(i,e,Pp(e,i)):null}let Ak=()=>null;function Ia(e,i){return Ak(e,i)}class Zp{}const $u=new Te("",{providedIn:"root",factory:()=>!1}),Cb=new Te(""),Jp=new Te("");class sw{}class aw{}class Pk{resolveComponentFactory(i){throw function Nk(e){const i=Error(`No component factory found for ${mr(e)}.`);return i.ngComponent=e,i}(i)}}class Qp{static{this.NULL=new Pk}}class Tb{}let mc=(()=>{class e{constructor(){this.destroyNode=null}static{this.__NG_ELEMENT_ID__=()=>function Q3(){const e=ue(),t=Es(Un().index,e);return(vr(t)?t:e)[pt]}()}}return e})(),Mk=(()=>{class e{static{this.\u0275prov=Oe({token:e,providedIn:"root",factory:()=>null})}}return e})();function wb(e,i,t){let s=t?e.styles:null,c=t?e.classes:null,u=0;if(null!==i)for(let f=0;f<i.length;f++){const _=i[f];"number"==typeof _?u=_:1==u?c=_T(c,_):2==u&&(s=_T(s,_+": "+i[++f]+";"))}t?e.styles=s:e.stylesWithoutHost=s,t?e.classes=c:e.classesWithoutHost=c}class hw extends Qp{constructor(i){super(),this.ngModule=i}resolveComponentFactory(i){const t=Wt(i);return new ef(t,this.ngModule)}}function Lk(e,i){const t=[];for(const s in e){if(!e.hasOwnProperty(s))continue;const c=e[s];if(void 0===c)continue;const u=Array.isArray(c),f=u?c[0]:c;t.push(i?{propName:f,templateName:s,isSignal:!!((u?c[1]:zc.None)&zc.SignalBased)}:{propName:f,templateName:s})}return t}class ef extends aw{get inputs(){const i=this.componentDef,t=i.inputTransforms,s=Lk(i.inputs,!0);if(null!==t)for(const c of s)t.hasOwnProperty(c.propName)&&(c.transform=t[c.propName]);return s}get outputs(){return Lk(this.componentDef.outputs,!1)}constructor(i,t){super(),this.componentDef=i,this.ngModule=t,this.componentType=i.type,this.selector=function TV(e){return e.map(mp).join(",")}(i.selectors),this.ngContentSelectors=i.ngContentSelectors?i.ngContentSelectors:[],this.isBoundToModule=!!t}create(i,t,s,c){const u=gt(null);try{let f=(c=c||this.ngModule)instanceof $o?c:c?.injector;f&&null!==this.componentDef.getStandaloneInjector&&(f=this.componentDef.getStandaloneInjector(f)||f);const _=f?new Tu(i,f):i,E=_.get(Tb,null);if(null===E)throw new se(407,!1);const P={rendererFactory:E,sanitizer:_.get(Mk,null),inlineEffectRunner:null,changeDetectionScheduler:_.get(Zp,null)},U=E.createRenderer(null,this.componentDef),B=this.componentDef.selectors[0][0]||"div",G=s?function f3(e,i,t,s){const u=s.get(GP,!1)||t===la.ShadowDom,f=e.selectRootElement(i,u);return function m3(e){GM(e)}(f),f}(U,s,this.componentDef.encapsulation,_):_g(U,B,function xk(e){const i=e.toLowerCase();return"svg"===i?LN:"math"===i?"math":null}(B));let K=512;this.componentDef.signals?K|=4096:this.componentDef.onPush||(K|=16);let te=null;null!==G&&(te=X0(G,_,!0));const ae=kI(0,null,null,1,0,null,null,null,null,null,null),ne=eb(null,ae,null,K,null,null,P,U,_,null,te);f0(ne);let ke,Ge,Ht=null;try{const cn=this.componentDef;let An,Rr=null;cn.findHostDirectiveDefs?(An=[],Rr=new Map,cn.findHostDirectiveDefs(cn,An,Rr),An.push(cn)):An=[cn];const cu=function Wg(e,i){const t=e[Ie],s=He;return e[s]=i,Bu(t,s,2,"#host",null)}(ne,G);Ht=function Fk(e,i,t,s,c,u,f){const _=c[Ie];!function Uk(e,i,t,s){for(const c of e)i.mergedAttrs=Om(i.mergedAttrs,c.hostAttrs);null!==i.mergedAttrs&&(wb(i,i.mergedAttrs,!0),null!==t&&UM(s,t,i))}(s,e,i,f);let E=null;null!==i&&(E=X0(i,c[cr]));const S=u.rendererFactory.createRenderer(i,t);let I=16;t.signals?I=4096:t.onPush&&(I=64);const P=eb(c,HM(t),null,I,c[e.index],e,u,S,null,null,E);return _.firstCreatePass&&FI(_,e,s.length-1),Ig(c,P),c[e.index]=P}(cu,G,cn,An,ne,P,U),Ge=Wm(ae,He),G&&function Bk(e,i,t,s){if(s)NT(e,t,["ng-version","18.2.10"]);else{const{attrs:c,classes:u}=function IV(e){const i=[],t=[];let s=1,c=2;for(;s<e.length;){let u=e[s];if("string"==typeof u)2===c?""!==u&&i.push(u,e[++s]):8===c&&t.push(u);else{if(!da(c))break;c=u}s++}return{attrs:i,classes:t}}(i.selectors[0]);c&&NT(e,t,c),u&&u.length>0&&OI(e,t,u.join(" "))}}(U,cn,G,s),void 0!==t&&function rj(e,i,t){const s=e.projection=[];for(let c=0;c<i.length;c++){const u=t[c];s.push(null!=u?Array.from(u):null)}}(Ge,this.ngContentSelectors,t),ke=function Vk(e,i,t,s,c,u){const f=Un(),_=c[Ie],E=Ur(f,c);xI(_,c,f,t,null,s);for(let I=0;I<t.length;I++)ao(wu(c,_,f.directiveStart+I,f),c);qM(_,c,f),E&&ao(E,c);const S=wu(c,_,f.directiveStart+f.componentOffset,f);if(e[ri]=c[ri]=S,null!==u)for(const I of u)I(S,i);return MI(_,f,c),S}(Ht,cn,An,Rr,ne,[oj]),qp(ae,ne,null)}catch(cn){throw null!==Ht&&Mu(Ht),Mu(ne),cn}finally{m0()}return new ij(this.componentType,ke,Pp(Ge,ne),ne,Ge)}finally{gt(u)}}}class ij extends sw{constructor(i,t,s,c,u){super(),this.location=s,this._rootLView=c,this._tNode=u,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new Ag(c,void 0,!1),this.componentType=i}setInput(i,t){const s=this._tNode.inputs;let c;if(null!==s&&(c=s[i])){if(this.previousInputValues??=new Map,this.previousInputValues.has(i)&&Object.is(this.previousInputValues.get(i),t))return;const u=this._rootLView;db(u[Ie],u,c,i,t),this.previousInputValues.set(i,t),$p(Es(this._tNode.index,u),1)}}get injector(){return new Ti(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(i){this.hostView.onDestroy(i)}}function oj(){const e=Un();Tp(ue()[Ie],e)}let js=(()=>{class e{static{this.__NG_ELEMENT_ID__=md}}return e})();function md(){return Hk(Un(),ue())}const Rb=js,pw=class extends Rb{constructor(i,t,s){super(),this._lContainer=i,this._hostTNode=t,this._hostLView=s}get element(){return Pp(this._hostTNode,this._hostLView)}get injector(){return new Ti(this._hostTNode,this._hostLView)}get parentInjector(){const i=ad(this._hostTNode,this._hostLView);if(Jm(i)){const t=eg(i,this._hostLView),s=Qm(i);return new Ti(t[Ie].data[s+8],t)}return new Ti(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(i){const t=jk(this._lContainer);return null!==t&&t[i]||null}get length(){return this._lContainer.length-Yi}createEmbeddedView(i,t,s){let c,u;"number"==typeof s?c=s:null!=s&&(c=s.index,u=s.injector);const f=Ia(this._lContainer,i.ssrId),_=i.createEmbeddedViewImpl(t||{},u,f);return this.insertImpl(_,c,pd(this._hostTNode,f)),_}createComponent(i,t,s,c,u){const f=i&&!function xm(e){return"function"==typeof e}(i);let _;if(f)_=t;else{const G=t||{};_=G.index,s=G.injector,c=G.projectableNodes,u=G.environmentInjector||G.ngModuleRef}const E=f?i:new ef(Wt(i)),S=s||this.parentInjector;if(!u&&null==E.ngModule){const K=(f?S:this.parentInjector).get($o,null);K&&(u=K)}const I=Wt(E.componentType??{}),P=Ia(this._lContainer,I?.id??null),B=E.create(S,c,P?.firstChild??null,u);return this.insertImpl(B.hostView,_,pd(this._hostTNode,P)),B}insert(i,t){return this.insertImpl(i,t,!0)}insertImpl(i,t,s){const c=i._lView;if(function qV(e){return ro(e[ar])}(c)){const _=this.indexOf(i);if(-1!==_)this.detach(_);else{const E=c[ar],S=new pw(E,E[Fr],E[ar]);S.detach(S.indexOf(i))}}const u=this._adjustIndex(t),f=this._lContainer;return ju(f,c,u,s),i.attachToViewContainerRef(),EN(fw(f),u,i),i}move(i,t){return this.insert(i,t)}indexOf(i){const t=jk(this._lContainer);return null!==t?t.indexOf(i):-1}remove(i){const t=this._adjustIndex(i,-1),s=vg(this._lContainer,t);s&&(Dm(fw(this._lContainer),t),Eg(s[Ie],s))}detach(i){const t=this._adjustIndex(i,-1),s=vg(this._lContainer,t);return s&&null!=Dm(fw(this._lContainer),t)?new Ag(s):null}_adjustIndex(i,t=0){return i??this.length+t}};function jk(e){return e[8]}function fw(e){return e[8]||(e[8]=[])}function Hk(e,i){let t;const s=i[e.index];return ro(s)?t=s:(t=ab(s,i,null,e),i[e.index]=t,Ig(i,t)),mw(t,i,e,s),new pw(t,e,i)}let mw=function _w(e,i,t,s){if(e[sc])return;let c;c=8&t.type?un(s):function sj(e,i){const t=e[pt],s=t.createComment(""),c=Ur(i,e);return Vu(t,wI(t,c),s,function DM(e,i){return e.nextSibling(i)}(t,c),!1),s}(i,t),e[sc]=c},Ab=()=>!1;class vw{constructor(i){this.queryList=i,this.matches=null}clone(){return new vw(this.queryList)}setDirty(){this.queryList.setDirty()}}class Ew{constructor(i=[]){this.queries=i}createEmbeddedView(i){const t=i.queries;if(null!==t){const s=null!==i.contentQueries?i.contentQueries[0]:t.length,c=[];for(let u=0;u<s;u++){const f=t.getByIndex(u);c.push(this.queries[f.indexInDeclarationView].clone())}return new Ew(c)}return null}insertView(i){this.dirtyQueriesWithMatches(i)}detachView(i){this.dirtyQueriesWithMatches(i)}finishViewCreation(i){this.dirtyQueriesWithMatches(i)}dirtyQueriesWithMatches(i){for(let t=0;t<this.queries.length;t++)null!==Iw(i,t).matches&&this.queries[t].setDirty()}}class Wk{constructor(i,t,s=null){this.flags=t,this.read=s,this.predicate="string"==typeof i?function uj(e){return e.split(",").map(i=>i.trim())}(i):i}}class yw{constructor(i=[]){this.queries=i}elementStart(i,t){for(let s=0;s<this.queries.length;s++)this.queries[s].elementStart(i,t)}elementEnd(i){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(i)}embeddedTView(i){let t=null;for(let s=0;s<this.length;s++){const c=null!==t?t.length:0,u=this.getByIndex(s).embeddedTView(i,c);u&&(u.indexInDeclarationView=s,null!==t?t.push(u):t=[u])}return null!==t?new yw(t):null}template(i,t){for(let s=0;s<this.queries.length;s++)this.queries[s].template(i,t)}getByIndex(i){return this.queries[i]}get length(){return this.queries.length}track(i){this.queries.push(i)}}class bw{constructor(i,t=-1){this.metadata=i,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(i,t){this.isApplyingToNode(t)&&this.matchTNode(i,t)}elementEnd(i){this._declarationNodeIndex===i.index&&(this._appliesToNextNode=!1)}template(i,t){this.elementStart(i,t)}embeddedTView(i,t){return this.isApplyingToNode(i)?(this.crossesNgTemplate=!0,this.addMatch(-i.index,t),new bw(this.metadata)):null}isApplyingToNode(i){if(this._appliesToNextNode&&1&~this.metadata.flags){const t=this._declarationNodeIndex;let s=i.parent;for(;null!==s&&8&s.type&&s.index!==t;)s=s.parent;return t===(null!==s?s.index:-1)}return this._appliesToNextNode}matchTNode(i,t){const s=this.metadata.predicate;if(Array.isArray(s))for(let c=0;c<s.length;c++){const u=s[c];this.matchTNodeWithReadOption(i,t,lj(t,u)),this.matchTNodeWithReadOption(i,t,ng(t,i,u,!1,!1))}else s===sl?4&t.type&&this.matchTNodeWithReadOption(i,t,-1):this.matchTNodeWithReadOption(i,t,ng(t,i,s,!1,!1))}matchTNodeWithReadOption(i,t,s){if(null!==s){const c=this.metadata.read;if(null!==c)if(c===On||c===js||c===sl&&4&t.type)this.addMatch(t.index,-2);else{const u=ng(t,i,c,!1,!1);null!==u&&this.addMatch(t.index,u)}else this.addMatch(t.index,s)}}addMatch(i,t){null===this.matches?this.matches=[i,t]:this.matches.push(i,t)}}function lj(e,i){const t=e.localNames;if(null!==t)for(let s=0;s<t.length;s+=2)if(t[s]===i)return t[s+1];return null}function zk(e,i,t,s){return-1===t?function dj(e,i){return 11&e.type?Pp(e,i):4&e.type?Dg(e,i):null}(i,e):-2===t?function Kk(e,i,t){return t===On?Pp(i,e):t===sl?Dg(i,e):t===js?Hk(i,e):void 0}(e,i,s):wu(e,e[Ie],t,i)}function qk(e,i,t,s){const c=i[ha].queries[s];if(null===c.matches){const u=e.data,f=t.matches,_=[];for(let E=0;null!==f&&E<f.length;E+=2){const S=f[E];_.push(S<0?null:zk(i,u[S],f[E+1],t.metadata.read))}c.matches=_}return c.matches}function Sw(e,i,t,s){const c=e.queries.getByIndex(t),u=c.matches;if(null!==u){const f=qk(e,i,c,t);for(let _=0;_<u.length;_+=2){const E=u[_];if(E>0)s.push(f[_/2]);else{const S=u[_+1],I=i[-E];for(let P=Yi;P<I.length;P++){const U=I[P];U[Yc]===U[ar]&&Sw(U[Ie],U,S,s)}if(null!==I[Ep]){const P=I[Ep];for(let U=0;U<P.length;U++){const B=P[U];Sw(B[Ie],B,S,s)}}}}}return s}function zg(e,i){return e[ha].queries[i].queryList}function Yk(e,i,t){const s=new Nu(!(4&~t));return function g3(e,i,t,s){const c=cb(i);c.push(t),e.firstCreatePass&&VI(e).push(s,c.length-1)}(e,i,s,s.destroy),(i[ha]??=new Ew).queries.push(new vw(s))-1}function Cw(e,i,t,s){const c=Bt();if(c.firstCreatePass){const u=Un();Tw(c,new Wk(i,t,s),u.index),function hj(e,i){const t=e.contentQueries||(e.contentQueries=[]);i!==(t.length?t[t.length-1]:-1)&&t.push(e.queries.length-1,i)}(c,e),!(2&~t)&&(c.staticContentQueries=!0)}return Yk(c,ue(),t)}function Tw(e,i,t){null===e.queries&&(e.queries=new yw),e.queries.track(new bw(i,t))}function Iw(e,i){return e.queries.getByIndex(i)}function Xk(e,i){const t=e[Ie],s=Iw(t,i);return s.crossesNgTemplate?Sw(t,e,i,[]):qk(t,e,s,i)}const Kg=new Set;function jr(e){Kg.has(e)||(Kg.add(e),performance?.mark?.("mark_feature_usage",{detail:{feature:e}}))}function gd(e,i){jr("NgSignals");const t=function ZO(e){const i=Object.create(YU);i.value=e;const t=()=>(xn(i),i.value);return t[Pt]=i,t}(e),s=t[Pt];return i?.equal&&(s.equal=i.equal),t.set=c=>jc(s,c),t.update=c=>function vE(e,i){qO()||Sm(),jc(e,i(e.value))}(s,c),t.asReadonly=ww.bind(t),t}function ww(){const e=this[Pt];if(void 0===e.readonlyFn){const i=()=>this();i[Pt]=e,e.readonlyFn=i}return e.readonlyFn}function Db(e,i){let t;const s=_E(()=>{t._dirtyCounter();const c=function fj(e,i){const t=e._lView,s=e._queryIndex;if(void 0===t||void 0===s||4&t[Ye])return i?void 0:dn;const c=zg(t,s),u=Xk(t,s);return c.reset(u,L0),i?c.first:c._changesDetected||void 0===e._flatValue?e._flatValue=c.toArray():e._flatValue}(t,e);if(i&&void 0===c)throw new se(-951,!1);return c});return t=s[Pt],t._dirtyCounter=gd(0),t._flatValue=void 0,s}function Ob(e,i){return function Rw(){return Db(!0,!1)}()}const Dw=(Ob.required=function mj(e,i){return function Xu(){return Db(!0,!0)}()},Ob);function tn(e){let i=function t1(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),t=!0;const s=[e];for(;i;){let c;if(fa(e))c=i.\u0275cmp||i.\u0275dir;else{if(i.\u0275cmp)throw new se(903,!1);c=i.\u0275dir}if(c){if(t){s.push(c);const f=e;f.inputs=_d(e.inputs),f.inputTransforms=_d(e.inputTransforms),f.declaredInputs=_d(e.declaredInputs),f.outputs=_d(e.outputs);const _=c.hostBindings;_&&Tj(e,_);const E=c.viewQuery,S=c.contentQueries;if(E&&kw(e,E),S&&r1(e,S),n1(e,c),lN(e.outputs,c.outputs),fa(c)&&c.data.animation){const I=e.data;I.animation=(I.animation||[]).concat(c.data.animation)}}const u=c.features;if(u)for(let f=0;f<u.length;f++){const _=u[f];_&&_.ngInherit&&_(e),_===tn&&(t=!1)}}i=Object.getPrototypeOf(i)}!function Nb(e){let i=0,t=null;for(let s=e.length-1;s>=0;s--){const c=e[s];c.hostVars=i+=c.hostVars,c.hostAttrs=Om(c.hostAttrs,t=Om(t,c.hostAttrs))}}(s)}function n1(e,i){for(const t in i.inputs){if(!i.inputs.hasOwnProperty(t)||e.inputs.hasOwnProperty(t))continue;const s=i.inputs[t];if(void 0!==s&&(e.inputs[t]=s,e.declaredInputs[t]=i.declaredInputs[t],null!==i.inputTransforms)){const c=Array.isArray(s)?s[0]:s;if(!i.inputTransforms.hasOwnProperty(c))continue;e.inputTransforms??={},e.inputTransforms[c]=i.inputTransforms[c]}}}function _d(e){return e===gr?{}:e===dn?[]:e}function kw(e,i){const t=e.viewQuery;e.viewQuery=t?(s,c)=>{i(s,c),t(s,c)}:i}function r1(e,i){const t=e.contentQueries;e.contentQueries=t?(s,c,u)=>{i(s,c,u),t(s,c,u)}:i}function Tj(e,i){const t=e.hostBindings;e.hostBindings=t?(s,c)=>{i(s,c),t(s,c)}:i}function Jg(e){const i=e.inputConfig,t={};for(const s in i)if(i.hasOwnProperty(s)){const c=i[s];Array.isArray(c)&&c[3]&&(t[s]=c[3])}e.inputTransforms=t}class Zu{}class s1{}class Uw extends Zu{constructor(i,t,s,c=!0){super(),this.ngModuleType=i,this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new hw(this);const u=io(i);this._bootstrapComponents=Qo(u.bootstrap),this._r3Injector=Dp(i,t,[{provide:Zu,useValue:this},{provide:Qp,useValue:this.componentFactoryResolver},...s],mr(i),new Set(["environment"])),c&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){const i=this._r3Injector;!i.destroyed&&i.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(i){this.destroyCbs.push(i)}}class Pb extends s1{constructor(i){super(),this.moduleType=i}create(i){return new Uw(this.moduleType,i,[])}}class c1 extends Zu{constructor(i){super(),this.componentFactoryResolver=new hw(this),this.instance=null;const t=new gp([...i.providers,{provide:Zu,useValue:this},{provide:Qp,useValue:this.componentFactoryResolver}],i.parent||qE(),i.debugName,new Set(["environment"]));this.injector=t,i.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(i){this.injector.onDestroy(i)}}function Vw(e,i,t=null){return new c1({providers:e,parent:i,debugName:t,runEnvironmentInitializers:!0}).injector}function Aa(e,i,t){return e[i]=t}function $i(e,i,t){return!Object.is(e[i],t)&&(e[i]=t,!0)}function Ed(e,i,t,s){const c=$i(e,i,t);return $i(e,i+1,s)||c}function e_(e,i,t,s,c,u,f,_,E,S){const I=t+He,P=i.firstCreatePass?function Oj(e,i,t,s,c,u,f,_,E){const S=i.consts,I=Bu(i,e,4,f||null,_||null);Ro(i,t,I,Vr(S,E)),Tp(i,I);const P=I.tView=kI(2,I,s,c,u,i.directiveRegistry,i.pipeRegistry,null,i.schemas,S,null);return null!==i.queries&&(i.queries.template(i,I),P.queries=i.queries.embeddedTView(I)),I}(I,i,e,s,c,u,f,_,E):i.data[I];ga(P,!1);const U=jw(i,e,P,t);Cp()&&hd(i,e,U,P),ao(U,e);const B=ab(U,e,U,P);return e[I]=B,Ig(e,B),function gw(e,i,t){return Ab(e,i,t)}(B,P,e),ac(P)&&tb(i,e,P),null!=E&&nb(e,P,S),P}function Si(e,i,t,s,c,u,f,_){const E=ue(),S=Bt();return e_(E,S,e,i,t,s,c,Vr(S.consts,u),f,_),Si}let jw=function Hw(e,i,t,s){return dc(!0),i[pt].createComment("")};var lf=function(e){return e[e.EarlyRead=0]="EarlyRead",e[e.Write=1]="Write",e[e.MixedReadWrite=2]="MixedReadWrite",e[e.Read=3]="Read",e}(lf||{});let t_=(()=>{class e{constructor(){this.impl=null}execute(){this.impl?.execute()}static{this.\u0275prov=Oe({token:e,providedIn:"root",factory:()=>new e})}}return e})();class df{constructor(){this.ngZone=me(ft),this.scheduler=me(Zp),this.errorHandler=me(ya,{optional:!0}),this.sequences=new Set,this.deferredRegistrations=new Set,this.executing=!1}static{this.PHASES=[lf.EarlyRead,lf.Write,lf.MixedReadWrite,lf.Read]}execute(){this.executing=!0;for(const i of df.PHASES)for(const t of this.sequences)if(!t.erroredOrDestroyed&&t.hooks[i])try{t.pipelinedValue=this.ngZone.runOutsideAngular(()=>t.hooks[i](t.pipelinedValue))}catch(s){t.erroredOrDestroyed=!0,this.errorHandler?.handleError(s)}this.executing=!1;for(const i of this.sequences)i.afterRun(),i.once&&(this.sequences.delete(i),i.destroy());for(const i of this.deferredRegistrations)this.sequences.add(i);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear()}register(i){this.executing?this.deferredRegistrations.add(i):(this.sequences.add(i),this.scheduler.notify(6))}unregister(i){this.executing&&this.sequences.has(i)?(i.erroredOrDestroyed=!0,i.pipelinedValue=void 0,i.once=!0):(this.sequences.delete(i),this.deferredRegistrations.delete(i))}static{this.\u0275prov=Oe({token:df,providedIn:"root",factory:()=>new df})}}class m1{constructor(i,t,s,c){this.impl=i,this.hooks=t,this.once=s,this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.unregisterOnDestroy=c?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.()}}function eh(e,i){!i?.injector&&KT();const t=i?.injector??me(Oi);return ys(t)?(jr("NgAfterRender"),g1(e,t,i,!1)):_1}function uf(e,i){!i?.injector&&KT();const t=i?.injector??me(Oi);return ys(t)?(jr("NgAfterNextRender"),g1(e,t,i,!0)):_1}function g1(e,i,t,s){const c=i.get(t_);c.impl??=i.get(df);const u=t?.phase??lf.MixedReadWrite,f=!0!==t?.manualCleanup?i.get(Au):null,_=new m1(c.impl,function kj(e,i){if(e instanceof Function){const t=[void 0,void 0,void 0,void 0];return t[i]=e,t}return[e.earlyRead,e.write,e.mixedReadWrite,e.read]}(e,u),s,f);return c.impl.register(_),_}const _1={destroy(){}};function Ji(e,i,t,s){const c=ue();return $i(c,_a(),i)&&(Bt(),Ca(oi(),c,e,i,t,s)),Ji}function d_(e,i){return e<<17|i<<2}function ul(e){return e>>17&32767}function u_(e){return 2|e}function is(e){return(131068&e)>>2}function Ef(e,i){return-131069&e|i<<2}function h_(e){return 1|e}function Nr(e,i,t,s){const c=e[t+1],u=null===i;let f=s?ul(c):is(c),_=!1;for(;0!==f&&(!1===_||u);){const S=e[f+1];Yj(e[f],i)&&(_=!0,e[f+1]=s?h_(S):u_(S)),f=s?ul(S):is(S)}_&&(e[t+1]=s?u_(c):h_(c))}function Yj(e,i){return null===e||null==i||(Array.isArray(e)?e[1]:e)===i||!(!Array.isArray(e)||"string"!=typeof i)&&fp(e,i)>=0}const Ni={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function p_(e){return e.substring(Ni.key,Ni.keyEnd)}function pi(e,i){const t=Ni.textEnd;return t===i?-1:(i=Ni.keyEnd=function ot(e,i,t){for(;i<t&&e.charCodeAt(i)>32;)i++;return i}(e,Ni.key=i,t),wd(e,i,t))}function wd(e,i,t){for(;i<t&&e.charCodeAt(i)<=32;)i++;return i}function $e(e,i,t){const s=ue();return $i(s,_a(),i)&&yr(Bt(),oi(),s,e,i,s[pt],t,!1),$e}function Jb(e,i,t,s,c){const f=c?"class":"style";db(e,t,i.inputs[f],f,s)}function nt(e,i){return function Ws(e,i,t,s){const c=ue(),u=Bt(),f=Zc(2);u.firstUpdatePass&&nR(u,e,f,s),i!==St&&$i(c,f,i)&&$t(u,u.data[Br()],c,c[pt],e,c[f+1]=function k(e,i){return null==e||""===e||("string"==typeof i?e+=i:"object"==typeof e&&(e=mr(nl(e)))),e}(i,t),s,f)}(e,i,null,!0),nt}function Qb(e){!function zs(e,i,t,s){const c=Bt(),u=Zc(2);c.firstUpdatePass&&nR(c,null,u,s);const f=ue();if(t!==St&&$i(f,u,t)){const _=c.data[Br()];if(Y(_,s)&&!tR(c,u)){let E=s?_.classesWithoutHost:_.stylesWithoutHost;null!==E&&(t=_T(E,t||"")),Jb(c,_,f,t,s)}else!function g_(e,i,t,s,c,u,f,_){c===St&&(c=dn);let E=0,S=0,I=0<c.length?c[0]:null,P=0<u.length?u[0]:null;for(;null!==I||null!==P;){const U=E<c.length?c[E+1]:void 0,B=S<u.length?u[S+1]:void 0;let K,G=null;I===P?(E+=2,S+=2,U!==B&&(G=P,K=B)):null===P||null!==I&&I<P?(E+=2,G=I):(S+=2,G=P,K=B),null!==G&&$t(e,i,t,s,G,K,f,_),I=E<c.length?c[E]:null,P=S<u.length?u[S]:null}}(c,_,f,f[pt],f[u+1],f[u+1]=function rR(e,i,t){if(null==t||""===t)return dn;const s=[],c=nl(t);if(Array.isArray(c))for(let u=0;u<c.length;u++)e(s,c[u],!0);else if("object"==typeof c)for(const u in c)c.hasOwnProperty(u)&&e(s,u,c[u]);else"string"==typeof c&&i(s,c);return s}(e,i,t),s,u)}}(tS,Oa,e,!0)}function Oa(e,i){for(let t=function _c(e){return function Hs(e){Ni.key=0,Ni.keyEnd=0,Ni.value=0,Ni.valueEnd=0,Ni.textEnd=e.length}(e),pi(e,wd(e,0,Ni.textEnd))}(i);t>=0;t=pi(i,t))vs(e,p_(i),!0)}function tR(e,i){return i>=e.expandoStartIndex}function nR(e,i,t,s){const c=e.data;if(null===c[t+1]){const u=c[Br()],f=tR(e,t);Y(u,s)&&null===i&&!f&&(i=!1),i=function yf(e,i,t,s){const c=function h0(e){const i=_t.lFrame.currentDirectiveIndex;return-1===i?null:e[i]}(e);let u=s?i.residualClasses:i.residualStyles;if(null===c)0===(s?i.classBindings:i.styleBindings)&&(t=bf(t=eS(null,e,i,t,s),i.attrs,s),u=null);else{const f=i.directiveStylingLast;if(-1===f||e[f]!==c)if(t=eS(c,e,i,t,s),null===u){let E=function iR(e,i,t){const s=t?i.classBindings:i.styleBindings;if(0!==is(s))return e[ul(s)]}(e,i,s);void 0!==E&&Array.isArray(E)&&(E=eS(null,e,i,E[1],s),E=bf(E,i.attrs,s),function G1(e,i,t,s){e[ul(t?i.classBindings:i.styleBindings)]=s}(e,i,s,E))}else u=function Ks(e,i,t){let s;const c=i.directiveEnd;for(let u=1+i.directiveStylingLast;u<c;u++)s=bf(s,e[u].hostAttrs,t);return bf(s,i.attrs,t)}(e,i,s)}return void 0!==u&&(s?i.residualClasses=u:i.residualStyles=u),t}(c,u,i,s),function qj(e,i,t,s,c,u){let f=u?i.classBindings:i.styleBindings,_=ul(f),E=is(f);e[s]=t;let I,S=!1;if(Array.isArray(t)?(I=t[1],(null===I||fp(t,I)>0)&&(S=!0)):I=t,c)if(0!==E){const U=ul(e[_+1]);e[s+1]=d_(U,_),0!==U&&(e[U+1]=Ef(e[U+1],s)),e[_+1]=function U1(e,i){return 131071&e|i<<17}(e[_+1],s)}else e[s+1]=d_(_,0),0!==_&&(e[_+1]=Ef(e[_+1],s)),_=s;else e[s+1]=d_(E,0),0===_?_=s:e[E+1]=Ef(e[E+1],s),E=s;S&&(e[s+1]=u_(e[s+1])),Nr(e,I,s,!0),Nr(e,I,s,!1),function lr(e,i,t,s,c){const u=c?e.residualClasses:e.residualStyles;null!=u&&"string"==typeof i&&fp(u,i)>=0&&(t[s+1]=h_(t[s+1]))}(i,I,e,s,u),f=d_(_,E),u?i.classBindings=f:i.styleBindings=f}(c,u,i,t,f,s)}}function eS(e,i,t,s,c){let u=null;const f=t.directiveEnd;let _=t.directiveStylingLast;for(-1===_?_=t.directiveStart:_++;_<f&&(u=i[_],s=bf(s,u.hostAttrs,c),u!==e);)_++;return null!==e&&(t.directiveStylingLast=_),s}function bf(e,i,t){const s=t?1:2;let c=-1;if(null!==i)for(let u=0;u<i.length;u++){const f=i[u];"number"==typeof f?c=f:c===s&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),vs(e,f,!!t||i[++u]))}return void 0===e?null:e}function tS(e,i,t){const s=String(i);""!==s&&!s.includes(" ")&&vs(e,s,t)}function $t(e,i,t,s,c,u,f,_){if(!(3&i.type))return;const E=e.data,S=E[_+1],I=function $b(e){return!(1&~e)}(S)?oR(E,i,t,c,is(S),f):void 0;Ee(I)||(Ee(u)||function eR(e){return!(2&~e)}(S)&&(u=oR(E,null,t,c,_,f)),function DI(e,i,t,s,c){if(i)c?e.addClass(t,s):e.removeClass(t,s);else{let u=-1===s.indexOf("-")?void 0:ud.DashCase;null==c?e.removeStyle(t,s,u):("string"==typeof c&&c.endsWith("!important")&&(c=c.slice(0,-10),u|=ud.Important),e.setStyle(t,s,c,u))}}(s,f,Eu(Br(),t),c,u))}function oR(e,i,t,s,c,u){const f=null===i;let _;for(;c>0;){const E=e[c],S=Array.isArray(E),I=S?E[1]:E,P=null===I;let U=t[c+1];U===St&&(U=P?dn:void 0);let B=P?pp(U,s):I===s?U:void 0;if(S&&!Ee(B)&&(B=pp(E,s)),Ee(B)&&(_=B,f))return _;const G=e[c+1];c=f?ul(G):is(G)}if(null!==i){let E=u?i.residualClasses:i.residualStyles;null!=E&&(_=pp(E,s))}return _}function Ee(e){return void 0!==e}function Y(e,i){return!!(e.flags&(i?8:16))}class z1{destroy(i){}updateValue(i,t){}swap(i,t){const s=Math.min(i,t),c=Math.max(i,t),u=this.detach(c);if(c-s>1){const f=this.detach(s);this.attach(s,u),this.attach(c,f)}else this.attach(s,u)}move(i,t){this.attach(t,this.detach(i))}}function v_(e,i,t,s,c){return e===t&&Object.is(i,s)?1:Object.is(c(e,i),c(t,s))?-1:0}function nn(e,i,t,s){return!(void 0===i||!i.has(s)||(e.attach(t,i.get(s)),i.delete(s),0))}function Sf(e,i,t,s,c){if(nn(e,i,s,t(s,c)))e.updateValue(s,c);else{const u=e.create(s,c);e.attach(s,u)}}function lR(e,i,t,s){const c=new Set;for(let u=i;u<=t;u++)c.add(s(u,e.at(u)));return c}class Yn{constructor(){this.kvMap=new Map,this._vMap=void 0}has(i){return this.kvMap.has(i)}delete(i){if(!this.has(i))return!1;const t=this.kvMap.get(i);return void 0!==this._vMap&&this._vMap.has(t)?(this.kvMap.set(i,this._vMap.get(t)),this._vMap.delete(t)):this.kvMap.delete(i),!0}get(i){return this.kvMap.get(i)}set(i,t){if(this.kvMap.has(i)){let s=this.kvMap.get(i);void 0===this._vMap&&(this._vMap=new Map);const c=this._vMap;for(;c.has(s);)s=c.get(s);c.set(s,t)}else this.kvMap.set(i,t)}forEach(i){for(let[t,s]of this.kvMap)if(i(s,t),void 0!==this._vMap){const c=this._vMap;for(;c.has(s);)s=c.get(s),i(s,t)}}}function st(e,i){jr("NgControlFlow");const t=ue(),s=_a(),c=t[s]!==St?t[s]:-1,u=-1!==c?ml(t,He+c):void 0;if($i(t,s,e)){const _=gt(null);try{if(void 0!==u&&wg(u,0),-1!==e){const E=He+e,S=ml(t,E),I=Do(t[Ie],E),P=Ia(S,I.tView.ssrId);ju(S,ce(t,I,i,{dehydratedView:P}),0,pd(I,P))}}finally{gt(_)}}else if(void 0!==u){const _=kt(u,0);void 0!==_&&(_[ri]=i)}}class K1{constructor(i,t,s){this.lContainer=i,this.$implicit=t,this.$index=s}get $count(){return this.lContainer.length-Yi}}function Rt(e,i){return i}class nS{constructor(i,t,s){this.hasEmptyBlock=i,this.trackByFn=t,this.liveCollection=s}}class Hi extends z1{constructor(i,t,s){super(),this.lContainer=i,this.hostLView=t,this.templateTNode=s,this.operationsCounter=void 0,this.needsIndexUpdate=!1}get length(){return this.lContainer.length-Yi}at(i){return this.getLView(i)[ri].$implicit}attach(i,t){const s=t[Io];this.needsIndexUpdate||=i!==this.length,ju(this.lContainer,t,i,pd(this.templateTNode,s))}detach(i){return this.needsIndexUpdate||=i!==this.length-1,function Gi(e,i){return vg(e,i)}(this.lContainer,i)}create(i,t){const s=Ia(this.lContainer,this.templateTNode.tView.ssrId),c=ce(this.hostLView,this.templateTNode,new K1(this.lContainer,t,i),{dehydratedView:s});return this.operationsCounter?.recordCreate(),c}destroy(i){Eg(i[Ie],i),this.operationsCounter?.recordDestroy()}updateValue(i,t){this.getLView(i)[ri].$implicit=t}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let i=0;i<this.length;i++)this.getLView(i)[ri].$index=i}getLView(i){return function jt(e,i){return kt(e,i)}(this.lContainer,i)}}function ml(e,i){return e[i]}function Do(e,i){return Wm(e,i)}function Se(e,i,t,s){const c=ue(),u=Bt(),f=He+e,_=c[pt],E=u.firstCreatePass?function E_(e,i,t,s,c,u){const f=i.consts,E=Bu(i,e,2,s,Vr(f,c));return Ro(i,t,E,Vr(f,u)),null!==E.attrs&&wb(E,E.attrs,!1),null!==E.mergedAttrs&&wb(E,E.mergedAttrs,!0),null!==i.queries&&i.queries.elementStart(i,E),E}(f,u,c,i,t,s):u.data[f],S=y_(u,c,E,_,i,e);c[f]=S;const I=ac(E);return ga(E,!0),UM(_,S,E),!function yd(e){return!(32&~e.flags)}(E)&&Cp()&&hd(u,c,S,E),0===function FN(){return _t.lFrame.elementDepthCount}()&&ao(S,c),function a0(){_t.lFrame.elementDepthCount++}(),I&&(tb(u,c,E),MI(u,E,c)),null!==s&&nb(c,E),Se}function Be(){let e=Un();l0()?d0():(e=e.parent,ga(e,!1));const i=e;(function Su(e){return _t.skipHydrationRootTNode===e})(i)&&function c0(){_t.skipHydrationRootTNode=null}(),function YV(){_t.lFrame.elementDepthCount--}();const t=Bt();return t.firstCreatePass&&(Tp(t,e),XT(e)&&t.queries.elementEnd(e)),null!=i.classesWithoutHost&&function iB(e){return!!(8&e.flags)}(i)&&Jb(t,i,ue(),i.classesWithoutHost,!0),null!=i.stylesWithoutHost&&function eP(e){return!!(16&e.flags)}(i)&&Jb(t,i,ue(),i.stylesWithoutHost,!1),Be}function At(e,i,t,s){return Se(e,i,t,s),Be(),At}let y_=(e,i,t,s,c,u)=>(dc(!0),_g(s,c,function _0(){return _t.lFrame.currentNamespace}()));function yc(){return ue()}function b_(e,i,t){const s=ue();return $i(s,_a(),i)&&yr(Bt(),oi(),s,e,i,s[pt],t,!0),b_}const Nn="en-US";let C_=Nn,lL=(e,i,t)=>{};function Mn(e,i,t,s){const c=ue(),u=Bt(),f=Un();return function wR(e,i,t,s,c,u,f){const _=ac(s),S=e.firstCreatePass&&VI(e),I=i[ri],P=cb(i);let U=!0;if(3&s.type||f){const K=Ur(s,i),te=f?f(K):K,ae=P.length,ne=f?Ge=>f(un(Ge[s.index])):s.index;let ke=null;if(!f&&_&&(ke=function _4(e,i,t,s){const c=e.cleanup;if(null!=c)for(let u=0;u<c.length-1;u+=2){const f=c[u];if(f===t&&c[u+1]===s){const _=i[qc],E=c[u+2];return _.length>E?_[E]:null}"string"==typeof f&&(u+=2)}return null}(e,i,c,s.index)),null!==ke)(ke.__ngLastListenerFn__||ke).__ngNextListenerFn__=u,ke.__ngLastListenerFn__=u,U=!1;else{u=dL(s,i,I,u),lL(K,c,u);const Ge=t.listen(te,c,u);P.push(u,Ge),S&&S.push(c,ne,ae,ae+1)}}else u=dL(s,i,I,u);const B=s.outputs;let G;if(U&&null!==B&&(G=B[c])){const K=G.length;if(K)for(let te=0;te<K;te+=2){const Ht=i[G[te]][G[te+1]].subscribe(u),cn=P.length;P.push(u,Ht),S&&S.push(c,s.index,cn,-(cn+1))}}}(u,c,c[pt],f,e,i,s),Mn}function RR(e,i,t,s){const c=gt(null);try{return cc(6,i,t),!1!==t(s)}catch(u){return lb(e,u),!1}finally{cc(7,i,t),gt(c)}}function dL(e,i,t,s){return function c(u){if(u===Function)return s;$p(e.componentOffset>-1?Es(e.index,i):i,5);let _=RR(i,t,s,u),E=c.__ngNextListenerFn__;for(;E;)_=RR(i,t,E,u)&&_,E=E.__ngNextListenerFn__;return _}}function Sn(e=1){return function QV(e){return(_t.lFrame.contextLView=function bp(e,i){for(;e>0;)i=i[vp],e--;return i}(e,_t.lFrame.contextLView))[ri]}(e)}function v4(e,i){let t=null;const s=function bV(e){const i=e.attrs;if(null!=i){const t=i.indexOf(5);if(!(1&t))return i[t+1]}return null}(e);for(let c=0;c<i.length;c++){const u=i[c];if("*"!==u){if(null===s?CN(e,u,!0):CV(s,u))return c}else t=c}return t}function wf(e){const i=ue()[hi][Fr];if(!i.projection){const s=i.projection=function FE(e,i){const t=[];for(let s=0;s<e;s++)t.push(i);return t}(e?e.length:1,null),c=s.slice();let u=i.child;for(;null!==u;){if(128!==u.type){const f=e?v4(u,e):0;null!==f&&(c[f]?c[f].projectionNext=u:s[f]=u,c[f]=u)}u=u.next}}}function uo(e,i=0,t,s,c,u){const f=ue(),_=Bt(),E=s?e+1:null;null!==E&&e_(f,_,E,s,c,u,null,t);const S=Bu(_,He+e,16,null,t||null);null===S.projection&&(S.projection=i),d0();const P=!f[Io]||Us();null===f[hi][Fr].projection[S.projection]&&null!==E?function E4(e,i,t){const s=He+t,c=i.data[s],u=e[s],f=Ia(u,c.tView.ssrId);ju(u,ce(e,c,void 0,{dehydratedView:f}),0,pd(c,f))}(f,_,E):P&&32&~S.flags&&function d3(e,i,t){xM(i[pt],0,i,t,pc(e,t,i),OM(t.parent||i[Fr],t,i))}(_,f,S)}function fh(e,i,t,s){Cw(e,i,t,s)}function pe(e,i,t){!function $k(e,i,t){const s=Bt();return s.firstCreatePass&&(Tw(s,new Wk(e,i,t),-1),!(2&~i)&&(s.staticViewQueries=!0)),Yk(s,ue(),i)}(e,i,t)}function dr(e){const i=ue(),t=Bt(),s=p0();oy(s+1);const c=Iw(t,s);if(e.dirty&&function KV(e){return!(4&~e[Ye])}(i)===!(2&~c.metadata.flags)){if(null===c.matches)e.reset([]);else{const u=Xk(i,s);e.reset(u,L0),e.notifyOnChanges()}return!0}return!1}function kn(){return zg(ue(),p0())}function R_(e,i,t,s,c){!function tf(e,i){const t=e[Pt];t._lView=ue(),t._queryIndex=i,t._queryList=zg(t._lView,i),t._queryList.onDirty(()=>t._dirtyCounter.update(s=>s+1))}(i,Cw(e,t,s,c))}function we(e){return yu(function jN(){return _t.lFrame.contextLView}(),He+e)}function fn(e,i=""){const t=ue(),s=Bt(),c=e+He,u=s.firstCreatePass?Bu(s,c,1,i,null):s.data[c],f=bc(s,t,u,i,e);t[c]=f,Cp()&&hd(s,t,f,u),ga(u,!1)}let bc=(e,i,t,s,c)=>(dc(!0),function Zy(e,i){return e.createText(i)}(i[pt],s));function at(e){return gi("",e,""),at}function gi(e,i,t){const s=ue(),c=function oh(e,i,t,s){return $i(e,_a(),t)?i+It(t)+s:St}(s,e,i,t);return c!==St&&function fc(e,i,t){const s=Eu(i,e);!function CM(e,i,t){e.setValue(i,t)}(e[pt],s,t)}(s,Br(),c),gi}function os(e,i,t,s,c){if(e=ht(e),Array.isArray(e))for(let u=0;u<e.length;u++)os(e[u],i,t,s,c);else{const u=Bt(),f=ue(),_=Un();let E=gu(e)?e:ht(e.provide);const S=km(e),I=1048575&_.providerIndexes,P=_.directiveStart,U=_.providerIndexes>>20;if(gu(e)||!e.multi){const B=new Xm(S,c,re),G=Ys(E,i,c?I:I+U,P);-1===G?(cd(uy(_,f),u,E),vi(u,e,i.length),i.push(E),_.directiveStart++,_.directiveEnd++,c&&(_.providerIndexes+=1048576),t.push(B),f.push(B)):(t[G]=B,f[G]=B)}else{const B=Ys(E,i,I+U,P),G=Ys(E,i,I,I+U),te=G>=0&&t[G];if(c&&!te||!c&&!(B>=0&&t[B])){cd(uy(_,f),u,E);const ae=function Bn(e,i,t,s,c){const u=new Xm(e,t,re);return u.multi=[],u.index=i,u.componentProviders=0,kR(u,c,s&&!t),u}(c?Ma:Is,t.length,c,s,S);!c&&te&&(t[G].providerFactory=ae),vi(u,e,i.length,0),i.push(E),_.directiveStart++,_.directiveEnd++,c&&(_.providerIndexes+=1048576),t.push(ae),f.push(ae)}else vi(u,e,B>-1?B:G,kR(t[c?G:B],S,!c&&s));!c&&s&&te&&t[G].componentProviders++}}}function vi(e,i,t,s){const c=gu(i),u=function HT(e){return!!e.useClass}(i);if(c||u){const E=(u?ht(i.useClass):i).prototype.ngOnDestroy;if(E){const S=e.destroyHooks||(e.destroyHooks=[]);if(!c&&i.multi){const I=S.indexOf(t);-1===I?S.push(t,[s,E]):S[I+1].push(s,E)}else S.push(t,E)}}}function kR(e,i,t){return t&&e.componentProviders++,e.multi.push(i)-1}function Ys(e,i,t,s){for(let c=t;c<s;c++)if(i[c]===e)return c;return-1}function Is(e,i,t,s){return Od(this.multi,[])}function Ma(e,i,t,s){const c=this.multi;let u;if(this.providerFactory){const f=this.providerFactory.componentProviders,_=wu(t,t[Ie],this.providerFactory.index,s);u=_.slice(0,f),Od(c,u);for(let E=f;E<_.length;E++)u.push(_[E])}else u=[],Od(c,u);return u}function Od(e,i){for(let t=0;t<e.length;t++)i.push((0,e[t])());return i}function mn(e,i=[]){return t=>{t.providersResolver=(s,c)=>function qs(e,i,t){const s=Bt();if(s.firstCreatePass){const c=fa(e);os(t,s.data,s.blueprint,c,!0),os(i,s.data,s.blueprint,c,!1)}}(s,c?c(e):e,i)}}let Nd=(()=>{class e{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const s=GE(0,t.type),c=s.length>0?Vw([s],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,c)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static{this.\u0275prov=Oe({token:e,providedIn:"environment",factory:()=>new e(ye($o))})}}return e})();function fo(e){jr("NgStandalone"),e.getStandaloneInjector=i=>i.get(Nd).getOrCreateStandaloneInjector(e)}function SL(e,i,t,s,c,u,f){return function mh(e,i,t,s,c,u,f,_,E){const S=i+t;return function es(e,i,t,s,c,u){const f=Ed(e,i,t,s);return Ed(e,i+2,c,u)||f}(e,S,c,u,f,_)?Aa(e,S+4,E?s.call(E,c,u,f,_):s(c,u,f,_)):M_(e,S+4)}(ue(),so(),e,i,t,s,c,u,f)}function M_(e,i){const t=e[i];return t===St?void 0:t}function Mr(e,i){const t=Bt();let s;const c=e+He;t.firstCreatePass?(s=function IL(e,i){if(i)for(let t=i.length-1;t>=0;t--){const s=i[t];if(e===s.name)return s}}(i,t.pipeRegistry),t.data[c]=s,s.onDestroy&&(t.destroyHooks??=[]).push(c,s.onDestroy)):s=t.data[c];const u=s.factory||(s.factory=Or(s.type)),_=Ko(re);try{const E=dy(!1),S=u();return dy(E),function ur(e,i,t,s){t>=e.data.length&&(e.data[t]=null,e.blueprint[t]=null),i[t]=s}(t,ue(),c,S),S}finally{Ko(_)}}function L_(e,i,t){const s=e+He,c=ue(),u=yu(c,s);return function x_(e,i){return e[Ie].data[i].pure}(c,s)?function jn(e,i,t,s,c,u){const f=i+t;return $i(e,f,c)?Aa(e,f+1,u?s.call(u,c):s(c)):M_(e,f+1)}(c,so(),i,u.transform,t,u):u.transform(t)}function wL(e,i){return Dg(e,i)}let SS=(()=>{class e{log(t){console.log(t)}warn(t){console.warn(t)}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"platform"})}}return e})();const QR=new Te("");function H_(e){return!!e&&"function"==typeof e.then}function nA(e){return!!e&&"function"==typeof e.subscribe}const e5=new Te("");let WL=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,s)=>{this.resolve=t,this.reject=s}),this.appInits=me(e5,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const c of this.appInits){const u=c();if(H_(u))t.push(u);else if(nA(u)){const f=new Promise((_,E)=>{u.subscribe({complete:_,error:E})});t.push(f)}}const s=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{s()}).catch(c=>{this.reject(c)}),0===t.length&&s(),this.initialized=!0}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const wS=new Te("");let Sr=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=me(_B),this.afterRenderManager=me(t_),this.zonelessEnabled=me($u),this.dirtyFlags=0,this.deferredDirtyFlags=0,this.externalTestViews=new Set,this.beforeRender=new Mt,this.afterTick=new Mt,this.componentTypes=[],this.components=[],this.isStable=me(ld).hasPendingTasks.pipe(Jt(t=>!t)),this._injector=me($o)}get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}whenStable(){let t;return new Promise(s=>{t=this.isStable.subscribe({next:c=>{c&&s()}})}).finally(()=>{t.unsubscribe()})}get injector(){return this._injector}bootstrap(t,s){const c=t instanceof aw;if(!this._injector.get(WL).done)throw!c&&function nd(e){const i=Wt(e)||Vi(e)||Di(e);return null!==i&&i.standalone}(t),new se(405,!1);let f;f=c?t:this._injector.get(Qp).resolveComponentFactory(t),this.componentTypes.push(f.componentType);const _=function G_(e){return e.isBoundToModule}(f)?void 0:this._injector.get(Zu),S=f.create(Oi.NULL,[],s||f.selector,_),I=S.location.nativeElement,P=S.injector.get(QR,null);return P?.registerApplication(I),S.onDestroy(()=>{this.detachView(S.hostView),Eh(this.components,S),P?.unregisterApplication(I)}),this._loadComponent(S),S}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){if(this._runningTick)throw new se(101,!1);const t=gt(null);try{this._runningTick=!0,this.synchronize()}catch(s){this.internalErrorHandler(s)}finally{this._runningTick=!1,gt(t),this.afterTick.next()}}synchronize(){let t=null;this._injector.destroyed||(t=this._injector.get(Tb,null,{optional:!0})),this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0;let s=0;for(;0!==this.dirtyFlags&&s++<10;)this.synchronizeOnce(t)}synchronizeOnce(t){if(this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0,7&this.dirtyFlags){const s=!!(1&this.dirtyFlags);this.dirtyFlags&=-8,this.dirtyFlags|=8,this.beforeRender.next(s);for(let{_lView:c,notifyErrorHandler:u}of this._views)t5(c,u,s,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),7&this.dirtyFlags)return}else t?.begin?.(),t?.end?.();8&this.dirtyFlags&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){this.allViews.some(({_lView:t})=>bu(t))?this.dirtyFlags|=2:this.dirtyFlags&=-8}attachView(t){const s=t;this._views.push(s),s.attachToAppRef(this)}detachView(t){const s=t;Eh(this._views,s),s.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const s=this._injector.get(wS,[]);[...this._bootstrapListeners,...s].forEach(c=>c(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>Eh(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new se(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Eh(e,i){const t=e.indexOf(i);t>-1&&e.splice(t,1)}function t5(e,i,t,s){(t||bu(e))&&Rg(e,i,t&&!s?0:1)}class oA{constructor(i,t){this.ngModuleFactory=i,this.componentFactories=t}}let YL=(()=>{class e{compileModuleSync(t){return new Pb(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const s=this.compileModuleSync(t),u=Qo(io(t).declarations).reduce((f,_)=>{const E=Wt(_);return E&&f.push(new ef(E)),f},[]);return new oA(s,u)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),XL=(()=>{class e{constructor(){this.zone=me(ft),this.changeDetectionScheduler=me(Zp),this.applicationRef=me(Sr)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Lf({ngZoneFactory:e,ignoreChangesOutsideZone:i,scheduleInRootZone:t}){return e??=()=>new ft({...W_(),scheduleInRootZone:t}),[{provide:ft,useFactory:e},{provide:rc,multi:!0,useFactory:()=>{const s=me(XL,{optional:!0});return()=>s.initialize()}},{provide:rc,multi:!0,useFactory:()=>{const s=me(cA);return()=>{s.initialize()}}},!0===i?{provide:Cb,useValue:!0}:[],{provide:Jp,useValue:t??Ru}]}function W_(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}let cA=(()=>{class e{constructor(){this.subscription=new Ri,this.initialized=!1,this.zone=me(ft),this.pendingTasks=me(ld)}initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{ft.assertNotInAngularZone(),queueMicrotask(()=>{null!==t&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{ft.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Ic=(()=>{class e{constructor(){this.appRef=me(Sr),this.taskService=me(ld),this.ngZone=me(ft),this.zonelessEnabled=me($u),this.disableScheduling=me(Cb,{optional:!0})??!1,this.zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run,this.schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}],this.subscriptions=new Ri,this.angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(vy):null,this.scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(me(Jp,{optional:!0})??!1),this.cancelScheduledCallback=null,this.useMicrotaskScheduler=!1,this.runningTick=!1,this.pendingRenderTaskId=null,this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof Np||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&5===t)return;switch(t){case 0:this.appRef.dirtyFlags|=2;break;case 3:case 2:case 4:case 5:case 1:this.appRef.dirtyFlags|=4;break;case 7:this.appRef.deferredDirtyFlags|=8;break;default:this.appRef.dirtyFlags|=8}if(!this.shouldScheduleTick())return;const s=this.useMicrotaskScheduler?pP:N0;this.pendingRenderTaskId=this.taskService.add(),this.cancelScheduledCallback=this.scheduleInRootZone?Zone.root.run(()=>s(()=>this.tick())):this.ngZone.runOutsideAngular(()=>s(()=>this.tick()))}shouldScheduleTick(){return!(this.disableScheduling||null!==this.pendingRenderTaskId||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(vy+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;!this.zonelessEnabled&&7&this.appRef.dirtyFlags&&(this.appRef.dirtyFlags|=1);const t=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(s){throw this.taskService.remove(t),s}finally{this.cleanup()}this.useMicrotaskScheduler=!0,pP(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(t)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,null!==this.pendingRenderTaskId){const t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const No=new Te("",{providedIn:"root",factory:()=>me(No,Yt.Optional|Yt.SkipSelf)||function QL(){return typeof $localize<"u"&&$localize.locale||Nn}()}),OS=new Te("");function q_(e){return!e.moduleRef}let Hn=null;let Js=(()=>{class e{static{this.__NG_ELEMENT_ID__=ge}}return e})();function ge(e){return function zt(e,i,t){if(od(e)&&!t){const s=Es(e.index,i);return new Ag(s,s)}return 175&e.type?new Ag(i[hi],i):null}(Un(),ue(),!(16&~e))}function Cx(e){try{const{rootComponent:i,appProviders:t,platformProviders:s}=e,c=function hA(e=[]){if(Hn)return Hn;const i=function wi(e=[],i){return Oi.create({name:i,providers:[{provide:GT,useValue:"platform"},{provide:OS,useValue:new Set([()=>Hn=null])},...e]})}(e);return Hn=i,function zL(){!function Ui(e){XO=e}(()=>{throw new se(600,!1)})}(),function rx(e){e.get(kP,null)?.forEach(t=>t())}(i),i}(s),u=[Lf({}),{provide:Zp,useExisting:Ic},...t||[]];return function tx(e){const i=q_(e)?e.r3Injector:e.moduleRef.injector,t=i.get(ft);return t.run(()=>{q_(e)?e.r3Injector.resolveInjectorInitializers():e.moduleRef.resolveInjectorInitializers();const s=i.get(ya,null);let c;if(t.runOutsideAngular(()=>{c=t.onError.subscribe({next:u=>{s.handleError(u)}})}),q_(e)){const u=()=>i.destroy(),f=e.platformInjector.get(OS);f.add(u),i.onDestroy(()=>{c.unsubscribe(),f.delete(u)})}else{const u=()=>e.moduleRef.destroy(),f=e.platformInjector.get(OS);f.add(u),e.moduleRef.onDestroy(()=>{Eh(e.allPlatformModules,e.moduleRef),c.unsubscribe(),f.delete(u)})}return function qL(e,i,t){try{const s=t();return H_(s)?s.catch(c=>{throw i.runOutsideAngular(()=>e.handleError(c)),c}):s}catch(s){throw i.runOutsideAngular(()=>e.handleError(s)),s}}(s,t,()=>{const u=i.get(WL);return u.runInitializers(),u.donePromise.then(()=>{if(function fR(e){"string"==typeof e&&(C_=e.toLowerCase().replace(/_/g,"-"))}(i.get(No,Nn)||Nn),q_(e)){const _=i.get(Sr);return void 0!==e.rootComponent&&_.bootstrap(e.rootComponent),_}return function nx(e,i){const t=e.injector.get(Sr);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(s=>t.bootstrap(s));else{if(!e.instance.ngDoBootstrap)throw new se(-403,!1);e.instance.ngDoBootstrap(t)}i.push(e)}(e.moduleRef,e.allPlatformModules),e.moduleRef})})})}({r3Injector:new c1({providers:u,parent:c,debugName:"",runEnvironmentInitializers:!1}).injector,platformInjector:c,rootComponent:i})}catch(i){return Promise.reject(i)}}function zr(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}function Ud(e,i){jr("NgSignals");const t=_E(e);return i?.equal&&(t[Pt].equal=i.equal),t}function Qs(e){const i=gt(null);try{return e()}finally{gt(i)}}let BA=null;function Al(){return BA}class Wx{}const Ve=new Te("");let VS=(()=>{class e{historyGo(t){throw new Error("")}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:()=>me(Kx),providedIn:"platform"})}}return e})(),Kx=(()=>{class e extends VS{constructor(){super(),this._doc=me(Ve),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Al().getBaseHref(this._doc)}onPopState(t){const s=Al().getGlobalEventTarget(this._doc,"window");return s.addEventListener("popstate",t,!1),()=>s.removeEventListener("popstate",t)}onHashChange(t){const s=Al().getGlobalEventTarget(this._doc,"window");return s.addEventListener("hashchange",t,!1),()=>s.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,s,c){this._history.pushState(t,s,c)}replaceState(t,s,c){this._history.replaceState(t,s,c)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:()=>new e,providedIn:"platform"})}}return e})();function jA(e,i){if(0==e.length)return i;if(0==i.length)return e;let t=0;return e.endsWith("/")&&t++,i.startsWith("/")&&t++,2==t?e+i.substring(1):1==t?e+i:e+"/"+i}function HA(e){const i=e.match(/#|\?|$/),t=i&&i.index||e.length;return e.slice(0,t-("/"===e[t-1]?1:0))+e.slice(t)}function Vd(e){return e&&"?"!==e[0]?"?"+e:e}let go=(()=>{class e{historyGo(t){throw new Error("")}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:()=>me(Yx),providedIn:"root"})}}return e})();const qx=new Te("");let Yx=(()=>{class e extends go{constructor(t,s){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=s??this._platformLocation.getBaseHrefFromDOM()??me(Ve).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return jA(this._baseHref,t)}path(t=!1){const s=this._platformLocation.pathname+Vd(this._platformLocation.search),c=this._platformLocation.hash;return c&&t?`${s}${c}`:s}pushState(t,s,c,u){const f=this.prepareExternalUrl(c+Vd(u));this._platformLocation.pushState(t,s,f)}replaceState(t,s,c,u){const f=this.prepareExternalUrl(c+Vd(u));this._platformLocation.replaceState(t,s,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static{this.\u0275fac=function(s){return new(s||e)(ye(VS),ye(qx,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Ih=(()=>{class e{constructor(t){this._subject=new Dn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const s=this._locationStrategy.getBaseHref();this._basePath=function Zx(e){if(new RegExp("^(https?:)?//").test(e)){const[,t]=e.split(/\/\/[^\/]+/);return t}return e}(HA(pr(s))),this._locationStrategy.onPopState(c=>{this._subject.emit({url:this.path(!0),pop:!0,state:c.state,type:c.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,s=""){return this.path()==this.normalize(t+Vd(s))}normalize(t){return e.stripTrailingSlash(function Xx(e,i){if(!e||!i.startsWith(e))return i;const t=i.substring(e.length);return""===t||["/",";","?","#"].includes(t[0])?t:i}(this._basePath,pr(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,s="",c=null){this._locationStrategy.pushState(c,"",t,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Vd(s)),c)}replaceState(t,s="",c=null){this._locationStrategy.replaceState(c,"",t,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Vd(s)),c)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(s=>{this._notifyUrlChangeListeners(s.url,s.state)}),()=>{const s=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(s,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",s){this._urlChangeListeners.forEach(c=>c(t,s))}subscribe(t,s,c){return this._subject.subscribe({next:t,error:s,complete:c})}static{this.normalizeQueryParams=Vd}static{this.joinWithSlash=jA}static{this.stripTrailingSlash=HA}static{this.\u0275fac=function(s){return new(s||e)(ye(go))}}static{this.\u0275prov=Oe({token:e,factory:()=>function $x(){return new Ih(ye(go))}(),providedIn:"root"})}}return e})();function pr(e){return e.replace(/\/index.html$/,"")}const fv=/\s+/,rD=[];let mv=(()=>{class e{constructor(t,s){this._ngEl=t,this._renderer=s,this.initialClasses=rD,this.stateMap=new Map}set klass(t){this.initialClasses=null!=t?t.trim().split(fv):rD}set ngClass(t){this.rawClass="string"==typeof t?t.trim().split(fv):t}ngDoCheck(){for(const s of this.initialClasses)this._updateState(s,!0);const t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(const s of t)this._updateState(s,!0);else if(null!=t)for(const s of Object.keys(t))this._updateState(s,!!t[s]);this._applyStateDiff()}_updateState(t,s){const c=this.stateMap.get(t);void 0!==c?(c.enabled!==s&&(c.changed=!0,c.enabled=s),c.touched=!0):this.stateMap.set(t,{enabled:s,changed:!0,touched:!0})}_applyStateDiff(){for(const t of this.stateMap){const s=t[0],c=t[1];c.changed?(this._toggleClass(s,c.enabled),c.changed=!1):c.touched||(c.enabled&&this._toggleClass(s,!1),this.stateMap.delete(s)),c.touched=!1}}_toggleClass(t,s){(t=t.trim()).length>0&&t.split(fv).forEach(c=>{s?this._renderer.addClass(this._ngEl.nativeElement,c):this._renderer.removeClass(this._ngEl.nativeElement,c)})}static{this.\u0275fac=function(s){return new(s||e)(re(On),re(mc))}}static{this.\u0275dir=Ue({type:e,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"},standalone:!0})}}return e})(),QS=(()=>{class e{constructor(t,s){this._viewContainer=t,this._context=new aD,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=s}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){p2("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){p2("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,s){return!0}static{this.\u0275fac=function(s){return new(s||e)(re(js),re(sl))}}static{this.\u0275dir=Ue({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}}return e})();class aD{constructor(){this.$implicit=null,this.ngIf=null}}function p2(e,i){if(i&&!i.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${mr(i)}'.`)}let dD=(()=>{class e{constructor(t){this._viewContainerRef=t,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(t){if(this._shouldRecreateView(t)){const s=this._viewContainerRef;if(this._viewRef&&s.remove(s.indexOf(this._viewRef)),!this.ngTemplateOutlet)return void(this._viewRef=null);const c=this._createContextForwardProxy();this._viewRef=s.createEmbeddedView(this.ngTemplateOutlet,c,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(t){return!!t.ngTemplateOutlet||!!t.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(t,s,c)=>!!this.ngTemplateOutletContext&&Reflect.set(this.ngTemplateOutletContext,s,c),get:(t,s,c)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,s,c)}})}static{this.\u0275fac=function(s){return new(s||e)(re(js))}}static{this.\u0275dir=Ue({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[Xo]})}}return e})();class $5{createSubscription(i,t){return Qs(()=>i.subscribe({next:t,error:s=>{throw s}}))}dispose(i){Qs(()=>i.unsubscribe())}}class uD{createSubscription(i,t){return i.then(t,s=>{throw s})}dispose(i){}}const _2=new uD,X5=new $5;let hD=(()=>{class e{constructor(t){this._latestValue=null,this.markForCheckOnValueUpdate=!0,this._subscription=null,this._obj=null,this._strategy=null,this._ref=t}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(t){if(!this._obj){if(t)try{this.markForCheckOnValueUpdate=!1,this._subscribe(t)}finally{this.markForCheckOnValueUpdate=!0}return this._latestValue}return t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,s=>this._updateLatestValue(t,s))}_selectStrategy(t){if(H_(t))return _2;if(nA(t))return X5;throw function Ua(e,i){return new se(2100,!1)}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,s){t===this._obj&&(this._latestValue=s,this.markForCheckOnValueUpdate&&this._ref?.markForCheck())}static{this.\u0275fac=function(s){return new(s||e)(re(Js,16))}}static{this.\u0275pipe=To({name:"async",type:e,pure:!1,standalone:!0})}}return e})(),ED=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({})}}return e})();const Pl="browser";function tC(e){return"server"===e}class K2 extends Wx{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Kd extends K2{static makeCurrent(){!function Gx(e){BA??=e}(new Kd)}onAndCancel(i,t,s){return i.addEventListener(t,s),()=>{i.removeEventListener(t,s)}}dispatchEvent(i,t){i.dispatchEvent(t)}remove(i){i.remove()}createElement(i,t){return(t=t||this.getDefaultDocument()).createElement(i)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(i){return i.nodeType===Node.ELEMENT_NODE}isShadowRoot(i){return i instanceof DocumentFragment}getGlobalEventTarget(i,t){return"window"===t?window:"document"===t?i:"body"===t?i.body:null}getBaseHref(i){const t=function SH(){return bv=bv||document.querySelector("base"),bv?bv.getAttribute("href"):null}();return null==t?null:function Lh(e){return new URL(e,document.baseURI).pathname}(t)}resetBaseElement(){bv=null}getUserAgent(){return window.navigator.userAgent}getCookie(i){return function u2(e,i){i=encodeURIComponent(i);for(const t of e.split(";")){const s=t.indexOf("="),[c,u]=-1==s?[t,""]:[t.slice(0,s),t.slice(s+1)];if(c.trim()===i)return decodeURIComponent(u)}return null}(document.cookie,i)}}let bv=null,ND=(()=>{class e{build(){return new XMLHttpRequest}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})();const Sv=new Te("");let hC=(()=>{class e{constructor(t,s){this._zone=s,this._eventNameToPlugin=new Map,t.forEach(c=>{c.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,s,c){return this._findPluginFor(s).addEventListener(t,s,c)}getZone(){return this._zone}_findPluginFor(t){let s=this._eventNameToPlugin.get(t);if(s)return s;if(s=this._plugins.find(u=>u.supports(t)),!s)throw new se(5101,!1);return this._eventNameToPlugin.set(t,s),s}static{this.\u0275fac=function(s){return new(s||e)(ye(Sv),ye(ft))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})();class Cv{constructor(i){this._doc=i}}const PD="ng-app-id";let pC=(()=>{class e{constructor(t,s,c,u={}){this.doc=t,this.appId=s,this.nonce=c,this.platformId=u,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=tC(u),this.resetHostNodes()}addStyles(t){for(const s of t)1===this.changeUsageCount(s,1)&&this.onStyleAdded(s)}removeStyles(t){for(const s of t)this.changeUsageCount(s,-1)<=0&&this.onStyleRemoved(s)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(s=>s.remove()),t.clear());for(const s of this.getAllStyles())this.onStyleRemoved(s);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const s of this.getAllStyles())this.addStyleToHost(t,s)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const s of this.hostNodes)this.addStyleToHost(s,t)}onStyleRemoved(t){const s=this.styleRef;s.get(t)?.elements?.forEach(c=>c.remove()),s.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${PD}="${this.appId}"]`);if(t?.length){const s=new Map;return t.forEach(c=>{null!=c.textContent&&s.set(c.textContent,c)}),s}return null}changeUsageCount(t,s){const c=this.styleRef;if(c.has(t)){const u=c.get(t);return u.usage+=s,u.usage}return c.set(t,{usage:s,elements:[]}),s}getStyleElement(t,s){const c=this.styleNodesInDOM,u=c?.get(s);if(u?.parentNode===t)return c.delete(s),u.removeAttribute(PD),u;{const f=this.doc.createElement("style");return this.nonce&&f.setAttribute("nonce",this.nonce),f.textContent=s,this.platformIsServer&&f.setAttribute(PD,this.appId),t.appendChild(f),f}}addStyleToHost(t,s){const c=this.getStyleElement(t,s),u=this.styleRef,f=u.get(s)?.elements;f?f.push(c):u.set(s,{elements:[c],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve),ye(Vp),ye(G0,8),ye(dd))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})();const fC={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},Tv=/%COMP%/g,Y2=new Te("",{providedIn:"root",factory:()=>!0});function Iv(e,i){return i.map(t=>t.replace(Tv,e))}let mC=(()=>{class e{constructor(t,s,c,u,f,_,E,S=null){this.eventManager=t,this.sharedStylesHost=s,this.appId=c,this.removeStylesOnCompDestroy=u,this.doc=f,this.platformId=_,this.ngZone=E,this.nonce=S,this.rendererByCompId=new Map,this.platformIsServer=tC(_),this.defaultRenderer=new xD(t,f,E,this.platformIsServer)}createRenderer(t,s){if(!t||!s)return this.defaultRenderer;this.platformIsServer&&s.encapsulation===la.ShadowDom&&(s={...s,encapsulation:la.Emulated});const c=this.getOrCreateRenderer(t,s);return c instanceof Z2?c.applyToHost(t):c instanceof wv&&c.applyStyles(),c}getOrCreateRenderer(t,s){const c=this.rendererByCompId;let u=c.get(s.id);if(!u){const f=this.doc,_=this.ngZone,E=this.eventManager,S=this.sharedStylesHost,I=this.removeStylesOnCompDestroy,P=this.platformIsServer;switch(s.encapsulation){case la.Emulated:u=new Z2(E,S,s,this.appId,I,f,_,P);break;case la.ShadowDom:return new TH(E,S,t,s,f,_,this.nonce,P);default:u=new wv(E,S,s,I,f,_,P)}c.set(s.id,u)}return u}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(s){return new(s||e)(ye(hC),ye(pC),ye(Vp),ye(Y2),ye(Ve),ye(dd),ye(ft),ye(G0))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})();class xD{constructor(i,t,s,c){this.eventManager=i,this.doc=t,this.ngZone=s,this.platformIsServer=c,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(i,t){return t?this.doc.createElementNS(fC[t]||t,i):this.doc.createElement(i)}createComment(i){return this.doc.createComment(i)}createText(i){return this.doc.createTextNode(i)}appendChild(i,t){(Fh(i)?i.content:i).appendChild(t)}insertBefore(i,t,s){i&&(Fh(i)?i.content:i).insertBefore(t,s)}removeChild(i,t){t.remove()}selectRootElement(i,t){let s="string"==typeof i?this.doc.querySelector(i):i;if(!s)throw new se(-5104,!1);return t||(s.textContent=""),s}parentNode(i){return i.parentNode}nextSibling(i){return i.nextSibling}setAttribute(i,t,s,c){if(c){t=c+":"+t;const u=fC[c];u?i.setAttributeNS(u,t,s):i.setAttribute(t,s)}else i.setAttribute(t,s)}removeAttribute(i,t,s){if(s){const c=fC[s];c?i.removeAttributeNS(c,t):i.removeAttribute(`${s}:${t}`)}else i.removeAttribute(t)}addClass(i,t){i.classList.add(t)}removeClass(i,t){i.classList.remove(t)}setStyle(i,t,s,c){c&(ud.DashCase|ud.Important)?i.style.setProperty(t,s,c&ud.Important?"important":""):i.style[t]=s}removeStyle(i,t,s){s&ud.DashCase?i.style.removeProperty(t):i.style[t]=""}setProperty(i,t,s){null!=i&&(i[t]=s)}setValue(i,t){i.nodeValue=t}listen(i,t,s){if("string"==typeof i&&!(i=Al().getGlobalEventTarget(this.doc,i)))throw new Error(`Unsupported event target ${i} for event ${t}`);return this.eventManager.addEventListener(i,t,this.decoratePreventDefault(s))}decoratePreventDefault(i){return t=>{if("__ngUnwrap__"===t)return i;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>i(t)):i(t))&&t.preventDefault()}}}function Fh(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class TH extends xD{constructor(i,t,s,c,u,f,_,E){super(i,u,f,E),this.sharedStylesHost=t,this.hostEl=s,this.shadowRoot=s.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const S=Iv(c.id,c.styles);for(const I of S){const P=document.createElement("style");_&&P.setAttribute("nonce",_),P.textContent=I,this.shadowRoot.appendChild(P)}}nodeOrShadowRoot(i){return i===this.hostEl?this.shadowRoot:i}appendChild(i,t){return super.appendChild(this.nodeOrShadowRoot(i),t)}insertBefore(i,t,s){return super.insertBefore(this.nodeOrShadowRoot(i),t,s)}removeChild(i,t){return super.removeChild(null,t)}parentNode(i){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(i)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class wv extends xD{constructor(i,t,s,c,u,f,_,E){super(i,u,f,_),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=c,this.styles=E?Iv(E,s.styles):s.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class Z2 extends wv{constructor(i,t,s,c,u,f,_,E){const S=c+"-"+s.id;super(i,t,s,u,f,_,E,S),this.contentAttr=function $2(e){return"_ngcontent-%COMP%".replace(Tv,e)}(S),this.hostAttr=function X2(e){return"_nghost-%COMP%".replace(Tv,e)}(S)}applyToHost(i){this.applyStyles(),this.setAttribute(i,this.hostAttr,"")}createElement(i,t){const s=super.createElement(i,t);return super.setAttribute(s,this.contentAttr,""),s}}const FD=["alt","control","meta","shift"],J2={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Q2={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};function Xf(e){return{appProviders:[...VD,...e?.providers??[]],platformProviders:tF}}const tF=[{provide:dd,useValue:Pl},{provide:kP,useValue:function wH(){Kd.makeCurrent()},multi:!0},{provide:Ve,useFactory:function eF(){return function PP(e){sg=e}(document),document},deps:[]}],VD=[{provide:GT,useValue:"root"},{provide:ya,useFactory:function Yd(){return new ya},deps:[]},{provide:Sv,useClass:(()=>{class e extends Cv{constructor(t){super(t)}supports(t){return!0}addEventListener(t,s,c){return t.addEventListener(s,c,!1),()=>this.removeEventListener(t,s,c)}removeEventListener(t,s,c){return t.removeEventListener(s,c)}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})(),multi:!0,deps:[Ve,ft,dd]},{provide:Sv,useClass:(()=>{class e extends Cv{constructor(t){super(t)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,s,c){const u=e.parseEventName(s),f=e.eventCallback(u.fullKey,c,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Al().onAndCancel(t,u.domEventName,f))}static parseEventName(t){const s=t.toLowerCase().split("."),c=s.shift();if(0===s.length||"keydown"!==c&&"keyup"!==c)return null;const u=e._normalizeKey(s.pop());let f="",_=s.indexOf("code");if(_>-1&&(s.splice(_,1),f="code."),FD.forEach(S=>{const I=s.indexOf(S);I>-1&&(s.splice(I,1),f+=S+".")}),f+=u,0!=s.length||0===u.length)return null;const E={};return E.domEventName=c,E.fullKey=f,E}static matchEventFullKeyCode(t,s){let c=J2[t.key]||t.key,u="";return s.indexOf("code.")>-1&&(c=t.code,u="code."),!(null==c||!c)&&(c=c.toLowerCase()," "===c?c="space":"."===c&&(c="dot"),FD.forEach(f=>{f!==c&&(0,Q2[f])(t)&&(u+=f+".")}),u+=c,u===s)}static eventCallback(t,s,c){return u=>{e.matchEventFullKeyCode(u,t)&&c.runGuarded(()=>s(u))}}static _normalizeKey(t){return"esc"===t?"escape":t}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})(),multi:!0,deps:[Ve]},mC,pC,hC,{provide:Tb,useExisting:mC},{provide:class A2{},useClass:ND,deps:[]},[]];let DH=(()=>{class e{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function kl(e){return this instanceof kl?(this.v=e,this):new kl(e)}function Os(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e=function bC(e){var i="function"==typeof Symbol&&Symbol.iterator,t=i&&e[i],s=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(u){t[u]=e[u]&&function(f){return new Promise(function(_,E){!function c(u,f,_,E){Promise.resolve(E).then(function(S){u({value:S,done:_})},f)}(_,E,(f=e[u](f)).done,f.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const zD=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function fr(e){return vn(e?.then)}function Uh(e){return vn(e[pT])}function TC(e){return Symbol.asyncIterator&&vn(e?.[Symbol.asyncIterator])}function KD(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Jf=function Dv(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function IC(e){return vn(e?.[Jf])}function Ov(e){return function fe(e,i,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,s=t.apply(e,i||[]),u=[];return c=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),_("next"),_("throw"),_("return",function f(B){return function(G){return Promise.resolve(G).then(B,P)}}),c[Symbol.asyncIterator]=function(){return this},c;function _(B,G){s[B]&&(c[B]=function(K){return new Promise(function(te,ae){u.push([B,K,te,ae])>1||E(B,K)})},G&&(c[B]=G(c[B])))}function E(B,G){try{!function S(B){B.value instanceof kl?Promise.resolve(B.value.v).then(I,P):U(u[0][2],B)}(s[B](G))}catch(K){U(u[0][3],K)}}function I(B){E("next",B)}function P(B){E("throw",B)}function U(B,G){B(G),u.shift(),u.length&&E(u[0][0],u[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:s,done:c}=yield kl(t.read());if(c)return yield kl(void 0);yield yield kl(s)}}finally{t.releaseLock()}})}function CF(e){return vn(e?.getReader)}function qr(e){if(e instanceof ni)return e;if(null!=e){if(Uh(e))return function Ll(e){return new ni(i=>{const t=e[pT]();if(vn(t.subscribe))return t.subscribe(i);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(zD(e))return function Nv(e){return new ni(i=>{for(let t=0;t<e.length&&!i.closed;t++)i.next(e[t]);i.complete()})}(e);if(fr(e))return function Pv(e){return new ni(i=>{e.then(t=>{i.closed||(i.next(t),i.complete())},t=>i.error(t)).then(null,bE)})}(e);if(TC(e))return wC(e);if(IC(e))return function Mv(e){return new ni(i=>{for(const t of e)if(i.next(t),i.closed)return;i.complete()})}(e);if(CF(e))return function RC(e){return wC(Ov(e))}(e)}throw KD(e)}function wC(e){return new ni(i=>{(function qD(e,i){var t,s,c,u;return function HD(e,i,t,s){return new(t||(t=Promise))(function(u,f){function _(I){try{S(s.next(I))}catch(P){f(P)}}function E(I){try{S(s.throw(I))}catch(P){f(P)}}function S(I){I.done?u(I.value):function c(u){return u instanceof t?u:new t(function(f){f(u)})}(I.value).then(_,E)}S((s=s.apply(e,i||[])).next())})}(this,void 0,void 0,function*(){try{for(t=Os(e);!(s=yield t.next()).done;)if(i.next(s.value),i.closed)return}catch(f){c={error:f}}finally{try{s&&!s.done&&(u=t.return)&&(yield u.call(t))}finally{if(c)throw c.error}}i.complete()})})(e,i).catch(t=>i.error(t))})}function Oc(e,i,t,s=0,c=!1){const u=i.schedule(function(){t(),c?e.add(this.schedule(null,s)):this.unsubscribe()},s);if(e.add(u),!c)return u}function YD(e,i=0){return yi((t,s)=>{t.subscribe(ui(s,c=>Oc(s,e,()=>s.next(c),i),()=>Oc(s,e,()=>s.complete(),i),c=>Oc(s,e,()=>s.error(c),i)))})}function $D(e,i=0){return yi((t,s)=>{s.add(e.schedule(()=>t.subscribe(s),i))})}function ja(e,i){if(!e)throw new Error("Iterable cannot be null");return new ni(t=>{Oc(t,i,()=>{const s=e[Symbol.asyncIterator]();Oc(t,i,()=>{s.next().then(c=>{c.done?t.complete():t.next(c.value)})},0,!0)})})}function Lr(e,i){return i?function wF(e,i){if(null!=e){if(Uh(e))return function XD(e,i){return qr(e).pipe($D(i),YD(i))}(e,i);if(zD(e))return function kv(e,i){return new ni(t=>{let s=0;return i.schedule(function(){s===e.length?t.complete():(t.next(e[s++]),t.closed||this.schedule())})})}(e,i);if(fr(e))return function TF(e,i){return qr(e).pipe($D(i),YD(i))}(e,i);if(TC(e))return ja(e,i);if(IC(e))return function hs(e,i){return new ni(t=>{let s;return Oc(t,i,()=>{s=e[Jf](),Oc(t,i,()=>{let c,u;try{({value:c,done:u}=s.next())}catch(f){return void t.error(f)}u?t.complete():t.next(c)},0,!0)}),()=>vn(s?.return)&&s.return()})}(e,i);if(CF(e))return function IF(e,i){return ja(Ov(e),i)}(e,i)}throw KD(e)}(e,i):qr(e)}function ZD(e){return e&&vn(e.schedule)}function AC(e){return e[e.length-1]}function DC(e){return vn(AC(e))?e.pop():void 0}function Qf(e){return ZD(AC(e))?e.pop():void 0}function vt(...e){return Lr(e,Qf(e))}const Lv=uT(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:RF}=Array,{getPrototypeOf:AF,prototype:QH,keys:e6}=Object;function DF(e){if(1===e.length){const i=e[0];if(RF(i))return{args:i,keys:null};if(function t6(e){return e&&"object"==typeof e&&AF(e)===QH}(i)){const t=e6(i);return{args:t.map(s=>i[s]),keys:t}}}return{args:e,keys:null}}const{isArray:n6}=Array;function QD(e){return Jt(i=>function xv(e,i){return n6(i)?e(...i):e(i)}(e,i))}function Cr(e,i){return e.reduce((t,s,c)=>(t[s]=i[c],t),{})}function xl(...e){const i=Qf(e),t=DC(e),{args:s,keys:c}=DF(e);if(0===s.length)return Lr([],i);const u=new ni(function em(e,i,t=Xl){return s=>{OF(i,()=>{const{length:c}=e,u=new Array(c);let f=c,_=c;for(let E=0;E<c;E++)OF(i,()=>{const S=Lr(e[E],i);let I=!1;S.subscribe(ui(s,P=>{u[E]=P,I||(I=!0,_--),_||s.next(t(u.slice()))},()=>{--f||s.complete()}))},s)},s)}}(s,i,c?f=>Cr(c,f):Xl));return t?u.pipe(QD(t)):u}function OF(e,i,t){e?Oc(t,e,i):i()}function Yr(e,i,t=1/0){return vn(i)?Yr((s,c)=>Jt((u,f)=>i(s,u,c,f))(qr(e(s,c))),t):("number"==typeof i&&(t=i),yi((s,c)=>function eO(e,i,t,s,c,u,f,_){const E=[];let S=0,I=0,P=!1;const U=()=>{P&&!E.length&&!S&&i.complete()},B=K=>S<s?G(K):E.push(K),G=K=>{u&&i.next(K),S++;let te=!1;qr(t(K,I++)).subscribe(ui(i,ae=>{c?.(ae),u?B(ae):i.next(ae)},()=>{te=!0},void 0,()=>{if(te)try{for(S--;E.length&&S<s;){const ae=E.shift();f?Oc(i,f,()=>G(ae)):G(ae)}U()}catch(ae){i.error(ae)}}))};return e.subscribe(ui(i,B,()=>{P=!0,U()})),()=>{_?.()}}(s,c,e,t)))}function Ha(e=1/0){return Yr(Xl,e)}function oa(...e){return function i6(){return Ha(1)}()(Lr(e,Qf(e)))}function NF(e){return new ni(i=>{qr(e()).subscribe(i)})}function OC(e,i){const t=vn(e)?e:()=>e,s=c=>c.error(t());return new ni(i?c=>i.schedule(s,0,c):s)}const Fi=new ni(e=>e.complete());function NC(){return yi((e,i)=>{let t=null;e._refCount++;const s=ui(i,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(t=null);const c=e._connection,u=t;t=null,c&&(!u||c===u)&&c.unsubscribe(),i.unsubscribe()});e.subscribe(s),s.closed||(t=e.connect())})}class Ga extends ni{constructor(i,t){super(),this.source=i,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,oN(i)&&(this.lift=i.lift)}_subscribe(i){return this.getSubject().subscribe(i)}getSubject(){const i=this._subject;return(!i||i.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:i}=this;this._subject=this._connection=null,i?.unsubscribe()}connect(){let i=this._connection;if(!i){i=this._connection=new Ri;const t=this.getSubject();i.add(this.source.subscribe(ui(t,void 0,()=>{this._teardown(),t.complete()},s=>{this._teardown(),t.error(s)},()=>this._teardown()))),i.closed&&(this._connection=null,i=Ri.EMPTY)}return i}refCount(){return NC()(this)}}function Nc(e,i){return yi((t,s)=>{let c=null,u=0,f=!1;const _=()=>f&&!c&&s.complete();t.subscribe(ui(s,E=>{c?.unsubscribe();let S=0;const I=u++;qr(e(E,I)).subscribe(c=ui(s,P=>s.next(i?i(E,P,I,S++):P),()=>{c=null,_()}))},()=>{f=!0,_()}))})}function nr(e){return e<=0?()=>Fi:yi((i,t)=>{let s=0;i.subscribe(ui(t,c=>{++s<=e&&(t.next(c),e<=s&&t.complete())}))})}function PF(...e){const i=Qf(e);return yi((t,s)=>{(i?oa(e,t,i):oa(e,t)).subscribe(s)})}function Ns(e,i){return yi((t,s)=>{let c=0;t.subscribe(ui(s,u=>e.call(i,u,c++)&&s.next(u)))})}function Vh(e){return yi((i,t)=>{let s=!1;i.subscribe(ui(t,c=>{s=!0,t.next(c)},()=>{s||t.next(e),t.complete()}))})}function MF(e=o6){return yi((i,t)=>{let s=!1;i.subscribe(ui(t,c=>{s=!0,t.next(c)},()=>s?t.complete():t.error(e())))})}function o6(){return new Lv}function Bh(e,i){const t=arguments.length>=2;return s=>s.pipe(e?Ns((c,u)=>e(c,u,s)):Xl,nr(1),t?Vh(i):MF(()=>new Lv))}function PC(e,i){return vn(i)?Yr(e,i,1):Yr(e,1)}function ir(e,i,t){const s=vn(e)||i||t?{next:e,error:i,complete:t}:e;return s?yi((c,u)=>{var f;null===(f=s.subscribe)||void 0===f||f.call(s);let _=!0;c.subscribe(ui(u,E=>{var S;null===(S=s.next)||void 0===S||S.call(s,E),u.next(E)},()=>{var E;_=!1,null===(E=s.complete)||void 0===E||E.call(s),u.complete()},E=>{var S;_=!1,null===(S=s.error)||void 0===S||S.call(s,E),u.error(E)},()=>{var E,S;_&&(null===(E=s.unsubscribe)||void 0===E||E.call(s)),null===(S=s.finalize)||void 0===S||S.call(s)}))}):Xl}function Xd(e){return yi((i,t)=>{let u,s=null,c=!1;s=i.subscribe(ui(t,void 0,void 0,f=>{u=qr(e(f,Xd(e)(i))),s?(s.unsubscribe(),s=null,u.subscribe(t)):c=!0})),c&&(s.unsubscribe(),s=null,u.subscribe(t))})}function tO(e){return e<=0?()=>Fi:yi((i,t)=>{let s=[];i.subscribe(ui(t,c=>{s.push(c),e<s.length&&s.shift()},()=>{for(const c of s)t.next(c);t.complete()},void 0,()=>{s=null}))})}function Zd(e){return Jt(()=>e)}function sa(e){return yi((i,t)=>{try{i.subscribe(t)}finally{t.add(e)}})}function Tr(e){return yi((i,t)=>{qr(e).subscribe(ui(t,()=>t.complete(),tp)),!t.closed&&i.subscribe(t)})}const yt="primary",Fl=Symbol("RouteTitle");class jh{constructor(i){this.params=i||{}}has(i){return Object.prototype.hasOwnProperty.call(this.params,i)}get(i){if(this.has(i)){const t=this.params[i];return Array.isArray(t)?t[0]:t}return null}getAll(i){if(this.has(i)){const t=this.params[i];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Hh(e){return new jh(e)}function Jd(e,i,t){const s=t.path.split("/");if(s.length>e.length||"full"===t.pathMatch&&(i.hasChildren()||s.length<e.length))return null;const c={};for(let u=0;u<s.length;u++){const f=s[u],_=e[u];if(":"===f[0])c[f.substring(1)]=_;else if(f!==_.path)return null}return{consumed:e.slice(0,s.length),posParams:c}}function Xr(e,i){const t=e?jo(e):void 0,s=i?jo(i):void 0;if(!t||!s||t.length!=s.length)return!1;let c;for(let u=0;u<t.length;u++)if(c=t[u],!ps(e[c],i[c]))return!1;return!0}function jo(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function ps(e,i){if(Array.isArray(e)&&Array.isArray(i)){if(e.length!==i.length)return!1;const t=[...e].sort(),s=[...i].sort();return t.every((c,u)=>s[u]===c)}return e===i}function In(e){return e.length>0?e[e.length-1]:null}function aa(e){return function _C(e){return!!e&&(e instanceof ni||vn(e.lift)&&vn(e.subscribe))}(e)?e:H_(e)?Lr(Promise.resolve(e)):vt(e)}const nO={exact:function MC(e,i,t){if(!Wh(e.segments,i.segments)||!kC(e.segments,i.segments,t)||e.numberOfChildren!==i.numberOfChildren)return!1;for(const s in i.children)if(!e.children[s]||!MC(e.children[s],i.children[s],t))return!1;return!0},subset:Wa},iO={exact:function kF(e,i){return Xr(e,i)},subset:function tm(e,i){return Object.keys(i).length<=Object.keys(e).length&&Object.keys(i).every(t=>ps(e[t],i[t]))},ignored:()=>!0};function Gh(e,i,t){return nO[t.paths](e.root,i.root,t.matrixParams)&&iO[t.queryParams](e.queryParams,i.queryParams)&&!("exact"===t.fragment&&e.fragment!==i.fragment)}function Wa(e,i,t){return nm(e,i,i.segments,t)}function nm(e,i,t,s){if(e.segments.length>t.length){const c=e.segments.slice(0,t.length);return!(!Wh(c,t)||i.hasChildren()||!kC(c,t,s))}if(e.segments.length===t.length){if(!Wh(e.segments,t)||!kC(e.segments,t,s))return!1;for(const c in i.children)if(!e.children[c]||!Wa(e.children[c],i.children[c],s))return!1;return!0}{const c=t.slice(0,e.segments.length),u=t.slice(e.segments.length);return!!(Wh(e.segments,c)&&kC(e.segments,c,s)&&e.children[yt])&&nm(e.children[yt],i,u,s)}}function kC(e,i,t){return i.every((s,c)=>iO[t](e[c].parameters,s.parameters))}class za{constructor(i=new Kn([],{}),t={},s=null){this.root=i,this.queryParams=t,this.fragment=s}get queryParamMap(){return this._queryParamMap??=Hh(this.queryParams),this._queryParamMap}toString(){return xC.serialize(this)}}class Kn{constructor(i,t){this.segments=i,this.children=t,this.parent=null,Object.values(t).forEach(s=>s.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Fv(this)}}class im{constructor(i,t){this.path=i,this.parameters=t}get parameterMap(){return this._parameterMap??=Hh(this.parameters),this._parameterMap}toString(){return UF(this)}}function Wh(e,i){return e.length===i.length&&e.every((t,s)=>t.path===i[s].path)}let Pc=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:()=>new LC,providedIn:"root"})}}return e})();class LC{parse(i){const t=new BC(i);return new za(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(i){const t=`/${Ul(i.root,!0)}`,s=function u6(e){const i=Object.entries(e).map(([t,s])=>Array.isArray(s)?s.map(c=>`${Uv(t)}=${Uv(c)}`).join("&"):`${Uv(t)}=${Uv(s)}`).filter(t=>t);return i.length?`?${i.join("&")}`:""}(i.queryParams);return`${t}${s}${"string"==typeof i.fragment?`#${function xF(e){return encodeURI(e)}(i.fragment)}`:""}`}}const xC=new LC;function Fv(e){return e.segments.map(i=>UF(i)).join("/")}function Ul(e,i){if(!e.hasChildren())return Fv(e);if(i){const t=e.children[yt]?Ul(e.children[yt],!1):"",s=[];return Object.entries(e.children).forEach(([c,u])=>{c!==yt&&s.push(`${c}:${Ul(u,!1)}`)}),s.length>0?`${t}(${s.join("//")})`:t}{const t=function d6(e,i){let t=[];return Object.entries(e.children).forEach(([s,c])=>{s===yt&&(t=t.concat(i(c,s)))}),Object.entries(e.children).forEach(([s,c])=>{s!==yt&&(t=t.concat(i(c,s)))}),t}(e,(s,c)=>c===yt?[Ul(e.children[yt],!1)]:[`${c}:${Ul(s,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[yt]?`${Fv(e)}/${t[0]}`:`${Fv(e)}/(${t.join("//")})`}}function rm(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Uv(e){return rm(e).replace(/%3B/gi,";")}function rO(e){return rm(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function FC(e){return decodeURIComponent(e)}function FF(e){return FC(e.replace(/\+/g,"%20"))}function UF(e){return`${rO(e.path)}${function UC(e){return Object.entries(e).map(([i,t])=>`;${rO(i)}=${rO(t)}`).join("")}(e.parameters)}`}const h6=/^[^\/()?;#]+/;function oO(e){const i=e.match(h6);return i?i[0]:""}const p6=/^[^\/()?;=#]+/,sO=/^[^=?&#]+/,VC=/^[^&#]+/;class BC{constructor(i){this.url=i,this.remaining=i}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Kn([],{}):new Kn([],this.parseChildren())}parseQueryParams(){const i={};if(this.consumeOptional("?"))do{this.parseQueryParam(i)}while(this.consumeOptional("&"));return i}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const i=[];for(this.peekStartsWith("(")||i.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),i.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let s={};return this.peekStartsWith("(")&&(s=this.parseParens(!1)),(i.length>0||Object.keys(t).length>0)&&(s[yt]=new Kn(i,t)),s}parseSegment(){const i=oO(this.remaining);if(""===i&&this.peekStartsWith(";"))throw new se(4009,!1);return this.capture(i),new im(FC(i),this.parseMatrixParams())}parseMatrixParams(){const i={};for(;this.consumeOptional(";");)this.parseParam(i);return i}parseParam(i){const t=function Vv(e){const i=e.match(p6);return i?i[0]:""}(this.remaining);if(!t)return;this.capture(t);let s="";if(this.consumeOptional("=")){const c=oO(this.remaining);c&&(s=c,this.capture(s))}i[FC(t)]=FC(s)}parseQueryParam(i){const t=function f6(e){const i=e.match(sO);return i?i[0]:""}(this.remaining);if(!t)return;this.capture(t);let s="";if(this.consumeOptional("=")){const f=function m6(e){const i=e.match(VC);return i?i[0]:""}(this.remaining);f&&(s=f,this.capture(s))}const c=FF(t),u=FF(s);if(i.hasOwnProperty(c)){let f=i[c];Array.isArray(f)||(f=[f],i[c]=f),f.push(u)}else i[c]=u}parseParens(i){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const s=oO(this.remaining),c=this.remaining[s.length];if("/"!==c&&")"!==c&&";"!==c)throw new se(4010,!1);let u;s.indexOf(":")>-1?(u=s.slice(0,s.indexOf(":")),this.capture(u),this.capture(":")):i&&(u=yt);const f=this.parseChildren();t[u]=1===Object.keys(f).length?f[yt]:new Kn([],f),this.consumeOptional("//")}return t}peekStartsWith(i){return this.remaining.startsWith(i)}consumeOptional(i){return!!this.peekStartsWith(i)&&(this.remaining=this.remaining.substring(i.length),!0)}capture(i){if(!this.consumeOptional(i))throw new se(4011,!1)}}function VF(e){return e.segments.length>0?new Kn([],{[yt]:e}):e}function BF(e){const i={};for(const[s,c]of Object.entries(e.children)){const u=BF(c);if(s===yt&&0===u.segments.length&&u.hasChildren())for(const[f,_]of Object.entries(u.children))i[f]=_;else(u.segments.length>0||u.hasChildren())&&(i[s]=u)}return function g6(e){if(1===e.numberOfChildren&&e.children[yt]){const i=e.children[yt];return new Kn(e.segments.concat(i.segments),i.children)}return e}(new Kn(e.segments,i))}function zh(e){return e instanceof za}function aO(e){let i;const c=VF(function t(u){const f={};for(const E of u.children){const S=t(E);f[E.outlet]=S}const _=new Kn(u.url,f);return u===e&&(i=_),_}(e.root));return i??c}function jF(e,i,t,s){let c=e;for(;c.parent;)c=c.parent;if(0===i.length)return cO(c,c,c,t,s);const u=function GF(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new Ps(!0,0,e);let i=0,t=!1;const s=e.reduce((c,u,f)=>{if("object"==typeof u&&null!=u){if(u.outlets){const _={};return Object.entries(u.outlets).forEach(([E,S])=>{_[E]="string"==typeof S?S.split("/"):S}),[...c,{outlets:_}]}if(u.segmentPath)return[...c,u.segmentPath]}return"string"!=typeof u?[...c,u]:0===f?(u.split("/").forEach((_,E)=>{0==E&&"."===_||(0==E&&""===_?t=!0:".."===_?i++:""!=_&&c.push(_))}),c):[...c,u]},[]);return new Ps(t,i,s)}(i);if(u.toRoot())return cO(c,c,new Kn([],{}),t,s);const f=function _6(e,i,t){if(e.isAbsolute)return new jv(i,!0,0);if(!t)return new jv(i,!1,NaN);if(null===t.parent)return new jv(t,!0,0);const s=Kh(e.commands[0])?0:1;return function WF(e,i,t){let s=e,c=i,u=t;for(;u>c;){if(u-=c,s=s.parent,!s)throw new se(4005,!1);c=s.segments.length}return new jv(s,!1,c-u)}(t,t.segments.length-1+s,e.numberOfDoubleDots)}(u,c,e),_=f.processChildren?Ms(f.segmentGroup,f.index,u.commands):Hv(f.segmentGroup,f.index,u.commands);return cO(c,f.segmentGroup,_,t,s)}function Kh(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function Ka(e){return"object"==typeof e&&null!=e&&e.outlets}function cO(e,i,t,s,c){let f,u={};s&&Object.entries(s).forEach(([E,S])=>{u[E]=Array.isArray(S)?S.map(I=>`${I}`):`${S}`}),f=e===i?t:HF(e,i,t);const _=VF(BF(f));return new za(_,u,c)}function HF(e,i,t){const s={};return Object.entries(e.children).forEach(([c,u])=>{s[c]=u===i?t:HF(u,i,t)}),new Kn(e.segments,s)}class Ps{constructor(i,t,s){if(this.isAbsolute=i,this.numberOfDoubleDots=t,this.commands=s,i&&s.length>0&&Kh(s[0]))throw new se(4003,!1);const c=s.find(Ka);if(c&&c!==In(s))throw new se(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class jv{constructor(i,t,s){this.segmentGroup=i,this.processChildren=t,this.index=s}}function Hv(e,i,t){if(e??=new Kn([],{}),0===e.segments.length&&e.hasChildren())return Ms(e,i,t);const s=function lO(e,i,t){let s=0,c=i;const u={match:!1,pathIndex:0,commandIndex:0};for(;c<e.segments.length;){if(s>=t.length)return u;const f=e.segments[c],_=t[s];if(Ka(_))break;const E=`${_}`,S=s<t.length-1?t[s+1]:null;if(c>0&&void 0===E)break;if(E&&S&&"object"==typeof S&&void 0===S.outlets){if(!GC(E,S,f))return u;s+=2}else{if(!GC(E,{},f))return u;s++}c++}return{match:!0,pathIndex:c,commandIndex:s}}(e,i,t),c=t.slice(s.commandIndex);if(s.match&&s.pathIndex<e.segments.length){const u=new Kn(e.segments.slice(0,s.pathIndex),{});return u.children[yt]=new Kn(e.segments.slice(s.pathIndex),e.children),Ms(u,0,c)}return s.match&&0===c.length?new Kn(e.segments,{}):s.match&&!e.hasChildren()?Gv(e,i,t):s.match?Ms(e,0,c):Gv(e,i,t)}function Ms(e,i,t){if(0===t.length)return new Kn(e.segments,{});{const s=function jC(e){return Ka(e[0])?e[0].outlets:{[yt]:e}}(t),c={};if(Object.keys(s).some(u=>u!==yt)&&e.children[yt]&&1===e.numberOfChildren&&0===e.children[yt].segments.length){const u=Ms(e.children[yt],i,t);return new Kn(e.segments,u.children)}return Object.entries(s).forEach(([u,f])=>{"string"==typeof f&&(f=[f]),null!==f&&(c[u]=Hv(e.children[u],i,f))}),Object.entries(e.children).forEach(([u,f])=>{void 0===s[u]&&(c[u]=f)}),new Kn(e.segments,c)}}function Gv(e,i,t){const s=e.segments.slice(0,i);let c=0;for(;c<t.length;){const u=t[c];if(Ka(u)){const E=HC(u.outlets);return new Kn(s,E)}if(0===c&&Kh(t[0])){s.push(new im(e.segments[i].path,Wv(t[0]))),c++;continue}const f=Ka(u)?u.outlets[yt]:`${u}`,_=c<t.length-1?t[c+1]:null;f&&_&&Kh(_)?(s.push(new im(f,Wv(_))),c+=2):(s.push(new im(f,{})),c++)}return new Kn(s,{})}function HC(e){const i={};return Object.entries(e).forEach(([t,s])=>{"string"==typeof s&&(s=[s]),null!==s&&(i[t]=Gv(new Kn([],{}),0,s))}),i}function Wv(e){const i={};return Object.entries(e).forEach(([t,s])=>i[t]=`${s}`),i}function GC(e,i,t){return e==t.path&&Xr(i,t.parameters)}const Qn="imperative";var Qt=function(e){return e[e.NavigationStart=0]="NavigationStart",e[e.NavigationEnd=1]="NavigationEnd",e[e.NavigationCancel=2]="NavigationCancel",e[e.NavigationError=3]="NavigationError",e[e.RoutesRecognized=4]="RoutesRecognized",e[e.ResolveStart=5]="ResolveStart",e[e.ResolveEnd=6]="ResolveEnd",e[e.GuardsCheckStart=7]="GuardsCheckStart",e[e.GuardsCheckEnd=8]="GuardsCheckEnd",e[e.RouteConfigLoadStart=9]="RouteConfigLoadStart",e[e.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",e[e.ChildActivationStart=11]="ChildActivationStart",e[e.ChildActivationEnd=12]="ChildActivationEnd",e[e.ActivationStart=13]="ActivationStart",e[e.ActivationEnd=14]="ActivationEnd",e[e.Scroll=15]="Scroll",e[e.NavigationSkipped=16]="NavigationSkipped",e}(Qt||{});class Mc{constructor(i,t){this.id=i,this.url=t}}class Vl extends Mc{constructor(i,t,s="imperative",c=null){super(i,t),this.type=Qt.NavigationStart,this.navigationTrigger=s,this.restoredState=c}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Qd extends Mc{constructor(i,t,s){super(i,t),this.urlAfterRedirects=s,this.type=Qt.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var fs=function(e){return e[e.Redirect=0]="Redirect",e[e.SupersededByNewNavigation=1]="SupersededByNewNavigation",e[e.NoDataFromResolver=2]="NoDataFromResolver",e[e.GuardRejected=3]="GuardRejected",e}(fs||{}),WC=function(e){return e[e.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",e[e.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",e}(WC||{});class eu extends Mc{constructor(i,t,s,c){super(i,t),this.reason=s,this.code=c,this.type=Qt.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class qh extends Mc{constructor(i,t,s,c){super(i,t),this.reason=s,this.code=c,this.type=Qt.NavigationSkipped}}class zv extends Mc{constructor(i,t,s,c){super(i,t),this.error=s,this.target=c,this.type=Qt.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class dO extends Mc{constructor(i,t,s,c){super(i,t),this.urlAfterRedirects=s,this.state=c,this.type=Qt.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class v6 extends Mc{constructor(i,t,s,c){super(i,t),this.urlAfterRedirects=s,this.state=c,this.type=Qt.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class zF extends Mc{constructor(i,t,s,c,u){super(i,t),this.urlAfterRedirects=s,this.state=c,this.shouldActivate=u,this.type=Qt.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class E6 extends Mc{constructor(i,t,s,c){super(i,t),this.urlAfterRedirects=s,this.state=c,this.type=Qt.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Bl extends Mc{constructor(i,t,s,c){super(i,t),this.urlAfterRedirects=s,this.state=c,this.type=Qt.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class y6{constructor(i){this.route=i,this.type=Qt.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class KF{constructor(i){this.route=i,this.type=Qt.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class b6{constructor(i){this.snapshot=i,this.type=Qt.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class S6{constructor(i){this.snapshot=i,this.type=Qt.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Kv{constructor(i){this.snapshot=i,this.type=Qt.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class uO{constructor(i){this.snapshot=i,this.type=Qt.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class hO{}class qv{constructor(i,t){this.url=i,this.navigationBehaviorOptions=t}}function kc(e){return e.outlet||yt}function $v(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let i=e.parent;i;i=i.parent){const t=i.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class T6{get injector(){return $v(this.route?.snapshot)??this.rootInjector}set injector(i){}constructor(i){this.rootInjector=i,this.outlet=null,this.route=null,this.children=new om(this.rootInjector),this.attachRef=null}}let om=(()=>{class e{constructor(t){this.rootInjector=t,this.contexts=new Map}onChildOutletCreated(t,s){const c=this.getOrCreateContext(t);c.outlet=s,this.contexts.set(t,c)}onChildOutletDestroyed(t){const s=this.getContext(t);s&&(s.outlet=null,s.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let s=this.getContext(t);return s||(s=new T6(this.rootInjector),this.contexts.set(t,s)),s}getContext(t){return this.contexts.get(t)||null}static{this.\u0275fac=function(s){return new(s||e)(ye($o))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();class $F{constructor(i){this._root=i}get root(){return this._root.value}parent(i){const t=this.pathFromRoot(i);return t.length>1?t[t.length-2]:null}children(i){const t=pO(i,this._root);return t?t.children.map(s=>s.value):[]}firstChild(i){const t=pO(i,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(i){const t=fO(i,this._root);return t.length<2?[]:t[t.length-2].children.map(c=>c.value).filter(c=>c!==i)}pathFromRoot(i){return fO(i,this._root).map(t=>t.value)}}function pO(e,i){if(e===i.value)return i;for(const t of i.children){const s=pO(e,t);if(s)return s}return null}function fO(e,i){if(e===i.value)return[i];for(const t of i.children){const s=fO(e,t);if(s.length)return s.unshift(i),s}return[]}class qa{constructor(i,t){this.value=i,this.children=t}toString(){return`TreeNode(${this.value})`}}function sm(e){const i={};return e&&e.children.forEach(t=>i[t.value.outlet]=t),i}class mO extends $F{constructor(i,t){super(i),this.snapshot=t,gO(this,i)}toString(){return this.snapshot.toString()}}function am(e){const i=function I6(e){const u=new zC([],{},{},"",{},yt,e,null,{});return new XF("",new qa(u,[]))}(e),t=new bo([new im("",{})]),s=new bo({}),c=new bo({}),u=new bo({}),f=new bo(""),_=new tu(t,s,u,f,c,yt,e,i.root);return _.snapshot=i.root,new mO(new qa(_,[]),i)}class tu{constructor(i,t,s,c,u,f,_,E){this.urlSubject=i,this.paramsSubject=t,this.queryParamsSubject=s,this.fragmentSubject=c,this.dataSubject=u,this.outlet=f,this.component=_,this._futureSnapshot=E,this.title=this.dataSubject?.pipe(Jt(S=>S[Fl]))??vt(void 0),this.url=i,this.params=t,this.queryParams=s,this.fragment=c,this.data=u}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Jt(i=>Hh(i))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Jt(i=>Hh(i))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Ir(e,i,t="emptyOnly"){let s;const{routeConfig:c}=e;return s=null===i||"always"!==t&&""!==c?.path&&(i.component||i.routeConfig?.loadComponent)?{params:{...e.params},data:{...e.data},resolve:{...e.data,...e._resolvedData??{}}}:{params:{...i.params,...e.params},data:{...i.data,...e.data},resolve:{...e.data,...i.data,...c?.data,...e._resolvedData}},c&&JF(c)&&(s.resolve[Fl]=c.title),s}class zC{get title(){return this.data?.[Fl]}constructor(i,t,s,c,u,f,_,E,S){this.url=i,this.params=t,this.queryParams=s,this.fragment=c,this.data=u,this.outlet=f,this.component=_,this.routeConfig=E,this._resolve=S}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Hh(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Hh(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(s=>s.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class XF extends $F{constructor(i,t){super(t),this.url=i,gO(this,t)}toString(){return ZF(this._root)}}function gO(e,i){i.value._routerState=e,i.children.forEach(t=>gO(e,t))}function ZF(e){const i=e.children.length>0?` { ${e.children.map(ZF).join(", ")} } `:"";return`${e.value}${i}`}function _O(e){if(e.snapshot){const i=e.snapshot,t=e._futureSnapshot;e.snapshot=t,Xr(i.queryParams,t.queryParams)||e.queryParamsSubject.next(t.queryParams),i.fragment!==t.fragment&&e.fragmentSubject.next(t.fragment),Xr(i.params,t.params)||e.paramsSubject.next(t.params),function l6(e,i){if(e.length!==i.length)return!1;for(let t=0;t<e.length;++t)if(!Xr(e[t],i[t]))return!1;return!0}(i.url,t.url)||e.urlSubject.next(t.url),Xr(i.data,t.data)||e.dataSubject.next(t.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function vO(e,i){const t=Xr(e.params,i.params)&&function LF(e,i){return Wh(e,i)&&e.every((t,s)=>Xr(t.parameters,i[s].parameters))}(e.url,i.url);return t&&!(!e.parent!=!i.parent)&&(!e.parent||vO(e.parent,i.parent))}function JF(e){return"string"==typeof e.title||null===e.title}let KC=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=yt,this.activateEvents=new Dn,this.deactivateEvents=new Dn,this.attachEvents=new Dn,this.detachEvents=new Dn,this.parentContexts=me(om),this.location=me(js),this.changeDetector=me(Js),this.inputBinder=me(cm,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){const{firstChange:s,previousValue:c}=t.name;if(s)return;this.isTrackedInParentContexts(c)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(c)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new se(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new se(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new se(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,s){this.activated=t,this._activatedRoute=s,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,s){if(this.isActivated)throw new se(4013,!1);this._activatedRoute=t;const c=this.location,f=t.snapshot.component,_=this.parentContexts.getOrCreateContext(this.name).children,E=new EO(t,_,c.injector);this.activated=c.createComponent(f,{index:c.length,injector:E,environmentInjector:s}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275dir=Ue({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Xo]})}}return e})();class EO{__ngOutletInjector(i){return new EO(this.route,this.childContexts,i)}constructor(i,t,s){this.route=i,this.childContexts=t,this.parent=s}get(i,t){return i===tu?this.route:i===om?this.childContexts:this.parent.get(i,t)}}const cm=new Te("");function dm(e,i,t){if(t&&e.shouldReuseRoute(i.value,t.value.snapshot)){const s=t.value;s._futureSnapshot=i.value;const c=function QF(e,i,t){return i.children.map(s=>{for(const c of t.children)if(e.shouldReuseRoute(s.value,c.value.snapshot))return dm(e,s,c);return dm(e,s)})}(e,i,t);return new qa(s,c)}{if(e.shouldAttach(i.value)){const u=e.retrieve(i.value);if(null!==u){const f=u.route;return f.value._futureSnapshot=i.value,f.children=i.children.map(_=>dm(e,_)),f}}const s=function w6(e){return new tu(new bo(e.url),new bo(e.params),new bo(e.queryParams),new bo(e.fragment),new bo(e.data),e.outlet,e.component,e)}(i.value),c=i.children.map(u=>dm(e,u));return new qa(s,c)}}class Xv{constructor(i,t){this.redirectTo=i,this.navigationBehaviorOptions=t}}const yO="ngNavigationCancelingError";function jl(e,i){const{redirectTo:t,navigationBehaviorOptions:s}=zh(i)?{redirectTo:i,navigationBehaviorOptions:void 0}:i,c=qC(!1,fs.Redirect);return c.url=t,c.navigationBehaviorOptions=s,c}function qC(e,i){const t=new Error(`NavigationCancelingError: ${e||""}`);return t[yO]=!0,t.cancellationCode=i,t}function Ya(e){return!!e&&e[yO]}class nU{constructor(i,t,s,c,u){this.routeReuseStrategy=i,this.futureState=t,this.currState=s,this.forwardEvent=c,this.inputBindingEnabled=u}activate(i){const t=this.futureState._root,s=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,s,i),_O(this.futureState.root),this.activateChildRoutes(t,s,i)}deactivateChildRoutes(i,t,s){const c=sm(t);i.children.forEach(u=>{const f=u.value.outlet;this.deactivateRoutes(u,c[f],s),delete c[f]}),Object.values(c).forEach(u=>{this.deactivateRouteAndItsChildren(u,s)})}deactivateRoutes(i,t,s){const c=i.value,u=t?t.value:null;if(c===u)if(c.component){const f=s.getContext(c.outlet);f&&this.deactivateChildRoutes(i,t,f.children)}else this.deactivateChildRoutes(i,t,s);else u&&this.deactivateRouteAndItsChildren(t,s)}deactivateRouteAndItsChildren(i,t){i.value.component&&this.routeReuseStrategy.shouldDetach(i.value.snapshot)?this.detachAndStoreRouteSubtree(i,t):this.deactivateRouteAndOutlet(i,t)}detachAndStoreRouteSubtree(i,t){const s=t.getContext(i.value.outlet),c=s&&i.value.component?s.children:t,u=sm(i);for(const f of Object.values(u))this.deactivateRouteAndItsChildren(f,c);if(s&&s.outlet){const f=s.outlet.detach(),_=s.children.onOutletDeactivated();this.routeReuseStrategy.store(i.value.snapshot,{componentRef:f,route:i,contexts:_})}}deactivateRouteAndOutlet(i,t){const s=t.getContext(i.value.outlet),c=s&&i.value.component?s.children:t,u=sm(i);for(const f of Object.values(u))this.deactivateRouteAndItsChildren(f,c);s&&(s.outlet&&(s.outlet.deactivate(),s.children.onOutletDeactivated()),s.attachRef=null,s.route=null)}activateChildRoutes(i,t,s){const c=sm(t);i.children.forEach(u=>{this.activateRoutes(u,c[u.value.outlet],s),this.forwardEvent(new uO(u.value.snapshot))}),i.children.length&&this.forwardEvent(new S6(i.value.snapshot))}activateRoutes(i,t,s){const c=i.value,u=t?t.value:null;if(_O(c),c===u)if(c.component){const f=s.getOrCreateContext(c.outlet);this.activateChildRoutes(i,t,f.children)}else this.activateChildRoutes(i,t,s);else if(c.component){const f=s.getOrCreateContext(c.outlet);if(this.routeReuseStrategy.shouldAttach(c.snapshot)){const _=this.routeReuseStrategy.retrieve(c.snapshot);this.routeReuseStrategy.store(c.snapshot,null),f.children.onOutletReAttached(_.contexts),f.attachRef=_.componentRef,f.route=_.route.value,f.outlet&&f.outlet.attach(_.componentRef,_.route.value),_O(_.route.value),this.activateChildRoutes(i,null,f.children)}else f.attachRef=null,f.route=c,f.outlet&&f.outlet.activateWith(c,f.injector),this.activateChildRoutes(i,null,f.children)}else this.activateChildRoutes(i,null,s)}}class YC{constructor(i){this.path=i,this.route=this.path[this.path.length-1]}}class um{constructor(i,t){this.component=i,this.route=t}}function Lc(e,i,t){const s=e._root;return hm(s,i?i._root:null,t,[s.value])}function ks(e,i){const t=Symbol(),s=i.get(e,t);return s===t?"function"!=typeof e||function uN(e){return null!==RE(e)}(e)?i.get(e):e:s}function hm(e,i,t,s,c={canDeactivateChecks:[],canActivateChecks:[]}){const u=sm(i);return e.children.forEach(f=>{(function R6(e,i,t,s,c={canDeactivateChecks:[],canActivateChecks:[]}){const u=e.value,f=i?i.value:null,_=t?t.getContext(e.value.outlet):null;if(f&&u.routeConfig===f.routeConfig){const E=function iU(e,i,t){if("function"==typeof t)return t(e,i);switch(t){case"pathParamsChange":return!Wh(e.url,i.url);case"pathParamsOrQueryParamsChange":return!Wh(e.url,i.url)||!Xr(e.queryParams,i.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!vO(e,i)||!Xr(e.queryParams,i.queryParams);default:return!vO(e,i)}}(f,u,u.routeConfig.runGuardsAndResolvers);E?c.canActivateChecks.push(new YC(s)):(u.data=f.data,u._resolvedData=f._resolvedData),hm(e,i,u.component?_?_.children:null:t,s,c),E&&_&&_.outlet&&_.outlet.isActivated&&c.canDeactivateChecks.push(new um(_.outlet.component,f))}else f&&Zv(i,_,c),c.canActivateChecks.push(new YC(s)),hm(e,null,u.component?_?_.children:null:t,s,c)})(f,u[f.value.outlet],t,s.concat([f.value]),c),delete u[f.value.outlet]}),Object.entries(u).forEach(([f,_])=>Zv(_,t.getContext(f),c)),c}function Zv(e,i,t){const s=sm(e),c=e.value;Object.entries(s).forEach(([u,f])=>{Zv(f,c.component?i?i.children.getContext(u):null:i,t)}),t.canDeactivateChecks.push(new um(c.component&&i&&i.outlet&&i.outlet.isActivated?i.outlet.component:null,c))}function Jv(e){return"function"==typeof e}function l(e){return e instanceof Lv||"EmptyError"===e?.name}const d=Symbol("INITIAL_VALUE");function h(){return Nc(e=>xl(e.map(i=>i.pipe(nr(1),PF(d)))).pipe(Jt(i=>{for(const t of i)if(!0!==t){if(t===d)return d;if(!1===t||p(t))return t}return!0}),Ns(i=>i!==d),nr(1)))}function p(e){return zh(e)||e instanceof Xv}function D(e){return function JU(...e){return iN(e)}(ir(i=>{if("boolean"!=typeof i)throw jl(0,i)}),Jt(i=>!0===i))}class x{constructor(i){this.segmentGroup=i||null}}class j extends Error{constructor(i){super(),this.urlTree=i}}function W(e){return OC(new x(e))}class X{constructor(i,t){this.urlSerializer=i,this.urlTree=t}lineralizeSegments(i,t){let s=[],c=t.root;for(;;){if(s=s.concat(c.segments),0===c.numberOfChildren)return vt(s);if(c.numberOfChildren>1||!c.children[yt])return OC(new se(4e3,!1));c=c.children[yt]}}applyRedirectCommands(i,t,s,c,u){if("string"!=typeof t){const _=t,{queryParams:E,fragment:S,routeConfig:I,url:P,outlet:U,params:B,data:G,title:K}=c,te=Kc(u,()=>_({params:B,data:G,queryParams:E,fragment:S,routeConfig:I,url:P,outlet:U,title:K}));if(te instanceof za)throw new j(te);t=te}const f=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),i,s);if("/"===t[0])throw new j(f);return f}applyRedirectCreateUrlTree(i,t,s,c){const u=this.createSegmentGroup(i,t.root,s,c);return new za(u,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(i,t){const s={};return Object.entries(i).forEach(([c,u])=>{if("string"==typeof u&&":"===u[0]){const _=u.substring(1);s[c]=t[_]}else s[c]=u}),s}createSegmentGroup(i,t,s,c){const u=this.createSegments(i,t.segments,s,c);let f={};return Object.entries(t.children).forEach(([_,E])=>{f[_]=this.createSegmentGroup(i,E,s,c)}),new Kn(u,f)}createSegments(i,t,s,c){return t.map(u=>":"===u.path[0]?this.findPosParam(i,u,c):this.findOrReturn(u,s))}findPosParam(i,t,s){const c=s[t.path.substring(1)];if(!c)throw new se(4001,!1);return c}findOrReturn(i,t){let s=0;for(const c of t){if(c.path===i.path)return t.splice(s),c;s++}return i}}const Ce={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Re(e,i,t,s,c){const u=ut(e,i,t);return u.matched?(s=function Yv(e,i){return e.providers&&!e._injector&&(e._injector=Vw(e.providers,i,`Route: ${e.path}`)),e._injector??i}(i,s),function M(e,i,t,s){const c=i.canMatch;return c&&0!==c.length?vt(c.map(f=>{const _=ks(f,e);return aa(function a(e){return e&&Jv(e.canMatch)}(_)?_.canMatch(i,t):Kc(e,()=>_(i,t)))})).pipe(h(),D()):vt(!0)}(s,i,t).pipe(Jt(f=>!0===f?u:{...Ce}))):vt(u)}function ut(e,i,t){if("**"===i.path)return function Nt(e){return{matched:!0,parameters:e.length>0?In(e).parameters:{},consumedSegments:e,remainingSegments:[],positionalParamSegments:{}}}(t);if(""===i.path)return"full"===i.pathMatch&&(e.hasChildren()||t.length>0)?{...Ce}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const c=(i.matcher||Jd)(t,e,i);if(!c)return{...Ce};const u={};Object.entries(c.posParams??{}).forEach(([_,E])=>{u[_]=E.path});const f=c.consumed.length>0?{...u,...c.consumed[c.consumed.length-1].parameters}:u;return{matched:!0,consumedSegments:c.consumed,remainingSegments:t.slice(c.consumed.length),parameters:f,positionalParamSegments:c.posParams??{}}}function _n(e,i,t,s){return t.length>0&&function Z(e,i,t){return t.some(s=>ve(e,i,s)&&kc(s)!==yt)}(e,t,s)?{segmentGroup:new Kn(i,ca(s,new Kn(t,e.children))),slicedSegments:[]}:0===t.length&&function oe(e,i,t){return t.some(s=>ve(e,i,s))}(e,t,s)?{segmentGroup:new Kn(e.segments,Zt(e,t,s,e.children)),slicedSegments:t}:{segmentGroup:new Kn(e.segments,e.children),slicedSegments:t}}function Zt(e,i,t,s){const c={};for(const u of t)if(ve(e,i,u)&&!s[kc(u)]){const f=new Kn([],{});c[kc(u)]=f}return{...s,...c}}function ca(e,i){const t={};t[yt]=i;for(const s of e)if(""===s.path&&kc(s)!==yt){const c=new Kn([],{});t[kc(s)]=c}return t}function ve(e,i,t){return(!(e.hasChildren()||i.length>0)||"full"!==t.pathMatch)&&""===t.path}class Et{}class F{constructor(i,t,s,c,u,f,_){this.injector=i,this.configLoader=t,this.rootComponentType=s,this.config=c,this.urlTree=u,this.paramsInheritanceStrategy=f,this.urlSerializer=_,this.applyRedirects=new X(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(i){return new se(4002,`'${i.segmentGroup}'`)}recognize(){const i=_n(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(i).pipe(Jt(({children:t,rootSnapshot:s})=>{const c=new qa(s,t),u=new XF("",c),f=function Bv(e,i,t=null,s=null){return jF(aO(e),i,t,s)}(s,[],this.urlTree.queryParams,this.urlTree.fragment);return f.queryParams=this.urlTree.queryParams,u.url=this.urlSerializer.serialize(f),{state:u,tree:f}}))}match(i){const t=new zC([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Object.freeze({}),yt,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,i,yt,t).pipe(Jt(s=>({children:s,rootSnapshot:t})),Xd(s=>{if(s instanceof j)return this.urlTree=s.urlTree,this.match(s.urlTree.root);throw s instanceof x?this.noMatchError(s):s}))}processSegmentGroup(i,t,s,c,u){return 0===s.segments.length&&s.hasChildren()?this.processChildren(i,t,s,u):this.processSegment(i,t,s,s.segments,c,!0,u).pipe(Jt(f=>f instanceof qa?[f]:[]))}processChildren(i,t,s,c){const u=[];for(const f of Object.keys(s.children))"primary"===f?u.unshift(f):u.push(f);return Lr(u).pipe(PC(f=>{const _=s.children[f],E=function oz(e,i){const t=e.filter(s=>kc(s)===i);return t.push(...e.filter(s=>kc(s)!==i)),t}(t,f);return this.processSegmentGroup(i,E,_,f,c)}),function a6(e,i){return yi(function s6(e,i,t,s,c){return(u,f)=>{let _=t,E=i,S=0;u.subscribe(ui(f,I=>{const P=S++;E=_?e(E,I,P):(_=!0,I),s&&f.next(E)},c&&(()=>{_&&f.next(E),f.complete()})))}}(e,i,arguments.length>=2,!0))}((f,_)=>(f.push(..._),f)),Vh(null),function c6(e,i){const t=arguments.length>=2;return s=>s.pipe(e?Ns((c,u)=>e(c,u,s)):Xl,tO(1),t?Vh(i):MF(()=>new Lv))}(),Yr(f=>{if(null===f)return W(s);const _=Le(f);return function H(e){e.sort((i,t)=>i.value.outlet===yt?-1:t.value.outlet===yt?1:i.value.outlet.localeCompare(t.value.outlet))}(_),vt(_)}))}processSegment(i,t,s,c,u,f,_){return Lr(t).pipe(PC(E=>this.processSegmentAgainstRoute(E._injector??i,t,E,s,c,u,f,_).pipe(Xd(S=>{if(S instanceof x)return vt(null);throw S}))),Bh(E=>!!E),Xd(E=>{if(l(E))return function xe(e,i,t){return 0===i.length&&!e.children[t]}(s,c,u)?vt(new Et):W(s);throw E}))}processSegmentAgainstRoute(i,t,s,c,u,f,_,E){return kc(s)===f||f!==yt&&ve(c,u,s)?void 0===s.redirectTo?this.matchSegmentAgainstRoute(i,c,s,u,f,E):this.allowRedirects&&_?this.expandSegmentAgainstRouteUsingRedirect(i,c,t,s,u,f,E):W(c):W(c)}expandSegmentAgainstRouteUsingRedirect(i,t,s,c,u,f,_){const{matched:E,parameters:S,consumedSegments:I,positionalParamSegments:P,remainingSegments:U}=ut(t,c,u);if(!E)return W(t);"string"==typeof c.redirectTo&&"/"===c.redirectTo[0]&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const B=new zC(u,S,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,li(c),kc(c),c.component??c._loadedComponent??null,c,Jr(c)),G=Ir(B,_,this.paramsInheritanceStrategy);B.params=Object.freeze(G.params),B.data=Object.freeze(G.data);const K=this.applyRedirects.applyRedirectCommands(I,c.redirectTo,P,B,i);return this.applyRedirects.lineralizeSegments(c,K).pipe(Yr(te=>this.processSegment(i,s,t,te.concat(U),f,!1,_)))}matchSegmentAgainstRoute(i,t,s,c,u,f){const _=Re(t,s,c,i);return"**"===s.path&&(t.children={}),_.pipe(Nc(E=>E.matched?this.getChildConfig(i=s._injector??i,s,c).pipe(Nc(({routes:S})=>{const I=s._loadedInjector??i,{parameters:P,consumedSegments:U,remainingSegments:B}=E,G=new zC(U,P,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,li(s),kc(s),s.component??s._loadedComponent??null,s,Jr(s)),K=Ir(G,f,this.paramsInheritanceStrategy);G.params=Object.freeze(K.params),G.data=Object.freeze(K.data);const{segmentGroup:te,slicedSegments:ae}=_n(t,U,B,S);if(0===ae.length&&te.hasChildren())return this.processChildren(I,S,te,G).pipe(Jt(ke=>new qa(G,ke)));if(0===S.length&&0===ae.length)return vt(new qa(G,[]));const ne=kc(s)===u;return this.processSegment(I,S,te,ae,ne?yt:u,!0,G).pipe(Jt(ke=>new qa(G,ke instanceof qa?[ke]:[])))})):W(t)))}getChildConfig(i,t,s){return t.children?vt({routes:t.children,injector:i}):t.loadChildren?void 0!==t._loadedRoutes?vt({routes:t._loadedRoutes,injector:t._loadedInjector}):function A(e,i,t,s){const c=i.canLoad;return void 0===c||0===c.length?vt(!0):vt(c.map(f=>{const _=ks(f,e);return aa(function ei(e){return e&&Jv(e.canLoad)}(_)?_.canLoad(i,t):Kc(e,()=>_(i,t)))})).pipe(h(),D())}(i,t,s).pipe(Yr(c=>c?this.configLoader.loadChildren(i,t).pipe(ir(u=>{t._loadedRoutes=u.routes,t._loadedInjector=u.injector})):function J(){return OC(qC(!1,fs.GuardRejected))}())):vt({routes:[],injector:i})}}function ie(e){const i=e.value.routeConfig;return i&&""===i.path}function Le(e){const i=[],t=new Set;for(const s of e){if(!ie(s)){i.push(s);continue}const c=i.find(u=>s.value.routeConfig===u.value.routeConfig);void 0!==c?(c.children.push(...s.children),t.add(c)):i.push(s)}for(const s of t){const c=Le(s.children);i.push(new qa(s.value,c))}return i.filter(s=>!t.has(s))}function li(e){return e.data||{}}function Jr(e){return e.resolve||{}}function Qv(e){const i=e.children.map(t=>Qv(t)).flat();return[e,...i]}function wn(e){return Nc(i=>{const t=e(i);return t?Lr(t).pipe(Jt(()=>i)):vt(i)})}let qn=(()=>{class e{buildTitle(t){let s,c=t.root;for(;void 0!==c;)s=this.getResolvedTitleForRoute(c)??s,c=c.children.find(u=>u.outlet===yt);return s}getResolvedTitleForRoute(t){return t.data[Fl]}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:()=>me(en),providedIn:"root"})}}return e})(),en=(()=>{class e extends qn{constructor(t){super(),this.title=t}updateTitle(t){const s=this.buildTitle(t);void 0!==s&&this.title.setTitle(s)}static{this.\u0275fac=function(s){return new(s||e)(ye(DH))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const wr=new Te("",{providedIn:"root",factory:()=>({})});let $a=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=no({type:e,selectors:[["ng-component"]],standalone:!0,features:[fo],decls:1,vars:0,template:function(s,c){1&s&&At(0,"router-outlet")},dependencies:[KC],encapsulation:2})}}return e})();function Rn(e){const i=e.children&&e.children.map(Rn),t=i?{...e,children:i}:{...e};return!t.component&&!t.loadComponent&&(i||t.loadChildren)&&t.outlet&&t.outlet!==yt&&(t.component=$a),t}const lt=new Te("");let Qr=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=me(YL)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return vt(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const s=aa(t.loadComponent()).pipe(Jt(bO),ir(u=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=u}),sa(()=>{this.componentLoaders.delete(t)})),c=new Ga(s,()=>new Mt).pipe(NC());return this.componentLoaders.set(t,c),c}loadChildren(t,s){if(this.childrenLoaders.get(s))return this.childrenLoaders.get(s);if(s._loadedRoutes)return vt({routes:s._loadedRoutes,injector:s._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(s);const u=function iu(e,i,t,s){return aa(e.loadChildren()).pipe(Jt(bO),Yr(c=>c instanceof s1||Array.isArray(c)?vt(c):Lr(i.compileModuleAsync(c))),Jt(c=>{s&&s(e);let u,f,_=!1;return Array.isArray(c)?(f=c,!0):(u=c.create(t).injector,f=u.get(lt,[],{optional:!0,self:!0}).flat()),{routes:f.map(Rn),injector:u}}))}(s,this.compiler,t,this.onLoadEndListener).pipe(sa(()=>{this.childrenLoaders.delete(s)})),f=new Ga(u,()=>new Mt).pipe(NC());return this.childrenLoaders.set(s,f),f}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function bO(e){return function Xa(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let A6=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:()=>me(LK),providedIn:"root"})}}return e})(),LK=(()=>{class e{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,s){return t}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const az=new Te(""),lz=new Te("");let oU=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Mt,this.transitionAbortSubject=new Mt,this.configLoader=me(Qr),this.environmentInjector=me($o),this.urlSerializer=me(Pc),this.rootContexts=me(om),this.location=me(Ih),this.inputBindingEnabled=null!==me(cm,{optional:!0}),this.titleStrategy=me(qn),this.options=me(wr,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=me(A6),this.createViewTransition=me(az,{optional:!0}),this.navigationErrorHandler=me(lz,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>vt(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=c=>this.events.next(new KF(c)),this.configLoader.onLoadStartListener=c=>this.events.next(new y6(c))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const s=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:s})}setupNavigations(t,s,c){return this.transitions=new bo({id:0,currentUrlTree:s,currentRawUrl:s,extractedUrl:this.urlHandlingStrategy.extract(s),urlAfterRedirects:this.urlHandlingStrategy.extract(s),rawUrl:s,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:Qn,restoredState:null,currentSnapshot:c.snapshot,targetSnapshot:null,currentRouterState:c,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Ns(u=>0!==u.id),Jt(u=>({...u,extractedUrl:this.urlHandlingStrategy.extract(u.rawUrl)})),Nc(u=>{let f=!1,_=!1;return vt(u).pipe(Nc(E=>{if(this.navigationId>u.id)return this.cancelNavigationTransition(u,"",fs.SupersededByNewNavigation),Fi;this.currentTransition=u,this.currentNavigation={id:E.id,initialUrl:E.rawUrl,extractedUrl:E.extractedUrl,targetBrowserUrl:"string"==typeof E.extras.browserUrl?this.urlSerializer.parse(E.extras.browserUrl):E.extras.browserUrl,trigger:E.source,extras:E.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null};const S=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!S&&"reload"!==(E.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const P="";return this.events.next(new qh(E.id,this.urlSerializer.serialize(E.rawUrl),P,WC.IgnoredSameUrlNavigation)),E.resolve(!1),Fi}if(this.urlHandlingStrategy.shouldProcessUrl(E.rawUrl))return vt(E).pipe(Nc(P=>{const U=this.transitions?.getValue();return this.events.next(new Vl(P.id,this.urlSerializer.serialize(P.extractedUrl),P.source,P.restoredState)),U!==this.transitions?.getValue()?Fi:Promise.resolve(P)}),function Hl(e,i,t,s,c,u){return Yr(f=>function de(e,i,t,s,c,u,f="emptyOnly"){return new F(e,i,t,s,c,f,u).recognize()}(e,i,t,s,f.extractedUrl,c,u).pipe(Jt(({state:_,tree:E})=>({...f,targetSnapshot:_,urlAfterRedirects:E}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),ir(P=>{u.targetSnapshot=P.targetSnapshot,u.urlAfterRedirects=P.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:P.urlAfterRedirects};const U=new dO(P.id,this.urlSerializer.serialize(P.extractedUrl),this.urlSerializer.serialize(P.urlAfterRedirects),P.targetSnapshot);this.events.next(U)}));if(S&&this.urlHandlingStrategy.shouldProcessUrl(E.currentRawUrl)){const{id:P,extractedUrl:U,source:B,restoredState:G,extras:K}=E,te=new Vl(P,this.urlSerializer.serialize(U),B,G);this.events.next(te);const ae=am(this.rootComponentType).snapshot;return this.currentTransition=u={...E,targetSnapshot:ae,urlAfterRedirects:U,extras:{...K,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=U,vt(u)}{const P="";return this.events.next(new qh(E.id,this.urlSerializer.serialize(E.extractedUrl),P,WC.IgnoredByUrlHandlingStrategy)),E.resolve(!1),Fi}}),ir(E=>{const S=new v6(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(S)}),Jt(E=>(this.currentTransition=u={...E,guards:Lc(E.targetSnapshot,E.currentSnapshot,this.rootContexts)},u)),function m(e,i){return Yr(t=>{const{targetSnapshot:s,currentSnapshot:c,guards:{canActivateChecks:u,canDeactivateChecks:f}}=t;return 0===f.length&&0===u.length?vt({...t,guardsResult:!0}):function g(e,i,t,s){return Lr(e).pipe(Yr(c=>function R(e,i,t,s,c){const u=i&&i.routeConfig?i.routeConfig.canDeactivate:null;return u&&0!==u.length?vt(u.map(_=>{const E=$v(i)??c,S=ks(_,E);return aa(function o(e){return e&&Jv(e.canDeactivate)}(S)?S.canDeactivate(e,i,t,s):Kc(E,()=>S(e,i,t,s))).pipe(Bh())})).pipe(h()):vt(!0)}(c.component,c.route,t,i,s)),Bh(c=>!0!==c,!0))}(f,s,c,e).pipe(Yr(_=>_&&function rU(e){return"boolean"==typeof e}(_)?function v(e,i,t,s){return Lr(i).pipe(PC(c=>oa(function b(e,i){return null!==e&&i&&i(new b6(e)),vt(!0)}(c.route.parent,s),function y(e,i){return null!==e&&i&&i(new Kv(e)),vt(!0)}(c.route,s),function N(e,i,t){const s=i[i.length-1],u=i.slice(0,i.length-1).reverse().map(f=>function Ot(e){const i=e.routeConfig?e.routeConfig.canActivateChild:null;return i&&0!==i.length?{node:e,guards:i}:null}(f)).filter(f=>null!==f).map(f=>NF(()=>vt(f.guards.map(E=>{const S=$v(f.node)??t,I=ks(E,S);return aa(function r(e){return e&&Jv(e.canActivateChild)}(I)?I.canActivateChild(s,e):Kc(S,()=>I(s,e))).pipe(Bh())})).pipe(h())));return vt(u).pipe(h())}(e,c.path,t),function C(e,i,t){const s=i.routeConfig?i.routeConfig.canActivate:null;if(!s||0===s.length)return vt(!0);const c=s.map(u=>NF(()=>{const f=$v(i)??t,_=ks(u,f);return aa(function n(e){return e&&Jv(e.canActivate)}(_)?_.canActivate(i,e):Kc(f,()=>_(i,e))).pipe(Bh())}));return vt(c).pipe(h())}(e,c.route,t))),Bh(c=>!0!==c,!0))}(s,u,e,i):vt(_)),Jt(_=>({...t,guardsResult:_})))})}(this.environmentInjector,E=>this.events.next(E)),ir(E=>{if(u.guardsResult=E.guardsResult,E.guardsResult&&"boolean"!=typeof E.guardsResult)throw jl(0,E.guardsResult);const S=new zF(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot,!!E.guardsResult);this.events.next(S)}),Ns(E=>!!E.guardsResult||(this.cancelNavigationTransition(E,"",fs.GuardRejected),!1)),wn(E=>{if(E.guards.canActivateChecks.length)return vt(E).pipe(ir(S=>{const I=new E6(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(I)}),Nc(S=>{let I=!1;return vt(S).pipe(function $C(e,i){return Yr(t=>{const{targetSnapshot:s,guards:{canActivateChecks:c}}=t;if(!c.length)return vt(t);const u=new Set(c.map(E=>E.route)),f=new Set;for(const E of u)if(!f.has(E))for(const S of Qv(E))f.add(S);let _=0;return Lr(f).pipe(PC(E=>u.has(E)?function Ls(e,i,t,s){const c=e.routeConfig,u=e._resolve;return void 0!==c?.title&&!JF(c)&&(u[Fl]=c.title),function nu(e,i,t,s){const c=jo(e);if(0===c.length)return vt({});const u={};return Lr(c).pipe(Yr(f=>function pm(e,i,t,s){const c=$v(i)??s,u=ks(e,c);return aa(u.resolve?u.resolve(i,t):Kc(c,()=>u(i,t)))}(e[f],i,t,s).pipe(Bh(),ir(_=>{if(_ instanceof Xv)throw jl(new LC,_);u[f]=_}))),tO(1),Zd(u),Xd(f=>l(f)?Fi:OC(f)))}(u,e,i,s).pipe(Jt(f=>(e._resolvedData=f,e.data=Ir(e,e.parent,t).resolve,null)))}(E,s,e,i):(E.data=Ir(E,E.parent,e).resolve,vt(void 0))),ir(()=>_++),tO(1),Yr(E=>_===f.size?vt(t):Fi))})}(this.paramsInheritanceStrategy,this.environmentInjector),ir({next:()=>I=!0,complete:()=>{I||this.cancelNavigationTransition(S,"",fs.NoDataFromResolver)}}))}),ir(S=>{const I=new Bl(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(I)}))}),wn(E=>{const S=I=>{const P=[];I.routeConfig?.loadComponent&&!I.routeConfig._loadedComponent&&P.push(this.configLoader.loadComponent(I.routeConfig).pipe(ir(U=>{I.component=U}),Jt(()=>{})));for(const U of I.children)P.push(...S(U));return P};return xl(S(E.targetSnapshot.root)).pipe(Vh(null),nr(1))}),wn(()=>this.afterPreactivation()),Nc(()=>{const{currentSnapshot:E,targetSnapshot:S}=u,I=this.createViewTransition?.(this.environmentInjector,E.root,S.root);return I?Lr(I).pipe(Jt(()=>u)):vt(u)}),Jt(E=>{const S=function lm(e,i,t){const s=dm(e,i._root,t?t._root:void 0);return new mO(s,i)}(t.routeReuseStrategy,E.targetSnapshot,E.currentRouterState);return this.currentTransition=u={...E,targetRouterState:S},this.currentNavigation.targetRouterState=S,u}),ir(()=>{this.events.next(new hO)}),((e,i,t,s)=>Jt(c=>(new nU(i,c.targetRouterState,c.currentRouterState,t,s).activate(e),c)))(this.rootContexts,t.routeReuseStrategy,E=>this.events.next(E),this.inputBindingEnabled),nr(1),ir({next:E=>{f=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Qd(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects))),this.titleStrategy?.updateTitle(E.targetRouterState.snapshot),E.resolve(!0)},complete:()=>{f=!0}}),Tr(this.transitionAbortSubject.pipe(ir(E=>{throw E}))),sa(()=>{!f&&!_&&this.cancelNavigationTransition(u,"",fs.SupersededByNewNavigation),this.currentTransition?.id===u.id&&(this.currentNavigation=null,this.currentTransition=null)}),Xd(E=>{if(_=!0,Ya(E))this.events.next(new eu(u.id,this.urlSerializer.serialize(u.extractedUrl),E.message,E.cancellationCode)),function eU(e){return Ya(e)&&zh(e.url)}(E)?this.events.next(new qv(E.url,E.navigationBehaviorOptions)):u.resolve(!1);else{const S=new zv(u.id,this.urlSerializer.serialize(u.extractedUrl),E,u.targetSnapshot??void 0);try{const I=Kc(this.environmentInjector,()=>this.navigationErrorHandler?.(S));if(I instanceof Xv){const{message:P,cancellationCode:U}=jl(0,I);this.events.next(new eu(u.id,this.urlSerializer.serialize(u.extractedUrl),P,U)),this.events.next(new qv(I.redirectTo,I.navigationBehaviorOptions))}else{this.events.next(S);const P=t.errorHandler(E);u.resolve(!!P)}}catch(I){this.options.resolveNavigationPromiseOnError?u.resolve(!1):u.reject(I)}}return Fi}))}))}cancelNavigationTransition(t,s,c){const u=new eu(t.id,this.urlSerializer.serialize(t.extractedUrl),s,c);this.events.next(u),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){const t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),s=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return t.toString()!==s?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function UK(e){return e!==Qn}let VK=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:()=>me(jK),providedIn:"root"})}}return e})();class BK{shouldDetach(i){return!1}store(i,t){}shouldAttach(i){return!1}retrieve(i){return null}shouldReuseRoute(i,t){return i.routeConfig===t.routeConfig}}let jK=(()=>{class e extends BK{static{this.\u0275fac=(()=>{let t;return function(c){return(t||(t=yn(e)))(c||e)}})()}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),dz=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:()=>me(HK),providedIn:"root"})}}return e})(),HK=(()=>{class e extends dz{constructor(){super(...arguments),this.location=me(Ih),this.urlSerializer=me(Pc),this.options=me(wr,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=me(A6),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new za,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=am(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(s=>{"popstate"===s.type&&t(s.url,s.state)})}handleRouterEvent(t,s){if(t instanceof Vl)this.stateMemento=this.createStateMemento();else if(t instanceof qh)this.rawUrlTree=s.initialUrl;else if(t instanceof dO){if("eager"===this.urlUpdateStrategy&&!s.extras.skipLocationChange){const c=this.urlHandlingStrategy.merge(s.finalUrl,s.initialUrl);this.setBrowserUrl(s.targetBrowserUrl??c,s)}}else t instanceof hO?(this.currentUrlTree=s.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(s.finalUrl,s.initialUrl),this.routerState=s.targetRouterState,"deferred"===this.urlUpdateStrategy&&!s.extras.skipLocationChange&&this.setBrowserUrl(s.targetBrowserUrl??this.rawUrlTree,s)):t instanceof eu&&(t.code===fs.GuardRejected||t.code===fs.NoDataFromResolver)?this.restoreHistory(s):t instanceof zv?this.restoreHistory(s,!0):t instanceof Qd&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,s){const c=t instanceof za?this.urlSerializer.serialize(t):t;if(this.location.isCurrentPathEqualTo(c)||s.extras.replaceUrl){const f={...s.extras.state,...this.generateNgRouterState(s.id,this.browserPageId)};this.location.replaceState(c,"",f)}else{const u={...s.extras.state,...this.generateNgRouterState(s.id,this.browserPageId+1)};this.location.go(c,"",u)}}restoreHistory(t,s=!1){if("computed"===this.canceledNavigationResolution){const u=this.currentPageId-this.browserPageId;0!==u?this.location.historyGo(u):this.currentUrlTree===t.finalUrl&&0===u&&(this.resetState(t),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(s&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,s){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:s}:{navigationId:t}}static{this.\u0275fac=(()=>{let t;return function(c){return(t||(t=yn(e)))(c||e)}})()}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var SO=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(SO||{});function GK(e){throw e}const WK={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},zK={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ru=(()=>{class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.console=me(SS),this.stateManager=me(dz),this.options=me(wr,{optional:!0})||{},this.pendingTasks=me(ld),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=me(oU),this.urlSerializer=me(Pc),this.location=me(Ih),this.urlHandlingStrategy=me(A6),this._events=new Mt,this.errorHandler=this.options.errorHandler||GK,this.navigated=!1,this.routeReuseStrategy=me(VK),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=me(lt,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!me(cm,{optional:!0}),this.eventsSubscription=new Ri,this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const t=this.navigationTransitions.events.subscribe(s=>{try{const c=this.navigationTransitions.currentTransition,u=this.navigationTransitions.currentNavigation;if(null!==c&&null!==u)if(this.stateManager.handleRouterEvent(s,u),s instanceof eu&&s.code!==fs.Redirect&&s.code!==fs.SupersededByNewNavigation)this.navigated=!0;else if(s instanceof Qd)this.navigated=!0;else if(s instanceof qv){const f=s.navigationBehaviorOptions,_=this.urlHandlingStrategy.merge(s.url,c.currentRawUrl),E={browserUrl:c.extras.browserUrl,info:c.extras.info,skipLocationChange:c.extras.skipLocationChange,replaceUrl:c.extras.replaceUrl||"eager"===this.urlUpdateStrategy||UK(c.source),...f};this.scheduleNavigation(_,Qn,null,E,{resolve:c.resolve,reject:c.reject,promise:c.promise})}(function qK(e){return!(e instanceof hO||e instanceof qv)})(s)&&this._events.next(s)}catch(c){this.navigationTransitions.transitionAbortSubject.next(c)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Qn,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,s)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(t,"popstate",s)},0)})}navigateToSyncWithBrowser(t,s,c){const u={replaceUrl:!0},f=c?.navigationId?c:null;if(c){const E={...c};delete E.navigationId,delete E.\u0275routerPageId,0!==Object.keys(E).length&&(u.state=E)}const _=this.parseUrl(t);this.scheduleNavigation(_,s,f,u)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(Rn),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,s={}){const{relativeTo:c,queryParams:u,fragment:f,queryParamsHandling:_,preserveFragment:E}=s,S=E?this.currentUrlTree.fragment:f;let P,I=null;switch(_??this.options.defaultQueryParamsHandling){case"merge":I={...this.currentUrlTree.queryParams,...u};break;case"preserve":I=this.currentUrlTree.queryParams;break;default:I=u||null}null!==I&&(I=this.removeEmptyProps(I));try{P=aO(c?c.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||"/"!==t[0][0])&&(t=[]),P=this.currentUrlTree.root}return jF(P,t,I,S??null)}navigateByUrl(t,s={skipLocationChange:!1}){const c=zh(t)?t:this.parseUrl(t),u=this.urlHandlingStrategy.merge(c,this.rawUrlTree);return this.scheduleNavigation(u,Qn,null,s)}navigate(t,s={skipLocationChange:!1}){return function KK(e){for(let i=0;i<e.length;i++)if(null==e[i])throw new se(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,s),s)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,s){let c;if(c=!0===s?{...WK}:!1===s?{...zK}:s,zh(t))return Gh(this.currentUrlTree,t,c);const u=this.parseUrl(t);return Gh(this.currentUrlTree,u,c)}removeEmptyProps(t){return Object.entries(t).reduce((s,[c,u])=>(null!=u&&(s[c]=u),s),{})}scheduleNavigation(t,s,c,u,f){if(this.disposed)return Promise.resolve(!1);let _,E,S;f?(_=f.resolve,E=f.reject,S=f.promise):S=new Promise((P,U)=>{_=P,E=U});const I=this.pendingTasks.add();return function uz(e,i){e.events.pipe(Ns(t=>t instanceof Qd||t instanceof eu||t instanceof zv||t instanceof qh),Jt(t=>t instanceof Qd||t instanceof qh?SO.COMPLETE:t instanceof eu&&(t.code===fs.Redirect||t.code===fs.SupersededByNewNavigation)?SO.REDIRECTING:SO.FAILED),Ns(t=>t!==SO.REDIRECTING),nr(1)).subscribe(()=>{i()})}(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(I))}),this.navigationTransitions.handleNavigationRequest({source:s,restoredState:c,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:u,resolve:_,reject:E,promise:S,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),S.catch(P=>Promise.reject(P))}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const O6=new Te("");function pz(e){return e.routerState.root}function fz(){const e=me(Oi);return i=>{const t=e.get(Sr);if(i!==t.components[0])return;const s=e.get(ru),c=e.get(mz);1===e.get(N6)&&s.initialNavigation(),e.get(gz,null,Yt.Optional)?.setUpPreloading(),e.get(O6,null,Yt.Optional)?.init(),s.resetRootComponentType(t.componentTypes[0]),c.closed||(c.next(),c.complete(),c.unsubscribe())}}const mz=new Te("",{factory:()=>new Mt}),N6=new Te("",{providedIn:"root",factory:()=>1}),gz=new Te("");let iq=(()=>{class e{constructor(){this.appVersion="18.0.0"}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=no({type:e,selectors:[["app-root"]],hostVars:1,hostBindings:function(s,c){2&s&&Ji("app-version",c.appVersion)},standalone:!0,features:[fo],decls:1,vars:0,template:function(s,c){1&s&&At(0,"router-outlet")},dependencies:[KC],changeDetection:0})}}return e})();var Tt=function(e){return e[e.State=0]="State",e[e.Transition=1]="Transition",e[e.Sequence=2]="Sequence",e[e.Group=3]="Group",e[e.Animate=4]="Animate",e[e.Keyframes=5]="Keyframes",e[e.Style=6]="Style",e[e.Trigger=7]="Trigger",e[e.Reference=8]="Reference",e[e.AnimateChild=9]="AnimateChild",e[e.AnimateRef=10]="AnimateRef",e[e.Query=11]="Query",e[e.Stagger=12]="Stagger",e}(Tt||{});const Yh="*";function P6(e,i){return{type:Tt.Trigger,name:e,definitions:i,options:{}}}function CO(e,i=null){return{type:Tt.Animate,styles:i,timings:e}}function su(e){return{type:Tt.Style,styles:e,offset:null}}function M6(e,i,t){return{type:Tt.State,name:e,styles:i,options:t}}function TO(e,i,t=null){return{type:Tt.Transition,expr:e,animation:i,options:t}}class IO{constructor(i=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=i+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}onStart(i){this._originalOnStartFns.push(i),this._onStartFns.push(i)}onDone(i){this._originalOnDoneFns.push(i),this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(i=>i()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(i){this._position=this.totalTime?i*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(i){const t="start"==i?this._onStartFns:this._onDoneFns;t.forEach(s=>s()),t.length=0}}class vz{constructor(i){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=i;let t=0,s=0,c=0;const u=this.players.length;0==u?queueMicrotask(()=>this._onFinish()):this.players.forEach(f=>{f.onDone(()=>{++t==u&&this._onFinish()}),f.onDestroy(()=>{++s==u&&this._onDestroy()}),f.onStart(()=>{++c==u&&this._onStart()})}),this.totalTime=this.players.reduce((f,_)=>Math.max(f,_.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}init(){this.players.forEach(i=>i.init())}onStart(i){this._onStartFns.push(i)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(i=>i()),this._onStartFns=[])}onDone(i){this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(i=>i.play())}pause(){this.players.forEach(i=>i.pause())}restart(){this.players.forEach(i=>i.restart())}finish(){this._onFinish(),this.players.forEach(i=>i.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(i=>i.destroy()),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}reset(){this.players.forEach(i=>i.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(i){const t=i*this.totalTime;this.players.forEach(s=>{const c=s.totalTime?Math.min(1,t/s.totalTime):1;s.setPosition(c)})}getPosition(){const i=this.players.reduce((t,s)=>null===t||s.totalTime>t.totalTime?s:t,null);return null!=i?i.getPosition():0}beforeDestroy(){this.players.forEach(i=>{i.beforeDestroy&&i.beforeDestroy()})}triggerCallback(i){const t="start"==i?this._onStartFns:this._onDoneFns;t.forEach(s=>s()),t.length=0}}function Ez(e){return new se(3e3,!1)}function fm(e){switch(e.length){case 0:return new IO;case 1:return e[0];default:return new vz(e)}}function yz(e,i,t=new Map,s=new Map){const c=[],u=[];let f=-1,_=null;if(i.forEach(E=>{const S=E.get("offset"),I=S==f,P=I&&_||new Map;E.forEach((U,B)=>{let G=B,K=U;if("offset"!==B)switch(G=e.normalizePropertyName(G,c),K){case"!":K=t.get(B);break;case Yh:K=s.get(B);break;default:K=e.normalizeStyleValue(B,G,K,c)}P.set(G,K)}),I||u.push(P),_=P,f=S}),c.length)throw function Nq(){return new se(3502,!1)}();return u}function L6(e,i,t,s){switch(i){case"start":e.onStart(()=>s(t&&x6(t,"start",e)));break;case"done":e.onDone(()=>s(t&&x6(t,"done",e)));break;case"destroy":e.onDestroy(()=>s(t&&x6(t,"destroy",e)))}}function x6(e,i,t){const u=F6(e.element,e.triggerName,e.fromState,e.toState,i||e.phaseName,t.totalTime??e.totalTime,!!t.disabled),f=e._data;return null!=f&&(u._data=f),u}function F6(e,i,t,s,c="",u=0,f){return{element:e,triggerName:i,fromState:t,toState:s,phaseName:c,totalTime:u,disabled:!!f}}function Za(e,i,t){let s=e.get(i);return s||e.set(i,s=t),s}function bz(e){const i=e.indexOf(":");return[e.substring(1,i),e.slice(i+1)]}const Gq=typeof document>"u"?null:document.documentElement;function U6(e){const i=e.parentNode||e.host||null;return i===Gq?null:i}let eE=null,Sz=!1;function Cz(e,i){for(;i;){if(i===e)return!0;i=U6(i)}return!1}function Tz(e,i,t){if(t)return Array.from(e.querySelectorAll(i));const s=e.querySelector(i);return s?[s]:[]}let V6=(()=>{class e{validateStyleProperty(t){return function zq(e){eE||(eE=function Kq(){return typeof document<"u"?document.body:null}()||{},Sz=!!eE.style&&"WebkitAppearance"in eE.style);let i=!0;return eE.style&&!function Wq(e){return"ebkit"==e.substring(1,6)}(e)&&(i=e in eE.style,!i&&Sz&&(i="Webkit"+e.charAt(0).toUpperCase()+e.slice(1)in eE.style)),i}(t)}containsElement(t,s){return Cz(t,s)}getParentElement(t){return U6(t)}query(t,s,c){return Tz(t,s,c)}computeStyle(t,s,c){return c||""}animate(t,s,c,u,f,_=[],E){return new IO(c,u)}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})();class B6{static{this.NOOP=new V6}}class j6{}const Yq=1e3,H6="ng-enter",sU="ng-leave",aU="ng-trigger",cU=".ng-trigger",wz="ng-animating",G6=".ng-animating";function $h(e){if("number"==typeof e)return e;const i=e.match(/^(-?[\.\d]+)(m?s)/);return!i||i.length<2?0:W6(parseFloat(i[1]),i[2])}function W6(e,i){return"s"===i?e*Yq:e}function lU(e,i,t){return e.hasOwnProperty("duration")?e:function Xq(e,i,t){let c,u=0,f="";if("string"==typeof e){const _=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===_)return i.push(Ez()),{duration:0,delay:0,easing:""};c=W6(parseFloat(_[1]),_[2]);const E=_[3];null!=E&&(u=W6(parseFloat(E),_[4]));const S=_[5];S&&(f=S)}else c=e;if(!t){let _=!1,E=i.length;c<0&&(i.push(function lq(){return new se(3100,!1)}()),_=!0),u<0&&(i.push(function dq(){return new se(3101,!1)}()),_=!0),_&&i.splice(E,0,Ez())}return{duration:c,delay:u,easing:f}}(e,i,t)}function au(e,i,t){i.forEach((s,c)=>{const u=K6(c);t&&!t.has(c)&&t.set(c,e.style[u]),e.style[u]=s})}function tE(e,i){i.forEach((t,s)=>{const c=K6(s);e.style[c]=""})}function wO(e){return Array.isArray(e)?1==e.length?e[0]:function rq(e,i=null){return{type:Tt.Sequence,steps:e,options:i}}(e):e}const z6=new RegExp("{{\\s*(.+?)\\s*}}","g");function Az(e){let i=[];if("string"==typeof e){let t;for(;t=z6.exec(e);)i.push(t[1]);z6.lastIndex=0}return i}function RO(e,i,t){const s=`${e}`,c=s.replace(z6,(u,f)=>{let _=i[f];return null==_&&(t.push(function hq(){return new se(3003,!1)}()),_=""),_.toString()});return c==s?e:c}const Qq=/-+([a-z0-9])/g;function K6(e){return e.replace(Qq,(...i)=>i[1].toUpperCase())}function Ja(e,i,t){switch(i.type){case Tt.Trigger:return e.visitTrigger(i,t);case Tt.State:return e.visitState(i,t);case Tt.Transition:return e.visitTransition(i,t);case Tt.Sequence:return e.visitSequence(i,t);case Tt.Group:return e.visitGroup(i,t);case Tt.Animate:return e.visitAnimate(i,t);case Tt.Keyframes:return e.visitKeyframes(i,t);case Tt.Style:return e.visitStyle(i,t);case Tt.Reference:return e.visitReference(i,t);case Tt.AnimateChild:return e.visitAnimateChild(i,t);case Tt.AnimateRef:return e.visitAnimateRef(i,t);case Tt.Query:return e.visitQuery(i,t);case Tt.Stagger:return e.visitStagger(i,t);default:throw function pq(){return new se(3004,!1)}()}}function q6(e,i){return window.getComputedStyle(e)[i]}const nY=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class Dz extends j6{normalizePropertyName(i,t){return K6(i)}normalizeStyleValue(i,t,s,c){let u="";const f=s.toString().trim();if(nY.has(t)&&0!==s&&"0"!==s)if("number"==typeof s)u="px";else{const _=s.match(/^[+-]?[\d\.]+([a-z]*)$/);_&&0==_[1].length&&c.push(function fq(){return new se(3005,!1)}())}return f+u}}const dU="*";const uU=new Set(["true","1"]),hU=new Set(["false","0"]);function Oz(e,i){const t=uU.has(e)||hU.has(e),s=uU.has(i)||hU.has(i);return(c,u)=>{let f=e==dU||e==c,_=i==dU||i==u;return!f&&t&&"boolean"==typeof c&&(f=c?uU.has(e):hU.has(e)),!_&&s&&"boolean"==typeof u&&(_=u?uU.has(i):hU.has(i)),f&&_}}const sY=new RegExp("s*:selfs*,?","g");function Y6(e,i,t,s){return new aY(e).build(i,t,s)}class aY{constructor(i){this._driver=i}build(i,t,s){const c=new dY(t);return this._resetContextStyleTimingState(c),Ja(this,wO(i),c)}_resetContextStyleTimingState(i){i.currentQuerySelector="",i.collectedStyles=new Map,i.collectedStyles.set("",new Map),i.currentTime=0}visitTrigger(i,t){let s=t.queryCount=0,c=t.depCount=0;const u=[],f=[];return"@"==i.name.charAt(0)&&t.errors.push(function mq(){return new se(3006,!1)}()),i.definitions.forEach(_=>{if(this._resetContextStyleTimingState(t),_.type==Tt.State){const E=_,S=E.name;S.toString().split(/\s*,\s*/).forEach(I=>{E.name=I,u.push(this.visitState(E,t))}),E.name=S}else if(_.type==Tt.Transition){const E=this.visitTransition(_,t);s+=E.queryCount,c+=E.depCount,f.push(E)}else t.errors.push(function gq(){return new se(3007,!1)}())}),{type:Tt.Trigger,name:i.name,states:u,transitions:f,queryCount:s,depCount:c,options:null}}visitState(i,t){const s=this.visitStyle(i.styles,t),c=i.options&&i.options.params||null;if(s.containsDynamicStyles){const u=new Set,f=c||{};s.styles.forEach(_=>{_ instanceof Map&&_.forEach(E=>{Az(E).forEach(S=>{f.hasOwnProperty(S)||u.add(S)})})}),u.size&&t.errors.push(function _q(){return new se(3008,!1)}(0,u.values()))}return{type:Tt.State,name:i.name,style:s,options:c?{params:c}:null}}visitTransition(i,t){t.queryCount=0,t.depCount=0;const s=Ja(this,wO(i.animation),t),c=function iY(e,i){const t=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(s=>function rY(e,i,t){if(":"==e[0]){const E=function oY(e,i){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,s)=>parseFloat(s)>parseFloat(t);case":decrement":return(t,s)=>parseFloat(s)<parseFloat(t);default:return i.push(function Rq(){return new se(3016,!1)}()),"* => *"}}(e,t);if("function"==typeof E)return void i.push(E);e=E}const s=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==s||s.length<4)return t.push(function wq(){return new se(3015,!1)}()),i;const c=s[1],u=s[2],f=s[3];i.push(Oz(c,f)),"<"==u[0]&&(c!=dU||f!=dU)&&i.push(Oz(f,c))}(s,t,i)):t.push(e),t}(i.expr,t.errors);return{type:Tt.Transition,matchers:c,animation:s,queryCount:t.queryCount,depCount:t.depCount,options:nE(i.options)}}visitSequence(i,t){return{type:Tt.Sequence,steps:i.steps.map(s=>Ja(this,s,t)),options:nE(i.options)}}visitGroup(i,t){const s=t.currentTime;let c=0;const u=i.steps.map(f=>{t.currentTime=s;const _=Ja(this,f,t);return c=Math.max(c,t.currentTime),_});return t.currentTime=c,{type:Tt.Group,steps:u,options:nE(i.options)}}visitAnimate(i,t){const s=function hY(e,i){if(e.hasOwnProperty("duration"))return e;if("number"==typeof e)return $6(lU(e,i).duration,0,"");const t=e;if(t.split(/\s+/).some(u=>"{"==u.charAt(0)&&"{"==u.charAt(1))){const u=$6(0,0,"");return u.dynamic=!0,u.strValue=t,u}const c=lU(t,i);return $6(c.duration,c.delay,c.easing)}(i.timings,t.errors);t.currentAnimateTimings=s;let c,u=i.styles?i.styles:su({});if(u.type==Tt.Keyframes)c=this.visitKeyframes(u,t);else{let f=i.styles,_=!1;if(!f){_=!0;const S={};s.easing&&(S.easing=s.easing),f=su(S)}t.currentTime+=s.duration+s.delay;const E=this.visitStyle(f,t);E.isEmptyStep=_,c=E}return t.currentAnimateTimings=null,{type:Tt.Animate,timings:s,style:c,options:null}}visitStyle(i,t){const s=this._makeStyleAst(i,t);return this._validateStyleAst(s,t),s}_makeStyleAst(i,t){const s=[],c=Array.isArray(i.styles)?i.styles:[i.styles];for(let _ of c)"string"==typeof _?_===Yh?s.push(_):t.errors.push(new se(3002,!1)):s.push(new Map(Object.entries(_)));let u=!1,f=null;return s.forEach(_=>{if(_ instanceof Map&&(_.has("easing")&&(f=_.get("easing"),_.delete("easing")),!u))for(let E of _.values())if(E.toString().indexOf("{{")>=0){u=!0;break}}),{type:Tt.Style,styles:s,easing:f,offset:i.offset,containsDynamicStyles:u,options:null}}_validateStyleAst(i,t){const s=t.currentAnimateTimings;let c=t.currentTime,u=t.currentTime;s&&u>0&&(u-=s.duration+s.delay),i.styles.forEach(f=>{"string"!=typeof f&&f.forEach((_,E)=>{const S=t.collectedStyles.get(t.currentQuerySelector),I=S.get(E);let P=!0;I&&(u!=c&&u>=I.startTime&&c<=I.endTime&&(t.errors.push(function Eq(){return new se(3010,!1)}()),P=!1),u=I.startTime),P&&S.set(E,{startTime:u,endTime:c}),t.options&&function Jq(e,i,t){const s=i.params||{},c=Az(e);c.length&&c.forEach(u=>{s.hasOwnProperty(u)||t.push(function uq(){return new se(3001,!1)}())})}(_,t.options,t.errors)})})}visitKeyframes(i,t){const s={type:Tt.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function yq(){return new se(3011,!1)}()),s;let u=0;const f=[];let _=!1,E=!1,S=0;const I=i.steps.map(ae=>{const ne=this._makeStyleAst(ae,t);let ke=null!=ne.offset?ne.offset:function uY(e){if("string"==typeof e)return null;let i=null;if(Array.isArray(e))e.forEach(t=>{if(t instanceof Map&&t.has("offset")){const s=t;i=parseFloat(s.get("offset")),s.delete("offset")}});else if(e instanceof Map&&e.has("offset")){const t=e;i=parseFloat(t.get("offset")),t.delete("offset")}return i}(ne.styles),Ge=0;return null!=ke&&(u++,Ge=ne.offset=ke),E=E||Ge<0||Ge>1,_=_||Ge<S,S=Ge,f.push(Ge),ne});E&&t.errors.push(function bq(){return new se(3012,!1)}()),_&&t.errors.push(function Sq(){return new se(3200,!1)}());const P=i.steps.length;let U=0;u>0&&u<P?t.errors.push(function Cq(){return new se(3202,!1)}()):0==u&&(U=1/(P-1));const B=P-1,G=t.currentTime,K=t.currentAnimateTimings,te=K.duration;return I.forEach((ae,ne)=>{const ke=U>0?ne==B?1:U*ne:f[ne],Ge=ke*te;t.currentTime=G+K.delay+Ge,K.duration=Ge,this._validateStyleAst(ae,t),ae.offset=ke,s.styles.push(ae)}),s}visitReference(i,t){return{type:Tt.Reference,animation:Ja(this,wO(i.animation),t),options:nE(i.options)}}visitAnimateChild(i,t){return t.depCount++,{type:Tt.AnimateChild,options:nE(i.options)}}visitAnimateRef(i,t){return{type:Tt.AnimateRef,animation:this.visitReference(i.animation,t),options:nE(i.options)}}visitQuery(i,t){const s=t.currentQuerySelector,c=i.options||{};t.queryCount++,t.currentQuery=i;const[u,f]=function cY(e){const i=!!e.split(/\s*,\s*/).find(t=>":self"==t);return i&&(e=e.replace(sY,"")),e=e.replace(/@\*/g,cU).replace(/@\w+/g,t=>cU+"-"+t.slice(1)).replace(/:animating/g,G6),[e,i]}(i.selector);t.currentQuerySelector=s.length?s+" "+u:u,Za(t.collectedStyles,t.currentQuerySelector,new Map);const _=Ja(this,wO(i.animation),t);return t.currentQuery=null,t.currentQuerySelector=s,{type:Tt.Query,selector:u,limit:c.limit||0,optional:!!c.optional,includeSelf:f,animation:_,originalSelector:i.selector,options:nE(i.options)}}visitStagger(i,t){t.currentQuery||t.errors.push(function Tq(){return new se(3013,!1)}());const s="full"===i.timings?{duration:0,delay:0,easing:"full"}:lU(i.timings,t.errors,!0);return{type:Tt.Stagger,animation:Ja(this,wO(i.animation),t),timings:s,options:null}}}class dY{constructor(i){this.errors=i,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function nE(e){return e?(e={...e}).params&&(e.params=function lY(e){return e?{...e}:null}(e.params)):e={},e}function $6(e,i,t){return{duration:e,delay:i,easing:t}}function X6(e,i,t,s,c,u,f=null,_=!1){return{type:1,element:e,keyframes:i,preStyleProps:t,postStyleProps:s,duration:c,delay:u,totalTime:c+u,easing:f,subTimeline:_}}class pU{constructor(){this._map=new Map}get(i){return this._map.get(i)||[]}append(i,t){let s=this._map.get(i);s||this._map.set(i,s=[]),s.push(...t)}has(i){return this._map.has(i)}clear(){this._map.clear()}}const mY=new RegExp(":enter","g"),_Y=new RegExp(":leave","g");function Z6(e,i,t,s,c,u=new Map,f=new Map,_,E,S=[]){return(new vY).buildKeyframes(e,i,t,s,c,u,f,_,E,S)}class vY{buildKeyframes(i,t,s,c,u,f,_,E,S,I=[]){S=S||new pU;const P=new J6(i,t,S,c,u,I,[]);P.options=E;const U=E.delay?$h(E.delay):0;P.currentTimeline.delayNextStep(U),P.currentTimeline.setStyles([f],null,P.errors,E),Ja(this,s,P);const B=P.timelines.filter(G=>G.containsAnimation());if(B.length&&_.size){let G;for(let K=B.length-1;K>=0;K--){const te=B[K];if(te.element===t){G=te;break}}G&&!G.allowOnlyTimelineStyles()&&G.setStyles([_],null,P.errors,E)}return B.length?B.map(G=>G.buildKeyframes()):[X6(t,[],[],[],0,U,"",!1)]}visitTrigger(i,t){}visitState(i,t){}visitTransition(i,t){}visitAnimateChild(i,t){const s=t.subInstructions.get(t.element);if(s){const c=t.createSubContext(i.options),u=t.currentTimeline.currentTime,f=this._visitSubInstructions(s,c,c.options);u!=f&&t.transformIntoNewTimeline(f)}t.previousNode=i}visitAnimateRef(i,t){const s=t.createSubContext(i.options);s.transformIntoNewTimeline(),this._applyAnimationRefDelays([i.options,i.animation.options],t,s),this.visitReference(i.animation,s),t.transformIntoNewTimeline(s.currentTimeline.currentTime),t.previousNode=i}_applyAnimationRefDelays(i,t,s){for(const c of i){const u=c?.delay;if(u){const f="number"==typeof u?u:$h(RO(u,c?.params??{},t.errors));s.delayNextStep(f)}}}_visitSubInstructions(i,t,s){let u=t.currentTimeline.currentTime;const f=null!=s.duration?$h(s.duration):null,_=null!=s.delay?$h(s.delay):null;return 0!==f&&i.forEach(E=>{const S=t.appendInstructionToTimeline(E,f,_);u=Math.max(u,S.duration+S.delay)}),u}visitReference(i,t){t.updateOptions(i.options,!0),Ja(this,i.animation,t),t.previousNode=i}visitSequence(i,t){const s=t.subContextCount;let c=t;const u=i.options;if(u&&(u.params||u.delay)&&(c=t.createSubContext(u),c.transformIntoNewTimeline(),null!=u.delay)){c.previousNode.type==Tt.Style&&(c.currentTimeline.snapshotCurrentStyles(),c.previousNode=fU);const f=$h(u.delay);c.delayNextStep(f)}i.steps.length&&(i.steps.forEach(f=>Ja(this,f,c)),c.currentTimeline.applyStylesToKeyframe(),c.subContextCount>s&&c.transformIntoNewTimeline()),t.previousNode=i}visitGroup(i,t){const s=[];let c=t.currentTimeline.currentTime;const u=i.options&&i.options.delay?$h(i.options.delay):0;i.steps.forEach(f=>{const _=t.createSubContext(i.options);u&&_.delayNextStep(u),Ja(this,f,_),c=Math.max(c,_.currentTimeline.currentTime),s.push(_.currentTimeline)}),s.forEach(f=>t.currentTimeline.mergeTimelineCollectedStyles(f)),t.transformIntoNewTimeline(c),t.previousNode=i}_visitTiming(i,t){if(i.dynamic){const s=i.strValue;return lU(t.params?RO(s,t.params,t.errors):s,t.errors)}return{duration:i.duration,delay:i.delay,easing:i.easing}}visitAnimate(i,t){const s=t.currentAnimateTimings=this._visitTiming(i.timings,t),c=t.currentTimeline;s.delay&&(t.incrementTime(s.delay),c.snapshotCurrentStyles());const u=i.style;u.type==Tt.Keyframes?this.visitKeyframes(u,t):(t.incrementTime(s.duration),this.visitStyle(u,t),c.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=i}visitStyle(i,t){const s=t.currentTimeline,c=t.currentAnimateTimings;!c&&s.hasCurrentStyleProperties()&&s.forwardFrame();const u=c&&c.easing||i.easing;i.isEmptyStep?s.applyEmptyStep(u):s.setStyles(i.styles,u,t.errors,t.options),t.previousNode=i}visitKeyframes(i,t){const s=t.currentAnimateTimings,c=t.currentTimeline.duration,u=s.duration,_=t.createSubContext().currentTimeline;_.easing=s.easing,i.styles.forEach(E=>{_.forwardTime((E.offset||0)*u),_.setStyles(E.styles,E.easing,t.errors,t.options),_.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(_),t.transformIntoNewTimeline(c+u),t.previousNode=i}visitQuery(i,t){const s=t.currentTimeline.currentTime,c=i.options||{},u=c.delay?$h(c.delay):0;u&&(t.previousNode.type===Tt.Style||0==s&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=fU);let f=s;const _=t.invokeQuery(i.selector,i.originalSelector,i.limit,i.includeSelf,!!c.optional,t.errors);t.currentQueryTotal=_.length;let E=null;_.forEach((S,I)=>{t.currentQueryIndex=I;const P=t.createSubContext(i.options,S);u&&P.delayNextStep(u),S===t.element&&(E=P.currentTimeline),Ja(this,i.animation,P),P.currentTimeline.applyStylesToKeyframe(),f=Math.max(f,P.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(f),E&&(t.currentTimeline.mergeTimelineCollectedStyles(E),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=i}visitStagger(i,t){const s=t.parentContext,c=t.currentTimeline,u=i.timings,f=Math.abs(u.duration),_=f*(t.currentQueryTotal-1);let E=f*t.currentQueryIndex;switch(u.duration<0?"reverse":u.easing){case"reverse":E=_-E;break;case"full":E=s.currentStaggerTime}const I=t.currentTimeline;E&&I.delayNextStep(E);const P=I.currentTime;Ja(this,i.animation,t),t.previousNode=i,s.currentStaggerTime=c.currentTime-P+(c.startTime-s.currentTimeline.startTime)}}const fU={};class J6{constructor(i,t,s,c,u,f,_,E){this._driver=i,this.element=t,this.subInstructions=s,this._enterClassName=c,this._leaveClassName=u,this.errors=f,this.timelines=_,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=fU,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=E||new mU(this._driver,t,0),_.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(i,t){if(!i)return;const s=i;let c=this.options;null!=s.duration&&(c.duration=$h(s.duration)),null!=s.delay&&(c.delay=$h(s.delay));const u=s.params;if(u){let f=c.params;f||(f=this.options.params={}),Object.keys(u).forEach(_=>{(!t||!f.hasOwnProperty(_))&&(f[_]=RO(u[_],f,this.errors))})}}_copyOptions(){const i={};if(this.options){const t=this.options.params;if(t){const s=i.params={};Object.keys(t).forEach(c=>{s[c]=t[c]})}}return i}createSubContext(i=null,t,s){const c=t||this.element,u=new J6(this._driver,c,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(c,s||0));return u.previousNode=this.previousNode,u.currentAnimateTimings=this.currentAnimateTimings,u.options=this._copyOptions(),u.updateOptions(i),u.currentQueryIndex=this.currentQueryIndex,u.currentQueryTotal=this.currentQueryTotal,u.parentContext=this,this.subContextCount++,u}transformIntoNewTimeline(i){return this.previousNode=fU,this.currentTimeline=this.currentTimeline.fork(this.element,i),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(i,t,s){const c={duration:t??i.duration,delay:this.currentTimeline.currentTime+(s??0)+i.delay,easing:""},u=new EY(this._driver,i.element,i.keyframes,i.preStyleProps,i.postStyleProps,c,i.stretchStartingKeyframe);return this.timelines.push(u),c}incrementTime(i){this.currentTimeline.forwardTime(this.currentTimeline.duration+i)}delayNextStep(i){i>0&&this.currentTimeline.delayNextStep(i)}invokeQuery(i,t,s,c,u,f){let _=[];if(c&&_.push(this.element),i.length>0){i=(i=i.replace(mY,"."+this._enterClassName)).replace(_Y,"."+this._leaveClassName);let S=this._driver.query(this.element,i,1!=s);0!==s&&(S=s<0?S.slice(S.length+s,S.length):S.slice(0,s)),_.push(...S)}return!u&&0==_.length&&f.push(function Iq(){return new se(3014,!1)}()),_}}class mU{constructor(i,t,s,c){this._driver=i,this.element=t,this.startTime=s,this._elementTimelineStylesLookup=c,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(i){const t=1===this._keyframes.size&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+i),t&&this.snapshotCurrentStyles()):this.startTime+=i}fork(i,t){return this.applyStylesToKeyframe(),new mU(this._driver,i,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(i){this.applyStylesToKeyframe(),this.duration=i,this._loadKeyframe()}_updateStyle(i,t){this._localTimelineStyles.set(i,t),this._globalTimelineStyles.set(i,t),this._styleSummary.set(i,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(i){i&&this._previousKeyframe.set("easing",i);for(let[t,s]of this._globalTimelineStyles)this._backFill.set(t,s||Yh),this._currentKeyframe.set(t,Yh);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(i,t,s,c){t&&this._previousKeyframe.set("easing",t);const u=c&&c.params||{},f=function yY(e,i){const t=new Map;let s;return e.forEach(c=>{if("*"===c){s??=i.keys();for(let u of s)t.set(u,Yh)}else for(let[u,f]of c)t.set(u,f)}),t}(i,this._globalTimelineStyles);for(let[_,E]of f){const S=RO(E,u,s);this._pendingStyles.set(_,S),this._localTimelineStyles.has(_)||this._backFill.set(_,this._globalTimelineStyles.get(_)??Yh),this._updateStyle(_,S)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((i,t)=>{this._currentKeyframe.set(t,i)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((i,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,i)}))}snapshotCurrentStyles(){for(let[i,t]of this._localTimelineStyles)this._pendingStyles.set(i,t),this._updateStyle(i,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const i=[];for(let t in this._currentKeyframe)i.push(t);return i}mergeTimelineCollectedStyles(i){i._styleSummary.forEach((t,s)=>{const c=this._styleSummary.get(s);(!c||t.time>c.time)&&this._updateStyle(s,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();const i=new Set,t=new Set,s=1===this._keyframes.size&&0===this.duration;let c=[];this._keyframes.forEach((_,E)=>{const S=new Map([...this._backFill,..._]);S.forEach((I,P)=>{"!"===I?i.add(P):I===Yh&&t.add(P)}),s||S.set("offset",E/this.duration),c.push(S)});const u=[...i.values()],f=[...t.values()];if(s){const _=c[0],E=new Map(_);_.set("offset",0),E.set("offset",1),c=[_,E]}return X6(this.element,c,u,f,this.duration,this.startTime,this.easing,!1)}}class EY extends mU{constructor(i,t,s,c,u,f,_=!1){super(i,t,f.delay),this.keyframes=s,this.preStyleProps=c,this.postStyleProps=u,this._stretchStartingKeyframe=_,this.timings={duration:f.duration,delay:f.delay,easing:f.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let i=this.keyframes,{delay:t,duration:s,easing:c}=this.timings;if(this._stretchStartingKeyframe&&t){const u=[],f=s+t,_=t/f,E=new Map(i[0]);E.set("offset",0),u.push(E);const S=new Map(i[0]);S.set("offset",Mz(_)),u.push(S);const I=i.length-1;for(let P=1;P<=I;P++){let U=new Map(i[P]);const B=U.get("offset");U.set("offset",Mz((t+B*s)/f)),u.push(U)}s=f,t=0,c="",i=u}return X6(this.element,i,this.preStyleProps,this.postStyleProps,s,t,c,!0)}}function Mz(e,i=3){const t=Math.pow(10,i-1);return Math.round(e*t)/t}function kz(e,i,t,s,c,u,f,_,E,S,I,P,U){return{type:0,element:e,triggerName:i,isRemovalTransition:c,fromState:t,fromStyles:u,toState:s,toStyles:f,timelines:_,queriedElements:E,preStyleProps:S,postStyleProps:I,totalTime:P,errors:U}}const Q6={};class Lz{constructor(i,t,s){this._triggerName=i,this.ast=t,this._stateStyles=s}match(i,t,s,c){return function bY(e,i,t,s,c){return e.some(u=>u(i,t,s,c))}(this.ast.matchers,i,t,s,c)}buildStyles(i,t,s){let c=this._stateStyles.get("*");return void 0!==i&&(c=this._stateStyles.get(i?.toString())||c),c?c.buildStyles(t,s):new Map}build(i,t,s,c,u,f,_,E,S,I){const P=[],U=this.ast.options&&this.ast.options.params||Q6,G=this.buildStyles(s,_&&_.params||Q6,P),K=E&&E.params||Q6,te=this.buildStyles(c,K,P),ae=new Set,ne=new Map,ke=new Map,Ge="void"===c,Ht={params:xz(K,U),delay:this.ast.options?.delay},cn=I?[]:Z6(i,t,this.ast.animation,u,f,G,te,Ht,S,P);let An=0;return cn.forEach(Rr=>{An=Math.max(Rr.duration+Rr.delay,An)}),P.length?kz(t,this._triggerName,s,c,Ge,G,te,[],[],ne,ke,An,P):(cn.forEach(Rr=>{const cu=Rr.element,oT=Za(ne,cu,new Set);Rr.preStyleProps.forEach(lE=>oT.add(lE));const RK=Za(ke,cu,new Set);Rr.postStyleProps.forEach(lE=>RK.add(lE)),cu!==t&&ae.add(cu)}),kz(t,this._triggerName,s,c,Ge,G,te,cn,[...ae.values()],ne,ke,An))}}function xz(e,i){const t={...i};return Object.entries(e).forEach(([s,c])=>{null!=c&&(t[s]=c)}),t}class SY{constructor(i,t,s){this.styles=i,this.defaultParams=t,this.normalizer=s}buildStyles(i,t){const s=new Map,c=xz(i,this.defaultParams);return this.styles.styles.forEach(u=>{"string"!=typeof u&&u.forEach((f,_)=>{f&&(f=RO(f,c,t));const E=this.normalizer.normalizePropertyName(_,t);f=this.normalizer.normalizeStyleValue(_,E,f,t),s.set(_,f)})}),s}}class TY{constructor(i,t,s){this.name=i,this.ast=t,this._normalizer=s,this.transitionFactories=[],this.states=new Map,t.states.forEach(c=>{this.states.set(c.name,new SY(c.style,c.options&&c.options.params||{},s))}),Fz(this.states,"true","1"),Fz(this.states,"false","0"),t.transitions.forEach(c=>{this.transitionFactories.push(new Lz(i,c,this.states))}),this.fallbackTransition=function IY(e,i){return new Lz(e,{type:Tt.Transition,animation:{type:Tt.Sequence,steps:[],options:null},matchers:[(f,_)=>!0],options:null,queryCount:0,depCount:0},i)}(i,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(i,t,s,c){return this.transitionFactories.find(f=>f.match(i,t,s,c))||null}matchStyles(i,t,s){return this.fallbackTransition.buildStyles(i,t,s)}}function Fz(e,i,t){e.has(i)?e.has(t)||e.set(t,e.get(i)):e.has(t)&&e.set(i,e.get(t))}const wY=new pU;class RY{constructor(i,t,s){this.bodyNode=i,this._driver=t,this._normalizer=s,this._animations=new Map,this._playersById=new Map,this.players=[]}register(i,t){const s=[],u=Y6(this._driver,t,s,[]);if(s.length)throw function Pq(){return new se(3503,!1)}();this._animations.set(i,u)}_buildPlayer(i,t,s){const c=i.element,u=yz(this._normalizer,i.keyframes,t,s);return this._driver.animate(c,u,i.duration,i.delay,i.easing,[],!0)}create(i,t,s={}){const c=[],u=this._animations.get(i);let f;const _=new Map;if(u?(f=Z6(this._driver,t,u,H6,sU,new Map,new Map,s,wY,c),f.forEach(I=>{const P=Za(_,I.element,new Map);I.postStyleProps.forEach(U=>P.set(U,null))})):(c.push(function Mq(){return new se(3300,!1)}()),f=[]),c.length)throw function kq(){return new se(3504,!1)}();_.forEach((I,P)=>{I.forEach((U,B)=>{I.set(B,this._driver.computeStyle(P,B,Yh))})});const S=fm(f.map(I=>{const P=_.get(I.element);return this._buildPlayer(I,new Map,P)}));return this._playersById.set(i,S),S.onDestroy(()=>this.destroy(i)),this.players.push(S),S}destroy(i){const t=this._getPlayer(i);t.destroy(),this._playersById.delete(i);const s=this.players.indexOf(t);s>=0&&this.players.splice(s,1)}_getPlayer(i){const t=this._playersById.get(i);if(!t)throw function Lq(){return new se(3301,!1)}();return t}listen(i,t,s,c){const u=F6(t,"","","");return L6(this._getPlayer(i),s,u,c),()=>{}}command(i,t,s,c){if("register"==s)return void this.register(i,c[0]);if("create"==s)return void this.create(i,t,c[0]||{});const u=this._getPlayer(i);switch(s){case"play":u.play();break;case"pause":u.pause();break;case"reset":u.reset();break;case"restart":u.restart();break;case"finish":u.finish();break;case"init":u.init();break;case"setPosition":u.setPosition(parseFloat(c[0]));break;case"destroy":this.destroy(i)}}}const Uz="ng-animate-queued",e8="ng-animate-disabled",PY=[],Vz={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},MY={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Gl="__ng_removed";class t8{get params(){return this.options.params}constructor(i,t=""){this.namespaceId=t;const s=i&&i.hasOwnProperty("value");if(this.value=function FY(e){return e??null}(s?i.value:i),s){const{value:u,...f}=i;this.options=f}else this.options={};this.options.params||(this.options.params={})}absorbOptions(i){const t=i.params;if(t){const s=this.options.params;Object.keys(t).forEach(c=>{null==s[c]&&(s[c]=t[c])})}}}const AO="void",n8=new t8(AO);class kY{constructor(i,t,s){this.id=i,this.hostElement=t,this._engine=s,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+i,xc(t,this._hostClassName)}listen(i,t,s,c){if(!this._triggers.has(t))throw function xq(){return new se(3302,!1)}();if(null==s||0==s.length)throw function Fq(){return new se(3303,!1)}();if(!function UY(e){return"start"==e||"done"==e}(s))throw function Uq(){return new se(3400,!1)}();const u=Za(this._elementListeners,i,[]),f={name:t,phase:s,callback:c};u.push(f);const _=Za(this._engine.statesByElement,i,new Map);return _.has(t)||(xc(i,aU),xc(i,aU+"-"+t),_.set(t,n8)),()=>{this._engine.afterFlush(()=>{const E=u.indexOf(f);E>=0&&u.splice(E,1),this._triggers.has(t)||_.delete(t)})}}register(i,t){return!this._triggers.has(i)&&(this._triggers.set(i,t),!0)}_getTrigger(i){const t=this._triggers.get(i);if(!t)throw function Vq(){return new se(3401,!1)}();return t}trigger(i,t,s,c=!0){const u=this._getTrigger(t),f=new i8(this.id,t,i);let _=this._engine.statesByElement.get(i);_||(xc(i,aU),xc(i,aU+"-"+t),this._engine.statesByElement.set(i,_=new Map));let E=_.get(t);const S=new t8(s,this.id);if(!(s&&s.hasOwnProperty("value"))&&E&&S.absorbOptions(E.options),_.set(t,S),E||(E=n8),S.value!==AO&&E.value===S.value){if(!function jY(e,i){const t=Object.keys(e),s=Object.keys(i);if(t.length!=s.length)return!1;for(let c=0;c<t.length;c++){const u=t[c];if(!i.hasOwnProperty(u)||e[u]!==i[u])return!1}return!0}(E.params,S.params)){const K=[],te=u.matchStyles(E.value,E.params,K),ae=u.matchStyles(S.value,S.params,K);K.length?this._engine.reportError(K):this._engine.afterFlush(()=>{tE(i,te),au(i,ae)})}return}const U=Za(this._engine.playersByElement,i,[]);U.forEach(K=>{K.namespaceId==this.id&&K.triggerName==t&&K.queued&&K.destroy()});let B=u.matchTransition(E.value,S.value,i,S.params),G=!1;if(!B){if(!c)return;B=u.fallbackTransition,G=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:i,triggerName:t,transition:B,fromState:E,toState:S,player:f,isFallbackTransition:G}),G||(xc(i,Uz),f.onStart(()=>{XC(i,Uz)})),f.onDone(()=>{let K=this.players.indexOf(f);K>=0&&this.players.splice(K,1);const te=this._engine.playersByElement.get(i);if(te){let ae=te.indexOf(f);ae>=0&&te.splice(ae,1)}}),this.players.push(f),U.push(f),f}deregister(i){this._triggers.delete(i),this._engine.statesByElement.forEach(t=>t.delete(i)),this._elementListeners.forEach((t,s)=>{this._elementListeners.set(s,t.filter(c=>c.name!=i))})}clearElementCache(i){this._engine.statesByElement.delete(i),this._elementListeners.delete(i);const t=this._engine.playersByElement.get(i);t&&(t.forEach(s=>s.destroy()),this._engine.playersByElement.delete(i))}_signalRemovalForInnerTriggers(i,t){const s=this._engine.driver.query(i,cU,!0);s.forEach(c=>{if(c[Gl])return;const u=this._engine.fetchNamespacesByElement(c);u.size?u.forEach(f=>f.triggerLeaveAnimation(c,t,!1,!0)):this.clearElementCache(c)}),this._engine.afterFlushAnimationsDone(()=>s.forEach(c=>this.clearElementCache(c)))}triggerLeaveAnimation(i,t,s,c){const u=this._engine.statesByElement.get(i),f=new Map;if(u){const _=[];if(u.forEach((E,S)=>{if(f.set(S,E.value),this._triggers.has(S)){const I=this.trigger(i,S,AO,c);I&&_.push(I)}}),_.length)return this._engine.markElementAsRemoved(this.id,i,!0,t,f),s&&fm(_).onDone(()=>this._engine.processLeaveNode(i)),!0}return!1}prepareLeaveAnimationListeners(i){const t=this._elementListeners.get(i),s=this._engine.statesByElement.get(i);if(t&&s){const c=new Set;t.forEach(u=>{const f=u.name;if(c.has(f))return;c.add(f);const E=this._triggers.get(f).fallbackTransition,S=s.get(f)||n8,I=new t8(AO),P=new i8(this.id,f,i);this._engine.totalQueuedPlayers++,this._queue.push({element:i,triggerName:f,transition:E,fromState:S,toState:I,player:P,isFallbackTransition:!0})})}}removeNode(i,t){const s=this._engine;if(i.childElementCount&&this._signalRemovalForInnerTriggers(i,t),this.triggerLeaveAnimation(i,t,!0))return;let c=!1;if(s.totalAnimations){const u=s.players.length?s.playersByQueriedElement.get(i):[];if(u&&u.length)c=!0;else{let f=i;for(;f=f.parentNode;)if(s.statesByElement.get(f)){c=!0;break}}}if(this.prepareLeaveAnimationListeners(i),c)s.markElementAsRemoved(this.id,i,!1,t);else{const u=i[Gl];(!u||u===Vz)&&(s.afterFlush(()=>this.clearElementCache(i)),s.destroyInnerAnimations(i),s._onRemovalComplete(i,t))}}insertNode(i,t){xc(i,this._hostClassName)}drainQueuedTransitions(i){const t=[];return this._queue.forEach(s=>{const c=s.player;if(c.destroyed)return;const u=s.element,f=this._elementListeners.get(u);f&&f.forEach(_=>{if(_.name==s.triggerName){const E=F6(u,s.triggerName,s.fromState.value,s.toState.value);E._data=i,L6(s.player,_.phase,E,_.callback)}}),c.markedForDestroy?this._engine.afterFlush(()=>{c.destroy()}):t.push(s)}),this._queue=[],t.sort((s,c)=>{const u=s.transition.ast.depCount,f=c.transition.ast.depCount;return 0==u||0==f?u-f:this._engine.driver.containsElement(s.element,c.element)?1:-1})}destroy(i){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,i)}}class LY{_onRemovalComplete(i,t){this.onRemovalComplete(i,t)}constructor(i,t,s){this.bodyNode=i,this.driver=t,this._normalizer=s,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(c,u)=>{}}get queuedPlayers(){const i=[];return this._namespaceList.forEach(t=>{t.players.forEach(s=>{s.queued&&i.push(s)})}),i}createNamespace(i,t){const s=new kY(i,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(s,t):(this.newHostElements.set(t,s),this.collectEnterElement(t)),this._namespaceLookup[i]=s}_balanceNamespaceList(i,t){const s=this._namespaceList,c=this.namespacesByHostElement;if(s.length-1>=0){let f=!1,_=this.driver.getParentElement(t);for(;_;){const E=c.get(_);if(E){const S=s.indexOf(E);s.splice(S+1,0,i),f=!0;break}_=this.driver.getParentElement(_)}f||s.unshift(i)}else s.push(i);return c.set(t,i),i}register(i,t){let s=this._namespaceLookup[i];return s||(s=this.createNamespace(i,t)),s}registerTrigger(i,t,s){let c=this._namespaceLookup[i];c&&c.register(t,s)&&this.totalAnimations++}destroy(i,t){i&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const s=this._fetchNamespace(i);this.namespacesByHostElement.delete(s.hostElement);const c=this._namespaceList.indexOf(s);c>=0&&this._namespaceList.splice(c,1),s.destroy(t),delete this._namespaceLookup[i]}))}_fetchNamespace(i){return this._namespaceLookup[i]}fetchNamespacesByElement(i){const t=new Set,s=this.statesByElement.get(i);if(s)for(let c of s.values())if(c.namespaceId){const u=this._fetchNamespace(c.namespaceId);u&&t.add(u)}return t}trigger(i,t,s,c){if(gU(t)){const u=this._fetchNamespace(i);if(u)return u.trigger(t,s,c),!0}return!1}insertNode(i,t,s,c){if(!gU(t))return;const u=t[Gl];if(u&&u.setForRemoval){u.setForRemoval=!1,u.setForMove=!0;const f=this.collectedLeaveElements.indexOf(t);f>=0&&this.collectedLeaveElements.splice(f,1)}if(i){const f=this._fetchNamespace(i);f&&f.insertNode(t,s)}c&&this.collectEnterElement(t)}collectEnterElement(i){this.collectedEnterElements.push(i)}markElementAsDisabled(i,t){t?this.disabledNodes.has(i)||(this.disabledNodes.add(i),xc(i,e8)):this.disabledNodes.has(i)&&(this.disabledNodes.delete(i),XC(i,e8))}removeNode(i,t,s){if(gU(t)){const c=i?this._fetchNamespace(i):null;c?c.removeNode(t,s):this.markElementAsRemoved(i,t,!1,s);const u=this.namespacesByHostElement.get(t);u&&u.id!==i&&u.removeNode(t,s)}else this._onRemovalComplete(t,s)}markElementAsRemoved(i,t,s,c,u){this.collectedLeaveElements.push(t),t[Gl]={namespaceId:i,setForRemoval:c,hasAnimation:s,removedBeforeQueried:!1,previousTriggersValues:u}}listen(i,t,s,c,u){return gU(t)?this._fetchNamespace(i).listen(t,s,c,u):()=>{}}_buildInstruction(i,t,s,c,u){return i.transition.build(this.driver,i.element,i.fromState.value,i.toState.value,s,c,i.fromState.options,i.toState.options,t,u)}destroyInnerAnimations(i){let t=this.driver.query(i,cU,!0);t.forEach(s=>this.destroyActiveAnimationsForElement(s)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(i,G6,!0),t.forEach(s=>this.finishActiveQueriedAnimationOnElement(s)))}destroyActiveAnimationsForElement(i){const t=this.playersByElement.get(i);t&&t.forEach(s=>{s.queued?s.markedForDestroy=!0:s.destroy()})}finishActiveQueriedAnimationOnElement(i){const t=this.playersByQueriedElement.get(i);t&&t.forEach(s=>s.finish())}whenRenderingDone(){return new Promise(i=>{if(this.players.length)return fm(this.players).onDone(()=>i());i()})}processLeaveNode(i){const t=i[Gl];if(t&&t.setForRemoval){if(i[Gl]=Vz,t.namespaceId){this.destroyInnerAnimations(i);const s=this._fetchNamespace(t.namespaceId);s&&s.clearElementCache(i)}this._onRemovalComplete(i,t.setForRemoval)}i.classList?.contains(e8)&&this.markElementAsDisabled(i,!1),this.driver.query(i,".ng-animate-disabled",!0).forEach(s=>{this.markElementAsDisabled(s,!1)})}flush(i=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((s,c)=>this._balanceNamespaceList(s,c)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let s=0;s<this.collectedEnterElements.length;s++)xc(this.collectedEnterElements[s],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const s=[];try{t=this._flushAnimations(s,i)}finally{for(let c=0;c<s.length;c++)s[c]()}}else for(let s=0;s<this.collectedLeaveElements.length;s++)this.processLeaveNode(this.collectedLeaveElements[s]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(s=>s()),this._flushFns=[],this._whenQuietFns.length){const s=this._whenQuietFns;this._whenQuietFns=[],t.length?fm(t).onDone(()=>{s.forEach(c=>c())}):s.forEach(c=>c())}}reportError(i){throw function Bq(){return new se(3402,!1)}()}_flushAnimations(i,t){const s=new pU,c=[],u=new Map,f=[],_=new Map,E=new Map,S=new Map,I=new Set;this.disabledNodes.forEach(We=>{I.add(We);const dt=this.driver.query(We,".ng-animate-queued",!0);for(let bt=0;bt<dt.length;bt++)I.add(dt[bt])});const P=this.bodyNode,U=Array.from(this.statesByElement.keys()),B=Hz(U,this.collectedEnterElements),G=new Map;let K=0;B.forEach((We,dt)=>{const bt=H6+K++;G.set(dt,bt),We.forEach(Ln=>xc(Ln,bt))});const te=[],ae=new Set,ne=new Set;for(let We=0;We<this.collectedLeaveElements.length;We++){const dt=this.collectedLeaveElements[We],bt=dt[Gl];bt&&bt.setForRemoval&&(te.push(dt),ae.add(dt),bt.hasAnimation?this.driver.query(dt,".ng-star-inserted",!0).forEach(Ln=>ae.add(Ln)):ne.add(dt))}const ke=new Map,Ge=Hz(U,Array.from(ae));Ge.forEach((We,dt)=>{const bt=sU+K++;ke.set(dt,bt),We.forEach(Ln=>xc(Ln,bt))}),i.push(()=>{B.forEach((We,dt)=>{const bt=G.get(dt);We.forEach(Ln=>XC(Ln,bt))}),Ge.forEach((We,dt)=>{const bt=ke.get(dt);We.forEach(Ln=>XC(Ln,bt))}),te.forEach(We=>{this.processLeaveNode(We)})});const Ht=[],cn=[];for(let We=this._namespaceList.length-1;We>=0;We--)this._namespaceList[We].drainQueuedTransitions(t).forEach(bt=>{const Ln=bt.player,Eo=bt.element;if(Ht.push(Ln),this.collectedEnterElements.length){const ms=Eo[Gl];if(ms&&ms.setForMove){if(ms.previousTriggersValues&&ms.previousTriggersValues.has(bt.triggerName)){const dE=ms.previousTriggersValues.get(bt.triggerName),Vc=this.statesByElement.get(bt.element);if(Vc&&Vc.has(bt.triggerName)){const KU=Vc.get(bt.triggerName);KU.value=dE,Vc.set(bt.triggerName,KU)}}return void Ln.destroy()}}const lu=!P||!this.driver.containsElement(P,Eo),Qa=ke.get(Eo),vm=G.get(Eo),rr=this._buildInstruction(bt,s,vm,Qa,lu);if(rr.errors&&rr.errors.length)return void cn.push(rr);if(lu)return Ln.onStart(()=>tE(Eo,rr.fromStyles)),Ln.onDestroy(()=>au(Eo,rr.toStyles)),void c.push(Ln);if(bt.isFallbackTransition)return Ln.onStart(()=>tE(Eo,rr.fromStyles)),Ln.onDestroy(()=>au(Eo,rr.toStyles)),void c.push(Ln);const OK=[];rr.timelines.forEach(ms=>{ms.stretchStartingKeyframe=!0,this.disabledNodes.has(ms.element)||OK.push(ms)}),rr.timelines=OK,s.append(Eo,rr.timelines),f.push({instruction:rr,player:Ln,element:Eo}),rr.queriedElements.forEach(ms=>Za(_,ms,[]).push(Ln)),rr.preStyleProps.forEach((ms,dE)=>{if(ms.size){let Vc=E.get(dE);Vc||E.set(dE,Vc=new Set),ms.forEach((KU,$8)=>Vc.add($8))}}),rr.postStyleProps.forEach((ms,dE)=>{let Vc=S.get(dE);Vc||S.set(dE,Vc=new Set),ms.forEach((KU,$8)=>Vc.add($8))})});if(cn.length){const We=[];cn.forEach(dt=>{We.push(function jq(){return new se(3505,!1)}())}),Ht.forEach(dt=>dt.destroy()),this.reportError(We)}const An=new Map,Rr=new Map;f.forEach(We=>{const dt=We.element;s.has(dt)&&(Rr.set(dt,dt),this._beforeAnimationBuild(We.player.namespaceId,We.instruction,An))}),c.forEach(We=>{const dt=We.element;this._getPreviousPlayers(dt,!1,We.namespaceId,We.triggerName,null).forEach(Ln=>{Za(An,dt,[]).push(Ln),Ln.destroy()})});const cu=te.filter(We=>Wz(We,E,S)),oT=new Map;jz(oT,this.driver,ne,S,Yh).forEach(We=>{Wz(We,E,S)&&cu.push(We)});const lE=new Map;B.forEach((We,dt)=>{jz(lE,this.driver,new Set(We),E,"!")}),cu.forEach(We=>{const dt=oT.get(We),bt=lE.get(We);oT.set(We,new Map([...dt?.entries()??[],...bt?.entries()??[]]))});const Y8=[],AK=[],DK={};f.forEach(We=>{const{element:dt,player:bt,instruction:Ln}=We;if(s.has(dt)){if(I.has(dt))return bt.onDestroy(()=>au(dt,Ln.toStyles)),bt.disabled=!0,bt.overrideTotalTime(Ln.totalTime),void c.push(bt);let Eo=DK;if(Rr.size>1){let Qa=dt;const vm=[];for(;Qa=Qa.parentNode;){const rr=Rr.get(Qa);if(rr){Eo=rr;break}vm.push(Qa)}vm.forEach(rr=>Rr.set(rr,Eo))}const lu=this._buildAnimation(bt.namespaceId,Ln,An,u,lE,oT);if(bt.setRealPlayer(lu),Eo===DK)Y8.push(bt);else{const Qa=this.playersByElement.get(Eo);Qa&&Qa.length&&(bt.parentPlayer=fm(Qa)),c.push(bt)}}else tE(dt,Ln.fromStyles),bt.onDestroy(()=>au(dt,Ln.toStyles)),AK.push(bt),I.has(dt)&&c.push(bt)}),AK.forEach(We=>{const dt=u.get(We.element);if(dt&&dt.length){const bt=fm(dt);We.setRealPlayer(bt)}}),c.forEach(We=>{We.parentPlayer?We.syncPlayerEvents(We.parentPlayer):We.destroy()});for(let We=0;We<te.length;We++){const dt=te[We],bt=dt[Gl];if(XC(dt,sU),bt&&bt.hasAnimation)continue;let Ln=[];if(_.size){let lu=_.get(dt);lu&&lu.length&&Ln.push(...lu);let Qa=this.driver.query(dt,G6,!0);for(let vm=0;vm<Qa.length;vm++){let rr=_.get(Qa[vm]);rr&&rr.length&&Ln.push(...rr)}}const Eo=Ln.filter(lu=>!lu.destroyed);Eo.length?VY(this,dt,Eo):this.processLeaveNode(dt)}return te.length=0,Y8.forEach(We=>{this.players.push(We),We.onDone(()=>{We.destroy();const dt=this.players.indexOf(We);this.players.splice(dt,1)}),We.play()}),Y8}afterFlush(i){this._flushFns.push(i)}afterFlushAnimationsDone(i){this._whenQuietFns.push(i)}_getPreviousPlayers(i,t,s,c,u){let f=[];if(t){const _=this.playersByQueriedElement.get(i);_&&(f=_)}else{const _=this.playersByElement.get(i);if(_){const E=!u||u==AO;_.forEach(S=>{S.queued||!E&&S.triggerName!=c||f.push(S)})}}return(s||c)&&(f=f.filter(_=>!(s&&s!=_.namespaceId||c&&c!=_.triggerName))),f}_beforeAnimationBuild(i,t,s){const u=t.element,f=t.isRemovalTransition?void 0:i,_=t.isRemovalTransition?void 0:t.triggerName;for(const E of t.timelines){const S=E.element,I=S!==u,P=Za(s,S,[]);this._getPreviousPlayers(S,I,f,_,t.toState).forEach(B=>{const G=B.getRealPlayer();G.beforeDestroy&&G.beforeDestroy(),B.destroy(),P.push(B)})}tE(u,t.fromStyles)}_buildAnimation(i,t,s,c,u,f){const _=t.triggerName,E=t.element,S=[],I=new Set,P=new Set,U=t.timelines.map(G=>{const K=G.element;I.add(K);const te=K[Gl];if(te&&te.removedBeforeQueried)return new IO(G.duration,G.delay);const ae=K!==E,ne=function BY(e){const i=[];return Gz(e,i),i}((s.get(K)||PY).map(An=>An.getRealPlayer())).filter(An=>!!An.element&&An.element===K),ke=u.get(K),Ge=f.get(K),Ht=yz(this._normalizer,G.keyframes,ke,Ge),cn=this._buildPlayer(G,Ht,ne);if(G.subTimeline&&c&&P.add(K),ae){const An=new i8(i,_,K);An.setRealPlayer(cn),S.push(An)}return cn});S.forEach(G=>{Za(this.playersByQueriedElement,G.element,[]).push(G),G.onDone(()=>function xY(e,i,t){let s=e.get(i);if(s){if(s.length){const c=s.indexOf(t);s.splice(c,1)}0==s.length&&e.delete(i)}return s}(this.playersByQueriedElement,G.element,G))}),I.forEach(G=>xc(G,wz));const B=fm(U);return B.onDestroy(()=>{I.forEach(G=>XC(G,wz)),au(E,t.toStyles)}),P.forEach(G=>{Za(c,G,[]).push(B)}),B}_buildPlayer(i,t,s){return t.length>0?this.driver.animate(i.element,t,i.duration,i.delay,i.easing,s):new IO(i.duration,i.delay)}}class i8{constructor(i,t,s){this.namespaceId=i,this.triggerName=t,this.element=s,this._player=new IO,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(i){this._containsRealPlayer||(this._player=i,this._queuedCallbacks.forEach((t,s)=>{t.forEach(c=>L6(i,s,void 0,c))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(i.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(i){this.totalTime=i}syncPlayerEvents(i){const t=this._player;t.triggerCallback&&i.onStart(()=>t.triggerCallback("start")),i.onDone(()=>this.finish()),i.onDestroy(()=>this.destroy())}_queueEvent(i,t){Za(this._queuedCallbacks,i,[]).push(t)}onDone(i){this.queued&&this._queueEvent("done",i),this._player.onDone(i)}onStart(i){this.queued&&this._queueEvent("start",i),this._player.onStart(i)}onDestroy(i){this.queued&&this._queueEvent("destroy",i),this._player.onDestroy(i)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(i){this.queued||this._player.setPosition(i)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(i){const t=this._player;t.triggerCallback&&t.triggerCallback(i)}}function gU(e){return e&&1===e.nodeType}function Bz(e,i){const t=e.style.display;return e.style.display=i??"none",t}function jz(e,i,t,s,c){const u=[];t.forEach(E=>u.push(Bz(E)));const f=[];s.forEach((E,S)=>{const I=new Map;E.forEach(P=>{const U=i.computeStyle(S,P,c);I.set(P,U),(!U||0==U.length)&&(S[Gl]=MY,f.push(S))}),e.set(S,I)});let _=0;return t.forEach(E=>Bz(E,u[_++])),f}function Hz(e,i){const t=new Map;if(e.forEach(_=>t.set(_,[])),0==i.length)return t;const c=new Set(i),u=new Map;function f(_){if(!_)return 1;let E=u.get(_);if(E)return E;const S=_.parentNode;return E=t.has(S)?S:c.has(S)?1:f(S),u.set(_,E),E}return i.forEach(_=>{const E=f(_);1!==E&&t.get(E).push(_)}),t}function xc(e,i){e.classList?.add(i)}function XC(e,i){e.classList?.remove(i)}function VY(e,i,t){fm(t).onDone(()=>e.processLeaveNode(i))}function Gz(e,i){for(let t=0;t<e.length;t++){const s=e[t];s instanceof vz?Gz(s.players,i):i.push(s)}}function Wz(e,i,t){const s=t.get(e);if(!s)return!1;let c=i.get(e);return c?s.forEach(u=>c.add(u)):i.set(e,s),t.delete(e),!0}class DO{constructor(i,t,s){this._driver=t,this._normalizer=s,this._triggerCache={},this.onRemovalComplete=(c,u)=>{},this._transitionEngine=new LY(i.body,t,s),this._timelineEngine=new RY(i.body,t,s),this._transitionEngine.onRemovalComplete=(c,u)=>this.onRemovalComplete(c,u)}registerTrigger(i,t,s,c,u){const f=i+"-"+c;let _=this._triggerCache[f];if(!_){const E=[],I=Y6(this._driver,u,E,[]);if(E.length)throw function Oq(){return new se(3404,!1)}();_=function CY(e,i,t){return new TY(e,i,t)}(c,I,this._normalizer),this._triggerCache[f]=_}this._transitionEngine.registerTrigger(t,c,_)}register(i,t){this._transitionEngine.register(i,t)}destroy(i,t){this._transitionEngine.destroy(i,t)}onInsert(i,t,s,c){this._transitionEngine.insertNode(i,t,s,c)}onRemove(i,t,s){this._transitionEngine.removeNode(i,t,s)}disableAnimations(i,t){this._transitionEngine.markElementAsDisabled(i,t)}process(i,t,s,c){if("@"==s.charAt(0)){const[u,f]=bz(s);this._timelineEngine.command(u,t,f,c)}else this._transitionEngine.trigger(i,t,s,c)}listen(i,t,s,c,u){if("@"==s.charAt(0)){const[f,_]=bz(s);return this._timelineEngine.listen(f,t,_,u)}return this._transitionEngine.listen(i,t,s,c,u)}flush(i=-1){this._transitionEngine.flush(i)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(i){this._transitionEngine.afterFlushAnimationsDone(i)}}class OO{static{this.initialStylesByElement=new WeakMap}constructor(i,t,s){this._element=i,this._startStyles=t,this._endStyles=s,this._state=0;let c=OO.initialStylesByElement.get(i);c||OO.initialStylesByElement.set(i,c=new Map),this._initialStyles=c}start(){this._state<1&&(this._startStyles&&au(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(au(this._element,this._initialStyles),this._endStyles&&(au(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(OO.initialStylesByElement.delete(this._element),this._startStyles&&(tE(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(tE(this._element,this._endStyles),this._endStyles=null),au(this._element,this._initialStyles),this._state=3)}}function r8(e){let i=null;return e.forEach((t,s)=>{(function GY(e){return"display"===e||"position"===e})(s)&&(i=i||new Map,i.set(s,t))}),i}class zz{constructor(i,t,s,c){this.element=i,this.keyframes=t,this.options=s,this._specialStyles=c,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=s.duration,this._delay=s.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const i=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,i,this.options),this._finalKeyframe=i.length?i[i.length-1]:new Map;const t=()=>this._onFinish();this.domPlayer.addEventListener("finish",t),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",t)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(i){const t=[];return i.forEach(s=>{t.push(Object.fromEntries(s))}),t}_triggerWebAnimation(i,t,s){return i.animate(this._convertKeyframesToObject(t),s)}onStart(i){this._originalOnStartFns.push(i),this._onStartFns.push(i)}onDone(i){this._originalOnDoneFns.push(i),this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(i=>i()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}setPosition(i){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=i*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const i=new Map;this.hasStarted()&&this._finalKeyframe.forEach((s,c)=>{"offset"!==c&&i.set(c,this._finished?s:q6(this.element,c))}),this.currentSnapshot=i}triggerCallback(i){const t="start"===i?this._onStartFns:this._onDoneFns;t.forEach(s=>s()),t.length=0}}class Kz{validateStyleProperty(i){return!0}validateAnimatableStyleProperty(i){return!0}containsElement(i,t){return Cz(i,t)}getParentElement(i){return U6(i)}query(i,t,s){return Tz(i,t,s)}computeStyle(i,t,s){return q6(i,t)}animate(i,t,s,c,u,f=[]){const E={duration:s,delay:c,fill:0==c?"both":"forwards"};u&&(E.easing=u);const S=new Map,I=f.filter(B=>B instanceof zz);(function eY(e,i){return 0===e||0===i})(s,c)&&I.forEach(B=>{B.currentSnapshot.forEach((G,K)=>S.set(K,G))});let P=function Zq(e){return e.length?e[0]instanceof Map?e:e.map(i=>new Map(Object.entries(i))):[]}(t).map(B=>new Map(B));P=function tY(e,i,t){if(t.size&&i.length){let s=i[0],c=[];if(t.forEach((u,f)=>{s.has(f)||c.push(f),s.set(f,u)}),c.length)for(let u=1;u<i.length;u++){let f=i[u];c.forEach(_=>f.set(_,q6(e,_)))}}return i}(i,P,S);const U=function HY(e,i){let t=null,s=null;return Array.isArray(i)&&i.length?(t=r8(i[0]),i.length>1&&(s=r8(i[i.length-1]))):i instanceof Map&&(t=r8(i)),t||s?new OO(e,t,s):null}(i,P);return new zz(i,P,E,U)}}const qz="@.disabled";class Yz{constructor(i,t,s,c){this.namespaceId=i,this.delegate=t,this.engine=s,this._onDestroy=c,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(i){this.delegate.destroyNode?.(i)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(i,t){return this.delegate.createElement(i,t)}createComment(i){return this.delegate.createComment(i)}createText(i){return this.delegate.createText(i)}appendChild(i,t){this.delegate.appendChild(i,t),this.engine.onInsert(this.namespaceId,t,i,!1)}insertBefore(i,t,s,c=!0){this.delegate.insertBefore(i,t,s),this.engine.onInsert(this.namespaceId,t,i,c)}removeChild(i,t,s){this.parentNode(t)&&this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(i,t){return this.delegate.selectRootElement(i,t)}parentNode(i){return this.delegate.parentNode(i)}nextSibling(i){return this.delegate.nextSibling(i)}setAttribute(i,t,s,c){this.delegate.setAttribute(i,t,s,c)}removeAttribute(i,t,s){this.delegate.removeAttribute(i,t,s)}addClass(i,t){this.delegate.addClass(i,t)}removeClass(i,t){this.delegate.removeClass(i,t)}setStyle(i,t,s,c){this.delegate.setStyle(i,t,s,c)}removeStyle(i,t,s){this.delegate.removeStyle(i,t,s)}setProperty(i,t,s){"@"==t.charAt(0)&&t==qz?this.disableAnimations(i,!!s):this.delegate.setProperty(i,t,s)}setValue(i,t){this.delegate.setValue(i,t)}listen(i,t,s){return this.delegate.listen(i,t,s)}disableAnimations(i,t){this.engine.disableAnimations(i,t)}}class WY extends Yz{constructor(i,t,s,c,u){super(t,s,c,u),this.factory=i,this.namespaceId=t}setProperty(i,t,s){"@"==t.charAt(0)?"."==t.charAt(1)&&t==qz?this.disableAnimations(i,s=void 0===s||!!s):this.engine.process(this.namespaceId,i,t.slice(1),s):this.delegate.setProperty(i,t,s)}listen(i,t,s){if("@"==t.charAt(0)){const c=function zY(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(i);let u=t.slice(1),f="";return"@"!=u.charAt(0)&&([u,f]=function KY(e){const i=e.indexOf(".");return[e.substring(0,i),e.slice(i+1)]}(u)),this.engine.listen(this.namespaceId,c,u,f,_=>{this.factory.scheduleListenerCallback(_._data||-1,s,_)})}return this.delegate.listen(i,t,s)}}class qY{constructor(i,t,s){this.delegate=i,this.engine=t,this._zone=s,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,t.onRemovalComplete=(c,u)=>{u?.removeChild(null,c)}}createRenderer(i,t){const c=this.delegate.createRenderer(i,t);if(!i||!t?.data?.animation){const S=this._rendererCache;let I=S.get(c);return I||(I=new Yz("",c,this.engine,()=>S.delete(c)),S.set(c,I)),I}const u=t.id,f=t.id+"-"+this._currentId;this._currentId++,this.engine.register(f,i);const _=S=>{Array.isArray(S)?S.forEach(_):this.engine.registerTrigger(u,f,i,S.name,S)};return t.data.animation.forEach(_),new WY(this,f,c,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(i,t,s){if(i>=0&&i<this._microtaskId)return void this._zone.run(()=>t(s));const c=this._animationCallbacksBuffer;0==c.length&&queueMicrotask(()=>{this._zone.run(()=>{c.forEach(u=>{const[f,_]=u;f(_)}),this._animationCallbacksBuffer=[]})}),c.push([t,s])}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}const ZY=[{provide:B6,useFactory:()=>new Kz},{provide:tl,useValue:"BrowserAnimations"},...[{provide:j6,useFactory:function $Y(){return new Dz}},{provide:DO,useClass:(()=>{class e extends DO{constructor(t,s,c){super(t,s,c)}ngOnDestroy(){this.flush()}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve),ye(B6),ye(j6))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})()},{provide:Tb,useFactory:function XY(e,i,t){return new qY(e,i,t)},deps:[mC,DO,ft]}]];class e$ extends Ri{constructor(i,t){super()}schedule(i,t=0){return this}}const vU={setInterval(e,i,...t){const{delegate:s}=vU;return s?.setInterval?s.setInterval(e,i,...t):setInterval(e,i,...t)},clearInterval(e){const{delegate:i}=vU;return(i?.clearInterval||clearInterval)(e)},delegate:void 0};class o8 extends e${constructor(i,t){super(i,t),this.scheduler=i,this.work=t,this.pending=!1}schedule(i,t=0){var s;if(this.closed)return this;this.state=i;const c=this.id,u=this.scheduler;return null!=c&&(this.id=this.recycleAsyncId(u,c,t)),this.pending=!0,this.delay=t,this.id=null!==(s=this.id)&&void 0!==s?s:this.requestAsyncId(u,this.id,t),this}requestAsyncId(i,t,s=0){return vU.setInterval(i.flush.bind(i,this),s)}recycleAsyncId(i,t,s=0){if(null!=s&&this.delay===s&&!1===this.pending)return t;null!=t&&vU.clearInterval(t)}execute(i,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const s=this._execute(i,t);if(s)return s;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(i,t){let c,s=!1;try{this.work(i)}catch(u){s=!0,c=u||new Error("Scheduled action threw falsy error")}if(s)return this.unsubscribe(),c}unsubscribe(){if(!this.closed){const{id:i,scheduler:t}=this,{actions:s}=t;this.work=this.state=this.scheduler=null,this.pending=!1,yE(s,this),null!=i&&(this.id=this.recycleAsyncId(t,i,null)),this.delay=null,super.unsubscribe()}}}const s8={now:()=>(s8.delegate||Date).now(),delegate:void 0};class NO{constructor(i,t=NO.now){this.schedulerActionCtor=i,this.now=t}schedule(i,t=0,s){return new this.schedulerActionCtor(this,i).schedule(s,t)}}NO.now=s8.now;class a8 extends NO{constructor(i,t=NO.now){super(i,t),this.actions=[],this._active=!1}flush(i){const{actions:t}=this;if(this._active)return void t.push(i);let s;this._active=!0;do{if(s=i.execute(i.state,i.delay))break}while(i=t.shift());if(this._active=!1,s){for(;i=t.shift();)i.unsubscribe();throw s}}}const PO=new a8(o8),t$=PO;function EU(e=0,i,t=t$){let s=-1;return null!=i&&(ZD(i)?t=i:s=i),new ni(c=>{let u=function n$(e){return e instanceof Date&&!isNaN(e)}(e)?+e-t.now():e;u<0&&(u=0);let f=0;return t.schedule(function(){c.closed||(c.next(f++),0<=s?this.schedule(void 0,s):c.complete())},u)})}function c8(e=0,i=PO){return e<0&&(e=0),EU(e,e,i)}function Xz(e,i){return i?t=>oa(i.pipe(nr(1),function i$(){return yi((e,i)=>{e.subscribe(ui(i,tp))})}()),t.pipe(Xz(e))):Yr((t,s)=>qr(e(t,s)).pipe(nr(1),Zd(t)))}var o$=hE(827);function s$(e,i){if(1&e){const t=yc();Se(0,"div",1)(1,"button",2),Mn("click",function(){return Zo(t),oo(Sn().onToggleFullScreen())}),Se(2,"div",3),va(),Se(3,"svg",4)(4,"g",25)(5,"g",6)(6,"g",7)(7,"g",11),At(8,"path",26)(9,"path",27)(10,"path",28)(11,"path",29),Be()()()(),Se(12,"g",30)(13,"g",6)(14,"g",31)(15,"g",7),At(16,"path",32)(17,"path",33)(18,"path",34)(19,"path",35),Be()()()()()(),Ea(),Se(20,"p"),fn(21),Be()()()}if(2&e){const t=Sn();Ze(),nt("controls__button--active",t.fullScreenEnabled),Ze(3),nt("controls__icon--shown",!t.fullScreenEnabled),Ze(8),nt("controls__icon--shown",t.fullScreenEnabled),Ze(9),at(t.fullScreenEnabled?"Exit fullscreen":"Fullscreen")}}function a$(e,i){if(1&e){const t=yc();Se(0,"div",1)(1,"button",36),Mn("click",function(){return Zo(t),oo(Sn().onToggleSmallScreen())}),Se(2,"div",3),va(),Se(3,"svg",4)(4,"g",37),At(5,"path",38),Be(),Se(6,"defs")(7,"filter",39),At(8,"feFlood",40)(9,"feColorMatrix",41)(10,"feOffset",42)(11,"feGaussianBlur",43)(12,"feComposite",44)(13,"feColorMatrix",45)(14,"feBlend",46)(15,"feBlend",47),Be()()()(),Ea(),Se(16,"p"),fn(17,"Minimize"),Be()()()}if(2&e){const t=Sn();Ze(),nt("controls__button--active",t.smallScreenEnabled)}}const c$=(e,i,t,s)=>({"spinner--connected":e,"spinner--ended":i,"spinner--small":t,"spinner--error":s});function l$(e,i){if(1&e&&(Se(0,"div",7),fn(1),Be()),2&e){const t=Sn();Ze(),at(t.text)}}function d$(e,i){1&e&&fn(0),2&e&&gi(" Calling to ",Sn(2).data.user.name," ")}function u$(e,i){1&e&&fn(0),2&e&&gi(" ",Sn(2).data.user.name," is calling ")}function h$(e,i){if(1&e){const t=yc();Se(0,"button",9),Mn("click",function(){return Zo(t),oo(Sn(2).onAcceptCall())}),Be()}}function p$(e,i){if(1&e){const t=yc();Se(0,"div",1)(1,"div",2)(2,"div",3),At(3,"img",4),Be(),Se(4,"p",5),Si(5,d$,1,1)(6,u$,1,1),Be()(),Se(7,"div",6),Si(8,h$,1,0,"button",7),Se(9,"span")(10,"button",8),Mn("click",function(){return Zo(t),oo(Sn().onDeclineCall())}),Be()()()()}if(2&e){const t=Sn();nt("video-call--full-screen",t.fullScreen),$e("@fade",void 0),Ze(3),$e("src",t.data.user.photoURL,pI),Ze(2),st(t.data.outcome?5:6),Ze(3),st(t.data.outcome?-1:8)}}function f$(e,i){if(1&e&&At(0,"ngx-spinner",15),2&e){const t=Sn().ngIf,s=Sn(2);$e("error",t.error)("text",t.statusText)("connected",t.connected)("ended",t.ended)("small",s.smallScreenEnabled)}}function m$(e,i){1&e&&At(0,"ngx-timer",16),2&e&&$e("started",Sn().ngIf.started)}function g$(e,i){if(1&e&&(At(0,"div",17),Mr(1,"async")),2&e){const t=i.$implicit;nt("hidden",!1===L_(1,3,Sn(3).remoteStreamVideoToggle$)),$e("id",t)}}function _$(e,i){if(1&e){const t=yc();Se(0,"ngx-controls",18),Mn("toggleCamera",function(c){return Zo(t),oo(Sn(3).onToggleCamera(c))})("toggleMicrophone",function(c){return Zo(t),oo(Sn(3).onToggleMicrophone(c))})("toggleFullScreen",function(c){return Zo(t),oo(Sn(3).onToggleFullScreen(c))})("toggleSmallScreen",function(c){return Zo(t),oo(Sn(3).onToggleSmallScreen(c))})("endCall",function(){return Zo(t),oo(Sn(3).onEndCall())}),Be()}if(2&e){const t=Sn(3);$e("cameraEnabled",t.cameraEnabled)("microphoneEnabled",t.microphoneEnabled)("fullScreenEnabled",t.fullScreenEnabled)("smallScreenEnabled",t.smallScreenEnabled)("displaySmallScreen",t.displaySmallScreen)}}function v$(e,i){if(1&e&&(Se(0,"div",2),Si(1,f$,1,5,"ngx-spinner",3)(2,m$,1,1,"ngx-timer",4),At(3,"div",5),function dR(e,i,t,s,c,u,f,_,E,S,I,P,U){jr("NgControlFlow");const B=ue(),G=Bt(),K=void 0!==E,te=ue(),ae=_?f.bind(te[hi][ri]):f,ne=new nS(K,ae);te[He+e]=ne,e_(B,G,e+1,i,t,s,c,Vr(G.consts,u)),K&&e_(B,G,e+2,E,S,I,P,Vr(G.consts,U))}(4,g$,2,5,"div",6,Rt),Se(6,"div",7),va(),Se(7,"svg",8)(8,"g",9),At(9,"path",10)(10,"path",11),Be(),Se(11,"defs")(12,"clipPath",12),At(13,"rect",13),Be()()()(),Si(14,_$,1,5,"ngx-controls",14),Be()),2&e){const t=i.ngIf,s=Sn(2);Ze(),$e("ngIf",t.loading),Ze(),$e("ngIf",t.started),Ze(),nt("hidden",!s.cameraEnabled||s.smallScreenEnabled),$e("id",s.localContainerId),Ze(),function co(e){const i=gt(null),t=Br();try{const s=ue(),c=s[Ie],u=s[t],f=t+1,_=ml(s,f);if(void 0===u.liveCollection){const S=Do(c,f);u.liveCollection=new Hi(_,s,S)}else u.liveCollection.reset();const E=u.liveCollection;if(function cR(e,i,t){let s,c,u=0,f=e.length-1;if(Array.isArray(i)){let E=i.length-1;for(;u<=f&&u<=E;){const S=e.at(u),I=i[u],P=v_(u,S,u,I,t);if(0!==P){P<0&&e.updateValue(u,I),u++;continue}const U=e.at(f),B=i[E],G=v_(f,U,E,B,t);if(0!==G){G<0&&e.updateValue(f,B),f--,E--;continue}const K=t(u,S),te=t(f,U),ae=t(u,I);if(Object.is(ae,te)){const ne=t(E,B);Object.is(ne,K)?(e.swap(u,f),e.updateValue(f,B),E--,f--):e.move(f,u),e.updateValue(u,I),u++}else if(s??=new Yn,c??=lR(e,u,f,t),nn(e,s,u,ae))e.updateValue(u,I),u++,f++;else if(c.has(ae))s.set(K,e.detach(u)),f--;else{const ne=e.create(u,i[u]);e.attach(u,ne),u++,f++}}for(;u<=E;)Sf(e,s,t,u,i[u]),u++}else if(null!=i){const E=i[Symbol.iterator]();let S=E.next();for(;!S.done&&u<=f;){const I=e.at(u),P=S.value,U=v_(u,I,u,P,t);if(0!==U)U<0&&e.updateValue(u,P),u++,S=E.next();else{s??=new Yn,c??=lR(e,u,f,t);const B=t(u,P);if(nn(e,s,u,B))e.updateValue(u,P),u++,f++,S=E.next();else if(c.has(B)){const G=t(u,I);s.set(G,e.detach(u)),f--}else e.attach(u,e.create(u,P)),u++,f++,S=E.next()}}for(;!S.done;)Sf(e,s,t,e.length,S.value),S=E.next()}for(;u<=f;)e.destroy(e.detach(f--));s?.forEach(E=>{e.destroy(E)})}(E,e,u.trackByFn),E.updateIndexes(),u.hasEmptyBlock){const S=_a(),I=0===E.length;if($i(s,S,I)){const P=t+2,U=ml(s,P);if(I){const B=Do(c,P),G=Ia(U,B.tView.ssrId);ju(U,ce(s,B,void 0,{dehydratedView:G}),0,pd(B,G))}else wg(U,0)}}}finally{gt(i)}}(s.remoteCalls),Ze(10),$e("ngIf",t.connected&&!t.ended)}}function E$(e,i){if(1&e&&(Se(0,"div"),Si(1,v$,15,6,"div",1),Mr(2,"async"),Be()),2&e){const t=Sn();$e("@fade",void 0)("@.disabled",!t.animate),Ze(),$e("ngIf",L_(2,3,t.streamState$))}}class Zz{constructor(i){this.cdr=i,this.afterClosed=new Mt,this.shown=!0}closeDialog(i){this.onAfterClosed(i)}onAfterClosed(i){this.shown=!1,this.cdr.markForCheck(),this.afterClosed.next(i)}}let y$=(()=>{class e{constructor(){this.cameraEnabled=!0,this.microphoneEnabled=!0,this.fullScreenEnabled=!1,this.smallScreenEnabled=!1,this.displaySmallScreen=!1,this.toggleCamera=new Dn,this.toggleMicrophone=new Dn,this.toggleFullScreen=new Dn,this.toggleSmallScreen=new Dn,this.endCall=new Dn}onToggleCamera(){this.toggleCamera.emit(this.cameraEnabled)}onToggleMicrophone(){this.toggleMicrophone.emit(this.microphoneEnabled)}onToggleFullScreen(){this.toggleFullScreen.emit(this.fullScreenEnabled)}onToggleSmallScreen(){this.toggleSmallScreen.emit(this.smallScreenEnabled)}onEndCall(){this.endCall.emit()}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=no({type:e,selectors:[["ngx-controls"]],inputs:{cameraEnabled:"cameraEnabled",microphoneEnabled:"microphoneEnabled",fullScreenEnabled:"fullScreenEnabled",smallScreenEnabled:"smallScreenEnabled",displaySmallScreen:"displaySmallScreen"},outputs:{toggleCamera:"toggleCamera",toggleMicrophone:"toggleMicrophone",toggleFullScreen:"toggleFullScreen",toggleSmallScreen:"toggleSmallScreen",endCall:"endCall"},standalone:!0,features:[fo],decls:43,vars:16,consts:[[1,"controls"],[1,"controls__item"],[1,"controls__button",3,"click"],[1,"controls__icon-wrapper"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","video-camera",1,"controls__icon"],["id","Group"],["id","Group_2"],["id","Vector","d","M63.4134 16.2294C63.0454 15.9814 62.5787 15.928 62.1707 16.096L50.6668 20.6986V20C50.6668 16.3226 47.6748 13.3334 44.0001 13.3334H6.66663C2.992 13.3334 0 16.3226 0 20V44C0 47.6774 2.992 50.6666 6.66663 50.6666H44C47.6746 50.6666 50.6666 47.6772 50.6666 44V43.3014L62.1706 47.904C62.5812 48.072 63.048 48.0186 63.4132 47.7706C63.7786 47.5226 63.9999 47.1093 63.9999 46.6666V17.3334C64 16.8906 63.7786 16.4774 63.4134 16.2294Z","fill","white"],["id","no-camera",1,"controls__icon"],["id","Vector","d","M44.0002 13.3325H6.66735C2.99276 13.3325 0.000793457 16.3218 0.000793457 19.999V43.9988C0.000793457 47.6761 2.99276 50.6654 6.66735 50.6654H7.67797L44.9176 13.4257C44.6162 13.3832 44.315 13.3325 44.0002 13.3325Z","fill","white"],["id","Group_3"],["id","Group_4"],["id","Vector_2","d","M63.4134 16.2285C63.0454 15.9805 62.5788 15.9271 62.1708 16.0951L50.6669 20.6977V19.9991C50.6669 18.6417 50.2535 17.3831 49.5549 16.3297L63.608 2.2766C64.128 1.75661 64.128 0.911242 63.608 0.391247C63.088 -0.128748 62.2426 -0.128748 61.7226 0.391247L0.389996 61.724C-0.129999 62.244 -0.129999 63.0894 0.389996 63.6094C0.651369 63.868 0.992615 63.9988 1.33399 63.9988C1.67536 63.9988 2.01661 63.8681 2.27798 63.6094L15.2192 50.6655H44.0003C47.6749 50.6655 50.6669 47.6762 50.6669 43.9989V43.3003L62.1708 47.9029C62.5814 48.0709 63.0481 48.0175 63.4134 47.7695C63.7788 47.5215 64 47.1082 64 46.6655V17.3325C64 16.8898 63.7788 16.4765 63.4134 16.2285Z","fill","white"],["id","microphone",1,"controls__icon"],["id","Vector"],["fill-rule","evenodd","clip-rule","evenodd","d","M44.3474 12.1407L44.3468 17.2309V33.8672C44.3468 40.6024 38.9004 46.0823 32.206 46.0823C27.8366 46.0787 23.8059 43.7286 21.6503 39.9279L20.4131 36.8161C20.1824 35.875 20.0659 34.9098 20.0659 33.941V12.1407C20.0659 5.43551 25.5014 0 32.2066 0C38.9118 0 44.3474 5.43551 44.3474 12.1407Z","fill","white"],["fill-rule","evenodd","clip-rule","evenodd","d","M15.0971 33.7512C15.0947 36.1345 15.5932 38.4912 16.5596 40.6697L18.1223 43.4553C22.3699 49.6259 30.1387 52.3143 37.292 50.089C44.4453 47.8638 49.318 41.2426 49.3156 33.7518C49.3156 32.9026 50.0039 32.2143 50.8532 32.2143C51.7018 32.2143 52.3907 32.9026 52.3907 33.7518C52.4051 44.4499 44.0585 53.2951 33.3778 53.9017V60.9246H39.8098C40.6584 60.9246 41.3473 61.6135 41.3473 62.4622C41.3473 63.3114 40.6584 63.9997 39.8098 63.9997H24.6029C23.7537 63.9997 23.0654 63.3114 23.0654 62.4622C23.0654 61.6135 23.7537 60.9246 24.6029 60.9246H30.3033V53.847C25.6228 53.4212 21.2413 51.3623 17.926 48.0313C17.1926 47.298 16.5163 46.51 15.9031 45.6739L14.2418 42.9874C12.7757 40.1297 12.0148 36.9633 12.022 33.7512C12.022 32.902 12.7103 32.2137 13.5595 32.2137C14.4088 32.2137 15.0971 32.902 15.0971 33.7512Z","fill","white"],["id","no-microphone",1,"controls__icon"],["id","Vector","d","M52.9733 4.25592L44.3474 12.8813V12.1407C44.3474 5.43551 38.9118 0 32.2066 0C25.5014 0 20.0659 5.43551 20.0659 12.1407V33.941C20.0659 34.9098 20.1824 35.875 20.4131 36.8161L16.5596 40.6697C15.5932 38.4912 15.0947 36.1345 15.0971 33.7512C15.0971 32.902 14.4088 32.2137 13.5595 32.2137C12.7103 32.2137 12.022 32.902 12.022 33.7512C12.0148 36.9633 12.7757 40.1297 14.2418 42.9874L8.81411 48.4151C8.4117 48.8007 8.24954 49.3731 8.39008 49.9124C8.53002 50.4518 8.95105 50.8728 9.4898 51.0133C10.0291 51.1539 10.6021 50.9917 10.9877 50.5899L15.9031 45.6739C16.5163 46.51 17.1926 47.298 17.926 48.0313C21.2413 51.3623 25.6228 53.4212 30.3033 53.847V60.9246H24.6029C23.7537 60.9246 23.0654 61.6135 23.0654 62.4622C23.0654 63.3114 23.7537 63.9997 24.6029 63.9997H39.8098C40.6584 63.9997 41.3473 63.3114 41.3473 62.4622C41.3473 61.6135 40.6584 60.9246 39.8098 60.9246H33.3778V53.9017C44.0585 53.2951 52.4051 44.4499 52.3907 33.7518C52.3907 32.9026 51.7018 32.2143 50.8532 32.2143C50.0039 32.2143 49.3156 32.9026 49.3156 33.7518C49.318 41.2426 44.4453 47.8638 37.292 50.089C30.1387 52.3143 22.3699 49.6259 18.1224 43.4553L21.6503 39.9279C23.8059 43.7286 27.8366 46.0787 32.206 46.0823C38.9004 46.0823 44.3468 40.6024 44.3468 33.8672V17.2309L55.1475 6.43072C55.7481 5.83071 55.7481 4.85713 55.1475 4.25652C54.5469 3.65591 53.5733 3.65591 52.9733 4.25652V4.25592Z","fill","white"],[1,"controls__button","controls__button--danger",3,"click"],["id","phone"],["id","Vector","d","M51.7097 13.2478C51.2458 12.7839 50.4959 12.7839 50.032 13.2478L1.38351 61.8963C0.919568 62.3602 0.919568 63.1101 1.38351 63.574C1.61488 63.8054 1.91864 63.9217 2.2224 63.9217C2.52615 63.9217 2.82991 63.8054 3.06129 63.574L51.7097 14.9256C52.1737 14.4628 52.1737 13.7117 51.7097 13.2478Z","fill","white"],["id","Vector_2","d","M16.9605 42.9635L26.1159 33.8081L21.3365 29.0287C18.91 26.6022 18.6869 24.3679 20.5878 21.5629C20.8535 21.1951 22.5444 19.6941 23.992 18.4839C24.9151 17.9333 25.5487 17.1181 25.8264 16.1155C26.1954 14.783 25.9225 13.2156 25.0516 11.6885C24.8463 11.3373 19.9625 3.06229 15.4583 0.680892C14.6171 0.235937 13.6714 0.0010004 12.721 0.0010004C11.1571 0.0010004 9.68576 0.610886 8.58109 1.71556L5.57082 4.72702C-3.21082 13.5098 -1.58525 24.419 10.2719 36.2749L16.9605 42.9635Z","fill","white"],["id","Vector_3","d","M63.313 48.5357C60.9304 44.0328 52.6566 39.1478 52.2923 38.9342C51.2304 38.329 50.1209 38.0099 49.0839 38.0099C47.5402 38.0099 46.2753 38.717 45.51 40.0033C44.2986 41.452 42.7964 43.1429 42.4345 43.4051C39.6129 45.3154 37.4071 45.1007 34.9652 42.6588L31.148 38.8416L21.9926 47.997L27.7189 53.7233C34.5356 60.5412 41.0367 63.9976 47.0371 63.9976C47.0383 63.9976 47.0383 63.9976 47.0383 63.9976C51.4534 63.9976 55.5672 62.1217 59.2669 58.4232L62.2771 55.413C64.1068 53.5845 64.5233 50.821 63.313 48.5357Z","fill","white"],["id","fullscreen",1,"controls__icon"],["id","Vector","d","M57.8018 53.4382L44.3964 40.0328L40.0328 44.3964L53.4382 57.8018H43.0205V64H64V43.0205H57.8018V53.4382Z","fill","white"],["id","Vector_2","d","M44.3964 23.9803L57.8018 10.5618V20.9795H64V0H43.0205V6.1982H53.4382L40.0328 19.6036L44.3964 23.9803Z","fill","white"],["id","Vector_3","d","M19.6036 40.0328L6.1982 53.4382V43.0205H0V64H20.9795V57.8018H10.5618L23.9803 44.3964L19.6036 40.0328Z","fill","white"],["id","Vector_4","d","M20.9795 6.1982V0H0V20.9795H6.1982V10.5618L19.6036 23.9803L23.9803 19.6036L10.5618 6.1982H20.9795Z","fill","white"],["id","exit-full-screen",1,"controls__icon"],["id","fullscreen_x5F_exit"],["id","Vector","d","M49.172 54.828L58.344 64L64 58.344L54.828 49.172L64 40H40V64L49.172 54.828Z","fill","white"],["id","Vector_2","d","M0 24H24V0L14.828 9.172L5.75 0.086L0.094 5.742L9.172 14.828L0 24Z","fill","white"],["id","Vector_3","d","M0 58.344L5.656 64L14.828 54.828L24 64V40H0L9.172 49.172L0 58.344Z","fill","white"],["id","Vector_4","d","M40 24H64L54.828 14.828L63.922 5.742L58.266 0.086L49.172 9.172L40 0V24Z","fill","white"],[1,"controls__button","controls__button--rotate",3,"click"],["filter","url(#filter0_d_0_4)"],["d","M-4.81762e-07 34.7678V57.0215C-4.81762e-07 60.8696 3.13284 64 6.98275 64H57.016C60.8672 64 64 60.8696 64 57.0215V7.05508C64 3.20697 60.8672 0.0757321 57.016 0.0757321H34.6959C35.8972 1.3077 36.6961 2.93443 36.871 4.74067H57.0168C58.2942 4.74067 59.3335 5.77899 59.3335 7.05508V57.0216C59.3335 58.2969 58.2942 59.3352 57.0168 59.3352H6.98342C5.7062 59.3352 4.66761 58.2969 4.66761 57.0216V36.9389C2.90982 36.7703 1.27948 36.0149 -4.81762e-07 34.7678ZM10.7807 30.6654H26.0384L1.34093 5.97437C-0.02533 4.60686 -0.02533 2.39174 1.34093 1.02583C2.70813 -0.341677 4.92462 -0.341677 6.29089 1.02423L30.9883 25.7159V10.4614C30.9883 8.52907 32.5556 6.96139 34.4888 6.96139C35.4553 6.96139 36.3305 7.35214 36.9642 7.98612C37.5976 8.62116 37.9897 9.49543 37.9897 10.4613V34.1643C37.9897 36.0966 36.4228 37.6635 34.4896 37.6635H10.7807C8.84705 37.6635 7.28056 36.0974 7.28056 34.1643C7.28056 32.2312 8.84705 30.6654 10.7807 30.6654Z","fill","white"],["id","filter0_d_0_4","x","-4","y","0","width","72","height","72","filterUnits","userSpaceOnUse","color-interpolation-filters","sRGB"],["flood-opacity","0","result","BackgroundImageFix"],["in","SourceAlpha","type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0","result","hardAlpha"],["dy","4"],["stdDeviation","2"],["in2","hardAlpha","operator","out"],["type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"],["mode","normal","in2","BackgroundImageFix","result","effect1_dropShadow_0_4"],["mode","normal","in","SourceGraphic","in2","effect1_dropShadow_0_4","result","shape"]],template:function(s,c){1&s&&(Se(0,"div",0)(1,"div",1)(2,"button",2),Mn("click",function(){return c.onToggleCamera()}),Se(3,"div",3),va(),Se(4,"svg",4)(5,"g",5)(6,"g",6)(7,"g",7),At(8,"path",8),Be()()(),Se(9,"g",9)(10,"g",6)(11,"g",7),At(12,"path",10),Be()(),Se(13,"g",11)(14,"g",12),At(15,"path",13),Be()()()()(),Ea(),Se(16,"p"),fn(17,"Camera"),Be()()(),Se(18,"div",1)(19,"button",2),Mn("click",function(){return c.onToggleMicrophone()}),Se(20,"div",3),va(),Se(21,"svg",4)(22,"g",14)(23,"g",15),At(24,"path",16)(25,"path",17),Be()(),Se(26,"g",18),At(27,"path",19),Be()()(),Ea(),Se(28,"p"),fn(29,"Mic"),Be()()(),Si(30,s$,22,7,"div",1)(31,a$,18,2,"div",1),Se(32,"div",1)(33,"button",20),Mn("click",function(){return c.onEndCall()}),Se(34,"div",3),va(),Se(35,"svg",4)(36,"g",21)(37,"g",6),At(38,"path",22)(39,"path",23)(40,"path",24),Be()()()(),Ea(),Se(41,"p"),fn(42,"End"),Be()()()()),2&s&&(nt("controls--small",c.smallScreenEnabled),Ze(2),nt("controls__button--active",c.cameraEnabled),Ze(3),nt("controls__icon--shown",c.cameraEnabled),Ze(4),nt("controls__icon--shown",!c.cameraEnabled),Ze(10),nt("controls__button--active",c.microphoneEnabled),Ze(3),nt("controls__icon--shown",c.microphoneEnabled),Ze(4),nt("controls__icon--shown",!c.microphoneEnabled),Ze(4),st(c.smallScreenEnabled?-1:30),Ze(),st(c.displaySmallScreen?31:-1))},styles:["[_nghost-%COMP%]{transition:.3s}.controls[_ngcontent-%COMP%]{background:#0000004d;bottom:0;display:flex;justify-content:center;padding:15px 0;position:absolute;left:0;width:100%}.controls--small[_ngcontent-%COMP%]{border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding:5px 0}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{height:32px;width:32px}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:16px;width:16px}.controls--small[_ngcontent-%COMP%]   .controls__item[_ngcontent-%COMP%]{margin:0}.controls--small[_ngcontent-%COMP%]   .controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:none}.controls__item[_ngcontent-%COMP%]{margin:0 5px;text-align:center}.controls__button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer}.controls__button[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#101316}.controls__button--active[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#0b73c9}.controls__button--active[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#158ef2}.controls__button--active.controls__button--rotate[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transform:translate(-50%,-50%) rotate(-180deg)}.controls__button--danger[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#d73b3d}.controls__button--danger[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#e06567}.controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;margin:8px 0 0}.controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#313a42;border-radius:50%;box-shadow:0 3px 8px #00000080;margin:auto;position:relative;height:60px;width:60px;transition:.3s}.controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%) rotate(0);height:32px;width:32px;transition:.3s}.controls__icon[_ngcontent-%COMP%]{opacity:0;transition:.3s}.controls__icon--shown[_ngcontent-%COMP%]{opacity:1}"],changeDetection:0})}}return e})(),b$=(()=>{class e{constructor(){this.error=!1,this.connected=!0,this.ended=!1,this.small=!1}get color(){return this.ended?"#aaa":this.error?"#d73b3d":this.connected?"#37D425":"#1195E6"}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=no({type:e,selectors:[["ngx-spinner"]],inputs:{text:"text",error:"error",connected:"connected",ended:"ended",small:"small"},standalone:!0,features:[fo],decls:8,vars:9,consts:[[1,"spinner",3,"ngClass"],[1,"spinner__wrapper"],[1,"spinner__icon"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 32 32","fill","none"],["d","M5.25 5.5C3.45507 5.5 2 6.95508 2 8.75V19.25C2 21.0449 3.45507 22.5 5.25 22.5H14.75C16.5449 22.5 18 21.0449 18 19.25V8.75C18 6.95507 16.5449 5.5 14.75 5.5H5.25Z"],["d","M23.1232 20.6431L19.5 17.0935V10.9989L23.1121 7.3706C23.8988 6.58044 25.248 7.13753 25.248 8.25251V19.7502C25.248 20.8577 23.9143 21.4181 23.1232 20.6431Z"],[1,"spinner__cirle"],[1,"spinner__text"]],template:function(s,c){1&s&&(Se(0,"div",0)(1,"div",1)(2,"div",2),va(),Se(3,"svg",3),At(4,"path",4)(5,"path",5),Be()(),Ea(),At(6,"div",6),Si(7,l$,2,1,"div",7),Be()()),2&s&&($e("ngClass",SL(4,c$,c.connected,c.ended,c.small,c.error)),Ze(4),Ji("fill",c.color),Ze(),Ji("fill",c.color),Ze(2),st(c.small?-1:7))},dependencies:[mv],styles:[".spinner[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;position:relative;transition:.3s}.spinner--connected[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#37d425}.spinner--ended[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:transparent}.spinner--error[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#d73b3d}.spinner--small[_ngcontent-%COMP%]{border-radius:10px;height:200px}.spinner--small[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-width:4px;height:80px;width:80px}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]{top:26px;transform:translate(-35%)}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.spinner__wrapper[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}.spinner__cirle[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 2s linear infinite;border:5px solid #1195E6;border-radius:50%;border-top-color:transparent;height:160px;margin:auto;width:160px;transition:.3s}.spinner__icon[_ngcontent-%COMP%]{left:50%;position:absolute;top:52px;transform:translate(-40%);transition:.3s}.spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px;transition:.3s}.spinner__text[_ngcontent-%COMP%]{color:#fff;font-size:1.3em;margin-top:25px;text-align:center}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"],changeDetection:0})}}return e})(),S$=(()=>{class e{constructor(){this.started=Date.now()}ngOnInit(){this.time$=EU(0,1e3).pipe(Jt(()=>this.format(Date.now()-this.started)))}format(t){const s=Math.floor(t/1e3%60).toString().padStart(2,"0"),c=Math.floor(t/6e4%60).toString().padStart(2,"0");return[Math.floor(t/36e5%24).toString().padStart(2,"0"),c,s].join(":")}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=no({type:e,selectors:[["ngx-timer"]],inputs:{started:"started"},standalone:!0,features:[fo],decls:4,vars:3,consts:[[1,"timer"]],template:function(s,c){1&s&&(Se(0,"div",0)(1,"span"),fn(2),Mr(3,"async"),Be()()),2&s&&(Ze(2),at(L_(3,1,c.time$)))},dependencies:[hD],styles:[".timer[_ngcontent-%COMP%]{color:#fff;position:relative;text-align:center;z-index:1}.timer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#0000004d;border-radius:5px;padding:5px 10px}"],changeDetection:0})}}return e})();const yU_HIDDEN={opacity:0,"margin-top":"100%"},yU_SHOWN={opacity:1,"margin-top":0},Jz=P6("fade",[TO(":enter",[su(yU_HIDDEN),CO("250ms ease-in-out",su(yU_SHOWN))]),TO(":leave",[su(yU_SHOWN),CO("250ms ease-in-out",su(yU_HIDDEN))])]);let C$=(()=>{class e extends Zz{constructor(t){super(t),this.fullScreen=!1}ngOnInit(){this.play(`assets/${this.data.outcome?"outcome":"income"}.mp3`)}ngOnDestroy(){this.stop()}onAcceptCall(){this.fullScreen=!0,this.cdr.markForCheck(),this.afterClosed.next(this.data)}onDeclineCall(){this.play("assets/cancel.mp3"),setTimeout(()=>this.closeDialog(null),200)}play(t,s=!0){this.audio&&this.stop(),this.audio=new Audio(t),this.audio.loop=s,this.audio.load(),this.audio.play()}stop(){this.audio.pause(),this.audio.remove()}static{this.\u0275fac=function(s){return new(s||e)(re(Js))}}static{this.\u0275cmp=no({type:e,selectors:[["ngx-video-call"]],inputs:{data:"data"},standalone:!0,features:[tn,fo],decls:1,vars:1,consts:[["class","video-call",3,"video-call--full-screen",4,"ngIf"],[1,"video-call"],[1,"video-call-user"],[1,"video-call-user__block","video-call-user__block--animated"],["alt","",1,"video-call-user__img",3,"src"],[1,"video-call-user__title"],[1,"video-call__actions"],["aria-label","Accept",1,"video-call__button","video-call__button--accept"],["aria-label","Decline",1,"video-call__button","video-call__button--decline",3,"click"],["aria-label","Accept",1,"video-call__button","video-call__button--accept",3,"click"]],template:function(s,c){1&s&&Si(0,p$,11,6,"div",0),2&s&&$e("ngIf",c.shown&&c.data)},dependencies:[QS],styles:['[_nghost-%COMP%]{display:block;height:100vh;position:relative}.video-call[_ngcontent-%COMP%]{background-image:linear-gradient(#3f51b5,#313a42);background-size:cover;border-radius:10px;box-shadow:0 5px 10px #0000001a;display:flex;flex-direction:column;height:100%;justify-content:flex-end;left:50%;max-height:400px;max-width:400px;position:absolute;top:50%;transform:translate(-50%,-50%);width:100%;z-index:5;transition:.3s}.video-call--full-screen[_ngcontent-%COMP%]{background-image:linear-gradient(#22292f);border-radius:0;max-height:100%;max-width:100%}.video-call-user[_ngcontent-%COMP%]{left:50%;position:absolute;text-align:center;top:50%;transform:translate(-50%,-55%);z-index:1}.video-call-user__block[_ngcontent-%COMP%]{background:#fff;border-radius:50%;border:solid 5px #fff;height:180px;margin:0 auto;transform:scale(1);width:180px}.video-call-user__block--animated[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_play 2s ease infinite;backface-visibility:hidden}.video-call-user__img[_ngcontent-%COMP%]{border-radius:50%;height:100%;left:0;object-fit:cover;position:absolute;top:0;width:100%}.video-call-user__title[_ngcontent-%COMP%]{color:#fff;font-size:1.2em;font-weight:700;margin:15px 0 0}.video-call__actions[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:10px 0}.video-call__button[_ngcontent-%COMP%]{border-radius:50%;box-shadow:0 0 #3f51b500,0 .05em .1em #0003;border:0;cursor:pointer;display:block;font-size:40px;height:1em;margin:0 5px;position:relative;transform:translateZ(0) scale(1);width:1em;transition:.3s}.video-call__button[_ngcontent-%COMP%]:before, .video-call__button[_ngcontent-%COMP%]:after{content:"";position:absolute}.video-call__button[_ngcontent-%COMP%]:before{background-color:#ffffff1a;border-radius:50%;height:1em;left:0;opacity:1;top:0;transform:translateZ(0) scale(0);width:1em}.video-call__button[_ngcontent-%COMP%]:after{background-position:50% 50%;background-repeat:no-repeat;background-size:cover;background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTYuNiAxMC44YzEuNCAyLjggMy44IDUuMSA2LjYgNi42bDIuMi0yLjJjLjMtLjMuNy0uNCAxLS4yIDEuMS40IDIuMy42IDMuNi42LjUgMCAxIC40IDEgMVYyMGMwIC41LS41IDEtMSAxLTkuNCAwLTE3LTcuNi0xNy0xNyAwLS42LjQtMSAxLTFoMy41Yy41IDAgMSAuNCAxIDEgMCAxLjIuMiAyLjUuNiAzLjYuMS40IDAgLjctLjIgMWwtMi4zIDIuMnoiIGZpbGw9IiNmZmZmZmYiLz48L3N2Zz4=);height:.5em;left:.25em;top:.25em;transform:translateZ(0);width:.5em;transition:.3s}.video-call__button--accept[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_phone-outer 3s infinite;background-color:#3f51b5}.video-call__button--accept[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_phone-inner 3s infinite}.video-call__button--accept[_ngcontent-%COMP%]:after{animation:_ngcontent-%COMP%_phone-icon 3s infinite}.video-call__button--decline[_ngcontent-%COMP%]{background-color:#d73b3d}.video-call__button--decline[_ngcontent-%COMP%]:hover{background-color:#ce2a2c}.video-call__button--decline[_ngcontent-%COMP%]:after{top:.28em;transform:translateZ(0) rotate(135deg)}@keyframes _ngcontent-%COMP%_play{0%{transform:scale(1)}15%{box-shadow:0 0 0 5px #9b9da466}25%{box-shadow:0 0 0 10px #9b9da466,0 0 0 20px #9b9da433}25%{box-shadow:0 0 0 15px #9b9da466,0 0 0 30px #9b9da433}}@keyframes _ngcontent-%COMP%_phone-outer{0%{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}33.3333%{box-shadow:0 0 #3f51b51a,0 .05em .1em #00000080;transform:translateZ(0) scale(1.1)}66.6666%{box-shadow:0 0 0 .5em #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}to{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translateZ(0) scale(1)}}@keyframes _ngcontent-%COMP%_phone-inner{0%{opacity:1;transform:translateZ(0) scale(0)}33.3333%{opacity:1;transform:translateZ(0) scale(.9)}66.6666%{opacity:0;transform:translateZ(0) scale(0)}to{opacity:0;transform:translateZ(0) scale(0)}}@keyframes _ngcontent-%COMP%_phone-icon{0%{transform:translateZ(0)}2%{transform:translate3d(.01em,0,0)}4%{transform:translate3d(-.01em,0,0)}6%{transform:translate3d(.01em,0,0)}8%{transform:translate3d(-.01em,0,0)}10%{transform:translate3d(.01em,0,0)}12%{transform:translate3d(-.01em,0,0)}14%{transform:translate3d(.01em,0,0)}16%{transform:translate3d(-.01em,0,0)}18%{transform:translate3d(.01em,0,0)}20%{transform:translate3d(-.01em,0,0)}22%{transform:translate3d(.01em,0,0)}24%{transform:translate3d(-.01em,0,0)}26%{transform:translate3d(.01em,0,0)}28%{transform:translate3d(-.01em,0,0)}30%{transform:translate3d(.01em,0,0)}32%{transform:translate3d(-.01em,0,0)}34%{transform:translate3d(.01em,0,0)}36%{transform:translate3d(-.01em,0,0)}38%{transform:translate3d(.01em,0,0)}40%{transform:translate3d(-.01em,0,0)}42%{transform:translate3d(.01em,0,0)}44%{transform:translate3d(-.01em,0,0)}46%{transform:translateZ(0)}}'],data:{animation:[Jz]},changeDetection:0})}}return e})(),T$=(()=>{class e{onEnter(){this.subscription.unsubscribe(),this.setStyle(1)}onLeave(){this.hide()}constructor(t,s){this.renderer=t,this.el=s,this.subscription=new Ri,this.delay=5e3}ngOnInit(){this.hide()}hide(){this.subscription.unsubscribe(),this.subscription=c8(this.delay).pipe(nr(1)).subscribe(()=>this.setStyle(0))}setStyle(t){this.renderer.setStyle(this.el.nativeElement,"opacity",t)}static{this.\u0275fac=function(s){return new(s||e)(re(mc),re(On))}}static{this.\u0275dir=Ue({type:e,selectors:[["","ngxToggle",""]],hostBindings:function(s,c){1&s&&Mn("mouseenter",function(){return c.onEnter()})("mouseleave",function(){return c.onLeave()})},standalone:!0})}}return e})(),I$=(()=>{class e{constructor(t,s,c,u){this.document=t,this.componentFactoryResolver=s,this.appRef=c,this.injector=u,this.wrapperSelector="ngx-webrtc-wrapper"}open(t,s={}){return this.appendComponent(t,s)}appendComponent(t,s){const c=this.componentFactoryResolver.resolveComponentFactory(t).create(this.injector),{instance:u}=c;Object.keys(s).forEach(_=>u[_]=s[_]),this.appRef.attachView(c.hostView);const f=c.hostView.rootNodes[0];return this.getContainer().append(f),u.afterClosed.pipe(nr(1),function r$(e,i=PO){const t=EU(e,i);return Xz(()=>t)}(250)).subscribe(()=>{this.appRef.detachView(c.hostView),c.destroy()}),u}getContainer(){let t=this.document.querySelector(`.${this.wrapperSelector}`);return t||(t=this.document.createElement("div"),t.setAttribute("class",this.wrapperSelector),t.setAttribute("style","position: fixed; top: 0; width: 100%; z-index: 1;"),this.document.body.appendChild(t)),t}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve),ye(Qp),ye(Sr),ye(Oi))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const Qz={connected:!1,loading:!0,statusText:"Initializing",started:null,ended:!1,error:!1},w$={mode:"rtc",codec:"h264"};let e9=(()=>{class e{constructor(t){this.config=t,this.agoraRTC=o$,this.streamState=new bo(Qz),this.remoteStreamVideoToggle=new bo(!0),this.callEnd=new Mt,this.localContainerId="local-video",this.remoteCalls=[],this.remoteStreamVideoToggle$=this.remoteStreamVideoToggle.asObservable(),this.streamState$=this.streamState.asObservable(),this.agoraRTC.checkSystemRequirements()||this.handleError(new Error("Web RTC is not supported in this browser"))}init(t,s,c,u=!1){return this.uid=t,this.agoraRTC.setLogLevel(u?0:4),this.client=this.agoraRTC.createClient(w$),this.assignClientHandlers(),this.initLocalStream().then(()=>{this.client.join(this.config.AppID,s,c||null,this.uid).then(()=>{this.localTracks.videoTrack.play(this.localContainerId),this.client.publish(Object.values(this.localTracks)),this.streamState.next({...this.streamState.value,connected:!0,statusText:"Waiting others to join"})}).catch(f=>this.handleError(f))}),this.callEnd.asObservable()}deinit(){this.streamState.next(Qz)}endCall(){this.client.leave().then(()=>{this.stopLocalStream(),this.streamState.next({...this.streamState.value,started:null,loading:!0,statusText:"",ended:!0}),this.remoteCalls=[],c8(500).pipe(nr(1)).subscribe(()=>this.callEnd.next())})}toggleVideo(t){this.localTracks&&this.localTracks.videoTrack.setMuted(t)}toggleAudio(t){this.localTracks&&this.localTracks.audioTrack.setMuted(t)}toggleFullScreen(t){t?document.exitFullscreen():document.documentElement.requestFullscreen()}isVideoEnabled(){return!!this.localTracks&&!this.localTracks.videoTrack.muted}isAudioEnabled(){return!!this.localTracks&&!this.localTracks.audioTrack.muted}assignClientHandlers(){this.client.on("user-joined",t=>{this.streamState.next({...this.streamState.value,started:Date.now(),loading:!1}),this.remoteCalls.length||this.remoteCalls.push(this.getRemoteId(t))}),this.client.on("user-published",(t,s)=>{const c=this.getRemoteId(t);this.client.subscribe(t,s).then(u=>{this.remoteCalls.includes(c)&&u.play(c)})}),this.client.on("user-info-updated",(t,s)=>{"mute-video"===s&&this.remoteStreamVideoToggle.next(!1),"unmute-video"===s&&this.remoteStreamVideoToggle.next(!0)}),this.client.on("user-left",()=>{this.endCall()})}initLocalStream(){return Promise.all([this.agoraRTC.createCameraVideoTrack(),this.agoraRTC.createMicrophoneAudioTrack()]).then(([t,s])=>{this.localTracks={audioTrack:s,videoTrack:t}}).catch(t=>{this.handleError(t)})}getRemoteId(t){return`remote_call-${t.uid}`}handleError(t){throw this.streamState.next({...this.streamState.value,statusText:t.message,error:!0}),this.stopLocalStream(),c8(5e3).pipe(nr(1)).subscribe(()=>this.callEnd.next()),new Error(t.message)}stopLocalStream(){this.localTracks&&Object.values(this.localTracks).forEach(t=>{t.stop(),t.close()})}static{this.\u0275fac=function(s){return new(s||e)(ye("AgoraConfig"))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac})}}return e})(),t9=(()=>{class e extends Zz{constructor(t,s){super(s),this.webRtcService=t,this.animate=!0,this.displaySmallScreen=!1,this.debug=!1,this.callEnd=new Dn,this.smallScreenEnabled=!1,this.active=!1,this.streamState$=this.webRtcService.streamState$,this.remoteStreamVideoToggle$=this.webRtcService.remoteStreamVideoToggle$}ngOnInit(){this.webRtcService.init(this.uid,this.channel,this.token,this.debug).pipe(nr(1)).subscribe(()=>{this.active=this.smallScreenEnabled,this.callEnd.emit(),this.closeDialog(!0)})}ngOnDestroy(){this.webRtcService.deinit()}get localContainerId(){return this.webRtcService.localContainerId}get remoteCalls(){return this.webRtcService.remoteCalls}get cameraEnabled(){return this.webRtcService.isVideoEnabled()}get microphoneEnabled(){return this.webRtcService.isAudioEnabled()}get fullScreenEnabled(){return!!document.fullscreenElement}onToggleCamera(t){this.webRtcService.toggleVideo(t)}onToggleMicrophone(t){this.webRtcService.toggleAudio(t)}onToggleFullScreen(t){this.webRtcService.toggleFullScreen(t)}onToggleSmallScreen(t){this.smallScreenEnabled=!t,this.active=!0}onEndCall(){this.webRtcService.endCall()}static{this.\u0275fac=function(s){return new(s||e)(re(e9),re(Js))}}static{this.\u0275cmp=no({type:e,selectors:[["ngx-webrtc"]],hostVars:4,hostBindings:function(s,c){2&s&&nt("small-screen",c.smallScreenEnabled)("active",c.active)},inputs:{uid:"uid",token:"token",channel:"channel",animate:"animate",displaySmallScreen:"displaySmallScreen",debug:"debug"},outputs:{callEnd:"callEnd"},standalone:!0,features:[tn,fo],decls:1,vars:1,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[1,"container"],[3,"error","text","connected","ended","small",4,"ngIf"],[3,"started",4,"ngIf"],[1,"container__local",3,"id"],[1,"container__remote",3,"id","hidden"],[1,"container__user-icon"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","user","clip-path","url(#clip0)"],["id","Vector","d","M31.5439 30.829C35.7793 30.829 39.4468 29.3099 42.4434 26.3129C45.4399 23.3163 46.959 19.6498 46.959 15.414C46.959 11.1796 45.4399 7.51267 42.4429 4.51512C39.4458 1.51904 35.7788 0 31.5439 0C27.3081 0 23.6416 1.51904 20.645 4.51561C17.6484 7.51218 16.1289 11.1792 16.1289 15.414C16.1289 19.6498 17.6484 23.3168 20.6455 26.3134C23.6426 29.3095 27.3096 30.829 31.5439 30.829V30.829Z","fill","#0B73C9"],["id","Vector_2","d","M58.5161 49.2127C58.4297 47.9656 58.2549 46.6053 57.9976 45.1688C57.7378 43.7215 57.4033 42.3533 57.0029 41.1029C56.5894 39.8104 56.0269 38.534 55.3315 37.3109C54.6099 36.0414 53.7622 34.9359 52.811 34.0262C51.8164 33.0746 50.5986 32.3094 49.1904 31.7513C47.7871 31.1962 46.2319 30.9149 44.5684 30.9149C43.915 30.9149 43.2832 31.183 42.063 31.9774C41.312 32.4672 40.4336 33.0336 39.4531 33.66C38.6147 34.1942 37.479 34.6947 36.0762 35.1478C34.7075 35.5907 33.3179 35.8153 31.9463 35.8153C30.5747 35.8153 29.1855 35.5907 27.8154 35.1478C26.4141 34.6952 25.2783 34.1947 24.4409 33.6605C23.4697 33.0399 22.5908 32.4735 21.8286 31.9769C20.6099 31.1825 19.9775 30.9144 19.3242 30.9144C17.6602 30.9144 16.1055 31.1962 14.7026 31.7518C13.2954 32.309 12.0771 33.0741 11.0815 34.0267C10.1309 34.9369 9.28271 36.0419 8.56201 37.3109C7.86719 38.534 7.30469 39.8099 6.89062 41.1034C6.49072 42.3538 6.15625 43.7215 5.89648 45.1688C5.63916 46.6033 5.46436 47.9642 5.37793 49.2142C5.29297 50.4388 5.25 51.7098 5.25 52.9934C5.25 56.3343 6.31201 59.0388 8.40625 61.0335C10.4746 63.0017 13.2114 64.0002 16.5396 64.0002H47.356C50.6841 64.0002 53.4199 63.0022 55.4888 61.0335C57.5835 59.0403 58.6455 56.3352 58.6455 52.993C58.645 51.7034 58.6016 50.4314 58.5161 49.2127V49.2127Z","fill","#0B73C9"],["id","clip0"],["width","64","height","64","fill","#0B73C9"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall",4,"ngIf"],[3,"error","text","connected","ended","small"],[3,"started"],[1,"container__remote",3,"id"],["ngxToggle","",3,"toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall","cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen"]],template:function(s,c){1&s&&Si(0,E$,3,5,"div",0),2&s&&$e("ngIf",c.shown)},dependencies:[hD,QS,y$,b$,S$,T$],styles:["ngx-timer[_ngcontent-%COMP%]{display:block;padding-top:25px}[_nghost-%COMP%]{bottom:0;max-width:100%;right:0;width:100%;transition:.3s}.active[_nghost-%COMP%]{position:fixed}.small-screen[_nghost-%COMP%]{max-width:210px}.small-screen[_nghost-%COMP%]   ngx-timer[_ngcontent-%COMP%]{padding-top:10px}.small-screen[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{border-radius:10px;box-shadow:#00000059 0 5px 15px;height:200px;max-width:200px;margin-right:10px;margin-bottom:10px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]{border-radius:10px;height:200px;width:200px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]    >div{border-radius:10px}.small-screen[_nghost-%COMP%]   .container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.container[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;max-width:100%;margin-left:auto;overflow:hidden;position:relative;transition:.3s}.container__local[_ngcontent-%COMP%]{border-radius:5px;height:20vh;opacity:1;overflow:hidden;position:absolute;right:1rem;top:1rem;width:20vw;z-index:1;transition:.3s}.container__local.hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden}.container__local[_ngcontent-%COMP%]:not(:empty){box-shadow:0 3px 8px #00000080}.container__remote[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;left:0;position:absolute;top:0;width:100vw;transition:.3s}.container__remote[_ngcontent-%COMP%]    >div{transition:.3s}.container__remote.hidden[_ngcontent-%COMP%]{display:none}.container__remote.hidden[_ngcontent-%COMP%] + .container__user-icon[_ngcontent-%COMP%]{display:block}.container__remote[_ngcontent-%COMP%]:empty{display:none}.container__user-icon[_ngcontent-%COMP%]{background:#0000004d;border-radius:50%;box-shadow:0 3px 8px #00000080;display:none;left:50%;padding:20px;position:absolute;top:50%;transform:translate(-50%,-50%)}.container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px}@media screen and (max-width: 769px){ngx-controls[_ngcontent-%COMP%]{opacity:1!important}}"],data:{animation:[Jz]},changeDetection:0})}}return e})(),R$=(()=>{class e{constructor(t){this.dialog=t}open(t){const s=new Mt,c=this.dialog.open(C$,{data:t});return c.afterClosed.asObservable().pipe(Nc(u=>u?.channel?this.dialog.open(t9,{uid:u.uid,token:u.token,channel:u.channel,debug:!!u.debug,displaySmallScreen:!0}).afterClosed.asObservable():vt(!1)),nr(1),ir(()=>s.next(!0))).subscribe(),{acceptCall:c.onAcceptCall.bind(c),close:c.closeDialog.bind(c),afterConfirmation:()=>c.afterClosed.asObservable().pipe(nr(1)),afterCallEnd:()=>s.asObservable().pipe(nr(1))}}static{this.\u0275fac=function(s){return new(s||e)(ye(I$))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();let i9=(()=>{class e{constructor(t,s){this._renderer=t,this._elementRef=s,this.onChange=c=>{},this.onTouched=()=>{}}setProperty(t,s){this._renderer.setProperty(this._elementRef.nativeElement,t,s)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static{this.\u0275fac=function(s){return new(s||e)(re(mc),re(On))}}static{this.\u0275dir=Ue({type:e})}}return e})(),iE=(()=>{class e extends i9{static{this.\u0275fac=(()=>{let t;return function(c){return(t||(t=yn(e)))(c||e)}})()}static{this.\u0275dir=Ue({type:e,features:[tn]})}}return e})();const Wl=new Te(""),N$={provide:Wl,useExisting:Fn(()=>bU),multi:!0},M$=new Te("");let bU=(()=>{class e extends i9{constructor(t,s,c){super(t,s),this._compositionMode=c,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function P$(){const e=Al()?Al().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static{this.\u0275fac=function(s){return new(s||e)(re(mc),re(On),re(M$,8))}}static{this.\u0275dir=Ue({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(s,c){1&s&&Mn("input",function(f){return c._handleInput(f.target.value)})("blur",function(){return c.onTouched()})("compositionstart",function(){return c._compositionStart()})("compositionend",function(f){return c._compositionEnd(f.target.value)})},features:[mn([N$]),tn]})}}return e})();function mm(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}function o9(e){return null!=e&&"number"==typeof e.length}const vo=new Te(""),gm=new Te(""),k$=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class s9{static min(i){return function a9(e){return i=>{if(mm(i.value)||mm(e))return null;const t=parseFloat(i.value);return!isNaN(t)&&t<e?{min:{min:e,actual:i.value}}:null}}(i)}static max(i){return function c9(e){return i=>{if(mm(i.value)||mm(e))return null;const t=parseFloat(i.value);return!isNaN(t)&&t>e?{max:{max:e,actual:i.value}}:null}}(i)}static required(i){return function l9(e){return mm(e.value)?{required:!0}:null}(i)}static requiredTrue(i){return function d9(e){return!0===e.value?null:{required:!0}}(i)}static email(i){return function u9(e){return mm(e.value)||k$.test(e.value)?null:{email:!0}}(i)}static minLength(i){return function h9(e){return i=>mm(i.value)||!o9(i.value)?null:i.value.length<e?{minlength:{requiredLength:e,actualLength:i.value.length}}:null}(i)}static maxLength(i){return function p9(e){return i=>o9(i.value)&&i.value.length>e?{maxlength:{requiredLength:e,actualLength:i.value.length}}:null}(i)}static pattern(i){return function f9(e){if(!e)return SU;let i,t;return"string"==typeof e?(t="","^"!==e.charAt(0)&&(t+="^"),t+=e,"$"!==e.charAt(e.length-1)&&(t+="$"),i=new RegExp(t)):(t=e.toString(),i=e),s=>{if(mm(s.value))return null;const c=s.value;return i.test(c)?null:{pattern:{requiredPattern:t,actualValue:c}}}}(i)}static nullValidator(i){return null}static compose(i){return y9(i)}static composeAsync(i){return b9(i)}}function SU(e){return null}function m9(e){return null!=e}function g9(e){return H_(e)?Lr(e):e}function _9(e){let i={};return e.forEach(t=>{i=null!=t?{...i,...t}:i}),0===Object.keys(i).length?null:i}function v9(e,i){return i.map(t=>t(e))}function E9(e){return e.map(i=>function L$(e){return!e.validate}(i)?i:t=>i.validate(t))}function y9(e){if(!e)return null;const i=e.filter(m9);return 0==i.length?null:function(t){return _9(v9(t,i))}}function l8(e){return null!=e?y9(E9(e)):null}function b9(e){if(!e)return null;const i=e.filter(m9);return 0==i.length?null:function(t){return function D$(...e){const i=DC(e),{args:t,keys:s}=DF(e),c=new ni(u=>{const{length:f}=t;if(!f)return void u.complete();const _=new Array(f);let E=f,S=f;for(let I=0;I<f;I++){let P=!1;qr(t[I]).subscribe(ui(u,U=>{P||(P=!0,S--),_[I]=U},()=>E--,void 0,()=>{(!E||!P)&&(S||u.next(s?Cr(s,_):_),u.complete())}))}});return i?c.pipe(QD(i)):c}(v9(t,i).map(g9)).pipe(Jt(_9))}}function d8(e){return null!=e?b9(E9(e)):null}function S9(e,i){return null===e?[i]:Array.isArray(e)?[...e,i]:[e,i]}function C9(e){return e._rawValidators}function T9(e){return e._rawAsyncValidators}function u8(e){return e?Array.isArray(e)?e:[e]:[]}function CU(e,i){return Array.isArray(e)?e.includes(i):e===i}function I9(e,i){const t=u8(i);return u8(e).forEach(c=>{CU(t,c)||t.push(c)}),t}function w9(e,i){return u8(i).filter(t=>!CU(e,t))}class R9{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(i){this._rawValidators=i||[],this._composedValidatorFn=l8(this._rawValidators)}_setAsyncValidators(i){this._rawAsyncValidators=i||[],this._composedAsyncValidatorFn=d8(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(i){this._onDestroyCallbacks.push(i)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(i=>i()),this._onDestroyCallbacks=[]}reset(i=void 0){this.control&&this.control.reset(i)}hasError(i,t){return!!this.control&&this.control.hasError(i,t)}getError(i,t){return this.control?this.control.getError(i,t):null}}class xs extends R9{get formDirective(){return null}get path(){return null}}class Xh extends R9{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class A9{constructor(i){this._cd=i}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}}let D9=(()=>{class e extends A9{constructor(t){super(t)}static{this.\u0275fac=function(s){return new(s||e)(re(Xh,2))}}static{this.\u0275dir=Ue({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(s,c){2&s&&nt("ng-untouched",c.isUntouched)("ng-touched",c.isTouched)("ng-pristine",c.isPristine)("ng-dirty",c.isDirty)("ng-valid",c.isValid)("ng-invalid",c.isInvalid)("ng-pending",c.isPending)},features:[tn]})}}return e})(),O9=(()=>{class e extends A9{constructor(t){super(t)}static{this.\u0275fac=function(s){return new(s||e)(re(xs,10))}}static{this.\u0275dir=Ue({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(s,c){2&s&&nt("ng-untouched",c.isUntouched)("ng-touched",c.isTouched)("ng-pristine",c.isPristine)("ng-dirty",c.isDirty)("ng-valid",c.isValid)("ng-invalid",c.isInvalid)("ng-pending",c.isPending)("ng-submitted",c.isSubmitted)},features:[tn]})}}return e})();const MO="VALID",IU="INVALID",ZC="PENDING",kO="DISABLED";class JC{}class P9 extends JC{constructor(i,t){super(),this.value=i,this.source=t}}class f8 extends JC{constructor(i,t){super(),this.pristine=i,this.source=t}}class m8 extends JC{constructor(i,t){super(),this.touched=i,this.source=t}}class wU extends JC{constructor(i,t){super(),this.status=i,this.source=t}}class B$ extends JC{constructor(i){super(),this.source=i}}class j$ extends JC{constructor(i){super(),this.source=i}}function g8(e){return(RU(e)?e.validators:e)||null}function _8(e,i){return(RU(i)?i.asyncValidators:e)||null}function RU(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function M9(e,i,t){const s=e.controls;if(!(i?Object.keys(s):s).length)throw new se(1e3,"");if(!s[t])throw new se(1001,"")}function k9(e,i,t){e._forEachChild((s,c)=>{if(void 0===t[c])throw new se(1002,"")})}class AU{constructor(i,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=Ud(()=>this.statusReactive()),this.statusReactive=gd(void 0),this._pristine=Ud(()=>this.pristineReactive()),this.pristineReactive=gd(!0),this._touched=Ud(()=>this.touchedReactive()),this.touchedReactive=gd(!1),this._events=new Mt,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(i),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(i){this._rawValidators=this._composedValidatorFn=i}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(i){this._rawAsyncValidators=this._composedAsyncValidatorFn=i}get parent(){return this._parent}get status(){return Qs(this.statusReactive)}set status(i){Qs(()=>this.statusReactive.set(i))}get valid(){return this.status===MO}get invalid(){return this.status===IU}get pending(){return this.status==ZC}get disabled(){return this.status===kO}get enabled(){return this.status!==kO}get pristine(){return Qs(this.pristineReactive)}set pristine(i){Qs(()=>this.pristineReactive.set(i))}get dirty(){return!this.pristine}get touched(){return Qs(this.touchedReactive)}set touched(i){Qs(()=>this.touchedReactive.set(i))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(i){this._assignValidators(i)}setAsyncValidators(i){this._assignAsyncValidators(i)}addValidators(i){this.setValidators(I9(i,this._rawValidators))}addAsyncValidators(i){this.setAsyncValidators(I9(i,this._rawAsyncValidators))}removeValidators(i){this.setValidators(w9(i,this._rawValidators))}removeAsyncValidators(i){this.setAsyncValidators(w9(i,this._rawAsyncValidators))}hasValidator(i){return CU(this._rawValidators,i)}hasAsyncValidator(i){return CU(this._rawAsyncValidators,i)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(i={}){const t=!1===this.touched;this.touched=!0;const s=i.sourceControl??this;this._parent&&!i.onlySelf&&this._parent.markAsTouched({...i,sourceControl:s}),t&&!1!==i.emitEvent&&this._events.next(new m8(!0,s))}markAllAsTouched(i={}){this.markAsTouched({onlySelf:!0,emitEvent:i.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(i))}markAsUntouched(i={}){const t=!0===this.touched;this.touched=!1,this._pendingTouched=!1;const s=i.sourceControl??this;this._forEachChild(c=>{c.markAsUntouched({onlySelf:!0,emitEvent:i.emitEvent,sourceControl:s})}),this._parent&&!i.onlySelf&&this._parent._updateTouched(i,s),t&&!1!==i.emitEvent&&this._events.next(new m8(!1,s))}markAsDirty(i={}){const t=!0===this.pristine;this.pristine=!1;const s=i.sourceControl??this;this._parent&&!i.onlySelf&&this._parent.markAsDirty({...i,sourceControl:s}),t&&!1!==i.emitEvent&&this._events.next(new f8(!1,s))}markAsPristine(i={}){const t=!1===this.pristine;this.pristine=!0,this._pendingDirty=!1;const s=i.sourceControl??this;this._forEachChild(c=>{c.markAsPristine({onlySelf:!0,emitEvent:i.emitEvent})}),this._parent&&!i.onlySelf&&this._parent._updatePristine(i,s),t&&!1!==i.emitEvent&&this._events.next(new f8(!0,s))}markAsPending(i={}){this.status=ZC;const t=i.sourceControl??this;!1!==i.emitEvent&&(this._events.next(new wU(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!i.onlySelf&&this._parent.markAsPending({...i,sourceControl:t})}disable(i={}){const t=this._parentMarkedDirty(i.onlySelf);this.status=kO,this.errors=null,this._forEachChild(c=>{c.disable({...i,onlySelf:!0})}),this._updateValue();const s=i.sourceControl??this;!1!==i.emitEvent&&(this._events.next(new P9(this.value,s)),this._events.next(new wU(this.status,s)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...i,skipPristineCheck:t},this),this._onDisabledChange.forEach(c=>c(!0))}enable(i={}){const t=this._parentMarkedDirty(i.onlySelf);this.status=MO,this._forEachChild(s=>{s.enable({...i,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:i.emitEvent}),this._updateAncestors({...i,skipPristineCheck:t},this),this._onDisabledChange.forEach(s=>s(!1))}_updateAncestors(i,t){this._parent&&!i.onlySelf&&(this._parent.updateValueAndValidity(i),i.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(i){this._parent=i}getRawValue(){return this.value}updateValueAndValidity(i={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){const s=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===MO||this.status===ZC)&&this._runAsyncValidator(s,i.emitEvent)}const t=i.sourceControl??this;!1!==i.emitEvent&&(this._events.next(new P9(this.value,t)),this._events.next(new wU(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!i.onlySelf&&this._parent.updateValueAndValidity({...i,sourceControl:t})}_updateTreeValidity(i={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(i)),this.updateValueAndValidity({onlySelf:!0,emitEvent:i.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?kO:MO}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(i,t){if(this.asyncValidator){this.status=ZC,this._hasOwnPendingAsyncValidator={emitEvent:!1!==t};const s=g9(this.asyncValidator(this));this._asyncValidationSubscription=s.subscribe(c=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(c,{emitEvent:t,shouldHaveEmitted:i})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();const i=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,i}return!1}setErrors(i,t={}){this.errors=i,this._updateControlsErrors(!1!==t.emitEvent,this,t.shouldHaveEmitted)}get(i){let t=i;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((s,c)=>s&&s._find(c),this)}getError(i,t){const s=t?this.get(t):this;return s&&s.errors?s.errors[i]:null}hasError(i,t){return!!this.getError(i,t)}get root(){let i=this;for(;i._parent;)i=i._parent;return i}_updateControlsErrors(i,t,s){this.status=this._calculateStatus(),i&&this.statusChanges.emit(this.status),(i||s)&&this._events.next(new wU(this.status,t)),this._parent&&this._parent._updateControlsErrors(i,t,s)}_initObservables(){this.valueChanges=new Dn,this.statusChanges=new Dn}_calculateStatus(){return this._allControlsDisabled()?kO:this.errors?IU:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ZC)?ZC:this._anyControlsHaveStatus(IU)?IU:MO}_anyControlsHaveStatus(i){return this._anyControls(t=>t.status===i)}_anyControlsDirty(){return this._anyControls(i=>i.dirty)}_anyControlsTouched(){return this._anyControls(i=>i.touched)}_updatePristine(i,t){const s=!this._anyControlsDirty(),c=this.pristine!==s;this.pristine=s,this._parent&&!i.onlySelf&&this._parent._updatePristine(i,t),c&&this._events.next(new f8(this.pristine,t))}_updateTouched(i={},t){this.touched=this._anyControlsTouched(),this._events.next(new m8(this.touched,t)),this._parent&&!i.onlySelf&&this._parent._updateTouched(i,t)}_registerOnCollectionChange(i){this._onCollectionChange=i}_setUpdateStrategy(i){RU(i)&&null!=i.updateOn&&(this._updateOn=i.updateOn)}_parentMarkedDirty(i){return!i&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(i){return null}_assignValidators(i){this._rawValidators=Array.isArray(i)?i.slice():i,this._composedValidatorFn=function H$(e){return Array.isArray(e)?l8(e):e||null}(this._rawValidators)}_assignAsyncValidators(i){this._rawAsyncValidators=Array.isArray(i)?i.slice():i,this._composedAsyncValidatorFn=function G$(e){return Array.isArray(e)?d8(e):e||null}(this._rawAsyncValidators)}}class LO extends AU{constructor(i,t,s){super(g8(t),_8(s,t)),this.controls=i,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(i,t){return this.controls[i]?this.controls[i]:(this.controls[i]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(i,t,s={}){this.registerControl(i,t),this.updateValueAndValidity({emitEvent:s.emitEvent}),this._onCollectionChange()}removeControl(i,t={}){this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),delete this.controls[i],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(i,t,s={}){this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),delete this.controls[i],t&&this.registerControl(i,t),this.updateValueAndValidity({emitEvent:s.emitEvent}),this._onCollectionChange()}contains(i){return this.controls.hasOwnProperty(i)&&this.controls[i].enabled}setValue(i,t={}){k9(this,0,i),Object.keys(i).forEach(s=>{M9(this,!0,s),this.controls[s].setValue(i[s],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(i,t={}){null!=i&&(Object.keys(i).forEach(s=>{const c=this.controls[s];c&&c.patchValue(i[s],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(i={},t={}){this._forEachChild((s,c)=>{s.reset(i?i[c]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(i,t,s)=>(i[s]=t.getRawValue(),i))}_syncPendingControls(){let i=this._reduceChildren(!1,(t,s)=>!!s._syncPendingControls()||t);return i&&this.updateValueAndValidity({onlySelf:!0}),i}_forEachChild(i){Object.keys(this.controls).forEach(t=>{const s=this.controls[t];s&&i(s,t)})}_setUpControls(){this._forEachChild(i=>{i.setParent(this),i._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(i){for(const[t,s]of Object.entries(this.controls))if(this.contains(t)&&i(s))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,s,c)=>((s.enabled||this.disabled)&&(t[c]=s.value),t))}_reduceChildren(i,t){let s=i;return this._forEachChild((c,u)=>{s=t(s,c,u)}),s}_allControlsDisabled(){for(const i of Object.keys(this.controls))if(this.controls[i].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(i){return this.controls.hasOwnProperty(i)?this.controls[i]:null}}class L9 extends LO{}const QC=new Te("CallSetDisabledState",{providedIn:"root",factory:()=>DU}),DU="always";function xO(e,i,t=DU){v8(e,i),i.valueAccessor.writeValue(e.value),(e.disabled||"always"===t)&&i.valueAccessor.setDisabledState?.(e.disabled),function z$(e,i){i.valueAccessor.registerOnChange(t=>{e._pendingValue=t,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&x9(e,i)})}(e,i),function q$(e,i){const t=(s,c)=>{i.valueAccessor.writeValue(s),c&&i.viewToModelUpdate(s)};e.registerOnChange(t),i._registerOnDestroy(()=>{e._unregisterOnChange(t)})}(e,i),function K$(e,i){i.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&x9(e,i),"submit"!==e.updateOn&&e.markAsTouched()})}(e,i),function W$(e,i){if(i.valueAccessor.setDisabledState){const t=s=>{i.valueAccessor.setDisabledState(s)};e.registerOnDisabledChange(t),i._registerOnDestroy(()=>{e._unregisterOnDisabledChange(t)})}}(e,i)}function NU(e,i,t=!0){const s=()=>{};i.valueAccessor&&(i.valueAccessor.registerOnChange(s),i.valueAccessor.registerOnTouched(s)),MU(e,i),e&&(i._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function PU(e,i){e.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(i)})}function v8(e,i){const t=C9(e);null!==i.validator?e.setValidators(S9(t,i.validator)):"function"==typeof t&&e.setValidators([t]);const s=T9(e);null!==i.asyncValidator?e.setAsyncValidators(S9(s,i.asyncValidator)):"function"==typeof s&&e.setAsyncValidators([s]);const c=()=>e.updateValueAndValidity();PU(i._rawValidators,c),PU(i._rawAsyncValidators,c)}function MU(e,i){let t=!1;if(null!==e){if(null!==i.validator){const c=C9(e);if(Array.isArray(c)&&c.length>0){const u=c.filter(f=>f!==i.validator);u.length!==c.length&&(t=!0,e.setValidators(u))}}if(null!==i.asyncValidator){const c=T9(e);if(Array.isArray(c)&&c.length>0){const u=c.filter(f=>f!==i.asyncValidator);u.length!==c.length&&(t=!0,e.setAsyncValidators(u))}}}const s=()=>{};return PU(i._rawValidators,s),PU(i._rawAsyncValidators,s),t}function x9(e,i){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),i.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function F9(e,i){v8(e,i)}function U9(e,i){e._syncPendingControls(),i.forEach(t=>{const s=t.control;"submit"===s.updateOn&&s._pendingChange&&(t.viewToModelUpdate(s._pendingValue),s._pendingChange=!1)})}const J$={provide:xs,useExisting:Fn(()=>kU)},FO=Promise.resolve();let kU=(()=>{class e extends xs{get submitted(){return Qs(this.submittedReactive)}constructor(t,s,c){super(),this.callSetDisabledState=c,this._submitted=Ud(()=>this.submittedReactive()),this.submittedReactive=gd(!1),this._directives=new Set,this.ngSubmit=new Dn,this.form=new LO({},l8(t),d8(s))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){FO.then(()=>{const s=this._findContainer(t.path);t.control=s.registerControl(t.name,t.control),xO(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){FO.then(()=>{const s=this._findContainer(t.path);s&&s.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){FO.then(()=>{const s=this._findContainer(t.path),c=new LO({});F9(c,t),s.registerControl(t.name,c),c.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){FO.then(()=>{const s=this._findContainer(t.path);s&&s.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,s){FO.then(()=>{this.form.get(t.path).setValue(s)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submittedReactive.set(!0),U9(this.form,this._directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static{this.\u0275fac=function(s){return new(s||e)(re(vo,10),re(gm,10),re(QC,8))}}static{this.\u0275dir=Ue({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(s,c){1&s&&Mn("submit",function(f){return c.onSubmit(f)})("reset",function(){return c.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[mn([J$]),tn]})}}return e})();function V9(e,i){const t=e.indexOf(i);t>-1&&e.splice(t,1)}function B9(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const UO=class extends AU{constructor(i=null,t,s){super(g8(t),_8(s,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(i),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),RU(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=B9(i)?i.value:i)}setValue(i,t={}){this.value=this._pendingValue=i,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(s=>s(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(i,t={}){this.setValue(i,t)}reset(i=this.defaultValue,t={}){this._applyFormState(i),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(i){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(i){this._onChange.push(i)}_unregisterOnChange(i){V9(this._onChange,i)}registerOnDisabledChange(i){this._onDisabledChange.push(i)}_unregisterOnDisabledChange(i){V9(this._onDisabledChange,i)}_forEachChild(i){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(i){B9(i)?(this.value=this._pendingValue=i.value,i.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=i}};Promise.resolve();let z9=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275dir=Ue({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return e})();const S8=new Te(""),aX={provide:xs,useExisting:Fn(()=>VO)};let VO=(()=>{class e extends xs{get submitted(){return Qs(this._submittedReactive)}set submitted(t){this._submittedReactive.set(t)}constructor(t,s,c){super(),this.callSetDisabledState=c,this._submitted=Ud(()=>this._submittedReactive()),this._submittedReactive=gd(!1),this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Dn,this._setValidators(t),this._setAsyncValidators(s)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(MU(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const s=this.form.get(t.path);return xO(s,t,this.callSetDisabledState),s.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),s}getControl(t){return this.form.get(t.path)}removeControl(t){NU(t.control||null,t,!1),function Z$(e,i){const t=e.indexOf(i);t>-1&&e.splice(t,1)}(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,s){this.form.get(t.path).setValue(s)}onSubmit(t){return this._submittedReactive.set(!0),U9(this.form,this.directives),this.ngSubmit.emit(t),this.form._events.next(new B$(this.control)),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this._submittedReactive.set(!1),this.form._events.next(new j$(this.form))}_updateDomValue(){this.directives.forEach(t=>{const s=t.control,c=this.form.get(t.path);s!==c&&(NU(s||null,t),(e=>e instanceof UO)(c)&&(xO(c,t,this.callSetDisabledState),t.control=c))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const s=this.form.get(t.path);F9(s,t),s.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const s=this.form.get(t.path);s&&function Y$(e,i){return MU(e,i)}(s,t)&&s.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){v8(this.form,this),this._oldForm&&MU(this._oldForm,this)}_checkFormPresent(){}static{this.\u0275fac=function(s){return new(s||e)(re(vo,10),re(gm,10),re(QC,8))}}static{this.\u0275dir=Ue({type:e,selectors:[["","formGroup",""]],hostBindings:function(s,c){1&s&&Mn("submit",function(f){return c.onSubmit(f)})("reset",function(){return c.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[mn([aX]),tn,Xo]})}}return e})();const dX={provide:Xh,useExisting:Fn(()=>I8)};let I8=(()=>{class e extends Xh{set isDisabled(t){}static{this._ngModelWarningSentOnce=!1}constructor(t,s,c,u,f){super(),this._ngModelWarningConfig=f,this._added=!1,this.name=null,this.update=new Dn,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(s),this._setAsyncValidators(c),this.valueAccessor=function b8(e,i){if(!i)return null;let t,s,c;return Array.isArray(i),i.forEach(u=>{u.constructor===bU?t=u:function X$(e){return Object.getPrototypeOf(e.constructor)===iE}(u)?s=u:c=u}),c||s||t||null}(0,u)}ngOnChanges(t){this._added||this._setUpControl(),function y8(e,i){if(!e.hasOwnProperty("model"))return!1;const t=e.model;return!!t.isFirstChange()||!Object.is(i,t.currentValue)}(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return function OU(e,i){return[...i.path,e]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static{this.\u0275fac=function(s){return new(s||e)(re(xs,13),re(vo,10),re(gm,10),re(Wl,10),re(S8,8))}}static{this.\u0275dir=Ue({type:e,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[mn([dX]),tn,Xo]})}}return e})(),IX=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({})}}return e})();class a7 extends AU{constructor(i,t,s){super(g8(t),_8(s,t)),this.controls=i,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(i){return this.controls[this._adjustIndex(i)]}push(i,t={}){this.controls.push(i),this._registerControl(i),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(i,t,s={}){this.controls.splice(i,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:s.emitEvent})}removeAt(i,t={}){let s=this._adjustIndex(i);s<0&&(s=0),this.controls[s]&&this.controls[s]._registerOnCollectionChange(()=>{}),this.controls.splice(s,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(i,t,s={}){let c=this._adjustIndex(i);c<0&&(c=0),this.controls[c]&&this.controls[c]._registerOnCollectionChange(()=>{}),this.controls.splice(c,1),t&&(this.controls.splice(c,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:s.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(i,t={}){k9(this,0,i),i.forEach((s,c)=>{M9(this,!1,c),this.at(c).setValue(s,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(i,t={}){null!=i&&(i.forEach((s,c)=>{this.at(c)&&this.at(c).patchValue(s,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(i=[],t={}){this._forEachChild((s,c)=>{s.reset(i[c],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(i=>i.getRawValue())}clear(i={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:i.emitEvent}))}_adjustIndex(i){return i<0?i+this.length:i}_syncPendingControls(){let i=this.controls.reduce((t,s)=>!!s._syncPendingControls()||t,!1);return i&&this.updateValueAndValidity({onlySelf:!0}),i}_forEachChild(i){this.controls.forEach((t,s)=>{i(t,s)})}_updateValue(){this.value=this.controls.filter(i=>i.enabled||this.disabled).map(i=>i.value)}_anyControls(i){return this.controls.some(t=>t.enabled&&i(t))}_setUpControls(){this._forEachChild(i=>this._registerControl(i))}_allControlsDisabled(){for(const i of this.controls)if(i.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(i){i.setParent(this),i._registerOnCollectionChange(this._onCollectionChange)}_find(i){return this.at(i)??null}}function c7(e){return!!e&&(void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn)}let O8,wX=(()=>{class e{constructor(){this.useNonNullable=!1}get nonNullable(){const t=new e;return t.useNonNullable=!0,t}group(t,s=null){const c=this._reduceControls(t);let u={};return c7(s)?u=s:null!==s&&(u.validators=s.validator,u.asyncValidators=s.asyncValidator),new LO(c,u)}record(t,s=null){const c=this._reduceControls(t);return new L9(c,s)}control(t,s,c){let u={};return this.useNonNullable?(c7(s)?u=s:(u.validators=s,u.asyncValidators=c),new UO(t,{...u,nonNullable:!0})):new UO(t,s,c)}array(t,s,c){const u=t.map(f=>this._createControl(f));return new a7(u,s,c)}_reduceControls(t){const s={};return Object.keys(t).forEach(c=>{s[c]=this._createControl(t[c])}),s}_createControl(t){return t instanceof UO||t instanceof AU?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),RX=(()=>{class e extends wX{group(t,s=null){return super.group(t,s)}control(t,s,c){return super.control(t,s,c)}array(t,s,c){return super.array(t,s,c)}static{this.\u0275fac=(()=>{let t;return function(c){return(t||(t=yn(e)))(c||e)}})()}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),AX=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:S8,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:QC,useValue:t.callSetDisabledState??DU}]}}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({imports:[IX]})}}return e})();try{O8=typeof Intl<"u"&&Intl.v8BreakIterator}catch{O8=!1}let eT,Ho=(()=>{class e{constructor(t){this._platformId=t,this.isBrowser=this._platformId?function eH(e){return e===Pl}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!O8)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}static{this.\u0275fac=function(s){return new(s||e)(ye(dd))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const l7=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function d7(){if(eT)return eT;if("object"!=typeof document||!document)return eT=new Set(l7),eT;let e=document.createElement("input");return eT=new Set(l7.filter(i=>(e.setAttribute("type",i),e.type===i))),eT}let BO,oE,N8;function tT(e){return function DX(){if(null==BO&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>BO=!0}))}finally{BO=BO||!1}return BO}()?e:!!e.capture}function OX(){if(null==oE){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return oE=!1,oE;if("scrollBehavior"in document.documentElement.style)oE=!0;else{const e=Element.prototype.scrollTo;oE=!!e&&!/\{\s*\[native code\]\s*\}/.test(e.toString())}}return oE}function Zh(e){return e.composedPath?e.composedPath()[0]:e.target}function P8(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function p7(e){return Ns((i,t)=>e<=t)}function QX(e,i){return e===i}let eZ=(()=>{class e{create(t){return typeof MutationObserver>"u"?null:new MutationObserver(t)}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),m7=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({providers:[eZ]})}}return e})();function nT(e){return null!=e&&"false"!=`${e}`}function g7(e,i=0){return function tZ(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}(e)?Number(e):2===arguments.length?i:0}function xU(e){return Array.isArray(e)?e:[e]}function xr(e){return null==e?"":"string"==typeof e?e:`${e}px`}function _m(e){return e instanceof On?e.nativeElement:e}const _7=new Set;let sE,nZ=(()=>{class e{constructor(t,s){this._platform=t,this._nonce=s,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):rZ}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&function iZ(e,i){if(!_7.has(e))try{sE||(sE=document.createElement("style"),i&&sE.setAttribute("nonce",i),sE.setAttribute("type","text/css"),document.head.appendChild(sE)),sE.sheet&&(sE.sheet.insertRule(`@media ${e} {body{ }}`,0),_7.add(e))}catch(t){console.error(t)}}(t,this._nonce),this._matchMedia(t)}static{this.\u0275fac=function(s){return new(s||e)(ye(Ho),ye(G0,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function rZ(e){return{matches:"all"===e||""===e,media:e,addListener:()=>{},removeListener:()=>{}}}let oZ=(()=>{class e{constructor(t,s){this._mediaMatcher=t,this._zone=s,this._queries=new Map,this._destroySubject=new Mt}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return v7(xU(t)).some(c=>this._registerQuery(c).mql.matches)}observe(t){let u=xl(v7(xU(t)).map(f=>this._registerQuery(f).observable));return u=oa(u.pipe(nr(1)),u.pipe(p7(1),function h7(e,i=PO){return yi((t,s)=>{let c=null,u=null,f=null;const _=()=>{if(c){c.unsubscribe(),c=null;const S=u;u=null,s.next(S)}};function E(){const S=f+e,I=i.now();if(I<S)return c=this.schedule(void 0,S-I),void s.add(c);_()}t.subscribe(ui(s,S=>{u=S,f=i.now(),c||(c=i.schedule(E,e),s.add(c))},()=>{_(),s.complete()},void 0,()=>{u=c=null}))})}(0))),u.pipe(Jt(f=>{const _={matches:!1,breakpoints:{}};return f.forEach(({matches:E,query:S})=>{_.matches=_.matches||E,_.breakpoints[S]=E}),_}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const s=this._mediaMatcher.matchMedia(t),u={observable:new ni(f=>{const _=E=>this._zone.run(()=>f.next(E));return s.addListener(_),()=>{s.removeListener(_)}}).pipe(PF(s),Jt(({matches:f})=>({query:t,matches:f})),Tr(this._destroySubject)),mql:s};return this._queries.set(t,u),u}static{this.\u0275fac=function(s){return new(s||e)(ye(nZ),ye(ft))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function v7(e){return e.map(i=>i.split(",")).reduce((i,t)=>i.concat(t)).map(i=>i.trim())}function FU(e,i){return e.getAttribute(i)?.match(/\S+/g)??[]}const y7="cdk-describedby-message",UU="cdk-describedby-host";let M8=0,cZ=(()=>{class e{constructor(t,s){this._platform=s,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+M8++,this._document=t,this._id=me(Vp)+"-"+M8++}describe(t,s,c){if(!this._canBeDescribed(t,s))return;const u=k8(s,c);"string"!=typeof s?(b7(s,this._id),this._messageRegistry.set(u,{messageElement:s,referenceCount:0})):this._messageRegistry.has(u)||this._createMessageElement(s,c),this._isElementDescribedByMessage(t,u)||this._addMessageReference(t,u)}removeDescription(t,s,c){if(!s||!this._isElementNode(t))return;const u=k8(s,c);if(this._isElementDescribedByMessage(t,u)&&this._removeMessageReference(t,u),"string"==typeof s){const f=this._messageRegistry.get(u);f&&0===f.referenceCount&&this._deleteMessageElement(u)}0===this._messagesContainer?.childNodes.length&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){const t=this._document.querySelectorAll(`[${UU}="${this._id}"]`);for(let s=0;s<t.length;s++)this._removeCdkDescribedByReferenceIds(t[s]),t[s].removeAttribute(UU);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(t,s){const c=this._document.createElement("div");b7(c,this._id),c.textContent=t,s&&c.setAttribute("role",s),this._createMessagesContainer(),this._messagesContainer.appendChild(c),this._messageRegistry.set(k8(t,s),{messageElement:c,referenceCount:0})}_deleteMessageElement(t){this._messageRegistry.get(t)?.messageElement?.remove(),this._messageRegistry.delete(t)}_createMessagesContainer(){if(this._messagesContainer)return;const t="cdk-describedby-message-container",s=this._document.querySelectorAll(`.${t}[platform="server"]`);for(let u=0;u<s.length;u++)s[u].remove();const c=this._document.createElement("div");c.style.visibility="hidden",c.classList.add(t),c.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&c.setAttribute("platform","server"),this._document.body.appendChild(c),this._messagesContainer=c}_removeCdkDescribedByReferenceIds(t){const s=FU(t,"aria-describedby").filter(c=>0!=c.indexOf(y7));t.setAttribute("aria-describedby",s.join(" "))}_addMessageReference(t,s){const c=this._messageRegistry.get(s);(function sZ(e,i,t){const s=FU(e,i);t=t.trim(),!s.some(c=>c.trim()===t)&&(s.push(t),e.setAttribute(i,s.join(" ")))})(t,"aria-describedby",c.messageElement.id),t.setAttribute(UU,this._id),c.referenceCount++}_removeMessageReference(t,s){const c=this._messageRegistry.get(s);c.referenceCount--,function aZ(e,i,t){const s=FU(e,i);t=t.trim();const c=s.filter(u=>u!==t);c.length?e.setAttribute(i,c.join(" ")):e.removeAttribute(i)}(t,"aria-describedby",c.messageElement.id),t.removeAttribute(UU)}_isElementDescribedByMessage(t,s){const c=FU(t,"aria-describedby"),u=this._messageRegistry.get(s),f=u&&u.messageElement.id;return!!f&&-1!=c.indexOf(f)}_canBeDescribed(t,s){if(!this._isElementNode(t))return!1;if(s&&"object"==typeof s)return!0;const c=null==s?"":`${s}`.trim(),u=t.getAttribute("aria-label");return!(!c||u&&u.trim()===c)}_isElementNode(t){return t.nodeType===this._document.ELEMENT_NODE}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve),ye(Ho))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function k8(e,i){return"string"==typeof e?`${i||""}/${e}`:e}function b7(e,i){e.id||(e.id=`${y7}-${i}-${M8++}`)}function w7(e){return 0===e.buttons||0===e.detail}function R7(e){const i=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!(!i||-1!==i.identifier||null!=i.radiusX&&1!==i.radiusX||null!=i.radiusY&&1!==i.radiusY)}const yZ=new Te("cdk-input-modality-detector-options"),bZ={ignoreKeys:[18,17,224,91,16]},iT=tT({passive:!0,capture:!0});let SZ=(()=>{class e{get mostRecentModality(){return this._modality.value}constructor(t,s,c,u){this._platform=t,this._mostRecentTarget=null,this._modality=new bo(null),this._lastTouchMs=0,this._onKeydown=f=>{this._options?.ignoreKeys?.some(_=>_===f.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Zh(f))},this._onMousedown=f=>{Date.now()-this._lastTouchMs<650||(this._modality.next(w7(f)?"keyboard":"mouse"),this._mostRecentTarget=Zh(f))},this._onTouchstart=f=>{R7(f)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Zh(f))},this._options={...bZ,...u},this.modalityDetected=this._modality.pipe(p7(1)),this.modalityChanged=this.modalityDetected.pipe(function JX(e,i=Xl){return e=e??QX,yi((t,s)=>{let c,u=!0;t.subscribe(ui(s,f=>{const _=i(f);(u||!e(c,_))&&(u=!1,c=_,s.next(f))}))})}()),t.isBrowser&&s.runOutsideAngular(()=>{c.addEventListener("keydown",this._onKeydown,iT),c.addEventListener("mousedown",this._onMousedown,iT),c.addEventListener("touchstart",this._onTouchstart,iT)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,iT),document.removeEventListener("mousedown",this._onMousedown,iT),document.removeEventListener("touchstart",this._onTouchstart,iT))}static{this.\u0275fac=function(s){return new(s||e)(ye(Ho),ye(ft),ye(Ve),ye(yZ,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var VU=function(e){return e[e.IMMEDIATE=0]="IMMEDIATE",e[e.EVENTUAL=1]="EVENTUAL",e}(VU||{});const TZ=new Te("cdk-focus-monitor-default-options"),BU=tT({passive:!0,capture:!0});let L8=(()=>{class e{constructor(t,s,c,u,f){this._ngZone=t,this._platform=s,this._inputModalityDetector=c,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Mt,this._rootNodeFocusAndBlurListener=_=>{for(let S=Zh(_);S;S=S.parentElement)"focus"===_.type?this._onFocus(_,S):this._onBlur(_,S)},this._document=u,this._detectionMode=f?.detectionMode||VU.IMMEDIATE}monitor(t,s=!1){const c=_m(t);if(!this._platform.isBrowser||1!==c.nodeType)return vt();const u=function PX(e){if(function NX(){if(null==N8){const e=typeof document<"u"?document.head:null;N8=!(!e||!e.createShadowRoot&&!e.attachShadow)}return N8}()){const i=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&i instanceof ShadowRoot)return i}return null}(c)||this._getDocument(),f=this._elementInfo.get(c);if(f)return s&&(f.checkChildren=!0),f.subject;const _={checkChildren:s,subject:new Mt,rootNode:u};return this._elementInfo.set(c,_),this._registerGlobalListeners(_),_.subject}stopMonitoring(t){const s=_m(t),c=this._elementInfo.get(s);c&&(c.subject.complete(),this._setClasses(s),this._elementInfo.delete(s),this._removeGlobalListeners(c))}focusVia(t,s,c){const u=_m(t);u===this._getDocument().activeElement?this._getClosestElementsInfo(u).forEach(([_,E])=>this._originChanged(_,s,E)):(this._setOrigin(s),"function"==typeof u.focus&&u.focus(c))}ngOnDestroy(){this._elementInfo.forEach((t,s)=>this.stopMonitoring(s))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(t){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(t)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:t&&this._isLastInteractionFromInputLabel(t)?"mouse":"program"}_shouldBeAttributedToTouch(t){return this._detectionMode===VU.EVENTUAL||!!t?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(t,s){t.classList.toggle("cdk-focused",!!s),t.classList.toggle("cdk-touch-focused","touch"===s),t.classList.toggle("cdk-keyboard-focused","keyboard"===s),t.classList.toggle("cdk-mouse-focused","mouse"===s),t.classList.toggle("cdk-program-focused","program"===s)}_setOrigin(t,s=!1){this._ngZone.runOutsideAngular(()=>{this._origin=t,this._originFromTouchInteraction="touch"===t&&s,this._detectionMode===VU.IMMEDIATE&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(t,s){const c=this._elementInfo.get(s),u=Zh(t);!c||!c.checkChildren&&s!==u||this._originChanged(s,this._getFocusOrigin(u),c)}_onBlur(t,s){const c=this._elementInfo.get(s);!c||c.checkChildren&&t.relatedTarget instanceof Node&&s.contains(t.relatedTarget)||(this._setClasses(s),this._emitOrigin(c,null))}_emitOrigin(t,s){t.subject.observers.length&&this._ngZone.run(()=>t.subject.next(s))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;const s=t.rootNode,c=this._rootNodeFocusListenerCount.get(s)||0;c||this._ngZone.runOutsideAngular(()=>{s.addEventListener("focus",this._rootNodeFocusAndBlurListener,BU),s.addEventListener("blur",this._rootNodeFocusAndBlurListener,BU)}),this._rootNodeFocusListenerCount.set(s,c+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Tr(this._stopInputModalityDetector)).subscribe(u=>{this._setOrigin(u,!0)}))}_removeGlobalListeners(t){const s=t.rootNode;if(this._rootNodeFocusListenerCount.has(s)){const c=this._rootNodeFocusListenerCount.get(s);c>1?this._rootNodeFocusListenerCount.set(s,c-1):(s.removeEventListener("focus",this._rootNodeFocusAndBlurListener,BU),s.removeEventListener("blur",this._rootNodeFocusAndBlurListener,BU),this._rootNodeFocusListenerCount.delete(s))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(t,s,c){this._setClasses(t,s),this._emitOrigin(c,s),this._lastFocusOrigin=s}_getClosestElementsInfo(t){const s=[];return this._elementInfo.forEach((c,u)=>{(u===t||c.checkChildren&&u.contains(t))&&s.push([u,c])}),s}_isLastInteractionFromInputLabel(t){const{_mostRecentTarget:s,mostRecentModality:c}=this._inputModalityDetector;if("mouse"!==c||!s||s===t||"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName||t.disabled)return!1;const u=t.labels;if(u)for(let f=0;f<u.length;f++)if(u[f].contains(s))return!0;return!1}static{this.\u0275fac=function(s){return new(s||e)(ye(ft),ye(Ho),ye(SZ),ye(Ve,8),ye(TZ,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var aE=function(e){return e[e.NONE=0]="NONE",e[e.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",e[e.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",e}(aE||{});const D7="cdk-high-contrast-black-on-white",O7="cdk-high-contrast-white-on-black",x8="cdk-high-contrast-active";let N7=(()=>{class e{constructor(t,s){this._platform=t,this._document=s,this._breakpointSubscription=me(oZ).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return aE.NONE;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const s=this._document.defaultView||window,c=s&&s.getComputedStyle?s.getComputedStyle(t):null,u=(c&&c.backgroundColor||"").replace(/ /g,"");switch(t.remove(),u){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return aE.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return aE.BLACK_ON_WHITE}return aE.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(x8,D7,O7),this._hasCheckedHighContrastMode=!0;const s=this.getHighContrastMode();s===aE.BLACK_ON_WHITE?t.add(x8,D7):s===aE.WHITE_ON_BLACK&&t.add(x8,O7)}}static{this.\u0275fac=function(s){return new(s||e)(ye(Ho),ye(Ve))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),IZ=(()=>{class e{constructor(t){t._applyBodyHighContrastModeCssClasses()}static{this.\u0275fac=function(s){return new(s||e)(ye(N7))}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({imports:[m7]})}}return e})();const wZ=new Te("cdk-dir-doc",{providedIn:"root",factory:function RZ(){return me(Ve)}}),AZ=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let F8=(()=>{class e{constructor(t){this.value="ltr",this.change=new Dn,t&&(this.value=function DZ(e){const i=e?.toLowerCase()||"";return"auto"===i&&typeof navigator<"u"&&navigator?.language?AZ.test(navigator.language)?"rtl":"ltr":"rtl"===i?"rtl":"ltr"}((t.body?t.body.dir:null)||(t.documentElement?t.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}static{this.\u0275fac=function(s){return new(s||e)(ye(wZ,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),HO=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({})}}return e})();const OZ=["mat-internal-form-field",""],NZ=["*"],MZ=new Te("mat-sanity-checks",{providedIn:"root",factory:function PZ(){return!0}});let Fc=(()=>{class e{constructor(t,s,c){this._sanityChecks=s,this._document=c,this._hasDoneGlobalChecks=!1,t._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!P8()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}static{this.\u0275fac=function(s){return new(s||e)(ye(N7),ye(MZ,8),ye(Ve))}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({imports:[HO,HO]})}}return e})();class k7{constructor(i,t,s,c,u){this._defaultMatcher=i,this.ngControl=t,this._parentFormGroup=s,this._parentForm=c,this._stateChanges=u,this.errorState=!1}updateErrorState(){const i=this.errorState,t=this._parentFormGroup||this._parentForm,s=this.matcher||this._defaultMatcher,c=this.ngControl?this.ngControl.control:null,u=s?.isErrorState(c,t)??!1;u!==i&&(this.errorState=u,this._stateChanges.next())}}let VZ=(()=>{class e{isErrorState(t,s){return!!(t&&t.invalid&&(t.touched||s&&s.submitted))}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var Uc=function(e){return e[e.FADING_IN=0]="FADING_IN",e[e.VISIBLE=1]="VISIBLE",e[e.FADING_OUT=2]="FADING_OUT",e[e.HIDDEN=3]="HIDDEN",e}(Uc||{});class BZ{constructor(i,t,s,c=!1){this._renderer=i,this.element=t,this.config=s,this._animationForciblyDisabledThroughCss=c,this.state=Uc.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}}const L7=tT({passive:!0,capture:!0});class jZ{constructor(){this._events=new Map,this._delegateEventHandler=i=>{const t=Zh(i);t&&this._events.get(i.type)?.forEach((s,c)=>{(c===t||c.contains(t))&&s.forEach(u=>u.handleEvent(i))})}}addHandler(i,t,s,c){const u=this._events.get(t);if(u){const f=u.get(s);f?f.add(c):u.set(s,new Set([c]))}else this._events.set(t,new Map([[s,new Set([c])]])),i.runOutsideAngular(()=>{document.addEventListener(t,this._delegateEventHandler,L7)})}removeHandler(i,t,s){const c=this._events.get(i);if(!c)return;const u=c.get(t);u&&(u.delete(s),0===u.size&&c.delete(t),0===c.size&&(this._events.delete(i),document.removeEventListener(i,this._delegateEventHandler,L7)))}}const x7={enterDuration:225,exitDuration:150},F7=tT({passive:!0,capture:!0}),U7=["mousedown","touchstart"],V7=["mouseup","mouseleave","touchend","touchcancel"];class jU{static{this._eventManager=new jZ}constructor(i,t,s,c){this._target=i,this._ngZone=t,this._platform=c,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,c.isBrowser&&(this._containerElement=_m(s))}fadeInRipple(i,t,s={}){const c=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),u={...x7,...s.animation};s.centered&&(i=c.left+c.width/2,t=c.top+c.height/2);const f=s.radius||function GZ(e,i,t){const s=Math.max(Math.abs(e-t.left),Math.abs(e-t.right)),c=Math.max(Math.abs(i-t.top),Math.abs(i-t.bottom));return Math.sqrt(s*s+c*c)}(i,t,c),_=i-c.left,E=t-c.top,S=u.enterDuration,I=document.createElement("div");I.classList.add("mat-ripple-element"),I.style.left=_-f+"px",I.style.top=E-f+"px",I.style.height=2*f+"px",I.style.width=2*f+"px",null!=s.color&&(I.style.backgroundColor=s.color),I.style.transitionDuration=`${S}ms`,this._containerElement.appendChild(I);const P=window.getComputedStyle(I),B=P.transitionDuration,G="none"===P.transitionProperty||"0s"===B||"0s, 0s"===B||0===c.width&&0===c.height,K=new BZ(this,I,s,G);I.style.transform="scale3d(1, 1, 1)",K.state=Uc.FADING_IN,s.persistent||(this._mostRecentTransientRipple=K);let te=null;return!G&&(S||u.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const ae=()=>{te&&(te.fallbackTimer=null),clearTimeout(ke),this._finishRippleTransition(K)},ne=()=>this._destroyRipple(K),ke=setTimeout(ne,S+100);I.addEventListener("transitionend",ae),I.addEventListener("transitioncancel",ne),te={onTransitionEnd:ae,onTransitionCancel:ne,fallbackTimer:ke}}),this._activeRipples.set(K,te),(G||!S)&&this._finishRippleTransition(K),K}fadeOutRipple(i){if(i.state===Uc.FADING_OUT||i.state===Uc.HIDDEN)return;const t=i.element,s={...x7,...i.config.animation};t.style.transitionDuration=`${s.exitDuration}ms`,t.style.opacity="0",i.state=Uc.FADING_OUT,(i._animationForciblyDisabledThroughCss||!s.exitDuration)&&this._finishRippleTransition(i)}fadeOutAll(){this._getActiveRipples().forEach(i=>i.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(i=>{i.config.persistent||i.fadeOut()})}setupTriggerEvents(i){const t=_m(i);!this._platform.isBrowser||!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,U7.forEach(s=>{jU._eventManager.addHandler(this._ngZone,s,t,this)}))}handleEvent(i){"mousedown"===i.type?this._onMousedown(i):"touchstart"===i.type?this._onTouchStart(i):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{V7.forEach(t=>{this._triggerElement.addEventListener(t,this,F7)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(i){i.state===Uc.FADING_IN?this._startFadeOutTransition(i):i.state===Uc.FADING_OUT&&this._destroyRipple(i)}_startFadeOutTransition(i){const t=i===this._mostRecentTransientRipple,{persistent:s}=i.config;i.state=Uc.VISIBLE,!s&&(!t||!this._isPointerDown)&&i.fadeOut()}_destroyRipple(i){const t=this._activeRipples.get(i)??null;this._activeRipples.delete(i),this._activeRipples.size||(this._containerRect=null),i===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),i.state=Uc.HIDDEN,null!==t&&(i.element.removeEventListener("transitionend",t.onTransitionEnd),i.element.removeEventListener("transitioncancel",t.onTransitionCancel),null!==t.fallbackTimer&&clearTimeout(t.fallbackTimer)),i.element.remove()}_onMousedown(i){const t=w7(i),s=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!t&&!s&&(this._isPointerDown=!0,this.fadeInRipple(i.clientX,i.clientY,this._target.rippleConfig))}_onTouchStart(i){if(!this._target.rippleDisabled&&!R7(i)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const t=i.changedTouches;if(t)for(let s=0;s<t.length;s++)this.fadeInRipple(t[s].clientX,t[s].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(i=>{!i.config.persistent&&(i.state===Uc.VISIBLE||i.config.terminateOnPointerUp&&i.state===Uc.FADING_IN)&&i.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const i=this._triggerElement;i&&(U7.forEach(t=>jU._eventManager.removeHandler(t,i,this)),this._pointerUpEventsRegistered&&(V7.forEach(t=>i.removeEventListener(t,this,F7)),this._pointerUpEventsRegistered=!1))}}const B7=new Te("mat-ripple-global-options");let j7=(()=>{class e{get disabled(){return this._disabled}set disabled(t){t&&this.fadeOutAllNonPersistent(),this._disabled=t,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(t){this._trigger=t,this._setupTriggerEventsIfEnabled()}constructor(t,s,c,u,f){this._elementRef=t,this._animationMode=f,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=u||{},this._rippleRenderer=new jU(this,s,t,c)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(t,s=0,c){return"number"==typeof t?this._rippleRenderer.fadeInRipple(t,s,{...this.rippleConfig,...c}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...t})}static{this.\u0275fac=function(s){return new(s||e)(re(On),re(ft),re(Ho),re(B7,8),re(tl,8))}}static{this.\u0275dir=Ue({type:e,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(s,c){2&s&&nt("mat-ripple-unbounded",c.unbounded)},inputs:{color:[0,"matRippleColor","color"],unbounded:[0,"matRippleUnbounded","unbounded"],centered:[0,"matRippleCentered","centered"],radius:[0,"matRippleRadius","radius"],animation:[0,"matRippleAnimation","animation"],disabled:[0,"matRippleDisabled","disabled"],trigger:[0,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0})}}return e})(),WZ=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({imports:[Fc,Fc]})}}return e})();const H7={capture:!0},G7=["focus","mousedown","mouseenter","touchstart"],U8="mat-ripple-loader-uninitialized",V8="mat-ripple-loader-class-name",W7="mat-ripple-loader-centered",HU="mat-ripple-loader-disabled";let zZ=(()=>{class e{constructor(){this._document=me(Ve,{optional:!0}),this._animationMode=me(tl,{optional:!0}),this._globalRippleOptions=me(B7,{optional:!0}),this._platform=me(Ho),this._ngZone=me(ft),this._hosts=new Map,this._onInteraction=t=>{const s=Zh(t);if(s instanceof HTMLElement){const c=s.closest(`[${U8}="${this._globalRippleOptions?.namespace??""}"]`);c&&this._createRipple(c)}},this._ngZone.runOutsideAngular(()=>{for(const t of G7)this._document?.addEventListener(t,this._onInteraction,H7)})}ngOnDestroy(){const t=this._hosts.keys();for(const s of t)this.destroyRipple(s);for(const s of G7)this._document?.removeEventListener(s,this._onInteraction,H7)}configureRipple(t,s){t.setAttribute(U8,this._globalRippleOptions?.namespace??""),(s.className||!t.hasAttribute(V8))&&t.setAttribute(V8,s.className||""),s.centered&&t.setAttribute(W7,""),s.disabled&&t.setAttribute(HU,"")}getRipple(t){return this._hosts.get(t)||this._createRipple(t)}setDisabled(t,s){const c=this._hosts.get(t);c?c.disabled=s:s?t.setAttribute(HU,""):t.removeAttribute(HU)}_createRipple(t){if(!this._document)return;const s=this._hosts.get(t);if(s)return s;t.querySelector(".mat-ripple")?.remove();const c=this._document.createElement("span");c.classList.add("mat-ripple",t.getAttribute(V8)),t.append(c);const u=new j7(new On(c),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return u._isInitialized=!0,u.trigger=t,u.centered=t.hasAttribute(W7),u.disabled=t.hasAttribute(HU),this.attachRipple(t,u),u}attachRipple(t,s){t.removeAttribute(U8),this._hosts.set(t,s)}destroyRipple(t){const s=this._hosts.get(t);s&&(s.ngOnDestroy(),this._hosts.delete(t))}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),KZ=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=no({type:e,selectors:[["div","mat-internal-form-field",""]],hostAttrs:[1,"mdc-form-field","mat-internal-form-field"],hostVars:2,hostBindings:function(s,c){2&s&&nt("mdc-form-field--align-end","before"===c.labelPosition)},inputs:{labelPosition:"labelPosition"},standalone:!0,features:[fo],attrs:OZ,ngContentSelectors:NZ,decls:1,vars:0,template:function(s,c){1&s&&(wf(),uo(0))},styles:[".mat-internal-form-field{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:inline-flex;align-items:center;vertical-align:middle}.mat-internal-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mat-internal-form-field>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end .mdc-form-field--align-end label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0}"],encapsulation:2,changeDetection:0})}}return e})();const qZ=["mat-button",""],YZ=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],$Z=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"],XZ=new Te("MAT_BUTTON_CONFIG"),ZZ=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab-base","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mat-mdc-fab-base","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}];let JZ=(()=>{class e{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(t){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,t)}get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=t,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(t){this._disabled=t,this._updateRippleDisabled()}constructor(t,s,c,u){this._elementRef=t,this._platform=s,this._ngZone=c,this._animationMode=u,this._focusMonitor=me(L8),this._rippleLoader=me(zZ),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;const f=me(XZ,{optional:!0}),_=t.nativeElement,E=_.classList;this.disabledInteractive=f?.disabledInteractive??!1,this.color=f?.color??null,this._rippleLoader?.configureRipple(_,{className:"mat-mdc-button-ripple"});for(const{attribute:S,mdcClasses:I}of ZZ)_.hasAttribute(S)&&E.add(...I)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(t="program",s){t?this._focusMonitor.focusVia(this._elementRef.nativeElement,t,s):this._elementRef.nativeElement.focus(s)}_getAriaDisabled(){return null!=this.ariaDisabled?this.ariaDisabled:!(!this.disabled||!this.disabledInteractive)||null}_getDisabledAttribute(){return!(this.disabledInteractive||!this.disabled)||null}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}static{this.\u0275fac=function(s){!function BM(){throw new Error("invalid")}()}}static{this.\u0275dir=Ue({type:e,inputs:{color:"color",disableRipple:[2,"disableRipple","disableRipple",zr],disabled:[2,"disabled","disabled",zr],ariaDisabled:[2,"aria-disabled","ariaDisabled",zr],disabledInteractive:[2,"disabledInteractive","disabledInteractive",zr]},features:[Jg]})}}return e})(),QZ=(()=>{class e extends JZ{constructor(t,s,c,u){super(t,s,c,u)}static{this.\u0275fac=function(s){return new(s||e)(re(On),re(Ho),re(ft),re(tl,8))}}static{this.\u0275cmp=no({type:e,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(s,c){2&s&&(Ji("disabled",c._getDisabledAttribute())("aria-disabled",c._getAriaDisabled()),Qb(c.color?"mat-"+c.color:""),nt("mat-mdc-button-disabled",c.disabled)("mat-mdc-button-disabled-interactive",c.disabledInteractive)("_mat-animation-noopable","NoopAnimations"===c._animationMode)("mat-unthemed",!c.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[tn,fo],attrs:qZ,ngContentSelectors:$Z,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(s,c){1&s&&(wf(YZ),At(0,"span",0),uo(1),Se(2,"span",1),uo(3,1),Be(),uo(4,2),At(5,"span",2)(6,"span",3)),2&s&&nt("mdc-button__ripple",!c._isFab)("mdc-fab__ripple",c._isFab)},styles:['.mat-mdc-button-base{text-decoration:none}.mdc-button{-webkit-user-select:none;user-select:none;position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0);padding:0 8px}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__label{position:relative}.mat-mdc-button{padding:0 var(--mat-text-button-horizontal-padding, 8px);height:var(--mdc-text-button-container-height);font-family:var(--mdc-text-button-label-text-font, var(--mat-app-label-large-font));font-size:var(--mdc-text-button-label-text-size, var(--mat-app-label-large-size));letter-spacing:var(--mdc-text-button-label-text-tracking, var(--mat-app-label-large-tracking));text-transform:var(--mdc-text-button-label-text-transform);font-weight:var(--mdc-text-button-label-text-weight, var(--mat-app-label-large-weight))}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 8px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color, var(--mat-app-primary))}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color, var(--mat-app-on-surface-variant))}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity, var(--mat-app-hover-state-layer-opacity))}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity, var(--mat-app-focus-state-layer-opacity))}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity, var(--mat-app-pressed-state-layer-opacity))}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display)}.mat-mdc-button,.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape, var(--mat-app-corner-full))}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color, var(--mat-app-primary))}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 var(--mat-filled-button-horizontal-padding, 16px);height:var(--mdc-filled-button-container-height);font-family:var(--mdc-filled-button-label-text-font, var(--mat-app-label-large-font));font-size:var(--mdc-filled-button-label-text-size, var(--mat-app-label-large-size));letter-spacing:var(--mdc-filled-button-label-text-tracking, var(--mat-app-label-large-tracking));text-transform:var(--mdc-filled-button-label-text-transform);font-weight:var(--mdc-filled-button-label-text-weight, var(--mat-app-label-large-weight))}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color, var(--mat-app-on-primary))}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color, var(--mat-app-on-surface-variant))}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity, var(--mat-app-hover-state-layer-opacity))}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity, var(--mat-app-focus-state-layer-opacity))}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity, var(--mat-app-pressed-state-layer-opacity))}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color, var(--mat-app-on-primary));background-color:var(--mdc-filled-button-container-color, var(--mat-app-primary))}.mat-mdc-unelevated-button,.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape, var(--mat-app-corner-full))}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 var(--mat-protected-button-horizontal-padding, 16px);box-shadow:var(--mdc-protected-button-container-elevation-shadow, var(--mat-app-level1));height:var(--mdc-protected-button-container-height);font-family:var(--mdc-protected-button-label-text-font, var(--mat-app-label-large-font));font-size:var(--mdc-protected-button-label-text-size, var(--mat-app-label-large-size));letter-spacing:var(--mdc-protected-button-label-text-tracking, var(--mat-app-label-large-tracking));text-transform:var(--mdc-protected-button-label-text-transform);font-weight:var(--mdc-protected-button-label-text-weight, var(--mat-app-label-large-weight))}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color, var(--mat-app-primary))}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color, var(--mat-app-on-surface-variant))}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity, var(--mat-app-hover-state-layer-opacity))}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity, var(--mat-app-focus-state-layer-opacity))}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity, var(--mat-app-pressed-state-layer-opacity))}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color, var(--mat-app-primary));background-color:var(--mdc-protected-button-container-color, var(--mat-app-surface))}.mat-mdc-raised-button,.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape, var(--mat-app-corner-full))}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow, var(--mat-app-level2))}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow, var(--mat-app-level1))}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow, var(--mat-app-level1))}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow, var(--mat-app-level0))}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 var(--mat-outlined-button-horizontal-padding, 15px);height:var(--mdc-outlined-button-container-height);font-family:var(--mdc-outlined-button-label-text-font, var(--mat-app-label-large-font));font-size:var(--mdc-outlined-button-label-text-size, var(--mat-app-label-large-size));letter-spacing:var(--mdc-outlined-button-label-text-tracking, var(--mat-app-label-large-tracking));text-transform:var(--mdc-outlined-button-label-text-transform);font-weight:var(--mdc-outlined-button-label-text-weight, var(--mat-app-label-large-weight));border-radius:var(--mdc-outlined-button-container-shape, var(--mat-app-corner-full));border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color, var(--mat-app-primary))}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color, var(--mat-app-on-surface-variant))}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity, var(--mat-app-hover-state-layer-opacity))}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity, var(--mat-app-focus-state-layer-opacity))}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity, var(--mat-app-pressed-state-layer-opacity))}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color, var(--mat-app-primary));border-color:var(--mdc-outlined-button-outline-color, var(--mat-app-outline))}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button .mdc-button__ripple{border-width:var(--mdc-outlined-button-outline-width);border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-button .mat-icon,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-unelevated-button .mat-icon,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-raised-button .mat-icon,.mat-mdc-outlined-button .mdc-button__label,.mat-mdc-outlined-button .mat-icon{z-index:1;position:relative}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0})}}return e})(),tJ=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({imports:[Fc,WZ,Fc]})}}return e})();const z7=tT({passive:!0});let nJ=(()=>{class e{constructor(t,s){this._platform=t,this._ngZone=s,this._monitoredElements=new Map}monitor(t){if(!this._platform.isBrowser)return Fi;const s=_m(t),c=this._monitoredElements.get(s);if(c)return c.subject;const u=new Mt,f="cdk-text-field-autofilled",_=E=>{"cdk-text-field-autofill-start"!==E.animationName||s.classList.contains(f)?"cdk-text-field-autofill-end"===E.animationName&&s.classList.contains(f)&&(s.classList.remove(f),this._ngZone.run(()=>u.next({target:E.target,isAutofilled:!1}))):(s.classList.add(f),this._ngZone.run(()=>u.next({target:E.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{s.addEventListener("animationstart",_,z7),s.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(s,{subject:u,unlisten:()=>{s.removeEventListener("animationstart",_,z7)}}),u}stopMonitoring(t){const s=_m(t),c=this._monitoredElements.get(s);c&&(c.unlisten(),c.subject.complete(),s.classList.remove("cdk-text-field-autofill-monitored"),s.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(s))}ngOnDestroy(){this._monitoredElements.forEach((t,s)=>this.stopMonitoring(s))}static{this.\u0275fac=function(s){return new(s||e)(ye(Ho),ye(ft))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),iJ=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({})}}return e})();function K7(...e){const i=Qf(e),t=function JD(e,i){return"number"==typeof AC(e)?e.pop():i}(e,1/0),s=e;return s.length?1===s.length?qr(s[0]):Ha(t)(Lr(s,i)):Fi}class rJ extends Mt{constructor(i=1/0,t=1/0,s=s8){super(),this._bufferSize=i,this._windowTime=t,this._timestampProvider=s,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,i),this._windowTime=Math.max(1,t)}next(i){const{isStopped:t,_buffer:s,_infiniteTimeWindow:c,_timestampProvider:u,_windowTime:f}=this;t||(s.push(i),!c&&s.push(u.now()+f)),this._trimBuffer(),super.next(i)}_subscribe(i){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(i),{_infiniteTimeWindow:s,_buffer:c}=this,u=c.slice();for(let f=0;f<u.length&&!i.closed;f+=s?1:2)i.next(u[f]);return this._checkFinalizedStatuses(i),t}_trimBuffer(){const{_bufferSize:i,_timestampProvider:t,_buffer:s,_infiniteTimeWindow:c}=this,u=(c?1:2)*i;if(i<1/0&&u<s.length&&s.splice(0,s.length-u),!c){const f=t.now();let _=0;for(let E=1;E<s.length&&s[E]<=f;E+=2)_=E;_&&s.splice(0,_+1)}}}function B8(e,i,...t){if(!0===i)return void e();if(!1===i)return;const s=new ip({next:()=>{s.unsubscribe(),e()}});return qr(i(...t)).subscribe(s)}class aJ{constructor(i){this._box=i,this._destroyed=new Mt,this._resizeSubject=new Mt,this._elementObservables=new Map,typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(t=>this._resizeSubject.next(t)))}observe(i){return this._elementObservables.has(i)||this._elementObservables.set(i,new ni(t=>{const s=this._resizeSubject.subscribe(t);return this._resizeObserver?.observe(i,{box:this._box}),()=>{this._resizeObserver?.unobserve(i),s.unsubscribe(),this._elementObservables.delete(i)}}).pipe(Ns(t=>t.some(s=>s.target===i)),function sJ(e,i,t){let s,c=!1;return e&&"object"==typeof e?({bufferSize:s=1/0,windowTime:i=1/0,refCount:c=!1,scheduler:t}=e):s=e??1/0,function oJ(e={}){const{connector:i=()=>new Mt,resetOnError:t=!0,resetOnComplete:s=!0,resetOnRefCountZero:c=!0}=e;return u=>{let f,_,E,S=0,I=!1,P=!1;const U=()=>{_?.unsubscribe(),_=void 0},B=()=>{U(),f=E=void 0,I=P=!1},G=()=>{const K=f;B(),K?.unsubscribe()};return yi((K,te)=>{S++,!P&&!I&&U();const ae=E=E??i();te.add(()=>{S--,0===S&&!P&&!I&&(_=B8(G,c))}),ae.subscribe(te),!f&&S>0&&(f=new ip({next:ne=>ae.next(ne),error:ne=>{P=!0,U(),_=B8(B,t,ne),ae.error(ne)},complete:()=>{I=!0,U(),_=B8(B,s),ae.complete()}}),qr(K).subscribe(f))})(u)}}({connector:()=>new rJ(s,i,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:c})}({bufferSize:1,refCount:!0}),Tr(this._destroyed))),this._elementObservables.get(i)}destroy(){this._destroyed.next(),this._destroyed.complete(),this._resizeSubject.complete(),this._elementObservables.clear()}}let cJ=(()=>{class e{constructor(){this._observers=new Map,this._ngZone=me(ft)}ngOnDestroy(){for(const[,t]of this._observers)t.destroy();this._observers.clear()}observe(t,s){const c=s?.box||"content-box";return this._observers.has(c)||this._observers.set(c,new aJ(c)),this._observers.get(c).observe(t)}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const lJ=["notch"],dJ=["matFormFieldNotchedOutline",""],uJ=["*"],hJ=["textField"],pJ=["iconPrefixContainer"],fJ=["textPrefixContainer"],mJ=["iconSuffixContainer"],gJ=["textSuffixContainer"],_J=["*",[["mat-label"]],[["","matPrefix",""],["","matIconPrefix",""]],[["","matTextPrefix",""]],[["","matTextSuffix",""]],[["","matSuffix",""],["","matIconSuffix",""]],[["mat-error"],["","matError",""]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],vJ=["*","mat-label","[matPrefix], [matIconPrefix]","[matTextPrefix]","[matTextSuffix]","[matSuffix], [matIconSuffix]","mat-error, [matError]","mat-hint:not([align='end'])","mat-hint[align='end']"];function EJ(e,i){1&e&&At(0,"span",21)}function yJ(e,i){if(1&e&&(Se(0,"label",20),uo(1,1),Si(2,EJ,1,0,"span",21),Be()),2&e){const t=Sn(2);$e("floating",t._shouldLabelFloat())("monitorResize",t._hasOutline())("id",t._labelId),Ji("for",t._control.disableAutomaticLabeling?null:t._control.id),Ze(2),st(!t.hideRequiredMarker&&t._control.required?2:-1)}}function bJ(e,i){1&e&&Si(0,yJ,3,5,"label",20),2&e&&st(Sn()._hasFloatingLabel()?0:-1)}function SJ(e,i){1&e&&At(0,"div",7)}function CJ(e,i){}function TJ(e,i){1&e&&Si(0,CJ,0,0,"ng-template",13),2&e&&(Sn(2),$e("ngTemplateOutlet",we(1)))}function IJ(e,i){if(1&e&&(Se(0,"div",9),Si(1,TJ,1,1,null,13),Be()),2&e){const t=Sn();$e("matFormFieldNotchedOutlineOpen",t._shouldLabelFloat()),Ze(),st(t._forceDisplayInfixLabel()?-1:1)}}function wJ(e,i){1&e&&(Se(0,"div",10,2),uo(2,2),Be())}function RJ(e,i){1&e&&(Se(0,"div",11,3),uo(2,3),Be())}function AJ(e,i){}function DJ(e,i){1&e&&Si(0,AJ,0,0,"ng-template",13),2&e&&(Sn(),$e("ngTemplateOutlet",we(1)))}function OJ(e,i){1&e&&(Se(0,"div",14,4),uo(2,4),Be())}function NJ(e,i){1&e&&(Se(0,"div",15,5),uo(2,5),Be())}function PJ(e,i){1&e&&At(0,"div",16)}function MJ(e,i){1&e&&(Se(0,"div",18),uo(1,6),Be()),2&e&&$e("@transitionMessages",Sn()._subscriptAnimationState)}function kJ(e,i){if(1&e&&(Se(0,"mat-hint",22),fn(1),Be()),2&e){const t=Sn(2);$e("id",t._hintLabelId),Ze(),at(t.hintLabel)}}function LJ(e,i){if(1&e&&(Se(0,"div",19),Si(1,kJ,2,2,"mat-hint",22),uo(2,7),At(3,"div",23),uo(4,8),Be()),2&e){const t=Sn();$e("@transitionMessages",t._subscriptAnimationState),Ze(),st(t.hintLabel?1:-1)}}let j8=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275dir=Ue({type:e,selectors:[["mat-label"]],standalone:!0})}}return e})();const xJ=new Te("MatError");let FJ=0,q7=(()=>{class e{constructor(){this.align="start",this.id="mat-mdc-hint-"+FJ++}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275dir=Ue({type:e,selectors:[["mat-hint"]],hostAttrs:[1,"mat-mdc-form-field-hint","mat-mdc-form-field-bottom-align"],hostVars:4,hostBindings:function(s,c){2&s&&(b_("id",c.id),Ji("align",null),nt("mat-mdc-form-field-hint-end","end"===c.align))},inputs:{align:"align",id:"id"},standalone:!0})}}return e})();const UJ=new Te("MatPrefix"),VJ=new Te("MatSuffix"),Y7=new Te("FloatingLabelParent");let $7=(()=>{class e{get floating(){return this._floating}set floating(t){this._floating=t,this.monitorResize&&this._handleResize()}get monitorResize(){return this._monitorResize}set monitorResize(t){this._monitorResize=t,this._monitorResize?this._subscribeToResize():this._resizeSubscription.unsubscribe()}constructor(t){this._elementRef=t,this._floating=!1,this._monitorResize=!1,this._resizeObserver=me(cJ),this._ngZone=me(ft),this._parent=me(Y7),this._resizeSubscription=new Ri}ngOnDestroy(){this._resizeSubscription.unsubscribe()}getWidth(){return function BJ(e){if(null!==e.offsetParent)return e.scrollWidth;const t=e.cloneNode(!0);t.style.setProperty("position","absolute"),t.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(t);const s=t.scrollWidth;return t.remove(),s}(this._elementRef.nativeElement)}get element(){return this._elementRef.nativeElement}_handleResize(){setTimeout(()=>this._parent._handleLabelResized())}_subscribeToResize(){this._resizeSubscription.unsubscribe(),this._ngZone.runOutsideAngular(()=>{this._resizeSubscription=this._resizeObserver.observe(this._elementRef.nativeElement,{box:"border-box"}).subscribe(()=>this._handleResize())})}static{this.\u0275fac=function(s){return new(s||e)(re(On))}}static{this.\u0275dir=Ue({type:e,selectors:[["label","matFormFieldFloatingLabel",""]],hostAttrs:[1,"mdc-floating-label","mat-mdc-floating-label"],hostVars:2,hostBindings:function(s,c){2&s&&nt("mdc-floating-label--float-above",c.floating)},inputs:{floating:"floating",monitorResize:"monitorResize"},standalone:!0})}}return e})();const X7="mdc-line-ripple--active",GU="mdc-line-ripple--deactivating";let Z7=(()=>{class e{constructor(t,s){this._elementRef=t,this._handleTransitionEnd=c=>{const u=this._elementRef.nativeElement.classList,f=u.contains(GU);"opacity"===c.propertyName&&f&&u.remove(X7,GU)},s.runOutsideAngular(()=>{t.nativeElement.addEventListener("transitionend",this._handleTransitionEnd)})}activate(){const t=this._elementRef.nativeElement.classList;t.remove(GU),t.add(X7)}deactivate(){this._elementRef.nativeElement.classList.add(GU)}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._handleTransitionEnd)}static{this.\u0275fac=function(s){return new(s||e)(re(On),re(ft))}}static{this.\u0275dir=Ue({type:e,selectors:[["div","matFormFieldLineRipple",""]],hostAttrs:[1,"mdc-line-ripple"],standalone:!0})}}return e})(),J7=(()=>{class e{constructor(t,s){this._elementRef=t,this._ngZone=s,this.open=!1}ngAfterViewInit(){const t=this._elementRef.nativeElement.querySelector(".mdc-floating-label");t?(this._elementRef.nativeElement.classList.add("mdc-notched-outline--upgraded"),"function"==typeof requestAnimationFrame&&(t.style.transitionDuration="0s",this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>t.style.transitionDuration="")}))):this._elementRef.nativeElement.classList.add("mdc-notched-outline--no-label")}_setNotchWidth(t){this._notch.nativeElement.style.width=this.open&&t?`calc(${t}px * var(--mat-mdc-form-field-floating-label-scale, 0.75) + 9px)`:""}static{this.\u0275fac=function(s){return new(s||e)(re(On),re(ft))}}static{this.\u0275cmp=no({type:e,selectors:[["div","matFormFieldNotchedOutline",""]],viewQuery:function(s,c){if(1&s&&pe(lJ,5),2&s){let u;dr(u=kn())&&(c._notch=u.first)}},hostAttrs:[1,"mdc-notched-outline"],hostVars:2,hostBindings:function(s,c){2&s&&nt("mdc-notched-outline--notched",c.open)},inputs:{open:[0,"matFormFieldNotchedOutlineOpen","open"]},standalone:!0,features:[fo],attrs:dJ,ngContentSelectors:uJ,decls:5,vars:0,consts:[["notch",""],[1,"mat-mdc-notch-piece","mdc-notched-outline__leading"],[1,"mat-mdc-notch-piece","mdc-notched-outline__notch"],[1,"mat-mdc-notch-piece","mdc-notched-outline__trailing"]],template:function(s,c){1&s&&(wf(),At(0,"div",1),Se(1,"div",2,0),uo(3),Be(),At(4,"div",3))},encapsulation:2,changeDetection:0})}}return e})();const jJ={transitionMessages:P6("transitionMessages",[M6("enter",su({opacity:1,transform:"translateY(0%)"})),TO("void => enter",[su({opacity:0,transform:"translateY(-5px)"}),CO("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])};let Q7=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275dir=Ue({type:e})}}return e})();const eK=new Te("MatFormField"),HJ=new Te("MAT_FORM_FIELD_DEFAULT_OPTIONS");let tK=0,zJ=(()=>{class e{get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(t){this._hideRequiredMarker=nT(t)}get floatLabel(){return this._floatLabel||this._defaults?.floatLabel||"auto"}set floatLabel(t){t!==this._floatLabel&&(this._floatLabel=t,this._changeDetectorRef.markForCheck())}get appearance(){return this._appearance}set appearance(t){const s=this._appearance;this._appearance=t||this._defaults?.appearance||"fill","outline"===this._appearance&&this._appearance!==s&&(this._needsOutlineLabelOffsetUpdate=!0)}get subscriptSizing(){return this._subscriptSizing||this._defaults?.subscriptSizing||"fixed"}set subscriptSizing(t){this._subscriptSizing=t||this._defaults?.subscriptSizing||"fixed"}get hintLabel(){return this._hintLabel}set hintLabel(t){this._hintLabel=t,this._processHints()}get _control(){return this._explicitFormFieldControl||this._formFieldControl}set _control(t){this._explicitFormFieldControl=t}constructor(t,s,c,u,f,_,E,S){this._elementRef=t,this._changeDetectorRef=s,this._dir=u,this._platform=f,this._defaults=_,this._animationMode=E,this._labelChild=Dw(j8),this._hideRequiredMarker=!1,this.color="primary",this._appearance="fill",this._subscriptSizing=null,this._hintLabel="",this._hasIconPrefix=!1,this._hasTextPrefix=!1,this._hasIconSuffix=!1,this._hasTextSuffix=!1,this._labelId="mat-mdc-form-field-label-"+tK++,this._hintLabelId="mat-mdc-hint-"+tK++,this._subscriptAnimationState="",this._destroyed=new Mt,this._isFocused=null,this._needsOutlineLabelOffsetUpdate=!1,this._previousControl=null,this._injector=me(Oi),this.getLabelId=Ud(()=>this._hasFloatingLabel()?this._labelId:null),this._hasFloatingLabel=Ud(()=>!!this._labelChild()),_&&(_.appearance&&(this.appearance=_.appearance),this._hideRequiredMarker=!!_?.hideRequiredMarker,_.color&&(this.color=_.color))}ngAfterViewInit(){this._updateFocusState(),this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngAfterContentInit(){this._assertFormFieldControl(),this._initializeSubscript(),this._initializePrefixAndSuffix(),this._initializeOutlineLabelOffsetSubscriptions()}ngAfterContentChecked(){this._assertFormFieldControl(),this._control!==this._previousControl&&(this._initializeControl(this._previousControl),this._previousControl=this._control)}ngOnDestroy(){this._stateChanges?.unsubscribe(),this._valueChanges?.unsubscribe(),this._destroyed.next(),this._destroyed.complete()}getConnectedOverlayOrigin(){return this._textField||this._elementRef}_animateAndLockLabel(){this._hasFloatingLabel()&&(this.floatLabel="always")}_initializeControl(t){const s=this._control,c="mat-mdc-form-field-type-";t&&this._elementRef.nativeElement.classList.remove(c+t.controlType),s.controlType&&this._elementRef.nativeElement.classList.add(c+s.controlType),this._stateChanges?.unsubscribe(),this._stateChanges=s.stateChanges.subscribe(()=>{this._updateFocusState(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._valueChanges?.unsubscribe(),s.ngControl&&s.ngControl.valueChanges&&(this._valueChanges=s.ngControl.valueChanges.pipe(Tr(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()))}_checkPrefixAndSuffixTypes(){this._hasIconPrefix=!!this._prefixChildren.find(t=>!t._isText),this._hasTextPrefix=!!this._prefixChildren.find(t=>t._isText),this._hasIconSuffix=!!this._suffixChildren.find(t=>!t._isText),this._hasTextSuffix=!!this._suffixChildren.find(t=>t._isText)}_initializePrefixAndSuffix(){this._checkPrefixAndSuffixTypes(),K7(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._checkPrefixAndSuffixTypes(),this._changeDetectorRef.markForCheck()})}_initializeSubscript(){this._hintChildren.changes.subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._validateHints(),this._syncDescribedByIds()}_assertFormFieldControl(){}_updateFocusState(){this._control.focused&&!this._isFocused?(this._isFocused=!0,this._lineRipple?.activate()):!this._control.focused&&(this._isFocused||null===this._isFocused)&&(this._isFocused=!1,this._lineRipple?.deactivate()),this._textField?.nativeElement.classList.toggle("mdc-text-field--focused",this._control.focused)}_initializeOutlineLabelOffsetSubscriptions(){this._prefixChildren.changes.subscribe(()=>this._needsOutlineLabelOffsetUpdate=!0),eh(()=>{this._needsOutlineLabelOffsetUpdate&&(this._needsOutlineLabelOffsetUpdate=!1,this._updateOutlineLabelOffset())},{injector:this._injector}),this._dir.change.pipe(Tr(this._destroyed)).subscribe(()=>this._needsOutlineLabelOffsetUpdate=!0)}_shouldAlwaysFloat(){return"always"===this.floatLabel}_hasOutline(){return"outline"===this.appearance}_forceDisplayInfixLabel(){return!this._platform.isBrowser&&this._prefixChildren.length&&!this._shouldLabelFloat()}_shouldLabelFloat(){return!!this._hasFloatingLabel()&&(this._control.shouldLabelFloat||this._shouldAlwaysFloat())}_shouldForward(t){const s=this._control?this._control.ngControl:null;return s&&s[t]}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_handleLabelResized(){this._refreshOutlineNotchWidth()}_refreshOutlineNotchWidth(){this._hasOutline()&&this._floatingLabel&&this._shouldLabelFloat()?this._notchedOutline?._setNotchWidth(this._floatingLabel.getWidth()):this._notchedOutline?._setNotchWidth(0)}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){}_syncDescribedByIds(){if(this._control){let t=[];if(this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&t.push(...this._control.userAriaDescribedBy.split(" ")),"hint"===this._getDisplayedMessages()){const s=this._hintChildren?this._hintChildren.find(u=>"start"===u.align):null,c=this._hintChildren?this._hintChildren.find(u=>"end"===u.align):null;s?t.push(s.id):this._hintLabel&&t.push(this._hintLabelId),c&&t.push(c.id)}else this._errorChildren&&t.push(...this._errorChildren.map(s=>s.id));this._control.setDescribedByIds(t)}}_updateOutlineLabelOffset(){if(!this._hasOutline()||!this._floatingLabel)return;const t=this._floatingLabel.element;if(!this._iconPrefixContainer&&!this._textPrefixContainer)return void(t.style.transform="");if(!this._isAttachedToDom())return void(this._needsOutlineLabelOffsetUpdate=!0);const s=this._iconPrefixContainer?.nativeElement,c=this._textPrefixContainer?.nativeElement,u=this._iconSuffixContainer?.nativeElement,f=this._textSuffixContainer?.nativeElement,_=s?.getBoundingClientRect().width??0,E=c?.getBoundingClientRect().width??0,S=u?.getBoundingClientRect().width??0,I=f?.getBoundingClientRect().width??0;t.style.transform=`var(\n        --mat-mdc-form-field-label-transform,\n        translateY(-50%) translateX(calc(${"rtl"===this._dir.value?"-1":"1"} * (${_+E}px + var(--mat-mdc-form-field-label-offset-x, 0px))))\n    )`,this._elementRef.nativeElement.style.setProperty("--mat-form-field-notch-max-width",`calc(100% - ${_+E+S+I}px)`)}_isAttachedToDom(){const t=this._elementRef.nativeElement;if(t.getRootNode){const s=t.getRootNode();return s&&s!==t}return document.documentElement.contains(t)}static{this.\u0275fac=function(s){return new(s||e)(re(On),re(Js),re(ft),re(F8),re(Ho),re(HJ,8),re(tl,8),re(Ve))}}static{this.\u0275cmp=no({type:e,selectors:[["mat-form-field"]],contentQueries:function(s,c,u){if(1&s&&(R_(u,c._labelChild,j8,5),fh(u,Q7,5),fh(u,UJ,5),fh(u,VJ,5),fh(u,xJ,5),fh(u,q7,5)),2&s){let f;(function Ts(e=1){oy(p0()+e)})(),dr(f=kn())&&(c._formFieldControl=f.first),dr(f=kn())&&(c._prefixChildren=f),dr(f=kn())&&(c._suffixChildren=f),dr(f=kn())&&(c._errorChildren=f),dr(f=kn())&&(c._hintChildren=f)}},viewQuery:function(s,c){if(1&s&&(pe(hJ,5),pe(pJ,5),pe(fJ,5),pe(mJ,5),pe(gJ,5),pe($7,5),pe(J7,5),pe(Z7,5)),2&s){let u;dr(u=kn())&&(c._textField=u.first),dr(u=kn())&&(c._iconPrefixContainer=u.first),dr(u=kn())&&(c._textPrefixContainer=u.first),dr(u=kn())&&(c._iconSuffixContainer=u.first),dr(u=kn())&&(c._textSuffixContainer=u.first),dr(u=kn())&&(c._floatingLabel=u.first),dr(u=kn())&&(c._notchedOutline=u.first),dr(u=kn())&&(c._lineRipple=u.first)}},hostAttrs:[1,"mat-mdc-form-field"],hostVars:42,hostBindings:function(s,c){2&s&&nt("mat-mdc-form-field-label-always-float",c._shouldAlwaysFloat())("mat-mdc-form-field-has-icon-prefix",c._hasIconPrefix)("mat-mdc-form-field-has-icon-suffix",c._hasIconSuffix)("mat-form-field-invalid",c._control.errorState)("mat-form-field-disabled",c._control.disabled)("mat-form-field-autofilled",c._control.autofilled)("mat-form-field-no-animations","NoopAnimations"===c._animationMode)("mat-form-field-appearance-fill","fill"==c.appearance)("mat-form-field-appearance-outline","outline"==c.appearance)("mat-form-field-hide-placeholder",c._hasFloatingLabel()&&!c._shouldLabelFloat())("mat-focused",c._control.focused)("mat-primary","accent"!==c.color&&"warn"!==c.color)("mat-accent","accent"===c.color)("mat-warn","warn"===c.color)("ng-untouched",c._shouldForward("untouched"))("ng-touched",c._shouldForward("touched"))("ng-pristine",c._shouldForward("pristine"))("ng-dirty",c._shouldForward("dirty"))("ng-valid",c._shouldForward("valid"))("ng-invalid",c._shouldForward("invalid"))("ng-pending",c._shouldForward("pending"))},inputs:{hideRequiredMarker:"hideRequiredMarker",color:"color",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",hintLabel:"hintLabel"},exportAs:["matFormField"],standalone:!0,features:[mn([{provide:eK,useExisting:e},{provide:Y7,useExisting:e}]),fo],ngContentSelectors:vJ,decls:18,vars:21,consts:[["labelTemplate",""],["textField",""],["iconPrefixContainer",""],["textPrefixContainer",""],["textSuffixContainer",""],["iconSuffixContainer",""],[1,"mat-mdc-text-field-wrapper","mdc-text-field",3,"click"],[1,"mat-mdc-form-field-focus-overlay"],[1,"mat-mdc-form-field-flex"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen"],[1,"mat-mdc-form-field-icon-prefix"],[1,"mat-mdc-form-field-text-prefix"],[1,"mat-mdc-form-field-infix"],[3,"ngTemplateOutlet"],[1,"mat-mdc-form-field-text-suffix"],[1,"mat-mdc-form-field-icon-suffix"],["matFormFieldLineRipple",""],[1,"mat-mdc-form-field-subscript-wrapper","mat-mdc-form-field-bottom-align"],[1,"mat-mdc-form-field-error-wrapper"],[1,"mat-mdc-form-field-hint-wrapper"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id"],["aria-hidden","true",1,"mat-mdc-form-field-required-marker","mdc-floating-label--required"],[3,"id"],[1,"mat-mdc-form-field-hint-spacer"]],template:function(s,c){if(1&s){const u=yc();wf(_J),Si(0,bJ,1,1,"ng-template",null,0,wL),Se(2,"div",6,1),Mn("click",function(_){return Zo(u),oo(c._control.onContainerClick(_))}),Si(4,SJ,1,0,"div",7),Se(5,"div",8),Si(6,IJ,2,2,"div",9)(7,wJ,3,0,"div",10)(8,RJ,3,0,"div",11),Se(9,"div",12),Si(10,DJ,1,1,null,13),uo(11),Be(),Si(12,OJ,3,0,"div",14)(13,NJ,3,0,"div",15),Be(),Si(14,PJ,1,0,"div",16),Be(),Se(15,"div",17),Si(16,MJ,2,1,"div",18)(17,LJ,5,2,"div",19),Be()}if(2&s){let u;Ze(2),nt("mdc-text-field--filled",!c._hasOutline())("mdc-text-field--outlined",c._hasOutline())("mdc-text-field--no-label",!c._hasFloatingLabel())("mdc-text-field--disabled",c._control.disabled)("mdc-text-field--invalid",c._control.errorState),Ze(2),st(c._hasOutline()||c._control.disabled?-1:4),Ze(2),st(c._hasOutline()?6:-1),Ze(),st(c._hasIconPrefix?7:-1),Ze(),st(c._hasTextPrefix?8:-1),Ze(2),st(!c._hasOutline()||c._forceDisplayInfixLabel()?10:-1),Ze(2),st(c._hasTextSuffix?12:-1),Ze(),st(c._hasIconSuffix?13:-1),Ze(),st(c._hasOutline()?-1:14),Ze(),nt("mat-mdc-form-field-subscript-dynamic-size","dynamic"===c.subscriptSizing),Ze(),st("error"===(u=c._getDisplayedMessages())?16:"hint"===u?17:-1)}},dependencies:[$7,J7,dD,Z7,q7],styles:['.mdc-text-field{display:inline-flex;align-items:baseline;padding:0 16px;position:relative;box-sizing:border-box;overflow:hidden;will-change:opacity,transform,color;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:0;border-bottom-left-radius:0}.mdc-text-field__input{width:100%;min-width:0;border:none;border-radius:0;background:none;padding:0;-moz-appearance:none;-webkit-appearance:none;height:28px}.mdc-text-field__input::-webkit-calendar-picker-indicator{display:none}.mdc-text-field__input::-ms-clear{display:none}.mdc-text-field__input:focus{outline:none}.mdc-text-field__input:invalid{box-shadow:none}.mdc-text-field__input::placeholder{opacity:0}.mdc-text-field__input::-moz-placeholder{opacity:0}.mdc-text-field__input::-webkit-input-placeholder{opacity:0}.mdc-text-field__input:-ms-input-placeholder{opacity:0}.mdc-text-field--no-label .mdc-text-field__input::placeholder,.mdc-text-field--focused .mdc-text-field__input::placeholder{opacity:1}.mdc-text-field--no-label .mdc-text-field__input::-moz-placeholder,.mdc-text-field--focused .mdc-text-field__input::-moz-placeholder{opacity:1}.mdc-text-field--no-label .mdc-text-field__input::-webkit-input-placeholder,.mdc-text-field--focused .mdc-text-field__input::-webkit-input-placeholder{opacity:1}.mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{opacity:1}.mdc-text-field--outlined .mdc-text-field__input,.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{height:100%}.mdc-text-field--outlined .mdc-text-field__input{display:flex;border:none !important;background-color:rgba(0,0,0,0)}.mdc-text-field--disabled .mdc-text-field__input{pointer-events:auto}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-filled-text-field-input-text-color, var(--mat-app-on-surface));caret-color:var(--mdc-filled-text-field-caret-color, var(--mat-app-primary))}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color, var(--mat-app-on-surface-variant))}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::-moz-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color, var(--mat-app-on-surface-variant))}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::-webkit-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color, var(--mat-app-on-surface-variant))}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color, var(--mat-app-on-surface-variant))}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-error-caret-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-filled-text-field-disabled-input-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-outlined-text-field-input-text-color, var(--mat-app-on-surface));caret-color:var(--mdc-outlined-text-field-caret-color, var(--mat-app-primary))}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color, var(--mat-app-on-surface-variant))}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::-moz-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color, var(--mat-app-on-surface-variant))}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::-webkit-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color, var(--mat-app-on-surface-variant))}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color, var(--mat-app-on-surface-variant))}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-error-caret-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-outlined-text-field-disabled-input-text-color)}.mdc-text-field--disabled .cdk-high-contrast-active .mdc-text-field__input{background-color:Window}.mdc-text-field--filled{height:56px;border-bottom-right-radius:0;border-bottom-left-radius:0;border-top-left-radius:var(--mdc-filled-text-field-container-shape, var(--mat-app-corner-extra-small-top));border-top-right-radius:var(--mdc-filled-text-field-container-shape, var(--mat-app-corner-extra-small-top))}.mdc-text-field--filled:not(.mdc-text-field--disabled){background-color:var(--mdc-filled-text-field-container-color, var(--mat-app-surface-variant))}.mdc-text-field--filled.mdc-text-field--disabled{background-color:var(--mdc-filled-text-field-disabled-container-color)}.mdc-text-field--outlined{height:56px;overflow:visible;padding-right:max(16px,var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small)));padding-left:max(16px,var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small)) + 4px)}[dir=rtl] .mdc-text-field--outlined{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small)) + 4px);padding-left:max(16px,var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small)))}.mdc-floating-label{position:absolute;left:0;transform-origin:left top;line-height:1.15rem;text-align:left;text-overflow:ellipsis;white-space:nowrap;cursor:text;overflow:hidden;will-change:transform}[dir=rtl] .mdc-floating-label{right:0;left:auto;transform-origin:right top;text-align:right}.mdc-text-field .mdc-floating-label{top:50%;transform:translateY(-50%);pointer-events:none}.mdc-notched-outline .mdc-floating-label{display:inline-block;position:relative;max-width:100%}.mdc-text-field--outlined .mdc-floating-label{left:4px;right:auto}[dir=rtl] .mdc-text-field--outlined .mdc-floating-label{left:auto;right:4px}.mdc-text-field--filled .mdc-floating-label{left:16px;right:auto}[dir=rtl] .mdc-text-field--filled .mdc-floating-label{left:auto;right:16px}.mdc-text-field--disabled .mdc-floating-label{cursor:default}.cdk-high-contrast-active .mdc-text-field--disabled .mdc-floating-label{z-index:1}.mdc-text-field--filled.mdc-text-field--no-label .mdc-floating-label{display:none}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label{color:var(--mdc-filled-text-field-label-text-color, var(--mat-app-on-surface-variant))}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label{color:var(--mdc-filled-text-field-focus-label-text-color, var(--mat-app-primary))}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label{color:var(--mdc-filled-text-field-hover-label-text-color, var(--mat-app-on-surface-variant))}.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label{color:var(--mdc-filled-text-field-disabled-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid .mdc-floating-label{color:var(--mdc-filled-text-field-error-label-text-color, var(--mat-app-error))}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid.mdc-text-field--focused .mdc-floating-label{color:var(--mdc-filled-text-field-error-focus-label-text-color, var(--mat-app-error))}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid:not(.mdc-text-field--disabled):hover .mdc-floating-label{color:var(--mdc-filled-text-field-error-hover-label-text-color, var(--mat-app-on-error-container))}.mdc-text-field--filled .mdc-floating-label{font-family:var(--mdc-filled-text-field-label-text-font, var(--mat-app-body-large-font));font-size:var(--mdc-filled-text-field-label-text-size, var(--mat-app-body-large-size));font-weight:var(--mdc-filled-text-field-label-text-weight, var(--mat-app-body-large-weight));letter-spacing:var(--mdc-filled-text-field-label-text-tracking, var(--mat-app-body-large-tracking))}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label{color:var(--mdc-outlined-text-field-label-text-color, var(--mat-app-on-surface-variant))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label{color:var(--mdc-outlined-text-field-focus-label-text-color, var(--mat-app-primary))}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label{color:var(--mdc-outlined-text-field-hover-label-text-color, var(--mat-app-on-surface))}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label{color:var(--mdc-outlined-text-field-disabled-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid .mdc-floating-label{color:var(--mdc-outlined-text-field-error-label-text-color, var(--mat-app-error))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid.mdc-text-field--focused .mdc-floating-label{color:var(--mdc-outlined-text-field-error-focus-label-text-color, var(--mat-app-error))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid:not(.mdc-text-field--disabled):hover .mdc-floating-label{color:var(--mdc-outlined-text-field-error-hover-label-text-color, var(--mat-app-on-error-container))}.mdc-text-field--outlined .mdc-floating-label{font-family:var(--mdc-outlined-text-field-label-text-font, var(--mat-app-body-large-font));font-size:var(--mdc-outlined-text-field-label-text-size, var(--mat-app-body-large-size));font-weight:var(--mdc-outlined-text-field-label-text-weight, var(--mat-app-body-large-weight));letter-spacing:var(--mdc-outlined-text-field-label-text-tracking, var(--mat-app-body-large-tracking))}.mdc-floating-label--float-above{cursor:auto;transform:translateY(-106%) scale(0.75)}.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) scale(1);font-size:.75rem}.mdc-notched-outline .mdc-floating-label--float-above{text-overflow:clip}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:133.3333333333%}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) scale(0.75)}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:1px;margin-right:0;content:"*"}[dir=rtl] .mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:0;margin-right:1px}.mdc-notched-outline{display:flex;position:absolute;top:0;right:0;left:0;box-sizing:border-box;width:100%;max-width:100%;height:100%;text-align:left;pointer-events:none}[dir=rtl] .mdc-notched-outline{text-align:right}.mdc-text-field--outlined .mdc-notched-outline{z-index:1}.mat-mdc-notch-piece{box-sizing:border-box;height:100%;pointer-events:none;border-top:1px solid;border-bottom:1px solid}.mdc-text-field--focused .mat-mdc-notch-piece{border-width:2px}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-outline-color, var(--mat-app-outline));border-width:var(--mdc-outlined-text-field-outline-width)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-hover-outline-color, var(--mat-app-on-surface))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-focus-outline-color, var(--mat-app-primary))}.mdc-text-field--outlined.mdc-text-field--disabled .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-disabled-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-error-outline-color, var(--mat-app-error))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid:not(.mdc-text-field--focused):hover .mdc-notched-outline .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-error-hover-outline-color, var(--mat-app-on-error-container))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--invalid.mdc-text-field--focused .mat-mdc-notch-piece{border-color:var(--mdc-outlined-text-field-error-focus-outline-color, var(--mat-app-error))}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mat-mdc-notch-piece{border-width:var(--mdc-outlined-text-field-focus-outline-width)}.mdc-notched-outline__leading{border-left:1px solid;border-right:none;border-top-right-radius:0;border-bottom-right-radius:0;border-top-left-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small));border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small))}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small)))}[dir=rtl] .mdc-notched-outline__leading{border-left:none;border-right:1px solid;border-bottom-left-radius:0;border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small));border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small))}.mdc-notched-outline__trailing{flex-grow:1;border-left:none;border-right:1px solid;border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small));border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small))}[dir=rtl] .mdc-notched-outline__trailing{border-left:1px solid;border-right:none;border-top-right-radius:0;border-bottom-right-radius:0;border-top-left-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small));border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small))}.mdc-notched-outline__notch{flex:0 0 auto;width:auto}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:min(var(--mat-form-field-notch-max-width, 100%),100% - max(12px,var(--mdc-outlined-text-field-container-shape, var(--mat-app-corner-extra-small)))*2)}.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:1px}.mdc-text-field--focused.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:2px}.mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:0;padding-right:8px;border-top:none;--mat-form-field-notch-max-width: 100%}[dir=rtl] .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:8px;padding-right:0}.mdc-notched-outline--no-label .mdc-notched-outline__notch{display:none}.mdc-line-ripple::before,.mdc-line-ripple::after{position:absolute;bottom:0;left:0;width:100%;border-bottom-style:solid;content:""}.mdc-line-ripple::before{z-index:1;border-bottom-width:var(--mdc-filled-text-field-active-indicator-height)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-active-indicator-color, var(--mat-app-on-surface-variant))}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-hover-active-indicator-color, var(--mat-app-on-surface))}.mdc-text-field--filled.mdc-text-field--disabled .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-disabled-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-active-indicator-color, var(--mat-app-error))}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--invalid:not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-hover-active-indicator-color, var(--mat-app-on-error-container))}.mdc-line-ripple::after{transform:scaleX(0);opacity:0;z-index:2}.mdc-text-field--filled .mdc-line-ripple::after{border-bottom-width:var(--mdc-filled-text-field-focus-active-indicator-height)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-focus-active-indicator-color, var(--mat-app-primary))}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-error-focus-active-indicator-color, var(--mat-app-error))}.mdc-line-ripple--active::after{transform:scaleX(1);opacity:1}.mdc-line-ripple--deactivating::after{opacity:0}.mdc-text-field--disabled{pointer-events:none}.mat-mdc-form-field-textarea-control{vertical-align:middle;resize:vertical;box-sizing:border-box;height:auto;margin:0;padding:0;border:none;overflow:auto}.mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:inherit;letter-spacing:inherit;text-decoration:inherit;text-transform:inherit;border:none}.mat-mdc-form-field .mat-mdc-floating-label.mdc-floating-label{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;line-height:normal;pointer-events:all;will-change:auto}.mat-mdc-form-field:not(.mat-form-field-disabled) .mat-mdc-floating-label.mdc-floating-label{cursor:inherit}.mdc-text-field--no-label:not(.mdc-text-field--textarea) .mat-mdc-form-field-input-control.mdc-text-field__input,.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control{height:auto}.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control.mdc-text-field__input[type=color]{height:23px}.mat-mdc-text-field-wrapper{height:auto;flex:auto;will-change:auto}.mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-left:0;--mat-mdc-form-field-label-offset-x: -16px}.mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-right:0}[dir=rtl] .mat-mdc-text-field-wrapper{padding-left:16px;padding-right:16px}[dir=rtl] .mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-left:0}[dir=rtl] .mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-right:0}.mat-form-field-disabled .mdc-text-field__input::placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-moz-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-webkit-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input:-ms-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-mdc-form-field-label-always-float .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms;opacity:1}.mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-floating-label{left:auto;right:auto}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-text-field__input{display:inline-block}.mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field .mdc-notched-outline__notch{padding-top:0}.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:1px solid rgba(0,0,0,0)}[dir=rtl] .mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:none;border-right:1px solid rgba(0,0,0,0)}.mat-mdc-form-field-infix{min-height:var(--mat-form-field-container-height);padding-top:var(--mat-form-field-filled-with-label-container-padding-top);padding-bottom:var(--mat-form-field-filled-with-label-container-padding-bottom)}.mdc-text-field--outlined .mat-mdc-form-field-infix,.mdc-text-field--no-label .mat-mdc-form-field-infix{padding-top:var(--mat-form-field-container-vertical-padding);padding-bottom:var(--mat-form-field-container-vertical-padding)}.mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-floating-label{top:calc(var(--mat-form-field-container-height)/2)}.mdc-text-field--filled .mat-mdc-floating-label{display:var(--mat-form-field-filled-label-display, block)}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{--mat-mdc-form-field-label-transform: translateY(calc(calc(6.75px + var(--mat-form-field-container-height) / 2) * -1)) scale(var(--mat-mdc-form-field-floating-label-scale, 0.75));transform:var(--mat-mdc-form-field-label-transform)}.mat-mdc-form-field-subscript-wrapper{box-sizing:border-box;width:100%;position:relative}.mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-error-wrapper{position:absolute;top:0;left:0;right:0;padding:0 16px}.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-error-wrapper{position:static}.mat-mdc-form-field-bottom-align::before{content:"";display:inline-block;height:16px}.mat-mdc-form-field-bottom-align.mat-mdc-form-field-subscript-dynamic-size::before{content:unset}.mat-mdc-form-field-hint-end{order:1}.mat-mdc-form-field-hint-wrapper{display:flex}.mat-mdc-form-field-hint-spacer{flex:1 0 1em}.mat-mdc-form-field-error{display:block;color:var(--mat-form-field-error-text-color, var(--mat-app-error))}.mat-mdc-form-field-subscript-wrapper,.mat-mdc-form-field-bottom-align::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-subscript-text-font, var(--mat-app-body-small-font));line-height:var(--mat-form-field-subscript-text-line-height, var(--mat-app-body-small-line-height));font-size:var(--mat-form-field-subscript-text-size, var(--mat-app-body-small-size));letter-spacing:var(--mat-form-field-subscript-text-tracking, var(--mat-app-body-small-tracking));font-weight:var(--mat-form-field-subscript-text-weight, var(--mat-app-body-small-weight))}.mat-mdc-form-field-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;opacity:0;pointer-events:none;background-color:var(--mat-form-field-state-layer-color, var(--mat-app-on-surface))}.mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-hover-state-layer-opacity, var(--mat-app-hover-state-layer-opacity))}.mat-mdc-form-field.mat-focused .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-focus-state-layer-opacity)}select.mat-mdc-form-field-input-control{-moz-appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box}select.mat-mdc-form-field-input-control:not(:disabled){cursor:pointer}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option{color:var(--mat-form-field-select-option-text-color)}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option:disabled{color:var(--mat-form-field-select-disabled-option-text-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;right:0;top:50%;margin-top:-2.5px;pointer-events:none;color:var(--mat-form-field-enabled-select-arrow-color, var(--mat-app-on-surface-variant))}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{right:auto;left:0}.mat-mdc-form-field-type-mat-native-select.mat-focused .mat-mdc-form-field-infix::after{color:var(--mat-form-field-focus-select-arrow-color, var(--mat-app-primary))}.mat-mdc-form-field-type-mat-native-select.mat-form-field-disabled .mat-mdc-form-field-infix::after{color:var(--mat-form-field-disabled-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:15px}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:0;padding-left:15px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-mdc-text-field-wrapper{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-mdc-text-field-wrapper{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-mdc-text-field-wrapper{outline:dashed 3px}.cdk-high-contrast-active .mat-mdc-form-field.mat-focused .mdc-notched-outline{border:dashed 3px}.mat-mdc-form-field-input-control[type=date],.mat-mdc-form-field-input-control[type=datetime],.mat-mdc-form-field-input-control[type=datetime-local],.mat-mdc-form-field-input-control[type=month],.mat-mdc-form-field-input-control[type=week],.mat-mdc-form-field-input-control[type=time]{line-height:1}.mat-mdc-form-field-input-control::-webkit-datetime-edit{line-height:1;padding:0;margin-bottom:-2px}.mat-mdc-form-field{--mat-mdc-form-field-floating-label-scale: 0.75;display:inline-flex;flex-direction:column;min-width:0;text-align:left;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-container-text-font, var(--mat-app-body-large-font));line-height:var(--mat-form-field-container-text-line-height, var(--mat-app-body-large-line-height));font-size:var(--mat-form-field-container-text-size, var(--mat-app-body-large-size));letter-spacing:var(--mat-form-field-container-text-tracking, var(--mat-app-body-large-tracking));font-weight:var(--mat-form-field-container-text-weight, var(--mat-app-body-large-weight))}[dir=rtl] .mat-mdc-form-field{text-align:right}.mat-mdc-form-field .mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(var(--mat-form-field-outlined-label-text-populated-size)*var(--mat-mdc-form-field-floating-label-scale))}.mat-mdc-form-field .mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mat-form-field-outlined-label-text-populated-size)}.mat-mdc-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-mdc-text-field-wrapper{width:100%;z-index:0}.mat-mdc-form-field-icon-prefix,.mat-mdc-form-field-icon-suffix{align-self:center;line-height:0;pointer-events:auto;position:relative;z-index:1}.mat-mdc-form-field-icon-prefix>.mat-icon,.mat-mdc-form-field-icon-suffix>.mat-icon{padding:0 12px;box-sizing:content-box}.mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-leading-icon-color, var(--mat-app-on-surface-variant))}.mat-form-field-disabled .mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-disabled-leading-icon-color)}.mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-trailing-icon-color, var(--mat-app-on-surface-variant))}.mat-form-field-disabled .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-disabled-trailing-icon-color)}.mat-form-field-invalid .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-trailing-icon-color, var(--mat-app-error))}.mat-form-field-invalid:not(.mat-focused):not(.mat-form-field-disabled) .mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-hover-trailing-icon-color, var(--mat-app-on-error-container))}.mat-form-field-invalid.mat-focused .mat-mdc-text-field-wrapper .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-focus-trailing-icon-color, var(--mat-app-error))}.mat-mdc-form-field-icon-prefix,[dir=rtl] .mat-mdc-form-field-icon-suffix{padding:0 4px 0 0}.mat-mdc-form-field-icon-suffix,[dir=rtl] .mat-mdc-form-field-icon-prefix{padding:0 0 0 4px}.mat-mdc-form-field-subscript-wrapper .mat-icon,.mat-mdc-form-field label .mat-icon{width:1em;height:1em;font-size:inherit}.mat-mdc-form-field-infix{flex:auto;min-width:0;width:180px;position:relative;box-sizing:border-box}.mat-mdc-form-field-infix:has(textarea[cols]){width:auto}.mat-mdc-form-field .mdc-notched-outline__notch{margin-left:-1px;-webkit-clip-path:inset(-9em -999em -9em 1px);clip-path:inset(-9em -999em -9em 1px)}[dir=rtl] .mat-mdc-form-field .mdc-notched-outline__notch{margin-left:0;margin-right:-1px;-webkit-clip-path:inset(-9em 1px -9em -999em);clip-path:inset(-9em 1px -9em -999em)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-floating-label{transition:transform 150ms cubic-bezier(0.4, 0, 0.2, 1),color 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input{transition:opacity 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition:opacity 67ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::-moz-placeholder{transition:opacity 67ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::-webkit-input-placeholder{transition:opacity 67ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition:opacity 67ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--no-label .mdc-text-field__input::placeholder,.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--focused .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms}.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--no-label .mdc-text-field__input::-moz-placeholder,.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--focused .mdc-text-field__input::-moz-placeholder{transition-delay:40ms;transition-duration:110ms}.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--no-label .mdc-text-field__input::-webkit-input-placeholder,.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--focused .mdc-text-field__input::-webkit-input-placeholder{transition-delay:40ms;transition-duration:110ms}.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mat-mdc-form-field:not(.mat-form-field-no-animations).mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{transition-delay:40ms;transition-duration:110ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled:not(.mdc-ripple-upgraded):focus .mdc-text-field__ripple::before{transition-duration:75ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-line-ripple::after{transition:transform 180ms cubic-bezier(0.4, 0, 0.2, 1),opacity 180ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-notched-outline .mdc-floating-label{max-width:calc(100% + 1px)}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:calc(133.3333333333% + 1px)}'],encapsulation:2,data:{animation:[jJ.transitionMessages]},changeDetection:0})}}return e})(),rK=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({imports:[Fc,ED,m7,Fc]})}}return e})();const KJ=new Te("MAT_INPUT_VALUE_ACCESSOR"),qJ=["button","checkbox","file","hidden","image","radio","range","reset","submit"];let YJ=0,$J=(()=>{class e{get disabled(){return this._disabled}set disabled(t){this._disabled=nT(t),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(t){this._id=t||this._uid}get required(){return this._required??this.ngControl?.control?.hasValidator(s9.required)??!1}set required(t){this._required=nT(t)}get type(){return this._type}set type(t){this._type=t||"text",this._validateType(),!this._isTextarea&&d7().has(this._type)&&(this._elementRef.nativeElement.type=this._type),this._ensureWheelDefaultBehavior()}get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(t){this._errorStateTracker.matcher=t}get value(){return this._inputValueAccessor.value}set value(t){t!==this.value&&(this._inputValueAccessor.value=t,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(t){this._readonly=nT(t)}get errorState(){return this._errorStateTracker.errorState}set errorState(t){this._errorStateTracker.errorState=t}constructor(t,s,c,u,f,_,E,S,I,P){this._elementRef=t,this._platform=s,this.ngControl=c,this._autofillMonitor=S,this._ngZone=I,this._formField=P,this._uid="mat-input-"+YJ++,this._webkitBlinkWheelListenerAttached=!1,this.focused=!1,this.stateChanges=new Mt,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(G=>d7().has(G)),this._iOSKeyupListener=G=>{const K=G.target;!K.value&&0===K.selectionStart&&0===K.selectionEnd&&(K.setSelectionRange(1,1),K.setSelectionRange(0,0))},this._webkitBlinkWheelListener=()=>{};const U=this._elementRef.nativeElement,B=U.nodeName.toLowerCase();this._inputValueAccessor=E||U,this._previousNativeValue=this.value,this.id=this.id,s.IOS&&I.runOutsideAngular(()=>{t.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._errorStateTracker=new k7(_,c,f,u,this.stateChanges),this._isServer=!this._platform.isBrowser,this._isNativeSelect="select"===B,this._isTextarea="textarea"===B,this._isInFormField=!!P,this._isNativeSelect&&(this.controlType=U.multiple?"mat-native-select-multiple":"mat-native-select")}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(t=>{this.autofilled=t.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener),this._webkitBlinkWheelListenerAttached&&this._elementRef.nativeElement.removeEventListener("wheel",this._webkitBlinkWheelListener)}ngDoCheck(){this.ngControl&&(this.updateErrorState(),null!==this.ngControl.disabled&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(t){this._elementRef.nativeElement.focus(t)}updateErrorState(){this._errorStateTracker.updateErrorState()}_focusChanged(t){t!==this.focused&&(this.focused=t,this.stateChanges.next())}_onInput(){}_dirtyCheckNativeValue(){const t=this._elementRef.nativeElement.value;this._previousNativeValue!==t&&(this._previousNativeValue=t,this.stateChanges.next())}_dirtyCheckPlaceholder(){const t=this._getPlaceholder();if(t!==this._previousPlaceholder){const s=this._elementRef.nativeElement;this._previousPlaceholder=t,t?s.setAttribute("placeholder",t):s.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){qJ.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let t=this._elementRef.nativeElement.validity;return t&&t.badInput}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}get shouldLabelFloat(){if(this._isNativeSelect){const t=this._elementRef.nativeElement,s=t.options[0];return this.focused||t.multiple||!this.empty||!!(t.selectedIndex>-1&&s&&s.label)}return this.focused||!this.empty}setDescribedByIds(t){t.length?this._elementRef.nativeElement.setAttribute("aria-describedby",t.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){const t=this._elementRef.nativeElement;return this._isNativeSelect&&(t.multiple||t.size>1)}_ensureWheelDefaultBehavior(){!this._webkitBlinkWheelListenerAttached&&"number"===this._type&&(this._platform.BLINK||this._platform.WEBKIT)&&(this._ngZone.runOutsideAngular(()=>{this._elementRef.nativeElement.addEventListener("wheel",this._webkitBlinkWheelListener)}),this._webkitBlinkWheelListenerAttached=!0),this._webkitBlinkWheelListenerAttached&&"number"!==this._type&&(this._elementRef.nativeElement.removeEventListener("wheel",this._webkitBlinkWheelListener),this._webkitBlinkWheelListenerAttached=!0)}static{this.\u0275fac=function(s){return new(s||e)(re(On),re(Ho),re(Xh,10),re(kU,8),re(VO,8),re(VZ),re(KJ,10),re(nJ),re(ft),re(eK,8))}}static{this.\u0275dir=Ue({type:e,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:18,hostBindings:function(s,c){1&s&&Mn("focus",function(){return c._focusChanged(!0)})("blur",function(){return c._focusChanged(!1)})("input",function(){return c._onInput()}),2&s&&(b_("id",c.id)("disabled",c.disabled)("required",c.required),Ji("name",c.name||null)("readonly",c.readonly&&!c._isNativeSelect||null)("aria-invalid",c.empty&&c.required?null:c.errorState)("aria-required",c.required)("id",c.id),nt("mat-input-server",c._isServer)("mat-mdc-form-field-textarea-control",c._isInFormField&&c._isTextarea)("mat-mdc-form-field-input-control",c._isInFormField)("mdc-text-field__input",c._isInFormField)("mat-mdc-native-select-inline",c._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:[0,"aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["matInput"],standalone:!0,features:[mn([{provide:Q7,useExisting:e}]),Xo]})}}return e})(),XJ=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({imports:[Fc,rK,rK,iJ,Fc]})}}return e})();const ZJ=["switch"],JJ=["*"];function QJ(e,i){1&e&&(Se(0,"span",10),va(),Se(1,"svg",12),At(2,"path",13),Be(),Se(3,"svg",14),At(4,"path",15),Be()())}const eQ=new Te("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1,disabledInteractive:!1})}),tQ={provide:Wl,useExisting:Fn(()=>H8),multi:!0};class oK{constructor(i,t){this.source=i,this.checked=t}}let nQ=0,H8=(()=>{class e{_createChangeEvent(t){return new oK(this,t)}get buttonId(){return`${this.id||this._uniqueId}-button`}focus(){this._switchElement.nativeElement.focus()}get checked(){return this._checked}set checked(t){this._checked=t,this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(t,s,c,u,f,_){this._elementRef=t,this._focusMonitor=s,this._changeDetectorRef=c,this.defaults=f,this._onChange=E=>{},this._onTouched=()=>{},this._validatorOnChange=()=>{},this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.disabled=!1,this.disableRipple=!1,this.tabIndex=0,this.change=new Dn,this.toggleChange=new Dn,this.tabIndex=parseInt(u)||0,this.color=f.color||"accent",this._noopAnimations="NoopAnimations"===_,this.id=this._uniqueId="mat-mdc-slide-toggle-"+ ++nQ,this.hideIcon=f.hideIcon??!1,this.disabledInteractive=f.disabledInteractive??!1,this._labelId=this._uniqueId+"-label"}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{"keyboard"===t||"program"===t?(this._focused=!0,this._changeDetectorRef.markForCheck()):t||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnChanges(t){t.required&&this._validatorOnChange()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(t){this.checked=!!t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}validate(t){return this.required&&!0!==t.value?{required:!0}:null}registerOnValidatorChange(t){this._validatorOnChange=t}setDisabledState(t){this.disabled=t,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}_handleClick(){this.disabled||(this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new oK(this,this.checked))))}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}static{this.\u0275fac=function(s){return new(s||e)(re(On),re(L8),re(Js),function Ap(e){return function rP(e,i){if("class"===i)return e.classes;if("style"===i)return e.styles;const t=e.attrs;if(t){const s=t.length;let c=0;for(;c<s;){const u=t[c];if(bN(u))break;if(0===u)c+=2;else if("number"==typeof u)for(c++;c<s&&"string"==typeof t[c];)c++;else{if(u===i)return t[c+1];c+=2}}}return null}(Un(),e)}("tabindex"),re(eQ),re(tl,8))}}static{this.\u0275cmp=no({type:e,selectors:[["mat-slide-toggle"]],viewQuery:function(s,c){if(1&s&&pe(ZJ,5),2&s){let u;dr(u=kn())&&(c._switchElement=u.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:13,hostBindings:function(s,c){2&s&&(b_("id",c.id),Ji("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),Qb(c.color?"mat-"+c.color:""),nt("mat-mdc-slide-toggle-focused",c._focused)("mat-mdc-slide-toggle-checked",c.checked)("_mat-animation-noopable",c._noopAnimations))},inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[0,"aria-describedby","ariaDescribedby"],required:[2,"required","required",zr],color:"color",disabled:[2,"disabled","disabled",zr],disableRipple:[2,"disableRipple","disableRipple",zr],tabIndex:[2,"tabIndex","tabIndex",t=>null==t?0:function Ux(e,i=NaN){return isNaN(parseFloat(e))||isNaN(Number(e))?i:Number(e)}(t)],checked:[2,"checked","checked",zr],hideIcon:[2,"hideIcon","hideIcon",zr],disabledInteractive:[2,"disabledInteractive","disabledInteractive",zr]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],standalone:!0,features:[mn([tQ,{provide:vo,useExisting:e,multi:!0}]),Jg,Xo,fo],ngContentSelectors:JJ,decls:13,vars:27,consts:[["switch",""],["mat-internal-form-field","",3,"labelPosition"],["role","switch","type","button",1,"mdc-switch",3,"click","tabIndex","disabled"],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-switch__icons"],[1,"mdc-label",3,"click","for"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(s,c){if(1&s){const u=yc();wf(),Se(0,"div",1)(1,"button",2,0),Mn("click",function(){return Zo(u),oo(c._handleClick())}),At(3,"span",3),Se(4,"span",4)(5,"span",5)(6,"span",6),At(7,"span",7),Be(),Se(8,"span",8),At(9,"span",9),Be(),Si(10,QJ,5,0,"span",10),Be()()(),Se(11,"label",11),Mn("click",function(_){return Zo(u),oo(_.stopPropagation())}),uo(12),Be()()}if(2&s){const u=we(2);$e("labelPosition",c.labelPosition),Ze(),nt("mdc-switch--selected",c.checked)("mdc-switch--unselected",!c.checked)("mdc-switch--checked",c.checked)("mdc-switch--disabled",c.disabled)("mat-mdc-slide-toggle-disabled-interactive",c.disabledInteractive),$e("tabIndex",c.disabled&&!c.disabledInteractive?-1:c.tabIndex)("disabled",c.disabled&&!c.disabledInteractive),Ji("id",c.buttonId)("name",c.name)("aria-label",c.ariaLabel)("aria-labelledby",c._getAriaLabelledBy())("aria-describedby",c.ariaDescribedby)("aria-required",c.required||null)("aria-checked",c.checked)("aria-disabled",c.disabled&&c.disabledInteractive?"true":null),Ze(8),$e("matRippleTrigger",u)("matRippleDisabled",c.disableRipple||c.disabled)("matRippleCentered",!0),Ze(),st(c.hideIcon?-1:10),Ze(),$e("for",c.buttonId),Ji("id",c._labelId)}},dependencies:[j7,KZ],styles:['.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative;width:var(--mdc-switch-track-width)}.mdc-switch.mdc-switch--disabled{cursor:default;pointer-events:none}.mdc-switch.mat-mdc-slide-toggle-disabled-interactive{pointer-events:auto}.mdc-switch__track{overflow:hidden;position:relative;width:100%;height:var(--mdc-switch-track-height);border-radius:var(--mdc-switch-track-shape, var(--mat-app-corner-full))}.mdc-switch--disabled.mdc-switch .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity)}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%;border-width:var(--mat-switch-track-outline-width);border-color:var(--mat-switch-track-outline-color, var(--mat-app-outline))}.cdk-high-contrast-active .mdc-switch__track::before,.cdk-high-contrast-active .mdc-switch__track::after{border-color:currentColor}.mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track::after{border-width:var(--mat-switch-selected-track-outline-width);border-color:var(--mat-switch-selected-track-outline-color)}.mdc-switch--disabled .mdc-switch__track::before,.mdc-switch--disabled .mdc-switch__track::after{border-width:var(--mat-switch-disabled-unselected-track-outline-width);border-color:var(--mat-switch-disabled-unselected-track-outline-color, var(--mat-app-on-surface))}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0);background:var(--mdc-switch-unselected-track-color, var(--mat-app-surface-variant))}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch--selected .mdc-switch__track::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::before{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mdc-switch--unselected .mdc-switch__track::before{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color, var(--mat-app-surface-variant))}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color, var(--mat-app-surface-variant))}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color, var(--mat-app-surface-variant))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__track::before,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__track::before,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__track::before,.mdc-switch.mdc-switch--disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color, var(--mat-app-surface-variant))}.mdc-switch__track::after{transform:translateX(-100%);background:var(--mdc-switch-selected-track-color, var(--mat-app-primary))}[dir=rtl] .mdc-switch__track::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::after{transform:translateX(0)}.mdc-switch--selected .mdc-switch__track::after{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch--unselected .mdc-switch__track::after{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color, var(--mat-app-primary))}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color, var(--mat-app-primary))}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color, var(--mat-app-primary))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__track::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__track::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__track::after,.mdc-switch.mdc-switch--disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color, var(--mat-app-on-surface))}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0);width:calc(100% - var(--mdc-switch-handle-width))}[dir=rtl] .mdc-switch__handle-track{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto;transition:width 75ms cubic-bezier(0.4, 0, 0.2, 1),height 75ms cubic-bezier(0.4, 0, 0.2, 1),margin 75ms cubic-bezier(0.4, 0, 0.2, 1);width:var(--mdc-switch-handle-width);height:var(--mdc-switch-handle-height);border-radius:var(--mdc-switch-handle-shape, var(--mat-app-corner-full))}[dir=rtl] .mdc-switch__handle{left:auto;right:0}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{width:var(--mat-switch-unselected-handle-size);height:var(--mat-switch-unselected-handle-size);margin:var(--mat-switch-unselected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-unselected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{width:var(--mat-switch-selected-handle-size);height:var(--mat-switch-selected-handle-size);margin:var(--mat-switch-selected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-selected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch__handle:has(.mdc-switch__icons){width:var(--mat-switch-with-icon-handle-size);height:var(--mat-switch-with-icon-handle-size)}.mat-mdc-slide-toggle .mdc-switch:active:not(.mdc-switch--disabled) .mdc-switch__handle{width:var(--mat-switch-pressed-handle-size);height:var(--mat-switch-pressed-handle-size)}.mat-mdc-slide-toggle .mdc-switch--selected:active:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-selected-pressed-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected:active:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-unselected-pressed-handle-horizontal-margin)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-selected-handle-opacity)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-unselected-handle-opacity)}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}.cdk-high-contrast-active .mdc-switch__handle::before,.cdk-high-contrast-active .mdc-switch__handle::after{border-color:currentColor}.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color, var(--mat-app-on-primary))}.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color, var(--mat-app-primary-container))}.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color, var(--mat-app-primary-container))}.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color, var(--mat-app-primary-container))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:hover:not(:focus):not(:active) .mdc-switch__handle::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:focus:not(:active) .mdc-switch__handle::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:active .mdc-switch__handle::after,.mdc-switch--selected.mdc-switch--disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color, var(--mat-app-surface))}.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color, var(--mat-app-outline))}.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color, var(--mat-app-on-surface-variant))}.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color, var(--mat-app-on-surface-variant))}.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color, var(--mat-app-on-surface-variant))}.mdc-switch--unselected.mdc-switch--disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color, var(--mat-app-on-surface))}.mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__shadow,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__shadow,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__shadow,.mdc-switch.mdc-switch--disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1;width:var(--mdc-switch-state-layer-size);height:var(--mdc-switch-state-layer-size)}.mdc-switch__ripple::after{content:"";opacity:0}.mdc-switch--disabled .mdc-switch__ripple::after{display:none}.mat-mdc-slide-toggle-disabled-interactive .mdc-switch__ripple::after{display:block}.mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:75ms opacity cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:focus .mdc-switch__ripple::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:active .mdc-switch__ripple::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:hover:not(:focus) .mdc-switch__ripple::after,.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-hover-state-layer-color, var(--mat-app-on-surface))}.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-focus-state-layer-color, var(--mat-app-on-surface))}.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-pressed-state-layer-color, var(--mat-app-on-surface));opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity, var(--mat-app-pressed-state-layer-opacity));transition:opacity 75ms linear}.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background:var(--mdc-switch-selected-hover-state-layer-color, var(--mat-app-primary))}.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background:var(--mdc-switch-selected-focus-state-layer-color, var(--mat-app-primary))}.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background:var(--mdc-switch-selected-pressed-state-layer-color, var(--mat-app-primary));opacity:var(--mdc-switch-selected-pressed-state-layer-opacity, var(--mat-app-pressed-state-layer-opacity));transition:opacity 75ms linear}.mdc-switch__icons{position:relative;height:100%;width:100%;z-index:1}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity)}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size);height:var(--mdc-switch-unselected-icon-size);fill:var(--mdc-switch-unselected-icon-color, var(--mat-app-surface-variant))}.mdc-switch--unselected.mdc-switch--disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color, var(--mat-app-surface-variant))}.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size);height:var(--mdc-switch-selected-icon-size);fill:var(--mdc-switch-selected-icon-color, var(--mat-app-on-primary-container))}.mdc-switch--selected.mdc-switch--disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color, var(--mat-app-on-surface))}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle{-webkit-user-select:none;user-select:none;display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-mdc-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-internal-form-field{color:var(--mat-switch-label-text-color, var(--mat-app-on-surface));font-family:var(--mat-switch-label-text-font, var(--mat-app-body-medium-font));line-height:var(--mat-switch-label-text-line-height, var(--mat-app-body-medium-line-height));font-size:var(--mat-switch-label-text-size, var(--mat-app-body-medium-size));letter-spacing:var(--mat-switch-label-text-tracking, var(--mat-app-body-medium-tracking));font-weight:var(--mat-switch-label-text-weight, var(--mat-app-body-medium-weight))}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}.mat-mdc-slide-toggle .mdc-switch--disabled+label{color:var(--mdc-switch-disabled-label-text-color)}'],encapsulation:2,changeDetection:0})}}return e})(),oQ=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({imports:[H8,Fc,Fc]})}}return e})();const sQ=["addListener","removeListener"],aQ=["addEventListener","removeEventListener"],cQ=["on","off"];function G8(e,i,t,s){if(vn(t)&&(s=t,t=void 0),s)return G8(e,i,t).pipe(QD(s));const[c,u]=function uQ(e){return vn(e.addEventListener)&&vn(e.removeEventListener)}(e)?aQ.map(f=>_=>e[f](i,_,t)):function lQ(e){return vn(e.addListener)&&vn(e.removeListener)}(e)?sQ.map(sK(e,i)):function dQ(e){return vn(e.on)&&vn(e.off)}(e)?cQ.map(sK(e,i)):[];if(!c&&zD(e))return Yr(f=>G8(f,i,t))(qr(e));if(!c)throw new TypeError("Invalid event target");return new ni(f=>{const _=(...E)=>f.next(1<E.length?E:E[0]);return c(_),()=>u(_)})}function sK(e,i){return t=>s=>e[t](i,s)}const WO={schedule(e){let i=requestAnimationFrame,t=cancelAnimationFrame;const{delegate:s}=WO;s&&(i=s.requestAnimationFrame,t=s.cancelAnimationFrame);const c=i(u=>{t=void 0,e(u)});return new Ri(()=>t?.(c))},requestAnimationFrame(...e){const{delegate:i}=WO;return(i?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:i}=WO;return(i?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0};new class pQ extends a8{flush(i){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:s}=this;let c;i=i||s.shift();do{if(c=i.execute(i.state,i.delay))break}while((i=s[0])&&i.id===t&&s.shift());if(this._active=!1,c){for(;(i=s[0])&&i.id===t&&s.shift();)i.unsubscribe();throw c}}}(class hQ extends o8{constructor(i,t){super(i,t),this.scheduler=i,this.work=t}requestAsyncId(i,t,s=0){return null!==s&&s>0?super.requestAsyncId(i,t,s):(i.actions.push(this),i._scheduled||(i._scheduled=WO.requestAnimationFrame(()=>i.flush(void 0))))}recycleAsyncId(i,t,s=0){var c;if(null!=s?s>0:this.delay>0)return super.recycleAsyncId(i,t,s);const{actions:u}=i;null!=t&&(null===(c=u[u.length-1])||void 0===c?void 0:c.id)!==t&&(WO.cancelAnimationFrame(t),i._scheduled=void 0)}});let W8,mQ=1;const WU={};function aK(e){return e in WU&&(delete WU[e],!0)}const gQ={setImmediate(e){const i=mQ++;return WU[i]=!0,W8||(W8=Promise.resolve()),W8.then(()=>aK(i)&&e()),i},clearImmediate(e){aK(e)}},{setImmediate:_Q,clearImmediate:vQ}=gQ,zU={setImmediate(...e){const{delegate:i}=zU;return(i?.setImmediate||_Q)(...e)},clearImmediate(e){const{delegate:i}=zU;return(i?.clearImmediate||vQ)(e)},delegate:void 0};new class yQ extends a8{flush(i){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:s}=this;let c;i=i||s.shift();do{if(c=i.execute(i.state,i.delay))break}while((i=s[0])&&i.id===t&&s.shift());if(this._active=!1,c){for(;(i=s[0])&&i.id===t&&s.shift();)i.unsubscribe();throw c}}}(class EQ extends o8{constructor(i,t){super(i,t),this.scheduler=i,this.work=t}requestAsyncId(i,t,s=0){return null!==s&&s>0?super.requestAsyncId(i,t,s):(i.actions.push(this),i._scheduled||(i._scheduled=zU.setImmediate(i.flush.bind(i,void 0))))}recycleAsyncId(i,t,s=0){var c;if(null!=s?s>0:this.delay>0)return super.recycleAsyncId(i,t,s);const{actions:u}=i;null!=t&&(null===(c=u[u.length-1])||void 0===c?void 0:c.id)!==t&&(zU.clearImmediate(t),i._scheduled===t&&(i._scheduled=void 0))}});function cK(e,i=PO){return function SQ(e){return yi((i,t)=>{let s=!1,c=null,u=null,f=!1;const _=()=>{if(u?.unsubscribe(),u=null,s){s=!1;const S=c;c=null,t.next(S)}f&&t.complete()},E=()=>{u=null,f&&t.complete()};i.subscribe(ui(t,S=>{s=!0,c=S,u||qr(e(S)).subscribe(u=ui(t,_,E))},()=>{f=!0,(!s||!u||u.closed)&&t.complete()}))})}(()=>EU(e,i))}let lK=(()=>{class e{constructor(t,s,c){this._ngZone=t,this._platform=s,this._scrolled=new Mt,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=c}register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){const s=this.scrollContainers.get(t);s&&(s.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=20){return this._platform.isBrowser?new ni(s=>{this._globalSubscription||this._addGlobalListener();const c=t>0?this._scrolled.pipe(cK(t)).subscribe(s):this._scrolled.subscribe(s);return this._scrolledCount++,()=>{c.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):vt()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((t,s)=>this.deregister(s)),this._scrolled.complete()}ancestorScrolled(t,s){const c=this.getAncestorScrollContainers(t);return this.scrolled(s).pipe(Ns(u=>!u||c.indexOf(u)>-1))}getAncestorScrollContainers(t){const s=[];return this.scrollContainers.forEach((c,u)=>{this._scrollableContainsElement(u,t)&&s.push(u)}),s}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(t,s){let c=_m(s),u=t.getElementRef().nativeElement;do{if(c==u)return!0}while(c=c.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>G8(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}static{this.\u0275fac=function(s){return new(s||e)(ye(ft),ye(Ho),ye(Ve,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),dK=(()=>{class e{constructor(t,s,c){this._platform=t,this._change=new Mt,this._changeListener=u=>{this._change.next(u)},this._document=c,s.runOutsideAngular(()=>{if(t.isBrowser){const u=this._getWindow();u.addEventListener("resize",this._changeListener),u.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const t=this._getWindow();t.removeEventListener("resize",this._changeListener),t.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){const t=this.getViewportScrollPosition(),{width:s,height:c}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+c,right:t.left+s,height:c,width:s}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const t=this._document,s=this._getWindow(),c=t.documentElement,u=c.getBoundingClientRect();return{top:-u.top||t.body.scrollTop||s.scrollY||c.scrollTop||0,left:-u.left||t.body.scrollLeft||s.scrollX||c.scrollLeft||0}}change(t=20){return t>0?this._change.pipe(cK(t)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const t=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:t.innerWidth,height:t.innerHeight}:{width:0,height:0}}static{this.\u0275fac=function(s){return new(s||e)(ye(Ho),ye(ft),ye(Ve,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),z8=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({})}}return e})(),uK=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({imports:[HO,z8,HO,z8]})}}return e})();class K8{attach(i){return this._attachedHost=i,i.attach(this)}detach(){let i=this._attachedHost;null!=i&&(this._attachedHost=null,i.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(i){this._attachedHost=i}}class hK extends K8{constructor(i,t,s,c,u){super(),this.component=i,this.viewContainerRef=t,this.injector=s,this.componentFactoryResolver=c,this.projectableNodes=u}}class IQ extends K8{constructor(i,t,s,c){super(),this.templateRef=i,this.viewContainerRef=t,this.context=s,this.injector=c}get origin(){return this.templateRef.elementRef}attach(i,t=this.context){return this.context=t,super.attach(i)}detach(){return this.context=void 0,super.detach()}}class wQ extends K8{constructor(i){super(),this.element=i instanceof On?i.nativeElement:i}}class RQ{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(i){return i instanceof hK?(this._attachedPortal=i,this.attachComponentPortal(i)):i instanceof IQ?(this._attachedPortal=i,this.attachTemplatePortal(i)):this.attachDomPortal&&i instanceof wQ?(this._attachedPortal=i,this.attachDomPortal(i)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(i){this._disposeFn=i}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class AQ extends RQ{constructor(i,t,s,c,u){super(),this.outletElement=i,this._componentFactoryResolver=t,this._appRef=s,this._defaultInjector=c,this.attachDomPortal=f=>{const _=f.element,E=this._document.createComment("dom-portal");_.parentNode.insertBefore(E,_),this.outletElement.appendChild(_),this._attachedPortal=f,super.setDisposeFn(()=>{E.parentNode&&E.parentNode.replaceChild(_,E)})},this._document=u}attachComponentPortal(i){const s=(i.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(i.component);let c;return i.viewContainerRef?(c=i.viewContainerRef.createComponent(s,i.viewContainerRef.length,i.injector||i.viewContainerRef.injector,i.projectableNodes||void 0),this.setDisposeFn(()=>c.destroy())):(c=s.create(i.injector||this._defaultInjector||Oi.NULL),this._appRef.attachView(c.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(c.hostView),c.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(c)),this._attachedPortal=i,c}attachTemplatePortal(i){let t=i.viewContainerRef,s=t.createEmbeddedView(i.templateRef,i.context,{injector:i.injector});return s.rootNodes.forEach(c=>this.outletElement.appendChild(c)),s.detectChanges(),this.setDisposeFn(()=>{let c=t.indexOf(s);-1!==c&&t.remove(c)}),this._attachedPortal=i,s}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(i){return i.hostView.rootNodes[0]}}let DQ=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({})}}return e})();const pK=OX();class OQ{constructor(i,t){this._viewportRuler=i,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=t}attach(){}enable(){if(this._canBeEnabled()){const i=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=i.style.left||"",this._previousHTMLStyles.top=i.style.top||"",i.style.left=xr(-this._previousScrollPosition.left),i.style.top=xr(-this._previousScrollPosition.top),i.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const i=this._document.documentElement,s=i.style,c=this._document.body.style,u=s.scrollBehavior||"",f=c.scrollBehavior||"";this._isEnabled=!1,s.left=this._previousHTMLStyles.left,s.top=this._previousHTMLStyles.top,i.classList.remove("cdk-global-scrollblock"),pK&&(s.scrollBehavior=c.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),pK&&(s.scrollBehavior=u,c.scrollBehavior=f)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const t=this._document.body,s=this._viewportRuler.getViewportSize();return t.scrollHeight>s.height||t.scrollWidth>s.width}}class NQ{constructor(i,t,s,c){this._scrollDispatcher=i,this._ngZone=t,this._viewportRuler=s,this._config=c,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(i){this._overlayRef=i}enable(){if(this._scrollSubscription)return;const i=this._scrollDispatcher.scrolled(0).pipe(Ns(t=>!t||!this._overlayRef.overlayElement.contains(t.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=i.subscribe(()=>{const t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=i.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class fK{enable(){}disable(){}attach(){}}function q8(e,i){return i.some(t=>e.bottom<t.top||e.top>t.bottom||e.right<t.left||e.left>t.right)}function mK(e,i){return i.some(t=>e.top<t.top||e.bottom>t.bottom||e.left<t.left||e.right>t.right)}class PQ{constructor(i,t,s,c){this._scrollDispatcher=i,this._viewportRuler=t,this._ngZone=s,this._config=c,this._scrollSubscription=null}attach(i){this._overlayRef=i}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:s,height:c}=this._viewportRuler.getViewportSize();q8(t,[{width:s,height:c,bottom:c,right:s,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let MQ=(()=>{class e{constructor(t,s,c,u){this._scrollDispatcher=t,this._viewportRuler=s,this._ngZone=c,this.noop=()=>new fK,this.close=f=>new NQ(this._scrollDispatcher,this._ngZone,this._viewportRuler,f),this.block=()=>new OQ(this._viewportRuler,this._document),this.reposition=f=>new PQ(this._scrollDispatcher,this._viewportRuler,this._ngZone,f),this._document=u}static{this.\u0275fac=function(s){return new(s||e)(ye(lK),ye(dK),ye(ft),ye(Ve))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();class kQ{constructor(i){if(this.scrollStrategy=new fK,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,i){const t=Object.keys(i);for(const s of t)void 0!==i[s]&&(this[s]=i[s])}}}class LQ{constructor(i,t){this.connectionPair=i,this.scrollableViewProperties=t}}let gK=(()=>{class e{constructor(t){this._attachedOverlays=[],this._document=t}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){const s=this._attachedOverlays.indexOf(t);s>-1&&this._attachedOverlays.splice(s,1),0===this._attachedOverlays.length&&this.detach()}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),xQ=(()=>{class e extends gK{constructor(t,s){super(t),this._ngZone=s,this._keydownListener=c=>{const u=this._attachedOverlays;for(let f=u.length-1;f>-1;f--)if(u[f]._keydownEvents.observers.length>0){const _=u[f]._keydownEvents;this._ngZone?this._ngZone.run(()=>_.next(c)):_.next(c);break}}}add(t){super.add(t),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve),ye(ft,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),FQ=(()=>{class e extends gK{constructor(t,s,c){super(t),this._platform=s,this._ngZone=c,this._cursorStyleIsSet=!1,this._pointerDownListener=u=>{this._pointerDownEventTarget=Zh(u)},this._clickListener=u=>{const f=Zh(u),_="click"===u.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:f;this._pointerDownEventTarget=null;const E=this._attachedOverlays.slice();for(let S=E.length-1;S>-1;S--){const I=E[S];if(I._outsidePointerEvents.observers.length<1||!I.hasAttached())continue;if(_K(I.overlayElement,f)||_K(I.overlayElement,_))break;const P=I._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>P.next(u)):P.next(u)}}}add(t){if(super.add(t),!this._isAttached){const s=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(s)):this._addEventListeners(s),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=s.style.cursor,s.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const t=this._document.body;t.removeEventListener("pointerdown",this._pointerDownListener,!0),t.removeEventListener("click",this._clickListener,!0),t.removeEventListener("auxclick",this._clickListener,!0),t.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(t.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(t){t.addEventListener("pointerdown",this._pointerDownListener,!0),t.addEventListener("click",this._clickListener,!0),t.addEventListener("auxclick",this._clickListener,!0),t.addEventListener("contextmenu",this._clickListener,!0)}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve),ye(Ho),ye(ft,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function _K(e,i){const t=typeof ShadowRoot<"u"&&ShadowRoot;let s=i;for(;s;){if(s===e)return!0;s=t&&s instanceof ShadowRoot?s.host:s.parentNode}return!1}let vK=(()=>{class e{constructor(t,s){this._platform=s,this._document=t}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t="cdk-overlay-container";if(this._platform.isBrowser||P8()){const c=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let u=0;u<c.length;u++)c[u].remove()}const s=this._document.createElement("div");s.classList.add(t),P8()?s.setAttribute("platform","test"):this._platform.isBrowser||s.setAttribute("platform","server"),this._document.body.appendChild(s),this._containerElement=s}static{this.\u0275fac=function(s){return new(s||e)(ye(Ve),ye(Ho))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();class UQ{constructor(i,t,s,c,u,f,_,E,S,I=!1,P){this._portalOutlet=i,this._host=t,this._pane=s,this._config=c,this._ngZone=u,this._keyboardDispatcher=f,this._document=_,this._location=E,this._outsideClickDispatcher=S,this._animationsDisabled=I,this._injector=P,this._backdropElement=null,this._backdropClick=new Mt,this._attachments=new Mt,this._detachments=new Mt,this._locationChanges=Ri.EMPTY,this._backdropClickHandler=U=>this._backdropClick.next(U),this._backdropTransitionendHandler=U=>{this._disposeBackdrop(U.target)},this._keydownEvents=new Mt,this._outsidePointerEvents=new Mt,this._renders=new Mt,c.scrollStrategy&&(this._scrollStrategy=c.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=c.positionStrategy,this._afterRenderRef=Qs(()=>eh(()=>{this._renders.next()},{injector:this._injector}))}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(i){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const t=this._portalOutlet.attach(i);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._afterNextRenderRef?.destroy(),this._afterNextRenderRef=uf(()=>{this.hasAttached()&&this.updatePosition()},{injector:this._injector}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof t?.onDestroy&&t.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const i=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenEmpty(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),i}dispose(){const i=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._afterNextRenderRef?.destroy(),this._previousHostParent=this._pane=this._host=null,i&&this._detachments.next(),this._detachments.complete(),this._afterRenderRef.destroy(),this._renders.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(i){i!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=i,this.hasAttached()&&(i.attach(this),this.updatePosition()))}updateSize(i){this._config={...this._config,...i},this._updateElementSize()}setDirection(i){this._config={...this._config,direction:i},this._updateElementDirection()}addPanelClass(i){this._pane&&this._toggleClasses(this._pane,i,!0)}removePanelClass(i){this._pane&&this._toggleClasses(this._pane,i,!1)}getDirection(){const i=this._config.direction;return i?"string"==typeof i?i:i.value:"ltr"}updateScrollStrategy(i){i!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=i,this.hasAttached()&&(i.attach(this),i.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const i=this._pane.style;i.width=xr(this._config.width),i.height=xr(this._config.height),i.minWidth=xr(this._config.minWidth),i.minHeight=xr(this._config.minHeight),i.maxWidth=xr(this._config.maxWidth),i.maxHeight=xr(this._config.maxHeight)}_togglePointerEvents(i){this._pane.style.pointerEvents=i?"":"none"}_attachBackdrop(){const i="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(i)})}):this._backdropElement.classList.add(i)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const i=this._backdropElement;if(i){if(this._animationsDisabled)return void this._disposeBackdrop(i);i.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{i.addEventListener("transitionend",this._backdropTransitionendHandler)}),i.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(i)},500))}}_toggleClasses(i,t,s){const c=xU(t||[]).filter(u=>!!u);c.length&&(s?i.classList.add(...c):i.classList.remove(...c))}_detachContentWhenEmpty(){this._ngZone.runOutsideAngular(()=>{const i=this._renders.pipe(Tr(K7(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),i.unsubscribe())})})}_disposeScrollStrategy(){const i=this._scrollStrategy;i&&(i.disable(),i.detach&&i.detach())}_disposeBackdrop(i){i&&(i.removeEventListener("click",this._backdropClickHandler),i.removeEventListener("transitionend",this._backdropTransitionendHandler),i.remove(),this._backdropElement===i&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const EK="cdk-overlay-connected-position-bounding-box",VQ=/([A-Za-z%]+)$/;class BQ{get positions(){return this._preferredPositions}constructor(i,t,s,c,u){this._viewportRuler=t,this._document=s,this._platform=c,this._overlayContainer=u,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Mt,this._resizeSubscription=Ri.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(i)}attach(i){this._validatePositions(),i.hostElement.classList.add(EK),this._overlayRef=i,this._boundingBox=i.hostElement,this._pane=i.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const i=this._originRect,t=this._overlayRect,s=this._viewportRect,c=this._containerRect,u=[];let f;for(let _ of this._preferredPositions){let E=this._getOriginPoint(i,c,_),S=this._getOverlayPoint(E,t,_),I=this._getOverlayFit(S,t,s,_);if(I.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(_,E);this._canFitWithFlexibleDimensions(I,S,s)?u.push({position:_,origin:E,overlayRect:t,boundingBoxRect:this._calculateBoundingBoxRect(E,_)}):(!f||f.overlayFit.visibleArea<I.visibleArea)&&(f={overlayFit:I,overlayPoint:S,originPoint:E,position:_,overlayRect:t})}if(u.length){let _=null,E=-1;for(const S of u){const I=S.boundingBoxRect.width*S.boundingBoxRect.height*(S.position.weight||1);I>E&&(E=I,_=S)}return this._isPushed=!1,void this._applyPosition(_.position,_.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(f.position,f.originPoint);this._applyPosition(f.position,f.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&cE(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(EK),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const i=this._lastPosition;if(i){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._getOriginPoint(this._originRect,this._containerRect,i);this._applyPosition(i,t)}else this.apply()}withScrollableContainers(i){return this._scrollables=i,this}withPositions(i){return this._preferredPositions=i,-1===i.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(i){return this._viewportMargin=i,this}withFlexibleDimensions(i=!0){return this._hasFlexibleDimensions=i,this}withGrowAfterOpen(i=!0){return this._growAfterOpen=i,this}withPush(i=!0){return this._canPush=i,this}withLockedPosition(i=!0){return this._positionLocked=i,this}setOrigin(i){return this._origin=i,this}withDefaultOffsetX(i){return this._offsetX=i,this}withDefaultOffsetY(i){return this._offsetY=i,this}withTransformOriginOn(i){return this._transformOriginSelector=i,this}_getOriginPoint(i,t,s){let c,u;if("center"==s.originX)c=i.left+i.width/2;else{const f=this._isRtl()?i.right:i.left,_=this._isRtl()?i.left:i.right;c="start"==s.originX?f:_}return t.left<0&&(c-=t.left),u="center"==s.originY?i.top+i.height/2:"top"==s.originY?i.top:i.bottom,t.top<0&&(u-=t.top),{x:c,y:u}}_getOverlayPoint(i,t,s){let c,u;return c="center"==s.overlayX?-t.width/2:"start"===s.overlayX?this._isRtl()?-t.width:0:this._isRtl()?0:-t.width,u="center"==s.overlayY?-t.height/2:"top"==s.overlayY?0:-t.height,{x:i.x+c,y:i.y+u}}_getOverlayFit(i,t,s,c){const u=bK(t);let{x:f,y:_}=i,E=this._getOffset(c,"x"),S=this._getOffset(c,"y");E&&(f+=E),S&&(_+=S);let U=0-_,B=_+u.height-s.height,G=this._subtractOverflows(u.width,0-f,f+u.width-s.width),K=this._subtractOverflows(u.height,U,B),te=G*K;return{visibleArea:te,isCompletelyWithinViewport:u.width*u.height===te,fitsInViewportVertically:K===u.height,fitsInViewportHorizontally:G==u.width}}_canFitWithFlexibleDimensions(i,t,s){if(this._hasFlexibleDimensions){const c=s.bottom-t.y,u=s.right-t.x,f=yK(this._overlayRef.getConfig().minHeight),_=yK(this._overlayRef.getConfig().minWidth);return(i.fitsInViewportVertically||null!=f&&f<=c)&&(i.fitsInViewportHorizontally||null!=_&&_<=u)}return!1}_pushOverlayOnScreen(i,t,s){if(this._previousPushAmount&&this._positionLocked)return{x:i.x+this._previousPushAmount.x,y:i.y+this._previousPushAmount.y};const c=bK(t),u=this._viewportRect,f=Math.max(i.x+c.width-u.width,0),_=Math.max(i.y+c.height-u.height,0),E=Math.max(u.top-s.top-i.y,0),S=Math.max(u.left-s.left-i.x,0);let I=0,P=0;return I=c.width<=u.width?S||-f:i.x<this._viewportMargin?u.left-s.left-i.x:0,P=c.height<=u.height?E||-_:i.y<this._viewportMargin?u.top-s.top-i.y:0,this._previousPushAmount={x:I,y:P},{x:i.x+I,y:i.y+P}}_applyPosition(i,t){if(this._setTransformOrigin(i),this._setOverlayElementStyles(t,i),this._setBoundingBoxStyles(t,i),i.panelClass&&this._addPanelClasses(i.panelClass),this._positionChanges.observers.length){const s=this._getScrollVisibility();if(i!==this._lastPosition||!this._lastScrollVisibility||!function jQ(e,i){return e===i||e.isOriginClipped===i.isOriginClipped&&e.isOriginOutsideView===i.isOriginOutsideView&&e.isOverlayClipped===i.isOverlayClipped&&e.isOverlayOutsideView===i.isOverlayOutsideView}(this._lastScrollVisibility,s)){const c=new LQ(i,s);this._positionChanges.next(c)}this._lastScrollVisibility=s}this._lastPosition=i,this._isInitialRender=!1}_setTransformOrigin(i){if(!this._transformOriginSelector)return;const t=this._boundingBox.querySelectorAll(this._transformOriginSelector);let s,c=i.overlayY;s="center"===i.overlayX?"center":this._isRtl()?"start"===i.overlayX?"right":"left":"start"===i.overlayX?"left":"right";for(let u=0;u<t.length;u++)t[u].style.transformOrigin=`${s} ${c}`}_calculateBoundingBoxRect(i,t){const s=this._viewportRect,c=this._isRtl();let u,f,_,I,P,U;if("top"===t.overlayY)f=i.y,u=s.height-f+this._viewportMargin;else if("bottom"===t.overlayY)_=s.height-i.y+2*this._viewportMargin,u=s.height-_+this._viewportMargin;else{const B=Math.min(s.bottom-i.y+s.top,i.y),G=this._lastBoundingBoxSize.height;u=2*B,f=i.y-B,u>G&&!this._isInitialRender&&!this._growAfterOpen&&(f=i.y-G/2)}if("end"===t.overlayX&&!c||"start"===t.overlayX&&c)U=s.width-i.x+2*this._viewportMargin,I=i.x-this._viewportMargin;else if("start"===t.overlayX&&!c||"end"===t.overlayX&&c)P=i.x,I=s.right-i.x;else{const B=Math.min(s.right-i.x+s.left,i.x),G=this._lastBoundingBoxSize.width;I=2*B,P=i.x-B,I>G&&!this._isInitialRender&&!this._growAfterOpen&&(P=i.x-G/2)}return{top:f,left:P,bottom:_,right:U,width:I,height:u}}_setBoundingBoxStyles(i,t){const s=this._calculateBoundingBoxRect(i,t);!this._isInitialRender&&!this._growAfterOpen&&(s.height=Math.min(s.height,this._lastBoundingBoxSize.height),s.width=Math.min(s.width,this._lastBoundingBoxSize.width));const c={};if(this._hasExactPosition())c.top=c.left="0",c.bottom=c.right=c.maxHeight=c.maxWidth="",c.width=c.height="100%";else{const u=this._overlayRef.getConfig().maxHeight,f=this._overlayRef.getConfig().maxWidth;c.height=xr(s.height),c.top=xr(s.top),c.bottom=xr(s.bottom),c.width=xr(s.width),c.left=xr(s.left),c.right=xr(s.right),c.alignItems="center"===t.overlayX?"center":"end"===t.overlayX?"flex-end":"flex-start",c.justifyContent="center"===t.overlayY?"center":"bottom"===t.overlayY?"flex-end":"flex-start",u&&(c.maxHeight=xr(u)),f&&(c.maxWidth=xr(f))}this._lastBoundingBoxSize=s,cE(this._boundingBox.style,c)}_resetBoundingBoxStyles(){cE(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){cE(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(i,t){const s={},c=this._hasExactPosition(),u=this._hasFlexibleDimensions,f=this._overlayRef.getConfig();if(c){const I=this._viewportRuler.getViewportScrollPosition();cE(s,this._getExactOverlayY(t,i,I)),cE(s,this._getExactOverlayX(t,i,I))}else s.position="static";let _="",E=this._getOffset(t,"x"),S=this._getOffset(t,"y");E&&(_+=`translateX(${E}px) `),S&&(_+=`translateY(${S}px)`),s.transform=_.trim(),f.maxHeight&&(c?s.maxHeight=xr(f.maxHeight):u&&(s.maxHeight="")),f.maxWidth&&(c?s.maxWidth=xr(f.maxWidth):u&&(s.maxWidth="")),cE(this._pane.style,s)}_getExactOverlayY(i,t,s){let c={top:"",bottom:""},u=this._getOverlayPoint(t,this._overlayRect,i);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,s)),"bottom"===i.overlayY?c.bottom=this._document.documentElement.clientHeight-(u.y+this._overlayRect.height)+"px":c.top=xr(u.y),c}_getExactOverlayX(i,t,s){let f,c={left:"",right:""},u=this._getOverlayPoint(t,this._overlayRect,i);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,s)),f=this._isRtl()?"end"===i.overlayX?"left":"right":"end"===i.overlayX?"right":"left","right"===f?c.right=this._document.documentElement.clientWidth-(u.x+this._overlayRect.width)+"px":c.left=xr(u.x),c}_getScrollVisibility(){const i=this._getOriginRect(),t=this._pane.getBoundingClientRect(),s=this._scrollables.map(c=>c.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:mK(i,s),isOriginOutsideView:q8(i,s),isOverlayClipped:mK(t,s),isOverlayOutsideView:q8(t,s)}}_subtractOverflows(i,...t){return t.reduce((s,c)=>s-Math.max(c,0),i)}_getNarrowedViewportRect(){const i=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,s=this._viewportRuler.getViewportScrollPosition();return{top:s.top+this._viewportMargin,left:s.left+this._viewportMargin,right:s.left+i-this._viewportMargin,bottom:s.top+t-this._viewportMargin,width:i-2*this._viewportMargin,height:t-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(i,t){return"x"===t?null==i.offsetX?this._offsetX:i.offsetX:null==i.offsetY?this._offsetY:i.offsetY}_validatePositions(){}_addPanelClasses(i){this._pane&&xU(i).forEach(t=>{""!==t&&-1===this._appliedPanelClasses.indexOf(t)&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(i=>{this._pane.classList.remove(i)}),this._appliedPanelClasses=[])}_getOriginRect(){const i=this._origin;if(i instanceof On)return i.nativeElement.getBoundingClientRect();if(i instanceof Element)return i.getBoundingClientRect();const t=i.width||0,s=i.height||0;return{top:i.y,bottom:i.y+s,left:i.x,right:i.x+t,height:s,width:t}}}function cE(e,i){for(let t in i)i.hasOwnProperty(t)&&(e[t]=i[t]);return e}function yK(e){if("number"!=typeof e&&null!=e){const[i,t]=e.split(VQ);return t&&"px"!==t?null:parseFloat(i)}return e||null}function bK(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}const SK="cdk-global-overlay-wrapper";class HQ{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(i){const t=i.getConfig();this._overlayRef=i,this._width&&!t.width&&i.updateSize({width:this._width}),this._height&&!t.height&&i.updateSize({height:this._height}),i.hostElement.classList.add(SK),this._isDisposed=!1}top(i=""){return this._bottomOffset="",this._topOffset=i,this._alignItems="flex-start",this}left(i=""){return this._xOffset=i,this._xPosition="left",this}bottom(i=""){return this._topOffset="",this._bottomOffset=i,this._alignItems="flex-end",this}right(i=""){return this._xOffset=i,this._xPosition="right",this}start(i=""){return this._xOffset=i,this._xPosition="start",this}end(i=""){return this._xOffset=i,this._xPosition="end",this}width(i=""){return this._overlayRef?this._overlayRef.updateSize({width:i}):this._width=i,this}height(i=""){return this._overlayRef?this._overlayRef.updateSize({height:i}):this._height=i,this}centerHorizontally(i=""){return this.left(i),this._xPosition="center",this}centerVertically(i=""){return this.top(i),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const i=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,s=this._overlayRef.getConfig(),{width:c,height:u,maxWidth:f,maxHeight:_}=s,E=!("100%"!==c&&"100vw"!==c||f&&"100%"!==f&&"100vw"!==f),S=!("100%"!==u&&"100vh"!==u||_&&"100%"!==_&&"100vh"!==_),I=this._xPosition,P=this._xOffset,U="rtl"===this._overlayRef.getConfig().direction;let B="",G="",K="";E?K="flex-start":"center"===I?(K="center",U?G=P:B=P):U?"left"===I||"end"===I?(K="flex-end",B=P):("right"===I||"start"===I)&&(K="flex-start",G=P):"left"===I||"start"===I?(K="flex-start",B=P):("right"===I||"end"===I)&&(K="flex-end",G=P),i.position=this._cssPosition,i.marginLeft=E?"0":B,i.marginTop=S?"0":this._topOffset,i.marginBottom=this._bottomOffset,i.marginRight=E?"0":G,t.justifyContent=K,t.alignItems=S?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const i=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,s=t.style;t.classList.remove(SK),s.justifyContent=s.alignItems=i.marginTop=i.marginBottom=i.marginLeft=i.marginRight=i.position="",this._overlayRef=null,this._isDisposed=!0}}let GQ=(()=>{class e{constructor(t,s,c,u){this._viewportRuler=t,this._document=s,this._platform=c,this._overlayContainer=u}global(){return new HQ}flexibleConnectedTo(t){return new BQ(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static{this.\u0275fac=function(s){return new(s||e)(ye(dK),ye(Ve),ye(Ho),ye(vK))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),WQ=0,rT=(()=>{class e{constructor(t,s,c,u,f,_,E,S,I,P,U,B){this.scrollStrategies=t,this._overlayContainer=s,this._componentFactoryResolver=c,this._positionBuilder=u,this._keyboardDispatcher=f,this._injector=_,this._ngZone=E,this._document=S,this._directionality=I,this._location=P,this._outsideClickDispatcher=U,this._animationsModuleType=B}create(t){const s=this._createHostElement(),c=this._createPaneElement(s),u=this._createPortalOutlet(c),f=new kQ(t);return f.direction=f.direction||this._directionality.value,new UQ(u,s,c,f,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType,this._injector.get($o))}position(){return this._positionBuilder}_createPaneElement(t){const s=this._document.createElement("div");return s.id="cdk-overlay-"+WQ++,s.classList.add("cdk-overlay-pane"),t.appendChild(s),s}_createHostElement(){const t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(Sr)),new AQ(t,this._componentFactoryResolver,this._appRef,this._injector,this._document)}static{this.\u0275fac=function(s){return new(s||e)(ye(MQ),ye(vK),ye(Qp),ye(GQ),ye(xQ),ye(Oi),ye(ft),ye(Ve),ye(F8),ye(Ih),ye(FQ),ye(tl,8))}}static{this.\u0275prov=Oe({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const qQ={provide:new Te("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{const e=me(rT);return()=>e.scrollStrategies.reposition()}}),deps:[rT],useFactory:function KQ(e){return()=>e.scrollStrategies.reposition()}};let YQ=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({providers:[rT,qQ],imports:[HO,DQ,uK,uK]})}}return e})();const $Q=["tooltip"],TK=new Te("mat-tooltip-scroll-strategy",{providedIn:"root",factory:()=>{const e=me(rT);return()=>e.scrollStrategies.reposition({scrollThrottle:20})}}),ZQ={provide:TK,deps:[rT],useFactory:function XQ(e){return()=>e.scrollStrategies.reposition({scrollThrottle:20})}},QQ=new Te("mat-tooltip-default-options",{providedIn:"root",factory:function JQ(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}}),IK="tooltip-panel",wK=tT({passive:!0});let ree=(()=>{class e{get position(){return this._position}set position(t){t!==this._position&&(this._position=t,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(t){this._positionAtOrigin=nT(t),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(t){const s=nT(t);this._disabled!==s&&(this._disabled=s,s?this.hide(0):this._setupPointerEnterEventsIfNeeded(),this._syncAriaDescription(this.message))}get showDelay(){return this._showDelay}set showDelay(t){this._showDelay=g7(t)}get hideDelay(){return this._hideDelay}set hideDelay(t){this._hideDelay=g7(t),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(t){const s=this._message;this._message=null!=t?String(t).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage()),this._syncAriaDescription(s)}get tooltipClass(){return this._tooltipClass}set tooltipClass(t){this._tooltipClass=t,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}constructor(t,s,c,u,f,_,E,S,I,P,U,B){this._overlay=t,this._elementRef=s,this._scrollDispatcher=c,this._viewContainerRef=u,this._ngZone=f,this._platform=_,this._ariaDescriber=E,this._focusMonitor=S,this._dir=P,this._defaultOptions=U,this._position="below",this._positionAtOrigin=!1,this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._tooltipComponent=oee,this._viewportMargin=8,this._cssClassPrefix="mat-mdc",this.touchGestures="auto",this._message="",this._passiveListeners=[],this._touchstartTimeout=null,this._destroyed=new Mt,this._injector=me(Oi),this._scrollStrategy=I,this._document=B,U&&(this._showDelay=U.showDelay,this._hideDelay=U.hideDelay,U.position&&(this.position=U.position),U.positionAtOrigin&&(this.positionAtOrigin=U.positionAtOrigin),U.touchGestures&&(this.touchGestures=U.touchGestures),U.tooltipClass&&(this.tooltipClass=U.tooltipClass)),P.change.pipe(Tr(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)}),this._viewportMargin=8}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(Tr(this._destroyed)).subscribe(t=>{t?"keyboard"===t&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const t=this._elementRef.nativeElement;this._touchstartTimeout&&clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([s,c])=>{t.removeEventListener(s,c,wK)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(t,this.message,"tooltip"),this._focusMonitor.stopMonitoring(t)}show(t=this.showDelay,s){if(this.disabled||!this.message||this._isTooltipVisible())return void this._tooltipInstance?._cancelPendingAnimations();const c=this._createOverlay(s);this._detach(),this._portal=this._portal||new hK(this._tooltipComponent,this._viewContainerRef);const u=this._tooltipInstance=c.attach(this._portal).instance;u._triggerElement=this._elementRef.nativeElement,u._mouseLeaveHideDelay=this._hideDelay,u.afterHidden().pipe(Tr(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),u.show(t)}hide(t=this.hideDelay){const s=this._tooltipInstance;s&&(s.isVisible()?s.hide(t):(s._cancelPendingAnimations(),this._detach()))}toggle(t){this._isTooltipVisible()?this.hide():this.show(void 0,t)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(t){if(this._overlayRef){const u=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!t)&&u._origin instanceof On)return this._overlayRef;this._detach()}const s=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),c=this._overlay.position().flexibleConnectedTo(this.positionAtOrigin&&t||this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(s);return c.positionChanges.pipe(Tr(this._destroyed)).subscribe(u=>{this._updateCurrentPositionClass(u.connectionPair),this._tooltipInstance&&u.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:c,panelClass:`${this._cssClassPrefix}-${IK}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(Tr(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(Tr(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(Tr(this._destroyed)).subscribe(u=>{this._isTooltipVisible()&&27===u.keyCode&&!function u7(e,...i){return i.length?i.some(t=>e[t]):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}(u)&&(u.preventDefault(),u.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(t){const s=t.getConfig().positionStrategy,c=this._getOrigin(),u=this._getOverlayPosition();s.withPositions([this._addOffset({...c.main,...u.main}),this._addOffset({...c.fallback,...u.fallback})])}_addOffset(t){const c=!this._dir||"ltr"==this._dir.value;return"top"===t.originY?t.offsetY=-8:"bottom"===t.originY?t.offsetY=8:"start"===t.originX?t.offsetX=c?-8:8:"end"===t.originX&&(t.offsetX=c?8:-8),t}_getOrigin(){const t=!this._dir||"ltr"==this._dir.value,s=this.position;let c;"above"==s||"below"==s?c={originX:"center",originY:"above"==s?"top":"bottom"}:"before"==s||"left"==s&&t||"right"==s&&!t?c={originX:"start",originY:"center"}:("after"==s||"right"==s&&t||"left"==s&&!t)&&(c={originX:"end",originY:"center"});const{x:u,y:f}=this._invertPosition(c.originX,c.originY);return{main:c,fallback:{originX:u,originY:f}}}_getOverlayPosition(){const t=!this._dir||"ltr"==this._dir.value,s=this.position;let c;"above"==s?c={overlayX:"center",overlayY:"bottom"}:"below"==s?c={overlayX:"center",overlayY:"top"}:"before"==s||"left"==s&&t||"right"==s&&!t?c={overlayX:"end",overlayY:"center"}:("after"==s||"right"==s&&t||"left"==s&&!t)&&(c={overlayX:"start",overlayY:"center"});const{x:u,y:f}=this._invertPosition(c.overlayX,c.overlayY);return{main:c,fallback:{overlayX:u,overlayY:f}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),uf(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()},{injector:this._injector}))}_setTooltipClass(t){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=t,this._tooltipInstance._markForCheck())}_invertPosition(t,s){return"above"===this.position||"below"===this.position?"top"===s?s="bottom":"bottom"===s&&(s="top"):"end"===t?t="start":"start"===t&&(t="end"),{x:t,y:s}}_updateCurrentPositionClass(t){const{overlayY:s,originX:c,originY:u}=t;let f;if(f="center"===s?this._dir&&"rtl"===this._dir.value?"end"===c?"left":"right":"start"===c?"left":"right":"bottom"===s&&"top"===u?"above":"below",f!==this._currentPosition){const _=this._overlayRef;if(_){const E=`${this._cssClassPrefix}-${IK}-`;_.removePanelClass(E+this._currentPosition),_.addPanelClass(E+f)}this._currentPosition=f}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",t=>{let s;this._setupPointerExitEventsIfNeeded(),void 0!==t.x&&void 0!==t.y&&(s=t),this.show(void 0,s)}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",t=>{const s=t.targetTouches?.[0],c=s?{x:s.clientX,y:s.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),this._touchstartTimeout&&clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>{this._touchstartTimeout=null,this.show(void 0,c)},this._defaultOptions.touchLongPressShowDelay??500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const t=[];if(this._platformSupportsMouseEvents())t.push(["mouseleave",s=>{const c=s.relatedTarget;(!c||!this._overlayRef?.overlayElement.contains(c))&&this.hide()}],["wheel",s=>this._wheelListener(s)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const s=()=>{this._touchstartTimeout&&clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};t.push(["touchend",s],["touchcancel",s])}this._addListeners(t),this._passiveListeners.push(...t)}_addListeners(t){t.forEach(([s,c])=>{this._elementRef.nativeElement.addEventListener(s,c,wK)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(t){if(this._isTooltipVisible()){const s=this._document.elementFromPoint(t.clientX,t.clientY),c=this._elementRef.nativeElement;s!==c&&!c.contains(s)&&this.hide()}}_disableNativeGesturesIfNecessary(){const t=this.touchGestures;if("off"!==t){const s=this._elementRef.nativeElement,c=s.style;("on"===t||"INPUT"!==s.nodeName&&"TEXTAREA"!==s.nodeName)&&(c.userSelect=c.msUserSelect=c.webkitUserSelect=c.MozUserSelect="none"),("on"===t||!s.draggable)&&(c.webkitUserDrag="none"),c.touchAction="none",c.webkitTapHighlightColor="transparent"}}_syncAriaDescription(t){this._ariaDescriptionPending||(this._ariaDescriptionPending=!0,this._ariaDescriber.removeDescription(this._elementRef.nativeElement,t,"tooltip"),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriptionPending=!1,this.message&&!this.disabled&&this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}static{this.\u0275fac=function(s){return new(s||e)(re(rT),re(On),re(lK),re(js),re(ft),re(Ho),re(cZ),re(L8),re(TK),re(F8),re(QQ,8),re(Ve))}}static{this.\u0275dir=Ue({type:e,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],hostVars:2,hostBindings:function(s,c){2&s&&nt("mat-mdc-tooltip-disabled",c.disabled)},inputs:{position:[0,"matTooltipPosition","position"],positionAtOrigin:[0,"matTooltipPositionAtOrigin","positionAtOrigin"],disabled:[0,"matTooltipDisabled","disabled"],showDelay:[0,"matTooltipShowDelay","showDelay"],hideDelay:[0,"matTooltipHideDelay","hideDelay"],touchGestures:[0,"matTooltipTouchGestures","touchGestures"],message:[0,"matTooltip","message"],tooltipClass:[0,"matTooltipClass","tooltipClass"]},exportAs:["matTooltip"],standalone:!0})}}return e})(),oee=(()=>{class e{constructor(t,s,c){this._changeDetectorRef=t,this._elementRef=s,this._isMultiline=!1,this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new Mt,this._showAnimation="mat-mdc-tooltip-show",this._hideAnimation="mat-mdc-tooltip-hide",this._animationsDisabled="NoopAnimations"===c}show(t){null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},t)}hide(t){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},t)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:t}){(!t||!this._triggerElement.contains(t))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){const t=this._elementRef.nativeElement.getBoundingClientRect();return t.height>24&&t.width>=200}_handleAnimationEnd({animationName:t}){(t===this._showAnimation||t===this._hideAnimation)&&this._finalizeAnimation(t===this._showAnimation)}_cancelPendingAnimations(){null!=this._showTimeoutId&&clearTimeout(this._showTimeoutId),null!=this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(t){t?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(t){const s=this._tooltip.nativeElement,c=this._showAnimation,u=this._hideAnimation;if(s.classList.remove(t?u:c),s.classList.add(t?c:u),this._isVisible!==t&&(this._isVisible=t,this._changeDetectorRef.markForCheck()),t&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const f=getComputedStyle(s);("0s"===f.getPropertyValue("animation-duration")||"none"===f.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}t&&this._onShow(),this._animationsDisabled&&(s.classList.add("_mat-animation-noopable"),this._finalizeAnimation(t))}static{this.\u0275fac=function(s){return new(s||e)(re(Js),re(On),re(tl,8))}}static{this.\u0275cmp=no({type:e,selectors:[["mat-tooltip-component"]],viewQuery:function(s,c){if(1&s&&pe($Q,7),2&s){let u;dr(u=kn())&&(c._tooltip=u.first)}},hostAttrs:["aria-hidden","true"],hostBindings:function(s,c){1&s&&Mn("mouseleave",function(f){return c._handleMouseLeave(f)})},standalone:!0,features:[fo],decls:4,vars:4,consts:[["tooltip",""],[1,"mdc-tooltip","mat-mdc-tooltip",3,"animationend","ngClass"],[1,"mat-mdc-tooltip-surface","mdc-tooltip__surface"]],template:function(s,c){if(1&s){const u=yc();Se(0,"div",1,0),Mn("animationend",function(_){return Zo(u),oo(c._handleAnimationEnd(_))}),Se(2,"div",2),fn(3),Be()()}2&s&&(nt("mdc-tooltip--multiline",c._isMultiline),$e("ngClass",c.tooltipClass),Ze(3),at(c.message))},dependencies:[mv],styles:['.mat-mdc-tooltip{position:relative;transform:scale(0);display:inline-flex}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-surface{word-break:normal;overflow-wrap:anywhere;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center;will-change:transform,opacity;background-color:var(--mdc-plain-tooltip-container-color, var(--mat-app-inverse-surface));color:var(--mdc-plain-tooltip-supporting-text-color, var(--mat-app-inverse-on-surface));border-radius:var(--mdc-plain-tooltip-container-shape, var(--mat-app-corner-extra-small));font-family:var(--mdc-plain-tooltip-supporting-text-font, var(--mat-app-body-small-font));font-size:var(--mdc-plain-tooltip-supporting-text-size, var(--mat-app-body-small-size));font-weight:var(--mdc-plain-tooltip-supporting-text-weight, var(--mat-app-body-small-weight));line-height:var(--mdc-plain-tooltip-supporting-text-line-height, var(--mat-app-body-small-line-height));letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking, var(--mat-app-body-small-tracking))}.mat-mdc-tooltip-surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.mdc-tooltip--multiline .mat-mdc-tooltip-surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mat-mdc-tooltip-surface{text-align:right}.mat-mdc-tooltip-panel.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}'],encapsulation:2,changeDetection:0})}}return e})(),see=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=sr({type:e})}static{this.\u0275inj=qi({providers:[ZQ],imports:[IZ,ED,YQ,Fc,Fc,z8]})}}return e})();(function ra(e,i){return Cx({rootComponent:e,...Xf(i)})})(iq,{providers:[function JK(e,...i){return mu([{provide:lt,multi:!0,useValue:e},[],{provide:tu,useFactory:pz,deps:[ru]},{provide:wS,multi:!0,useFactory:fz},i.map(t=>t.\u0275providers)])}([{path:"",component:(()=>{class e{constructor(t,s,c,u,f){this.formBuilder=t,this.router=s,this.localStorage=c,this.videoCallDialogService=u,this.cdr=f,this.sessionKey="ngx-webrtc:channelId",this.outcome=!1}get channelId(){return this.localStorage.getItem(this.sessionKey)||"test-channel-ngx-webrtc"}get tooltipText(){return this.outcome?"Outcome":"Income"}ngOnInit(){this.form=this.formBuilder.group({channelId:[this.channelId,s9.required]})}onSubmit(){this.saveChannel(),this.router.navigate(["conference"],{queryParams:{...this.form.value}})}onModalOpen(){this.saveChannel(),this.dialog=this.videoCallDialogService.open({uid:String(Math.floor(100*Math.random())),channel:this.channelId,outcome:this.outcome,user:{name:"Test User",photoURL:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTvDtoEwuV9E2kHqNDi6MnBzXlefn8TfyrwgQ&usqp=CAU"},debug:!0});const t=setTimeout(()=>this.dialog?.close(),7e3);this.dialog.afterConfirmation().pipe(Ns(s=>!!s),ir(()=>clearTimeout(t))).subscribe(),this.dialog.afterCallEnd().subscribe(()=>{clearTimeout(t),this.dialog=null,this.cdr.markForCheck()})}saveChannel(){const{channelId:t}=this.form.value;this.localStorage.setItem(this.sessionKey,t)}static{this.\u0275fac=function(s){return new(s||e)(re(RX),re(ru),re(Storage),re(R$),re(Js))}}static{this.\u0275cmp=no({type:e,selectors:[["app-home"]],standalone:!0,features:[fo],decls:25,vars:8,consts:[[1,"home"],[1,"home__welcome"],[1,"home__form",3,"ngSubmit","formGroup"],[1,"home__wrapper","home__wrapper--center"],["src","assets/user.svg","alt","User",1,"user"],[1,"home__title"],["appearance","outline",1,"home__wrapper"],["matInput","","placeholder","Channel id","formControlName","channelId"],[1,"home__wrapper","home__wrapper--center","home__wrapper--buttons"],["mat-flat-button","","color","primary",1,"home__btn",3,"disabled"],["mat-raised-button","","type","button",1,"home__btn",3,"click","disabled"],[3,"change","click","checked","disabled","matTooltip"],[1,"home__footer"],["href","https://www.npmjs.com/package/ngx-webrtc-lib","target","_blank"],["viewBox","0 0 27.23 27.23"],["width","27.23","height","27.23","rx","2"],["fill","#fff","points","5.8 21.75 13.66 21.75 13.67 9.98 17.59 9.98 17.58 21.76 21.51 21.76 21.52 6.06 5.82 6.04 5.8 21.75"],["href","https://github.com/TarasMoskovych/ngx-webrtc","target","_blank"],["aria-hidden","true","role","img","viewBox","0 0 16 16","width","50","height","50",1,""],["fill-rule","evenodd","d","M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"]],template:function(s,c){1&s&&(Se(0,"div",0)(1,"div",1)(2,"form",2),Mn("ngSubmit",function(){return!c.dialog&&c.onSubmit()}),Se(3,"div",3),At(4,"img",4),Be(),Se(5,"h1",5),fn(6," Welcome "),Be(),Se(7,"mat-form-field",6)(8,"mat-label"),fn(9,"Channel Id"),Be(),At(10,"input",7),Be(),Se(11,"div",8)(12,"button",9),fn(13,"Start / Join call"),Be(),Se(14,"button",10),Mn("click",function(){return!c.dialog&&c.onModalOpen()}),fn(15,"Open Call Dialog "),Se(16,"mat-slide-toggle",11),Mn("change",function(f){return c.outcome=f.checked})("click",function(f){return f.stopPropagation()}),Be()()()(),Se(17,"div",12)(18,"a",13),va(),Se(19,"svg",14),At(20,"rect",15)(21,"polygon",16),Be()(),Ea(),Se(22,"a",17),va(),Se(23,"svg",18),At(24,"path",19),Be()()()()()),2&s&&(Ze(2),$e("formGroup",c.form),Ze(5),nt("mat-focused",c.form.valid),Ze(5),$e("disabled",c.form.invalid||!!c.dialog),Ze(2),$e("disabled",c.form.invalid||!!c.dialog),Ze(2),$e("checked",c.outcome)("disabled",!!c.dialog)("matTooltip",c.tooltipText))},dependencies:[tJ,QZ,XJ,$J,zJ,j8,oQ,H8,see,ree,AX,z9,bU,D9,O9,VO,I8],styles:[".home[_ngcontent-%COMP%]{align-items:center;background-color:#f2f2f2;display:flex;flex-wrap:wrap;justify-content:center;min-height:100vh;width:100%}.home__welcome[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 5px 10px #0000001a;overflow:hidden;padding:10px 35px;width:390px}.home__welcome[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{height:150px}.home__title[_ngcontent-%COMP%]{color:#333;display:block;font-size:30px;font-weight:500;margin:10px 0 60px;text-align:center}.home__wrapper[_ngcontent-%COMP%]{width:100%}.home__wrapper--center[_ngcontent-%COMP%]{text-align:center}.home__wrapper--buttons[_ngcontent-%COMP%]{align-items:center;display:flex}.home__btn[_ngcontent-%COMP%]{letter-spacing:normal}.home__btn[_ngcontent-%COMP%]:first-of-type{margin-right:5px}.home__btn[_ngcontent-%COMP%]:last-of-type{margin-left:5px}.home__footer[_ngcontent-%COMP%]{margin-top:30px;text-align:center}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:#333;cursor:pointer;height:24px;margin:0 5px;width:24px;transition:.3s}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]:hover{fill:#aaa}"],changeDetection:0})}}return e})()},{path:"conference",component:(()=>{class e{constructor(t,s){this.route=t,this.router=s,this.uid=String(Math.floor(100*Math.random()))}ngOnInit(){this.channel=this.route.snapshot.queryParams.channelId||"test-channel"}onCallEnd(){this.router.navigateByUrl("/")}static{this.\u0275fac=function(s){return new(s||e)(re(tu),re(ru))}}static{this.\u0275cmp=no({type:e,selectors:[["app-conference"]],standalone:!0,features:[fo],decls:1,vars:4,consts:[[3,"callEnd","animate","channel","debug","uid"]],template:function(s,c){1&s&&(Se(0,"ngx-webrtc",0),Mn("callEnd",function(){return c.onCallEnd()}),Be()),2&s&&$e("animate",!1)("channel",c.channel)("debug",!0)("uid",c.uid)},dependencies:[t9],changeDetection:0})}}return e})()},{path:"**",redirectTo:""}]),function QY(){return jr("NgEagerAnimations"),[...ZY]}(),function A$(e){return mu([e9,{provide:"AgoraConfig",useValue:e}])}({AppID:"67f11adf2f054480b431c8447ff85d91"}),{provide:Storage,useValue:window.localStorage}]}).catch(e=>console.error(e))},827:function(zl,uE,hE){var L=hE(293).default;zl.exports=function(){"use strict";var eo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Pt=function(n){try{return!!n()}catch{return!0}},gt=!Pt(function(){var n=function(){}.bind();return"function"!=typeof n||n.hasOwnProperty("prototype")}),ec=gt,Kl=Function.prototype,Bc=Kl.call,du=ec&&Kl.bind.bind(Bc,Bc),xn=ec?du:function(n){return function(){return Bc.apply(n,arguments)}},Ar=xn({}.isPrototypeOf),Em=function(n){return n&&n.Math==Math&&n},ti=Em("object"==typeof globalThis&&globalThis)||Em("object"==typeof window&&window)||Em("object"==typeof self&&self)||Em("object"==typeof eo&&eo)||function(){return this}()||eo||Function("return this")(),aT=Function.prototype,ym=aT.apply,pE=aT.call,Jh="object"==typeof Reflect&&Reflect.apply||(gt?pE.bind(ym):function(){return pE.apply(ym,arguments)}),fE=xn,YO=fE({}.toString),mE=fE("".slice),Go=function(n){return mE(YO(n),8,-1)},gE=Go,$O=xn,Qh=function(n){if("Function"===gE(n))return $O(n)},_E="object"==typeof document&&document.all,ep={all:_E,IS_HTMLDDA:void 0===_E&&void 0!==_E},cT=ep.all,di=ep.IS_HTMLDDA?function(n){return"function"==typeof n||n===cT}:function(n){return"function"==typeof n},bm={},gs=!Pt(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),Sm=Function.prototype.call,Ui=gt?Sm.bind(Sm):function(){return Sm.apply(Sm,arguments)},uu={},ZO={}.propertyIsEnumerable,qU=Object.getOwnPropertyDescriptor,X8=qU&&!ZO.call({1:2},1);uu.f=X8?function(n){var r=qU(this,n);return!!r&&r.enumerable}:ZO;var jc,vE,hu=function(n,r){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:r}},YU=Pt,$U=Go,lT=Object,dT=xn("".split),EE=YU(function(){return!lT("z").propertyIsEnumerable(0)})?function(n){return"String"==$U(n)?dT(n,""):lT(n)}:lT,Cm=function(n){return null==n},vn=Cm,uT=TypeError,ql=function(n){if(vn(n))throw uT("Can't call method on "+n);return n},yE=EE,Ri=ql,Hc=function(n){return yE(Ri(n))},hT=di,JO=ep.all,or=ep.IS_HTMLDDA?function(n){return"object"==typeof n?null!==n:hT(n)||n===JO}:function(n){return"object"==typeof n?null!==n:hT(n)},to={},bE=to,tp=ti,XU=di,QO=function(n){return XU(n)?n:void 0},yo=function(n,r){return arguments.length<2?QO(bE[n])||QO(tp[n]):bE[n]&&bE[n][r]||tp[n]&&tp[n][r]},tc=typeof navigator<"u"&&String(navigator.userAgent)||"",np=tc,eN=ti.process,SE=ti.Deno,tN=eN&&eN.versions||SE&&SE.version,CE=tN&&tN.v8;CE&&(vE=(jc=CE.split("."))[0]>0&&jc[0]<4?1:+(jc[0]+jc[1])),!vE&&np&&(!(jc=np.match(/Edge\/(\d+)/))||jc[1]>=74)&&(jc=np.match(/Chrome\/(\d+)/))&&(vE=+jc[1]);var pu=vE,ip=pu,ZU=ti.String,$l=!!Object.getOwnPropertySymbols&&!Pt(function(){var n=Symbol();return!ZU(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&ip&&ip<41}),nN=$l&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,pT=yo,Xl=di,JU=Ar,iN=Object,ni=nN?function(n){return"symbol"==typeof n}:function(n){var r=pT("Symbol");return Xl(r)&&JU(r.prototype,iN(n))},rN=String,rp=function(n){try{return rN(n)}catch{return"Object"}},QU=di,eV=rp,Mt=TypeError,Wo=function(n){if(QU(n))return n;throw Mt(eV(n)+" is not a function")},bo=Wo,oN=Cm,yi=function(n,r){var o=n[r];return oN(o)?void 0:bo(o)},ui=Ui,fT=di,Jt=or,Z8=TypeError,mT={exports:{}},se=ti,op=Object.defineProperty,gT="__core-js_shared__",sN=ti[gT]||function(n,r){try{op(se,n,{value:r,configurable:!0,writable:!0})}catch{se[n]=r}return r}(gT,{}),tV=sN;(mT.exports=function(n,r){return tV[n]||(tV[n]=void 0!==r?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var fu=mT.exports,Gc=ql,sp=Object,So=function(n){return sp(Gc(n))},ap=So,aN=xn({}.hasOwnProperty),Ai=Object.hasOwn||function(n,r){return aN(ap(n),r)},cp=xn,J8=0,bi=Math.random(),Q8=cp(1..toString),cN=function(n){return"Symbol("+(void 0===n?"":n)+")_"+Q8(++J8+bi,36)},lN=Ai,mr=cN,_T=$l,eG=nN,lp=ti.Symbol,Fn=fu("wks"),ht=eG?lp.for||lp:lp&&lp.withoutSetter||mr,En=function(n){return lN(Fn,n)||(Fn[n]=_T&&lN(lp,n)?lp[n]:ht("Symbol."+n)),Fn[n]},_s=Ui,nV=or,dN=ni,tG=yi,nG=TypeError,iG=En("toPrimitive"),rG=function(n,r){if(!nV(n)||dN(n))return n;var o,a=tG(n,iG);if(a){if(void 0===r&&(r="default"),o=_s(a,n,r),!nV(o)||dN(o))return o;throw nG("Can't convert object to primitive value")}return void 0===r&&(r="number"),function(n,r){var o,a;if("string"===r&&fT(o=n.toString)&&!Jt(a=ui(o,n))||fT(o=n.valueOf)&&!Jt(a=ui(o,n))||"string"!==r&&fT(o=n.toString)&&!Jt(a=ui(o,n)))return a;throw Z8("Can't convert object to primitive value")}(n,r)},oG=ni,wE=function(n){var r=rG(n,"string");return oG(r)?r:r+""},iV=or,vT=ti.document,sG=iV(vT)&&iV(vT.createElement),Co=function(n){return sG?vT.createElement(n):{}},rt=Co,rV=!gs&&!Pt(function(){return 7!=Object.defineProperty(rt("div"),"a",{get:function(){return 7}}).a}),cG=Ui,lG=uu,dG=hu,Oe=Hc,uG=wE,qi=Ai,RE=rV,uN=Object.getOwnPropertyDescriptor;bm.f=gs?uN:function(n,r){if(n=Oe(n),r=uG(r),RE)try{return uN(n,r)}catch{}if(qi(n,r))return dG(!cG(lG.f,n,r),n[r])};var hN=Pt,oV=di,AE=/#|\.prototype\./,Jl=function(n,r){var o=pN[ET(n)];return o==Te||o!=sV&&(oV(r)?hN(r):!!r)},ET=Jl.normalize=function(n){return String(n).replace(AE,".").toLowerCase()},pN=Jl.data={},sV=Jl.NATIVE="N",Te=Jl.POLYFILL="P",DE=Jl,yT=Wo,fN=gt,bT=Qh(Qh.bind),Ql=function(n,r){return yT(n),void 0===r?n:fN?bT(n,r):function(){return n.apply(r,arguments)}},zo={},aV=gs&&Pt(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),hG=or,pG=String,fG=TypeError,Dr=function(n){if(hG(n))return n;throw fG(pG(n)+" is not an object")},ST=rV,Im=Dr,nc=wE,wm=TypeError,OE=Object.defineProperty,It=Object.getOwnPropertyDescriptor,ln="enumerable",mN="configurable",TT="writable";zo.f=gs?aV?function(n,r,o){if(Im(n),r=nc(r),Im(o),"function"==typeof n&&"prototype"===r&&"value"in o&&TT in o&&!o[TT]){var a=It(n,r);a&&a[TT]&&(n[r]=o.value,o={configurable:mN in o?o[mN]:a[mN],enumerable:ln in o?o[ln]:a[ln],writable:!1})}return OE(n,r,o)}:OE:function(n,r,o){if(Im(n),r=nc(r),Im(o),ST)try{return OE(n,r,o)}catch{}if("get"in o||"set"in o)throw wm("Accessors not supported");return"value"in o&&(n[r]=o.value),n};var cV=zo,mG=hu,ed=gs?function(n,r,o){return cV.f(n,r,mG(1,o))}:function(n,r,o){return n[r]=o,n},dp=ti,Yt=Jh,IT=Qh,gN=di,Ko=bm.f,_N=DE,Rm=to,gG=Ql,ic=ed,NE=Ai,PE=function(n){var r=function(o,a,l){if(this instanceof r){switch(arguments.length){case 0:return new n;case 1:return new n(o);case 2:return new n(o,a)}return new n(o,a,l)}return Yt(n,this,arguments)};return r.prototype=n.prototype,r},Ft=function(n,r){var o,a,l,d,h,p,m,g,v,y=n.target,b=n.global,C=n.stat,N=n.proto,R=b?dp:C?dp[y]:(dp[y]||{}).prototype,A=b?Rm:Rm[y]||ic(Rm,y,{})[y],D=A.prototype;for(d in r)a=!(o=_N(b?d:y+(C?".":"#")+d,n.forced))&&R&&NE(R,d),p=A[d],a&&(m=n.dontCallGetSet?(v=Ko(R,d))&&v.value:R[d]),h=a&&m?m:r[d],a&&typeof p==typeof h||(g=n.bind&&a?gG(h,dp):n.wrap&&a?PE(h):N&&gN(h)?IT(h):h,(n.sham||h&&h.sham||p&&p.sham)&&ic(g,"sham",!0),ic(A,d,g),N&&(NE(Rm,l=y+"Prototype")||ic(Rm,l,{}),ic(Rm[l],d,h),n.real&&D&&(o||!D[d])&&ic(D,d,h)))},lV=Math.ceil,dV=Math.floor,up=Math.trunc||function(n){var r=+n;return(r>0?dV:lV)(r)},wT=function(n){var r=+n;return r!=r||0===r?0:up(r)},td=wT,uV=Math.max,ye=Math.min,ME=function(n,r){var o=td(n);return o<0?uV(o+r,0):ye(o,r)},me=wT,kE=Math.min,LE=function(n){return n>0?kE(me(n),9007199254740991):0},Am=LE,Wc=function(n){return Am(n.length)},hV=Hc,pV=ME,fV=Wc,xE=function(n){return function(r,o,a){var l,d=hV(r),h=fV(d),p=pV(a,h);if(n&&o!=o){for(;h>p;)if((l=d[p++])!=l)return!0}else for(;h>p;p++)if((n||p in d)&&d[p]===o)return n||p||0;return!n&&-1}},RT={includes:xE(!0),indexOf:xE(!1)},AT=RT.includes;Ft({target:"Array",proto:!0,forced:Pt(function(){return!Array(1).includes()})},{includes:function(n){return AT(this,n,arguments.length>1?arguments[1]:void 0)}});var mV=to,Or=function(n){return mV[n+"Prototype"]},gV=Or("Array").includes,qo=or,hp=Go,EN=En("match"),Dm=function(n){var r;return qo(n)&&(void 0!==(r=n[EN])?!!r:"RegExp"==hp(n))},FE=Dm,DT=TypeError,_V={};_V[En("toStringTag")]="z";var UE="[object z]"===String(_V),_G=UE,vs=di,pp=Go,fp=En("toStringTag"),vG=Object,yN="Arguments"==pp(function(){return arguments}()),gr=_G?pp:function(n){var r,o,a;return void 0===n?"Undefined":null===n?"Null":"string"==typeof(o=function(l,d){try{return l[d]}catch{}}(r=vG(n),fp))?o:yN?pp(r):"Object"==(a=pp(r))&&vs(r.callee)?"Arguments":a},dn=gr,rc=String,Yo=function(n){if("Symbol"===dn(n))throw TypeError("Cannot convert a Symbol value to a string");return rc(n)},OT=En("match"),VE=Ft,la=ql,zc=Yo,NT=xn("".indexOf);VE({target:"String",proto:!0,forced:!function(n){var r=/./;try{"/./"[n](r)}catch{try{return r[OT]=!1,"/./"[n](r)}catch{}}return!1}("includes")},{includes:function(n){return!!~NT(zc(la(this)),zc(function(n){if(FE(n))throw DT("The method doesn't accept regular expressions");return n}(n)),arguments.length>1?arguments[1]:void 0)}});var bN=Or("String").includes,PT=Ar,Om=gV,SN=bN,jE=Array.prototype,MT=String.prototype,he=Gt(function(n){var r=n.includes;return n===jE||PT(jE,n)&&r===jE.includes?Om:"string"==typeof n||n===MT||PT(MT,n)&&r===MT.includes?SN:r}),EV=Wo,da=So,yV=EE,CN=Wc,bV=TypeError,TN=function(n){return function(r,o,a,l){EV(o);var d=da(r),h=yV(d),p=CN(d),m=n?p-1:0,g=n?-1:1;if(a<2)for(;;){if(m in h){l=h[m],m+=g;break}if(m+=g,n?m<0:p<=m)throw bV("Reduce of empty array with no initial value")}for(;n?m>=0:p>m;m+=g)m in h&&(l=o(l,h[m],m,d));return l}},SV={left:TN(!1),right:TN(!0)},CV=Pt,Nm=function(n,r){var o=[][n];return!!o&&CV(function(){o.call(null,r||function(){return 1},1)})},mp=typeof process<"u"&&"process"==Go(process),TV=SV.left;Ft({target:"Array",proto:!0,forced:!mp&&pu>79&&pu<83||!Nm("reduce")},{reduce:function(n){var r=arguments.length;return TV(this,n,r,r>1?arguments[1]:void 0)}});var IV=Or("Array").reduce,no=Ar,wV=IV,LT=Array.prototype,xT=function(n){var r=n.reduce;return n===LT||no(LT,n)&&r===LT.reduce?wV:r},Ue=Gt(xT);let To=!0,Wt=!0;function Vi(n,r,o){const a=n.match(r);return a&&a.length>=o&&parseInt(a[o],10)}function Di(n,r,o){if(!n.RTCPeerConnection)return;const a=n.RTCPeerConnection.prototype,l=a.addEventListener;a.addEventListener=function(h,p){if(h!==r)return l.apply(this,arguments);const m=g=>{const v=o(g);v&&(p.handleEvent?p.handleEvent(v):p(v))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(p,m),l.apply(this,[h,m])};const d=a.removeEventListener;a.removeEventListener=function(h,p){if(h!==r||!this._eventMap||!this._eventMap[r])return d.apply(this,arguments);if(!this._eventMap[r].has(p))return d.apply(this,arguments);const m=this._eventMap[r].get(p);return this._eventMap[r].delete(p),0===this._eventMap[r].size&&delete this._eventMap[r],0===Object.keys(this._eventMap).length&&delete this._eventMap,d.apply(this,[h,m])},Object.defineProperty(a,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function nd(n){return"boolean"!=typeof n?new Error("Argument type: "+typeof n+". Please use a boolean."):(To=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function io(n){return"boolean"!=typeof n?new Error("Argument type: "+typeof n+". Please use a boolean."):(Wt=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function FT(){if("object"==typeof window){if(To)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function HE(n,r){Wt&&console.warn(n+" is deprecated, please use "+r+" instead.")}function Pm(n){return"[object Object]"===Object.prototype.toString.call(n)}function IN(n){var r;return Pm(n)?Ue(r=Object.keys(n)).call(r,function(o,a){const l=Pm(n[a]),d=l?IN(n[a]):n[a],h=l&&!Object.keys(d).length;return void 0===d||h?o:Object.assign(o,{[a]:d})},{}):n}function UT(n,r,o){r&&!o.has(r.id)&&(o.set(r.id,r),Object.keys(r).forEach(a=>{a.endsWith("Id")?UT(n,n.get(r[a]),o):a.endsWith("Ids")&&r[a].forEach(l=>{UT(n,n.get(l),o)})}))}function mu(n,r,o){const a=o?"outbound-rtp":"inbound-rtp",l=new Map;if(null===r)return l;const d=[];return n.forEach(h=>{"track"===h.type&&h.trackIdentifier===r.id&&d.push(h)}),d.forEach(h=>{n.forEach(p=>{p.type===a&&p.trackId===h.id&&UT(n,p,l)})}),l}var RV=cN,GE=fu("keys"),Mm=function(n){return GE[n]||(GE[n]=RV(n))},WE=!Pt(function(){function n(){}return n.prototype.constructor=null,Object.getPrototypeOf(new n)!==n.prototype}),EG=Ai,VT=di,AV=So,BT=WE,jT=Mm("IE_PROTO"),zE=Object,gu=zE.prototype,HT=BT?zE.getPrototypeOf:function(n){var r=AV(n);if(EG(r,jT))return r[jT];var o=r.constructor;return VT(o)&&r instanceof o?o.prototype:r instanceof zE?gu:null},GT=xn,KE=Wo,DV=di,WT=String,qE=TypeError,gp=Dr,OV=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,o={};try{(n=function(n,r,o){try{return GT(KE(Object.getOwnPropertyDescriptor(n,r)[o]))}catch{}}(Object.prototype,"__proto__","set"))(o,[]),r=o instanceof Array}catch{}return function(a,l){return gp(a),function(n){if("object"==typeof n||DV(n))return n;throw qE("Can't set "+WT(n)+" as a prototype")}(l),r?n(a,l):a.__proto__=l,a}}():void 0),YE={},km={},id=Ai,NV=Hc,PV=RT.indexOf,MV=km,$E=xn([].push),Kc=function(n,r){var o,a=NV(n),l=0,d=[];for(o in a)!id(MV,o)&&id(a,o)&&$E(d,o);for(;r.length>l;)id(a,o=r[l++])&&(~PV(d,o)||$E(d,o));return d},XE=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],KT=Kc,_p=XE.concat("length","prototype");YE.f=Object.getOwnPropertyNames||function(n){return KT(n,_p)};var Lm={};Lm.f=Object.getOwnPropertySymbols;var kV=yo,_r=YE,wN=Lm,LV=Dr,xm=xn([].concat),xV=kV("Reflect","ownKeys")||function(n){var r=_r.f(LV(n)),o=wN.f;return o?xm(r,o(n)):r},RN=Ai,FV=xV,UV=bm,VV=zo,qT={},YT=Kc,ZE=XE,ii=Object.keys||function(n){return YT(n,ZE)},ar=zo,ua=Dr,Fr=Hc,Io=ii;qT.f=gs&&!aV?Object.defineProperties:function(n,r){ua(n);for(var o,a=Fr(r),l=Io(r),d=l.length,h=0;d>h;)ar.f(n,o=l[h++],a[o]);return n};var qc,ri=yo("document","documentElement"),cr=Dr,oc=qT,pt=XE,Fm=km,AN=ri,vp=Co,hi="prototype",Yc="script",_u=Mm("IE_PROTO"),ha=function(){},vu=function(n){return"<script>"+n+"</"+Yc+">"},$T=function(n){n.write(vu("")),n.close();var r=n.parentWindow.Object;return n=null,r},pa=function(){try{qc=new ActiveXObject("htmlfile")}catch{}var n,r;pa=typeof document<"u"?document.domain&&qc?$T(qc):((r=vp("iframe")).style.display="none",AN.appendChild(r),r.src=String("javascript:"),(n=r.contentWindow.document).open(),n.write(vu("document.F=Object")),n.close(),n.F):$T(qc);for(var a=pt.length;a--;)delete pa[hi][pt[a]];return pa()};Fm[_u]=!0;var rd=Object.create||function(n,r){var o;return null!==n?(ha[hi]=cr(n),o=new ha,ha[hi]=null,o[_u]=n):o=pa(),void 0===r?o:oc.f(o,r)},Fs=or,He=ed,JE=Error,Um=xn("".replace),sc=String(JE("zxcasd").stack),Vm=/\n\s*at [^:]*:[^\n]*/,Ep=Vm.test(sc),Yi=hu,QE=!Pt(function(){var n=Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",Yi(1,7)),7!==n.stack)}),vr=ed,XT=QE,od=Error.captureStackTrace,ac={},fa=ac,Bm=En("iterator"),DN=Array.prototype,ON=function(n){return void 0!==n&&(fa.Array===n||DN[Bm]===n)},ZT=gr,JT=yi,BV=Cm,QT=ac,yG=En("iterator"),e0=function(n){if(!BV(n))return JT(n,yG)||JT(n,"@@iterator")||QT[ZT(n)]},bG=Ui,SG=Wo,CG=Dr,TG=rp,IG=e0,wG=TypeError,NN=function(n,r){var o=arguments.length<2?IG(n):r;if(SG(o))return CG(bG(o,n));throw wG(TG(n)+" is not iterable")},RG=Ui,jV=Dr,AG=yi,t0=function(n,r,o){var a,l;jV(n);try{if(!(a=AG(n,"return"))){if("throw"===r)throw o;return o}a=RG(a,n)}catch(d){l=!0,a=d}if("throw"===r)throw o;if(l)throw a;return jV(a),o},PN=Ql,DG=Ui,OG=Dr,NG=rp,PG=ON,HV=Wc,n0=Ar,Xo=NN,MN=e0,kN=t0,GV=TypeError,jm=function(n,r){this.stopped=n,this.result=r},r0=jm.prototype,Hm=function(n,r,o){var a,l,d,h,p,m,g,y=!(!o||!o.AS_ENTRIES),b=!(!o||!o.IS_RECORD),C=!(!o||!o.IS_ITERATOR),N=!(!o||!o.INTERRUPTED),R=PN(r,o&&o.that),A=function(M){return a&&kN(a,"normal",M),new jm(!0,M)},D=function(M){return y?(OG(M),N?R(M[0],M[1],A):R(M[0],M[1])):N?R(M,A):R(M)};if(b)a=n.iterator;else if(C)a=n;else{if(!(l=MN(n)))throw GV(NG(n)+" is not iterable");if(PG(l)){for(d=0,h=HV(n);h>d;d++)if((p=D(n[d]))&&n0(r0,p))return p;return new jm(!1)}a=Xo(n,l)}for(m=b?n.next:a.next;!(g=DG(m,a)).done;){try{p=D(g.value)}catch(M){kN(a,"throw",M)}if("object"==typeof p&&p&&n0(r0,p))return p}return new jm(!1)},o0=Yo,WV=Ft,cc=Ar,LN=HT,Gm=OV,ey=rd,Eu=ed,Ur=hu,Wm=function(n,r,o,a){XT&&(od?od(n,r):vr(n,"stack",function(n,r){if(Ep&&"string"==typeof n&&!JE.prepareStackTrace)for(;r--;)n=Um(n,Vm,"");return n}(o,a)))},yu=Hm,KV=En("toStringTag"),yp=Error,qV=[].push,Vr=function(n,r){var o,a=cc(ty,this);Gm?o=Gm(yp(),a?LN(this):ty):(o=a?this:ey(ty),Eu(o,KV,"Error")),void 0!==r&&Eu(o,"message",function(n,r){return void 0===n?arguments.length<2?"":r:o0(n)}(r)),Wm(o,Vr,o.stack,1),arguments.length>2&&function(n,r){Fs(r)&&"cause"in r&&He(n,"cause",r.cause)}(o,arguments[2]);var l=[];return yu(n,qV,{that:l}),Eu(o,"errors",l),o};Gm?Gm(Vr,yp):function(n,r,o){for(var a=FV(r),l=VV.f,d=UV.f,h=0;h<a.length;h++){var p=a[h];RN(n,p)||o&&RN(o,p)||l(n,p,d(r,p))}}(Vr,yp,{name:!0});var ty=Vr.prototype=ey(yp.prototype,{constructor:Ur(1,Vr),message:Ur(1,""),name:Ur(1,"AggregateError")});WV({global:!0,constructor:!0,arity:2},{AggregateError:Vr});var zm,bp,bu,Km=ti.WeakMap,ny=di(Km)&&/native code/.test(String(Km)),$c=or,_t=ed,Sp=Ai,xN=Mm,MG=km,FN="Object already initialized",a0=ti.TypeError;if(ny||sN.state){var ma=sN.state||(sN.state=new(0,ti.WeakMap));ma.get=ma.get,ma.has=ma.has,ma.set=ma.set,zm=function(n,r){if(ma.has(n))throw a0(FN);return r.facade=n,ma.set(n,r),r},bp=function(n){return ma.get(n)||{}},bu=function(n){return ma.has(n)}}else{var Us=xN("state");MG[Us]=!0,zm=function(n,r){if(Sp(n,Us))throw a0(FN);return r.facade=n,_t(n,Us,r),r},bp=function(n){return Sp(n,Us)?n[Us]:{}},bu=function(n){return Sp(n,Us)}}var Su,UN,VN,Cu={set:zm,get:bp,has:bu,enforce:function(n){return bu(n)?bp(n):zm(n,{})},getterFor:function(n){return function(r){var o;if(!$c(r)||(o=bp(r)).type!==n)throw a0("Incompatible receiver, "+n+" required");return o}}},c0=gs,Bt=Function.prototype,Zo=c0&&Object.getOwnPropertyDescriptor,oo=Ai(Bt,"name"),Un={EXISTS:oo,PROPER:oo&&"something"===function(){}.name,CONFIGURABLE:oo&&(!c0||c0&&Zo(Bt,"name").configurable)},BN=ed,Vs=function(n,r,o,a){return a&&a.enumerable?n[r]=o:BN(n,r,o),n},ga=Pt,l0=di,d0=or,jN=rd,$V=HT,kG=Vs,ry=En("iterator"),u0=!1;[].keys&&("next"in(VN=[].keys())?(UN=$V($V(VN)))!==Object.prototype&&(Su=UN):u0=!0);var HN=!d0(Su)||ga(function(){var n={};return Su[ry].call(n)!==n});l0((Su=HN?{}:jN(Su))[ry])||kG(Su,ry,function(){return this});var so={IteratorPrototype:Su,BUGGY_SAFARI_ITERATORS:u0},Xc=gr,_a=UE,Zc=zo.f,XV=ed,WN=Ai,ZV=UE?{}.toString:function(){return"[object "+Xc(this)+"]"},zN=En("toStringTag"),lc=function(n,r,o,a){if(n){var l=o?n:n.prototype;WN(l,zN)||Zc(l,zN,{configurable:!0,value:r}),a&&!_a&&XV(l,"toString",ZV)}},h0=so.IteratorPrototype,p0=rd,oy=hu,JV=lc,KN=ac,f0=function(){return this},sy=function(n,r,o,a){var l=r+" Iterator";return n.prototype=p0(h0,{next:oy(+!a,o)}),JV(n,l,!1,!0),KN[l]=f0,n},qN=Ft,YN=Ui,m0=sy,QV=HT,Br=lc,sd=Vs,oi=ac,eB=Un.PROPER,Ea=so.BUGGY_SAFARI_ITERATORS,g0=En("iterator"),Ym="values",Cp="entries",dc=function(){return this},XN=function(n,r,o,a,l,d,h){m0(o,r,a);var p,m,g,v=function(D){if(D===l&&R)return R;if(!Ea&&D in C)return C[D];switch(D){case"keys":case Ym:case Cp:return function(){return new o(this,D)}}return function(){return new o(this)}},y=r+" Iterator",b=!1,C=n.prototype,N=C[g0]||C["@@iterator"]||l&&C[l],R=!Ea&&N||v(l),A="Array"==r&&C.entries||N;if(A&&(p=QV(A.call(new n)))!==Object.prototype&&p.next&&(Br(p,y,!0,!0),oi[y]=dc),eB&&l==Ym&&N&&N.name!==Ym&&(b=!0,R=function(){return YN(N,this)}),l)if(m={values:v(Ym),keys:d?R:v("keys"),entries:v(Cp)},h)for(g in m)(Ea||b||!(g in C))&&sd(C,g,m[g]);else qN({target:r,proto:!0,forced:Ea||b},m);return h&&C[g0]!==R&&sd(C,g0,R,{name:l}),oi[r]=R,m},Tp=function(n,r){return{value:n,done:r}},ay=Hc,$m=ac,ZN=XN,v0=Tp,JN="Array Iterator",Ip=Cu.set,Xm=Cu.getterFor(JN);ZN(Array,"Array",function(n,r){Ip(this,{type:JN,target:ay(n),index:0,kind:r})},function(){var n=Xm(this),r=n.target,o=n.kind,a=n.index++;return!r||a>=r.length?(n.target=void 0,v0(void 0,!0)):v0("keys"==o?a:"values"==o?r[a]:[a,r[a]],!1)},"values"),$m.Arguments=$m.Array;var tB=zo,wp=function(n,r,o){return tB.f(n,r,o)},QN=yo,nB=wp,iB=gs,eP=En("species"),LG=Ar,xG=TypeError,Zm=function(n,r){if(LG(r,n))return n;throw xG("Incorrect invocation")},Tu=di,Jm=sN,Qm=xn(Function.toString);Tu(Jm.inspectSource)||(Jm.inspectSource=function(n){return Qm(n)});var tP=Jm.inspectSource,eg=xn,rB=Pt,ly=di,dy=gr,FG=tP,E0=function(){},nP=[],iP=yo("Reflect","construct"),Bs=/^\s*(?:class|function)\b/,oB=eg(Bs.exec),uy=!Bs.exec(E0),Iu=function(n){if(!ly(n))return!1;try{return iP(E0,nP,n),!0}catch{return!1}},y0=function(n){if(!ly(n))return!1;switch(dy(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return uy||!!oB(Bs,FG(n))}catch{return!0}};y0.sham=!0;var ad,cd,rP,hy,tg=!iP||rB(function(){var n;return Iu(Iu.call)||!Iu(Object)||!Iu(function(){n=!0})||n})?y0:Iu,oP=tg,sP=rp,sB=TypeError,ng=Dr,aB=Cm,aP=En("species"),py=function(n,r){var o,a=ng(n).constructor;return void 0===a||aB(o=ng(a)[aP])?r:function(n){if(oP(n))return n;throw sB(sP(n)+" is not a constructor")}(o)},Jc=xn([].slice),Rp=TypeError,Ti=function(n,r){if(n<r)throw Rp("Not enough arguments");return n},cP=/(?:ipad|iphone|ipod).*applewebkit/i.test(tc),yn=ti,b0=Jh,cB=Ql,S0=di,Ap=Ai,lP=Pt,C0=ri,T0=Jc,ig=Co,dP=Ti,lB=cP,dB=mp,I0=yn.setImmediate,fy=yn.clearImmediate,uB=yn.process,my=yn.Dispatch,hB=yn.Function,uP=yn.MessageChannel,UG=yn.String,gy=0,Dp={},Oi="onreadystatechange";lP(function(){ad=yn.location});var hP=function(n){if(Ap(Dp,n)){var r=Dp[n];delete Dp[n],r()}},w0=function(n){return function(){hP(n)}},pB=function(n){hP(n.data)},R0=function(n){yn.postMessage(UG(n),ad.protocol+"//"+ad.host)};I0&&fy||(I0=function(n){dP(arguments.length,1);var r=S0(n)?n:hB(n),o=T0(arguments,1);return Dp[++gy]=function(){b0(r,void 0,o)},cd(gy),gy},fy=function(n){delete Dp[n]},dB?cd=function(n){uB.nextTick(w0(n))}:my&&my.now?cd=function(n){my.now(w0(n))}:uP&&!lB?(hy=(rP=new uP).port2,rP.port1.onmessage=pB,cd=cB(hy.postMessage,hy)):yn.addEventListener&&S0(yn.postMessage)&&!yn.importScripts&&ad&&"file:"!==ad.protocol&&!lP(R0)?(cd=R0,yn.addEventListener("message",pB,!1)):cd=Oi in ig("script")?function(n){C0.appendChild(ig("script"))[Oi]=function(){C0.removeChild(this),hP(n)}}:function(n){setTimeout(w0(n),0)});var A0={set:I0,clear:fy},_y=function(){this.head=null,this.tail=null};_y.prototype={add:function(n){var r={item:n,next:null},o=this.tail;o?o.next=r:this.head=r,this.tail=r},get:function(){var n=this.head;if(n)return null===(this.head=n.next)&&(this.tail=null),n.item}};var Ru,Au,D0,O0,ld,fB=_y,mB=/ipad|iphone|ipod/i.test(tc)&&typeof Pebble<"u",Dn=/web0s(?!.*chrome)/i.test(tc),uc=ti,N0=Ql,fP=A0.set,P0=fB,vy=cP,gB=mB,ft=Dn,M0=mp,Ey=uc.MutationObserver||uc.WebKitMutationObserver,mP=uc.document,gP=uc.process,Op=uc.Promise,k0=(0,bm.f)(uc,"queueMicrotask"),yy=k0&&k0.value;if(!yy){var Np=new P0,by=function(){var n,r;for(M0&&(n=gP.domain)&&n.exit();r=Np.get();)try{r()}catch(o){throw Np.head&&Ru(),o}n&&n.enter()};vy||M0||ft||!Ey||!mP?!gB&&Op&&Op.resolve?((O0=Op.resolve(void 0)).constructor=Op,ld=N0(O0.then,O0),Ru=function(){ld(by)}):M0?Ru=function(){gP.nextTick(by)}:(fP=N0(fP,uc),Ru=function(){fP(by)}):(Au=!0,D0=mP.createTextNode(""),new Ey(by).observe(D0,{characterData:!0}),Ru=function(){D0.data=Au=!Au}),yy=function(n){Np.head||Ru(),Np.add(n)}}var _P=yy,Du=function(n){try{return{error:!1,value:n()}}catch(r){return{error:!0,value:r}}},Ou=ti.Promise,ya="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,_B=!ya&&!mp&&"object"==typeof window&&"object"==typeof document,vP=ti,Sy=Ou,VG=di,BG=DE,jG=tP,vB=_B,Pp=ya,On=pu,L0=Sy&&Sy.prototype,EB=En("species"),Nu=!1,Mp=VG(vP.PromiseRejectionEvent),Pu={CONSTRUCTOR:BG("Promise",function(){var n=jG(Sy),r=n!==String(Sy);if(!r&&66===On||!L0.catch||!L0.finally)return!0;if(!On||On<51||!/native code/.test(n)){var o=new Sy(function(l){l(1)}),a=function(l){l(function(){},function(){})};if((o.constructor={})[EB]=a,!(Nu=o.then(function(){})instanceof a))return!0}return!r&&(vB||Pp)&&!Mp}),REJECTION_EVENT:Mp,SUBCLASSING:Nu},ba={},kp=Wo,rg=TypeError,EP=function(n){var r,o;this.promise=new n(function(a,l){if(void 0!==r||void 0!==o)throw rg("Bad Promise constructor");r=a,o=l}),this.resolve=kp(r),this.reject=kp(o)};ba.f=function(n){return new EP(n)};var og,yP,bB=Ft,Cy=mp,Qc=ti,Mu=Ui,SB=Vs,Jo=lc,bP=Wo,Lp=di,GG=or,WG=Zm,ao=py,ku=A0.set,Ty=_P,CB=Du,CP=fB,TP=Cu,Iy=Ou,F0=ba,wy="Promise",wP=Pu.CONSTRUCTOR,TB=Pu.REJECTION_EVENT,U0=TP.getterFor(wy),RP=TP.set,xp=Iy,Fp=Iy&&Iy.prototype,V0=Qc.TypeError,Ry=Qc.document,Ay=Qc.process,Dy=F0.f,IB=Dy,wB=!!(Ry&&Ry.createEvent&&Qc.dispatchEvent),DP="unhandledrejection",OP=function(n){var r;return!(!GG(n)||!Lp(r=n.then))&&r},B0=function(n,r){var o,a,l,d=r.value,h=1==r.state,p=h?n.ok:n.fail,m=n.resolve,g=n.reject,v=n.domain;try{p?(h||(2===r.rejection&&zG(r),r.rejection=1),!0===p?o=d:(v&&v.enter(),o=p(d),v&&(v.exit(),l=!0)),o===n.promise?g(V0("Promise-chain cycle")):(a=OP(o))?Mu(a,o,m,g):m(o)):g(d)}catch(y){v&&!l&&v.exit(),g(y)}},RB=function(n,r){n.notified||(n.notified=!0,Ty(function(){for(var o,a=n.reactions;o=a.get();)B0(o,n);n.notified=!1,r&&!n.rejection&&AB(n)}))},j0=function(n,r,o){var a,l;wB?((a=Ry.createEvent("Event")).promise=r,a.reason=o,a.initEvent(n,!1,!0),Qc.dispatchEvent(a)):a={promise:r,reason:o},!TB&&(l=Qc["on"+n])?l(a):n===DP&&function(n,r){try{1==arguments.length?console.error(n):console.error(n,r)}catch{}}("Unhandled promise rejection",o)},AB=function(n){Mu(ku,Qc,function(){var r,o=n.facade,a=n.value;if(NP(n)&&(r=CB(function(){Cy?Ay.emit("unhandledRejection",a,o):j0(DP,o,a)}),n.rejection=Cy||NP(n)?2:1,r.error))throw r.value})},NP=function(n){return 1!==n.rejection&&!n.parent},zG=function(n){Mu(ku,Qc,function(){var r=n.facade;Cy?Ay.emit("rejectionHandled",r):j0("rejectionhandled",r,n.value)})},Up=function(n,r,o){return function(a){n(r,a,o)}},Lu=function(n,r,o){n.done||(n.done=!0,o&&(n=o),n.value=r,n.state=2,RB(n,!0))},sg=function(n,r,o){if(!n.done){n.done=!0,o&&(n=o);try{if(n.facade===r)throw V0("Promise can't be resolved itself");var a=OP(r);a?Ty(function(){var l={done:!1};try{Mu(a,r,Up(sg,l,n),Up(Lu,l,n))}catch(d){Lu(l,d,n)}}):(n.value=r,n.state=1,RB(n,!1))}catch(l){Lu({done:!1},l,n)}}};wP&&(Fp=(xp=function(n){WG(this,Fp),bP(n),Mu(og,this);var r=U0(this);try{n(Up(sg,r),Up(Lu,r))}catch(o){Lu(r,o)}}).prototype,(og=function(n){RP(this,{type:wy,done:!1,notified:!1,parent:!1,reactions:new CP,rejection:!1,state:0,value:void 0})}).prototype=SB(Fp,"then",function(n,r){var o=U0(this),a=Dy(ao(this,xp));return o.parent=!0,a.ok=!Lp(n)||n,a.fail=Lp(r)&&r,a.domain=Cy?Ay.domain:void 0,0==o.state?o.reactions.add(a):Ty(function(){B0(a,o)}),a.promise}),yP=function(){var n=new og,r=U0(n);this.promise=n,this.resolve=Up(sg,r),this.reject=Up(Lu,r)},F0.f=Dy=function(n){return n===xp||void 0===n?new yP(n):IB(n)}),bB({global:!0,constructor:!0,wrap:!0,forced:wP},{Promise:xp}),Jo(xp,wy,!1,!0),function(n){var r=QN(n);iB&&r&&!r[eP]&&nB(r,eP,{configurable:!0,get:function(){return this}})}(wy);var PP=En("iterator"),el=!1;try{var Vp=0,MP={next:function(){return{done:!!Vp++}},return:function(){el=!0}};MP[PP]=function(){return this},Array.from(MP,function(){throw 2})}catch{}var kP=Ou,H0=Pu.CONSTRUCTOR||!function(n,r){if(!r&&!el)return!1;var o=!1;try{var a={};a[PP]=function(){return{next:function(){return{done:o=!0}}}},n(a)}catch{}return o}(function(n){kP.all(n).then(void 0,function(){})}),tl=Ui,G0=Wo,DB=ba,OB=Du,KG=Hm;Ft({target:"Promise",stat:!0,forced:H0},{all:function(n){var r=this,o=DB.f(r),a=o.resolve,l=o.reject,d=OB(function(){var h=G0(r.resolve),p=[],m=0,g=1;KG(n,function(v){var y=m++,b=!1;g++,tl(h,r,v).then(function(C){b||(b=!0,p[y]=C,--g||a(p))},l)}),--g||a(p)});return d.error&&l(d.value),o.promise}}),Ft({target:"Promise",proto:!0,forced:Pu.CONSTRUCTOR,real:!0},{catch:function(n){return this.then(void 0,n)}});var NB=Ui,W0=Wo,z0=ba,Bp=Du,Ny=Hm;Ft({target:"Promise",stat:!0,forced:H0},{race:function(n){var r=this,o=z0.f(r),a=o.reject,l=Bp(function(){var d=W0(r.resolve);Ny(n,function(h){NB(d,r,h).then(o.resolve,a)})});return l.error&&a(l.value),o.promise}});var K0=Ui,ag=ba;Ft({target:"Promise",stat:!0,forced:Pu.CONSTRUCTOR},{reject:function(n){var r=ag.f(this);return K0(r.reject,void 0,n),r.promise}});var Py=Dr,jp=or,q0=ba,cg=function(n,r){if(Py(n),jp(r)&&r.constructor===n)return r;var o=q0.f(n);return(0,o.resolve)(r),o.promise},lg=Ft,Y0=Ou,YG=Pu.CONSTRUCTOR,$0=cg,dg=yo("Promise"),PB=!YG;lg({target:"Promise",stat:!0,forced:!0},{resolve:function(n){return $0(PB&&this===dg?Y0:this,n)}});var LP=Ui,MB=Wo,kB=ba,X0=Du,xP=Hm;Ft({target:"Promise",stat:!0,forced:H0},{allSettled:function(n){var r=this,o=kB.f(r),a=o.resolve,l=o.reject,d=X0(function(){var h=MB(r.resolve),p=[],m=0,g=1;xP(n,function(v){var y=m++,b=!1;g++,LP(h,r,v).then(function(C){b||(b=!0,p[y]={status:"fulfilled",value:C},--g||a(p))},function(C){b||(b=!0,p[y]={status:"rejected",reason:C},--g||a(p))})}),--g||a(p)});return d.error&&l(d.value),o.promise}});var LB=Ui,xB=Wo,ug=yo,FP=ba,Z0=Du,FB=Hm,UB="No one promise resolved";Ft({target:"Promise",stat:!0,forced:H0},{any:function(n){var r=this,o=ug("AggregateError"),a=FP.f(r),l=a.resolve,d=a.reject,h=Z0(function(){var p=xB(r.resolve),m=[],g=0,v=1,y=!1;FB(n,function(b){var C=g++,N=!1;v++,LB(p,r,b).then(function(R){N||y||(y=!0,l(R))},function(R){N||y||(N=!0,m[C]=R,--v||d(new o(m,UB)))})}),--v||d(new o(m,UB))});return h.error&&d(h.value),a.promise}});var My=yo,J0=di,UP=py,VP=cg,BP=Ou&&Ou.prototype;Ft({target:"Promise",proto:!0,real:!0,forced:!!Ou&&Pt(function(){BP.finally.call({then:function(){}},function(){})})},{finally:function(n){var r=UP(this,My("Promise")),o=J0(n);return this.then(o?function(a){return VP(r,n()).then(function(){return a})}:n,o?function(a){return VP(r,n()).then(function(){throw a})}:n)}});var hg=xn,jP=wT,Fu=Yo,HP=ql,ky=hg("".charAt),Q0=hg("".charCodeAt),GP=hg("".slice),eI=function(n){return function(r,o){var a,l,d=Fu(HP(r)),h=jP(o),p=d.length;return h<0||h>=p?n?"":void 0:(a=Q0(d,h))<55296||a>56319||h+1===p||(l=Q0(d,h+1))<56320||l>57343?n?ky(d,h):a:n?GP(d,h,h+2):l-56320+(a-55296<<10)+65536}},pg={codeAt:eI(!1),charAt:eI(!0)},WP=pg.charAt,Ly=Yo,Hp=XN,zP=Tp,KP="String Iterator",XG=Cu.set,Fy=Cu.getterFor(KP);Hp(String,"String",function(n){XG(this,{type:KP,string:Ly(n),index:0})},function(){var n,r=Fy(this),o=r.string,a=r.index;return a>=o.length?zP(void 0,!0):(n=WP(o,a),r.index+=n.length,zP(n,!1))});var tI=to.Promise,YP=ti,$P=gr,XP=ed,ZP=ac,JP=En("toStringTag");for(var nI in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var QP=YP[nI],iI=QP&&QP.prototype;iI&&$P(iI)!==JP&&XP(iI,JP,nI),ZP[nI]=ZP.Array}var nl=tI,le=Gt(nl);const eM=FT;function BB(n,r){const o=n&&n.navigator;if(!o.mediaDevices)return;const a=function(h){if("object"!=typeof h||h.mandatory||h.optional)return h;const p={};return Object.keys(h).forEach(m=>{if("require"===m||"advanced"===m||"mediaSource"===m)return;const g="object"==typeof h[m]?h[m]:{ideal:h[m]};void 0!==g.exact&&"number"==typeof g.exact&&(g.min=g.max=g.exact);const v=function(y,b){return y?y+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==g.ideal){p.optional=p.optional||[];let y={};"number"==typeof g.ideal?(y[v("min",m)]=g.ideal,p.optional.push(y),y={},y[v("max",m)]=g.ideal,p.optional.push(y)):(y[v("",m)]=g.ideal,p.optional.push(y))}void 0!==g.exact&&"number"!=typeof g.exact?(p.mandatory=p.mandatory||{},p.mandatory[v("",m)]=g.exact):["min","max"].forEach(y=>{void 0!==g[y]&&(p.mandatory=p.mandatory||{},p.mandatory[v(y,m)]=g[y])})}),h.advanced&&(p.optional=(p.optional||[]).concat(h.advanced)),p},l=function(h,p){if(r.version>=61)return p(h);if((h=JSON.parse(JSON.stringify(h)))&&"object"==typeof h.audio){const m=function(g,v,y){v in g&&!(y in g)&&(g[y]=g[v],delete g[v])};m((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),m(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&"object"==typeof h.video){let m=h.video.facingMode;m=m&&("object"==typeof m?m:{ideal:m});const g=r.version<66;if(m&&("user"===m.exact||"environment"===m.exact||"user"===m.ideal||"environment"===m.ideal)&&(!o.mediaDevices.getSupportedConstraints||!o.mediaDevices.getSupportedConstraints().facingMode||g)){let v;if(delete h.video.facingMode,"environment"===m.exact||"environment"===m.ideal?v=["back","rear"]:"user"!==m.exact&&"user"!==m.ideal||(v=["front"]),v)return o.mediaDevices.enumerateDevices().then(y=>{let b=(y=y.filter(C=>"videoinput"===C.kind)).find(C=>v.some(N=>{var R;return he(R=C.label.toLowerCase()).call(R,N)}));return!b&&y.length&&he(v).call(v,"back")&&(b=y[y.length-1]),b&&(h.video.deviceId=m.exact?{exact:b.deviceId}:{ideal:b.deviceId}),h.video=a(h.video),eM("chrome: "+JSON.stringify(h)),p(h)})}h.video=a(h.video)}return eM("chrome: "+JSON.stringify(h)),p(h)},d=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(o.getUserMedia=function(h,p,m){l(h,g=>{o.webkitGetUserMedia(g,p,v=>{m&&m(d(v))})})}.bind(o),o.mediaDevices.getUserMedia){const h=o.mediaDevices.getUserMedia.bind(o.mediaDevices);o.mediaDevices.getUserMedia=function(p){return l(p,m=>h(m).then(g=>{if(m.audio&&!g.getAudioTracks().length||m.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(v=>{v.stop()}),new DOMException("","NotFoundError");return g},g=>le.reject(d(g))))}}}function jB(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function HB(n){if("object"==typeof n&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(o){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=o)},enumerable:!0,configurable:!0});const r=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=o=>{o.stream.addEventListener("addtrack",a=>{let l;l=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.track.id):{track:a.track};const d=new Event("track");d.track=a.track,d.receiver=l,d.transceiver={receiver:l},d.streams=[o.stream],this.dispatchEvent(d)}),o.stream.getTracks().forEach(a=>{let l;l=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.id):{track:a};const d=new Event("track");d.track=a,d.receiver=l,d.transceiver={receiver:l},d.streams=[o.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else Di(n,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function GB(n){if("object"==typeof n&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const r=function(l,d){return{track:d,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===d.kind?l.createDTMFSender(d):null),this._dtmf},_pc:l}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const l=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(h,p){let m=l.apply(this,arguments);return m||(m=r(this,h),this._senders.push(m)),m};const d=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const p=this._senders.indexOf(h);-1!==p&&this._senders.splice(p,1)}}const o=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(l){this._senders=this._senders||[],o.apply(this,[l]),l.getTracks().forEach(d=>{this._senders.push(r(this,d))})};const a=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(l){this._senders=this._senders||[],a.apply(this,[l]),l.getTracks().forEach(d=>{const h=this._senders.find(p=>p.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if("object"==typeof n&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const r=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const o=r.apply(this,[]);return o.forEach(a=>a._pc=this),o},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function WB(n){if(!n.RTCPeerConnection)return;const r=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[o,a,l]=arguments;if(arguments.length>0&&"function"==typeof o)return r.apply(this,arguments);if(0===r.length&&(0===arguments.length||"function"!=typeof o))return r.apply(this,[]);const d=function(p){const m={};return p.result().forEach(g=>{const v={id:g.id,timestamp:g.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[g.type]||g.type};g.names().forEach(y=>{v[y]=g.stat(y)}),m[v.id]=v}),m},h=function(p){return new Map(Object.keys(p).map(m=>[m,p[m]]))};return arguments.length>=2?r.apply(this,[function(m){a(h(d(m)))},o]):new le((p,m)=>{r.apply(this,[function(g){p(h(d(g)))},m])}).then(a,l)}}function rI(n){if(!("object"==typeof n&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const o=n.RTCPeerConnection.prototype.getSenders;o&&(n.RTCPeerConnection.prototype.getSenders=function(){const l=o.apply(this,[]);return l.forEach(d=>d._pc=this),l});const a=n.RTCPeerConnection.prototype.addTrack;a&&(n.RTCPeerConnection.prototype.addTrack=function(){const l=a.apply(this,arguments);return l._pc=this,l}),n.RTCRtpSender.prototype.getStats=function(){const l=this;return this._pc.getStats().then(d=>mu(d,l.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const o=n.RTCPeerConnection.prototype.getReceivers;o&&(n.RTCPeerConnection.prototype.getReceivers=function(){const a=o.apply(this,[]);return a.forEach(l=>l._pc=this),a}),Di(n,"track",a=>(a.receiver._pc=a.srcElement,a)),n.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(l=>mu(l,a.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype)||!("getStats"in n.RTCRtpReceiver.prototype))return;const r=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const o=arguments[0];let a,l,d;return this.getSenders().forEach(h=>{h.track===o&&(a?d=!0:a=h)}),this.getReceivers().forEach(h=>(h.track===o&&(l?d=!0:l=h),h.track===o)),d||a&&l?le.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():l?l.getStats():le.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function tM(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const r=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?-1===this._shimmedLocalStreams[h.id].indexOf(p)&&this._shimmedLocalStreams[h.id].push(p):this._shimmedLocalStreams[h.id]=[h,p],p};const o=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(m=>{if(this.getSenders().find(v=>v.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();o.apply(this,arguments);const p=this.getSenders().filter(m=>-1===h.indexOf(m));this._shimmedLocalStreams[d.id]=[d].concat(p)};const a=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],a.apply(this,arguments)};const l=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const p=this._shimmedLocalStreams[h].indexOf(d);-1!==p&&this._shimmedLocalStreams[h].splice(p,1),1===this._shimmedLocalStreams[h].length&&delete this._shimmedLocalStreams[h]}),l.apply(this,arguments)}}function nM(n,r){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&r.version>=65)return tM(n);const o=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const m=o.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(g=>this._reverseStreams[g.id])};const a=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(g=>{if(this.getSenders().find(y=>y.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const g=new n.MediaStream(m.getTracks());this._streams[m.id]=g,this._reverseStreams[g.id]=m,m=g}a.apply(this,[m])};const l=n.RTCPeerConnection.prototype.removeStream;function d(m,g){let v=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(y=>{const b=m._reverseStreams[y];v=v.replace(new RegExp(m._streams[b.id].id,"g"),b.id)}),new RTCSessionDescription({type:g.type,sdp:v})}n.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},n.RTCPeerConnection.prototype.addTrack=function(m,g){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const v=[].slice.call(arguments,1);if(1!==v.length||!v[0].getTracks().find(C=>C===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(C=>C.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const b=this._streams[g.id];if(b)b.addTrack(m),le.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const C=new n.MediaStream([m]);this._streams[g.id]=C,this._reverseStreams[C.id]=g,this.addStream(C)}return this.getSenders().find(C=>C.track===m)},["createOffer","createAnswer"].forEach(function(m){const g=n.RTCPeerConnection.prototype[m],v={[m](){const y=arguments;return arguments.length&&"function"==typeof arguments[0]?g.apply(this,[b=>{const C=d(this,b);y[0].apply(null,[C])},b=>{y[1]&&y[1].apply(null,b)},arguments[2]]):g.apply(this,arguments).then(b=>d(this,b))}};n.RTCPeerConnection.prototype[m]=v[m]});const h=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,g){let v=g.sdp;return Object.keys(m._reverseStreams||[]).forEach(y=>{const b=m._reverseStreams[y],C=m._streams[b.id];v=v.replace(new RegExp(b.id,"g"),C.id)}),new RTCSessionDescription({type:g.type,sdp:v})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const p=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const m=p.get.apply(this);return""===m.type?m:d(this,m)}}),n.RTCPeerConnection.prototype.removeTrack=function(m){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let g;this._streams=this._streams||{},Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(y=>m.track===y)&&(g=this._streams[v])}),g&&(1===g.getTracks().length?this.removeStream(this._reverseStreams[g.id]):g.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function oI(n,r){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const a=n.RTCPeerConnection.prototype[o],l={[o](){return arguments[0]=new("addIceCandidate"===o?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};n.RTCPeerConnection.prototype[o]=l[o]})}function iM(n,r){Di(n,"negotiationneeded",o=>{const a=o.target;if(!(r.version<72||a.getConfiguration&&"plan-b"===a.getConfiguration().sdpSemantics)||"stable"===a.signalingState)return o})}var Uy=Object.freeze({__proto__:null,fixNegotiationNeeded:iM,shimAddTrackRemoveTrack:nM,shimAddTrackRemoveTrackWithNative:tM,shimGetDisplayMedia:function(n,r){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&("function"==typeof r?n.navigator.mediaDevices.getDisplayMedia=function(o){return r(o).then(a=>{const l=o.video&&o.video.width,d=o.video&&o.video.height;return o.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:o.video&&o.video.frameRate||3}},l&&(o.video.mandatory.maxWidth=l),d&&(o.video.mandatory.maxHeight=d),n.navigator.mediaDevices.getUserMedia(o)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:GB,shimGetStats:WB,shimGetUserMedia:BB,shimMediaStream:jB,shimOnTrack:HB,shimPeerConnection:oI,shimSenderReceiverGetStats:rI});function hc(n,r){const o=n&&n.navigator,a=n&&n.MediaStreamTrack;if(o.getUserMedia=function(l,d,h){HE("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),o.mediaDevices.getUserMedia(l).then(d,h)},!(r.version>55&&"autoGainControl"in o.mediaDevices.getSupportedConstraints())){const l=function(h,p,m){p in h&&!(m in h)&&(h[m]=h[p],delete h[p])},d=o.mediaDevices.getUserMedia.bind(o.mediaDevices);if(o.mediaDevices.getUserMedia=function(h){return"object"==typeof h&&"object"==typeof h.audio&&(h=JSON.parse(JSON.stringify(h)),l(h.audio,"autoGainControl","mozAutoGainControl"),l(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const p=h.apply(this,arguments);return l(p,"mozAutoGainControl","autoGainControl"),l(p,"mozNoiseSuppression","noiseSuppression"),p}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(p){return"audio"===this.kind&&"object"==typeof p&&(p=JSON.parse(JSON.stringify(p)),l(p,"autoGainControl","mozAutoGainControl"),l(p,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[p])}}}}function Gp(n){"object"==typeof n&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Vy(n,r){if("object"!=typeof n||!n.RTCPeerConnection&&!n.mozRTCPeerConnection)return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(l){const d=n.RTCPeerConnection.prototype[l],h={[l](){return arguments[0]=new("addIceCandidate"===l?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};n.RTCPeerConnection.prototype[l]=h[l]});const o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[l,d,h]=arguments;return a.apply(this,[l||null]).then(p=>{if(r.version<53&&!d)try{p.forEach(m=>{m.type=o[m.type]||m.type})}catch(m){if("TypeError"!==m.name)throw m;p.forEach((g,v)=>{p.set(v,Object.assign({},g,{type:o[g.type]||g.type}))})}return p}).then(d,h)}}function sI(n){if("object"!=typeof n||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const r=n.RTCPeerConnection.prototype.getSenders;r&&(n.RTCPeerConnection.prototype.getSenders=function(){const a=r.apply(this,[]);return a.forEach(l=>l._pc=this),a});const o=n.RTCPeerConnection.prototype.addTrack;o&&(n.RTCPeerConnection.prototype.addTrack=function(){const a=o.apply(this,arguments);return a._pc=this,a}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):le.resolve(new Map)}}function aI(n){if("object"!=typeof n||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const r=n.RTCPeerConnection.prototype.getReceivers;r&&(n.RTCPeerConnection.prototype.getReceivers=function(){const o=r.apply(this,[]);return o.forEach(a=>a._pc=this),o}),Di(n,"track",o=>(o.receiver._pc=o.srcElement,o)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function zB(n){n.RTCPeerConnection&&!("removeStream"in n.RTCPeerConnection.prototype)&&(n.RTCPeerConnection.prototype.removeStream=function(r){HE("removeStream","removeTrack"),this.getSenders().forEach(o=>{var a;o.track&&he(a=r.getTracks()).call(a,o.track)&&this.removeTrack(o)})})}function KB(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function qB(n){if("object"!=typeof n||!n.RTCPeerConnection)return;const r=n.RTCPeerConnection.prototype.addTransceiver;r&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let o=arguments[1]&&arguments[1].sendEncodings;void 0===o&&(o=[]),o=[...o];const a=o.length>0;a&&o.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const l=r.apply(this,arguments);if(a){const{sender:d}=l,h=d.getParameters();(!("encodings"in h)||1===h.encodings.length&&0===Object.keys(h.encodings[0]).length)&&(h.encodings=o,d.sendEncodings=o,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return l})}function By(n){if("object"!=typeof n||!n.RTCRtpSender)return;const r=n.RTCRtpSender.prototype.getParameters;r&&(n.RTCRtpSender.prototype.getParameters=function(){const o=r.apply(this,arguments);return"encodings"in o||(o.encodings=[].concat(this.sendEncodings||[{}])),o})}function jy(n){if("object"!=typeof n||!n.RTCPeerConnection)return;const r=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?le.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function YB(n){if("object"!=typeof n||!n.RTCPeerConnection)return;const r=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?le.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var $B=Object.freeze({__proto__:null,shimAddTransceiver:qB,shimCreateAnswer:YB,shimCreateOffer:jy,shimGetDisplayMedia:function(n,r){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(o){if(!o||!o.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,le.reject(a)}return!0===o.video?o.video={mediaSource:r}:o.video.mediaSource=r,n.navigator.mediaDevices.getUserMedia(o)})},shimGetParameters:By,shimGetUserMedia:hc,shimOnTrack:Gp,shimPeerConnection:Vy,shimRTCDataChannel:KB,shimReceiverGetStats:aI,shimRemoveStream:zB,shimSenderGetStats:sI});function cI(n){if("object"==typeof n&&n.RTCPeerConnection){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const r=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(o){var a;this._localStreams||(this._localStreams=[]),he(a=this._localStreams).call(a,o)||this._localStreams.push(o),o.getAudioTracks().forEach(l=>r.call(this,l,o)),o.getVideoTracks().forEach(l=>r.call(this,l,o))},n.RTCPeerConnection.prototype.addTrack=function(o){for(var a=arguments.length,l=new Array(a>1?a-1:0),d=1;d<a;d++)l[d-1]=arguments[d];return l&&l.forEach(h=>{var p;this._localStreams?he(p=this._localStreams).call(p,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const o=this._localStreams.indexOf(r);if(-1===o)return;this._localStreams.splice(o,1);const a=r.getTracks();this.getSenders().forEach(l=>{he(a).call(a,l.track)&&this.removeTrack(l)})})}}function rM(n){if("object"==typeof n&&n.RTCPeerConnection&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(o){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=o),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(l=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),he(d=this._remoteStreams).call(d,l))return;this._remoteStreams.push(l);const h=new Event("addstream");h.stream=l,this.dispatchEvent(h)})})}});const r=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const o=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(l=>{if(o._remoteStreams||(o._remoteStreams=[]),o._remoteStreams.indexOf(l)>=0)return;o._remoteStreams.push(l);const d=new Event("addstream");d.stream=l,o.dispatchEvent(d)})}),r.apply(o,arguments)}}}function oM(n){if("object"!=typeof n||!n.RTCPeerConnection)return;const r=n.RTCPeerConnection.prototype,o=r.createOffer,a=r.createAnswer,l=r.setLocalDescription,d=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(m,g){const y=o.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return g?(y.then(m,g),le.resolve()):y},r.createAnswer=function(m,g){const y=a.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return g?(y.then(m,g),le.resolve()):y};let p=function(m,g,v){const y=l.apply(this,[m]);return v?(y.then(g,v),le.resolve()):y};r.setLocalDescription=p,p=function(m,g,v){const y=d.apply(this,[m]);return v?(y.then(g,v),le.resolve()):y},r.setRemoteDescription=p,p=function(m,g,v){const y=h.apply(this,[m]);return v?(y.then(g,v),le.resolve()):y},r.addIceCandidate=p}function sM(n){const r=n&&n.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const o=r.mediaDevices,a=o.getUserMedia.bind(o);r.mediaDevices.getUserMedia=l=>a(aM(l))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=function(o,a,l){r.mediaDevices.getUserMedia(o).then(a,l)}.bind(r))}function aM(n){return n&&void 0!==n.video?Object.assign({},n,{video:IN(n.video)}):n}function cM(n){if(!n.RTCPeerConnection)return;const r=n.RTCPeerConnection;n.RTCPeerConnection=function(o,a){if(o&&o.iceServers){const l=[];for(let d=0;d<o.iceServers.length;d++){let h=o.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(HE("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,l.push(h)):l.push(o.iceServers[d])}o.iceServers=l}return new r(o,a)},n.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function lI(n){"object"==typeof n&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function dI(n){const r=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(o){if(o){void 0!==o.offerToReceiveAudio&&(o.offerToReceiveAudio=!!o.offerToReceiveAudio);const a=this.getTransceivers().find(d=>"audio"===d.receiver.track.kind);!1===o.offerToReceiveAudio&&a?"sendrecv"===a.direction?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":"recvonly"===a.direction&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):!0!==o.offerToReceiveAudio||a||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==o.offerToReceiveVideo&&(o.offerToReceiveVideo=!!o.offerToReceiveVideo);const l=this.getTransceivers().find(d=>"video"===d.receiver.track.kind);!1===o.offerToReceiveVideo&&l?"sendrecv"===l.direction?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":"recvonly"===l.direction&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):!0!==o.offerToReceiveVideo||l||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function lM(n){"object"!=typeof n||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var n,dM=Object.freeze({__proto__:null,shimAudioContext:lM,shimCallbacksAPI:oM,shimConstraints:aM,shimCreateOfferLegacy:dI,shimGetUserMedia:sM,shimLocalStreamsAPI:cI,shimRTCIceServerUrls:cM,shimRemoteStreamsAPI:rM,shimTrackEventTransceiver:lI}),uI="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",Hy=ql,XB=Yo,fg=uI,uM=xn("".replace),Wp=RegExp("^["+fg+"]+"),ZB=RegExp("(^|[^"+fg+"])["+fg+"]+$"),hI=function(n){return function(r){var o=XB(Hy(r));return 1&n&&(o=uM(o,Wp,"")),2&n&&(o=uM(o,ZB,"$1")),o}},pI={start:hI(1),end:hI(2),trim:hI(3)},hM=Un.PROPER,pM=uI,QB=pI.trim;Ft({target:"String",proto:!0,forced:(n="trim",Pt(function(){return!!pM[n]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[n]()||hM&&pM[n].name!==n}))},{trim:function(){return QB(this)}});var e3=Or("String").trim,fM=Ar,ZG=e3,mM=String.prototype,Er=Gt(function(n){var r=n.trim;return"string"==typeof n||n===mM||fM(mM,n)&&r===mM.trim?ZG:r}),gM={exports:{}};!function(n){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(o){return o.trim().split("\n").map(a=>a.trim())},r.splitSections=function(o){return o.split("\nm=").map((a,l)=>(l>0?"m="+a:a).trim()+"\r\n")},r.getDescription=function(o){const a=r.splitSections(o);return a&&a[0]},r.getMediaSections=function(o){const a=r.splitSections(o);return a.shift(),a},r.matchPrefix=function(o,a){return r.splitLines(o).filter(l=>0===l.indexOf(a))},r.parseCandidate=function(o){let a;a=0===o.indexOf("a=candidate:")?o.substring(12).split(" "):o.substring(10).split(" ");const l={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let d=8;d<a.length;d+=2)switch(a[d]){case"raddr":l.relatedAddress=a[d+1];break;case"rport":l.relatedPort=parseInt(a[d+1],10);break;case"tcptype":l.tcpType=a[d+1];break;case"ufrag":l.ufrag=a[d+1],l.usernameFragment=a[d+1];break;default:void 0===l[a[d]]&&(l[a[d]]=a[d+1])}return l},r.writeCandidate=function(o){const a=[];a.push(o.foundation);const l=o.component;a.push("rtp"===l?1:"rtcp"===l?2:l),a.push(o.protocol.toUpperCase()),a.push(o.priority),a.push(o.address||o.ip),a.push(o.port);const d=o.type;return a.push("typ"),a.push(d),"host"!==d&&o.relatedAddress&&o.relatedPort&&(a.push("raddr"),a.push(o.relatedAddress),a.push("rport"),a.push(o.relatedPort)),o.tcpType&&"tcp"===o.protocol.toLowerCase()&&(a.push("tcptype"),a.push(o.tcpType)),(o.usernameFragment||o.ufrag)&&(a.push("ufrag"),a.push(o.usernameFragment||o.ufrag)),"candidate:"+a.join(" ")},r.parseIceOptions=function(o){return o.substring(14).split(" ")},r.parseRtpMap=function(o){let a=o.substring(9).split(" ");const l={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),l.name=a[0],l.clockRate=parseInt(a[1],10),l.channels=3===a.length?parseInt(a[2],10):1,l.numChannels=l.channels,l},r.writeRtpMap=function(o){let a=o.payloadType;void 0!==o.preferredPayloadType&&(a=o.preferredPayloadType);const l=o.channels||o.numChannels||1;return"a=rtpmap:"+a+" "+o.name+"/"+o.clockRate+(1!==l?"/"+l:"")+"\r\n"},r.parseExtmap=function(o){const a=o.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},r.writeExtmap=function(o){return"a=extmap:"+(o.id||o.preferredId)+(o.direction&&"sendrecv"!==o.direction?"/"+o.direction:"")+" "+o.uri+(o.attributes?" "+o.attributes:"")+"\r\n"},r.parseFmtp=function(o){const a={};let l;const d=o.substring(o.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)l=d[h].trim().split("="),a[l[0].trim()]=l[1];return a},r.writeFmtp=function(o){let a="",l=o.payloadType;if(void 0!==o.preferredPayloadType&&(l=o.preferredPayloadType),o.parameters&&Object.keys(o.parameters).length){const d=[];Object.keys(o.parameters).forEach(h=>{d.push(void 0!==o.parameters[h]?h+"="+o.parameters[h]:h)}),a+="a=fmtp:"+l+" "+d.join(";")+"\r\n"}return a},r.parseRtcpFb=function(o){const a=o.substring(o.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},r.writeRtcpFb=function(o){let a="",l=o.payloadType;return void 0!==o.preferredPayloadType&&(l=o.preferredPayloadType),o.rtcpFeedback&&o.rtcpFeedback.length&&o.rtcpFeedback.forEach(d=>{a+="a=rtcp-fb:"+l+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+"\r\n"}),a},r.parseSsrcMedia=function(o){const a=o.indexOf(" "),l={ssrc:parseInt(o.substring(7,a),10)},d=o.indexOf(":",a);return d>-1?(l.attribute=o.substring(a+1,d),l.value=o.substring(d+1)):l.attribute=o.substring(a+1),l},r.parseSsrcGroup=function(o){const a=o.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(l=>parseInt(l,10))}},r.getMid=function(o){const a=r.matchPrefix(o,"a=mid:")[0];if(a)return a.substring(6)},r.parseFingerprint=function(o){const a=o.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},r.getDtlsParameters=function(o,a){return{role:"auto",fingerprints:r.matchPrefix(o+a,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(o,a){let l="a=setup:"+a+"\r\n";return o.fingerprints.forEach(d=>{l+="a=fingerprint:"+d.algorithm+" "+d.value+"\r\n"}),l},r.parseCryptoLine=function(o){const a=o.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},r.writeCryptoLine=function(o){return"a=crypto:"+o.tag+" "+o.cryptoSuite+" "+("object"==typeof o.keyParams?r.writeCryptoKeyParams(o.keyParams):o.keyParams)+(o.sessionParams?" "+o.sessionParams.join(" "):"")+"\r\n"},r.parseCryptoKeyParams=function(o){if(0!==o.indexOf("inline:"))return null;const a=o.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(o){return o.keyMethod+":"+o.keySalt+(o.lifeTime?"|"+o.lifeTime:"")+(o.mkiValue&&o.mkiLength?"|"+o.mkiValue+":"+o.mkiLength:"")},r.getCryptoParameters=function(o,a){return r.matchPrefix(o+a,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(o,a){const l=r.matchPrefix(o+a,"a=ice-ufrag:")[0],d=r.matchPrefix(o+a,"a=ice-pwd:")[0];return l&&d?{usernameFragment:l.substring(12),password:d.substring(10)}:null},r.writeIceParameters=function(o){let a="a=ice-ufrag:"+o.usernameFragment+"\r\na=ice-pwd:"+o.password+"\r\n";return o.iceLite&&(a+="a=ice-lite\r\n"),a},r.parseRtpParameters=function(o){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},l=r.splitLines(o)[0].split(" ");a.profile=l[2];for(let h=3;h<l.length;h++){const p=l[h],m=r.matchPrefix(o,"a=rtpmap:"+p+" ")[0];if(m){const g=r.parseRtpMap(m),v=r.matchPrefix(o,"a=fmtp:"+p+" ");switch(g.parameters=v.length?r.parseFmtp(v[0]):{},g.rtcpFeedback=r.matchPrefix(o,"a=rtcp-fb:"+p+" ").map(r.parseRtcpFb),a.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(g.name.toUpperCase())}}}r.matchPrefix(o,"a=extmap:").forEach(h=>{a.headerExtensions.push(r.parseExtmap(h))});const d=r.matchPrefix(o,"a=rtcp-fb:* ").map(r.parseRtcpFb);return a.codecs.forEach(h=>{d.forEach(p=>{h.rtcpFeedback.find(m=>m.type===p.type&&m.parameter===p.parameter)||h.rtcpFeedback.push(p)})}),a},r.writeRtpDescription=function(o,a){let l="";l+="m="+o+" ",l+=a.codecs.length>0?"9":"0",l+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",l+=a.codecs.map(h=>void 0!==h.preferredPayloadType?h.preferredPayloadType:h.payloadType).join(" ")+"\r\n",l+="c=IN IP4 0.0.0.0\r\n",l+="a=rtcp:9 IN IP4 0.0.0.0\r\n",a.codecs.forEach(h=>{l+=r.writeRtpMap(h),l+=r.writeFmtp(h),l+=r.writeRtcpFb(h)});let d=0;return a.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(l+="a=maxptime:"+d+"\r\n"),a.headerExtensions&&a.headerExtensions.forEach(h=>{l+=r.writeExtmap(h)}),l},r.parseRtpEncodingParameters=function(o){const a=[],l=r.parseRtpParameters(o),d=-1!==l.fecMechanisms.indexOf("RED"),h=-1!==l.fecMechanisms.indexOf("ULPFEC"),p=r.matchPrefix(o,"a=ssrc:").map(b=>r.parseSsrcMedia(b)).filter(b=>"cname"===b.attribute),m=p.length>0&&p[0].ssrc;let g;const v=r.matchPrefix(o,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(C=>parseInt(C,10)));v.length>0&&v[0].length>1&&v[0][0]===m&&(g=v[0][1]),l.codecs.forEach(b=>{if("RTX"===b.name.toUpperCase()&&b.parameters.apt){let C={ssrc:m,codecPayloadType:parseInt(b.parameters.apt,10)};m&&g&&(C.rtx={ssrc:g}),a.push(C),d&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:m,mechanism:h?"red+ulpfec":"red"},a.push(C))}}),0===a.length&&m&&a.push({ssrc:m});let y=r.matchPrefix(o,"b=");return y.length&&(y=0===y[0].indexOf("b=TIAS:")?parseInt(y[0].substring(7),10):0===y[0].indexOf("b=AS:")?1e3*parseInt(y[0].substring(5),10)*.95-16e3:void 0,a.forEach(b=>{b.maxBitrate=y})),a},r.parseRtcpParameters=function(o){const a={},l=r.matchPrefix(o,"a=ssrc:").map(p=>r.parseSsrcMedia(p)).filter(p=>"cname"===p.attribute)[0];l&&(a.cname=l.value,a.ssrc=l.ssrc);const d=r.matchPrefix(o,"a=rtcp-rsize");a.reducedSize=d.length>0,a.compound=0===d.length;const h=r.matchPrefix(o,"a=rtcp-mux");return a.mux=h.length>0,a},r.writeRtcpParameters=function(o){let a="";return o.reducedSize&&(a+="a=rtcp-rsize\r\n"),o.mux&&(a+="a=rtcp-mux\r\n"),void 0!==o.ssrc&&o.cname&&(a+="a=ssrc:"+o.ssrc+" cname:"+o.cname+"\r\n"),a},r.parseMsid=function(o){let a;const l=r.matchPrefix(o,"a=msid:");if(1===l.length)return a=l[0].substring(7).split(" "),{stream:a[0],track:a[1]};const d=r.matchPrefix(o,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>"msid"===h.attribute);return d.length>0?(a=d[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},r.parseSctpDescription=function(o){const a=r.parseMLine(o),l=r.matchPrefix(o,"a=max-message-size:");let d;l.length>0&&(d=parseInt(l[0].substring(19),10)),isNaN(d)&&(d=65536);const h=r.matchPrefix(o,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:d};const p=r.matchPrefix(o,"a=sctpmap:");if(p.length>0){const m=p[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:d}}},r.writeSctpDescription=function(o,a){let l=[];return l="DTLS/SCTP"!==o.protocol?["m="+o.kind+" 9 "+o.protocol+" "+a.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+a.port+"\r\n"]:["m="+o.kind+" 9 "+o.protocol+" "+a.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+a.port+" "+a.protocol+" 65535\r\n"],void 0!==a.maxMessageSize&&l.push("a=max-message-size:"+a.maxMessageSize+"\r\n"),l.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(o,a,l){let d;const h=void 0!==a?a:2;return d=o||r.generateSessionId(),"v=0\r\no="+(l||"thisisadapterortc")+" "+d+" "+h+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.getDirection=function(o,a){const l=r.splitLines(o);for(let d=0;d<l.length;d++)switch(l[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return l[d].substring(2)}return a?r.getDirection(a):"sendrecv"},r.getKind=function(o){return r.splitLines(o)[0].split(" ")[0].substring(2)},r.isRejected=function(o){return"0"===o.split(" ",2)[1]},r.parseMLine=function(o){const a=r.splitLines(o)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},r.parseOLine=function(o){const a=r.matchPrefix(o,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},r.isValidSDP=function(o){if("string"!=typeof o||0===o.length)return!1;const a=r.splitLines(o);for(let l=0;l<a.length;l++)if(a[l].length<2||"="!==a[l].charAt(1))return!1;return!0},n.exports=r}(gM);var _M=gM.exports,Uu=Gt(_M),t3=function Ci(n,r){return r.forEach(function(o){o&&"string"!=typeof o&&!Array.isArray(o)&&Object.keys(o).forEach(function(a){if("default"!==a&&!(a in n)){var l=Object.getOwnPropertyDescriptor(o,a);Object.defineProperty(n,a,l.get?l:{enumerable:!0,get:function(){return o[a]}})}})}),Object.freeze(n)}({__proto__:null,default:Uu},[_M]);function Gy(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const r=n.RTCIceCandidate;n.RTCIceCandidate=function(o){if("object"==typeof o&&o.candidate&&0===o.candidate.indexOf("a=")&&((o=JSON.parse(JSON.stringify(o))).candidate=o.candidate.substr(2)),o.candidate&&o.candidate.length){const a=new r(o),l=Uu.parseCandidate(o.candidate),d=Object.assign(a,l);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new r(o)},n.RTCIceCandidate.prototype=r.prototype,Di(n,"icecandidate",o=>(o.candidate&&Object.defineProperty(o,"candidate",{value:new n.RTCIceCandidate(o.candidate),writable:"false"}),o))}function fI(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||Di(n,"icecandidate",r=>{if(r.candidate){const o=Uu.parseCandidate(r.candidate.candidate);"relay"===o.type&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[o.priority>>24])}return r})}function Wy(n,r){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const h=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===r.browser&&r.version>=76){const{sdpSemantics:p}=this.getConfiguration();"plan-b"===p&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(p){if(!p||!p.sdp)return!1;const m=Uu.splitSections(p.sdp);return m.shift(),m.some(g=>{const v=Uu.parseMLine(g);return v&&"application"===v.kind&&-1!==v.protocol.indexOf("SCTP")})}(arguments[0])){const p=function(p){const m=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===m||m.length<2)return-1;const g=parseInt(m[1],10);return g!=g?-1:g}(arguments[0]),m=function(p){let m=65536;return"firefox"===r.browser&&(m=r.version<57?-1===p?16384:2147483637:r.version<60?57===r.version?65535:65536:2147483637),m}(p),g=function(p,m){let g=65536;"firefox"===r.browser&&57===r.version&&(g=65535);const v=Uu.matchPrefix(p.sdp,"a=max-message-size:");return v.length>0?g=parseInt(v[0].substr(19),10):"firefox"===r.browser&&-1!==m&&(g=2147483637),g}(arguments[0],p);let v;v=0===m&&0===g?Number.POSITIVE_INFINITY:0===m||0===g?Math.max(m,g):Math.min(m,g);const y={};Object.defineProperty(y,"maxMessageSize",{get:()=>v}),this._sctp=y}return h.apply(this,arguments)}}function zy(n){if(!n.RTCPeerConnection||!("createDataChannel"in n.RTCPeerConnection.prototype))return;function r(a,l){const d=a.send;a.send=function(){const h=arguments[0];if("open"===a.readyState&&l.sctp&&(h.length||h.size||h.byteLength)>l.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+l.sctp.maxMessageSize+" bytes)");return d.apply(a,arguments)}}const o=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const a=o.apply(this,arguments);return r(a,this),a},Di(n,"datachannel",a=>(r(a.channel,a.target),a))}function mI(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const r=n.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(o){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),o&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=o)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(o=>{const a=r[o];r[o]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=l=>{const d=l.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",l);d.dispatchEvent(h)}return l},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function gg(n,r){if(!n.RTCPeerConnection||"chrome"===r.browser&&r.version>=71||"safari"===r.browser&&r.version>=605)return;const o=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&-1!==a.sdp.indexOf("\na=extmap-allow-mixed")){const l=a.sdp.split("\n").filter(d=>"a=extmap-allow-mixed"!==Er(d).call(d)).join("\n");n.RTCSessionDescription&&a instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:a.type,sdp:l}):a.sdp=l}return o.apply(this,arguments)}}function gI(n,r){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;const o=n.RTCPeerConnection.prototype.addIceCandidate;o&&0!==o.length&&(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===r.browser&&r.version<78||"firefox"===r.browser&&r.version<68||"safari"===r.browser)&&arguments[0]&&""===arguments[0].candidate?le.resolve():o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),le.resolve())})}function _I(n,r){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;const o=n.RTCPeerConnection.prototype.setLocalDescription;o&&0!==o.length&&(n.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if("object"!=typeof a||a.type&&a.sdp)return o.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||"offer"!==a.type&&"answer"!==a.type?o.apply(this,[a]):("offer"===a.type?this.createOffer:this.createAnswer).apply(this).then(l=>o.apply(this,[l]))})}var vI=Object.freeze({__proto__:null,removeExtmapAllowMixed:gg,shimAddIceCandidateNullOrEmpty:gI,shimConnectionState:mI,shimMaxMessageSize:Wy,shimParameterlessSetLocalDescription:_I,shimRTCIceCandidate:Gy,shimRTCIceCandidateRelayProtocol:fI,shimSendThrowTypeError:zy});!function(){let{window:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const o=FT,a=function(d){const h={browser:null,version:null};if(void 0===d||!d.navigator)return h.browser="Not a browser.",h;const{navigator:p}=d;if(p.mozGetUserMedia)h.browser="firefox",h.version=Vi(p.userAgent,/Firefox\/(\d+)\./,1);else if(p.webkitGetUserMedia||!1===d.isSecureContext&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=Vi(p.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!p.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=Vi(p.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(n),l={browserDetails:a,commonShim:vI,extractVersion:Vi,disableLog:nd,disableWarnings:io,sdp:t3};switch(a.browser){case"chrome":if(!Uy||!oI||!r.shimChrome)return o("Chrome shim is not included in this adapter release."),l;if(null===a.version)return o("Chrome shim can not determine version, not shimming."),l;o("adapter.js shimming chrome."),l.browserShim=Uy,gI(n,a),_I(n),BB(n,a),jB(n),oI(n,a),HB(n),nM(n,a),GB(n),WB(n),rI(n),iM(n,a),Gy(n),fI(n),mI(n),Wy(n,a),zy(n),gg(n,a);break;case"firefox":if(!$B||!Vy||!r.shimFirefox)return o("Firefox shim is not included in this adapter release."),l;o("adapter.js shimming firefox."),l.browserShim=$B,gI(n,a),_I(n),hc(n,a),Vy(n,a),Gp(n),zB(n),sI(n),aI(n),KB(n),qB(n),By(n),jy(n),YB(n),Gy(n),mI(n),Wy(n,a),zy(n);break;case"safari":if(!dM||!r.shimSafari)return o("Safari shim is not included in this adapter release."),l;o("adapter.js shimming safari."),l.browserShim=dM,gI(n,a),_I(n),cM(n),dI(n),oM(n),cI(n),rM(n),lI(n),sM(n),lM(n),Gy(n),fI(n),Wy(n,a),zy(n),gg(n,a);break;default:o("Unsupported browser!")}}({window:typeof window>"u"?void 0:window});var JG=Or("Array").keys,QG=gr,eW=Ai,tW=Ar,nW=JG,EI=Array.prototype,Ky={DOMTokenList:!0,NodeList:!0},wo=Gt(function(n){var r=n.keys;return n===EI||tW(EI,n)&&r===EI.keys||eW(Ky,QG(n))?nW:r}),yI=rp,vM=TypeError,n3=wE,i3=zo,EM=hu,il=function(n,r,o){var a=n3(r);a in n?i3.f(n,a,EM(0,o)):n[a]=o},Qo=ME,ys=Wc,yM=il,iW=Array,r3=Math.max,bM=function(n,r,o){for(var a=ys(n),l=Qo(r,a),d=Qo(void 0===o?a:o,a),h=iW(r3(d-l,0)),p=0;l<d;l++,p++)yM(h,p,n[l]);return h.length=p,h},o3=bM,SM=Math.floor,Yy=function(n,r){var o=n.length,a=SM(o/2);return o<8?rW(n,r):ud(n,Yy(o3(n,0,a),r),Yy(o3(n,a),r),r)},rW=function(n,r){for(var o,a,l=n.length,d=1;d<l;){for(a=d,o=n[d];a&&r(n[a-1],o)>0;)n[a]=n[--a];a!==d++&&(n[a]=o)}return n},ud=function(n,r,o,a){for(var l=r.length,d=o.length,h=0,p=0;h<l||p<d;)n[h+p]=h<l&&p<d?a(r[h],o[p])<=0?r[h++]:o[p++]:h<l?r[h++]:o[p++];return n},$y=Yy,Xy=tc.match(/firefox\/(\d+)/i),s3=!!Xy&&+Xy[1],zp=/MSIE|Trident/.test(tc),Zy=tc.match(/AppleWebKit\/(\d+)\./),bI=Ft,_g=xn,a3=Wo,c3=So,SI=Wc,l3=function(n,r){if(!delete n[r])throw vM("Cannot delete property "+yI(r)+" of "+yI(n))},TM=Yo,Jy=Pt,CI=$y,vg=Nm,Eg=s3,TI=zp,IM=pu,wM=!!Zy&&+Zy[1],pc=[],II=_g(pc.sort),Vu=_g(pc.push),RM=Jy(function(){pc.sort(void 0)}),AM=Jy(function(){pc.sort(null)}),wI=vg("sort"),DM=!Jy(function(){if(IM)return IM<70;if(!(Eg&&Eg>3)){if(TI)return!0;if(wM)return wM<603;var n,r,o,a,l="";for(n=65;n<76;n++){switch(r=String.fromCharCode(n),n){case 66:case 69:case 70:case 72:o=3;break;case 68:case 71:o=4;break;default:o=2}for(a=0;a<47;a++)pc.push({k:r+a,v:o})}for(pc.sort(function(d,h){return h.v-d.v}),a=0;a<pc.length;a++)r=pc[a].k.charAt(0),l.charAt(l.length-1)!==r&&(l+=r);return"DGBEFHACIJK"!==l}});bI({target:"Array",proto:!0,forced:RM||!AM||!wI||!DM},{sort:function(n){void 0!==n&&a3(n);var r=c3(this);if(DM)return void 0===n?II(r):II(r,n);var o,a,l=[],d=SI(r);for(a=0;a<d;a++)a in r&&Vu(l,r[a]);for(CI(l,function(h){return function(p,m){return void 0===m?-1:void 0===p?1:void 0!==h?+h(p,m)||0:TM(p)>TM(m)?1:-1}}(n)),o=SI(l),a=0;a<o;)r[a]=l[a++];for(;a<d;)l3(r,a++);return r}});var OM=Or("Array").sort,NM=Ar,PM=OM,yg=Array.prototype,hd=Gt(function(n){var r=n.sort;return n===yg||NM(yg,n)&&r===yg.sort?PM:r}),rl={exports:{}};!function(n,r){!function(o,a){var l="function",d="undefined",h="object",p="string",m="major",g="model",v="name",y="type",b="vendor",C="version",N="architecture",R="console",A="mobile",D="tablet",M="smarttv",x="wearable",j="embedded",W="Amazon",q="Apple",J="BlackBerry",X="Browser",Ce="Chrome",Re="Firefox",ut="Google",Zt="Microsoft",ca="Motorola",Z="Opera",oe="Samsung",xe="Sony",Et="Xiaomi",de="Zebra",w="Facebook",F="Chromium OS",H="Mac OS",ie=function(wn){for(var qn={},en=0;en<wn.length;en++)qn[wn[en].toUpperCase()]=wn[en];return qn},Le=function(wn,qn){return typeof wn===p&&-1!==Vt(qn).indexOf(Vt(wn))},Vt=function(wn){return wn.toLowerCase()},li=function(wn,qn){if(typeof wn===p)return wn=wn.replace(/^\s\s*/,""),typeof qn===d?wn:wn.substring(0,350)},Jr=function(wn,qn){for(var en,wr,$a,Rn,lt,Qr,iu=0;iu<qn.length&&!lt;){var Xa=qn[iu],bO=qn[iu+1];for(en=wr=0;en<Xa.length&&!lt&&Xa[en];)if(lt=Xa[en++].exec(wn))for($a=0;$a<bO.length;$a++)Qr=lt[++wr],typeof(Rn=bO[$a])===h&&Rn.length>0?2===Rn.length?this[Rn[0]]=typeof Rn[1]==l?Rn[1].call(this,Qr):Rn[1]:3===Rn.length?this[Rn[0]]=typeof Rn[1]!==l||Rn[1].exec&&Rn[1].test?Qr?Qr.replace(Rn[1],Rn[2]):a:Qr?Rn[1].call(this,Qr,Rn[2]):a:4===Rn.length&&(this[Rn[0]]=Qr?Rn[3].call(this,Qr.replace(Rn[1],Rn[2])):a):this[Rn]=Qr||a;iu+=2}},Hl=function(wn,qn){for(var en in qn)if(typeof qn[en]===h&&qn[en].length>0){for(var wr=0;wr<qn[en].length;wr++)if(Le(qn[en][wr],wn))return"?"===en?a:en}else if(Le(qn[en],wn))return"?"===en?a:en;return wn},$C={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Qv={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[C,[v,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[C,[v,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[v,C],[/opios[\/ ]+([\w\.]+)/i],[C,[v,Z+" Mini"]],[/\bopr\/([\w\.]+)/i],[C,[v,Z]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[v,C],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[C,[v,"UC"+X]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[C,[v,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[C,[v,"WeChat"]],[/konqueror\/([\w\.]+)/i],[C,[v,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[C,[v,"IE"]],[/yabrowser\/([\w\.]+)/i],[C,[v,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[v,/(.+)/,"$1 Secure "+X],C],[/\bfocus\/([\w\.]+)/i],[C,[v,Re+" Focus"]],[/\bopt\/([\w\.]+)/i],[C,[v,Z+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[C,[v,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[C,[v,"Dolphin"]],[/coast\/([\w\.]+)/i],[C,[v,Z+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[C,[v,"MIUI "+X]],[/fxios\/([-\w\.]+)/i],[C,[v,Re]],[/\bqihu|(qi?ho?o?|360)browser/i],[[v,"360 "+X]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[v,/(.+)/,"$1 "+X],C],[/(comodo_dragon)\/([\w\.]+)/i],[[v,/_/g," "],C],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[v,C],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[v],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[v,w],C],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[v,C],[/\bgsa\/([\w\.]+) .*safari\//i],[C,[v,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[C,[v,Ce+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[v,Ce+" WebView"],C],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[C,[v,"Android "+X]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[v,C],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[C,[v,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[C,v],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[v,[C,Hl,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[v,C],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[v,"Netscape"],C],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[C,[v,Re+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[v,C],[/(cobalt)\/([\w\.]+)/i],[v,[C,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[N,"amd64"]],[/(ia32(?=;))/i],[[N,Vt]],[/((?:i[346]|x)86)[;\)]/i],[[N,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[N,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[N,"armhf"]],[/windows (ce|mobile); ppc;/i],[[N,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[N,/ower/,"",Vt]],[/(sun4\w)[;\)]/i],[[N,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[N,Vt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[g,[b,oe],[y,D]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[g,[b,oe],[y,A]],[/\((ip(?:hone|od)[\w ]*);/i],[g,[b,q],[y,A]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[g,[b,q],[y,D]],[/(macintosh);/i],[g,[b,q]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[g,[b,"Sharp"],[y,A]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[g,[b,"Huawei"],[y,D]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[g,[b,"Huawei"],[y,A]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[g,/_/g," "],[b,Et],[y,A]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[g,/_/g," "],[b,Et],[y,D]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[g,[b,"OPPO"],[y,A]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[g,[b,"Vivo"],[y,A]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[g,[b,"Realme"],[y,A]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[g,[b,ca],[y,A]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[g,[b,ca],[y,D]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[g,[b,"LG"],[y,D]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[g,[b,"LG"],[y,A]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[g,[b,"Lenovo"],[y,D]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[g,/_/g," "],[b,"Nokia"],[y,A]],[/(pixel c)\b/i],[g,[b,ut],[y,D]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[g,[b,ut],[y,A]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[g,[b,xe],[y,A]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[g,"Xperia Tablet"],[b,xe],[y,D]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[g,[b,"OnePlus"],[y,A]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[g,[b,W],[y,D]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[g,/(.+)/g,"Fire Phone $1"],[b,W],[y,A]],[/(playbook);[-\w\),; ]+(rim)/i],[g,b,[y,D]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[g,[b,J],[y,A]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[g,[b,"ASUS"],[y,D]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[g,[b,"ASUS"],[y,A]],[/(nexus 9)/i],[g,[b,"HTC"],[y,D]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[b,[g,/_/g," "],[y,A]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[g,[b,"Acer"],[y,D]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[g,[b,"Meizu"],[y,A]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[b,g,[y,A]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[b,g,[y,D]],[/(surface duo)/i],[g,[b,Zt],[y,D]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[g,[b,"Fairphone"],[y,A]],[/(u304aa)/i],[g,[b,"AT&T"],[y,A]],[/\bsie-(\w*)/i],[g,[b,"Siemens"],[y,A]],[/\b(rct\w+) b/i],[g,[b,"RCA"],[y,D]],[/\b(venue[\d ]{2,7}) b/i],[g,[b,"Dell"],[y,D]],[/\b(q(?:mv|ta)\w+) b/i],[g,[b,"Verizon"],[y,D]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[g,[b,"Barnes & Noble"],[y,D]],[/\b(tm\d{3}\w+) b/i],[g,[b,"NuVision"],[y,D]],[/\b(k88) b/i],[g,[b,"ZTE"],[y,D]],[/\b(nx\d{3}j) b/i],[g,[b,"ZTE"],[y,A]],[/\b(gen\d{3}) b.+49h/i],[g,[b,"Swiss"],[y,A]],[/\b(zur\d{3}) b/i],[g,[b,"Swiss"],[y,D]],[/\b((zeki)?tb.*\b) b/i],[g,[b,"Zeki"],[y,D]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[b,"Dragon Touch"],g,[y,D]],[/\b(ns-?\w{0,9}) b/i],[g,[b,"Insignia"],[y,D]],[/\b((nxa|next)-?\w{0,9}) b/i],[g,[b,"NextBook"],[y,D]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[b,"Voice"],g,[y,A]],[/\b(lvtel\-)?(v1[12]) b/i],[[b,"LvTel"],g,[y,A]],[/\b(ph-1) /i],[g,[b,"Essential"],[y,A]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[g,[b,"Envizen"],[y,D]],[/\b(trio[-\w\. ]+) b/i],[g,[b,"MachSpeed"],[y,D]],[/\btu_(1491) b/i],[g,[b,"Rotor"],[y,D]],[/(shield[\w ]+) b/i],[g,[b,"Nvidia"],[y,D]],[/(sprint) (\w+)/i],[b,g,[y,A]],[/(kin\.[onetw]{3})/i],[[g,/\./g," "],[b,Zt],[y,A]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[g,[b,de],[y,D]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[g,[b,de],[y,A]],[/smart-tv.+(samsung)/i],[b,[y,M]],[/hbbtv.+maple;(\d+)/i],[[g,/^/,"SmartTV"],[b,oe],[y,M]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[b,"LG"],[y,M]],[/(apple) ?tv/i],[b,[g,q+" TV"],[y,M]],[/crkey/i],[[g,Ce+"cast"],[b,ut],[y,M]],[/droid.+aft(\w)( bui|\))/i],[g,[b,W],[y,M]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[g,[b,"Sharp"],[y,M]],[/(bravia[\w ]+)( bui|\))/i],[g,[b,xe],[y,M]],[/(mitv-\w{5}) bui/i],[g,[b,Et],[y,M]],[/Hbbtv.*(technisat) (.*);/i],[b,g,[y,M]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[b,li],[g,li],[y,M]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[y,M]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[b,g,[y,R]],[/droid.+; (shield) bui/i],[g,[b,"Nvidia"],[y,R]],[/(playstation [345portablevi]+)/i],[g,[b,xe],[y,R]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[g,[b,Zt],[y,R]],[/((pebble))app/i],[b,g,[y,x]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[g,[b,q],[y,x]],[/droid.+; (glass) \d/i],[g,[b,ut],[y,x]],[/droid.+; (wt63?0{2,3})\)/i],[g,[b,de],[y,x]],[/(quest( 2| pro)?)/i],[g,[b,w],[y,x]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[b,[y,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[g,[y,A]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[g,[y,D]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[y,D]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[y,A]],[/(android[-\w\. ]{0,9});.+buil/i],[g,[b,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[C,[v,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[C,[v,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[v,C],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[C,v]],os:[[/microsoft (windows) (vista|xp)/i],[v,C],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[v,[C,Hl,$C]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[v,"Windows"],[C,Hl,$C]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[C,/_/g,"."],[v,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[v,H],[C,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[C,v],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[v,C],[/\(bb(10);/i],[C,[v,J]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[C,[v,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[C,[v,Re+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[C,[v,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[C,[v,"watchOS"]],[/crkey\/([\d\.]+)/i],[C,[v,Ce+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[v,F],C],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[v,C],[/(sunos) ?([\w\.\d]*)/i],[[v,"Solaris"],C],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[v,C]]},Ls=function(wn,qn){if(typeof wn===h&&(qn=wn,wn=a),!(this instanceof Ls))return new Ls(wn,qn).getResult();var en=typeof o!==d&&o.navigator?o.navigator:a,wr=wn||(en&&en.userAgent?en.userAgent:""),$a=en&&en.userAgentData?en.userAgentData:a,Rn=qn?function(lt,Qr){var iu={};for(var Xa in lt)iu[Xa]=Qr[Xa]&&Qr[Xa].length%2==0?Qr[Xa].concat(lt[Xa]):lt[Xa];return iu}(Qv,qn):Qv;return this.getBrowser=function(){var Qr,lt={};return lt[v]=a,lt[C]=a,Jr.call(lt,wr,Rn.browser),lt[m]=typeof(Qr=lt[C])===p?Qr.replace(/[^\d\.]/g,"").split(".")[0]:a,en&&en.brave&&typeof en.brave.isBrave==l&&(lt[v]="Brave"),lt},this.getCPU=function(){var lt={};return lt[N]=a,Jr.call(lt,wr,Rn.cpu),lt},this.getDevice=function(){var lt={};return lt[b]=a,lt[g]=a,lt[y]=a,Jr.call(lt,wr,Rn.device),!lt[y]&&$a&&$a.mobile&&(lt[y]=A),"Macintosh"==lt[g]&&en&&typeof en.standalone!==d&&en.maxTouchPoints&&en.maxTouchPoints>2&&(lt[g]="iPad",lt[y]=D),lt},this.getEngine=function(){var lt={};return lt[v]=a,lt[C]=a,Jr.call(lt,wr,Rn.engine),lt},this.getOS=function(){var lt={};return lt[v]=a,lt[C]=a,Jr.call(lt,wr,Rn.os),!lt[v]&&$a&&"Unknown"!=$a.platform&&(lt[v]=$a.platform.replace(/chrome os/i,F).replace(/macos/i,H)),lt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return wr},this.setUA=function(lt){return wr=typeof lt===p&&lt.length>350?li(lt,350):lt,this},this.setUA(wr),this};Ls.VERSION="0.7.34",Ls.BROWSER=ie([v,C,m]),Ls.CPU=ie([N]),Ls.DEVICE=ie([g,b,y,R,A,M,D,x,j]),Ls.ENGINE=Ls.OS=ie([v,C]),n.exports&&(r=n.exports=Ls),r.UAParser=Ls;var nu=typeof o!==d&&(o.jQuery||o.Zepto);if(nu&&!nu.ua){var pm=new Ls;nu.ua=pm.getResult(),nu.ua.get=function(){return pm.getUA()},nu.ua.set=function(wn){pm.setUA(wn);var qn=pm.getResult();for(var en in qn)nu.ua[en]=qn[en]}}}("object"==typeof window?window:eo)}(rl,rl.exports);var kM=Gt(rl.exports),RI=gr,bg=Ai,LM=Cm,AI=ac,Qy=En("iterator"),d3=Object,u3=Gt(function(n){if(LM(n))return!1;var r=d3(n);return void 0!==r[Qy]||"@@iterator"in r||bg(AI,RI(r))});Ft({global:!0,forced:ti.globalThis!==ti},{globalThis:ti});var FM=Gt(ti),OI=A0.clear;Ft({global:!0,bind:!0,enumerable:!0,forced:ti.clearImmediate!==OI},{clearImmediate:OI});var UM="function"==typeof Bun&&Bun&&"string"==typeof Bun.version,St=ti,Ze=Jh,VM=di,re=UM,jM=Jc,h3=Ti,eb=St.Function,Bu=/MSIE .\./.test(tc)||re&&function(){var n=St.Bun.version.split(".");return n.length<3||0==n[0]&&(n[1]<3||3==n[1]&&0==n[2])}(),NI=Ft,Kp=ti,PI=A0.set,tb=Kp.setImmediate?function(n,r){var o=r?2:1;return Bu?function(a,l){var d=h3(arguments.length,1)>o,h=VM(a)?a:eb(a),p=d?jM(arguments,o):[],m=d?function(){Ze(h,this,p)}:h;return r?n(m,l):n(m)}:n}(PI,!1):PI;NI({global:!0,bind:!0,enumerable:!0,forced:Kp.setImmediate!==tb},{setImmediate:tb});var nb=Gt(to.setImmediate),kI=_P,p3=Wo,f3=Ti,m3=mp,GM=ti.process;Ft({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(n){f3(arguments.length,1),p3(n);var r=m3&&GM.domain;kI(r?r.bind(n):n)}});var WM=Gt(to.queueMicrotask);function zM(n,r){return function(){return n.apply(r,arguments)}}const{toString:g3}=Object.prototype,{getPrototypeOf:LI}=Object,Sg=(ib=Object.create(null),n=>{const r=g3.call(n);return ib[r]||(ib[r]=r.slice(8,-1).toLowerCase())});var ib;const Sa=n=>(n=n.toLowerCase(),r=>Sg(r)===n),rb=n=>r=>typeof r===n,{isArray:yr}=Array,Cg=rb("undefined"),KM=Sa("ArrayBuffer"),oW=rb("string"),Ro=rb("function"),xI=rb("number"),ob=n=>null!==n&&"object"==typeof n,sb=n=>{if("object"!==Sg(n))return!1;const r=LI(n);return!(null!==r&&r!==Object.prototype&&null!==Object.getPrototypeOf(r)||Symbol.toStringTag in n||u3(n))},_3=Sa("Date"),qM=Sa("File"),v3=Sa("Blob"),E3=Sa("FileList"),FI=Sa("URLSearchParams"),[y3,b3,S3,C3]=["ReadableStream","Request","Response","Headers"].map(Sa);function Tg(n,r){let o,a,{allOwnKeys:l=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=n)if("object"!=typeof n&&(n=[n]),yr(n))for(o=0,a=n.length;o<a;o++)r.call(null,n[o],o,n);else{const d=l?Object.getOwnPropertyNames(n):Object.keys(n),h=d.length;let p;for(o=0;o<h;o++)p=d[o],r.call(null,n[p],p,n)}}function Ca(n,r){r=r.toLowerCase();const o=Object.keys(n);let a,l=o.length;for(;l-- >0;)if(a=o[l],r===a.toLowerCase())return a;return null}const ol=void 0!==FM?FM:typeof self<"u"?self:typeof window<"u"?window:global,YM=n=>!Cg(n)&&n!==ol,T3=(ab=typeof Uint8Array<"u"&&LI(Uint8Array),n=>ab&&n instanceof ab);var ab;const $M=Sa("HTMLFormElement"),Ig=(n=>{let{hasOwnProperty:r}=n;return(o,a)=>r.call(o,a)})(Object.prototype),UI=Sa("RegExp"),I3=(n,r)=>{const o=Object.getOwnPropertyDescriptors(n),a={};Tg(o,(l,d)=>{let h;!1!==(h=r(l,d,n))&&(a[d]=h||l)}),Object.defineProperties(n,a)},cb="abcdefghijklmnopqrstuvwxyz",VI="0123456789",BI={DIGIT:VI,ALPHA:cb,ALPHA_DIGIT:cb+cb.toUpperCase()+VI},lb=Sa("AsyncFunction"),db=(fc="function"==typeof nb,XM=Ro(ol.postMessage),fc?nb:XM?(jI="axios@".concat(Math.random()),qp=[],ol.addEventListener("message",n=>{let{source:r,data:o}=n;r===ol&&o===jI&&qp.length&&qp.shift()()},!1),n=>{qp.push(n),ol.postMessage(jI,"*")}):n=>setTimeout(n));var fc,XM,jI,qp;const w3=void 0!==WM?WM.bind(ol):typeof process<"u"&&process.nextTick||db;var ce={isArray:yr,isArrayBuffer:KM,isBuffer:function(n){return null!==n&&!Cg(n)&&null!==n.constructor&&!Cg(n.constructor)&&Ro(n.constructor.isBuffer)&&n.constructor.isBuffer(n)},isFormData:n=>{let r;return n&&("function"==typeof FormData&&n instanceof FormData||Ro(n.append)&&("formdata"===(r=Sg(n))||"object"===r&&Ro(n.toString)&&"[object FormData]"===n.toString()))},isArrayBufferView:function(n){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer&&KM(n.buffer),r},isString:oW,isNumber:xI,isBoolean:n=>!0===n||!1===n,isObject:ob,isPlainObject:sb,isReadableStream:y3,isRequest:b3,isResponse:S3,isHeaders:C3,isUndefined:Cg,isDate:_3,isFile:qM,isBlob:v3,isRegExp:UI,isFunction:Ro,isStream:n=>ob(n)&&Ro(n.pipe),isURLSearchParams:FI,isTypedArray:T3,isFileList:E3,forEach:Tg,merge:function n(){const{caseless:r}=YM(this)&&this||{},o={},a=(l,d)=>{const h=r&&Ca(o,d)||d;o[h]=sb(o[h])&&sb(l)?n(o[h],l):sb(l)?n({},l):yr(l)?l.slice():l};for(let l=0,d=arguments.length;l<d;l++)arguments[l]&&Tg(arguments[l],a);return o},extend:function(n,r,o){let{allOwnKeys:a}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Tg(r,(l,d)=>{n[d]=o&&Ro(l)?zM(l,o):l},{allOwnKeys:a}),n},trim:n=>Er(n)?Er(n).call(n):n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:n=>(65279===n.charCodeAt(0)&&(n=n.slice(1)),n),inherits:(n,r,o,a)=>{n.prototype=Object.create(r.prototype,a),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:r.prototype}),o&&Object.assign(n.prototype,o)},toFlatObject:(n,r,o,a)=>{let l,d,h;const p={};if(r=r||{},null==n)return r;do{for(l=Object.getOwnPropertyNames(n),d=l.length;d-- >0;)h=l[d],a&&!a(h,n,r)||p[h]||(r[h]=n[h],p[h]=!0);n=!1!==o&&LI(n)}while(n&&(!o||o(n,r))&&n!==Object.prototype);return r},kindOf:Sg,kindOfTest:Sa,endsWith:(n,r,o)=>{n=String(n),(void 0===o||o>n.length)&&(o=n.length);const a=n.indexOf(r,o-=r.length);return-1!==a&&a===o},toArray:n=>{if(!n)return null;if(yr(n))return n;let r=n.length;if(!xI(r))return null;const o=new Array(r);for(;r-- >0;)o[r]=n[r];return o},forEachEntry:(n,r)=>{const o=(n&&n[Symbol.iterator]).call(n);let a;for(;(a=o.next())&&!a.done;){const l=a.value;r.call(n,l[0],l[1])}},matchAll:(n,r)=>{let o;const a=[];for(;null!==(o=n.exec(r));)a.push(o);return a},isHTMLForm:$M,hasOwnProperty:Ig,hasOwnProp:Ig,reduceDescriptors:I3,freezeMethods:n=>{I3(n,(r,o)=>{if(Ro(n)&&-1!==["arguments","caller","callee"].indexOf(o))return!1;Ro(n[o])&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+o+"'")}))})},toObjectSet:(n,r)=>{const o={},a=l=>{l.forEach(d=>{o[d]=!0})};return yr(n)?a(n):a(String(n).split(r)),o},toCamelCase:n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,o,a){return o.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(n,r)=>null!=n&&Number.isFinite(n=+n)?n:r,findKey:Ca,global:ol,isContextDefined:YM,ALPHABET:BI,generateString:function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:BI.ALPHA_DIGIT,o="";const{length:a}=r;for(;n--;)o+=r[Math.random()*a|0];return o},isSpecCompliantForm:function(n){return!!(n&&Ro(n.append)&&"FormData"===n[Symbol.toStringTag]&&n[Symbol.iterator])},toJSONObject:n=>{const r=new Array(10),o=(a,l)=>{if(ob(a)){if(r.indexOf(a)>=0)return;if(!("toJSON"in a)){r[l]=a;const d=yr(a)?[]:{};return Tg(a,(h,p)=>{const m=o(h,l+1);!Cg(m)&&(d[p]=m)}),r[l]=void 0,d}}return a};return o(n,0)},isAsyncFn:lb,isThenable:n=>n&&(ob(n)||Ro(n))&&Ro(n.then)&&Ro(n.catch),setImmediate:db,asap:w3};function kt(n,r,o,a,l){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=n,this.name="AxiosError",r&&(this.code=r),o&&(this.config=o),a&&(this.request=a),l&&(this.response=l,this.status=l.status?l.status:null)}ce.inherits(kt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ce.toJSONObject(this.config),code:this.code,status:this.status}}});const pd=kt.prototype,ju={};function wg(n){return ce.isPlainObject(n)||ce.isArray(n)}function Yp(n){return ce.endsWith(n,"[]")?n.slice(0,-2):n}function HI(n,r,o){return n?n.concat(r).map(function(a,l){return a=Yp(a),!o&&l?"["+a+"]":a}).join(o?".":""):r}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{ju[n]={value:n}}),Object.defineProperties(kt,ju),Object.defineProperty(pd,"isAxiosError",{value:!0}),kt.from=(n,r,o,a,l,d)=>{const h=Object.create(pd);return ce.toFlatObject(n,h,function(p){return p!==Error.prototype},p=>"isAxiosError"!==p),kt.call(h,n.message,r,o,a,l),h.cause=n,h.name=n.name,d&&Object.assign(h,d),h};const ZM=ce.toFlatObject(ce,{},null,function(n){return/^is[A-Z]/.test(n)});function ub(n,r,o){if(!ce.isObject(n))throw new TypeError("target must be an object");r=r||new FormData;const a=(o=ce.toFlatObject(o,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,C){return!ce.isUndefined(C[b])})).metaTokens,l=o.visitor||g,d=o.dots,h=o.indexes,p=(o.Blob||typeof Blob<"u"&&Blob)&&ce.isSpecCompliantForm(r);if(!ce.isFunction(l))throw new TypeError("visitor must be a function");function m(b){if(null===b)return"";if(ce.isDate(b))return b.toISOString();if(!p&&ce.isBlob(b))throw new kt("Blob is not supported. Use a Buffer instead.");return ce.isArrayBuffer(b)||ce.isTypedArray(b)?p&&"function"==typeof Blob?new Blob([b]):Buffer.from(b):b}function g(b,C,N){let R=b;if(b&&!N&&"object"==typeof b)if(ce.endsWith(C,"{}"))C=a?C:C.slice(0,-2),b=JSON.stringify(b);else if(ce.isArray(b)&&ce.isArray(A=b)&&!A.some(wg)||(ce.isFileList(b)||ce.endsWith(C,"[]"))&&(R=ce.toArray(b)))return C=Yp(C),R.forEach(function(A,D){!ce.isUndefined(A)&&null!==A&&r.append(!0===h?HI([C],D,d):null===h?C:C+"[]",m(A))}),!1;var A;return!!wg(b)||(r.append(HI(N,C,d),m(b)),!1)}const v=[],y=Object.assign(ZM,{defaultVisitor:g,convertValue:m,isVisitable:wg});if(!ce.isObject(n))throw new TypeError("data must be an object");return function b(C,N){if(!ce.isUndefined(C)){if(-1!==v.indexOf(C))throw Error("Circular reference detected in "+N.join("."));v.push(C),ce.forEach(C,function(R,A){!0===(!(ce.isUndefined(R)||null===R)&&l.call(r,R,ce.isString(A)?Er(A).call(A):A,N,y))&&b(R,N?N.concat(A):[A])}),v.pop()}}(n),r}function JM(n){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(o){return r[o]})}function GI(n,r){this._pairs=[],n&&ub(n,this,r)}const QM=GI.prototype;function R3(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ek(n,r,o){if(!r)return n;const a=o&&o.encode||R3,l=o&&o.serialize;let d;if(d=l?l(r,o):ce.isURLSearchParams(r)?r.toString():new GI(r,o).toString(a),d){const h=n.indexOf("#");-1!==h&&(n=n.slice(0,h)),n+=(-1===n.indexOf("?")?"?":"&")+d}return n}QM.append=function(n,r){this._pairs.push([n,r])},QM.toString=function(n){const r=n?function(o){return n.call(this,o,JM)}:JM;return this._pairs.map(function(o){return r(o[0])+"="+r(o[1])},"").join("&")};var WI=class{constructor(){this.handlers=[]}use(n,r,o){return this.handlers.push({fulfilled:n,rejected:r,synchronous:!!o&&o.synchronous,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){ce.forEach(this.handlers,function(r){null!==r&&n(r)})}},tk={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Rg={exports:{}},ik=zo.f;Ft({target:"Object",stat:!0,forced:Object.defineProperty!==ik,sham:!gs},{defineProperty:ik});var zI=to.Object,D3=Rg.exports=function(n,r,o){return zI.defineProperty(n,r,o)};zI.defineProperty.sham&&(D3.sham=!0);var rk=Gt(Rg.exports),ok=Go,Hu=Array.isArray||function(n){return"Array"==ok(n)},sk=TypeError,$p=Hu,Ag=tg,sl=or,O3=En("species"),ak=Array,Dg=function(n,r){return new(function(n){var r;return $p(n)&&(Ag(r=n.constructor)&&(r===ak||$p(r.prototype))||sl(r)&&null===(r=r[O3]))&&(r=void 0),void 0===r?ak:r}(n))(0===r?0:r)},KI=Pt,P3=pu,sW=En("species"),M3=function(n){return P3>=51||!KI(function(){var r=[];return(r.constructor={})[sW]=function(){return{foo:1}},1!==r[n](Boolean).foo})},k3=Ft,L3=Pt,aW=Hu,x3=or,cW=So,F3=Wc,ck=function(n){if(n>9007199254740991)throw sk("Maximum allowed index exceeded");return n},lk=il,qI=Dg,Og=M3,YI=pu,Ng=En("isConcatSpreadable"),dk=YI>=51||!L3(function(){var n=[];return n[Ng]=!1,n.concat()[0]!==n}),Pg=function(n){if(!x3(n))return!1;var r=n[Ng];return void 0!==r?!!r:aW(n)};k3({target:"Array",proto:!0,arity:1,forced:!dk||!Og("concat")},{concat:function(n){var r,o,a,l,d,h=cW(this),p=qI(h,0),m=0;for(r=-1,a=arguments.length;r<a;r++)if(Pg(d=-1===r?h:arguments[r]))for(l=F3(d),ck(m+l),o=0;o<l;o++,m++)o in d&&lk(p,m,d[o]);else ck(m+1),lk(p,m++,d);return p.length=m,p}});var $I={},U3=Go,Mg=Hc,XI=YE.f,uk=bM,ZI="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];$I.f=function(n){return ZI&&"Window"==U3(n)?function(r){try{return XI(r)}catch{return uk(ZI)}}(n):XI(Mg(n))};var Gu={};Gu.f=En;var hk=to,B3=Ai,kg=Gu,j3=zo.f,Bi=function(n){var r=hk.Symbol||(hk.Symbol={});B3(r,n)||j3(r,n,{value:kg.f(n)})},H3=Ui,hb=yo,pk=En,fk=Vs,JI=function(){var n=hb("Symbol"),r=n&&n.prototype,o=r&&r.valueOf,a=pk("toPrimitive");r&&!r[a]&&fk(r,a,function(l){return H3(o,this)},{arity:1})},G3=Ql,mk=EE,QI=So,pb=Wc,W3=Dg,gk=xn([].push),fd=function(n){var r=1==n,o=2==n,a=3==n,l=4==n,d=6==n,h=7==n,p=5==n||d;return function(m,g,v,y){for(var b,C,N=QI(m),R=mk(N),A=G3(g,v),D=pb(R),M=0,x=y||W3,j=r?x(m,D):o||h?x(m,0):void 0;D>M;M++)if((p||M in R)&&(C=A(b=R[M],M,N),n))if(r)j[M]=C;else if(C)switch(n){case 3:return!0;case 5:return b;case 6:return M;case 2:gk(j,b)}else switch(n){case 4:return!1;case 7:gk(j,b)}return d?-1:a||l?l:j}},_k={forEach:fd(0),map:fd(1),filter:fd(2),some:fd(3),every:fd(4),find:fd(5),findIndex:fd(6),filterReject:fd(7)},fb=Ft,ew=ti,Lg=Ui,xg=xn,Wu=gs,zu=$l,z3=Pt,ji=Ai,mb=Ar,vk=Dr,gb=Hc,_b=wE,tw=Yo,nw=hu,Xp=rd,Ek=ii,yk=YE,iw=$I,bk=Lm,vb=bm,Sk=zo,K3=qT,Ck=uu,Tk=Vs,q3=wp,rw=fu,Eb=km,Ik=cN,Y3=En,$3=Gu,Ku=Bi,Fg=JI,ow=lc,yb=Cu,bb=_k.forEach,br=Mm("hidden"),Ug="Symbol",Vg="prototype",X3=yb.set,wk=yb.getterFor(Ug),Ta=Object[Vg],qu=ew.Symbol,Bg=qu&&qu[Vg],Z3=ew.TypeError,Sb=ew.QObject,jg=vb.f,Yu=Sk.f,Rk=iw.f,Ak=Ck.f,Dk=xg([].push),al=rw("symbols"),Ia=rw("op-symbols"),Zp=rw("wks"),$u=!Sb||!Sb[Vg]||!Sb[Vg].findChild,Ok=Wu&&z3(function(){return 7!=Xp(Yu({},"a",{get:function(){return Yu(this,"a",{value:7}).a}})).a})?function(n,r,o){var a=jg(Ta,r);a&&delete Ta[r],Yu(n,r,o),a&&n!==Ta&&Yu(Ta,r,a)}:Yu,Cb=function(n,r){var o=al[n]=Xp(Bg);return X3(o,{type:Ug,tag:n,description:r}),Wu||(o.description=r),o},Jp=function(n,r,o){n===Ta&&Jp(Ia,r,o),vk(n);var a=_b(r);return vk(o),ji(al,a)?(o.enumerable?(ji(n,br)&&n[br][a]&&(n[br][a]=!1),o=Xp(o,{enumerable:nw(0,!1)})):(ji(n,br)||Yu(n,br,nw(1,{})),n[br][a]=!0),Ok(n,a,o)):Yu(n,a,o)},sw=function(n,r){vk(n);var o=gb(r),a=Ek(o).concat(J3(o));return bb(a,function(l){Wu&&!Lg(aw,o,l)||Jp(n,l,o[l])}),n},aw=function(n){var r=_b(n),o=Lg(Ak,this,r);return!(this===Ta&&ji(al,r)&&!ji(Ia,r))&&(!(o||!ji(this,r)||!ji(al,r)||ji(this,br)&&this[br][r])||o)},Nk=function(n,r){var o=gb(n),a=_b(r);if(o!==Ta||!ji(al,a)||ji(Ia,a)){var l=jg(o,a);return!l||!ji(al,a)||ji(o,br)&&o[br][a]||(l.enumerable=!0),l}},cw=function(n){var r=Rk(gb(n)),o=[];return bb(r,function(a){ji(al,a)||ji(Eb,a)||Dk(o,a)}),o},J3=function(n){var r=n===Ta,o=Rk(r?Ia:gb(n)),a=[];return bb(o,function(l){!ji(al,l)||r&&!ji(Ta,l)||Dk(a,al[l])}),a};zu||(qu=function(){if(mb(Bg,this))throw Z3("Symbol is not a constructor");var n=arguments.length&&void 0!==arguments[0]?tw(arguments[0]):void 0,r=Ik(n),o=function(a){this===Ta&&Lg(o,Ia,a),ji(this,br)&&ji(this[br],r)&&(this[br][r]=!1),Ok(this,r,nw(1,a))};return Wu&&$u&&Ok(Ta,r,{configurable:!0,set:o}),Cb(r,n)},Tk(Bg=qu[Vg],"toString",function(){return wk(this).tag}),Tk(qu,"withoutSetter",function(n){return Cb(Ik(n),n)}),Ck.f=aw,Sk.f=Jp,K3.f=sw,vb.f=Nk,yk.f=iw.f=cw,bk.f=J3,$3.f=function(n){return Cb(Y3(n),n)},Wu&&q3(Bg,"description",{configurable:!0,get:function(){return wk(this).description}})),fb({global:!0,constructor:!0,wrap:!0,forced:!zu,sham:!zu},{Symbol:qu}),bb(Ek(Zp),function(n){Ku(n)}),fb({target:Ug,stat:!0,forced:!zu},{useSetter:function(){$u=!0},useSimple:function(){$u=!1}}),fb({target:"Object",stat:!0,forced:!zu,sham:!Wu},{create:function(n,r){return void 0===r?Xp(n):sw(Xp(n),r)},defineProperty:Jp,defineProperties:sw,getOwnPropertyDescriptor:Nk}),fb({target:"Object",stat:!0,forced:!zu},{getOwnPropertyNames:cw}),Fg(),ow(qu,Ug),Eb[br]=!0;var Pk=$l&&!!Symbol.for&&!!Symbol.keyFor,Qp=Ft,Tb=yo,mc=Ai,Q3=Yo,Mk=fu,lw=Pk,gc=Mk("string-to-symbol-registry"),Ib=Mk("symbol-to-string-registry");Qp({target:"Symbol",stat:!0,forced:!lw},{for:function(n){var r=Q3(n);if(mc(gc,r))return gc[r];var o=Tb("Symbol")(r);return gc[r]=o,Ib[o]=r,o}});var kk=Ft,Hg=Ai,ej=ni,tj=rp,dw=Pk,uw=fu("symbol-to-string-registry");kk({target:"Symbol",stat:!0,forced:!dw},{keyFor:function(n){if(!ej(n))throw TypeError(tj(n)+" is not a symbol");if(Hg(uw,n))return uw[n]}});var cl=Hu,Gg=di,nj=Go,wb=Yo,hw=xn([].push),Lk=Ft,xk=yo,ef=Jh,ij=Ui,Wg=xn,Fk=Pt,Uk=di,Vk=ni,Bk=Jc,oj=$l,js=String,md=xk("JSON","stringify"),Rb=Wg(/./.exec),pw=Wg("".charAt),jk=Wg("".charCodeAt),fw=Wg("".replace),Hk=Wg(1..toString),sj=/[\uD800-\uDFFF]/g,mw=/^[\uD800-\uDBFF]$/,Ab=/^[\uDC00-\uDFFF]$/,gw=!oj||Fk(function(){var n=xk("Symbol")();return"[null]"!=md([n])||"{}"!=md({a:n})||"{}"!=md(Object(n))}),_w=Fk(function(){return'"\\udf06\\ud834"'!==md("\udf06\ud834")||'"\\udead"'!==md("\udead")}),aj=function(n,r){var o=Bk(arguments),a=function(n){if(Gg(n))return n;if(cl(n)){for(var r=n.length,o=[],a=0;a<r;a++){var l=n[a];"string"==typeof l?hw(o,l):"number"!=typeof l&&"Number"!=nj(l)&&"String"!=nj(l)||hw(o,wb(l))}var d=o.length,h=!0;return function(p,m){if(h)return h=!1,m;if(cl(this))return m;for(var g=0;g<d;g++)if(o[g]===p)return m}}}(r);if(Uk(a)||void 0!==n&&!Vk(n))return o[1]=function(l,d){if(Uk(a)&&(d=ij(a,this,js(l),d)),!Vk(d))return d},ef(md,null,o)},cj=function(n,r,o){var a=pw(o,r-1),l=pw(o,r+1);return Rb(mw,n)&&!Rb(Ab,l)||Rb(Ab,n)&&!Rb(mw,a)?"\\u"+Hk(jk(n,0),16):n};md&&Lk({target:"JSON",stat:!0,arity:3,forced:gw||_w},{stringify:function(n,r,o){var a=Bk(arguments),l=ef(gw?aj:md,null,a);return _w&&"string"==typeof l?fw(l,sj,cj):l}});var Gk=Lm,vw=So;Ft({target:"Object",stat:!0,forced:!$l||Pt(function(){Gk.f(1)})},{getOwnPropertySymbols:function(n){var r=Gk.f;return r?r(vw(n)):[]}}),Bi("asyncIterator"),Bi("hasInstance"),Bi("isConcatSpreadable"),Bi("iterator"),Bi("match"),Bi("matchAll"),Bi("replace"),Bi("search"),Bi("species"),Bi("split");var Ew=JI;Bi("toPrimitive"),Ew();var Wk=yo,yw=lc;Bi("toStringTag"),yw(Wk("Symbol"),"Symbol"),Bi("unscopables"),lc(ti.JSON,"JSON",!0);var bw=to.Symbol,dj=zo.f,zk=En("metadata"),Kk=Function.prototype;void 0===Kk[zk]&&dj(Kk,zk,{value:null}),Bi("dispose"),Bi("metadata");var qk=bw;Bi("asyncDispose");var Sw=xn,zg=yo("Symbol"),Yk=zg.keyFor,$k=Sw(zg.prototype.valueOf),Cw=zg.isRegisteredSymbol||function(n){try{return void 0!==Yk($k(n))}catch{return!1}};Ft({target:"Symbol",stat:!0},{isRegisteredSymbol:Cw});for(var uj=fu,Tw=yo,hj=xn,Iw=ni,Xk=En,Kg=Tw("Symbol"),jr=Kg.isWellKnownSymbol,qg=Tw("Object","getOwnPropertyNames"),lW=hj(Kg.prototype.valueOf),pj=uj("wks"),gd=0,ww=qg(Kg),Zk=ww.length;gd<Zk;gd++)try{var Db=ww[gd];Iw(Kg[Db])&&Xk(Db)}catch{}var Rw=function(n){if(jr&&jr(n))return!0;try{for(var r=lW(n),o=0,a=qg(pj),l=a.length;o<l;o++)if(pj[a[o]]==r)return!0}catch{}return!1};Ft({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Rw}),Bi("matcher"),Bi("observable"),Ft({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:Cw}),Ft({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:Rw}),Bi("metadataKey"),Bi("patternMatch"),Bi("replaceAll");var Xu=Gt(qk),Aw=Gt(Gu.f("iterator"));function tf(n){return(tf="function"==typeof Xu&&"symbol"==typeof Aw?function(r){return typeof r}:function(r){return r&&"function"==typeof Xu&&r.constructor===Xu&&r!==Xu.prototype?"symbol":typeof r})(n)}var fj=Gt(Gu.f("toPrimitive"));function O(n,r,o){return(r=function dW(n){var r=function(o){if("object"!==tf(o)||null===o)return o;var l=o[fj];if(void 0!==l){var d=l.call(o,"string");if("object"!==tf(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(n);return"symbol"===tf(r)?r:String(r)}(r))in n?rk(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,n}var uW=Pt,hW=En("iterator"),Ob=!uW(function(){var n=new URL("b?a=1&b=2&c=3","http://a"),r=n.searchParams,o=new URLSearchParams("a=1&a=2"),a="";return n.pathname="c%20d",r.forEach(function(l,d){r.delete("b"),a+=d+l}),o.delete("a",2),!n.toJSON||!o.has("a",1)||o.has("a",2)||!r.size&&!0||!r.sort||"http://a/c%20d?a=1&c=3"!==n.href||"3"!==r.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!r[hW]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("http://a#\u0431").hash||"a1c3"!==a||"x"!==new URL("http://x",void 0).host}),mj=Vs,Dw=Ft,Yg=ti,$g=Ui,wa=xn,Xg=gs,gj=Ob,_j=Vs,pW=wp,mW=lc,gW=sy,Jk=Cu,vj=Zm,Ow=di,nf=Ai,Zg=Ql,Ej=gr,_W=Dr,Nw=or,Ao=Yo,vW=rd,Qk=hu,Pw=NN,yj=e0,ll=Ti,e1=$y,bj=En("iterator"),rf="URLSearchParams",Sj=rf+"Iterator",Mw=Jk.set,Ra=Jk.getterFor(rf),Cj=Jk.getterFor(Sj),t1=Object.getOwnPropertyDescriptor,tn=function(n){if(!Xg)return Yg[n];var r=t1(Yg,n);return r&&r.value},n1=tn("fetch"),Nb=tn("Request"),_d=tn("Headers"),kw=Nb&&Nb.prototype,r1=_d&&_d.prototype,Tj=Yg.RegExp,Ij=Yg.TypeError,o1=Yg.decodeURIComponent,wj=Yg.encodeURIComponent,Rj=wa("".charAt),Lw=wa([].join),vd=wa([].push),xw=wa("".replace),EW=wa([].shift),Fw=wa([].splice),Jg=wa("".split),Zu=wa("".slice),s1=/\+/g,a1=Array(4),yW=function(n){return a1[n-1]||(a1[n-1]=Tj("((?:%[\\da-f]{2}){"+n+"})","gi"))},Uw=function(n){try{return o1(n)}catch{return n}},Pb=function(n){var r=xw(n,s1," "),o=4;try{return o1(r)}catch{for(;o;)r=xw(r,yW(o--),Uw);return r}},Aj=/[!'()~]|%20/g,c1={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Vw=function(n){return c1[n]},l1=function(n){return xw(wj(n),Aj,Vw)},d1=gW(function(n,r){Mw(this,{type:Sj,iterator:Pw(Ra(n).entries),kind:r})},"Iterator",function(){var n=Cj(this),r=n.kind,o=n.iterator.next(),a=o.value;return o.done||(o.value="keys"===r?a.key:"values"===r?a.value:[a.key,a.value]),o},!0),Qg=function(n){this.entries=[],this.url=null,void 0!==n&&(Nw(n)?this.parseObject(n):this.parseQuery("string"==typeof n?"?"===Rj(n,0)?Zu(n,1):n:Ao(n)))};Qg.prototype={type:rf,bindURL:function(n){this.url=n,this.update()},parseObject:function(n){var r,o,a,l,d,h,p,m=yj(n);if(m)for(o=(r=Pw(n,m)).next;!(a=$g(o,r)).done;){if(d=(l=Pw(_W(a.value))).next,(h=$g(d,l)).done||(p=$g(d,l)).done||!$g(d,l).done)throw Ij("Expected sequence with length 2");vd(this.entries,{key:Ao(h.value),value:Ao(p.value)})}else for(var g in n)nf(n,g)&&vd(this.entries,{key:g,value:Ao(n[g])})},parseQuery:function(n){if(n)for(var r,o,a=Jg(n,"&"),l=0;l<a.length;)(r=a[l++]).length&&(o=Jg(r,"="),vd(this.entries,{key:Pb(EW(o)),value:Pb(Lw(o,"="))}))},serialize:function(){for(var n,r=this.entries,o=[],a=0;a<r.length;)n=r[a++],vd(o,l1(n.key)+"="+l1(n.value));return Lw(o,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Mb=function(){vj(this,sf);var n=Mw(this,new Qg(arguments.length>0?arguments[0]:void 0));Xg||(this.size=n.entries.length)},sf=Mb.prototype;if(function(n,r,o){for(var a in r)o&&o.unsafe&&n[a]?n[a]=r[a]:mj(n,a,r[a],o)}(sf,{append:function(n,r){var o=Ra(this);ll(arguments.length,2),vd(o.entries,{key:Ao(n),value:Ao(r)}),Xg||this.length++,o.updateURL()},delete:function(n){for(var r=Ra(this),o=ll(arguments.length,1),a=r.entries,l=Ao(n),d=o<2?void 0:arguments[1],h=void 0===d?d:Ao(d),p=0;p<a.length;){var m=a[p];if(m.key!==l||void 0!==h&&m.value!==h)p++;else if(Fw(a,p,1),void 0!==h)break}Xg||(this.size=a.length),r.updateURL()},get:function(n){var r=Ra(this).entries;ll(arguments.length,1);for(var o=Ao(n),a=0;a<r.length;a++)if(r[a].key===o)return r[a].value;return null},getAll:function(n){var r=Ra(this).entries;ll(arguments.length,1);for(var o=Ao(n),a=[],l=0;l<r.length;l++)r[l].key===o&&vd(a,r[l].value);return a},has:function(n){for(var r=Ra(this).entries,o=ll(arguments.length,1),a=Ao(n),l=o<2?void 0:arguments[1],d=void 0===l?l:Ao(l),h=0;h<r.length;){var p=r[h++];if(p.key===a&&(void 0===d||p.value===d))return!0}return!1},set:function(n,r){var o=Ra(this);ll(arguments.length,1);for(var a,l=o.entries,d=!1,h=Ao(n),p=Ao(r),m=0;m<l.length;m++)(a=l[m]).key===h&&(d?Fw(l,m--,1):(d=!0,a.value=p));d||vd(l,{key:h,value:p}),Xg||(this.size=l.length),o.updateURL()},sort:function(){var n=Ra(this);e1(n.entries,function(r,o){return r.key>o.key?1:-1}),n.updateURL()},forEach:function(n){for(var r,o=Ra(this).entries,a=Zg(n,arguments.length>1?arguments[1]:void 0),l=0;l<o.length;)a((r=o[l++]).value,r.key,this)},keys:function(){return new d1(this,"keys")},values:function(){return new d1(this,"values")},entries:function(){return new d1(this,"entries")}},{enumerable:!0}),_j(sf,bj,sf.entries,{name:"entries"}),_j(sf,"toString",function(){return Ra(this).serialize()},{enumerable:!0}),Xg&&pW(sf,"size",{get:function(){return Ra(this).entries.length},configurable:!0,enumerable:!0}),mW(Mb,rf),Dw({global:!0,constructor:!0,forced:!gj},{URLSearchParams:Mb}),!gj&&Ow(_d)){var Bw=wa(r1.has),Dj=wa(r1.set),Aa=function(n){if(Nw(n)){var r,o=n.body;if(Ej(o)===rf)return r=n.headers?new _d(n.headers):new _d,Bw(r,"content-type")||Dj(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),vW(n,{body:Qk(0,Ao(o)),headers:Qk(0,r)})}return n};if(Ow(n1)&&Dw({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(n){return n1(n,arguments.length>1?Aa(arguments[1]):{})}}),Ow(Nb)){var Ju=function(n){return vj(this,kw),new Nb(n,arguments.length>1?Aa(arguments[1]):{})};kw.constructor=Ju,Ju.prototype=kw,Dw({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:Ju})}}var $i={URLSearchParams:Mb,getState:Ra},Ed=Gt(to.URLSearchParams),kb={isBrowser:!0,classes:{URLSearchParams:void 0!==Ed?Ed:GI,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const es=typeof window<"u"&&typeof document<"u",yd="object"==typeof navigator&&navigator||void 0,Oj=es&&(!yd||["ReactNative","NativeScript","NS"].indexOf(yd.product)<0),e_=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,Si=es&&window.location.href||"http://localhost";function jw(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function Hw(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?jw(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):jw(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}var ts=Hw(Hw({},Object.freeze({__proto__:null,hasBrowserEnv:es,hasStandardBrowserEnv:Oj,hasStandardBrowserWebWorkerEnv:e_,navigator:yd,origin:Si})),kb),Nj=Dr,Xi=Ui,u1=Ai,Pj=Ar,Zi=function(){var n=Nj(this),r="";return n.hasIndices&&(r+="d"),n.global&&(r+="g"),n.ignoreCase&&(r+="i"),n.multiline&&(r+="m"),n.dotAll&&(r+="s"),n.unicode&&(r+="u"),n.unicodeSets&&(r+="v"),n.sticky&&(r+="y"),r},af=RegExp.prototype,Qu=function(n){var r=n.flags;return void 0!==r||"flags"in af||u1(n,"flags")||!Pj(af,n)?r:Xi(Zi,n)},Lb=pg.charAt,cf=Ui,xb=Dr,h1=di,p1=Go,f1=/./.exec,Fb=TypeError,Gw=Ft,Ww=Ui,Mj=Qh,lf=sy,t_=Tp,df=ql,m1=LE,eh=Yo,uf=Dr,kj=Cm,g1=Go,_1=Dm,n_=Qu,th=yi,Lj=Pt,bs=py,Ub=Cu,v1=En("matchAll"),zw="RegExp String",E1=zw+" Iterator",bW=Ub.set,Uj=Ub.getterFor(E1),Vb=TypeError,i_=Mj("".indexOf),hf=Mj("".matchAll),bd=!!hf&&!Lj(function(){hf("a",/./)}),y1=lf(function(n,r,o,a){bW(this,{type:E1,regexp:n,string:r,global:o,unicode:a,done:!1})},zw,function(){var n=Uj(this);if(n.done)return t_(void 0,!0);var r=n.regexp,o=n.string,a=function(n,r){var o=n.exec;if(h1(o)){var a=cf(o,n,r);return null!==a&&xb(a),a}if("RegExp"===p1(n))return cf(f1,n,r);throw Fb("RegExp#exec called on incompatible receiver")}(r,o);return null===a?(n.done=!0,t_(void 0,!0)):n.global?(""===eh(a[0])&&(r.lastIndex=function(n,r,o){return r+(o?Lb(n,r).length:1)}(o,m1(r.lastIndex),n.unicode)),t_(a,!1)):(n.done=!0,t_(a,!1))}),Kw=function(n){var r,o,a,l=uf(this),d=eh(n),h=bs(l,RegExp),p=eh(n_(l));return r=new h(h===RegExp?l.source:l,p),o=!!~i_(p,"g"),a=!!~i_(p,"u"),r.lastIndex=m1(l.lastIndex),new y1(r,d,o,a)};Gw({target:"String",proto:!0,forced:bd},{matchAll:function(n){var r,o,a,l,d=df(this);if(kj(n)){if(bd)return hf(d,n)}else{if(_1(n)&&(r=eh(df(n_(n))),!~i_(r,"g")))throw Vb("`.matchAll` does not allow non-global regexes");if(bd)return hf(d,n);if(void 0===(a=th(n,v1))&&"RegExp"==g1(n)&&(a=Kw),a)return Ww(a,n,d)}return o=eh(d),l=new RegExp(n,"g"),Ww(Kw,l,o)}});var pf=Or("String").matchAll,qw=Ar,Yw=pf,Bb=String.prototype,S1=Gt(function(n){var r=n.matchAll;return"string"==typeof n||n===Bb||qw(Bb,n)&&r===Bb.matchAll?Yw:r});function C1(n){function r(o,a,l,d){let h=o[d++];if("__proto__"===h)return!0;const p=Number.isFinite(+h),m=d>=o.length;return h=!h&&ce.isArray(l)?l.length:h,m?(l[h]=ce.hasOwnProp(l,h)?[l[h],a]:a,!p):(l[h]&&ce.isObject(l[h])||(l[h]=[]),r(o,a,l[h],d)&&ce.isArray(l[h])&&(l[h]=function(g){const v={},y=Object.keys(g);let b;const C=y.length;let N;for(b=0;b<C;b++)N=y[b],v[N]=g[N];return v}(l[h])),!p)}if(ce.isFormData(n)&&ce.isFunction(n.entries)){const o={};return ce.forEachEntry(n,(a,l)=>{var d;r((d=a,S1(ce).call(ce,/\w+|\[(\w*)]/g,d).map(h=>"[]"===h[0]?"":h[1]||h[0])),l,o,0)}),o}return null}const $w={transitional:tk,adapter:["xhr","http","fetch"],transformRequest:[function(n,r){const o=r.getContentType()||"",a=o.indexOf("application/json")>-1,l=ce.isObject(n);if(l&&ce.isHTMLForm(n)&&(n=new FormData(n)),ce.isFormData(n))return a?JSON.stringify(C1(n)):n;if(ce.isArrayBuffer(n)||ce.isBuffer(n)||ce.isStream(n)||ce.isFile(n)||ce.isBlob(n)||ce.isReadableStream(n))return n;if(ce.isArrayBufferView(n))return n.buffer;if(ce.isURLSearchParams(n))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let d;if(l){if(o.indexOf("application/x-www-form-urlencoded")>-1)return(h=n,p=this.formSerializer,ub(h,new ts.classes.URLSearchParams,Object.assign({visitor:function(m,g,v,y){return ts.isNode&&ce.isBuffer(m)?(this.append(g,m.toString("base64")),!1):y.defaultVisitor.apply(this,arguments)}},p))).toString();if((d=ce.isFileList(n))||o.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return ub(d?{"files[]":n}:n,h&&new h,this.formSerializer)}}var h,p;return l||a?(r.setContentType("application/json",!1),function(h){if(ce.isString(h))try{return(0,JSON.parse)(h),Er(ce).call(ce,h)}catch(g){if("SyntaxError"!==g.name)throw g}return(0,JSON.stringify)(h)}(n)):n}],transformResponse:[function(n){const r=this.transitional||$w.transitional,o=r&&r.forcedJSONParsing,a="json"===this.responseType;if(ce.isResponse(n)||ce.isReadableStream(n))return n;if(n&&ce.isString(n)&&(o&&!this.responseType||a)){const l=!(r&&r.silentJSONParsing)&&a;try{return JSON.parse(n)}catch(d){if(l)throw"SyntaxError"===d.name?kt.from(d,kt.ERR_BAD_RESPONSE,this,null,this.response):d}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ts.classes.FormData,Blob:ts.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ce.forEach(["delete","get","head","post","put","patch"],n=>{$w.headers[n]={}});var Sd=$w;const T1=ce.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),I1=Symbol("internals");function r_(n){var r;return n&&Er(r=String(n)).call(r).toLowerCase()}function jb(n){return!1===n||null==n?n:ce.isArray(n)?n.map(jb):String(n)}function Hb(n,r,o,a,l){return ce.isFunction(a)?a.call(this,r,o):(l&&(r=o),ce.isString(r)?ce.isString(a)?-1!==r.indexOf(a):ce.isRegExp(a)?a.test(r):void 0:void 0)}class o_{constructor(r){r&&this.set(r)}set(r,o,a){const l=this;function d(m,g,v){const y=r_(g);if(!y)throw new Error("header name must be a non-empty string");const b=ce.findKey(l,y);(!b||void 0===l[b]||!0===v||void 0===v&&!1!==l[b])&&(l[b||g]=jb(m))}const h=(m,g)=>ce.forEach(m,(v,y)=>d(v,y,g));if(ce.isPlainObject(r)||r instanceof this.constructor)h(r,o);else if(ce.isString(r)&&(r=Er(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Er(p=r).call(p)))h((m=>{const g={};let v,y,b;return m&&m.split("\n").forEach(function(C){var N,R;b=C.indexOf(":"),v=Er(N=C.substring(0,b)).call(N).toLowerCase(),y=Er(R=C.substring(b+1)).call(R),!v||g[v]&&T1[v]||("set-cookie"===v?g[v]?g[v].push(y):g[v]=[y]:g[v]=g[v]?g[v]+", "+y:y)}),g})(r),o);else if(ce.isHeaders(r))for(const[m,g]of r.entries())d(g,m,a);else null!=r&&d(o,r,a);var p;return this}get(r,o){if(r=r_(r)){const a=ce.findKey(this,r);if(a){const l=this[a];if(!o)return l;if(!0===o)return function(d){const h=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let m;for(;m=p.exec(d);)h[m[1]]=m[2];return h}(l);if(ce.isFunction(o))return o.call(this,l,a);if(ce.isRegExp(o))return o.exec(l);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,o){if(r=r_(r)){const a=ce.findKey(this,r);return!(!a||void 0===this[a]||o&&!Hb(0,this[a],a,o))}return!1}delete(r,o){const a=this;let l=!1;function d(h){if(h=r_(h)){const p=ce.findKey(a,h);!p||o&&!Hb(0,a[p],p,o)||(delete a[p],l=!0)}}return ce.isArray(r)?r.forEach(d):d(r),l}clear(r){const o=Object.keys(this);let a=o.length,l=!1;for(;a--;){const d=o[a];r&&!Hb(0,this[d],d,r,!0)||(delete this[d],l=!0)}return l}normalize(r){const o=this,a={};return ce.forEach(this,(l,d)=>{var h;const p=ce.findKey(a,d);if(p)return o[p]=jb(l),void delete o[d];const m=r?Er(g=d).call(g).toLowerCase().replace(/([a-z\d])(\w*)/g,(v,y,b)=>y.toUpperCase()+b):Er(h=String(d)).call(h);var g;m!==d&&delete o[d],o[m]=jb(l),a[m]=!0}),this}concat(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return this.constructor.concat(this,...o)}toJSON(r){const o=Object.create(null);return ce.forEach(this,(a,l)=>{null!=a&&!1!==a&&(o[l]=r&&ce.isArray(a)?a.join(", "):a)}),o}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[o,a]=r;return o+": "+a}).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const o=new this(r);for(var a=arguments.length,l=new Array(a>1?a-1:0),d=1;d<a;d++)l[d-1]=arguments[d];return l.forEach(h=>o.set(h)),o}static accessor(r){const o=(this[I1]=this[I1]={accessors:{}}).accessors,a=this.prototype;function l(d){const h=r_(d);o[h]||(function(p,m){const g=ce.toCamelCase(" "+m);["get","set","has"].forEach(v=>{Object.defineProperty(p,v+g,{value:function(y,b,C){return this[v].call(this,m,y,b,C)},configurable:!0})})}(a,d),o[h]=!0)}return ce.isArray(r)?r.forEach(l):l(r),this}}o_.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ce.reduceDescriptors(o_.prototype,(n,r)=>{let{value:o}=n,a=r[0].toUpperCase()+r.slice(1);return{get:()=>o,set(l){this[a]=l}}}),ce.freezeMethods(o_);var Da=o_;function w1(n,r){const o=this||Sd,a=r||o,l=Da.from(a.headers);let d=a.data;return ce.forEach(n,function(h){d=h.call(o,d,l.normalize(),r?r.status:void 0)}),l.normalize(),d}function R1(n){return!(!n||!n.__CANCEL__)}function Cd(n,r,o){kt.call(this,n??"canceled",kt.ERR_CANCELED,r,o),this.name="CanceledError"}function Gb(n,r,o){const a=o.config.validateStatus;o.status&&a&&!a(o.status)?r(new kt("Request failed with status code "+o.status,[kt.ERR_BAD_REQUEST,kt.ERR_BAD_RESPONSE][Math.floor(o.status/100)-4],o.config,o.request,o)):n(o)}ce.inherits(Cd,kt,{__CANCEL__:!0});const Wb=function(n,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,a=0;const l=function(d,h){d=d||10;const p=new Array(d),m=new Array(d);let g,v=0,y=0;return h=void 0!==h?h:1e3,function(b){const C=Date.now(),N=m[y];g||(g=C),p[v]=b,m[v]=C;let R=y,A=0;for(;R!==v;)A+=p[R++],R%=d;if(v=(v+1)%d,v===y&&(y=(y+1)%d),C-g<h)return;const D=N&&C-N;return D?Math.round(1e3*A/D):void 0}}(50,250);return function(d,h){let p,m,g=0,v=1e3/h;const y=function(b){g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),p=null,m&&(clearTimeout(m),m=null),d.apply(null,b)};return[function(){const b=Date.now(),C=b-g;for(var N=arguments.length,R=new Array(N),A=0;A<N;A++)R[A]=arguments[A];C>=v?y(R,b):(p=R,m||(m=setTimeout(()=>{m=null,y(p)},v-C)))},()=>p&&y(p)]}(d=>{const h=d.loaded,p=d.lengthComputable?d.total:void 0,m=h-a,g=l(m);a=h,n({loaded:h,total:p,progress:p?h/p:void 0,bytes:m,rate:g||void 0,estimated:g&&p&&h<=p?(p-h)/g:void 0,event:d,lengthComputable:null!=p,[r?"download":"upload"]:!0})},o)},A1=(n,r)=>{const o=null!=n;return[a=>r[0]({lengthComputable:o,total:n,loaded:a}),r[1]]},D1=n=>function(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return ce.asap(()=>n(...o))};var Vj=ts.hasStandardBrowserEnv?function(){const n=ts.navigator&&/(msie|trident)/i.test(ts.navigator.userAgent),r=document.createElement("a");let o;function a(l){let d=l;return n&&(r.setAttribute("href",d),d=r.href),r.setAttribute("href",d),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return o=a(window.location.href),function(l){const d=ce.isString(l)?a(l):l;return d.protocol===o.protocol&&d.host===o.host}}():function(){return!0},Bj=ts.hasStandardBrowserEnv?{write(n,r,o,a,l,d){const h=[n+"="+encodeURIComponent(r)];ce.isNumber(o)&&h.push("expires="+new Date(o).toGMTString()),ce.isString(a)&&h.push("path="+a),ce.isString(l)&&h.push("domain="+l),!0===d&&h.push("secure"),document.cookie=h.join("; ")},read(n){const r=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function O1(n,r){return n&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)?(o=n,(a=r)?o.replace(/\/?\/$/,"")+"/"+a.replace(/^\/+/,""):o):r;var o,a}function N1(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}const P1=n=>n instanceof Da?function(r){for(var o=1;o<arguments.length;o++){var a=null!=arguments[o]?arguments[o]:{};o%2?N1(Object(a),!0).forEach(function(l){O(r,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):N1(Object(a)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(a,l))})}return r}({},n):n;function nh(n,r){r=r||{};const o={};function a(g,v,y){return ce.isPlainObject(g)&&ce.isPlainObject(v)?ce.merge.call({caseless:y},g,v):ce.isPlainObject(v)?ce.merge({},v):ce.isArray(v)?v.slice():v}function l(g,v,y){return ce.isUndefined(v)?ce.isUndefined(g)?void 0:a(void 0,g,y):a(g,v,y)}function d(g,v){if(!ce.isUndefined(v))return a(void 0,v)}function h(g,v){return ce.isUndefined(v)?ce.isUndefined(g)?void 0:a(void 0,g):a(void 0,v)}function p(g,v,y){return y in r?a(g,v):y in n?a(void 0,g):void 0}const m={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:p,headers:(g,v)=>l(P1(g),P1(v),!0)};return ce.forEach(Object.keys(Object.assign({},n,r)),function(g){const v=m[g]||l,y=v(n[g],r[g],g);ce.isUndefined(y)&&v!==p||(o[g]=y)}),o}var M1=n=>{const r=nh({},n);let o,{data:a,withXSRFToken:l,xsrfHeaderName:d,xsrfCookieName:h,headers:p,auth:m}=r;if(r.headers=p=Da.from(p),r.url=ek(O1(r.baseURL,r.url),n.params,n.paramsSerializer),m&&p.set("Authorization","Basic "+btoa((m.username||"")+":"+(m.password?unescape(encodeURIComponent(m.password)):""))),ce.isFormData(a))if(ts.hasStandardBrowserEnv||ts.hasStandardBrowserWebWorkerEnv)p.setContentType(void 0);else if(!1!==(o=p.getContentType())){const[g,...v]=o?o.split(";").map(y=>Er(y).call(y)).filter(Boolean):[];p.setContentType([g||"multipart/form-data",...v].join("; "))}if(ts.hasStandardBrowserEnv&&(l&&ce.isFunction(l)&&(l=l(r)),l||!1!==l&&Vj(r.url))){const g=d&&h&&Bj.read(h);g&&p.set(d,g)}return r},jj=typeof XMLHttpRequest<"u"&&function(n){return new le(function(r,o){const a=M1(n);let l=a.data;const d=Da.from(a.headers).normalize();let h,p,m,g,v,{responseType:y,onUploadProgress:b,onDownloadProgress:C}=a;function N(){g&&g(),v&&v(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let R=new XMLHttpRequest;function A(){if(!R)return;const M=Da.from("getAllResponseHeaders"in R&&R.getAllResponseHeaders());Gb(function(x){r(x),N()},function(x){o(x),N()},{data:y&&"text"!==y&&"json"!==y?R.response:R.responseText,status:R.status,statusText:R.statusText,headers:M,config:n,request:R}),R=null}R.open(a.method.toUpperCase(),a.url,!0),R.timeout=a.timeout,"onloadend"in R?R.onloadend=A:R.onreadystatechange=function(){R&&4===R.readyState&&(0!==R.status||R.responseURL&&0===R.responseURL.indexOf("file:"))&&setTimeout(A)},R.onabort=function(){R&&(o(new kt("Request aborted",kt.ECONNABORTED,n,R)),R=null)},R.onerror=function(){o(new kt("Network Error",kt.ERR_NETWORK,n,R)),R=null},R.ontimeout=function(){let M=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";a.timeoutErrorMessage&&(M=a.timeoutErrorMessage),o(new kt(M,(a.transitional||tk).clarifyTimeoutError?kt.ETIMEDOUT:kt.ECONNABORTED,n,R)),R=null},void 0===l&&d.setContentType(null),"setRequestHeader"in R&&ce.forEach(d.toJSON(),function(M,x){R.setRequestHeader(x,M)}),ce.isUndefined(a.withCredentials)||(R.withCredentials=!!a.withCredentials),y&&"json"!==y&&(R.responseType=a.responseType),C&&([m,v]=Wb(C,!0),R.addEventListener("progress",m)),b&&R.upload&&([p,g]=Wb(b),R.upload.addEventListener("progress",p),R.upload.addEventListener("loadend",g)),(a.cancelToken||a.signal)&&(h=M=>{R&&(o(!M||M.type?new Cd(null,n,R):M),R.abort(),R=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));const D=function(M){const x=/^([-+\w]{1,25})(:?\/\/|:)/.exec(M);return x&&x[1]||""}(a.url);D&&-1===ts.protocols.indexOf(D)?o(new kt("Unsupported protocol "+D+":",kt.ERR_BAD_REQUEST,n)):R.send(l||null)})},Hj=(n,r)=>{const{length:o}=n=n?n.filter(Boolean):[];if(r||o){let a,l=new AbortController;const d=function(g){if(!a){a=!0,p();const v=g instanceof Error?g:this.reason;l.abort(v instanceof kt?v:new Cd(v instanceof Error?v.message:v))}};let h=r&&setTimeout(()=>{h=null,d(new kt("timeout ".concat(r," of ms exceeded"),kt.ETIMEDOUT))},r);const p=()=>{n&&(h&&clearTimeout(h),h=null,n.forEach(g=>{g.unsubscribe?g.unsubscribe(d):g.removeEventListener("abort",d)}),n=null)};n.forEach(g=>g.addEventListener("abort",d));const{signal:m}=l;return m.unsubscribe=()=>ce.asap(p),m}},Gj=nl,Wj=ba;Ft({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var n=Wj.f(this);return{promise:n.promise,resolve:n.resolve,reject:n.reject}}});var zj=ba,Kj=Du;Ft({target:"Promise",stat:!0,forced:!0},{try:function(n){var r=zj.f(this),o=Kj(n);return(o.error?r.reject:r.resolve)(o.value),r.promise}});var zb=Gt(Gj),Xw=Gu.f("asyncIterator"),Td=Gt(Xw);function s_(n,r){this.v=n,this.k=r}function a_(n){var r,o;function a(d,h){try{var p=n[d](h),m=p.value,g=m instanceof s_;zb.resolve(g?m.v:m).then(function(v){if(g){var y="return"===d?"return":"next";if(!m.k||v.done)return a(y,v);v=n[y](v).value}l(p.done?"return":"normal",v)},function(v){a("throw",v)})}catch(v){l("throw",v)}}function l(d,h){switch(d){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?a(r.key,r.arg):o=null}this._invoke=function(d,h){return new zb(function(p,m){var g={key:d,arg:h,resolve:p,reject:m,next:null};o?o=o.next=g:(r=o=g,a(d,h))})},"function"!=typeof n.return&&(this.return=void 0)}function ns(n){return function(){return new a_(n.apply(this,arguments))}}function tt(n){return new s_(n,0)}function c_(n){var r={},o=!1;function a(l,d){return o=!0,{done:!1,value:new s_(d=new zb(function(h){h(n[l](d))}),1)}}return r[void 0!==Xu&&Aw||"@@iterator"]=function(){return this},r.next=function(l){return o?(o=!1,l):a("next",l)},"function"==typeof n.throw&&(r.throw=function(l){if(o)throw o=!1,l;return a("throw",l)}),"function"==typeof n.return&&(r.return=function(l){return o?(o=!1,l):a("return",l)}),r}a_.prototype["function"==typeof Xu&&Td||"@@asyncIterator"]=function(){return this},a_.prototype.next=function(n){return this._invoke("next",n)},a_.prototype.throw=function(n){return this._invoke("throw",n)},a_.prototype.return=function(n){return this._invoke("return",n)};var Kb=Gt(Xw);function ih(n){var r,o,a,l=2;for(typeof Symbol<"u"&&(o=Kb,a=Symbol.iterator);l--;){if(o&&null!=(r=n[o]))return r.call(n);if(a&&null!=(r=n[a]))return new ff(r.call(n));o="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function ff(n){function r(o){if(Object(o)!==o)return le.reject(new TypeError(o+" is not an object."));var a=o.done;return le.resolve(o.value).then(function(l){return{value:l,done:a}})}return(ff=function(o){this.s=o,this.n=o.next}).prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(o){var a=this.s.return;return void 0===a?le.resolve({value:o,done:!0}):r(a.apply(this.s,arguments))},throw:function(o){var a=this.s.return;return void 0===a?le.reject(o):r(a.apply(this.s,arguments))}},new ff(n)}const mf=function*(n,r){let o=n.byteLength;if(!r||o<r)return void(yield n);let a,l=0;for(;l<o;)a=l+r,yield n.slice(l,a),l=a},k1=function(){var n=ns(function*(r,o){var a,l=!1,d=!1;try{for(var h,p=ih(gf(r));l=!(h=yield tt(p.next())).done;l=!1){const m=h.value;yield*c_(ih(mf(m,o)))}}catch(m){d=!0,a=m}finally{try{l&&null!=p.return&&(yield tt(p.return()))}finally{if(d)throw a}}});return function(r,o){return n.apply(this,arguments)}}(),gf=function(){var n=ns(function*(r){if(r[Kb])return void(yield*c_(ih(r)));const o=r.getReader();try{for(;;){const{done:a,value:l}=yield tt(o.read());if(a)break;yield l}}finally{yield tt(o.cancel())}});return function(r){return n.apply(this,arguments)}}(),Ji=(n,r,o,a)=>{const l=k1(n,r);let d,h=0,p=m=>{d||(d=!0,a&&a(m))};return new ReadableStream({pull:m=>L(function*(){try{const{done:g,value:v}=yield l.next();if(g)return p(),void m.close();if(o){let b=h+=v.byteLength;o(b)}m.enqueue(new Uint8Array(v))}catch(g){throw p(g),g}})(),cancel:m=>(p(m),l.return())},{highWaterMark:2})};function rh(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function oh(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?rh(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):rh(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}const dl="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,sh=dl&&"function"==typeof ReadableStream,_f=dl&&("function"==typeof TextEncoder?(ah=new TextEncoder,n=>ah.encode(n)):function(){var n=L(function*(r){return new Uint8Array(yield new Response(r).arrayBuffer())});return function(r){return n.apply(this,arguments)}}());var ah;const ch=function(n){try{for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return!!n(...o)}catch{return!1}},vf=sh&&ch(()=>{let n=!1;const r=new Request(ts.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!r}),Id=sh&&ch(()=>ce.isReadableStream(new Response("").body)),l_={stream:Id&&(n=>n.body)};var Zw;dl&&(Zw=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(n=>{!l_[n]&&(l_[n]=ce.isFunction(Zw[n])?r=>r[n]():(r,o)=>{throw new kt("Response type '".concat(n,"' is not supported"),kt.ERR_NOT_SUPPORT,o)})}));const L1=function(){var n=L(function*(r,o){return ce.toFiniteNumber(r.getContentLength())??(l=L(function*(d){return null==d?0:ce.isBlob(d)?d.size:ce.isSpecCompliantForm(d)?(yield new Request(ts.origin,{method:"POST",body:d}).arrayBuffer()).byteLength:ce.isArrayBufferView(d)||ce.isArrayBuffer(d)?d.byteLength:(ce.isURLSearchParams(d)&&(d+=""),ce.isString(d)?(yield _f(d)).byteLength:void 0)}),function(d){return l.apply(this,arguments)})(o);var l});return function(o,a){return n.apply(this,arguments)}}();var x1=dl&&function(){var n=L(function*(r){let{url:o,method:a,data:l,signal:d,cancelToken:h,timeout:p,onDownloadProgress:m,onUploadProgress:g,responseType:v,headers:y,withCredentials:b="same-origin",fetchOptions:C}=M1(r);v=v?(v+"").toLowerCase():"text";let N,R=Hj([d,h&&h.toAbortSignal()],p);const A=R&&R.unsubscribe&&(()=>{R.unsubscribe()});let D;try{if(g&&vf&&"get"!==a&&"head"!==a&&0!==(D=yield L1(y,l))){let q,ee=new Request(o,{method:"POST",body:l,duplex:"half"});if(ce.isFormData(l)&&(q=ee.headers.get("content-type"))&&y.setContentType(q),ee.body){const[J,X]=A1(D,Wb(D1(g)));l=Ji(ee.body,65536,J,X)}}ce.isString(b)||(b=b?"include":"omit");const M="credentials"in Request.prototype;N=new Request(o,oh(oh({},C),{},{signal:R,method:a.toUpperCase(),headers:y.normalize().toJSON(),body:l,duplex:"half",credentials:M?b:void 0}));let x=yield fetch(N);const j=Id&&("stream"===v||"response"===v);if(Id&&(m||j&&A)){const q={};["status","statusText","headers"].forEach(Ce=>{q[Ce]=x[Ce]});const ee=ce.toFiniteNumber(x.headers.get("content-length")),[J,X]=m&&A1(ee,Wb(D1(m),!0))||[];x=new Response(Ji(x.body,65536,J,()=>{X&&X(),A&&A()}),q)}v=v||"text";let W=yield l_[ce.findKey(l_,v)||"text"](x,r);return!j&&A&&A(),yield new le((q,ee)=>{Gb(q,ee,{data:W,headers:Da.from(x.headers),status:x.status,statusText:x.statusText,config:r,request:N})})}catch(M){throw A&&A(),M&&"TypeError"===M.name&&/fetch/i.test(M.message)?Object.assign(new kt("Network Error",kt.ERR_NETWORK,r,N),{cause:M.cause||M}):kt.from(M,M&&M.code,r,N)}});return function(r){return n.apply(this,arguments)}}();const qb={http:null,xhr:jj,fetch:x1};ce.forEach(qb,(n,r)=>{if(n){try{Object.defineProperty(n,"name",{value:r})}catch{}Object.defineProperty(n,"adapterName",{value:r})}});const Jw=n=>"- ".concat(n),F1=n=>ce.isFunction(n)||null===n||!1===n;var Qw_getAdapter=n=>{n=ce.isArray(n)?n:[n];const{length:r}=n;let o,a;const l={};for(let d=0;d<r;d++){let h;if(o=n[d],a=o,!F1(o)&&(a=qb[(h=String(o)).toLowerCase()],void 0===a))throw new kt("Unknown adapter '".concat(h,"'"));if(a)break;l[h||"#"+d]=a}if(!a){const d=Object.entries(l).map(h=>{let[p,m]=h;return"adapter ".concat(p," ")+(!1===m?"is not supported by the environment":"is not available in the build")});throw new kt("There is no suitable adapter to dispatch the request "+(r?d.length>1?"since :\n"+d.map(Jw).join("\n"):" "+Jw(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return a};function Yb(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Cd(null,n)}function d_(n){return Yb(n),n.headers=Da.from(n.headers),n.data=w1.call(n,n.transformRequest),-1!==["post","put","patch"].indexOf(n.method)&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Qw_getAdapter(n.adapter||Sd.adapter)(n).then(function(r){return Yb(n),r.data=w1.call(n,n.transformResponse,r),r.headers=Da.from(r.headers),r},function(r){return R1(r)||(Yb(n),r&&r.response&&(r.response.data=w1.call(n,n.transformResponse,r.response),r.response.headers=Da.from(r.response.headers))),le.reject(r)})}const eR={};["object","boolean","number","function","string","symbol"].forEach((n,r)=>{eR[n]=function(o){return typeof o===n||"a"+(r<1?"n ":" ")+n}});const U1={};eR.transitional=function(n,r,o){function a(l,d){return"[Axios v1.7.7] Transitional option '"+l+"'"+d+(o?". "+o:"")}return(l,d,h)=>{if(!1===n)throw new kt(a(d," has been removed"+(r?" in "+r:"")),kt.ERR_DEPRECATED);return r&&!U1[d]&&(U1[d]=!0,console.warn(a(d," has been deprecated since v"+r+" and will be removed in the near future"))),!n||n(l,d,h)}};var u_={assertOptions:function(n,r,o){if("object"!=typeof n)throw new kt("options must be an object",kt.ERR_BAD_OPTION_VALUE);const a=Object.keys(n);let l=a.length;for(;l-- >0;){const d=a[l],h=r[d];if(h){const p=n[d],m=void 0===p||h(p,d,n);if(!0!==m)throw new kt("option "+d+" must be "+m,kt.ERR_BAD_OPTION_VALUE)}else if(!0!==o)throw new kt("Unknown option "+d,kt.ERR_BAD_OPTION)}},validators:eR};const is=u_.validators;let Ef=class{constructor(n){this.defaults=n,this.interceptors={request:new WI,response:new WI}}request(n,r){var o=this;return L(function*(){try{return yield o._request(n,r)}catch(a){if(a instanceof Error){let l;Error.captureStackTrace?Error.captureStackTrace(l={}):l=new Error;const d=l.stack?l.stack.replace(/^.+\n/,""):"";try{a.stack?d&&!String(a.stack).endsWith(d.replace(/^.+\n.+\n/,""))&&(a.stack+="\n"+d):a.stack=d}catch{}}throw a}})()}_request(n,r){"string"==typeof n?(r=r||{}).url=n:r=n||{},r=nh(this.defaults,r);const{transitional:o,paramsSerializer:a,headers:l}=r;void 0!==o&&u_.assertOptions(o,{silentJSONParsing:is.transitional(is.boolean),forcedJSONParsing:is.transitional(is.boolean),clarifyTimeoutError:is.transitional(is.boolean)},!1),null!=a&&(ce.isFunction(a)?r.paramsSerializer={serialize:a}:u_.assertOptions(a,{encode:is.function,serialize:is.function},!0)),r.method=(r.method||this.defaults.method||"get").toLowerCase();let d=l&&ce.merge(l.common,l[r.method]);l&&ce.forEach(["delete","get","head","post","put","patch","common"],C=>{delete l[C]}),r.headers=Da.concat(d,l);const h=[];let p=!0;this.interceptors.request.forEach(function(C){"function"==typeof C.runWhen&&!1===C.runWhen(r)||(p=p&&C.synchronous,h.unshift(C.fulfilled,C.rejected))});const m=[];let g;this.interceptors.response.forEach(function(C){m.push(C.fulfilled,C.rejected)});let v,y=0;if(!p){const C=[d_.bind(this),void 0];for(C.unshift.apply(C,h),C.push.apply(C,m),v=C.length,g=le.resolve(r);y<v;)g=g.then(C[y++],C[y++]);return g}v=h.length;let b=r;for(y=0;y<v;){const C=h[y++],N=h[y++];try{b=C(b)}catch(R){N.call(this,R);break}}try{g=d_.call(this,b)}catch(C){return le.reject(C)}for(y=0,v=m.length;y<v;)g=g.then(m[y++],m[y++]);return g}getUri(n){return ek(O1((n=nh(this.defaults,n)).baseURL,n.url),n.params,n.paramsSerializer)}};ce.forEach(["delete","get","head","options"],function(n){Ef.prototype[n]=function(r,o){return this.request(nh(o||{},{method:n,url:r,data:(o||{}).data}))}}),ce.forEach(["post","put","patch"],function(n){function r(o){return function(a,l,d){return this.request(nh(d||{},{method:n,headers:o?{"Content-Type":"multipart/form-data"}:{},url:a,data:l}))}}Ef.prototype[n]=r(),Ef.prototype[n+"Form"]=r(!0)});var $b=Ef;class h_{constructor(r){if("function"!=typeof r)throw new TypeError("executor must be a function.");let o;this.promise=new le(function(l){o=l});const a=this;this.promise.then(l=>{if(!a._listeners)return;let d=a._listeners.length;for(;d-- >0;)a._listeners[d](l);a._listeners=null}),this.promise.then=l=>{let d;const h=new le(p=>{a.subscribe(p),d=p}).then(l);return h.cancel=function(){a.unsubscribe(d)},h},r(function(l,d,h){a.reason||(a.reason=new Cd(l,d,h),o(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const o=this._listeners.indexOf(r);-1!==o&&this._listeners.splice(o,1)}toAbortSignal(){const r=new AbortController,o=a=>{r.abort(a)};return this.subscribe(o),r.signal.unsubscribe=()=>this.unsubscribe(o),r.signal}static source(){let r;return{token:new h_(function(o){r=o}),cancel:r}}}var SW=h_;const V1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(V1).forEach(n=>{let[r,o]=n;V1[o]=r});var qj=V1;const lr=function n(r){const o=new $b(r),a=zM($b.prototype.request,o);return ce.extend(a,$b.prototype,o,{allOwnKeys:!0}),ce.extend(a,o,null,{allOwnKeys:!0}),a.create=function(l){return n(nh(r,l))},a}(Sd);lr.Axios=$b,lr.CanceledError=Cd,lr.CancelToken=SW,lr.isCancel=R1,lr.VERSION="1.7.7",lr.toFormData=ub,lr.AxiosError=kt,lr.Cancel=lr.CanceledError,lr.all=function(n){return le.all(n)},lr.spread=function(n){return function(r){return n.apply(null,r)}},lr.isAxiosError=function(n){return ce.isObject(n)&&!0===n.isAxiosError},lr.mergeConfig=nh,lr.AxiosHeaders=Da,lr.formToJSON=n=>C1(ce.isHTMLForm(n)?new FormData(n):n),lr.getAdapter=Qw_getAdapter,lr.HttpStatusCode=qj,lr.default=lr;var Nr=lr;const Yj=()=>{};function Ni(){const n={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Yj};return n.promise=new le((r,o)=>{n.resolve=a=>{n.isFinished||(n.isResolved=!0,n.isFinished=!0,r(a),n.value=a)},n.reject=a=>{n.isFinished||(n.isRejected=!0,n.isFinished=!0,o(a))}}),n}const p_=new Map,Xb=new Map,_c=new Map;let pi=function(n){return n.WIN_10="Windows 10",n.WIN_81="Windows 8.1",n.WIN_8="Windows 8",n.WIN_7="Windows 7",n.WIN_VISTA="Windows Vista",n.WIN_SERVER_2003="Windows Server 2003",n.WIN_XP="Windows XP",n.WIN_2000="Windows 2000",n.ANDROID="Android",n.HARMONY_OS="HarmonyOS",n.OPEN_BSD="Open BSD",n.SUN_OS="Sun OS",n.LINUX="Linux",n.IOS="iOS",n.MAC_OS="Mac OS",n.CHROMIUM_OS="Chromium OS",n.QNX="QNX",n.UNIX="UNIX",n.BEOS="BeOS",n.OS_2="OS/2",n.SEARCH_BOT="Search Bot",n}({}),wt=function(n){return n.CHROME="Chrome",n.SAFARI="Safari",n.EDGE="Edge",n.FIREFOX="Firefox",n.OPERA="OPR",n.QQ="QQBrowser",n.WECHAT="MicroMessenger",n}({});const Zb=new kM;let Hs=Zb.getResult(),wd=null;function ot(n){if(!wd){n&&Zb.setUA(n),Hs=Zb.getResult();const r=function(p){if("Blink"===p.engine.name&&"WeChat"!==p.browser.name)return wt.CHROME;switch(p.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return wt.CHROME;case"Safari":case"Mobile Safari":return wt.SAFARI;case"Edge":return wt.EDGE;case"Firefox":return wt.FIREFOX;case"QQ":case"QQBrowser":return wt.QQ;case"Opera":return wt.OPERA;case"WeChat":return wt.WECHAT;default:return p.browser.name||""}}(Hs),o=B1(Hs),a="Windows"===(p=Hs).os.name?p.os.version?p.os.name+" "+p.os.version:p.os.name:p.os.name||"",l=Hs.os.version,d=B1(Hs,!1),h=Hs.device.type;if(!(r&&o&&a&&l))return{name:r,version:o,os:a,osVersion:l,browserVersion:d,deviceType:h};wd={name:r,version:o,os:a,osVersion:l,browserVersion:d,deviceType:h}}var p;return wd}function B1(n){let r;return r="Blink"===n.engine.name?n.engine.version||"":n.browser.version||"",arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?r:r.split(".")[0]}function f_(){return ot().os}function j1(){const n=ot();return"".concat(n.os," ").concat(n.osVersion)}function m_(){const n=ot();return!!("WebKit"===Hs.engine.name&&n.os===pi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&n.name!==wt.SAFARI||nt()&&n.name!==wt.SAFARI)}function lh(){return ot().name===wt.CHROME}function $e(){return ot().name===wt.SAFARI}function Jb(){return ot().name===wt.EDGE}function hn(){return ot().name===wt.FIREFOX}function nt(){return ot().os===pi.IOS}function Gs(n){const r=ot();return!(r.name!==wt.CHROME||!r.osVersion)&&Number(r.version)>=n}function H1(n){const r=ot();return!(r.name!==wt.CHROME||!r.osVersion)&&Number(r.version)<n}function Qb(n){const r=ot();return!(r.name!==wt.EDGE||!r.osVersion)&&Number(r.version)>=n}function Oa(n){const r=ot();return!(r.name!==wt.SAFARI||!r.osVersion)&&Number(r.version)>=n}function Ws(n,r,o){const a=ot();if(a.os!==pi.IOS||!a.osVersion)return!1;const l=a.osVersion.split(".");return o?r&&Number(l[0])===n&&Number(l[1])<r||Number(l[0])<n:r?Number(l[0])===n&&Number(l[1])<=r||Number(l[0])<n:Number(l[0])<=n}function zs(n,r,o){const a=ot();if(a.name!==wt.SAFARI||!a.osVersion||!a.browserVersion)return!1;const l=a.browserVersion.split(".");return o?r&&Number(l[0])===n&&Number(l[1])<r||Number(l[0])<n:r?Number(l[0])===n&&Number(l[1])<=r||Number(l[0])<n:Number(l[0])<=n}function tR(n){const r=ot();return!(r.name!==wt.OPERA||!r.osVersion)&&Number(r.version)>=n}function nR(){const n=ot();if(n.os!==pi.IOS||!n.osVersion)return!1;const r=n.osVersion.split(".");return Number(r[0])<14||14===Number(r[0])&&Number(r[1])<=6}function yf(){const n=ot();if(n.os!==pi.IOS||!n.osVersion)return!1;const r=n.osVersion.split(".");return 15===Number(r[0])}function iR(){const n=ot();if(n.os!==pi.IOS||!n.osVersion)return!1;const r=n.osVersion.split(".");return 16===Number(r[0])}function G1(){const n=ot();if(n.os!==pi.IOS||!n.osVersion)return!1;const r=n.osVersion.split(".");return 15===Number(r[0])&&Number(r[1])>=1}function Ks(){return $e()&&navigator.maxTouchPoints>0}function eS(){return ot().name===wt.WECHAT}function bf(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function rR(){const n=f_();return function(){const{deviceType:r}=ot();return"mobile"===r||"tablet"===r}()||n===pi.ANDROID||n===pi.IOS||n===pi.HARMONY_OS}function hl(){const n=ot();return n.name!==wt.EDGE&&n.name!==wt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function tS(){return f_()===pi.ANDROID}function g_(){const n=ot();return tS()&&(n.name===wt.CHROME||n.name===wt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function $t(n,r,o){return(r="symbol"==typeof(l=function(d){if("object"!=typeof d||!d)return d;var p=d[Symbol.toPrimitive];if(void 0!==p){var m=p.call(d,"string");if("object"!=typeof m)return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(r))?l:l+"")in n?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,n;var l}function oR(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function Ee(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?oR(Object(o),!0).forEach(function(a){$t(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):oR(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}let k=function(n){return n.UNEXPECTED_ERROR="UNEXPECTED_ERROR",n.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",n.TIMEOUT="TIMEOUT",n.INVALID_PARAMS="INVALID_PARAMS",n.NOT_READABLE="NOT_READABLE",n.NOT_SUPPORTED="NOT_SUPPORTED",n.INVALID_OPERATION="INVALID_OPERATION",n.OPERATION_ABORTED="OPERATION_ABORTED",n.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",n.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",n.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",n.DATACHANNEL_FAILED="DATACHANNEL_FAILED",n.NETWORK_ERROR="NETWORK_ERROR",n.NETWORK_TIMEOUT="NETWORK_TIMEOUT",n.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",n.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",n.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",n.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",n.ELECTRON_IS_NULL="ELECTRON_IS_NULL",n.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",n.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",n.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",n.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",n.PERMISSION_DENIED="PERMISSION_DENIED",n.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",n.TRACK_IS_DISABLED="TRACK_IS_DISABLED",n.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",n.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",n.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",n.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",n.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",n.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",n.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",n.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",n.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",n.UID_CONFLICT="UID_CONFLICT",n.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",n.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",n.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",n.INVALID_TRACK="INVALID_TRACK",n.SENDER_NOT_FOUND="SENDER_NOT_FOUND",n.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",n.SET_ANSWER_FAILED="SET_ANSWER_FAILED",n.ICE_FAILED="ICE_FAILED",n.PC_CLOSED="PC_CLOSED",n.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",n.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",n.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",n.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",n.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",n.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",n.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",n.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",n.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",n.INVALID_REMOTE_USER="INVALID_REMOTE_USER",n.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",n.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",n.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",n.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",n.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",n.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",n.WS_ABORT="WS_ABORT",n.WS_DISCONNECT="WS_DISCONNECT",n.WS_ERR="WS_ERR",n.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",n.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",n.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",n.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",n.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",n.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",n.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",n.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",n.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",n.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",n.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",n.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",n.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",n.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",n.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",n.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",n.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",n.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",n.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",n.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",n.INVALID_PLUGIN="INVALID_PLUGIN",n.DISCONNECT_P2P="DISCONNECT_P2P",n.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",n.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",n.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",n.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",n.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",n.PROHIBITED_OPERATION="PROHIBITED_OPERATION",n.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",n.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",n}({}),Y=class extends Error{constructor(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0;super(r),$t(this,"code",void 0),$t(this,"message",void 0),$t(this,"data",void 0),$t(this,"name","AgoraRTCException"),this.code=n,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=o}toString(){return this.data?"".concat(this.message,"\ndata: ").concat(JSON.stringify(this.data)):this.message}print(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return"error"===n&&(r||console).error(this.toString()),"warning"===n&&(r||console).warn(this.toString()),this}throw(n){throw this.print("error",n),this}};function pl(n,r){if("boolean"!=typeof n)throw new Y(k.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function fi(n,r,o){if(!he(o).call(o,n))throw new Y(k.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(o)))}function Ut(n,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(n<o||n>a||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&("number"!=typeof(l=n)||l%1!=0))throw new Y(k.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(o,", ").concat(a,"]. integer only"));var l}function sR(n,r){if("number"!=typeof n){if(!(n.min||n.max||n.ideal||n.exact))throw new Y(k.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));void 0!==n.min&&Ut(n.min,"".concat(r,".min"),0,1/0),void 0!==n.max&&Ut(n.max,"".concat(r,".max"),1,1/0),void 0!==n.exact&&Ut(n.exact,"".concat(r,".exact"),1,1/0),void 0!==n.ideal&&Ut(n.ideal,"".concat(r,".ideal"),1,1/0)}else Ut(n,r,1,1/0)}function Pi(n,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==n)throw new Y(k.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!W1(n,o,a,l))throw new Y(k.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(o,",").concat(a,"].").concat(l?" ASCII characters only.":""))}function fl(n,r){if(!Array.isArray(n))throw new Y(k.INVALID_PARAMS,"".concat(r," should be an array"))}function pn(n){return null==n}function W1(n){return"string"==typeof n&&n.length<=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:255)&&n.length>=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)&&(!(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])||function(l){if("string"!=typeof l)return!1;for(let d=0;d<l.length;d+=1){const h=l.charCodeAt(d);if(h<0||h>255)return!1}return!0}(n))}var __=function(n){return n.COVERED="COVERED",n.POSITION="POSITION",n.SIZE="SIZE",n.STYLE="STYLE",n}(__||{}),aR=function(n){return n.UNMOUNTED="UNMOUNTED",n.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",n}(aR||{});const z1=new class{constructor(){$t(this,"_clientSize",null),$t(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),$t(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),$t(this,"getStyle",n=>window.getComputedStyle(n,null)),$t(this,"checkCssVisibleProperty",n=>{var r;let o=!0;const a=this.getStyle(n),{display:l,visibility:d,opacity:h,filter:p}=a;return("none"===l||he(r=["hidden","collapse"]).call(r,d)||Number(h)<.1)&&(o=!1),!!o&&(p&&p.split(" ").filter(m=>{var g;const v=m.split("(")[0];return he(g=["brightness","blur","opacity"]).call(g,v)}).map(m=>{const[g,v]=m.split(/\(|\)/);return[g,Number(v.match(/^[0-9\.]+/))]}).forEach(m=>{const[g,v]=m;switch(g){case"brightness":(v<.1||v>3)&&(o=!1);break;case"blur":v>3&&(o=!1);break;case"opacity":v<.1&&(o=!1)}}),o)}),$t(this,"checkPropertyUpToAllParentNodes",(n,r)=>{let o=!0,a=!0;let d=n;for(;d&&a;)r(d)||(o=!1,a=!1),d=d.parentElement,d||(a=!1);return o}),$t(this,"checkActualCssVisibleIncludeInherit",n=>this.checkPropertyUpToAllParentNodes(n,this.checkCssVisibleProperty)),$t(this,"getSizeAboutClient",n=>{const{width:r,height:o,left:a,right:l,top:d,bottom:h}=n.getBoundingClientRect(),p=this.getClientWidth(),m=this.getClientHeight();return{width:r,height:o,left:a,right:l,top:d,bottom:h,clientWidth:p,clientHeight:m,clientMin:Math.min(p,m)}}),$t(this,"checkActualSize",()=>{const{width:n,height:r,clientMin:o}=this._clientSize;return this.checkSizeIsVisible(n,r,o)}),$t(this,"elementFromPoint",(n,r)=>document.elementFromPoint?document.elementFromPoint(n,r):null),$t(this,"checkCoverForAPoint",(n,r,o)=>{const a=this.elementFromPoint(n,r);return null!==a&&a!==o}),$t(this,"getPointPositionList",()=>{const{width:n,height:r,left:o,top:a}=this._clientSize,l=n/6,d=r/6,h=[],p=10**6;for(let m=0;m<5;m++)for(let g=0;g<5;g++)h.push({x:(o*p+(0===m?.1:4===m?(l*m*p-1e5)/p:l*m)*p)/p,y:(a*p+(0===g?.1:4===g?(d*g*p-1e5)/p:d*g)*p)/p});return[...h]}),$t(this,"checkElementCover",n=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,n)).filter(r=>!!r).length>6),$t(this,"checkSizeIsVisible",(n,r,o)=>(n>50||o/n<=10)&&(r>50||o/r<=10)),$t(this,"checkSizeOfPartInClient",()=>{const{left:n,right:r,top:o,bottom:a,clientHeight:l,clientWidth:d,clientMin:h}=this._clientSize;let p,m,g,v;if(n<0)p=0;else{if(!(n<d))return!1;p=n}if(r<0)return!1;if(m=r<d?r:d,o<0)g=0;else{if(!(o<l))return!1;g=o}return!(a<0)&&(v=a<l?a:l,this.checkSizeIsVisible(m-p,v-g,h))}),$t(this,"returnHiddenResult",n=>(this._clientSize=null,{visible:!1,reason:n})),$t(this,"checkOneElementVisible",n=>{if(n instanceof HTMLElement){if(this.checkElementIsMountedOnDom(n)){if(this.checkActualCssVisibleIncludeInherit(n)){if(this._clientSize=this.getSizeAboutClient(n),this.checkElementCover(n))return this.returnHiddenResult(__.COVERED);{const r=this.checkActualSize(),o=this.checkSizeOfPartInClient();return r&&!o?this.returnHiddenResult(__.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(__.SIZE)}}return this.returnHiddenResult(__.STYLE)}return this.returnHiddenResult(aR.UNMOUNTED)}return this.returnHiddenResult(aR.INVALID_HTML_ELEMENT)}),$t(this,"checkElementIsMountedOnDom",n=>this.checkPropertyUpToAllParentNodes(n,r=>"HTML"!==r.nodeName.toUpperCase()?null!==r.parentElement:!!document.documentElement))}};function v_(n){return(new TextEncoder).encode(n)}const $j=function(n,r){const o=new Uint8Array(n.byteLength+r.byteLength);return o.set(new Uint8Array(n),0),o.set(new Uint8Array(r),n.byteLength),o},cR=function(){var n=L(function*(r){return function(o){let l="";return new Uint8Array(o).forEach(d=>{l+=d.toString(16).padStart(2,"0")}),l}(yield crypto.subtle.digest("SHA-256",v_(r)))});return function(o){return n.apply(this,arguments)}}();class nn{constructor(){$t(this,"_events",{}),$t(this,"addListener",this.on)}getListeners(r){return this._events[r]?this._events[r].map(o=>o.listener):[]}on(r,o){this._events[r]||(this._events[r]=[]);const a=this._events[r];-1===this._indexOfListener(a,o)&&a.push({listener:o,once:!1})}once(r,o){this._events[r]||(this._events[r]=[]);const a=this._events[r];-1===this._indexOfListener(a,o)&&a.push({listener:o,once:!0})}off(r,o){if(!this._events[r])return;const a=this._events[r],l=this._indexOfListener(a,o);-1!==l&&a.splice(l,1),0===this._events[r].length&&delete this._events[r]}removeAllListeners(r){r?delete this._events[r]:this._events={}}emit(r){this._events[r]||(this._events[r]=[]);const o=this._events[r].map(h=>h);for(var a=arguments.length,l=new Array(a>1?a-1:0),d=1;d<a;d++)l[d-1]=arguments[d];for(let h=0;h<o.length;h+=1){const p=o[h];p.once&&this.off(r,p.listener),p.listener.apply(this,l||[])}}safeEmit(r){for(var o=arguments.length,a=new Array(o>1?o-1:0),l=1;l<o;l++)a[l-1]=arguments[l];[...this._events[r]||[]].forEach(d=>{d.once&&this.off(r,d.listener);try{d.listener.apply(this,a)}catch(h){console.error("safeEmit event:".concat(r," error ").concat(h?.toString()))}})}_indexOfListener(r,o){let a=r.length;for(;a--;)if(r[a].listener===o)return a;return-1}}let Sf=null;function lR(){if(Sf)return Sf;if(window.electron)return Sf=window.electron;if(!window.require)return null;try{return Sf=window.require("electron"),Sf}catch{return null}}let Yn=function(n){return n.CREATE_CLIENT="createClient",n.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",n.SET_AREA="setArea",n.PRELOAD="PRELOAD",n.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",n.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",n.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",n.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",n.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",n.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",n.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",n.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",n.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",n.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",n.START_PROXY_SERVER="Client.startProxyServer",n.STOP_PROXY_SERVER="Client.stopProxyServer",n.SET_PROXY_SERVER="Client.setProxyServer",n.SET_TURN_SERVER="Client.setTurnServer",n.SET_CLIENT_ROLE="Client.setClientRole",n.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",n.ENABLE_DUAL_STREAM="Client.enableDualStream",n.DISABLE_DUAL_STREAM="Client.disableDualStream",n.JOIN="Client.join",n.LEAVE="Client.leave",n.PUBLISH="Client.publish",n.UNPUBLISH="Client.unpublish",n.SUBSCRIBE="Client.subscribe",n.MASS_SUBSCRIBE="Client.massSubscribe",n.MASS_UNSUBSCRIBE="Client.massUnsubscribe",n.UNSUBSCRIBE="Client.unsubscribe",n.RENEW_TOKEN="Client.renewToken",n.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",n.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",n.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",n.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",n.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",n.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",n.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",n.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",n.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",n.START_LIVE_STREAMING="Client.startLiveStreaming",n.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",n.STOP_LIVE_STREAMING="Client.stopLiveStreaming",n.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",n.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",n.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",n.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",n.SET_CONFIG_DISTRIBUTE="_configDistribute",n.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",n.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",n.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",n.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",n.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",n.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",n.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",n.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",n.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",n.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",n.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",n.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",n.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",n.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",n.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",n.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",n.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",n.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",n.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",n.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",n.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",n.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",n.STREAM_TYPE_CHANGE="streamTypeChange",n.CONNECTION_STATE_CHANGE="connectionStateChange",n.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",n.IMAGE_MODERATION_UPLOAD="imageModerationUpload",n}({}),st=function(n){return n.TRACER="tracer",n}({});function K1(n){return Ut(n.timeout,"config.timeout",0,1e5),Ut(n.timeoutFactor,"config.timeoutFactor",0,100,!1),Ut(n.maxRetryCount,"config.maxRetryConfig",0,1/0),Ut(n.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Xj=function(n){return n[n.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",n[n.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",n[n.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",n}({}),Rt=function(n){return n.LEAVE="LEAVE",n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.UID_BANNED="UID_BANNED",n.FALLBACK="FALLBACK",n.IP_BANNED="IP_BANNED",n.CHANNEL_BANNED="CHANNEL_BANNED",n.LICENSE_MISSING="LICENSE_MISSING",n.LICENSE_EXPIRED="LICENSE_EXPIRED",n.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",n.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",n.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",n.LICENSE_ILLEGAL="LICENSE_ILLEGAL",n.TOKEN_EXPIRE="TOKEN_EXPIRE",n}({});function nS(n){if(!Array.isArray(n)||n.length<1)return!1;try{n.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function dR(n){return Pi(n.turnServerURL,"turnServerURL"),Pi(n.username,"username"),Pi(n.password,"password"),n.udpport&&Ut(n.udpport,"udpport",1,99999,!0),n.forceturn&&pl(n.forceturn,"forceturn"),n.security&&pl(n.security,"security"),n.tcpport&&Ut(n.tcpport,"tcpport",1,99999,!0),!0}function Zj(n){return void 0!==n.level&&fi(n.level,"level",[1,2,3]),void 0!==n.delay&&Ut(n.delay,"delay",0,3e3,!0),!0}let Je=function(n){return n.CONNECTION_STATE_CHANGE="connection-state-change",n.MEDIA_RECONNECT_START="media-reconnect-start",n.MEDIA_RECONNECT_END="media-reconnect-end",n.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",n.USER_JOINED="user-joined",n.USER_LEAVED="user-left",n.USER_PUBLISHED="user-published",n.USER_UNPUBLISHED="user-unpublished",n.USER_INFO_UPDATED="user-info-updated",n.CLIENT_BANNED="client-banned",n.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",n.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",n.VOLUME_INDICATOR="volume-indicator",n.CRYPT_ERROR="crypt-error",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGED="stream-type-changed",n.STREAM_FALLBACK="stream-fallback",n.RECEIVE_METADATA="receive-metadata",n.STREAM_MESSAGE="stream-message",n.LIVE_STREAMING_ERROR="live-streaming-error",n.LIVE_STREAMING_WARNING="live-streaming-warning",n.EXCEPTION="exception",n.ERROR="error",n.P2P_LOST="p2p_lost",n.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",n.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",n.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",n.PUBLISHED_USER_LIST="published-user-list",n.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",n.CONTENT_INSPECT_ERROR="content-inspect-error",n.CONTENT_INSPECT_RESULT="content-inspect-result",n.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",n}({}),Hi=function(n){return n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.MULTI_IP="MULTI_IP",n.TIMEOUT="TIMEOUT",n.OFFLINE="OFFLINE",n.LEAVE="LEAVE",n.P2P_FAILED="P2P_FAILED",n.FALLBACK="FALLBACK",n}({}),co=function(n){return n.ONLINE="ONLINE",n.OFFLINE="OFFLINE",n}({}),ml=function(n){return n.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",n.ONLINE="ONLINE",n.OFFLINE="OFFLINE",n}({});function Gi(n,r){for(var o=arguments.length,a=new Array(o>2?o-2:0),l=2;l<o;l++)a[l-2]=arguments[l];return 0===n.getListeners(r).length?le.reject(new Y(k.UNEXPECTED_ERROR,"can not emit promise")):new le((d,h)=>{n.emit(r,...a,d,h)})}function jt(n,r){if(0===n.getListeners(r).length)return le.resolve();for(var o=arguments.length,a=new Array(o>2?o-2:0),l=2;l<o;l++)a[l-2]=arguments[l];return Gi(n,r,...a)}function Do(n,r){if(0===n.getListeners(r).length)return null;for(var o=arguments.length,a=new Array(o>2?o-2:0),l=2;l<o;l++)a[l-2]=arguments[l];return E_(n,r,...a)}function E_(n,r){let o=null,a=null;for(var l=arguments.length,d=new Array(l>2?l-2:0),h=2;h<l;h++)d[h-2]=arguments[h];if(n.emit(r,...d,p=>{o=p},p=>{a=p}),null!==a)throw a;if(null===o)throw new Y(k.UNEXPECTED_ERROR,"handler is not sync");return o}const Se=new class extends nn{set networkState(n){this.emit(ml.NETWORK_STATE_CHANGE,n,this._networkState),n===co.ONLINE?this.emit(ml.ONLINE):n===co.OFFLINE&&(this.onlineWaiter=new le(r=>{this.once(ml.ONLINE,()=>{this.onlineWaiter=void 0,r(co.ONLINE)})}),this.emit(ml.OFFLINE)),this._networkState=n}get networkState(){return this._networkState}get isOnline(){return this._networkState===co.ONLINE}constructor(){super(),$t(this,"_moduleName","network-indicator"),$t(this,"_networkState",co.ONLINE),$t(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=co.ONLINE}),window.addEventListener("offline",()=>{this.networkState=co.OFFLINE})}};function Be(n,r){const o=n.indexOf(r);-1!==o&&n.splice(o,1)}function At(n){const r=[];return n.forEach(o=>{-1===r.indexOf(o)&&r.push(o)}),r}function y_(n){void 0!==le?le.resolve().then(n):setTimeout(n,0)}function Vn(n){return JSON.parse(JSON.stringify(n))}function dh(n){try{return Vn(n)}catch{return n}}const q1={};function vc(n,r){q1[r]||(q1[r]=!0,n())}function gl(n){const r=window.atob(n),o=new Uint8Array(new ArrayBuffer(r.length));for(let a=0;a<r.length;a+=1)o[a]=r.charCodeAt(a);return o}function _l(n){let r="";for(let o=0;o<n.length;o+=1)r+=String.fromCharCode(n[o]);return window.btoa(r)}function uR(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,o=(new TextEncoder).encode(n);if(o.length>r)o=o.slice(0,r);else if(o.length<r){const a=new Uint8Array(r);a.set(o),o=a}return o}function Y1(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];const a=Ue(r).call(r,(h,p)=>h+p.length,0),l=new Uint8Array(new ArrayBuffer(a));let d=0;return r.forEach(h=>{l.set(h,d),d+=h.length}),l}function Ec(n){return window.TextEncoder?(new TextEncoder).encode(n).length:n.length}function yc(n){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&n.realFormData&&(n=n.realFormData),n.forEach(o=>{r+="string"==typeof o?Ec(o):o.size}),r+138}function b_(n){const r=new Y(k.TIMEOUT,"timeout");return new le((o,a)=>{window.setTimeout(()=>a(r),n)})}function Ii(n){return new le(r=>{window.setTimeout(r,n)})}function Ct(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const o=Math.random().toString(16).substr(2,n).toLowerCase();return o.length===n?"".concat(r).concat(o):"".concat(r).concat(o)+Ct(n-o.length,"")}function Cf(){return Ct(32,"").toUpperCase()}const iS=()=>{},uh=new class{constructor(){$t(this,"fnMap",new Map)}throttleByKey(n,r,o,a){for(var l=arguments.length,d=new Array(l>4?l-4:0),h=4;h<l;h++)d[h-4]=arguments[h];if(this.fnMap.has(r)){const p=this.fnMap.get(r);if(p.threshold!==o){p.fn(...p.args),clearTimeout(p.timer);const m=window.setTimeout(()=>{const g=this.fnMap.get(r);g&&g.fn(...g.args),this.fnMap.delete(r)},o);this.fnMap.set(r,{fn:n,threshold:o,timer:m,args:d,skipFn:a})}else p.skipFn&&p.skipFn(...p.args),this.fnMap.set(r,Ee(Ee({},p),{},{fn:n,args:d,skipFn:a}))}else{const p=window.setTimeout(()=>{const m=this.fnMap.get(r);m&&m.fn(...m.args),this.fnMap.delete(r)},o);this.fnMap.set(r,{fn:n,threshold:o,timer:p,args:d,skipFn:a})}}},Jj=uh.throttleByKey.bind(uh);function lo(n){return"object"==typeof n&&null!==n&&!(n instanceof RegExp)}function $1(n,r){if(!lo(n)||!lo(r)||Array.isArray(n)&&!Array.isArray(r)||!Array.isArray(n)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(n)){const o=[...n];for(let a=0;a<r.length;a++)o[a]=$1(n[a],r[a]);return o}{const o=Ee({},n);for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&(o[a]=Object.prototype.hasOwnProperty.call(n,a)?$1(n[a],r[a]):r[a]);return o}}function hR(n,r){let o=[0];if(r&&(o=new Array(r).fill(0)),0===n)return o;let a=0;for(;n>0&&(o[a]=255&n,n>>=8,a++,!r||a!==r););return o}function rS(n){return"number"==typeof n?n:n.exact||n.ideal||n.max||n.min||0}function Qj(n){const r="0123456789abcdef";function o(x){let j,W="";for(j=0;j<=3;j++)W+=r.charAt(x>>8*j+4&15)+r.charAt(x>>8*j&15);return W}function a(x,j){const W=(65535&x)+(65535&j);return(x>>16)+(j>>16)+(W>>16)<<16|65535&W}function l(x,j,W,q,ee,J){return a((X=a(a(j,x),a(q,J)))<<(Ce=ee)|X>>>32-Ce,W);var X,Ce}function d(x,j,W,q,ee,J,X){return l(j&W|~j&q,x,j,ee,J,X)}function h(x,j,W,q,ee,J,X){return l(j&q|W&~q,x,j,ee,J,X)}function p(x,j,W,q,ee,J,X){return l(j^W^q,x,j,ee,J,X)}function m(x,j,W,q,ee,J,X){return l(W^(j|~q),x,j,ee,J,X)}const g=function(x){let j;const W=1+(x.length+8>>6),q=new Array(16*W);for(j=0;j<16*W;j++)q[j]=0;for(j=0;j<x.length;j++)q[j>>2]|=x.charCodeAt(j)<<j%4*8;return q[j>>2]|=128<<j%4*8,q[16*W-2]=8*x.length,q}(n);let v,y,b,C,N,R=1732584193,A=-271733879,D=-1732584194,M=271733878;for(v=0;v<g.length;v+=16)y=R,b=A,C=D,N=M,R=d(R,A,D,M,g[v+0],7,-680876936),M=d(M,R,A,D,g[v+1],12,-389564586),D=d(D,M,R,A,g[v+2],17,606105819),A=d(A,D,M,R,g[v+3],22,-1044525330),R=d(R,A,D,M,g[v+4],7,-176418897),M=d(M,R,A,D,g[v+5],12,1200080426),D=d(D,M,R,A,g[v+6],17,-1473231341),A=d(A,D,M,R,g[v+7],22,-45705983),R=d(R,A,D,M,g[v+8],7,1770035416),M=d(M,R,A,D,g[v+9],12,-1958414417),D=d(D,M,R,A,g[v+10],17,-42063),A=d(A,D,M,R,g[v+11],22,-1990404162),R=d(R,A,D,M,g[v+12],7,1804603682),M=d(M,R,A,D,g[v+13],12,-40341101),D=d(D,M,R,A,g[v+14],17,-1502002290),A=d(A,D,M,R,g[v+15],22,1236535329),R=h(R,A,D,M,g[v+1],5,-165796510),M=h(M,R,A,D,g[v+6],9,-1069501632),D=h(D,M,R,A,g[v+11],14,643717713),A=h(A,D,M,R,g[v+0],20,-373897302),R=h(R,A,D,M,g[v+5],5,-701558691),M=h(M,R,A,D,g[v+10],9,38016083),D=h(D,M,R,A,g[v+15],14,-660478335),A=h(A,D,M,R,g[v+4],20,-405537848),R=h(R,A,D,M,g[v+9],5,568446438),M=h(M,R,A,D,g[v+14],9,-1019803690),D=h(D,M,R,A,g[v+3],14,-187363961),A=h(A,D,M,R,g[v+8],20,1163531501),R=h(R,A,D,M,g[v+13],5,-1444681467),M=h(M,R,A,D,g[v+2],9,-51403784),D=h(D,M,R,A,g[v+7],14,1735328473),A=h(A,D,M,R,g[v+12],20,-1926607734),R=p(R,A,D,M,g[v+5],4,-378558),M=p(M,R,A,D,g[v+8],11,-2022574463),D=p(D,M,R,A,g[v+11],16,1839030562),A=p(A,D,M,R,g[v+14],23,-35309556),R=p(R,A,D,M,g[v+1],4,-1530992060),M=p(M,R,A,D,g[v+4],11,1272893353),D=p(D,M,R,A,g[v+7],16,-155497632),A=p(A,D,M,R,g[v+10],23,-1094730640),R=p(R,A,D,M,g[v+13],4,681279174),M=p(M,R,A,D,g[v+0],11,-358537222),D=p(D,M,R,A,g[v+3],16,-722521979),A=p(A,D,M,R,g[v+6],23,76029189),R=p(R,A,D,M,g[v+9],4,-640364487),M=p(M,R,A,D,g[v+12],11,-421815835),D=p(D,M,R,A,g[v+15],16,530742520),A=p(A,D,M,R,g[v+2],23,-995338651),R=m(R,A,D,M,g[v+0],6,-198630844),M=m(M,R,A,D,g[v+7],10,1126891415),D=m(D,M,R,A,g[v+14],15,-1416354905),A=m(A,D,M,R,g[v+5],21,-57434055),R=m(R,A,D,M,g[v+12],6,1700485571),M=m(M,R,A,D,g[v+3],10,-1894986606),D=m(D,M,R,A,g[v+10],15,-1051523),A=m(A,D,M,R,g[v+1],21,-2054922799),R=m(R,A,D,M,g[v+8],6,1873313359),M=m(M,R,A,D,g[v+15],10,-30611744),D=m(D,M,R,A,g[v+6],15,-1560198380),A=m(A,D,M,R,g[v+13],21,1309151649),R=m(R,A,D,M,g[v+4],6,-145523070),M=m(M,R,A,D,g[v+11],10,-1120210379),D=m(D,M,R,A,g[v+2],15,718787259),A=m(A,D,M,R,g[v+9],21,-343485551),R=a(R,y),A=a(A,b),D=a(D,C),M=a(M,N);return o(R)+o(A)+o(D)+o(M)}let mi=1,X1=console,Qi=class{static setLogger(n){X1=n}constructor(n,r){$t(this,"id",void 0),$t(this,"lockingPromise",le.resolve()),$t(this,"locks",0),$t(this,"name",""),$t(this,"lockId",void 0),this.lockId=mi++,n&&(this.name=n),r&&(this.id=r),this.logger("created")}logger(n,r){const o=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),a="created"===n?"is ".concat(n,"."):"is ".concat(n,", current queue ").concat(this.locks,". ").concat(r??"");X1.debug("".concat(o," ").concat(a))}setId(n){this.id=n}get isLocked(){return this.locks>0}lock(n){let r;this.locks+=1,this.logger("locked",n);const o=new le(l=>{r=()=>{this.locks-=1,this.logger("unlocked",n),l()}}),a=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>o),a}};function Tf(n,r){return function(o,a,l){const d=l.value;if("function"!=typeof d)throw new Error("Cannot use mutex on object property.");return l.value=L(function*(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(n));const p=yield h.lock("From ".concat(n,".").concat(a));try{for(var m=arguments.length,g=new Array(m),v=0;v<m;v++)g[v]=arguments[v];return yield d.apply(this,g)}finally{p()}}),l}}const Nn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function pR(n,r){const o=Math.floor(r.timeout*Math.pow(r.timeoutFactor,n));return Math.min(r.maxRetryTimeout,o)}function rs(n,r,o,a){const l=Object.assign({},Nn,a);let d=l.timeout;const h=function(){var g=L(function*(){var v;yield(v=d,new le(y=>{window.setTimeout(y,v)})),d*=l.timeoutFactor,d=Math.min(l.maxRetryTimeout,d)});return function(){return g.apply(this,arguments)}}();let p=!1;const m=new le(function(){var g=L(function*(v,y){r=r||(()=>!1),o=o||(()=>!0);for(let b=0;b<l.maxRetryCount;b+=1){if(p)return y(new Y(k.OPERATION_ABORTED));try{const C=yield n();if(!r(C,b)||b+1===l.maxRetryCount)return v(C);yield h()}catch(C){if(!o(C,b)||b+1===l.maxRetryCount)return y(C);yield h()}}});return function(v,y){return g.apply(this,arguments)}}());return m.cancel=()=>p=!0,m}class S_{constructor(r){$t(this,"input",[]),$t(this,"size",void 0),this.size=r}add(r){this.input.push(r),this.input.length>this.size&&this.input.splice(0,1)}mean(){var r;return 0===this.input.length?0:Ue(r=this.input).call(r,(o,a)=>o+a)/this.input.length}}let Hr,C_=0,fR=0;function mR(n,r,o,a){return new le((l,d)=>{r.responseType=r.responseType||"json",r.data&&!o?(r.data=JSON.stringify(r.data),C_+=Ec(r.data)):o&&(r.data.size?C_+=r.data.size:r.data instanceof FormData?C_+=yc(r.data):C_+=Ec(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=n,Nr.request(r).then(h=>{"string"==typeof h.data?fR+=Ec(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?fR+=h.data.byteLength:fR+=Ec(JSON.stringify(h.data)),a&&l({data:h.data,headers:h.headers}),l(h.data)}).catch(h=>{Nr.isCancel(h)?d(new Y(k.OPERATION_ABORTED,"cancel token canceled")):d("ECONNABORTED"===h.code?new Y(k.NETWORK_TIMEOUT,h.message):h.response?new Y(k.NETWORK_RESPONSE_ERROR,h.response.status):new Y(k.NETWORK_ERROR,h.message))})})}function T_(n,r){return hh.apply(this,arguments)}function hh(){return hh=L(function*(n,r){const o=new Blob([r.data],{type:"buffer"});return yield mR(n,Ee(Ee({},r),{},{data:o,headers:{"Content-Type":"application/octet-stream"}}),!0)}),hh.apply(this,arguments)}const Z1=()=>void 0!==window.isSecureContext,Ss=function(n){if(n.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return n;const r=n.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const a=r[2];return"".concat(r[1],".").concat(a)}return"4.0.0.999"}("4.22.2"),oS=function(){try{return!0===JSON.parse("true")}catch{return!0}}();let Na=function(n){return n.Default="default",n.Auto="auto",n.Relay="relay",n.SdRtn="sd-rtn",n}({});const Wi=function(){const n="us".concat("erna","me"),r="pa".concat("sswo","rd"),o=["t","s","t"];o.splice(1,0,"e");const a=o.join(""),l=[];for(let p=0;p<6;p++)l.push("1");const d=l.join(""),h={};return h[n]=a,h[r]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Wi;const gR={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},_R="v4.22.2-0-g4caa29bb(10/28/2024, 2:37:34 PM)",Pn=Ee(Ee({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:gR,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0,DISABLE_SCREEN_SHARE_REMB:!1},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"]});function Lt(n,r,o){var a,l,d;he(a=Object.keys(Pn)).call(a,n)&&(!o&&he(l=Object.keys(Rd)).call(l,n)||(Pn[n]=r,"ENABLE_VIDEO_SEI"===n&&!0===r&&(Pn.ENABLE_ENCODED_TRANSFORM=!0),"USE_NEW_NETWORK_CONFIG"===n&&r&&(Pn.USE_NEW_NETWORK_CONFIG=d=!!r,d&&(Pn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Pn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Pn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Pn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Pn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Pn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Pn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),"ENABLE_PRE_SUB"===n&&r&&(Pn.ENABLE_INSTANT_VIDEO=!0,Pn.ENABLE_PREALLOC_PC=!0),"ENABLE_SVC"===n&&r&&(Pn.ENABLE_AUT_CC=!0)))}function V(n){return Pn[n]}oS||(Pn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Pn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Pn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Pn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Pn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Pn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Pn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Pn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Pn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Pn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Pn.AREAS=["NORTH_AMERICA","OVERSEA"]);const Rd={};var Ke=function(n){return n.SET_SESSION_ID="SET_SESSION_ID",n.SET_P2P_ID="SET_P2P_id",n.SET_DC_ID="SET_DC_id",n.SET_UID="SET_UID",n.SET_INT_UID="SET_INT_UID",n.SET_PUB_ID="SET_PUB_ID",n.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",n.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",n.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",n.AVOID_JOIN_START="AVOID_JOIN_START",n.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",n.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",n.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",n.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",n.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",n.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",n.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",n.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",n.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",n.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",n.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",n.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",n.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",n.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",n.RESET_KEY_METRICS="RESET_KEY_METRICS",n.SET_USE_P2P="SET_USE_P2P",n.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",n}(Ke||{});class e4{constructor(r,o,a,l){$t(this,"state",void 0),this.state={codec:r,audioCodec:o,mode:a,clientId:l,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Na.Default}}dispatch(r){this.state=function(o,a){switch(a.type){case Ke.SET_SESSION_ID:return Ee(Ee({},o),{},{sessionId:a.sessionId});case Ke.SET_P2P_ID:return Ee(Ee({},o),{},{p2pId:a.p2pId});case Ke.SET_UID:return Ee(Ee({},o),{},{uid:a.uid});case Ke.SET_INT_UID:return Ee(Ee({},o),{},{intUid:a.intUid});case Ke.SET_PUB_ID:return Ee(Ee({},o),{},{pubId:a.pubId});case Ke.KEY_METRIC_CLIENT_CREATED:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{clientCreated:a.metric})});case Ke.KEY_METRIC_JOIN_START:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{joinStart:a.metric})});case Ke.AVOID_JOIN_START:return Ee(Ee({},o),{},{avoidJoinStart:a.avoidJoinStart});case Ke.KEY_METRIC_JOIN_END:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{joinEnd:a.metric})});case Ke.KEY_METRIC_REQUEST_AP_START:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{requestAPStart:a.metric})});case Ke.KEY_METRIC_REQUEST_AP_END:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{requestAPEnd:a.metric})});case Ke.KEY_METRIC_JOIN_GATEWAY_START:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{joinGatewayStart:a.metric})});case Ke.KEY_METRIC_JOIN_GATEWAY_END:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{joinGatewayEnd:a.metric})});case Ke.KEY_METRIC_PEER_CONNECTION_START:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{peerConnectionStart:a.metric})});case Ke.KEY_METRIC_PEER_CONNECTION_END:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{peerConnectionEnd:a.metric})});case Ke.KEY_METRIC_DESCRIPTION_START:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{descriptionStart:a.metric})});case Ke.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{signalChannelOpen:a.metric})});case Ke.KEY_METRIC_ICE_CONNECTION_END:return Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{iceConnectionEnd:a.metric})});case Ke.KEY_METRIC_PUBLISH:{const l=o.keyMetrics.publish,d=l.findIndex(h=>h.trackId===a.metric.trackId);return-1!==d?(l[d]=Ee(Ee({},l[d]),a.metric),Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{publish:[...l]})})):Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{publish:[...o.keyMetrics.publish,a.metric]})})}case Ke.KEY_METRIC_SUBSCRIBE:{const l=o.keyMetrics.subscribe,d=l.findIndex(h=>h.userId===a.metric.userId&&h.type===a.metric.type);return-1!==d?(l[d]=Ee(Ee({},l[d]),a.metric),Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{subscribe:[...l]})})):Ee(Ee({},o),{},{keyMetrics:Ee(Ee({},o.keyMetrics),{},{subscribe:[...o.keyMetrics.subscribe,a.metric]})})}case Ke.SET_CLOUD_PROXY_SERVER_MODE:return o.cloudProxyServerMode=a.mode,o;case Ke.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof a.index?o.joinChannelServiceRecords=[...o.joinChannelServiceRecords,a.record]:(o.joinChannelServiceRecords[a.index]=Ee(Ee({},o.joinChannelServiceRecords[a.index]),a.record),o.joinChannelServiceRecords=[...o.joinChannelServiceRecords]),o;case Ke.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return o.joinChannelServiceRecords=[],o;case Ke.RESET_KEY_METRICS:return o.keyMetrics={publish:[],subscribe:[]},o;case Ke.SET_USE_P2P:return Ee(Ee({},o),{},{useP2P:a.val});case Ke.SET_TRANSPORT_TYPE:return Ee(Ee({},o),{},{p2pTransport:a.val});default:return o}}(this.state,r)}set sessionId(r){this.dispatch({type:Ke.SET_SESSION_ID,sessionId:r})}get sessionId(){return this.state.sessionId}set codec(r){this.state.codec=r}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(r){this.dispatch({type:Ke.SET_P2P_ID,p2pId:r})}get p2pId(){return this.state.p2pId}set dcId(r){this.dispatch({type:Ke.SET_DC_ID,dcId:r})}get dcId(){return this.state.dcId}set uid(r){this.dispatch({type:Ke.SET_UID,uid:r})}get uid(){return this.state.uid}set intUid(r){this.dispatch({type:Ke.SET_INT_UID,intUid:r})}get intUid(){return this.state.intUid}set pubId(r){this.dispatch({type:Ke.SET_PUB_ID,pubId:r})}get pubId(){return this.state.pubId}set cloudProxyServerMode(r){this.dispatch({type:Ke.SET_CLOUD_PROXY_SERVER_MODE,mode:r})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(r){this.dispatch({type:Ke.SET_USE_P2P,val:r})}get useP2P(){return this.state.useP2P}set p2pTransport(r){this.dispatch({type:Ke.SET_TRANSPORT_TYPE,val:r})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:Ke.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Ke.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Ke.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Ke.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Ke.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Ke.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Ke.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Ke.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Ke.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Ke.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Ke.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Ke.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(r,o,a,l){this.dispatch({type:Ke.KEY_METRIC_PUBLISH,metric:Ee(Ee({trackId:r,type:o},a&&{publishStart:a}),l&&{publishEnd:l})})}subscribe(r,o,a,l,d,h,p){this.dispatch({type:Ke.KEY_METRIC_SUBSCRIBE,metric:Ee(Ee(Ee(Ee(Ee({userId:r,type:o},a&&{subscribeStart:a}),l&&{subscribeEnd:l}),d&&{firstFrame:d}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(r,o,a,l){r.forEach(d=>{this.dispatch({type:Ke.KEY_METRIC_SUBSCRIBE,metric:Ee(Ee(Ee({userId:d.userId,type:d.type},o&&{subscribeStart:o}),a&&{subscribeEnd:a}),l&&{firstFrame:l})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(r,o){"gateway"===r.service&&Array.isArray(r.urls)&&(r.urls=r.urls.map(a=>a.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof o?(this.dispatch({type:Ke.RECORD_JOIN_CHANNEL_SERVICE,record:Ee(Ee({},r),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(o<0||o>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Ke.RECORD_JOIN_CHANNEL_SERVICE,record:r,index:o}),o)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Ke.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Ke.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(r){this.dispatch({type:Ke.AVOID_JOIN_START,avoidJoinStart:r})}}let vR=function(n){return n.h264="h264",n.h265="h265",n.vp8="vp8",n.vp9="vp9",n.av1="av1",n}({});!function(n){n.opus="opus",n.pcma="pcma",n.pcmu="pcmu",n.g722="g722"}({});let sS=0;function bn(n,r,o){return(r="symbol"==typeof(l=function(d){if("object"!=typeof d||!d)return d;var p=d[Symbol.toPrimitive];if(void 0!==p){var m=p.call(d,"string");if("object"!=typeof m)return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(r))?l:l+"")in n?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,n;var l}function J1(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function je(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?J1(Object(o),!0).forEach(function(a){bn(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):J1(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}const If=new class extends nn{constructor(){super(...arguments),bn(this,"currentUploadLogID",0)}reportLogUploadError(n){const{errorRange:r}=n;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",n))}};class i4{constructor(r){bn(this,"logger",void 0),bn(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];this.logger.debug(...this.prefixLists,...o)}info(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];this.logger.info(...this.prefixLists,...o)}warning(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];this.logger.warning(...this.prefixLists,...o)}error(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];this.logger.error(...this.prefixLists,...o)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function ER(){const n=new Date;return n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}function Q1(){const n=new Date,r=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return r?r?.[0]+":"+n.getUTCMilliseconds():n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}const Cs={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},yR=Date.now(),I_=n=>{for(const r in Cs)if(Object.prototype.hasOwnProperty.call(Cs,r)&&Cs[r]===n)return r;return"DEFAULT"},T=new class{constructor(){bn(this,"proxyServerURL",void 0),bn(this,"logLevel",Cs.DEBUG),bn(this,"uploadState","collecting"),bn(this,"uploadLogWaitingList",[]),bn(this,"uploadLogUploadingList",[]),bn(this,"uploadErrorCount",0),bn(this,"currentLogID",0),bn(this,"url",void 0),bn(this,"extLog",(n,r)=>{this.appendLogToWaitingList(n,...r)})}debug(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];const a=[Cs.DEBUG].concat(r);this.log.apply(this,a)}info(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];const a=[Cs.INFO].concat(r);this.log.apply(this,a)}warning(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];const a=[Cs.WARNING].concat(r);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];const a=[Cs.ERROR].concat(r);this.log.apply(this,a)}upload(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];const a=[Cs.DEBUG].concat(r);this.uploadLog.apply(this,a)}setLogLevel(n){n=Math.min(Math.max(0,n),4),this.logLevel=n}enableLogUpload(){Lt("UPLOAD_LOG",!0)}disableLogUpload(){Lt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(n){this.proxyServerURL=n}prefix(n){return new i4(this).prefix(n)}log(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];if(Date.now()-yR<100)return void setTimeout(()=>{this.log(...r)},Date.now()-yR);const a=Math.max(0,Math.min(4,r[0]));if(r[0]=ER()+" Agora-SDK [".concat(I_(a),"]:"),this.appendLogToWaitingList(a,...r),a<this.logLevel)return;const l=ER()+" %cAgora-SDK [".concat(I_(a),"]:");let d=[];if(!V("USE_NEW_LOG"))switch(a){case Cs.DEBUG:d=[l,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,d);break;case Cs.INFO:d=[l,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,d);break;case Cs.WARNING:d=[l,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,d);break;case Cs.ERROR:d=[l,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];if(Date.now()-yR<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-yR);const a=Math.max(0,Math.min(4,r[0]));r[0]=ER()+" Agora-SDK [".concat(I_(a),"]:"),this.appendLogToWaitingList(a,...r)}appendLogToWaitingList(n){if(!V("UPLOAD_LOG"))return;for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];Array.isArray(o[0])?o[0][0]=Q1()+" Agora-SDK [".concat(I_(n),"]:"):o[0]=Q1()+" Agora-SDK [".concat(I_(n),"]:");let l="";o.forEach(d=>{"object"==typeof d&&(d=JSON.stringify(d)),l+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:l,log_level:n,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}uploadLogs(){var n=this;return L(function*(){const r=n.uploadLogUploadingList,o={sdk_version:Ss,process_id:V("PROCESS_ID"),payload:JSON.stringify(r)};return rs(L(function*(){const a=yield Nr.post(n.url||(n.proxyServerURL?"https://".concat(n.proxyServerURL,"/ls/?h=").concat(V("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(V("LOG_UPLOAD_SERVER"),"/upload/v1")),o,{responseType:"text"});if("OK"!==a.data){const l=new Error("unexpected upload log response");throw l.response=a,l}}),()=>(n.uploadLogUploadingList=[],!1),a=>{const l={status:-1,message:a.message,errorRange:r.map(d=>d.log_item_id)};return a.response?(l.status=a.response.status,l.data=a.response.data,l.headers=a.response.headers):a.request&&(l.status=a.request.status),If.reportLogUploadError(l),!0},{timeout:V("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:V("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})})()}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,V("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_INTERVAL"))}).catch(n=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),V("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var eL;function r4(n){return Pi(n.reportId,"params.reportId",0,100,!1),Pi(n.category,"params.category",0,100,!1),Pi(n.event,"params.event",0,100,!1),Pi(n.label,"params.label",0,100,!1),Ut(n.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(eL={}).FREE="free",eL.UPLOADING="uploading",function(n){n[n.MISC=0]="MISC",n[n.INTERNAL_EVENT=1]="INTERNAL_EVENT",n[n.PUBLIC_EVENT=2]="PUBLIC_EVENT",n[n.WEB_EVENT=3]="WEB_EVENT",n[n.INTERNAL_API=4]="INTERNAL_API",n[n.WEB_API=5]="WEB_API",n[n.PUBLIC_API=6]="PUBLIC_API"}({});const w_={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Mi=function(n){return n.PUBLISH="publish",n.SUBSCRIBE="subscribe",n.WS_COMPRESSOR_INIT="ws_compressor_init",n.SESSION_INIT="session_init",n.JOIN_CHOOSE_SERVER="join_choose_server",n.REQ_USER_ACCOUNT="req_user_account",n.JOIN_GATEWAY="join_gateway",n.REJOIN_GATEWAY="rejoin_gateway",n.STREAM_SWITCH="stream_switch",n.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",n.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",n.FIRST_VIDEO_RECEIVED="first_video_received",n.FIRST_AUDIO_RECEIVED="first_audio_received",n.FIRST_VIDEO_DECODE="first_video_decode",n.FIRST_AUDIO_DECODE="first_audio_decode",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_UPDATE_STREAM="on_update_stream",n.ON_REMOVE_STREAM="on_remove_stream",n.USER_ANALYTICS="req_user_analytics",n.PC_STATS="pc_stats",n.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",n}({}),sn=function(n){return n.SESSION="io.agora.pb.Wrtc.Session",n.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",n.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",n.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",n.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",n.PUBLISH="io.agora.pb.Wrtc.Publish",n.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",n.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",n.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",n.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",n.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",n.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",n.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",n.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",n.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",n.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",n.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",n.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",n.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",n.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",n.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",n.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",n.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",n.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",n.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",n.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",n.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",n.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",n.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",n.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",n.PC_STATS="io.agora.pb.Wrtc.PCStats",n.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",n}({});!function(n){n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}({});let tL=function(n){return n[n.SESSION=26]="SESSION",n[n.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",n[n.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",n[n.JOIN_GATEWAY=28]="JOIN_GATEWAY",n[n.PUBLISH=30]="PUBLISH",n[n.SUBSCRIBE=29]="SUBSCRIBE",n[n.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",n[n.STREAM_SWITCH=32]="STREAM_SWITCH",n[n.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",n[n.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",n[n.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",n[n.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",n[n.API_INVOKE=41]="API_INVOKE",n[n.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",n[n.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",n[n.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",n[n.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",n[n.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",n[n.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",n[n.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",n[n.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",n[n.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",n[n.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",n[n.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",n[n.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",n[n.USER_ANALYTICS=1e4]="USER_ANALYTICS",n[n.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",n}({});function Ae(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(r,o,a){const l=a.value;if("function"==typeof l){const d=n.className||r.__className__||("AgoraRTCClient"===r.constructor.name?"Client":r.constructor.name);a.value=function(){for(var h,p=arguments.length,m=new Array(p),g=0;g<p;g++)m[g]=arguments[g];let v=m;if(n.argsMap)try{v=n.argsMap(this,...m)}catch(b){T.warning(b),v=[]}try{JSON.stringify(v)}catch{T.warning("arguments for method ".concat(d,".").concat(String(o)," not serializable for apiInvoke.")),v=[]}const y=(n.report||be).reportApiInvoke(this._sessionId||null,{id:this._clientId||(null===(h=this.store)||void 0===h?void 0:h.clientId)||this._ID,name:"".concat(d,".").concat(String(o)),options:v,tag:st.TRACER,reportResult:n.reportResult},n.throttleTime);try{const b=l.apply(this,m);return b instanceof le?b.then(C=>(y.onSuccess(n.reportResult&&C),C)).catch(C=>{throw y.onError(C),C}):(y.onSuccess(n.reportResult&&b),b)}catch(b){throw y.onError(b),b}}}return a}}const be=new class{constructor(){var n=this;bn(this,"baseInfoMap",new Map),bn(this,"proxyServer",void 0),bn(this,"eventUploadTimer",void 0),bn(this,"setSessionIdTimer",void 0),bn(this,"url",void 0),bn(this,"sids",new Set),bn(this,"backupUrl",void 0),bn(this,"_appId",void 0),bn(this,"keyEventUploadPendingItems",[]),bn(this,"normalEventUploadPendingItems",[]),bn(this,"apiInvokeUploadPendingItems",[]),bn(this,"apiInvokeCount",0),bn(this,"apiInvokeLoggedCount",0),bn(this,"ltsList",[]),bn(this,"lastSendNormalEventTime",Date.now()),bn(this,"customReportCounterTimer",void 0),bn(this,"customReportCount",0),bn(this,"extApiInvoke",function(){var r=L(function*(o){for(const a of o){const l=je(je({},a),{},{sid:null,invokeId:++n.apiInvokeCount,tag:st.TRACER});n.sendApiInvoke(l)}});return function(o){return r.apply(this,arguments)}}()),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),V("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),V("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(n){return this.baseInfoMap.get(n)}setAppId(n){this._appId=n}reportApiInvoke(n,r,o){r.timeout=r.timeout||6e4,r.reportResult=void 0===r.reportResult||r.reportResult;const a=Date.now();this.apiInvokeCount+=1;const l=this.apiInvokeCount,d=!!V("SHOW_REPORT_INVOKER_LOG"),h=!!V("SHOW_REPORT_USER_INVOKER_LOG"),p=d||h&&r.id;p&&(this.apiInvokeLoggedCount+=1);const m=this.apiInvokeLoggedCount;function g(C,N){if(p){let R="[apiInvoke-".concat(m,"]");r.id&&(R+="[".concat(r.id,"]")),r.name&&(R+="[".concat(r.name,"]")),T.info("".concat(R," ").concat(C),"start"===C?r.options:N||"")}}const v=()=>({tag:r.tag,invokeId:l,sid:n,name:r.name,apiInvokeTime:a,options:r.options,states:r.states||null});g("start");let y=!1;Ii(r.timeout).then(()=>{y||(this.sendApiInvoke(je(je({},v()),{},{error:k.API_INVOKE_TIMEOUT,success:!1})),g("timeout"))});const b=new Y(k.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:C=>{const N=()=>{if(y)throw b;return y=!0,this.sendApiInvoke(je(je({},v()),{},{success:!0},r.reportResult&&{result:C})),g("onSuccess"),C};return o?Jj(N,r.name+"Success",o,()=>y=!0):N()},onError:C=>{const N=()=>{if(y)throw C;y=!0,this.sendApiInvoke(je(je({},v()),{},{success:!1,error:C})),g("onFailure",C.toString())};return o?Jj(N,r.name+"Error",o,()=>y=!0):N()}}}sessionInit(n,r){if(this.baseInfoMap.has(n))return;const o=Date.now(),a=this.createBaseInfo(n,o);a.cname=r.cname;const l=Object.assign({},{willUploadConsoleLog:V("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:oS?"global":"oversea",areas:V("AREAS")&&V("AREAS").join(",")},r.extend),{stringUid:d,channelProfile:h,channelMode:p,isABTestSuccess:m,lsid:g,clientRole:v}=r,y=Date.now(),b=je(je({},a),{},{eventType:Mi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:_R,lts:y,elapse:y-o,extend:JSON.stringify(l),mode:r.mode,process:V("PROCESS_ID"),appType:V("APP_TYPE"),success:!0,version:Ss,stringUid:d,channelProfile:h,channelMode:p,isABTestSuccess:m,lsid:g,clientType:he(C=window.navigator.userAgent).call(C,"AgoraWebView")?42:20,clientRole:v,serviceId:V("PROCESS_ID"),extensionID:V("PLUGIN_INFO").join(",")||""});var C;this.send({type:sn.SESSION,data:b},!0)}joinChooseServer(n,r){const o=this.baseInfoMap.get(n);if(!o)return;const a=o.info,l=Date.now(),d=je(je({},a),{},{eventType:Mi.JOIN_CHOOSE_SERVER,lts:l,eventElapse:r.elapse||l-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:l-o.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:sn.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(n,r){const o=this.baseInfoMap.get(n);if(!o)return;const a=o.info,l=Date.now(),d=je(je({},a),{},{eventType:Mi.REQ_USER_ACCOUNT,lts:l,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||l-o.startTime,eventElapse:l-r.lts,extend:JSON.stringify(r.extend)});this.send({type:sn.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(n,r){const o=this.baseInfoMap.get(n);if(!o)return;const a=o.info;r.vid&&(a.vid=r.vid),a.uid=r.uid,a.cid=r.cid;const l=Date.now(),{firstSuccess:d,avoidJoinStartTime:h}=r,p=l-(d&&h?h:o.startTime),m=je(je({},a),{},{eventType:Mi.JOIN_GATEWAY,lts:l,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:p,eventElapse:l-r.lts,firstSuccess:d,signalChannel:r.signalChannel,preload:r.preload?1:0});r.succ&&(o.lastJoinSuccessTime=l),this.send({type:sn.JOIN_GATEWAY,data:m},!0)}joinChannelTimeout(n,r){const o=this.baseInfoMap.get(n);if(!o)return;const a=Date.now(),l=je(je({},o.info),{},{lts:a,timeout:r,elapse:a-o.startTime});this.send({type:sn.JOIN_CHANNEL_TIMEOUT,data:l},!0)}publish(n,r){const o=this.baseInfoMap.get(n);if(!o)return;const a=o.info,l=Date.now(),d=je(je({},a),{},{eventType:Mi.PUBLISH,lts:l,eventElapse:r.eventElapse,elapse:l-o.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:sn.PUBLISH,data:d},!0)}subscribe(n,r,o){const a=this.baseInfoMap.get(n);if(!a)return;const l=a.info,d=Date.now(),h=je(je({},l),{},{eventType:Mi.SUBSCRIBE,lts:d,eventElapse:r.eventElapse,elapse:d-a.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},o&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof r.peerid?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:sn.SUBSCRIBE,data:h},!0)}wsCompressorInit(n){var r;const o=[...wo(r=this.baseInfoMap).call(r)],l=this.baseInfoMap.get(o.length?o[0]:"UnableToGetSid");if(!l)return;const d=l.info,h=Date.now(),p=je(je({},d),{},{eventType:Mi.WS_COMPRESSOR_INIT,lts:h,eventElapse:n.eventElapse,elapse:h-l.startTime,status:n.status?1:2});this.send({type:sn.WS_COMPRESSOR_INIT,data:p},!0)}firstRemoteVideoDecode(n,r,o,a){const l=this.baseInfoMap.get(n);if(!l)return;const d=l.info,h=Date.now(),p=je(je(je({},d),a),{},{elapse:h-l.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((a.firstFrame||h)-l.startTime,0),apEnd:Math.max(a.apEnd-l.startTime,0),apStart:Math.max(a.apStart-l.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-l.startTime,0),joinGwStart:Math.max(a.joinGwStart-l.startTime,0),pcEnd:Math.max(a.pcEnd-l.startTime,0),pcStart:Math.max(a.pcStart-l.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-l.startTime,0),subscriberStart:Math.max(a.subscriberStart-l.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-l.startTime,0)});this.send({type:o,data:p},!0)}firstRemoteFrame(n,r,o,a){const l=this.baseInfoMap.get(n);if(!l)return;const d=l.info,h=Date.now(),p=je(je(je({},d),a),{},{elapse:h-l.startTime,eventType:r,lts:h});this.send({type:o,data:p},!0)}pcStats(n,r){const o=this.baseInfoMap.get(n);if(!o)return;const a=o.info,l=Date.now(),d=je(je(je({},a),r),{},{vid:void 0===a.vid?0:Number(a.vid),elapse:l-o.startTime,eventType:Mi.PC_STATS,lts:l,preallocation:r.preallocation?1:0});this.send({type:sn.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(n,r){if(n){const o=this.baseInfoMap.get(n);if(!o)return;const a=o.info,l=Date.now(),d=je(je(je({},a),r),{},{vid:void 0===a.vid?0:Number(a.vid),eventType:Mi.UPDATE_REMOTE_RTPCAPABILITIES,lts:l});this.send({type:sn.UPDATE_REMOTE_RTPCAPABILITIES,data:d},!0)}}onGatewayStream(n,r,o,a){const l=this.baseInfoMap.get(n);if(!l)return;const d=l.info,h=Date.now(),p=je(je(je({},d),a),{},{eventType:r,lts:h});this.send({type:o,data:p},!0)}streamSwitch(n,r){const o=this.baseInfoMap.get(n);if(!o)return;const a=o.info,l=Date.now(),d=je(je({},a),{},{eventType:Mi.STREAM_SWITCH,lts:l,isDual:r.isdual,elapse:l-o.startTime,success:r.succ});this.send({type:sn.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(n,r){const o=this.baseInfoMap.get(n);if(!o)return;const a=o.info,l=Date.now(),d=je(je({},a),{},{eventType:Mi.REQUEST_PROXY_APPCENTER,lts:l,eventElapse:l-r.lts,elapse:l-o.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:sn.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(n,r){const o=this.baseInfoMap.get(n);if(!o)return;const a=o.info,l=Date.now(),d=je(je({},a),{},{eventType:Mi.REQUEST_PROXY_WORKER_MANAGER,lts:l,eventElapse:l-r.lts,elapse:l-o.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:sn.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(n){this.proxyServer=n,T.debug(n?"reportProxyServerurl: ".concat(n):"disable reportProxyServerurl: ".concat(n))}peerPublishStatus(n,r){const o=this.baseInfoMap.get(n);if(!o)return;const a=o.info,l=Date.now(),d=je(je({},a),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:l,elapse:l-o.startTime,joinChannelSuccessElapse:l-(o.lastJoinSuccessTime||l),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:sn.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(n,r){const o=this.baseInfoMap.get(n);if(!o)return;const a=o.info,l=Date.now();(function(d,h){const m=d[h];if(!m||"string"!=typeof m)return[d];d[h]="";const g=Ec(JSON.stringify(d));let v=0;const y=[];let b=0;for(let C=0;C<m.length;C++)b+=m.charCodeAt(C)<=127?1:3,b<=1300-g||(y[y.length]=Ee(Ee({},d),{},{[h]:m.substring(v,C)}),v=C,b=m.charCodeAt(C)<=127?1:3);return v!==m.length-1&&(y[y.length]=Ee(Ee({},d),{},{[h]:m.substring(v)})),y})(je(je(je({},a),r),{},{elapse:l-o.startTime,lts:l,productType:"WebRTC"}),"payload").forEach(d=>this.send({type:sn.WORKER_EVENT,data:d},!0))}apworkerEvent(n,r){const o=this.baseInfoMap.get(n);if(!o)return;const a=o.info,l=Date.now(),d=je(je(je({},a),r),{},{elapse:l-o.startTime,lts:l});this.send({type:sn.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(n,r){const o=this.baseInfoMap.get(n);if(!o)return;const a=o.info,l=Date.now(),d=je(je(je({},a),r),{},{elapse:l-o.startTime,lts:l,extend:r.extend||void 0});this.send({type:sn.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(n,r){const o=this.baseInfoMap.get(n);if(!o)return;const a=o.info,l=Date.now(),d=je(je(je({},a),r),{},{elapse:l-o.startTime,lts:l});this.send({type:sn.WEBSOCKET_QUIT,data:d},!0)}sendCustomReportMessage(n,r){var o=this;return L(function*(){if(o.customReportCount+=r.length,o.customReportCount>V("CUSTOM_REPORT_LIMIT"))throw new Y(k.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);o.customReportCounterTimer||(o.customReportCounterTimer=window.setInterval(()=>{o.customReportCount=0},5e3));const a=Date.now(),l=r.map(d=>({type:sn.USER_ANALYTICS,data:je(je({sid:n},d),{},{lts:a})}));try{V("NEW_REPORT_SERVER")?yield o.postDataToStatsCollector2(l):yield o.postDataToStatsCollector(l)}catch(d){throw T.error("send custom report message failed",d.toString()),new Y(k.CUSTOM_REPORT_SEND_FAILED,d.message)}})()}sendApiInvoke(n){const r=V("NOT_REPORT_EVENT");if(n.tag&&he(r)&&he(r).call(r,n.tag))return!1;if(null===n.sid)return this.apiInvokeUploadPendingItems.push(n),!1;const o=this.baseInfoMap.get(n.sid);if(!o)return this.apiInvokeUploadPendingItems.push(n),!1;const{cname:a,uid:l,cid:d}=o.info;let h;if(n.lts=n.lts||Date.now(),n.error)if(n.error instanceof Y){const{code:m,message:g}=n.error;h=m||g||n.error.toString()}else h=n.error.toString();const p={invokeId:n.invokeId,sid:n.sid,cname:a,cid:d,uid:l,lts:n.lts,success:n.success,elapse:n.lts-o.startTime,execElapse:n.lts-n.apiInvokeTime,apiName:n.name,options:n.options?JSON.stringify(n.options):void 0,execStates:n.states?JSON.stringify(n.states):void 0,execResult:n.result?JSON.stringify(n.result):void 0,errorCode:n.error?h:void 0,errorMsg:n.error?JSON.stringify(n.error):void 0};return this.send({type:sn.API_INVOKE,data:p},!1),!0}addSid(n){this.sids.add(n)}removeSid(n){this.sids.delete(n)}appendSessionId(){const n=this.apiInvokeUploadPendingItems;if(0===n.length)return;const r=Array.from(this.sids).find(o=>null!==o);r&&n.forEach(o=>{o&&(o.sid=r,this.sendApiInvoke(Object.assign({},o)))}),n.length=0}send(n,r){if(r)return this.keyEventUploadPendingItems.push(n),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(n),this.normalEventUploadPendingItems.length>V("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(n,r){const o=[],a=[];for(;n.length;){const d=n.shift();o.length<20?o.push(d):a.push(d)}n.push(...a);for(const d of[...o]){var l;-1!==this.ltsList.indexOf(d.data.lts)?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),hd(l=this.ltsList).call(l,(h,p)=>h-p))}return r||(this.lastSendNormalEventTime=Date.now()),V("ENABLE_EVENT_REPORT")&&o.length&&(V("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(o):this.postDataToStatsCollector(o)).catch((d=>h=>{V("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>V("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-V("NORMAL_EVENT_QUEUE_CAPACITY")),T.warning("report: drop normal events"))))})(o)),n}postDataToStatsCollector2(n){var r=this;return L(function*(){Se.networkState===co.OFFLINE&&(yield le.race([Se.onlineWaiter,Ii(2*Nn.maxRetryTimeout)]));const o=d=>{let h=new Uint8Array;return d.forEach(p=>{const m=v_(JSON.stringify(p.data)),g=new ArrayBuffer(5),v=(b=>{let C=0;return Object.entries(sn).forEach(N=>{let[R,A]=N;A===b.type&&(C=tL[R])}),C})(p),y=new DataView(g);y.setUint16(0,m.byteLength,!0),y.setUint8(2,255&v),y.setUint8(3,v>>>8&255),y.setUint8(4,v>>>16&255),h=$j(h,new Uint8Array(g)),h=$j(h,m)}),h},a="event";let l=r.proxyServer?"https://".concat(r.proxyServer,"/rs/?h=").concat(V("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(a):"https://".concat(V("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(a);for(let d=0;d<2;d+=1){1===d&&(l=r.proxyServer?"https://".concat(r.proxyServer,"/rs/?h=").concat(V("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(a):"https://".concat(V("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(a));try{yield mR(l,{timeout:1e4,data:o(n),headers:je(je({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},r._appId&&{appid:r._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(h){if(1===d)throw h;continue}return}})()}postDataToStatsCollector(n){var r=arguments,o=this;return L(function*(){let a=r.length>1&&void 0!==r[1]&&r[1];const l={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:n.map(p=>JSON.stringify(p)),vid:(p=>{const m=p&&p.data.sid&&o.baseInfoMap.get(p.data.sid);return m&&m.info.vid&&+m.info.vid||0})(n[0])};Se.networkState===co.OFFLINE&&(yield le.race([Se.onlineWaiter,Ii(2*Nn.maxRetryTimeout)]));const d=a?"/events/proto-raws":"/events/messages";let h=o.url||(o.proxyServer?"https://".concat(o.proxyServer,"/rs/?h=").concat(V("EVENT_REPORT_DOMAIN"),"&p=").concat(V("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(V("EVENT_REPORT_DOMAIN"),":").concat(V("STATS_COLLECTOR_PORT")).concat(d));for(let p=0;p<2;p+=1){1===p&&(h=o.backupUrl||(o.proxyServer?"https://".concat(o.proxyServer,"/rs/?h=").concat(V("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(V("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(V("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(V("STATS_COLLECTOR_PORT")).concat(d)));try{a?yield T_(h,{timeout:1e4,data:l}):yield mR(h,{timeout:1e4,data:l})}catch(m){if(1===p)throw m;continue}return}})()}createBaseInfo(n,r){const o=Object.assign({},w_);return o.sid=n,this.baseInfoMap.set(n,{info:o,startTime:r}),o}reportResourceTiming(n,r){const o=performance.getEntriesByName(n),a=o[o.length-1];a&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:a,tag:st.TRACER}).onSuccess()}};If.on("REPORT_LOG_UPLOAD",n=>{n.networkState=Se.networkState,be.reportApiInvoke(null,{name:"logUploadError",options:n,tag:st.TRACER}).onSuccess("logUploadError")});class z extends Y{constructor(r){super(r,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),bn(this,"name","AgoraRTCException")}print(){return super.print(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",T)}throw(){super.throw(T)}}const bR=["CHINA","GLOBAL"],nL=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Ad=[];function Dd(n,r){return!!r&&Ad.some(o=>o.uid===n&&o.channelName===r)}var o4=_k.forEach,iL=Nm("forEach")?[].forEach:function(n){return o4(this,n,arguments.length>1?arguments[1]:void 0)};Ft({target:"Array",proto:!0,forced:[].forEach!=iL},{forEach:iL});var s4=Or("Array").forEach,SR=gr,a4=Ai,rL=Ar,c4=s4,CR=Array.prototype,l4={DOMTokenList:!0,NodeList:!0},u4=Gt(function(n){var r=n.forEach;return n===CR||rL(CR,n)&&r===CR.forEach||a4(l4,SR(n))?c4:r}),h4=So,oL=ii;Ft({target:"Object",stat:!0,forced:Pt(function(){oL(1)})},{keys:function(n){return oL(h4(n))}});var sL=Gt(to.Object.keys),aL=Gt(xT),cL=Ft,p4=Hu,f4=xn([].reverse),TR=[1,2];cL({target:"Array",proto:!0,forced:String(TR)===String(TR.reverse())},{reverse:function(){return p4(this)&&(this.length=this.length),f4(this)}});var m4=Or("Array").reverse,g4=Ar,lL=m4,aS=Array.prototype,IR=function(n){var r=n.reverse;return n===aS||g4(aS,n)&&r===aS.reverse?lL:r},_4=Gt(IR),wR=Ft,RR=Hu,dL=tg,TW=or,Sn=ME,v4=Wc,wf=Hc,uo=il,E4=En,uL=Jc,AR=M3("slice"),hL=E4("species"),cS=Array,pL=Math.max;wR({target:"Array",proto:!0,forced:!AR},{slice:function(n,r){var o,a,l,d=wf(this),h=v4(d),p=Sn(n,h),m=Sn(void 0===r?h:r,h);if(RR(d)&&((dL(o=d.constructor)&&(o===cS||RR(o.prototype))||TW(o)&&null===(o=o[hL]))&&(o=void 0),o===cS||void 0===o))return uL(d,p,m);for(a=new(void 0===o?cS:o)(pL(m-p,0)),l=0;p<m;p++,l++)p in d&&uo(a,l,d[p]);return a.length=l,a}});var fL=Or("Array").slice,mL=Ar,gL=fL,lS=Array.prototype,fh=Gt(function(n){var r=n.slice;return n===lS||mL(lS,n)&&r===lS.slice?gL:r});function pe(n,r,o,a,l){var d,h,p,m={};return u4(d=sL(a)).call(d,function(g){m[g]=a[g]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=aL(h=_4(p=fh(o).call(o)).call(p)).call(h,function(g,v){return v(n,r,g)||g},m),l&&void 0!==m.initializer&&(m.value=m.initializer?m.initializer.call(l):void 0,m.initializer=void 0),void 0===m.initializer&&(rk(n,r,m),m=null),m}let dr=function(n){return n.L1T1="L1T1",n.L1T2="L1T2",n.L1T3="L1T3",n.L1T3_KEY="L1T3_KEY",n.L2T1_KEY="L2T1_KEY",n.L2T2_KEY="L2T2_KEY",n.L2T3_KEY="L2T3_KEY",n.L3T1_KEY="L3T1_KEY",n.L3T2_KEY="L3T2_KEY",n.L3T3_KEY="L3T3_KEY",n}({}),kn=function(n){return n.CERTIFICATE="certificate",n.CODEC="codec",n.CANDIDATE_PAIR="candidate-pair",n.LOCAL_CANDIDATE="local-candidate",n.REMOTE_CANDIDATE="remote-candidate",n.INBOUND="inbound-rtp",n.TRACK="track",n.OUTBOUND="outbound-rtp",n.PC="peer-connection",n.REMOTE_INBOUND="remote-inbound-rtp",n.REMOTE_OUTBOUND="remote-outbound-rtp",n.TRANSPORT="transport",n.CSRC="csrc",n.DATA_CHANNEL="data-channel",n.STREAM="stream",n.SENDER="sender",n.RECEIVER="receiver",n}({}),R_=function(n){return n[n.ACCESS_POINT=101]="ACCESS_POINT",n[n.UNILBS=201]="UNILBS",n[n.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",n}({}),DR=function(n){return n[n.IIIEGAL_APPID=1]="IIIEGAL_APPID",n[n.IIIEGAL_UID=2]="IIIEGAL_UID",n[n.INTERNAL_ERROR=3]="INTERNAL_ERROR",n}({}),Ts=function(n){return n[n.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",n[n.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",n[n.INTERNAL_ERROR=8]="INTERNAL_ERROR",n[n.NO_AUTHORIZED=9]="NO_AUTHORIZED",n[n.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",n[n.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",n[n.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",n[n.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",n[n.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",n[n.USER_OVERLOAD=16]="USER_OVERLOAD",n[n.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",n[n.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",n}({}),ur=function(n){return n[n.NO_FLAG_SET=100]="NO_FLAG_SET",n[n.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",n[n.INVALID_FALG_SET=102]="INVALID_FALG_SET",n[n.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",n[n.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",n[n.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",n[n.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",n[n.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",n[n.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",n[n.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",n[n.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",n[n.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",n[n.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",n[n.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",n[n.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",n[n.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",n[n.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",n[n.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",n[n.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",n}({}),we=function(n){return n[n.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",n[n.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",n[n.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",n[n.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",n[n.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",n[n.K_TICKET_INVALID=7]="K_TICKET_INVALID",n[n.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",n[n.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",n[n.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",n[n.K_UID_BANNED=14]="K_UID_BANNED",n[n.K_IP_BANNED=15]="K_IP_BANNED",n[n.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",n[n.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",n[n.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",n[n.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",n[n.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",n[n.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",n[n.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",n[n.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",n[n.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",n[n.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",n[n.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",n[n.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",n[n.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",n[n.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",n[n.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",n[n.ERR_INVALID_UID=117]="ERR_INVALID_UID",n[n.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",n[n.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",n[n.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",n[n.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",n[n.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",n[n.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",n[n.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",n[n.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",n[n.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",n[n.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",n[n.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",n[n.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",n[n.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",n[n.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",n[n.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",n[n.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",n[n.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",n[n.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",n[n.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",n[n.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",n[n.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",n[n.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",n[n.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",n[n.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",n[n.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",n[n.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",n[n.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",n[n.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",n[n.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",n[n.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",n[n.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",n[n.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",n[n.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",n[n.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",n[n.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",n[n.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",n[n.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",n}({}),qt=function(n){return n.CONNECTING="connecting",n.CONNECTED="connected",n.RECONNECTING="reconnecting",n.CLOSED="closed",n}({}),Me=function(n){return n.WS_CONNECTED="ws_connected",n.WS_RECONNECTING="ws_reconnecting",n.WS_CLOSED="ws_closed",n.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",n.ON_BINARY_DATA="on_binary_data",n.REQUEST_RECOVER="request_recover",n.REQUEST_JOIN_INFO="request_join_info",n.REQUEST_REJOIN_INFO="req_rejoin_info",n.IS_P2P_DISCONNECTED="is_p2p_dis",n.DISCONNECT_P2P="dis_p2p",n.ABORT_P2P_EXECUTION="abort_p2p_execution",n.NEED_RENEW_SESSION="need-sid",n.REPORT_JOIN_GATEWAY="report_join_gateway",n.REQUEST_TIMEOUT="request_timeout",n.REQUEST_SUCCESS="request_success",n.JOIN_RESPONSE="join_response",n.PRE_CONNECT_PC="pre_connect_pc",n.P2P_CONNECTION="p2p_connection",n.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",n.P2P_SUBSCRIBE="p2p_subscribe",n.P2P_UNSUBSCRIBE="p2p_unsubscribe",n.P2P_EXCHANGE_SDP="p2p_exchange_sdp",n.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",n.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",n.RECOVER_NOTIFICATION="recover_notification",n}({}),Pe=function(n){return n.PING="ping",n.PING_BACK="ping_back",n.JOIN="join_v3",n.REJOIN="rejoin_v3",n.LEAVE="leave",n.SET_CLIENT_ROLE="set_client_role",n.PUBLISH="publish",n.PUBLISH_DATASTREAM="publish_datastream",n.UNPUBLISH="unpublish",n.UNPUBLISH_DATASTREAM="unpublish_datastream",n.SUBSCRIBE="subscribe",n.PRE_SUBSCRIBE="pre_subscribe",n.SUBSCRIBE_DATASTREAM="subscribe_datastream",n.SUBSCRIBE_STREAMS="subscribe_streams",n.UNSUBSCRIBE="unsubscribe",n.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",n.UNSUBSCRIBE_STREAMS="unsubscribe_streams",n.SUBSCRIBE_CHANGE="subscribe_change",n.TRAFFIC_STATS="traffic_stats",n.RENEW_TOKEN="renew_token",n.SWITCH_VIDEO_STREAM="switch_video_stream",n.DEFAULT_VIDEO_STREAM="default_video_stream",n.SET_FALLBACK_OPTION="set_fallback_option",n.GATEWAY_INFO="gateway_info",n.CONTROL="control",n.SEND_METADATA="send_metadata",n.DATA_STREAM="data_stream",n.PICK_SVC_LAYER="pick_svc_layer",n.RESTART_ICE="restart_ice",n.CONNECT_PC="connect_pc",n.SET_VIDEO_PROFILE="set_video_profile",n.SET_PARAMETER="set_parameter",n.SET_RTM2_FLAG="set_rtm2_flag",n}({}),A_=function(n){return n.WRTC_STATS="wrtc_stats",n.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",n.DENOISER_STATS="denoiser_stats",n.EXTENSION_USAGE_STATS="extension_usage_stats",n}({}),qe=function(n){return n.ON_USER_ONLINE="on_user_online",n.ON_USER_OFFLINE="on_user_offline",n.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",n.ON_PUBLISH_STREAM="on_publish_stream",n.ON_UPLINK_STATS="on_uplink_stats",n.ON_P2P_LOST="on_p2p_lost",n.ON_REMOVE_STREAM="on_remove_stream",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",n.ON_USER_BANNED="on_user_banned",n.ON_USER_LICENSE_BANNED="on_user_license_banned",n.ON_NOTIFICATION="on_notification",n.ON_CRYPT_ERROR="on_crypt_error",n.MUTE_AUDIO="mute_audio",n.MUTE_VIDEO="mute_video",n.UNMUTE_AUDIO="unmute_audio",n.UNMUTE_VIDEO="unmute_video",n.ON_P2P_OK="on_p2p_ok",n.RECEIVE_METADATA="receive_metadata",n.ON_DATA_STREAM="on_data_stream",n.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",n.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",n.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",n.ENABLE_LOCAL_VIDEO="enable_local_video",n.DISABLE_LOCAL_VIDEO="disable_local_video",n.ENABLE_LOCAL_AUDIO="enable_local_audio",n.DISABLE_LOCAL_AUDIO="disable_local_audio",n.ON_PUBLISHED_USER_LIST="on_published_user_list",n}({}),Pr=function(n){return n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY",n}({}),Fe=function(n){return n.CONNECTED="websocket:connected",n.RECONNECTING="websocket:reconnecting",n.WILL_RECONNECT="websocket:will_reconnect",n.CLOSED="websocket:closed",n.FAILED="websocket:failed",n.ON_MESSAGE="websocket:on_message",n.REQUEST_NEW_URLS="websocket:request_new_urls",n.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",n}({});function dS(n){if("string"!=typeof n||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(n))throw T.error("Invalid Channel Name ".concat(n)),new z(k.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function uS(n){if(!("number"==typeof(r=n)&&Math.floor(r)===r&&0<=r&&r<=4294967295||W1(n,1,255)))throw new z(k.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;"string"==typeof n&&T.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Pa=function(n){return n.TRANSCODE="mix_streaming",n.RAW="raw_streaming",n}({});const vL={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},hS={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function pS(n,r){Pi(n.url,"".concat(r,".url"),1,1e3,!1),pn(n.x)||Ut(n.x,"".concat(r,".x"),0,1e4),pn(n.y)||Ut(n.y,"".concat(r,".y"),0,1e4),pn(n.width)||Ut(n.width,"".concat(r,".width"),0,1e4),pn(n.height)||Ut(n.height,"".concat(r,".height"),0,1e4),pn(n.zOrder)||Ut(n.zOrder,"".concat(r,".zOrder"),0,255),pn(n.alpha)||Ut(n.alpha,"".concat(r,".alpha"),0,1,!1)}const EL={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let vl=function(n){return n.WARNING="@live_uap-warning",n.ERROR="@line_uap-error",n.PUBLISH_STREAM_STATUS="@live_uap-publish-status",n.WORKER_STATUS="@live_uap-worker-status",n.REQUEST_NEW_ADDRESS="@live_uap-request-address",n}({}),fS=function(n){return n.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",n}({}),$n=function(n){return n[n.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",n[n.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",n[n.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",n[n.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",n[n.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",n[n.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",n[n.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",n[n.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",n[n.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",n[n.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",n[n.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",n[n.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",n[n.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",n[n.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",n[n.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",n[n.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",n}({});function OR(n){if(!n.channelName)throw new z(k.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof n.uid)throw new z(k.INVALID_PARAMS,"invalid uid in info, uid must be a number");return n.token&&Pi(n.token,"info.token",1,2047),uS(n.uid),dS(n.channelName),!0}let fn=function(n){return n[n.SetSdkProfile=0]="SetSdkProfile",n[n.SetSourceChannel=1]="SetSourceChannel",n[n.SetSourceUserId=2]="SetSourceUserId",n[n.SetDestChannel=3]="SetDestChannel",n[n.StartPacketTransfer=4]="StartPacketTransfer",n[n.StopPacketTransfer=5]="StopPacketTransfer",n[n.UpdateDestChannel=6]="UpdateDestChannel",n[n.Reconnect=7]="Reconnect",n[n.SetVideoProfile=8]="SetVideoProfile",n}({}),bc=function(n){return n.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",n.NETWORK_CONNECTED="NETWORK_CONNECTED",n.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",n.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",n.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",n.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",n.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",n.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",n.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",n.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",n}({}),ho=function(n){return n.RELAY_STATE_IDLE="RELAY_STATE_IDLE",n.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",n.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",n.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",n}({}),Rf=function(n){return n.RELAY_OK="RELAY_OK",n.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",n.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",n.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",n}({}),at=function(n){return n.High="high",n.Low="low",n.Audio="audio",n.Screen="screen",n.ScreenLow="screen_low",n}({}),gi=function(n){return n.DISCONNECT="disconnect",n.CONNECTION_STATE_CHANGE="connection-state-change",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGE="stream-type-change",n.IS_P2P_DISCONNECTED="is-p2p-dis",n.DISCONNECT_P2P="dis-p2p",n.REQUEST_NEW_GATEWAY_LIST="req-gate-url",n.NEED_RENEW_SESSION="need-sid",n.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",n.JOIN_RESPONSE="join-response",n.RESET_CONNECTION_EVENTS="reset-connection-events",n.PRE_CONNECT_PC="pre-connect_pc",n}({}),D_=function(n){return n.P2P_DISCONNECTED="P2P_DISCONNECTED",n.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",n.TIMEOUT="TIMEOUT",n.UNKNOWN_REASON="UNKNOWN_REASON",n}({}),_i=function(n){return n[n.Nothing=0]="Nothing",n[n.Audio=1]="Audio",n[n.LwoVideo=2]="LwoVideo",n[n.Video=4]="Video",n[n.Data=8]="Data",n[n.DataStream0=256]="DataStream0",n[n.DataStream1=512]="DataStream1",n[n.DataStream2=1024]="DataStream2",n[n.DataStream3=2048]="DataStream3",n[n.DataStream4=4096]="DataStream4",n[n.DataStream5=8192]="DataStream5",n[n.DataStream6=16384]="DataStream6",n[n.DataStream7=32768]="DataStream7",n}({}),mt=function(n){return n.CHINA="CHINA",n.ASIA="ASIA",n.NORTH_AMERICA="NORTH_AMERICA",n.EUROPE="EUROPE",n.JAPAN="JAPAN",n.INDIA="INDIA",n.KOREA="KOREA",n.HKMC="HKMC",n.US="US",n.OCEANIA="OCEANIA",n.SOUTH_AMERICA="SOUTH_AMERICA",n.AFRICA="AFRICA",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="EXTENSIONS",n}({});const NR=[mt.AFRICA,mt.ASIA,mt.CHINA,mt.EUROPE,mt.GLOBAL,mt.INDIA,mt.JAPAN,mt.NORTH_AMERICA,mt.OCEANIA,mt.OVERSEA,mt.SOUTH_AMERICA];let zi=function(n){return n.CHINA="CN",n.ASIA="AS",n.NORTH_AMERICA="NA",n.EUROPE="EU",n.JAPAN="JP",n.INDIA="IN",n.KOREA="KR",n.HKMC="HK",n.US="US",n.OCEANIA="OC",n.SOUTH_AMERICA="SA",n.AFRICA="AF",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="GLOBAL",n}({});const O_={CHINA:{},ASIA:{CODE:zi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:zi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:zi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:zi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:zi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:zi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:zi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:zi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:zi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:zi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:zi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:zi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:zi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};oS&&(O_.CHINA={CODE:zi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let mS=function(n){return n.UPDATE_BITRATE_LIMIT="update_bitrate_limit",n}({});class PR extends nn{constructor(r,o){super(),O(this,"onICEConnectionStateChange",void 0),O(this,"onConnectionStateChange",void 0),O(this,"onDTLSTransportStateChange",void 0),O(this,"onDTLSTransportError",void 0),O(this,"onICETransportStateChange",void 0),O(this,"onFirstAudioReceived",void 0),O(this,"onFirstVideoReceived",void 0),O(this,"onFirstAudioDecoded",void 0),O(this,"onFirstVideoDecoded",void 0),O(this,"onFirstVideoDecodedTimeout",void 0),O(this,"onSelectedLocalCandidateChanged",void 0),O(this,"onSelectedRemoteCandidateChanged",void 0),O(this,"getLocalVideoStats",void 0)}}class MR extends PR{constructor(r,o){super(r,o),O(this,"establishPromise",void 0)}}let _e=function(n){return n.VIDEO="video",n.AUDIO="audio",n}({}),po=function(n){return n[n.UDP=0]="UDP",n[n.TCP=1]="TCP",n[n.RELAY=2]="RELAY",n}({}),Sc=function(n){return n[n.FIRST_CONNECTION=0]="FIRST_CONNECTION",n[n.TCP_RESTART=1]="TCP_RESTART",n[n.RELAY_RESTART=2]="RELAY_RESTART",n[n.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",n[n.OLD_RESTART=11]="OLD_RESTART",n[n.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",n}({}),Q=function(n){return n.LocalVideoTrack="videoTrack",n.LocalAudioTrack="audioTrack",n.LocalVideoLowTrack="videoLowTrack",n}({}),Dt=function(n){return n.New="new",n.Connected="connected",n.Reconnecting="reconnecting",n.Disconnected="disconnected",n}({}),De=function(n){return n.StateChange="stateChange",n.IceConnectionStateChange="iceConnectionStateChange",n.RequestMuteLocal="requestMuteLocal",n.RequestUnmuteLocal="requestUnmuteLocal",n.RequestRePublish="requestRePublish",n.RequestRePublishDataChannel="requestRePublishDataChannel",n.RequestReSubscribe="requestReSubscribe",n.RequestUploadStats="requestUploadStats",n.RequestUpload="requestUpload",n.MediaReconnectStart="MediaReconnectStart",n.MediaReconnectEnd="MediaReconnectEnd",n.NeedSignalRTT="NeedSignalRTT",n.RequestRestartICE="RequestRestartIce",n.PeerConnectionStateChange="PeerConnectionStateChange",n.RequestReconnect="RequestReconnect",n.RequestReconnectPC="RequestReconnectPC",n.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",n.P2PLost="P2PLost",n.UpdateVideoEncoder="UpdateVideoEncoder",n.ConnectionTypeChange="ConnectionTypeChange",n.RequestLowStreamParameter="RequestLowStreamParameter",n.QueryClientConnectionState="QueryClientConnectionState",n.LocalCandidate="LocalCandidate",n.RequestP2PMuteLocal="requestP2PMuteLocal",n.RequestP2PUnPublish="RequestP2PUnPublish",n.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",n.RequestP2PMuteRemote="RequestP2PMuteRemote",n.RequestP2PRestartICE="RequestP2PRestartICE",n}({}),qs=function(n){return n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED",n}({}),os=function(n){return n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED",n}({}),vi=function(n){return n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url",n}({}),kR=function(n){return n.CONNECTED="transmitter:connected",n.RECONNECTING="transmitter:reconnecting",n.WILL_RECONNECT="transmitter:will_reconnect",n.CLOSED="transmitter:closed",n.FAILED="transmitter:failed",n.ON_MESSAGE="transmitter:on_message",n.REQUEST_NEW_URLS="transmitter:request_new_urls",n.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",n.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",n.FAILBACK="transmitter:failback",n.PRE_CONNECT_PC="transmitter:pre_connect_pc",n}({}),Ys=function(n){return n.CAMERA_CHANGED="camera-changed",n.MICROPHONE_CHANGED="microphone-changed",n.PLAYBACK_DEVICE_CHANGED="playback-device-changed",n.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",n.AUTOPLAY_FAILED="autoplay-failed",n.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",n.SECURITY_POLICY_VIOLATION="security-policy-violation",n}({}),Is=function(n){return n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED",n}({}),Ma=function(n){return n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url",n}({}),Od=function(n){return n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED",n}({}),Bn=function(n){return n.CALL="call",n.CANDIDATE="candidate",n.PUBLISH="publish",n.UNPUBLISH="unpublish",n.CONTROL="control",n.RESTART_ICE="restart_ice",n.ACK="ack",n.RESPONSE="response",n.JOIN="join",n.CHECK="check",n}({}),mn=function(n){return n.ABORT="abort",n}({}),Nd=function(n){return n.MUTE_LOCAL_AUDIO="mute_local_audio",n.MUTE_LOCAL_VIDEO="mute_local_video",n.UNMUTE_LOCAL_AUDIO="unmute_local_audio",n.UNMUTE_LOCAL_VIDEO="unmute_local_video",n}({}),fo=function(n){return n.P2P_TOKEN_TIMEOUT="p2p_token_timeout",n.P2P_TOKEN_CHANGED="p2p_token_changed",n}({});const y4={[R_.ACCESS_POINT]:{[ur.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[ur.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[ur.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[ur.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[ur.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[ur.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[ur.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[ur.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[ur.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[ur.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[ur.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[ur.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[ur.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[ur.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[ur.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[ur.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[ur.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[ur.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[R_.UNILBS]:{[Ts.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Ts.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Ts.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Ts.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Ts.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Ts.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Ts.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Ts.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Ts.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Ts.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Ts.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Ts.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[R_.STRING_UID_ALLOCATOR]:{[DR.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[DR.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[DR.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Af(n){const r=y4[Math.floor(n/1e4)];if(!r)return{desc:"unknown error",retry:!1};const o=r[n%1e4];if(!o){if(Math.floor(n/1e4)===R_.ACCESS_POINT){const a=n%1e4;if("1"===a.toString()[0])return{desc:n.toString(),retry:!1};if("2"===a.toString()[0])return{desc:n.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return o}const gS={[we.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[we.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[we.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[we.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[we.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[we.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[we.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[we.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[we.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[we.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[we.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[we.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[we.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[we.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[we.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[we.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[we.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[we.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[we.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[we.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[we.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[we.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[we.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[we.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[we.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[we.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[we.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[we.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[we.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[we.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[we.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[we.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[we.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[we.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[we.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[we.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[we.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[we.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[we.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[we.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[we.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[we.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[we.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[we.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[we.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[we.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[we.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[we.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[we.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[we.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[we.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[we.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[we.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[we.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[we.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[we.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[we.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[we.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[we.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[we.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[we.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[we.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[we.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Df(n){return gS[n]||{desc:"UNKNOWN_ERROR_".concat(n),action:"failed"}}function N_(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function yL(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?N_(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):N_(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}function bL(n){return n.every(r=>r.readyState===WebSocket.CLOSED||r.readyState===WebSocket.CLOSING)}function LR(n,r){if("string"==typeof n)return n;const{proxy:o,host:a,port:l}=n;if(r){const d=V("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===d?"wss://".concat(a,"/ws/?p=").concat(Number(l)+150):"wss://".concat(a,":").concat(d,"/ws/?p=").concat(Number(l)+150)}return o?"wss://".concat(o,"/ws/?h=").concat(a,"&p=").concat(l):"wss://".concat(a,":").concat(l)}const b4=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,S4=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,C4=/wss:\/\/(.+):([0-9]+)\/?/,T4=/wss:\/\/(.[^\/]+)\/?/;let SL=0;class I4{constructor(r,o){O(this,"id",0),O(this,"store",void 0),O(this,"recordIndex",void 0),O(this,"websockets",[]),O(this,"try443PortDuration",2e3),O(this,"forceCloseWSDuration",5e3),O(this,"try443PortTimeout",null),O(this,"forceCloseTimeout",null),O(this,"isTry443PortFailed",!1),O(this,"isNormalPortFailed",!1),O(this,"useDoubleDomain",!1),O(this,"useProxy",!1),O(this,"startTime",Date.now()),this.id=++SL,this.try443PortDuration=V("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=o}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var r;const o=Date.now()-this.startTime;for(var a=arguments.length,l=new Array(a),d=0;d<a;d++)l[d]=arguments[d];T.debug("[choose-best-ws ".concat(null===(r=this.store)||void 0===r?void 0:r.clientId," ").concat(this.id,"] ").concat(o,"ms:"),...l)}createWebSocket(r,o,a){this.logger("createWebSocket:",r,{isTry443Port:o,hasTimeoutDetection:a});const l=V("GATEWAY_DOMAINS"),d=Date.now(),h=[],p=l.find(v=>{var y;return he(y=r.host).call(y,v)});p||(this.useDoubleDomain=!1);const m=[];if(this.useDoubleDomain)l.forEach(v=>{m.push(LR(yL(yL({},r),{},{host:r.host.replace(p,v)}),o))});else{const v=yL({},r);if(o&&p){const y=l.find(b=>b!==p);y&&(v.host=v.host.replace(p,y))}m.push(LR(v,o))}try{m.forEach(v=>{const y=new WebSocket(v);y.binaryType="arraybuffer",h.push(y),this.logger("ws is connecting:",y.url)})}catch(v){if(this.logger("ws create failed"),h.forEach(y=>y.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,o,a);if(!o&&443!==Number(r.port))return this.createWebSocket(r,!0,a);throw new z(k.WS_ERR,"init websocket failed! Error: ".concat(v.toString()))}const g=Ni();return this.store&&this.store.recordJoinChannelService({urls:h.map(v=>v.url),service:"gateway"},this.recordIndex),h.forEach(v=>{v.onopen=()=>{this.logger("onopen: ws ".concat(v.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(y=>{y!==v&&(y.onopen=null,y.onclose=null,y.onmessage=null,y.close(),this.logger("close backup websocket: ".concat(y.url)))}),this.websockets.length=0,g.resolve(v)},v.onclose=y=>{this.logger("onclose: ws ".concat(v.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(v.readyState)),o?this.isTry443PortFailed=bL(h):this.isNormalPortFailed=bL(h),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(o&&this.isTry443PortFailed||!o&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(y.reason)),g.reject({code:y.code,reason:D_.A_ROUND_WS_FAILED}))},v.onmessage=y=>this.logger("".concat(v.url," onmessage: ").concat(y.data))}),this.websockets.push(...h),a||(()=>{const v=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",g.isResolved),this.websockets.forEach(y=>y.readyState!==WebSocket.OPEN&&y.close())};if(o||this.useProxy)return this.logger("add 5s timeout at ".concat(o?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(v,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",g.isResolved),g.isResolved)return v();ot().os===pi.MAC_OS&&hn()&&v(),this.createWebSocket(r,!0,!0).then(y=>g.resolve(y)).catch(y=>{this.isNormalPortFailed&&g.reject(y),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(v,this.forceCloseWSDuration)},this.try443PortDuration)})(),g.promise}chooseBestWebsocket(r,o,a,l){return this.useDoubleDomain=!!o,"string"==typeof r&&(r=function(d){let h,p,m;return[,h,p,m]=d.match(b4)||[],h||([,p,m]=d.match(S4)||[]),p&&m||([,p,m]=d.match(C4)||[]),p&&m||([,p]=d.match(T4)||[]),p||T.warning("un-destructible url: ",d),{proxy:h,host:p,port:m||"443"}}(r)),this.recordIndex=l,this.useProxy=!!r.proxy,a&&this.useProxy&&(T.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(r,!!a,!1).finally(()=>this.clearTimeout())}}function CL(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}class TL extends nn{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var o;he(o=["tryNext","recover"]).call(o,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,"reconnecting"===this._state?this.emit(Fe.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Fe.CONNECTED):"closed"===this._state?this.emit(Fe.CLOSED):"failed"===this._state&&this.emit(Fe.FAILED))}resetReconnectCount(r){T.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,o){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),O(this,"connectionID",0),O(this,"currentURLIndex",0),O(this,"urls",[]),O(this,"_reconnectMode","tryNext"),O(this,"reconnectReason",void 0),O(this,"_initMutex",void 0),O(this,"name",void 0),O(this,"_state","closed"),O(this,"reconnectInterrupter",void 0),O(this,"websocket",void 0),O(this,"retryConfig",void 0),O(this,"reconnectCount",0),O(this,"forceCloseTimeout",5e3),O(this,"onlineReconnectListener",void 0),O(this,"useCompress",void 0),O(this,"tryDoubleDomain",!1),O(this,"use443PortOnly",!1),O(this,"wsInflateLength",0),O(this,"wsDeflateLength",0),O(this,"closeEstablishingWs",()=>{}),O(this,"store",void 0),O(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(y){for(var b=1;b<arguments.length;b++){var C=null!=arguments[b]?arguments[b]:{};b%2?CL(Object(C),!0).forEach(function(N){O(y,N,C[N])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(C)):CL(Object(C)).forEach(function(N){Object.defineProperty(y,N,Object.getOwnPropertyDescriptor(C,N))})}return y}({},o),this.useCompress=a,this.tryDoubleDomain=l,this.use443PortOnly=d,this._initMutex=new Qi("websocket",h?h.clientId:void 0);const{timeout:p,timeoutFactor:m}=o,g=Math.max(300,Math.floor(3*p/5)),v=Math.max(1.2,Math.floor(8*m)/10);co.ONLINE&&(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=v),Se.on(ml.NETWORK_STATE_CHANGE,(y,b)=>{y!==b&&(this.resetReconnectCount("network state change: ".concat(b," -> ").concat(y)),y===co.ONLINE?(this.retryConfig.timeout=g,this.retryConfig.timeoutFactor=v):(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}init(r){var o=arguments,a=this;return L(function*(){let l=o.length>1&&void 0!==o[1]?o[1]:5e3;const d=yield a._initMutex.lock();a.forceCloseTimeout=l,a.urls=r,a.state="connecting";try{const h=Ni(),p=a.urls[a.currentURLIndex];V("ENABLE_PREALLOC_PC")&&a.emit(kR.PRE_CONNECT_PC),a.createWebSocketConnection(p).then(h.resolve).catch(h.reject),a.once(Fe.CLOSED,()=>{h.reject(new Y(k.WS_DISCONNECT))}),a.once(Fe.CONNECTED,h.resolve),yield h.promise}catch{}finally{d()}})()}close(r,o){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;o?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,o){if(!this.websocket)return void T.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==r&&(this.reconnectMode=r),T.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(o)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:o})}sendMessage(r){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Y(k.WS_ABORT,"websocket is not ready");try{o||(r=JSON.stringify(r)),this.websocket.send(r)}catch(a){throw new Y(k.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,o=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:o}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}createWebSocketConnection(r){var o=this;return L(function*(){var a;const l=Ni();o.connectionID+=1,o.joinGatewayRecordIndex=void 0;const d=y=>{var b;null===(b=o.store)||void 0===b||b.signalChannelOpen(),T.debug("[".concat(o.name,"] websocket opened:"),y),o.reconnectMode="retry",o.state="connected",o.resetReconnectCount("opened"),l.resolve()},h=function(){var y=L(function*(b){var C;if(T.debug("[".concat(o.name,"] websocket close ").concat(null===(C=o.websocket)||void 0===C?void 0:C.url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(o.reconnectMode)),o.reconnectCount>=o.retryConfig.maxRetryCount)l.reject(new Y(k.WS_DISCONNECT,"websocket close: ".concat(b.code))),o.close();else{"connected"===o.state&&(o.reconnectReason=b.reason,o.state="reconnecting");const N=Do(o,Fe.WILL_RECONNECT,o.reconnectMode,b.reason)||o.reconnectMode,R=yield o.reconnectWithAction(N);if("closed"===o.state)return void T.debug("[".concat(o.connectionID,"] ws is closed, no need to reconnect"));if(!R)return l.reject(new Y(k.WS_DISCONNECT,"websocket reconnect failed: ".concat(b.code))),o.close(!0);l.resolve()}});return function(C){return y.apply(this,arguments)}}(),p=y=>{o.emit(Fe.ON_MESSAGE,y)},m=y=>{T.warn("[".concat(o.connectionID,"] ws open error ").concat(y))};o.websocket&&(o.websocket.onclose=null,o.websocket.close()),V("GATEWAY_WSS_ADDRESS")&&o.name.startsWith("gateway")&&(r=V("GATEWAY_WSS_ADDRESS")),T.debug("[".concat(o.name,"] start connect, url:"),r);const g=null===(a=o.store)||void 0===a?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;const y=yield o.chooseBestWebsocketConnection(r);o.websocket=y,d&&d(o.websocket.url),o.websocket.onclose=h,o.websocket.onmessage=p,o.websocket.onerror=m,null===(v=o.store)||void 0===v||v.recordJoinChannelService({endTs:Date.now(),status:"success"},g),o.joinGatewayRecordIndex=g}catch(y){const b="closed"===o.state,C=y instanceof Y,N=C&&y.code===k.WS_ABORT,R=C&&y.code===k.WS_ERR,A=C?y.message:y&&(y.reason||y.toString());T.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(A)),o.store&&o.store.recordJoinChannelService({endTs:Date.now(),status:N?"aborted":"error",errors:[y]},g),b||R?(l.reject(b?new Y(k.WS_DISCONNECT,"websocket is closed: ".concat(A)):new Y(k.WS_ERR,"init websocket failed: ".concat(A))),R&&T.error("[".concat(o.name,"] init websocket failed: ").concat(A))):h&&h(y)}return l.promise})()}reconnectWithAction(r){var o=arguments,a=this;return L(function*(){let l=!(o.length>1&&void 0!==o[1])||o[1];if(a.reconnectCount>=a.retryConfig.maxRetryCount||0===a.urls.length||"closed"===a.state)return!1;T.warning("[choose-best-ws] action: =>",r),a.onlineReconnectListener||Se.isOnline||!Se.onlineWaiter||(a.onlineReconnectListener=Se.onlineWaiter.then(()=>{a.onlineReconnectListener=void 0}));let d=!0;if(a.reconnectInterrupter=()=>d=!1,l){const m=pR(a.reconnectCount,a.retryConfig);T.debug("[".concat(a.name,"] wait ").concat(m,"ms to reconnect websocket, mode: ").concat(r)),yield le.race([Ii(m),a.onlineReconnectListener||new le(()=>{})])}if("closed"===a._state||!d)return!1;a.reconnectCount+=1;const h=function(){var m=L(function*(g,v){a.emit(Fe.RECONNECT_CREATE_CONNECTION,v),yield a.createWebSocketConnection(g)});return function(v,y){return m.apply(this,arguments)}}();try{if("retry"===r)yield h(a.urls[a.currentURLIndex],r);else if("tryNext"===r){if(a.currentURLIndex+=1,a.currentURLIndex>=a.urls.length)return a.reconnectWithAction("recover",!1);T.debug("[".concat(a.name,"] websocket url length: ").concat(a.urls.length," current index: ").concat(a.currentURLIndex)),yield h(a.urls[a.currentURLIndex],r)}else"recover"===r&&(T.debug("[".concat(a.name,"] request new urls")),a.resetReconnectCount("recover mode"),a.urls=yield Gi(a,Fe.REQUEST_NEW_URLS),a.currentURLIndex=0,yield h(a.urls[a.currentURLIndex],r))}catch(m){var p;T.error("[".concat(a.name,"] reconnect failed ").concat(m&&m.toString()));const g=null==m||null===(p=m.data)||void 0===p?void 0:p.desc;return Array.isArray(g)&&he(g).call(g,"dynamic key expired")?(a.emit(Fe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):a.reconnectWithAction(r,l)}return!0})()}}class xR extends TL{constructor(r,o){super(r,o,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(r,o){var a=this;return L(function*(){const l=Ni(),d=new I4(a.forceCloseTimeout,a.store);a.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),d.closeAllWebsockets(),l.reject(new Y(k.WS_ABORT,"choose best websocket aborted"))};const h=V("GATEWAY_DOMAINS");return T.debug("[choose-best-ws] currentDomain: ",r,", domains: ",h,"total: ".concat(a.urls.length),"current: ".concat(a.currentURLIndex+1)),d.chooseBestWebsocket(r,a.tryDoubleDomain,a.use443PortOnly,o).then(l.resolve).catch(l.reject),l.promise.finally(()=>{a.closeEstablishingWs=void 0})})()}}class P_ extends TL{constructor(r,o){super(r,o,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(r,o){var a=this;return L(function*(){return new le((l,d)=>{let h=!1;const p=[];a.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),p.forEach(R=>{R.onclose=null,R.onopen=null,R.onmessage=null,R.close()}),d(new Y(k.WS_ABORT,"choose best websocket aborted"))};const m=V("GATEWAY_DOMAINS");let g;const v=r.indexOf("?h="),y=m.find(R=>-1!==v?he(r).call(r,R,v):he(r).call(r,R));T.debug("[choose-best-ws] currentDomain: ",y,", domains: ",m);let b=!a.tryDoubleDomain||!y;if(!b&&y){var C;const R=Date.now();try{m.forEach(A=>{const D=-1===v?r.replace(y,A):r.substr(0,v)+r.substr(v).replace(y,A),M=new WebSocket(D);M.binaryType="arraybuffer",p.push(M),T.debug("[choose-best-ws] ws is connecting:",M.url)})}catch{for(T.debug("[choose-best-ws] ws create failed, fallback to single url"),p.forEach(D=>D.close());p.length;)p.pop();b=!0}null===(C=a.store)||void 0===C||C.recordJoinChannelService({urls:p.map(A=>A.url),service:"gateway"},o),p.forEach(A=>{A.onopen=()=>{if(h)return;const D=Date.now()-R;T.debug("[choose-best-ws] ws open cost ".concat(D,"ms")),p.filter(M=>M!==A).forEach(M=>{T.debug("[choose-best-ws]close backup websocket: ".concat(M.url)),M.close()}),h=!0,l(A)},A.onclose=D=>{g=D,!h&&(p.find(M=>!(M.readyState===WebSocket.CLOSED||M.readyState===WebSocket.CLOSING))||(T.debug("[choose-best-ws] all websocket is closed"),h=!0,d(g)))},A.onmessage=D=>{T.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(D.data))}}),Ii(a.forceCloseTimeout).then(()=>{p.forEach(A=>{A.readyState!==WebSocket.OPEN&&A.close()})})}if(b){var N;let R;T.debug("[choose-best-ws] use single url: ",r),null===(N=a.store)||void 0===N||N.recordJoinChannelService({urls:[r],service:"gateway"},o);try{R=new WebSocket(r),p.push(R),R.binaryType="arraybuffer"}catch(A){const D=new Y(k.WS_ERR,"init websocket failed! Error: ".concat(A.toString()));return T.error("[".concat(a.name,"]").concat(D)),void d(D)}R.onopen=()=>{l(R)},R.onclose=A=>{d(A)},R.onmessage=A=>{T.debug("[choose-best-ws]".concat(R.url," onmessage: ").concat(A.data))},Ii(a.forceCloseTimeout).then(()=>{R&&R.readyState!==WebSocket.OPEN&&R.close()})}}).then(l=>(a.closeEstablishingWs=void 0,l)).catch(l=>{throw a.closeEstablishingWs=void 0,l})})()}}class M_ extends nn{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===qt.CONNECTED?this.emit(Me.WS_CONNECTED):r===qt.RECONNECTING?this.emit(Me.WS_RECONNECTING,this._websocketReconnectReason):r===qt.CLOSED&&this.emit(Me.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,o){super(),O(this,"_disconnectedReason",void 0),O(this,"_websocketReconnectReason",void 0),O(this,"_connectionState",qt.CLOSED),O(this,"reconnectToken",void 0),O(this,"websocket",void 0),O(this,"openConnectionTime",void 0),O(this,"clientId",void 0),O(this,"lastMsgTime",Date.now()),O(this,"uploadCache",[]),O(this,"uploadCacheInterval",void 0),O(this,"rttRolling",new S_(5)),O(this,"pingpongTimer",void 0),O(this,"wsInflateDataTimer",void 0),O(this,"pingpongTimeoutCount",0),O(this,"joinResponse",void 0),O(this,"multiIpOption",void 0),O(this,"initError",void 0),O(this,"spec",void 0),O(this,"store",void 0),O(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(Me.ON_BINARY_DATA,a.data);const l=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(l,"_id")){const d="res-@".concat(l._id);this.emit(d,l._result,l._message)}else if(Object.prototype.hasOwnProperty.call(l,"_type")){if(this.emit(l._type,l._message),l._type===qe.ON_NOTIFICATION&&this.handleNotification(l._message),l._type===qe.ON_USER_BANNED)switch(l._message.error_code){case 14:this.close(Rt.UID_BANNED);break;case 15:this.close(Rt.IP_BANNED);break;case 16:this.close(Rt.CHANNEL_BANNED)}if(l._type===qe.ON_USER_LICENSE_BANNED)switch(l._message.error_code){case we.ERR_LICENSE_MISSING:this.close(Rt.LICENSE_MISSING);break;case we.ERR_LICENSE_EXPIRED:this.close(Rt.LICENSE_EXPIRED);break;case we.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Rt.LICENSE_MINUTES_EXCEEDED);break;case we.ERR_LICENSE_PERIOD_INVALID:this.close(Rt.LICENSE_PERIOD_INVALID);break;case we.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Rt.LICENSE_MULTIPLE_SDK_SERVICE);break;case we.ERR_LICENSE_ILLEGAL:this.close(Rt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=o,this.websocket=new xR("gateway-".concat(this.clientId),this.spec.retryConfig,!0,V("JOIN_GATEWAY_USE_DUAL_DOMAIN"),V("JOIN_GATEWAY_USE_443PORT_ONLY"),o),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===qt.CONNECTED&&this.reconnect("retry",Hi.OFFLINE)})}request(r,o,a,l){var d=this;return L(function*(){const h=Ct(6,""),p={_id:h,_type:r,_message:o},m=d.websocket.connectionID,g=()=>new le((R,A)=>{if(d.connectionState===qt.CONNECTED)return R();const D=()=>{d.off(Me.WS_CLOSED,M),R()},M=()=>{d.off(Me.WS_CONNECTED,D),A(new z(k.WS_ABORT))};d.once(Me.WS_CONNECTED,D),d.once(Me.WS_CLOSED,M),r!==Pe.PUBLISH&&r!==Pe.PUBLISH_DATASTREAM&&r!==Pe.SUBSCRIBE&&r!==Pe.SUBSCRIBE_DATASTREAM&&r!==Pe.UNSUBSCRIBE&&r!==Pe.UNSUBSCRIBE_DATASTREAM&&r!==Pe.UNPUBLISH&&r!==Pe.UNPUBLISH_DATASTREAM&&r!==Pe.CONTROL&&r!==Pe.RESTART_ICE||d.once(Me.DISCONNECT_P2P,()=>{A(new z(k.DISCONNECT_P2P))}),r!==Pe.PUBLISH&&r!==Pe.RESTART_ICE||d.once(Me.ABORT_P2P_EXECUTION,()=>{A(new z(k.DISCONNECT_P2P))})});if(d.connectionState!==qt.CONNECTING&&d.connectionState!==qt.RECONNECTING||r===Pe.JOIN||r===Pe.REJOIN||(yield g()),d.websocket.sendMessage(p,!0),l)return;const v=new le((R,A)=>{let D=!1;const M=(j,W)=>{D=!0,R({isSuccess:"success"===j,message:W||{}}),d.off(Me.WS_CLOSED,x),d.off(Me.WS_RECONNECTING,x),d.emit(Me.REQUEST_SUCCESS,r,o)};d.once("res-@".concat(h),M);const x=()=>{A(new z(k.WS_ABORT,"type: ".concat(r))),d.off(Me.WS_CLOSED,x),d.off(Me.WS_RECONNECTING,x),d.off("res-@".concat(h),M)};d.once(Me.WS_CLOSED,x),d.once(Me.WS_RECONNECTING,x),Ii(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||D||(T.warning("[".concat(d.clientId,"] ws request timeout, type: ").concat(r)),d.emit(Me.REQUEST_TIMEOUT,r,o))})});let y=null;try{y=yield v}catch(R){if(d.connectionState===qt.CLOSED||r===Pe.LEAVE)throw new z(k.WS_ABORT);return!d.spec.forceWaitGatewayResponse||a?R.throw():r===Pe.JOIN||r===Pe.REJOIN?null:(yield g(),yield d.request(r,o))}if(y.isSuccess)return y.message;const b=Number(y.message.error_code||y.message.code),C=Df(b),N=new z(k.UNEXPECTED_RESPONSE,"".concat(C.desc,": ").concat(y.message.error_str),{code:b,data:y.message,desc:C.desc});return"success"===C.action?y.message:(T.warning("[".concat(d.clientId,"] [").concat(d.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(b,", message: ").concat(C.desc,", action: ").concat(C.action)),b===we.ERR_TOO_MANY_BROADCASTERS?((r===Pe.JOIN||r===Pe.REJOIN)&&(d.initError=N,d.close()),N.throw()):"failed"===C.action?N.throw():"quit"===C.action?(d.initError=N,d.close(),N.throw()):(b===we.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=y.message.option,T.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",Hi.MULTI_IP)):d.reconnect(C.action,Hi.SERVER_ERROR),r===Pe.JOIN||r===Pe.REJOIN?null:yield d.request(r,o)))})()}waitMessage(r,o){return new le(a=>{const l=d=>{(!o||o(d))&&(this.off(r,l),a(d))};this.on(r,l)})}uploadWRTCStats(r){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const o={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(A_.WRTC_STATS,o)}upload(r,o){const a={_type:r,_message:o};try{this.websocket.sendMessage(a)}catch{const d=V("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==qt.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},V("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,o){this.websocket.sendMessage({_type:r,_message:o})}init(r,o){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new le((a,l)=>{this.once(Me.WS_CONNECTED,()=>a(this.joinResponse)),this.once(Me.WS_CLOSED,()=>l(this.initError||new z(k.WS_ABORT))),this.connectionState=qt.CONNECTING,this.websocket.init(r).catch(l),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||Rt.LEAVE,this.connectionState=qt.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}join(){var r=this;return L(function*(){if(!r.joinResponse){r.emit(Me.ABORT_P2P_EXECUTION);const o=yield Gi(r,Me.REQUEST_JOIN_INFO),a=yield r.request(Pe.JOIN,o);if(!a)return r.emit(Me.REPORT_JOIN_GATEWAY,D_.TIMEOUT,r.url||""),!1;r.joinResponse=a,r.emit(Me.JOIN_RESPONSE,r.joinResponse),r.reconnectToken=r.joinResponse.rejoin_token}return r.connectionState=qt.CONNECTED,r.pingpongTimer&&window.clearInterval(r.pingpongTimer),r.pingpongTimer=window.setInterval(r.handlePingPong.bind(r),3e3),!0})()}rejoin(){var r=this;return L(function*(){if(!r.reconnectToken)throw new z(k.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const o=E_(r,Me.REQUEST_REJOIN_INFO);o.token=r.reconnectToken;const a=yield r.request(Pe.REJOIN,o);return!!a&&(r.connectionState=qt.CONNECTED,r.pingpongTimer&&window.clearInterval(r.pingpongTimer),r.pingpongTimer=window.setInterval(r.handlePingPong.bind(r),3e3),a.peers&&a.peers.forEach(l=>{r.emit(qe.ON_USER_ONLINE,{uid:l.uid}),l.audio&&r.emit(qe.ON_ADD_AUDIO_STREAM,{uid:l.uid,uint_id:l.uint_id,audio:!0,ssrcId:l.audio_ssrc}),l.video&&r.emit(qe.ON_ADD_VIDEO_STREAM,{uid:l.uid,uint_id:l.uint_id,video:!0,ssrcId:l.video_ssrc}),r.emit(l.audio_mute?qe.MUTE_AUDIO:qe.UNMUTE_AUDIO,{uid:l.uid}),r.emit(l.video_mute?qe.MUTE_VIDEO:qe.UNMUTE_VIDEO,{uid:l.uid}),r.emit(l.audio_enable_local?qe.ENABLE_LOCAL_AUDIO:qe.DISABLE_LOCAL_AUDIO,{uid:l.uid}),r.emit(l.video_enable_local?qe.ENABLE_LOCAL_VIDEO:qe.DISABLE_LOCAL_VIDEO,{uid:l.uid}),l.audio||l.video||r.emit(qe.ON_REMOVE_STREAM,{uid:l.uid,uint_id:l.uint_id})}),!0)})()}reconnect(r,o){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,o)}handleNotification(r){T.debug("[".concat(this.clientId,"] receive notification: "),r);const o=Df(r.code);if(28===r.code&&"detail"in r&&(T.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(Me.RECOVER_NOTIFICATION,r.detail)),"success"!==o.action){if("failed"!==o.action)return"quit"===o.action?("ERR_REPEAT_JOIN_CHANNEL"===o.desc&&this.close(Rt.UID_BANNED),void this.close()):void this.reconnect(o.action,Hi.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),o.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=V("PING_PONG_TIME_OUT"),o=Date.now();this.pingpongTimeoutCount>=r&&(T.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(o-this.lastMsgTime,"ms")),o-this.lastMsgTime>V("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Hi.TIMEOUT):this.request(Pe.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-o;this.rttRolling.add(a),V("REPORT_STATS")&&this.send(Pe.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:o}=this.websocket.getWsInflateData();0!==r&&0!==o&&this.upload(A_.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:o,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(Fe.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Me.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Fe.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Fe.CLOSED,()=>{this.connectionState=qt.CLOSED}),this.websocket.on(Fe.FAILED,()=>{this._disconnectedReason=Rt.NETWORK_ERROR,this.connectionState=qt.CLOSED}),this.websocket.on(Fe.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState=this.connectionState===qt.CONNECTED?qt.RECONNECTING:qt.CONNECTING}),this.websocket.on(Fe.WILL_RECONNECT,(r,o,a)=>{const l=E_(this,Me.IS_P2P_DISCONNECTED),d=l||"retry"!==r;l&&"retry"===r&&(T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",o=D_.P2P_DISCONNECTED),d&&(T.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(Me.REPORT_JOIN_GATEWAY,o||D_.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Me.DISCONNECT_P2P)),a(r)}),this.websocket.on(Fe.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",Hi.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Me.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof z){if(r.code===k.UNEXPECTED_RESPONSE&&r.data.code===we.ERR_NO_AUTHORIZED)return this.initError=new z(k.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Hi.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Hi.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(Fe.REQUEST_NEW_URLS,(r,o)=>{Gi(this,Me.REQUEST_RECOVER,this.multiIpOption).then(r).catch(o)}),this.websocket.on(Fe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(qe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(kR.PRE_CONNECT_PC,()=>{this.emit(Me.PRE_CONNECT_PC)})}}let jn=function(n){return n[n.CHOOSE_SERVER=11]="CHOOSE_SERVER",n[n.CLOUD_PROXY=18]="CLOUD_PROXY",n[n.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",n[n.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",n}({});function FR(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function k_(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?FR(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):FR(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}function mh(n){return n.match(/^[\.\:\d]+$/)?"".concat(n.replace(/[^\d]/g,"-"),".").concat(V("TURN_DOMAIN")):(T.debug("Cannot recognized as ip address: ".concat(n,", use as host")),n)}function _S(n,r){n.addresses||(n.addresses=[]);const o=function(p,m){if(V("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return p.map(y=>{let{ip:b,port:C}=y;return{address:"".concat(b,":").concat(C)}});const g=V("GATEWAY_DOMAINS");let v=g[1]&&he(m).call(m,g[1])?1:0;return p.map(y=>{let{domain_prefix:b,port:C,ip:N}=y;if(b)return{address:"".concat(b,".").concat(g[v++%g.length],":").concat(C)};const R=/^[\.\:\d]+$/.test(N),A=R?"".concat(N.replace(/[^\d]/g,"-"),".").concat(g[v++%g.length],":").concat(C):"".concat(N,":").concat(C);return R||T.debug("Cannot recognized as ip address: ".concat(N,", use as host")),{ip:N,port:C,address:A}})}(n.addresses,r),a=Array.isArray(n.detail)&&n.detail[18];if(a&&"string"==typeof a){const p=a.split(";");for(let m=0;m<p.length;m++){var l;const g=Er(l=p[m]).call(l);o[m]&&g&&(o[m].ip6=g)}}const d=n.detail&&n.detail.candidate;let h;if(d){const[p,m]=d.split(":");p&&m&&(h={port:Number(m),ip:p,address:"".concat(p,":").concat(m)})}return{gatewayAddrs:o,apGatewayAddress:h,uid:n.uid,cid:n.cid,cert:n.cert,vid:n.detail&&n.detail[8],uni_lbs_ip:n.detail&&n.detail[1],res:n,csIp:n.detail&&n.detail[502]}}function Mr(n){return"number"==typeof n?n:n.exact||n.ideal||n.max||n.min||0}function IL(n){const r=n._encoderConfig;if(!r)return{};const o={resolution:r.width&&r.height?"".concat(Mr(r.width),"x").concat(Mr(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return"number"==typeof r.frameRate?(o.maxFrameRate=r.frameRate,o.minFrameRate=r.frameRate):r.frameRate&&(o.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,o.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),o}function w4(n){return n>=0&&n<.17?1:n>=.17&&n<.36?2:n>=.36&&n<.59?3:n>=.59&&n<=1?4:n>1?5:0}function vS(n,r){let o,a,l;switch(r){case jn.CHOOSE_SERVER:a=4096,l="choose server";break;case jn.CLOUD_PROXY:a=1048576,l="proxy";break;case jn.CLOUD_PROXY_5:a=4194304,l="proxy5";break;case jn.CLOUD_PROXY_FALLBACK:a=4194310,l="proxy fallback";break;default:throw new z(k.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:n.detail&&n.detail[502],retry:!1})}if(n.response_body.forEach(d=>{d.buffer&&d.buffer.flag===a&&(o={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>k_(k_({},h),{},{ticket:d.buffer.cert})),server_ts:n.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:k_(k_({},d.buffer.detail),n.detail),flag:d.buffer.flag,opid:n.opid,cert:d.buffer.cert})}),!o)throw new z(k.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(l," from multi unilbs response"),{csIp:n.detail&&n.detail[502]});return o}function L_(n,r){return UR.apply(this,arguments)}function UR(){return UR=L(function*(n,r){return yield le.all(n.addresses.map(function(){var o=L(function*(a){return{address:mh(a.ip),tcpport:a.port,udpport:a.port,username:r&&V("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Wi.username,password:r&&V("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?yield cR(r.toString()):Wi.password}});return function(a){return o.apply(this,arguments)}}()))}),UR.apply(this,arguments)}function VR(n,r){const o=r.getMediaStreamTrack(!0).getSettings(),a=r.videoHeight||o.height,l=r.videoWidth||o.width;return a&&l?Math.max(Math.min(a,l)/Math.min(Mr(n.height),Mr(n.width)),1):(T.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Pd(n){let{candidateType:r,relayProtocol:o,type:a,address:l,port:d,protocol:h}=n;const p={candidateType:r,relayProtocol:o,protocol:h};if("local-candidate"!==a){const m=l.split(".");m.length>=4&&(m[1]="*",m[2]="*"),p.address=m.join("."),p.port=d}return p}var $s,x_=Gt(IR),wL=Or("Array").values,R4=gr,A4=Ai,Oo=Ar,Of=wL,BR=Array.prototype,D4={DOMTokenList:!0,NodeList:!0},Md=Gt(function(n){var r=n.values;return n===BR||Oo(BR,n)&&r===BR.values||A4(D4,R4(n))?Of:r}),Nf=gs,jR=Ui,N4=Pt,ES=ii,P4=Lm,M4=uu,k4=So,HR=EE,gh=Object.assign,RL=Object.defineProperty,yS=xn([].concat),GR=!gh||N4(function(){if(Nf&&1!==gh({b:1},gh(RL({},"a",{enumerable:!0,get:function(){RL(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var n={},r={},o=Symbol(),a="abcdefghijklmnopqrst";return n[o]=7,a.split("").forEach(function(l){r[l]=l}),7!=gh({},n)[o]||ES(gh({},r)).join("")!=a})?function(n,r){for(var o=k4(n),a=arguments.length,l=1,d=P4.f,h=M4.f;a>l;)for(var p,m=HR(arguments[l++]),g=d?yS(ES(m),d(m)):ES(m),v=g.length,y=0;v>y;)p=g[y++],Nf&&!jR(h,m,p)||(o[p]=m[p]);return o}:gh,wW=Dr,AL=t0,L4=Ql,DL=Ui,Pf=So,x4=function(n,r,o,a){try{return a?r(wW(o)[0],o[1]):r(o)}catch(l){AL(n,"throw",l)}},OL=ON,WR=tg,RW=Wc,NL=il,F4=NN,U4=e0,zR=Array,kd=xn,KR=2147483647,PL=/[^\0-\u007E]/,qR=/[.\u3002\uFF0E\uFF61]/g,ML="Overflow: input needs wider integers to process",kL=RangeError,LL=kd(qR.exec),Mf=Math.floor,bS=String.fromCharCode,YR=kd("".charCodeAt),$R=kd([].join),El=kd([].push),V4=kd("".replace),B4=kd("".split),AW=kd("".toLowerCase),XR=function(n){return n+22+75*(n<26)},DW=function(n,r,o){var a=0;for(n=o?Mf(n/700):n>>1,n+=Mf(n/r);n>455;)n=Mf(n/35),a+=36;return Mf(a+36*n/(n+38))},OW=function(n){var o,a,r=[],l=(n=function(D){for(var M=[],x=0,j=D.length;x<j;){var W=YR(D,x++);if(W>=55296&&W<=56319&&x<j){var q=YR(D,x++);56320==(64512&q)?El(M,((1023&W)<<10)+(1023&q)+65536):(El(M,W),x--)}else El(M,W)}return M}(n)).length,d=128,h=0,p=72;for(o=0;o<n.length;o++)(a=n[o])<128&&El(r,bS(a));var m=r.length,g=m;for(m&&El(r,"-");g<l;){var v=KR;for(o=0;o<n.length;o++)(a=n[o])>=d&&a<v&&(v=a);var y=g+1;if(v-d>Mf((KR-h)/y))throw kL(ML);for(h+=(v-d)*y,d=v,o=0;o<n.length;o++){if((a=n[o])<d&&++h>KR)throw kL(ML);if(a==d){for(var b=h,C=36;;){var N=C<=p?1:C>=p+26?26:C-p;if(b<N)break;var R=b-N,A=36-N;El(r,bS(XR(N+R%A))),b=Mf(R/A),C+=36}El(r,bS(XR(b))),p=DW(h,y,g==m),h=0,g++}}h++,d++}return $R(r,"")},NW=Ft,xL=gs,PW=Ob,FL=ti,j4=Ql,ka=xn,Cc=Vs,La=wp,MW=Zm,SS=Ai,ZR=GR,Tc=function(n){var r=Pf(n),o=WR(this),a=arguments.length,l=a>1?arguments[1]:void 0,d=void 0!==l;d&&(l=L4(l,a>2?arguments[2]:void 0));var h,p,m,g,v,y,b=U4(r),C=0;if(!b||this===zR&&OL(b))for(h=RW(r),p=o?new this(h):zR(h);h>C;C++)y=d?l(r[C],C):r[C],NL(p,C,y);else for(v=(g=F4(r,b)).next,p=o?new this:[];!(m=DL(v,g)).done;C++)y=d?x4(g,l,[m.value,C],!0):m.value,NL(p,C,y);return p.length=C,p},ss=bM,H4=pg.codeAt,yl=Yo,W4=lc,z4=Ti,UL=$i,BL=Cu.set,CS=Cu.getterFor("URL"),K4=UL.URLSearchParams,q4=UL.getState,F_=FL.URL,JR=FL.TypeError,TS=FL.parseInt,Y4=Math.floor,jL=Math.pow,Xs=ka("".charAt),xa=ka(/./.exec),U_=ka([].join),$4=ka(1..toString),X4=ka([].pop),_h=ka([].push),V_=ka("".replace),Z4=ka([].shift),J4=ka("".split),kf=ka("".slice),IS=ka("".toLowerCase),HL=ka([].unshift),GL="Invalid scheme",vh="Invalid host",QR="Invalid port",B_=/[a-z]/i,eA=/[\d+-.a-z]/i,j_=/\d/,Q4=/^0x/i,tA=/^[0-7]+$/,H_=/^\d+$/,nA=/^[\da-f]+$/i,e5=/[\0\t\n\r #%/:<>?@[\\\]^|]/,WL=/[\0\t\n\r #/:<>?@[\\\]^|]/,wS=/^[\u0000-\u0020]+/,kW=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,zL=/[\t\n\r]/g,G_=function(n){var r,o,a,l;if("number"==typeof n){for(r=[],o=0;o<4;o++)HL(r,n%256),n=Y4(n/256);return U_(r,".")}if("object"==typeof n){for(r="",a=function(d){for(var h=null,p=1,m=null,g=0,v=0;v<8;v++)0!==d[v]?(g>p&&(h=m,p=g),m=null,g=0):(null===m&&(m=v),++g);return g>p&&(h=m,p=g),h}(n),o=0;o<8;o++)l&&0===n[o]||(l&&(l=!1),a===o?(r+=o?":":"::",l=!0):(r+=$4(n[o],16),o<7&&(r+=":")));return"["+r+"]"}return n},iA={},KL=ZR({},iA,{" ":1,'"':1,"<":1,">":1,"`":1}),qL=ZR({},KL,{"#":1,"?":1,"{":1,"}":1}),RS=ZR({},qL,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Sr=function(n,r){var o=H4(n,0);return o>32&&o<127&&!SS(r,n)?n:encodeURIComponent(n)},Eh={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Ld=function(n,r){var o;return 2==n.length&&xa(B_,Xs(n,0))&&(":"==(o=Xs(n,1))||!r&&"|"==o)},rA=function(n){var r;return n.length>1&&Ld(kf(n,0,2))&&(2==n.length||"/"===(r=Xs(n,2))||"\\"===r||"?"===r||"#"===r)},t5=function(n){return"."===n||"%2e"===IS(n)},oA={},YL={},sA={},n5={},$L={},AS={},XL={},ZL={},Lf={},aA={},W_={},cA={},DS={},z_={},lA={},JL={},Ic={},bl={},QL={},No={},Sl={},ex=function(n,r,o){var a,l,d,h=yl(n);if(r){if(l=this.parse(h))throw JR(l);this.searchParams=null}else{if(void 0!==o&&(a=new ex(o,!0)),l=this.parse(h,null,a))throw JR(l);(d=q4(new K4)).bindURL(this),this.searchParams=d}};ex.prototype={type:"URL",parse:function(n,r,o){var a,l,d,h,p,m=this,g=r||oA,v=0,y="",b=!1,C=!1,N=!1;for(n=yl(n),r||(m.scheme="",m.username="",m.password="",m.host=null,m.port=null,m.path=[],m.query=null,m.fragment=null,m.cannotBeABaseURL=!1,n=V_(n,wS,""),n=V_(n,kW,"$1")),n=V_(n,zL,""),a=Tc(n);v<=a.length;){switch(l=a[v],g){case oA:if(!l||!xa(B_,l)){if(r)return GL;g=sA;continue}y+=IS(l),g=YL;break;case YL:if(l&&(xa(eA,l)||"+"==l||"-"==l||"."==l))y+=IS(l);else{if(":"!=l){if(r)return GL;y="",g=sA,v=0;continue}if(r&&(m.isSpecial()!=SS(Eh,y)||"file"==y&&(m.includesCredentials()||null!==m.port)||"file"==m.scheme&&!m.host))return;if(m.scheme=y,r)return void(m.isSpecial()&&Eh[m.scheme]==m.port&&(m.port=null));y="","file"==m.scheme?g=z_:m.isSpecial()&&o&&o.scheme==m.scheme?g=n5:m.isSpecial()?g=ZL:"/"==a[v+1]?(g=$L,v++):(m.cannotBeABaseURL=!0,_h(m.path,""),g=QL)}break;case sA:if(!o||o.cannotBeABaseURL&&"#"!=l)return GL;if(o.cannotBeABaseURL&&"#"==l){m.scheme=o.scheme,m.path=ss(o.path),m.query=o.query,m.fragment="",m.cannotBeABaseURL=!0,g=Sl;break}g="file"==o.scheme?z_:AS;continue;case n5:if("/"!=l||"/"!=a[v+1]){g=AS;continue}g=Lf,v++;break;case $L:if("/"==l){g=aA;break}g=bl;continue;case AS:if(m.scheme=o.scheme,l==$s)m.username=o.username,m.password=o.password,m.host=o.host,m.port=o.port,m.path=ss(o.path),m.query=o.query;else if("/"==l||"\\"==l&&m.isSpecial())g=XL;else if("?"==l)m.username=o.username,m.password=o.password,m.host=o.host,m.port=o.port,m.path=ss(o.path),m.query="",g=No;else{if("#"!=l){m.username=o.username,m.password=o.password,m.host=o.host,m.port=o.port,m.path=ss(o.path),m.path.length--,g=bl;continue}m.username=o.username,m.password=o.password,m.host=o.host,m.port=o.port,m.path=ss(o.path),m.query=o.query,m.fragment="",g=Sl}break;case XL:if(!m.isSpecial()||"/"!=l&&"\\"!=l){if("/"!=l){m.username=o.username,m.password=o.password,m.host=o.host,m.port=o.port,g=bl;continue}g=aA}else g=Lf;break;case ZL:if(g=Lf,"/"!=l||"/"!=Xs(y,v+1))continue;v++;break;case Lf:if("/"!=l&&"\\"!=l){g=aA;continue}break;case aA:if("@"==l){b&&(y="%40"+y),b=!0,d=Tc(y);for(var R=0;R<d.length;R++){var A=d[R];if(":"!=A||N){var D=Sr(A,RS);N?m.password+=D:m.username+=D}else N=!0}y=""}else if(l==$s||"/"==l||"?"==l||"#"==l||"\\"==l&&m.isSpecial()){if(b&&""==y)return"Invalid authority";v-=Tc(y).length+1,y="",g=W_}else y+=l;break;case W_:case cA:if(r&&"file"==m.scheme){g=JL;continue}if(":"!=l||C){if(l==$s||"/"==l||"?"==l||"#"==l||"\\"==l&&m.isSpecial()){if(m.isSpecial()&&""==y)return vh;if(r&&""==y&&(m.includesCredentials()||null!==m.port))return;if(h=m.parseHost(y))return h;if(y="",g=Ic,r)return;continue}"["==l?C=!0:"]"==l&&(C=!1),y+=l}else{if(""==y)return vh;if(h=m.parseHost(y))return h;if(y="",g=DS,r==cA)return}break;case DS:if(!xa(j_,l)){if(l==$s||"/"==l||"?"==l||"#"==l||"\\"==l&&m.isSpecial()||r){if(""!=y){var M=TS(y,10);if(M>65535)return QR;m.port=m.isSpecial()&&M===Eh[m.scheme]?null:M,y=""}if(r)return;g=Ic;continue}return QR}y+=l;break;case z_:if(m.scheme="file","/"==l||"\\"==l)g=lA;else{if(!o||"file"!=o.scheme){g=bl;continue}if(l==$s)m.host=o.host,m.path=ss(o.path),m.query=o.query;else if("?"==l)m.host=o.host,m.path=ss(o.path),m.query="",g=No;else{if("#"!=l){rA(U_(ss(a,v),""))||(m.host=o.host,m.path=ss(o.path),m.shortenPath()),g=bl;continue}m.host=o.host,m.path=ss(o.path),m.query=o.query,m.fragment="",g=Sl}}break;case lA:if("/"==l||"\\"==l){g=JL;break}o&&"file"==o.scheme&&!rA(U_(ss(a,v),""))&&(Ld(o.path[0],!0)?_h(m.path,o.path[0]):m.host=o.host),g=bl;continue;case JL:if(l==$s||"/"==l||"\\"==l||"?"==l||"#"==l){if(!r&&Ld(y))g=bl;else if(""==y){if(m.host="",r)return;g=Ic}else{if(h=m.parseHost(y))return h;if("localhost"==m.host&&(m.host=""),r)return;y="",g=Ic}continue}y+=l;break;case Ic:if(m.isSpecial()){if(g=bl,"/"!=l&&"\\"!=l)continue}else if(r||"?"!=l)if(r||"#"!=l){if(l!=$s&&(g=bl,"/"!=l))continue}else m.fragment="",g=Sl;else m.query="",g=No;break;case bl:if(l==$s||"/"==l||"\\"==l&&m.isSpecial()||!r&&("?"==l||"#"==l)){if(".."===(p=IS(p=y))||"%2e."===p||".%2e"===p||"%2e%2e"===p?(m.shortenPath(),"/"==l||"\\"==l&&m.isSpecial()||_h(m.path,"")):t5(y)?"/"==l||"\\"==l&&m.isSpecial()||_h(m.path,""):("file"==m.scheme&&!m.path.length&&Ld(y)&&(m.host&&(m.host=""),y=Xs(y,0)+":"),_h(m.path,y)),y="","file"==m.scheme&&(l==$s||"?"==l||"#"==l))for(;m.path.length>1&&""===m.path[0];)Z4(m.path);"?"==l?(m.query="",g=No):"#"==l&&(m.fragment="",g=Sl)}else y+=Sr(l,qL);break;case QL:"?"==l?(m.query="",g=No):"#"==l?(m.fragment="",g=Sl):l!=$s&&(m.path[0]+=Sr(l,iA));break;case No:r||"#"!=l?l!=$s&&("'"==l&&m.isSpecial()?m.query+="%27":m.query+="#"==l?"%23":Sr(l,iA)):(m.fragment="",g=Sl);break;case Sl:l!=$s&&(m.fragment+=Sr(l,KL))}v++}},parseHost:function(n){var r,o,a;if("["==Xs(n,0)){if("]"!=Xs(n,n.length-1)||!(r=function(l){var d,h,p,m,g,v,y,b=[0,0,0,0,0,0,0,0],C=0,N=null,R=0,A=function(){return Xs(l,R)};if(":"==A()){if(":"!=Xs(l,1))return;R+=2,N=++C}for(;A();){if(8==C)return;if(":"!=A()){for(d=h=0;h<4&&xa(nA,A());)d=16*d+TS(A(),16),R++,h++;if("."==A()){if(0==h||(R-=h,C>6))return;for(p=0;A();){if(m=null,p>0){if(!("."==A()&&p<4))return;R++}if(!xa(j_,A()))return;for(;xa(j_,A());){if(g=TS(A(),10),null===m)m=g;else{if(0==m)return;m=10*m+g}if(m>255)return;R++}b[C]=256*b[C]+m,2!=++p&&4!=p||C++}if(4!=p)return;break}if(":"==A()){if(R++,!A())return}else if(A())return;b[C++]=d}else{if(null!==N)return;R++,N=++C}}if(null!==N)for(v=C-N,C=7;0!=C&&v>0;)y=b[C],b[C--]=b[N+v-1],b[N+--v]=y;else if(8!=C)return;return b}(kf(n,1,-1))))return vh;this.host=r}else if(this.isSpecial()){if(n=function(n){var r,o,a=[],l=B4(V4(AW(n),qR,"."),".");for(r=0;r<l.length;r++)El(a,LL(PL,o=l[r])?"xn--"+OW(o):o);return $R(a,".")}(n),xa(e5,n)||null===(r=function(l){var d,h,p,m,g,v,y,b=J4(l,".");if(b.length&&""==b[b.length-1]&&b.length--,(d=b.length)>4)return l;for(h=[],p=0;p<d;p++){if(""==(m=b[p]))return l;if(g=10,m.length>1&&"0"==Xs(m,0)&&(g=xa(Q4,m)?16:8,m=kf(m,8==g?1:2)),""===m)v=0;else{if(!xa(10==g?H_:8==g?tA:nA,m))return l;v=TS(m,g)}_h(h,v)}for(p=0;p<d;p++)if(v=h[p],p==d-1){if(v>=jL(256,5-d))return null}else if(v>255)return null;for(y=X4(h),p=0;p<h.length;p++)y+=h[p]*jL(256,3-p);return y}(n)))return vh;this.host=r}else{if(xa(WL,n))return vh;for(r="",o=Tc(n),a=0;a<o.length;a++)r+=Sr(o[a],iA);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return SS(Eh,this.scheme)},shortenPath:function(){var n=this.path,r=n.length;!r||"file"==this.scheme&&1==r&&Ld(n[0],!0)||n.length--},serialize:function(){var n=this,r=n.scheme,o=n.username,a=n.password,l=n.host,d=n.port,h=n.path,p=n.query,m=n.fragment,g=r+":";return null!==l?(g+="//",n.includesCredentials()&&(g+=o+(a?":"+a:"")+"@"),g+=G_(l),null!==d&&(g+=":"+d)):"file"==r&&(g+="//"),g+=n.cannotBeABaseURL?h[0]:h.length?"/"+U_(h,"/"):"",null!==p&&(g+="?"+p),null!==m&&(g+="#"+m),g},setHref:function(n){var r=this.parse(n);if(r)throw JR(r);this.searchParams.update()},getOrigin:function(){var n=this.scheme,r=this.port;if("blob"==n)try{return new K_(n.path[0]).origin}catch{return"null"}return"file"!=n&&this.isSpecial()?n+"://"+G_(this.host)+(null!==r?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(n){this.parse(yl(n)+":",oA)},getUsername:function(){return this.username},setUsername:function(n){var r=Tc(yl(n));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var o=0;o<r.length;o++)this.username+=Sr(r[o],RS)}},getPassword:function(){return this.password},setPassword:function(n){var r=Tc(yl(n));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var o=0;o<r.length;o++)this.password+=Sr(r[o],RS)}},getHost:function(){var n=this.host,r=this.port;return null===n?"":null===r?G_(n):G_(n)+":"+r},setHost:function(n){this.cannotBeABaseURL||this.parse(n,W_)},getHostname:function(){var n=this.host;return null===n?"":G_(n)},setHostname:function(n){this.cannotBeABaseURL||this.parse(n,cA)},getPort:function(){var n=this.port;return null===n?"":yl(n)},setPort:function(n){this.cannotHaveUsernamePasswordPort()||(""==(n=yl(n))?this.port=null:this.parse(n,DS))},getPathname:function(){var n=this.path;return this.cannotBeABaseURL?n[0]:n.length?"/"+U_(n,"/"):""},setPathname:function(n){this.cannotBeABaseURL||(this.path=[],this.parse(n,Ic))},getSearch:function(){var n=this.query;return n?"?"+n:""},setSearch:function(n){""==(n=yl(n))?this.query=null:("?"==Xs(n,0)&&(n=kf(n,1)),this.query="",this.parse(n,No)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var n=this.fragment;return n?"#"+n:""},setHash:function(n){""!=(n=yl(n))?("#"==Xs(n,0)&&(n=kf(n,1)),this.fragment="",this.parse(n,Sl)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var K_=function(n){var r=MW(this,Po),o=z4(arguments.length,1)>1?arguments[1]:void 0,a=BL(r,new ex(n,!1,o));xL||(r.href=a.serialize(),r.origin=a.getOrigin(),r.protocol=a.getProtocol(),r.username=a.getUsername(),r.password=a.getPassword(),r.host=a.getHost(),r.hostname=a.getHostname(),r.port=a.getPort(),r.pathname=a.getPathname(),r.search=a.getSearch(),r.searchParams=a.getSearchParams(),r.hash=a.getHash())},Po=K_.prototype,Zs=function(n,r){return{get:function(){return CS(this)[n]()},set:r&&function(o){return CS(this)[r](o)},configurable:!0,enumerable:!0}};if(xL&&(La(Po,"href",Zs("serialize","setHref")),La(Po,"origin",Zs("getOrigin")),La(Po,"protocol",Zs("getProtocol","setProtocol")),La(Po,"username",Zs("getUsername","setUsername")),La(Po,"password",Zs("getPassword","setPassword")),La(Po,"host",Zs("getHost","setHost")),La(Po,"hostname",Zs("getHostname","setHostname")),La(Po,"port",Zs("getPort","setPort")),La(Po,"pathname",Zs("getPathname","setPathname")),La(Po,"search",Zs("getSearch","setSearch")),La(Po,"searchParams",Zs("getSearchParams")),La(Po,"hash",Zs("getHash","setHash"))),Cc(Po,"toJSON",function(){return CS(this).serialize()},{enumerable:!0}),Cc(Po,"toString",function(){return CS(this).serialize()},{enumerable:!0}),F_){var dA=F_.createObjectURL,r5=F_.revokeObjectURL;dA&&Cc(K_,"createObjectURL",j4(dA,F_)),r5&&Cc(K_,"revokeObjectURL",j4(r5,F_))}W4(K_,"URL"),NW({global:!0,constructor:!0,forced:!PW,sham:!xL},{URL:K_});var o5=Ft,s5=Pt,OS=Ti,q_=Yo,tx=Ob,nx=yo("URL");o5({target:"URL",stat:!0,forced:!(tx&&s5(function(){nx.canParse()}))},{canParse:function(n){var r=OS(arguments.length,1),o=q_(n),a=r<2||void 0===arguments[1]?void 0:q_(arguments[1]);try{return!!new nx(o,a)}catch{return!1}}});var uA=Gt(to.URL);const Hn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function ct(){return Hn}function ix(){return"setSinkId"in HTMLAudioElement.prototype&&(!V("RESTRICTION_SET_PLAYBACK_DEVICE")||(lh()||Jb())&&!rR())}function a5(){return!Hn.supportUnifiedPlan||V("CHROME_FORCE_PLAN_B")&&hl()}let wi=function(n){return n.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",n.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",n.IOS_INTERRUPTION_START="ios-interruption-start",n.IOS_INTERRUPTION_END="ios-interruption-end",n.STATE_CHANGE="state-change",n}({});function xf(n,r,o){return{sampleRate:n,stereo:r,bitrate:o}}function Xe(n,r,o,a,l){return{width:n,height:r,frameRate:o,bitrateMin:a,bitrateMax:l}}function Fa(n,r,o,a,l){return{width:{max:n},height:{max:r},frameRate:o,bitrateMin:a,bitrateMax:l}}function hA(n,r){return{numSpatialLayers:n,numTemporalLayers:r}}const rx={"90p":Xe(160,90),"90p_1":Xe(160,90),"120p":Xe(160,120,15,30,65),"120p_1":Xe(160,120,15,30,65),"120p_3":Xe(120,120,15,30,50),"120p_4":Xe(212,120),"180p":Xe(320,180,15,30,140),"180p_1":Xe(320,180,15,30,140),"180p_3":Xe(180,180,15,30,100),"180p_4":Xe(240,180,15,30,120),"240p":Xe(320,240,15,40,200),"240p_1":Xe(320,240,15,40,200),"240p_3":Xe(240,240,15,40,140),"240p_4":Xe(424,240,15,40,220),"360p":Xe(640,360,15,80,400),"360p_1":Xe(640,360,15,80,400),"360p_3":Xe(360,360,15,80,260),"360p_4":Xe(640,360,30,80,600),"360p_6":Xe(360,360,30,80,400),"360p_7":Xe(480,360,15,80,320),"360p_8":Xe(480,360,30,80,490),"360p_9":Xe(640,360,15,80,800),"360p_10":Xe(640,360,24,80,800),"360p_11":Xe(640,360,24,80,1e3),"480p":Xe(640,480,15,100,500),"480p_1":Xe(640,480,15,100,500),"480p_2":Xe(640,480,30,100,1e3),"480p_3":Xe(480,480,15,100,400),"480p_4":Xe(640,480,30,100,750),"480p_6":Xe(480,480,30,100,600),"480p_8":Xe(848,480,15,100,610),"480p_9":Xe(848,480,30,100,930),"480p_10":Xe(640,480,10,100,400),"720p":Xe(1280,720,15,120,1130),"720p_auto":Xe(1280,720,30,900,3e3),"720p_1":Xe(1280,720,15,120,1130),"720p_2":Xe(1280,720,30,120,2e3),"720p_3":Xe(1280,720,30,120,1710),"720p_5":Xe(960,720,15,120,910),"720p_6":Xe(960,720,30,120,1380),"1080p":Xe(1920,1080,15,120,2080),"1080p_1":Xe(1920,1080,15,120,2080),"1080p_2":Xe(1920,1080,30,120,3e3),"1080p_3":Xe(1920,1080,30,120,3150),"1080p_5":Xe(1920,1080,60,120,4780),"1440p":Xe(2560,1440,30,120,4850),"1440p_1":Xe(2560,1440,30,120,4850),"1440p_2":Xe(2560,1440,60,120,7350),"4k":Xe(3840,2160,30,120,8910),"4k_1":Xe(3840,2160,30,120,8910),"4k_3":Xe(3840,2160,60,120,13500)},LW={"480p":Fa(640,480,5),"480p_1":Fa(640,480,5),"480p_2":Fa(640,480,30),"480p_3":Fa(640,480,15),"720p":Fa(1280,720,5),"720p_auto":Xe(1280,720,30,900,3e3),"720p_1":Fa(1280,720,5),"720p_2":Fa(1280,720,30),"720p_3":Fa(1280,720,15),"1080p":Fa(1920,1080,5),"1080p_1":Fa(1920,1080,5),"1080p_2":Fa(1920,1080,30),"1080p_3":Fa(1920,1080,15)},xW={"1SL1TL":hA(1,1),"3SL3TL":hA(3,3),"2SL3TL":hA(2,3)};function Cl(n){return n||(n="480p_1"),"string"==typeof n?Object.assign({},rx[n]):n}function ox(n){return"string"==typeof n?Object.assign({},LW[n]):n}function pA(n){return"string"==typeof n?Object.assign({},xW[n]):n}const FW={speech_low_quality:xf(16e3,!1),speech_standard:xf(32e3,!1,18),music_standard:xf(48e3,!1),standard_stereo:xf(48e3,!0,56),high_quality:xf(48e3,!1,128),high_quality_stereo:xf(48e3,!0,192)};function fA(n){return"string"==typeof n?Object.assign({},FW[n]):n}const yh=[];function Js(n){return fi(n,"mediaSource",["screen","window","application"]),!0}let ge=function(n){return n.NEED_RENEGOTIATE="@need_renegotiate",n.NEED_REPLACE_TRACK="@need_replace_track",n.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",n.NEED_CLOSE="@need_close",n.NEED_ENABLE_TRACK="@need_enable_track",n.NEED_DISABLE_TRACK="@need_disable_track",n.NEED_SESSION_ID="@need_sid",n.SET_OPTIMIZATION_MODE="@set_optimization_mode",n.GET_STATS="@get_stats",n.GET_RTC_STATS="@get_rtc_stats",n.GET_LOW_VIDEO_TRACK="@get_low_video_track",n.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",n.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",n.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",n.NEED_MUTE_TRACK="@need_mute_track",n.NEED_UNMUTE_TRACK="@need_unmute_track",n}({}),zt=function(n){return n.SCREEN_TRACK="screen_track",n.CUSTOM_TRACK="custome_track",n.LOW_STREAM="low_stream",n.SCREEN_LOW_TRACK="screen_low_track",n}({}),Y_=function(n){return n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM",n}({}),UW=function(n){return n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM",n[n.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",n[n.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",n[n.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",n[n.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",n[n.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",n[n.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",n}({}),VW=function(n){return n[n.DISABLE=0]="DISABLE",n[n.LOW_STREAM=1]="LOW_STREAM",n[n.AUDIO_ONLY=2]="AUDIO_ONLY",n[n.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",n[n.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",n[n.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",n[n.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",n[n.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",n[n.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",n}({}),Ff=function(n){return n.TRANSCEIVER_UPDATED="transceiver-updated",n.SEI_TO_SEND="sei-to-send",n.SEI_RECEIVED="sei-received",n.TRACK_UPDATED="track-updated",n}({}),$_=function(n){return n.SOURCE_STATE_CHANGE="source-state-change",n.TRACK_ENDED="track-ended",n.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",n.CLOSED="closed",n}({}),bh=function(n){return n.FIRST_FRAME_DECODED="first-frame-decoded",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",n.VIDEO_STATE_CHANGED="video-state-changed",n}({}),Tl=function(n){return n.AUDIO="audio",n.VIDEO="video",n.DATA="data",n}({}),as=function(n){return n.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",n.RECEIVE_TRACK_BUFFER="receive_track_buffer",n.ON_AUDIO_BUFFER="on_audio_buffer",n.UPDATE_SOURCE="update_source",n}({});const mA={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},NS={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},xd={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},sx={uplinkNetworkQuality:0,downlinkNetworkQuality:0},PS={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let hr=function(n){return n.ON_TRACK="on_track",n.ON_NODE="on_node",n}({}),cs=function(n){return n.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",n.REQUEST_CONSTRAINTS="request_constraints",n}({}),Sh=function(n){return n.IDLE="IDLE",n.INITING="INITING",n.INITEND="INITEND",n}({}),Il=function(n){return n.STATE_CHANGE="state_change",n.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",n.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",n.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",n}({}),Ki=function(n){return n.NONE="none",n.INIT="init",n.CANPLAY="canplay",n.PLAYING="playing",n.PAUSED="paused",n.SUSPEND="suspend",n.STALLED="stalled",n.WAITING="waiting",n.ERROR="error",n.DESTROYED="destroyed",n.ABORT="abort",n.ENDED="ended",n.EMPTIED="emptied",n.LOADEDDATA="loadeddata",n}({}),wl=function(n){return n[n.VideoStateStopped=0]="VideoStateStopped",n[n.VideoStateStarting=1]="VideoStateStarting",n[n.VideoStateDecoding=2]="VideoStateDecoding",n[n.VideoStateFrozen=3]="VideoStateFrozen",n}({});const ax={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let gA=function(n){return n.OPEN="open",n.MESSAGE="message",n.CLOSE="close",n.CLOSING="closing",n.ERROR="error",n}({});function Qe(n,r,o,a,l){var d,h,p={};return Object.keys(a).forEach(function(m){p[m]=a[m]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=Ue(d=x_(h=o.slice()).call(h)).call(d,function(m,g){return g(n,r,m)||m},p),l&&void 0!==p.initializer&&(p.value=p.initializer?p.initializer.call(l):void 0,p.initializer=void 0),void 0===p.initializer&&(Object.defineProperty(n,r,p),p=null),p}function $(n,r,o){return(r="symbol"==typeof(l=function(d){if("object"!=typeof d||!d)return d;var p=d[Symbol.toPrimitive];if(void 0!==p){var m=p.call(d,"string");if("object"!=typeof m)return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(r))?l:l+"")in n?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,n;var l}function cx(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function rn(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?cx(Object(o),!0).forEach(function(a){$(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):cx(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}class lx extends nn{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(Ff.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,o){super(),$(this,"trackMediaType",void 0),$(this,"_ID",void 0),$(this,"_rtpTransceiver",void 0),$(this,"_lowRtpTransceiver",void 0),$(this,"_hints",[]),$(this,"_isClosed",!1),$(this,"_originMediaStreamTrack",void 0),$(this,"mediaStreamTrack",void 0),$(this,"_external",{}),this._ID=o||Ct(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,he(yh).call(yh,this)||yh.push(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||vc(()=>{var o;be.reportApiInvoke(null,{name:Yn.GET_MEDIA_STREAM_TRACK,options:[],tag:st.TRACER}).onSuccess((null===(o=this._mediaStreamTrack)||void 0===o?void 0:o.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Y_.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const o=yh.indexOf(r);-1!==o&&yh.splice(o,1)}(this),this.emit($_.CLOSED),this.removeAllListeners(Ff.SEI_RECEIVED)}_updateRtpTransceiver(r,o){if(o===Y_.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(Ff.TRANSCEIVER_UPDATED,r,o)}}class Ch extends lx{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,o){super(r,o),$(this,"_enabled",!0),$(this,"_muted",!1),$(this,"_isExternalTrack",!1),$(this,"_isClosed",!1),$(this,"_enabledMutex",void 0),$(this,"processor",void 0),$(this,"_processorContext",void 0),$(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Qi("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,o;return null!==(r=null===(o=this._originMediaStreamTrack)||void 0===o?void 0:o.label)&&void 0!==r?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,T.debug("[".concat(this.getTrackId(),"] close")),this.emit(ge.NEED_CLOSE),super.close())}_updateOriginMediaStreamTrack(r,o){var a=arguments,l=this;return L(function*(){l._isExternalTrack=a.length>2&&void 0!==a[2]&&a[2],r!==l._originMediaStreamTrack&&(l._originMediaStreamTrack&&(l._originMediaStreamTrack.removeEventListener("ended",l._handleTrackEnded),o&&l._originMediaStreamTrack.stop()),r.addEventListener("ended",l._handleTrackEnded),l._originMediaStreamTrack=r,l._muted&&(l._originMediaStreamTrack.enabled=!1),l._mediaStreamTrack=l._originMediaStreamTrack,l._updatePlayerSource(),yield jt(l,ge.NEED_REPLACE_TRACK,l),l.processor&&l._processorContext&&l.processor.updateInput({track:l._originMediaStreamTrack,context:l._processorContext}))})()}_getDefaultPlayerConfig(){return{}}onTrackEnded(){T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($_.TRACK_ENDED)}stateCheck(r,o){if(T.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(o,"]")),pl(o,r),this._enabled&&this._muted&&"enabled"===r&&!1===o)throw new Y(k.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",T);if(!this._enabled&&!this._muted&&"muted"===r&&!0===o)throw new Y(k.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",T)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():le.resolve([])}}const _A=window.AudioContext||window.webkitAudioContext;let Mo=null;const xt=new class extends nn{constructor(){var n;super(...arguments),n=this,$(this,"prevState",void 0),$(this,"curState",void 0),$(this,"currentTime",void 0),$(this,"currentTimeStuckAt",void 0),$(this,"interruptDetectorTrack",void 0),$(this,"onLocalAudioTrackMute",()=>{T.info("ios15-interruption-start"),this.emit(wi.IOS_15_16_INTERRUPTION_START)}),$(this,"onLocalAudioTrackUnmute",L(function*(){T.info("ios15-interruption-end"),"running"!==n.curState||n.duringInterruption?T.info("ios15-interruption-end-canceled"):(Mo&&(yield Mo.suspend()),n.emit(wi.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(n){T.debug("webaudio bindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=n,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(n){T.debug("webaudio unbindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===n&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Uf(){if(!Mo){if(function(){if(!_A)return void T.error("your browser is not support web audio");T.info("create audio context");const n=rn({},V("WEBAUDIO_INIT_OPTIONS"));var r;T.debug("audio context init option:",JSON.stringify(n)),Mo=new _A(n),xt.curState=Mo.state,Mo.onstatechange=()=>{xt.prevState=xt.curState,xt.curState=Mo?Mo.state:void 0;const{prevState:r,curState:o}=xt,a="running"===o,l="interrupted"===o,d="running"===r,h="suspended"===r,p="interrupted"===r,m=ot().osVersion;(nt()||Ks())&&d&&l&&(T.info("ios".concat(m,"-interruption-start")),xt.emit(wi.IOS_INTERRUPTION_START)),(nt()||Ks())&&(h||p)&&a&&(T.info("ios".concat(m,"-interruption-end")),xt.emit(wi.IOS_INTERRUPTION_END)),r!==o&&xt.emit(wi.STATE_CHANGE,o,r)},setInterval(()=>{var r;const o=null===(r=Mo)||void 0===r?void 0:r.currentTime;xt.currentTime!==o?(xt.currentTimeStuckAt&&(T.debug("AudioContext current time resume at ".concat(o)),xt.currentTimeStuckAt=void 0),xt.currentTime=o):(o!==xt.currentTimeStuckAt&&(be.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:o},tag:st.TRACER}).onSuccess(),T.warning("AudioContext current time stuck at ".concat(o))),xt.currentTimeStuckAt=o)},5e3),(r=L(function*(o){const a=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let l,d=!1,h=!1,p=!1;function m(A){"running"===o.state?g(!1):nt()||Ks()?"suspended"===o.state&&(g(!0),A&&o.resume().then(v,v)):"closed"!==o.state&&(g(!0),A&&o.resume().then(v,v))}function g(A){if(d!==A){d=A;for(let D=0,M=a;D<M.length;D+=1){const x=M[D];A?window.addEventListener(x,y,{capture:!0,passive:!0}):window.removeEventListener(x,y,{capture:!0,passive:!0})}}}function v(){m(!1)}function y(){m(!0)}function b(A){if(!p)if(l.paused)if(A){let D;C(!1),p=!0;try{D=l.play(),D?D.then(N,N):(l.addEventListener("playing",N),l.addEventListener("abort",N),l.addEventListener("error",N))}catch{N()}}else C(!0);else C(!1)}function C(A){if(h!==A){h=A;for(let D=0,M=a;D<M.length;D++){const x=M[D];A?window.addEventListener(x,R,{capture:!0,passive:!0}):window.removeEventListener(x,R,{capture:!0,passive:!0})}}}function N(){l.removeEventListener("playing",N),l.removeEventListener("abort",N),l.removeEventListener("error",N),p=!1,b(!1)}function R(){b(!0)}if(nt()){const A=o.createMediaStreamDestination(),D=document.createElement("div");D.innerHTML="<audio x-webkit-airplay='deny'></audio>",l=D.children.item(0),l.controls=!1,l.disableRemotePlayback=!0,l.preload="auto",l.srcObject=A.stream,b(!0)}xt.on(wi.STATE_CHANGE,function(){m(!0)}),m(!1)}),function(o){return r.apply(this,arguments)})(Mo)}(),!Mo)throw new Y(k.NOT_SUPPORTED,"can not create audio context");return Mo}return Mo}function Fd(n){if(function(){if(null!==X_)return X_;const a=Uf(),l=a.createBufferSource(),d=a.createGain(),h=a.createGain();l.connect(d),l.connect(h),l.disconnect(d);let p=!1;try{l.disconnect(d)}catch{p=!0}return l.disconnect(),X_=p,p}())return;const r=n.connect,o=n.disconnect;n.connect=(a,l,d)=>{var h;return n._inputNodes||(n._inputNodes=[]),he(h=n._inputNodes).call(h,a)||(a instanceof AudioNode?(n._inputNodes.push(a),r.call(n,a,l,d)):r.call(n,a,l)),n},n.disconnect=(a,l,d)=>{o.call(n),a?Be(n._inputNodes,a):n._inputNodes=[];for(const h of n._inputNodes)r.call(n,h)}}let X_=null;function dx(n,r){let o=!1;const a=1/r;if(V("DISABLE_WEBAUDIO")){const l=window.setInterval(()=>{o?window.clearInterval(l):n(performance.now()/1e3)},1e3*a)}else{const l=Uf();let d=l.createGain();d.gain.value=0,d.connect(l.destination);const h=()=>{if(o)return void(d=null);const p=l.createOscillator();p.onended=h,p.connect(d),p.start(0),p.stop(l.currentTime+a),n(l.currentTime)};h()}return()=>{o=!0}}class vA{constructor(){$(this,"context",void 0),$(this,"analyserNode",void 0),$(this,"sourceNode",void 0),this.context=Uf(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||nt()||Ks()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let l=0;l<r.length;++l)r[l]=a[l]/128-1}const o=Ue(r).call(r,(a,l)=>a+l*l,0)/r.length;return Math.max(10*Math.log10(o)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,o;null===(r=this.sourceNode)||void 0===r||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(o=this.sourceNode)||void 0===o||o.connect(this.analyserNode)}catch{T.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Z_ extends nn{get processSourceNode(){return this.sourceNode}set processedNode(r){var o;if(!this.isDestroyed&&this._processedNode!==r){try{var a;null===(a=this.sourceNode)||void 0===a||a.disconnect(this.outputNode)}catch{}null===(o=this._processedNode)||void 0===o||o.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),$(this,"outputNode",void 0),$(this,"outputTrack",void 0),$(this,"isPlayed",!1),$(this,"sourceNode",void 0),$(this,"context",void 0),$(this,"audioBufferNode",void 0),$(this,"destNode",void 0),$(this,"audioOutputLevel",0),$(this,"volumeLevelAnalyser",void 0),$(this,"_processedNode",void 0),$(this,"playNode",void 0),$(this,"isDestroyed",!1),$(this,"onNoAudioInput",void 0),$(this,"isNoAudioInput",!1),$(this,"_noAudioInputCount",0),this.context=Uf(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Fd(this.outputNode),this.volumeLevelAnalyser=new vA}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=o=>{this.emit(as.ON_AUDIO_BUFFER,function(a){for(let l=0;l<a.outputBuffer.numberOfChannels;l+=1){const d=a.outputBuffer.getChannelData(l);for(let h=0;h<d.length;h+=1)d[h]=0}return a.inputBuffer}(o))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!ct().webAudioMediaStreamDest)throw new Y(k.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){"running"!==this.context.state&&y_(()=>{xt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}checkHasAudioInput(){var r=arguments,o=this;return L(function*(){let a=r.length>0&&void 0!==r[0]?r[0]:0;if(a>5)return o.isNoAudioInput=!0,o.onNoAudioInput&&o.onNoAudioInput(),!1;nt()||Ks()?"suspended"===o.context.state&&o.context.resume():"running"!==o.context.state&&o.context.resume();const l=o.volumeLevelAnalyser.getAnalyserNode();let d;l.getFloatTimeDomainData?(d=new Float32Array(l.fftSize),l.getFloatTimeDomainData(d)):(d=new Uint8Array(l.fftSize),l.getByteTimeDomainData(d));let h=!1;for(let p=0;p<d.length;p++)0!==d[p]&&(h=!0);return h?(o.isNoAudioInput=!1,!0):(yield Ii(200),(yield o.checkHasAudioInput(a?a+1:1))&&h)})()}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,o;null===(r=this.processedNode)||void 0===r||r.disconnect(),null===(o=this.sourceNode)||void 0===o||o.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?null===(r=this.processedNode)||void 0===r||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class ux extends Z_{get isFreeze(){return!1}constructor(r,o,a){var l,d;if(super(),l=this,$(this,"sourceNode",void 0),$(this,"track",void 0),$(this,"clonedTrack",void 0),$(this,"audioElement",void 0),$(this,"isCurrentTrackCloned",!1),$(this,"isRemoteTrack",!1),$(this,"originVolumeLevelAnalyser",void 0),$(this,"rebuildWebAudio",L(function*(){if(T.debug("ready to rebuild web audio, state:",l.context.state),l.isNoAudioInput&&(yield l.checkHasAudioInput()),!l.isNoAudioInput||l.isDestroyed)return document.body.removeEventListener("click",l.rebuildWebAudio,!0),void T.debug("rebuild web audio success, current volume status",l.getAccurateVolumeLevel());l.context.resume().then(()=>T.info("resume success")),T.debug("rebuild web audio because of ios 12 bugs"),l.disconnect();const m=l.track;l.track=l.track.clone(),l.isCurrentTrackCloned?m.stop():l.isCurrentTrackCloned=!0;const g=new MediaStream([l.track]);l.sourceNode=l.context.createMediaStreamSource(g),Fd(l.sourceNode),l.volumeLevelAnalyser.rebuildAnalyser();const v=l.outputNode.gain.value;l.outputNode=l.context.createGain(),l.outputNode.gain.setValueAtTime(v,l.context.currentTime),Fd(l.outputNode),l.emit(as.UPDATE_SOURCE),l.connect(),l.audioElement.srcObject=g,l.isPlayed&&l.play(l.playNode),l.checkHasAudioInput()})),"audio"!==r.kind)throw new Y(k.UNEXPECTED_ERROR);this.track=r;const h=new MediaStream([this.track]);if(this.isRemoteTrack=!!o,this.sourceNode=this.context.createMediaStreamSource(h),Fd(this.sourceNode),a){const m=a.clone();m.enabled=!0,this.clonedTrack=m,T.debug("create an unmuted track ".concat(m.id," from the original track ").concat(a.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([m]));Fd(g),this.originVolumeLevelAnalyser=new vA,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=h;const p=ot();o&&p.os===pi.IOS&&Number(null===(d=p.osVersion)||void 0===d?void 0:d.split(".")[0])<15&&(xt.on(wi.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const o=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(o),Fd(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(as.UPDATE_SOURCE),this.audioElement.srcObject=o}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),xt.off("state-change",this.rebuildWebAudio),null===(r=this.originVolumeLevelAnalyser)||void 0===r||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const o=r.clone();o.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=o),T.debug("create an unmuted track ".concat(o.id," from the original track ").concat(r.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([o]));Fd(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}function hx(n,r,o){return px.apply(this,arguments)}function px(){return px=L(function*(n,r,o){const a=(d,h)=>d?"number"!=typeof d?d.max||d.exact||d.ideal||d.min||h:d:h,l={audio:!!o&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxHeight:a(r.height,1080),maxWidth:a(r.width,1920)}}};return r.frameRate&&"number"!=typeof r.frameRate?(l.video.mandatory.maxFrameRate=r.frameRate.max,l.video.mandatory.minFrameRate=r.frameRate.min):"number"==typeof r.frameRate&&(l.video.mandatory.maxFrameRate=r.frameRate),yield navigator.mediaDevices.getUserMedia(l)}),px.apply(this,arguments)}function fx(){return fx=L(function*(n,r){const o=yield c5(n.mediaSource),{sourceId:a,audio:l}=yield function(d){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new le((p,m)=>{const g=document.createElement("div");g.innerText="share screen",g.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const v=document.createElement("div");v.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const y=document.createElement("div");y.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",y.setAttribute("style","height: 12%;");const b=document.createElement("div");b.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const C=document.createElement("div");C.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const N=document.createElement("button");N.innerHTML="cancel",N.setAttribute("style","width: 85px;"),N.onclick=()=>{document.body.removeChild(D);const M=new Error("NotAllowedError");M.name="NotAllowedError",m(M)};let R=h;const A=document.createElement("div");if(h){const M=document.createElement("input");M.setAttribute("type","checkbox");const x=document.createElement("span");M.setAttribute("style","margin-right: 6px;"),x.innerText="Share audio",M.checked=R,M.onchange=()=>{R=M.checked},A.appendChild(M),A.appendChild(x)}C.appendChild(A),C.appendChild(N),v.appendChild(y),v.appendChild(b),v.appendChild(C);const D=document.createElement("div");D.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),D.appendChild(g),D.appendChild(v),document.body.appendChild(D),d.map(M=>{if(M.id){const x=document.createElement("div");x.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let j=M.thumbnail;try{const{width:W}=j.getSize();W>1920&&(j=j.resize({width:1920}))}catch(W){throw W&&W.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),W}x.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+j.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+M.name.replace(/[\u00A0-\u9999<>\&]/g,function(W){return"&#"+W.charCodeAt(0)+";"})+"</span>",x.onclick=()=>{document.body.removeChild(D),p({sourceId:M.id,audio:R})},b.appendChild(x)}})})}(o,r);return yield hx(a,n,l)}),fx.apply(this,arguments)}function c5(n){return mx.apply(this,arguments)}function mx(){return mx=L(function*(n){let r=["window","screen"];"application"!==n&&"window"!==n||(r=["window"]),"screen"===n&&(r=["screen"]);const o=lR();if(!o)throw console.error("failed to fetch electron, please mount it to window"),new Y(k.ELECTRON_IS_NULL);let a=null;try{var l;a=(null===(l=o.desktopCapturer)||void 0===l?void 0:l.getSources({types:r}))||o.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{a=null}a&&a.then||(a=new le((d,h)=>{o.desktopCapturer.getSources({types:r},(p,m)=>{p?h(p):d(m)})}));try{return yield a}catch(d){throw new Y(k.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}),mx.apply(this,arguments)}const er=new Qi("safari");let Vf=!1,J_=!1;function Gr(n,r){return MS.apply(this,arguments)}function MS(){return MS=L(function*(n,r){let o=0,a=null;for(;o<2;)try{a=yield jW(n,r,o>0);break}catch(l){if(l instanceof Y)throw T.error("[".concat(r,"] ").concat(l.toString())),l;const d=yA(l.name||l.code||l,l.message);if(d.code===k.MEDIA_OPTION_INVALID){T.debug("[".concat(r,"] detect media option invalid, retry")),o+=1,yield Ii(500);continue}throw T.error("[".concat(r,"] ").concat(d.toString())),d}if(!a)throw new Y(k.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}),MS.apply(this,arguments)}function jW(n,r,o){return EA.apply(this,arguments)}function EA(){return EA=L(function*(n,r,o){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Y(k.NOT_SUPPORTED,"can not find getUserMedia");o&&(n.video&&(delete n.video.width,delete n.video.height),n.screen&&(delete n.screen.width,delete n.screen.height));const a=ct(),l=new MediaStream;if(n.audioSource&&l.addTrack(n.audioSource),n.videoSource&&l.addTrack(n.videoSource),!n.audio&&!n.video&&!n.screen)return T.debug("Using Video Source/ Audio Source"),l;if(n.screen)if(lR())Q_(l,n.screen.sourceId?yield hx(n.screen.sourceId,n.screen,!!n.screenAudio):yield function BW(n,r){return fx.apply(this,arguments)}(n.screen,!!n.screenAudio));else if(lh()&&n.screen.extensionId&&n.screen.mandatory){if(!a.getStreamFromExtension)throw new Y(k.NOT_SUPPORTED,"This browser does not support screen sharing");T.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const b=yield(h=n.screen.extensionId,p=r,new le((C,N)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},R=>{if(!R||!R.streamId)return T.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),R),void N(new Y(k.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));C(R.streamId)})}catch(R){T.error("[".concat(p,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),R.toString()),N(new Y(k.CHROME_PLUGIN_NOT_INSTALL))}}));n.screen.mandatory.chromeMediaSourceId=b,Q_(l,yield navigator.mediaDevices.getUserMedia({video:{mandatory:n.screen.mandatory}}))}else if(a.getDisplayMedia){var d;n.screen.mediaSource&&Js(n.screen.mediaSource);const b={width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate,displaySurface:null!==(d=n.screen.displaySurface)&&void 0!==d?d:"screen"===n.screen.mediaSource?"monitor":n.screen.mediaSource},{selfBrowserSurface:C,surfaceSwitching:N,systemAudio:R}=n.screen,A={selfBrowserSurface:C,surfaceSwitching:N,systemAudio:R};!C&&delete A.selfBrowserSurface,!N&&delete A.surfaceSwitching,!R&&delete A.systemAudio,T.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:b,audio:n.screenAudio,controls:A})),Q_(l,yield navigator.mediaDevices.getDisplayMedia(rn({video:b,audio:n.screenAudio},A)))}else{if(!hn())throw T.error("[".concat(r,"] This browser does not support screenSharing")),new Y(k.NOT_SUPPORTED,"This browser does not support screen sharing");{n.screen.mediaSource&&Js(n.screen.mediaSource);const b={video:{mediaSource:n.screen.mediaSource,width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate}};T.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(b))),Q_(l,yield navigator.mediaDevices.getUserMedia(b))}}var h,p;if(!n.video&&!n.audio)return l;let m={video:n.video,audio:n.audio},g=V("MEDIA_DEVICE_CONSTRAINTS");if(g)try{"string"==typeof g&&(g=JSON.parse(g)),m=$1(m,g)}catch{}T.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(m)),ot();let v,y=null;($e()||nt()||m_())&&(y=yield er.lock());try{v=yield navigator.mediaDevices.getUserMedia(m)}catch(b){throw y&&y(),b}return m.audio&&(Vf=!0),m.video&&(J_=!0),Q_(l,v),y&&y(),l}),EA.apply(this,arguments)}function yA(n,r){switch(n){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Y(k.MEDIA_OPTION_INVALID,"".concat(n,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Y(k.DEVICE_NOT_FOUND,"".concat(n,": ").concat(r));case"NotSupportedError":return new Y(k.NOT_SUPPORTED,"".concat(n,": ").concat(r));case"NotReadableError":return new Y(k.NOT_READABLE,"".concat(n,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Y(k.PERMISSION_DENIED,"".concat(n,": ").concat(r));case"ConstraintNotSatisfiedError":return new Y(k.CONSTRAINT_NOT_SATISFIED,"".concat(n,": ").concat(r));default:return T.error("getUserMedia unexpected error",n),new Y(k.UNEXPECTED_ERROR,"".concat(n,": ").concat(r))}}function Q_(n,r){const o=n.getVideoTracks()[0],a=n.getAudioTracks()[0],l=r.getVideoTracks()[0],d=r.getAudioTracks()[0];d&&(a&&n.removeTrack(a),n.addTrack(d)),l&&(o&&n.removeTrack(o),n.addTrack(l))}const mo=new class extends nn{get state(){return this._state}set state(n){n!==this._state&&(this.emit(Il.STATE_CHANGE,n),this._state=n)}constructor(){super(),$(this,"_state",Sh.IDLE),$(this,"isAccessMicrophonePermission",!1),$(this,"isAccessCameraPermission",!1),$(this,"lastAccessMicrophonePermission",!1),$(this,"lastAccessCameraPermission",!1),$(this,"checkdeviceMatched",!1),$(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(V("ENUMERATE_DEVICES_INTERVAL")||(tS()||f_()===pi.HARMONY_OS)&&hl())&&this.updateDevicesInfo()},V("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(n=>T.error(n.toString()))}enumerateDevices(n,r){var o=arguments,a=this;return L(function*(){let l=o.length>2&&void 0!==o[2]&&o[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Y(k.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const d=yield navigator.mediaDevices.enumerateDevices(),h=a.checkMediaDeviceInfoIsOk(d);let p=!a.isAccessMicrophonePermission&&n,m=!a.isAccessCameraPermission&&r;h.audio&&(p=!1),h.video&&(m=!1);let g=null,v=null,y=null;if(!l&&(p||m)){if(er.isLocked&&(T.debug("[device manager] wait GUM lock"),(yield er.lock())(),T.debug("[device manager] GUM unlock")),Vf&&(p=!1,a.isAccessMicrophonePermission=!0),J_&&(m=!1,a.isAccessCameraPermission=!0),T.debug("[device manager] check media device permissions",n,r,p,m),p&&m){try{y=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(b){const C=yA(b.name||b.code||b,b.message);if(C.code===k.PERMISSION_DENIED)throw C;T.warning("getUserMedia failed in getDevices",C)}a.isAccessCameraPermission=!0,a.isAccessMicrophonePermission=!0}else if(p){try{g=yield navigator.mediaDevices.getUserMedia({audio:n})}catch(b){const C=yA(b.name||b.code||b,b.message);if(C.code===k.PERMISSION_DENIED)throw C;T.warning("getUserMedia failed in getDevices",C)}a.isAccessMicrophonePermission=!0}else if(m){try{v=yield navigator.mediaDevices.getUserMedia({video:r})}catch(b){const C=yA(b.name||b.code||b,b.message);if(C.code===k.PERMISSION_DENIED)throw C;T.warning("getUserMedia failed in getDevices",C)}a.isAccessCameraPermission=!0}T.debug("[device manager] mic permission",n,"cam permission",r)}try{const b=yield navigator.mediaDevices.enumerateDevices();return g&&g.getTracks().forEach(C=>C.stop()),v&&v.getTracks().forEach(C=>C.stop()),y&&y.getTracks().forEach(C=>C.stop()),g=null,v=null,y=null,b}catch(b){return g&&g.getTracks().forEach(C=>C.stop()),v&&v.getTracks().forEach(C=>C.stop()),y&&y.getTracks().forEach(C=>C.stop()),g=null,v=null,y=null,new Y(k.ENUMERATE_DEVICES_FAILED,b.toString()).throw()}})()}getRecordingDevices(){var n=arguments,r=this;return L(function*(){let o=n.length>0&&void 0!==n[0]&&n[0];return(yield r.enumerateDevices(!0,!1,o)).filter(a=>"audioinput"===a.kind)})()}getCamerasDevices(){var n=arguments,r=this;return L(function*(){let o=n.length>0&&void 0!==n[0]&&n[0];return(yield r.enumerateDevices(!1,!0,o)).filter(a=>"videoinput"===a.kind)})()}getSpeakers(){var n=arguments,r=this;return L(function*(){let o=n.length>0&&void 0!==n[0]&&n[0];return(yield r.enumerateDevices(!0,!1,o)).filter(a=>"audiooutput"===a.kind)})()}searchDeviceIdByName(n){let r=null;return this.deviceInfoMap.forEach(o=>{o.device.label===n&&(r=o.device.deviceId)}),r}getDeviceById(n){var r=this;return L(function*(){const o=(yield r.enumerateDevices(!0,!0,!0)).find(a=>a.deviceId===n);if(!o)throw new Y(k.DEVICE_NOT_FOUND,"deviceId: ".concat(n));return o})()}init(){var n=this;return L(function*(){n.state=Sh.INITING;try{yield n.updateDevicesInfo(),n.state=Sh.INITEND}catch(r){throw T.warning("Device Detection functionality cannot start properly.",r.toString()),n.state=Sh.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new Y(k.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),r}})()}updateDevicesInfo(){var n=this;return L(function*(){const r=yield n.enumerateDevices(!0,!0,!0),o=Date.now(),a=[];if(r[0]&&r[0].label&&!1===n.checkdeviceMatched){n.checkdeviceMatched=!0;const d=r.find(p=>"audioinput"===p.kind&&"default"===p.deviceId),h=r.find(p=>"audiooutput"===p.kind&&"default"===p.deviceId);T.debug(d&&h?h.groupId===d.groupId?"[device-check] default input ".concat(d.label," and output ").concat(h.label," is the same group"):"[device-check] default input ".concat(d.label," and output ").concat(h.label," is not the same group"):"[device-check] default input or output not found")}const l=n.checkMediaDeviceInfoIsOk(r);if(r.forEach(d=>{if(!d.deviceId)return;const h=n.deviceInfoMap.get("".concat(d.kind,"_").concat(d.deviceId));if("ACTIVE"!==(h?h.state:"INACTIVE")){const p={initAt:o,updateAt:o,device:d,state:"ACTIVE"};n.deviceInfoMap.set("".concat(d.kind,"_").concat(d.deviceId),p),a.push(p)}h&&(h.updateAt=o)}),n.deviceInfoMap.forEach((d,h)=>{"ACTIVE"===d.state&&d.updateAt!==o&&(d.state="INACTIVE",a.push(d))}),n.state!==Sh.INITEND)return l.audio&&(n.lastAccessMicrophonePermission=!0,n.isAccessMicrophonePermission=!0),void(l.video&&(n.lastAccessCameraPermission=!0,n.isAccessCameraPermission=!0));a.forEach(d=>{switch(d.device.kind){case"audioinput":n.lastAccessMicrophonePermission&&n.isAccessMicrophonePermission&&n.emit(Il.RECORDING_DEVICE_CHANGED,d);break;case"videoinput":n.lastAccessCameraPermission&&n.isAccessCameraPermission&&n.emit(Il.CAMERA_DEVICE_CHANGED,d);break;case"audiooutput":n.lastAccessMicrophonePermission&&n.isAccessMicrophonePermission&&n.emit(Il.PLAYOUT_DEVICE_CHANGED,d)}}),l.audio&&(n.lastAccessMicrophonePermission=!0,n.isAccessMicrophonePermission=!0),l.video&&(n.lastAccessCameraPermission=!0,n.isAccessCameraPermission=!0)})()}checkMediaDeviceInfoIsOk(n){const r=n.filter(l=>"audioinput"===l.kind),o=n.filter(l=>"videoinput"===l.kind),a={audio:!1,video:!1};for(const l of r)if(l.label&&l.deviceId){a.audio=!0;break}for(const l of o)if(l.label&&l.deviceId){a.video=!0;break}return a}};let bA=!1;const ko=new class extends nn{constructor(){super(...arguments),$(this,"onAutoplayFailed",void 0),$(this,"onAudioAutoplayFailed",void 0)}};function SA(){if(ot(),!bA){const n=r=>{r.preventDefault(),bA=!1,g_()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};bA=!0,g_()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),T.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),ko.onAutoplayFailed?ko.onAutoplayFailed():T.warning(ko.onAudioAutoplayFailed?"AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .":"We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),ko.emit("autoplay-failed")}}function CA(n,r,o,a){if(!n)return;const l=be.getBaseInfoBySessionId(n);if(!l)return;const d=l.info,h=Date.now(),p=rn(rn({},d),{},{vid:void 0===d.vid?0:Number(d.vid),lts:h,elapse:h-l.startTime,cbRegistered:ko.onAutoplayFailed||ko.onAudioAutoplayFailed?1:-1,errorMsg:o,mediaType:r,trackId:a,extend:void 0});be.send({type:sn.AUTOPLAY_FAILED,data:p},!0)}const gx=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Wr=new class{constructor(){$(this,"onAutoplayFailed",void 0),$(this,"elementMap",new Map),$(this,"elementStateMap",new Map),$(this,"elementsNeedToResume",[]),$(this,"sinkIdMap",new Map),$(this,"autoResumeAfterInterruption",n=>{Array.from(this.elementMap.entries()).forEach(r=>{let[o,a]=r;const l=this.elementStateMap.get(o),d=a.srcObject.getAudioTracks()[0],h=d&&d.readyState;if(T.debug("resume after interrupted, ele: ".concat(l," audio: ").concat(h," ").concat(n)),"live"===h){if(n)return a.pause(),void a.play();if("running"===xt.curState)return yf()?(a.pause(),void a.play()):void(l&&"paused"===l&&a.play())}})}),$(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(n=>{let[r,o]=n;const a=o.srcObject.getAudioTracks()[0];a&&"live"===a.readyState&&(T.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),o.pause(),o.play())})}),this.autoResumeAudioElement(),xt.on(wi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),xt.on(wi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),xt.on(wi.STATE_CHANGE,()=>{nt()&&"suspended"===xt.prevState&&"running"===xt.curState&&this.autoResumeAfterInterruption()})}setSinkID(n,r){var o=this;return L(function*(){const a=o.elementMap.get(n);if(o.sinkIdMap.set(n,r),a)try{yield a.setSinkId(r)}catch(l){throw new Y(k.PERMISSION_DENIED,"can not set sink id: "+l.toString())}})()}play(n,r,o,a){if(this.elementMap.has(r))return;const l=document.createElement("audio");l.autoplay=!0,l.srcObject=new MediaStream([n]),this.bindAudioElementEvents(r,l),this.elementMap.set(r,l),this.elementStateMap.set(r,Ki.INIT),this.setVolume(r,o);const d=this.sinkIdMap.get(r);if(d)try{l.setSinkId(d).catch(p=>{T.warning("[".concat(r,"] set sink id failed"),p.toString())})}catch(p){T.warning("[".concat(r,"] set sink id failed"),p.toString())}const h=l.play();h&&h.then&&h.catch(p=>{a&&CA(a,"audio",p.message,r),T.warning("audio element play warning",p.toString()),this.elementMap.has(r)&&"NotAllowedError"===p.name&&(T.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(l),y_(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),SA()}))})}updateTrack(n,r){const o=this.elementMap.get(n);o&&(o.srcObject=new MediaStream([r]))}isPlaying(n){return this.elementMap.has(n)&&"playing"===this.elementStateMap.get(n)}setVolume(n,r){const o=this.elementMap.get(n);o&&(r=Math.max(0,Math.min(100,r)),o.volume=r/100)}stop(n){const r=this.elementMap.get(n);if(this.sinkIdMap.delete(n),!r)return;const o=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(o,1),r.srcObject=null,r.remove(),this.elementMap.delete(n),this.elementStateMap.delete(n)}bindAudioElementEvents(n,r){gx.forEach(o=>{r.addEventListener(o,a=>{const l=this.elementStateMap.get(n),d="pause"===a.type?"paused":a.type;if(T.debug("[".concat(n,"] audio-element-status change ").concat(l," => ").concat(d)),"error"===a.type){const h=r?.error;h&&T.error("[".concat(n,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(n,d)})})}getPlayerState(n){return this.elementStateMap.get(n)||"uninit"}autoResumeAudioElement(){const n=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(o=>{T.debug("Auto resume audio element success")}).catch(o=>{T.warning("Auto resume audio element failed!",o)})}),this.elementsNeedToResume=[]};new le(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{g_()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0))})}};function Gn(){return function(n,r,o){const a=o.value;return"function"==typeof a&&(o.value=function(){this._isClosed&&new Y(k.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",T);for(var l=arguments.length,d=new Array(l),h=0;h<l;h++)d[h]=arguments[h];const p=a.apply(this,d);return p instanceof le?new le((m,g)=>{p.then(m).catch(g)}):p}),o}}class TA extends nn{constructor(r){super(),$(this,"name","VideoProcessorDestination"),$(this,"ID","0"),$(this,"_source",void 0),$(this,"videoContext",void 0),$(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Y(k.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Y(k.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(hr.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(hr.ON_TRACK,void 0)}}class _x extends nn{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,o){super(),$(this,"constraintsMap",new Map),$(this,"statsRegistry",[]),$(this,"usageRegistry",[]),$(this,"trackId",void 0),$(this,"direction",void 0),$(this,"_chained",!1),this.trackId=r,this.direction=o}getConstraints(){var r=this;return L(function*(){return yield Gi(r,cs.REQUEST_CONSTRAINTS)})()}requestApplyConstraints(r,o){var a=this;return L(function*(){var l;return T.info("processor ".concat(o.name," requestApplyConstraints for ").concat(a.trackId)),r&&a.constraintsMap.set(o,r),jt(a,cs.REQUEST_UPDATE_CONSTRAINTS,Array.from(Md(l=a.constraintsMap).call(l)))})()}requestRevertConstraints(r){var o=this;return L(function*(){var a;if(o.constraintsMap.has(r))return T.info("processor ".concat(r.name," requestRevertConstraints for ").concat(o.trackId)),o.constraintsMap.delete(r),jt(o,cs.REQUEST_UPDATE_CONSTRAINTS,Array.from(Md(a=o.constraintsMap).call(a)))})()}registerStats(r,o,a){this.statsRegistry.find(l=>l.processorID===r.ID&&l.processorName===r.name&&l.type===o)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:o,cb:a})}unregisterStats(r,o){const a=this.statsRegistry.findIndex(l=>l.processorID===r.ID&&l.processorName===r.name&&l.type===o);-1!==a&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:o,processorName:a,type:l,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:o,processorName:a,type:l,stats:h})}catch(h){T.error(new Y(k.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,o){this.usageRegistry.find(a=>a.processorID===r.ID&&a.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:o})}unregisterUsage(r){const o=this.usageRegistry.findIndex(a=>a.processorID===r.ID&&a.processorName===r.name);-1!==o&&this.usageRegistry.splice(o,1)}gatherUsage(){var r=this;return L(function*(){const o=[];if(!r.chained)return[];for(const{cb:a}of r.usageRegistry)try{let l=a();l instanceof le&&(l=yield l),o.push(rn(rn({},l),{},{direction:r.direction}))}catch(l){T.error("gather extension usage error",l)}return o})()}getDirection(){return this.direction}}class IA extends nn{constructor(r){super(),$(this,"name","AudioProcessorDestination"),$(this,"ID","0"),$(this,"inputTrack",void 0),$(this,"inputNode",void 0),$(this,"audioProcessorContext",void 0),$(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Y(k.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Y(k.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(hr.ON_TRACK,void 0),this.emit(hr.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(hr.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(hr.ON_NODE,this.inputNode))}}class ev extends nn{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,o,a){super(),$(this,"constraintsMap",new Map),$(this,"statsRegistry",[]),$(this,"audioContext",void 0),$(this,"trackId",void 0),$(this,"direction",void 0),$(this,"usageRegistry",[]),$(this,"_chained",!1),this.audioContext=r,this.trackId=o,this.direction=a}getConstraints(){var r=this;return L(function*(){return Gi(r,cs.REQUEST_CONSTRAINTS)})()}getAudioContext(){return this.audioContext}requestApplyConstraints(r,o){var a=this;return L(function*(){var l;return T.info("processor ".concat(o.name," requestApplyConstraints for ").concat(a.trackId)),r&&a.constraintsMap.set(o,r),jt(a,cs.REQUEST_UPDATE_CONSTRAINTS,Array.from(Md(l=a.constraintsMap).call(l)))})()}requestRevertConstraints(r){var o=this;return L(function*(){var a;if(o.constraintsMap.has(r))return o.constraintsMap.delete(r),jt(o,cs.REQUEST_UPDATE_CONSTRAINTS,Array.from(Md(a=o.constraintsMap).call(a)))})()}registerStats(r,o,a){this.statsRegistry.find(l=>l.processorID===r.ID&&l.processorName===r.name&&l.type===o)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:o,cb:a})}unregisterStats(r,o){const a=this.statsRegistry.findIndex(l=>l.processorID===r.ID&&l.processorName===r.name&&l.type===o);-1!==a&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:o,processorName:a,type:l,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:o,processorName:a,type:l,stats:h})}catch(h){T.error(new Y(k.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,o){this.usageRegistry.find(a=>a.processorID===r.ID&&a.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:o})}unregisterUsage(r){const o=this.usageRegistry.findIndex(a=>a.processorID===r.ID&&a.processorName===r.name);-1!==o&&this.usageRegistry.splice(o,1)}gatherUsage(){var r=this;return L(function*(){const o=[];if(!r.chained)return[];for(const{cb:a}of r.usageRegistry)try{let l=a();l instanceof le&&(l=yield l),o.push(rn(rn({},l),{},{direction:r.direction}))}catch(l){T.error("gather extension usage error",l)}return o})()}getDirection(){return this.direction}}class Th extends nn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),$(this,"context",void 0),$(this,"processSourceNode",void 0),$(this,"outputTrack",void 0),$(this,"processedNode",void 0),$(this,"clonedTrack",void 0),$(this,"outputNode",void 0),this.outputNode=new kS}setVolume(){}createOutputTrack(){throw new Y(k.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class kS{disconnect(){}connect(){}}function wA(n){return new le((r,o)=>{let a=!1;const l=document.createElement("video");l.setAttribute("autoplay",""),l.setAttribute("muted",""),l.muted=!0,l.autoplay=!0,l.setAttribute("playsinline",""),l.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(l);const d=nt()?"canplay":"playing";l.addEventListener(d,()=>{const h=l.videoWidth,p=l.videoHeight;!h&&hn()||(a=!0,l.srcObject=null,l.remove(),r([h,p]))}),l.srcObject=new MediaStream([n]),l.play().catch(iS),setTimeout(()=>{a||(l.srcObject=null,l.remove(),r([l.videoWidth,l.videoHeight]))},4e3)})}function tv(n){const r={};n.facingMode&&(r.facingMode=n.facingMode),n.cameraId&&(r.deviceId={exact:n.cameraId});const o=Cl(n.encoderConfig);return null!=o.width&&(r.width=o.width),null!=o.height&&(r.height=o.height),!bf()&&o.frameRate&&(r.frameRate=o.frameRate),Jb()&&"object"==typeof r.frameRate&&(r.frameRate.max=60),hn()&&(r.frameRate={ideal:30,max:30}),r}function l5(n){const r={};return bf()||(void 0!==n.AGC&&(r.autoGainControl=n.AGC),void 0!==n.AEC&&(r.echoCancellation=n.AEC),void 0!==n.ANS&&(r.noiseSuppression=n.ANS,lh()&&n.ANS&&(r.googHighpassFilter=n.ANS))),r}function d5(n){const r=l5(n);if(n.encoderConfig){const o=fA(n.encoderConfig);r.channelCount=o.stereo?2:1,r.sampleRate=o.sampleRate,r.sampleSize=o.sampleSize}return n.microphoneId&&(r.deviceId={exact:n.microphoneId}),tS()&&(r.sampleRate=void 0),r}const vx=function(){var n=L(function*(r,o,a){return yield(l=L(function*(d,h,p){const m=function(y){const b=[];for(let C=0;C<y.length;C+=2)b.push(parseInt(y.slice(C,C+2),16));return Uint8Array.from(b)}(Qj(""+h+p)).slice(0,16),g=m.slice(0,12),v=yield window.crypto.subtle.importKey("raw",m,"AES-GCM",!0,["encrypt"]);return new Uint8Array(yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:g},v,d))}),function(d,h,p){return l.apply(this,arguments)})(r.buffer,o,a);var l});return function(o,a,l){return n.apply(this,arguments)}}(),RA=n=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new le((o,a)=>{r.toBlob(function(){var l=L(function*(d){if(r.remove(),d){const h=yield u5(d);o({buffer:h,width:r.width,height:r.height})}else a(new Y(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(d){return l.apply(this,arguments)}}(),n,1)})},u5=function(){var n=L(function*(r){const o=yield r.arrayBuffer();return new Uint8Array(o)});return function(o){return n.apply(this,arguments)}}();var AA,DA,h5,nv,p5,f5,m5,Ex,g5,_5,yx,bx,v5,OA,Sx,E5,Cx,NA,an,Tx,Ix,wx,Rx,PA,MA,Rl,Ax,Dx,Ox,Nx,kA,LA,Px,xA,FA,y5,Mx,Bf,LS,ki;let Cn=(AA=Ae({argsMap:(n,r)=>[n.getTrackId(),r],throttleTime:300}),DA=Ae({argsMap:(n,r)=>[n.getTrackId(),r]}),h5=Gn(),nv=Tf("LocalAudioTrack","_enabledMutex"),p5=Ae({argsMap:(n,r)=>[n.getTrackId(),r]}),f5=Gn(),m5=Tf("LocalAudioTrack","_enabledMutex"),Ex=Ae({argsMap:(n,r)=>[n.getTrackId(),r]}),g5=Gn(),_5=Gn(),yx=Gn(),bx=Ae({argsMap:n=>[n.getTrackId()]}),v5=Gn(),OA=Ae({argsMap:n=>[n.getTrackId()]}),Sx=Gn(),E5=Ae({argsMap:n=>[n.getTrackId()]}),Cx=Ae({argsMap:(n,r)=>[n.getTrackId(),r.name]}),NA=Ae({argsMap:n=>[n.getTrackId()]}),Qe((an=class extends Ch{get _source(){return this.initWebAudio()}set _source(n){this._trackSource=n}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Wr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(n,r,o,a){super(n,o),$(this,"trackMediaType",Tl.AUDIO),$(this,"_encoderConfig",void 0),$(this,"_trackSource",void 0),$(this,"_enabled",!0),$(this,"_volume",100),$(this,"_useAudioElement",!0),$(this,"_bypassWebAudio",!1),$(this,"processor",void 0),$(this,"_processorContext",void 0),$(this,"_processorDestination",void 0),$(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!a,this._trackSource=new Th,V("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),V("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),$e()&&!Mo?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(n){Ut(n,"volume",0,1e3),this._volume=n,this._source.setVolume(n/100),this._useAudioElement&&Wr.setVolume(this.getTrackId(),n);try{if(this._bypassWebAudio)return void T.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,jt(this,ge.NEED_REPLACE_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(o=>{T.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),o)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}setPlaybackDevice(n){var r=this;return L(function*(){if(!r._useAudioElement||!ix())throw new Y(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield Wr.setSinkID(r.getTrackId(),n)})()}setEnabled(n,r,o){var a=this;return L(function*(){return a._setEnabled(n,r,o)})()}_setEnabled(n,r,o){var a=this;return L(function*(){if(!o){if(n===a._enabled)return;a.stateCheck("enabled",n)}if(T.info("[".concat(a.getTrackId(),"] start setEnabled"),n),n){a._originMediaStreamTrack.enabled=!0;try{o||(a._enabled=!0),yield jt(a,ge.NEED_ENABLE_TRACK,a),T.info("[".concat(a.getTrackId(),"] setEnabled to ").concat(n," success"))}catch(l){throw o||(a._enabled=!1),T.error("[".concat(a.getTrackId(),"] setEnabled to true error"),l.toString()),l}}else{a._originMediaStreamTrack.enabled=!1,o||(a._enabled=!1);try{yield jt(a,ge.NEED_DISABLE_TRACK,a)}catch(l){throw o||(a._enabled=!0),T.error("[".concat(a.getTrackId(),"] setEnabled to false error"),l.toString()),l}}})()}setMuted(n){var r=this;return L(function*(){n!==r._muted&&(r.stateCheck("muted",n),r._muted=n,r._originMediaStreamTrack.enabled=!n,T.debug("[".concat(r.getTrackId(),"] start set muted: ").concat(n)),n?yield jt(r,ge.NEED_MUTE_TRACK,r):yield jt(r,ge.NEED_UNMUTE_TRACK,r))})()}getStats(){return vc(()=>{T.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Do(this,ge.GET_STATS)||rn({},mA)}setAudioFrameCallback(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!n)return this._source.removeAllListeners(as.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(as.ON_AUDIO_BUFFER),this._source.on(as.ON_AUDIO_BUFFER,o=>n(o))}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Wr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Wr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),n&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Wr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}_updateOriginMediaStreamTrack(n,r){var o=this;return L(function*(){o._originMediaStreamTrack!==n&&(o._originMediaStreamTrack&&(o._originMediaStreamTrack.removeEventListener("ended",o._handleTrackEnded),r&&o._originMediaStreamTrack.stop()),n.addEventListener("ended",o._handleTrackEnded),o._originMediaStreamTrack=n,o._muted&&(o._originMediaStreamTrack.enabled=!1),o.processor&&o._processorContext&&o.processor.updateInput({track:n,context:o._processorContext}),o._mediaStreamTrack!==o._source.outputTrack?(o._mediaStreamTrack=o._originMediaStreamTrack,o._updatePlayerSource(),yield jt(o,ge.NEED_REPLACE_TRACK,o)):o._source.updateTrack(o._originMediaStreamTrack),o._getOriginVolumeLevel&&o._source.updateOriginTrack(n))})()}renewMediaStreamTrack(n){return le.resolve(void 0)}pipe(n){if(this._bypassWebAudio)throw new Y(k.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===n)return n;if(n._source)throw new Y(k.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),n}unpipe(){var n;if(!this.processor)return;const r=this.processor;null===(n=this._source.processSourceNode)||void 0===n||n.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(n){var r=this;n.on(hr.ON_TRACK,function(){var o=L(function*(a){a?a!==r._mediaStreamTrack&&(r._mediaStreamTrack=a,r._updatePlayerSource(!1),r._source.processedNode=r._source.createMediaStreamSourceNode(a),yield jt(r,ge.NEED_REPLACE_TRACK,r)):r._mediaStreamTrack!==r._originMediaStreamTrack&&(r._mediaStreamTrack=r._originMediaStreamTrack,r._updatePlayerSource(),yield jt(r,ge.NEED_REPLACE_TRACK,r))});return function(a){return o.apply(this,arguments)}}()),n.on(hr.ON_NODE,o=>{this._source.processedNode=o})}unbindProcessorDestinationEvents(n){n.removeAllListeners(hr.ON_TRACK),n.removeAllListeners(hr.ON_NODE)}bindProcessorContextEvents(n){var r=this;n.on(cs.REQUEST_CONSTRAINTS,function(){var o=L(function*(a){a(r._originMediaStreamTrack.getSettings())});return function(a){return o.apply(this,arguments)}}())}unbindProcessorContextEvents(n){n.removeAllListeners(cs.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Th&&(this._trackSource=new ux(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const n=new ev(this._source.context,this.getTrackId(),"local"),r=new IA(n);return this._processorContext=n,this._processorDestination=r,this.bindProcessorContextEvents(n),this.bindProcessorDestinationEvents(r),this._source.on(as.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:n})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Wr.stop(this.getTrackId()),this._source.play()),jt(this,ge.NEED_REPLACE_MIXING_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(o=>{T.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),o)})),{processorContext:n,processorDestination:r}}}).prototype,"setVolume",[AA],Object.getOwnPropertyDescriptor(an.prototype,"setVolume"),an.prototype),Qe(an.prototype,"setPlaybackDevice",[DA,h5],Object.getOwnPropertyDescriptor(an.prototype,"setPlaybackDevice"),an.prototype),Qe(an.prototype,"setEnabled",[nv,p5,f5],Object.getOwnPropertyDescriptor(an.prototype,"setEnabled"),an.prototype),Qe(an.prototype,"setMuted",[m5,Ex,g5],Object.getOwnPropertyDescriptor(an.prototype,"setMuted"),an.prototype),Qe(an.prototype,"getStats",[_5],Object.getOwnPropertyDescriptor(an.prototype,"getStats"),an.prototype),Qe(an.prototype,"setAudioFrameCallback",[yx],Object.getOwnPropertyDescriptor(an.prototype,"setAudioFrameCallback"),an.prototype),Qe(an.prototype,"play",[bx,v5],Object.getOwnPropertyDescriptor(an.prototype,"play"),an.prototype),Qe(an.prototype,"stop",[OA,Sx],Object.getOwnPropertyDescriptor(an.prototype,"stop"),an.prototype),Qe(an.prototype,"close",[E5],Object.getOwnPropertyDescriptor(an.prototype,"close"),an.prototype),Qe(an.prototype,"pipe",[Cx],Object.getOwnPropertyDescriptor(an.prototype,"pipe"),an.prototype),Qe(an.prototype,"unpipe",[NA],Object.getOwnPropertyDescriptor(an.prototype,"unpipe"),an.prototype),an),xS=(Tx=Ae({argsMap:(n,r)=>[n.getTrackId(),r]}),Ix=Gn(),wx=Tf("MicrophoneAudioTrack","_enabledMutex"),Rx=Ae({argsMap:(n,r,o)=>[n.getTrackId(),r,o]}),PA=Gn(),MA=Ae({argsMap:n=>[n.getTrackId()]}),Qe((Rl=class extends Cn{get __className__(){return"MicrophoneAudioTrack"}constructor(n,r,o,a){super(n,r.encoderConfig?fA(r.encoderConfig):{},a,V("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),$(this,"_config",void 0),$(this,"_deviceName","default"),$(this,"_constraints",void 0),$(this,"_originalConstraints",void 0),$(this,"_enabled",!0),this._config=r,this._constraints=o,this._originalConstraints=o,this._deviceName=n.label,"boolean"==typeof r.bypassWebAudio&&(this._bypassWebAudio=r.bypassWebAudio),(yf()||iR())&&xt.bindInterruptDetectorTrack(this)}setDevice(n){var r=this;return L(function*(){if(T.info("[".concat(r.getTrackId(),"] start set device to ").concat(n)),r._enabled)try{const o=yield mo.getDeviceById(n),a={};a.audio=rn({},r._constraints),a.audio.deviceId={exact:n},r._originMediaStreamTrack.stop();let l=null;try{l=yield Gr(a,r.getTrackId())}catch(d){throw T.error("[".concat(r.getTrackId(),"] setDevice failed"),d.toString()),l=yield Gr({audio:r._constraints},r.getTrackId()),yield r._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!1),d}yield r._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!1),r._deviceName=o.label,r._config.microphoneId=n,r._constraints.deviceId={exact:n}}catch(o){throw T.error("[".concat(r.getTrackId(),"] setDevice error"),o.toString()),o}else try{const o=yield mo.getDeviceById(n);r._deviceName=o.label,r._config.microphoneId=n,r._constraints.deviceId={exact:n}}catch(o){throw T.error("[".concat(r.getTrackId(),"] setDevice error"),o.toString()),o}T.info("[".concat(r.getTrackId(),"] set device to ").concat(n," success"))})()}setEnabled(n,r,o){var a=()=>super._setEnabled,l=this;return L(function*(){if(r)return T.debug("[".concat(l.getTrackId(),"] setEnabled false (do not close microphone)")),yield a().call(l,n);if(!o){if(n===l._enabled)return;l.stateCheck("enabled",n)}if(T.info("[".concat(l.getTrackId(),"] start setEnabled"),n),V("AUTO_RESET_AUDIO_ROUTE")&&(nt()||Ks())){const m=navigator.audioSession;m&&(n||(m.type="playback"),m.type="auto")}if(!n){var d;l._originMediaStreamTrack.onended=null,l._originMediaStreamTrack.stop(),null===(d=l._source.clonedTrack)||void 0===d||d.stop(),o||(l._enabled=!1);try{yield jt(l,ge.NEED_DISABLE_TRACK,l)}catch(m){throw T.error("[".concat(l.getTrackId(),"] setEnabled false failed"),m.toString()),m}return}const h=rn({},l._constraints),p=mo.searchDeviceIdByName(l._deviceName);p&&!h.deviceId&&(h.deviceId=p);try{o||(l._enabled=!0);const m=yield Gr({audio:l._constraints},l.getTrackId());yield l._updateOriginMediaStreamTrack(m.getAudioTracks()[0],!1),yield jt(l,ge.NEED_ENABLE_TRACK,l)}catch(m){throw o||(l._enabled=!1),T.error("[".concat(l.getTrackId(),"] setEnabled true failed"),m.toString()),m}T.info("[".concat(l.getTrackId(),"] setEnabled success"))})()}close(){super.close(),(yf()||iR())&&xt.unbindInterruptDetectorTrack(this)}onTrackEnded(){var n=this;if((nt()||Ks())&&this._enabled&&!this._isClosed&&xt.duringInterruption){const r=function(){var o=L(function*(){xt.off(wi.IOS_INTERRUPTION_END,r),n._enabled&&!n._isClosed&&(T.debug("[".concat(n.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),yield n.setEnabled(!1),yield n.setEnabled(!0))});return function(){return o.apply(this,arguments)}}();xt.on(wi.IOS_INTERRUPTION_END,r)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($_.TRACK_ENDED)}renewMediaStreamTrack(n){var r=this;return L(function*(){const o=n||r._constraints,a=mo.searchDeviceIdByName(r._deviceName);if(a&&!o.deviceId&&(o.deviceId=a),r._constraints=o,r._enabled){r._originMediaStreamTrack.stop();const l=yield Gr({audio:r._constraints},r.getTrackId());yield r._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!0)}})()}bindProcessorContextEvents(n){var r=this;super.bindProcessorContextEvents(n),n.on(cs.REQUEST_UPDATE_CONSTRAINTS,function(){var o=L(function*(a,l,d){try{const h=Object.assign({},r._originalConstraints,...a);yield r.renewMediaStreamTrack(h),l()}catch(h){d(h)}});return function(a,l,d){return o.apply(this,arguments)}}())}unbindProcessorContextEvents(n){super.unbindProcessorContextEvents(n),n.removeAllListeners(cs.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Tx,Ix],Object.getOwnPropertyDescriptor(Rl.prototype,"setDevice"),Rl.prototype),Qe(Rl.prototype,"setEnabled",[wx,Rx,PA],Object.getOwnPropertyDescriptor(Rl.prototype,"setEnabled"),Rl.prototype),Qe(Rl.prototype,"close",[MA],Object.getOwnPropertyDescriptor(Rl.prototype,"close"),Rl.prototype),Rl),FS=(Ax=Ae({argsMap:(n,r)=>[n.getTrackId(),r,n.duration]}),Dx=Gn(),Ox=Ae({argsMap:n=>[n.getTrackId()]}),Nx=Gn(),kA=Ae({argsMap:n=>[n.getTrackId()]}),LA=Gn(),Px=Ae({argsMap:n=>[n.getTrackId()]}),xA=Gn(),FA=Ae({argsMap:n=>[n.getTrackId()]}),y5=Gn(),Mx=Ae({argsMap:n=>[n.getTrackId()]}),Bf=Ae({argsMap:n=>[n.getTrackId()]}),LS=Gn(),Qe((ki=class extends Cn{get __className__(){return"BufferSourceAudioTrack"}constructor(n,r,o,a){super(r.createOutputTrack(),o,a),$(this,"source",void 0),$(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=n,this._bufferSource=r,this._bufferSource.on(as.AUDIO_SOURCE_STATE_CHANGE,l=>{this.safeEmit($_.SOURCE_STATE_CHANGE,l)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(n){n&&this._bufferSource.updateOptions(n),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(n){this._bufferSource.seekAudioBuffer(n)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(n){Ut(n,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(n)}}).prototype,"startProcessAudioBuffer",[Ax,Dx],Object.getOwnPropertyDescriptor(ki.prototype,"startProcessAudioBuffer"),ki.prototype),Qe(ki.prototype,"pauseProcessAudioBuffer",[Ox,Nx],Object.getOwnPropertyDescriptor(ki.prototype,"pauseProcessAudioBuffer"),ki.prototype),Qe(ki.prototype,"seekAudioBuffer",[kA,LA],Object.getOwnPropertyDescriptor(ki.prototype,"seekAudioBuffer"),ki.prototype),Qe(ki.prototype,"resumeProcessAudioBuffer",[Px,xA],Object.getOwnPropertyDescriptor(ki.prototype,"resumeProcessAudioBuffer"),ki.prototype),Qe(ki.prototype,"stopProcessAudioBuffer",[FA,y5],Object.getOwnPropertyDescriptor(ki.prototype,"stopProcessAudioBuffer"),ki.prototype),Qe(ki.prototype,"close",[Mx],Object.getOwnPropertyDescriptor(ki.prototype,"close"),ki.prototype),Qe(ki.prototype,"setAudioBufferPlaybackSpeed",[Bf,LS],Object.getOwnPropertyDescriptor(ki.prototype,"setAudioBufferPlaybackSpeed"),ki.prototype),ki);class si extends Cn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Uf().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,Ct(8,"track-mix-")),$(this,"trackList",void 0),$(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return-1!==this.trackList.indexOf(r)}addAudioTrack(r){-1===this.trackList.indexOf(r)?(T.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):T.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(-1!==this.trackList.indexOf(r)){T.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}Be(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(o=>{o._encoderConfig&&((o._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=o._encoderConfig.bitrate),(o._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=o._encoderConfig.sampleRate),(o._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=o._encoderConfig.sampleSize),o._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(o=>{o instanceof si?o.emit(Ff.TRANSCEIVER_UPDATED,r):o._updateRtpTransceiver(r)}))}}class b5 extends Z_{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(as.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),$(this,"audioBuffer",void 0),$(this,"sourceNode",void 0),$(this,"startPlayTime",0),$(this,"startPlayOffset",0),$(this,"pausePlayTime",0),$(this,"options",void 0),$(this,"currentLoopCount",0),$(this,"currentPlaybackSpeed",100),$(this,"_currentState","stopped"),this.audioBuffer=r,this.options=o,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:(this.playbackSpeed/100*(this.context.currentTime-this.startPlayTime)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){"stopped"===this.currentState?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):T.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=r,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const UA=new Map;class US{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const o=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/(this.renderStats.curTs-this.renderStats.lastTs);return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,o}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(T.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var o;r!==this._videoState&&(this._videoState=r,null===(o=this.onVideoStateChanged)||void 0===o||o.call(this,this.videoState))}constructor(r){$(this,"trackId",void 0),$(this,"config",void 0),$(this,"onFirstVideoFrameDecoded",void 0),$(this,"onVideoStateChanged",void 0),$(this,"freezeTimeCounterList",[]),$(this,"renderFreezeAccTime",0),$(this,"isKeepLastFrame",!1),$(this,"timeUpdatedCount",0),$(this,"freezeTime",0),$(this,"playbackTime",0),$(this,"lastTimeUpdatedTime",0),$(this,"autoplayFailed",!1),$(this,"videoTrack",void 0),$(this,"videoElement",void 0),$(this,"cacheVideoElement",void 0),$(this,"renderStats",void 0),$(this,"_videoState",wl.VideoStateStopped),$(this,"videoElementCheckInterval",void 0),$(this,"videoElementFreezeTimeout",void 0),$(this,"_videoElementStatus",Ki.NONE),$(this,"isGettingVideoDimensions",!1),$(this,"startGetVideoDimensions",()=>{const o=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return T.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(o,500)};!this.isGettingVideoDimensions&&o()}),$(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===xt.curState&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(j1())),G1()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),$(this,"handleVideoEvents",o=>{switch(o.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Ki.PLAYING;break;case"loadeddata":if(this.videoState=wl.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Ki.CANPLAY;break;case"stalled":this.videoElementStatus=Ki.STALLED;break;case"suspend":this.videoElementStatus=Ki.SUSPEND;break;case"pause":this.videoElementStatus=Ki.PAUSED,nt()||Ks()||$e()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Ki.WAITING;break;case"abort":this.videoElementStatus=Ki.ABORT;break;case"ended":this.videoElementStatus=Ki.ENDED;break;case"emptied":this.videoElementStatus=Ki.EMPTIED;break;case"error":{const a=this.videoElement.error;a&&(this.videoElementStatus=Ki.ERROR,T.error("[".concat(this.trackId,"] media error: ").concat(a.message," (").concat(a.code,")")));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const l=a-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,ls.lastVisibleTime<ls.lastHiddenTime||d<ls.lastHiddenTime||d<ls.lastVisibleTime)return;for(l>V("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=l),this.playbackTime+=l;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),$(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(j1())),G1()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,this.videoElement=r.element instanceof HTMLVideoElement?r.element:document.createElement("video"),xt.on(wi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),xt.on(wi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return null!==(r=this.videoElement.parentElement)&&void 0!==r?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const o=this.videoElement.play();o&&o.catch&&o.catch(l=>{r&&CA(r,"video",l.message,this.trackId),"NotAllowedError"===l.name?(T.warning("detected video element autoplay failed",l),this.autoplayFailed=!0,this.handleAutoPlayFailed()):T.warning("[".concat(this.trackId,"] play warning: "),l)});const a=ot();if(("Safari"===a.name&&15===Number(a.version)||yf())&&o&&o.then){const l=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};o.then(l).catch(l)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const o=r.getContext("2d");if(!o)return T.error("create canvas context failed!"),new ImageData(2,2);o.drawImage(this.videoElement,0,0,r.width,r.height);const a=o.getImageData(0,0,r.width,r.height);return r.remove(),a}getCurrentFrameToUint8Array(r){var o=arguments,a=this;return L(function*(){let l=o.length>1&&void 0!==o[1]?o[1]:1;const d=document.createElement("canvas");d.width=a.videoElement.videoWidth,d.height=a.videoElement.videoHeight;const h=d.getContext("2d");return h?(h.drawImage(a.videoElement,0,0,d.width,d.height),new le((p,m)=>{d.toBlob(function(){var g=L(function*(v){if(d.remove(),v){const y=yield u5(v);p({buffer:y,width:d.width,height:d.height})}else m(new Y(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(v){return g.apply(this,arguments)}}(),r,l<0?.1:l>1?1:l)})):yield RA(r)})()}destroy(){this.renderStats=void 0,xt.off(wi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),xt.off(wi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=wl.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Ki.INIT,!this.videoElementCheckInterval&&(S5.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{var d;(d=this.videoElement)!==document.body&&document.body.contains(d)||(this.videoElementStatus=Ki.DESTROYED)},1e3),V("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,o;let d;const h=()=>{"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(p,V("VIDEO_FREEZE_DURATION")))},p=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===wl.VideoStateDecoding&&("visible"===document.visibilityState?this.videoState=wl.VideoStateFrozen:document.addEventListener("visibilitychange",h))},m=(g,v)=>{if(this.videoElementStatus===Ki.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=v.mediaTime):this.renderStats={lastTs:v.mediaTime,curTs:v.mediaTime,lastRenderNum:0,renderNum:0},d){const C=v.presentationTime-d.presentationTime;this.videoState===wl.VideoStateStarting&&(this.videoState=wl.VideoStateDecoding),this.videoState===wl.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(p,V("VIDEO_FREEZE_DURATION"))),C<V("VIDEO_FREEZE_DURATION")&&this.videoState===wl.VideoStateFrozen&&(this.videoState=wl.VideoStateDecoding),C>V("VIDEO_FREEZE_DURATION")&&ls.lastVisibleTime>=ls.lastHiddenTime&&d.timestamp>ls.lastVisibleTime&&d.timestamp>ls.lastHiddenTime&&(this.renderFreezeAccTime+=C)}d=rn(rn({},v),{},{timestamp:g})}var y,b;V("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(y=(b=this.videoElement).requestVideoFrameCallback)||void 0===y||y.call(b,m))};null===(r=(o=this.videoElement).requestVideoFrameCallback)||void 0===r||r.call(o,m)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),tS()&&!V("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const a=ot();"Safari"===a.name&&15===Number(a.version)||yf()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.videoElement.style.objectFit=this.config.fit?this.config.fit:"cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,hn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,hn()&&this.videoElement.load());const l=this.videoElement.play();void 0!==l&&l.catch(d=>{T.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){S5.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Ki.NONE}handleAutoPlayFailed(){const r=o=>{o.preventDefault(),this.videoElement.play().then(()=>{T.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{T.error(a)}),this.autoplayFailed=!1,g_()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};g_()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),SA()}}const S5=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class kx extends US{constructor(r){super(r),$(this,"container",void 0),$(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const o=r.element;o!==this.slot&&(this.destroy(),this.slot=o),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var o;null!==(o=this.container)&&void 0!==o&&o.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return null!==(r=this.container)&&void 0!==r&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}getCurrentFrameToUint8Array(r){var o=arguments,a=()=>super.getCurrentFrameToUint8Array,l=this;return L(function*(){var d;let h=o.length>1&&void 0!==o[1]?o[1]:1;return null!==(d=l.container)&&void 0!==d&&d.contains(l.videoElement)?yield a().call(l,r,h):yield RA(r)})()}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",V("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||null!==(r=this.container)&&void 0!==r&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if(null!==(r=this.container)&&void 0!==r&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;null!==(r=this.container)&&void 0!==r&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Lx,C5,xx,T5,I5,w5,Fx,zr,Ux,R5,A5,D5,O5,N5,Vx,P5,M5,k5,L5,Ud,Qs,Bx,jx,Hx,et,VA,x5,F5,U5,BA,Al,Gx,Wx,ws;let Ve=(Lx=Ae({argsMap:(n,r,o)=>[n.getTrackId(),"string"==typeof r?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",o]}),C5=Gn(),xx=Ae({argsMap:n=>[n.getTrackId()]}),T5=Tf("LocalVideoTrack","_enabledMutex"),I5=Ae({argsMap:(n,r)=>[n.getTrackId(),r]}),w5=Gn(),Fx=Tf("LocalVideoTrack","_enabledMutex"),zr=Ae({argsMap:(n,r)=>[n.getTrackId(),r]}),Ux=Gn(),R5=Ae({argsMap:(n,r)=>[n.getTrackId(),r]}),A5=Gn(),D5=Gn(),O5=Ae({argsMap:(n,r,o)=>[n.getTrackId(),r,o]}),N5=Gn(),Vx=Gn(),P5=Gn(),M5=Gn(),k5=Gn(),L5=Gn(),Ud=Gn(),Qs=Ae({argsMap:(n,r)=>[n.getTrackId(),r.name]}),Bx=Ae({argsMap:n=>[n.getTrackId()]}),jx=Ae({argsMap:n=>[n.getTrackId()]}),Hx=Ae({argsMap:(n,r,o)=>[n.getTrackId(),r.label,o]}),et=class NK extends Ch{get videoHeight(){if($e()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if($e()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Ki.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,o,a,l,d,h){if(super(r,d),$(this,"trackMediaType",Tl.VIDEO),$(this,"_player",void 0),$(this,"isUseScaleResolutionDownBy",!1),$(this,"_videoVisibleTimer",null),$(this,"_previousVideoVisibleStatus",void 0),$(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),$(this,"_encoderConfig",void 0),$(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),$(this,"_optimizationMode",void 0),$(this,"_videoHeight",void 0),$(this,"_videoWidth",void 0),$(this,"_forceBitrateLimit",void 0),$(this,"_enabled",!0),$(this,"_processorDestination",void 0),$(this,"_processorContext",void 0),$e()){const{width:p,height:m}=r.getSettings();this._videoWidth=p,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=o,this._scalabilityMode=a,this._optimizationMode=l,this._hints=h||[],-1===this._hints.indexOf(zt.SCREEN_TRACK))this.updateBitrateFromProfile();else if(function(p){const v=ot();return!(v.name!==p||!v.osVersion)&&115===Number(v.version)}(wt.CHROME)&&-1!==f_().indexOf("Windows")){const p=function(m){if("VideoFrame"in window&&"TransformStream"in window&&ct().supportWebRTCInsertableStream){const v=new MediaStreamTrackProcessor(m),y=new MediaStreamTrackGenerator({kind:"video"});let b,C,N=Date.now();const R=()=>{A&&(clearInterval(A),A=void 0),b&&(b.close(),b=void 0),m.stop(),C=void 0,y.removeEventListener("ended",R)};let A=window.setInterval(()=>{if(C&&b&&Date.now()-N>1e3)try{"live"===y.readyState?C.enqueue(b.clone()):R()}catch{R()}},1e3);const D=new TransformStream({transform:(M,x)=>{"live"===y.readyState?(C=x,N=Date.now(),void 0===b?(b=M,x.enqueue(M.clone())):(x.enqueue(b),b=M)):M.close()}});return y.addEventListener("ended",R),v.readable.pipeThrough(D).pipeTo(y.writable),y}}(r);p&&(T.info("local screen video track begin to inject frame"),this._mediaStreamTrack=p)}o&&-1!==this._hints.indexOf(zt.CUSTOM_TRACK)&&this.setEncoderConfiguration(o),this._processorContext=new _x(this.getTrackId(),"local"),this._processorDestination=new TA(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof r){const l=document.getElementById(r);l?r=l:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(o));const a=rn(rn(rn({},this._getDefaultPlayerConfig()),o),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(a):(this._player=r instanceof HTMLVideoElement?new US(a):new kx(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const l=this.getVideoElementVisibleStatus();this.safeEmit($_.VIDEO_ELEMENT_VISIBLE_STATUS,l)}catch{}},V("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}setEnabled(r,o){var a=this;return L(function*(){if(!o){if(r===a._enabled)return;a.stateCheck("enabled",r)}if(T.info("[".concat(a.getTrackId(),"] start setEnabled"),r),!r){a._originMediaStreamTrack.enabled=!1;try{yield jt(a,ge.NEED_DISABLE_TRACK,a)}catch(l){throw T.error("[".concat(a.getTrackId(),"] setEnabled to false error"),l.toString()),l}return o||(a._enabled=!1),void T.info("[".concat(a.getTrackId(),"] setEnabled to false success"))}a._originMediaStreamTrack.enabled=!0;try{yield jt(a,ge.NEED_ENABLE_TRACK,a)}catch(l){throw T.error("[".concat(a.getTrackId(),"] setEnabled to true error"),l.toString()),l}T.info("[".concat(a.getTrackId(),"] setEnabled to true success")),o||(a._enabled=!0)})()}setMuted(r){var o=this;return L(function*(){r!==o._muted&&(o.stateCheck("muted",r),o._muted=r,o._originMediaStreamTrack.enabled=!r,T.debug("[".concat(o.getTrackId(),"] start set muted: ").concat(r)),r?yield jt(o,ge.NEED_MUTE_TRACK,o):yield jt(o,ge.NEED_UNMUTE_TRACK,o))})()}setEncoderConfiguration(r,o){var a=this;return L(function*(){if(!a._enabled)throw new Y(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=Cl(r),a._forceBitrateLimit&&(r.bitrateMax=a._forceBitrateLimit.max_bitrate?a._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=a._forceBitrateLimit.min_bitrate?a._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const l=tv({encoderConfig:r});($e()||nt()||Ks())&&(l.deviceId=void 0),T.debug("[".concat(a.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(l));try{yield a._originMediaStreamTrack.applyConstraints(l),a.updateMediaStreamTrackResolution()}catch(d){const h=new Y(k.UNEXPECTED_ERROR,d.toString());throw T.error("[".concat(a.getTrackId(),"] applyConstraints error"),h.toString()),h}}a._encoderConfig=r,-1===a._hints.indexOf(zt.SCREEN_TRACK)&&a.updateBitrateFromProfile();try{yield jt(a,ge.NEED_UPDATE_VIDEO_ENCODER,a)}catch(l){return l.throw(T)}})()}getStats(){return vc(()=>{T.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Do(this,ge.GET_STATS)||rn({},NS)}setBeautyEffect(r){return L(function*(){T.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")})()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}getCurrentFrameImage(r){var o=arguments,a=this;return L(function*(){return a._player?a._player.getCurrentFrameToUint8Array(r,o.length>1&&void 0!==o[1]?o[1]:1):yield RA(r)})()}setBitrateLimit(r){var o=this;return L(function*(){if(T.debug("[".concat(o.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r){o._forceBitrateLimit=r,o._encoderConfig&&(o._encoderConfig.bitrateMax=o._encoderConfig.bitrateMax&&o._encoderConfig.bitrateMax<r.max_bitrate?o._encoderConfig.bitrateMax:r.max_bitrate,o._encoderConfig.bitrateMin=r.min_bitrate);try{yield jt(o,ge.NEED_UPDATE_VIDEO_ENCODER,o)}catch(a){return a.throw(T)}}})()}setOptimizationMode(r){var o=this;return L(function*(){if("motion"!==r&&"detail"!==r&&"balanced"!==r)return void T.error(k.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const a=o._optimizationMode;try{o._optimizationMode=r,yield jt(o,ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,o)}catch(l){throw o._optimizationMode=a,T.error("[".concat(o.getTrackId(),"] set optimization mode failed"),l.toString()),l}T.info("[".concat(o.getTrackId(),"] set optimization mode success (").concat(r,")"))})()}setScalabiltyMode(r){if(1===r.numSpatialLayers&&1!==r.numTemporalLayers)return T.error(k.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,T.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){wA(this._originMediaStreamTrack).then(r=>{let[o,a]=r;this._videoHeight=a,this._videoWidth=o}).catch(iS)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}setSenderConfiguration(r){var o=this;return L(function*(){if(!o._enabled)throw new Y(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");T.debug("[".concat(o.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=Cl(r),o._forceBitrateLimit&&(r.bitrateMax=o._forceBitrateLimit.max_bitrate?o._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=o._forceBitrateLimit.min_bitrate?o._forceBitrateLimit.min_bitrate:r.bitrateMin),o._encoderConfig=r,-1===o._hints.indexOf(zt.SCREEN_TRACK)&&o.updateBitrateFromProfile();try{yield jt(o,ge.NEED_UPDATE_VIDEO_ENCODER,o)}catch(a){return a.throw(T)}})()}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:o,frameRate:a}=this.getMediaStreamTrackSettings();if(!r||!o||!a)return;const{bitrateMax:l,bitrateMin:d}=this._encoderConfig;if(null==d||null==l){const{max:h,min:p}=function(m,g,v,y,b){const C=V("BITRATE_ADAPTER_TYPE");if("DEFAULT_BITRATE"===C)return{min:y,max:b};if(void 0===b){var N;const A=Math.floor(200*Math.pow(v/15,.6)*Math.pow(m*g/640/360,.75));b="STANDARD_BITRATE"===C?4*A:2*A,y=null!==(N=y)&&void 0!==N?N:A}else{var R;y=null!==(R=y)&&void 0!==R?R:Math.floor(b/10)}return{min:y,max:b}}(r,o,a,d,l);this._encoderConfig.bitrateMin=p,this._encoderConfig.bitrateMax=h,T.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(o,", fps: ").concat(a,"] => [brMax: ").concat(h,", brMin: ").concat(p,"]"))}}getVideoElementVisibleStatus(){try{var r,o;const a=null==this||null===(r=this._player)||void 0===r?void 0:r.getContainerElement(),l={track:this,element:null==this||null===(o=this._player)||void 0===o?void 0:o.getVideoElement(),slot:a?.parentElement},{element:d,slot:h}=l;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=z1.checkOneElementVisible(d),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;be.reportApiInvoke(null,{tag:st.TRACER,name:Yn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(m.visible?"Video is visible":"Invisible because of ".concat(m.reason))}return m}return}catch(a){throw new Y(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}renewMediaStreamTrack(r){return L(function*(){})()}pipe(r){if(this.processor===r)return r;if(r._source)throw new Y(k.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this._encoderConfig;r&&(a=rn(rn({},a),Cl(r))),a=dh(a);const l=Ct(8,"track-video-cloned-"),d=new NK(o?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,dh(this._scalabilityMode),this._optimizationMode,l,dh(this._hints));return r&&a&&d.setEncoderConfiguration(a),T.debug("clone video track from ".concat(this.getTrackId()," to ").concat(l,", clone ").concat(o)),d}replaceTrack(r,o){var a=this;return L(function*(){if(!(r instanceof MediaStreamTrack))throw new Y(k.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==r.kind)throw new Y(k.INVALID_PARAMS,"track should be a video MediaStreamTrack");yield a._updateOriginMediaStreamTrack(r,o,!0),a.updateMediaStreamTrackResolution()})()}sendSeiData(r){if(vc(()=>{be.reportApiInvoke(null,{name:Yn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:st.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!V("ENABLE_VIDEO_SEI")||!V("ENABLE_ENCODED_TRANSFORM"))return void T.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Y(k.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const o=this.getRTCRtpTransceiver();if(!o)return void T.warning("Video track is not published, SEI can not be send");const a=o.sender.getParameters();if(0===a.codecs.length)return;const l=a.codecs[0].mimeType.toLocaleLowerCase();"video/h264"===l?this.safeEmit("sei-to-send",r):T.warning("SEI is not supported by ".concat(l))}bindProcessorDestinationEvents(){var r=this;this.processorDestination.on(hr.ON_TRACK,function(){var o=L(function*(a){a?a!==r._mediaStreamTrack&&(r._mediaStreamTrack=a,r._updatePlayerSource(),yield jt(r,ge.NEED_REPLACE_TRACK,r)):r._mediaStreamTrack!==r._originMediaStreamTrack&&(r._mediaStreamTrack=r._originMediaStreamTrack,r._updatePlayerSource(),yield jt(r,ge.NEED_REPLACE_TRACK,r))});return function(a){return o.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(hr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(cs.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(cs.REQUEST_CONSTRAINTS)}},Qe(et.prototype,"play",[Lx,C5],Object.getOwnPropertyDescriptor(et.prototype,"play"),et.prototype),Qe(et.prototype,"stop",[xx],Object.getOwnPropertyDescriptor(et.prototype,"stop"),et.prototype),Qe(et.prototype,"setEnabled",[T5,I5,w5],Object.getOwnPropertyDescriptor(et.prototype,"setEnabled"),et.prototype),Qe(et.prototype,"setMuted",[Fx,zr,Ux],Object.getOwnPropertyDescriptor(et.prototype,"setMuted"),et.prototype),Qe(et.prototype,"setEncoderConfiguration",[R5,A5],Object.getOwnPropertyDescriptor(et.prototype,"setEncoderConfiguration"),et.prototype),Qe(et.prototype,"getStats",[D5],Object.getOwnPropertyDescriptor(et.prototype,"getStats"),et.prototype),Qe(et.prototype,"setBeautyEffect",[O5,N5],Object.getOwnPropertyDescriptor(et.prototype,"setBeautyEffect"),et.prototype),Qe(et.prototype,"getCurrentFrameData",[Vx],Object.getOwnPropertyDescriptor(et.prototype,"getCurrentFrameData"),et.prototype),Qe(et.prototype,"getCurrentFrameImage",[P5],Object.getOwnPropertyDescriptor(et.prototype,"getCurrentFrameImage"),et.prototype),Qe(et.prototype,"setBitrateLimit",[M5],Object.getOwnPropertyDescriptor(et.prototype,"setBitrateLimit"),et.prototype),Qe(et.prototype,"setOptimizationMode",[k5],Object.getOwnPropertyDescriptor(et.prototype,"setOptimizationMode"),et.prototype),Qe(et.prototype,"setScalabiltyMode",[L5],Object.getOwnPropertyDescriptor(et.prototype,"setScalabiltyMode"),et.prototype),Qe(et.prototype,"updateMediaStreamTrackResolution",[Ud],Object.getOwnPropertyDescriptor(et.prototype,"updateMediaStreamTrackResolution"),et.prototype),Qe(et.prototype,"pipe",[Qs],Object.getOwnPropertyDescriptor(et.prototype,"pipe"),et.prototype),Qe(et.prototype,"unpipe",[Bx],Object.getOwnPropertyDescriptor(et.prototype,"unpipe"),et.prototype),Qe(et.prototype,"close",[jx],Object.getOwnPropertyDescriptor(et.prototype,"close"),et.prototype),Qe(et.prototype,"replaceTrack",[Hx],Object.getOwnPropertyDescriptor(et.prototype,"replaceTrack"),et.prototype),et),VS=(VA=Ae({argsMap:(n,r)=>[n.getTrackId(),r]}),x5=Gn(),F5=Tf("CameraVideoTrack","_enabledMutex"),U5=Ae({argsMap:(n,r)=>[n.getTrackId(),r]}),BA=Gn(),Al=Ae({argsMap:(n,r)=>[n.getTrackId(),r]}),Gx=Gn(),Wx=Ae({argsMap:n=>[n.getTrackId()]}),ws=class PK extends Ve{get __className__(){return"CameraVideoTrack"}constructor(r,o,a,l,d,h){var p;super(r,Cl(o.encoderConfig),l,d,h),p=this,$(this,"_config",void 0),$(this,"_originalConstraints",void 0),$(this,"_constraints",void 0),$(this,"_enabled",!0),$(this,"_deviceName","default"),$(this,"tryResumeVideoForIOS15_16WeChat",L(function*(){(yf()||iR())&&!function(){const m=ot();if(m.os!==pi.IOS||!m.osVersion)return!1;const g=m.osVersion.split(".");return 15===Number(g[0])&&Number(g[1])>=2}()&&eS()&&p._enabled&&!p._isClosed&&(T.debug("[".concat(p.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),yield p.renewMediaStreamTrack())})),this._config=o,this._originalConstraints=a,this._constraints=a,this._deviceName=r.label,this._encoderConfig=Cl(this._config.encoderConfig),xt.on(wi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),xt.on(wi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}setDevice(r){var o=this;return L(function*(){return"string"==typeof r?o._setDeviceById(r):r.deviceId?o._setDeviceById(r.deviceId):r.facingMode?o._setDeviceByFacingModel(r.facingMode):void 0})()}_setDeviceById(r){var o=this;return L(function*(){if(T.info("[".concat(o.getTrackId(),"] set device to ").concat(r)),o._enabled)try{const a=yield mo.getDeviceById(r),l={};l.video=rn({},o._constraints),l.video.deviceId={exact:r},l.video.facingMode=void 0,o._originMediaStreamTrack.stop();let d=null;try{d=yield Gr(l,o.getTrackId())}catch(h){throw T.error("[".concat(o.getTrackId(),"] setDevice failed"),h.toString()),d=yield Gr({video:o._constraints},o.getTrackId()),yield o._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),h}yield o._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),o.updateMediaStreamTrackResolution(),o._deviceName=a.label,o._config.cameraId=r,o._constraints.deviceId={exact:r}}catch(a){throw T.error("[".concat(o.getTrackId(),"] setDevice error"),a.toString()),a}else try{const a=yield mo.getDeviceById(r);o._deviceName=a.label,o._config.cameraId=r,o._constraints.deviceId={exact:r}}catch(a){throw T.error("[".concat(o.getTrackId(),"] setDevice error"),a.toString()),a}T.info("[".concat(o.getTrackId(),"] setDevice success"))})()}_setDeviceByFacingModel(r){var o=this;return L(function*(){T.info("[".concat(o.getTrackId(),"] set facingMode ").concat(r));const a={video:rn(rn({},o._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(o._enabled){o._originMediaStreamTrack.stop();let l=null;try{l=yield Gr(a,o.getTrackId())}catch(d){throw T.error("[".concat(o.getTrackId(),"] setDeviceByFacingModel failed"),d.toString()),l=yield Gr({video:o._constraints},o.getTrackId()),yield o._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),d}yield o._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),o.updateMediaStreamTrackResolution()}o._deviceName="",o._config.facingMode=r,o._config.cameraId=void 0,o._constraints=rn({},a.video),T.info("[".concat(o.getTrackId(),"] setDeviceByFacingModel success"))})()}setEnabled(r,o){var a=this;return L(function*(){if(!o){if(r===a._enabled)return;a.stateCheck("enabled",r)}if(T.info("[".concat(a.getTrackId(),"] start setEnabled"),r),r){try{if(a.isExternalTrack)a._originMediaStreamTrack.enabled=!0;else{const l=yield Gr({video:a._constraints},a.getTrackId());yield a._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1)}yield jt(a,ge.NEED_ENABLE_TRACK,a)}catch(l){throw T.error("[".concat(a.getTrackId(),"] setEnabled true error"),l.toString()),l}a.updateMediaStreamTrackResolution(),T.info("[".concat(a.getTrackId(),"] setEnabled to true success")),o||(a._enabled=!0)}else{a.isExternalTrack?a._originMediaStreamTrack.enabled=!1:(a._originMediaStreamTrack.onended=null,a._originMediaStreamTrack.stop()),o||(a._enabled=!1);try{yield jt(a,ge.NEED_DISABLE_TRACK,a)}catch(l){throw T.error("[".concat(a.getTrackId(),"] setEnabled to false error"),l.toString()),l}T.info("[".concat(a.getTrackId(),"] setEnabled to false success"))}})()}setEncoderConfiguration(r,o){var a=this;return L(function*(){if(!a._enabled)throw new Y(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=Cl(r),a._forceBitrateLimit&&(r.bitrateMax=a._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=a._forceBitrateLimit.min_bitrate||r.bitrateMin);const l=Vn(a._config);l.encoderConfig=r;const d=tv(l);($e()||nt()||Ks())&&(d.deviceId=void 0),T.debug("[".concat(a.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(d));try{yield a._originMediaStreamTrack.applyConstraints(d),a.updateMediaStreamTrackResolution()}catch(h){const p=new Y(k.UNEXPECTED_ERROR,h.toString());throw T.error("[".concat(a.getTrackId(),"] applyConstraints error"),p.toString()),p}a._config=l,a._constraints=d,a._originalConstraints=d,a._encoderConfig=r,-1===a._hints.indexOf(zt.SCREEN_TRACK)&&a.updateBitrateFromProfile();try{yield jt(a,ge.NEED_UPDATE_VIDEO_ENCODER,a)}catch(h){return h.throw(T)}})()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){var r=this;if((nt()||Ks())&&this._enabled&&!this._isClosed&&xt.duringInterruption){const o=function(){var a=L(function*(){xt.off(wi.IOS_INTERRUPTION_END,o),r._enabled&&!r._isClosed&&(T.debug("[".concat(r.getTrackId(),"] try capture camera media device for interrupted iOS device.")),yield r.setEnabled(!1),yield r.setEnabled(!0))});return function(){return a.apply(this,arguments)}}();xt.on(wi.IOS_INTERRUPTION_END,o)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($_.TRACK_ENDED)}renewMediaStreamTrack(r){var o=this;return L(function*(){const a=r||o._constraints,l=mo.searchDeviceIdByName(o._deviceName);if(l&&!a.deviceId&&(a.deviceId={exact:l}),o._enabled){const d=yield Gr({video:a},o.getTrackId());o._constraints=a,yield o._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!0),o.updateMediaStreamTrackResolution()}})()}close(){super.close(),xt.off(wi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),xt.off(wi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this._encoderConfig;r&&(a=rn(rn({},a),Cl(r))),a=dh(a);const l=Ct(8,"track-cam-cloned-"),d=new PK(o?this._mediaStreamTrack.clone():this._mediaStreamTrack,dh(rn(rn({},this._config),{},{encoderConfig:a})),dh(this._constraints),dh(this._scalabilityMode),this._optimizationMode,l);return r&&a&&d.setEncoderConfiguration(a),T.debug("clone track from ".concat(this.getTrackId()," to ").concat(l,", clone ").concat(o)),d}bindProcessorContextEvents(){var r=this;this.processorContext.on(cs.REQUEST_UPDATE_CONSTRAINTS,function(){var o=L(function*(a,l,d){try{const h=Object.assign({},r._originalConstraints,...a);yield r.renewMediaStreamTrack(h),l()}catch(h){d(h)}});return function(a,l,d){return o.apply(this,arguments)}}()),this.processorContext.on(cs.REQUEST_CONSTRAINTS,function(){var o=L(function*(a){a(r._originMediaStreamTrack.getSettings())});return function(a){return o.apply(this,arguments)}}())}},Qe(ws.prototype,"setDevice",[VA,x5],Object.getOwnPropertyDescriptor(ws.prototype,"setDevice"),ws.prototype),Qe(ws.prototype,"setEnabled",[F5,U5,BA],Object.getOwnPropertyDescriptor(ws.prototype,"setEnabled"),ws.prototype),Qe(ws.prototype,"setEncoderConfiguration",[Al,Gx],Object.getOwnPropertyDescriptor(ws.prototype,"setEncoderConfiguration"),ws.prototype),Qe(ws.prototype,"close",[Wx],Object.getOwnPropertyDescriptor(ws.prototype,"close"),ws.prototype),ws);function zx(n,r,o,a){o.optimizationMode&&(a&&a.width&&a.height?(o.encoderConfig=rn(rn({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),"motion"!==o.optimizationMode&&"detail"!==o.optimizationMode||(r.contentHint=o.optimizationMode,r.contentHint===o.optimizationMode?T.debug("[".concat(n,"] set content hint to"),o.optimizationMode):T.debug("[".concat(n,"] set content hint failed")))):T.warning("[".concat(n,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Kx,jA,HA,Vd,go,qx,Yx,V5,Ih,$x,Xx,pr;class Zx extends lx{getUserId(){return this._userId}constructor(r,o,a,l){super(r,"track-".concat(r.kind,"-").concat(o,"-").concat(l.clientId,"_").concat(Ct(5,""))),$(this,"_userId",void 0),$(this,"_uintId",void 0),$(this,"_isDestroyed",!1),$(this,"store",void 0),$(this,"processor",void 0),$(this,"processorContext",void 0),this._userId=o,this._uintId=a,this.store=l}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,T.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let wh=(Kx=Ae({argsMap:(n,r,o)=>[n.getTrackId(),"string"==typeof r?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",o]}),jA=Ae({argsMap:n=>[n.getTrackId()]}),HA=Ae({argsMap:(n,r)=>[n.getTrackId(),r.name]}),Vd=Ae({argsMap:n=>[n.getTrackId()]}),Qe((go=class extends Zx{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Ki.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(n,r,o,a){super(n,r,o,a),$(this,"_videoVisibleTimer",null),$(this,"_previousVideoVisibleStatus",void 0),$(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),$(this,"trackMediaType",Tl.VIDEO),$(this,"_videoWidth",void 0),$(this,"_videoHeight",void 0),$(this,"_player",void 0),$(this,"processorDestination",void 0),$(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new _x(this.getTrackId(),"remote"),this.processorDestination=new TA(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return vc(()=>{T.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Do(this,ge.GET_STATS)||rn({},PS)}play(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof n){const a=document.getElementById(n);a?n=a:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const o=rn(rn({fit:"cover"},r),{},{trackId:this.getTrackId(),element:n});this._player?this._player.updateConfig(o):(this._player=n instanceof HTMLVideoElement?new US(o):new kx(o),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(bh.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=a=>{this.safeEmit(bh.VIDEO_STATE_CHANGED,a)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(bh.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},V("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){wA(this._originMediaStreamTrack).then(n=>{let[r,o]=n;this._videoHeight=o,this._videoWidth=r}).catch(iS)}_updatePlayerSource(){T.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var n,r;const o=null==this||null===(n=this._player)||void 0===n?void 0:n.getContainerElement(),a={track:this,element:null==this||null===(r=this._player)||void 0===r?void 0:r.getVideoElement(),slot:o?.parentElement},{element:l,slot:d}=a;if(this.isPlaying&&l instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=z1.checkOneElementVisible(l),p=Object.assign({},h);if(p.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=p.visible;be.reportApiInvoke(null,{tag:st.TRACER,name:Yn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(p.visible?"Video is visible":"Invisible because of ".concat(p.reason))}return p}return}catch(o){throw new Y(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}pipe(n){if(this.processor===n)return n;if(n._source)throw new Y(k.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;const n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(hr.ON_TRACK,function(){var r=L(function*(o){o?o!==n._mediaStreamTrack&&(n._mediaStreamTrack=o,n._updatePlayerSource()):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource())});return function(o){return r.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(hr.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(n){this.emit(Ff.SEI_RECEIVED,n)}}).prototype,"play",[Kx],Object.getOwnPropertyDescriptor(go.prototype,"play"),go.prototype),Qe(go.prototype,"stop",[jA],Object.getOwnPropertyDescriptor(go.prototype,"stop"),go.prototype),Qe(go.prototype,"pipe",[HA],Object.getOwnPropertyDescriptor(go.prototype,"pipe"),go.prototype),Qe(go.prototype,"unpipe",[Vd],Object.getOwnPropertyDescriptor(go.prototype,"unpipe"),go.prototype),go),Dl=(qx=Ae({argsMap:(n,r)=>[n.getTrackId(),r],throttleTime:300}),Yx=Ae({argsMap:(n,r)=>[n.getTrackId(),r]}),V5=Ae({argsMap:n=>[n.getTrackId()]}),Ih=Ae({argsMap:n=>[n.getTrackId()]}),$x=Ae({argsMap:(n,r)=>[n.getTrackId(),r.name]}),Xx=Ae({argsMap:n=>[n.getTrackId()]}),Qe((pr=class extends Zx{get isPlaying(){return this._useAudioElement?Wr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(n,r,o,a){super(n,r,o,a),$(this,"trackMediaType",Tl.AUDIO),$(this,"_source",void 0),$(this,"_useAudioElement",!0),$(this,"_volume",100),$(this,"processorContext",void 0),$(this,"processorDestination",void 0),$(this,"_played",!1),$(this,"_bypassWebAudio",!1),V("DISABLE_WEBAUDIO")?(this._source=new Th,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new ux(n,!0),V("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(as.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(bh.FIRST_FRAME_DECODED)}),this.processorContext=new ev(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new IA(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(as.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!n)return this._source.removeAllListeners(as.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(as.ON_AUDIO_BUFFER),this._source.on(as.ON_AUDIO_BUFFER,o=>n(o))}setVolume(n){this._volume=n,this._useAudioElement?Wr.setVolume(this.getTrackId(),n):this._source.setVolume(n/100)}setPlaybackDevice(n){var r=this;return L(function*(){if(!r._useAudioElement||!ix())throw new Y(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield Wr.setSinkID(r.getTrackId(),n)})()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return vc(()=>{T.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Do(this,ge.GET_STATS)||rn({},xd)}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] use audio element to play")),Wr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Wr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),n&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Wr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(n){if(this._bypassWebAudio)throw new Y(k.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===n)return n;if(n._source)throw new Y(k.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),n}unpipe(){var n;if(this._bypassWebAudio)throw new Y(k.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;null===(n=this._source.processSourceNode)||void 0===n||n.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(hr.ON_TRACK,function(){var r=L(function*(o){o?o!==n._mediaStreamTrack&&(n._mediaStreamTrack=o,n._updatePlayerSource(!1),n._source.processedNode=n._source.createMediaStreamSourceNode(o)):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource())});return function(o){return r.apply(this,arguments)}}()),this.processorDestination.on(hr.ON_NODE,r=>{this._source.processedNode=r;const o=!r;this._useAudioElement!==o&&(this._played?(this.stop(),this._useAudioElement=o,this.play()):this._useAudioElement=o)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(hr.ON_TRACK),this.processorDestination.removeAllListeners(hr.ON_NODE)}}).prototype,"setVolume",[qx],Object.getOwnPropertyDescriptor(pr.prototype,"setVolume"),pr.prototype),Qe(pr.prototype,"setPlaybackDevice",[Yx],Object.getOwnPropertyDescriptor(pr.prototype,"setPlaybackDevice"),pr.prototype),Qe(pr.prototype,"play",[V5],Object.getOwnPropertyDescriptor(pr.prototype,"play"),pr.prototype),Qe(pr.prototype,"stop",[Ih],Object.getOwnPropertyDescriptor(pr.prototype,"stop"),pr.prototype),Qe(pr.prototype,"pipe",[$x],Object.getOwnPropertyDescriptor(pr.prototype,"pipe"),pr.prototype),Qe(pr.prototype,"unpipe",[Xx],Object.getOwnPropertyDescriptor(pr.prototype,"unpipe"),pr.prototype),pr);const ls=new class extends nn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),$(this,"_lastHiddenTime",0),$(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),T.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class _o extends nn{constructor(r,o){super(),$(this,"trackMediaType",Tl.DATA),$(this,"_version",1),$(this,"_type",3),$(this,"_config",void 0),$(this,"_originDataChannel",void 0),$(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),$(this,"_dataStreamPacketHandler",{serialize:a=>a,deserialize:a=>a}),$(this,"_datachannelEventMap",new Map),this._config=r,o&&(this._originDataChannel=o,this._bandDataChannelEvents(o)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return V("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,o;return null!==(r=null===(o=this._originDataChannel)||void 0===o?void 0:o.readyState)&&void 0!==r?r:"connecting"}get _originDataChannelId(){var r,o;return null!==(r=null===(o=this._originDataChannel)||void 0===o?void 0:o.id)&&void 0!==r?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}_waitTillOpen(){var r=this;return L(function*(){return new le((o,a)=>{if(r._originDataChannel){"open"===r._originDataChannel.readyState&&o();const l=setTimeout(()=>{var d;a(new Y(k.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(d=r._originDataChannel)||void 0===d?void 0:d.id)))},1e4);r._originDataChannel.onopen=()=>{clearTimeout(l),r._originDataChannel&&r._bandDataChannelEvents(r._originDataChannel),o()},r._originDataChannel.onerror=()=>{throw clearTimeout(l),new Y(k.DATACHANNEL_CONNECTION_TIMEOUT)}}else a(new Y(k.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})})()}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[gA.OPEN,gA.CLOSE,gA.ERROR].forEach(o=>{const a=()=>{this.emit(o)};this._datachannelEventMap.set(o,a),r.addEventListener(o,a)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(o=>{let[a,l]=o;r.removeEventListener(a,l)}),this._datachannelEventMap.clear()}}class ai extends _o{constructor(r){super(r),$(this,"_messageListener",void 0),this._messageListener=o=>{if(o.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=o.data.slice(0,this._dataStreamPacketHeader.byteLength),l=new DataView(a).getUint8(3);if(l!==this.id)return void(V("SHOW_DATASTREAM2_LOG")&&T.debug("invalid datachannel id: ".concat(l," !== ").concat(this.id)));let d=o.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(gA.MESSAGE,d)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Rs extends _o{send(r){if(this._originDataChannel){let o=r;o=this._dataStreamPacketHandler.serialize(r);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+o.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(o),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}function Li(){const n=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>uA.revokeObjectURL(n),0),new Worker(uA.createObjectURL(n))}const BS=new Map,jS=new Map;function B5(n,r,o){let a=new Uint8Array(n,r,o),l=[],d=0;for(;l.length<o;)d+3<o&&0===a[d]&&0===a[d+1]&&3===a[d+2]&&(0===a[d+3]||1===a[d+3]||2===a[d+3]||3===a[d+3])?(l.push(a[d],a[d+1],a[d+3]),d+=4):(l.push(a[d]),d++);return new Uint8Array(l)}const HS=new Map;function GA(){return GA=L(function*(n,r){if(!ct().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(HS.has(n)||!n.track)return;const o={track:n.track};if(lh()){if(!n.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let l=null;try{l=n.createEncodedStreams()}catch(p){return void T.error("create video-encoded-streams error",p&&p.message)}let d=[];r.on("sei-to-send",p=>{d.push(p)});const h=new TransformStream({transform(p,m){o.controller||(o.controller=m),n.track&&n.track.id!==o.track.id&&(T.debug("video track changed: ".concat(o.track.id," => ").concat(n.track.id)),o.track.removeEventListener("ended",a),o.track=n.track,o.track.addEventListener("ended",a));const g=d.shift();g&&(p.data=function(v,y){const b=function(M){const x=M.length;let j=[],W=0;for(;W<x;)W+2<x&&0===M[W]&&0===M[W+1]&&(0===M[W+2]||1===M[W+2]||2===M[W+2]||3===M[W+2])?(j.push(M[W],M[W+1],3,M[W+2]),W+=3):(j.push(M[W]),W++);return new Uint8Array(j)}(y),C=b.length,N=Math.floor(C/255),R=C%255,A=new Uint8Array(6+N+1+C+v.byteLength);A[0]=0,A[1]=0,A[2]=0,A[3]=1,A[4]=6,A[5]=101;let D=0;for(;D<N;)A[6+D]=255,D++;return A[6+D]=R,D++,A.set(b,6+D),A.set(new Uint8Array(v),6+D+C),A.buffer}(p.data,g)),m.enqueue(p)}});l.readable.pipeThrough(h).pipeTo(l.writable)}else{if(!$e())return;{if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const l=Li(),d=new MessageChannel;yield new le(p=>l.onmessage=m=>{"registered"===m.data&&p(void 0)});const h=new RTCRtpScriptTransform(l,{name:"tx",port:d.port2},[d.port2]);n.transform=h,yield new le(p=>l.onmessage=m=>{"started"===m.data&&p(void 0)}),r.on("sei-to-send",p=>{d.port1.postMessage({sei:p})}),d.port1.onmessage=p=>{var m;p.data.transformed&&n.track&&(null===(m=n.track)||void 0===m?void 0:m.id)!==o.track.id&&(T.debug("video track changed: ".concat(o.track.id," => ").concat(n.track.id)),o.track.removeEventListener("ended",a),o.track=n.track,o.track.addEventListener("ended",a))},o.worker=l}}function a(){if(n.track){if(this.id!==n.track.id)return;n.track.removeEventListener("ended",a)}const l=HS.get(n);if(l){HS.delete(n);try{var d,h;null===(d=l.controller)||void 0===d||d.terminate(),null===(h=l.worker)||void 0===h||h.terminate()}catch(p){T.warning(p&&p.message)}}}HS.set(n,o),n.track.addEventListener("ended",a)}),GA.apply(this,arguments)}const GS=new Map;!function(){const n=ot();Hn.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Hn.getStreamFromExtension=n.name===wt.CHROME&&Number(n.version)>34,Hn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let o=!1;try{r.addTransceiver("audio"),o=!0}catch{}return r.close(),o}(),Hn.supportMinBitrate=n.name===wt.CHROME||n.name===wt.EDGE,Hn.supportSetRtpSenderParameters=function(){const r=ot();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!hl()||!(!$e()&&!m_())||r.name===wt.FIREFOX&&Number(r.version)>=64)}(),n.name===wt.SAFARI&&(Hn.supportDualStream=Number(n.version)>=14),Hn.webAudioMediaStreamDest=function(){const r=ot();return!(r.name===wt.SAFARI&&Number(r.version)<12)}(),Hn.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,Hn.supportWebGL=typeof WebGLRenderingContext<"u",Hn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,hl()||(Hn.webAudioWithAEC=!0),Hn.supportShareAudio=function(){const r=ot();return(r.os===pi.WIN_10||r.os===pi.WIN_81||r.os===pi.WIN_7||r.os===pi.LINUX||r.os===pi.MAC_OS||r.os===pi.CHROMIUM_OS)&&r.name===wt.CHROME&&Number(r.version)>=74}(),Hn.supportDataChannel=!!(Gs(76)||function(){const o=ot();return!(o.name!==wt.FIREFOX||!o.osVersion)&&Number(o.version)>=68}()||Oa(14)),Hn.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!hn()&&!!r&&r.prototype.setConfiguration instanceof Function}(),Hn.supportWebRTCEncodedTransform=function(){const r=ot();return"Chrome"===r.name&&Number(r.version)>=86||"Safari"===r.name&&Number(r.version)>=15}(),Hn.supportWebRTCInsertableStream=function(){const r=ot();return(r.name===wt.CHROME||r.name===wt.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Hn.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Hn.supportWebCrypto=typeof window<"u"&&void 0!==window.crypto&&void 0!==window.crypto.subtle,y_(()=>{Hn.supportDualStreamEncoding=function(){const r=ot();return!!V("DISABLE_WEBAUDIO")||"Safari"===r.name&&Number(r.version)>=14||!!("Chrome"===r.name&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&V("CHROME_DUAL_STREAM_USE_ENCODING"))}(),T.debug("browser ua: ",navigator.userAgent),T.info("browser info: ",n),T.info("browser compatibility: ",Hn)})}();class jf extends nn{constructor(r,o){super(),O(this,"signal",void 0),O(this,"token",void 0),O(this,"tokenTimeout",void 0),O(this,"tokenInterval",void 0),O(this,"_sequence",0),O(this,"userMap",new Map),O(this,"encoder",new TextEncoder),this.signal=r,this.token=o;const a=()=>{this.signal.connectionState===qt.CONNECTED&&this.check(),this.tokenInterval=0===this.userMap.size?window.setTimeout(a,1e3):window.setTimeout(a,3*V("P2P_TOKEN_INTERVAL"))};a()}send(r,o,a,l,d){var h=this;return L(function*(){var p,m,g;if(0===h.userMap.size)return;const v=Array.from(Md(p=h.userMap).call(p))[0].token;"string"!=typeof o&&(o=JSON.stringify(o)),l=null!==(m=l)&&void 0!==m?m:Ct(6,""),d=null!==(g=d)&&void 0!==g?g:h._sequence++;const y={_id:l,_type:r,_seq:d,_message:o,token:"".concat(h.token,"_").concat(v)};V("SHOW_P2P_LOG")&&T.debug("send message",y,"noNeedResponse : ".concat(a)),h.splitMessage(JSON.stringify(y)).forEach(C=>{h.signal.request(Pe.DATA_STREAM,{payload:_l(h.encoder.encode(C))})});const b=new le((C,N)=>{const R=window.setTimeout(()=>{h.off("res-@".concat(l,"_ack"),A),h.off("res-@".concat(l),M),h.off(mn.ABORT,D),T.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(l)),N(new Y(0===h.userMap.size?k.INVALID_REMOTE_USER:k.TIMEOUT))},V("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),A=()=>{R&&window.clearTimeout(R),h.off(mn.ABORT,D),a&&C()},D=()=>{R&&window.clearTimeout(R),h.off("res-@".concat(l,"_ack"),A),h.off("res-@".concat(l),M),N(new Y(k.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(l)))};h.once(mn.ABORT,D),h.once("res-@".concat(l,"_ack"),A);const M=(j,W)=>{x=!0,R&&window.clearTimeout(R),h.off("res-@".concat(l,"_ack"),A),h.off(mn.ABORT,D),"success"===j?C(W):N(new Y(k.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(l)))};let x=!1;a||(h.once("res-@".concat(l),M),Ii(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{x||T.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(l,", ").concat(y))}))});try{return yield b}catch(C){if(C.code===k.TIMEOUT)return yield h.send(r,o,a,l,d);throw C}})()}onMessage(r){var o;const{_uid:a}=r;let l,d=this.userMap.get(a);if(d)l=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==Bn.CHECK)return;const{token:g}=r;l=new Map,d={uid:a,isStart:!0,token:g,splitMessageMap:l,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,d),this.signal.emit(qe.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:g,total:v}=r,y=null!==(h=l.get(g))&&void 0!==h?h:[];if(y.push(r),l.has(g)||l.set(g,y),y.length!==v)return;{const b=hd(y).call(y,(C,N)=>C.index-N.index).map(C=>C.payload).join("");l.delete(g),(r=JSON.parse(b))._uid=a}}const{_type:p,token:m}=r;if(he(o=[Bn.ACK,Bn.CHECK]).call(o,p))return p===Bn.CHECK&&this.handleCheckToken(d,m),void this.receiveMessage(r);m==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(r):T.debug('Receive unexpected message", '.concat(m,", cur_token: ").concat(d.token,"_").concat(this.token),r)}check(){const r={_id:Ct(6,""),token:this.token,_type:Bn.CHECK};V("SHOW_P2P_LOG")&&T.debug("send message",r),this.signal.request(Pe.DATA_STREAM,{payload:_l(this.encoder.encode(JSON.stringify(r)))})}ack(r){const o={_id:r,_type:Bn.ACK,token:this.token};V("SHOW_P2P_LOG")&&T.debug("send message",o),this.signal.request(Pe.DATA_STREAM,{payload:_l(this.encoder.encode(JSON.stringify(o)))})}response(r,o,a){this.send(Bn.RESPONSE,JSON.stringify({success:!a,message:o}),!0,r)}handleReceivedMessage(r){const o=()=>{this.userMap.forEach(g=>{const{receivedMessagesMap:v,nextExpectedSequenceNumber:y}=g;for(;v.has(y);){const b=v.get(y);v.delete(y),this.receiveMessage(b),g.nextExpectedSequenceNumber++}})};if(!r)return void o();const{_uid:a,_seq:l}=r,d=this.userMap.get(a),{receivedMessagesMap:h,isStart:p,nextExpectedSequenceNumber:m}=d;if(l<m)return this.ack(r._id),void T.debug("[external-signal] receive old message, seq: ".concat(l,", ").concat(r._message));h.set(l,r),p&&l===m&&(this.receiveMessage(r),h.delete(m),d.nextExpectedSequenceNumber++,o())}receiveMessage(r){const{_id:o,_type:a,_message:l,_uid:d}=r;if(V("SHOW_P2P_LOG")&&T.debug("receive message",r),o){let h;switch(r._type!==Bn.ACK&&(l&&(h=JSON.parse(l)),this.ack(r._id)),r._type){case Bn.CANDIDATE:case Bn.CONTROL:this.signal.emit(a,h,d);break;case Bn.PUBLISH:case Bn.UNPUBLISH:case Bn.RESTART_ICE:case Bn.CALL:h.uid=d,Gi(this.signal,a,h).then(p=>{this.response(r._id,p)}).catch(()=>{this.response(r._id,void 0,!0)});break;case Bn.ACK:this.getListeners("res-@".concat(o,"_ack")).length>0&&this.emit("res-@".concat(o,"_ack"));break;case Bn.RESPONSE:{const{success:p,message:m}=h;this.emit("res-@".concat(o),p?"success":"failed",m);break}}}}splitMessage(r){if(r.length<jf.MAX_MESSAGE_SIZE)return[r];const o=[],{remoteToken:a}=JSON.parse(r),l=Ct(6,"");let d=0,h=800;const p=Math.ceil(r.length/h);for(;r.length>0;){d++;const m={id:l,index:d,total:p,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(a)};JSON.stringify(m).length>jf.MAX_MESSAGE_SIZE?h-=50:(o.push(m),r=r.slice(h))}return o.map(m=>JSON.stringify(m))}handleCheckToken(r,o){return r.token!==o?(T.debug("token changed, from ".concat(r.token," to ").concat(o)),this.reset(r.uid,o),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{T.debug("token timeout, ".concat(o)),this.reset(r.uid)},V("MAX_P2P_TIMEOUT")),!0)}handleUserOnline(){var r=this;return L(function*(){const o=yield Gi(r.signal,Bn.CALL,void 0),a=yield r.send(Bn.CALL,o);r.signal.emit(Me.P2P_CONNECTION,a,!0)})()}reset(r,o){var a=this;return L(function*(){const l=a.userMap.get(r);l&&(a.emit(mn.ABORT),a.signal.emit(qe.ON_USER_OFFLINE,{uid:l.uid,reason:fo.P2P_TOKEN_CHANGED}),a._sequence=0,a.userMap.clear(),o||(T.debug("change local token from ".concat(o," to ").concat(o)),a.token=Ct(6,"")))})()}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(mn.ABORT)}}O(jf,"MAX_SIZE",1),O(jf,"MAX_MESSAGE_SIZE",1024);class iv extends nn{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===qt.CONNECTED?this.emit(Me.WS_CONNECTED):r===qt.RECONNECTING?this.emit(Me.WS_RECONNECTING,this._websocketReconnectReason):r===qt.CLOSED&&this.emit(Me.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,o){super(),O(this,"_disconnectedReason",void 0),O(this,"_websocketReconnectReason",void 0),O(this,"_connectionState",qt.CLOSED),O(this,"reconnectToken",void 0),O(this,"p2pToken",void 0),O(this,"websocket",void 0),O(this,"openConnectionTime",void 0),O(this,"clientId",void 0),O(this,"lastMsgTime",Date.now()),O(this,"uploadCache",[]),O(this,"uploadCacheInterval",void 0),O(this,"rttRolling",new S_(5)),O(this,"pingpongTimer",void 0),O(this,"pingpongTimeoutCount",0),O(this,"joinResponse",void 0),O(this,"multiIpOption",void 0),O(this,"initError",void 0),O(this,"spec",void 0),O(this,"store",void 0),O(this,"_external_signal",void 0),O(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(Me.ON_BINARY_DATA,a.data);const l=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(l,"_id")){const d="res-@".concat(l._id);this.emit(d,l._result,l._message)}else if(Object.prototype.hasOwnProperty.call(l,"_type")){switch(l._type){case qe.ON_DATA_STREAM:return void this.handleDataStream(l._message);case qe.MUTE_AUDIO:case qe.MUTE_VIDEO:case qe.ON_P2P_LOST:case qe.ON_USER_ONLINE:return;case qe.ON_USER_OFFLINE:const{uid:d}=l._message;return T.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(l._type,l._message),l._type===qe.ON_NOTIFICATION&&this.handleNotification(l._message),l._type===qe.ON_USER_BANNED)switch(l._message.error_code){case 14:this.close(Rt.UID_BANNED);break;case 15:this.close(Rt.IP_BANNED);break;case 16:this.close(Rt.CHANNEL_BANNED)}if(l._type===qe.ON_USER_LICENSE_BANNED)switch(l._message.error_code){case we.ERR_LICENSE_MISSING:this.close(Rt.LICENSE_MISSING);break;case we.ERR_LICENSE_EXPIRED:this.close(Rt.LICENSE_EXPIRED);break;case we.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Rt.LICENSE_MINUTES_EXCEEDED);break;case we.ERR_LICENSE_PERIOD_INVALID:this.close(Rt.LICENSE_PERIOD_INVALID);break;case we.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Rt.LICENSE_MULTIPLE_SDK_SERVICE);break;case we.ERR_LICENSE_ILLEGAL:this.close(Rt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=o,this.websocket=new xR("gateway-".concat(this.clientId),this.spec.retryConfig,!0,V("JOIN_GATEWAY_USE_DUAL_DOMAIN"),V("JOIN_GATEWAY_USE_443PORT_ONLY"),o),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===qt.CONNECTED&&this.reconnect("retry",Hi.OFFLINE)}),this.p2pToken=Ct(6,""),this._external_signal=new jf(this,this.p2pToken)}request(r,o,a,l){var d=this;return L(function*(){const h=Ct(6,""),p={_id:h,_type:r,_message:o},m=d.websocket.connectionID,g=()=>new le((R,A)=>{if(d.connectionState===qt.CONNECTED)return R();const D=()=>{d.off(Me.WS_CLOSED,M),R()},M=()=>{d.off(Me.WS_CONNECTED,D),A(new Y(k.WS_ABORT))};d.once(Me.WS_CONNECTED,D),d.once(Me.WS_CLOSED,M)});if(d.connectionState!==qt.CONNECTING&&d.connectionState!==qt.RECONNECTING||r===Pe.JOIN||r===Pe.REJOIN||(yield g()),d.websocket.sendMessage(p,!0),l)return;const v=new le((R,A)=>{let D=!1;const M=(j,W)=>{D=!0,R({isSuccess:"success"===j,message:W||{}}),d.off(Me.WS_CLOSED,x),d.off(Me.WS_RECONNECTING,x),d.emit(Me.REQUEST_SUCCESS,r,o)};d.once("res-@".concat(h),M);const x=()=>{A(new Y(k.WS_ABORT,"type: ".concat(r))),d.off(Me.WS_CLOSED,x),d.off(Me.WS_RECONNECTING,x),d.off("res-@".concat(h),M)};d.once(Me.WS_CLOSED,x),d.once(Me.WS_RECONNECTING,x),Ii(V("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||D||(T.warning("[".concat(d.clientId,"] ws request timeout, type: ").concat(r)),d.emit(Me.REQUEST_TIMEOUT,r,o))})});let y=null;try{y=yield v}catch(R){if(d.connectionState===qt.CLOSED||r===Pe.LEAVE)throw new Y(k.WS_ABORT);return!d.spec.forceWaitGatewayResponse||a?R.throw():r===Pe.JOIN||r===Pe.REJOIN?null:(yield g(),yield d.request(r,o))}if(y.isSuccess)return y.message;const b=Number(y.message.error_code||y.message.code),C=Df(b),N=new Y(k.UNEXPECTED_RESPONSE,"".concat(C.desc,": ").concat(y.message.error_str),{code:b,data:y.message,desc:C.desc});return"success"===C.action?y.message:(T.warning("[".concat(d.clientId,"] [").concat(d.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(b,", message: ").concat(C.desc,", action: ").concat(C.action)),b===we.ERR_TOO_MANY_BROADCASTERS?((r===Pe.JOIN||r===Pe.REJOIN)&&(d.initError=N,d.close()),N.throw()):"failed"===C.action?N.throw():"quit"===C.action?(d.initError=N,d.close(),N.throw()):(b===we.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=y.message.option,T.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",Hi.MULTI_IP)):d.reconnect(C.action,Hi.SERVER_ERROR),r===Pe.JOIN||r===Pe.REJOIN?null:yield d.request(r,o)))})()}waitMessage(r,o){return new le(a=>{const l=d=>{(!o||o(d))&&(this.off(r,l),a(d))};this.on(r,l)})}uploadWRTCStats(r){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const o={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(A_.WRTC_STATS,o)}upload(r,o){const a={_type:r,_message:o};try{this.websocket.sendMessage(a)}catch{const d=V("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==qt.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},V("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,o){this.websocket.sendMessage({_type:r,_message:o})}sendExtensionMessage(r,o,a){var l=this;return L(function*(){return yield l._external_signal.send(r,o,a)})()}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new le((o,a)=>{this.once(Me.WS_CONNECTED,()=>o(this.joinResponse)),this.once(Me.WS_CLOSED,()=>a(this.initError||new Y(k.WS_ABORT))),this.connectionState=qt.CONNECTING,this.websocket.init(r).catch(a)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||Rt.LEAVE,this.connectionState=qt.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Ct(6,""),this._external_signal.clear(),this._external_signal=new jf(this,this.p2pToken)}join(){var r=this;return L(function*(){if(!r.joinResponse){r.emit(Me.ABORT_P2P_EXECUTION);const o=yield Gi(r,Me.REQUEST_JOIN_INFO),a=yield r.request(Pe.JOIN,o);if(!a)return r.emit(Me.REPORT_JOIN_GATEWAY,k.TIMEOUT,r.url||""),!1;r.joinResponse=a,r.emit(Me.JOIN_RESPONSE,r.joinResponse),r.reconnectToken=r.joinResponse.rejoin_token}return r.connectionState=qt.CONNECTED,r.pingpongTimer&&window.clearInterval(r.pingpongTimer),r.pingpongTimer=window.setInterval(r.handlePingPong.bind(r),3e3),!0})()}reconnect(r,o){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,o)}handleDataStream(r){try{var o;const a=gl(r.payload),l=(new TextDecoder).decode(a),d=JSON.parse(l);"total"in d&&"id"in d||he(o=Object.values(Bn)).call(o,d._type)?(d._uid=r.uid,this._external_signal.onMessage(d)):this.emit(qe.ON_DATA_STREAM,r)}catch{this.emit(qe.ON_DATA_STREAM,r)}}handleNotification(r){T.debug("[".concat(this.clientId,"] receive notification: "),r);const o=Df(r.code);if("success"!==o.action){if("failed"!==o.action)return"quit"===o.action?("ERR_REPEAT_JOIN_CHANNEL"===o.desc&&this.close(Rt.UID_BANNED),void this.close()):void this.reconnect(o.action,Hi.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),o.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=V("PING_PONG_TIME_OUT"),o=Date.now();this.pingpongTimeoutCount>=r&&(T.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(o-this.lastMsgTime,"ms")),o-this.lastMsgTime>V("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Hi.TIMEOUT):this.request(Pe.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-o;this.rttRolling.add(a),V("REPORT_STATS")&&this.send(Pe.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWebsocketEvents(){this.websocket.on(Fe.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Me.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Fe.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Fe.CLOSED,()=>{this.connectionState=qt.CLOSED}),this.websocket.on(Fe.FAILED,()=>{this._disconnectedReason=Rt.NETWORK_ERROR,this.connectionState=qt.CLOSED}),this.websocket.on(Fe.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState=this.connectionState===qt.CONNECTED?qt.RECONNECTING:qt.CONNECTING}),this.websocket.on(Fe.WILL_RECONNECT,(r,o,a)=>{"retry"!==r?(T.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):T.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(r)}),this.websocket.on(Fe.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(Me.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Y&&r.code===k.UNEXPECTED_RESPONSE&&r.data.code===we.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Hi.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Hi.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(Fe.REQUEST_NEW_URLS,(r,o)=>{Gi(this,Me.REQUEST_RECOVER,this.multiIpOption).then(r).catch(o)}),this.websocket.on(Fe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(qe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var rv={exports:{}};!function(n){n.exports=(()=>{var o={8:(d,h,p)=>{p.r(h),p.d(h,{Parser:()=>Re,Printer:()=>ca,parse:()=>xe,print:()=>Et});const m="\n",g="".concat("\r").concat(m),v=" ";let y;function b(de){return de>="0"&&de<="9"}function C(de){return de>="!"&&de<="~"}function N(de){return C(de)||de>="\x80"&&de<="\xff"}function R(de){return"!"===de||de>="#"&&de<="'"||de>="*"&&de<="+"||de>="-"&&de<="."||de>="0"&&de<="9"||de>="A"&&de<="Z"||de>="^"&&de<="~"}function A(de){return de>="1"&&de<="9"}function D(de){return de>="A"&&de<="Z"||de>="a"&&de<="z"}function M(de){return"d"===de||"h"===de||"m"===de||"s"===de}function x(de){return de>"\x01"&&de<"\t"||de>"\v"&&de<"\f"||de>"\x0e"&&de<"\xff"}function j(de){return D(de)||b(de)||"+"===de||"/"===de}function W(de){return b(de)||D(de)||"+"===de||"/"===de||"-"===de||"_"===de}function q(de){return D(de)||b(de)||"+"===de||"/"===de}function ee(de,w){var F=Object.keys(de);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(de);w&&(H=H.filter(function(ie){return Object.getOwnPropertyDescriptor(de,ie).enumerable})),F.push.apply(F,H)}return F}function J(de){for(var w=1;w<arguments.length;w++){var F=null!=arguments[w]?arguments[w]:{};w%2?ee(Object(F),!0).forEach(function(H){X(de,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(de,Object.getOwnPropertyDescriptors(F)):ee(Object(F)).forEach(function(H){Object.defineProperty(de,H,Object.getOwnPropertyDescriptor(F,H))})}return de}function X(de,w,F){return w in de?Object.defineProperty(de,w,{value:F,enumerable:!0,configurable:!0,writable:!0}):de[w]=F,de}var de;(de=y||(y={})).VERSION="v",de.ORIGIN="o",de.SESSION_NAME="s",de.INFORMATION="i",de.URI="u",de.EMAIL="e",de.PHONE="p",de.CONNECTION="c",de.BANDWIDTH="b",de.TIME="t",de.REPEAT="r",de.ZONE_ADJUSTMENTS="z",de.KEY="k",de.ATTRIBUTE="a",de.MEDIA="m";class Ce{consumeText(w,F){let H=F;for(;H<w.length;){const ie=w[H];if("\0"===ie||"\r"===ie||ie===m)break;H+=1}if(H-F==0)throw new Error("Invalid text, at ".concat(w));return H}consumeUnicastAddress(w,F,H){return this.consumeTill(w,F,v)}consumeOneOrMore(w,F,H){let ie=F;for(;H(w[ie]);)ie++;if(ie-F==0)throw new Error("Invalid rule at ".concat(F,"."));return ie}consumeSpace(w,F){if(w[F]===v)return F+1;throw new Error("Invalid space at ".concat(F,"."))}consumeIP4Address(w,F){let H=F;for(let ie=0;ie<4;ie++)if(H=this.consumeDecimalUChar(w,H),3!==ie){if("."!==w[H])throw new Error("Invalid IP4 address.");H++}return H}consumeDecimalUChar(w,F){let H=F;for(let Le=0;Le<3&&b(w[H]);Le++,H++);if(H-F==0)throw new Error("Invalid decimal uchar.");const ie=parseInt(w.slice(F,H));if(ie>=0&&ie<=255)return H;throw new Error("Invalid decimal uchar")}consumeIP6Address(w,F){let H=this.consumeHexpart(w,F);return":"===w[H]&&(H+=1,H=this.consumeIP4Address(w,H)),H}consumeHexpart(w,F){let H=F;if(":"===w[H]&&":"===w[H+1]){H+=2;try{H=this.consumeHexseq(w,H)}catch{}return H}if(H=this.consumeHexseq(w,H),":"===w[H]&&":"===w[H+1]){H+=2;try{H=this.consumeHexseq(w,H)}catch{}return H}return H}consumeHexseq(w,F){let H=F;for(;H=this.consumeHex4(w,H),":"===w[H]&&":"!==w[H+1];)H+=1;return H}consumeHex4(w,F){let H=0;for(;H<4;H++)if(!((ie=w[F+H])>="0"&&ie<="9"||ie>="a"&&ie<="f"||ie>="A"&&ie<="F")){if(0===H)throw new Error("Invalid hex 4");break}var ie;return F+H}consumeFQDN(w,F){let H=F;for(;b(w[H])||D(w[H])||"-"===w[H]||"."===w[H];)H+=1;if(H-F<4)throw new Error("Invalid FQDN");return H}consumeExtnAddr(w,F){return this.consumeOneOrMore(w,F,N)}consumeMulticastAddress(w,F,H){switch(H){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(w,F);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(w,F);default:try{return this.consumeFQDN(w,F)}catch{return this.consumeExtnAddr(w,F)}}}consumeIP6MulticastAddress(w,F){const H=this.consumeHexpart(w,F);return"/"===w[H]?this.consumeInteger(w,H+1):H}consumeIP4MulticastAddress(w,F){let H=F+3;const ie=w.slice(F,H),Le=parseInt(ie);if(Le<224||Le>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Vt=0;Vt<3;Vt++){if("."!==w[H])throw new Error("Invalid IP4 multicast address.");H+=1,H=this.consumeDecimalUChar(w,H)}return"/"===w[H]&&(H+=1),H=this.consumeTTL(w,H),"/"===w[H]&&(H=this.consumeInteger(w,H)),H}consumeInteger(w,F){if(!A(w[F]))throw new Error("Invalid integer.");for(F+=1;b(w[F]);)F+=1;return F}consumeTTL(w,F){if("0"===w[F])return F+1;if(!A(w[F]))throw new Error("Invalid TTL.");F+=1;for(let H=0;H<2&&b(w[F]);H++)F+=1;return F}consumeToken(w,F){return this.consumeOneOrMore(w,F,R)}consumeTime(w,F){let H=F;if("0"===w[H])return H+1;for(A(w[H])&&(H+=1);b(w[H]);)H++;if(H-F<10)throw new Error("Invalid time");return H}consumeAddress(w,F){return this.consumeTill(w,F,v)}consumeTypedTime(w,F){let H=F;return H=this.consumeOneOrMore(w,H,b),M(w[H])?H+1:H}consumeRepeatInterval(w,F){if(!A(w[F]))throw new Error("Invalid repeat interval");for(F+=1;b(w[F]);)F+=1;return M(w[F])&&(F+=1),F}consumePort(w,F){return this.consumeOneOrMore(w,F,b)}consume(w,F,H){for(let ie=0;ie<H.length;ie++){if(F+ie>=w.length)throw new Error("consume exceeding value length");if(w[F+ie]!==H[ie])throw new Error("consume ".concat(H," failed at ").concat(ie))}return F+H.length}consumeTill(w,F,H){let ie=F;for(;ie<w.length&&("string"!=typeof H||w[ie]!==H)&&("function"!=typeof H||!H(w[ie]));)ie++;return ie}}class Re extends Ce{constructor(){super(),X(this,"records",[]),X(this,"currentLine",0)}parse(w){const F=this.probeEOL(w);this.records=w.split(F).filter(qn=>!!Er(qn).call(qn)).map(this.parseLine),this.currentLine=0;const H=this.parseVersion(),ie=this.parseOrigin(),Le=this.parseSessionName(),Vt=this.parseInformation(),li=this.parseUri(),Jr=this.parseEmail(),Hl=this.parsePhone(),$C=this.parseConnection(),Qv=this.parseBandWidth(),Ls=this.parseTimeFields(),nu=this.parseKey(),pm=this.parseSessionAttribute(),wn=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:H,origin:ie,sessionName:Le,information:Vt,uri:li,emails:Jr,phones:Hl,connection:$C,bandwidths:Qv,timeFields:Ls,key:nu,attributes:pm,mediaDescriptions:wn}}getCurrentRecord(){const w=this.records[this.currentLine];if(!w)throw new Error("Record doesn't exit.");return w}probeEOL(w){for(let F=0;F<w.length;F++)if(w[F]===m)return"\r"===w[F-1]?g:m;throw new Error("Invalid newline character.")}parseLine(w,F){if(w.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const H=w[0];if("="!==w[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:H,value:w.slice(2),line:F,cur:0}}parseSessionAttribute(){const w=new Nt;for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==y.ATTRIBUTE)break;const H={attField:this.extractOneOrMore(F,ie=>R(ie)&&":"!==ie),_cur:0};":"===F.value[F.cur]&&(F.cur+=1,H.attValue=this.extractOneOrMore(F,x)),w.parse(H),this.currentLine++}return w.digest()}parseMediaAttributes(w){const F=new _n(w);for(;this.currentLine<this.records.length;){const H=this.getCurrentRecord();if(H.type!==y.ATTRIBUTE)break;const ie={attField:this.extractOneOrMore(H,Le=>R(Le)&&":"!==Le),_cur:0};":"===H.value[H.cur]&&(H.cur+=1,ie.attValue=this.extractOneOrMore(H,x)),F.parse(ie),this.currentLine++}return F.digest()}parseKey(){const w=this.getCurrentRecord();if(w.type===y.KEY){if("prompt"===w.value||"clear:"===w.value||"base64:"===w.value||"uri:"===w.value)return w.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const w=this.getCurrentRecord();if(w.type===y.ZONE_ADJUSTMENTS){const F=[];for(;;)try{const H=this.extract(w,this.consumeTime);this.consumeSpaceForRecord(w);let ie=!1;"-"===w.value[w.cur]&&(ie=!0,w.cur+=1);const Le=this.extract(w,this.consumeTypedTime);F.push({time:H,typedTime:Le,back:ie})}catch{break}if(0===F.length)throw new Error("Invalid zone adjustments");return this.currentLine++,F}return[]}parseRepeat(){const w=[];for(;;){const F=this.getCurrentRecord();if(F.type!==y.REPEAT)break;{const H=this.extract(F,this.consumeRepeatInterval),ie=this.parseTypedTime(F);w.push({repeatInterval:H,typedTimes:ie}),this.currentLine++}}return w}parseTypedTime(w){const F=[];for(;;)try{this.consumeSpaceForRecord(w),F.push(this.extract(w,this.consumeTypedTime))}catch{break}if(0===F.length)throw new Error("Invalid typed time.");return F}parseTime(){const w=this.getCurrentRecord(),F=this.extract(w,this.consumeTime);this.consumeSpaceForRecord(w);const H=this.extract(w,this.consumeTime);return this.currentLine++,{startTime:F,stopTime:H}}parseBandWidth(){const w=[];for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==y.BANDWIDTH)break;{const H=this.extractOneOrMore(F,R);if(":"!==F.value[F.cur])throw new Error("Invalid bandwidth field.");F.cur++;const ie=this.extractOneOrMore(F,b);w.push({bwtype:H,bandwidth:ie}),this.currentLine++}}return w}parseVersion(){const w=this.getCurrentRecord();if(w.type!==y.VERSION)throw new Error("first sdp record must be version");const F=w.value.slice(0,this.consumeOneOrMore(w.value,0,b));if(F.length!==w.value.length)throw new Error('invalid proto version, "v='.concat(w.value,'"'));return this.currentLine++,F}parseOrigin(){const w=this.getCurrentRecord();if(w.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");const F=this.extractOneOrMore(w,N);this.consumeSpaceForRecord(w);const H=this.extractOneOrMore(w,b);this.consumeSpaceForRecord(w);const ie=this.extractOneOrMore(w,b);this.consumeSpaceForRecord(w);const Le=this.extractOneOrMore(w,R);this.consumeSpaceForRecord(w);const Vt=this.extractOneOrMore(w,R);this.consumeSpaceForRecord(w);const li=this.extract(w,this.consumeUnicastAddress);return this.currentLine++,{username:F,sessId:H,sessVersion:ie,nettype:Le,addrtype:Vt,unicastAddress:li}}parseSessionName(){const w=this.getCurrentRecord();if(w.type===y.SESSION_NAME){const F=this.extract(w,this.consumeText);return this.currentLine++,F}}parseInformation(){const w=this.getCurrentRecord();if(w.type!==y.INFORMATION)return;const F=this.extract(w,this.consumeText);return this.currentLine++,F}parseUri(){const w=this.getCurrentRecord();if(w.type===y.URI)return this.currentLine++,w.value}parseEmail(){const w=[];for(;;){const F=this.getCurrentRecord();if(F.type!==y.EMAIL)break;w.push(F.value),this.currentLine++}return w}parsePhone(){const w=[];for(;;){const F=this.getCurrentRecord();if(F.type!==y.PHONE)break;w.push(F.value),this.currentLine++}return w}parseConnection(){const w=this.getCurrentRecord();if(w.type===y.CONNECTION){const F=this.extractOneOrMore(w,R);this.consumeSpaceForRecord(w);const H=this.extractOneOrMore(w,R);this.consumeSpaceForRecord(w);const ie=this.extract(w,this.consumeAddress);return this.currentLine++,{nettype:F,addrtype:H,address:ie}}}parseMedia(){const w=this.getCurrentRecord(),F=this.extract(w,this.consumeToken);this.consumeSpaceForRecord(w);let H=this.extract(w,this.consumePort);"/"===w.value[w.cur]&&(w.cur+=1,H+=this.extract(w,this.consumeInteger)),this.consumeSpaceForRecord(w);const ie=[];for(ie.push(this.extract(w,this.consumeToken));"/"===w.value[w.cur];)w.cur+=1,ie.push(this.extract(w,this.consumeToken));if(0===ie.length)throw new Error("Invalid proto");const Le=this.parseFmt(w);return this.currentLine++,{mediaType:F,port:H,protos:ie,fmts:Le}}parseTimeFields(){const w=[];for(;this.getCurrentRecord().type===y.TIME;){const F=this.parseTime(),H=this.parseRepeat(),ie=this.parseZone();w.push({time:F,repeats:H,zones:ie})}return w}parseMediaDescription(){const w=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){const F=this.parseMedia(),H=this.parseInformation(),ie=this.parseConnections(),Le=this.parseBandWidth(),Vt=this.parseKey(),li=this.parseMediaAttributes(F);w.push({media:F,information:H,connections:ie,bandwidths:Le,key:Vt,attributes:li})}return w}parseConnections(){const w=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)w.push(this.parseConnection());return w}parseFmt(w){const F=[];for(;;)try{this.consumeSpaceForRecord(w),F.push(this.extract(w,this.consumeToken))}catch{break}if(0===F.length)throw new Error("Invalid fmts");return F}extract(w,F){for(var H=arguments.length,ie=new Array(H>2?H-2:0),Le=2;Le<H;Le++)ie[Le-2]=arguments[Le];const Vt=F.call(this,w.value,w.cur,...ie),li=w.value.slice(w.cur,Vt);return w.cur=Vt,li}extractOneOrMore(w,F){const H=this.consumeOneOrMore(w.value,w.cur,F),ie=w.value.slice(w.cur,H);return w.cur=H,ie}consumeSpaceForRecord(w){if(w.value[w.cur]!==v)throw new Error("Invalid space at ".concat(w.cur,"."));w.cur+=1}}class ut extends Ce{constructor(){super(...arguments),X(this,"attributes",void 0),X(this,"digested",!1)}extractOneOrMore(w,F,H){const ie=this.consumeOneOrMore(w.attValue,w._cur,F),Le=w.attValue.slice(w._cur,ie),[Vt,li]=H||[];if("number"==typeof Vt&&Le.length<Vt)throw new Error("error in length, should be more or equal than ".concat(Vt," characters."));if("number"==typeof li&&Le.length>li)throw new Error("error in length, should be less or equal than ".concat(li," characters."));return w._cur=ie,Le}consumeAttributeSpace(w){if(w.attValue[w._cur]!==v)throw new Error("Invalid space at ".concat(w._cur,"."));w._cur+=1}extract(w,F){if(!w.attValue)throw new Error("Nothing to extract from attValue.");for(var H=arguments.length,ie=new Array(H>2?H-2:0),Le=2;Le<H;Le++)ie[Le-2]=arguments[Le];const Vt=F.call(this,w.attValue,w._cur,...ie),li=w.attValue.slice(w._cur,Vt);return w._cur=Vt,li}atEnd(w){if(!w.attValue)throw new Error;return w._cur>=w.attValue.length}peekChar(w){if(!w.attValue)throw new Error;return w.attValue[w._cur]}peek(w,F){if(!w.attValue)throw new Error;for(let H=0;H<F.length;H++)if(F[H]!==w.attValue[w._cur+H])return!1;return!0}parseIceUfrag(w){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(w,j,[4,256])}parseIcePwd(w){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(w,j,[22,256])}parseIceOptions(w){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const F=[];for(;!this.atEnd(w);){F.push(this.extractOneOrMore(w,j));try{this.consumeAttributeSpace(w)}catch(H){if(this.atEnd(w))break;throw H}}this.attributes.iceOptions=F}parseFingerprint(w){const F=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const H=this.extract(w,this.consumeTill);this.attributes.fingerprints.push({hashFunction:F,fingerprint:H})}parseExtmap(w){const F=this.extractOneOrMore(w,b);let H;"/"===this.peekChar(w)&&(this.extract(w,this.consume,"/"),H=this.extract(w,this.consumeToken)),this.consumeAttributeSpace(w);const ie=this.extract(w,this.consumeTill,v),Le=J(J({entry:parseInt(F,10)},H&&{direction:H}),{},{extensionName:ie});this.peekChar(w)===v&&(this.consumeAttributeSpace(w),Le.extensionAttributes=this.extract(w,this.consumeTill)),this.attributes.extmaps.push(Le)}parseSetup(w){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const F=this.extract(w,this.consumeTill);if("active"!==F&&"passive"!==F&&"actpass"!==F&&"holdconn"!==F)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=F}}class Nt extends ut{constructor(){super(...arguments),X(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(w){if(this.digested)throw new Error("already digested");try{switch(w.attField){case"group":this.parseGroup(w);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(w);break;case"ice-pwd":this.parseIcePwd(w);break;case"ice-options":this.parseIceOptions(w);break;case"fingerprint":this.parseFingerprint(w);break;case"setup":this.parseSetup(w);break;case"tls-id":this.parseTlsId(w);break;case"identity":this.parseIdentity(w);break;case"extmap":this.parseExtmap(w);break;case"msid-semantic":this.parseMsidSemantic(w);break;default:w.ignored=!0,this.attributes.unrecognized.push(w)}}catch(F){throw console.error("parsing session attribute ".concat(w.attField,' error, "a=').concat(w.attField,":").concat(w.attValue,'"')),F}if(!w.ignored&&w.attValue&&!this.atEnd(w))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(w){const F=this.extract(w,this.consumeToken),H=[];for(;!this.atEnd(w)&&this.peekChar(w)===v;)this.consumeAttributeSpace(w),H.push(this.extract(w,this.consumeToken));this.attributes.groups.push({semantic:F,identificationTag:H})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(w){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(w,W)}parseIdentity(w){const F=this.extractOneOrMore(w,q),H=[];for(;!this.atEnd(w)&&this.peekChar(w)===v;){this.consumeAttributeSpace(w);const ie=this.extract(w,this.consumeToken);this.extract(w,this.consume,"=");const Le=this.extractOneOrMore(w,Vt=>Vt!==v&&x(Vt));H.push({name:ie,value:Le})}this.attributes.identities.push({assertionValue:F,extensions:H})}parseMsidSemantic(w){this.peekChar(w)===v&&this.consumeAttributeSpace(w);const F={semantic:this.extract(w,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(w)}catch{break}if("*"===this.peekChar(w)){this.extract(w,this.consume,"*"),F.applyForAll=!0;break}{const H=this.extract(w,this.consumeTill,v);F.identifierList.push(H)}}this.attributes.msidSemantic=F}}class _n extends ut{constructor(w){super(),X(this,"attributes",void 0),-1!==w.protos.indexOf("RTP")||w.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(w){if(this.digested)throw new Error("already digested");try{switch(w.attField){case"extmap":this.parseExtmap(w);break;case"setup":this.parseSetup(w);break;case"ice-ufrag":this.parseIceUfrag(w);break;case"ice-pwd":this.parseIcePwd(w);break;case"ice-options":this.parseIceOptions(w);break;case"candidate":this.parseCandidate(w);break;case"remote-candidate":this.parseRemoteCandidate(w);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(w);break;case"rtpmap":this.parseRtpmap(w);break;case"ptime":this.parsePtime(w);break;case"maxptime":this.parseMaxPtime(w);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(w);break;case"ssrc":this.parseSSRC(w);break;case"fmtp":this.parseFmtp(w);break;case"rtcp-fb":this.parseRtcpFb(w);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(w);break;case"mid":this.parseMid(w);break;case"msid":this.parseMsid(w);break;case"imageattr":this.parseImageAttr(w);break;case"rid":this.parseRid(w);break;case"simulcast":this.parseSimulcast(w);break;case"sctp-port":this.parseSctpPort(w);break;case"max-message-size":this.parseMaxMessageSize(w);break;case"ssrc-group":this.parseSSRCGroup(w);break;default:w.ignored=!0,this.attributes.unrecognized.push(w)}}catch(F){throw console.error("parsing media attribute ".concat(w.attField,' error, "a=').concat(w.attField,":").concat(w.attValue,'"')),F}if(!w.ignored&&w.attValue&&!this.atEnd(w))throw new Error("attribute parsing error")}parseCandidate(w){const F=this.extractOneOrMore(w,j,[1,32]);this.consumeAttributeSpace(w);const H=this.extractOneOrMore(w,b,[1,5]);this.consumeAttributeSpace(w);const ie=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const Le=this.extractOneOrMore(w,b,[1,10]);this.consumeAttributeSpace(w);const Vt=this.extract(w,this.consumeAddress);this.consumeAttributeSpace(w);const li=this.extract(w,this.consumePort);this.consumeAttributeSpace(w),this.extract(w,this.consume,"typ"),this.consumeAttributeSpace(w);const Jr={foundation:F,componentId:H,transport:ie,priority:Le,connectionAddress:Vt,port:li,type:this.extract(w,this.consumeToken),extension:{}};for(this.peek(w," raddr")&&(this.extract(w,this.consume," raddr"),this.consumeAttributeSpace(w),Jr.relAddr=this.extract(w,this.consumeAddress)),this.peek(w," rport")&&(this.extract(w,this.consume," rport"),this.consumeAttributeSpace(w),Jr.relPort=this.extract(w,this.consumePort));this.peekChar(w)===v;){this.consumeAttributeSpace(w);const Hl=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w),Jr.extension[Hl]=this.extractOneOrMore(w,C)}this.attributes.candidates.push(Jr)}parseRemoteCandidate(w){const F=[];for(;;){const H=this.extractOneOrMore(w,b,[1,5]);this.consumeAttributeSpace(w);const ie=this.extract(w,this.consumeAddress);this.consumeAttributeSpace(w);const Le=this.extract(w,this.consumePort);F.push({componentId:H,connectionAddress:ie,port:Le});try{this.consumeAttributeSpace(w)}catch{break}}this.attributes.remoteCandidatesList.push(F)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(w){const F=this.extract(w,this.consumeToken);this.consumeAttributeSpace(w);const H=this.extract(w,this.consumeTill,"/");this.extract(w,this.consume,"/");const ie={encodingName:H,clockRate:this.extractOneOrMore(w,b)};this.atEnd(w)||"/"!==this.peekChar(w)||(this.extract(w,this.consume,"/"),ie.encodingParameters=parseInt(this.extract(w,this.consumeTill),10));const Le=this.attributes.payloads.find(Vt=>Vt.payloadType===parseInt(F,10));Le?Le.rtpMap=ie:this.attributes.payloads.push({payloadType:parseInt(F,10),rtpMap:ie,rtcpFeedbacks:[]})}parsePtime(w){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(w,this.consumeTill)}parseMaxPtime(w){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(w,this.consumeTill)}parseDirection(w){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=w.attField}parseSSRC(w){const F=this.extractOneOrMore(w,b);this.consumeAttributeSpace(w);const H=this.extract(w,this.consumeTill,":");let ie;":"===this.peekChar(w)&&(this.extract(w,this.consume,":"),ie=this.extract(w,this.consumeTill));const Le=this.attributes.ssrcs.find(Vt=>Vt.ssrcId===parseInt(F,10));Le?Le.attributes[H]=ie:this.attributes.ssrcs.push({ssrcId:parseInt(F,10),attributes:{[H]:ie}})}parseFmtp(w){const F=this.extract(w,this.consumeTill,v);this.consumeAttributeSpace(w);const H=this.extract(w,this.consumeTill),ie={};H.split(";").forEach(Vt=>{let[li,Jr]=Vt.split("=");li=Er(li).call(li);const Hl="string"==typeof Jr?Er(Jr).call(Jr):null;"string"==typeof li&&li.length>0&&(ie[li]=Hl)});const Le=this.attributes.payloads.find(Vt=>Vt.payloadType===parseInt(F,10));Le?Le.fmtp={parameters:ie}:this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[],fmtp:{parameters:ie}})}parseFmtParameters(w){const F={},H=this.extract(w,this.consumeTill,"=");w._cur++;const ie=this.extract(w,this.consumeTill,";");for(F[H]=ie;";"===w.attValue[w._cur];){const Le=this.extract(w,this.consumeTill,"=");w._cur++;const Vt=this.extract(w,this.consumeTill,";");F[Le]=Vt}return F}parseRtcpFb(w){let F="";F="*"===this.peekChar(w)?this.extract(w,this.consume,"*"):this.extract(w,this.consumeTill,v),this.consumeAttributeSpace(w);const H=this.extract(w,this.consumeTill,v);let ie;if("trr-int"===H)ie={type:H,interval:this.extract(w,this.consumeTill)};else{const Le={type:H};this.peekChar(w)===v&&(this.consumeAttributeSpace(w),Le.parameter=this.extract(w,this.consumeToken),this.peekChar(w)===v&&(Le.additional=this.extract(w,this.consumeTill))),ie=Le}if("*"===F)this.attributes.rtcpFeedbackWildcards.push(ie);else{const Le=this.attributes.payloads.find(Vt=>Vt.payloadType===parseInt(F,10));Le?Le.rtcpFeedbacks.push(ie):this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[ie]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(w){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const F={port:this.extract(w,this.consumePort)};this.peekChar(w)===v&&(this.consumeAttributeSpace(w),F.netType=this.extractOneOrMore(w,R),this.consumeAttributeSpace(w),F.addressType=this.extractOneOrMore(w,R),this.consumeAttributeSpace(w),F.address=this.extract(w,this.consumeAddress)),this.attributes.rtcp=F}parseMsid(w){const F={id:this.extractOneOrMore(w,R,[1,64])};this.peekChar(w)===v&&(this.consumeAttributeSpace(w),F.appdata=this.extractOneOrMore(w,R,[1,64])),this.attributes.msids.push(F)}parseImageAttr(w){this.attributes.imageattr.push(w.attValue)}parseRid(w){const F=this.extractOneOrMore(w,ie=>D(ie)||b(ie)||"_"===ie||"-"===ie);this.consumeAttributeSpace(w);const H={id:F,direction:this.extract(w,this.consumeToken),params:[]};if(this.peekChar(w)===v){if(this.consumeAttributeSpace(w),this.peek(w,"pt=")){this.extract(w,this.consume,"pt=");const ie=[];for(;;){const Le=this.extract(w,this.consumeToken);ie.push(Le);try{this.extract(w,this.consume,",")}catch{break}}H.payloads=ie,this.peekChar(w)===v&&this.extract(w,this.consume,v)}for(;;){const ie=this.extract(w,this.consumeToken);switch(ie){case"depend":{const Le={type:ie,rids:this.extract(w,this.consume,"=").split(",")};H.params.push(Le);break}default:{const Le={type:ie};"="===this.peekChar(w)&&(this.extract(w,this.consume,"="),Le.val=this.extract(w,this.consumeTill,";")),H.params.push(Le)}}try{this.extract(w,this.consume,";")}catch{break}}}this.attributes.rids.push(H)}parseSimulcast(w){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=w.attValue,this.extract(w,this.consumeTill)}parseSctpPort(w){this.attributes.sctpPort=this.extractOneOrMore(w,b,[1,5])}parseMaxMessageSize(w){this.attributes.maxMessageSize=this.extractOneOrMore(w,b,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(w){this.attributes.mid=this.extract(w,this.consumeToken)}parseSSRCGroup(w){const F=this.extract(w,this.consumeToken),H=[];for(;;)try{this.consumeAttributeSpace(w);const ie=this.extract(w,this.consumeInteger);H.push(parseInt(ie,10))}catch{break}this.attributes.ssrcGroups.push({semantic:F,ssrcIds:H})}}function Zt(de,w,F){return w in de?Object.defineProperty(de,w,{value:F,enumerable:!0,configurable:!0,writable:!0}):de[w]=F,de}class ca{constructor(){Zt(this,"eol",g)}print(w,F){let H="";return F&&(this.eol=F),H+=this.printVersion(w.version),H+=this.printOrigin(w.origin),H+=this.printSessionName(w.sessionName),H+=this.printInformation(w.information),H+=this.printUri(w.uri),H+=this.printEmail(w.emails),H+=this.printPhone(w.phones),H+=this.printConnection(w.connection),H+=this.printBandwidth(w.bandwidths),H+=this.printTimeFields(w.timeFields),H+=this.printKey(w.key),H+=this.printSessionAttributes(w.attributes),H+=this.printMediaDescription(w.mediaDescriptions),H}printVersion(w){return"v=".concat(w).concat(this.eol)}printOrigin(w){return"o=".concat(w.username," ").concat(w.sessId," ").concat(w.sessVersion," ").concat(w.nettype," ").concat(w.addrtype," ").concat(w.unicastAddress).concat(this.eol)}printSessionName(w){return w?"s=".concat(w).concat(this.eol):""}printInformation(w){return w?"i=".concat(w).concat(this.eol):""}printUri(w){return w?"u=".concat(w).concat(this.eol):""}printEmail(w){let F="";for(const H of w)F+="e=".concat(H).concat(this.eol);return F}printPhone(w){let F="";for(const H of w)F+="e=".concat(H).concat(this.eol);return F}printConnection(w){return w?"c=".concat(w.nettype," ").concat(w.addrtype," ").concat(w.address).concat(this.eol):""}printBandwidth(w){let F="";for(const H of w)F+="b=".concat(H.bwtype,":").concat(H.bandwidth).concat(this.eol);return F}printTimeFields(w){let F="";for(const H of w){F+="t=".concat(H.time.startTime," ").concat(H.time.startTime).concat(this.eol);for(const ie of H.repeats)F+="r=".concat(ie.repeatInterval," ").concat(ie.typedTimes.join(" ")).concat(this.eol);H.zoneAdjustments&&(F+="z=",F+="z=".concat(H.zoneAdjustments.map(ie=>"".concat(ie.time," ").concat(ie.back?"-":""," ").concat(ie.typedTime)).join(" ")).concat(this.eol),F+=this.eol)}return F}printKey(w){return w?"k=".concat(w).concat(this.eol):""}printAttributes(w){let F="";for(const H of w)F+="a=".concat(H.attField).concat(H.attValue?":".concat(H.attValue):"").concat(this.eol);return F}printMediaDescription(w){let F="";for(const H of w)F+=this.printMedia(H.media),F+=this.printInformation(H.information),F+=this.printConnections(H.connections),F+=this.printBandwidth(H.bandwidths),F+=this.printKey(H.key),F+=this.printMediaAttributes(H);return F}printConnections(w){let F="";for(const H of w)F+=this.printConnection(H);return F}printMedia(w){return"m=".concat(w.mediaType," ").concat(w.port," ").concat(w.protos.join("/")," ").concat(w.fmts.join(" ")).concat(this.eol)}printSessionAttributes(w){return new oe(this.eol).print(w)}printMediaAttributes(w){return new ve(this.eol).print(w)}}class Z{constructor(w){Zt(this,"eol",void 0),this.eol=w}printIceUfrag(w){return void 0===w?"":"a=ice-ufrag:".concat(w).concat(this.eol)}printIcePwd(w){return void 0===w?"":"a=ice-pwd:".concat(w).concat(this.eol)}printIceOptions(w){return void 0===w?"":"a=ice-options:".concat(w.join(v)).concat(this.eol)}printFingerprints(w){return w.length>0?w.map(F=>"a=fingerprint:".concat(F.hashFunction).concat(v).concat(F.fingerprint)).join(this.eol)+this.eol:""}printExtmap(w){return w.map(F=>"a=extmap:".concat(F.entry).concat(F.direction?"/".concat(F.direction):"").concat(v).concat(F.extensionName).concat(F.extensionAttributes?"".concat(v).concat(F.extensionAttributes):"").concat(this.eol)).join("")}printSetup(w){return void 0===w?"":"a=setup:".concat(w).concat(this.eol)}printUnrecognized(w){return w.map(F=>"a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol)).join("")}}class oe extends Z{print(w){let F="";return F+=this.printGroups(w.groups),F+=this.printMsidSemantic(w.msidSemantic),F+=this.printIceLite(w.iceLite),F+=this.printIceUfrag(w.iceUfrag),F+=this.printIcePwd(w.icePwd),F+=this.printIceOptions(w.iceOptions),F+=this.printFingerprints(w.fingerprints),F+=this.printSetup(w.setup),F+=this.printTlsId(w.tlsId),F+=this.printIdentity(w.identities),F+=this.printExtmap(w.extmaps),F+=this.printUnrecognized(w.unrecognized),F}printGroups(w){let F="";return w.length>0&&(F+=w.map(H=>"a=group:".concat(H.semantic).concat(H.identificationTag.map(ie=>"".concat(v).concat(ie)).join("")).concat(this.eol)).join("")),F}printIceLite(w){return void 0===w?"":"a=ice-lite"+this.eol}printTlsId(w){return w?"a=tls-id:".concat(w).concat(this.eol):""}printIdentity(w){return 0===w.length?"":w.map(F=>"a=identity:".concat(F.assertionValue).concat(F.extensions.map(H=>"".concat(v).concat(H.name).concat(H.value?"=".concat(H.value):"")))).join(this.eol)+this.eol}printMsidSemantic(w){if(!w)return"";let F="a=msid-semantic:".concat(w.semantic);return w.applyForAll?F+="".concat(v,"*"):w.identifierList.length>0&&(F+=w.identifierList.map(H=>"".concat(v).concat(H))),F+this.eol}}class ve extends Z{print(w){const F=w.attributes;let H="";return H+=this.printRTCP(F.rtcp),H+=this.printIceUfrag(F.iceUfrag),H+=this.printIcePwd(F.icePwd),H+=this.printIceOptions(F.iceOptions),H+=this.printCandidates(F.candidates),H+=this.printRemoteCandidatesList(F.remoteCandidatesList),H+=this.printEndOfCandidates(F.endOfCandidates),H+=this.printFingerprints(F.fingerprints),H+=this.printSetup(F.setup),H+=this.printMid(F.mid),H+=this.printExtmap(F.extmaps),H+=this.printRTPRelated(F),H+=this.printPtime(F.ptime),H+=this.printMaxPtime(F.maxPtime),H+=this.printDirection(F.direction),H+=this.printSSRCGroups(F.ssrcGroups),H+=this.printSSRC(F.ssrcs),H+=this.printRTCPMux(F.rtcpMux),H+=this.printRTCPMuxOnly(F.rtcpMuxOnly),H+=this.printRTCPRsize(F.rtcpRsize),H+=this.printMSId(F.msids),H+=this.printImageattr(F.imageattr),H+=this.printRid(F.rids),H+=this.printSimulcast(F.simulcast),H+=this.printSCTPPort(F.sctpPort),H+=this.printMaxMessageSize(F.maxMessageSize),H+=this.printUnrecognized(F.unrecognized),H}printCandidates(w){return w.map(F=>"a=candidate:".concat(F.foundation).concat(v).concat(F.componentId).concat(v).concat(F.transport).concat(v).concat(F.priority).concat(v).concat(F.connectionAddress).concat(v).concat(F.port).concat(v,"typ").concat(v).concat(F.type).concat(F.relAddr?"".concat(v,"raddr").concat(v).concat(F.relAddr):"").concat(F.relPort?"".concat(v,"rport").concat(v).concat(F.relPort):"").concat(Object.keys(F.extension).map(H=>"".concat(v).concat(H).concat(v).concat(F.extension[H])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(w){return w.map(F=>"a=remote-candidates:".concat(F.join(v)).concat(this.eol)).join("")}printEndOfCandidates(w){return void 0===w?"":"a=end-of-candidates"+this.eol}printRTPRelated(w){if(!w.payloads)return"";const F=w.payloads;let H="";H+=w.rtcpFeedbackWildcards.map(ie=>this.printRTCPFeedback("*",ie)).join("");for(const ie of F)H+=this.printRtpMap(ie.payloadType,ie.rtpMap),H+=this.printFmtp(ie.payloadType,ie.fmtp),H+=ie.rtcpFeedbacks.map(Le=>this.printRTCPFeedback(ie.payloadType,Le)).join("");return H}printFmtp(w,F){if(!F)return"";const H=Object.keys(F.parameters);return 1===H.length&&null===F.parameters[H[0]]?"a=fmtp:".concat(w).concat(v).concat(H[0]).concat(this.eol):"a=fmtp:".concat(w).concat(v).concat(Object.keys(F.parameters).map(ie=>"".concat(ie,"=").concat(F.parameters[ie])).join(";")).concat(this.eol)}printRtpMap(w,F){return F?"a=rtpmap:".concat(w).concat(v).concat(F.encodingName,"/").concat(F.clockRate).concat(F.encodingParameters?"/".concat(F.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(w,F){let H="a=rtcp-fb:".concat(w).concat(v),ie=F;return"trr-int"===ie.type?H+="ttr-int".concat(v).concat(ie.interval):(H+="".concat(ie.type),ie.parameter&&(H+="".concat(v).concat(ie.parameter),ie.additional&&(H+="".concat(v).concat(ie.additional)))),H+this.eol}printPtime(w){return void 0===w?"":"a=ptime:".concat(w).concat(this.eol)}printMaxPtime(w){return void 0===w?"":"a=maxptime:".concat(w).concat(this.eol)}printDirection(w){return void 0===w?"":"a=".concat(w).concat(this.eol)}printSSRC(w){return w.map(F=>Object.keys(F.attributes).map(H=>"a=ssrc:".concat(F.ssrcId.toString(10)).concat(v).concat(H).concat(F.attributes[H]?":".concat(F.attributes[H]):"").concat(this.eol)).join("")).join("")}printRTCPMux(w){return void 0===w?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(w){return void 0===w?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(w){return void 0===w?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(w){if(void 0===w)return"";let F="a=rtcp:".concat(w.port);return w.netType&&(F+="".concat(v).concat(w.netType)),w.addressType&&(F+="".concat(v).concat(w.addressType)),w.address&&(F+="".concat(v).concat(w.address)),F+this.eol}printMSId(w){return w.map(F=>"a=msid:".concat(F.id).concat(F.appdata?"".concat(v).concat(F.appdata):"").concat(this.eol)).join("")}printImageattr(w){return w.map(F=>"a=imageattr:".concat(F).concat(this.eol)).join("")}printRid(w){return w.map(F=>{let H="a=rid:".concat(F.id).concat(v).concat(F.direction);return F.payloads&&(H+="".concat(v,"pt=").concat(F.payloads.join(","))),F.params.length>0&&(H+="".concat(v).concat(F.params.map(ie=>"depend"===ie.type?"depend=".concat(ie.rids.join(",")):"".concat(ie.type,"=").concat(ie.val)).join(";"))),H+this.eol}).join("")}printSimulcast(w){return void 0===w?"":"a=simulcast:".concat(w).concat(this.eol)}printSCTPPort(w){return void 0===w?"":"a=sctp-port:".concat(w).concat(this.eol)}printMaxMessageSize(w){return void 0===w?"":"a=max-message-size:".concat(w).concat(this.eol)}printMid(w){return void 0===w?"":"a=mid:".concat(w).concat(this.eol)}printSSRCGroups(w){return w.map(F=>"a=ssrc-group:".concat(F.semantic).concat(F.ssrcIds.map(H=>"".concat(v).concat(H.toString(10))).join("")).concat(this.eol)).join("")}}function xe(de){return(new Re).parse(de)}function Et(de,w){return(new ca).print(de,w)}}},a={};function l(d){if(a[d])return a[d].exports;var h=a[d]={exports:{}};return o[d](h,h.exports,l),h.exports}return l.d=(d,h)=>{for(var p in h)l.o(h,p)&&!l.o(d,p)&&Object.defineProperty(d,p,{enumerable:!0,get:h[p]})},l.o=(d,h)=>Object.prototype.hasOwnProperty.call(d,h),l.r=d=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},l(8)})()}(rv);var Ei=rv.exports;function ds(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V("SVC_MODE");if(V("ENABLE_SVC"))return n in dr?n:dr.L1T3}const WS={[_e.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[_e.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function WA(n,r,o){r.forEach(a=>{var l;const d=WS[n].find(p=>{var m;let{key:g}=p;return he(m=a.extensionName).call(m,g)});if(!d)return;const h=o.find(p=>{let{extensionName:m}=p;return he(m).call(m,d.key)});h&&he(l=h.extensionName).call(l,"gdpr_forbidden")&&(a.extensionName=h.extensionName)})}function ov(n,r){r.forEach(o=>{var a;const l=WS[n].find(d=>{var h;let{key:p}=d;return he(h=o.extensionName).call(h,p)});he(a=o.extensionName).call(a,"gdpr_forbidden")&&l&&(o.extensionName=l.extensionName)})}function H5(n){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===n||he(n).call(n,"abs-send-time")}function zS(n){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===n||he(n).call(n,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function Jx(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function zA(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?Jx(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Jx(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}function sv(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:l,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:p,filterVideoCodec:m}=r,{useXR:g}=o;let v=[],y=[],b=[],C=[],N=!1,R=!1;if(Ei.parse(n).mediaDescriptions.forEach(D=>{a&&a!==D.attributes.direction||("video"!==D.media.mediaType||N||(y=D.attributes.payloads,C=D.attributes.extmaps,N=!0),"audio"!==D.media.mediaType||R||(v=D.attributes.payloads,b=D.attributes.extmaps,R=!0))}),!C||0===y.length)throw new Error("Cannot get video capabilities from SDP.");if(!b||0===v.length)throw new Error("Cannot get audio capabilities from SDP.");if(y.forEach(D=>{var M;null!==(M=D.rtpMap)&&void 0!==M&&M.clockRate&&(D.rtpMap.clockRate=parseInt(D.rtpMap.clockRate)),g&&D.rtcpFeedbacks.push({type:"rrtr"})}),v.forEach(D=>{var M;null!==(M=D.rtpMap)&&void 0!==M&&M.clockRate&&(D.rtpMap.clockRate=parseInt(D.rtpMap.clockRate)),g&&D.rtcpFeedbacks.push({type:"rrtr"})}),l&&(v=v.filter(D=>{var M;return"rtx"!==(null===(M=D.rtpMap)||void 0===M?void 0:M.encodingName.toLowerCase())}),y=y.filter(D=>{var M;return"rtx"!==(null===(M=D.rtpMap)||void 0===M?void 0:M.encodingName.toLowerCase())})),d&&(y=y.filter(D=>{var M;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(M=D.rtpMap)||void 0===M?void 0:M.encodingName)||"")})),h&&(v=v.filter(D=>{var M;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(M=D.rtpMap)||void 0===M?void 0:M.encodingName)||"")})),p&&p?.length>0&&(v=v.filter(D=>{var M;return he(p).call(p,(null===(M=D.rtpMap)||void 0===M?void 0:M.encodingName.toLowerCase())||"")})),m&&m?.length>0){const D=y.filter(M=>{var x;return he(m).call(m,(null===(x=M.rtpMap)||void 0===x?void 0:x.encodingName.toLowerCase())||"")});y=D.concat(l?[]:YA(D,y))}const A=V("UNSUPPORTED_VIDEO_CODEC");return A&&A.length>0&&(y=y.filter(D=>!(D.rtpMap&&he(A).call(A,D.rtpMap.encodingName.toLowerCase())))),{audioCodecs:v,videoCodecs:y,audioExtensions:b,videoExtensions:C}}function Bd(n){const r=Ei.parse(n);let o,a;for(const l of r.mediaDescriptions){if(!o){const d=l.attributes.iceUfrag,h=l.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");o={iceUfrag:d,icePwd:h}}if(!a){const d=l.attributes.fingerprints;d.length>0&&(a={fingerprints:d})}}if(!a&&r.attributes.fingerprints.length>0&&(a={fingerprints:r.attributes.fingerprints}),!a||!o)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:o,dtlsParameters:a}}function G5(n,r){const o=[],a=n.attributes.ssrcGroups.filter(h=>"FID"===h.semantic),l=n.attributes.ssrcGroups.find(h=>"SIM"===h.semantic),d=n.attributes.ssrcs;if(l)l.ssrcIds.forEach(h=>{var p;const m=null===(p=a.find(g=>g.ssrcIds[0]===h))||void 0===p?void 0:p.ssrcIds[1];o.push({ssrcId:h,rtx:r?m:void 0})});else if(a.length>0)o.push({ssrcId:a[0].ssrcIds[0],rtx:r?a[0].ssrcIds[1]:void 0});else{if(0===d.length)throw new Error("No ssrcs found on local media description.");o.push({ssrcId:d[0].ssrcId})}return o}function As(n,r,o){const{cname:a}=n;let l=[];r&&(l=KS(r)),0===l.length&&(l=n.iceParameters.candidates.map(v=>({foundation:v.foundation,componentId:"1",transport:v.protocol,priority:v.priority.toString(),connectionAddress:v.ip,port:v.port.toString(),type:v.type,extension:{}})),T.debug("Using candidates from gateway."));const d={fingerprints:n.dtlsParameters.fingerprints.map(v=>({hashFunction:v.algorithm,fingerprint:v.fingerprint}))},h={iceUfrag:n.iceParameters.iceUfrag,icePwd:n.iceParameters.icePwd};let p;switch(n.dtlsParameters.role){case"server":p="passive";break;case"client":p="active";break;case"auto":p="actpass"}const m=ea(n.rtpCapabilities),g=[];return Array.isArray(o)&&o.length>0&&o.forEach(v=>{g.push({kind:_e.VIDEO,ssrcId:v.v,rtx:v.v_rtx,mslabel:"".concat(v.v,"_").concat(v.a)},{kind:_e.AUDIO,ssrcId:v.a,mslabel:"".concat(v.v,"_").concat(v.a)})}),{dtlsParameters:d,iceParameters:h,candidates:l,rtpCapabilities:m,setup:p,cname:a,preSSRCs:g}}function KS(n){let r=[];return n.ip&&"number"==typeof n.port&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:n.ip,port:n.port.toString(),type:"host",extension:{}}],T.debug("Using remote candidate from AP ".concat(n.ip,":").concat(n.port)),n.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:n.ip6,port:n.port.toString(),type:"host",extension:{}}),T.debug("Using IPV6 remote candidate from AP ".concat(n.ip6,":").concat(n.port)))),r}function Rh(n,r,o){const a=[],l=[];return n.forEach(d=>{let{ssrcId:h,rtx:p}=d;const m=Ct(8,"track-"),g={ssrcId:h,attributes:zA({label:m,mslabel:o=o||Ct(10,""),msid:"".concat(o," ").concat(m)},r&&{cname:r})};if(a.push(g),void 0!==p){const v={ssrcId:p,attributes:zA({label:m,mslabel:o,msid:"".concat(o," ").concat(m)},r&&{cname:r})};a.push(v),l.push({semantic:"FID",ssrcIds:[h,p]})}}),n.length>1&&l.push({semantic:"SIM",ssrcIds:n.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:a,ssrcGroups:l}}function Hf(n,r){r instanceof Cn&&n.attributes.payloads.forEach(o=>{var a;const l=null===(a=o.rtpMap)||void 0===a?void 0:a.encodingName.toLowerCase();if(!l||-1===["opus","pcmu","pcma","g722"].indexOf(l))return;o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters.minptime="10",o.fmtp.parameters.useinbandfec="1";const d=r._encoderConfig;d&&"pcmu"!==l&&"pcma"!==l&&"g722"!==l&&(d.bitrate&&!hn()&&(o.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(o.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),o.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(o.fmtp.parameters.stereo="1",o.fmtp.parameters["sprop-stereo"]="1"))})}function KA(n){const r=n.attributes.unrecognized.findIndex(o=>"x-google-flag"===o.attField&&"conference"===o.attValue);-1!==r&&n.attributes.unrecognized.splice(r,1)}function qA(n,r){var o;if(!(r instanceof Ve&&r._encoderConfig&&-1===r._hints.indexOf(zt.SCREEN_TRACK)))return;const a=r._encoderConfig;ct().supportMinBitrate&&a.bitrateMin&&n.attributes.payloads.forEach(l=>{var d,h;he(d=["h264","h265","vp8","vp9","av1"]).call(d,(null===(h=l.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(l.fmtp||(l.fmtp={parameters:{}}),l.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),ct().supportMinBitrate&&!he(o=r._hints).call(o,zt.LOW_STREAM)&&a.bitrateMax&&n.attributes.payloads.forEach(l=>{var d,h;he(d=["h264","h265","vp8","vp9","av1"]).call(d,(null===(h=l.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(l.fmtp||(l.fmtp={parameters:{}}),l.fmtp.parameters["x-google-start-bitrate"]="".concat(V("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function av(n){if("video"!==n.media.mediaType)return;const r=ot();if(r.name!==wt.SAFARI&&r.os!==pi.IOS)return;const o=n.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));-1!==o&&n.attributes.extmaps.splice(o,1)}function qS(n,r,o){if(!r)return;let a,l;if("video"===n.media.mediaType?(a=o.videoExtensions,l=o.videoCodecs):(a=o.audioExtensions,l=o.audioCodecs),!0===r.twcc){const d=a.find(h=>zS(h.extensionName));if(d){const h=d.extensionName;n.attributes.extmaps.find(m=>zS(m.extensionName))||n.attributes.extmaps.push({entry:d.entry,extensionName:h}),(m=l,g=n.attributes.payloads,g.filter(v=>!!m.find(y=>y.payloadType===v.payloadType&&!!y.rtcpFeedbacks.find(b=>"transport-cc"===b.type)))).forEach(m=>{m.rtcpFeedbacks.find(g=>"transport-cc"===g.type)||m.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(!1===r.twcc){const d=n.attributes.extmaps.findIndex(h=>zS(h.extensionName));-1!==d&&n.attributes.extmaps.splice(d,1),n.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>"transport-cc"===m.type);-1!==p&&h.rtcpFeedbacks.splice(p,1)})}var m,g;if(!0===r.remb){const d=a.find(h=>H5(h.extensionName));if(d){const h=d.extensionName;n.attributes.extmaps.find(m=>m.extensionName===h)||n.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(m,g){return g.filter(v=>!!m.find(y=>y.payloadType===v.payloadType&&!!y.rtcpFeedbacks.find(b=>"goog-remb"===b.type)))}(l,n.attributes.payloads).forEach(m=>{m.rtcpFeedbacks.find(g=>"goog-remb"===g.type)||m.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(!1===r.remb){const d=n.attributes.extmaps.findIndex(h=>H5(h.extensionName));-1!==d&&n.attributes.extmaps.splice(d,1),n.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>"goog-remb"===m.type);-1!==p&&h.rtcpFeedbacks.splice(p,1)})}}function wc(n,r,o){if(hn()||"video"!==n.media.mediaType||!(r instanceof Ve)||"vp9"!==o&&"vp8"!==o||"vp8"===o&&!V("SIMULCAST")||"vp9"===o&&V("ENABLE_SVC")||void 0===r._scalabilityMode||r._scalabilityMode.numSpatialLayers<=1)return;const a="vp8"===o?2:r._scalabilityMode.numSpatialLayers,l=n.attributes.ssrcs[0],d=n.attributes.ssrcGroups.find(p=>"FID"===p.semantic&&p.ssrcIds[0]===l.ssrcId),h={semantic:"SIM",ssrcIds:[l.ssrcId]};for(let p=1;p<a;p++)n.attributes.ssrcs.push({ssrcId:l.ssrcId+p,attributes:Vn(l.attributes)}),h.ssrcIds.push(l.ssrcId+p),d&&(n.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+p,attributes:Vn(l.attributes)}),n.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[l.ssrcId+p,d.ssrcIds[1]+p]}));n.attributes.ssrcGroups.unshift(h)}function Tn(){return gn.apply(this,arguments)}function gn(){return gn=L(function*(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=new RTCPeerConnection;o.addTransceiver("video",{direction:"sendonly"}),o.addTransceiver("audio",{direction:"sendonly"}),o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"});const a=(yield o.createOffer()).sdp,{send:l,recv:d,sendrecv:h}=function(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=arguments.length>2?arguments[2]:void 0;const v=sv(g,p,m,"sendonly"),y=sv(g,p,m,"recvonly"),b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Lo(v,y,"videoExtensions",b,C,N),Lo(v,y,"videoCodecs",b,C,N),Lo(v,y,"audioExtensions",b,C,N),Lo(v,y,"audioCodecs",b,C,N),V("RAISE_H264_BASELINE_PRIORITY")){const R=[],A=[];N.videoCodecs.forEach((D,M)=>{var x;if("h264"===(null===(x=D.rtpMap)||void 0===x?void 0:x.encodingName.toLocaleLowerCase())){var j,W;const q=N.videoCodecs[M+1],ee=q&&t2(D,q),J=null===(j=D.fmtp)||void 0===j?void 0:j.parameters["profile-level-id"],X=null===(W=D.fmtp)||void 0===W?void 0:W.parameters["packetization-mode"];!J||J!==V("FIRST_H264_PROFILE_LEVEL_ID")||V("FIRST_PACKETIZATION_MODE")&&X!==V("FIRST_PACKETIZATION_MODE")?A.push(ee?[D,q]:[D]):R.push(ee?[D,q]:[D])}}),R.length>0&&A.length>0&&(T.debug("raising H264 baseline profile priority"),N.videoCodecs.forEach((D,M)=>{var x;if("h264"===(null===(x=D.rtpMap)||void 0===x?void 0:x.encodingName.toLocaleLowerCase())){const j=t2(D,N.videoCodecs[M+1]),W=R.shift()||A.shift()||[];W.length>0&&(j?N.videoCodecs.splice(M,2,...W):N.videoCodecs.splice(M,1,...W))}}),C.videoCodecs=C.videoCodecs.filter(D=>{var M,x;return!("h264"===(null===(M=D.rtpMap)||void 0===M?void 0:M.encodingName.toLocaleLowerCase())&&(null===(x=D.fmtp)||void 0===x?void 0:x.parameters["profile-level-id"])!==V("FIRST_H264_PROFILE_LEVEL_ID"))}),V("FILTER_SEND_H264_BASELINE")&&(b.videoCodecs=b.videoCodecs.filter(D=>{var M,x;return!("h264"===(null===(M=D.rtpMap)||void 0===M?void 0:M.encodingName.toLocaleLowerCase())&&(null===(x=D.fmtp)||void 0===x?void 0:x.parameters["profile-level-id"])!==V("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:b,recv:C,sendrecv:N}}(n,r,a);try{o.close()}catch{}return{send:l,recv:d,sendrecv:h}}),gn.apply(this,arguments)}function Qx(){const n={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=sv(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Lo(n,r,"videoExtensions",o,a,l),Lo(n,r,"videoCodecs",o,a,l),Lo(n,r,"audioExtensions",o,a,l),Lo(n,r,"audioCodecs",o,a,l),V("RAISE_H264_BASELINE_PRIORITY")){const d=l.videoCodecs.findIndex(h=>h.rtpMap&&"h264"===h.rtpMap.encodingName.toLocaleLowerCase()&&h.fmtp&&"42001f"===h.fmtp.parameters["profile-level-id"]);if(-1!==d){const h=l.videoCodecs.findIndex(p=>p.rtpMap&&"h264"===p.rtpMap.encodingName.toLocaleLowerCase());if(h<d){T.debug("raising H264 baseline profile priority");const p=l.videoCodecs[d];l.videoCodecs.splice(d,1),l.videoCodecs.splice(h,0,p)}-1!==h&&(a.videoCodecs=a.videoCodecs.filter(p=>!(p.rtpMap&&"h264"===p.rtpMap.encodingName.toLocaleLowerCase()&&p.fmtp&&"42001f"!==p.fmtp.parameters["profile-level-id"])))}}return{send:o,recv:a,sendrecv:l}}function Lo(n,r,o,a,l,d){if("videoExtensions"===o||"audioExtensions"===o){const h=[];return n[o].forEach(p=>{r[o].some((m,g)=>{if(p.entry===m.entry&&p.extensionName===m.extensionName)return h.push(g),!0})?d[o].push(p):a[o].push(p)}),void r[o].forEach((p,m)=>{-1===h.indexOf(m)&&l[o].push(p)})}if("videoCodecs"===o||"audioCodecs"===o){const h=[];return n[o].forEach(p=>{r[o].some((m,g)=>{if(p.payloadType===m.payloadType&&JSON.stringify(p)===JSON.stringify(m))return h.push(g),!0})?d[o].push(p):a[o].push(p)}),void r[o].forEach((p,m)=>{-1===h.indexOf(m)&&l[o].push(p)})}}function ea(n){const{send:r,recv:o,sendrecv:a}=n;if(!a){if(!r||!o)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:o}}let l,d;return r?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...r.audioCodecs,...a.audioCodecs],l.videoCodecs=[...r.videoCodecs,...a.videoCodecs],l.audioExtensions=[...r.audioExtensions,...a.audioExtensions],l.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):l=a,o?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...o.audioCodecs,...a.audioCodecs],d.videoCodecs=[...o.videoCodecs,...a.videoCodecs],d.audioExtensions=[...o.audioExtensions,...a.audioExtensions],d.videoExtensions=[...o.videoExtensions,...a.videoExtensions]):d=a,{send:l,recv:d}}function Ol(n){"audio"===n.media.mediaType&&n.attributes.payloads.filter(r=>{var o;return"opus"===(null===(o=r.rtpMap)||void 0===o?void 0:o.encodingName.toLowerCase())}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function xo(n,r,o,a){let l=[];if(n===_e.VIDEO){if(V("H264_PROFILE_LEVEL_ID")&&"h264"===a&&(l=r.videoCodecs.filter(d=>{var h;return he(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===V("H264_PROFILE_LEVEL_ID")})),!Array.isArray(l)||0===l.length){let d=[];const h=[],p=[],m=[];if(o.videoCodecs.forEach(g=>{const v=g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"";he(v).call(v,a)?d.push(g):he(v).call(v,"vp9")?h.push(g):he(v).call(v,"vp8")?p.push(g):he(v).call(v,"h264")&&m.push(g)}),0===d.length){let g="";0!==h.length?(d=h,g="vp9"):0!==p.length?(d=p,g="vp8"):0!==m.length&&(d=m,g="h264"),T.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(g))}0!==d.length&&(l=r.videoCodecs.filter(g=>d.some(v=>v.payloadType===g.payloadType)))}if(0===l.length&&(T.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),l=r.videoCodecs),V("USE_PUB_RTX")||V("USE_SUB_RTX")){const d=YA(l,r.videoCodecs);l=[...l,...d]}}else l=r.audioCodecs.filter(d=>{var h;return he(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)}),0===l.length&&(T.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),l=r.audioCodecs.filter(d=>{var h;return he(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return l}function YA(n,r){const o=n.map(a=>a.payloadType.toString());return r.filter(a=>a.rtpMap&&"rtx"===a.rtpMap.encodingName&&a.fmtp&&a.fmtp.parameters.apt&&he(o).call(o,a.fmtp&&a.fmtp.parameters.apt))}function xi(n,r,o){return $A.apply(this,arguments)}function $A(){return $A=L(function*(n,r,o){const a=r.toString(),l=e2(a,"offer","remote","exchangeSDP");yield n.setRemoteDescription({type:"offer",sdp:a});const d=yield n.createAnswer();if(!d.sdp)throw new Error("cannot get answer sdp");let h=d.sdp;h=ci(h,o||{}),l?.(h||""),yield n.setLocalDescription({type:"answer",sdp:h})}),$A.apply(this,arguments)}function ci(n,r,o){const a=Ei.parse(n),{useXR:l}=r;return a.mediaDescriptions.forEach(d=>{var h;d.attributes.mid&&(Array.isArray(o)&&!he(o).call(o,d.attributes.mid)||("audio"===d.media.mediaType&&Ol(d),l&&he(h=["audio","video"]).call(h,d.media.mediaType)&&d.attributes.payloads.forEach(p=>{-1===p.rtcpFeedbacks.findIndex(m=>"rrtr"===m.type)&&p.rtcpFeedbacks.push({type:"rrtr"})})))}),Ei.print(a)}function e2(n,r,o,a){if(V("SDP_LOGGING"))return T.upload("exchanging ".concat(o," ").concat(r," SDP during P2PConnection.").concat(a,"\n"),n),"offer"===r?l=>{e2(l,"answer","local"===o?"remote":"local",a)}:void 0}function cv(n){const r=V("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(o=>he(n).call(n,o))}function t2(n,r){try{var o;return(null===(o=n.fmtp)||void 0===o?void 0:o.parameters.apt)===r.payloadType.toString()}catch{return!1}}function Ds(n,r){return typeof V(n)===r?V(n):void 0}function n2(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function Nl(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?n2(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):n2(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}const lv=new Map;class YS extends nn{get state(){return this._state}set state(r){if(r===this._state)return;const o=this._state;this._state=r,"DISCONNECTED"===r&&this._disconnectedReason?this.emit(gi.CONNECTION_STATE_CHANGE,r,o,this._disconnectedReason):this.emit(gi.CONNECTION_STATE_CHANGE,r,o)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){T.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,o){super(),O(this,"store",void 0),O(this,"joinInfo",void 0),O(this,"key",void 0),O(this,"ntpOffset",0),O(this,"signal",void 0),O(this,"role",void 0),O(this,"inChannelInfo",{joinAt:null,duration:0}),O(this,"spec",void 0),O(this,"_state","DISCONNECTED"),O(this,"_statsCollector",void 0),O(this,"_disconnectedReason",void 0),O(this,"isSignalRecover",!1),O(this,"hasChangeBGPAddress",!1),O(this,"trafficStatsInterval",void 0),O(this,"networkQualityInterval",void 0),O(this,"_joinGatewayStartTime",0),O(this,"_signalTimeout",!1),O(this,"_clientRoleOptions",void 0),O(this,"_isProactiveJoin",!1),this.store=r,this.spec=o,this.signal=this.store.useP2P?new iv(Nl(Nl({},o),{},{retryConfig:o.websocketRetryConfig}),r):new M_(Nl(Nl({},o),{},{retryConfig:o.websocketRetryConfig}),r),this._statsCollector=o.statsCollector,this.role=o.role||"audience",this._clientRoleOptions=o.clientRoleOptions,this.handleSignalEvents()}join(r,o,a){var l=this;return L(function*(){l.store.joinGatewayStart(),"disabled"!==r.cloudProxyServer&&(l.hasChangeBGPAddress=!0);const d=Date.now();let h=lv.get(r.cname);if(h||(h=new Map,lv.set(r.cname,h)),l._isProactiveJoin=!0,h.has(r.uid)){const v=new z(k.UID_CONFLICT);throw be.joinGateway(r.sid,{lts:d,succ:!1,ec:v.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:l._isProactiveJoin,avoidJoinStartTime:l.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),l._isProactiveJoin=!1,v}h.set(r.uid,!0),l.joinInfo=r,l.key=o;let p=0;l.joinGatewayStartTime=d;const m=r.proxyServer;try{T.debug("[".concat(l.store.clientId,"] use websocket join uid ").concat(p));const v=r.gatewayAddrs.map(y=>{let{address:b}=y;const[C,N]=b.split(":"),R={host:C,port:N};return r.proxyServer&&(R.proxy=r.proxyServer),R});p=(yield l.signal.init(v,a)).uid,T.debug("[".concat(l.store.clientId,"] websocket join uid ").concat(p," cost ").concat(Date.now()-l.joinGatewayStartTime))}catch(v){var g;throw T.error("[".concat(l.store.clientId,"] User join failed"),v.toString()),be.joinGateway(r.sid,{lts:d,succ:!1,ec:(null===(g=v.data)||void 0===g?void 0:g.desc)||v.code,errorMsg:v.message,addr:l.signal.url,uid:r.uid,cid:r.cid,firstSuccess:l._isProactiveJoin,avoidJoinStartTime:l.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:r.preload}),l._isProactiveJoin=!1,h.delete(r.uid),l.signal.close(),v}return l.state="CONNECTED",l.inChannelInfo.joinAt=Date.now(),T.debug("[".concat(l.store.clientId,"] Connected to gateway server")),l.trafficStatsInterval=window.setInterval(()=>{l.updateTrafficStats().catch(v=>{T.warning("[".concat(l.store.clientId,"] get traffic stats error"),v.toString())})},3e3),l.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?l.emit(gi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):l.emit(gi.NETWORK_QUALITY,l._signalTimeout?{downlinkNetworkQuality:5,uplinkNetworkQuality:5}:"CONNECTED"===l.state&&l._statsCollector.trafficStats?{uplinkNetworkQuality:w4(l._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:w4(l._statsCollector.trafficStats.B_dnq)}:{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),l.store.joinGatewayEnd(),p})()}leave(){var r=arguments,o=this;return L(function*(){let a=r.length>0&&void 0!==r[0]&&r[0],l=r.length>1?r[1]:void 0;if("DISCONNECTED"!==o.state){l!==Rt.FALLBACK&&(o.state="DISCONNECTING");try{a||o.signal.connectionState!==qt.CONNECTED||(yield(d=o.signal.request(Pe.LEAVE,void 0,!0),le.race([d,b_(3e3)])))}catch(d){T.warning("[".concat(o.store.clientId,"] leave request failed, ignore"),d)}o.signal.close(l),l!==Rt.FALLBACK&&(o.state="DISCONNECTED"),o.reset()}var d})()}publish(r,o,a){var l=this;return L(function*(){if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new z(k.INVALID_OPERATION,"can not publish when connection state is ".concat(l.state));const d={state:"offer",p2p_id:l.store.p2pId,ortc:o,mode:l.spec.mode,extend:V("PUB_EXTEND"),twcc:!!V("PUBLISH_TWCC"),rtx:!!V("USE_PUB_RTX")};try{return(yield l.signal.request(Pe.PUBLISH,d,!0))._message}catch(h){if(a&&h.data&&h.data.code===we.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(l.store.clientId,"] receive publish error code, retry"),h.toString()),yield l.tryUnpubBeforeRepub(r,o),l.publish(r,o,!1);throw h}})()}publishDataChannel(r,o,a){var l=this;return L(function*(){var d;if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new z(k.INVALID_OPERATION,"can not publish when connection state is ".concat(l.state));const h={stream_id:o.streamId,ordered:o.ordered?1:0,max_retrans_times:null!==(d=o.maxRetransmits)&&void 0!==d?d:10,channel_id:o.channelId,metadata:o.metadata};try{yield l.signal.request(Pe.PUBLISH_DATASTREAM,h,!0)}catch(p){if(a&&p.data&&p.data.code===we.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(l.store.clientId,"] receive publish datachannels error code, retry"),p.toString()),yield l.tryUnpubDataChannelBeforeRepub(r,o),l.publishDataChannel(r,o,!1);throw p}})()}unpublish(r,o){var a=this;return L(function*(){try{if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new z(k.INVALID_OPERATION,"can not publish when connection state is ".concat(a.state));yield a.signal.request(Pe.UNPUBLISH,{stream_id:o,ortc:r},!0)}catch(l){T.warning("[".concat(a.store.clientId,"] unpublish warning: "),l)}})()}unpublishDataChannel(r){var o=this;return L(function*(){try{if("CONNECTED"!==o.state&&"RECONNECTING"!==o.state)throw new z(k.INVALID_OPERATION,"can not publish when connection state is ".concat(o.state));yield le.all(r.map(a=>o.signal.request(Pe.UNPUBLISH_DATASTREAM,{channel_id:a},!0)))}catch(a){T.warning("unpublish datachannels warning: ",a)}})()}presubscribe(r,o,a){var l=this;return L(function*(){if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new z(k.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(l.state));const d={stream_id:r,stream_type:o,mode:l.spec.mode,codec:l.spec.codec,p2p_id:l.store.p2pId,twcc:!!V("SUBSCRIBE_TWCC"),rtx:!!V("USE_SUB_RTX")||void 0,extend:V("SUB_EXTEND"),svc:Array.isArray(V("SVC"))&&0!==V("SVC").length?V("SVC"):void 0};try{return yield l.signal.request(Pe.PRE_SUBSCRIBE,d,!0)}catch(h){if(a&&h.data&&h.data.code===we.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(l.store.clientId,"] pre-subscribe error, retry"),h.toString()),l.presubscribe(r,o,!1);throw h}})()}subscribe(r,o,a){var l=this;return L(function*(){if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new z(k.INVALID_OPERATION,"can not subscribe when connection state is ".concat(l.state));const d={stream_id:r,stream_type:o.stream_type,mode:l.spec.mode,codec:l.spec.codec,p2p_id:l.store.p2pId,twcc:!!V("SUBSCRIBE_TWCC"),rtx:!!V("USE_SUB_RTX"),extend:V("SUB_EXTEND"),ssrcId:o.ssrcId,svc:Array.isArray(V("SVC"))&&0!==V("SVC").length?V("SVC"):void 0};try{return(yield l.signal.request(Pe.SUBSCRIBE,d,!0))._message}catch(h){if(a&&h.data&&h.data.code===we.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(l.store.clientId,"] receiver subscribe error code, retry"),h.toString()),yield l.tryUnsubBeforeResub(r,o),yield l.subscribe(r,o,!1);throw h}})()}subscribeDataChannel(r,o,a){var l=this;return L(function*(){if("CONNECTED"!==l.state&&"RECONNECTING"!==l.state)throw new z(k.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(l.state));const d={uid:r,stream_id:o.id,channel_id:o.datachannelId};try{return void(yield l.signal.request(Pe.SUBSCRIBE_DATASTREAM,d,!0))}catch(h){if(a&&h.data&&h.data.code===we.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(l.store.clientId,"] receiver subscribe datachannel error code, retry"),h.toString()),yield l.tryUnsubDataChannelBeforeResub(r,o),yield l.subscribeDataChannel(r,o,!1);throw h}})()}subscribeAll(r,o){var a=this;return L(function*(){if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new z(k.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(a.state));const l={p2p_id:a.store.p2pId,users:r,dtx:!1,rtx:!!V("USE_SUB_RTX"),twcc:!!V("SUBSCRIBE_TWCC"),svc:Array.isArray(V("SVC"))&&0!==V("SVC").length?V("SVC"):void 0};try{return yield a.signal.request(Pe.SUBSCRIBE_STREAMS,l,!0)}catch(d){if(o&&d.data&&d.data.code===we.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(a.store.clientId,"] receiver massSubscribe error code, retry"),d.toString()),yield a.tryMassUnsubBeforeResub(r),yield a.subscribeAll(r,!1);throw d}})()}setVideoProfile(r){var o=this;return L(function*(){const a=function(l){if(!(l.bitrateMax&&l.bitrateMin&&l.frameRate&&l.height&&l.width))return;let d=l.frameRate,h=l.width,p=l.height,m=!0;return"number"!=typeof d&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),"number"!=typeof h&&(h=h.exact||h.ideal||h.max||h.min||0,h||(m=!1)),"number"!=typeof p&&(p=p.exact||p.ideal||p.max||p.min||0,d||(m=!1)),m?{stream_type:0,width:h,height:p,fps:d,start_bps:1e3*l.bitrateMax,min_bps:1e3*l.bitrateMin,target_bps:1e3*l.bitrateMax}:void 0}(r);if(a)return o.signal.request(Pe.SET_VIDEO_PROFILE,a);T.debug("[".concat(o.store.clientId,"] encoder config is not complete, do not report to gateway"))})()}unsubscribe(r,o){var a=this;return L(function*(){try{yield a.signal.request(Pe.UNSUBSCRIBE,{p2p_id:a.store.p2pId,ortc:r,stream_id:o},!0)}catch(l){T.warning("[".concat(a.store.clientId,"] unsubscribe warning: "),l)}})()}unsubscribeDataChannel(r,o){var a=this;return L(function*(){try{if("CONNECTED"!==a.state&&"RECONNECTING"!==a.state)throw new z(k.INVALID_OPERATION,"can not publish when connection state is ".concat(a.state));yield le.all(r.map(l=>a.signal.request(Pe.UNSUBSCRIBE_DATASTREAM,{stream_id:l,uid:o},!0)))}catch(l){T.warning("unsubscribeDataChannel warning: ",l)}})()}massUnsubscribe(r){var o=this;return L(function*(){try{yield o.signal.request(Pe.UNSUBSCRIBE_STREAMS,r,!0)}catch(a){T.warning("[".concat(o.store.clientId,"] massUnsubscribeAll warning: "),a)}})()}reconnectPC(r){var o=this;return L(function*(){const{iceParameters:a,dtlsParameters:l,rtpCapabilities:d}=r;return{gatewayEstablishParams:yield o.signal.request(Pe.CONNECT_PC,{p2p_id:o.store.p2pId,stream_id:o.store.uid,ortc:{iceParameters:a,dtlsParameters:l,rtpCapabilities:d}},!0),gatewayAddress:o.getCurrentGatewayAddress()}})()}getGatewayInfo(){return this.signal.request(Pe.GATEWAY_INFO)}renewToken(r){var o=this;return L(function*(){yield o.signal.request(Pe.RENEW_TOKEN,r),o.key=r.token})()}setClientRole(r,o){var a=this;return L(function*(){if(o&&(a._clientRoleOptions=Object.assign({},o)),"CONNECTED"!==a.state)return void(a.role=r);let l,d=0;"audience"===r?a._clientRoleOptions&&a._clientRoleOptions.delay?(l=a._clientRoleOptions.delay,d=1):d=a._clientRoleOptions&&a._clientRoleOptions.level?a._clientRoleOptions.level:2:d=0,yield a.signal.request(Pe.SET_CLIENT_ROLE,{role:r,level:d,delay:l,client_ts:Date.now()}),a.role=r})()}setRemoteVideoStreamType(r,o){var a=this;return L(function*(){yield a.signal.request(Pe.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:o})})()}setDefaultRemoteVideoStreamType(r){var o=this;return L(function*(){yield o.signal.request(Pe.DEFAULT_VIDEO_STREAM,{stream_type:r})})()}setStreamFallbackOption(r,o){var a=this;return L(function*(){yield a.signal.request(Pe.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:o})})()}pickSVCLayer(r,o){var a=this;return L(function*(){yield a.signal.request(Pe.PICK_SVC_LAYER,{stream_id:r,spatial_layer:o.spatialLayer,temporal_layer:o.temporalLayer})})()}setRTM2Flag(r){var o=this;return L(function*(){yield o.signal.request(Pe.SET_RTM2_FLAG,{rtm2_flag:r})})()}sendExtensionMessage(r,o,a){var l=this;return L(function*(){if(l.signal instanceof iv)return l.signal.sendExtensionMessage(r,o,a)})()}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Nl({},this.inChannelInfo)}getGatewayVersion(){var r=this;return L(function*(){return(yield r.signal.request(Pe.GATEWAY_INFO)).version})()}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=lv.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(o){let a;return a=o.startsWith("dc")?o.match(/(dc\:\/\/)?([^:]+):(\d+)/):o.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:Wi.username,password:Wi.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(Nl(Nl({},Wi),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}updateTrafficStats(){var r=this;return L(function*(){if("CONNECTED"!==r.state)return;const o=yield r.signal.request(Pe.TRAFFIC_STATS,void 0,!0);o.timestamp=Date.now(),null!=o.ntp_offset&&(r.ntpOffset=o.ntp_offset),o.peer_delay.forEach(a=>{const l=r._statsCollector.trafficStats&&r._statsCollector.trafficStats.peer_delay.find(d=>d.peer_uid===a.peer_uid);l&&l.B_st!==a.B_st&&y_(()=>{r.emit(gi.STREAM_TYPE_CHANGE,a.peer_uid,a.B_st)})}),r._statsCollector.updateTrafficStats(o)})()}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new z(k.UNEXPECTED_ERROR,"can not generate join message, no join info");const o=Object.assign({},this.joinInfo.apResponse);let a=V("REPORT_APP_SCENARIO");if("string"!=typeof a)try{a=JSON.stringify(a)}catch{a=void 0}a&&a.length>128&&(a=void 0);const l=!(hn()||H1(87)||a5())&&"boolean"==typeof V("ENABLE_PRE_SUB")&&V("ENABLE_PRE_SUB"),d=!a5()&&Ds("ENABLE_PREALLOC_PC","boolean"),h=Nl({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ss,browser:navigator.userAgent,process_id:V("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:o,extend:V("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:a,attributes:{userAttributes:{enablePublishedUserList:V("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:V("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof V("SUBSCRIBE_AUDIO_FILTER_TOPN")?V("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof V("ENABLE_PUBLISH_AUDIO_FILTER")?V("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof V("ENABLE_USER_LICENSE_CHECK")?V("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===V("USE_PUB_RTX")||!0===V("USE_SUB_RTX")||void 0,disableFEC:V("DISABLE_FEC"),enableNTPReport:!!V("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!V("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!V("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Ds("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!V("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!V("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Ds("USE_XR","boolean"),enableLossbasedBwe:Ds("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!V("ENABLE_AUT_CC")||void 0,enableCCFallback:Ds("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:d,preSubNum:l?Ds("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Ds("PUBLISH_TWCC","boolean"),enableSubTWCC:Ds("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Ds("USE_PUB_RTX","boolean"),enableSubRTX:Ds("USE_SUB_RTX","boolean"),enableSubSVC:V("ENABLE_SVC")?V("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(V("SVC"))&&0!==V("SVC").length?V("SVC"):void 0}},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(h.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(h.aes_mode=this.joinInfo.aesmode,V("ENCRYPT_AES")?(h.aes_secret=this.joinInfo.aespassword,h.aes_encrypt=!0):h.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(h.aes_salt=this.joinInfo.aessalt)),o.addresses[this.signal.websocket.currentURLIndex]&&(h.ap_response.ticket=o.addresses[this.signal.websocket.currentURLIndex].ticket,delete o.addresses),void 0!==this.joinInfo.defaultVideoStream&&(h.default_video_stream=this.joinInfo.defaultVideoStream),h}getRejoinMessage(){if(!this.joinInfo)throw new z(k.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){var r=this;this.signal.on(Me.WS_RECONNECT_CREATE_CONNECTION,o=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Me.WS_RECONNECTING,o=>{this.joinInfo&&be.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:o||Hi.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",be.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Me.WS_CLOSED,o=>{let a;switch(o){case Rt.LEAVE:a=Hi.LEAVE;break;case Rt.UID_BANNED:case Rt.IP_BANNED:case Rt.CHANNEL_BANNED:case Rt.SERVER_ERROR:a=Hi.SERVER_ERROR;break;case Rt.FALLBACK:a=Hi.FALLBACK;break;case Rt.LICENSE_MISSING:case Rt.LICENSE_EXPIRED:case Rt.LICENSE_MINUTES_EXCEEDED:case Rt.LICENSE_PERIOD_INVALID:case Rt.LICENSE_MULTIPLE_SDK_SERVICE:case Rt.LICENSE_ILLEGAL:case Rt.TOKEN_EXPIRE:a=o;break;default:a=Hi.NETWORK_ERROR}T.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(a||"undefined -> "+Hi.NETWORK_ERROR)),this.joinInfo&&be.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:o===Rt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:a}),this._disconnectedReason=o,o!==Rt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Me.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(T.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),be.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const o=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!o)return void T.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(o));Lt("EVENT_REPORT_DOMAIN",o[1]),Lt("EVENT_REPORT_BACKUP_DOMAIN",o[1]),Lt("LOG_UPLOAD_SERVER","".concat(o[1],":6444"))}}),this.signal.on(qe.ON_UPLINK_STATS,o=>{this._statsCollector.updateUplinkStats(o)}),this.signal.on(Me.REQUEST_RECOVER,(o,a,l)=>{if(!this.joinInfo)return l(new z(k.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));o&&(this.joinInfo.multiIP=o,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Gi(this,gi.REQUEST_NEW_GATEWAY_LIST).then(a).catch(l)}),this.signal.on(Me.REQUEST_JOIN_INFO,function(){var o=L(function*(a){var l;if(r.updateTurnConfigFromSignal(),r.store.useP2P)return void a(r.getJoinMessage({ortc:{}}));const{iceParameters:d,dtlsParameters:h,rtpCapabilities:p}=yield Gi(r,gi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(l=r.joinInfo)||void 0===l?void 0:l.turnServer});a(r.getJoinMessage({ortc:{iceParameters:d,dtlsParameters:h,rtpCapabilities:p,version:"2"}}))});return function(a){return o.apply(this,arguments)}}()),this.signal.on(Me.REQUEST_REJOIN_INFO,o=>{o(this.getRejoinMessage())}),this.signal.on(Me.REPORT_JOIN_GATEWAY,(o,a)=>{if(!this.joinInfo)return;let l,d="";var h;o instanceof z?(l=(null===(h=o.data)||void 0===h?void 0:h.desc)||o.code,d=o.message):l=o,be.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:l,errorMsg:d,addr:a,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1}),this.signal.on(Me.IS_P2P_DISCONNECTED,o=>{o(E_(this,gi.IS_P2P_DISCONNECTED))}),this.signal.on(Me.DISCONNECT_P2P,()=>{this.emit(gi.DISCONNECT_P2P)}),this.signal.on(Me.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Me.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Me.JOIN_RESPONSE,o=>{const a=this.getCurrentGatewayAddress();this.emit(gi.JOIN_RESPONSE,o,a)}),this.signal.on(Me.PRE_CONNECT_PC,L(function*(){if(r.joinInfo){r.updateTurnConfigFromSignal();const o=r.getCurrentGatewayAddress(),a=V("FINGERPRINT")||r.joinInfo.apResponse.addresses[r.signal.currentURLIndex].fingerprint;if(o&&a){const l=KS(o);r.emit(gi.PRE_CONNECT_PC,{candidates:l,fingerprint:a})}}})),this.signal.on(Me.RECOVER_NOTIFICATION,o=>{this.joinInfo&&"string"==typeof V("AP_REQUEST_DETAIL")&&(this.joinInfo.apRequestDetail="".concat(V("AP_REQUEST_DETAIL"),";").concat(o))})}tryUnsubBeforeResub(r,o){var a=this;return L(function*(){try{yield a.signal.request(Pe.UNSUBSCRIBE,{p2p_id:a.store.p2pId,stream_id:r,ortc:[o]},!0)}catch(l){throw T.warning("[".concat(a.store.clientId,"] tryUnsubBeforeResub warning"),l),l}})()}tryUnsubDataChannelBeforeResub(r,o){var a=this;return L(function*(){try{yield a.signal.request(Pe.UNSUBSCRIBE,{stream_id:o.id},!0)}catch(l){throw T.warning("unsubscribe datachannel warning",l),l}})()}tryUnpubBeforeRepub(r,o){var a=this;return L(function*(){try{yield a.signal.request(Pe.UNPUBLISH,{stream_id:r,ortc:o},!0)}catch(l){throw T.warning("[".concat(a.store.clientId,"] tryUnpubBeforeRepub warning: "),l),l}})()}tryUnpubDataChannelBeforeRepub(r,o){var a=this;return L(function*(){try{yield a.signal.request(Pe.UNPUBLISH_DATASTREAM,{channnel_id:o.channelId},!0)}catch(l){throw T.warning("unpublish datastream warning: ",l),l}})()}tryMassUnsubBeforeResub(r){var o=this;return L(function*(){const a={users:r.map(l=>({stream_id:l.stream_id,stream_type:l.stream_type}))};try{yield o.signal.request(Pe.UNSUBSCRIBE_STREAMS,a,!0)}catch(l){throw T.warning("[".concat(o.store.clientId,"] tryMassUnsubBeforeResub warning"),l),l}})()}muteLocal(r,o){var a=this;return L(function*(){const l={action:r.find(d=>d.stream_type===at.Audio)?"mute_local_audio":"mute_local_video",p2p_id:a.store.p2pId,ortc:r,stream_id:o};try{yield a.signal.request(Pe.CONTROL,l,!0,!0)}catch(d){throw T.warning("[".concat(a.store.clientId,"] gateway muteLocal warning: "),d),d}})()}unmuteLocal(r,o){var a=this;return L(function*(){const l={action:r.find(d=>d.stream_type===at.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:a.store.p2pId,ortc:r,stream_id:o};try{yield a.signal.request(Pe.CONTROL,l,!0,!0)}catch(d){throw T.warning("[".concat(a.store.clientId,"] gateway unmuteLocal warning: "),d),d}})()}muteRemote(r,o){var a=this;return L(function*(){const l={action:r===_e.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:a.store.p2pId,stream_id:o};try{yield a.signal.request(Pe.CONTROL,l,!0,!0)}catch(d){throw T.warning("[".concat(a.store.clientId,"] gateway muteRemote warning: "),d),d}})()}unmuteRemote(r,o){var a=this;return L(function*(){const l={action:r===_e.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:a.store.p2pId,stream_id:o};try{yield a.signal.request(Pe.CONTROL,l,!0,!0)}catch(d){throw T.warning("[".concat(a.store.clientId,"] gateway unmuteRemote warning: "),d),d}})()}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,o){this.signal.upload(r,o)}getSignalRTT(){return this.signal.rtt}restartICE(r){var o=this;return L(function*(){const a={p2p_id:o.store.p2pId,stream_id:o.store.uid,ortc:r};try{return yield o.signal.request(Pe.RESTART_ICE,a,!0)}catch(l){throw T.warning("[".concat(o.store.clientId,"] P2PChannel.restartICE warning: "),l),l}})()}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,Hi.P2P_FAILED)}getCurrentGatewayAddress(){var r,o;if(!V("GATEWAY_WSS_ADDRESS"))return V("USE_CANDIDATE_FROM_AP_DETAIL")&&null!==(r=this.joinInfo)&&void 0!==r&&r.apGatewayAddress?(T.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):null!==(o=this.joinInfo)&&void 0!==o&&o.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}setPublishAudioFilterEnabled(r){var o=this;return L(function*(){yield o.signal.request(Pe.SET_PARAMETER,{enablePublishAudioFilter:r})})()}}let Gf=0,XA=0;function ta(n,r,o,a){return new le((l,d)=>{r.timeout=r.timeout||V("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!o?(r.data=JSON.stringify(r.data),Gf+=Ec(r.data)):o&&(r.data.size?Gf+=r.data.size:r.data instanceof FormData?Gf+=yc(r.data):Gf+=Ec(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=n,Nr.request(r).then(h=>{"string"==typeof h.data?XA+=Ec(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?XA+=h.data.byteLength:XA+=Ec(JSON.stringify(h.data)),a&&l({data:h.data,headers:h.headers}),l(h.data)}).catch(h=>{Nr.isCancel(h)?d(new z(k.OPERATION_ABORTED,"cancel token canceled")):d("ECONNABORTED"===h.code?new z(k.NETWORK_TIMEOUT,h.message):h.response?new z(k.NETWORK_RESPONSE_ERROR,h.response.status):new z(k.NETWORK_ERROR,h.message))})})}!function(){var n;function r(Z){var oe=0;return function(){return oe<Z.length?{done:!1,value:Z[oe++]}:{done:!0}}}var a,o="function"==typeof Object.defineProperties?Object.defineProperty:function(Z,oe,ve){return Z==Array.prototype||Z==Object.prototype||(Z[oe]=ve.value),Z},l=function(Z){Z=["object"==typeof globalThis&&globalThis,Z,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof eo&&eo];for(var oe=0;oe<Z.length;++oe){var ve=Z[oe];if(ve&&ve.Math==Math)return ve}throw Error("Cannot find global object")}(this);function d(Z,oe){if(oe)e:{var ve=l;Z=Z.split(".");for(var xe=0;xe<Z.length-1;xe++){var Et=Z[xe];if(!(Et in ve))break e;ve=ve[Et]}(oe=oe(xe=ve[Z=Z[Z.length-1]]))!=xe&&null!=oe&&o(ve,Z,{configurable:!0,writable:!0,value:oe})}}function h(Z){return(Z={next:Z})[Symbol.iterator]=function(){return this},Z}function p(Z){var oe=typeof Symbol<"u"&&Symbol.iterator&&Z[Symbol.iterator];return oe?oe.call(Z):{next:r(Z)}}if(d("Symbol",function(Z){function oe(Et,de){this.A=Et,o(this,"description",{configurable:!0,writable:!0,value:de})}if(Z)return Z;oe.prototype.toString=function(){return this.A};var ve="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",xe=0;return function Et(de){if(this instanceof Et)throw new TypeError("Symbol is not a constructor");return new oe(ve+(de||"")+"_"+xe++,de)}}),d("Symbol.iterator",function(Z){if(Z)return Z;Z=Symbol("Symbol.iterator");for(var oe="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ve=0;ve<oe.length;ve++){var xe=l[oe[ve]];"function"==typeof xe&&"function"!=typeof xe.prototype[Z]&&o(xe.prototype,Z,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return Z}),"function"==typeof Object.setPrototypeOf)a=Object.setPrototypeOf;else{var m;e:{var g={};try{g.__proto__={a:!0},m=g.a;break e}catch{}m=!1}a=m?function(Z,oe){if(Z.__proto__=oe,Z.__proto__!==oe)throw new TypeError(Z+" is not extensible");return Z}:null}var v=a;function y(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function b(Z){if(Z.m)throw new TypeError("Generator is already running");Z.m=!0}function C(Z,oe){return Z.h=3,{value:oe}}function N(Z){this.g=new y,this.G=Z}function R(Z,oe,ve,xe){try{var Et=oe.call(Z.g.j,ve);if(!(Et instanceof Object))throw new TypeError("Iterator result "+Et+" is not an object");if(!Et.done)return Z.g.m=!1,Et;var de=Et.value}catch(w){return Z.g.j=null,Z.g.s(w),A(Z)}return Z.g.j=null,xe.call(Z.g,de),A(Z)}function A(Z){for(;Z.g.h;)try{var oe=Z.G(Z.g);if(oe)return Z.g.m=!1,{value:oe.value,done:!1}}catch(ve){Z.g.v=void 0,Z.g.s(ve)}if(Z.g.m=!1,Z.g.l){if(oe=Z.g.l,Z.g.l=null,oe.F)throw oe.D;return{value:oe.return,done:!0}}return{value:void 0,done:!0}}function D(Z){this.next=function(oe){return Z.o(oe)},this.throw=function(oe){return Z.s(oe)},this.return=function(oe){return function(ve,xe){b(ve.g);var Et=ve.g.j;return Et?R(ve,"return"in Et?Et.return:function(de){return{value:de,done:!0}},xe,ve.g.return):(ve.g.return(xe),A(ve))}(Z,oe)},this[Symbol.iterator]=function(){return this}}function M(Z,oe){return oe=new D(new N(oe)),v&&Z.prototype&&v(oe,Z.prototype),oe}if(y.prototype.o=function(Z){this.v=Z},y.prototype.s=function(Z){this.l={D:Z,F:!0},this.h=this.C||this.u},y.prototype.return=function(Z){this.l={return:Z},this.h=this.u},N.prototype.o=function(Z){return b(this.g),this.g.j?R(this,this.g.j.next,Z,this.g.o):(this.g.o(Z),A(this))},N.prototype.s=function(Z){return b(this.g),this.g.j?R(this,this.g.j.throw,Z,this.g.o):(this.g.s(Z),A(this))},d("Array.prototype.entries",function(Z){return Z||function(){return function(oe,ve){oe instanceof String&&(oe+="");var xe=0,Et=!1,de={next:function(){if(!Et&&xe<oe.length){var w=xe++;return{value:ve(w,oe[w]),done:!1}}return Et=!0,{done:!0,value:void 0}}};return de[Symbol.iterator]=function(){return de},de}(this,function(oe,ve){return[oe,ve]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var x=function(Z,oe){for(var ve=0;ve<Z.length;ve++)oe(Z[ve])},j=function(Z){return Z.replace(/\r?\n|\r/g,"\r\n")},W=function(Z,oe,ve){return oe instanceof Blob?(oe.name===(ve=void 0!==ve?ve+"":"string"==typeof oe.name?oe.name:"blob")&&"[object Blob]"!==Object.prototype.toString.call(oe)||(oe=new File([oe],ve)),[String(Z),oe]):[String(Z),String(oe)]},q=function(Z,oe){if(Z.length<oe)throw new TypeError(oe+" argument required, but only "+Z.length+" present.")},ee="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,J=ee.FormData,X=ee.XMLHttpRequest&&ee.XMLHttpRequest.prototype.send,Ce=ee.Request&&ee.fetch,Re=ee.navigator&&ee.navigator.sendBeacon,ut=ee.Element&&ee.Element.prototype,Nt=ee.Symbol&&Symbol.toStringTag;Nt&&(Blob.prototype[Nt]||(Blob.prototype[Nt]="Blob"),"File"in ee&&!File.prototype[Nt]&&(File.prototype[Nt]="File"));try{new File([],"")}catch{ee.File=function(oe,ve,xe){return oe=new Blob(oe,xe||{}),Object.defineProperties(oe,{name:{value:ve},lastModified:{value:+(xe&&void 0!==xe.lastModified?new Date(xe.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Nt&&Object.defineProperty(oe,Nt,{value:"File"}),oe}}var _n=function(Z){return Z.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Zt=function(Z){this.i=[];var oe=this;Z&&x(Z.elements,function(ve){if(ve.name&&!ve.disabled&&"submit"!==ve.type&&"button"!==ve.type&&!ve.matches("form fieldset[disabled] *"))if("file"===ve.type){var xe=ve.files&&ve.files.length?ve.files:[new File([],"",{type:"application/octet-stream"})];x(xe,function(Et){oe.append(ve.name,Et)})}else"select-multiple"===ve.type||"select-one"===ve.type?x(ve.options,function(Et){!Et.disabled&&Et.selected&&oe.append(ve.name,Et.value)}):"checkbox"===ve.type||"radio"===ve.type?ve.checked&&oe.append(ve.name,ve.value):(xe="textarea"===ve.type?j(ve.value):ve.value,oe.append(ve.name,xe))})};if((n=Zt.prototype).append=function(Z,oe,ve){q(arguments,2),this.i.push(W(Z,oe,ve))},n.delete=function(Z){q(arguments,1);var oe=[];Z=String(Z),x(this.i,function(ve){ve[0]!==Z&&oe.push(ve)}),this.i=oe},n.entries=function Z(){var oe,ve=this;return M(Z,function(xe){if(1==xe.h&&(oe=0),3!=xe.h)return oe<ve.i.length?xe=C(xe,ve.i[oe]):(xe.h=0,xe=void 0),xe;oe++,xe.h=2})},n.forEach=function(Z,oe){q(arguments,1);for(var ve=p(this),xe=ve.next();!xe.done;xe=ve.next()){var Et=p(xe.value);xe=Et.next().value,Et=Et.next().value,Z.call(oe,Et,xe,this)}},n.get=function(Z){q(arguments,1);var oe=this.i;Z=String(Z);for(var ve=0;ve<oe.length;ve++)if(oe[ve][0]===Z)return oe[ve][1];return null},n.getAll=function(Z){q(arguments,1);var oe=[];return Z=String(Z),x(this.i,function(ve){ve[0]===Z&&oe.push(ve[1])}),oe},n.has=function(Z){q(arguments,1),Z=String(Z);for(var oe=0;oe<this.i.length;oe++)if(this.i[oe][0]===Z)return!0;return!1},n.keys=function Z(){var oe,ve,de=this;return M(Z,function(w){if(1==w.h&&(oe=p(de),ve=oe.next()),3!=w.h)return ve.done?void(w.h=0):C(w,p(ve.value).next().value);ve=oe.next(),w.h=2})},n.set=function(Z,oe,ve){q(arguments,2),Z=String(Z);var xe=[],Et=W(Z,oe,ve),de=!0;x(this.i,function(w){w[0]===Z?de&&(de=!xe.push(Et)):xe.push(w)}),de&&xe.push(Et),this.i=xe},n.values=function Z(){var oe,ve,Et,de=this;return M(Z,function(w){if(1==w.h&&(oe=p(de),ve=oe.next()),3!=w.h)return ve.done?void(w.h=0):((Et=p(ve.value)).next(),C(w,Et.next().value));ve=oe.next(),w.h=2})},Zt.prototype._asNative=function(){for(var Z=new J,oe=p(this),ve=oe.next();!ve.done;ve=oe.next()){var xe=p(ve.value);ve=xe.next().value,xe=xe.next().value,Z.append(ve,xe)}return Z},Zt.prototype._blob=function(){var Z="----formdata-polyfill-"+Math.random(),oe=[],ve="--"+Z+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(xe,Et){return"string"==typeof xe?oe.push(ve+_n(j(Et))+'"\r\n\r\n'+j(xe)+"\r\n"):oe.push(ve+_n(j(Et))+'"; filename="'+_n(xe.name)+'"\r\nContent-Type: '+(xe.type||"application/octet-stream")+"\r\n\r\n",xe,"\r\n")}),oe.push("--"+Z+"--"),new Blob(oe,{type:"multipart/form-data; boundary="+Z})},Zt.prototype[Symbol.iterator]=function(){return this.entries()},Zt.prototype.toString=function(){return"[object FormData]"},ut&&!ut.matches&&(ut.matches=ut.matchesSelector||ut.mozMatchesSelector||ut.msMatchesSelector||ut.oMatchesSelector||ut.webkitMatchesSelector||function(Z){for(var oe=(Z=(this.document||this.ownerDocument).querySelectorAll(Z)).length;0<=--oe&&Z.item(oe)!==this;);return-1<oe}),Nt&&(Zt.prototype[Nt]="FormData"),X){var ca=ee.XMLHttpRequest.prototype.setRequestHeader;ee.XMLHttpRequest.prototype.setRequestHeader=function(Z,oe){ca.call(this,Z,oe),"content-type"===Z.toLowerCase()&&(this.B=!0)},ee.XMLHttpRequest.prototype.send=function(Z){Z instanceof Zt?(Z=Z._blob(),this.B||this.setRequestHeader("Content-Type",Z.type),X.call(this,Z)):X.call(this,Z)}}Ce&&(ee.fetch=function(Z,oe){return oe&&oe.body&&oe.body instanceof Zt&&(oe.body=oe.body._blob()),Ce.call(this,Z,oe)}),Re&&(ee.navigator.sendBeacon=function(Z,oe){return oe instanceof Zt&&(oe=oe._asNative()),Re.call(this,Z,oe)}),ee.FormData=Zt}}();const dv=()=>{const n=V("AREAS");return 0===n.length&&n.push(mt.GLOBAL),Ue(n).call(n,(r,o,a)=>{const l=r2(o);return l?0===a?l:"".concat(r,",").concat(l):r},"")},r2=n=>n===mt.OVERSEA?"".concat(zi.ASIA,",").concat(zi.EUROPE,",").concat(zi.AFRICA,",").concat(zi.NORTH_AMERICA,",").concat(zi.SOUTH_AMERICA,",").concat(zi.OCEANIA):zi[n],W5=n=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return n.map(o=>{const a=O_[o],l=Object.keys(a);l&&l.map(d=>{"CODE"!==d&&(r[d]=r[d].concat(a[d]))})}),r},$S={GLOBAL:{ASIA:[mt.CHINA,mt.JAPAN,mt.INDIA,mt.KOREA,mt.HKMC],EUROPE:[],NORTH_AMERICA:[mt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},uv=Object.keys($S[mt.GLOBAL]),ZA=[mt.CHINA,mt.NORTH_AMERICA,mt.EUROPE,mt.ASIA,mt.JAPAN,mt.INDIA,mt.OCEANIA,mt.SOUTH_AMERICA,mt.AFRICA,mt.KOREA,mt.HKMC,mt.US],o2=function(n,r){let o=[];if(he(n).call(n,mt.GLOBAL)){const d=[mt.GLOBAL,mt.OVERSEA],h=Object.keys(O_);if(r===mt.GLOBAL)throw new z(k.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===mt.CHINA)o=[mt.OVERSEA];else if(l=r,he(uv).call(uv,l)){const p=$S[mt.GLOBAL][r]||[],m=[...d,r,...p];o=h.filter(g=>!he(m).call(m,g))}else if(function(p){let m=!1;return uv.forEach(g=>{var v;he(v=$S[mt.GLOBAL][g]).call(v,p)&&(m=!0)}),m}(r)){const p=function(g){let v;return uv.forEach(y=>{var b;he(b=$S[mt.GLOBAL][y]).call(b,g)&&(v=y)}),v}(r),m=[...d,p,r];o=h.filter(g=>!he(m).call(m,g))}else o=n;o=function(p){const m=[];return ZA.forEach(g=>{he(p).call(p,g)&&m.push(g)}),m.concat(p.filter(g=>!he(ZA).call(ZA,g)))}(o)}else o=n;var l;return o};function hv(n){var r,o;if(!n&&he(r=V("AREAS")).call(r,mt.EXTENSIONS))return T.debug("update area from ap : reset"),void Ah(bR,!0);if(!he(o=V("AREAS")).call(o,mt.GLOBAL)||!n)return;let a=O_.EXTENSIONS;a&&(a={CODE:r2(mt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(n,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(n,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(n,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(n,".agora.io"),"cds-ap-web-2-".concat(n,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(n,".agora.io"),"sua-ap-web-2-".concat(n,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(n,".agora.io"),"uap-ap-web-2-".concat(n,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(n,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(n,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(n,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(n,".agora.io")]},T.debug("update area from ap success: ".concat(n,",config is "),a),Lt("AREAS",[mt.EXTENSIONS],!0),Object.keys(a).map(l=>{Lt(l,"LOG_UPLOAD_SERVER"===l||"EVENT_REPORT_DOMAIN"===l||"EVENT_REPORT_BACKUP_DOMAIN"===l||"PROXY_SERVER_TYPE3"===l?a[l][0]:a[l])}))}function Ah(n){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=be.reportApiInvoke(null,{name:Yn.SET_AREA,options:n,tag:st.TRACER});try{let a=[];if("string"==typeof n&&(a=[n]),Array.isArray(n)&&(n.forEach(d=>{if(!he(NR).call(NR,d))throw new z(k.INVALID_PARAMS,"invalid area code")}),a=n),"[object Object]"===Object.prototype.toString.call(n)){const{areaCode:d,excludedArea:h}=n;if(!d)throw new z(k.INVALID_PARAMS,"area code is needed");let p=d;"string"==typeof d&&(p=[d]),a=h?o2(p,h):p}if(!r){if(Rd.AREAS){const d=new z(k.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return o.onError(d),void T.warning("setArea is prohibited because of config-distribute")}if(he(a).call(a,mt.GLOBAL)&&V("AREAS")===mt.EXTENSIONS){const d=new z(k.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return o.onError(d),void T.warning("setArea is prohibited because of ap extensions")}}Lt("AREAS",a,r);const l=W5(a);Object.keys(l).map(d=>{Lt(d,"LOG_UPLOAD_SERVER"===d||"EVENT_REPORT_DOMAIN"===d||"EVENT_REPORT_BACKUP_DOMAIN"===d||"PROXY_SERVER_TYPE3"===d?l[d][0]:l[d])}),T.debug("set area success:",a.join(","))}catch(a){throw o.onError(a),a}o.onSuccess()}function s2(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function XS(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?s2(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):s2(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}let pv=1;let JA=1;function ZS(n,r,o,a){let{url:l,areaCode:d}=n;const{clientId:h,sid:p}=r,m=Date.now();let g;const[v,y]=tD(r,d,[jn.CHOOSE_SERVER]);let b=Se.networkState;return rs(L(function*(){b&&Se.networkState===co.OFFLINE&&Se.onlineWaiter&&(yield le.race([Se.onlineWaiter,Ii(a&&a.maxRetryTimeout||Nn.maxRetryTimeout)])),b=Se.networkState;const{data:C,headers:N}=yield ta(l,{data:v,cancelToken:o,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g="1"===N.http3?1:-1,be.reportResourceTiming(l,p),l2(C,l,r,m,[jn.CHOOSE_SERVER],g);const R=vS(C,jn.CHOOSE_SERVER);return QA(R),_S(R,l)}),C=>(C&&be.joinChooseServer(p,{lts:m,succ:!0,csAddr:l,opid:y,serverList:C.gatewayAddrs.map(N=>N.address),ec:null,cid:C.cid.toString(),uid:C.uid.toString(),csIp:C.csIp,unilbsServerIds:[jn.CHOOSE_SERVER].toString(),isHttp3:g,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:C.res.detail&&C.res.detail[38]}),!1),C=>C.code!==k.OPERATION_ABORTED&&(C.code===k.CAN_NOT_GET_GATEWAY_SERVER?C.data.retry:(be.joinChooseServer(p,{lts:m,succ:!1,csAddr:l,serverList:null,opid:y,ec:C.code,csIp:C.data&&C.data.csIp,unilbsServerIds:[jn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:b}),isHttp3:g,corssRegionTagReq:r.apRequestDetail}),T.warning("[".concat(h||"sid-".concat(p.slice(0,6)),"] Choose server network error, retry"),C),!0)),a)}function c2(n,r,o,a){let l,{url:d,areaCode:h,serviceIds:p}=n;const m=Date.now(),[g,v]=tD(r,h,p);let y;return rs(L(function*(){y&&Se.networkState===co.OFFLINE&&Se.onlineWaiter&&(yield le.race([Se.onlineWaiter,Ii(a&&a.maxRetryTimeout||Nn.maxRetryTimeout)])),y=Se.networkState;const{data:b,headers:C}=yield ta(d,{data:g,cancelToken:o,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l="1"===C.http3?1:-1,be.reportResourceTiming(d,r.sid),l2(b,d,r,m,p,l);const N=vS(b,jn.CHOOSE_SERVER),R=vS(b,"proxy5"===r.cloudProxyServer?jn.CLOUD_PROXY_5:"proxy3"===r.cloudProxyServer||"proxy4"===r.cloudProxyServer?jn.CLOUD_PROXY:jn.CLOUD_PROXY_FALLBACK);return QA(N),{gatewayInfo:_S(N,d),proxyInfo:R,url:d}}),b=>(b.gatewayInfo&&be.joinChooseServer(r.sid,{lts:m,succ:!0,csAddr:d,serverList:b.gatewayInfo.gatewayAddrs.map(C=>C.address),ec:null,opid:v,cid:b.gatewayInfo.cid.toString(),uid:b.gatewayInfo.uid.toString(),csIp:b.gatewayInfo.csIp,unilbsServerIds:p.toString(),isHttp3:l,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:b.gatewayInfo.res.detail&&b.gatewayInfo.res.detail[38]}),b.proxyInfo&&be.joinWebProxyAP(r.sid,{lts:m,sucess:1,apServerAddr:d,turnServerAddrList:b.proxyInfo.addresses.map(C=>C.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:p.toString()}),!1),b=>b.code!==k.OPERATION_ABORTED&&(b.code===k.CAN_NOT_GET_GATEWAY_SERVER?b.data.retry:(be.joinWebProxyAP(r.sid,{lts:m,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:b.code,eventType:r.cloudProxyServer,unilbsServerIds:p.toString(),extend:JSON.stringify({networkState:y})}),T.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),b),!0)),a)}const l2=(n,r,o,a,l,d)=>{const{sid:h,clientId:p,cloudProxyServer:m}=o,g=[],v=y=>{4096===y.flag?be.joinChooseServer(h,{lts:a,succ:!1,csAddr:r,opid:n.opid,serverList:null,ec:y.error.message,csIp:y.error.data&&y.error.data.csIp,unilbsServerIds:l.toString(),isHttp3:d,corssRegionTagReq:o.apRequestDetail}):1048576!==y.flag&&4194304!==y.flag&&4194310!==y.flag||be.joinWebProxyAP(h,{lts:a,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:y.error.code,eventType:m,unilbsServerIds:l.toString()})};if(n.response_body.forEach(y=>{const b=y.buffer.code;if(23===y.uri&&0===b&&!y.buffer.edges_services)if(4194310===y.buffer.flag)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),y.buffer.edges_services=[];else{const C={error:new z(k.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:n.detail[502]}),flag:y.buffer.flag};g.push(C),v(C)}if(0!==b){const C=Af(b),N={error:new z(k.CAN_NOT_GET_GATEWAY_SERVER,C.desc,{desc:C.desc,retry:C.retry,csIp:n.detail[502]}),flag:y.buffer.flag};4194310===y.buffer.flag?T.warning(N.error.toString()):g.push(N),v(N)}}),g.length)throw T.warning("[".concat(p||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(g.map(y=>"flag: ".concat(y.flag,", message: ").concat(y.error.message,", retry: ").concat(y.error.data.retry)).join(" | "))),new z(k.CAN_NOT_GET_GATEWAY_SERVER,g.map(y=>"flag: ".concat(y.flag,", message: ").concat(y.error.message)).join(" | "),{retry:!!g.find(y=>y.error.data.retry),csIp:n.detail[502],desc:[...new Set(g.map(y=>{var b;return null==y||null===(b=y.error)||void 0===b||null===(b=b.data)||void 0===b?void 0:b.desc}).filter(y=>!!y))]})},QA=n=>{var r,o,a,l;if(n.addresses&&0===n.addresses.length&&0===n.code)throw new z(k.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:n.detail&&n.detail[502]});if(V("AP_AREA")&&(null!==(a=n.detail)&&void 0!==a&&a[23]&&"string"==typeof(null===(l=n.detail)||void 0===l?void 0:l[23])?hv(n.detail[23].toLowerCase()):hv()),null!==(r=n.detail)&&void 0!==r&&r[19]&&"string"==typeof(null===(o=n.detail)||void 0===o?void 0:o[19])){const h=n.detail[19],p=h?.split(";");for(let m=0;m<p.length;m++){var d;const g=Er(d=p[m]).call(d);n.addresses[m]&&p&&(n.addresses[m].fingerprint=g)}}if(V("GATEWAY_ADDRESS")&&V("GATEWAY_ADDRESS").length>0){T.debug("assign gateway address to",V("GATEWAY_ADDRESS"));const h=V("GATEWAY_ADDRESS").map(p=>{var m,g;const v=null!==(m=null===(g=n.addresses.find(y=>y.ip===p.ip&&y.port===p.port))||void 0===g?void 0:g.fingerprint)&&void 0!==m?m:"";return{ip:p.ip,port:p.port,ticket:n.addresses[0]&&n.addresses[0].ticket,fingerprint:v}});n.addresses=h}},eD=(n,r)=>{if(n.response_body&&n.response_body.length){const o=n.response_body[0];if(0!==o.buffer.code){const a=Af(o.buffer.code);throw new z(k.UPDATE_TICKET_FAILED,"[".concat(o.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return o.buffer.ticket}throw T.debug("update ticket request received ap response without response body:",r),new z(k.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},tD=(n,r,o)=>{const a=Math.floor(1e12*Math.random()),l={appid:n.appId,client_ts:Date.now(),opid:a,sid:n.sid,request_bodies:[{uri:22,buffer:{cname:n.cname,detail:XS(XS({6:n.stringUid,11:r,12:V("USE_NEW_TOKEN")?"1":void 0,22:r},n.apRequestDetail?{33:n.apRequestDetail}:{}),n.apRTM?{26:"RTM2"}:{}),key:n.token,service_ids:o,uid:n.uid||0}}]};l.request_bodies.forEach(h=>{n.multiIP&&n.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[n.multiIP.uni_lbs_ip],vos_ip:[n.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",JSON.stringify(l)),[d,a]},z5=(n,r)=>{const o=Math.floor(1e12*Math.random()),a={appid:n.appId,client_ts:Date.now(),opid:o,sid:n.sid,request_bodies:[{uri:28,buffer:{cname:n.cname,detail:{1:"",6:n.stringUid,12:"1"},token:n.token,service_ids:r,uid:n.uid||0,edges_services:n.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},l=new FormData;return l.append("request",JSON.stringify(a)),[l,o]};let Wf=0;function jd(n){return le.all(n.map(r=>r.then(o=>{throw o},o=>o))).then(r=>{throw r},r=>r)}const Dh=function(){var n=L(function*(r){let{fragementLength:o,referenceList:a,asyncMapHandler:l,allFailedhandler:d,promisesCollector:h}=r,p=0;const m=o;let g,v=0;const y=function(){var b=L(function*(){const C=(()=>{const N=p*m;return a.slice(N,N+m).map(l)})();h&&h.push(...C);try{g=yield jd(C)}catch(N){if(v+=m,p++,!(v>=a.length))return void(yield y());d(N)}C.forEach(N=>N.cancel())});return function(){return b.apply(this,arguments)}}();return yield y(),g});return function(o){return n.apply(this,arguments)}}(),nD=function(){var n=L(function*(r){let{referenceList:o,asyncMapHandler:a,closeFn:l}=r;const d=o.length;let h=0;const p=function(){var m=L(function*(){const g=a(o.shift());try{return yield g}catch(v){if(h++,h>=d||null!=l&&l(v))throw v;return p()}});return function(){return m.apply(this,arguments)}}();return p()});return function(o){return n.apply(this,arguments)}}();function iD(n,r,o,a){return d2.apply(this,arguments)}function d2(){return d2=L(function*(n,r,o,a){return{gatewayInfo:yield(d=L(function*(h,p,m,g){let v=null;const y=[],b=function(){var N=L(function*(){const R=V("WEBCS_DOMAIN").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(M=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(M+"/api/v2/transpond/webrtc?v=2"):"https://".concat(M,"/api/v2/transpond/webrtc?v=2"),areaCode:dv()})),A=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(M=>M.url)}),D=yield Dh({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:M=>(T.debug("[".concat(h.clientId,"] Connect to choose_server:"),M.url),ZS(M,h,p,m)),allFailedhandler:M=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},A),M[0]},promisesCollector:y});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},A),D});return function(){return N.apply(this,arguments)}}(),C=function(){var N=L(function*(){if(yield Ii(1e3),null!==v)return v;const R=V("WEBCS_DOMAIN_BACKUP_LIST").map(M=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(M+"/api/v2/transpond/webrtc?v=2"):"https://".concat(M,"/api/v2/transpond/webrtc?v=2"),areaCode:dv()})),A=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(M=>M.url)}),D=yield Dh({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:M=>(T.debug("[".concat(h.clientId,"] Connect to backup choose_server:"),M.url),ZS(M,h,p,m)),allFailedhandler:M=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},A),M[0]},promisesCollector:y});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},A),D});return function(){return N.apply(this,arguments)}}();try{return v=yield jd([b(),C()]),y.length&&y.forEach(N=>N.cancel&&"function"==typeof N.cancel&&N.cancel()),v}catch(N){throw N[0]}}),function(h,p,m,g){return d.apply(this,arguments)})(n,r,o,a)};var d}),d2.apply(this,arguments)}function u2(n,r,o,a,l){return fv.apply(this,arguments)}function fv(){return fv=L(function*(n,r,o,a,l){const d=n.cloudProxyServer;if("disabled"===d){if(!a)return;if(n.useLocalAccessPoint)return yield iD(n,r,o,l);if(V("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:b,proxyInfo:C}=yield QS(n,r,o,l);if(n.turnServer&&"auto"!==n.turnServer.mode)return{gatewayInfo:b};const N=C.map(R=>({turnServerURL:R.address,tcpport:R.tcpport||Wi.tcpport,udpport:R.udpport||Wi.udpport,username:R.username||Wi.username,password:R.password||Wi.password,forceturn:!1,security:!0}));if(l.useP2P){var h;const R=null!==(h=n.uid)&&void 0!==h?h:b.uid,A="glb:".concat(R.toString()),D=yield cR(A),M=C.map(x=>({turnServerURL:x.address,tcpport:x.tcpport||Wi.tcpport,udpport:x.udpport||Wi.udpport,username:A,password:D,forceturn:!1,security:!0}));N.push(...M)}return n.turnServer={mode:"manual",servers:N},{gatewayInfo:b}}return yield iD(n,r,o,l)}const{proxyInfo:p,gatewayInfo:m}=yield QS(n,r,o,l),g={gatewayInfo:m},v=p.map(b=>({turnServerURL:b.address,tcpport:"proxy3"===d?void 0:b.tcpport?b.tcpport:Wi.tcpport,udpport:"proxy4"===d?void 0:b.udpport?b.udpport:Wi.udpport,username:b.username||Wi.username,password:b.password||Wi.password,forceturn:"proxy4"!==d,security:"proxy5"===d}));if(l.useP2P){var y;const b=null!==(y=n.uid)&&void 0!==y?y:m.uid,C="glb:".concat(b.toString()),N=yield cR(C),R=p.map(A=>({turnServerURL:A.address,tcpport:"proxy3"===d?void 0:A.tcpport||Wi.tcpport,udpport:"proxy4"===d?void 0:A.udpport||Wi.udpport,username:C,password:N,forceturn:"proxy4"!==d,security:"proxy5"===d}));v.push(...R)}return n.turnServer={mode:"manual",servers:v},T.debug("[".concat(n.clientId,"] set proxy server: ").concat(n.proxyServer,", mode: ").concat(d)),g}),fv.apply(this,arguments)}function rD(n,r,o,a,l){return mv.apply(this,arguments)}function mv(){return mv=L(function*(n,r,o,a,l){let h=[];h=V("ACCOUNT_REGISTER").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(r.proxyServer?m=>"https://".concat(r.proxyServer,"/ap/?url=").concat(m+"/api/v1"):m=>"https://".concat(m,"/api/v1"));const p=l?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const m=yield(g=L(function*(v,y,b,C,N){const R=Date.now(),A={sid:b.sid,opid:10,appid:b.appId,string_uid:y};let D=v[0];const M=yield rs(()=>ta(D+"".concat(-1===D.indexOf("?")?"?":"&","action=stringuid"),{data:A,cancelToken:C,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(x,j)=>{if(0===x.code){if(x.uid<=0||x.uid>=Math.pow(2,32))throw T.error("Invalid Uint Uid ".concat(y," => ").concat(x.uid),x),be.reqUserAccount(A.sid,{lts:R,success:!1,serverAddr:D,stringUid:A.string_uid,uid:x.uid,errorCode:k.INVALID_UINT_UID_FROM_STRING_UID,extend:A}),new z(k.INVALID_UINT_UID_FROM_STRING_UID);return be.reqUserAccount(A.sid,{lts:R,success:!0,serverAddr:D,stringUid:A.string_uid,uid:x.uid,errorCode:null,extend:A}),!1}const W=Af(x.code);return W.retry&&(D=v[(j+1)%v.length]),be.reqUserAccount(A.sid,{lts:R,success:!1,serverAddr:D,stringUid:A.string_uid,uid:x.uid,errorCode:W.desc,extend:A}),W.retry},(x,j)=>x.code!==k.OPERATION_ABORTED&&(be.reqUserAccount(A.sid,{lts:R,success:!1,serverAddr:D,stringUid:A.string_uid,uid:null,errorCode:x.code,extend:A}),D=v[(j+1)%v.length],!0),N);if(0!==M.code){const x=Af(M.code);throw new z(k.UNEXPECTED_RESPONSE,x.desc)}return M}),function(v,y,b,C,N){return g.apply(this,arguments)})(h,n,r,o,a);return l?.recordJoinChannelService({status:"success",endTs:Date.now()},p),m.uid}catch(m){throw l?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},p),m}var g}),mv.apply(this,arguments)}function K5(n,r,o){return JS.apply(this,arguments)}function JS(){return JS=L(function*(n,r,o){let l=[];l=V("ACCOUNT_REGISTER").map(r.proxyServer?d=>"https://".concat(r.proxyServer,"/ap/?url=").concat(d+"/api/v1"):d=>"https://".concat(d,"/api/v1"));try{return yield nD({referenceList:l,asyncMapHandler:h=>{return(p=L(function*(m,g,v,y){const b=Date.now(),C={sid:v.sid,opid:10,appid:v.appId,string_uid:g};try{const N=yield ta(m+"".concat(-1===m.indexOf("?")?"?":"&","action=stringuid"),{data:C,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(0!==N.code){const R=Af(N.code);throw new z(k.UNEXPECTED_RESPONSE,"preload sua error:".concat(R.desc),R)}if(N.uid<=0||N.uid>=Math.pow(2,32))throw new z(k.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:b,url:m,req:C,uid:N.uid,elapse:Date.now()-b}}catch(N){throw N}}),function(m,g,v,y){return p.apply(this,arguments)})(h,n,r,o);var p},closeFn:h=>h.code===k.OPERATION_ABORTED||h.code===k.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(d){throw d}}),JS.apply(this,arguments)}function oD(){return oD=L(function*(n,r,o){const l=V("CDS_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(m=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(m+"/api/v1"):"https://".concat(m,"/api/v1?action=config")).map(m=>function(g,v,y,b){const C=ot(),N={flag:64,cipher_method:0,features:{device:C.name,system:C.os,system_general:navigator.userAgent,vendor:v.appId,version:Ss,cname:v.cname,sid:v.sid,session_id:v.sid,detail:"",proxyServer:v.proxyServer}};return rs(()=>ta(g,{data:N,timeout:1e3,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,R=>R.code!==k.OPERATION_ABORTED,b)}(m,n,r,o));let d=null,h=null,p={};try{d=yield jd(l)}catch(m){if(m.code===k.OPERATION_ABORTED)throw m;h=m}if(l.forEach(m=>m.cancel()),be.reportApiInvoke(n.sid,{name:Yn.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:d}}).onSuccess(),d&&d.test_tags)try{p=function(m){if(!m.test_tags)return{};const g=m.test_tags,v=Object.keys(g),y={};return v.forEach(b=>{var C;const N=Er(C=b.slice(4)).call(C),R=JSON.parse(g[b])[1];y[N]=R}),y}(d)}catch{}return p}),oD.apply(this,arguments)}function sD(n,r){return h2.apply(this,arguments)}function h2(){return h2=L(function*(n,r){const o=V("WEBCS_DOMAIN").concat(V("WEBCS_DOMAIN_BACKUP_LIST")).map(a=>({url:"https://".concat(a,"/api/v2/transpond/webrtc?v=2"),areaCode:dv(),serviceIds:[jn.CHOOSE_SERVER,jn.CLOUD_PROXY_FALLBACK]}));try{return yield nD({referenceList:o,asyncMapHandler:l=>{return(d=L(function*(h,p,m){let g,{url:v,areaCode:y,serviceIds:b}=h;const C=Date.now(),[N,R]=tD(p,y,b);let A=Se.networkState;try{A&&Se.networkState===co.OFFLINE&&Se.onlineWaiter&&(yield le.race([Se.onlineWaiter,Ii(Nn.maxRetryTimeout)])),A=Se.networkState;const{data:D,headers:M}=yield ta(v,{data:N,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g="1"===M.http3?1:-1,(q=>{const ee=[];if(q.response_body.forEach(J=>{const X=J.buffer.code;if(23===J.uri&&0===X&&!J.buffer.edges_services)if(4194310===J.buffer.flag)J.buffer.edges_services=[];else{const Ce={error:new z(k.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:q.detail[502]}),flag:J.buffer.flag};ee.push(Ce)}if(0!==X){const Ce=Af(X),Re={error:new z(k.CAN_NOT_GET_GATEWAY_SERVER,Ce.desc,{desc:Ce.desc,retry:Ce.retry,csIp:q.detail[502]}),flag:J.buffer.flag};4194310===J.buffer.flag?T.warning(Re.error.toString()):ee.push(Re)}}),ee.length)throw new z(k.CAN_NOT_GET_GATEWAY_SERVER,ee.map(J=>"flag: ".concat(J.flag,", message: ").concat(J.error.message)).join(" | "),{retry:!!ee.find(J=>J.error.data.retry),csIp:q.detail[502],desc:[...new Set(ee.map(J=>{var X;return null==J||null===(X=J.error)||void 0===X||null===(X=X.data)||void 0===X?void 0:X.desc}).filter(J=>!!J))]})})(D);const j=vS(D,jn.CHOOSE_SERVER),W=vS(D,jn.CLOUD_PROXY_FALLBACK);return QA(j),{gatewayInfo:_S(j,v),proxyInfo:W,opid:R,requestTime:C,url:v,isHttp3:g,elapse:Date.now()-C}}catch(D){throw D}}),function(h,p,m){return d.apply(this,arguments)})(l,n,r);var d},closeFn:l=>l.code===k.OPERATION_ABORTED||l.code===k.CAN_NOT_GET_GATEWAY_SERVER&&!l.data.retry})}catch(a){throw a}}),h2.apply(this,arguments)}function QS(n,r,o,a){return aD.apply(this,arguments)}function aD(){return aD=L(function*(n,r,o,a){const l=V("PROXY_SERVER_TYPE3"),d=(C,N,R)=>{let A=R||l;return Array.isArray(A)&&(A=N%2==0?l[1]:l[0]),"https://".concat(A,"/ap/?url=").concat(C)};let h=null;const p=[],m=function(){var C=L(function*(){const N=V("WEBCS_DOMAIN").slice(0,V("AJAX_REQUEST_CONCURRENT")).map((D,M)=>{let x;return x="disabled"===n.cloudProxyServer&&n.proxyServer?d("".concat(D,"/api/v2/transpond/webrtc?v=2"),M,n.proxyServer):"disabled"===n.cloudProxyServer||"fallback"===n.cloudProxyServer?"https://".concat(D,"/api/v2/transpond/webrtc?v=2"):d("".concat(D,"/api/v2/transpond/webrtc?v=2"),M),{url:x,areaCode:dv(),serviceIds:[jn.CHOOSE_SERVER,"proxy5"===n.cloudProxyServer?jn.CLOUD_PROXY_5:"proxy3"===n.cloudProxyServer||"proxy4"===n.cloudProxyServer?jn.CLOUD_PROXY:jn.CLOUD_PROXY_FALLBACK]}}),R=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(D=>D.url)}),A=yield Dh({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:D=>(T.debug("[".concat(n.clientId,"] Connect to choose_server:"),D.url),c2(D,n,r,o)),allFailedhandler:D=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:D},R),D[0]},promisesCollector:p});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},R),A});return function(){return C.apply(this,arguments)}}(),g=function(){var C=L(function*(){if(yield Ii(1e3),null!==h)return h;const N=V("WEBCS_DOMAIN_BACKUP_LIST").map((D,M)=>{let x;return x="disabled"===n.cloudProxyServer&&n.proxyServer?d("".concat(D,"/api/v2/transpond/webrtc?v=2"),M,n.proxyServer):"disabled"===n.cloudProxyServer||"fallback"===n.cloudProxyServer?"https://".concat(D,"/api/v2/transpond/webrtc?v=2"):d("".concat(D,"/api/v2/transpond/webrtc?v=2"),M),{url:x,areaCode:dv(),serviceIds:[jn.CHOOSE_SERVER,"proxy5"===n.cloudProxyServer?jn.CLOUD_PROXY_5:"proxy3"===n.cloudProxyServer||"proxy4"===n.cloudProxyServer?jn.CLOUD_PROXY:jn.CLOUD_PROXY_FALLBACK]}}),R=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(D=>D.url)}),A=yield Dh({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:D=>(T.debug("[".concat(n.clientId,"] Connect to backup choose_server:"),D.url),c2(D,n,r,o)),allFailedhandler:D=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:D},R),D[0]},promisesCollector:p});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},R),A});return function(){return C.apply(this,arguments)}}();let v,y,b;try{({gatewayInfo:v,proxyInfo:y,url:b}=yield jd([m(),g()]))}catch(C){throw C[0]}if(p.length&&p.forEach(C=>C.cancel&&"function"==typeof C.cancel&&C.cancel()),!v||!y)throw new z(k.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(n.apUrl=b,"disabled"!==n.cloudProxyServer&&Array.isArray(l)&&b){const C=/^https?:\/\/(.+?)(\/.*)?$/.exec(b)[1];he(l).call(l,C)&&(n.proxyServer=C,T.setProxyServer(C),be.setProxyServer(C))}return h={gatewayInfo:v,proxyInfo:yield L_(y,v.uid)},h}),aD.apply(this,arguments)}function gv(){return gv=L(function*(n,r,o){const l=V("UAP_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(d=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap")).map(d=>function(h,p,m,g){const v={command:"convergeAllocateEdge",sid:p.sid,appId:p.appId,token:p.token,ts:Date.now(),version:Ss,cname:p.cname,uid:p.uid.toString(),requestId:JA,seq:JA};JA+=1;const y={service_name:"tele_channel",json_body:JSON.stringify(v)};return rs(L(function*(){const b=yield ta(h,{data:y,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==b.code){const N=new z(k.UNEXPECTED_RESPONSE,"cross channel ap error, code"+b.code,{retry:!0});throw T.error(N.toString()),N}const C=JSON.parse(b.json_body);if(200!==C.code){const N=new z(k.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(C.code,", reason: ").concat(C.reason));throw T.error(N.toString()),N}if(!C.servers||0===C.servers.length){const N=new z(k.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw T.error(N.toString()),N}return{vid:C.vid,workerToken:C.workerToken,addressList:(V("CHANNEL_MEDIA_RELAY_SERVERS")||C.servers).map(N=>"wss://".concat(N.address.replace(/\./g,"-"),".").concat(V("WORKER_DOMAIN"),":").concat(N.wss))}}),void 0,b=>!!(b.code!==k.OPERATION_ABORTED&&b.code!==k.UNEXPECTED_RESPONSE||b.data&&b.data.retry),g)}(d,n,r,o));try{const d=yield jd(l);return l.forEach(h=>h.cancel()),d}catch(d){throw d[0]}}),gv.apply(this,arguments)}function lD(){return lD=L(function*(n,r,o){let a=null;const l=[],d=function(){var h=L(function*(p){const m=V(p?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(g=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2"));return p&&(yield Ii(1e3),null!==a)?a:yield Dh({fragementLength:V("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:g=>(T.debug("[".concat(n.clientId,"] update ticket, Connect to ").concat(p?"backup":""," choose_server:"),g),function(v,y,b,C){const[N]=z5(y,[jn.CHOOSE_SERVER]);let R=Se.networkState;return rs(L(function*(){R&&Se.networkState===co.OFFLINE&&Se.onlineWaiter&&(yield le.race([Se.onlineWaiter,Ii(C&&C.maxRetryTimeout||Nn.maxRetryTimeout)])),R=Se.networkState;const A=yield ta(v,{data:N,cancelToken:b,headers:{"Content-Type":"multipart/form-data;"}},!0);return eD(A,v)}),()=>!1,A=>A.code!==k.OPERATION_ABORTED&&(A.code===k.UPDATE_TICKET_FAILED?A.data.retry:(T.warning("[".concat(y.clientId,"] update ticket network error, retry"),A),!0)),C)}(g,n,r,o)),allFailedhandler:g=>{throw g[0]},promisesCollector:l})});return function(m){return h.apply(this,arguments)}}();try{return a=yield jd([d(!1),d(!0)]),l.length&&l.forEach(h=>h.cancel&&"function"==typeof h.cancel&&h.cancel()),a}catch(h){throw h[0]}}),lD.apply(this,arguments)}function f2(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function Y5(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?f2(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):f2(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}class GW extends nn{get isSuccess(){return!!this.configs}constructor(r){super(),O(this,"configs",void 0),O(this,"joinInfo",void 0),O(this,"cancelToken",void 0),O(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),O(this,"interval",void 0),O(this,"mutex",void 0),O(this,"mutableParamsRead",!1),this.mutex=new Qi("config-distribute",r)}startGetConfigDistribute(r,o){this.joinInfo=r,this.cancelToken=o,this.interval&&this.stopGetConfigDistribute(),V("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},V("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}awaitConfigDistributeComplete(){var r=this;return L(function*(){r.mutex.isLocked&&(yield r.mutex.lock())()})()}updateConfigDistribute(){var r=this;return L(function*(){if(r.mutableParamsRead||(r.mutableParamsRead=!0,be.reportApiInvoke(null,{options:void 0,name:Yn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:st.TRACER}).onSuccess(JSON.stringify(Rd))),!r.joinInfo||!r.cancelToken||!r.retryConfig)return void T.debug("[config-distribute] get config distribute interrupted have no joininfo");let o;const a=yield r.mutex.lock();try{o=yield function q5(n,r,o){return oD.apply(this,arguments)}(r.joinInfo,r.cancelToken,r.retryConfig),T.debug("[config-distribute] get config distribute",JSON.stringify(o)),o.limit_bitrate&&r.handleBitrateLimit(o.limit_bitrate),r.cacheGlobalParameterConfig(o),r.configs=o}catch(l){const d=new z(k.NETWORK_RESPONSE_ERROR,l);T.warning("[config-distribute] ".concat(d.toString()))}finally{a()}})()}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(r){var o;(o=r)&&o.uplink&&o.id&&void 0!==o.uplink.max_bitrate&&void 0!==o.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==r.id&&this.emit(mS.UPDATE_BITRATE_LIMIT,r):this.emit(mS.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&Y5({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(r){var o;const a=hd(o=Object.keys(r).filter(d=>/^webrtc_ng_global_parameter/.test(d))).call(o);for(let d=0;d<a.length;d++)for(let h=a.length-1;h>d;h--){const p=a[h];if("number"==typeof r[p].__priority){const g=a[h-1];if("number"==typeof r[g].__priority){if(!(r[p].__priority>r[g].__priority))continue;{const v=p;a[h]=a[h-1],a[h-1]=v}}else{const v=p;a[h]=a[h-1],a[h-1]=v}}}const l={};a.forEach(d=>{const h=r[d],p=h.__expires;Object.keys(h).forEach(m=>{"__priority"===m||"__expires"===m||Object.prototype.hasOwnProperty.call(l,m)||(l[m]=Y5({value:h[m]},p&&{expires:p}))})});try{!function(p){try{const m=Date.now();Object.keys(p).forEach(g=>{switch(g){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(Pn,g)){const{value:v,expires:y}=p[g];if(y&&y<=m)return;Rd[g]=v,Pn[g]=v,T.debug("Update global parameters from config distribute",g,v)}}})}catch(m){T.error("Error update config immediately: ".concat(p),m.message)}}(l);const d=JSON.stringify(l),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),T.debug("Caching global parameters ".concat(d))}catch(d){T.error("Error caching global parameters:",d.message)}}}class m2 extends nn{constructor(){super(...arguments),O(this,"resultStorage",new Map)}setLocalAudioStats(r,o,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(a,o)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(a,o))}setLocalVideoStats(r,o,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(a,o)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(a,o)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(a))}setRemoteAudioStats(r,o){const a=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(o))}setRemoteVideoStats(r,o){const a=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(o))}record(r,o,a){if(V("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const l=this.resultStorage.get(r);if(l&&(l.result.push(a),l.result.length>=5)){var d;const h=he(d=l.result).call(d,!0);l.isPrevNormal&&!h&&this.emit("exception",g2[r],r,o),!l.isPrevNormal&&h&&this.emit("exception",g2[r]+2e3,r+"_RECOVER",o),l.isPrevNormal=h,l.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&0===r.receiveLevel)}checkAudioInputLevel(r,o){return o instanceof si&&!o.isActive||!!o.muted||0!==r.sendVolumeLevel}checkFramerateInput(r,o){let a=null;o._encoderConfig&&o._encoderConfig.frameRate&&(a=Mr(o._encoderConfig.frameRate));const l=r.captureFrameRate;return!a||!l||!(a>10&&l<5||a<10&&a>=5&&l<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,o){return!!o.muted||0!==r.sendBitrate}checkSendAudioBitrate(r,o){return o instanceof si&&!o.isActive||!!o.muted||0!==r.sendBitrate}checkVideoDecode(r){return 0===r.receiveBitrate||0!==r.decodeFrameRate}}const g2={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},tr=new class{markSubscribeStart(n,r){performance.mark("agora-web-sdk/".concat(n,"/subscribe-").concat(r))}markPublishStart(n,r){performance.mark("agora-web-sdk/".concat(n,"/publish-").concat(r))}measureFromSubscribeStart(n,r){const o=performance.getEntriesByName("agora-web-sdk/".concat(n,"/subscribe-").concat(r));if(o.length>0){const a=o[o.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(n,r){const o=performance.getEntriesByName("agora-web-sdk/".concat(n,"/publish-").concat(r));if(o.length>0){const a=o[o.length-1];return Math.round(performance.now()-a.startTime)}return 0}};var dD=Gt(to.Object.getOwnPropertySymbols),WW=Ft,Ua=RT.indexOf,$5=Nm,uD=Qh([].indexOf),_2=!!uD&&1/uD([1],1,-0)<0;WW({target:"Array",proto:!0,forced:_2||!$5("indexOf")},{indexOf:function(n){var r=arguments.length>1?arguments[1]:void 0;return _2?uD(this,n,r)||0:Ua(this,n,r)}});var X5=Or("Array").indexOf,hD=Ar,Z5=X5,pD=Array.prototype,v2=Gt(function(n){var r=n.indexOf;return n===pD||hD(pD,n)&&r===pD.indexOf?Z5:r});function na(n){if(Array.isArray(n))return n.map(o=>o);if(!E2(n))return n;const r={};for(const o in n){const a=n[o];r[o]=E2(a)||Array.isArray(a)?na(a):a}return r}function E2(n){return!("object"!=typeof n||Array.isArray(n)||!n)}class fD{constructor(r){O(this,"input",[]),O(this,"size",void 0),this.size=r}add(r){this.input.push(r),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Rc={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},_v={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Rc,remoteCandidate:Rc},updateInterval:0},y2={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},b2={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},S2={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},C2={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function mD(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function T2(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?mD(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):mD(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}class gD{constructor(r,o){var a=this;O(this,"onFirstVideoReceived",void 0),O(this,"onFirstVideoDecoded",void 0),O(this,"onFirstAudioReceived",void 0),O(this,"onFirstVideoDecodedTimeout",void 0),O(this,"onFirstAudioDecoded",void 0),O(this,"onSelectedLocalCandidateChanged",void 0),O(this,"onSelectedRemoteCandidateChanged",void 0),O(this,"videoIsReady",!1),O(this,"videoIsReady2",{}),O(this,"pc",void 0),O(this,"options",void 0),O(this,"intervalTimer",void 0),O(this,"stats",na(_v)),O(this,"isFirstVideoReceived",{}),O(this,"isFirstVideoDecoded",{}),O(this,"isFirstAudioReceived",{}),O(this,"isFirstAudioDecoded",{}),O(this,"isFirstVideoDecodedTimeout",{}),O(this,"lossRateWindowStats",[]),this.pc=r,this.options=o,this.intervalTimer=window.setInterval(L(function*(){a.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new le(r=>{r({local:T2({},Rc),remote:T2({},Rc)})})}setVideoIsReady(r){this.videoIsReady=r}setVideoIsReady2(r,o){this.videoIsReady2[r]=o}getVideoIsReady(r){return this.videoIsReady2[r]||!1}setIsFirstAudioDecoded(r){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(r){this.lossRateWindowStats.push(r),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const o=this.lossRateWindowStats.length,a=["videoSend","audioSend","videoRecv","audioRecv"];let l=0,d=0,h=0,p=0;for(const m of a)r[m].forEach((g,v)=>{if(!this.lossRateWindowStats[o-1][m][v]||!this.lossRateWindowStats[0][m][v])return;const y=this.lossRateWindowStats[o-1][m][v].packets-this.lossRateWindowStats[0][m][v].packets,b=this.lossRateWindowStats[o-1][m][v].packetsLost-this.lossRateWindowStats[0][m][v].packetsLost;"videoSend"===m||"audioSend"===m?(l+=y,h+=b):(d+=y,p+=b),g.packetLostRate=Number.isNaN(y)||Number.isNaN(y)||y<=0||b<=0?0:b/(y+b)});r.sendPacketLossRate=l<=0||h<=0?0:h/(l+h),r.recvPacketLossRate=d<=0||p<=0?0:p/(d+p)}}function I2(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function _D(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?I2(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):I2(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}class vD extends gD{constructor(){super(...arguments),O(this,"_stats",_v),O(this,"lastDecodeVideoReceiverStats",new Map)}updateStats(){var r=this;return L(function*(){const o=yield r._getStats(),a=r.statsResponsesToObjects(o);r._stats=na(_v);const l=a.filter(h=>"ssrc"===h.type);r.processSSRCStats(l);const d=a.find(h=>"VideoBwe"===h.type);d&&r.processBandwidthStats(d),r._stats.timestamp=Date.now(),r.calcLossRate(r._stats),r.stats=r._stats})()}processBandwidthStats(r){this._stats.bitrate={actualEncoded:Number(r.googActualEncBitrate),targetEncoded:Number(r.googTargetEncBitrate),retransmit:Number(r.googRetransmitBitrate),transmit:Number(r.googTransmitBitrate)},this._stats.sendBandwidth=Number(r.googAvailableSendBandwidth)}processSSRCStats(r){r.forEach(o=>{var a;const l=he(a=o.id).call(a,"send");switch("".concat(o.mediaType,"_").concat(l?"send":"recv")){case"video_send":{const d=na(b2);d.codec=o.googCodecName,d.adaptionChangeReason="none",o.googCpuLimitedResolution&&(d.adaptionChangeReason="cpu"),o.googBandwidthLimitedResolution&&(d.adaptionChangeReason="bandwidth"),d.avgEncodeMs=Number(o.googAvgEncodeMs),d.inputFrame={width:Number(o.googFrameWidthInput)||Number(o.googFrameWidthSent),height:Number(o.googFrameHeightInput)||Number(o.googFrameHeightSent),frameRate:Number(o.googFrameRateInput)},d.sentFrame={width:Number(o.googFrameWidthSent),height:Number(o.googFrameHeightSent),frameRate:Number(o.googFrameRateInput)},d.firsCount=Number(o.googFirReceived),d.nacksCount=Number(o.googNacksReceived),d.plisCount=Number(o.googPlisReceived),d.frameCount=Number(o.framesEncoded),d.bytes=Number(o.bytesSent),d.packets=Number(o.packetsSent),d.packetsLost=Number(o.packetsLost),d.ssrc=Number(o.ssrc),d.rttMs=Number(o.googRtt||0),this._stats.videoSend.push(d),this._stats.rtt=d.rttMs;break}case"video_recv":{const d=na(y2),h=this.lastDecodeVideoReceiverStats.get(Number(o.ssrc));if(d.codec=o.googCodecName,d.targetDelayMs=Number(o.googTargetDelayMs),d.renderDelayMs=Number(o.googRenderDelayMs),d.currentDelayMs=Number(o.googCurrentDelayMs),d.minPlayoutDelayMs=Number(o.googMinPlayoutDelayMs),d.decodeMs=Number(o.googDecodeMs),d.maxDecodeMs=Number(o.googMaxDecodeMs),d.receivedFrame={width:Number(o.googFrameWidthReceived),height:Number(o.googFrameHeightReceived),frameRate:Number(o.googFrameRateReceived)},d.decodedFrame={width:Number(o.googFrameWidthReceived),height:Number(o.googFrameHeightReceived),frameRate:Number(o.googFrameRateDecoded)},d.decodeFrameRate=Number(o.googFrameRateDecoded),d.outputFrame={width:Number(o.googFrameWidthReceived),height:Number(o.googFrameHeightReceived),frameRate:Number(o.googFrameRateOutput)},d.jitterBufferMs=Number(o.googJitterBufferMs),d.firsCount=Number(o.googFirsSent),d.nacksCount=Number(o.googNacksSent),d.plisCount=Number(o.googPlisSent),d.framesDecodeCount=Number(o.framesDecoded),d.bytes=Number(o.bytesReceived),d.packets=Number(o.packetsReceived),d.packetsLost=Number(o.packetsLost),d.ssrc=Number(o.ssrc),d.packets>0&&!this.isFirstVideoReceived[d.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(d.ssrc),this.isFirstVideoReceived[d.ssrc]=!0),d.framesDecodeCount>0&&!this.isFirstVideoDecoded[d.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(d.ssrc,d.decodedFrame.width,d.decodedFrame.height),this.isFirstVideoDecoded[d.ssrc]=!0),h){const p=h.stats,m=Date.now()-h.lts;d.framesDecodeFreezeTime=p.framesDecodeFreezeTime,d.framesDecodeInterval=p.framesDecodeInterval,d.framesDecodeCount>p.framesDecodeCount&&this.isFirstVideoDecoded[d.ssrc]?(h.lts=Date.now(),d.framesDecodeInterval=m,d.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(o.ssrc,10))?d.framesDecodeFreezeTime+=d.framesDecodeInterval:this.setVideoIsReady2(parseInt(o.ssrc,10),!0))):d.framesDecodeCount<h.stats.framesDecodeCount&&(d.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(d.ssrc,{stats:_D({},d),lts:Date.now()}),this._stats.videoRecv.push(d);break}case"audio_recv":{const d=na(C2);d.codec=o.googCodecName,d.outputLevel=Math.abs(Number(o.audioOutputLevel))/32767,d.decodingCNG=Number(o.googDecodingCNG),d.decodingCTN=Number(o.googDecodingCTN),d.decodingCTSG=Number(o.googDecodingCTSG),d.decodingNormal=Number(o.googDecodingNormal),d.decodingPLC=Number(o.googDecodingPLC),d.decodingPLCCNG=Number(o.googDecodingPLCCNG),d.expandRate=Number(o.googExpandRate),d.accelerateRate=Number(o.googAccelerateRate),d.preemptiveExpandRate=Number(o.googPreemptiveExpandRate),d.secondaryDecodedRate=Number(o.googSecondaryDecodedRate),d.speechExpandRate=Number(o.googSpeechExpandRate),d.preferredJitterBufferMs=Number(o.googPreferredJitterBufferMs),d.jitterBufferMs=Number(o.googJitterBufferMs),d.jitterMs=Number(o.googJitterReceived),d.bytes=Number(o.bytesReceived),d.packets=Number(o.packetsReceived),d.packetsLost=Number(o.packetsLost),d.ssrc=Number(o.ssrc),d.receivedFrames=Number(o.googDecodingCTN)||Number(o.packetsReceived),d.droppedFrames=Number(o.googDecodingPLC)+Number(o.googDecodingPLCCNG)||Number(o.packetsLost),d.receivedFrames>0&&!this.isFirstAudioReceived[d.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(d.ssrc),this.isFirstAudioReceived[d.ssrc]=!0),d.decodingNormal>0&&!this.isFirstAudioDecoded[d.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(d.ssrc),this.isFirstAudioDecoded[d.ssrc]=!0),this._stats.audioRecv.push(d);break}case"audio_send":{const d=na(S2);d.codec=o.googCodecName,d.inputLevel=Math.abs(Number(o.audioInputLevel))/32767,d.aecReturnLoss=Number(o.googEchoCancellationReturnLoss||0),d.aecReturnLossEnhancement=Number(o.googEchoCancellationReturnLossEnhancement||0),d.residualEchoLikelihood=Number(o.googResidualEchoLikelihood||0),d.residualEchoLikelihoodRecentMax=Number(o.googResidualEchoLikelihoodRecentMax||0),d.bytes=Number(o.bytesSent),d.packets=Number(o.packetsSent),d.packetsLost=Number(o.packetsLost),d.ssrc=Number(o.ssrc),d.rttMs=Number(o.googRtt||0),this._stats.rtt=d.rttMs,this._stats.audioSend.push(d);break}}})}_getStats(){return new le((r,o)=>{this.pc.getStats(r,o)})}statsResponsesToObjects(r){const o=[];return r.result().forEach(a=>{const l={id:a.id,timestamp:a.timestamp.valueOf().toString(),type:a.type};a.names().forEach(d=>{l[d]=a.stat(d)}),o.push(l)}),o}}var vv=function(n){return n[n.kNone=1]="kNone",n[n.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",n[n.kBytesToBits=8]="kBytesToBits",n}(vv||{});function eC(n,r,o,a){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:vv.kNone;if(!r)return;const d=Number(r[o]);if("number"!=typeof d)return;const h=Number(r[a]);if("number"!=typeof h)return;if(!n)return h?d/h*l:void 0;const p=Number(n[o]);if("number"!=typeof p)return;const m=Number(n[a]);if("number"!=typeof m)return;const g=h-m;return g?(d-p)/g*l:void 0}function ED(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function Pl(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?ED(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):ED(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}class w2 extends gD{constructor(){super(...arguments),O(this,"_stats",_v),O(this,"report",void 0),O(this,"lastDecodeVideoReceiverStats",new Map),O(this,"lastVideoFramesRecv",new Map),O(this,"lastVideoFramesSent",new Map),O(this,"lastVideoFramesDecode",new Map),O(this,"lastVideoFramesOutput",new Map),O(this,"lastVideoJBDelay",new Map),O(this,"lastAudioJBDelay",new Map),O(this,"mediaBytesSent",new Map),O(this,"mediaBytesRetransmit",new Map),O(this,"mediaBytesTargetEncode",new Map),O(this,"lastDecodeAudioReceiverStats",new Map),O(this,"lastEncoderMs",new Map)}updateStats(){var r=this;return L(function*(){r.report=yield r.pc.getStats(),r._stats=na(_v),r.report.forEach(o=>{switch(o.type){case kn.OUTBOUND:case kn.INBOUND:{const a=o.mediaType||o.kind,l=!a&&"frameWidth"in o,d=!a&&!("frameWidth"in o);o.type===kn.OUTBOUND?"audio"===a||d?r.processAudioOutboundStats(o):("video"===a||l)&&r.processVideoOutboundStats(o):o.type===kn.INBOUND&&("audio"===a||d?r.processAudioInboundStats(o):("video"===a||l)&&r.processVideoInboundStats(o));break}case kn.TRANSPORT:{const a=r.report.get(o.selectedCandidatePairId);a&&r.processCandidatePairStats(a);break}case kn.CANDIDATE_PAIR:o.selected&&r.processCandidatePairStats(o)}}),r.updateSendBitrate(),r._stats.updateInterval=Date.now()-r.stats.timestamp,r._stats.timestamp=Date.now(),r.calcLossRate(r._stats),r.stats=r._stats})()}getSelectedCandidatePair(){var r=this;return L(function*(){const o=yield r.pc.getStats(),a={local:Pl({},Rc),remote:Pl({},Rc)};return o.forEach(l=>{let d;if(l.type===kn.TRANSPORT&&(d=o.get(l.selectedCandidatePairId)),l.type===kn.CANDIDATE_PAIR&&l.selected&&(d=l),d){const h=(p,m)=>{p.type=m.type,p.id=m.id,m.address&&(p.address=m.address),m.candidateType&&(p.candidateType=m.candidateType),m.port&&(p.port=m.port),m.priority&&(p.priority=m.priority),m.protocol&&(p.protocol=m.protocol),m.relayProtocol&&(p.relayProtocol=m.relayProtocol)};if(d.localCandidateId){const p=o.get(d.localCandidateId);p&&h(a.local,p)}if(d.remoteCandidateId){const p=o.get(d.remoteCandidateId);p&&h(a.remote,p)}}}),a})()}processCandidatePairStats(r){if(this._stats.sendBandwidth=r.availableOutgoingBitrate||0,r.currentRoundTripTime&&(this._stats.rtt=1e3*r.currentRoundTripTime),this._stats.videoSend.forEach(o=>{r.currentRoundTripTime&&(o.rttMs=1e3*r.currentRoundTripTime)}),this._stats.audioSend.forEach(o=>{r.currentRoundTripTime&&(o.rttMs=1e3*r.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=r.id,r.localCandidateId){const o=this.report.get(r.localCandidateId);o&&this.processCandidateStats(o)}if(r.remoteCandidateId){const o=this.report.get(r.remoteCandidateId);o&&this.processCandidateStats(o)}}processCandidateStats(r){let o;r.type===kn.LOCAL_CANDIDATE&&(o=this._stats.selectedCandidatePair.localCandidate),r.type===kn.REMOTE_CANDIDATE&&(o=this._stats.selectedCandidatePair.remoteCandidate),o&&(o.type=r.type,o.id=r.id,r.address&&(o.address=r.address),r.candidateType&&(o.candidateType=r.candidateType),r.port&&(o.port=r.port),r.priority&&(o.priority=r.priority),r.protocol&&(o.protocol=r.protocol),r.relayProtocol&&(o.relayProtocol=r.relayProtocol),r.type===kn.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==o.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Pl({},o),Pl({},this.stats.selectedCandidatePair.localCandidate)),r.type===kn.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==o.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Pl({},o),Pl({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(r){let o=this._stats.audioRecv.find(l=>l.ssrc===r.ssrc);o||(o=na(C2),this._stats.audioRecv.push(o)),o.ssrc=r.ssrc,o.packets=r.packetsReceived,o.packetsLost=r.packetsLost,o.packetsDiscarded=r.packetsDiscarded,o.bytes=r.bytesReceived,o.jitterMs=1e3*r.jitter,o.retransmittedBytesReceived=r.retransmittedBytesReceived,o.retransmittedPacketsReceived=r.retransmittedPacketsReceived,o.totalProcessingDelay=r.totalProcessingDelay,o.jitterBufferEmittedCount=r.jitterBufferEmittedCount;const a=this.lastDecodeAudioReceiverStats.get(o.ssrc);o.avgProcessingDelayMs=eC(a,o,"totalProcessingDelay","jitterBufferEmittedCount",vv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(r,r.trackId,o),r.codecId&&(o.codec=this.getCodecFromCodecStats(r.codecId)),o.receivedFrames||(o.receivedFrames=r.packetsReceived),o.droppedFrames||(o.droppedFrames=r.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.outputLevel&&o.outputLevel>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),"number"==typeof r.concealedSamples&&(o.concealedSamples=r.concealedSamples),this.lastDecodeAudioReceiverStats.set(o.ssrc,Pl({},o))}processVideoInboundStats(r){let o=this._stats.videoRecv.find(p=>p.ssrc===r.ssrc);o||(o=na(y2),this._stats.videoRecv.push(o)),o.ssrc=r.ssrc,o.packets=r.packetsReceived,o.packetsLost=r.packetsLost,o.bytes=r.bytesReceived,o.firsCount=r.firCount,o.nacksCount=r.nackCount,o.plisCount=r.pliCount,o.framesDecodeCount=r.framesDecoded,o.framesDroppedCount=r.framesDropped,o.totalInterFrameDelay=r.totalInterFrameDelay,o.totalSquaredInterFrameDelay=r.totalSquaredInterFrameDelay,o.totalFreezesDuration=r.totalFreezesDuration,o.totalProcessingDelay=r.totalProcessingDelay,o.packetsDiscarded=r.packetsDiscarded,o.framesAssembledFromMultiplePackets=r.framesAssembledFromMultiplePackets,o.totalAssemblyTime=r.totalAssemblyTime,o.keyFramesDecoded=r.keyFramesDecoded,o.retransmittedBytesReceived=r.retransmittedBytesReceived,o.retransmittedPacketsReceived=r.retransmittedPacketsReceived;const a=this.lastDecodeVideoReceiverStats.get(o.ssrc),l=this.lastVideoFramesDecode.get(o.ssrc),d=this.lastVideoFramesOutput.get(o.ssrc),h=Date.now();if(o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,o.decodedFrame?o.decodedFrame.width:0,o.decodedFrame?o.decodedFrame.height:0),this.isFirstVideoDecoded[o.ssrc]=!0),a){const p=a.stats,m=h-a.lts;o.framesDecodeFreezeTime=p.framesDecodeFreezeTime,o.framesDecodeInterval=p.framesDecodeInterval,!this.isFirstVideoDecoded[o.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[o.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(o.ssrc),this.isFirstVideoDecodedTimeout[o.ssrc]=!0),o.framesDecodeCount>p.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(a.lts=Date.now(),o.framesDecodeInterval=m,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):o.framesDecodeCount<p.framesDecodeCount&&(o.framesDecodeInterval=0),r.framesDecoded&&r.qpSum&&(o.qpSumPerFrame=a.stats.framesDecodeCount>r.framesDecoded?r.qpSum/r.framesDecoded:(r.qpSum-a.qpSum)/(r.framesDecoded-a.stats.framesDecodeCount))}r.totalDecodeTime&&(o.decodeMs=1e3*r.totalDecodeTime,o.avgDecodeMs=eC(a?.stats,o,"decodeMs","framesDecodeCount")),o.avgProcessingDelayMs=eC(a?.stats,o,"totalProcessingDelay","framesDecodeCount",vv.kMillisecondsFromSeconds),o.avgFramesAssembledFromMultiplePacketsMs=eC(a?.stats,o,"totalAssemblyTime","framesAssembledFromMultiplePackets",vv.kMillisecondsFromSeconds),o.avgInterFrameDelayMs=eC(a?.stats,o,"totalInterFrameDelay","framesDecodeCount",vv.kMillisecondsFromSeconds),l&&h-l.lts>=800?(o.decodeFrameRate=Math.round((o.framesDecodeCount-l.count)/((h-l.lts)/1e3)),this.lastVideoFramesDecode.set(o.ssrc,{count:o.framesDecodeCount,lts:h,rate:o.decodeFrameRate})):l?o.decodeFrameRate=l.rate:this.lastVideoFramesDecode.set(o.ssrc,{count:o.framesDecodeCount,lts:h,rate:0}),o.framesDroppedCount&&r.framesReceived&&(d&&h-d.lts>=800?(o.outputFrameRate=Math.round((r.framesReceived-o.framesDroppedCount-d.count)/((h-d.lts)/1e3)),this.lastVideoFramesOutput.set(o.ssrc,{count:r.framesReceived-o.framesDroppedCount,lts:h,rate:Math.max(o.outputFrameRate,0)})):d?o.outputFrameRate=d.rate:this.lastVideoFramesOutput.set(o.ssrc,{count:r.framesReceived-o.framesDroppedCount,lts:h,rate:0})),this.processVideoTrackReceiverStats(r,r.trackId,o),r.codecId&&(o.codec=this.getCodecFromCodecStats(r.codecId)),r.framerateMean&&(o.framesRateFirefox=r.framerateMean),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:Pl({},o),lts:a?a.lts:Date.now(),qpSum:r.qpSum})}processVideoOutboundStats(r){let o=this._stats.videoSend.find(l=>l.ssrc===r.ssrc);o||(o=na(b2),this._stats.videoSend.push(o));const a=this.mediaBytesSent.get(r.ssrc);if(a)a.add(r.bytesSent);else{const l=new fD(10);l.add(r.bytesSent),this.mediaBytesSent.set(r.ssrc,l)}if(void 0!==r.retransmittedBytesSent){const l=this.mediaBytesRetransmit.get(r.ssrc);if(l)l.add(r.retransmittedBytesSent);else{const d=new fD(10);d.add(r.retransmittedBytesSent),this.mediaBytesRetransmit.set(r.ssrc,d)}}if(r.totalEncodedBytesTarget){const l=this.mediaBytesTargetEncode.get(r.ssrc);if(l)l.add(r.totalEncodedBytesTarget);else{const d=new fD(10);d.add(r.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(r.ssrc,d)}}if(o.ssrc=r.ssrc,o.bytes=r.bytesSent,o.packets=r.packetsSent,o.firsCount=r.firCount,o.nacksCount=r.nackCount,o.plisCount=r.pliCount,o.frameCount=r.framesEncoded,o.adaptionChangeReason=r.qualityLimitationReason,o.scalabilityMode=r.scalabilityMode,o.retransmittedBytesSent=r.retransmittedBytesSent,o.retransmittedPacketsSent=r.retransmittedPacketsSent,o.hugeFramesSent=r.hugeFramesSent,o.keyFramesEncoded=r.keyFramesEncoded,r.totalEncodeTime&&r.framesEncoded){const l=this.lastEncoderMs.get(r.ssrc);o.avgEncodeMs=!l||l.lastFrameCount>r.framesEncoded?1e3*r.totalEncodeTime/r.framesEncoded:1e3*(r.totalEncodeTime-l.lastEncoderTime)/(r.framesEncoded-l.lastFrameCount)}if(r.framesEncoded&&r.qpSum){const l=this.lastEncoderMs.get(r.ssrc);o.qpSumPerFrame=!l||l.lastFrameCount>r.framesEncoded?r.qpSum/r.framesEncoded:(r.qpSum-l.lastQpSum)/(r.framesEncoded-l.lastFrameCount)}if(this.lastEncoderMs.set(r.ssrc,{lastFrameCount:r.framesEncoded,lastEncoderTime:r.totalEncodeTime,lastQpSum:r.qpSum,lts:Date.now()}),r.codecId&&(o.codec=this.getCodecFromCodecStats(r.codecId)),r.mediaSourceId&&this.processVideoMediaSource(r.mediaSourceId,o),this.processVideoTrackSenderStats(r,r.trackId,o),r.remoteId)this.processRemoteInboundStats(r.remoteId,o);else{const l=this.findRemoteStatsId(r.ssrc,kn.REMOTE_INBOUND);l&&this.processRemoteInboundStats(l,o)}}processAudioOutboundStats(r){let o=this._stats.audioSend.find(a=>a.ssrc===r.ssrc);if(o||(o=na(S2),this._stats.audioSend.push(o)),o.ssrc=r.ssrc,o.packets=r.packetsSent,o.bytes=r.bytesSent,o.retransmittedBytesSent=r.retransmittedBytesSent,o.retransmittedPacketsSent=r.retransmittedPacketsSent,r.mediaSourceId&&this.processAudioMediaSource(r.mediaSourceId,o),r.codecId&&(o.codec=this.getCodecFromCodecStats(r.codecId)),this.processAudioTrackSenderStats(r,r.trackId,o),r.remoteId)this.processRemoteInboundStats(r.remoteId,o);else{const a=this.findRemoteStatsId(r.ssrc,kn.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,o)}}findRemoteStatsId(r,o){var a;const l=Array.from(Md(a=this.report).call(a)).find(d=>d.type===o&&d.ssrc===r);return l?l.id:null}processVideoMediaSource(r,o){const a=this.report.get(r);a&&a.width&&a.height&&a.framesPerSecond&&(o.inputFrame={width:a.width,height:a.height,frameRate:a.framesPerSecond})}processAudioMediaSource(r,o){const a=this.report.get(r);a&&(o.inputLevel=a.audioLevel)}processVideoTrackSenderStats(r,o,a){var l,d,h,p;const m=o?this.report.get(o):void 0,g=null!==(l=m?.framesSent)&&void 0!==l?l:r.framesSent;if("number"!=typeof g)return;let v=null!==(d=m?.frameWidth)&&void 0!==d?d:r.frameWidth,y=null!==(h=m?.frameHeight)&&void 0!==h?h:r.frameHeight,b=null!==(p=m?.framesPerSecond)&&void 0!==p?p:r.framesPerSecond;if("number"==typeof v&&"number"==typeof y||(v=0,y=0),null==b){const C=Date.now(),N=this.lastVideoFramesSent.get(a.ssrc);N&&C-N.lts>=800?(b=Math.round((g-N.count)/((C-N.lts)/1e3)),this.lastVideoFramesSent.set(a.ssrc,{count:g,lts:C,rate:b})):N?b=N.rate:this.lastVideoFramesSent.set(a.ssrc,{count:g,lts:C,rate:0})}a.sentFrame={width:v,height:y,frameRate:Math.max(0,b)}}processVideoTrackReceiverStats(r,o,a){var l,d,h,p,m;const g=o?this.report.get(o):void 0,v=null!==(l=g?.framesReceived)&&void 0!==l?l:r.framesReceived,y=null!==(d=g?.frameWidth)&&void 0!==d?d:r.frameWidth,b=null!==(h=g?.frameHeight)&&void 0!==h?h:r.frameHeight,C=null!==(p=g?.jitterBufferDelay)&&void 0!==p?p:r.jitterBufferDelay,N=null!==(m=g?.jitterBufferEmittedCount)&&void 0!==m?m:r.jitterBufferEmittedCount;if("number"==typeof v){const R=this.lastVideoFramesRecv.get(a.ssrc),A=Date.now();a.framesReceivedCount=v;let D=0;R&&A-R.lts>=800?(D=Math.round((v-R.count)/((A-R.lts)/1e3)),this.lastVideoFramesRecv.set(a.ssrc,{count:v,lts:A,rate:D})):R?D=R.rate:this.lastVideoFramesRecv.set(a.ssrc,{count:v,lts:A,rate:0}),a.receivedFrame={width:y||0,height:b||0,frameRate:D||0},a.decodedFrame={width:y||0,height:b||0,frameRate:a.decodeFrameRate||0},a.outputFrame={width:y||0,height:b||0,frameRate:a.outputFrameRate||a.decodeFrameRate||0}}if(C&&N){const R=this.lastVideoJBDelay.get(a.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let A=R.jitterBufferMs;const D=N-R.jitterBufferEmittedCount;D>0&&(A=1e3*(C-R.jitterBufferDelay)/D),a.jitterBufferMs=A,a.currentDelayMs=Math.round(A),this.lastVideoJBDelay.set(a.ssrc,{jitterBufferDelay:C,jitterBufferEmittedCount:N,jitterBufferMs:a.currentDelayMs})}}processAudioTrackSenderStats(r,o,a){var l,d,h,p;const m=o?this.report.get(o):void 0,g=null!==(l=null!==(d=m?.echoReturnLoss)&&void 0!==d?d:r.echoReturnLoss)&&void 0!==l?l:0,v=null!==(h=null!==(p=m?.echoReturnLossEnhancement)&&void 0!==p?p:r.echoReturnLossEnhancement)&&void 0!==h?h:0;a.aecReturnLoss=g,a.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(r,o,a){var l,d,h,p,m,g,v;const y=o?this.report.get(o):void 0,b=null!==(l=y?.removedSamplesForAcceleration)&&void 0!==l?l:r.removedSamplesForAcceleration,C=null!==(d=y?.totalSamplesReceived)&&void 0!==d?d:r.totalSamplesReceived,N=null!==(h=y?.jitterBufferDelay)&&void 0!==h?h:r.jitterBufferDelay,R=null!==(p=y?.jitterBufferEmittedCount)&&void 0!==p?p:r.jitterBufferEmittedCount,A=null!==(m=y?.audioLevel)&&void 0!==m?m:r?.audioLevel,D=null!==(g=y?.totalSamplesDuration)&&void 0!==g?g:r?.totalSamplesDuration,M=null!==(v=y?.concealedSamples)&&void 0!==v?v:r.concealedSamples;if(b&&C&&(a.accelerateRate=b/C),N&&R){const j=this.lastAudioJBDelay.get(a.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let W=j.jitterBufferMs;const q=R-j.jitterBufferEmittedCount;q>0&&(W=1e3*(N-j.jitterBufferDelay)/q),a.jitterBufferMs=Math.round(W),this.lastAudioJBDelay.set(a.ssrc,{jitterBufferDelay:N,jitterBufferEmittedCount:R,jitterBufferMs:a.jitterBufferMs})}a.outputLevel=A;let x=1920;D&&C&&(x=C/D/50,a.receivedFrames=Math.round(C/x)),M&&(a.droppedFrames=Math.round(M/x))}processRemoteInboundStats(r,o){const a=this.report.get(r);a&&(o.packetsLost=a.packetsLost,a.roundTripTime&&(o.rttMs=1e3*a.roundTripTime),a.jitter&&(o.jitterMs=1e3*a.jitter),a.timestamp&&(o.timestamp=a.timestamp))}getCodecFromCodecStats(r){const o=this.report.get(r);if(!o)return"";const a=o.mimeType.match(/\/(.*)$/);return a&&a[1]?a[1]:""}updateSendBitrate(){let r=0,o=null,a=null;this.mediaBytesSent.forEach(d=>{r+=d.diffMean()}),this.mediaBytesRetransmit.forEach(d=>{o=null===o?d.diffMean():o+d.diffMean()}),this.mediaBytesTargetEncode.forEach(d=>{a=null===a?d.diffMean():a+d.diffMean()}),this._stats.bitrate={actualEncoded:8*(null!==o?r-o:r)/(this.options.updateInterval/1e3),transmit:8*r/(this.options.updateInterval/1e3)},null!==o&&(this._stats.bitrate.retransmit=8*o/(this.options.updateInterval/1e3)),null!==a&&(this._stats.bitrate.targetEncoded=8*a/(this.options.updateInterval/1e3))}}class eH extends gD{updateStats(){return le.resolve()}}function tC(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const d=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new vD(n,{updateInterval:r,lossRateInterval:o,freezeRateLimit:a,firstVideoDecodedTimeout:l}):new w2(n,{updateInterval:r,lossRateInterval:o,freezeRateLimit:a,firstVideoDecodedTimeout:l}):function(h){if(!window.RTCStatsReport)return!1;const p=h.getStats();return!(!(p instanceof le)&&(m=p,!m||"object"!=typeof m&&"function"!=typeof m||"function"!=typeof m.then));var m}(n)?new w2(n,{updateInterval:r,lossRateInterval:o,freezeRateLimit:a,firstVideoDecodedTimeout:l}):new eH(n,{updateInterval:r,lossRateInterval:o,freezeRateLimit:a,firstVideoDecodedTimeout:l})}let tH=class{get localCapabilities(){return Vn(this._localCapabilities)}get rtpCapabilities(){return Vn(this._rtpCapabilities)}get candidates(){return Vn(this._candidates)}get iceParameters(){return Vn(this._iceParameters)}get dtlsParameters(){return Vn(this._dtlsParameters)}constructor(n){O(this,"sessionDesc",void 0),O(this,"_localCapabilities",void 0),O(this,"_rtpCapabilities",void 0),O(this,"_candidates",void 0),O(this,"_iceParameters",void 0),O(this,"_dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname","o/i14u9pJrxRKAsu"),O(this,"firefoxSsrcMidMap",new Map),n=Vn(n);const{remoteIceParameters:r,remoteDtlsParameters:o,candidates:a,remoteRTPCapabilities:l,localCapabilities:d,direction:h,setup:p,videoCodec:m,audioCodec:g}=n;let v;this.setup=p,v=Ei.parse(h===Pr.RECEIVE_ONLY?"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n":"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=l,this._candidates=a,this._iceParameters=r,this._dtlsParameters=o,this._localCapabilities=d;const y=h===Pr.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,b=h===Pr.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,C=h===Pr.RECEIVE_ONLY?l.send.videoCodecs:xo(_e.VIDEO,y,b,m),N=h===Pr.RECEIVE_ONLY?l.send.audioCodecs:xo(_e.AUDIO,y,b,g);for(const R of v.mediaDescriptions)R.attributes.iceUfrag=r.iceUfrag,R.attributes.icePwd=r.icePwd,R.attributes.fingerprints=o.fingerprints,R.attributes.candidates=a,R.attributes.setup=this.setup,"application"===R.media.mediaType&&(R.attributes.sctpPort="5000"),"video"===R.media.mediaType&&(R.media.fmts=C.map(A=>A.payloadType.toString(10)),R.attributes.payloads=C,R.attributes.extmaps=y.videoExtensions),"audio"===R.media.mediaType&&(R.media.fmts=N.map(A=>A.payloadType.toString(10)),R.attributes.payloads=N,R.attributes.extmaps=y.audioExtensions,Ol(R));this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1}toString(){return Ei.print(this.sessionDesc)}hasMid(n){return Array.isArray(n)?n.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===n)}send(n,r,o,a,l){o=o.replace(/ /g,"-");const{ssrcs:d,ssrcGroups:h}=Rh(r,this.cname,V("SYNC_GROUP")?o:void 0),p=this.findPreloadMediaDesc(d);if(p){if(hn()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,p.attributes.mid),l&&(l.twcc||l.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(p,l),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(n,d,a);let g;return-1===m?(g=this.createOrRecycleSendMedia(n,d,h,"sendonly",a,l),this.updateBundleMids()):(g=Vn(this.sessionDesc.mediaDescriptions[m]),g.attributes.direction="sendonly",g.attributes.ssrcs=d,g.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(g,l)),hn()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,g.attributes.mid),{needExchangeSDP:!0,mid:g.attributes.mid}}}stopSending(n){const r=this.sessionDesc.mediaDescriptions.filter(o=>o.attributes.mid&&-1!==n.indexOf(o.attributes.mid));if(r.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(o=>{o.attributes.ssrcs=[]}),this.updateBundleMids()}receive(n,r,o){const a=[];return n.forEach(l=>{const h=this.findAvailableRecvMediaIndex(l._mediaStreamTrack.kind);let p,m=!1;-1===h?(m=!0,p=this.createOrRecycleRecvMedia(l,[],"recvonly",r,o),this.updateBundleMids()):(p=Vn(this.sessionDesc.mediaDescriptions[h]),p.attributes.direction="recvonly"),a.push({mid:p.attributes.mid,needCreateTransceiver:m})}),a}stopReceiving(n){const r=this.sessionDesc.mediaDescriptions.filter(o=>-1!==n.indexOf(o.attributes.mid));if(r.length!==n.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(o=>{o.media.port="0",o.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(n){const{foundation:r,protocol:o,address:a,port:l,type:d,relatedAddress:h,relatedPort:p,priority:m}=new RTCIceCandidate(n),g={foundation:r??"",componentId:"1",transport:o??"",priority:m?m+"":"",connectionAddress:a??"",port:l?l+"":"",type:d?d+"":"",relAddr:h??"",relPort:p?p+"":"",extension:{}};this.candidates.some(v=>v.priority===g.priority&&v.connectionAddress===g.connectionAddress&&v.port===g.port)||(this._candidates.push(g),this.sessionDesc.mediaDescriptions.forEach(v=>{v.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(n,r,o,a,l){const d=n._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,p=xo(d,h,this.localCapabilities.send,d===_e.AUDIO?l:a),m=d===_e.VIDEO?h.videoExtensions:h.audioExtensions,g="".concat(++this.currentMidIndex);let v={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};v=this.mungRecvMediaDsec(v,n);const y=this.findFirstClosedMedia(d);if(y){const b=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[b]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}muteRemote(n){const r=this.sessionDesc.mediaDescriptions.filter(o=>he(n).call(n,o.attributes.mid||""));if(r.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(o=>{o.attributes.direction="inactive"})}unmuteRemote(n){const r=this.sessionDesc.mediaDescriptions.filter(o=>he(n).call(n,o.attributes.mid||""));if(r.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(o=>{o.attributes.direction="recvonly"})}findAvailableMediaIndex(n,r,o){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const l=a.media.mediaType===n&&"0"!==a.media.port&&("sendonly"===a.attributes.direction||"sendrecv"===a.attributes.direction)&&0===a.attributes.ssrcs.length;if(hn()){if(l){const d=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(d||"0"!==a.attributes.mid&&"1"!==a.attributes.mid)||!(!d||d!==a.attributes.mid)}return!1}return l&&a.attributes.mid===o})}findAvailableRecvMediaIndex(n){return this.sessionDesc.mediaDescriptions.findIndex(r=>"0"!==r.attributes.mid&&"1"!==r.attributes.mid&&r.media.mediaType===n&&"0"!==r.media.port&&("recvonly"===r.attributes.direction||"sendrecv"===r.attributes.direction))}predictReceivingMids(n){const r=[];for(let o=0;o<n;o++)r.push((this.currentMidIndex+o+1).toString(10));return r}restartICE(n){n=Vn(n),this._iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=n.iceUfrag,r.attributes.icePwd=n.icePwd})}createOrRecycleSendMedia(n,r,o,a,l,d){const h=this.rtpCapabilities.send,p=n===_e.VIDEO?h.videoCodecs:h.audioCodecs,m=n===_e.VIDEO?h.videoExtensions:h.audioExtensions;hn()&&(l="".concat(++this.currentMidIndex));let g={media:{mediaType:n,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:o,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:l}};g=this.mungSendMediaDesc(g,d);const v=this.findFirstClosedMedia(n);if(v){const y=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[y]=g}else this.sessionDesc.mediaDescriptions.push(g);return g}mungRecvMediaDsec(n,r,o){const a=Vn(n);return KA(a),Hf(a,r),qA(a,r),av(a),qS(a,o,this.localCapabilities.send),a}mungSendMediaDesc(n,r){const o=Vn(n);return qS(o,r,this.localCapabilities.recv),Ol(o),o}updateRecvMedia(n,r){const o=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===n);if(-1!==o){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],r);this.sessionDesc.mediaDescriptions[o]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(n=>"0"!==n.media.port).map(n=>n.attributes.mid)}findPreloadMediaDesc(n){return this.sessionDesc.mediaDescriptions.find(r=>{var o;return(null===(o=r.attributes)||void 0===o||null===(o=o.ssrcs[0])||void 0===o?void 0:o.ssrcId)===n[0].ssrcId})}findFirstClosedMedia(n){return this.sessionDesc.mediaDescriptions.find(r=>hn()?"0"===r.media.port&&r.media.mediaType===n:"0"===r.media.port)}};const zW=["sdp"];var Xt;function R2(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function Oh(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?R2(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):R2(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}let A2=(Xt=class sT extends PR{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,o;return null!==(r=null===(o=this.peerConnection.getReceivers()[0])||void 0===o||null===(o=o.transport)||void 0===o?void 0:o.state)&&void 0!==r?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,o,a){super(r,o),O(this,"direction",void 0),O(this,"name",void 0),O(this,"store",void 0),O(this,"spec",void 0),O(this,"peerConnection",void 0),O(this,"initialOffer",void 0),O(this,"transport",void 0),O(this,"statsFilter",void 0),O(this,"localCandidateCount",0),O(this,"_isInRestartIce",!1),O(this,"mutex",void 0),O(this,"onLocalCandidate",void 0),O(this,"remoteSDP",void 0),O(this,"pendingCandidates",[]),O(this,"localCapabilities",void 0),O(this,"isReady",!1),O(this,"restartCnt",0),O(this,"curTurnServerIndex",0),this.store=o,this.spec=r,this.mutex=new Qi("P2PConnection-mutex",o.clientId),this.peerConnection=new RTCPeerConnection(sT.resolvePCConfiguration(r,o.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??Pr.SEND_ONLY,this.name=this.direction===Pr.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=tC(this.peerConnection,V("STATS_UPDATE_INTERVAL"),void 0,hn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}establish(r){var o=this;return L(function*(){try{const a=yield Tn();if(o.localCapabilities=ea(a),r){const{sdp:l}=r,d=function Q5(n,r){if(null==n)return{};var o,a,l=function(h,p){if(null==h)return{};var m,g,v={},y=sL(h);for(g=0;g<y.length;g++)m=y[g],v2(p).call(p,m)>=0||(v[m]=h[m]);return v}(n,r);if(dD){var d=dD(n);for(a=0;a<d.length;a++)o=d[a],v2(r).call(r,o)>=0||Object.prototype.propertyIsEnumerable.call(n,o)&&(l[o]=n[o])}return l}(r,zW),h=function(){const y={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},b=sv(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Lo(b,y,"videoExtensions",C,N,R),Lo(b,y,"videoCodecs",C,N,R),Lo(b,y,"audioExtensions",C,N,R),Lo(b,y,"audioCodecs",C,N,R),V("RAISE_H264_BASELINE_PRIORITY")){const A=R.videoCodecs.findIndex(D=>D.rtpMap&&"h264"===D.rtpMap.encodingName.toLocaleLowerCase()&&D.fmtp&&"42001f"===D.fmtp.parameters["profile-level-id"]);if(-1!==A){const D=R.videoCodecs.findIndex(M=>M.rtpMap&&"h264"===M.rtpMap.encodingName.toLocaleLowerCase());if(D<A){T.debug("raising H264 baseline profile priority");const M=R.videoCodecs[A];R.videoCodecs.splice(A,1),R.videoCodecs.splice(D,0,M)}-1!==D&&V("FILTER_SEND_H264_BASELINE")&&(C.videoCodecs=C.videoCodecs.filter(M=>!(M.rtpMap&&"h264"===M.rtpMap.encodingName.toLocaleLowerCase()&&M.fmtp&&"42001f"!==M.fmtp.parameters["profile-level-id"])))}}return{send:C,recv:N,sendrecv:R}}({},{},l);o.remoteSDP=new tH({remoteIceParameters:d.iceParameters,remoteDtlsParameters:d.dtlsParameters,candidates:[],remoteRTPCapabilities:h,localCapabilities:o.localCapabilities,direction:o.direction,setup:"actpass",videoCodec:o.store.codec,audioCodec:o.store.audioCodec}),yield o.setRemoteDescription({type:"offer",sdp:o.remoteSDP.toString()}),o.isReady=!0;const p=yield o.peerConnection.createAnswer();if(!p.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Bd(p.sdp);yield o.peerConnection.setLocalDescription(p);const g=yield Qx({},{},p.sdp);o.localCapabilities=ea(g);const v=o.peerConnection.getTransceivers()[0];return null!=v&&v.receiver&&v.receiver.transport&&o.tryBindTransportEvents(v.receiver.transport),Oh(Oh({},m),{},{sdp:p.sdp})}{o.peerConnection.addTransceiver("video",{direction:"sendonly"}),o.peerConnection.addTransceiver("audio",{direction:"sendonly"});const l=yield o.peerConnection.createOffer();if(!l.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const d=Bd(l.sdp);return o.initialOffer=l,Oh(Oh({},d),{},{sdp:l.sdp})}}catch(a){throw new Y(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}})()}connect(r){var o=this;return L(function*(){try{if(!o.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");yield o.peerConnection.setLocalDescription(o.initialOffer);const{sdp:a,iceParameters:l,dtlsParameters:d}=r,h=yield Qx({},{},a);o.remoteSDP=new tH({remoteIceParameters:l,remoteDtlsParameters:d,candidates:[],remoteRTPCapabilities:h,localCapabilities:o.localCapabilities,direction:o.direction,setup:"active",videoCodec:o.store.codec,audioCodec:o.store.audioCodec}),yield o.setRemoteDescription({type:"answer",sdp:o.remoteSDP.toString()});const p=o.peerConnection.getTransceivers()[0];null!=p&&p.sender&&p.sender.transport&&o.tryBindTransportEvents(p.sender.transport)}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(a.toString()))}})()}addRemoteCandidate(r){var o=this;return L(function*(){try{r&&o.pendingCandidates.push(r),o.peerConnection.remoteDescription&&o.isReady&&(o.pendingCandidates.forEach(a=>{o.peerConnection.addIceCandidate(a)}),o.pendingCandidates=[])}catch(a){throw new Y(k.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(a.toString()))}})()}send(r,o,a){var l=this;return ns(function*(){const d=yield tt(l.mutex.lock("From P2PConnection.send"));try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],p=l.remoteSDP.receive(r,o,a);r.forEach((A,D)=>{if(p[D].needCreateTransceiver){const M=l.peerConnection.addTransceiver(A._mediaStreamTrack,{direction:"sendonly"});h.push(M),A._updateRtpTransceiver(M)}else{const M=l.peerConnection.getTransceivers().find(x=>x.mid===p[D].mid);if(!M)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(p[D].mid));h.push(M),A._updateRtpTransceiver(M)}}),hn()&&!0===V("SIMULCAST")&&(yield tt(l.applySimulcastForFirefox(h,r)));const m=p.map(A=>A.mid),g=yield tt(l.peerConnection.createOffer()),v=l.mungSendOfferSDP(g.sdp,r,m),y=Ei.parse(v),b=m.map(A=>{const D=y.mediaDescriptions.find(M=>M.attributes.mid===A);if(!D)throw new Error("Cannot extract ssrc from mediaDescription.");return G5(D,V("USE_PUB_RTX"))}),C=h.map((A,D)=>({localSSRC:b[D],id:m[D]}));yield tt(l.peerConnection.setLocalDescription({type:"offer",sdp:v}));try{yield C}catch(A){const D=l.remoteSDP.toString();throw yield tt(l.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield tt(l.peerConnection.setRemoteDescription({type:"answer",sdp:D})),yield tt(l.stopSending(m,!0)),A}yield tt(l.applySimulcastEncodings(h,r)),yield tt(l.applySendEncodings(h,r));const N=l.remoteSDP.toString(),R=l.logSDPExchange(v,"offer","local","send");return R?.(N),yield tt(l.setRemoteDescription({type:"answer",sdp:N})),h.map((A,D)=>({localSSRC:b[D],id:m[D]}))}catch(h){throw h instanceof Y?h:new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}stopSending(r,o){var a=this;return L(function*(){const l=o?void 0:yield a.mutex.lock("From P2PConnection.stopSending");try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const d=a.peerConnection.getTransceivers().filter(g=>-1!==r.indexOf(g.mid));if(d.length!==r.length)throw new Error("Transceivers' length (".concat(d.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));d.map(g=>{var v;g.direction="inactive",null===(v=g.stop)||void 0===v||v.call(g)});const h=yield a.peerConnection.createOffer(),p=a.logSDPExchange(h.sdp||"","offer","local","stopSending");yield a.peerConnection.setLocalDescription(h),a.remoteSDP.stopReceiving(r);const m=a.remoteSDP.toString();p?.(m),yield a.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{l&&l()}})()}receive(r,o,a,l){var d=this;return L(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=d.remoteSDP.send(r,o,a,l);if(p){const g=d.remoteSDP.toString(),v=d.logSDPExchange(g,"offer","remote","receive");yield d.setRemoteDescription({type:"offer",sdp:g});const y=yield d.peerConnection.createAnswer(),b=d.mungReceiveAnswerSDP(y.sdp,h,r);v?.(b||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:b}),T.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else T.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=d.peerConnection.getTransceivers().find(g=>g.mid===h);if(!m||null===m.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(h){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}mockReceive(r,o,a,l){var d=this;return L(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=d.remoteSDP.send(r,o,a,l);if(p){const m=d.remoteSDP.toString(),g=d.logSDPExchange(m,"offer","remote","receive");yield d.setRemoteDescription({type:"offer",sdp:m});const v=yield d.peerConnection.createAnswer(),y=d.mungReceiveAnswerSDP(v.sdp,h,r);g?.(y||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:y}),T.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else T.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(h){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}stopReceiving(r){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");o.remoteSDP.stopSending(r);const a=o.remoteSDP.toString(),l=o.logSDPExchange(a,"offer","remote","stopReceiving");yield o.setRemoteDescription({type:"offer",sdp:a});const d=yield o.peerConnection.createAnswer();l?.(d.sdp||""),yield o.peerConnection.setLocalDescription(d)}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}restartICE(r){var o=this;return L(function*(){try{if(o.store.p2pTransport===Na.Auto&&(o.store.p2pTransport=Na.SdRtn,ct().supportPCSetConfiguration&&o.peerConnection.setConfiguration(sT.resolvePCConfiguration(o.spec,o.store.p2pTransport))),o.restartCnt>3&&(o.restartCnt=0,ct().supportPCSetConfiguration&&o.peerConnection.setConfiguration(sT.resolvePCConfiguration(o.spec,o.store.p2pTransport,++o.curTurnServerIndex))),!r){o.restartCnt++,o.isReady=!1;const a=yield o.peerConnection.createOffer({iceRestart:!0});if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:l}=Bd(a.sdp);return o.store.descriptionStart(),o.direction===Pr.SEND_ONLY&&(yield o.peerConnection.setLocalDescription(a)),l}if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(o.remoteSDP.restartICE(r),o.store.descriptionStart(),o.direction===Pr.RECEIVE_ONLY){o.restartCnt++,yield o.setRemoteDescription({type:"offer",sdp:o.remoteSDP.toString()});const a=yield o.peerConnection.createAnswer();if(!a.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:l}=Bd(a.sdp);return yield o.peerConnection.setLocalDescription(a),l}yield o.setRemoteDescription({type:"answer",sdp:o.remoteSDP.toString()}),o.isReady=!0}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(r=this.onConnectionStateChange)||void 0===r||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}updateEncoderConfig(r,o){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const l=yield a.peerConnection.createOffer(),d=a.mungSendOfferSDP(l.sdp,[o],[r]);a.remoteSDP.updateRecvMedia(r,o);const h=a.remoteSDP.toString(),p=a.logSDPExchange(d,"offer","local","updateEncoderConfig");yield a.peerConnection.setLocalDescription({type:"offer",sdp:d}),p?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(l){throw new Y(k.EXCHANGE_SDP_FAILED,l.toString())}})()}updateSendParameters(r,o){var a=this;return L(function*(){const l=a.peerConnection.getTransceivers().filter(d=>d.mid===r);1===l.length&&(a.isVP8Simulcast(o)?hn()||(yield a.applySimulcastEncodings(l,[o])):yield a.applySendEncodings(l,[o]))})()}setStatsRemoteVideoIsReady(r,o){this.statsFilter.setVideoIsReady2(r,o)}replaceTrack(r,o){var a=this;return L(function*(){const l=a.peerConnection.getTransceivers().find(d=>d.mid===o);l&&(yield l.sender.replaceTrack(r._mediaStreamTrack))})()}getSelectedCandidatePair(){var r=this;return L(function*(){const o=r.peerConnection.getReceivers();if(o.length>0&&o[0].transport&&o[0].transport.iceTransport&&o[0].transport.iceTransport.getSelectedCandidatePair&&o[0].transport.iceTransport.getSelectedCandidatePair()){const a=o[0].transport.iceTransport,{local:l,remote:d}=a.getSelectedCandidatePair();return{local:Oh(Oh({},Rc),{},{candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port}),remote:Oh(Oh({},Rc),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return r.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,o;he(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),null===(o=this.onICEConnectionStateChange)||void 0===o||o.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;"connected"===this.peerConnection.connectionState&&(this.restartCnt=0),null===(r=this.onConnectionStateChange)||void 0===r||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{var o;r.candidate?(r.candidate.candidate&&(null===(o=this.onLocalCandidate)||void 0===o||o.call(this,r.candidate.toJSON())),this.localCandidateCount+=1):T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,o){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const l={iceServers:[]};var d;return r.iceServers?l.iceServers=r.iceServers:r.turnServer&&"off"!==r.turnServer.mode&&(nS(r.turnServer.servers)?l.iceServers=r.turnServer.servers:(l.iceServers&&l.iceServers.push(...sT.turnServerConfigToIceServers(r.turnServer.servers,o,a)),V("USE_TURN_SERVER_OF_GATEWAY")&&l.iceServers&&r.turnServer.serversFromGateway&&l.iceServers.push(...sT.turnServerConfigToIceServers(r.turnServer.serversFromGateway,o,a)),he(d=[Na.Relay,Na.SdRtn]).call(d,o)&&(l.iceTransportPolicy="relay"),V("FORCE_TURN_TCP")?l.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(l.iceTransportPolicy="relay")}))),V("ENABLE_ENCODED_TRANSFORM")&&ct().supportWebRTCEncodedTransform&&(l.encodedInsertableStreams=!0),T.debug("P2PConnection p2pTransport is ".concat(o)),l}static turnServerConfigToIceServers(r,o){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const l=[],d=r.filter(p=>p.tcpport);T.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(a));const h=d.length>a?d[a]:d[0];switch(o){case Na.SdRtn:const p=r.filter(g=>{var v;return he(v=g.username).call(v,"glb:")&&g.turnServerURL==g.turnServerURL}),m=p.length>a?p[a]:p[0];m&&(l.push({username:m.username,credential:m.password,credentialType:"password",urls:"turn:".concat(mh(m.turnServerURL),":").concat(m.tcpport,"?transport=udp")}),l.push({username:m.username,credential:m.password,credentialType:"password",urls:"turns:".concat(mh(m.turnServerURL),":").concat(m.tcpport,"?transport=tcp")}));break;case Na.Relay:h&&(l.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),l.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(mh(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(l.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),l.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(mh(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),l.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return l}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var a;null!=r&&r.state&&(null===(a=this.onDTLSTransportStateChange)||void 0===a||a.call(this,r.state))},r.onerror=a=>{var l;null===(l=this.onDTLSTransportError)||void 0===l||l.call(this,"error"in a?a.error:a)};const o=r.iceTransport;o&&(o.onstatechange=()=>{const a=r?.iceTransport.state;var l;a&&(null===(l=this.onICETransportStateChange)||void 0===l||l.call(this,a))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:a,remote:l}=o.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol}),", remote ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(r,o){var a=this;return L(function*(){var l;if(o||(o=a.peerConnection.getSenders().find(y=>y.track===r._mediaStreamTrack)),!o)return T.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(a.isVP8Simulcast(r))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ct().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(r._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(r._encoderConfig){var p;const{bitrateMax:y,frameRate:b,scaleResolutionDownBy:C}=r._encoderConfig;y&&(h.maxBitrate=1e3*y),he(p=r._hints).call(p,zt.LOW_STREAM)&&(b&&(h.maxFramerate=Mr(b)),C&&C>=1&&(h.scaleResolutionDownBy=C))}if(V("DSCP_TYPE")&&hl()){var m;const y=V("DSCP_TYPE");he(m=["very-low","low","medium","high"]).call(m,y)&&(h.networkPriority=y)}const g=o.getParameters(),v=null===(l=g.encodings)||void 0===l?void 0:l[0];hn()&&!v&&(d.encodings=[h]),v&&Object.assign(v,h),Object.assign(g,d),T.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),yield o.setParameters(g)})()}applySendEncodings(r,o){var a=this;return L(function*(){try{if(!ct().supportSetRtpSenderParameters||r.length!==o.length)return;for(let l=0;l<r.length;l++){const d=r[l],h=o[l];h instanceof Ve&&!a.isVP8Simulcast(h)&&(yield a.updateRtpSenderEncodings(h,d.sender))}}catch{T.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(r,o,a){const l=Ei.parse(r);return o.forEach((d,h)=>{const p=a[h],m=l.mediaDescriptions.find(g=>g.attributes.mid===p);m&&(Hf(m,d),wc(m,d,this.store.codec))}),Ei.print(l)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var o;null===(o=this.onFirstAudioReceived)||void 0===o||o.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var o;null===(o=this.onFirstVideoReceived)||void 0===o||o.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var o;null===(o=this.onFirstAudioDecoded)||void 0===o||o.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,o,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,r,o,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,o)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,r,o)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,o)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,r,o)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var o;null===(o=this.onFirstVideoDecodedTimeout)||void 0===o||o.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(r,o){var a=this;return L(function*(){if(r.length===o.length)for(let g=0;g<r.length;g++){var l,d,h,p,m;const v=r[g],y=o[g];if(y instanceof Ve&&!he(l=y._hints).call(l,zt.LOW_STREAM)&&null!==(d=y._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=y._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=y._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=y._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===a.store.codec){const b={},C={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:C.high}];const N=v.sender.getParameters();yield v.sender.setParameters(Object.assign(N,b))}}})()}applySimulcastEncodings(r,o){var a=this;return L(function*(){if(!hn()&&r.length===o.length)for(let l=0;l<r.length;l++){const d=o[l];if(d instanceof Ve&&a.isVP8Simulcast(d)){const h=r[l],p={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=h.sender.getParameters();yield h.sender.setParameters(Object.assign(g,p))}}})()}isVP8Simulcast(r){var o,a,l,d,h;return!!(r instanceof Ve&&V("SIMULCAST")&&"vp8"===this.store.codec&&!he(o=r._hints).call(o,zt.LOW_STREAM)&&null!==(a=r._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(l=r._encoderConfig)||void 0===l?void 0:l.bitrateMax)>200&&null!==(d=r._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=r._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,o,a,l){if(V("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(o," SDP during P2PConnection.").concat(l,"\n"),r),"offer"===o?d=>{this.logSDPExchange(d,"answer","local"===a?"remote":"local",l)}:void 0}muteLocal(r){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=o.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==r.indexOf(p.mid));if(a.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(p=>{p.direction="inactive"});const l=yield o.peerConnection.createOffer(),d=o.logSDPExchange(l.sdp||"","offer","local","muteLocal");yield o.peerConnection.setLocalDescription(l),o.remoteSDP.muteRemote(r);const h=o.remoteSDP.toString();d?.(h),yield o.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(r){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=o.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==r.indexOf(p.mid));if(a.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(function(){var p=L(function*(m){m.direction="sendonly"});return function(m){return p.apply(this,arguments)}}());const l=yield o.peerConnection.createOffer(),d=o.logSDPExchange(l.sdp||"","offer","local","unmuteLocal");yield o.peerConnection.setLocalDescription(l),o.remoteSDP.unmuteRemote(r);const h=o.remoteSDP.toString();d?.(h),yield o.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}getRemoteSSRC(r,o){var a=this;return L(function*(){var l,d;if(o=null!==(l=o)&&void 0!==l?l:null===(d=a.currentRemoteDescription)||void 0===d?void 0:d.sdp){var h;const p=null===(h=Ei.parse(o).mediaDescriptions.find(m=>m.attributes.mid===r))||void 0===h?void 0:h.attributes.ssrcs;return p?.[0].ssrcId}})()}setRemoteDescription(r){var o=this;return L(function*(){var a;yield o.peerConnection.setRemoteDescription(r),he(a=["connected","completed"]).call(a,o.peerConnection.iceConnectionState)||(o.isReady=!0,o.addRemoteCandidate())})()}mungReceiveAnswerSDP(r,o,a){const l=Ei.parse(r),d=l.mediaDescriptions.find(h=>h.attributes.mid===o);return d&&a===_e.AUDIO&&"audio"===d.media.mediaType&&Ol(d),Ei.print(l)}},pe(Xt.prototype,"establish",[Fo],Object.getOwnPropertyDescriptor(Xt.prototype,"establish"),Xt.prototype),pe(Xt.prototype,"connect",[Fo],Object.getOwnPropertyDescriptor(Xt.prototype,"connect"),Xt.prototype),pe(Xt.prototype,"receive",[Fo],Object.getOwnPropertyDescriptor(Xt.prototype,"receive"),Xt.prototype),pe(Xt.prototype,"mockReceive",[Fo],Object.getOwnPropertyDescriptor(Xt.prototype,"mockReceive"),Xt.prototype),pe(Xt.prototype,"stopReceiving",[Fo],Object.getOwnPropertyDescriptor(Xt.prototype,"stopReceiving"),Xt.prototype),pe(Xt.prototype,"restartICE",[Fo],Object.getOwnPropertyDescriptor(Xt.prototype,"restartICE"),Xt.prototype),pe(Xt.prototype,"close",[Fo],Object.getOwnPropertyDescriptor(Xt.prototype,"close"),Xt.prototype),pe(Xt.prototype,"updateEncoderConfig",[Fo],Object.getOwnPropertyDescriptor(Xt.prototype,"updateEncoderConfig"),Xt.prototype),pe(Xt.prototype,"updateSendParameters",[Fo],Object.getOwnPropertyDescriptor(Xt.prototype,"updateSendParameters"),Xt.prototype),pe(Xt.prototype,"replaceTrack",[Fo],Object.getOwnPropertyDescriptor(Xt.prototype,"replaceTrack"),Xt.prototype),pe(Xt.prototype,"muteLocal",[Fo],Object.getOwnPropertyDescriptor(Xt.prototype,"muteLocal"),Xt.prototype),pe(Xt.prototype,"unmuteLocal",[Fo],Object.getOwnPropertyDescriptor(Xt.prototype,"unmuteLocal"),Xt.prototype),Xt);function Fo(n,r,o){const a=n[r];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return o.value=L(function*(){const l=this.mutex,d=yield l.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{d()}}),o}function D2(n,r){let o=document.createElement("video"),a=document.createElement("canvas");o.setAttribute("style","display:none"),a.setAttribute("style","display:none"),o.setAttribute("muted",""),o.muted=!0,o.setAttribute("autoplay",""),o.autoplay=!0,o.setAttribute("playsinline",""),a.width=Mr(r.width),a.height=Mr(r.height);const l=Mr(r.framerate||15);document.body.append(o),document.body.append(a);let d=n._mediaStreamTrack;o.srcObject=new MediaStream([d]),o.play();const h=a.getContext("2d");if(!h)throw new z(k.UNEXPECTED_ERROR,"can not get canvas context");const p=ct(),m=a.captureStream(p.supportRequestFrame?0:l).getVideoTracks()[0];m.canvas||(m.canvas=a),a.startCapture=()=>{if(!o)return a.stopCapture&&a.stopCapture();if(o.paused&&o.play(),o.videoHeight>2&&o.videoWidth>2){const b=a.width*(o.videoHeight/o.videoWidth);Math.abs(b-a.height)>=2&&(T.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(b)),a.height=b)}h.drawImage(o,0,0,a.width,a.height),m.requestFrame&&m.requestFrame(),d!==n._mediaStreamTrack&&(d=n._mediaStreamTrack,o.srcObject=new MediaStream([d]))},a.stopCapture=dx(()=>a.startCapture&&a.startCapture(),l);const g=m.stop;return m.stop=()=>{g.call(m),o&&(o.remove(),o.srcObject=null,o=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),T.debug("clean low stream renderer")},m}var Nh=function(n){return n[n.HEIGHT=2033]="HEIGHT",n[n.FRAME_RATE=2034]="FRAME_RATE",n[n.WIDTH=2035]="WIDTH",n}(Nh||{}),Xn=function(n){return n[n.FRAME_RATE=2002]="FRAME_RATE",n[n.WIDTH=2003]="WIDTH",n[n.HEIGHT=2004]="HEIGHT",n[n.PACKAGE_LOST=2005]="PACKAGE_LOST",n[n.AVG_ENCODE=2007]="AVG_ENCODE",n[n.NACKS=2009]="NACKS",n[n.PLIS=2010]="PLIS",n[n.FIRS=2011]="FIRS",n[n.BITRATE=2012]="BITRATE",n[n.PACKAGE_RATE=2031]="PACKAGE_RATE",n[n.ADAPTATION=2032]="ADAPTATION",n[n.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",n[n.BANDWIDTH=2061]="BANDWIDTH",n[n.RETRANSMIT=2062]="RETRANSMIT",n[n.TARGET_ENCODED=2064]="TARGET_ENCODED",n[n.TRANSMIT=2066]="TRANSMIT",n[n.FREEZE=2082]="FREEZE",n[n.DISABLED=2095]="DISABLED",n[n.PLAYER_STATUS=2128]="PLAYER_STATUS",n[n.QP_SUM=2143]="QP_SUM",n[n.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",n[n.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",n[n.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",n[n.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",n}(Xn||{}),Hd=function(n){return n[n.BITRATE=2069]="BITRATE",n[n.PACKAGE_LOST=2070]="PACKAGE_LOST",n[n.PACKAGE_RATE=2071]="PACKAGE_RATE",n[n.HEIGHT=2073]="HEIGHT",n[n.FRAME_RATE=2075]="FRAME_RATE",n[n.WIDTH=2077]="WIDTH",n}(Hd||{}),zn=function(n){return n[n.JITTER=-1]="JITTER",n[n.PACKAGE_LOST=2014]="PACKAGE_LOST",n[n.WIDTH=2018]="WIDTH",n[n.HEIGHT=2019]="HEIGHT",n[n.FRAME_RATE=2020]="FRAME_RATE",n[n.JITTER_BUFFER=2023]="JITTER_BUFFER",n[n.CURRENT_DELAY=2024]="CURRENT_DELAY",n[n.NACKS=2026]="NACKS",n[n.PLIS=2027]="PLIS",n[n.FIRS=2028]="FIRS",n[n.BITRATE=2029]="BITRATE",n[n.PACKAGE_RATE=2078]="PACKAGE_RATE",n[n.FREEZE=2084]="FREEZE",n[n.DISABLED=2101]="DISABLED",n[n.PLAYER_STATUS=2129]="PLAYER_STATUS",n[n.QP_SUM=2144]="QP_SUM",n[n.I_FRAME_DELAY=2149]="I_FRAME_DELAY",n[n.FRAMES_DROPPED=2181]="FRAMES_DROPPED",n[n.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",n[n.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",n[n.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",n[n.AVG_DECODE=2200]="AVG_DECODE",n[n.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",n[n.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",n[n.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",n[n.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",n}(zn||{}),Ph=function(n){return n[n.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",n[n.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",n[n.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",n[n.FREEZE_TIME=2109]="FREEZE_TIME",n[n.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",n[n.FREEZE_DURATION=2156]="FREEZE_DURATION",n}(Ph||{}),zf=function(n){return n[n.PCM_LEVEL=2104]="PCM_LEVEL",n}(zf||{}),ia=function(n){return n[n.PACKAGE_LOST=-1]="PACKAGE_LOST",n[n.LEVEL=2038]="LEVEL",n[n.BITRATE=2039]="BITRATE",n[n.PACKAGE_RATE=2040]="PACKAGE_RATE",n[n.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",n[n.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",n[n.FREEZE=2081]="FREEZE",n[n.DISABLED=2096]="DISABLED",n[n.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",n[n.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",n}(ia||{}),Uo=function(n){return n[n.BITRATE=2044]="BITRATE",n[n.PACKAGE_LOST=2045]="PACKAGE_LOST",n[n.PACKAGE_RATE=2046]="PACKAGE_RATE",n[n.CURRENT_DELAY=2047]="CURRENT_DELAY",n[n.JITTER_BUFFER=2054]="JITTER_BUFFER",n[n.JITTER=2055]="JITTER",n[n.FREEZE=2083]="FREEZE",n[n.DISABLED=2102]="DISABLED",n[n.PCM_LEVEL=2105]="PCM_LEVEL",n[n.PLAYER_STATUS=2130]="PLAYER_STATUS",n[n.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",n[n.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",n[n.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",n[n.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",n[n.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",n}(Uo||{}),O2=function(n){return n[n.FREEZE_TIME=-1]="FREEZE_TIME",n[n.LEVEL=2043]="LEVEL",n}(O2||{}),Vo=function(n){return n[n.RTT=2006]="RTT",n[n.CONN_TYPE=801]="CONN_TYPE",n[n.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",n}(Vo||{});const Gd=1e3;function Ne(n,r,o){null!=o&&Number.isFinite(o)&&(n[r]=Math.round(Math.max(0,o)))}function N2(n){const r={[Vo.CONN_TYPE]:0,[Vo.RTT]:n.rtt,[Vo.STATS_UPDATE_INTERVAL]:n.updateInterval?Math.round(Math.max(0,n.updateInterval)):void 0};switch(n.selectedCandidatePair.localCandidate.candidateType){case"relay":{const o=n.selectedCandidatePair.localCandidate.relayProtocol;"udp"===o&&(r[Vo.CONN_TYPE]=1),"tcp"===o&&(r[Vo.CONN_TYPE]=3),"tls"===o&&(r[Vo.CONN_TYPE]=4);break}case"srflx":r[Vo.CONN_TYPE]=2}return r}function P2(n){let r=0;switch(n){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class nH extends nn{constructor(r){super(),O(this,"store",void 0),O(this,"uploadWRTCStatsTimer",void 0),O(this,"uploadOutboundDenoiserStatsTimer",void 0),O(this,"uploadExtStatsTimer",void 0),O(this,"uploadExtUsageStatsTimer",void 0),O(this,"uploadInboundExtStatsTimer",void 0),O(this,"requestStats",void 0),O(this,"requestTransportStats",void 0),O(this,"requestLocalMedia",void 0),O(this,"requestRemoteMedia",void 0),O(this,"requestAllTracks",void 0),O(this,"requestVideoIsReady",void 0),O(this,"requestUploadStats",void 0),O(this,"requestUpload",void 0),O(this,"uploadOutboundStarted",!1),O(this,"uploadInboundStarted",!1),O(this,"uploadTransportStarted",!1),O(this,"uploadExtensionUsageStarted",!1),O(this,"lastRecvStats",void 0),O(this,"lastSendStats",void 0),O(this,"lastFullRecvStats",void 0),O(this,"lastFullSendStats",void 0),O(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;let o,a;if(this.uploadTransportStarted&&(o=this.requestStats(),this.store.useP2P&&(a=this.requestStats(!0))),!o&&this.uploadOutboundStarted&&(o=this.requestStats()),!a&&this.uploadInboundStarted&&(a=this.requestStats(!0)),o||a){const l={};if(this.uploadTransportStarted&&o){const d=this.getTransportStats(o,a,r);d&&(l.misc=[d])}if(this.uploadOutboundStarted&&o){const d=this.getOutboundStats(o,r?this.lastSendStats:this.lastFullSendStats,r);d&&(l.outbound=[d])}if(this.uploadInboundStarted&&a){const d=this.getInboundStats(a,r?this.lastRecvStats:this.lastFullRecvStats,r);d&&(l.inbound=d)}this.requestUploadStats(l)}this.lastRecvStats=a,this.lastSendStats=o,r||(this.lastFullRecvStats=a,this.lastFullSendStats=o)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(3!==r),4==++r&&(r=1)},Gd)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,o,a){if(!this.requestStats)return;if(a)return null==r.rtt?void 0:{addition:{[Vo.RTT]:r.rtt,[Vo.CONN_TYPE]:void 0,[Vo.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const l=N2(r);if(this.store.useP2P){if(o){const d=N2(o);l[Vo.CONN_TYPE]+=d[Vo.CONN_TYPE]<<3}l[Vo.CONN_TYPE]+=110}else l[Vo.CONN_TYPE]+=100;return{addition:l}}getOutboundStats(r,o,a){if(!this.requestUploadStats||!this.requestLocalMedia)return;const l=this.requestLocalMedia();if(!l||0===l.length)return;let d,h,p;return l.forEach(m=>{let[g,{track:v,ssrcs:y}]=m;switch(g){case Q.LocalVideoLowTrack:case Q.LocalVideoTrack:if(g===Q.LocalVideoTrack){const b=function(R,A,D,M,x){const j=A.videoSend.find(Ce=>Ce.ssrc===R);if(!j)return;const W={},{sentFrame:q,inputFrame:ee}=j;if(ee&&q&&(W[Xn.FREEZE]=function(ut,Nt){let _n=!0;return _n=!(ut<=5)&&(ut<=10?Nt<3:ut<=20?Nt<4:Nt<5),_n}(ee.frameRate,q.frameRate)?1:0),Ne(W,Xn.QP_SUM,j.qpSumPerFrame),x)return W;switch(q&&(Ne(W,Xn.HEIGHT,q.height),Ne(W,Xn.WIDTH,q.width),Ne(W,Xn.FRAME_RATE,q.frameRate)),W[Xn.DISABLED]=M._originMediaStreamTrack&&!M._originMediaStreamTrack.enabled||M._mediaStreamTrack&&!M._mediaStreamTrack.enabled?1:0,j.adaptionChangeReason){case"none":W[Xn.ADAPTATION]=0;break;case"cpu":W[Xn.ADAPTATION]=1;break;case"bandwidth":W[Xn.ADAPTATION]=2;break;case"other":W[Xn.ADAPTATION]=3}let J=0;j.adaptionChangeReason&&(J+=P2(j.adaptionChangeReason)),A.qualityLimitationReason&&(J+=P2(A.qualityLimitationReason)<<3),W[Xn.ADAPTATION]=J,W[Xn.PLAYER_STATUS]=ax[M._player?M._player.videoElementStatus:"uninit"],Ne(W,Xn.NACKS,j.nacksCount),Ne(W,Xn.PLIS,j.plisCount),Ne(W,Xn.FIRS,j.firsCount),Ne(W,Xn.AVG_ENCODE,j.avgEncodeMs),Ne(W,Xn.HUGE_FRAME_SENT,j.hugeFramesSent),Ne(W,Xn.BYTES_RETRANSMIT,j.retransmittedBytesSent),Ne(W,Xn.PACKAGES_RETRANSMIT,j.retransmittedPacketsSent),Ne(W,Xn.KEY_FRAMES_ENCODED,j.keyFramesEncoded);const X=D&&D.videoSend.find(Ce=>Ce.ssrc===R);if(X){let Ce=x?Gd:3e3;X.timestamp&&j.timestamp&&(Ce=j.timestamp-X.timestamp),null!=X.packets&&null!=j.packets&&Ne(W,Xn.PACKAGE_RATE,1e3*(j.packets-X.packets)/Ce),null!=j.packetsLost&&null!=X.packetsLost&&Ne(W,Xn.PACKAGE_LOST,j.packetsLost-X.packetsLost),null!=X.bytes&&null!=j.bytes&&Ne(W,Xn.BITRATE,8*(j.bytes-X.bytes)/Ce)}return W}(y[0].ssrcId,r,o,v,a),C=a?null:function(R,A,D){const M=A.videoSend.find(J=>J.ssrc===R);if(!M)return null;const x={},j=M.inputFrame,q=j&&j.width||D&&D.videoWidth||0,ee=j&&j.frameRate||0;return Ne(x,Nh.HEIGHT,j&&j.height||D&&D.videoHeight||0),Ne(x,Nh.WIDTH,q),Ne(x,Nh.FRAME_RATE,ee),x}(y[0].ssrcId,r,v),N=a?null:function(R){const A={};return Ne(A,Xn.RETRANSMIT,R.bitrate.retransmit),Ne(A,Xn.TARGET_ENCODED,R.bitrate.targetEncoded),Ne(A,Xn.ACTUAL_ENCODED,R.bitrate.actualEncoded),Ne(A,Xn.TRANSMIT,R.bitrate.transmit),Ne(A,Xn.BANDWIDTH,R.sendBandwidth),A}(r);h=Object.assign({},b,C,N)}else p=a?void 0:function(b,C,N){const R=C.videoSend.find(M=>M.ssrc===b);if(!R)return;const A={},D=R.sentFrame;if(D&&(Ne(A,Hd.HEIGHT,D.height),Ne(A,Hd.WIDTH,D.width),Ne(A,Hd.FRAME_RATE,D.frameRate)),N){const M=N.videoSend.find(x=>x.ssrc===b);if(M){let x=3e3;M.timestamp&&R.timestamp&&(x=R.timestamp-M.timestamp),null!=M.packets&&null!=R.packets&&Ne(A,Hd.PACKAGE_RATE,1e3*(R.packets-M.packets)/x),null!=R.packetsLost&&null!=M.packetsLost&&Ne(A,Hd.PACKAGE_LOST,R.packetsLost-M.packetsLost),null!=M.bytes&&null!=R.bytes&&Ne(A,Hd.BITRATE,8*(R.bytes-M.bytes)/x)}}return A}(y[0].ssrcId,r,o);break;case Q.LocalAudioTrack:d=a?void 0:function(b,C,N,R){const A=C.audioSend.find(W=>W.ssrc===b);if(!A)return;const D={};D[ia.DISABLED]=R._originMediaStreamTrack&&!R._originMediaStreamTrack.enabled||R._mediaStreamTrack&&!R._mediaStreamTrack.enabled?1:0;const M=100*R._source.getAccurateVolumeLevel(),x=A.inputLevel;if(null!=x){const W=Math.ceil(50*Math.log10(100*x+1));Ne(D,ia.LEVEL,W)}else Ne(D,ia.LEVEL,M);Ne(D,zf.PCM_LEVEL,M),Ne(D,ia.AEC_RETURN_LOSS,A.aecReturnLoss),Ne(D,ia.AEC_RETURN_LOSS_ENH,A.aecReturnLossEnhancement),Ne(D,ia.BYTES_RETRANSMIT,A.retransmittedBytesSent),Ne(D,ia.PACKAGES_RETRANSMIT,A.retransmittedPacketsSent),D[ia.FREEZE]=0;const j=N&&N.audioSend.find(W=>W.ssrc===b);if(j){let W=3e3;j.timestamp&&A.timestamp&&(W=A.timestamp-j.timestamp),null!=j.bytes&&null!=A.bytes&&Ne(D,ia.BITRATE,8*(A.bytes-j.bytes)/W),null!=j.packets&&null!=A.packets&&Ne(D,ia.PACKAGE_RATE,1e3*(A.packets-j.packets)/W)}return D}(y[0].ssrcId,r,o,v)}}),{high:h,low:p,audio:d}}getInboundStats(r,o,a){if(!this.requestRemoteMedia)return;const l=this.requestRemoteMedia()||[],d=[];return l.forEach(h=>{let[p,m]=h;const g={peer:p.uid};if(m.has(_e.VIDEO)&&p.videoTrack){const v=p._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(p._videoSSRC)||!1,y=p.videoTrack?function(b,C,N,R,A,D,M){var x;const j=C.videoRecv.find(Re=>Re.ssrc===b);if(!j)return;const W={},{receivedFrame:q,outputFrame:ee,decodeFrameRate:J}=j,X=N&&N.videoRecv.find(Re=>Re.ssrc===b);if(W[zn.FREEZE]=A&&nC.isRemoteVideoFreeze(R,j,X)?1:0,Ne(W,Ph.FRAME_RATE_DECODE,J),Ne(W,zn.QP_SUM,j.qpSumPerFrame),j.framesRateFirefox&&Ne(W,zn.FRAME_RATE,j.framesRateFirefox),q&&Ne(W,zn.FRAME_RATE,q.frameRate),Ne(W,zn.FRAMES_DROPPED,j.framesDroppedCount),Ne(W,zn.BYTES_RETRANSMIT,j.retransmittedBytesReceived),Ne(W,zn.PACKAGES_RETRANSMIT,j.retransmittedPacketsReceived),Ne(W,zn.PACKAGES_DISCARDED,j.packetsDiscarded),Ne(W,zn.AVG_DECODE,j.avgDecodeMs),Ne(W,zn.AVG_PROCESSING_DELAY,j.avgProcessingDelayMs),Ne(W,zn.AVG_ASSEMBLY_TIME,j.avgFramesAssembledFromMultiplePacketsMs),Ne(W,zn.AVG_INTER_FRAME_DELAY,j.avgInterFrameDelayMs),Ne(W,zn.KEY_FRAMES_DECODED,j.keyFramesDecoded),X){const Re=C.timestamp-N.timestamp||(M?Gd:3e3);null!=j.packetsLost&&null!=X.packetsLost&&Ne(W,zn.PACKAGE_LOST,j.packetsLost-X.packetsLost),null!=X.bytes&&null!=j.bytes&&Ne(W,zn.BITRATE,8*(j.bytes-X.bytes)/Re),null!=X.packets&&null!=j.packets&&Ne(W,zn.PACKAGE_RATE,1e3*(j.packets-X.packets)/Re)}if(M)return W;q?(Ne(W,zn.HEIGHT,q.height),Ne(W,zn.WIDTH,q.width)):R&&(Ne(W,zn.HEIGHT,R._videoHeight||0),Ne(W,zn.WIDTH,R._videoWidth||0)),ee&&Ne(W,Ph.FRAME_RATE_OUTPUT,ee.frameRate);const Ce=null===(x=R._player)||void 0===x?void 0:x.rendFrameRate.toFixed(0);if(Ce&&Ne(W,Ph.FRAME_RATE_RENDER,+Ce),Ne(W,zn.JITTER_BUFFER,j.jitterBufferMs),Ne(W,zn.CURRENT_DELAY,j.currentDelayMs),Ne(W,zn.FIRS,j.firsCount),Ne(W,zn.NACKS,j.nacksCount),Ne(W,zn.PLIS,j.plisCount),R){W[zn.DISABLED]=R._originMediaStreamTrack.enabled&&R._mediaStreamTrack.enabled?0:1;const Re=R._player;if(Re){const{freezeTimeCounterList:ut,renderFreezeAccTime:Nt,videoElementStatus:_n}=Re;if(ut&&ut.length>0&&Ne(W,Ph.FREEZE_TIME,ut.splice(0,1)[0]),D&&"visible"===ls.visibility&&_n===Ki.PLAYING&&ct().supportRequestVideoFrameCallback){const Zt=Math.min(6e3,Nt);Re.renderFreezeAccTime=Math.max(0,Nt-Zt),Ne(W,Ph.FREEZE_TIME_RENDER,Zt)}"number"==typeof j.totalFreezesDuration&&Ne(W,Ph.FREEZE_DURATION,1e3*(X&&X.totalFreezesDuration?j.totalFreezesDuration-X.totalFreezesDuration:j.totalFreezesDuration))}}if(W[zn.PLAYER_STATUS]=ax[R._player?R._player.videoElementStatus:"uninit"],X&&void 0!==j.totalInterFrameDelay&&void 0!==j.totalSquaredInterFrameDelay&&void 0!==X.totalInterFrameDelay&&void 0!==X.totalSquaredInterFrameDelay){const Re=j.totalInterFrameDelay-X.totalInterFrameDelay,Nt=j.framesDecodeCount-X.framesDecodeCount,_n=Re/Nt*1e3,Zt=Math.round(1e3*Math.sqrt((j.totalSquaredInterFrameDelay-X.totalSquaredInterFrameDelay-Math.pow(Re,2)/Nt)/Nt));!isNaN(Zt)&&_n+Zt>Math.max(3*_n,_n+150)&&(W[zn.I_FRAME_DELAY]=Zt)}return W}(p._videoSSRC,r,o,p.videoTrack,!0===v,this.needUploadRenderFreezeTime,a):void 0;y&&(g.video=y)}if(m.has(_e.AUDIO)&&p.audioTrack){const v=p.audioTrack?function(y,b,C,N,R){const A=b.audioRecv.find(X=>X.ssrc===y);if(!A)return;const D={},M=C&&C.audioRecv.find(X=>X.ssrc===y),{receivedFrames:x,droppedFrames:j}=A;var W;if(Ne(D,Uo.JITTER,A.jitterMs),Ne(D,Uo.BYTES_RETRANSMIT,A.retransmittedBytesReceived),Ne(D,Uo.PACKAGES_RETRANSMIT,A.retransmittedPacketsReceived),Ne(D,Uo.PACKAGES_DISCARDED,A.packetsDiscarded),Ne(D,Uo.AVG_PROCESSING_DELAY,A.avgProcessingDelayMs),null!=x&&null!=j&&(D[Uo.FREEZE]=0===(W=x)||100*j/W>20?1:0),M){const X=b.timestamp-C.timestamp||(R?Gd:3e3);null!=A.packets&&null!=M.packets&&Ne(D,Uo.PACKAGE_RATE,1e3*(A.packets-M.packets)/X),null!=M.bytes&&null!=A.bytes&&Ne(D,Uo.BITRATE,8*(A.bytes-M.bytes)/X),null!=A.packetsLost&&null!=M.packetsLost&&Ne(D,Uo.PACKAGE_LOST,A.packetsLost-M.packetsLost)}if(R)return D;const ee=100*N._source.getAccurateVolumeLevel(),J=A.outputLevel;if(null!=J){const X=Math.ceil(50*Math.log10(100*J+1));Ne(D,O2.LEVEL,X)}if(Ne(D,Uo.PCM_LEVEL,ee),N&&(D[Uo.DISABLED]=N._originMediaStreamTrack.enabled&&N._mediaStreamTrack.enabled?0:1),Ne(D,Uo.JITTER_BUFFER,A.jitterBufferMs),Ne(D,Uo.CURRENT_DELAY,A.jitterBufferMs),D[Uo.PLAYER_STATUS]=ax[Wr.getPlayerState(N.getTrackId())],M){const X=A.concealedSamples-M.concealedSamples;X>0&&Ne(D,Uo.CONCEALED_SAMPLES,X)}return D}(p._audioSSRC,r,o,p.audioTrack,a):void 0;v&&(g.audio=v)}(g.video||g.audio)&&d.push(g)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,d}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(o=>o instanceof xS);if(r&&r._external.getDenoiserStats){const o=r._external.getDenoiserStats();o&&this.requestUpload(A_.DENOISER_STATS,o)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[o,a]=r;a.has(_e.VIDEO)&&o.videoTrack&&o.videoTrack.getProcessorStats().forEach(l=>{this.requestUpload&&this.requestUpload(l.type,l.stats)}),a.has(_e.AUDIO)&&o.audioTrack&&o.audioTrack.getProcessorStats().forEach(l=>{this.requestUpload&&this.requestUpload(l.type,l.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){var r=this;if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const o=new Map;this.uploadExtUsageStatsTimer=window.setInterval(L(function*(){const a=Date.now(),l={connectionInterval:V("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:a};let d=[];const h=r.requestAllTracks&&r.requestAllTracks()||[];for(const v of h)!v.muted&&v.enabled&&(d=d.concat(yield v.getProcessorUsage()));const p=r.requestRemoteMedia&&r.requestRemoteMedia()||[];for(const[v,y]of p)y.has(_e.VIDEO)&&v.videoTrack&&(d=d.concat(yield v.videoTrack.getProcessorUsage())),y.has(_e.AUDIO)&&v.audioTrack&&(d=d.concat(yield v.audioTrack.getProcessorUsage()));if(0===d.length)return;l.details=function(v,y){const b={};for(const{id:A,value:D,level:M,direction:x}of v){var C;const j=null!==(C=y.get(A))&&void 0!==C?C:0,W=2===D?j+V("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:j;var N,R;y.set(A,W),b[A]?(2===D&&(b[A].value=D),M>b[A].level&&(b[A].level=M),"remote"===x&&(b[A].remoteUidCount+=1),b[A].totalTs=null!==(N=y.get(A))&&void 0!==N?N:0):b[A]={value:D,level:M,remoteUidCount:"local"===x?0:1,totalTs:null!==(R=y.get(A))&&void 0!==R?R:0}}return Object.keys(b).map(A=>{const{level:D,value:M,totalTs:x}=b[A];return{id:A,level:D,value:M,totalTs:x}})}(d,o);const m=Date.now();r.requestUpload&&r.requestUpload(A_.EXTENSION_USAGE_STATS,{usageStats:l,sendTs:m>a?m:a+1})}),V("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class Mh{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,o){O(this,"uid",void 0),O(this,"_uintid",void 0),O(this,"_trust_in_room_",!0),O(this,"_trust_audio_enabled_state_",!0),O(this,"_trust_video_enabled_state_",!0),O(this,"_trust_audio_mute_state_",!0),O(this,"_trust_video_mute_state_",!0),O(this,"_audio_muted_",!1),O(this,"_video_muted_",!1),O(this,"_audio_enabled_",!0),O(this,"_video_enabled_",!0),O(this,"_audio_added_",!1),O(this,"_video_added_",!1),O(this,"_is_pre_created",!1),O(this,"_video_pre_subscribed",!1),O(this,"_audio_pre_subscribed",!1),O(this,"_trust_video_stream_added_state_",!0),O(this,"_trust_audio_stream_added_state_",!0),O(this,"_audioTrack",void 0),O(this,"_videoTrack",void 0),O(this,"_dataChannels",[]),O(this,"_audioSSRC",void 0),O(this,"_videoSSRC",void 0),O(this,"_audioOrtc",void 0),O(this,"_videoOrtc",void 0),O(this,"_cname",void 0),O(this,"_rtxSsrcId",void 0),O(this,"_videoMid",void 0),O(this,"_audioMid",void 0),this.uid=r,this._uintid=o}}let Va=function(n){return n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY",n}({});function iH(n,r){var o;let a;switch(r){case Q.LocalAudioTrack:a=at.Audio;break;case Q.LocalVideoTrack:a=he(o=n._hints).call(o,zt.SCREEN_TRACK)?at.Screen:at.High;break;case Q.LocalVideoLowTrack:a=at.Low}return a}function yD(n){const r=ct();if(n.some(o=>o._bypassWebAudio))throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function M2(n,r){yD(n);const o=r||new si;return n.forEach(a=>o.addAudioTrack(a)),o}var rH,k2,L2,x2,oH,sH,F2,U2,V2,aH,bD,on;function Zn(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function SD(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?Zn(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Zn(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}let us=(rH=Ac(Va.SEND_ONLY),k2=Ac(Va.SEND_ONLY),L2=Ac(),x2=Ac(Va.RECEIVE_ONLY),oH=Ac(Va.RECEIVE_ONLY),sH=Ac(Va.RECEIVE_ONLY),F2=Ac(Va.RECEIVE_ONLY),U2=Ac(Va.RECEIVE_ONLY),V2=Ac(Va.RECEIVE_ONLY),aH=Ac(),bD=Ac(Va.RECEIVE_ONLY),on=class extends nn{get state(){return this._state}set state(n){const r=this._state;this._state=n,this.emit(De.StateChange,r,this._state)}constructor(n,r){var o;super(),o=this,O(this,"isPlanB",!1),O(this,"store",void 0),O(this,"statsUploader",void 0),O(this,"sendConnection",void 0),O(this,"recvConnection",void 0),O(this,"localTrackMap",new Map),O(this,"remoteUserMap",new Map),O(this,"localDataChannels",[]),O(this,"pendingLocalTracks",[]),O(this,"pendingRemoteTracks",[]),O(this,"statsCollector",void 0),O(this,"dtlsFailedCount",0),O(this,"sendMutex",void 0),O(this,"recvMutex",void 0),O(this,"_state",Dt.Disconnected),O(this,"_restartStates",["disconnected","failed"]),O(this,"reconnectInterval",void 0),O(this,"uploadUnplinkStarted",!1),O(this,"uploadDownlinkStarted",!1),O(this,"uplinkStateUploadInterval",void 0),O(this,"downlinkStatsUploadInterval",void 0),O(this,"handleMuteLocalTrack",function(){var a=L(function*(l,d,h){const p=yield o.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!o.sendConnection||o.state!==Dt.Connected)return void h(new Y(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const v=o.filterTobeMutedTracks(l);if(0===v.length)return void d();const y=v.find(R=>"videoLowTrack"===R[0]);y&&y[1].track._originMediaStreamTrack.stop(),yield o.sendConnection.muteLocal(v.map(R=>{let[,{id:A}]=R;return A}));let b=!1;var m,g;b="video"===l.trackMediaType?!(null===(m=o.localTrackMap.get(Q.LocalAudioTrack))||void 0===m||!m.track._muted):void 0===(null===(g=o.localTrackMap.get(Q.LocalVideoTrack))||void 0===g?void 0:g.id);const C=o.createMuteMessage(v);yield jt(o,De.RequestMuteLocal,C);const N="video"===l.trackMediaType?Nd.MUTE_LOCAL_VIDEO:Nd.MUTE_LOCAL_AUDIO;yield jt(o,De.RequestP2PMuteLocal,{action:N,message:C,isMuteAll:b}),d()}catch(v){h(v)}finally{p()}});return function(l,d,h){return a.apply(this,arguments)}}()),O(this,"handleUnmuteLocalTrack",function(){var a=L(function*(l,d,h){const p=yield o.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!o.sendConnection||o.state!==Dt.Connected)return void h(new Y(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const m=o.filterTobeUnmutedTracks(l);if(0===m.length)return void d();yield o.sendConnection.unmuteLocal(m.map(y=>{let[,{id:b}]=y;return b}));const g=o.createUnmuteMessage(m),v="video"===l.trackMediaType?Nd.UNMUTE_LOCAL_VIDEO:Nd.UNMUTE_LOCAL_AUDIO;yield jt(o,De.RequestP2PMuteLocal,{action:v,message:g}),d()}catch(m){h(m)}finally{p()}});return function(l,d,h){return a.apply(this,arguments)}}()),O(this,"handleUpdateVideoEncoder",function(){var a=L(function*(l,d,h){const p=yield o.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const m=o.localTrackMap.get(Q.LocalVideoTrack);if(!o.sendConnection||!m||m.track!==l||o.state!==Dt.Connected)return void d();const{id:g,track:v}=m;g&&(yield o.sendConnection.updateSendParameters(g,v),yield o.sendConnection.updateEncoderConfig(g,v),o.emit(De.UpdateVideoEncoder,v)),d()}catch(m){h(m)}finally{p()}});return function(l,d,h){return a.apply(this,arguments)}}()),O(this,"handleUpdateVideoSendParameters",function(){var a=L(function*(l,d,h){const p=yield o.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const m=o.localTrackMap.get(Q.LocalVideoTrack);if(!o.sendConnection||!m||m.track!==l||o.state!==Dt.Connected)return void d();const{id:g,track:v}=m;g&&(yield o.sendConnection.updateSendParameters(g,v)),d()}catch(m){h(m)}finally{p()}});return function(l,d,h){return a.apply(this,arguments)}}()),O(this,"handleReplaceTrack",function(){var a=L(function*(l,d,h,p){let m;T.debug("[".concat(o.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(l.getTrackId(),"]")),"boolean"==typeof p&&p||(m=yield o.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var g;const y=Array.from(o.localTrackMap.entries()).find(b=>{let[,{track:C}]=b;return l===C});if(!o.sendConnection||!y||void 0===y[1].id||o.state!==Dt.Connected)return void d();if(yield null===(g=o.sendConnection)||void 0===g?void 0:g.replaceTrack(l,y[1].id),y[0]===Q.LocalVideoTrack&&ct().supportDualStreamEncoding){const b=o.localTrackMap.get(Q.LocalVideoLowTrack);if(b){const C=l._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=C,b.track._originMediaStreamTrack=C,yield new le((N,R)=>{o.handleReplaceTrack(b.track,N,R,!0)})}}d()}catch(y){h(y)}finally{var v;null===(v=m)||void 0===v||v()}});return function(l,d,h,p){return a.apply(this,arguments)}}()),O(this,"handleGetLocalVideoStats",a=>{a(this.statsCollector.getLocalVideoTrackStats())}),O(this,"handleGetLocalAudioStats",a=>{a(this.statsCollector.getLocalAudioTrackStats())}),O(this,"handleGetRemoteVideoStats",a=>this.statsCollector.getRemoteVideoTrackStats(a.uid)[a.uid]),O(this,"handleGetRemoteAudioStats",a=>this.statsCollector.getRemoteAudioTrackStats(a.uid)[a.uid]),this.store=n,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new nH(n),this.bindStatsUploaderEvents(),this.sendMutex=new Qi("P2PChannel2-send-mutex",n.clientId),this.recvMutex=new Qi("P2PChannel2-recv-mutex",n.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(a=>{a&&("disconnected"!==a.iceConnectionState&&"failed"!==a.iceConnectionState||this.handleDisconnect(a.direction))})},V("ICE_RESTART_INTERVAL"))}startP2PConnection(n,r){return L(function*(){throw new Y(k.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")})()}connect(n){return L(function*(){throw new Y(k.NOT_SUPPORTED,"p2p mode does not support connect.")})()}startP2P(n,r){var o=this;return L(function*(){let a;try{if(r){o.recvConnection&&(T.warning("[".concat(o.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),o.recvConnection.close(),o.unbindConnectionEvents(o.recvConnection)),a=yield o.recvMutex.lock("From P2PChannel.startP2P"),o.recvConnection=new A2(n,o.store,Pr.RECEIVE_ONLY),o.bindConnectionEvents(o.recvConnection);const l=yield o.recvConnection.establish(r);return{iceParameters:l.iceParameters,dtlsParameters:l.dtlsParameters,sdp:l.sdp}}{o.state=Dt.New,o.sendConnection&&(T.warning("[".concat(o.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),o.sendConnection.close(),o.unbindConnectionEvents(o.sendConnection)),a=yield o.sendMutex.lock("From P2PChannel.startP2P"),o.sendConnection=new A2(n,o.store),o.store.peerConnectionStart(),o.bindConnectionEvents(o.sendConnection);const l=yield o.sendConnection.establish();return{iceParameters:l.iceParameters,dtlsParameters:l.dtlsParameters,sdp:l.sdp}}}finally{a&&a()}})()}p2pConnect(n){var r=this;return L(function*(){if(!r.sendConnection)throw new Y(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");r.store.peerConnectionStart(),yield r.sendConnection.connect(n),r.statsUploader.startUploadTransportStats(),r.statsUploader.startUploadExtensionUsageStats(),r.state=Dt.Connected})()}addRemoteCandidate(n,r){var o=this;return L(function*(){if(r===Pr.RECEIVE_ONLY){if(!o.sendConnection)throw new Y(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield o.sendConnection.addRemoteCandidate(n)}else{if(!o.recvConnection)throw new Y(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield o.recvConnection.addRemoteCandidate(n)}})()}publish(n,r,o){var a=this;return ns(function*(){const l=yield tt(a.sendMutex.lock("From P2PChannel.publish"));try{if(!a.sendConnection||a.state!==Dt.Connected){a.throwIfTrackTypeNotMatch(n);const g=n.filter(v=>-1===a.pendingLocalTracks.indexOf(v));return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(g))}a.store.pubId=a.store.pubId+1,tr.markPublishStart(a.store.clientId,a.store.pubId);const d=a.filterTobePublishedTracks(n,r,o);if(0===d.length)return void(yield tt(a.tryToUnmuteAudio(n)));d.forEach(g=>{let{track:v,type:y}=g;const b=Date.now();a.store.publish(v.getTrackId(),y===Q.LocalAudioTrack?"audio":"video",b)}),a.bindLocalTrackEvents(d);const h=yield tt(a.sendConnection.send(d.map(g=>{let{track:v}=g;return v}),a.store.codec,a.store.audioCodec)),p=(yield tt(h.next())).value,m=a.createGatewayPublishMessage(d,p);try{yield m}catch(g){throw h.throw(g),g?.code===k.WS_ABORT&&d.forEach(v=>{let{track:y}=v;-1===a.pendingLocalTracks.indexOf(y)&&a.pendingLocalTracks.push(y)}),a.unbindLocalTrackEvents(d),g}yield tt(h.next()),d.forEach(g=>{let{type:v}=g;a.statsCollector.addLocalStats(v)}),a.statsUploader.startUploadOutboundStats(),a.assignLocalTracks(d,p),d.forEach(g=>{let{track:v,type:y}=g;const b=Date.now();a.store.publish(v.getTrackId(),y===Q.LocalAudioTrack?"audio":"video",void 0,b)}),a.startUploadUplinkState()}finally{l()}})()}unpublish(n){var r=this;return L(function*(){if(!r.sendConnection||r.state!==Dt.Connected)return void(0===n.length?r.pendingLocalTracks.length=0:r.pendingLocalTracks=r.pendingLocalTracks.filter(d=>!he(n).call(n,d)));const o=r.filterTobeUnpublishedTracks(n);if(0===o.length)return;const a=o.find(d=>"videoLowTrack"===d[0]);a&&a[1].track.close();const l=r.createGatewayUnpublishMessage(o);if(yield r.sendConnection.stopSending(o.map(d=>{let[,{id:h}]=d;return h})),r.withdrawLocalTracks(o),r.unbindLocalTrackEvents(o.map(d=>{let[h,{track:p}]=d;return{type:h,track:p}})),o.forEach(d=>{let[h]=d;r.statsCollector.removeLocalStats(h)}),0===r.localTrackMap.size&&(r.statsUploader.stopUploadOutboundStats(),r.stopUploadUplinkState()),r.sendConnection&&r.state===Dt.Connected)return a&&a[1].track.close(),l;n.forEach(d=>{const h=r.pendingLocalTracks.indexOf(d);-1!==h&&r.pendingLocalTracks.splice(h,1)})})()}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const n=()=>{const r=[],o=[];Array.from(this.localTrackMap.entries()).forEach(a=>{let[l,{track:d,ssrcs:h}]=a;const p={stream_type:iH(d,l),ssrcs:h};d._muted||!d._enabled?r.push(p):o.push(p)}),r.length>0&&r.forEach(a=>{jt(this,De.RequestMuteLocal,[a])}),o.length>0&&o.forEach(a=>{jt(this,De.RequestUnmuteLocal,[a])})};n(),this.uplinkStateUploadInterval=window.setInterval(()=>{n()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(n){return ns(function*(){throw new Y(k.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}republish(){var n=this;return L(function*(){n.pendingLocalTracks.length>0&&(T.debug("[".concat(n.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield Gi(n,De.RequestRePublish,n.pendingLocalTracks),n.emit(De.MediaReconnectEnd,n.store.uid),n.pendingLocalTracks=[])})()}unpublishLowStream(){return L(function*(){throw new Y(k.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")})()}subscribe(n,r,o,a){var l=this;return L(function*(){var d;if(!l.recvConnection)throw new Y(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(d=l.remoteUserMap.get(n))&&void 0!==d&&d.has(r))return;const{track:h,mid:p,transceiver:m}=yield l.recvConnection.receive(r,[{ssrcId:o}],String(n.uid),a);r===_e.AUDIO?(n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(h):(n._audioTrack=new Dl(h,n.uid,n._uintid,l.store),T.info("[".concat(l.store.clientId,"] [").concat(l.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),m&&n._audioTrack._updateRtpTransceiver(m),l.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoSSRC=o,n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(h):(n._videoTrack=new wh(h,n.uid,n._uintid,l.store),T.info("[".concat(l.store.clientId,"] [").concat(l.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),m&&n._videoTrack._updateRtpTransceiver(m),l.bindRemoteTrackEvents(n,n._videoTrack));const g=l.remoteUserMap.get(n);g?g.set(r,p):l.remoteUserMap.set(n,new Map([[r,p]])),l.statsCollector.addRemoteStats(n.uid),l.statsUploader.startUploadInboundStats(),l.startUploadDownlinkState();const v=l.pendingRemoteTracks.findIndex(y=>{let{user:b,kind:C}=y;return b.uid===n.uid&&r===C});-1!==v&&(l.pendingRemoteTracks.splice(v,1),l.emit(De.MediaReconnectEnd,n.uid))})()}mockSubscribe(n,r,o,a){var l=this;return L(function*(){if(!l.recvConnection)throw new Y(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");yield l.recvConnection.mockReceive(r,[{ssrcId:o}],String(n.uid),a)})()}unsubscribe(n,r,o){var a=this;return L(function*(){const l=a.pendingRemoteTracks.filter(h=>{let{user:p,kind:m}=h;return void 0!==r?p.uid===n.uid&&r===m:p.uid===n.uid});if(l.forEach(h=>{const p=a.pendingRemoteTracks.indexOf(h);a.pendingRemoteTracks.splice(p,1)}),a.recvConnection||o||l.forEach(h=>{let{kind:p}=h;var m;if(p===_e.AUDIO)null===(m=n._audioTrack)||void 0===m||m._destroy(),n._audioTrack=void 0;else if(p===_e.VIDEO){var g;null===(g=n._videoTrack)||void 0===g||g._destroy(),n._videoTrack=void 0}}),!a.recvConnection)return;const d=a.filterTobeUnSubscribedTracks(n,r);0!==d.length&&(yield a.recvConnection.stopReceiving(d.map(h=>{let[,{id:p}]=h;return p})),a.withdrawRemoteTracks(d),0===a.remoteUserMap.size&&(a.statsUploader.stopUploadInboundStats(),a.stopUploadDownlinkState()),d.forEach(h=>{let[p,{kind:m}]=h;var g,v;if(m===_e.VIDEO&&p._videoSSRC&&(null===(g=a.recvConnection)||void 0===g||g.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),m===_e.VIDEO)a.unbindRemoteTrackEvents(p._videoTrack),o||(null===(v=p._videoTrack)||void 0===v||v._destroy(),p._videoTrack=void 0);else if(m===_e.AUDIO){var y;a.unbindRemoteTrackEvents(p._audioTrack),!o&&(null===(y=p._audioTrack)||void 0===y||y._destroy(),p._audioTrack=void 0)}}),d.forEach(h=>{let[,{kind:p}]=h;jt(a,De.RequestP2PMuteRemote,p)}))})()}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const n=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,o]=r;[_e.VIDEO,_e.AUDIO].forEach(a=>{o.has(a)?jt(this,De.RequestP2PUnmuteRemote,a):jt(this,De.RequestP2PMuteRemote,a)})});n(),this.downlinkStatsUploadInterval=window.setInterval(()=>{n()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}massSubscribe(n){return L(function*(){throw new Y(k.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")})()}massSubscribeNoLock(n){return L(function*(){throw new Y(k.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")})()}massUnsubscribe(n){return L(function*(){throw new Y(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")})()}massUnsubscribeNoLock(n){return L(function*(){throw new Y(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")})()}muteRemote(n,r){var o=this;return L(function*(){if(!o.recvConnection)return;const a=o.remoteUserMap.get(n);if(!a)return void T.warning("[".concat(o.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(n.uid,"."));if(!a.get(r))return void T.warning("[".concat(o.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(n.uid," media type ").concat(r,"."));const l=r===_e.VIDEO?n._videoSSRC:n._audioSSRC;void 0!==l&&o.recvConnection.setStatsRemoteVideoIsReady(l,!1)})()}unmuteRemote(n,r){var o=this;return L(function*(){return o.unmuteRemoteNoLock(n,r)})()}unmuteRemoteNoLock(n,r){var o=this;return L(function*(){if(!o.recvConnection)return;const a=o.remoteUserMap.get(n);a?a.get(r)||T.warning("[".concat(o.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(n.uid," media type ").concat(r,".")):T.warning("[".concat(o.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(n.uid,"."))})()}getAllTracks(n){const r=this.localTrackMap.get(Q.LocalAudioTrack);if(r?.track instanceof si){const o=r.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[l]=a;return l!==Q.LocalAudioTrack}).filter(a=>{let[l]=a;return!(n&&l===Q.LocalVideoLowTrack)}).map(a=>{let[,{track:l}]=a;return l}).concat(o.trackList)}return Array.from(this.localTrackMap.entries()).filter(o=>{let[a]=o;return!(n&&a===Q.LocalVideoLowTrack)}).map(o=>{let[,{track:a}]=o;return a})}reportPublishEvent(n,r,o,a,l){if(n){const h=this.localTrackMap.get(Q.LocalAudioTrack),p=this.localTrackMap.get(a?Q.LocalVideoLowTrack:Q.LocalVideoTrack);be.publish(this.store.sessionId,{eventElapse:tr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:r,audioName:h?.track.getTrackLabel(),videoName:p?.track.getTrackLabel(),screenshare:-1!==p?.track._hints.indexOf(zt.SCREEN_TRACK),audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}else{var d;o||(o=[]);const h=o.find(m=>m instanceof Cn),p=a?null===(d=this.localTrackMap.get(Q.LocalVideoTrack))||void 0===d?void 0:d.track:o.find(m=>m instanceof Ve);be.publish(this.store.sessionId,{eventElapse:tr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:r,audioName:h?.getTrackLabel(),videoName:p?.getTrackLabel(),screenshare:-1!==p?._hints.indexOf(zt.SCREEN_TRACK),audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}}reportSubscribeEvent(n,r,o,a){const l=a===_e.VIDEO?o._videoSSRC:o._audioSSRC;l&&be.subscribe(this.store.sessionId,{succ:n,ec:r,video:a===_e.VIDEO,audio:a===_e.AUDIO,peerid:o.uid,subscribeRequestid:a===_e.VIDEO?o._videoSSRC:o._audioSSRC,p2pid:this.store.p2pId,eventElapse:tr.measureFromSubscribeStart(this.store.clientId,l)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Qi("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Qi("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const n=this.localTrackMap.get(Q.LocalAudioTrack);if(n?.track instanceof si){if(n.track.trackList.length>0){const r=n.track;n.track.trackList.forEach(o=>{r.removeAudioTrack(o)})}n.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Dt.Disconnected}getStats(n){var r,o;return n?null===(o=this.recvConnection)||void 0===o?void 0:o.getStats():null===(r=this.sendConnection)||void 0===r?void 0:r.getStats()}getRemoteVideoIsReady(n){var r;return(null===(r=this.recvConnection)||void 0===r?void 0:r.getRemoteVideoIsReady(n))||!1}getLocalAudioVolume(){const n=this.localTrackMap.get(Q.LocalAudioTrack);if(n)return n.track.getVolumeLevel()}getLocalVideoSize(){const n=this.localTrackMap.get(Q.LocalVideoTrack);if(n)return{width:n.track.videoWidth||0,height:n.track.videoHeight||0}}getEncoderConfig(n){const r=this.localTrackMap.get(n);return r&&r.track instanceof Ve||r&&r.track instanceof Cn?r.track._encoderConfig:void 0}getLocalMedia(n){return this.localTrackMap.get(n)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(n,r){if(!n)return this.remoteUserMap.size>0;const o=this.remoteUserMap.get(n);return!!o&&(!r||o.has(r))}hasRemoteMediaWithLock(n,r){var o=this;return L(function*(){if(!n)return o.remoteUserMap.size>0;const a=o.remoteUserMap.get(n);return!!a&&(!r||a.has(r))})()}getRemoteMedia(n){var r;const o=Array.from(wo(r=this.remoteUserMap).call(r)).find(a=>a.uid===n);return o?{audioTrack:o.audioTrack,audioSSRC:o._audioSSRC,videoTrack:o.videoTrack,videoSSRC:o._videoSSRC}:{}}getAudioLevels(){let n=Array.from(this.remoteUserMap.entries()).map(o=>{let[a]=o;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Q.LocalAudioTrack);return r&&n.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),n=hd(n).call(n,(o,a)=>o.level-a.level),n}disconnectForReconnect(){var n=this;return L(function*(){n.sendConnection&&n.recvConnection&&(T.debug("[".concat(n.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),n.state=Dt.Reconnecting,V("KEEP_LAST_FRAME")&&0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(r=>{let[o]=r;var a;o._videoTrack&&o._videoTrack._player&&(null===(a=o._videoTrack._player.getVideoElement())||void 0===a||a.pause(),o._videoTrack._player.isKeepLastFrame=!0,o._videoTrack._originMediaStreamTrack.stop())}),n.sendConnection.close(),n.unbindConnectionEvents(n.sendConnection),n.sendConnection=void 0,n.recvConnection.close(),n.unbindConnectionEvents(n.recvConnection),n.recvConnection=void 0,0!==n.localTrackMap.size&&(Array.from(n.localTrackMap.entries()).forEach(r=>{var o;let[a,{track:l}]=r;switch(a){case Q.LocalVideoTrack:he(o=l._hints).call(o,zt.LOW_STREAM)?l.close():n.pendingLocalTracks.push(l);break;case Q.LocalAudioTrack:l instanceof si?n.pendingLocalTracks=n.pendingLocalTracks.concat(l.trackList):n.pendingLocalTracks.push(l)}}),n.emit(De.MediaReconnectStart,n.store.uid)),n.unbindLocalTrackEvents(),n.localTrackMap.clear(),0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(r=>{let[o,a]=r;Array.from(wo(a).call(a)).forEach(l=>{n.setPendingRemoteMedia(o,l)}),n.emit(De.MediaReconnectStart,o.uid)}),n.unbindAllRemoteTrackEvents(),n.remoteUserMap.clear(),n.stopUploadUplinkState(),n.stopUploadDownlinkState(),n.statsUploader.stopUploadOutboundStats(),n.statsUploader.stopUploadInboundStats(),n.statsUploader.stopUploadTransportStats(),T.debug("[".concat(n.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))})()}hasPendingRemoteMedia(n,r){for(const o of this.pendingRemoteTracks){const{user:a,kind:l}=o;if((n instanceof Mh?n.uid:n)===a.uid&&r===l)return!0}return!1}setPendingRemoteMedia(n,r){this.hasPendingRemoteMedia(n,r)||this.pendingRemoteTracks.push({user:n,kind:r})}restartICE(n,r){var o=this;return L(function*(){let a,l;if(n===Pr.SEND_ONLY){if(!o.sendConnection)throw new Y(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");a=yield o.sendMutex.lock("From P2PChannel.restartICE"),l=o.sendConnection}else{if(!o.recvConnection)throw new Y(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");a=yield o.recvMutex.lock("From P2PChannel.restartICE"),l=o.recvConnection}try{if(r){const d=yield l.restartICE(r);return l.isInRestartIce=!1,d}{const d=yield l.restartICE();if(d){const h=yield Gi(o,De.RequestP2PRestartICE,{direction:Pr.RECEIVE_ONLY,iceParameter:d});yield l.restartICE(h),l.isInRestartIce=!1}}}finally{a()}})()}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const n=this.sendConnection.getStats(),r=this.localTrackMap.get(Q.LocalVideoTrack),o=this.localTrackMap.get(Q.LocalAudioTrack),a=n.videoSend.find(C=>{var N;return C.ssrc===(null==r||null===(N=r.ssrcs)||void 0===N?void 0:N[0].ssrcId)}),l=n.audioSend.find(C=>{var N;return C.ssrc===(null==o||null===(N=o.ssrcs)||void 0===N?void 0:N[0].ssrcId)});if(!a||!l)return 1;const d=Do(this,De.NeedSignalRTT),h=a?a.rttMs:void 0,p=l?l.rttMs:void 0,m=h&&p?(h+p)/2:h||p,v=100*n.sendPacketLossRate*.7/50+.3*((m&&d?(m+d)/2:m||d)||0)/1500,y=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,b=r?.track;if(b&&b._encoderConfig&&-1===b._hints.indexOf(zt.SCREEN_TRACK)){const C=b._encoderConfig.bitrateMax,N=n.bitrate.actualEncoded;if(C&&N){const R=(1e3*C-N)/(1e3*C);return nL[R<.15?0:R<.3?1:R<.45?2:R<.6?3:4][y]}}return y}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const n=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(o=>{let[a]=o;const l=a._audioSSRC,d=a._videoSSRC,h=n.audioRecv.find(N=>N.ssrc===l),p=n.videoRecv.find(N=>N.ssrc===d);if(!h&&!p)return void(r+=1);const m=Do(this,De.NeedSignalRTT),g=n.rtt,v=(g&&m?(g+m)/2:g||m)||0,y=h?h.jitterMs:void 0,b=n.recvPacketLossRate;let C=.7*b*100/50+.3*v/1500;y&&(C=.6*b*100/50+.2*v/1500+.2*y/400),r+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}muteLocalTrack(n){var r=this;return L(function*(){return new le((o,a)=>{r.handleMuteLocalTrack(n,o,a)})})()}filterTobePublishedTracks(n,r,o){const a=[],l=ct(),d=this.getAllTracks();n=At(n=n.filter(m=>-1===d.indexOf(m)));let h=!1,p=!1;for(const m of n){if(m instanceof Ve&&(this.localTrackMap.has(Q.LocalVideoTrack)||h?new Y(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:m,type:Q.LocalVideoTrack}),h=!0),r)){const g=this.getLowVideoTrack(m,o);a.push({track:g,type:Q.LocalVideoLowTrack})}if(m instanceof Cn){const g=this.localTrackMap.get(Q.LocalAudioTrack);if(g){if(!(g.track instanceof si))throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");g.track.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0)}else if(p){const v=a.find(y=>{let{type:b}=y;return b===Q.LocalAudioTrack});if(!(v.track instanceof si))throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(m)}else{if(!l.webAudioMediaStreamDest||m instanceof si||m._bypassWebAudio)a.push({track:m,type:Q.LocalAudioTrack});else{const v=new si;v.addAudioTrack(m),a.push({track:v,type:Q.LocalAudioTrack})}p=!0}}}return a}filterTobeUnpublishedTracks(n){const r=[],o=this.getAllTracks();n=At(n=n.filter(a=>-1!==o.indexOf(a)));for(const a of n){if(a instanceof Cn){const l=this.localTrackMap.get(Q.LocalAudioTrack);if(!l)continue;l.track instanceof si?(l.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),0===l.track.trackList.length&&(r.push([Q.LocalAudioTrack,l]),l.track.close())):r.push([Q.LocalAudioTrack,l])}if(a instanceof Ve){const l=this.localTrackMap.get(Q.LocalVideoTrack);if(!l)continue;r.push([Q.LocalVideoTrack,l]);const d=this.localTrackMap.get(Q.LocalVideoLowTrack);d&&r.push([Q.LocalVideoLowTrack,d])}}return r}bindLocalTrackEvents(n){n.forEach(r=>{let{track:o,type:a}=r;switch(a){case Q.LocalVideoTrack:o.addListener(ge.GET_STATS,this.handleGetLocalVideoStats),o.addListener(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.addListener(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.addListener(ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),o.addListener(ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),o.addListener(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.addListener(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.addListener(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Q.LocalAudioTrack:this.bindLocalAudioTrackEvents(o)}})}bindLocalAudioTrackEvents(n,r){n instanceof si?n.trackList.forEach(o=>{o.addListener(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.addListener(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.addListener(ge.GET_STATS,this.handleGetLocalAudioStats),o.addListener(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.addListener(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.addListener(ge.GET_STATS,this.handleGetLocalAudioStats),n.addListener(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||n.addListener(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(n){n||(n=Array.from(this.localTrackMap.entries()).map(r=>{let[o,{track:a}]=r;return{track:a,type:o}})),n.forEach(r=>{let{track:o,type:a}=r;switch(a){case Q.LocalVideoTrack:o.off(ge.GET_STATS,this.handleGetLocalVideoStats),o.off(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.off(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.off(ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),o.off(ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),o.off(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.off(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.off(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Q.LocalAudioTrack:this.unbindLocalAudioTrackEvents(o)}})}unbindLocalAudioTrackEvents(n){n instanceof si?n.trackList.forEach(r=>{r.off(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(ge.GET_STATS,this.handleGetLocalAudioStats),r.off(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.off(ge.GET_STATS,this.handleGetLocalAudioStats),n.off(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(n,r){r instanceof wh&&r.addListener(ge.GET_STATS,o=>{o(this.handleGetRemoteVideoStats(n))}),r instanceof Dl&&r.addListener(ge.GET_STATS,o=>{o(this.handleGetRemoteAudioStats(n))})}unbindRemoteTrackEvents(n){n&&n.removeAllListeners(ge.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r,o]=n;o.has(_e.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),o.has(_e.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(n,r){return n.map((o,a)=>{var l;let d,{track:h,type:p}=o;switch(p){case Q.LocalAudioTrack:d=at.Audio;break;case Q.LocalVideoTrack:d=he(l=h._hints).call(l,zt.SCREEN_TRACK)?at.Screen:at.High;break;case Q.LocalVideoLowTrack:d=at.Low}return{kind:p===Q.LocalAudioTrack?_e.AUDIO:_e.VIDEO,stream_type:d,mid:r[a].id,ssrcs:r[a].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(n){return n.map(r=>{var o;let a,[l,{track:d,ssrcs:h,id:p}]=r;switch(l){case Q.LocalVideoTrack:a=he(o=d._hints).call(o,zt.SCREEN_TRACK)?at.Screen:at.High;break;case Q.LocalAudioTrack:a=at.Audio;break;case Q.LocalVideoLowTrack:a=at.Low}return{stream_type:a,ssrcs:h,mid:p}})}assignLocalTracks(n,r){n.forEach((o,a)=>{let{track:l,type:d}=o;this.localTrackMap.set(d,{track:l,id:r[a].id,ssrcs:r[a].localSSRC})})}withdrawLocalTracks(n){n.forEach(r=>{let[o]=r;this.localTrackMap.delete(o)})}bindConnectionEvents(n){var r=this;n.onConnectionStateChange=function(){var o=L(function*(a){var l;T.info("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: ").concat(n.name,".onConnectionStateChange(").concat(a,")")),r.emit(De.PeerConnectionStateChange,a),"connected"!==a||r.store.keyMetrics.peerConnectionEnd||r.store.peerConnectionEnd(),"connected"===a&&(n.isInRestartIce=!1),he(l=r._restartStates).call(l,a)&&!n.isInRestartIce&&("disconnected"===a&&(yield Ii(800)),"disconnected"!==n.iceConnectionState&&"failed"!==n.iceConnectionState||r.handleDisconnect(n.direction))});return function(a){return o.apply(this,arguments)}}(),n.onICEConnectionStateChange=o=>{"connected"!==o||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(o,")")),be.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:o,tag:st.TRACER}).onSuccess(),this.emit(De.IceConnectionStateChange,o)},n.onICETransportStateChange=o=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(o,")"))},n.onDTLSTransportStateChange=o=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(o,")"))},n.onDTLSTransportError=o=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(o,")"))},n.onFirstAudioDecoded=o=>{var a;const l=Array.from(wo(a=this.remoteUserMap).call(a)).find(h=>h._audioSSRC===o);var d;l&&(this.store.subscribe(l.uid,"audio",void 0,void 0,void 0,Date.now()),null===(d=l.audioTrack)||void 0===d||d.emit(bh.FIRST_FRAME_DECODED),be.firstRemoteFrame(this.store.sessionId,Mi.FIRST_AUDIO_DECODE,sn.FIRST_AUDIO_DECODE,{peer:l._uintid,subscribeElapse:tr.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId}))},n.onFirstAudioReceived=o=>{var a;const l=Array.from(wo(a=this.remoteUserMap).call(a)).find(d=>d._audioSSRC===o);l&&be.firstRemoteFrame(this.store.sessionId,Mi.FIRST_AUDIO_RECEIVED,sn.FIRST_AUDIO_RECEIVED,{peer:l._uintid,subscribeElapse:tr.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId})},n.onFirstVideoDecoded=(o,a,l)=>{this.reportVideoFirstFrameDecoded(o,a,l)},n.onFirstVideoReceived=o=>{var a;const l=Array.from(wo(a=this.remoteUserMap).call(a)).find(d=>d._videoSSRC===o);l&&be.firstRemoteFrame(this.store.sessionId,Mi.FIRST_VIDEO_RECEIVED,sn.FIRST_VIDEO_RECEIVED,{peer:l._uintid,subscribeElapse:tr.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId})},n.onSelectedLocalCandidateChanged=(o,a)=>{const l="relay"===o.candidateType;"unknown"!==a.candidateType&&l===("relay"===a.candidateType)||this.emit(De.ConnectionTypeChange,l),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Pd(a))," -> ").concat(JSON.stringify(Pd(o)),")"))},n.onSelectedRemoteCandidateChanged=(o,a)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Pd(a))," -> ").concat(JSON.stringify(Pd(o)),")"))},n.onFirstVideoDecodedTimeout=o=>{this.reportVideoFirstFrameDecoded(o,void 0,void 0,!0)},n.onLocalCandidate=o=>{this.emit(De.LocalCandidate,{candidate:o,direction:n.direction})}}unbindConnectionEvents(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0,n.onLocalCandidate=void 0}handleDisconnect(n){var r=this;return L(function*(){const o=n===Pr.SEND_ONLY?r.sendConnection:r.recvConnection;o&&!o.isInRestartIce&&(o.isInRestartIce=!0,T.debug("[".concat(r.store.clientId,"] [P2PChannel-").concat(o.name,"] start use restartICE")),n===Pr.SEND_ONLY?r.restartICE(n):Gi(r,De.RequestP2PRestartICE,{direction:Pr.SEND_ONLY}))})()}filterTobeMutedTracks(n){const r=[];if(-1===this.getAllTracks().indexOf(n))return r;const o=this.localTrackMap.get(Q.LocalAudioTrack);if(n instanceof Cn&&o?.track instanceof si)return o.track.isActive||r.push([Q.LocalAudioTrack,o]),r;const a=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:d}]=l;return n===d});if(a&&(r.push(a),a[0]===Q.LocalVideoTrack)){const l=this.localTrackMap.get(Q.LocalVideoLowTrack);l&&r.push([Q.LocalVideoLowTrack,l])}return r}filterTobeUnmutedTracks(n){const r=[],o=this.localTrackMap.get(Q.LocalAudioTrack);if(n instanceof Cn&&o?.track instanceof si)return o.track.isActive&&r.push([Q.LocalAudioTrack,o]),r;const a=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:d}]=l;return n===d});if(a)if(a[0]===Q.LocalVideoTrack){r.push(a);const l=this.localTrackMap.get(Q.LocalVideoLowTrack);l&&r.push([Q.LocalVideoLowTrack,l])}else r.push(a);return r}createMuteMessage(n){return n.map(r=>{var o;let a,[l,{track:d,ssrcs:h,id:p}]=r;switch(l){case Q.LocalAudioTrack:a=at.Audio;break;case Q.LocalVideoTrack:a=he(o=d._hints).call(o,zt.SCREEN_TRACK)?at.Screen:at.High;break;case Q.LocalVideoLowTrack:a=at.Low}return{stream_type:a,ssrcs:h,mid:p}})}createUnmuteMessage(n){return n.map(r=>{var o;let a,[l,{track:d,ssrcs:h,id:p}]=r;switch(l){case Q.LocalAudioTrack:a=at.Audio;break;case Q.LocalVideoTrack:a=he(o=d._hints).call(o,zt.SCREEN_TRACK)?at.Screen:at.High;break;case Q.LocalVideoLowTrack:a=at.Low}return{stream_type:a,ssrcs:h,mid:p}})}filterTobeUnSubscribedTracks(n,r){const o=[],a=this.remoteUserMap.get(n);if(!a)return o;if(r){const l=a.get(r);if(!l)return o;o.push([n,{kind:r,id:l}])}else Array.from(a.entries()).forEach(l=>{let[d,h]=l;o.push([n,{kind:d,id:h}])});return o}createUnsubscribeMessage(n){const r=[];return n.forEach(o=>{let[a,{kind:l}]=o;switch(l){case _e.VIDEO:return void(a._videoSSRC&&r.push({stream_type:_e.VIDEO,ssrcId:a._videoSSRC}));case _e.AUDIO:return void(a._audioSSRC&&r.push({stream_type:_e.AUDIO,ssrcId:a._audioSSRC}))}}),r}withdrawRemoteTracks(n){n.forEach(r=>{let[o,{kind:a}]=r;const l=this.remoteUserMap.get(o);l&&(l.delete(a),0===Array.from(l.entries()).length&&this.remoteUserMap.delete(o))})}updateBitrateLimit(n){var r=this;return L(function*(){const o=r.localTrackMap.get(Q.LocalVideoTrack),a=r.localTrackMap.get(Q.LocalVideoLowTrack);o&&(yield o.track.setBitrateLimit(n.uplink)),a&&n.low_stream_uplink&&(yield a.track.setBitrateLimit({max_bitrate:n.low_stream_uplink.bitrate,min_bitrate:n.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.sendConnection||!this.recvConnection||"connected"!==this.sendConnection.peerConnectionState&&"connected"!==this.recvConnection.peerConnectionState}tryToUnmuteAudio(n){var r=this;return L(function*(){for(let o=0;o<n.length;o++)if(n[o]instanceof Cn){const a=r.filterTobeUnmutedTracks(n[o]);if(0===a.length)continue;const l=r.createUnmuteMessage(a);return void(yield jt(r,De.RequestUnmuteLocal,l))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=n=>this.getStats(n),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(n=>{let[,{ssrcs:r}]=n;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=n=>{var r;return!(null===(r=this.recvConnection)||void 0===r||!r.getRemoteVideoIsReady(n))},this.statsUploader.requestUpload=(n,r)=>this.emit(De.RequestUpload,n,r),this.statsUploader.requestUploadStats=n=>this.emit(De.RequestUploadStats,n),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var n=this;return L(function*(){n.dtlsFailedCount+=1,yield Ii(pR(n.dtlsFailedCount,Nn)),n.emit(De.RequestReconnect)})()}reconnectP2P(){return L(function*(){})()}canPublishLowStream(){return this.localTrackMap.has(Q.LocalVideoTrack)||this.pendingLocalTracks.some(n=>n instanceof Ve)}throwIfTrackTypeNotMatch(n){if(n.filter(r=>r instanceof Ve).length>1)throw new Y(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n.filter(r=>r instanceof Cn).length>1&&(n.some(r=>r instanceof Cn&&r._bypassWebAudio)||!ct().webAudioMediaStreamDest))throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of n){if(r instanceof Ve&&this.pendingLocalTracks.some(o=>o instanceof Ve))throw new Y(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Cn&&this.pendingLocalTracks.some(o=>o instanceof Cn)&&(!ct().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(o=>o instanceof Cn&&o._bypassWebAudio)))throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(n,r){const o=!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&ct().supportDualStreamEncoding,a=SD(SD({},{width:160,height:120,framerate:15,bitrate:50}),r);let l;l=o?n._mediaStreamTrack.clone():D2(n,a);const d=Ct(8,"track-low-"),h=new Ve(l,SD(SD({},o&&{scaleResolutionDownBy:VR(a,n)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,d);return h.on(Ff.TRANSCEIVER_UPDATED,p=>{n._updateRtpTransceiver(p,Y_.LOW_STREAM)}),h._hints.push(zt.LOW_STREAM),n.addListener(ge.NEED_CLOSE,()=>{h.close()}),h}globalLock(){var n=this;return L(function*(){return n.recvMutex.lock("From P2PChannel2.globalLock")})()}reportVideoFirstFrameDecoded(n,r,o,a){var l;const d=Array.from(wo(l=this.remoteUserMap).call(l)).find(h=>h._videoSSRC===n);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,p=h.subscribe.find(m=>m.userId===d.uid&&"video"===m.type);be.firstRemoteVideoDecode(this.store.sessionId,Mi.FIRST_VIDEO_DECODE,sn.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:o,subscribeElapse:tr.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:p?.subscribeEnd||0,subscriberStart:p?.subscribeStart||0,videoAddNotify:p?.streamAdded||0,state:a?1:0})}}remoteMediaSsrcChanged(n,r,o){var a=this;return L(function*(){if(!a.recvConnection)return!1;const l=a.remoteUserMap.get(n);if(!l)return!1;const d=l.get(r);if(!d)return!1;const h=yield a.recvConnection.getRemoteSSRC(d);return void 0!==h&&h!==o})()}isPreSubScribe(n){return!1}publishDataChannel(n){return L(function*(){throw new Y(k.NOT_SUPPORTED)})()}unpublishDataChannel(n){return L(function*(){throw new Y(k.NOT_SUPPORTED)})()}subscribeDataChannel(n,r){return L(function*(){throw new Y(k.NOT_SUPPORTED)})()}unsubscribeDataChannel(n,r){return L(function*(){throw new Y(k.NOT_SUPPORTED)})()}hasPendingRemoteDataChannel(n,r){throw new Y(k.NOT_SUPPORTED)}setPendingRemoteDataChannel(n,r){throw new Y(k.NOT_SUPPORTED)}preConnect(n){return L(function*(){throw new Y(k.NOT_SUPPORTED)})()}getEstablishParams(){throw new Y(k.NOT_SUPPORTED)}reSubscribe(n){return L(function*(){throw new Y(k.NOT_SUPPORTED)})()}updateVideoStreamParameter(n,r){return L(function*(){throw new Y(k.NOT_SUPPORTED)})()}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(n=>{let[r,{track:o}]=n;r===Q.LocalVideoLowTrack?o._updateRtpTransceiver(void 0,Y_.LOW_STREAM):o._updateRtpTransceiver(void 0)})}},pe(on.prototype,"p2pConnect",[rH],Object.getOwnPropertyDescriptor(on.prototype,"p2pConnect"),on.prototype),pe(on.prototype,"unpublish",[k2],Object.getOwnPropertyDescriptor(on.prototype,"unpublish"),on.prototype),pe(on.prototype,"unpublishLowStream",[L2],Object.getOwnPropertyDescriptor(on.prototype,"unpublishLowStream"),on.prototype),pe(on.prototype,"subscribe",[x2],Object.getOwnPropertyDescriptor(on.prototype,"subscribe"),on.prototype),pe(on.prototype,"mockSubscribe",[oH],Object.getOwnPropertyDescriptor(on.prototype,"mockSubscribe"),on.prototype),pe(on.prototype,"unsubscribe",[sH],Object.getOwnPropertyDescriptor(on.prototype,"unsubscribe"),on.prototype),pe(on.prototype,"muteRemote",[F2],Object.getOwnPropertyDescriptor(on.prototype,"muteRemote"),on.prototype),pe(on.prototype,"unmuteRemote",[U2],Object.getOwnPropertyDescriptor(on.prototype,"unmuteRemote"),on.prototype),pe(on.prototype,"hasRemoteMediaWithLock",[V2],Object.getOwnPropertyDescriptor(on.prototype,"hasRemoteMediaWithLock"),on.prototype),pe(on.prototype,"disconnectForReconnect",[aH],Object.getOwnPropertyDescriptor(on.prototype,"disconnectForReconnect"),on.prototype),pe(on.prototype,"remoteMediaSsrcChanged",[bD],Object.getOwnPropertyDescriptor(on.prototype,"remoteMediaSsrcChanged"),on.prototype),on);function Ac(n){return function(r,o,a){const l=r[o];if("function"!=typeof l)throw new Error("Cannot use mutex on object property.");return a.value=L(function*(){for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];switch(n){case Va.SEND_ONLY:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(o));try{return yield l.apply(this,h)}finally{m()}}case Va.RECEIVE_ONLY:{const m=yield this.recvMutex.lock("From P2PChannel2.".concat(o));try{return yield l.apply(this,h)}finally{m()}}default:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(o)),g=yield this.recvMutex.lock("From P2PChannel2.".concat(o));try{return yield l.apply(this,h)}finally{m(),g()}}}}),a}}function cH(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function qf(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?cH(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):cH(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}class nC{constructor(r){O(this,"store",void 0),O(this,"onStatsException",void 0),O(this,"onUploadPublishDuration",void 0),O(this,"onStatsChanged",void 0),O(this,"localStats",new Map),O(this,"remoteStats",new Map),O(this,"updateStatsInterval",void 0),O(this,"trafficStats",void 0),O(this,"trafficStatsPeerList",[]),O(this,"uplinkStats",void 0),O(this,"exceptionMonitor",void 0),O(this,"p2pChannel",void 0),O(this,"scalabilityMode",dr.L1T1),O(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new m2,this.exceptionMonitor.on("exception",(o,a,l)=>{this.onStatsException&&this.onStatsException(o,a,l)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Q.LocalAudioTrack)||qf({},mA)}getLocalVideoTrackStats(){return this.localStats.get(Q.LocalVideoTrack)||qf({},NS)}getRemoteAudioTrackStats(r){const o=(d,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return p&&(h.publishDuration=p.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var l;const d=null===(l=this.remoteStats.get(r))||void 0===l?void 0:l.audioStats;d&&(a[r]=o(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:p}]=d;p&&(a[h]=o(h,p))});return a}getRemoteNetworkQualityStats(r){const o={};if(r){var a;const l=null===(a=this.remoteStats.get(r))||void 0===a?void 0:a.networkStats;l&&(o[r]=l)}else Array.from(this.remoteStats.entries()).forEach(l=>{let[d,{networkStats:h}]=l;h&&(o[d]=h)});return o}getRemoteVideoTrackStats(r){const o=(d,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return p&&(h.publishDuration=p.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var l;const d=null===(l=this.remoteStats.get(r))||void 0===l?void 0:l.videoStats;d&&(a[r]=o(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:p}]=d;p&&(a[h]=o(h,p))});return a}getRTCStats(){let r=0,o=0,a=0,l=0;const d=this.localStats.get(Q.LocalAudioTrack);d&&(r+=d.sendBytes,o+=d.sendBitrate);const h=this.localStats.get(Q.LocalVideoTrack);h&&(r+=h.sendBytes,o+=h.sendBitrate);const p=this.localStats.get(Q.LocalVideoLowTrack);p&&(r+=p.sendBytes,o+=p.sendBitrate),this.remoteStats.forEach(g=>{let{audioStats:v,videoStats:y}=g;v&&(a+=v.receiveBytes,l+=v.receiveBitrate),y&&(a+=y.receiveBytes,l+=y.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:o,SendBytes:r,RecvBytes:a,RecvBitrate:l,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(o=>void 0!==o.B_ppad||void 0!==o.B_ppvd),r.peer_delay.filter(o=>-1===this.trafficStatsPeerList.indexOf(o.peer_uid)).forEach(o=>{var a;const l=null===(a=this.p2pChannel)||void 0===a?void 0:a.getRemoteMedia(o.peer_uid),d=null!=l&&l.videoSSRC?tr.measureFromSubscribeStart(this.store.clientId,l.videoSSRC):0,h=null!=l&&l.audioSSRC?tr.measureFromSubscribeStart(this.store.clientId,l.audioSSRC):0;void 0!==o.B_ppad&&void 0!==o.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(o.peer_uid,o.B_ppad,o.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(o.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&T.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,o,a){return!!r&&(!!a&&o.framesDecodeFreezeTime>a.framesDecodeFreezeTime||!(!a||o.framesDecodeCount>a.framesDecodeCount))}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(o=>{let[a,l]=o;switch(a){case Q.LocalVideoTrack:case Q.LocalVideoLowTrack:{const h=l,p=qf({},NS),m=r.getStats(),g=r.getLocalMedia(a);if(m){const v=m.videoSend.find(y=>y.ssrc===g?.ssrcs[0].ssrcId);if(v){const y=r.getLocalVideoSize(),b=r.getEncoderConfig(Q.LocalVideoTrack);"H264"!==v.codec&&"H265"!==v.codec&&"VP8"!==v.codec&&"VP9"!==v.codec&&"AV1X"!==v.codec&&"AV1"!==v.codec||(p.codecType=v.codec),p.sendBytes=v.bytes,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0,v.inputFrame?(p.captureFrameRate=v.inputFrame.frameRate,p.captureResolutionHeight=v.inputFrame.height,p.captureResolutionWidth=v.inputFrame.width):y&&(p.captureResolutionWidth=y.width,p.captureResolutionHeight=y.height),v.sentFrame?(p.sendFrameRate=v.sentFrame.frameRate,p.sendResolutionHeight=v.sentFrame.height,p.sendResolutionWidth=v.sentFrame.width):y&&(p.sendResolutionWidth=y.width,p.sendResolutionHeight=y.height),v.avgEncodeMs&&(p.encodeDelay=v.avgEncodeMs),b&&b.bitrateMax&&(p.targetSendBitrate=1e3*b.bitrateMax),p.sendPackets=v.packets,p.sendPacketsLost=v.packetsLost,p.sendJitterMs=v.jitterMs,p.sendRttMs=v.rttMs,p.totalDuration=h?h.totalDuration+1:1,p.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(v)&&(p.totalFreezeTime+=1),v.scalabilityMode&&this.scalabilityMode!==v.scalabilityMode&&(T.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(v.scalabilityMode)),this.scalabilityMode=v.scalabilityMode)}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(a,p),(h?.sendResolutionWidth!==p.sendResolutionWidth||h?.sendResolutionHeight!==p.sendResolutionHeight)&&(null===(d=this.onStatsChanged)||void 0===d||d.call(this,"resolution",{width:p.sendResolutionWidth,height:p.sendResolutionHeight})),p&&g&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,g.track,p);break}case Q.LocalAudioTrack:{const h=l,p=qf({},mA),m=r.getStats(),g=r.getLocalMedia(a);if(m){const v=m.audioSend.find(y=>y.ssrc===g?.ssrcs[0].ssrcId);if(v){if("opus"!==v.codec&&"aac"!==v.codec&&"PCMU"!==v.codec&&"PCMA"!==v.codec&&"G722"!==v.codec||(p.codecType=v.codec),v.inputLevel)p.sendVolumeLevel=Math.round(32767*v.inputLevel);else{const y=r.getLocalAudioVolume();y&&(p.sendVolumeLevel=Math.round(32767*y))}p.sendBytes=v.bytes,p.sendPackets=v.packets,p.sendPacketsLost=v.packetsLost,p.sendJitterMs=v.jitterMs,p.sendRttMs=v.rttMs,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0}}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Q.LocalAudioTrack,p),p&&g&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,g.track,p);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(o=>{var a,l;let[d,{videoStats:h,audioStats:p,videoPcStats:m}]=o;const g=p,v=h,y=m,b=qf({},xd),C=qf({},PS),N=qf({},sx),{audioTrack:R,videoTrack:A,audioSSRC:D,videoSSRC:M}=r.getRemoteMedia(d);let x;x=r instanceof us?r.getStats(!0):r.getStats();const j=null===(a=x)||void 0===a?void 0:a.audioRecv.find(ee=>ee.ssrc===D),W=null===(l=x)||void 0===l?void 0:l.videoRecv.find(ee=>ee.ssrc===M),q=this.trafficStats&&this.trafficStats.peer_delay.find(ee=>ee.peer_uid===d);if(j&&("opus"!==j.codec&&"aac"!==j.codec&&"PCMU"!==j.codec&&"PCMA"!==j.codec&&"G722"!==j.codec||(b.codecType=j.codec),j.outputLevel?b.receiveLevel=Math.round(32767*j.outputLevel):R&&(b.receiveLevel=Math.round(32767*R.getVolumeLevel())),b.receiveBytes=j.bytes,b.receivePackets=j.packets,b.receivePacketsLost=j.packetsLost,b.receivePacketsDiscarded=j.packetsDiscarded,b.packetLossRate=b.receivePacketsLost/(b.receivePackets+b.receivePacketsLost),b.receiveBitrate=g?8*Math.max(0,b.receiveBytes-g.receiveBytes):0,b.totalDuration=g?g.totalDuration+1:1,b.totalFreezeTime=g?g.totalFreezeTime:0,b.freezeRate=b.totalFreezeTime/b.totalDuration,b.receiveDelay=j.jitterBufferMs,b.totalDuration>10&&nC.isRemoteAudioFreeze(R)&&(b.totalFreezeTime+=1)),W){"H264"!==W.codec&&"H265"!==W.codec&&"VP8"!==W.codec&&"VP9"!==W.codec&&"AV1X"!==W.codec&&"AV1"!==W.codec||(C.codecType=W.codec),C.receiveBytes=W.bytes,C.receiveBitrate=v?8*Math.max(0,C.receiveBytes-v.receiveBytes):0,C.decodeFrameRate=W.decodeFrameRate<0?0:W.decodeFrameRate,C.renderFrameRate=W.decodeFrameRate<0?0:W.decodeFrameRate,W.outputFrame&&(C.renderFrameRate=W.outputFrame.frameRate),W.receivedFrame?(C.receiveFrameRate=W.receivedFrame.frameRate,C.receiveResolutionHeight=W.receivedFrame.height,C.receiveResolutionWidth=W.receivedFrame.width):A&&(C.receiveResolutionHeight=A._videoHeight||0,C.receiveResolutionWidth=A._videoWidth||0),void 0!==W.framesRateFirefox&&(C.receiveFrameRate=Math.round(W.framesRateFirefox)),C.receivePackets=W.packets,C.receivePacketsLost=W.packetsLost,C.packetLossRate=C.receivePacketsLost/(C.receivePackets+C.receivePacketsLost),C.totalDuration=v?v.totalDuration+1:1,C.totalFreezeTime=v?v.totalFreezeTime:0,C.receiveDelay=W.jitterBufferMs||0;const ee=!!M&&r.getRemoteVideoIsReady(M);A&&ee&&nC.isRemoteVideoFreeze(A,W,y)&&(C.totalFreezeTime+=1),C.freezeRate=C.totalFreezeTime/C.totalDuration}q&&(b.end2EndDelay=q.B_ad,C.end2EndDelay=q.B_vd,b.transportDelay=q.B_ed,C.transportDelay=q.B_ed,b.currentPacketLossRate=q.B_ealr4/100,C.currentPacketLossRate=q.B_evlr4/100,N.uplinkNetworkQuality=q.B_punq?q.B_punq:0,N.downlinkNetworkQuality=q.B_pdnq?q.B_pdnq:0),this.remoteStats.set(d,{audioStats:b,videoStats:C,videoPcStats:W,networkStats:N}),R&&this.exceptionMonitor.setRemoteAudioStats(R,b),A&&this.exceptionMonitor.setRemoteVideoStats(A,C)})}}class lH{constructor(){O(this,"destChannelMediaInfos",new Map),O(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){OR(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){OR(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){dS(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function B2(n){if(!(n instanceof lH))return new z(k.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=n.getSrcChannelMediaInfo(),o=n.getDestChannelMediaInfo();return r?0===o.size?new z(k.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new z(k.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}function dH(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function uH(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?dH(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):dH(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}var Kt;function CD(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function iC(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?CD(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):CD(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}let Ev=(Kt=class zO extends MR{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var o;return he(o=Object.keys(vR)).call(o,r)}))]}constructor(r,o){super(r,o),O(this,"store",void 0),O(this,"peerConnection",void 0),O(this,"remoteSDP",void 0),O(this,"initialOffer",void 0),O(this,"statsFilter",void 0),O(this,"useRTX",!1),O(this,"localCapabilities",void 0),O(this,"localCandidateCount",0),O(this,"allCandidatesReceived",!1),O(this,"establishPromise",void 0),O(this,"mutex",void 0),this.store=o,this.mutex=new Qi("P2PConnection-mutex",o.clientId),this.peerConnection=new RTCPeerConnection(zO.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=tC(this.peerConnection,V("STATS_UPDATE_INTERVAL"),void 0,hn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){var r=this;return L(function*(){try{const o=yield r.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=Bd(o.sdp),l=sv(o.sdp,{filterRTX:!r.useRTX,filterVideoFec:V("FILTER_VIDEO_FEC"),filterAudioFec:V("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return r.localCapabilities=l,r.initialOffer=o,iC(iC({},a),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:l},offerSDP:o.sdp})}catch(o){throw new Y(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}})()}updateRemoteConnect(){return L(function*(){})()}connect(r){var o=this;return L(function*(){try{if(!o.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");o.remoteSDP=new class{constructor(l){O(this,"sessionDesc",void 0),O(this,"localCapabilities",void 0),O(this,"rtpCapabilities",void 0),O(this,"candidates",void 0),O(this,"iceParameters",void 0),O(this,"dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname",void 0),l=Vn(l);const{iceParameters:d,dtlsParameters:h,candidates:p,rtpCapabilities:m,setup:g,localCapabilities:v,sdkCodec:y,cname:b}=l,C=Ei.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=m,this.candidates=p,this.iceParameters=d,this.dtlsParameters=h,this.setup=g,this.localCapabilities=v,this.cname=b;for(let N=0;N<C.mediaDescriptions.length;N++){const R=C.mediaDescriptions[N];if(R.attributes.iceUfrag=d.iceUfrag,R.attributes.icePwd=d.icePwd,R.attributes.fingerprints=h.fingerprints,R.attributes.candidates=p,R.attributes.setup=g,"video"===R.media.mediaType){R.media.fmts=m.videoCodecs.map(D=>D.payloadType.toString(10));let A=m.videoCodecs.filter(D=>{var M,x;return null===(M=D.rtpMap)||void 0===M?void 0:he(x=M.encodingName.toLowerCase()).call(x,y)});0===A.length&&(A=m.videoCodecs),R.attributes.payloads=A,R.attributes.extmaps=m.videoExtensions}"audio"===R.media.mediaType&&(R.media.fmts=m.audioCodecs.map(A=>A.payloadType.toString(10)),R.attributes.payloads=m.audioCodecs,R.attributes.extmaps=m.audioExtensions),C.mediaDescriptions[N]=this.mungMediaDesc(R)}this.sessionDesc=C,this.currentMidIndex=C.mediaDescriptions.length-1}toString(){return Ei.print(this.sessionDesc)}send(l,d,h){const{ssrcs:p,ssrcGroups:m}=Rh(d,this.cname),g=this.sessionDesc.mediaDescriptions.find(b=>l===_e.VIDEO?"video"===b.media.mediaType:"audio"===b.media.mediaType),v=p[0].attributes.label,y=p[0].attributes.mslabel;return g.attributes.ssrcs=g.attributes.ssrcs.concat(p),g.attributes.ssrcGroups=g.attributes.ssrcGroups.concat(m),{id:v,mslabel:y}}batchSend(l){return l.map(d=>{let{kind:h,ssrcMsg:p}=d;return this.send(h,p,void 0)})}stopSending(l){this.sessionDesc.mediaDescriptions.forEach(d=>{const h=[],p=[],m=[];d.attributes.ssrcs.forEach(g=>{he(l).call(l,g.attributes.label||"")?m.push(g):h.push(g)}),d.attributes.ssrcGroups.forEach(g=>{var v;he(v=m.map(y=>y.ssrcId)).call(v,g.ssrcIds[0])||p.push(g)}),d.attributes.ssrcs=h,d.attributes.ssrcGroups=p})}mute(l){const d=this.sessionDesc.mediaDescriptions.find(h=>h.attributes.mid===l);if(!d)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.mute."));d.attributes.direction="inactive"}unmute(l){const d=this.sessionDesc.mediaDescriptions.find(h=>h.attributes.mid===l);if(!d)throw new Error("mediaDescription not found with ".concat(l," in remote SDP when calling RemoteSDP.unmute."));d.attributes.direction="sendonly"}receive(l,d,h){l.forEach((p,m)=>{const g=p._mediaStreamTrack,v=this.sessionDesc.mediaDescriptions.findIndex(b=>b.attributes.mid===g.kind),y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[v],p);this.sessionDesc.mediaDescriptions[v]=y})}stopReceiving(l){}updateCandidates(l){l===po.TCP?this.candidates.forEach(d=>{-1===this.candidates.findIndex(h=>"tcp"===h.transport&&h.connectionAddress===d.connectionAddress&&h.port===d.port)&&this.candidates.push(uH(uH({},d),{},{foundation:"tcpcandidate",priority:Number(d.priority)-1+"",transport:"tcp",port:Number(d.port)+90+""}))}):this.candidates=this.candidates.filter(d=>"tcp"!==d.transport);for(const d of this.sessionDesc.mediaDescriptions)d.attributes.candidates=this.candidates}restartICE(l){l=Vn(l),this.iceParameters=l,this.sessionDesc.mediaDescriptions.forEach(d=>{d.attributes.iceUfrag=l.iceUfrag,d.attributes.icePwd=l.icePwd})}predictReceivingMids(l){const d=[];for(let h=0;h<l;h++)d.push((this.currentMidIndex+h+1).toString(10));return d}mungRecvMediaDsec(l,d){const h=Vn(l);return Hf(h,d),qA(h,d),h}updateRecvMedia(l,d){const h=this.sessionDesc.mediaDescriptions.findIndex(p=>p.attributes.mid===l);if(-1!==h){const p=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[h],d);this.sessionDesc.mediaDescriptions[h]=p}}bumpMid(l){this.currentMidIndex+=l}updateTrackLabel(l,d,h){const p=this.sessionDesc.mediaDescriptions.find(g=>l===_e.VIDEO?"video"===g.attributes.mid:"audio"===g.attributes.mid);if(p){const g=p.attributes.ssrcs.find(v=>v.attributes.label===d);var m;g&&(g.attributes.label=h,null===(m=g.attributes.msid)||void 0===m||m.replace(d,h))}}mungMediaDesc(l){const d=Vn(l);return KA(d),function(h){const p=h.attributes.extmaps.find(m=>zS(m.extensionName));p&&h.attributes.extmaps.splice(h.attributes.extmaps.indexOf(p),1),h.attributes.payloads.forEach(m=>{const g=m.rtcpFeedbacks.findIndex(v=>"transport-cc"===v.type);-1!==g&&m.rtcpFeedbacks.splice(g,1)})}(d),d}getSSRC(l){for(const d of this.sessionDesc.mediaDescriptions)for(const h of d.attributes.ssrcs)if(h.attributes.label===l)return[h]}}(iC(iC({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:o.localCapabilities,sdkCodec:o.store.codec}));const a=o.remoteSDP.toString();yield o.peerConnection.setLocalDescription(o.initialOffer),yield o.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(a.toString()))}})()}updateRemoteRTPCapabilities(r,o){return L(function*(){throw new Y(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")})()}getPreMedia(r){}send(r,o){var a=this;return ns(function*(){const l=yield tt(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=r.map(b=>a.peerConnection.addTrack(b._mediaStreamTrack)),h=yield tt(a.peerConnection.createOffer()),p=Ei.parse(h.sdp),m=r.map(b=>{const C=b._mediaStreamTrack,N=p.mediaDescriptions.find(R=>R.attributes.mid===C.kind);if(!N)throw new Error("Cannot extract ssrc from mediaDescription.");return function(R,A,D){const M=R.attributes.ssrcs.filter(j=>j.attributes.label===A),x=R.attributes.ssrcGroups;if(0===M.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(x&&M.length>1){const j=x.find(W=>-1!==W.ssrcIds.indexOf(M[0].ssrcId));return j?[{ssrcId:j.ssrcIds[0],rtx:D?j.ssrcIds[1]:void 0}]:[{ssrcId:M[0].ssrcId}]}return[{ssrcId:M[0].ssrcId}]}(N,C.id,a.useRTX)});let g;try{g=yield m}catch(b){throw d.forEach(C=>{$e()&&C.replaceTrack(null),a.peerConnection.removeTrack(C)}),b}const v=a.mungSendOfferSDP(h.sdp,r);a.remoteSDP.receive(r,o,g);const y=a.remoteSDP.toString();return yield tt(a.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield tt(a.applySendEncodings(d,r)),yield tt(a.peerConnection.setRemoteDescription({type:"answer",sdp:y})),r.map((b,C)=>({localSSRC:m[C],id:b._mediaStreamTrack.id}))}catch(d){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{l()}})()}stopSending(r){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=o.peerConnection.getSenders().filter(h=>{var p;return-1!==r.indexOf((null===(p=h.track)||void 0===p?void 0:p.id)||"")});if(a.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");a.map(h=>{$e()&&h.replaceTrack(null),o.peerConnection.removeTrack(h)});const l=yield o.peerConnection.createOffer();yield o.peerConnection.setLocalDescription(l),o.remoteSDP.stopReceiving(r);const d=o.remoteSDP.toString();yield o.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}})()}receive(r,o,a,l){var d=this;return L(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:h,mslabel:p}=d.remoteSDP.send(r,o,l),m=new le((y,b)=>{const C=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(h)))},1e4),N=R=>{const A=ot();if(("Safari"===A.name&&11===Number(A.version)||nt())&&R.track.id!==h&&R.streams[0].id===p){var D;const M=R.streams[0].getTracks()[0];return null===(D=d.remoteSDP)||void 0===D||D.updateTrackLabel(r,h,R.track.id),d.peerConnection.removeEventListener("track",N),clearTimeout(C),void y(M)}if(R.track.id===h)return d.peerConnection.removeEventListener("track",N),clearTimeout(C),void y(R.track)};d.peerConnection.addEventListener("track",N)}),g=d.remoteSDP.toString();yield d.peerConnection.setRemoteDescription({type:"offer",sdp:g});const v=yield d.peerConnection.createAnswer();return yield d.peerConnection.setLocalDescription(v),{track:yield m,id:h}}catch(h){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}stopReceiving(r){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");o.remoteSDP.stopSending(r);const a=o.remoteSDP.toString();yield o.peerConnection.setRemoteDescription({type:"offer",sdp:a});const l=yield o.peerConnection.createAnswer();yield o.peerConnection.setLocalDescription(l)}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(r){return L(function*(){})()}unmuteRemote(r){return L(function*(){})()}muteLocal(r){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=o.peerConnection.getSenders().filter(l=>{var d;return-1!==r.indexOf((null===(d=l.track)||void 0===d?void 0:d.id)||"")});if(a.length!==r.length)throw new Error("sender' length doesn't match mids' length.");a.map(l=>{if($e()&&l.track)l.track.enabled=!1;else{const d=l.getParameters();d.encodings.forEach(h=>h.active=!1),l.setParameters(d)}})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(r){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=o.peerConnection.getSenders().filter(h=>{var p;return-1!==r.indexOf((null===(p=h.track)||void 0===p?void 0:p.id)||"")});if(a.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");a.map(function(){var h=L(function*(p){if($e()&&p.track)p.track.enabled=!0;else{const m=p.getParameters();m.encodings.forEach(g=>g.active=!0),yield p.setParameters(m)}});return function(p){return h.apply(this,arguments)}}());const l=yield o.peerConnection.createOffer();yield o.peerConnection.setLocalDescription(l);const d=o.remoteSDP.toString();yield o.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(r){var o=this;return ns(function*(){const a=yield tt(o.mutex.lock("From P2PConnection.restartICE"));try{if(!o.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ct().supportPCSetConfiguration){const m=o.peerConnection.getConfiguration(),g=r===po.RELAY?"relay":"all";m.iceTransportPolicy!==g&&(T.debug("[".concat(o.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(g,"]")),m.iceTransportPolicy=g,o.peerConnection.setConfiguration(m))}else if(r===po.RELAY)return;r!==po.RELAY&&o.remoteSDP.updateCandidates(r);const l=yield tt(o.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Bd(l.sdp),{remoteIceParameters:h}=yield d.iceParameters;o.remoteSDP.restartICE(h);const p=o.remoteSDP.toString();yield tt(o.peerConnection.setLocalDescription(l)),yield tt(o.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(l){T.warning("[".concat(o.store.clientId,"] restart ICE failed, abort operation"),l)}finally{a()}})()}close(){var r;this.peerConnection.close(),null===(r=this.onConnectionStateChange)||void 0===r||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}updateEncoderConfig(r,o){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const l=yield a.peerConnection.createOffer(),d=a.mungSendOfferSDP(l.sdp,[o]);a.remoteSDP.updateRecvMedia(o._mediaStreamTrack.kind,o);const h=a.remoteSDP.toString();yield a.peerConnection.setLocalDescription({type:"offer",sdp:d}),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(l){throw new Y(k.EXCHANGE_SDP_FAILED,l.toString())}})()}updateSendParameters(r,o){var a=this;return L(function*(){const l=a.peerConnection.getSenders().filter(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===r});1===l.length&&(yield a.applySendEncodings(l,[o]))})()}setStatsRemoteVideoIsReady(r,o){this.statsFilter.setVideoIsReady2(r,o)}replaceTrack(r,o){var a=this;return L(function*(){const l=a.peerConnection.getSenders().find(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===o});l&&(yield l.replaceTrack(r._mediaStreamTrack))})()}createDataChannels(r,o){throw new Y(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Y(k.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;null===(r=this.onICEConnectionStateChange)||void 0===r||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;null===(r=this.onConnectionStateChange)||void 0===r||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},V("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const o={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?o.iceServers=r.iceServers:r.turnServer&&"off"!==r.turnServer.mode&&(nS(r.turnServer.servers)?o.iceServers=r.turnServer.servers:(o.iceServers&&o.iceServers.push(...zO.turnServerConfigToIceServers(r.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&r.turnServer.serversFromGateway&&o.iceServers.push(...zO.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(o.iceTransportPolicy="relay")}))),o}static turnServerConfigToIceServers(r){const o=[];return r.forEach(a=>{a.security?a.tcpport&&o.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&o.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&o.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),o}updateRtpSenderEncodings(r,o){var a=this;return L(function*(){var l;if(o||(o=a.peerConnection.getSenders().find(v=>{var y;return(null===(y=v.track)||void 0===y?void 0:y.id)===r._mediaStreamTrack.id})),!o)return T.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!ct().supportSetRtpSenderParameters)return T.warn("Browser not support set rtp-sender parameters");const d={},h={};if(r instanceof Ve)switch(r._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(V("DSCP_TYPE")&&hl()){var p;const v=V("DSCP_TYPE");he(p=["very-low","low","medium","high"]).call(p,v)&&(h.networkPriority=v)}const m=o.getParameters(),g=null===(l=m.encodings)||void 0===l?void 0:l[0];g&&Object.assign(g,h),Object.assign(m,d),T.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),yield o.setParameters(m)})()}applySendEncodings(r,o){var a=this;return L(function*(){try{if(!ct().supportSetRtpSenderParameters||r.length!==o.length)return;for(let l=0;l<r.length;l++){const d=r[l],h=o[l];d&&h&&(yield a.updateRtpSenderEncodings(h,d))}}catch{T.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(r,o){const a=Ei.parse(r);return o.forEach((l,d)=>{const h=l._mediaStreamTrack,p=a.mediaDescriptions.find(m=>m.attributes.mid===h.kind);p&&Hf(p,l)}),Ei.print(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var o;null===(o=this.onFirstAudioReceived)||void 0===o||o.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var o;null===(o=this.onFirstVideoReceived)||void 0===o||o.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var o;null===(o=this.onFirstAudioDecoded)||void 0===o||o.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,o,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,r,o,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,o)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,r,o)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,o)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,r,o)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}batchReceive(r){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const a=o.remoteSDP.batchSend(r).map((h,p)=>{let{id:m,mslabel:g}=h;const{kind:v}=r[p];return new le((y,b)=>{const C=setTimeout(()=>{b(new Error("Cannot receive track, id: ".concat(m)))},1e4),N=R=>{const A=ot();if("Safari"===A.name&&11===Number(A.version)&&R.track.id!==m&&R.streams[0].id===g){var D;const M=R.streams[0].getTracks()[0];return null===(D=o.remoteSDP)||void 0===D||D.updateTrackLabel(v,m,R.track.id),o.peerConnection.removeEventListener("track",N),clearTimeout(C),void y({track:M,id:m})}if(R.track.id===m)return o.peerConnection.removeEventListener("track",N),clearTimeout(C),void y({track:R.track,id:m})};o.peerConnection.addEventListener("track",N)})}),l=o.remoteSDP.toString();yield o.peerConnection.setRemoteDescription({type:"offer",sdp:l});const d=yield o.peerConnection.createAnswer();return yield o.peerConnection.setLocalDescription(d),yield le.all(a)}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}})()}getRemoteSSRC(r){var o=this;return L(function*(){if(!o.remoteSDP)return;const a=o.remoteSDP.getSSRC(r);return a?.[0].ssrcId})()}setConfiguration(r){if(ct().supportPCSetConfiguration){const o=zO.resolvePCConfiguration(r);this.peerConnection.setConfiguration(o)}}},pe(Kt.prototype,"connect",[Bo],Object.getOwnPropertyDescriptor(Kt.prototype,"connect"),Kt.prototype),pe(Kt.prototype,"stopSending",[Bo],Object.getOwnPropertyDescriptor(Kt.prototype,"stopSending"),Kt.prototype),pe(Kt.prototype,"receive",[Bo],Object.getOwnPropertyDescriptor(Kt.prototype,"receive"),Kt.prototype),pe(Kt.prototype,"stopReceiving",[Bo],Object.getOwnPropertyDescriptor(Kt.prototype,"stopReceiving"),Kt.prototype),pe(Kt.prototype,"muteRemote",[Bo],Object.getOwnPropertyDescriptor(Kt.prototype,"muteRemote"),Kt.prototype),pe(Kt.prototype,"unmuteRemote",[Bo],Object.getOwnPropertyDescriptor(Kt.prototype,"unmuteRemote"),Kt.prototype),pe(Kt.prototype,"muteLocal",[Bo],Object.getOwnPropertyDescriptor(Kt.prototype,"muteLocal"),Kt.prototype),pe(Kt.prototype,"unmuteLocal",[Bo],Object.getOwnPropertyDescriptor(Kt.prototype,"unmuteLocal"),Kt.prototype),pe(Kt.prototype,"close",[Bo],Object.getOwnPropertyDescriptor(Kt.prototype,"close"),Kt.prototype),pe(Kt.prototype,"updateEncoderConfig",[Bo],Object.getOwnPropertyDescriptor(Kt.prototype,"updateEncoderConfig"),Kt.prototype),pe(Kt.prototype,"updateSendParameters",[Bo],Object.getOwnPropertyDescriptor(Kt.prototype,"updateSendParameters"),Kt.prototype),pe(Kt.prototype,"replaceTrack",[Bo],Object.getOwnPropertyDescriptor(Kt.prototype,"replaceTrack"),Kt.prototype),pe(Kt.prototype,"getRemoteSSRC",[Bo],Object.getOwnPropertyDescriptor(Kt.prototype,"getRemoteSSRC"),Kt.prototype),Kt);function Bo(n,r,o){const a=n[r];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return o.value=L(function*(){const l=this.mutex,d=yield l.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{d()}}),o}function Yf(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function kh(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?Yf(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Yf(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}class j2{get localCapabilities(){return Vn(this._localCapabilities)}get rtpCapabilities(){return Vn(this._rtpCapabilities)}get candidates(){return Vn(this._candidates)}get iceParameters(){return Vn(this._iceParameters)}get dtlsParameters(){return Vn(this._dtlsParameters)}constructor(r){O(this,"sessionDesc",void 0),O(this,"_localCapabilities",void 0),O(this,"_rtpCapabilities",void 0),O(this,"_candidates",void 0),O(this,"_iceParameters",void 0),O(this,"_dtlsParameters",void 0),O(this,"setup",void 0),O(this,"currentMidIndex",void 0),O(this,"cname",void 0),O(this,"firefoxSsrcMidMap",new Map),r=Vn(r);const{iceParameters:o,dtlsParameters:a,candidates:l,rtpCapabilities:d,setup:h,localCapabilities:p,cname:m}=r;this._rtpCapabilities=d,this._candidates=l,this._iceParameters=o,this._dtlsParameters=a,this._localCapabilities=p,this.setup=h,this.cname=m,this.sessionDesc=this.updateRemoteRTPCapabilities(d),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(r){const o=this.candidates,a=this.dtlsParameters,l=this.iceParameters,d=this.rtpCapabilities.send;let h=this.sessionDesc.mediaDescriptions.length-1;for(let p=1;p<r;p++){const m=2*p+2e4,g=2*p+4e4,{ssrcs:v,ssrcGroups:y}=Rh([{ssrcId:m}],this.cname),{ssrcs:b,ssrcGroups:C}=Rh([{ssrcId:g,rtx:V("USE_SUB_RTX")?g+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.videoCodecs.map(N=>N.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:l.iceUfrag,icePwd:l.icePwd,unrecognized:[],candidates:o,extmaps:d.videoExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:b,ssrcGroups:C,rtcpFeedbackWildcards:[],payloads:d.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++h)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.audioCodecs.map(N=>N.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:l.iceUfrag,icePwd:l.icePwd,unrecognized:[],candidates:o,extmaps:d.audioExtensions,fingerprints:a.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:v,ssrcGroups:y,rtcpFeedbackWildcards:[],payloads:d.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++h)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Ei.print(this.sessionDesc)}send(r,o,a,l){const{ssrcs:d,ssrcGroups:h}=Rh(o,this.cname,V("SYNC_GROUP")?a:void 0),p=this.findPreloadMediaDesc(d);if(p){if(hn()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,p.attributes.mid),l&&(l.twcc||l.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(p,l),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(r,d);let g;return-1===m||1===m&&($e()||function(){const v=ot();return!(v.name!==wt.CHROME||!v.osVersion)&&Number(v.version)<=90}())||0===m&&V("USE_SUB_RTX")||nR()?(g=this.createOrRecycleSendMedia(r,d,h,"sendonly",l),this.updateBundleMids()):(g=Vn(this.sessionDesc.mediaDescriptions[m]),g.attributes.direction="sendonly",g.attributes.ssrcs=d,g.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(g,l)),hn()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,g.attributes.mid),{mid:g.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:r,needExchangeSDP:o}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:r.attributes.mid,needExchangeSDP:o}}batchSend(r){const o=r.map(d=>{let{kind:h,ssrcMsg:p,mslabel:m}=d;return this.send(h,p,m)}),a=[];let l=!1;return o.forEach(d=>{let{mid:h,needExchangeSDP:p}=d;p&&(l=!0),a.push(h)}),{mids:a,needExchangeSDP:l}}stopSending(r){const o=this.sessionDesc.mediaDescriptions.filter(a=>a.attributes.mid&&-1!==r.indexOf(a.attributes.mid));if(o.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");o.forEach(a=>{"0"===a.attributes.mid||hn()||nR()?a.attributes.ssrcs=[]:(a.attributes.ssrcs=[],a.attributes.direction="inactive",a.media.port="0")}),this.updateBundleMids()}mute(r){const o=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===r);if(!o)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));o.attributes.direction="inactive"}unmute(r){const o=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===r);if(!o)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));o.attributes.direction="sendonly"}muteRemote(r){const o=this.sessionDesc.mediaDescriptions.filter(a=>he(r).call(r,a.attributes.mid||""));if(o.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");o.forEach(a=>{a.attributes.direction="inactive"})}unmuteRemote(r){const o=this.sessionDesc.mediaDescriptions.filter(a=>he(r).call(r,a.attributes.mid||""));if(o.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");o.forEach(a=>{a.attributes.direction="recvonly"})}receive(r,o,a,l){r.forEach((d,h)=>{this.createOrRecycleRecvMedia(d,[],"recvonly",o,a,l[h])}),this.updateBundleMids()}stopReceiving(r){const o=this.sessionDesc.mediaDescriptions.filter(a=>-1!==r.indexOf(a.attributes.mid));if(o.length!==r.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");o.forEach(a=>{a.media.port="0",a.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(r){const o=this.sessionDesc||Ei.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=r;const a=this.rtpCapabilities.send,l=this.localCapabilities.send;for(const d of o.mediaDescriptions){if(d.attributes.iceUfrag=this._iceParameters.iceUfrag,d.attributes.icePwd=this._iceParameters.icePwd,d.attributes.fingerprints=this._dtlsParameters.fingerprints,d.attributes.candidates=this._candidates,d.attributes.setup=this.setup,"application"===d.media.mediaType&&(d.attributes.sctpPort="5000"),"video"===d.media.mediaType)if(0===a.videoCodecs.length){const h=l.videoCodecs.filter(p=>{var m,g;return null===(m=p.rtpMap)||void 0===m?void 0:he(g=m.encodingName.toLowerCase()).call(g,"vp8")})||[l.videoCodecs[0]];d.media.fmts=h.map(p=>p.payloadType.toString(10)),d.attributes.payloads=h,d.attributes.extmaps=[]}else if(d.media.fmts=a.videoCodecs.map(h=>h.payloadType.toString(10)),d.attributes.payloads=a.videoCodecs,d.attributes.extmaps=a.videoExtensions,V("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:h,ssrcGroups:p}=Rh([{ssrcId:4e4,rtx:V("USE_SUB_RTX")?40001:void 0}],this.cname);d.attributes.ssrcs=h,d.attributes.ssrcGroups=p}if("audio"===d.media.mediaType)if(0===a.audioCodecs.length){const h=l.audioCodecs.filter(p=>{var m,g;return null===(m=p.rtpMap)||void 0===m?void 0:he(g=m.encodingName.toLowerCase()).call(g,"opus")})||[l.audioCodecs[0]];d.media.fmts=h.map(p=>p.payloadType.toString(10)),d.attributes.payloads=h,d.attributes.extmaps=[]}else if(d.media.fmts=a.audioCodecs.map(h=>h.payloadType.toString(10)),d.attributes.payloads=a.audioCodecs,d.attributes.extmaps=a.audioExtensions,Ol(d),V("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:h,ssrcGroups:p}=Rh([{ssrcId:2e4}],this.cname);d.attributes.ssrcs=h,d.attributes.ssrcGroups=p}}return this.sessionDesc=o,this.currentMidIndex=o.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(r){const o=this._candidates.filter(a=>"udp"===a.transport);if(r===po.TCP){if(0===o.length)return;if(V("TCP_CANDIDATE_ONLY")){const a=this._candidates.filter(l=>"tcp"===l.transport);o.forEach(l=>{-1===a.findIndex(d=>d.connectionAddress===l.connectionAddress)&&a.push(kh(kh({},l),{},{foundation:"tcpcandidate",priority:Number(l.priority)-1+"",transport:"tcp",port:Number(l.port)+90+""}))}),this._candidates=a}else{const a=[];o.forEach(l=>{a.push(kh(kh({},l),{},{foundation:"tcpcandidate",priority:Number(l.priority)-1+"",transport:"tcp",port:Number(l.port)+90+""}))}),this._candidates=[...o,...a]}}else if(r===po.RELAY){if(0!==o.length)return;{const a=this._candidates.filter(l=>"tcp"===l.transport);a.forEach(l=>{o.push(kh(kh({},l),{},{foundation:"udpcandidate",priority:Number(l.priority)+1+"",transport:"udp",port:Number(l.port)-90+""}))}),this._candidates=[...o,...a]}}else 0===o.length?(this._candidates.filter(a=>"tcp"===a.transport).forEach(a=>{o.push(kh(kh({},a),{},{foundation:"udpcandidate",priority:Number(a.priority)+1+"",transport:"udp",port:Number(a.port)-90+""}))}),this._candidates=o):this._candidates=this._candidates.filter(a=>"tcp"!==a.transport);for(const a of this.sessionDesc.mediaDescriptions)a.attributes.candidates=this.candidates}restartICE(r){r=Vn(r),this._iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(o=>{o.attributes.iceUfrag=r.iceUfrag,o.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const o=[];for(let a=0;a<r;a++)o.push((this.currentMidIndex+a+1).toString(10));return o}findAvailableMediaIndex(r,o){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const l=a.media.mediaType===r&&"0"!==a.media.port&&("sendonly"===a.attributes.direction||"sendrecv"===a.attributes.direction)&&0===a.attributes.ssrcs.length;if(hn()){if(l){const d=this.firefoxSsrcMidMap.get(o[0].ssrcId);return!(d||"0"!==a.attributes.mid&&"1"!==a.attributes.mid)||!(!d||d!==a.attributes.mid)}return!1}return l})}createOrRecycleDataChannel(){for(const a of this.sessionDesc.mediaDescriptions)if("application"===a.media.mediaType)return{mediaDesc:a,needExchangeSDP:!1};this.currentMidIndex+=1;const r="".concat(this.currentMidIndex),o={media:{mediaType:"application",port:"9",protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(r),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(o),{mediaDesc:o,needExchangeSDP:!0}}createOrRecycleRecvMedia(r,o,a,l,d,h){const p=r._mediaStreamTrack.kind,m=this.rtpCapabilities.recv,g=xo(p,m,this.localCapabilities.send,p===_e.VIDEO?l:d),v=p===_e.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;const y="".concat(this.currentMidIndex);let b={media:{mediaType:p,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:g.map(N=>N.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:v,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:o,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:g,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};b=this.mungRecvMediaDsec(b,r,h);const C=this.findFirstClosedMedia(p);if(C){const N=this.sessionDesc.mediaDescriptions.indexOf(C);this.sessionDesc.mediaDescriptions[N]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}updateRemoteCodec(r,o,a){const l=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(b=>b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").filter(b=>{var C;return he(C=Object.keys(vR)).call(C,b)}))],d=new Set(o);if(l.every(b=>d.has(b)))return T.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(o)),!1;const h=this._rtpCapabilities.recv.videoCodecs.filter(b=>o.some(C=>{var N;return he(N=b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").call(N,C)}));if(0===h.length)return T.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(l," codecs: ").concat(o)),!1;const p=[...new Set(h.map(b=>b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||""))];let m;if(T.debug("updateRemoteCodec, from ".concat(l," to ").concat(p)),0===r.length)m=this.sessionDesc.mediaDescriptions.filter(b=>"video"===b.media.mediaType&&"recvonly"===b.attributes.direction);else if(m=this.sessionDesc.mediaDescriptions.filter(b=>b.attributes.mid&&he(r).call(r,b.attributes.mid)&&"recvonly"===b.attributes.direction),m.length!==r.length)return T.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(r,", codecs: ").concat(o)),!1;if(V("USE_PUB_RTX")||V("USE_SUB_RTX")){const b=YA(h,this.rtpCapabilities.recv.videoCodecs);h.push(...b)}this._rtpCapabilities.recv.videoCodecs=h;const y=xo(_e.VIDEO,this.rtpCapabilities.recv,this.localCapabilities.send,a);return m.forEach(b=>{const C=y.map(N=>N.payloadType.toString(10));T.debug("updateRemoteCodec mid: ".concat(b.attributes.mid,", from"),b.attributes.payloads,"to",y),b.attributes.payloads=y,b.media.fmts=C}),!0}createOrRecycleSendMedia(r,o,a,l,d){const h=this.rtpCapabilities.send,p=r===_e.VIDEO?h.videoCodecs:h.audioCodecs,m=r===_e.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const g="".concat(this.currentMidIndex);let v={media:{mediaType:r,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:o,ssrcGroups:a,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:l,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};v=this.mungSendMediaDesc(v,d);const y=this.findFirstClosedMedia(r);if(y){const b=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[b]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(r=>"0"!==r.media.port).map(r=>r.attributes.mid)}mungRecvMediaDsec(r,o,a){const l=Vn(r);return KA(l),Hf(l,o),qA(l,o),av(l),qS(l,a,this.localCapabilities.send),l}mungSendMediaDesc(r,o){const a=Vn(r);return qS(a,o,this.localCapabilities.recv),Ol(a),a}updateRecvMedia(r,o){const a=this.sessionDesc.mediaDescriptions.findIndex(l=>l.attributes.mid===r);if(-1!==a){const l=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],o);this.sessionDesc.mediaDescriptions[a]=l}}bumpMid(r){this.currentMidIndex+=r}findFirstClosedMedia(r){return this.sessionDesc.mediaDescriptions.find(o=>hn()?"0"===o.media.port&&o.media.mediaType===r:"0"===o.media.port)}findPreloadMediaDesc(r){return this.sessionDesc.mediaDescriptions.find(o=>{var a;return(null===(a=o.attributes)||void 0===a||null===(a=a.ssrcs[0])||void 0===a?void 0:a.ssrcId)===r[0].ssrcId})}getSSRC(r){var o;return null===(o=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===r))||void 0===o?void 0:o.attributes.ssrcs}}function hH(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function Wd(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?hH(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):hH(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}let oC=function(n){return n.BANDWIDTH="bandwidth",n.CPU="cpu",n.NONE="none",n.OTHER="other",n}({});var zd=function(n){return n[n.DOWN=0]="DOWN",n[n.UP=1]="UP",n}(zd||{});const yv=new Map;function ID(n,r,o,a){let{scale:l}=n;if(0===l&&a===zd.UP||l>=r.length-1&&a===zd.DOWN)return n;let d=Wd(Wd({},n),{},{scale:a===zd.DOWN?++l:--l});switch(o){case"maintain-framerate":d=Wd(Wd({},d),r[l].motion);break;case"maintain-resolution":d=Wd(Wd({},d),r[l].detail);break;case"balanced":d=Wd(Wd({},d),r[l].balanced)}return d}function H2(n,r){if(r){const o={overUse:0,underUse:0,adaptationList:wD(r)};yv.set(n,o)}else yv.delete(n)}function wD(n){const r=Wd({},n),{bitrateMax:o,frameRate:a,scaleResolutionDownBy:l,bitrateMin:d}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:p,MAX_SCALE:m,BITRATE_MIN_THRESHOLD:g,BITRATE_MAX_THRESHOLD:v,BWE_SCALE_UP_THRESHOLD:y,BWE_SCALE_DOWN_THRESHOLD:b,PERF_SCALE_DOWN_THRESHOLD:C,PERF_SCALE_UP_THRESHOLD:N,BALANCE_BITRATE_FACTOR:R,BALANCE_FRAMERATE_FACTOR:A,BALANCE_RESOLUTION_FACTOR:D,MOTION_RESOLUTION_FACTOR:M,MOTION_BITRATE_FACTOR:x,DETAIL_FRAMERATE_FACTOR:j,DETAIL_BITRATE_FACTOR:W}=gR,q=Math.min(r.frameRate,p),ee=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(b,1)*o),bwe_up:o,fps_down:Math.round(Math.pow(C,1)*q),fps_up:a},balanced:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:o,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:o,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:o,bitrateMin:d}}];for(let J=1;J<=m;J++){const X={bwe_up:Math.round(Math.pow(y,J)*o),bwe_down:Math.round(Math.pow(b,J+1)*o),fps_up:Math.round(Math.pow(N,J)*q),fps_down:Math.round(Math.pow(C,J+1)*q)},Ce={scaleResolutionDownBy:l/Math.pow(D,J),frameRate:Math.max(Math.round(Math.pow(A,J)*a),h),bitrateMax:Math.max(Math.round(Math.pow(R,J)*o),v),bitrateMin:Math.max(Math.round(Math.pow(R,J)*d),g)},Re={scaleResolutionDownBy:l/Math.pow(M,J),frameRate:a,bitrateMax:Math.max(Math.round(Math.pow(x,J)*o),v),bitrateMin:Math.max(Math.round(Math.pow(x,J)*d),g)},ut={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(j,J)*a),h),bitrateMax:Math.max(Math.round(Math.pow(W,J)*o),v),bitrateMin:Math.max(Math.round(Math.pow(W,J)*d),g)};ee.push({scale:J,threshold:X,balanced:Ce,motion:Re,detail:ut})}return ee}function pH(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function G2(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?pH(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):pH(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}const RD=new Map;function AD(n,r){const o=RD.get(n);if(o){const{timer:a}=o;window.clearTimeout(a),RD.delete(n)}r.qualityLimitationReason=oC.NONE,H2(n)}var it;function fH(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function Ml(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?fH(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):fH(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}let Ba=(it=class KO extends MR{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,o;return null!==(r=null===(o=this.peerConnection.getReceivers()[0])||void 0===o||null===(o=o.transport)||void 0===o?void 0:o.state)&&void 0!==r?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var o;return he(o=Object.keys(vR)).call(o,r)}))]}constructor(r,o){super(r,o),O(this,"store",void 0),O(this,"peerConnection",void 0),O(this,"id",Ct(5,"connection-")),O(this,"remoteSDP",void 0),O(this,"initialOffer",void 0),O(this,"transportEventReceiver",void 0),O(this,"statsFilter",void 0),O(this,"extension",{useXR:V("USE_XR")}),O(this,"localCapabilities",void 0),O(this,"remoteCodecs",void 0),O(this,"localCandidateCount",0),O(this,"allCandidatesReceived",!1),O(this,"isPreallocation",!1),O(this,"preSSRCMap",new Map),O(this,"dataStreamChannelMap",new Map),O(this,"establishPromise",void 0),O(this,"recoveredDataChannelIds",[]),O(this,"currentDataChannelId",1),O(this,"mutex",void 0),O(this,"qualityLimitationReason",oC.NONE),this.store=o,this.mutex=new Qi("P2PConnection-mutex",o.clientId),this.peerConnection=new RTCPeerConnection(KO.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=tC(this.peerConnection,V("STATS_UPDATE_INTERVAL"),void 0,hn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){const o=this.preSSRCMap.get(r);if(void 0!==o){const a=this.peerConnection.getTransceivers().find(l=>l.mid===o);if(a)return{transceiver:a,track:a.receiver.track,id:o}}}updateRemoteRTPCapabilities(r,o){var a=this;return L(function*(){if(a.remoteCodecs=o,a.remoteSDP)if(a.remoteSDP.updateRemoteCodec(r,o,a.store.codec)){const l=yield a.peerConnection.createOffer(),d=a.logSDPExchange(l.sdp||"","offer","local","muteLocal");yield a.peerConnection.setLocalDescription(l);const h=a.remoteSDP.toString();d?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}else T.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else T.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(a.localCodecs,", codecs: ").concat(o))})()}establish(){var r=this;return L(function*(){try{r.peerConnection.addTransceiver("video",{direction:"recvonly"}),r.peerConnection.addTransceiver("audio",{direction:"recvonly"});const a=yield r.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const l=Bd(a.sdp),d=yield Tn({filterRTX:!V("USE_PUB_RTX")&&!V("USE_SUB_RTX"),filterVideoFec:V("FILTER_VIDEO_FEC"),filterAudioFec:V("FILTER_AUDIO_FEC"),filterVideoCodec:V("FILTER_VIDEO_CODEC")},r.extension);let h;return r.localCapabilities=ea(d),r.initialOffer=a,a.sdp&&cv(a.sdp)&&(h=Vn(d),(o=h).send&&(ov(_e.VIDEO,o.send.videoExtensions),ov(_e.AUDIO,o.send.audioExtensions)),o.recv&&(ov(_e.VIDEO,o.recv.videoExtensions),ov(_e.AUDIO,o.recv.audioExtensions)),o.sendrecv&&(ov(_e.VIDEO,o.sendrecv.videoExtensions),ov(_e.AUDIO,o.sendrecv.audioExtensions))),Ml(Ml({},l),{},{rtpCapabilities:h||d,offerSDP:a.sdp})}catch(a){throw new Y(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}var o})()}connect(r){var o=this;return L(function*(){try{if(!o.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");o.initialOffer.sdp&&cv(o.initialOffer.sdp)&&(l=o.localCapabilities,(a=r.rtpCapabilities).send&&(WA(_e.VIDEO,a.send.videoExtensions,l.send.videoExtensions),WA(_e.AUDIO,a.send.audioExtensions,l.send.audioExtensions)),a.recv&&(WA(_e.VIDEO,a.recv.videoExtensions,l.recv.videoExtensions),WA(_e.AUDIO,a.recv.audioExtensions,l.recv.audioExtensions))),o.remoteSDP=new j2(Ml(Ml({},r),{},{localCapabilities:o.localCapabilities})),r.preallocation&&(o.isPreallocation=!0),Array.isArray(o.remoteCodecs)&&o.remoteCodecs.length>0&&o.remoteSDP.updateRemoteCodec([],o.remoteCodecs,o.store.codec);const d=o.remoteSDP.toString(),h=ci(o.initialOffer.sdp,o.extension),p=o.logSDPExchange(h||"","offer","local","connect");o.store.descriptionStart(),yield o.peerConnection.setLocalDescription({type:"offer",sdp:h}),p?.(d),yield o.peerConnection.setRemoteDescription({type:"answer",sdp:d});const m=o.peerConnection.getTransceivers()[0];if(null!=m&&m.receiver&&o.tryBindTransportEvents(m.receiver),V("PRELOAD_MEDIA_COUNT")>0){o.remoteSDP.preloadRemoteMedia(V("PRELOAD_MEDIA_COUNT"));const v=o.remoteSDP.toString();yield o.peerConnection.setRemoteDescription({type:"offer",sdp:v});const y=yield o.peerConnection.createAnswer();yield o.peerConnection.setLocalDescription(y)}const{preSSRCs:g}=r;if(Array.isArray(g)&&g.length>0){const{mids:v}=o.remoteSDP.batchSend(g.map(y=>({kind:y.kind,ssrcMsg:[{ssrcId:y.ssrcId,rtx:y.rtx}],mslabel:y.mslabel})));v.forEach((y,b)=>{o.preSSRCMap.set(g[b].ssrcId,y)}),yield xi(o.peerConnection,o.remoteSDP,o.extension),T.debug("[".concat(o.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(d){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(d.toString()))}var a,l})()}updateRemoteConnect(r){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:a}=r;o.remoteSDP.updateRemoteRTPCapabilities(a),Array.isArray(o.remoteCodecs)&&o.remoteCodecs.length>0&&o.remoteSDP.updateRemoteCodec([],o.remoteCodecs,o.store.codec);const{preSSRCs:l}=r;if(Array.isArray(l)&&l.length>0){const{mids:d}=o.remoteSDP.batchSend(l.map(h=>Object.assign({},{kind:h.kind,ssrcMsg:[{ssrcId:h.ssrcId,rtx:h.rtx}],mslabel:h.mslabel})));d.forEach((h,p)=>{o.preSSRCMap.set(l[p].ssrcId,h)})}yield xi(o.peerConnection,o.remoteSDP,o.extension),T.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(a.toString()))}})()}send(r,o,a){var l=this;return ns(function*(){const d=yield tt(l.mutex.lock("From P2PConnection.send"));try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[];r.forEach(R=>{const A=l.peerConnection.addTransceiver(R._mediaStreamTrack,{direction:"sendonly"});h.push(A),R._updateRtpTransceiver(A)}),hn()&&!0===V("SIMULCAST")&&(yield tt(l.applySimulcastForFirefox(h,r)));const p=yield tt(l.peerConnection.createOffer()),m=l.remoteSDP.predictReceivingMids(r.length),g=l.mungSendOfferSDP(p.sdp,r,m),v=Ei.parse(g),y=m.map(R=>{const A=v.mediaDescriptions.find(D=>D.attributes.mid===R);if(!A)throw new Error("Cannot extract ssrc from mediaDescription.");return G5(A,V("USE_PUB_RTX"))});let b;try{b=yield y}catch(R){b=[],l.remoteSDP.receive(r,o,a,b);const A=l.remoteSDP.toString();throw yield tt(l.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield tt(l.peerConnection.setRemoteDescription({type:"answer",sdp:A})),yield tt(l.stopSending(m,!0)),R}l.remoteSDP.receive(r,o,a,b);const C=l.remoteSDP.toString(),N=l.logSDPExchange(g,"offer","local","send");return yield tt(l.peerConnection.setLocalDescription({type:"offer",sdp:g})),yield tt(l.applySimulcastEncodings(h,r)),yield tt(l.applySendEncodings(h,r)),N?.(C),yield tt(l.peerConnection.setRemoteDescription({type:"answer",sdp:C})),h.map((R,A)=>({localSSRC:y[A],id:m[A],transceiver:R}))}catch(h){throw h instanceof Y?h:new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}createDataChannels(r,o){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let l=a.dataStreamChannelMap.get(r);if(l&&"open"===l.readyState)T.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const h=a.currentDataChannelId<1023?a.currentDataChannelId++:a.recoveredDataChannelIds.shift();if("number"!=typeof h)throw new Error("create DataChannel error, because cannot get dc id");l=a.peerConnection.createDataChannel("datastream-channel",{id:h,negotiated:!0,ordered:!1,maxRetransmits:V("DATASTREAM_MAX_RETRANSMITS")}),l.binaryType="arraybuffer",a.dataStreamChannelMap.set(r,l)}o.forEach(h=>{h._updateOriginDataChannel(l)});const{needExchangeSDP:d}=a.remoteSDP.sendDataChannel();if(d){const h=a.remoteSDP.toString();yield a.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=yield a.peerConnection.createAnswer();yield a.peerConnection.setLocalDescription(p),T.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else T.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(l){throw l instanceof Y?l:new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(l.toString()))}})()}stopDataChannels(r){var o=this;return L(function*(){try{const a=o.dataStreamChannelMap.get(r);return a&&(a.id&&o.recoveredDataChannelIds.push(a.id),a.close()),void o.dataStreamChannelMap.delete(r)}catch(a){throw a instanceof Y?a:new Y(k.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(a.toString()))}})()}stopSending(r,o){var a=this;return L(function*(){const l=o?void 0:yield a.mutex.lock("From P2PConnection.stopSending");try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const d=a.peerConnection.getTransceivers().filter(g=>-1!==r.indexOf(g.mid));if(d.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");d.map(g=>{var v;AD(a.id+g.mid,a),g.direction="inactive",null===(v=g.stop)||void 0===v||v.call(g)});const h=yield a.peerConnection.createOffer(),p=a.logSDPExchange(h.sdp||"","offer","local","stopSending");yield a.peerConnection.setLocalDescription(h),a.remoteSDP.stopReceiving(r);const m=a.remoteSDP.toString();p?.(m),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{l&&l()}})()}receive(r,o,a,l){var d=this;return L(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=d.remoteSDP.send(r,o,a,l);p&&(yield xi(d.peerConnection,d.remoteSDP,d.extension),T.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=d.peerConnection.getTransceivers().find(g=>g.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h,transceiver:m}}catch(h){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(r){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:a,needExchangeSDP:l}=o.remoteSDP.batchSend(r);return l&&(yield xi(o.peerConnection,o.remoteSDP,o.extension),T.debug("[".concat(o.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),a.map(d=>{const h=o.peerConnection.getTransceivers().find(p=>p.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d,transceiver:h}})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}})()}stopReceiving(r){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(h=>{Array.from(o.preSSRCMap.entries()).some(p=>{let[m,g]=p;if(g===h)return o.preSSRCMap.delete(m),!0})}),o.remoteSDP.stopSending(r);const a=o.remoteSDP.toString(),l=o.logSDPExchange(a,"offer","remote","stopReceiving");yield o.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield o.peerConnection.createAnswer();l?.(d.sdp||""),yield o.peerConnection.setLocalDescription(d)}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}})()}muteRemote(r){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));o.remoteSDP.mute(r);const a=o.remoteSDP.toString(),l=o.logSDPExchange(a,"offer","remote","muteRemote");yield o.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield o.peerConnection.createAnswer();l?.(d.sdp||""),yield o.peerConnection.setLocalDescription(d)}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(a.toString()))}})()}unmuteRemote(r){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));o.remoteSDP.unmute(r);const a=o.remoteSDP.toString(),l=o.logSDPExchange(a,"offer","remote","unmuteRemote");yield o.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=yield o.peerConnection.createAnswer();l?.(d.sdp||""),yield o.peerConnection.setLocalDescription(d)}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(a.toString()))}})()}muteLocal(r){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=o.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==r.indexOf(p.mid));if(a.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(p=>{p.direction="inactive"});const l=yield o.peerConnection.createOffer(),d=o.logSDPExchange(l.sdp||"","offer","local","muteLocal");yield o.peerConnection.setLocalDescription(l),o.remoteSDP.muteRemote(r);const h=o.remoteSDP.toString();d?.(h),yield o.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}})()}unmuteLocal(r){var o=this;return L(function*(){try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=o.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==r.indexOf(p.mid));if(a.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(function(){var p=L(function*(m,g){m.direction="sendonly"});return function(m,g){return p.apply(this,arguments)}}());const l=yield o.peerConnection.createOffer(),d=o.logSDPExchange(l.sdp||"","offer","local","unmuteLocal");yield o.peerConnection.setLocalDescription(l),o.remoteSDP.unmuteRemote(r);const h=o.remoteSDP.toString();d?.(h),yield o.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new Y(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}})()}restartICE(r){var o=this;return ns(function*(){const a=yield tt(o.mutex.lock("From P2PConnection.restartICE"));try{if(!o.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ct().supportPCSetConfiguration){const g=o.peerConnection.getConfiguration(),v=r===po.RELAY?"relay":"all";g.iceTransportPolicy!==v&&(T.debug("[".concat(o.store.clientId,"] restartICE change iceTransportPolicy from [").concat(g.iceTransportPolicy,"] to [").concat(v,"]")),g.iceTransportPolicy=v,o.peerConnection.setConfiguration(g))}else if(r===po.RELAY)return;o.remoteSDP.updateCandidates(r);const l=yield tt(o.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Bd(l.sdp),{remoteIceParameters:h}=yield d.iceParameters;o.remoteSDP.restartICE(h);const p=o.remoteSDP.toString(),m=o.logSDPExchange(l.sdp||"","offer","local","restartICE");o.store.descriptionStart(),yield tt(o.peerConnection.setLocalDescription(l)),m?.(p),yield tt(o.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(l){T.warning("[".concat(o.store.clientId,"] restart ICE failed, abort operation"),l)}finally{a()}})()}close(){var r;this.peerConnection.getTransceivers().forEach(o=>{AD(this.id+o.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),null===(r=this.onConnectionStateChange)||void 0===r||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Ml(Ml({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}updateEncoderConfig(r,o){var a=this;return L(function*(){try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const l=yield a.peerConnection.createOffer(),d=a.mungSendOfferSDP(l.sdp,[o],[r]);a.remoteSDP.updateRecvMedia(r,o);const h=a.remoteSDP.toString(),p=a.logSDPExchange(d,"offer","local","updateEncoderConfig");yield a.peerConnection.setLocalDescription({type:"offer",sdp:d}),p?.(h),yield a.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(l){throw new Y(k.EXCHANGE_SDP_FAILED,l.toString())}})()}updateSendParameters(r,o){var a=this;return L(function*(){const l=a.peerConnection.getTransceivers().filter(d=>d.mid===r);1===l.length&&(a.isVP8Simulcast(o)?hn()||(yield a.applySimulcastEncodings(l,[o])):yield a.applySendEncodings(l,[o]))})()}setStatsRemoteVideoIsReady(r,o){this.statsFilter.setVideoIsReady2(r,o)}replaceTrack(r,o){var a=this;return L(function*(){const l=a.peerConnection.getTransceivers().find(d=>d.mid===o);l&&(yield l.sender.replaceTrack(r._mediaStreamTrack))})()}getSelectedCandidatePair(){var r=this;return L(function*(){const o=r.peerConnection.getReceivers();if(o.length>0&&o[0].transport&&o[0].transport.iceTransport&&o[0].transport.iceTransport.getSelectedCandidatePair&&o[0].transport.iceTransport.getSelectedCandidatePair()){const a=o[0].transport.iceTransport,{local:l,remote:d}=a.getSelectedCandidatePair();return{local:Ml(Ml({},Rc),{},{candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port}),remote:Ml(Ml({},Rc),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return r.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;null===(r=this.onICEConnectionStateChange)||void 0===r||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;null===(r=this.onConnectionStateChange)||void 0===r||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},V("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const o={iceServers:[]};return r.iceServers?o.iceServers=r.iceServers:r.turnServer&&"off"!==r.turnServer.mode&&(nS(r.turnServer.servers)?o.iceServers=r.turnServer.servers:(o.iceServers&&o.iceServers.push(...KO.turnServerConfigToIceServers(r.turnServer.servers)),V("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&r.turnServer.serversFromGateway&&o.iceServers.push(...KO.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),V("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(o.iceTransportPolicy="relay")}))),V("ENABLE_ENCODED_TRANSFORM")&&ct().supportWebRTCEncodedTransform&&(o.encodedInsertableStreams=!0),o}static turnServerConfigToIceServers(r){const o=[];return r.forEach(a=>{a.security?a.tcpport&&o.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(mh(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!V("FORCE_TURN_TCP")&&o.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&o.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),o}tryBindTransportEvents(r){const o=r.transport;if(o){this.transportEventReceiver=r,o.onstatechange=()=>{var l;null!=o&&o.state&&(null===(l=this.onDTLSTransportStateChange)||void 0===l||l.call(this,o.state))},o.onerror=l=>{var d;null===(d=this.onDTLSTransportError)||void 0===d||d.call(this,"error"in l?l.error:l)};const a=o.iceTransport;a&&(a.onstatechange=()=>{const l=o?.iceTransport.state;var d;l&&(null===(d=this.onICETransportStateChange)||void 0===d||d.call(this,l))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:l,remote:d}=a.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(r,o){var a=this;return L(function*(){var l,d;if(o||(o=a.peerConnection.getSenders().find(D=>D.track===r._mediaStreamTrack)),!o)return T.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(a.isVP8Simulcast(r))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ct().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const h={},p={};switch(r._optimizationMode){case"motion":h.degradationPreference="maintain-framerate";break;case"detail":h.degradationPreference="maintain-resolution";break;case"balanced":h.degradationPreference="balanced"}const m=(D=r._mediaStreamTrack,a.peerConnection.getTransceivers().find(M=>M.sender.track===D||M.receiver.track===D)),g=(n=>{const r=n._encoderConfig;if(!r)return;const{frameRate:o,width:a,height:l}=n.getMediaStreamTrackSettings();let{frameRate:d=o,width:h=a,height:p=l}=r;if(!d||!h||!p)return;h=rS(h),p=rS(p),d=rS(d);const{max:m,min:g}=function(C,N,R){const A=200*Math.pow(R/15,.6)*Math.pow(C*N/640/360,.75);return{min:Math.floor(A),max:Math.floor(4*A)}}(h,p,d),{bitrateMax:v,bitrateMin:y}=r||{};v||T.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(p,", fps: ").concat(d,"] => [brMax: ").concat(v,", brMin: ").concat(y,"]"));const{maxFramerate:b}=V("ENCODER_CONFIG_LIMIT");return b&&"number"==typeof b&&(d=Math.min(d,b)),{frameRate:d,bitrateMax:v||m,bitrateMin:y||g,scaleResolutionDownBy:1,scale:0}})(r);var D;if(function KW(n){var r;return!(!V("ENABLE_AG_ADAPTATION")||!(n instanceof VS||he(r=n._hints).call(r,zt.CUSTOM_TRACK))||!V("FORCE_SUPPORT_AG_ADAPTATION")&&!(function(){const a=ot();if(a.os!==pi.IOS||!a.osVersion)return!1;const l=a.osVersion.split(".");return Number(l[0])>=14}()&&Ws(17,4,!0)||Oa(14)&&zs(17,4,!0)))}(r)&&m&&o&&g&&a.getLocalVideoStats&&he(l=["vp8","vp9"]).call(l,a.store.codec)){var v;const A=h.degradationPreference||(he(v=r._hints).call(v,zt.CUSTOM_TRACK)?V("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");!function(D,M,x,j,W,q){if(AD(D,x),W(M),"balanced"!==j&&"maintain-framerate"!==j&&"maintain-resolution"!==j)return;let ee=-1;H2(D,M);const J=window.setInterval(()=>{const Ce=RD.get(D);if(!V("ENABLE_AG_ADAPTATION")||!Ce)return AD(D,x),void W(M);const Re=q();if(Re.sendPackets>0&&Re.OutgoingAvailableBandwidth>0){if(-1===ee)return void(ee=Date.now());if(Date.now()-ee<1e3)return;const ut=Re.sendFrameRate,Nt=Re.OutgoingAvailableBandwidth,[_n,Zt]=function $f(n,r,o,a,l,d){const h=yv.get(n)||{overUse:0,underUse:0,adaptationList:wD(l)},{adaptationList:p}=h;yv.set(n,h);const{OVERUSE_TIMES_THRESHOLD:m,UNDERUSE_TIMES_THRESHOLD:g}=gR,{scale:v}=a;let y,b;return"number"==typeof r&&r>0&&function(C,N,R,A){if(N>=R.length)return!1;let{threshold:{fps_down:D}}=R[N];return V("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===A&&(D=R[0].threshold.fps_down),C<D}(r,v,p,d)&&(h.overUse++,b=oC.CPU,h.overUse>m)||"number"==typeof o&&o>0&&function(C,N,R){if(N>=R.length)return!1;const{threshold:{bwe_down:A}}=R[N];return C<A}(o,v,p)&&(h.overUse++,b=oC.BANDWIDTH,h.overUse>m)?(h.overUse=0,h.underUse=0,y=ID(a,p,d,zd.DOWN),[y,b]):("number"==typeof r&&r>0&&"number"==typeof o&&o>0&&function(C,N,R,A){if(0===N)return;let{threshold:{fps_up:D}}=R[N];return V("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===A&&(D=R[1].threshold.fps_up),C>D}(r,v,p,d)&&function(C,N,R){if(0===N)return;const{threshold:{bwe_up:A}}=R[N];return C>A}(o,v,p)&&(h.underUse++,h.underUse>g&&(h.overUse=0,h.underUse=0,y=ID(a,p,d,zd.UP),0===y.scale&&(b=oC.NONE))),[y,b])}(D,ut,Nt,Ce.adaptationConfig,M,j);Zt&&(x.qualityLimitationReason=Zt),_n&&Ce.adaptationConfig.scale!==_n.scale&&(T.debug("[".concat(D,"] applyAdaptation: ").concat(x.qualityLimitationReason,"\n           sendFps ").concat(ut,", bwe ").concat(Nt,", switch from ").concat(Ce.adaptationConfig.scale," to ").concat(_n.scale," ")),Ce.adaptationConfig=G2(G2({},Ce.adaptationConfig),_n),W(_n))}},V("CHECK_LOCAL_STATS_INTERVAL")),X=G2({},M);RD.set(D,{timer:J,adaptationConfig:X,originConfig:M,adaptationFunc:W}),T.debug("[".concat(D,"] start adaptation, originConfig: ").concat(JSON.stringify(M),", degradationPreference: ").concat(j))}(a.id+m.mid,g,a,A,D=>{o&&a.updateAdaptation(o,D)},a.getLocalVideoStats.bind(a))}if(r._encoderConfig){var y;const{bitrateMax:A,frameRate:D,scaleResolutionDownBy:M}=r._encoderConfig;A&&(p.maxBitrate=1e3*A),(he(y=r._hints).call(y,zt.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(D&&(p.maxFramerate=Mr(D)),M&&M>=1&&(p.scaleResolutionDownBy=M))}const{maxFramerate:b}=V("ENCODER_CONFIG_LIMIT");if(b&&"number"==typeof b&&(p.maxFramerate=p.maxFramerate?Math.min(p.maxFramerate,b):b),V("DSCP_TYPE")&&hl()){var C;const A=V("DSCP_TYPE");he(C=["very-low","low","medium","high"]).call(C,A)&&(p.networkPriority=A)}const N=o.getParameters(),R=null===(d=N.encodings)||void 0===d?void 0:d[0];var A;hn()&&!R&&(h.encodings=[p]),R&&Object.assign(R,p),Object.assign(N,h),T.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(N.encodings))),yield o.setParameters(N),yield(A=L(function*(D,M,x){try{var j;if(!ct().supportSetRtpSenderParameters||!function(X){return"vp9"===X}(D)||!V("ENABLE_SVC"))return;const W={},q={},ee=M.getParameters(),J=null===(j=ee.encodings)||void 0===j?void 0:j[0];q.scalabilityMode=ds(x),J&&Object.assign(J,q),Object.assign(ee,W),yield M.setParameters(ee),T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(ee.encodings)))}catch(W){T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",W)}}),function(D,M,x){return A.apply(this,arguments)})(a.store.codec,o,V("SVC_MODE"))})()}updateAdaptation(r,o){var a=this;return L(function*(){var l,d;if(!r)return T.debug("[updateAdaptation] no rtpSender found");if(!ct().supportSetRtpSenderParameters)return T.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const h={},{bitrateMax:p,frameRate:m,scaleResolutionDownBy:g}=o;p&&(h.maxBitrate=1e3*p),m&&(h.maxFramerate=Mr(m)),g&&g>=1&&he(l=["vp8","vp9"]).call(l,a.store.codec)&&(h.scaleResolutionDownBy=g);const v=r.getParameters(),y=null===(d=v.encodings)||void 0===d?void 0:d[0];y&&Object.assign(y,h),Object.assign(v,{});try{yield r.setParameters(v),T.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(b){!("transport"in r)||r.transport&&"connected"===r.transport.state?"connected"!==a.peerConnectionState?T.debug("[updateAdaptation] peerConnection not connected}"):T.debug("[updateAdaptation] updateRtpSenderEncodings failed",b):T.debug("[updateAdaptation] rtpSender transport not connected}")}})()}applySendEncodings(r,o){var a=this;return L(function*(){try{if(!ct().supportSetRtpSenderParameters||r.length!==o.length)return;for(let l=0;l<r.length;l++){const d=r[l],h=o[l];h instanceof Ve&&!a.isVP8Simulcast(h)&&(yield a.updateRtpSenderEncodings(h,d.sender))}}catch{T.debug("[".concat(a.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(r,o,a){const l=Ei.parse(r);return o.forEach((d,h)=>{const p=a[h],m=l.mediaDescriptions.find(g=>g.attributes.mid===p);m&&(Hf(m,d),wc(m,d,this.store.codec))}),Ei.print(l)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var o;null===(o=this.onFirstAudioReceived)||void 0===o||o.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var o;null===(o=this.onFirstVideoReceived)||void 0===o||o.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var o;null===(o=this.onFirstAudioDecoded)||void 0===o||o.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,o,a)=>{var l;null===(l=this.onFirstVideoDecoded)||void 0===l||l.call(this,r,o,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,o)=>{var a;null===(a=this.onSelectedLocalCandidateChanged)||void 0===a||a.call(this,r,o)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,o)=>{var a;null===(a=this.onSelectedRemoteCandidateChanged)||void 0===a||a.call(this,r,o)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var o;null===(o=this.onFirstVideoDecodedTimeout)||void 0===o||o.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(r,o){var a=this;return L(function*(){if(r.length===o.length)for(let g=0;g<r.length;g++){var l,d,h,p,m;const v=r[g],y=o[g];if(y instanceof Ve&&!he(l=y._hints).call(l,zt.LOW_STREAM)&&null!==(d=y._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=y._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=y._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=y._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===a.store.codec){const b={},C={high:1e3*(y._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:C.high}];const N=v.sender.getParameters();yield v.sender.setParameters(Object.assign(N,b))}}})()}applySimulcastEncodings(r,o){var a=this;return L(function*(){if(!hn()&&r.length===o.length)for(let l=0;l<r.length;l++){const d=o[l];if(d instanceof Ve&&a.isVP8Simulcast(d)){const h=r[l],p={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=h.sender.getParameters();yield h.sender.setParameters(Object.assign(g,p))}}})()}isVP8Simulcast(r){var o,a,l,d,h;return!!(r instanceof Ve&&V("SIMULCAST")&&"vp8"===this.store.codec&&!he(o=r._hints).call(o,zt.LOW_STREAM)&&null!==(a=r._encoderConfig)&&void 0!==a&&a.bitrateMax&&(null===(l=r._encoderConfig)||void 0===l?void 0:l.bitrateMax)>200&&null!==(d=r._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=r._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,o,a,l){if(V("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(o," SDP during P2PConnection.").concat(l,"\n"),r),"offer"===o?d=>{this.logSDPExchange(d,"answer","local"===a?"remote":"local",l)}:void 0}getRemoteSSRC(r){var o=this;return L(function*(){if(!o.remoteSDP)return;const a=o.remoteSDP.getSSRC(r);return a&&0!==a.length?a[0].ssrcId:void 0})()}setConfiguration(r){if(ct().supportPCSetConfiguration){const o=KO.resolvePCConfiguration(r);this.peerConnection.setConfiguration(o)}}},pe(it.prototype,"updateRemoteRTPCapabilities",[Kr],Object.getOwnPropertyDescriptor(it.prototype,"updateRemoteRTPCapabilities"),it.prototype),pe(it.prototype,"connect",[Kr],Object.getOwnPropertyDescriptor(it.prototype,"connect"),it.prototype),pe(it.prototype,"updateRemoteConnect",[Kr],Object.getOwnPropertyDescriptor(it.prototype,"updateRemoteConnect"),it.prototype),pe(it.prototype,"createDataChannels",[Kr],Object.getOwnPropertyDescriptor(it.prototype,"createDataChannels"),it.prototype),pe(it.prototype,"receive",[Kr],Object.getOwnPropertyDescriptor(it.prototype,"receive"),it.prototype),pe(it.prototype,"batchReceive",[Kr],Object.getOwnPropertyDescriptor(it.prototype,"batchReceive"),it.prototype),pe(it.prototype,"stopReceiving",[Kr],Object.getOwnPropertyDescriptor(it.prototype,"stopReceiving"),it.prototype),pe(it.prototype,"muteRemote",[Kr],Object.getOwnPropertyDescriptor(it.prototype,"muteRemote"),it.prototype),pe(it.prototype,"unmuteRemote",[Kr],Object.getOwnPropertyDescriptor(it.prototype,"unmuteRemote"),it.prototype),pe(it.prototype,"muteLocal",[Kr],Object.getOwnPropertyDescriptor(it.prototype,"muteLocal"),it.prototype),pe(it.prototype,"unmuteLocal",[Kr],Object.getOwnPropertyDescriptor(it.prototype,"unmuteLocal"),it.prototype),pe(it.prototype,"close",[Kr],Object.getOwnPropertyDescriptor(it.prototype,"close"),it.prototype),pe(it.prototype,"updateEncoderConfig",[Kr],Object.getOwnPropertyDescriptor(it.prototype,"updateEncoderConfig"),it.prototype),pe(it.prototype,"updateSendParameters",[Kr],Object.getOwnPropertyDescriptor(it.prototype,"updateSendParameters"),it.prototype),pe(it.prototype,"replaceTrack",[Kr],Object.getOwnPropertyDescriptor(it.prototype,"replaceTrack"),it.prototype),pe(it.prototype,"updateAdaptation",[Kr],Object.getOwnPropertyDescriptor(it.prototype,"updateAdaptation"),it.prototype),pe(it.prototype,"getRemoteSSRC",[Kr],Object.getOwnPropertyDescriptor(it.prototype,"getRemoteSSRC"),it.prototype),it);function Kr(n,r,o){const a=n[r];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return o.value=L(function*(){const l=this.mutex,d=yield l.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{d()}}),o}var ze;function mH(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function Dc(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?mH(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):mH(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}function gH(n){var r,o,a,l=2;for(typeof Symbol<"u"&&(o=Kb,a=Symbol.iterator);l--;){if(o&&null!=(r=n[o]))return r.call(n);if(a&&null!=(r=n[a]))return new sC(r.call(n));o="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function sC(n){function r(o){if(Object(o)!==o)return le.reject(new TypeError(o+" is not an object."));var a=o.done;return le.resolve(o.value).then(function(l){return{value:l,done:a}})}return(sC=function(o){this.s=o,this.n=o.next}).prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(o){var a=this.s.return;return void 0===a?le.resolve({value:o,done:!0}):r(a.apply(this.s,arguments))},throw:function(o){var a=this.s.return;return void 0===a?le.reject(o):r(a.apply(this.s,arguments))}},new sC(n)}let aC=(ze=class extends nn{get state(){return this._state}set state(n){const r=this._state;this._state=n,this.emit(De.StateChange,r,this._state)}constructor(n,r){var o;super(),o=this,O(this,"isPlanB",void 0),O(this,"store",void 0),O(this,"statsUploader",void 0),O(this,"connection",void 0),O(this,"localTrackMap",new Map),O(this,"remoteUserMap",new Map),O(this,"localDataChannels",[]),O(this,"remoteDataChannelMap",new Map),O(this,"pendingLocalTracks",[]),O(this,"pendingRemoteTracks",[]),O(this,"pendingLocalDataChannels",[]),O(this,"pendingRemoteDataChannels",[]),O(this,"statsCollector",void 0),O(this,"shouldForwardP2PCreation",void 0),O(this,"iceFailedCount",0),O(this,"dtlsFailedCount",0),O(this,"mutex",void 0),O(this,"_state",Dt.Disconnected),O(this,"_pcStatsUploadType",V("NEW_ICE_RESTART")?Sc.FIRST_CONNECTION:Sc.OLD_FIRST_CONNECTION),O(this,"_isInRestartIce",!1),O(this,"_isStartRestartIce",!1),O(this,"_restartStates",["disconnected","failed"]),O(this,"_restartTimer",void 0),O(this,"_isFirstConnected",!0),O(this,"handleMuteLocalTrack",function(){var a=L(function*(l,d,h){const p=yield o.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!o.connection||o.state!==Dt.Connected)return void h(new Y(k.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const m=o.filterTobeMutedTracks(l);if(0===m.length)return void d();const g=m.find(y=>"videoLowTrack"===y[0]);g&&g[1].track._originMediaStreamTrack.stop(),yield o.connection.muteLocal(m.map(y=>{let[,{id:b}]=y;return b}));const v=o.createMuteMessage(m);yield jt(o,De.RequestMuteLocal,v),d()}catch(m){h(m)}finally{p()}});return function(l,d,h){return a.apply(this,arguments)}}()),O(this,"handleUnmuteLocalTrack",function(){var a=L(function*(l,d,h){const p=yield o.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!o.connection||o.state!==Dt.Connected)return void h(new Y(k.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const m=o.filterTobeUnmutedTracks(l);if(0===m.length)return void d();const g=m.find(y=>"videoLowTrack"===y[0]);if(g){const y=g[1];if(y.track._originMediaStreamTrack.stop(),!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&ct().supportDualStreamEncoding){const b=l._mediaStreamTrack.clone();y.track._mediaStreamTrack=b,y.track._originMediaStreamTrack=b}else{const b=D2(l,E_(o,De.RequestLowStreamParameter));y.track._mediaStreamTrack=b,y.track._originMediaStreamTrack=b}yield new le((b,C)=>{o.handleReplaceTrack(y.track,b,C,!0)})}yield o.connection.unmuteLocal(m.map(y=>{let[,{id:b}]=y;return b}));const v=o.createUnmuteMessage(m);yield jt(o,De.RequestUnmuteLocal,v),d()}catch(m){h(m)}finally{p()}});return function(l,d,h){return a.apply(this,arguments)}}()),O(this,"handleUpdateVideoEncoder",function(){var a=L(function*(l,d,h){const p=yield o.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const m=o.localTrackMap.get(Q.LocalVideoTrack);if(!o.connection||!m||m.track!==l||o.state!==Dt.Connected)return void d();const{id:g,track:v}=m;yield o.connection.updateSendParameters(g,v),yield o.connection.updateEncoderConfig(g,v),o.emit(De.UpdateVideoEncoder,v),d()}catch(m){h(m)}finally{p()}});return function(l,d,h){return a.apply(this,arguments)}}()),O(this,"handleUpdateVideoSendParameters",function(){var a=L(function*(l,d,h){const p=yield o.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const m=o.localTrackMap.get(Q.LocalVideoTrack);if(!o.connection||!m||m.track!==l||o.state!==Dt.Connected)return void d();const{id:g,track:v}=m;yield o.connection.updateSendParameters(g,v),d()}catch(m){h(m)}finally{p()}});return function(l,d,h){return a.apply(this,arguments)}}()),O(this,"handleReplaceMixingTrack",function(){var a=L(function*(l,d,h,p){if(!o.connection||o.state!==Dt.Connected)return void d();const m=M2([l]);let g;T.debug("[".concat(o.store.clientId,"] [p2pId: ").concat(o.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(m.getTrackId(),"]")),"boolean"==typeof p&&p||(g=yield o.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{yield o.replaceTrack(l,m),d()}catch(y){h(y)}finally{var v;null===(v=g)||void 0===v||v()}});return function(l,d,h,p){return a.apply(this,arguments)}}()),O(this,"handleReplaceTrack",function(){var a=L(function*(l,d,h,p){let m;T.debug("[".concat(o.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(l.getTrackId(),"]")),"boolean"==typeof p&&p||(m=yield o.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var g;const y=Array.from(o.localTrackMap.entries()).find(b=>{let[,{track:C}]=b;return l===C});if(!o.connection||!y||o.state!==Dt.Connected)return void d();if(yield null===(g=o.connection)||void 0===g?void 0:g.replaceTrack(l,y[1].id),o.isPlanB){const b=y[1];b.id=l._mediaStreamTrack.id,o.localTrackMap.set(y[0],b)}if(y[0]===Q.LocalVideoTrack&&!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&ct().supportDualStreamEncoding){const b=o.localTrackMap.get(Q.LocalVideoLowTrack);if(b){const C=l._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=C,b.track._originMediaStreamTrack=C,yield new le((N,R)=>{o.handleReplaceTrack(b.track,N,R,!0)})}}d()}catch(y){h(y)}finally{var v;null===(v=m)||void 0===v||v()}});return function(l,d,h,p){return a.apply(this,arguments)}}()),O(this,"handleGetRTCStats",a=>{a(this.statsCollector.getRTCStats())}),O(this,"handleGetLocalVideoStats",a=>{a(this.statsCollector.getLocalVideoTrackStats())}),O(this,"handleGetLocalAudioStats",a=>{a(this.statsCollector.getLocalAudioTrackStats())}),O(this,"handleGetRemoteVideoStats",a=>this.statsCollector.getRemoteVideoTrackStats(a.uid)[a.uid]),O(this,"handleGetRemoteAudioStats",a=>this.statsCollector.getRemoteAudioTrackStats(a.uid)[a.uid]),this.store=n,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new nH(this.store),this.bindStatsUploaderEvents(),this.mutex=new Qi("P2PChannel-mutex",this.store.clientId),this.isPlanB=!ct().supportUnifiedPlan||V("CHROME_FORCE_PLAN_B")&&hl(),this.shouldForwardP2PCreation=V("FORWARD_P2P_CREATION")&&ct().supportPCSetConfiguration&&rR(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Ev({},this.store):new Ba({},this.store),this.bindConnectionEvents(this.connection))}startP2PConnection(n){var r=this;return L(function*(){var o;r.state=Dt.New;const a=r.shouldForwardP2PCreation&&"closed"===(null===(o=r.connection)||void 0===o?void 0:o.peerConnectionState);if(r.shouldForwardP2PCreation&&!a||(a&&r.connection&&(T.warning("[".concat(r.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),r.connection.close(),r.unbindConnectionEvents(r.connection)),r.connection=r.isPlanB?new Ev(n,r.store):new Ba(n,r.store),r.bindConnectionEvents(r.connection)),!r.connection)throw new Y(k.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return r._pcStatsUploadType=V("NEW_ICE_RESTART")?Sc.FIRST_CONNECTION:Sc.OLD_FIRST_CONNECTION,r._isFirstConnected=!0,r._isInRestartIce=!1,r._isStartRestartIce=!1,r.connection.setConfiguration(n),r.connection.establishPromise})()}connect(n){var r=this;return L(function*(){if(!r.connection)throw new Y(k.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");V("ENABLE_PREALLOC_PC")&&r.state===Dt.Connected?yield r.connection.updateRemoteConnect(n):(r.store.peerConnectionStart(),yield r.connection.connect(n),r.statsUploader.startUploadTransportStats(),r.statsUploader.startUploadExtensionUsageStats(),r.state=Dt.Connected)})()}updateRemoteRTPCapabilities(n){const r=Array.from(this.localTrackMap.entries()).filter(l=>{var d;let[h]=l;return he(d=[Q.LocalVideoLowTrack,Q.LocalVideoTrack]).call(d,h)}),o=r.map(l=>{let[,{id:d}]=l;return d}),a=r.map(l=>{let[d]=l;return d});if(this.connection instanceof Ba){if(be.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(a),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(n)}),!he(n).call(n,this.store.codec)){const l=["vp9","vp8","h264"].find(d=>he(n).call(n,d));l&&(this.store.codec=l,T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(l,".")))}this.connection.updateRemoteRTPCapabilities(o,n)}}getEstablishParams(){var n=this;return L(function*(){var r;if(n.connection instanceof Ba&&"closed"!==n.connection.peerConnectionState&&he(r=[Dt.New,Dt.Connected]).call(r,n.state))return n.connection.establishPromise})()}publishDataChannel(n){var r=this;return L(function*(){if(!r.connection||r.state!==Dt.Connected){if(r.state===Dt.Disconnected)throw new Y(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return n.forEach(a=>{var l;he(l=r.pendingLocalDataChannels).call(l,a)||r.pendingLocalDataChannels.push(a)}),[]}const o=r.filterTobePublishedDataChannels(n);return 0===o.length?[]:(o.forEach(a=>{const l=Date.now();r.store.publish(a.id.toString(),"datachannel",l)}),yield r.connection.createDataChannels(r.store.uid,o),o.forEach(a=>{r.localDataChannels.push(a);const l=Date.now();r.store.publish(a.id+"","datachannel",void 0,l)}),n.map(a=>({streamId:a.id,ordered:a.ordered,maxRetransmits:a.maxRetransmits,metadata:a.metadata,channelId:a._originDataChannelId})))})()}publish(n,r,o){var a=this;return ns(function*(){const l=yield tt(a.mutex.lock("From P2PChannel.publish"));try{if(!a.connection||a.state!==Dt.Connected){if(a.state===Dt.Disconnected)throw new Y(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");a.throwIfTrackTypeNotMatch(n);const h=n.filter(p=>-1===a.pendingLocalTracks.indexOf(p));return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(h))}a.store.pubId=a.store.pubId+1,tr.markPublishStart(a.store.clientId,a.store.pubId);const d=a.filterTobePublishedTracks(n,r,o);if(0===d.length)return void(yield tt(a.tryToUnmuteAudio(n)));yield*c_(gH(a.doPublish(a.connection,d)))}finally{l()}})()}doPublish(n,r){var o=this;return ns(function*(){r.forEach(y=>{let{track:b,type:C}=y;const N=Date.now();o.store.publish(b.getTrackId(),C===Q.LocalAudioTrack?"audio":"video",N)}),o.bindLocalTrackEvents(r);const a=r.map(y=>{let{track:b}=y;return b}),l=yield tt(n.send(a,o.store.codec,o.store.audioCodec)),d=(yield tt(l.next())).value,h=o.createGatewayPublishMessage(r,d);let p;try{p=yield h}catch(y){throw l.throw(y),y?.code===k.WS_ABORT&&r.forEach(b=>{let{track:C}=b;-1===o.pendingLocalTracks.indexOf(C)&&o.pendingLocalTracks.push(C)}),o.unbindLocalTrackEvents(r),y}const m=o.mapPubResToRemoteConfig(h,p,a),g=(yield tt(l.next(m))).value,v=V("ENABLE_VIDEO_SEI");a.forEach(function(){var y=L(function*(b){const C=b.getRTCRtpTransceiver();var N;C&&v&&(b.trackMediaType===_e.VIDEO?yield function j5(n,r){return GA.apply(this,arguments)}(C.sender,b):b.trackMediaType===_e.AUDIO&&(yield(N=L(function*(R){if(!ct().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(BS.has(R)||!R.track)return;const A={track:R.track};if(lh()){if(!R.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let M=null;try{M=R.createEncodedStreams()}catch(j){return void T.error("create audio-encoded-streams error",j&&j.message)}const x=new TransformStream({transform(j,W){A.controller||(A.controller=W),R.track&&R.track.id!==A.track.id&&(T.debug("audio track changed: ".concat(A.track.id," => ").concat(R.track.id)),A.track.removeEventListener("ended",D),A.track=R.track,A.track.addEventListener("ended",D)),W.enqueue(j)}});M.readable.pipeThrough(x).pipeTo(M.writable)}else if($e()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const M=Li(),x=new MessageChannel;yield new le(W=>M.onmessage=q=>{"registered"===q.data&&W(void 0)});const j=new RTCRtpScriptTransform(M,{name:"tx",port:x.port2},[x.port2]);R.transform=j,yield new le(W=>M.onmessage=q=>{"started"===q.data&&W(void 0)}),x.port1.onmessage=W=>{var q;W.data.transformed&&R.track&&(null===(q=R.track)||void 0===q?void 0:q.id)!==A.track.id&&(T.debug("audio track changed: ".concat(A.track.id," => ").concat(R.track.id)),A.track.removeEventListener("ended",D),A.track=R.track,A.track.addEventListener("ended",D))},A.worker=M}function D(){if(R.track){if(this.id!==R.track.id)return;R.track.removeEventListener("ended",D)}const M=BS.get(R);if(M){BS.delete(R);try{var x,j;null===(x=M.controller)||void 0===x||x.terminate(),null===(j=M.worker)||void 0===j||j.terminate()}catch(W){T.warning(W&&W.message)}}}BS.set(R,A),R.track.addEventListener("ended",D)}),function(R){return N.apply(this,arguments)})(C.sender)))});return function(b){return y.apply(this,arguments)}}()),r.forEach(y=>{let{type:b}=y;o.statsCollector.addLocalStats(b)}),o.assignLocalTracks(r,g),o.statsUploader.startUploadOutboundStats(),r.forEach(y=>{let{track:b,type:C}=y;const N=Date.now();o.store.publish(b.getTrackId(),C===Q.LocalAudioTrack?"audio":"video",void 0,N)})})()}updateVideoStreamParameter(n,r){var o=this;return L(function*(){const a=o.localTrackMap.get(r);if(!a)return;if(!(a.track instanceof Ve))return T.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(o.connection instanceof Ba||o.connection instanceof Ev))return T.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:l}=a,d=function(h,p){const m={};return h.height&&h.width&&(m.scaleResolutionDownBy=VR(h,p)),m.maxFramerate=h.framerate?Mr(h.framerate):void 0,m.maxBitrate=h.bitrate?1e3*h.bitrate:void 0,m}(n,l);if(l._encoderConfig||(l._encoderConfig={}),r!==Q.LocalVideoLowTrack||!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&ct().supportDualStreamEncoding)null!=d.scaleResolutionDownBy&&(l._encoderConfig.scaleResolutionDownBy=d.scaleResolutionDownBy);else{const h=l._originMediaStreamTrack;if(!h.canvas)return T.warn("[".concat(l.getTrackId(),"] no canvas on track"));!function(p,m){const g=p.canvas;m.width&&(g.width=Mr(m.width)),m.height&&(g.height=Mr(m.height)),m.framerate&&(g.stopCapture&&g.stopCapture(),g.stopCapture=dx(()=>{!g.startCapture&&g.stopCapture&&g.stopCapture(),g.startCapture&&g.startCapture()},Mr(m.framerate)))}(h,n)}null!=d.maxBitrate&&(l._encoderConfig.bitrateMax=d.maxBitrate/1e3),null!=d.maxFramerate&&(l._encoderConfig.frameRate&&"object"==typeof l._encoderConfig.frameRate?l._encoderConfig.frameRate.max=d.maxFramerate:l._encoderConfig.frameRate={max:d.maxFramerate}),T.debug("[".concat(l.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(l._encoderConfig))),yield o.connection.updateRtpSenderEncodings(l)})()}publishLowStream(n){var r=this;return ns(function*(){if(!r.connection||r.state!==Dt.Connected)return;const o=yield tt(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const l=r.localTrackMap.get(Q.LocalVideoTrack);if(!l)throw new Y(k.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Q.LocalVideoLowTrack))throw new Y(k.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:r.getLowVideoTrack(l.track,n),type:Q.LocalVideoLowTrack}];if(yield*c_(gH(r.doPublish(r.connection,d))),l.track.muted||!l.track.enabled){var a;const h=null===(a=r.localTrackMap.get(Q.LocalVideoLowTrack))||void 0===a?void 0:a.id;void 0!==h&&(yield tt(r.connection.muteLocal([h])))}}finally{o()}})()}republish(){var n=this;return L(function*(){n.pendingLocalTracks.length>0&&(T.debug("[".concat(n.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield Gi(n,De.RequestRePublish,n.pendingLocalTracks),n.emit(De.MediaReconnectEnd,n.store.uid),n.pendingLocalTracks=[]),n.pendingLocalDataChannels.length>0&&(T.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),yield Gi(n,De.RequestRePublishDataChannel,n.pendingLocalDataChannels),n.pendingLocalDataChannels=[])})()}reSubscribe(n){var r=this;return L(function*(){for(let o=r.pendingRemoteTracks.length-1;o>=0;o--){const{user:a,kind:l}=r.pendingRemoteTracks[o];(l!==_e.AUDIO||a._audio_added_&&a._audioSSRC)&&(l!==_e.VIDEO||a._video_added_&&a._videoSSRC)||r.pendingRemoteTracks.splice(o,1)}if(n)yield Gi(r,De.RequestReSubscribe,r.pendingRemoteTracks);else for(const{user:o,kind:a}of r.pendingRemoteTracks)yield r.subscribe(o,a,a===_e.VIDEO?o._videoSSRC:o._audioSSRC);r.pendingRemoteTracks.forEach(o=>{let{user:a}=o;r.emit(De.MediaReconnectEnd,a.uid)}),r.pendingRemoteTracks=[]})()}unpublish(n){var r=this;return L(function*(){if(!r.connection||r.state!==Dt.Connected)return void n.forEach(l=>{const d=r.pendingLocalTracks.indexOf(l);-1!==d&&r.pendingLocalTracks.splice(d,1)});const o=r.filterTobeUnpublishedTracks(n);if(0===o.length)return;const a=o.find(l=>"videoLowTrack"===l[0]);return a&&a[1].track.close(),r.doUnpublish(r.connection,o)})()}unpublishDataChannel(n){var r=this;return L(function*(){if(!r.connection||r.state!==Dt.Connected)return void n.forEach(a=>{const l=r.pendingLocalDataChannels.indexOf(a);-1!==l&&r.pendingLocalDataChannels.splice(l,1)});const o=r.filterTobeUnpublishedDataChannels(n);return 0!==o.length?(o.forEach(a=>{const l=r.localDataChannels.indexOf(a);-1!==l&&r.localDataChannels.splice(l,1)}),0===r.localDataChannels.length&&(yield r.connection.stopDataChannels(r.store.uid)),o.map(a=>a.id)):void 0})()}unpublishLowStream(){var n=this;return L(function*(){if(!n.connection||n.state!==Dt.Connected)return;const r=n.localTrackMap.get(Q.LocalVideoLowTrack);return r?(r.track.close(),n.doUnpublish(n.connection,[[Q.LocalVideoLowTrack,r]])):void 0})()}doUnpublish(n,r){var o=this;return L(function*(){const a=o.createGatewayUnpublishMessage(r);return yield n.stopSending(r.map(l=>{let[,{id:d}]=l;return d})),o.withdrawLocalTracks(r),o.unbindLocalTrackEvents(r.map(l=>{let[d,{track:h}]=l;return{type:d,track:h}})),r.forEach(l=>{let[d]=l;o.statsCollector.removeLocalStats(d)}),0===o.localTrackMap.size&&o.statsUploader.stopUploadOutboundStats(),a})()}subscribeDataChannel(n,r){var o=this;return L(function*(){if(!o.connection||o.state!==Dt.Connected)throw new Y(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const a=r.filter(l=>{var d;return!(null!==(d=o.remoteDataChannelMap.get(n))&&void 0!==d&&d.get(l.id))});if(0!==a.length)return yield o.connection.createDataChannels(n.uid,a),a.forEach(l=>{var d;o.remoteDataChannelMap.has(n)?null===(d=o.remoteDataChannelMap.get(n))||void 0===d||d.set(l.id,l):o.remoteDataChannelMap.set(n,new Map([[l.id,l]]));const h=o.pendingRemoteDataChannels.findIndex(p=>{let{user:m,id:g}=p;return m.uid===n.uid&&g===l.id});-1!==h&&o.pendingRemoteDataChannels.splice(h,1)}),a.map(l=>l.id)})()}subscribe(n,r,o,a,l){var d=this;return L(function*(){var h;if(!d.connection||d.state!==Dt.Connected)throw new Y(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(h=d.remoteUserMap.get(n))&&void 0!==h&&h.has(r))return;let p,m,g;const v=d.connection.getPreMedia(o);if(v)T.debug("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] preSSRCMap has ssrcId: ").concat(o,", no need to send sub to gateway.")),g=v.transceiver,p=v.track,m=v.id;else if(l){const C=l.find(R=>{let{stream_type:A}=R;return A===r});if(!C)throw new Y(k.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(n.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const N=yield d.connection.receive(r,C.ssrcs,String(n._uintid),C.attributes);d.connection instanceof Ba&&(g=N.transceiver),p=N.track,m=N.id}else{const C=yield d.connection.receive(r,[{ssrcId:o,rtx:a}],String(n._uintid),void 0);d.connection instanceof Ba&&(g=C.transceiver),p=C.track,m=C.id}var C;r===_e.AUDIO?(n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(p):(n._audioTrack=new Dl(p,n.uid,n._uintid,d.store),T.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),g&&n._audioTrack._updateRtpTransceiver(g),d.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(p):(n._videoTrack=new wh(p,n.uid,n._uintid,d.store),T.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),g&&n._videoTrack._updateRtpTransceiver(g),d.bindRemoteTrackEvents(n,n._videoTrack)),V("ENABLE_VIDEO_SEI")&&g&&(r==_e.VIDEO?yield(C=L(function*(N){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!ct().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(!N.track)return;if(GS.has(N)){const M=GS.get(N);return void(M&&(M.onSei=R.onSei))}const A={track:N.track,onSei:R.onSei};if(lh()){if(!N.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let M=null;try{M=N.createEncodedStreams()}catch(j){return void T.error("create video-encoded-streams error",j&&j.message)}const x=new TransformStream({transform(j,W){A.controller||(A.controller=W),N.track&&N.track.id!==A.track.id&&(T.debug("video track changed: ".concat(A.track.id," => ").concat(N.track.id)),A.track.removeEventListener("ended",D),A.track=N.track,A.track.addEventListener("ended",D));const q=function(ee){const J=new DataView(ee.data);let X=0;for(;X+4<ee.data.byteLength;){if(0===J.getUint8(X+0)&&0===J.getUint8(X+1)&&0===J.getUint8(X+2)&&1===J.getUint8(X+3)&&6===J.getUint8(X+4)){let Ce=X+6,Re=0,ut=0;for(;255===(ut=J.getUint8(Ce++));)Re+=255;Re+=ut;const Nt=B5(ee.data,Ce,Re);return new Uint8Array(Nt)}X++}return null}(j);q&&A.onSei&&A.onSei(q),W.enqueue(j)}});M.readable.pipeThrough(x).pipeTo(M.writable)}else if($e()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const M=Li(),x=new MessageChannel;yield new le(W=>M.onmessage=q=>{"registered"===q.data&&W(void 0)});const j=new RTCRtpScriptTransform(M,{name:"rx",port:x.port2},[x.port2]);N.transform=j,yield new le(W=>M.onmessage=q=>{"started"===q.data&&W(void 0)}),x.port1.onmessage=W=>{var q;W.data.transformed&&N.track&&(null===(q=N.track)||void 0===q?void 0:q.id)!==A.track.id?(T.debug("video track changed: ".concat(A.track.id," => ").concat(N.track.id)),A.track.removeEventListener("ended",D),A.track=N.track,A.track.addEventListener("ended",D)):W.data.sei&&A.onSei&&A.onSei(W.data.sei)},A.worker=M}function D(){if(N.track){if(this.id!==N.track.id)return;N.track.removeEventListener("ended",D)}!function(M){const x=GS.get(M);if(x){GS.delete(M);try{var j,W;null===(j=x.controller)||void 0===j||j.terminate(),null===(W=x.worker)||void 0===W||W.terminate()}catch(q){T.warning(q&&q.message)}}}(N)}GS.set(N,A),N.track.addEventListener("ended",D)}),function(N){return C.apply(this,arguments)})(g.receiver,{onSei:C=>{var N;null===(N=n._videoTrack)||void 0===N||N._onSei(C)}}):r==_e.AUDIO&&(yield function(){var C=L(function*(N){if(!ct().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(jS.has(N))return;const R={track:N.track};if(lh()){if(!N.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let D=null;try{D=N.createEncodedStreams()}catch(x){return void T.error("create audio-encoded-streams error",x&&x.message)}const M=new TransformStream({transform(x,j){R.controller||(R.controller=j),N.track&&N.track.id!==R.track.id&&(T.debug("audio track changed: ".concat(R.track.id," => ").concat(N.track.id)),R.track.removeEventListener("ended",A),R.track=N.track,R.track.addEventListener("ended",A)),j.enqueue(x)}});D.readable.pipeThrough(M).pipeTo(D.writable)}else if($e()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");const D=Li(),M=new MessageChannel;yield new le(j=>D.onmessage=W=>{"registered"===W.data&&j(void 0)});const x=new RTCRtpScriptTransform(D,{name:"rx",port:M.port2},[M.port2]);N.transform=x,yield new le(j=>D.onmessage=W=>{"started"===W.data&&j(void 0)}),M.port1.onmessage=j=>{var W;j.data.transformed&&N.track&&(null===(W=N.track)||void 0===W?void 0:W.id)!==R.track.id&&(T.debug("audio track changed: ".concat(R.track.id," => ").concat(N.track.id)),R.track.removeEventListener("ended",A),R.track=N.track,R.track.addEventListener("ended",A))},R.worker=D}function A(){N.track.removeEventListener("ended",A),function(D){const M=jS.get(D);if(M){jS.delete(D);try{var x,j;null===(x=M.controller)||void 0===x||x.terminate(),null===(j=M.worker)||void 0===j||j.terminate()}catch(W){T.warning(W&&W.message)}}}(N)}jS.set(N,R),N.track.addEventListener("ended",A)});return function(N){return C.apply(this,arguments)}}()(g.receiver)));const y=d.remoteUserMap.get(n);y?y.set(r,m):d.remoteUserMap.set(n,new Map([[r,m]])),d.statsCollector.addRemoteStats(n.uid),d.statsUploader.startUploadInboundStats();const b=d.pendingRemoteTracks.findIndex(C=>{let{user:N,kind:R}=C;return N.uid===n.uid&&r===R});-1!==b&&(d.pendingRemoteTracks.splice(b,1),d.emit(De.MediaReconnectEnd,n.uid))})()}massSubscribe(n){var r=this;return L(function*(){return r.massSubscribeNoLock(n)})()}massSubscribeNoLock(n){var r=this;return L(function*(){if(!r.connection||r.state!==Dt.Connected)throw new Y(k.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");n=n.filter(d=>{var h;let{user:p,mediaType:m}=d;return!(null!==(h=r.remoteUserMap.get(p))&&void 0!==h&&h.has(m))});const o=[],a=new Map;n.forEach(d=>{if(!r.connection)return;const h=r.connection.getPreMedia(d.ssrcId);h?a.set(d.ssrcId,h):o.push(d)});const l=yield r.connection.batchReceive(o.map(d=>{let{user:h,mediaType:p,ssrcId:m,rtxSsrcId:g}=d;return{kind:p,ssrcMsg:[{ssrcId:m,rtx:g}],mslabel:String(h._uintid)}}));o.forEach((d,h)=>{a.set(d.ssrcId,l[h])}),n.forEach(d=>{let{user:h,mediaType:p,ssrcId:m}=d;const g=a.get(m);if(!g)return void T.debug("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] cannot find ").concat(h.uid," subscribe data,").concat(p,", ").concat(m));const{track:v,id:y,transceiver:b}=g;p===_e.AUDIO?(h._audioTrack?h._audioTrack._updateOriginMediaStreamTrack(v):(h._audioTrack=new Dl(v,h.uid,h._uintid,r.store),T.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote audio track: ").concat(h._audioTrack.getTrackId()))),b&&h._audioTrack._updateRtpTransceiver(b),r.bindRemoteTrackEvents(h,h._audioTrack)):(h._videoTrack?h._videoTrack._updateOriginMediaStreamTrack(v):(h._videoTrack=new wh(v,h.uid,h._uintid,r.store),T.info("[".concat(r.store.clientId,"] [").concat(r.store.p2pId,"] create remote video track: ").concat(h._videoTrack.getTrackId()))),b&&h._videoTrack._updateRtpTransceiver(b),r.bindRemoteTrackEvents(h,h._videoTrack));const C=r.remoteUserMap.get(h);C?C.set(p,y):r.remoteUserMap.set(h,new Map([[p,y]])),r.statsCollector.addRemoteStats(h.uid),r.statsUploader.startUploadInboundStats();const N=r.pendingRemoteTracks.findIndex(R=>{let{user:A,kind:D}=R;return A.uid===h.uid&&p===D});-1!==N&&(r.pendingRemoteTracks.splice(N,1),r.emit(De.MediaReconnectEnd,h.uid))})})()}unsubscribe(n,r,o){var a=this;return L(function*(){const l=a.pendingRemoteTracks.filter(p=>{let{user:m,kind:g}=p;return void 0!==r?m.uid===n.uid&&r===g:m.uid===n.uid});if(l.forEach(p=>{const m=a.pendingRemoteTracks.indexOf(p);a.pendingRemoteTracks.splice(m,1)}),a.connection&&a.state===Dt.Connected||o||l.forEach(p=>{let{kind:m}=p;var g;if(m===_e.AUDIO)null===(g=n._audioTrack)||void 0===g||g._destroy(),n._audioTrack=void 0;else if(m===_e.VIDEO){var v;null===(v=n._videoTrack)||void 0===v||v._destroy(),n._videoTrack=void 0}}),!a.connection||a.state!==Dt.Connected)return;const d=a.filterTobeUnSubscribedTracks(n,r);if(0===d.length)return;yield a.connection.stopReceiving(d.map(p=>{let[,{id:m}]=p;return m}));const h=a.createUnsubscribeMessage(d);return a.withdrawRemoteTracks(d),0===a.remoteUserMap.size&&a.statsUploader.stopUploadInboundStats(),d.forEach(p=>{let[m,{kind:g}]=p;var v,y;if(g===_e.VIDEO&&m._videoSSRC&&(null===(v=a.connection)||void 0===v||v.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),g===_e.VIDEO)a.unbindRemoteTrackEvents(m._videoTrack),o||(null===(y=m._videoTrack)||void 0===y||y._destroy(),m._videoTrack=void 0);else if(g===_e.AUDIO){var b;a.unbindRemoteTrackEvents(m._audioTrack),!o&&(null===(b=m._audioTrack)||void 0===b||b._destroy(),m._audioTrack=void 0)}}),h})()}unsubscribeDataChannel(n,r){var o=this;return L(function*(){if(r.forEach(d=>{const h=o.pendingRemoteDataChannels.findIndex(p=>p.id===d.id);-1!==h&&o.pendingRemoteDataChannels.splice(h,1)}),!o.connection)return;const a=o.filterTobeUnSubscribedDataChannels(n,r);if(0===a.length)return;r.forEach(d=>{d._close()});const l=o.remoteDataChannelMap.get(n);return a.forEach(d=>{l&&l.delete(d.id)}),l&&0===l.size&&(o.remoteDataChannelMap.delete(n),yield o.connection.stopDataChannels(n.uid)),a.map(d=>d.id)})()}massUnsubscribe(n){var r=this;return L(function*(){return r.massUnsubscribeNoLock(n)})()}massUnsubscribeNoLock(n){var r=this;return L(function*(){let o=[];for(const{user:d,mediaType:h}of n){const p=r.pendingRemoteTracks.filter(m=>{let{user:g,kind:v}=m;return void 0!==h?g.uid===d.uid&&h===v:g.uid===d.uid});p.forEach(m=>{const g=r.pendingRemoteTracks.indexOf(m);r.pendingRemoteTracks.splice(g,1)}),o=o.concat(p)}if(!r.connection||r.state!==Dt.Connected)return void o.forEach(d=>{let{user:h,kind:p}=d;var m;if(p===_e.AUDIO)null===(m=h._audioTrack)||void 0===m||m._destroy(),h._audioTrack=void 0;else if(p===_e.VIDEO){var g;null===(g=h._videoTrack)||void 0===g||g._destroy(),h._videoTrack=void 0}});const a=Ue(n).call(n,(d,h)=>{let{user:p,mediaType:m}=h;const g=r.filterTobeUnSubscribedTracks(p,m);return d.concat(g)},[]);if(0===a.length)return;yield r.connection.stopReceiving(a.map(d=>{let[,{id:h}]=d;return h}));const l=r.createUnsubscribeAllMessage(a);return r.withdrawRemoteTracks(a),0===r.remoteUserMap.size&&r.statsUploader.stopUploadInboundStats(),a.forEach(d=>{let[h,{kind:p}]=d;var m,g;if(p===_e.VIDEO&&h._videoSSRC&&(null===(m=r.connection)||void 0===m||m.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),p===_e.VIDEO)r.unbindRemoteTrackEvents(h._videoTrack),null===(g=h._videoTrack)||void 0===g||g._destroy(),h._videoTrack=void 0;else if(p===_e.AUDIO){var v;r.unbindRemoteTrackEvents(h._audioTrack),null===(v=h._audioTrack)||void 0===v||v._destroy(),h._audioTrack=void 0}}),l})()}isPreSubScribe(n){return!(!this.connection||this.state!==Dt.Connected||!this.connection.getPreMedia(n))}muteRemote(n,r){var o=this;return L(function*(){if(!o.connection)return;const a=o.remoteUserMap.get(n);if(!a)return void T.warning("[".concat(o.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(n.uid,"."));if(!a.get(r))return void T.warning("[".concat(o.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(n.uid," media type ").concat(r,"."));const l=r===_e.VIDEO?n._videoSSRC:n._audioSSRC;void 0!==l&&o.connection.setStatsRemoteVideoIsReady(l,!1)})()}unmuteRemote(n,r){var o=this;return L(function*(){return o.unmuteRemoteNoLock(n,r)})()}unmuteRemoteNoLock(n,r){var o=this;return L(function*(){if(!o.connection)return;const a=o.remoteUserMap.get(n);a?a.get(r)||T.warning("[".concat(o.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(n.uid," media type ").concat(r,".")):T.warning("[".concat(o.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(n.uid,"."))})()}getAllTracks(n){const r=this.localTrackMap.get(Q.LocalAudioTrack);if(r?.track instanceof si){const o=r.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[l]=a;return l!==Q.LocalAudioTrack}).filter(a=>{let[l]=a;return!(n&&l===Q.LocalVideoLowTrack)}).map(a=>{let[,{track:l}]=a;return l}).concat(o.trackList)}return Array.from(this.localTrackMap.entries()).filter(o=>{let[a]=o;return!(n&&a===Q.LocalVideoLowTrack)}).map(o=>{let[,{track:a}]=o;return a})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(n,r,o,a,l){if(n){const h=this.localTrackMap.get(Q.LocalAudioTrack),p=this.localTrackMap.get(a?Q.LocalVideoLowTrack:Q.LocalVideoTrack);be.publish(this.store.sessionId,{eventElapse:tr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:r,audioName:h?.track.getTrackLabel(),videoName:p?.track.getTrackLabel(),screenshare:-1!==p?.track._hints.indexOf(zt.SCREEN_TRACK),audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}else{var d;o||(o=[]);const h=o.find(m=>m instanceof Cn),p=a?null===(d=this.localTrackMap.get(Q.LocalVideoTrack))||void 0===d?void 0:d.track:o.find(m=>m instanceof Ve);be.publish(this.store.sessionId,{eventElapse:tr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:r,audioName:h?.getTrackLabel(),videoName:p?.getTrackLabel(),screenshare:-1!==p?._hints.indexOf(zt.SCREEN_TRACK),audio:!!h,video:!!p,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:l})}}reportSubscribeEvent(n,r,o,a){const l=a===_e.VIDEO?o._videoSSRC:o._audioSSRC;l&&be.subscribe(this.store.sessionId,{succ:n,ec:r,video:a===_e.VIDEO,audio:a===_e.AUDIO,peerid:o.uid,subscribeRequestid:l,p2pid:this.store.p2pId,eventElapse:tr.measureFromSubscribeStart(this.store.clientId,l),preSsrc:this.isPreSubScribe(l)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Qi("P2PChannel-mutex",this.store.clientId),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Ev({},this.store):new Ba({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const n=this.localTrackMap.get(Q.LocalAudioTrack);if(n?.track instanceof si){if(n.track.trackList.length>0){const r=n.track;n.track.trackList.forEach(o=>{r.removeAudioTrack(o)})}n.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Dt.Disconnected}getStats(){var n;return null===(n=this.connection)||void 0===n?void 0:n.getStats()}getRemoteVideoIsReady(n){var r;return(null===(r=this.connection)||void 0===r?void 0:r.getRemoteVideoIsReady(n))||!1}getLocalAudioVolume(){const n=this.localTrackMap.get(Q.LocalAudioTrack);if(n)return n.track.getVolumeLevel()}getLocalVideoSize(){const n=this.localTrackMap.get(Q.LocalVideoTrack);if(n)return{width:n.track.videoWidth||0,height:n.track.videoHeight||0}}getEncoderConfig(n){const r=this.localTrackMap.get(n);return r&&r.track instanceof Ve||r&&r.track instanceof Cn?r.track._encoderConfig:void 0}getLocalMedia(n){return this.localTrackMap.get(n)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(n,r){if(!n)return this.remoteUserMap.size>0;const o=this.remoteUserMap.get(n);return!!o&&(!r||o.has(r))}hasRemoteMediaWithLock(n,r){var o=this;return L(function*(){if(!n)return o.remoteUserMap.size>0;const a=o.remoteUserMap.get(n);return!!a&&(!r||a.has(r))})()}getRemoteMedia(n){var r;const o=Array.from(wo(r=this.remoteUserMap).call(r)).find(a=>a.uid===n);return o?{audioTrack:o.audioTrack,audioSSRC:o._audioSSRC,videoTrack:o.videoTrack,videoSSRC:o._videoSSRC}:{}}getAudioLevels(){let n=Array.from(this.remoteUserMap.entries()).map(o=>{let[a]=o;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Q.LocalAudioTrack);return r&&n.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),n=hd(n).call(n,(o,a)=>o.level-a.level),n}disconnectForReconnect(){var n=this;return L(function*(){n.connection&&(T.debug("[".concat(n.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),n.state=Dt.Reconnecting,V("KEEP_LAST_FRAME")&&0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(r=>{let[o]=r;var a;o._videoTrack&&o._videoTrack._player&&(null===(a=o._videoTrack._player.getVideoElement())||void 0===a||a.pause(),o._videoTrack._player.isKeepLastFrame=!0,o._videoTrack._originMediaStreamTrack.stop())}),n.connection.close(),n.unbindConnectionEvents(n.connection),n.connection=void 0,n.shouldForwardP2PCreation&&(n.connection=n.isPlanB?new Ev({},n.store):new Ba({},n.store),n.bindConnectionEvents(n.connection)),0!==n.localTrackMap.size&&(Array.from(n.localTrackMap.entries()).forEach(r=>{var o;let[a,{track:l}]=r;switch(a){case Q.LocalVideoTrack:he(o=l._hints).call(o,zt.LOW_STREAM)?l.close():n.pendingLocalTracks.push(l);break;case Q.LocalAudioTrack:l instanceof si?n.pendingLocalTracks=n.pendingLocalTracks.concat(l.trackList):n.pendingLocalTracks.push(l)}}),n.emit(De.MediaReconnectStart,n.store.uid)),n.unbindLocalTrackEvents(),n.localTrackMap.clear(),0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(r=>{let[o,a]=r;Array.from(wo(a).call(a)).forEach(l=>{n.setPendingRemoteMedia(o,l)}),n.emit(De.MediaReconnectStart,o.uid)}),n.unbindAllRemoteTrackEvents(),n.remoteUserMap.clear(),0!==n.localDataChannels.length&&(n.localDataChannels.forEach(r=>{n.pendingLocalDataChannels.push(r)}),n.localDataChannels.length=0),0!==n.remoteDataChannelMap.size&&(Array.from(n.remoteDataChannelMap.entries()).forEach(r=>{let[o,a]=r;Array.from(wo(a).call(a)).forEach(l=>{n.setPendingRemoteDataChannel(o,l)})}),n.remoteDataChannelMap.clear()),n.statsUploader.stopUploadOutboundStats(),n.statsUploader.stopUploadInboundStats(),n.statsUploader.stopUploadTransportStats(),T.debug("[".concat(n.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))})()}hasPendingRemoteDataChannel(n,r){for(const o of this.pendingRemoteDataChannels){const{user:a,id:l}=o;if((n instanceof Mh?n.uid:n)===a.uid&&l===r)return!0}return!1}setPendingRemoteDataChannel(n,r){this.hasPendingRemoteDataChannel(n,r)||this.pendingRemoteDataChannels.push({user:n,id:r})}hasPendingRemoteMedia(n,r){for(const o of this.pendingRemoteTracks){const{user:a,kind:l}=o;if((n instanceof Mh?n.uid:n)===a.uid&&r===l)return!0}return!1}setPendingRemoteMedia(n,r){this.hasPendingRemoteMedia(n,r)||this.pendingRemoteTracks.push({user:n,kind:r})}restartICE(n){var r=this;return ns(function*(){if(!r.connection||r.state!==Dt.Connected)return;const o=yield tt(r.mutex.lock("From P2PChannel.restartICE"));let a;try{a=yield tt(r.connection.restartICE(n));const d=yield tt(a.next());if(d.done)return;const h=d.value,p=yield h;switch(r.reportPCDisconnectedOrFailed(n),n){case po.TCP:r._pcStatsUploadType=Sc.TCP_RESTART;break;case po.RELAY:r._pcStatsUploadType=Sc.RELAY_RESTART;break;default:r._pcStatsUploadType=Sc.OLD_RESTART}r._isInRestartIce=!0,a.next(p)}catch(d){var l;null===(l=a)||void 0===l||l.throw(d)}finally{o()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const n=this.connection.getStats(),r=this.localTrackMap.get(Q.LocalVideoTrack),o=this.localTrackMap.get(Q.LocalAudioTrack),a=n.videoSend.find(C=>C.ssrc===r?.ssrcs[0].ssrcId),l=n.audioSend.find(C=>C.ssrc===o?.ssrcs[0].ssrcId);if(!a||!l)return 1;const d=Do(this,De.NeedSignalRTT),h=a?a.rttMs:void 0,p=l?l.rttMs:void 0,m=h&&p?(h+p)/2:h||p,v=100*n.sendPacketLossRate*.7/50+.3*((m&&d?(m+d)/2:m||d)||0)/1500,y=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,b=r?.track;if(b&&b._encoderConfig&&-1===b._hints.indexOf(zt.SCREEN_TRACK)){const C=b._encoderConfig.bitrateMax,N=n.bitrate.actualEncoded;if(C&&N){const R=(1e3*C-N)/(1e3*C);return nL[R<.15?0:R<.3?1:R<.45?2:R<.6?3:4][y]}}return y}getDownlinkNetworkQuality(){if(!this.connection)return 0;const n=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(o=>{let[a]=o;const l=a._audioSSRC,d=a._videoSSRC,h=n.audioRecv.find(N=>N.ssrc===l),p=n.videoRecv.find(N=>N.ssrc===d);if(!h&&!p)return void(r+=1);const m=Do(this,De.NeedSignalRTT),g=n.rtt,v=(g&&m?(g+m)/2:g||m)||0,y=h?h.jitterMs:void 0,b=n.recvPacketLossRate;let C=.7*b*100/50+.3*v/1500;y&&(C=.6*b*100/50+.2*v/1500+.2*y/400),r+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}muteLocalTrack(n){var r=this;return L(function*(){return new le((o,a)=>{r.handleMuteLocalTrack(n,o,a)})})()}replaceTrack(n,r){var o=this;return L(function*(){var a;if(T.debug("[".concat(o.store.clientId,"] P2PChannel replaceTrack from [").concat(n.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!o.connection||o.state!==Dt.Connected)return;const l=Array.from(o.localTrackMap.entries()).find(h=>{let[,{track:p}]=h;return n===p});if(!l)return;const d=l[0];if(n!==r&&(o.unbindLocalTrackEvents([{track:n,type:d}]),o.bindLocalTrackEvents([{track:r,type:d}]),l[1].track=r),yield null===(a=o.connection)||void 0===a?void 0:a.replaceTrack(r,l[1].id),o.isPlanB){const h=l[1];h.id=r._mediaStreamTrack.id,o.localTrackMap.set(d,h)}if(d===Q.LocalVideoTrack&&!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&ct().supportDualStreamEncoding){const h=o.localTrackMap.get(Q.LocalVideoLowTrack);if(h){const p=n._mediaStreamTrack.clone();h.track._originMediaStreamTrack.stop(),h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p,yield new le((m,g)=>{o.handleReplaceTrack(h.track,m,g,!0)})}}})()}filterTobePublishedTracks(n,r,o){const a=[],l=this.getAllTracks();n=At(n=n.filter(m=>-1===l.indexOf(m)));let d,h=!1;const p=this.localTrackMap.get(Q.LocalAudioTrack);for(const m of n){if(m instanceof Ve&&(this.localTrackMap.has(Q.LocalVideoTrack)||h?new Y(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:m,type:Q.LocalVideoTrack}),h=!0),r)){const g=this.getLowVideoTrack(m,o);a.push({track:g,type:Q.LocalVideoLowTrack})}if(m instanceof Cn)if(p){const g=p.track;if(g instanceof si)yD([m]),g.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0);else{const v=M2([g,m]);T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(v.getTrackId(),"]")),this.replaceTrack(g,v)}}else d instanceof si?(yD([m]),d.addAudioTrack(m)):d=d||!m._useAudioElement&&ct().webAudioMediaStreamDest&&!m._bypassWebAudio?M2(d?[m,d]:[m]):m}return d&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),a.push({track:d,type:Q.LocalAudioTrack})),a}filterTobeUnpublishedTracks(n){const r=[],o=this.getAllTracks();n=At(n=n.filter(a=>-1!==o.indexOf(a)));for(const a of n){if(a instanceof Cn){const l=this.localTrackMap.get(Q.LocalAudioTrack);if(!l)continue;l.track instanceof si?(l.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),0===l.track.trackList.length&&(r.push([Q.LocalAudioTrack,l]),l.track.close())):r.push([Q.LocalAudioTrack,l])}if(a instanceof Ve){const l=this.localTrackMap.get(Q.LocalVideoTrack);if(!l)continue;r.push([Q.LocalVideoTrack,l]);const d=this.localTrackMap.get(Q.LocalVideoLowTrack);d&&r.push([Q.LocalVideoLowTrack,d])}}return r}filterTobePublishedDataChannels(n){return(n=At(n)).filter(r=>-1===this.localDataChannels.findIndex(o=>o.id===r.id))}filterTobeUnpublishedDataChannels(n){return(n=(n=At(n)).filter(r=>-1!==this.localDataChannels.indexOf(r))).filter(r=>r._originDataChannel)}bindLocalTrackEvents(n){n.forEach(r=>{let{track:o,type:a}=r;switch(a){case Q.LocalVideoTrack:o.addListener(ge.GET_STATS,this.handleGetLocalVideoStats),o.addListener(ge.GET_RTC_STATS,this.handleGetRTCStats),o.addListener(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.addListener(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.addListener(ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),o.addListener(ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),o.addListener(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.addListener(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.addListener(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Q.LocalAudioTrack:this.bindLocalAudioTrackEvents(o)}})}bindLocalAudioTrackEvents(n,r){n instanceof si?n.trackList.forEach(o=>{o.addListener(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.addListener(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.addListener(ge.GET_STATS,this.handleGetLocalAudioStats),o.addListener(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.addListener(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.addListener(ge.GET_STATS,this.handleGetLocalAudioStats),n.addListener(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(n.addListener(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(ge.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(n){n||(n=Array.from(this.localTrackMap.entries()).map(r=>{let[o,{track:a}]=r;return{track:a,type:o}})),n.forEach(r=>{let{track:o,type:a}=r;switch(a){case Q.LocalVideoTrack:o.off(ge.GET_STATS,this.handleGetLocalVideoStats),o.off(ge.GET_RTC_STATS,this.handleGetRTCStats),o.off(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.off(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.off(ge.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),o.off(ge.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),o.off(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.off(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.off(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Q.LocalAudioTrack:this.unbindLocalAudioTrackEvents(o)}})}unbindLocalAudioTrackEvents(n){n instanceof si?n.trackList.forEach(r=>{r.off(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(ge.GET_STATS,this.handleGetLocalAudioStats),r.off(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.off(ge.GET_STATS,this.handleGetLocalAudioStats),n.off(ge.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(ge.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(ge.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(ge.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),n.off(ge.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(ge.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(n,r){r instanceof wh&&r.addListener(ge.GET_STATS,o=>{o(this.handleGetRemoteVideoStats(n))}),r instanceof Dl&&r.addListener(ge.GET_STATS,o=>{o(this.handleGetRemoteAudioStats(n))})}unbindRemoteTrackEvents(n){n&&n.removeAllListeners(ge.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r,o]=n;o.has(_e.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),o.has(_e.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(n,r){return n.map((o,a)=>{var l;let d,h,{track:p,type:m}=o;switch(m){case Q.LocalAudioTrack:d=at.Audio,h={dtx:p instanceof xS&&p._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Q.LocalVideoTrack:d=he(l=p._hints).call(l,zt.SCREEN_TRACK)?at.Screen:at.High,h=Dc(Dc({},IL(p)),{},{codec:this.store.codec,svc_mode:ds()});break;case Q.LocalVideoLowTrack:d=at.Low,h=Dc(Dc({},IL(p)),{},{codec:this.store.codec,svc_mode:ds()})}return{stream_type:d,attributes:h,ssrcs:r[a]}})}createGatewayUnpublishMessage(n){return n.map(r=>{var o;let a,[l,{track:d,ssrcs:h,id:p}]=r;switch(l){case Q.LocalVideoTrack:a=he(o=d._hints).call(o,zt.SCREEN_TRACK)?at.Screen:at.High;break;case Q.LocalAudioTrack:a=at.Audio;break;case Q.LocalVideoLowTrack:a=at.Low}return{stream_type:a,ssrcs:h,mid:p}})}assignLocalTracks(n,r){n.forEach((o,a)=>{let{track:l,type:d}=o;this.localTrackMap.set(d,{track:l,id:r[a].id,ssrcs:r[a].localSSRC})})}withdrawLocalTracks(n){n.forEach(r=>{let[o]=r;this.localTrackMap.delete(o)})}bindConnectionEvents(n){var r=this;n.onConnectionStateChange=function(){var o=L(function*(a){if(T.info("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(a,")")),r.emit(De.PeerConnectionStateChange,a),"connected"!==a||r.store.keyMetrics.peerConnectionEnd||r.store.peerConnectionEnd(),"connected"===a&&(r._restartTimer&&(clearTimeout(r._restartTimer),r._restartTimer=void 0),(r._isFirstConnected||r._isInRestartIce)&&r.reportPCStats(Date.now(),!0,r._pcStatsUploadType),r._isInRestartIce=!1,r._isFirstConnected=!1,r._isStartRestartIce=!1),V("NEW_ICE_RESTART")){var l;if(he(l=r._restartStates).call(l,a)){if(r._isStartRestartIce)return;r._isStartRestartIce=!0;const d=m=>{("disconnected"===n.iceConnectionState||"checking"===n.iceConnectionState||"failed"===n.iceConnectionState)&&(T.debug("[".concat(r.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(m)),"CONNECTED"===Do(r,De.QueryClientConnectionState)&&r.emit(De.RequestRestartICE,m))},h=()=>{"disconnected"!==n.iceConnectionState&&"checking"!==n.iceConnectionState&&"failed"!==n.iceConnectionState||(r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),T.debug("[".concat(r.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>r.emit(De.P2PLost),0),r.iceFailedCount+=1,r.requestReconnect())},p=V("ICE_RESTART_INTERVAL");return void(r._restartTimer=window.setTimeout(()=>{if(V("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&ct().supportPCSetConfiguration)d(po.RELAY),r._restartTimer=window.setTimeout(h,p);else if(hn())d(po.UDP),r._restartTimer=window.setTimeout(h,4e3);else{if(d(po.TCP),ct().supportPCSetConfiguration)return void(r._restartTimer=window.setTimeout(()=>{d(po.RELAY),r._restartTimer=window.setTimeout(h,p)},p));r._restartTimer=window.setTimeout(h,p)}},800))}}else{if("disconnected"===a&&"disconnected"===n.iceConnectionState)return setTimeout(()=>{"disconnected"===n.iceConnectionState&&V("ICE_RESTART")&&"CONNECTED"===Do(r,De.QueryClientConnectionState)&&r.emit(De.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===n.peerConnectionState&&(T.debug("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),r._isInRestartIce=!1,setTimeout(()=>r.emit(De.P2PLost),0),r.iceFailedCount+=1,r.requestReconnect())},4e3);"failed"===a&&(T.debug("[".concat(r.store.clientId,"] [p2pId: ").concat(r.store.p2pId,"]: P2PConnection state failed, force reconnect")),r.reportPCDisconnectedOrFailed(),setTimeout(()=>r.emit(De.P2PLost),0),r.iceFailedCount+=1,yield r.requestReconnect())}});return function(a){return o.apply(this,arguments)}}(),n.onICEConnectionStateChange=o=>{"connected"!==o||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(o,")")),be.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:o,tag:st.TRACER}).onSuccess(),this.emit(De.IceConnectionStateChange,o)},n.onICETransportStateChange=o=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(o,")"))},n.onDTLSTransportStateChange=o=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(o,")"))},n.onDTLSTransportError=o=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(o,")"))},n.onFirstAudioDecoded=o=>{var a;const l=Array.from(wo(a=this.remoteUserMap).call(a)).find(h=>h._audioSSRC===o);var d;l&&(this.store.subscribe(l.uid,"audio",void 0,void 0,void 0,Date.now()),null===(d=l.audioTrack)||void 0===d||d.emit(bh.FIRST_FRAME_DECODED),be.firstRemoteFrame(this.store.sessionId,Mi.FIRST_AUDIO_DECODE,sn.FIRST_AUDIO_DECODE,{peer:l._uintid,subscribeElapse:tr.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId}))},n.onFirstAudioReceived=o=>{var a;const l=Array.from(wo(a=this.remoteUserMap).call(a)).find(d=>d._audioSSRC===o);l&&be.firstRemoteFrame(this.store.sessionId,Mi.FIRST_AUDIO_RECEIVED,sn.FIRST_AUDIO_RECEIVED,{peer:l._uintid,subscribeElapse:tr.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId})},n.onFirstVideoDecoded=(o,a,l)=>{this.reportVideoFirstFrameDecoded(o,a,l)},n.onFirstVideoReceived=o=>{var a;const l=Array.from(wo(a=this.remoteUserMap).call(a)).find(d=>d._videoSSRC===o);l&&be.firstRemoteFrame(this.store.sessionId,Mi.FIRST_VIDEO_RECEIVED,sn.FIRST_VIDEO_RECEIVED,{peer:l._uintid,subscribeElapse:tr.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId})},n.onSelectedLocalCandidateChanged=(o,a)=>{const l="relay"===o.candidateType;"unknown"!==a.candidateType&&l===("relay"===a.candidateType)||this.emit(De.ConnectionTypeChange,l),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Pd(a))," -> ").concat(JSON.stringify(Pd(o)),")"))},n.onSelectedRemoteCandidateChanged=(o,a)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Pd(a))," -> ").concat(JSON.stringify(Pd(o)),")"))},n.onFirstVideoDecodedTimeout=o=>{this.reportVideoFirstFrameDecoded(o,void 0,void 0,!0)},n.getLocalVideoStats=()=>{const o=this.statsCollector.getLocalVideoTrackStats(),a=this.statsCollector.getRTCStats();return Dc(Dc({},o),a)}}unbindConnectionEvents(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0,n.getLocalVideoStats=void 0}filterTobeMutedTracks(n){const r=[];if(-1===this.getAllTracks().indexOf(n))return r;const o=this.localTrackMap.get(Q.LocalAudioTrack);if(n instanceof Cn&&o?.track instanceof si)return o.track.isActive||r.push([Q.LocalAudioTrack,o]),r;const a=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:d}]=l;return n===d});if(a&&(r.push(a),a[0]===Q.LocalVideoTrack)){const l=this.localTrackMap.get(Q.LocalVideoLowTrack);l&&r.push([Q.LocalVideoLowTrack,l])}return r}filterTobeUnmutedTracks(n){const r=[],o=this.localTrackMap.get(Q.LocalAudioTrack);if(n instanceof Cn&&o?.track instanceof si)return o.track.isActive&&r.push([Q.LocalAudioTrack,o]),r;const a=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:d}]=l;return n===d});if(a)if(a[0]===Q.LocalVideoTrack){r.push(a);const l=this.localTrackMap.get(Q.LocalVideoLowTrack);l&&r.push([Q.LocalVideoLowTrack,l])}else r.push(a);return r}createMuteMessage(n){return n.map(r=>{var o;let a,[l,{track:d,ssrcs:h,id:p}]=r;switch(l){case Q.LocalAudioTrack:a=at.Audio;break;case Q.LocalVideoTrack:a=he(o=d._hints).call(o,zt.SCREEN_TRACK)?at.Screen:at.High;break;case Q.LocalVideoLowTrack:a=at.Low}return{stream_type:a,ssrcs:h,mid:p}})}createUnmuteMessage(n){return n.map(r=>{var o;let a,[l,{track:d,ssrcs:h,id:p}]=r;switch(l){case Q.LocalAudioTrack:a=at.Audio;break;case Q.LocalVideoTrack:a=he(o=d._hints).call(o,zt.SCREEN_TRACK)?at.Screen:at.High;break;case Q.LocalVideoLowTrack:a=at.Low}return{stream_type:a,ssrcs:h,mid:p}})}filterTobeUnSubscribedTracks(n,r){const o=[],a=this.remoteUserMap.get(n);if(!a)return o;if(r){const l=a.get(r);if(!l)return o;o.push([n,{kind:r,id:l}])}else Array.from(a.entries()).forEach(l=>{let[d,h]=l;o.push([n,{kind:d,id:h}])});return o}filterTobeUnSubscribedDataChannels(n,r){const o=[];return r.forEach(a=>{var l;null!==(l=this.remoteDataChannelMap.get(n))&&void 0!==l&&l.has(a.id)&&o.push(a)}),o}createUnsubscribeMessage(n){const r=[];return n.forEach(o=>{let[a,{kind:l}]=o;switch(l){case _e.VIDEO:return void(a._videoSSRC&&r.push({stream_type:_e.VIDEO,ssrcId:a._videoSSRC}));case _e.AUDIO:return void(a._audioSSRC&&r.push({stream_type:_e.AUDIO,ssrcId:a._audioSSRC}))}}),r}createUnsubscribeAllMessage(n){const r=new Map;return n.forEach(o=>{let[a,{kind:l}]=o;if(r.has(a)){let d=r.get(a);d|=l===_e.VIDEO?_i.Video:_i.Audio,r.set(a,d)}else r.set(a,l===_e.VIDEO?_i.Video:_i.Audio)}),{users:Array.from(r.entries()).map(o=>{let[a,l]=o;return{stream_id:a.uid,stream_type:l}})}}withdrawRemoteTracks(n){n.forEach(r=>{let[o,{kind:a}]=r;const l=this.remoteUserMap.get(o);l&&(l.delete(a),0===Array.from(l.entries()).length&&this.remoteUserMap.delete(o))})}updateBitrateLimit(n){var r=this;return L(function*(){const o=r.localTrackMap.get(Q.LocalVideoTrack),a=r.localTrackMap.get(Q.LocalVideoLowTrack);o&&(yield o.track.setBitrateLimit(n.uplink)),a&&n.low_stream_uplink&&(yield a.track.setBitrateLimit({max_bitrate:n.low_stream_uplink.bitrate,min_bitrate:n.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(n,r,o){return n.map((a,l)=>{var d;let{stream_type:h}=a;const p=null===(d=r.find(m=>{let{stream_type:g}=m;return h===g}))||void 0===d?void 0:d.attributes;if(p&&V("DISABLE_SCREEN_SHARE_REMB")){const m=o[l]._hints;(he(m).call(m,zt.SCREEN_TRACK)||he(m).call(m,zt.SCREEN_LOW_TRACK))&&(p.remb=!1,T.debug("disable remb for screen share, hints:",m))}return p})}tryToUnmuteAudio(n){var r=this;return L(function*(){for(let a=0;a<n.length;a++)if(n[a]instanceof Cn){var o;const l=r.filterTobeUnmutedTracks(n[a]);if(0===l.length)continue;yield null===(o=r.connection)||void 0===o?void 0:o.unmuteLocal(l.map(h=>{let[,{id:p}]=h;return p}));const d=r.createUnmuteMessage(l);return void(yield jt(r,De.RequestUnmuteLocal,d))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=n=>{var r;return!(null===(r=this.connection)||void 0===r||!r.getRemoteVideoIsReady(n))},this.statsUploader.requestUpload=(n,r)=>this.emit(De.RequestUpload,n,r),this.statsUploader.requestUploadStats=n=>this.emit(De.RequestUploadStats,n),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var n=this;return L(function*(){n.dtlsFailedCount+=1,yield Ii(pR(n.dtlsFailedCount,Nn)),n.emit(De.RequestReconnect)})()}reconnectP2P(){var n=this;return L(function*(){const r=Array.from(n.localTrackMap.entries()),o=n.createGatewayUnpublishMessage(r);Array.from(n.remoteUserMap.entries()),o.length>0&&(yield Gi(n,De.RequestUnpublishForReconnectPC,o)),n.disconnectForReconnect(),n.emit(De.RequestReconnectPC)})()}canPublishLowStream(){return this.localTrackMap.has(Q.LocalVideoTrack)||this.pendingLocalTracks.some(n=>n instanceof Ve)}throwIfTrackTypeNotMatch(n){if(n.filter(r=>r instanceof Ve).length>1)throw new Y(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n.filter(r=>r instanceof Cn).length>1&&(n.some(r=>r instanceof Cn&&r._bypassWebAudio)||!ct().webAudioMediaStreamDest))throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of n){if(r instanceof Ve&&this.pendingLocalTracks.some(o=>o instanceof Ve))throw new Y(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Cn&&this.pendingLocalTracks.some(o=>o instanceof Cn)&&(!ct().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(o=>o instanceof Cn&&o._bypassWebAudio)))throw new Y(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(n,r){var o;const a=!V("DISABLE_DUAL_STREAM_USE_ENCODING")&&ct().supportDualStreamEncoding,l=Dc(Dc({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=a?n._mediaStreamTrack.clone():D2(n,l);const h=Ct(8,"track-low-"),p=new Ve(d,Dc(Dc({},a&&{scaleResolutionDownBy:VR(l,n)}),{},{frameRate:l.framerate,bitrateMax:l.bitrate,bitrateMin:l.bitrate}),void 0,void 0,h);return p.on(Ff.TRANSCEIVER_UPDATED,m=>{n._updateRtpTransceiver(m,Y_.LOW_STREAM)}),p._hints.push(zt.LOW_STREAM),he(o=n._hints).call(o,zt.SCREEN_TRACK)&&p._hints.push(zt.SCREEN_LOW_TRACK),n.on("sei-to-send",m=>{p.emit("sei-to-send",m)}),n.addListener(ge.NEED_CLOSE,()=>{p.close()}),p}globalLock(){var n=this;return L(function*(){return n.mutex.lock("From P2PChannel.globalLock")})()}reportPCStats(n,r,o){var a=arguments,l=this;return L(function*(){let d=a.length>3&&void 0!==a[3]?a[3]:null;if(l.connection&&l.connection instanceof Ba){var h,p,m,g;const v=l.store.keyMetrics.descriptionStart||0,{iceConnectionState:y,dtlsTransportState:b,peerConnectionState:C}=l.connection,{local:N,remote:R}=yield l.connection.getSelectedCandidatePair();be.pcStats(l.store.sessionId,{startTime:v,eventElapse:n-v||0,iceconnectionsate:y,dtlsstate:b,connectionstate:C,intSucc:r?1:2,error:d,selectedLocalCandidateProtocol:null!==(h=N?.protocol)&&void 0!==h?h:"",selectedLocalCandidateType:null!==(p=N.candidateType)&&void 0!==p?p:"",selectedLocalCandidateAddress:"".concat(N.address,":").concat(N.port),selectedRemoteCandidateProtocol:null!==(m=R.protocol)&&void 0!==m?m:"",selectedRemoteCandidateType:null!==(g=R.candidateType)&&void 0!==g?g:"",selectedRemoteCandidateAddress:"".concat(R.address,":").concat(R.port),restartCnt:o,preallocation:l.connection.isPreallocation})}})()}reportVideoFirstFrameDecoded(n,r,o,a){var l;const d=Array.from(wo(l=this.remoteUserMap).call(l)).find(h=>h._videoSSRC===n);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,p=h.subscribe.find(m=>m.userId===d.uid&&"video"===m.type);be.firstRemoteVideoDecode(this.store.sessionId,Mi.FIRST_VIDEO_DECODE,sn.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:o,subscribeElapse:tr.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:p?.subscribeEnd||0,subscriberStart:p?.subscribeStart||0,videoAddNotify:p?.streamAdded||0,state:a?1:0,firstFrame:p?.firstFrame||0})}}remoteMediaSsrcChanged(n,r,o){var a=this;return L(function*(){if(!a.connection)return!1;const l=a.remoteUserMap.get(n);if(!l)return!1;const d=l.get(r);if(!d)return!1;const h=yield a.connection.getRemoteSSRC(d);return void 0!==h&&h!==o})()}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(n=>{let[r,{track:o}]=n;r===Q.LocalVideoLowTrack?o._updateRtpTransceiver(void 0,Y_.LOW_STREAM):o._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(n){this.connection&&this.connection instanceof Ba&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this.reportPCStats(Date.now(),!1,this._pcStatsUploadType===Sc.TCP_RESTART&&n===po.RELAY?this._pcStatsUploadType:Sc.DISCONNECTED_OR_FAILED)))}},pe(ze.prototype,"startP2PConnection",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"startP2PConnection"),ze.prototype),pe(ze.prototype,"connect",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"connect"),ze.prototype),pe(ze.prototype,"updateRemoteRTPCapabilities",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"updateRemoteRTPCapabilities"),ze.prototype),pe(ze.prototype,"publishDataChannel",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"publishDataChannel"),ze.prototype),pe(ze.prototype,"unpublish",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"unpublish"),ze.prototype),pe(ze.prototype,"unpublishDataChannel",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"unpublishDataChannel"),ze.prototype),pe(ze.prototype,"unpublishLowStream",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"unpublishLowStream"),ze.prototype),pe(ze.prototype,"subscribeDataChannel",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"subscribeDataChannel"),ze.prototype),pe(ze.prototype,"subscribe",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"subscribe"),ze.prototype),pe(ze.prototype,"massSubscribe",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"massSubscribe"),ze.prototype),pe(ze.prototype,"unsubscribe",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"unsubscribe"),ze.prototype),pe(ze.prototype,"unsubscribeDataChannel",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"unsubscribeDataChannel"),ze.prototype),pe(ze.prototype,"massUnsubscribe",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"massUnsubscribe"),ze.prototype),pe(ze.prototype,"muteRemote",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"muteRemote"),ze.prototype),pe(ze.prototype,"unmuteRemote",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"unmuteRemote"),ze.prototype),pe(ze.prototype,"hasRemoteMediaWithLock",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"hasRemoteMediaWithLock"),ze.prototype),pe(ze.prototype,"disconnectForReconnect",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"disconnectForReconnect"),ze.prototype),pe(ze.prototype,"updateBitrateLimit",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"updateBitrateLimit"),ze.prototype),pe(ze.prototype,"remoteMediaSsrcChanged",[kr],Object.getOwnPropertyDescriptor(ze.prototype,"remoteMediaSsrcChanged"),ze.prototype),ze);function kr(n,r,o){const a=n[r];if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return o.value=L(function*(){const l=this.mutex,d=yield l.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield a.apply(this,p)}finally{d()}}),o}const _H={};function cC(n){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&T.debug("install service ".concat(n.name)),_H[n.name]=n}function lC(n){const r=_H[n];if(!r)throw new Y(k.INVALID_OPERATION,"".concat(n," not found, please use AgoraRTC.use(").concat(n,"Service) to load it first"));return r}function vH(n,r){return lC("DataStream").create(n,r)}function EH(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function yH(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?EH(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):EH(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}const qW=Date.now(),YW=20,W2=new Map,DD=new Map;function dC(n){return z2.apply(this,arguments)}function z2(){return z2=L(function*(n){const r=W2.get(n),o=Array.isArray(r)&&r[r.length-1],a=DD.get(n);if(!o)return void(a.isSyncing=!1);const l={uid:o.uid,payload:o.payload};0===a.firstRecvTs&&(a.firstRecvTs=o.recvTs,a.firstSendTs=o.sendTs);const d=o.sendTs-a.firstSendTs,h=d-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-d);let p=o.mediaDelay+h;p<=0?(r.pop(),OD(o.context,l),p=0):p=Math.min(p,YW),setTimeout(()=>r.length&&dC(n),p)}),z2.apply(this,arguments)}function OD(n,r){n.safeEmit(Je.STREAM_MESSAGE,r.uid,r.payload),n.onStreamMessage&&n.onStreamMessage(r)}const $W=ot().name;function bH(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function K2(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?bH(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):bH(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}const Kd="websdk_ng_cache_parameter",bv=V("MAX_PRELOAD_ASYNC_LENGTH"),SH=1e4,Lh=new Map,xh=[];let ND=null,Sv=0,hC=0;const Cv=new Map,PD=function(n,r){const o=[];let a=0;const l=function(){var d=L(function*(){const h=o.shift();h&&(yield h()),o.length>0&&a<r?l():a--});return function(){return d.apply(this,arguments)}}();return L(function*(){for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return new le(function(){var m=L(function*(g,v){o.push(L(function*(){try{const y=yield n(...h);g(y)}catch(y){v(y)}})),a<r&&(a++,l())});return function(g,v){return m.apply(this,arguments)}}())})}(fC,bv),pC=Nr.CancelToken.source();function fC(n,r,o,a,l,d){return Tv.apply(this,arguments)}function Tv(){return Tv=L(function*(n,r,o,a,l,d){try{if(!V("ENABLE_PRELOAD"))return;if(!ct().supportWebCrypto)return void vc(()=>{T.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!o&&null!==o)throw new Y(k.INVALID_PARAMS,"Invalid token: ".concat(o,". If you don not use token, set it to null"));o&&Pi(o,"token",1,2047),Pi(n,"appid",1,2047),dS(r),a&&uS(a);const h=Cf();T.debug("preload channel ".concat(r,", uid is ").concat(a));const p={appId:n,cname:r,token:o||n,uid:"string"!=typeof a?a:null,sid:h,proxyServer:l};let m,g;"string"==typeof a?(p.stringUid=a,[g,m]=yield le.all([K5(a,{sid:h,appId:n},pC.token),sD(K2(K2({},p),{},{token:o||n,uid:0}),pC.token)]),p.uid=g.uid,m.gatewayInfo.uid=p.uid,m.gatewayInfo.res.uid=p.uid):(d&&(p.stringUid=d),m=yield sD(p,pC.token));const v={sid:h,appId:n,cname:r,token:o||n,uid:p.stringUid||a,intUid:p.uid||m.gatewayInfo.uid,stringUid:p.stringUid,ts:Date.now(),sua:g,ap:m};yield(y=L(function*(b){let C;try{b.uid&&q2({appId:b.appId,cname:b.cname,token:b.token,uid:b.uid,stringUid:b.stringUid});const N=mC(b),R=yield(D=L(function*(M,x){try{const j=yield window.crypto.subtle.importKey("raw",uR(x),"AES-GCM",!1,["encrypt"]),W=yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},j,gl(window.btoa(JSON.stringify(M))));return _l(new Uint8Array(W))}catch{return}}),function(M,x){return D.apply(this,arguments)})(b,b.token||b.appId);if(!R)return;C=X2(Kd);const A=C?JSON.parse(C):[];A.push({[N]:R}),A.length>V("AP_CACHE_NUM")&&A.shift(),Iv(Kd,JSON.stringify(A))}catch(N){T.warn("Error caching server parameters:",N.message),Iv(Kd,"")}var D}),function(b){return y.apply(this,arguments)})(v),Sv++}catch(h){throw hC++,function(p){ND||(ND=window.setTimeout(()=>{let g="";Cv.forEach((v,y)=>{g+="".concat(y,": ").concat(v," ;")}),be.reportApiInvoke(null,{name:Yn.PRELOAD,options:{success:Sv,failed:hC,err:g}}).onError(p),Sv=0,hC=0,Cv.clear(),ND=null},SH));const m=Cv.get(p.code)||0;Cv.set(p.code,m+1)}(h),h}var y}),Tv.apply(this,arguments)}function MD(n){return kD.apply(this,arguments)}function kD(){return kD=L(function*(n){try{if(V("AP_REQUEST_DETAIL"))return;const r=q2(n);if(!r||"disabled"!==n.cloudProxyServer)return;const o=yield(a=L(function*(l,d){try{const h=yield window.crypto.subtle.importKey("raw",uR(d),"AES-GCM",!1,["decrypt"]),p=yield window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},h,gl(l));return JSON.parse(window.atob(_l(new Uint8Array(p))))}catch{return}}),function(l,d){return a.apply(this,arguments)})(r,n.token||n.appId);if(!o||!function(a,l){return a.cname===l.cname&&a.appId===l.appId&&a.token===l.token&&(l.stringUid?a.stringUid===l.stringUid:"number"==typeof l.uid?a.uid===l.uid:a.uid==l.uid)}(o,n))return;if(o&&Date.now()-o.ts<V("AP_CACHE_LIFETIME"))return o}catch(r){T.warn("Error get preloadInfo",r.message)}var a}),kD.apply(this,arguments)}function q2(n){let r;try{if(r=X2(Kd),!r)return;const o=JSON.parse(r),a=mC(n),l=function(h,p){for(let m=h.length-1;m>=0;m--)if(p(h[m]))return m;return-1}(o,h=>a in h);if(-1===l)return;const d=o.splice(l,1)[0];return Iv(Kd,JSON.stringify(o)),d[a]}catch(o){T.warn("Error delete preload info: ".concat(r),o.message),Iv(Kd,"")}}function LD(n){if(n){let r=Lh.get(n);r&&(window.clearTimeout(r),r=null,Lh.delete(n)),he(xh).call(xh,n)||"disabled"!==n.cloudProxyServer||xh.push(n)}if(Lh.size<V("AP_CACHE_NUM")&&xh.length>0){const r=xh.shift();Lh.set(r,window.setTimeout(L(function*(){const{appId:o,cname:a,token:l,stringUid:d,uid:h,proxyServer:p}=r;try{yield PD(o,a,l,h,p,d),Lh.has(r)&&LD(r)}catch(m){T.warn("update preload failed",m.message),Y2(r)}}),V("AP_UPDATE_INTERVAL")))}}function Y2(n){const r=xh.indexOf(n);-1!==r&&xh.splice(r,1);let o=Lh.get(n);o&&(window.clearTimeout(o),o=null,Lh.delete(n),LD())}function $2(n,r){const o=n.sua,a=n.ap;r&&o&&be.reqUserAccount(n.sid,{lts:o.requestTime,elapse:o.elapse,success:!0,serverAddr:o.url,stringUid:r,uid:n.intUid,errorCode:null,extend:o.req}),be.reportResourceTiming(n.ap.url,n.sid),be.joinWebProxyAP(n.sid,{lts:a.requestTime,elapse:a.elapse,sucess:1,apServerAddr:a.url,turnServerAddrList:a.proxyInfo.addresses.map(l=>l.ip).join(","),eventType:"disabled",unilbsServerIds:[jn.CHOOSE_SERVER,jn.CLOUD_PROXY_FALLBACK].toString()}),be.joinChooseServer(n.sid,{lts:a.requestTime,elapse:a.elapse,succ:!0,csAddr:a.url,opid:a.opid,serverList:a.gatewayInfo.gatewayAddrs.map(l=>l.address),ec:null,cid:a.gatewayInfo.cid.toString(),uid:a.gatewayInfo.uid.toString(),csIp:a.gatewayInfo.csIp,unilbsServerIds:[jn.CHOOSE_SERVER].toString(),isHttp3:a.isHttp3})}function X2(n){return window.atob(window.localStorage.getItem(n)||"")}function Iv(n,r){window.localStorage.setItem(n,window.btoa(r))}function mC(n){let r="".concat(n.appId,"_").concat(n.cname);return"string"==typeof n.uid&&(r+="_s_".concat(n.uid)),"number"==typeof n.uid&&(r+="_".concat(n.uid)),n.token&&(r+="_".concat(n.token)),Qj(r)}function XW(n,r){switch(r){case 0:for(;128&ra(n););break;case 2:wv(n,Xf(n));break;case 5:wv(n,4);break;case 1:wv(n,8);break;default:throw new Error("Unimplemented type: "+r)}}function Fh(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let TH=[];function wv(n,r){if(n.offset+r>n.limit)throw new Error("Skip past limit");n.offset+=r}function Z2(n){return n.offset>=n.limit}function gC(n,r){let o=n.bytes,a=n.offset,l=n.limit,d=a+r;if(d>o.length){let h=new Uint8Array(2*d);h.set(o),n.bytes=h}return n.offset=d,d>l&&(n.limit=d),a}function FD(n,r){let o=n.offset;if(o+r>n.limit)throw new Error("Read past limit");return n.offset+=r,o}function J2(n,r){let o=gC(n,r.length);n.bytes.set(r,o)}function Q2(n,r){let o=FD(n,r),a=String.fromCharCode,l=n.bytes,d="\ufffd",h="";for(let p=0;p<r;p++){let m,g,v,y,b=l[p+o];128&b?192==(224&b)?p+1>=r?h+=d:(m=l[p+o+1],128!=(192&m)?h+=d:(y=(31&b)<<6|63&m,y<128?h+=d:(h+=a(y),p++))):224==(240&b)?p+2>=r?h+=d:(m=l[p+o+1],g=l[p+o+2],32896!=(49344&(m|g<<8))?h+=d:(y=(15&b)<<12|(63&m)<<6|63&g,y<2048||y>=55296&&y<=57343?h+=d:(h+=a(y),p+=2))):240==(248&b)?p+3>=r?h+=d:(m=l[p+o+1],g=l[p+o+2],v=l[p+o+3],8421504!=(12632256&(m|g<<8|v<<16))?h+=d:(y=(7&b)<<18|(63&m)<<12|(63&g)<<6|63&v,y<65536||y>1114111?h+=d:(y-=65536,h+=a(55296+(y>>10),56320+(1023&y)),p+=3))):h+=d:h+=a(b)}return h}function qd(n,r){let o=r.length,a=0;for(let h=0;h<o;h++){let p=r.charCodeAt(h);p>=55296&&p<=56319&&h+1<o&&(p=(p<<10)+r.charCodeAt(++h)-56613888),a+=p<128?1:p<2048?2:p<65536?3:4}Jn(n,a);let l=gC(n,a),d=n.bytes;for(let h=0;h<o;h++){let p=r.charCodeAt(h);p>=55296&&p<=56319&&h+1<o&&(p=(p<<10)+r.charCodeAt(++h)-56613888),p<128?d[l++]=p:(p<2048?d[l++]=p>>6&31|192:(p<65536?d[l++]=p>>12&15|224:(d[l++]=p>>18&7|240,d[l++]=p>>12&63|128),d[l++]=p>>6&63|128),d[l++]=63&p|128)}}function ra(n){return n.bytes[FD(n,1)]}function IH(n,r){let o=gC(n,1);n.bytes[o]=r}function Xf(n){let r,o=0,a=0;do{r=ra(n),o<32&&(a|=(127&r)<<o),o+=7}while(128&r);return a}function Jn(n,r){for(r>>>=0;r>=128;)IH(n,127&r|128),r>>>=7;IH(n,r)}function wH(n,r){let o,a=0,l=0,d=0;return o=ra(n),a=127&o,128&o&&(o=ra(n),a|=(127&o)<<7,128&o&&(o=ra(n),a|=(127&o)<<14,128&o&&(o=ra(n),a|=(127&o)<<21,128&o&&(o=ra(n),l=127&o,128&o&&(o=ra(n),l|=(127&o)<<7,128&o&&(o=ra(n),l|=(127&o)<<14,128&o&&(o=ra(n),l|=(127&o)<<21,128&o&&(o=ra(n),d=127&o,128&o&&(o=ra(n),d|=(127&o)<<7))))))))),{low:a|l<<28,high:l>>>4|d<<24,unsigned:r}}function Yd(n,r){let o=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,l=r.high>>>24,d=0===l?0===a?o<16384?o<128?1:2:o<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:l<128?9:10,h=gC(n,d),p=n.bytes;switch(d){case 10:p[h+9]=l>>>7&1;case 9:p[h+8]=9!==d?128|l:127&l;case 8:p[h+7]=8!==d?a>>>21|128:a>>>21&127;case 7:p[h+6]=7!==d?a>>>14|128:a>>>14&127;case 6:p[h+5]=6!==d?a>>>7|128:a>>>7&127;case 5:p[h+4]=5!==d?128|a:127&a;case 4:p[h+3]=4!==d?o>>>21|128:o>>>21&127;case 3:p[h+2]=3!==d?o>>>14|128:o>>>14&127;case 2:p[h+1]=2!==d?o>>>7|128:o>>>7&127;case 1:p[h]=1!==d?128|o:127&o}}const eF={},tF={},UD=4294967296,RH=UD*UD,nF=RH/2,VD=BD(0,!0),AH=BD(0),ZW=Zf(0,-2147483648,!1),JW=Zf(-1,2147483647,!1),DH=Zf(-1,-1,!0);function BD(n,r){let o,a,l;return r?(l=0<=(n>>>=0)&&n<256)&&(a=tF[n],a)?a:(o=Zf(n,0,!0),l&&(tF[n]=o),o):(l=-128<=(n|=0)&&n<128)&&(a=eF[n],a)?a:(o=Zf(n,n<0?-1:0,!1),l&&(eF[n]=o),o)}function Zf(n,r,o){return{low:0|n,high:0|r,unsigned:!!o}}function OH(n,r){if(isNaN(n))return r?VD:AH;if(r){if(n<0)return VD;if(n>=RH)return DH}else{if(n<=-nF)return ZW;if(n+1>=nF)return JW}return n<0?r?VD:AH:Zf(n%UD|0,n/UD|0,r)}function jD(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}class iF extends nn{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const o=this._connectionState;this._connectionState=r,this.emit(Ma.CONNECTION_STATE_CHANGE,r,o)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var o;super(),O(this,"name","AgoraRTCImageModeration"),O(this,"_connectionState",Is.CONNECTING),O(this,"_sequence",0),O(this,"_moderationStartTime",void 0),O(this,"_workerConnection",void 0),O(this,"_workerMessageLengthLimit",void 0),O(this,"_qualityRatio",void 0),O(this,"_connectInfo",void 0),O(this,"_cancelTokenSource",Nr.CancelToken.source()),O(this,"_retryConfig",void 0),O(this,"_moderationInterval",void 0),O(this,"_moderationTimer",null),O(this,"_moderationMode",1),O(this,"_quality",1),O(this,"_qualityTimer",null),O(this,"_ticket",void 0),O(this,"_moderationIntervalMinimum",void 0),O(this,"_uploadFailedNum",0),O(this,"_uploadNum",0),O(this,"_uploadTimer",null),O(this,"_extraInfo",void 0),O(this,"_vendor",""),O(this,"_encoder",new TextEncoder),O(this,"_moderationId",void 0),O(this,"inspectImage",()=>{if(this.connectionState!==Is.CONNECTED)throw new z(k.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Is.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Ct(5,"image-moderation-"),this._workerMessageLengthLimit=V("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=V("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(o=r.interval)&&void 0!==o?o:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=V("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new P_("worker-"+this._moderationId,Nn),this.on(Ma.STATE_CHANGE,(a,l)=>{T.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Od[a]," ").concat(l||""))}),this.handleWorkerEvents()}init(r,o){var a=this;return L(function*(){a.emit(Ma.STATE_CHANGE,Od.CONNECT_AP),a._connectInfo=r;const l=a._cancelTokenSource.token;return a._retryConfig=o,new le((d,h)=>{a.on(Ma.CONNECTION_STATE_CHANGE,(p,m)=>{p===Is.CONNECTED&&d()}),a.requestAP(r,l,o).then(p=>{a.connectWorker(p)}).catch(p=>{h(p)})})})()}updateConfig(r){var o;this._moderationInterval=null!==(o=r.interval)&&void 0!==o?o:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),T.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===Is.CONNECTED&&this.inspectImage()}requestAP(r,o,a){var l=this;return L(function*(){const d=V("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),h=yield function(g,v,y,b){let{appId:C,areaCode:N,cname:R,sid:A,token:D,uid:M}=v;Wf++;const x="moderation_plugin",j={service_name:x,json_body:JSON.stringify({appId:C,areaCode:N,cname:R,command:"allocateEdge",requestId:Wf,seq:Wf,sid:A,appToken:D,ts:Date.now(),uid:M+""})};let W,q,ee=g[0];return rs(L(function*(){W=Date.now();const J=yield ta(ee,{data:j,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(q=Date.now()-W,0!==J.code){const Re=new z(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+J.code,{retry:!0,responseTime:q});throw T.error(Re.toString()),Re}const X=JSON.parse(J.json_body);if(200!==X.code){const Re=new z(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(X.code,", reason: ").concat(X.reason),{code:X.code,responseTime:q});throw T.error(Re.toString()),Re}if(!X.servers||!Array.isArray(X.servers)||0===X.servers.length){const Re=new z(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:X.code,responseTime:q});throw T.error(Re.toString()),Re}if(!X.servers.some(Re=>!!Re.wss)){const Re=new z(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:X.code,responseTime:q});throw T.error(Re.toString()),Re}const Ce=V("IMAGE_MODERATION_WORKER_HOST");return{addressList:X.servers.map(Re=>{let{address:ut,wss:Nt}=Re;if(ut&&Nt)return"wss://".concat(ut.replace(/\./g,"-"),".").concat(Ce,":").concat(Nt,"/moderation")}).filter(Re=>!!Re),workerToken:X.workerToken,vid:X.vid,ticket:X.appTicket,responseTime:q}}),(J,X)=>(be.apworkerEvent(A,{success:!0,sc:200,serviceName:x,responseDetail:JSON.stringify(J.addressList),firstSuccess:0===X,responseTime:q,serverIp:g[X%g.length]}),!1),(J,X)=>(be.apworkerEvent(A,{success:!1,sc:J.data&&J.data.code||200,serviceName:x,responseTime:q,serverIp:g[X%g.length]}),!!(J.code!==k.OPERATION_ABORTED&&J.code!==k.UNEXPECTED_RESPONSE||J.data&&J.data.retry)&&(ee=g[(X+1)%g.length],!0)),b)}(d,r,o,a);l.emit(Ma.STATE_CHANGE,Od.AP_CONNECTED);const{addressList:p,ticket:m}=h;return l._ticket=m,p})()}connectWorker(r){var o=this;return L(function*(){o.emit(Ma.STATE_CHANGE,Od.CONNECT_WORKER),yield o._workerConnection.init(r,1e4)})()}handleWorkerEvents(){var r=this;this._workerConnection.on(Fe.CONNECTED,L(function*(){r.emit(Ma.STATE_CHANGE,Od.WORKER_CONNECTED,r._workerConnection.url),r.connectionState=Is.CONNECTED})),this._workerConnection.on(Fe.CLOSED,()=>{this.connectionState=Is.CLOSED}),this._workerConnection.on(Fe.FAILED,()=>{this.connectionState=Is.CLOSED}),this._workerConnection.on(Fe.RECONNECTING,()=>{this.connectionState=this.connectionState===Is.CONNECTED?Is.RECONNECTING:Is.CONNECTING}),this._workerConnection.on(Fe.ON_MESSAGE,function(){var o=L(function*(a){if(a.data instanceof ArrayBuffer){const l=function CH(n){return function(o){let a={};e:for(;!Z2(o);){let l=Xf(o);switch(l>>>3){case 0:break e;case 1:a.code=Xf(o);break;case 2:a.msg=Q2(o,Xf(o));break;case 3:a.requestId=Q2(o,Xf(o));break;case 4:a.timestamp=wH(o,!1);break;default:XW(o,7&l)}}return a}({bytes:r=n,offset:0,limit:r.length});var r}(new Uint8Array(a.data));V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("[".concat(r._moderationId,"] Response message for worker of image moderation "),JSON.stringify(l)),r._uploadNum++,void 0===l.code||0===l.code||(r._uploadFailedNum++,T.error("[".concat(r._moderationId,"] Error response from worke, code is ").concat(l.code,", msg is ").concat(l.msg)),r._uploadTimer||(r._uploadTimer=window.setTimeout(()=>{be.reportApiInvoke(r._connectInfo.sid||null,{name:Yn.IMAGE_MODERATION_UPLOAD,options:[r._uploadFailedNum,r._uploadNum,l.code],tag:st.TRACER}).onError(new z(k.IMAGE_MODERATION_UPLOAD_FAILED,l.msg)),r._uploadTimer=null},V("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else T.error("[".concat(r._moderationId,"] Unexpected message type from worker"))});return function(a){return o.apply(this,arguments)}}()),this._workerConnection.on(Fe.WILL_RECONNECT,(o,a,l)=>{"recover"===o&&l(o),l("tryNext")}),this._workerConnection.on(Fe.REQUEST_NEW_URLS,(o,a)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o).catch(a)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}requestToInspectImage(){var r=this;return L(function*(){const o=Do(r,Ma.CLIENT_LOCAL_VIDEO_TRACK),a={appId:r._connectInfo.appId,cname:r._connectInfo.cname,cid:r._connectInfo.cid,sid:r._connectInfo.sid,uid:r._connectInfo.uid,vid:r._connectInfo.vid};if(o){if(!o.isPlaying)return void(V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being played can be inspected"));r._sequence++;const l=yield r.generateRequestData(o,a);r._workerConnection.sendMessage(l,!0,!0)}else V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being published can be inspected")})()}generateRequestData(r,o){var a=this;return L(function*(){let{appId:l,cname:d,cid:h,vid:p,sid:m,uid:g}=o;const v=Date.now(),y=yield r.getCurrentFrameImage("image/jpeg",a.quality),b=yield vx(y,l,d),C=a._sequence+"-"+h+"-"+g+"-"+v+"-"+Ct(12,""),N={appId:l,cid:h,cname:d,deviceId:"",elapse:iF.intToLong(Number(v-a._moderationStartTime)),fileSize:y.buffer.byteLength,height:y.height,width:y.width,jpg:b,networkType:6,osType:7,requestId:C,sdkVersion:"4.22.2",sequence:a._sequence,sid:m,timestamp:OH(v),uid:g,vid:p,service:a._moderationMode,ticket:a._ticket,callbackData:a._extraInfo,vendorConfigs:a._vendor};void 0===a._extraInfo&&delete N.callbackData;const R=function xD(n){let r=function(){const o=TH.pop();return o?(o.offset=o.limit=0,o):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(o,a){let l=o.appId;void 0!==l&&(Jn(a,10),qd(a,l));let d=o.cid;void 0!==d&&(Jn(a,16),Jn(a,d));let h=o.cname;void 0!==h&&(Jn(a,26),qd(a,h));let p=o.deviceId;void 0!==p&&(Jn(a,34),qd(a,p));let m=o.elapse;void 0!==m&&(Jn(a,40),Yd(a,m));let g=o.fileSize;void 0!==g&&(Jn(a,48),Yd(a,Fh(g)));let v=o.height;void 0!==v&&(Jn(a,56),Yd(a,Fh(v)));let y=o.jpg;void 0!==y&&(Jn(a,66),Jn(a,y.length),J2(a,y));let b=o.networkType;void 0!==b&&(Jn(a,72),Yd(a,Fh(b)));let C=o.osType;void 0!==C&&(Jn(a,80),Yd(a,Fh(C)));let N=o.requestId;void 0!==N&&(Jn(a,90),qd(a,N));let R=o.sdkVersion;void 0!==R&&(Jn(a,98),qd(a,R));let A=o.sequence;void 0!==A&&(Jn(a,104),Yd(a,Fh(A)));let D=o.sid;void 0!==D&&(Jn(a,114),qd(a,D));let M=o.timestamp;void 0!==M&&(Jn(a,120),Yd(a,M));let x=o.uid;void 0!==x&&(Jn(a,128),Jn(a,x));let j=o.vid;void 0!==j&&(Jn(a,136),Jn(a,j));let W=o.width;void 0!==W&&(Jn(a,144),Yd(a,Fh(W)));let q=o.service;void 0!==q&&(Jn(a,152),Jn(a,q));let ee=o.callbackData;void 0!==ee&&(Jn(a,162),Jn(a,ee.length),J2(a,ee));let J=o.ticket;void 0!==J&&(Jn(a,170),qd(a,J));let X=o.vendorConfigs;void 0!==X&&(Jn(a,178),qd(a,X))}(n,r),function(o){let a=o.bytes,l=o.limit;return a.length===l?a:a.subarray(0,l)}(r)}(N);if(R.byteLength<a._workerMessageLengthLimit){if(V("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const A=function(D){for(var M=1;M<arguments.length;M++){var x=null!=arguments[M]?arguments[M]:{};M%2?jD(Object(x),!0).forEach(function(j){O(D,j,x[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(D,Object.getOwnPropertyDescriptors(x)):jD(Object(x)).forEach(function(j){Object.defineProperty(D,j,Object.getOwnPropertyDescriptor(x,j))})}return D}({},N);delete A.jpg,T.debug("[".concat(a._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(A))}return R}return a.quality=a.quality*a._qualityRatio,yield a.generateRequestData(r,{appId:l,cname:d,cid:h,vid:p,sid:m,uid:g})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Nr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Is.CLOSED,this.emit(Ma.STATE_CHANGE,Od.CLOSED)}}function NH(n){if(Ut(n.interval,"interval",1e3,1/0),n&&n.extraInfo&&n.extraInfo.length>1024)throw new z(k.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(n&&n.vendor&&n.vendor.length>1024)throw new z(k.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const QW={name:"ImageModeration",create:function(n){let{config:r}=n;return NH(r),new iF(r)}};var rF,PH,MH,kH,LH,xH,FH,UH,VH,$d,Rv,BH,jH,HH,GH,WH,zH,KH,_C,vC,oF,EC,sF,aF,cF,lF,dF,uF,hF,pF,HD,fF,yC,mF,bC,GD,gF,_F,vF,kl,fe;function EF(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function Os(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?EF(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):EF(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}Qi.setLogger(T);let qH=(rF=Ae(),PH=Ae({argsMap:(n,r)=>{if(!Array.isArray(r)){if(!(r instanceof Ch))return[r];r=[r]}return r.map(o=>o?Object(o).toString():"null")}}),MH=Ae({argsMap:(n,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==Tl.DATA?(Array.isArray(r)||(r=[r]),r.map(o=>o.getTrackId())):[r.getChannelId()])}),kH=Ae({argsMap:(n,r,o,a)=>["object"==typeof r?r.uid:r,o,a]}),LH=Ae({argsMap:(n,r,o)=>[r,o]}),xH=Ae({argsMap:(n,r)=>r.map(o=>{let{user:a,mediaType:l}=o;return[a?.uid,l]})}),FH=Ae({argsMap:(n,r,o,a)=>["object"==typeof r?r.uid:r,o,a]}),UH=Ae({argsMap:(n,r)=>r.map(o=>{let{user:a,mediaType:l}=o;return{uid:a?.uid,mediaType:l}})}),VH=Ae(),$d=Ae(),Rv=Ae(),BH=Ae(),jH=Ae(),HH=Ae(),GH=Ae(),WH=Ae(),zH=Ae(),KH=Ae(),_C=Ae(),vC=Ae(),oF=Ae(),EC=Ae(),sF=Ae({argsMap:(n,r)=>[r]}),aF=Ae(),cF=Ae(),lF=Ae(),dF=Ae(),uF=Ae(),hF=Ae(),pF=Ae(),HD=Ae(),fF=Ae({argsMap:(n,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),yC=Ae(),mF=Ae(),bC=Ae(),GD=Ae(),gF=Ae(),_F=Ae(),vF=Ae({reportResult:!0}),kl=Ae(),fe=class extends nn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var n;return(null===(n=this._config)||void 0===n?void 0:n.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(n,r){var o;let a;if(super(),o=this,O(this,"store",void 0),O(this,"_uid",void 0),O(this,"_channelName",void 0),O(this,"_uintUid",void 0),O(this,"_users",[]),O(this,"_config",void 0),O(this,"_clientId",void 0),O(this,"_appId",void 0),O(this,"_sessionId",null),O(this,"_key",void 0),O(this,"_rtmConfig",{}),O(this,"_joinInfo",void 0),O(this,"_gateway",void 0),O(this,"_statsCollector",void 0),O(this,"_configDistribute",void 0),O(this,"_leaveMutex",void 0),O(this,"_publishMutex",void 0),O(this,"_renewTokenMutex",void 0),O(this,"_subscribeMutex",void 0),O(this,"_encryptionMode","none"),O(this,"_encryptionSecret",null),O(this,"_encryptionSalt",null),O(this,"_encryptDataStream",!1),O(this,"_encryptDataStreamKey",null),O(this,"_encryptDataStreamIv",null),O(this,"_proxyServer",void 0),O(this,"_turnServer",{servers:[],mode:"auto"}),O(this,"_cloudProxyServerMode","disabled"),O(this,"_isDualStreamEnabled",!1),O(this,"_defaultStreamFallbackType",void 0),O(this,"_lowStreamParameter",void 0),O(this,"_streamFallbackTypeCacheMap",new Map),O(this,"_remoteStreamTypeCacheMap",new Map),O(this,"_axiosCancelSource",Nr.CancelToken.source()),O(this,"_audioVolumeIndicationInterval",void 0),O(this,"_networkQualityInterval",void 0),O(this,"_userOfflineTimeout",void 0),O(this,"_streamRemovedTimeout",void 0),O(this,"_liveTranscodeStreamingClient",void 0),O(this,"_liveRawStreamingClient",void 0),O(this,"_channelMediaRelayClient",void 0),O(this,"_networkQualitySensitivity","normal"),O(this,"_p2pChannel",void 0),O(this,"_useLocalAccessPoint",!1),O(this,"_setLocalAPVersion",void 0),O(this,"_joinAndNotLeaveYet",!1),O(this,"_numberOfJoinCount",0),O(this,"_remoteDefaultVideoStreamType",void 0),O(this,"_inspect",void 0),O(this,"_moderation",void 0),O(this,"_license",void 0),O(this,"_pendingPublishedUsers",[]),O(this,"ntpAlignErrorCount",0),O(this,"remoteInboundOffset",0),O(this,"_handleLocalTrackEnable",(l,d,h)=>{this.publish(l,!1).then(d).catch(h)}),O(this,"_handleLocalTrackDisable",(l,d,h)=>{this.unpublish(l).then(d).catch(h)}),O(this,"_handleUserOnline",l=>{if(V("BLOCK_LOCAL_CLIENT")&&Dd(l.uid,this.channelName))return void T.debug("[".concat(l.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof l.uid&&T.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find(h=>h.uid===l.uid);if(d)d._trust_in_room_=!0,d._is_pre_created&&(d._is_pre_created=!1,this.safeEmit(Je.USER_JOINED,d));else{const h=new Mh(l.uid,l.uint_id||l.uid);this._users.push(h),T.debug("[".concat(this._clientId,"] user online"),l.uid),this.safeEmit(Je.USER_JOINED,h)}}),O(this,"_handleUserOffline",l=>{if(V("BLOCK_LOCAL_CLIENT")&&Dd(l.uid,this.channelName))return;const d=this._users.find(h=>h.uid===l.uid);d&&(this._handleRemoveStream(l),this._handleRemoveDataChannels(l),d._audio_pre_subscribed||d._video_pre_subscribed?d._is_pre_created=!0:Be(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),T.debug("[".concat(this._clientId,"] user offline"),l.uid,"reason:",l.reason),this.safeEmit(Je.USER_LEAVED,d,l.reason))}),O(this,"_handleAddAudioOrVideoStream",(l,d,h,p,m,g,v)=>{if(V("BLOCK_LOCAL_CLIENT")&&Dd(d,this.channelName))return;const y=this._users.find(C=>C.uid===d);if(!y)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(l)),this.store.subscribe(y.uid,l,void 0,void 0,void 0,Date.now());const b="audio"===l?y.hasAudio:y.hasVideo;y._uintid||(y._uintid=m||d),"audio"===l?y._trust_audio_stream_added_state_=!0:y._trust_video_stream_added_state_=!0,"audio"===l?(y._audio_added_=!0,void 0!==h&&(y._audioSSRC=h),void 0!==p&&(y._cname=p),g&&(y._audioOrtc=g)):(y._video_added_=!0,void 0!==h&&(y._videoSSRC=h),void 0!==p&&(y._cname=p),void 0!==v&&(y._rtxSsrcId=v),g&&(y._videoOrtc=g)),("audio"===l?y.hasAudio:y.hasVideo)&&!b&&(T.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published ").concat(l)),this.safeEmit(Je.USER_PUBLISHED,y,l)),"video"===l?be.onGatewayStream(this._sessionId,Mi.ON_ADD_VIDEO_STREAM,sn.ON_ADD_VIDEO_STREAM,{peer:m||d,ssrc:y._videoSSRC}):be.onGatewayStream(this._sessionId,Mi.ON_ADD_AUDIO_STREAM,sn.ON_ADD_AUDIO_STREAM,{peer:m||d,ssrc:y._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(y,l,h).then(C=>{if(C&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(y.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof aC))return this._p2pChannel.unsubscribe(y,l,!0).then(()=>this._subscribe(y,l,!0).catch(N=>{T.error("[".concat(this._clientId,"] resubscribe error"),N.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(y,l)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(y.uid," after reconnect.")),this._subscribe(y,l,!0).catch(C=>{T.error("[".concat(this._clientId,"] resubscribe error"),C.toString())}))}),O(this,"_handleRemoveStream",l=>{if(V("BLOCK_LOCAL_CLIENT")&&Dd(l.uid,this.channelName))return;const d=this._users.find(p=>p.uid===l.uid);if(!d)return void T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));T.debug("[".concat(this._clientId,"] stream removed with uid ").concat(l.uid));let h=()=>{};d.hasAudio&&d.hasVideo?h=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Je.USER_UNPUBLISHED,d,"audio"),T.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Je.USER_UNPUBLISHED,d,"video")}:d.hasVideo?h=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Je.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(h=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Je.USER_UNPUBLISHED,d,"audio")}),d._video_pre_subscribed||d._audio_pre_subscribed||(d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof aC&&this._p2pChannel.unsubscribe(d).then(p=>{if(p)return this._gateway.unsubscribe(p,d.uid)}),d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),be.onGatewayStream(this._sessionId,Mi.ON_REMOVE_STREAM,sn.ON_REMOVE_STREAM,{peer:l.uint_id||l.uid}),h()}),O(this,"_handleSetStreamLocalEnable",(l,d,h)=>{if(V("BLOCK_LOCAL_CLIENT")&&Dd(d,this.channelName))return;const p=this._users.find(v=>v.uid===d);if(!p)return void T.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));T.debug("[".concat(this._clientId,"] local ").concat(l," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const m="audio"===l?p.hasAudio:p.hasVideo;if("audio"===l){p._trust_audio_enabled_state_=!0;const v=p._audio_enabled_;if(p._audio_enabled_=h,p._audio_enabled_===v)return;{const y=p._audio_enabled_?"enable-local-audio":"disable-local-audio";T.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(y)),this.safeEmit(Je.USER_INFO_UPDATED,d,y)}}else{p._trust_video_enabled_state_=!0;const v=p._video_enabled_;if(p._video_enabled_=h,p._video_enabled_===v)return;{const y=p._video_enabled_?"enable-local-video":"disable-local-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(y)),this.safeEmit(Je.USER_INFO_UPDATED,d,y)}}const g="audio"===l?p.hasAudio:p.hasVideo;return m!==g?!m&&g?(T.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(l)),void this.safeEmit(Je.USER_PUBLISHED,p,l)):("video"===l&&p._videoTrack&&p._videoTrack._destroy(),this._p2pChannel.muteRemote(p,l),T.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(l)),void this.safeEmit(Je.USER_UNPUBLISHED,p,l)):void 0}),O(this,"_handleMuteStream",(l,d,h)=>{if(V("BLOCK_LOCAL_CLIENT")&&Dd(l,this.channelName))return;T.debug("[".concat(this._clientId,"] receive mute message"),l,d,h);const p=this._users.find(v=>v.uid===l);if(!p)return void T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(l));const m="audio"===d?p.hasAudio:p.hasVideo;if("audio"===d){p._trust_audio_mute_state_=!0;const v=p._audio_muted_;if(p._audio_muted_=h,p._audio_muted_===v)return;{const y=p._audio_muted_?"mute-audio":"unmute-audio";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(y)),this.safeEmit(Je.USER_INFO_UPDATED,l,y)}}else{p._trust_video_mute_state_=!0;const v=p._video_muted_;if(p._video_muted_=h,p._video_muted_===v)return;{const y=p._video_muted_?"mute-video":"unmute-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(y)),this.safeEmit(Je.USER_INFO_UPDATED,l,y)}}const g="audio"===d?p.hasAudio:p.hasVideo;if(m!==g){if(!m&&g)return("audio"===d?p._audioSSRC:p._videoSSRC)?(T.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(d)),void this.safeEmit(Je.USER_PUBLISHED,p,d)):void T.warning("[".concat(this._clientId,"] remote user ").concat(l," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));"video"===d&&p._videoTrack&&!p._video_pre_subscribed&&p._videoTrack._destroy(),this._p2pChannel.muteRemote(p,d),T.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(d)),this.safeEmit(Je.USER_UNPUBLISHED,p,d)}}),O(this,"_handleP2PLost",function(){var l=L(function*(d){T.debug("[".concat(o._clientId,"] receive p2p lost"),d),parseInt(d.p2pid,10)===o.store.p2pId?yield o._p2pChannel.requestReconnect():T.warning("[".concat(o._clientId,"] P2PLost stream not found"),d)});return function(d){return l.apply(this,arguments)}}()),O(this,"_handleTokenWillExpire",()=>{T.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Je.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),O(this,"_handleBeforeUnload",l=>{"beforeunload"===l.type&&void 0!==l.returnValue&&""!==l.returnValue||(this.leave(),T.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),O(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(Je.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const l={downlinkNetworkQuality:0,uplinkNetworkQuality:0};l.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),l.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Je.NETWORK_QUALITY,l)}),O(this,"_handleP2PAddAudioOrVideoStream",(l,d,h,p)=>{const m=this._users.find(v=>v.uid===d);if(!m)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(l)),this.store.subscribe(m.uid,l,void 0,void 0,void 0,Date.now());const g="audio"===l?m.hasAudio:m.hasVideo;"audio"===l?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,"audio"===l?(m._audio_added_=!0,void 0!==h&&(m._audioSSRC=h),void 0!==p&&(m._audioMid=p)):(m._video_added_=!0,void 0!==h&&(m._videoSSRC=h),void 0!==p&&(m._videoMid=p)),("audio"===l?m.hasAudio:m.hasVideo)&&!g&&(T.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(l)),this.safeEmit(Je.USER_PUBLISHED,m,l)),this._p2pChannel.hasPendingRemoteMedia(m,l)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,l,!0).catch(v=>{T.error("[".concat(this._clientId,"] resubscribe error"),v.toString())}))}),this._config=n,this._clientId=r||Ct(5,"client-"),this.store=new e4(n.codec,n.audioCodec,n.mode,this._clientId),this._leaveMutex=new Qi("client-leave",this._clientId),this._publishMutex=new Qi("client-publish",this._clientId),this._renewTokenMutex=new Qi("client-renewtoken",this._clientId),this._subscribeMutex=new Qi("client-subscribe",this._clientId),this.store.clientCreated(),n.proxyServer&&this.setProxyServer(n.proxyServer,!0),n.turnServer&&this.setTurnServer(n.turnServer,!0),T.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ss," build: ").concat(_R,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),n.clientRoleOptions)try{Zj(n.clientRoleOptions),a=Object.assign({},n.clientRoleOptions)}catch(l){T.warning("[".concat(this._clientId,"] ").concat(l.toString()))}this._statsCollector=new nC(this.store),this._statsCollector.onStatsException=(l,d,h)=>{T.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(l,", msg: ").concat(d,", uid: ").concat(h)),this.safeEmit(Je.EXCEPTION,{code:l,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(l,d,h,p)=>{const m=this._users.find(g=>g.uid===l);m&&be.peerPublishStatus(this._sessionId,{subscribeElapse:p,audioPublishDuration:d,videoPublishDuration:h,peer:m._uintid})},this.store.useP2P="p2p"===n.mode,this._gateway=new YS(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:n.websocketRetryConfig||Nn,httpRetryConfig:n.httpRetryConfig||Nn,forceWaitGatewayResponse:void 0===n.forceWaitGatewayResponse||n.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:n.role,clientRoleOptions:a}),this._configDistribute=new GW(this._clientId),this.store.useP2P?(this._p2pChannel=new us(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new aC(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}joinMeta(n,r,o,a,l){var d=arguments,h=this;return L(function*(){let p=!(d.length>5&&void 0!==d[5])||d[5],m=d.length>6&&void 0!==d[6]&&d[6];Lt("JOIN_GATEWAY_USE_443PORT_ONLY",p),Lt("JOIN_GATEWAY_USE_DUAL_DOMAIN",m);const g=h._gateway.signal.websocket;return g instanceof xR&&(g.use443PortOnly=p,g.tryDoubleDomain=m),(v=L(function*(y,b,C){p_.get(y)||p_.set(y,[]),Xb.get(y)||Xb.set(y,b),_c.get(y)||_c.set(y,0);const N=p_.get(y),R=Xb.get(y);if(!N||!R)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(_c.get(y)===R){const j=Ni();N.push(j),yield j.promise}_c.set(y,_c.get(y)+1);for(var A=arguments.length,D=new Array(A>3?A-3:0),M=3;M<A;M++)D[M-3]=arguments[M];const x=yield C(...D);return _c.set(y,_c.get(y)-1),_c.get(y)===R-1&&N.length>0&&(N[0].resolve(),N.shift()),0===_c.get(y)&&(p_.set(y,[]),Xb.set(y,0),_c.set(y,0)),x}),function(y,b,C){return v.apply(this,arguments)})("client.join",V("JOIN_MAX_CONCURRENCY"),h.join.bind(h),n,r,o,a,l);var v})()}join(n,r,o,a,l){var d=this;return L(function*(){const h=++d._numberOfJoinCount;d.store.joinStart(),a&&(d.store.uid=a);const p="HTTPS"===(Hr||Hr||(Hr=(window.location.protocol.split(":")[0]||"").toUpperCase(),Hr)),m=Z1()?window.isSecureContext:"Browser Not Support";(!Z1()&&!p||!window.isSecureContext)&&T.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),"DISCONNECTED"===d.connectionState&&(d.store.avoidJoinStart=Math.round(Date.now()),T.debug("[".concat(d._clientId,"] set avoidJoinStart to ").concat(d.store.avoidJoinStart))),be.setAppId(n);try{if(!o&&null!==o)throw new z(k.INVALID_PARAMS,"Invalid token: ".concat(o,". If you don not use token, set it to null"));o&&Pi(o,"token",1,2047),Pi(n,"appid",1,2047),dS(r),a&&uS(a),l&&Pi(l,"optionalInfo",1,2047)}catch(A){throw be.reportApiInvoke(Cf(),{name:Yn.JOIN,options:[n,r,o,a],states:{isHttps:p,isSecureContext:m},tag:st.TRACER}).onError(A),A}if(d._leaveMutex.isLocked&&(T.debug("[".concat(d._clientId,"] join: waiting leave operation")),(yield d._leaveMutex.lock())(),T.debug("[".concat(d._clientId,"] join: continue"))),d._joinAndNotLeaveYet=!0,"DISCONNECTED"!==d.connectionState){const A=new z(k.INVALID_OPERATION,"[".concat(d._clientId,"] Client already in connecting/connected state"));throw be.reportApiInvoke(Cf(),{name:Yn.JOIN,options:[n,r,o,a],states:{isHttps:p,isSecureContext:m},tag:st.TRACER}).onError(A),A}d._gateway.state="CONNECTING";const g=yield MD({appId:n,cname:r,uid:a,stringUid:"string"==typeof a?a:void 0,token:o||n,cloudProxyServer:d._cloudProxyServerMode});if(!d._joinAndNotLeaveYet)throw new z(k.INVALID_OPERATION,"[".concat(d._clientId,"] Client already left"));const v=g?.sid||Cf();T.info("[".concat(d._clientId,"] start join channel ").concat(r,", join number: ").concat(h)),d._sessionId||(d._sessionId=v,d.store.sessionId=d._sessionId);const y=be.reportApiInvoke(v,{id:d._clientId,name:Yn.JOIN,options:[n,r,o,a],states:{isHttps:p,isSecureContext:m},tag:st.TRACER}),b=Os(Os(Os({},d._rtmConfig),{},{clientId:d._clientId,appId:n,sid:d._sessionId,cname:r,uid:"string"!=typeof a?a:null,turnServer:d._turnServer,proxyServer:d._proxyServer,token:o||n,cloudProxyServer:d._cloudProxyServerMode,optionalInfo:l,license:d._license,useLocalAccessPoint:d._useLocalAccessPoint,preload:!!g},void 0!==d._remoteDefaultVideoStreamType&&{defaultVideoStream:d._remoteDefaultVideoStreamType}),{},{apRequestDetail:V("AP_REQUEST_DETAIL")||void 0});if(d._useLocalAccessPoint&&(b.setLocalAPVersion=d._setLocalAPVersion),"string"==typeof a&&(b.stringUid=a,d._uintUid?(b.uid=d._uintUid,d._uintUid=void 0):b.uid=0),"none"!==d._encryptionMode&&d._encryptionSecret){if(b.aesmode=d._encryptionMode,b.aespassword=yield(A=L(function*(D){const M=function(){const ee=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),J=new Uint8Array(new ArrayBuffer(ee.length));for(let X=0;X<ee.length;X+=1)J[X]=ee.charCodeAt(X);return J}(),x=yield window.crypto.subtle.importKey("spki",M,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),j=v_(D),W=yield window.crypto.subtle.encrypt({name:"RSA-OAEP"},x,j);return function(q){let ee="";for(let J=0;J<q.length;J+=1)ee+=String.fromCharCode(q[J]);return window.btoa(ee)}(new Uint8Array(W))}),function(D){return A.apply(this,arguments)})(d._encryptionSecret),!d._joinAndNotLeaveYet)throw new z(k.INVALID_OPERATION,"[".concat(d._clientId,"] Client already left"));d._encryptionSalt&&(b.aessalt=d._encryptionSalt)}var A,M;if(d._encryptDataStream&&("aes-128-gcm2"===d._encryptionMode||"aes-256-gcm2"===d._encryptionMode))if(d._encryptionSalt&&d._encryptionSecret)if(window.crypto.subtle){const A=new TextEncoder,D=V("USE_PURE_ENCRYPTION_MASTER_KEY")?A.encode(b.appId+d._encryptionSecret+d._encryptionSecret):A.encode(b.appId+b.cname+d._encryptionSecret);d._encryptDataStreamIv=yield(M=L(function*(x,j,W){const q=yield window.crypto.subtle.importKey("raw",j,"PBKDF2",!1,["deriveBits","deriveKey"]),ee="aes-128-gcm2"===x?128:256,J=yield window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:W},q,ee+96);return new Uint8Array(J).subarray(ee/8)}),function(x,j,W){return M.apply(this,arguments)})(d._encryptionMode,D,gl(d._encryptionSalt)),d._encryptDataStreamKey=yield function(){var M=L(function*(x,j,W){const q=yield window.crypto.subtle.importKey("raw",j,"PBKDF2",!1,["deriveBits","deriveKey"]),ee="aes-128-gcm2"===x?128:256;return yield window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:W},q,{name:"AES-GCM",length:ee},!0,["encrypt","decrypt"])});return function(x,j,W){return M.apply(this,arguments)}}()(d._encryptionMode,D,gl(d._encryptionSalt))}else T.warning("[".concat(d._clientId,m?"] encrypt datastream must be running in a secure context, fallback to plain data stream":"] current browser do not support WebCrypto ,fallback to plain data stream")),d._encryptDataStream=!1;else d._encryptDataStream=!1,T.debug("[".concat(d._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));d._startSession(d._sessionId,{channel:r,appId:n,stringUid:b.stringUid});const C=d._sessionId;setTimeout(()=>{"CONNECTING"===d.connectionState&&C===d._sessionId&&be.joinChannelTimeout(d._sessionId,5)},5e3);try{var N;let A;const D=b.cloudProxyServer;if(he(N=["proxy3","proxy4","proxy5"]).call(N,D)){const q=V("PROXY_SERVER_TYPE3");b.proxyServer=Array.isArray(q)?q[0]:q}if(be.setProxyServer(b.proxyServer),T.setProxyServer(b.proxyServer),d.store.requestAPStart(),g){if(T.debug("[".concat(d._clientId,"] get serverInfo Success from Preload Cache ").concat(b.stringUid?", ".concat(b.stringUid," => ").concat(g.intUid):""," ")),b.stringUid&&!b.uid&&(b.uid=g.intUid),A={gatewayInfo:g.ap.gatewayInfo},V("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&"auto"===b.turnServer.mode)if(0===g.ap.proxyInfo.addresses.length)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const q=(yield L_(g.ap.proxyInfo,g.ap.gatewayInfo.uid)).map(ee=>({turnServerURL:ee.address,tcpport:ee.tcpport||Wi.tcpport,udpport:ee.udpport||Wi.udpport,username:ee.username||Wi.username,password:ee.password||Wi.password,forceturn:!1,security:!0}));b.turnServer={mode:"manual",servers:q}}$2(g,b.stringUid)}else{if(b.stringUid&&!b.uid){let q;[q,A]=yield le.all([rD(b.stringUid,b,d._axiosCancelSource.token,d._config.httpRetryConfig||Nn,d.store),u2(b,d._axiosCancelSource.token,d._config.httpRetryConfig||Nn,!0,d.store)]),T.debug("[".concat(d._clientId,"] getUserAccount Success ").concat(b.stringUid," => ").concat(q)),b.uid=q,A.gatewayInfo.uid=q,A.gatewayInfo.res.uid=q}else A=yield u2(b,d._axiosCancelSource.token,d._config.httpRetryConfig||Nn,!0,d.store);if(!d._joinAndNotLeaveYet)throw new z(k.INVALID_OPERATION,"[".concat(d._clientId,"] Client already left"))}d.store.requestAPEnd(),setTimeout(()=>{d._configDistribute.startGetConfigDistribute(b,d._axiosCancelSource.token),d._configDistribute.on(mS.UPDATE_BITRATE_LIMIT,q=>{d._p2pChannel.updateBitrateLimit(q)})},0),d._key=o||n;const M=A.gatewayInfo,x=b.uid?b.uid:M.uid;d._joinInfo=Os(Os({},b),{},{cid:M.cid,uid:x,vid:M.vid,apResponse:M.res,apGatewayAddress:M.apGatewayAddress,uni_lbs_ip:M.uni_lbs_ip,gatewayAddrs:M.gatewayAddrs}),d.store.intUid=x;const j=yield d._joinGateway();if(!d._joinAndNotLeaveYet)throw new z(k.INVALID_OPERATION,"[".concat(d._clientId,"] Client already left"));y.onSuccess(j),d._appId=n,d._channelName=b.cname,d._uid=j,d.store.uid=j,setTimeout(()=>{d._networkQualityInterval&&window.clearInterval(d._networkQualityInterval),d._networkQualityInterval=window.setInterval(d._handleUpdateNetworkQuality,2e3),window.addEventListener($e()?"beforeunload":"pagehide",d._handleBeforeUnload),d._statsCollector.startUpdateStats()},0);const W=b.stringUid?"string uid: ".concat(b.stringUid,",uid: ").concat(b.uid):"uid: ".concat(d._uid);return T.info("[".concat(d._clientId,"] Joining channel success: channel: ").concat(r,",").concat(W)),setTimeout(()=>{T.startUpload()},5e3),d.store.joinEnd(),R=d,he(Ad).call(Ad,R)||Ad.push(R),"disabled"===d._cloudProxyServerMode&&ct().supportWebCrypto&&V("ENABLE_PRELOAD")&&LD(d._joinInfo),j}catch(A){const D=Array.isArray(A)?A[0]:A;throw D&&D.code===k.OPERATION_ABORTED?T.warning("[".concat(d._clientId,"] join number: ").concat(h,", Joining channel failed, rollback"),D):T.error("[".concat(d._clientId,"] join number: ").concat(h,", Joining channel failed, rollback"),D),D.code!==k.OPERATION_ABORTED&&d._numberOfJoinCount===h&&(d._gateway.state="DISCONNECTED",d._reset()),y.onError(D),D}var R})()}_joinGateway(){if(!this._joinInfo||!this._key)throw new z(k.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!V("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}leave(){var n=this;return L(function*(){T.info("[".concat(n._clientId,"] Leaving channel")),window.removeEventListener($e()?"beforeunload":"pagehide",n._handleBeforeUnload),n._reset(),function(o){const a=Ad.indexOf(o);-1!==a&&Ad.splice(a,1)}(n),n._statsCollector.stopUpdateStats();const r=yield n._leaveMutex.lock();if("DISCONNECTED"===n.connectionState)return T.info("[".concat(n._clientId,"] Leaving channel repeated, success")),void r();yield n._gateway.leave("CONNECTED"!==n.connectionState),T.info("[".concat(n._clientId,"] Leaving channel success")),n._joinAndNotLeaveYet=!1,n.store.resetJoinChannelServiceRecords(),r()})()}publish(n){var r=arguments,o=this;return L(function*(){let a=!(r.length>1&&void 0!==r[1])||r[1];if(!Array.isArray(n)){if(!(n instanceof Ch))return o._publishDataChannel(n);n=[n]}if(0===n.length)throw new z(k.INVALID_PARAMS,"param list is empty");const l=n;if("audience"===o._gateway.role)throw new z(k.INVALID_OPERATION,"audience can not publish stream");for(const h of l){if(!(h instanceof Ch))throw new z(k.INVALID_PARAMS,"parameter is not local track");if(!h._enabled&&a)throw new z(k.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(h.getTrackId()))}T.info("[".concat(o._clientId,"] Publishing tracks, id ").concat(l.map(h=>"".concat(h.getTrackId()," "))));const d=yield o._publishMutex.lock();yield o._configDistribute.awaitConfigDistributeComplete(),a&&l.forEach(h=>{const p=o._configDistribute.getBitrateLimit();h instanceof Ve&&p&&h.setBitrateLimit(p.uplink)});try{yield o._publishHighStream(l),T.info("[".concat(o._clientId,"] Publish success, id ").concat(l.map(h=>"".concat(h.getTrackId()," "))))}catch(h){throw T.error("[".concat(o._clientId,"] publish error"),h.toString()),h}finally{d()}})()}_publishDataChannel(n){var r=this;return L(function*(){Ut(n.id,"id",0,65535,!0),pl(n.ordered,"ordered"),Pi(n.metadata,"metadata",0,512),T.info("[".concat(r._clientId,"] Publishing datachannels, id ").concat(n.id));const o=yield r._publishMutex.lock();try{if(-1!==r._p2pChannel.getAllDataChannels().findIndex(d=>d.id===n.id))throw new z(k.INVALID_PARAMS,"Invalid id: ".concat(n.id,". If you want to republish the datachannel, unpublish first"));if(!r._joinInfo||void 0===r._uid)throw new z(k.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new z(k.INVALID_OPERATION,"can not publish datachannel in ".concat(r.connectionState," state"));if("auto"===r._turnServer.mode&&V("FORCE_TURN")&&!V("TURN_ENABLE_TCP")&&!V("TURN_ENABLE_UDP"))throw new z(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const a=vH(d=n,!1),l=yield r._p2pChannel.publishDataChannel([a]);if(l.length>0){if("number"!=typeof a._originDataChannelId)throw T.error("[".concat(r._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new z(k.CREATE_DATACHANNEL_ERROR);try{yield le.all(l.map(d=>r._uid&&r._gateway.publishDataChannel(r._uid,d,!0))),yield a._waitTillOpen()}catch(d){if(d.code!==k.DISCONNECT_P2P)throw d}}return T.info("[".concat(r._clientId,"] Publish dataChannels success, id ").concat(a.id)),a}catch(a){throw T.error("[".concat(r._clientId,"] publish datachannels error"),a.toString()),a}finally{o()}var d})()}unpublish(n){var r=this;return L(function*(){if(!r._joinInfo||void 0===r._uid)throw new z(k.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let o=[];if(n)if(Array.isArray(n))o=n;else{if(!(n instanceof Ch))return r._unpublishDataChannel([n]);o=[n]}else r.store.useP2P||(yield r._unpublishDataChannel()),o=r._p2pChannel.getAllTracks(!0);T.info("[".concat(r._clientId,"] Unpublish tracks, tracks ").concat(o.map(l=>"".concat(l.getTrackId()," "))," "));const a=yield r._publishMutex.lock();try{if(r._p2pChannel instanceof us){const l=yield r._p2pChannel.unpublish(o);l&&(yield r._gateway.sendExtensionMessage(Bn.UNPUBLISH,{unpubMsg:l},!0))}else{const l=yield r._p2pChannel.unpublish(o);l&&(yield r._gateway.unpublish(l,r._uid)),T.info("[".concat(r._clientId,"] Unpublish success,tracks ").concat(o.map(d=>"".concat(d.getTrackId()))))}}catch(l){throw T.error("[".concat(r._clientId,"] unpublish error"),l.toString()),l}finally{a&&a()}})()}_unpublishDataChannel(n){var r=this;return L(function*(){void 0!==n&&0!==n.length||(n=r._p2pChannel.getAllDataChannels()),T.info("[".concat(r._clientId,"] Unpublish datachannels, datachannels ").concat(n.map(a=>"".concat(a.id," "))," "));const o=yield r._publishMutex.lock();try{const a=yield r._p2pChannel.unpublishDataChannel(n);a&&(yield r._gateway.unpublishDataChannel(a)),T.info("[".concat(r._clientId,"] Unpublish dataChannel success,dataChannel ").concat(n.map(l=>"".concat(l.id))))}catch(a){throw T.error("[".concat(r._clientId,"] unpublish dataChannel error"),a.toString()),a}finally{o&&o()}})()}subscribe(n,r,o){var a=this;return L(function*(){if(!(n instanceof Mh)){const l=a.remoteUsers.find(d=>d.uid===n);if(!l)throw new z(k.INVALID_REMOTE_USER,"user is not in the channel");n=l}return"datachannel"===r?a._subscribeDataChannel(n,o):a._subscribe(n,r)})()}presubscribe(n,r){var o=this;return L(function*(){if(fi(r,"mediaType",["audio","video"]),o._p2pChannel instanceof us)throw new z(k.INVALID_OPERATION,"can't presub at p2p mode");if(!o._joinInfo)throw new z(k.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==o.connectionState&&"RECONNECTING"!==o.connectionState)throw new z(k.INVALID_OPERATION,"can't presub in ".concat(o.connectionState," state"));const a=r===_e.AUDIO,l=r===_e.VIDEO,d=yield o._subscribeMutex.lock();try{const{ssrcId:h,ortc:p,rtxSsrcId:m,cname:g,uint_id:v}=yield o._gateway.presubscribe(n,r,!0);if(null==h)throw new z(k.UNEXPECTED_RESPONSE,"no ssrc id");let y=o._users.find(C=>C.uid===n);y||(y=new Mh(n,v||n),y._is_pre_created=!0,o._users.push(y)),g&&(y._cname=g),y._uintid||(y._uintid=v||n),a&&(y._audioSSRC=h,y._audio_pre_subscribed=!0,p&&(y._audioOrtc=p)),l&&(y._videoSSRC=h,y._video_pre_subscribed=!0,p&&(y._videoOrtc=p),null!=m&&(y._rtxSsrcId=m)),T.info("[".concat(o._clientId,"] presub succeed ssrc: ").concat(h)),yield o._p2pChannel.subscribe(y,r,h,m,p);const b=a?y._audioTrack:y._videoTrack;if(!b)throw new z(k.UNEXPECTED_ERROR,"can not find remote track in user");return a&&(y._trust_audio_stream_added_state_=!0,y._audio_added_=!0),l&&(y._trust_video_stream_added_state_=!0,y._video_added_=!0),b}catch(h){throw T.error("[".concat(o._clientId,"] presub user ").concat(n," error"),h),h}finally{d()}})()}_subscribeDataChannel(n,r){var o=this;return L(function*(){var a;if(Ut(r,"channelId",0,65535,!0),!o._joinInfo)throw new z(k.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==o.connectionState&&"RECONNECTING"!==o.connectionState)throw new z(k.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(o.connectionState," state"));if(!o._users.find(m=>m===n))throw T.error("[".concat(o._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),new z(k.INVALID_REMOTE_USER,"user is not in the channel");if(!n.hasAudio&&!n.hasVideo&&0===n._dataChannels.length)throw T.error("[".concat(o._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),new z(k.INVALID_REMOTE_USER,"user is not published");const d=null===(a=n._dataChannels)||void 0===a?void 0:a.find(m=>m.id===r);if(!d)throw T.error("[".concat(o._clientId,"] can not subscribe ").concat(n.uid," with mediaType datachannel, remote datachannel is not published")),new z(k.REMOTE_USER_IS_NOT_PUBLISHED);const h=yield o._subscribeMutex.lock();T.info("[".concat(o._clientId,"] subscribe user ").concat(n.uid,", mediaType: datachannel"));try{const m=yield o._p2pChannel.subscribeDataChannel(n,[d]);if(m&&he(m).call(m,d.id))try{var p;if("number"!=typeof d._originDataChannelId)throw T.error("[".concat(o._clientId,"] can not subscribe ").concat(n.uid," with mediaType datachannel, cannot get RTCDatachannel")),new z(k.CREATE_DATACHANNEL_ERROR);const g={id:d.id,datachannelId:d._originDataChannelId,ordered:d.ordered,maxRetransmits:d.maxRetransmits,metadata:null!==(p=d.metadata)&&void 0!==p?p:""};yield o._gateway.subscribeDataChannel(n.uid,g,!0),yield d._waitTillOpen()}catch(g){if(g?.code!==k.WS_ABORT)throw yield o._p2pChannel.unsubscribeDataChannel(n,[d]),g;yield o._p2pChannel.unsubscribeDataChannel(n,[d]),o._p2pChannel.setPendingRemoteDataChannel(n,d.id)}return T.info("[".concat(o._clientId,"] subscribe success user ").concat(n.uid,", mediaType: datachannel")),d}finally{h()}})()}_p2pSubscribe(n,r,o){var a=this;return L(function*(){if(fi(r,"mediaType",["audio","video"]),!a._joinInfo)throw new z(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==a.connectionState&&"RECONNECTING"!==a.connectionState)throw new z(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(a.connectionState," state"));if(!a._users.find(h=>h===n)){const h=new z(k.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(a._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),h}if(!n.hasAudio&&!n.hasVideo){const h=new z(k.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(a._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),h}if(!o&&("audio"===r&&!n.hasAudio||"video"===r&&!n.hasVideo)){const h=new z(k.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(a._clientId,"] can not subscribe ").concat(n.uid," with mediaType ").concat(r,", remote track is not published")),h}const d=yield a._subscribeMutex.lock();T.info("[".concat(a._clientId,"] subscribe user ").concat(n.uid,", mediaType: ").concat(r));try{if(yield a._p2pChannel.hasRemoteMediaWithLock(n,r))yield a._p2pChannel.unmuteRemote(n,r);else try{const p="audio"===r?n._audioSSRC:n._videoSSRC,m="audio"===r?n._audioMid:n._videoMid;a.store.subscribe(n.uid,r,Date.now()),a._p2pChannel instanceof us&&(yield a._p2pChannel.subscribe(n,r,p,m))}catch(p){throw p}T.info("[".concat(a._clientId,"] subscribe success user ").concat(n.uid,", mediaType: ").concat(r)),a._defaultStreamFallbackType&&a.setStreamFallbackOption(n.uid,a._defaultStreamFallbackType).catch(p=>{T.warning("[".concat(a._clientId,"] auto set fallback failed"),p)});const h="audio"===r?n._audioTrack:n._videoTrack;if(!h)throw new z(k.UNEXPECTED_ERROR,"can not find remote track in user object");return h}catch(h){throw T.error("[".concat(a._clientId,"] subscribe user ").concat(n.uid," error"),h),h}finally{d()}})()}_subscribe(n,r,o){var a=this;return L(function*(){if(a._p2pChannel instanceof us)return a._p2pSubscribe(n,r);if(fi(r,"mediaType",["audio","video"]),!a._joinInfo)throw new z(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==a.connectionState&&"RECONNECTING"!==a.connectionState)throw new z(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(a.connectionState," state"));if(!a._users.find(v=>v===n)){const v=new z(k.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(a._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),v}if(!n.hasAudio&&!n.hasVideo){const v=new z(k.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(a._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),v}if(!(o||("audio"!==r||n.hasAudio&&void 0!==n._audioSSRC)&&("video"!==r||n.hasVideo&&void 0!==n._videoSSRC))){const v=new z(k.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(a._clientId,"] can not subscribe ").concat(n.uid," with mediaType ").concat(r,", remote track is not published")),v}let d="audio"===r?n._audioSSRC:n._videoSSRC,h="audio"===r?n._audioOrtc:n._videoOrtc,p="video"===r?n._rtxSsrcId:void 0,m={stream_type:"audio"===r?_e.AUDIO:_e.VIDEO,ssrcId:d};const g=yield a._subscribeMutex.lock();T.info("[".concat(a._clientId,"] subscribe user ").concat(n.uid,", mediaType: ").concat(r));try{if(yield a._p2pChannel.hasRemoteMediaWithLock(n,r))yield a._p2pChannel.unmuteRemote(n,r);else try{const y="audio"===r?n._audioSSRC:n._videoSSRC;void 0!==y&&y!==d&&(d=y,h="audio"===r?n._audioOrtc:n._videoOrtc,p="video"===r?n._rtxSsrcId:void 0,m={stream_type:"audio"===r?_e.AUDIO:_e.VIDEO,ssrcId:d}),tr.markSubscribeStart(a.store.clientId,d),a.store.subscribe(n.uid,r,Date.now()),yield a._p2pChannel.subscribe(n,r,d,p,h);try{a._p2pChannel.isPreSubScribe(d)||(yield a._gateway.subscribe(n.uid,m,!0))}catch(b){if(b?.code!==k.WS_ABORT)throw yield a._p2pChannel.unsubscribe(n,r),b;yield a._p2pChannel.unsubscribe(n,r,!0),a._p2pChannel.setPendingRemoteMedia(n,r)}a.store.subscribe(n.uid,r,void 0,Date.now()),a._p2pChannel.reportSubscribeEvent(!0,null,n,r)}catch(y){throw a._p2pChannel.reportSubscribeEvent(!1,y?.code,n,r),y}T.info("[".concat(a._clientId,"] subscribe success user ").concat(n.uid,", mediaType: ").concat(r)),a._defaultStreamFallbackType&&a.setStreamFallbackOption(n.uid,a._defaultStreamFallbackType).catch(y=>{T.warning("[".concat(a._clientId,"] auto set fallback failed"),y)});const v="audio"===r?n._audioTrack:n._videoTrack;if(!v)throw new z(k.UNEXPECTED_ERROR,"can not find remote track in user object");return v}catch(v){throw T.error("[".concat(a._clientId,"] subscribe user ").concat(n.uid," error"),v),v}finally{g()}})()}massSubscribe(n){var r=this;return L(function*(){if(fl(n,"subscribeList"),!r._joinInfo)throw new z(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new z(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(r.connectionState," state"));const o=Date.now(),a=new Map,l=yield r._subscribeMutex.lock();T.info("[".concat(r._clientId,"]start massSubscribe user ").concat(n.map(m=>{let{user:g,mediaType:v}=m;return"user: ".concat(g?.uid,", mediaType: ").concat(v)}).join("; ")));const d=(n=[...n]).map(m=>{let{user:g,mediaType:v}=m;return{user:g,mediaType:v}}),h=yield r._p2pChannel.globalLock();try{var p;for(let g=n.length-1;g>=0;g--){const v=n[g],{user:y,mediaType:b}=v;if(fi(b,"mediaType",["audio","video"]),!y){const A=new z(k.INVALID_PARAMS,"user property does not exist in subscribeList item");throw T.error("[".concat(r._clientId,"] user property does not exist in subscribeList item")),A}if(!r._users.find(A=>A===y)){const A=new z(k.INVALID_REMOTE_USER,"user is not in the channel");T.error("[".concat(r._clientId,"] can not massSubscribe ").concat(y.uid,", this user is not in the channel")),d[g].error=A,n.splice(g,1);continue}if("audio"===b&&(!y.hasAudio||void 0===y._audioSSRC)||"video"===b&&(!y.hasVideo||void 0===y._videoSSRC)){const A=new z(k.REMOTE_USER_IS_NOT_PUBLISHED);T.error("[".concat(r._clientId,"] can not subscribe ").concat(y.uid," with mediaType ").concat(b,", remote user is not published")),d[g].error=A,n.splice(g,1);continue}const N=_i.Video|_i.LwoVideo,R=a.get(y);if(R){if("video"===b?R&N:R&_i.Audio){n.splice(g,1),T.warning("[".concat(r._clientId,"] repeat massSubscribe user:").concat(y.uid,", mediaType:").concat(b," twice"));continue}a.set(y,R|("video"===b?N:_i.Audio))}else a.set(y,"video"===b?N:_i.Audio)}for(let g=n.length-1;g>=0;g--){const v=n[g],{user:y,mediaType:b}=v,C=_i.Video|_i.LwoVideo;if(r._p2pChannel.hasRemoteMedia(y,b)){yield r._p2pChannel.unmuteRemoteNoLock(y,b);const N=a.get(y);a.set(y,"video"===b?N^C:N^_i.Audio),n.splice(g,1)}}r.store.massSubscribe(n.map(g=>({userId:g.user.uid,type:g.mediaType})),o);let m=Ue(p=Array.from(a.entries())).call(p,(g,v)=>{let[y,b]=v;if(0===b)return g;const C={stream_id:y.uid,stream_type:b};return b&_i.Audio&&(C.audio_ssrc=y._audioSSRC),b&_i.Video&&(C.video_ssrc=y._videoSSRC),g.push(C),g},[]);try{n.length>0&&(yield r._p2pChannel.massSubscribeNoLock(n.map(v=>{let{user:y,mediaType:b}=v;return{user:y,mediaType:b,ssrcId:b===_e.VIDEO?y._videoSSRC:y._audioSSRC,rtxSsrcId:b===_e.VIDEO?y._rtxSsrcId:void 0}})));const g=new Map;if(m=m.filter(v=>v.video_ssrc&&!r._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!r._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),m.length>0){const v=yield r._gateway.subscribeAll(m,!0);(v?.users||[]).forEach(y=>{let{stream_id:b,video_error_code:C,audio_error_code:N,error_code:R}=y;(C||N||R)&&g.set(b,{video_error_code:C,audio_error_code:N,error_code:R})})}if(Array.from(g.entries()).length>0){const v=[];Array.from(g.entries()).forEach(y=>{let[b,C]=y;const N=r.remoteUsers.find(R=>R.uid===b);if(N){let R;C.error_code||C.video_error_code&&C.audio_error_code?R=void 0:C.video_error_code?R=_e.VIDEO:C.audio_error_code&&(R=_e.AUDIO),v.push({user:N,mediaType:R})}}),v.length>0&&(yield r._p2pChannel.massUnsubscribeNoLock(v))}for(const v of d){const y=g.get(v.user.uid);if(y){const b=y.error_code||"audio"===v.mediaType&&y.audio_error_code||"video"===v.mediaType&&y.video_error_code;if(b){const C=Df(b);T.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(C.desc)),v.error=new z(k.SUBSCRIBE_FAILED,"code ".concat(b,": ").concat(C.desc))}}v.error||(v.track="video"===v.mediaType?v.user.videoTrack:v.user.audioTrack)}return r.store.massSubscribe(d.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),d.forEach(v=>{var y;be.subscribe(r.store.sessionId,{succ:!!v.error,ec:(null===(y=v.error)||void 0===y?void 0:y.code)||null,video:v.mediaType===_e.VIDEO,audio:v.mediaType===_e.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===_e.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:r.store.p2pId,eventElapse:Math.floor(performance.now()-o),preSsrc:r._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),T.info("[".concat(r._clientId,"] massSubscribe success ").concat(n.map(v=>{let{user:y,mediaType:b}=v;return"user: ".concat(y?.uid,", mediaType: ").concat(b)}).join("; "))),d}catch(g){throw yield r._p2pChannel.massUnsubscribeNoLock(n),g}}finally{h(),l()}})()}unsubscribe(n,r,o){var a=this;return L(function*(){if(!(n instanceof Mh)){const h=a.remoteUsers.find(p=>p.uid===n);if(!h)throw new z(k.INVALID_REMOTE_USER,"user is not in the channel");n=h}if(r||a.store.useP2P){if("datachannel"===r)return a._unsubscribeDataChannel(n,o)}else yield a._unsubscribeDataChannel(n,o);if(r&&fi(r,"mediaType",["audio","video"]),!a._joinInfo)throw new z(k.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!a._users.find(h=>h===n)){const h=new z(k.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(a._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),h}T.info("[".concat(a._clientId,"] unsubscribe uid: ").concat(n.uid,", mediaType: ").concat(r));const d=yield a._subscribeMutex.lock();try{if(a._p2pChannel instanceof us)yield a._p2pChannel.unsubscribe(n,r);else{const h=yield a._p2pChannel.unsubscribe(n,r);h&&(yield a._gateway.unsubscribe(h,n.uid)),r&&"audio"!==r||(n._audio_pre_subscribed=!1),r&&"video"!==r||(n._video_pre_subscribed=!1),n._is_pre_created&&Be(a._users,n),T.info("[".concat(a._clientId,"] unsubscribe success uid: ").concat(n.uid,", mediaType: ").concat(r))}}catch(h){if(h.code===k.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(a._clientId,"] unsubscribe user ").concat(n.uid," error"),h.toString()),h}finally{d()}})()}_unsubscribeDataChannel(n,r){var o=this;return L(function*(){if(r&&Ut(r,"id",0,65535,!0),!o._joinInfo)throw new z(k.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!o._users.find(d=>d===n)){const d=new z(k.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(o._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),d}let l;if("number"==typeof r){const d=n._dataChannels.find(h=>h.id===r);d&&(l=[d])}else l=n._dataChannels;if(void 0===l){const d=new z(k.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(o._clientId,"] can not unsubscribe ").concat(n.uid," with channelId ").concat(r,", remote datachannel is not published")),d}T.info("[".concat(o._clientId,"] unsubscribe uid: ").concat(n.uid,", mediaType: datachannel, ids: ").concat(l.map(d=>d.id)));try{const d=yield o._p2pChannel.unsubscribeDataChannel(n,l);d&&(yield o._gateway.unsubscribeDataChannel(d,n.uid)),T.info("[".concat(o._clientId,"] unsubscribe datachannel success uid: ").concat(n.uid,", mediaType: datachannel, ids: ").concat(d))}catch(d){if(d.code===k.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(o._clientId,"] unsubscribe user ").concat(n.uid," error"),d.toString()),d}})()}massUnsubscribe(n){var r=this;return L(function*(){if(fl(n,"unsubscribeList"),!r._joinInfo)throw new z(k.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");T.info("[".concat(r._clientId,"] start massUnsubscribe ").concat(n.map(a=>{let{user:l,mediaType:d}=a;return"user: ".concat(l?.uid,", mediaType: ").concat(d,";")}).join())),n=[...n];const o=new Map;for(let a=n.length-1;a>=0;a--){const{user:l,mediaType:d}=n[a];if(!l){const m=new z(k.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw T.error("[".concat(r._clientId,"] user property does not exist in unsubscribeList item")),m}if(fi(d,"mediaType",["video","audio",void 0]),!r._users.find(m=>m===l)){T.warning("[".concat(r._clientId,"] can not unsubscribe ").concat(l.uid,", user is not in the channel")),n.splice(a,1);continue}const p=_i.Video|_i.LwoVideo;if(o.has(l)){const m=o.get(l);let g;switch(d){case"video":g=m&p;break;case"audio":g=m&_i.Audio;break;default:g=m&(_i.Audio|p)}if(g){T.warning("[".concat(r._clientId,"] repeat massUnsubscribe user:").concat(l.uid,",mediaType:").concat(d," twice.")),n.splice(a,1);continue}d?"audio"===d?o.set(l,m|_i.Audio):"video"===d&&o.set(l,m|p):o.set(l,m|_i.Audio|p)}else d?"audio"===d?o.set(l,_i.Audio):"video"===d&&o.set(l,p):o.set(l,_i.Audio|p)}try{const a=yield r._p2pChannel.massUnsubscribe(n);a&&(yield r._gateway.massUnsubscribe(a)),T.info("[".concat(r._clientId,"] massUnsubscribe success ").concat(n.map(l=>{let{user:d,mediaType:h}=l;return"user: ".concat(d?.uid,", mediaType: ").concat(h,";")}).join()))}catch(a){if(a.code===k.DISCONNECT_P2P)return void T.warning("[".concat(r._clientId,"] disconnecting p2p, abort unsubscribe request."));throw T.error("[".concat(r._clientId,"] massUnsubscribe error"),a.toString()),a}})()}setLowStreamParameter(n){var r=this;return L(function*(){(function(a){if(!a)throw new Y(k.INVALID_PARAMS);pn(a.width)||sR(a.width,"streamParameter.width"),pn(a.height)||sR(a.height,"streamParameter.height"),pn(a.framerate)||sR(a.framerate,"streamParameter.framerate"),pn(a.bitrate)||Ut(a.bitrate,"streamParameter.bitrate")})(n),(!n.width&&n.height||n.width&&!n.height)&&T.warning("[".concat(r._clientId,"] The width and height parameters take effect only when both are set")),T.info("[".concat(r._clientId,"] set low stream parameter to"),JSON.stringify(n));const o=r._configDistribute.getLowStreamConfigDistribute();if(o&&o.bitrate&&n.bitrate&&o.bitrate<n.bitrate&&(n.bitrate=o.bitrate),r._lowStreamParameter=n,r._isDualStreamEnabled)return r._p2pChannel.updateVideoStreamParameter(n,Q.LocalVideoLowTrack)})()}enableDualStream(){var n=this;return L(function*(){if(!ct().supportDualStream)throw be.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new z(k.NOT_SUPPORTED,"Your browser is not support dual stream");if(n._isDualStreamEnabled)throw new z(k.INVALID_OPERATION,"Dual stream is already enabled");if(n._p2pChannel.canPublishLowStream())try{yield n._publishLowStream()}catch(r){throw be.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),r}n._isDualStreamEnabled=!0,be.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),T.info("[".concat(n._clientId,"] enable dual stream"))})()}disableDualStream(){var n=this;return L(function*(){if(n._isDualStreamEnabled){if(!n._joinInfo)throw new z(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(n._p2pChannel.getLocalMedia(Q.LocalVideoLowTrack))try{const r=yield n._p2pChannel.unpublishLowStream();r&&(yield n._gateway.unpublish(r,n._joinInfo.stringUid||n._joinInfo.uid))}catch(r){throw be.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),r}n._isDualStreamEnabled=!1,be.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),T.info("[".concat(n._clientId,"] disable dual stream"))}})()}setClientRole(n,r){var o=this;return L(function*(){if(fi(n,"role",["audience","host"]),r&&Zj(r),"rtc"===o.mode||"p2p"===o.mode)throw T.warning("[".concat(o._clientId,"]").concat(o.mode," mode can not use setClientRole")),new z(k.INVALID_OPERATION,"".concat(o.mode," mode can not use setClientRole"));if(r&&r.level&&"host"===n)throw new z(k.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===n&&o._p2pChannel.hasLocalMedia())throw new z(k.INVALID_OPERATION,"can not set client role to audience when publishing stream");yield o._gateway.setClientRole(n,r),o._config.role=n,T.info("[".concat(o._clientId,"] set client role to ").concat(n,", level: ").concat(r&&r.level))})()}getRemoteInboundOffset(){var n;const r=null===(n=this._p2pChannel.getStats())||void 0===n?void 0:n.audioSend[0];if(!r||!r.timestamp)return 0;const o=r.timestamp-Date.now();return Math.abs(o)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?o:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(n,r){if(Pi(n,"proxyServer"),!r){if("DISCONNECTED"!==this.connectionState)throw new z(k.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new z(k.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=n,be.setProxyServer(this._proxyServer),T.setProxyServer(this._proxyServer),T.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(n,r){if(Array.isArray(n)||(n=[n]),!r){if("DISCONNECTED"!==this.connectionState)throw new z(k.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new z(k.INVALID_OPERATION,"You have already set the proxy")}if(nS(n))return this._turnServer={servers:n,mode:"original-manual"},void T.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(n.map(o=>o.urls).join(","),"."));n.forEach(o=>dR(o)),this._turnServer={servers:n,mode:"manual"},T.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(n){if("DISCONNECTED"!==this.connectionState)throw new z(k.INVALID_OPERATION,"you should set license before join channel");if(Pi(n,"license",32,32),!/^[A-Za-z\d]+$/.test(n))throw new z(k.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=n,T.info("[".concat(this._clientId,"] set license success"),n)}startProxyServer(n){if("DISCONNECTED"!==this.connectionState)throw new z(k.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new z(k.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let o;switch(void 0===n&&(n=3),n){case 1:case 2:throw new z(k.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:o="proxy3";break;case 4:o="proxy4";break;case 5:o="proxy5";break;default:throw new z(k.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=o,this.store.cloudProxyServerMode=o,T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new z(k.INVALID_OPERATION,"Stop proxy server after leave channel");be.setProxyServer(),T.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(n){if(!n.accessPoints)throw new z(k.INVALID_PARAMS,"accessPoints is required.");fl(n.accessPoints.serverList,"accessPoints.serverList"),Pi(n.accessPoints.domain,"accessPoints.domain");const r=(b,C)=>{Ut(b,C,0,65535,!0)};let o=443;if(n.accessPoints.port&&(r(n.accessPoints.port,"accessPoints.port"),o=n.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new z(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");V("CLOSE_AFB_FOR_LOCAL_AP")&&(Lt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Lt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const a=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,l=n.accessPoints.domain,d=n.accessPoints.serverList.map(b=>a.test(b)?"".concat(b.replace(/\./g,"-"),".").concat(l):b),h=d.map(b=>"".concat(b,":").concat(o));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Lt("WEBCS_DOMAIN",h),Lt("WEBCS_DOMAIN_BACKUP_LIST",h),Lt("GATEWAY_DOMAINS",[l]),n.report&&n.report.hostname&&Array.isArray(n.report.hostname)&&n.report.hostname.length?(fl(n.report.hostname,"report.hostname"),Lt("EVENT_REPORT_DOMAIN",n.report.hostname[0]),Lt("EVENT_REPORT_BACKUP_DOMAIN",n.report.hostname[1]||n.report.hostname[0])):(Lt("EVENT_REPORT_DOMAIN",d[0]),Lt("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let p=6443;n.report&&n.report.port&&(r(n.report.port,"report.port"),p=n.report.port),Lt("STATS_COLLECTOR_PORT",p),Lt("ENABLE_EVENT_REPORT",!!n.report);let m="";n.log&&n.log.hostname&&Array.isArray(n.log.hostname)&&n.log.hostname.length?(fl(n.log.hostname,"log.hostname"),m=n.log.hostname[0]):m=d[0];let g=6444;n.log&&n.log.port&&(r(n.log.port,"log.port"),g=n.log.port),Lt("LOG_UPLOAD_SERVER","".concat(m,":").concat(g));let v=[];n.cds&&n.cds.hostname&&Array.isArray(n.cds.hostname)&&n.cds.hostname.length?(fl(n.cds.hostname,"cds.hostname"),v=n.cds.hostname):v=d;let y=443;n.cds&&n.cds.port&&(r(n.cds.port,"cds.port"),y=n.cds.port),Lt("CDS_AP",v.map(b=>"".concat(b,":").concat(y))),Lt("ENABLE_CONFIG_DISTRIBUTE",!!n.cds),T.info("set local access point v2 success")}setLocalAccessPoints(n,r){if(fl(n,"serverList"),Pi(r,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new z(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const o=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;n=n.map(a=>o.test(a)?"".concat(a.replace(/\./g,"-"),".").concat(r):a),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Lt("WEBCS_DOMAIN",n),Lt("WEBCS_DOMAIN_BACKUP_LIST",n),Lt("GATEWAY_DOMAINS",[r]),Lt("EVENT_REPORT_DOMAIN",n[0]),Lt("EVENT_REPORT_BACKUP_DOMAIN",n[1]||n[0]),Lt("LOG_UPLOAD_SERVER","".concat(n[0],":6444")),T.info("[".concat(this._clientId,"] set local access point success"))}setRemoteDefaultVideoStreamType(n){var r=this;return L(function*(){if(fi(n,"streamType",[0,1,4,5,6,7,8,9]),r._remoteDefaultVideoStreamType=n,r._joinInfo)try{yield r._gateway.setDefaultRemoteVideoStreamType(n),r._joinInfo.defaultVideoStream=r._remoteDefaultVideoStreamType}catch(o){throw T.error("[".concat(r._clientId,"] set default remote video stream type error"),o.toString()),o}else T.debug("[".concat(r._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(n))})()}setRemoteVideoStreamType(n,r){var o=this;return L(function*(){fi(r,"streamType",[0,1,4,5,6,7,8,9]);try{yield o._gateway.setRemoteVideoStreamType(n,r),setTimeout(()=>{const a=o._users.find(l=>l.uid===n);a&&a.videoTrack&&a.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(a){throw T.error("[".concat(o._clientId,"] set remote video stream type error"),a.toString()),a}T.info("[".concat(o._clientId,"] set remote ").concat(n," video stream type to ").concat(r)),o._remoteStreamTypeCacheMap.set(n,r)})()}setStreamFallbackOption(n,r){var o=this;return L(function*(){fi(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{yield o._gateway.setStreamFallbackOption(n,r)}catch(a){throw T.error("[".concat(o._clientId,"] set stream fallback option"),a.toString()),a}T.info("[".concat(o._clientId,"] set remote ").concat(n," stream fallback type to ").concat(r)),o._streamFallbackTypeCacheMap.set(n,r)})()}setEncryptionConfig(n,r,o,a){fi(n,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"]),Pi(r,"secret");const l=["aes-128-gcm2","aes-256-gcm2"];if(he(l).call(l,n)){if(!o||!(o instanceof Uint8Array&&32===o.length))throw new z(k.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(o)throw new z(k.INVALID_PARAMS,"current encrypt mode does not need salt");if(a){if(pl(a,"encryptDataStream"),!he(l).call(l,n))throw new z(k.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(r)||T.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=n,this._encryptionSecret=r,o&&(this._encryptionSalt=_l(o))}renewToken(n){var r=this;return L(function*(){if(Pi(n,"token",1,2047),!r._key||!r._joinInfo)throw new z(k.INVALID_OPERATION,"renewToken should not be called before user join");const o=r._key;r._key=n,r._joinInfo&&(r._joinInfo.token=n);const a=yield r._renewTokenMutex.lock();try{if(V("USE_NEW_TOKEN")){T.debug("[".concat(r._clientId,"] start renew token with ticket from unilbs"));const l=yield function cD(n,r,o){return lD.apply(this,arguments)}(r._joinInfo,r._axiosCancelSource.token,r._config.httpRetryConfig||Nn);T.debug("[".concat(r._clientId,"] get ticket from unilbs success")),yield r._gateway.renewToken({token:n,ticket:l})}else T.debug("[".concat(r._clientId,"] start renew token without ticket")),yield r._gateway.renewToken({token:n});T.debug("[".concat(r._clientId,"] renewToken success"))}catch(l){throw r._key=o,r._joinInfo.token=o,T.error("[".concat(r._clientId,"] renewToken failed"),l.toString()),l}finally{a()}})()}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?T.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const n=this._p2pChannel.getAudioLevels();this.safeEmit(Je.VOLUME_INDICATOR,n)},V("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const n=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return n.Duration=Math.round(r.duration/1e3),n}startLiveStreaming(n,r){var o=this;return L(function*(){if(!r){if("h264"!==o.codec)throw new z(k.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!o._p2pChannel.hasLocalMedia())throw new z(k.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(o._liveRawStreamingClient&&o._liveRawStreamingClient.hasUrl(n)||o._liveTranscodeStreamingClient&&o._liveTranscodeStreamingClient.hasUrl(n))throw new z(k.LIVE_STREAMING_TASK_CONFLICT);const a=r?Pa.TRANSCODE:Pa.RAW;return o._createLiveStreamingClient(a).startLiveStreamingTask(n,a)})()}setLiveTranscoding(n){return this._createLiveStreamingClient(Pa.TRANSCODE).setTranscodingConfig(n)}stopLiveStreaming(n){var r=this;return L(function*(){const o=[r._liveRawStreamingClient,r._liveTranscodeStreamingClient].filter(a=>a&&a.hasUrl(n));if(!o.length)throw new z(k.INVALID_PARAMS,"can not find live streaming url to stop");yield le.all(o.map(a=>a&&a.stopLiveStreamingTask(n)))})()}startChannelMediaRelay(n){var r=this;return L(function*(){B2(n),yield r._createChannelMediaRelayClient().startChannelMediaRelay(n)})()}updateChannelMediaRelay(n){var r=this;return L(function*(){B2(n),yield r._createChannelMediaRelayClient().updateChannelMediaRelay(n)})()}stopChannelMediaRelay(){var n=this;return L(function*(){yield n._createChannelMediaRelayClient().stopChannelMediaRelay(),n._statsCollector.onStatsChanged&&(n._statsCollector.onStatsChanged=void 0)})()}sendStreamMessage(n){var r=arguments,o=this;return L(function*(){var a;let l=!(r.length>1&&void 0!==r[1])||r[1];if(!o._joinInfo)throw new z(k.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof n||n instanceof Uint8Array)&&(n={payload:n}),"string"==typeof n.payload){const h=new TextEncoder;n.payload=h.encode(n.payload)}let d=!1;if(o._encryptDataStream&&o._encryptDataStreamIv&&o._encryptDataStreamKey&&window.crypto.subtle&&he(a=["aes-128-gcm2","aes-256-gcm2"]).call(a,o._encryptionMode)&&(d=!0,n.payload=yield(h=L(function*(p,m,g){var v;const y=Ue(v=Array.from(g)).call(v,(M,x)=>M+x,0),b={serverTs:0,seq:sS++,length:g.length,checkSum:y},C=new Uint8Array(hR(y,2)),N=new ArrayBuffer(10),R=new DataView(N);R.setUint32(0,b.serverTs),R.setUint16(4,b.seq),R.setUint16(6,b.length),R.setUint16(8,b.checkSum),g=Y1(g,new Uint8Array(16-g.length%16));const D=yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:p,tagLength:128,additionalData:C},m,g);return Y1(new Uint8Array(N),new Uint8Array(D))}),function(p,m,g){return h.apply(this,arguments)})(o._encryptDataStreamIv,o._encryptDataStreamKey,n.payload)),new Blob([n.payload]).size>1024)throw new z(k.INVALID_PARAMS,d?"encrypted stream message out of range.":"stream message out of range.");var h;return o._gateway.signal.request(Pe.DATA_STREAM,{payload:_l(n.payload),syncWithAudio:n.syncWithAudio,sendTs:Date.now()-qW},!l)})()}sendMetadata(n){if(!this._joinInfo)throw new z(k.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([n]).size>1024)throw new z(k.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Pe.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:_l(n)})}sendCustomReportMessage(n){var r=this;return L(function*(){if(Array.isArray(n)||(n=[n]),n.forEach(r4),!r._joinInfo)throw new z(k.INVALID_OPERATION,"can not send custom report, not joined");yield be.sendCustomReportMessage(r._joinInfo.sid,n)})()}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}pickSVCLayer(n,r){var o=this;return L(function*(){fi(r.spatialLayer,"spatialLayer",[0,1,2,3]),fi(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{yield o._gateway.pickSVCLayer(n,r)}catch(a){throw T.error("[".concat(o._clientId,"] pick SVC layer failed"),a.toString()),a}})()}setRTMConfig(n){var r=this;return L(function*(){const{apRTM:o=!1,rtmFlag:a}=n;if(pl(o,"apRTM"),Ut(a,"rtmFlag",0),r._rtmConfig.apRTM=o,r._rtmConfig.rtmFlag=a,T.debug("[".concat(r._clientId,"] setRTMconfig ").concat(JSON.stringify(n)," in ").concat(r.connectionState," state")),("CONNECTED"===r.connectionState||"RECONNECTING"===r.connectionState)&&r._joinInfo)return r._joinInfo.apRTM=o,r._joinInfo.rtmFlag=a,r._gateway.setRTM2Flag(a)})()}_reset(){if(T.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Nr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&Y2(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&be.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(n=>{n._audioTrack&&n._audioTrack._destroy(),n._videoTrack&&n._videoTrack._destroy(),n._dataChannels&&(n._dataChannels.forEach(r=>r._close()),n._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Qi("client-publish",this._clientId),this._subscribeMutex=new Qi("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(n,r){var o;const a=n||Cf();T.debug(n?"[".concat(this._clientId,"] new Session ").concat(a):"[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a));const l=n?"":this._sessionId||"";this._sessionId=a,this.store.sessionId=a,be.addSid(a);const d={lts:(new Date).getTime(),mode:this.mode,buildFormat:1,stringUid:r?.stringUid||(null===(o=this._joinInfo)||void 0===o?void 0:o.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:l,clientRole:"audience"===this.role?2:1};be.sessionInit(this._sessionId,Os({cname:r.channel,appid:r.appId},d)),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}_publishHighStream(n){var r=this;return L(function*(){if(!r._joinInfo||void 0===r._uid)throw new z(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==r.connectionState&&"RECONNECTING"!==r.connectionState)throw new z(k.INVALID_OPERATION,"can not publish stream in ".concat(r.connectionState," state"));if("auto"===r._turnServer.mode&&V("FORCE_TURN")&&!V("TURN_ENABLE_TCP")&&!V("TURN_ENABLE_UDP"))throw new z(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");T.debug("[".concat(r._clientId,"] publish high stream"));try{const a=yield r._p2pChannel.publish(n,r._isDualStreamEnabled,r._lowStreamParameter);if(r._p2pChannel instanceof us){const l=(yield a.next()).value;if(l){try{yield r._gateway.sendExtensionMessage(Bn.PUBLISH,l,!0)}catch(d){throw a.throw(d),d}yield a.next()}r._p2pChannel.reportPublishEvent(!0,null)}else{const l=(yield a.next()).value;if(l){var o;let d;try{d=yield r._gateway.publish(r._uid,l,!0)}catch(h){if(h.code!==k.DISCONNECT_P2P)throw a.throw(h),h}yield a.next((null===(o=d)||void 0===o?void 0:o.ortc)||[])}r._p2pChannel.reportPublishEvent(!0,null);for(const d of n)d instanceof Ve&&d._encoderConfig&&r._gateway.setVideoProfile(d._encoderConfig),!d.muted&&d.enabled||(yield r._p2pChannel.muteLocalTrack(d))}}catch(a){if(r._p2pChannel.reportPublishEvent(!1,a?.code,n),a?.code===k.WS_ABORT)return;throw a}})()}_publishLowStream(){var n=this;return L(function*(){if(!n._joinInfo||void 0===n._uid)throw new z(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==n.connectionState&&"RECONNECTING"!==n.connectionState)throw new z(k.INVALID_OPERATION,"can not publish stream in ".concat(n.connectionState," state"));T.debug("[".concat(n._clientId,"] publish low stream"));const r=n._configDistribute.getLowStreamConfigDistribute();r&&r.bitrate&&(n._lowStreamParameter||(n._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),n._lowStreamParameter&&n._lowStreamParameter.bitrate&&r.bitrate<n._lowStreamParameter.bitrate&&(n._lowStreamParameter.bitrate=r.bitrate));try{const a=yield n._p2pChannel.publishLowStream(n._lowStreamParameter),l=(yield a.next()).value;if(l){var o;let d;try{d=yield n._gateway.publish(n._uid,l,!0)}catch(h){if(h.code!==k.DISCONNECT_P2P)throw a.throw(h),h}a.next((null===(o=d)||void 0===o?void 0:o.ortc)||[]),n._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(a){if(n._p2pChannel.reportPublishEvent(!1,a?.code,void 0,!0),a?.code===k.WS_ABORT)return;throw a}})()}_createLiveStreamingClient(n){const r=()=>{if(!this._joinInfo||!this._appId)return new z(k.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const o=(a={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},lC("LiveStreaming").create(a));var a;return o.onLiveStreamError=(l,d)=>{be.reportApiInvoke(this._sessionId,{name:Yn.ON_LIVE_STREAM_ERROR,options:[l,d],tag:st.TRACER}).onSuccess(),this.safeEmit(Je.LIVE_STREAMING_ERROR,l,d)},o.onLiveStreamWarning=(l,d)=>{be.reportApiInvoke(this._sessionId,{name:Yn.ON_LIVE_STREAM_WARNING,options:[l,d],tag:st.TRACER}).onSuccess(),this.safeEmit(Je.LIVE_STREAMING_WARNING,l,d)},o.on(fS.REQUEST_WORKER_MANAGER_LIST,(l,d,h)=>{if(!this._joinInfo)return h(new z(k.INVALID_OPERATION,"can not find join info to get worker manager"));var p;(p=L(function*(m,g,v,y){const b=V("UAP_AP").slice(0,V("AJAX_REQUEST_CONCURRENT")).map(C=>g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(C+"/api/v1?action=uap"):"https://".concat(C,"/api/v1?action=uap"));return yield function a2(n,r,o,a,l){pv+=1;const d={sid:o.sid,command:"convergeAllocateEdge",uid:"666",appId:o.appId,ts:Math.floor(Date.now()/1e3),seq:pv,requestId:pv,version:Ss,cname:o.cname},h={service_name:r,json_body:JSON.stringify(d)};let p,m,g=n[0];return rs(L(function*(){p=Date.now();const v=yield ta(g,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-p,0!==v.code){const C=new z(k.UNEXPECTED_RESPONSE,"live streaming ap error, code"+v.code,{retry:!0,responseTime:m});throw T.error(C.toString()),C}const y=JSON.parse(v.json_body);if(200!==y.code){const C=new z(k.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(y.code,", reason: ").concat(y.reason),{code:y.code,responseTime:m});throw T.error(C.toString()),C}if(!y.servers||0===y.servers.length){const C=new z(k.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:y.code,responseTime:m});throw T.error(C.toString()),C}const b=(N=r,{addressList:(C=y).servers.map(R=>"wss://".concat(R.address.replace(/\./g,"-"),".").concat(V("WORKER_DOMAIN"),":").concat(R.wss,"?serviceName=").concat(encodeURIComponent(N))),workerToken:C.workerToken,vid:C.vid});var C,N;return V("LIVE_STREAMING_ADDRESS")&&(b.addressList=V("LIVE_STREAMING_ADDRESS")instanceof Array?V("LIVE_STREAMING_ADDRESS"):[V("LIVE_STREAMING_ADDRESS")]),XS(XS({},b),{},{responseTime:m})}),(v,y)=>(be.apworkerEvent(o.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(v.addressList),firstSuccess:0===y,responseTime:m,serverIp:n[y%n.length]}),!1),(v,y)=>(be.apworkerEvent(o.sid,{success:!1,sc:v.data&&v.data.code||200,serviceName:r,responseTime:m,serverIp:n[y%n.length]}),!!(v.code!==k.OPERATION_ABORTED&&v.code!==k.UNEXPECTED_RESPONSE||v.data&&v.data.retry)&&(g=n[(y+1)%n.length],!0)),l)}(b,m,g,v,y)}),function(m,g,v,y){return p.apply(this,arguments)})(l,this._joinInfo,this._axiosCancelSource.token,Nn).then(d).catch(h)}),o};return n===Pa.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new z(k.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:o}=this.getLocalVideoStats(),a=(n={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:o}},lC("ChannelMediaRelay").create(n));a.on("state",l=>{l===ho.RELAY_STATE_FAILURE&&a&&a.dispose(),this.safeEmit(Je.CHANNEL_MEDIA_RELAY_STATE,l)}),a.on("event",l=>{this.safeEmit(Je.CHANNEL_MEDIA_RELAY_EVENT,l)}),this._channelMediaRelayClient=a,this._statsCollector.onStatsChanged=(l,d)=>{var h;"resolution"===l&&(null===(h=this._channelMediaRelayClient)||void 0===h||h.setVideoProfile(d))}}var n;return this._channelMediaRelayClient}_handleUpdateDataChannel(n,r){const{added:o,deleted:a}=n,l=[];if(r){const d=[];this._users.forEach(h=>{h._dataChannels.forEach(p=>{o.every(m=>m.uid!==h._uintid||m.stream_id!==p.id)&&d.push({uid:h._uintid,stream_id:p.id,ordered:p.ordered,max_retrans_times:p.maxRetransmits,metadata:p.metadata})})}),d.length>0&&this._handleUpdateDataChannel({added:[],deleted:d})}Array.isArray(o)&&o.length>0&&o.forEach(d=>{const{uid:h,stream_id:p,ordered:m,max_retrans_times:g,metadata:v}=d,y=this._users.find(b=>b._uintid===h);if(y){if(T.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),he(l).call(l,y)||l.push(y),y._uintid||(y._uintid=h),-1===y._dataChannels.findIndex(b=>b.id===d.stream_id)){const b={id:p,ordered:!!m,maxRetransmits:g,metadata:v},C=vH(b,!0);y._dataChannels.push(C),T.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published datachannel")),r||this.safeEmit(Je.USER_PUBLISHED,y,"datachannel",b)}this._p2pChannel.hasPendingRemoteDataChannel(y,d.stream_id)&&(T.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(y.uid," after reconnect.")),this._subscribeDataChannel(y,d.stream_id).catch(b=>{T.error("[".concat(this._clientId,"] resubscribe datachannel error"),b.toString())}))}else T.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))}),r&&(this.safeEmit(Je.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(a)&&a.length>0&&a.forEach(d=>{const{uid:h}=d,m=this._users.find(v=>v._uintid===h);if(!m)return void T.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const g=m._dataChannels.find(v=>v.id===d.stream_id);g&&(T.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(m,[g]).then(v=>{if(m._dataChannels=m._dataChannels.filter(y=>y!==g),v)return this._gateway.unsubscribeDataChannel(v,m.uid)}),T.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(g.id)),this.safeEmit(Je.USER_UNPUBLISHED,m,"datachannel",g._config))})}_handleRemoveDataChannels(n){const r=this._users.find(o=>o.uid===n.uid);if(r){if(void 0!==r._dataChannels&&r._dataChannels.length>0){T.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(n.uid));const o=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(a=>{this.safeEmit(Je.USER_UNPUBLISHED,r,"datachannel",a._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(a=>{if(a)return this._gateway.unsubscribeDataChannel(a,r.uid)}),o()}}else T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){var n=this;this._gateway.on(gi.DISCONNECT_P2P,L(function*(){yield n._p2pChannel.disconnectForReconnect()})),this._gateway.on(gi.CONNECTION_STATE_CHANGE,(r,o,a)=>{var l;if(a===Rt.FALLBACK)return;const d=()=>{this.safeEmit(Je.CONNECTION_STATE_CHANGE,r,o,a)};if(be.reportApiInvoke(this._sessionId||(null===(l=this._gateway.joinInfo)||void 0===l?void 0:l.sid)||null,{name:Yn.CONNECTION_STATE_CHANGE,options:[r,o,a],tag:st.TRACER}).onSuccess(JSON.stringify({cur:r,prev:o,reason:a})),T.info("[".concat(this._clientId,"] signal connection state change: ").concat(o," -> ").concat(r)),"DISCONNECTED"===r)return this._reset(),void d();if("RECONNECTING"===r)this._users.forEach(p=>{p._trust_in_room_=!1,p._trust_audio_enabled_state_=!1,p._trust_video_enabled_state_=!1,p._trust_audio_mute_state_=!1,p._trust_video_mute_state_=!1,p._trust_audio_stream_added_state_=!1,p._trust_video_stream_added_state_=!1,p._is_pre_created||(p._audio_pre_subscribed||(p._audioSSRC=void 0,p._audioOrtc=void 0),p._video_pre_subscribed||(p._videoSSRC=void 0,p._videoOrtc=void 0,p._rtxSsrcId=void 0),p._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===r){var h;this._streamFallbackTypeCacheMap.forEach((p,m)=>{this._gateway.setStreamFallbackOption(m,p).catch(g=>{T.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)})}),this._remoteStreamTypeCacheMap.forEach((p,m)=>{this._gateway.setRemoteVideoStreamType(m,p).catch(g=>{T.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(h=this._joinInfo)||void 0===h?void 0:h.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{T.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(p=>{T.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(p))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(p=>!p._trust_in_room_).forEach(p=>{T.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(p.uid)),this._handleUserOffline({uid:p.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(p=>{p._trust_audio_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(p.uid)),this._handleMuteStream(p.uid,_e.AUDIO,!1)),p._trust_video_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(p.uid)),this._handleMuteStream(p.uid,_e.VIDEO,!1)),p._trust_audio_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(p.uid)),this._handleSetStreamLocalEnable("audio",p.uid,!0)),p._trust_video_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(p.uid)),this._handleSetStreamLocalEnable("video",p.uid,!0)),p._trust_video_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(p.uid)),this._handleResetAddStream(p,"video")),p._trust_audio_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(p.uid)),this._handleResetAddStream(p,"audio")),p._video_added_||p._audio_added_||(T.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(p.uid)),this._handleRemoveStream({uid:p.uid,uint_id:p._uintid}))}))},1e3))}d()}),this._gateway.on(gi.REQUEST_NEW_GATEWAY_LIST,function(){var r=L(function*(o,a){if(!n._joinInfo)return a(new z(k.UNEXPECTED_ERROR,"can not recover, no join info"));try{let l;const d=yield MD(Os(Os({},n._joinInfo),{},{uid:n._joinInfo.uid,stringUid:void 0}));d?(l=d.ap,$2(d),n._joinInfo.preload=!0):(l=yield iD(n._joinInfo,n._axiosCancelSource.token,n._config.httpRetryConfig||Nn,n.store),n._joinInfo.preload=!1),n._joinInfo&&(n._joinInfo.apResponse=l.gatewayInfo.res,n._joinInfo.gatewayAddrs=l.gatewayInfo.gatewayAddrs,n._joinInfo.uni_lbs_ip=l.gatewayInfo.uni_lbs_ip);const h=[];l.gatewayInfo.gatewayAddrs.forEach(p=>{let{address:m}=p;const[g,v]=m.split(":");h.push(n._joinInfo&&n._joinInfo.proxyServer?{proxy:n._joinInfo.proxyServer,host:g,port:v}:{host:g,port:v})}),o(h)}catch(l){a(l)}});return function(o,a){return r.apply(this,arguments)}}()),this._gateway.on(gi.NETWORK_QUALITY,r=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(Je.NETWORK_QUALITY,r)}),this._gateway.on(gi.STREAM_TYPE_CHANGE,(r,o)=>{this.safeEmit(Je.STREAM_TYPE_CHANGED,r,o),be.reportApiInvoke(this._sessionId,{name:Yn.STREAM_TYPE_CHANGE,options:[r,o],tag:st.TRACER}).onSuccess(JSON.stringify({uid:r,streamType:o}))}),this._gateway.on(gi.IS_P2P_DISCONNECTED,r=>{this._p2pChannel.isP2PDisconnected()?r(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?r(!1):r(!0)}),this._gateway.on(gi.REQUEST_P2P_CONNECTION_PARAMS,function(){var r=L(function*(o,a,l){try{let d=yield n._p2pChannel.getEstablishParams();V("ENABLE_PREALLOC_PC")&&d||(d=yield n._p2pChannel.startP2PConnection(o)),a(d)}catch(d){l(d)}});return function(o,a,l){return r.apply(this,arguments)}}()),this._gateway.on(gi.JOIN_RESPONSE,(r,o)=>{if(this.store.useP2P)return;let a;r.attributes?a=r.attributes.userAttributes.preSubSsrcs:T.debug("no attributes in joinResponse");const l=As(r.ortc,o,a);this._p2pChannel.connect(l)}),this._gateway.on(gi.PRE_CONNECT_PC,function(){var r=L(function*(o){const{candidates:a,fingerprint:l}=o;if(n._joinInfo&&a.length>0&&!n._p2pChannel.isPlanB){var d;yield n._p2pChannel.startP2PConnection({turnServer:n._joinInfo.turnServer});const{cert:h,cid:p}=n._joinInfo.apResponse;yield n._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(p,"_").concat(h),icePwd:"".concat(p,"_").concat(h)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(d=V("FINGERPRINT"))&&void 0!==d?d:l}]},candidates:a,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}});return function(o){return r.apply(this,arguments)}}())}_handleGatewaySignalEvents(){var n=this;this._gateway.signal.on(qe.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(qe.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(qe.ON_ADD_AUDIO_STREAM,r=>this._handleAddAudioOrVideoStream("audio",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc)),this._gateway.signal.on(qe.ON_ADD_VIDEO_STREAM,r=>this._handleAddAudioOrVideoStream("video",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc,r.rtxSsrcId)),this._gateway.signal.on(qe.ON_REMOTE_DATASTREAM_UPDATE,r=>{this._handleUpdateDataChannel(r)}),this._gateway.signal.on(qe.ON_REMOTE_FULL_DATASTREAM_INFO,r=>{this._handleUpdateDataChannel({added:r.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(qe.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(qe.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(qe.MUTE_AUDIO,r=>this._handleMuteStream(r.uid,_e.AUDIO,!0)),this._gateway.signal.on(qe.UNMUTE_AUDIO,r=>this._handleMuteStream(r.uid,_e.AUDIO,!1)),this._gateway.signal.on(qe.MUTE_VIDEO,r=>this._handleMuteStream(r.uid,_e.VIDEO,!0)),this._gateway.signal.on(qe.UNMUTE_VIDEO,r=>this._handleMuteStream(r.uid,_e.VIDEO,!1)),this._gateway.signal.on(qe.RECEIVE_METADATA,r=>{const o=gl(r.metadata);this.safeEmit(Je.RECEIVE_METADATA,r.uid,o)}),this._gateway.signal.on(qe.ON_DATA_STREAM,function(){var r=L(function*(o){var a;if(!o)return;let l=gl(o.payload);if(n._encryptDataStream&&n._encryptDataStreamIv&&n._encryptDataStreamKey&&window.crypto.subtle&&he(a=["aes-128-gcm2","aes-256-gcm2"]).call(a,n._encryptionMode)){if(o.payload.length<10)throw new z(k.UNEXPECTED_RESPONSE,"payload length ".concat(o.payload.length," is less than header length ").concat(10));l=yield(p=L(function*(m,g,v){const y=v.subarray(0,10),b=y.slice(8,10),C=(b[0]<<8)+b[1],N=(y[6]<<8)+y[7],R=yield window.crypto.subtle.decrypt({name:"AES-GCM",iv:m,tagLength:128,additionalData:new Uint8Array(hR(C,2))},g,v.subarray(10));return new Uint8Array(R).subarray(0,N)}),function(m,g,v){return p.apply(this,arguments)})(n._encryptDataStreamIv,n._encryptDataStreamKey,l)}var p;let d=0;if(o.ordered||o.syncWithAudio){const h=n._p2pChannel.getStats(),p=n.remoteUsers.find(g=>g.uid===o.uid),m=h?.audioRecv.find(g=>g.ssrc===p?._audioSSRC);d=m?.jitterBufferMs}null==d&&(d=0),function uC(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;if(!n.syncWithAudio)return OD(o,{uid:n.uid,payload:n.payload});const a="".concat(o.id,"-").concat(n.uid),l=W2.get(a)||[],d=l.findIndex(g=>n.sendTs>=g.sendTs),h=yH(yH({},n),{},{context:o,mediaDelay:r,recvTs:Date.now()});-1===d?l.push(h):l.splice(d,0,h),W2.set(a,l);let p=!1;var m;DD.has(a)?p=!(null===(m=DD.get(a))||void 0===m||!m.isSyncing):DD.set(a,{isSyncing:p,firstRecvTs:0,firstSendTs:0}),p||dC(a)}(Os(Os({},o),{},{payload:l}),d,{id:n._clientId,onStreamMessage:"function"==typeof n.onStreamMessage?n.onStreamMessage.bind(n):void 0,safeEmit:n.safeEmit.bind(n)})});return function(o){return r.apply(this,arguments)}}()),this._gateway.signal.on(qe.ON_CRYPT_ERROR,()=>{vc(()=>{T.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Je.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(qe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(qe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{T.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Rt.TOKEN_EXPIRE),this.safeEmit(Je.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(qe.ON_STREAM_FALLBACK_UPDATE,r=>{T.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(r.stream_id,", attr: ").concat(r.stream_type)),this.safeEmit(Je.STREAM_FALLBACK,r.stream_id,1===r.stream_type?"fallback":"recover")}),this._gateway.signal.on(qe.ON_PUBLISH_STREAM,r=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:r.proxy})),T.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(r))))}),this._gateway.signal.on(qe.ENABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!0)}),this._gateway.signal.on(qe.DISABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!1)}),this._gateway.signal.on(Me.REQUEST_TIMEOUT,(r,o)=>{if(this._joinInfo)switch(r){case Pe.PUBLISH:{if(!o)return;const d=o.ortc;if(d){var a,l;const h=d.some(g=>{let{stream_type:v}=g;return v===at.Audio}),p=d.some(g=>{let{stream_type:v}=g;return v!==at.Audio}),m=d.some(g=>{let{stream_type:v}=g;return v===at.Screen||v===at.ScreenLow});"offer"===o.state&&be.publish(this._joinInfo.sid,{eventElapse:tr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:k.TIMEOUT,audio:h,video:p,p2pid:o.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:h?null===(a=d.find(g=>{let{stream_type:v}=g;return v===at.Audio}))||void 0===a||null===(a=a.ssrcs[0])||void 0===a?void 0:a.ssrcId.toString():void 0,videoName:p?null===(l=d.find(g=>{let{stream_type:v}=g;return v!==at.Audio}))||void 0===l||null===(l=l.ssrcs[0])||void 0===l?void 0:l.ssrcId.toString():void 0})}break}case Pe.SUBSCRIBE:o&&be.subscribe(this._joinInfo.sid,{succ:!1,ec:k.TIMEOUT,audio:o.stream_type===_e.AUDIO,video:o.stream_type===_e.VIDEO,peerid:o.stream_id,subscribeRequestid:o.ssrcId,p2pid:this.store.p2pId,eventElapse:tr.measureFromSubscribeStart(this.store.clientId,o.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(o.ssrcId)})}}),this._gateway.signal.on(qe.ON_P2P_OK,r=>{}),this._gateway.signal.on(qe.ON_PUBLISHED_USER_LIST,r=>{if(null==r||!r.users)return;V("BLOCK_LOCAL_CLIENT")&&(r.users=r.users.filter(l=>!Dd(l.string_id||l.stream_id,this.channelName)));const o=[],a=[];for(const l of r.users){let d=this._users.find(y=>y._uintid===l.stream_id);d?d._trust_in_room_=!0:(d=new Mh(l.string_id||l.stream_id,l.stream_id),this._users.push(d),0===this.getListeners(Je.PUBLISHED_USER_LIST).length&&(T.debug("[".concat(this._clientId,"] user online"),l.stream_id),this.safeEmit(Je.USER_JOINED,d)));const h=_i.Audio&l.stream_type,p=(_i.Video|_i.LwoVideo)&l.stream_type,m=!!(65280&l.stream_type),g=h&&d.hasAudio,v=p&&d.hasVideo;p&&(d._trust_video_stream_added_state_=!0,d._video_added_=!0,d._videoSSRC=l.video_ssrc,d._rtxSsrcId=l.video_rtx),h&&(d._trust_audio_stream_added_state_=!0,d._audio_added_=!0,d._audioSSRC=l.audio_ssrc),h&&!g&&0===this.getListeners(Je.PUBLISHED_USER_LIST).length&&(T.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published audio")),this.safeEmit(Je.USER_PUBLISHED,d,"audio")),p&&!v&&0===this.getListeners(Je.PUBLISHED_USER_LIST).length&&(T.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published video")),this.safeEmit(Je.USER_PUBLISHED,d,"video")),(h&&!g||p&&!v||m)&&o.push(d),p&&this._p2pChannel.hasPendingRemoteMedia(d,"video")&&a.push({user:d,mediaType:"video"}),h&&this._p2pChannel.hasPendingRemoteMedia(d,"audio")&&a.push({user:d,mediaType:"audio"})}a.length>0&&(T.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(a.map(l=>"user: ".concat(l.user.uid,", mediaType: ").concat(l.mediaType)).join("; ")," ")),this.massSubscribe(a).catch(l=>{T.error("[".concat(this._clientId,"] mass resubscribe error"),l.toString())})),this.getListeners(Je.PUBLISHED_USER_LIST).length>0?V("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=o:(T.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(o.map(l=>l.uid).join(", "))),this.safeEmit(Je.PUBLISHED_USER_LIST,o)):T.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(o.map(l=>l.uid).join(", ")))}),this._gateway.signal.on(qe.ON_RTP_CAPABILITY_CHANGE,r=>{const{video_codec:o}=r;this._p2pChannel instanceof aC&&this._p2pChannel.updateRemoteRTPCapabilities(o.map(a=>a.toLowerCase()).filter(a=>{var l;return he(l=Object.keys(vR)).call(l,a)}))})}_handleP2PEvents(){var n=this;this._gateway.signal.on(qe.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Bn.PUBLISH,(r,o,a)=>{const{uid:l}=r;r.forEach(d=>{const{kind:h,ssrcs:p,mid:m,isMuted:g}=d;this._handleP2PAddAudioOrVideoStream(h,l,p[0].ssrcId,m);const v=this._users.find(y=>y.uid===l);return v&&this._p2pChannel instanceof us?this._p2pChannel.mockSubscribe(v,h,p[0].ssrcId,m).then(()=>{o()}).catch(a):o(),this._handleMuteStream(l,h,!!g)})}),this._gateway.signal.on(Bn.CALL,function(){var r=L(function*(o,a,l){if(n._p2pChannel instanceof us)try{var d;a(yield n._p2pChannel.startP2P({turnServer:null===(d=n._joinInfo)||void 0===d?void 0:d.turnServer},o))}catch(h){l(h)}});return function(o,a,l){return r.apply(this,arguments)}}()),this._gateway.signal.on(Me.P2P_CONNECTION,function(){var r=L(function*(o){n._p2pChannel instanceof us&&(yield n._p2pChannel.p2pConnect(o))});return function(o){return r.apply(this,arguments)}}()),this._gateway.signal.on(Bn.UNPUBLISH,function(){var r=L(function*(o,a,l){if(n._p2pChannel instanceof us){const{unpubMsg:d,uid:h}=o,p=n._users.find(m=>m.uid===h);if(!p)return T.warning("[".concat(n._clientId,"] can not find remote user, ignore mute event, uid: ").concat(h)),void a();try{d.forEach(function(){var m=L(function*(g){let{stream_type:v}=g;const y=v===at.Audio?_e.AUDIO:_e.VIDEO;yield n._p2pChannel.unsubscribe(p,y),n._handleMuteStream(h,y,!0)});return function(g){return m.apply(this,arguments)}}()),a()}catch(m){l(m)}}});return function(o,a,l){return r.apply(this,arguments)}}()),this._gateway.signal.on(Bn.CONTROL,function(){var r=L(function*(o,a){const{action:l}=o;switch(l){case Nd.MUTE_LOCAL_VIDEO:n._handleMuteStream(a,_e.VIDEO,!0);break;case Nd.MUTE_LOCAL_AUDIO:n._handleMuteStream(a,_e.AUDIO,!0);break;case Nd.UNMUTE_LOCAL_VIDEO:n._handleP2PAddAudioOrVideoStream("video",a),n._handleMuteStream(a,_e.VIDEO,!1);break;case Nd.UNMUTE_LOCAL_AUDIO:n._handleP2PAddAudioOrVideoStream("audio",a),n._handleMuteStream(a,_e.AUDIO,!1)}});return function(o,a){return r.apply(this,arguments)}}()),this._gateway.signal.on(Bn.RESTART_ICE,function(){var r=L(function*(o,a,l){if(n._p2pChannel instanceof us)try{const{direction:d,iceParameter:h}=o;d!==Pr.SEND_ONLY||h?a(yield n._p2pChannel.restartICE(d,h)):(n._p2pChannel.handleDisconnect(d),a())}catch(d){l(d)}});return function(o,a,l){return r.apply(this,arguments)}}()),this._gateway.signal.on(Bn.CANDIDATE,r=>{if(this._p2pChannel instanceof us){const{candidate:o,direction:a}=r;this._p2pChannel.addRemoteCandidate(o,a)}}),this._p2pChannel.on(De.RequestP2PRestartICE,function(){var r=L(function*(o,a,l){try{const{direction:d}=o;a(yield n._gateway.sendExtensionMessage(Bn.RESTART_ICE,o,d===Pr.SEND_ONLY))}catch(d){l(d)}});return function(o,a,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(De.LocalCandidate,r=>{this._gateway.sendExtensionMessage(Bn.CANDIDATE,JSON.stringify(r),!0)}),this._p2pChannel.on(De.RequestP2PMuteLocal,function(){var r=L(function*(o,a,l){try{yield n._gateway.sendExtensionMessage(Bn.CONTROL,o,!0),a()}catch(d){l(d)}});return function(o,a,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(De.RequestP2PUnmuteRemote,function(){var r=L(function*(o,a,l){if(n._joinInfo)try{yield n._gateway.unmuteRemote(o,n._joinInfo.stringUid||n._joinInfo.uid),a()}catch(d){d.code===k.DISCONNECT_P2P?a():l(d)}else a()});return function(o,a,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(De.RequestP2PMuteRemote,function(){var r=L(function*(o,a,l){if(n._joinInfo)try{yield n._gateway.muteRemote(o,n._joinInfo.stringUid||n._joinInfo.uid),a()}catch(d){d.code===k.DISCONNECT_P2P?a():l(d)}else a()});return function(o,a,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(De.StateChange,(r,o)=>{o===Dt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){var n=this;this._p2pChannel.on(De.RequestMuteLocal,function(){var r=L(function*(o,a,l){if(n._joinInfo)try{yield n._gateway.muteLocal(o,n._joinInfo.stringUid||n._joinInfo.uid),a()}catch(d){d.code===k.DISCONNECT_P2P?a():l(d)}else a()});return function(o,a,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(De.RequestUnmuteLocal,function(){var r=L(function*(o,a,l){if(n._joinInfo)try{yield n._gateway.unmuteLocal(o,n._joinInfo.stringUid||n._joinInfo.uid),a()}catch(d){d.code===k.DISCONNECT_P2P?a():l(d)}else a()});return function(o,a,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(De.RequestRePublish,(r,o,a)=>{this.publish(r,!1).then(o).catch(a)}),this._p2pChannel.on(De.RequestRePublishDataChannel,(r,o,a)=>{le.all(r.map(function(){var l=L(function*(d){const h=yield n._p2pChannel.publishDataChannel([d]);try{h.forEach(p=>{n._uid&&n._gateway.publishDataChannel(n._uid,p,!0)})}catch(p){if(p.code!==k.DISCONNECT_P2P)throw p}});return function(d){return l.apply(this,arguments)}}())).then(o).catch(a)}),this._p2pChannel.on(De.RequestReSubscribe,function(){var r=L(function*(o,a,l){try{for(const{user:d,kind:h}of o)h===_e.VIDEO?yield n.subscribe(d,"video"):yield n.subscribe(d,"audio");a()}catch(d){l(d)}});return function(o,a,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(De.RequestUpload,(r,o)=>{this._gateway.upload(r,o)}),this._p2pChannel.on(De.RequestUploadStats,r=>{this._gateway.uploadWRTCStats(r)}),this._p2pChannel.on(De.MediaReconnectStart,r=>{this.safeEmit(Je.MEDIA_RECONNECT_START,r)}),this._p2pChannel.on(De.MediaReconnectEnd,r=>{this.safeEmit(Je.MEDIA_RECONNECT_END,r)}),this._p2pChannel.on(De.NeedSignalRTT,r=>{r(this._gateway.getSignalRTT())}),this._p2pChannel.on(De.RequestRestartICE,function(){var r=L(function*(o){if(n._p2pChannel instanceof us)return;const a=yield n._p2pChannel.restartICE(o),l=yield a.next();if(l.done)return;const d=l.value;let h;try{h=yield n._gateway.restartICE({iceParameters:d})}catch(m){return void a.throw(m)}const{iceParameters:p}=function(m){const g=m.iceParameters;return{iceParameters:{iceUfrag:g.iceUfrag,icePwd:g.icePwd}}}(h);yield a.next({remoteIceParameters:p})});return function(o){return r.apply(this,arguments)}}()),this._p2pChannel.on(De.RequestReconnect,L(function*(){n._gateway.reconnect()})),this._p2pChannel.on(De.RequestReconnectPC,L(function*(){var r;const{iceParameters:o,dtlsParameters:a,rtpCapabilities:l}=yield n._p2pChannel.startP2PConnection({turnServer:null===(r=n._joinInfo)||void 0===r?void 0:r.turnServer}),{gatewayEstablishParams:d,gatewayAddress:h}=yield n._gateway.reconnectPC({iceParameters:o,dtlsParameters:a,rtpCapabilities:l}),p=As(d,h);yield n._p2pChannel.connect(p),yield n._p2pChannel.republish(),yield n._p2pChannel.reSubscribe()})),this._p2pChannel.on(De.RequestUnpublishForReconnectPC,function(){var r=L(function*(o,a,l){n._joinInfo&&void 0!==n._uid?(yield n._gateway.unpublish(o,n._uid),a()):l()});return function(o,a,l){return r.apply(this,arguments)}}()),this._p2pChannel.on(De.P2PLost,()=>{this.safeEmit(Je.P2P_LOST,this.store.uid)}),this._p2pChannel.on(De.UpdateVideoEncoder,r=>{r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig)}),this._p2pChannel.on(De.ConnectionTypeChange,r=>{this.safeEmit(Je.IS_USING_CLOUD_PROXY,r)}),this._p2pChannel.on(De.RequestLowStreamParameter,r=>{r(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(De.QueryClientConnectionState,r=>{r(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}enableContentInspect(n){var r=this;return L(function*(){if(!r._joinInfo||"CONNECTED"!==r.connectionState)throw new z(k.INVALID_OPERATION,"[".concat(r._clientId,"] can not create content inspect, please join channel first"));if(r._inspect)throw new z(k.INVALID_OPERATION,"[".concat(r._clientId,"] Inspect content service already in connecting/connected state"));try{const a=(o={config:n},lC("ContentInspect").create(o));r._inspect=a,r.handleVideoInspectEvents(a);const{appId:l,cname:d,sid:h,token:p,uid:m,cid:g,vid:v}=r._joinInfo;yield a.init({appId:l,areaCode:"",cname:d,sid:h,token:p,uid:m,cid:g,vid:v?Number(v):0},Nn)}catch(a){throw Array.isArray(a)?a[0]:a}var o})()}handleVideoInspectEvents(n){n.on(vi.CONNECTION_STATE_CHANGE,(r,o)=>{if(this.safeEmit(Je.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,o),o===qs.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(Je.CONTENT_INSPECT_ERROR,new z(k.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));n.inspectImage()}}),n.on(vi.INSPECT_RESULT,(r,o)=>{var a;if(o?.code===k.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return T.debug("Stop inspect content because that has left channel"),null==this||null===(a=this._inspect)||void 0===a||a.close(),void(this._inspect=void 0);this.safeEmit(Je.CONTENT_INSPECT_RESULT,r,o)}),n.on(vi.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(o=>"video"===o.trackMediaType)[0])})}disableContentInspect(){var n=this;return L(function*(){if(!n._inspect)throw new z(k.INVALID_OPERATION,"[".concat(n._clientId,"] inspectVideoContent not started"));try{n._inspect.close(),n._inspect=void 0}catch(r){throw Array.isArray(r)?r[0]:r}})()}setImageModeration(n,r){var o=this;return L(function*(){if(pl(n,"enabled"),n){if(!r)throw new z(k.INVALID_PARAMS,"config is required");if(NH(r),!o._joinInfo)throw new z(k.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(o._moderation)o._moderation.updateConfig(r);else{const l=(a={config:r},lC("ImageModeration").create(a));o._moderation=l,o.handleImageModerationEvents(l);const{appId:d,cname:h,sid:p,token:m,uid:g,cid:v,vid:y}=o._joinInfo;yield l.init({appId:d,areaCode:"",cname:h,sid:p,token:m,uid:g,cid:v,vid:y?Number(y):0},Nn)}}catch(l){throw Array.isArray(l)?l[0]:l}}else{var a;if(!o._moderation)throw new z(k.INVALID_OPERATION,"[".concat(o._clientId,"] image moderation not started"));try{o._moderation.close(),o._moderation.removeAllListeners(),o._moderation=void 0}catch(l){throw Array.isArray(l)?l[0]:l}}})()}handleImageModerationEvents(n){n.on(Ma.CONNECTION_STATE_CHANGE,(r,o)=>{if(this.safeEmit(Je.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,o),r===Is.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new z(k.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");n.inspectImage()}}),n.on(Ma.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(o=>"video"===o.trackMediaType)[0])})}setP2PTransport(n){if(fi(n,"transport",["default","auto","relay","sd-rtn"]),"p2p"!==this.mode)throw new z(k.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=n,T.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(n))}getJoinChannelServiceRecords(){return T.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}setPublishAudioFilterEnabled(n){var r=this;return L(function*(){pl(n,"enabled"),Lt("ENABLE_PUBLISH_AUDIO_FILTER",n),r._joinInfo&&(yield r._gateway.setPublishAudioFilterEnabled(n))})()}_handleResetAddStream(n,r){switch(r){case"audio":n._audio_added_=!1,n._trust_audio_stream_added_state_=!0;break;case"video":n._video_added_=!1,n._trust_video_stream_added_state_=!0}}},pe(fe.prototype,"leave",[rF],Object.getOwnPropertyDescriptor(fe.prototype,"leave"),fe.prototype),pe(fe.prototype,"publish",[PH],Object.getOwnPropertyDescriptor(fe.prototype,"publish"),fe.prototype),pe(fe.prototype,"unpublish",[MH],Object.getOwnPropertyDescriptor(fe.prototype,"unpublish"),fe.prototype),pe(fe.prototype,"subscribe",[kH],Object.getOwnPropertyDescriptor(fe.prototype,"subscribe"),fe.prototype),pe(fe.prototype,"presubscribe",[LH],Object.getOwnPropertyDescriptor(fe.prototype,"presubscribe"),fe.prototype),pe(fe.prototype,"massSubscribe",[xH],Object.getOwnPropertyDescriptor(fe.prototype,"massSubscribe"),fe.prototype),pe(fe.prototype,"unsubscribe",[FH],Object.getOwnPropertyDescriptor(fe.prototype,"unsubscribe"),fe.prototype),pe(fe.prototype,"massUnsubscribe",[UH],Object.getOwnPropertyDescriptor(fe.prototype,"massUnsubscribe"),fe.prototype),pe(fe.prototype,"setLowStreamParameter",[VH],Object.getOwnPropertyDescriptor(fe.prototype,"setLowStreamParameter"),fe.prototype),pe(fe.prototype,"enableDualStream",[$d],Object.getOwnPropertyDescriptor(fe.prototype,"enableDualStream"),fe.prototype),pe(fe.prototype,"disableDualStream",[Rv],Object.getOwnPropertyDescriptor(fe.prototype,"disableDualStream"),fe.prototype),pe(fe.prototype,"setClientRole",[BH],Object.getOwnPropertyDescriptor(fe.prototype,"setClientRole"),fe.prototype),pe(fe.prototype,"setProxyServer",[jH],Object.getOwnPropertyDescriptor(fe.prototype,"setProxyServer"),fe.prototype),pe(fe.prototype,"setTurnServer",[HH],Object.getOwnPropertyDescriptor(fe.prototype,"setTurnServer"),fe.prototype),pe(fe.prototype,"setLicense",[GH],Object.getOwnPropertyDescriptor(fe.prototype,"setLicense"),fe.prototype),pe(fe.prototype,"startProxyServer",[WH],Object.getOwnPropertyDescriptor(fe.prototype,"startProxyServer"),fe.prototype),pe(fe.prototype,"stopProxyServer",[zH],Object.getOwnPropertyDescriptor(fe.prototype,"stopProxyServer"),fe.prototype),pe(fe.prototype,"setLocalAccessPointsV2",[KH],Object.getOwnPropertyDescriptor(fe.prototype,"setLocalAccessPointsV2"),fe.prototype),pe(fe.prototype,"setLocalAccessPoints",[_C],Object.getOwnPropertyDescriptor(fe.prototype,"setLocalAccessPoints"),fe.prototype),pe(fe.prototype,"setRemoteDefaultVideoStreamType",[vC],Object.getOwnPropertyDescriptor(fe.prototype,"setRemoteDefaultVideoStreamType"),fe.prototype),pe(fe.prototype,"setRemoteVideoStreamType",[oF],Object.getOwnPropertyDescriptor(fe.prototype,"setRemoteVideoStreamType"),fe.prototype),pe(fe.prototype,"setStreamFallbackOption",[EC],Object.getOwnPropertyDescriptor(fe.prototype,"setStreamFallbackOption"),fe.prototype),pe(fe.prototype,"setEncryptionConfig",[sF],Object.getOwnPropertyDescriptor(fe.prototype,"setEncryptionConfig"),fe.prototype),pe(fe.prototype,"renewToken",[aF],Object.getOwnPropertyDescriptor(fe.prototype,"renewToken"),fe.prototype),pe(fe.prototype,"enableAudioVolumeIndicator",[cF],Object.getOwnPropertyDescriptor(fe.prototype,"enableAudioVolumeIndicator"),fe.prototype),pe(fe.prototype,"startLiveStreaming",[lF],Object.getOwnPropertyDescriptor(fe.prototype,"startLiveStreaming"),fe.prototype),pe(fe.prototype,"setLiveTranscoding",[dF],Object.getOwnPropertyDescriptor(fe.prototype,"setLiveTranscoding"),fe.prototype),pe(fe.prototype,"stopLiveStreaming",[uF],Object.getOwnPropertyDescriptor(fe.prototype,"stopLiveStreaming"),fe.prototype),pe(fe.prototype,"startChannelMediaRelay",[hF],Object.getOwnPropertyDescriptor(fe.prototype,"startChannelMediaRelay"),fe.prototype),pe(fe.prototype,"updateChannelMediaRelay",[pF],Object.getOwnPropertyDescriptor(fe.prototype,"updateChannelMediaRelay"),fe.prototype),pe(fe.prototype,"stopChannelMediaRelay",[HD],Object.getOwnPropertyDescriptor(fe.prototype,"stopChannelMediaRelay"),fe.prototype),pe(fe.prototype,"sendCustomReportMessage",[fF],Object.getOwnPropertyDescriptor(fe.prototype,"sendCustomReportMessage"),fe.prototype),pe(fe.prototype,"pickSVCLayer",[yC],Object.getOwnPropertyDescriptor(fe.prototype,"pickSVCLayer"),fe.prototype),pe(fe.prototype,"setRTMConfig",[mF],Object.getOwnPropertyDescriptor(fe.prototype,"setRTMConfig"),fe.prototype),pe(fe.prototype,"enableContentInspect",[bC],Object.getOwnPropertyDescriptor(fe.prototype,"enableContentInspect"),fe.prototype),pe(fe.prototype,"disableContentInspect",[GD],Object.getOwnPropertyDescriptor(fe.prototype,"disableContentInspect"),fe.prototype),pe(fe.prototype,"setImageModeration",[gF],Object.getOwnPropertyDescriptor(fe.prototype,"setImageModeration"),fe.prototype),pe(fe.prototype,"setP2PTransport",[_F],Object.getOwnPropertyDescriptor(fe.prototype,"setP2PTransport"),fe.prototype),pe(fe.prototype,"getJoinChannelServiceRecords",[vF],Object.getOwnPropertyDescriptor(fe.prototype,"getJoinChannelServiceRecords"),fe.prototype),pe(fe.prototype,"setPublishAudioFilterEnabled",[kl],Object.getOwnPropertyDescriptor(fe.prototype,"setPublishAudioFilterEnabled"),fe.prototype),fe);class Av{constructor(r,o){O(this,"id",0),O(this,"element",void 0),O(this,"peerPair",void 0),O(this,"context",void 0),O(this,"audioPlayerElement",void 0),O(this,"audioTrack",void 0),Av.count+=1,this.id=Av.count,this.element=r,this.context=o}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const o=document.createElement("audio");o.srcObject=new MediaStream([r.track]),o.play(),this.audioPlayerElement=o}}switchSdp(){var r=this;return L(function*(){if(!r.peerPair)return;const o=function(){var l=L(function*(d,h){const p="offer"===h?yield d.createOffer():yield d.createAnswer();return yield d.setLocalDescription(p),"complete"===d.iceGatheringState?d.localDescription:new le(m=>{d.onicegatheringstatechange=()=>{"complete"===d.iceGatheringState&&m(d.localDescription)}})});return function(h,p){return l.apply(this,arguments)}}(),a=function(){var l=L(function*(d,h){return yield d.setRemoteDescription(h)});return function(h,p){return l.apply(this,arguments)}}();try{const l=yield o(r.peerPair[0],"offer");yield a(r.peerPair[1],l);const d=yield o(r.peerPair[1],"answer");yield a(r.peerPair[0],d)}catch(l){throw new z(k.LOCAL_AEC_ERROR,l.toString()).print()}})()}getTracksFromMediaElement(r){var o=this;return L(function*(){if(o.audioTrack)return o.audioTrack;let a;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),a=o.context.createMediaStreamDestination(),o.context.createMediaElementSource(r).connect(a)}catch(d){throw new z(k.LOCAL_AEC_ERROR,d.toString()).print()}if(!a)throw new z(k.LOCAL_AEC_ERROR,"no dest node when local aec").print();const l=a.stream.getAudioTracks()[0];return o.audioTrack=l,l})()}getElement(){return this.element}startEchoCancellation(){var r=this;return L(function*(){r.context.resume(),r.peerPair&&r.close(),r.initPeers();const o=r.element,a=yield r.getTracksFromMediaElement(o);r.peerPair&&r.peerPair[0].addTrack(a),yield r.switchSdp()})()}close(){T.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var SC,CC;O(Av,"count",0);const YH=window.AudioContext||window.webkitAudioContext,$H=new(SC=Ae({report:be}),pe((CC=class{constructor(){O(this,"units",[]),O(this,"context",void 0)}processExternalMediaAEC(n){if(!this._doesEnvironmentNeedAEC())return T.debug("the system does not need to process local aec"),-1;this.context||(this.context=new YH);let r=this.units.find(o=>o&&o.getElement()===n);return r||(r=new Av(n,this.context),this.units.push(r)),r.startEchoCancellation(),T.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return ot().name!==wt.SAFARI}}).prototype,"processExternalMediaAEC",[SC],Object.getOwnPropertyDescriptor(CC.prototype,"processExternalMediaAEC"),CC.prototype),CC);function yF(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function bF(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?yF(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):yF(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}const WD=window||document;function SF(n){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!WD)return;const o=ei._cspEventHandlerPointer;if(o&&r)return void console.error(o,r);const a=l=>{if(!(l&&l.blockedURI&&(ei.onSecurityPolicyViolation||ei.getListeners(Ys.SECURITY_POLICY_VIOLATION).length>0)))return;const d=l.blockedURI;V("CSP_DETECTED_HOSTNAME_LIST").some(h=>he(d).call(d,h))&&(ei.onSecurityPolicyViolation&&"function"==typeof ei.onSecurityPolicyViolation&&ei.onSecurityPolicyViolation(l),ei.getListeners(Ys.SECURITY_POLICY_VIOLATION).length>0&&ei.safeEmit(Ys.SECURITY_POLICY_VIOLATION,l))};o&&WD.removeEventListener("securitypolicyviolation",o),(r||n&&"function"==typeof n||ei.getListeners(Ys.SECURITY_POLICY_VIOLATION).length>0)&&WD.addEventListener("securitypolicyviolation",a),ei._cspEventHandlerPointer=a}var XH=Ar,ZH=Qu,JH=RegExp.prototype,fr=Gt(function(n){return n===JH||XH(JH,n)?ZH(n):n.flags});function Uh(n){let r=n.length;for(;--r>=0;)n[r]=0}const IC=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Ov=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),CF=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),qr=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ll=new Array(576);Uh(Ll);const Nv=new Array(60);Uh(Nv);const Pv=new Array(512);Uh(Pv);const Mv=new Array(256);Uh(Mv);const wC=new Array(29);Uh(wC);const RC=new Array(30);function qD(n,r,o,a,l){this.static_tree=n,this.extra_bits=r,this.extra_base=o,this.elems=a,this.max_length=l,this.has_stree=n&&n.length}let Oc,YD,$D;function XD(n,r){this.dyn_tree=n,this.max_code=0,this.stat_desc=r}Uh(RC);const TF=n=>n<256?Pv[n]:Pv[256+(n>>>7)],kv=(n,r)=>{n.pending_buf[n.pending++]=255&r,n.pending_buf[n.pending++]=r>>>8&255},hs=(n,r,o)=>{n.bi_valid>16-o?(n.bi_buf|=r<<n.bi_valid&65535,kv(n,n.bi_buf),n.bi_buf=r>>16-n.bi_valid,n.bi_valid+=o-16):(n.bi_buf|=r<<n.bi_valid&65535,n.bi_valid+=o)},ja=(n,r,o)=>{hs(n,o[2*r],o[2*r+1])},IF=(n,r)=>{let o=0;do{o|=1&n,n>>>=1,o<<=1}while(--r>0);return o>>>1},wF=(n,r,o)=>{const a=new Array(16);let l,d,h=0;for(l=1;l<=15;l++)h=h+o[l-1]<<1,a[l]=h;for(d=0;d<=r;d++){let p=n[2*d+1];0!==p&&(n[2*d]=IF(a[p]++,p))}},Lr=n=>{let r;for(r=0;r<286;r++)n.dyn_ltree[2*r]=0;for(r=0;r<30;r++)n.dyn_dtree[2*r]=0;for(r=0;r<19;r++)n.bl_tree[2*r]=0;n.dyn_ltree[512]=1,n.opt_len=n.static_len=0,n.sym_next=n.matches=0},ZD=n=>{n.bi_valid>8?kv(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},AC=(n,r,o,a)=>{const l=2*r,d=2*o;return n[l]<n[d]||n[l]===n[d]&&a[r]<=a[o]},DC=(n,r,o)=>{const a=n.heap[o];let l=o<<1;for(;l<=n.heap_len&&(l<n.heap_len&&AC(r,n.heap[l+1],n.heap[l],n.depth)&&l++,!AC(r,a,n.heap[l],n.depth));)n.heap[o]=n.heap[l],o=l,l<<=1;n.heap[o]=a},Qf=(n,r,o)=>{let a,l,d,h,p=0;if(0!==n.sym_next)do{a=255&n.pending_buf[n.sym_buf+p++],a+=(255&n.pending_buf[n.sym_buf+p++])<<8,l=n.pending_buf[n.sym_buf+p++],0===a?ja(n,l,r):(d=Mv[l],ja(n,d+256+1,r),h=IC[d],0!==h&&(l-=wC[d],hs(n,l,h)),a--,d=TF(a),ja(n,d,o),h=Ov[d],0!==h&&(a-=RC[d],hs(n,a,h)))}while(p<n.sym_next);ja(n,256,r)},JD=(n,r)=>{const o=r.dyn_tree,a=r.stat_desc.static_tree,l=r.stat_desc.has_stree,d=r.stat_desc.elems;let h,p,m,g=-1;for(n.heap_len=0,n.heap_max=573,h=0;h<d;h++)0!==o[2*h]?(n.heap[++n.heap_len]=g=h,n.depth[h]=0):o[2*h+1]=0;for(;n.heap_len<2;)m=n.heap[++n.heap_len]=g<2?++g:0,o[2*m]=1,n.depth[m]=0,n.opt_len--,l&&(n.static_len-=a[2*m+1]);for(r.max_code=g,h=n.heap_len>>1;h>=1;h--)DC(n,o,h);m=d;do{h=n.heap[1],n.heap[1]=n.heap[n.heap_len--],DC(n,o,1),p=n.heap[1],n.heap[--n.heap_max]=h,n.heap[--n.heap_max]=p,o[2*m]=o[2*h]+o[2*p],n.depth[m]=(n.depth[h]>=n.depth[p]?n.depth[h]:n.depth[p])+1,o[2*h+1]=o[2*p+1]=m,n.heap[1]=m++,DC(n,o,1)}while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],((v,y)=>{const b=y.dyn_tree,C=y.max_code,N=y.stat_desc.static_tree,R=y.stat_desc.has_stree,A=y.stat_desc.extra_bits,D=y.stat_desc.extra_base,M=y.stat_desc.max_length;let x,j,W,q,ee,J,X=0;for(q=0;q<=15;q++)v.bl_count[q]=0;for(b[2*v.heap[v.heap_max]+1]=0,x=v.heap_max+1;x<573;x++)j=v.heap[x],q=b[2*b[2*j+1]+1]+1,q>M&&(q=M,X++),b[2*j+1]=q,j>C||(v.bl_count[q]++,ee=0,j>=D&&(ee=A[j-D]),J=b[2*j],v.opt_len+=J*(q+ee),R&&(v.static_len+=J*(N[2*j+1]+ee)));if(0!==X){do{for(q=M-1;0===v.bl_count[q];)q--;v.bl_count[q]--,v.bl_count[q+1]+=2,v.bl_count[M]--,X-=2}while(X>0);for(q=M;0!==q;q--)for(j=v.bl_count[q];0!==j;)W=v.heap[--x],W>C||(b[2*W+1]!==q&&(v.opt_len+=(q-b[2*W+1])*b[2*W],b[2*W+1]=q),j--)}})(n,r),wF(o,g,n.bl_count)},vt=(n,r,o)=>{let a,l,d=-1,h=r[1],p=0,m=7,g=4;for(0===h&&(m=138,g=3),r[2*(o+1)+1]=65535,a=0;a<=o;a++)l=h,h=r[2*(a+1)+1],++p<m&&l===h||(p<g?n.bl_tree[2*l]+=p:0!==l?(l!==d&&n.bl_tree[2*l]++,n.bl_tree[32]++):p<=10?n.bl_tree[34]++:n.bl_tree[36]++,p=0,d=l,0===h?(m=138,g=3):l===h?(m=6,g=3):(m=7,g=4))},Lv=(n,r,o)=>{let a,l,d=-1,h=r[1],p=0,m=7,g=4;for(0===h&&(m=138,g=3),a=0;a<=o;a++)if(l=h,h=r[2*(a+1)+1],!(++p<m&&l===h)){if(p<g)do{ja(n,l,n.bl_tree)}while(0!=--p);else 0!==l?(l!==d&&(ja(n,l,n.bl_tree),p--),ja(n,16,n.bl_tree),hs(n,p-3,2)):p<=10?(ja(n,17,n.bl_tree),hs(n,p-3,3)):(ja(n,18,n.bl_tree),hs(n,p-11,7));p=0,d=l,0===h?(m=138,g=3):l===h?(m=6,g=3):(m=7,g=4)}};let RF=!1;const AF=(n,r,o,a)=>{hs(n,0+(a?1:0),3),ZD(n),kv(n,o),kv(n,~o),o&&n.pending_buf.set(n.window.subarray(r,r+o),n.pending),n.pending+=o};var n6={_tr_init:n=>{RF||((()=>{let r,o,a,l,d;const h=new Array(16);for(a=0,l=0;l<28;l++)for(wC[l]=a,r=0;r<1<<IC[l];r++)Mv[a++]=l;for(Mv[a-1]=l,d=0,l=0;l<16;l++)for(RC[l]=d,r=0;r<1<<Ov[l];r++)Pv[d++]=l;for(d>>=7;l<30;l++)for(RC[l]=d<<7,r=0;r<1<<Ov[l]-7;r++)Pv[256+d++]=l;for(o=0;o<=15;o++)h[o]=0;for(r=0;r<=143;)Ll[2*r+1]=8,r++,h[8]++;for(;r<=255;)Ll[2*r+1]=9,r++,h[9]++;for(;r<=279;)Ll[2*r+1]=7,r++,h[7]++;for(;r<=287;)Ll[2*r+1]=8,r++,h[8]++;for(wF(Ll,287,h),r=0;r<30;r++)Nv[2*r+1]=5,Nv[2*r]=IF(r,5);Oc=new qD(Ll,IC,257,286,15),YD=new qD(Nv,Ov,0,30,15),$D=new qD(new Array(0),CF,0,19,7)})(),RF=!0),n.l_desc=new XD(n.dyn_ltree,Oc),n.d_desc=new XD(n.dyn_dtree,YD),n.bl_desc=new XD(n.bl_tree,$D),n.bi_buf=0,n.bi_valid=0,Lr(n)},_tr_stored_block:AF,_tr_flush_block:(n,r,o,a)=>{let l,d,h=0;n.level>0?(2===n.strm.data_type&&(n.strm.data_type=(p=>{let m,g=4093624447;for(m=0;m<=31;m++,g>>>=1)if(1&g&&0!==p.dyn_ltree[2*m])return 0;if(0!==p.dyn_ltree[18]||0!==p.dyn_ltree[20]||0!==p.dyn_ltree[26])return 1;for(m=32;m<256;m++)if(0!==p.dyn_ltree[2*m])return 1;return 0})(n)),JD(n,n.l_desc),JD(n,n.d_desc),h=(p=>{let m;for(vt(p,p.dyn_ltree,p.l_desc.max_code),vt(p,p.dyn_dtree,p.d_desc.max_code),JD(p,p.bl_desc),m=18;m>=3&&0===p.bl_tree[2*qr[m]+1];m--);return p.opt_len+=3*(m+1)+5+5+4,m})(n),l=n.opt_len+3+7>>>3,d=n.static_len+3+7>>>3,d<=l&&(l=d)):l=d=o+5,o+4<=l&&-1!==r?AF(n,r,o,a):4===n.strategy||d===l?(hs(n,2+(a?1:0),3),Qf(n,Ll,Nv)):(hs(n,4+(a?1:0),3),((p,m,g,v)=>{let y;for(hs(p,m-257,5),hs(p,g-1,5),hs(p,v-4,4),y=0;y<v;y++)hs(p,p.bl_tree[2*qr[y]+1],3);Lv(p,p.dyn_ltree,m-1),Lv(p,p.dyn_dtree,g-1)})(n,n.l_desc.max_code+1,n.d_desc.max_code+1,h+1),Qf(n,n.dyn_ltree,n.dyn_dtree)),Lr(n),a&&ZD(n)},_tr_tally:(n,r,o)=>(n.pending_buf[n.sym_buf+n.sym_next++]=r,n.pending_buf[n.sym_buf+n.sym_next++]=r>>8,n.pending_buf[n.sym_buf+n.sym_next++]=o,0===r?n.dyn_ltree[2*o]++:(n.matches++,r--,n.dyn_ltree[2*(Mv[o]+256+1)]++,n.dyn_dtree[2*TF(r)]++),n.sym_next===n.sym_end),_tr_align:n=>{var r;hs(n,2,3),ja(n,256,Ll),16===(r=n).bi_valid?(kv(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)}},xv=(n,r,o,a)=>{let l=65535&n,d=n>>>16&65535,h=0;for(;0!==o;){h=o>2e3?2e3:o,o-=h;do{l=l+r[a++]|0,d=d+l|0}while(--h);l%=65521,d%=65521}return l|d<<16};const QD=new Uint32Array((()=>{let n,r=[];for(var o=0;o<256;o++){n=o;for(var a=0;a<8;a++)n=1&n?3988292384^n>>>1:n>>>1;r[o]=n}return r})());var Cr=(n,r,o,a)=>{const l=QD,d=a+o;n^=-1;for(let h=a;h<d;h++)n=n>>>8^l[255&(n^r[h])];return~n},xl={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},em={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:OF,_tr_stored_block:eO,_tr_flush_block:Yr,_tr_tally:Ha,_tr_align:i6}=n6,{Z_NO_FLUSH:oa,Z_PARTIAL_FLUSH:NF,Z_FULL_FLUSH:OC,Z_FINISH:Fi,Z_BLOCK:r6,Z_OK:$r,Z_STREAM_END:NC,Z_STREAM_ERROR:Ga,Z_DATA_ERROR:Nc,Z_BUF_ERROR:nr,Z_DEFAULT_COMPRESSION:PF,Z_FILTERED:Ns,Z_HUFFMAN_ONLY:Vh,Z_RLE:MF,Z_FIXED:o6,Z_DEFAULT_STRATEGY:Bh,Z_UNKNOWN:PC,Z_DEFLATED:ir}=em,sa=262,jh=(n,r)=>(n.msg=xl[r],r),Hh=n=>2*n-(n>4?9:0),Jd=n=>{let r=n.length;for(;--r>=0;)n[r]=0},l6=n=>{let r,o,a,l=n.w_size;r=n.hash_size,a=r;do{o=n.head[--a],n.head[a]=o>=l?o-l:0}while(--r);r=l,a=r;do{o=n.prev[--a],n.prev[a]=o>=l?o-l:0}while(--r)};let Xr=(n,r,o)=>(r<<n.hash_shift^o)&n.hash_mask;const jo=n=>{const r=n.state;let o=r.pending;o>n.avail_out&&(o=n.avail_out),0!==o&&(n.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+o),n.next_out),n.next_out+=o,r.pending_out+=o,n.total_out+=o,n.avail_out-=o,r.pending-=o,0===r.pending&&(r.pending_out=0))},ps=(n,r)=>{Yr(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,r),n.block_start=n.strstart,jo(n.strm)},In=(n,r)=>{n.pending_buf[n.pending++]=r},aa=(n,r)=>{n.pending_buf[n.pending++]=r>>>8&255,n.pending_buf[n.pending++]=255&r},nO=(n,r,o,a)=>{let l=n.avail_in;return l>a&&(l=a),0===l?0:(n.avail_in-=l,r.set(n.input.subarray(n.next_in,n.next_in+l),o),1===n.state.wrap?n.adler=xv(n.adler,r,l,o):2===n.state.wrap&&(n.adler=Cr(n.adler,r,l,o)),n.next_in+=l,n.total_in+=l,l)},iO=(n,r)=>{let o,a,l=n.max_chain_length,d=n.strstart,h=n.prev_length,p=n.nice_match;const m=n.strstart>n.w_size-sa?n.strstart-(n.w_size-sa):0,g=n.window,v=n.w_mask,y=n.prev,b=n.strstart+258;let C=g[d+h-1],N=g[d+h];n.prev_length>=n.good_match&&(l>>=2),p>n.lookahead&&(p=n.lookahead);do{if(o=r,g[o+h]===N&&g[o+h-1]===C&&g[o]===g[d]&&g[++o]===g[d+1]){d+=2,o++;do{}while(g[++d]===g[++o]&&g[++d]===g[++o]&&g[++d]===g[++o]&&g[++d]===g[++o]&&g[++d]===g[++o]&&g[++d]===g[++o]&&g[++d]===g[++o]&&g[++d]===g[++o]&&d<b);if(a=258-(b-d),d=b-258,a>h){if(n.match_start=r,h=a,a>=p)break;C=g[d+h-1],N=g[d+h]}}}while((r=y[r&v])>m&&0!=--l);return h<=n.lookahead?h:n.lookahead},Gh=n=>{const r=n.w_size;let o,a,l;do{if(a=n.window_size-n.lookahead-n.strstart,n.strstart>=r+(r-sa)&&(n.window.set(n.window.subarray(r,r+r-a),0),n.match_start-=r,n.strstart-=r,n.block_start-=r,n.insert>n.strstart&&(n.insert=n.strstart),l6(n),a+=r),0===n.strm.avail_in)break;if(o=nO(n.strm,n.window,n.strstart+n.lookahead,a),n.lookahead+=o,n.lookahead+n.insert>=3)for(l=n.strstart-n.insert,n.ins_h=n.window[l],n.ins_h=Xr(n,n.ins_h,n.window[l+1]);n.insert&&(n.ins_h=Xr(n,n.ins_h,n.window[l+3-1]),n.prev[l&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=l,l++,n.insert--,!(n.lookahead+n.insert<3)););}while(n.lookahead<sa&&0!==n.strm.avail_in)},kF=(n,r)=>{let o,a,l,d=n.pending_buf_size-5>n.w_size?n.w_size:n.pending_buf_size-5,h=0,p=n.strm.avail_in;do{if(o=65535,l=n.bi_valid+42>>3,n.strm.avail_out<l||(l=n.strm.avail_out-l,a=n.strstart-n.block_start,o>a+n.strm.avail_in&&(o=a+n.strm.avail_in),o>l&&(o=l),o<d&&(0===o&&r!==Fi||r===oa||o!==a+n.strm.avail_in)))break;h=r===Fi&&o===a+n.strm.avail_in?1:0,eO(n,0,0,h),n.pending_buf[n.pending-4]=o,n.pending_buf[n.pending-3]=o>>8,n.pending_buf[n.pending-2]=~o,n.pending_buf[n.pending-1]=~o>>8,jo(n.strm),a&&(a>o&&(a=o),n.strm.output.set(n.window.subarray(n.block_start,n.block_start+a),n.strm.next_out),n.strm.next_out+=a,n.strm.avail_out-=a,n.strm.total_out+=a,n.block_start+=a,o-=a),o&&(nO(n.strm,n.strm.output,n.strm.next_out,o),n.strm.next_out+=o,n.strm.avail_out-=o,n.strm.total_out+=o)}while(0===h);return p-=n.strm.avail_in,p&&(p>=n.w_size?(n.matches=2,n.window.set(n.strm.input.subarray(n.strm.next_in-n.w_size,n.strm.next_in),0),n.strstart=n.w_size,n.insert=n.strstart):(n.window_size-n.strstart<=p&&(n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,n.insert>n.strstart&&(n.insert=n.strstart)),n.window.set(n.strm.input.subarray(n.strm.next_in-p,n.strm.next_in),n.strstart),n.strstart+=p,n.insert+=p>n.w_size-n.insert?n.w_size-n.insert:p),n.block_start=n.strstart),n.high_water<n.strstart&&(n.high_water=n.strstart),h?4:r!==oa&&r!==Fi&&0===n.strm.avail_in&&n.strstart===n.block_start?2:(l=n.window_size-n.strstart,n.strm.avail_in>l&&n.block_start>=n.w_size&&(n.block_start-=n.w_size,n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,l+=n.w_size,n.insert>n.strstart&&(n.insert=n.strstart)),l>n.strm.avail_in&&(l=n.strm.avail_in),l&&(nO(n.strm,n.window,n.strstart,l),n.strstart+=l,n.insert+=l>n.w_size-n.insert?n.w_size-n.insert:l),n.high_water<n.strstart&&(n.high_water=n.strstart),l=n.bi_valid+42>>3,l=n.pending_buf_size-l>65535?65535:n.pending_buf_size-l,d=l>n.w_size?n.w_size:l,a=n.strstart-n.block_start,(a>=d||(a||r===Fi)&&r!==oa&&0===n.strm.avail_in&&a<=l)&&(o=a>l?l:a,h=r===Fi&&0===n.strm.avail_in&&o===a?1:0,eO(n,n.block_start,o,h),n.block_start+=o,jo(n.strm)),h?3:1)},MC=(n,r)=>{let o,a;for(;;){if(n.lookahead<sa){if(Gh(n),n.lookahead<sa&&r===oa)return 1;if(0===n.lookahead)break}if(o=0,n.lookahead>=3&&(n.ins_h=Xr(n,n.ins_h,n.window[n.strstart+3-1]),o=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),0!==o&&n.strstart-o<=n.w_size-sa&&(n.match_length=iO(n,o)),n.match_length>=3)if(a=Ha(n,n.strstart-n.match_start,n.match_length-3),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=3){n.match_length--;do{n.strstart++,n.ins_h=Xr(n,n.ins_h,n.window[n.strstart+3-1]),o=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart}while(0!=--n.match_length);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=Xr(n,n.ins_h,n.window[n.strstart+1]);else a=Ha(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(a&&(ps(n,!1),0===n.strm.avail_out))return 1}return n.insert=n.strstart<2?n.strstart:2,r===Fi?(ps(n,!0),0===n.strm.avail_out?3:4):n.sym_next&&(ps(n,!1),0===n.strm.avail_out)?1:2},tm=(n,r)=>{let o,a,l;for(;;){if(n.lookahead<sa){if(Gh(n),n.lookahead<sa&&r===oa)return 1;if(0===n.lookahead)break}if(o=0,n.lookahead>=3&&(n.ins_h=Xr(n,n.ins_h,n.window[n.strstart+3-1]),o=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=2,0!==o&&n.prev_length<n.max_lazy_match&&n.strstart-o<=n.w_size-sa&&(n.match_length=iO(n,o),n.match_length<=5&&(n.strategy===Ns||3===n.match_length&&n.strstart-n.match_start>4096)&&(n.match_length=2)),n.prev_length>=3&&n.match_length<=n.prev_length){l=n.strstart+n.lookahead-3,a=Ha(n,n.strstart-1-n.prev_match,n.prev_length-3),n.lookahead-=n.prev_length-1,n.prev_length-=2;do{++n.strstart<=l&&(n.ins_h=Xr(n,n.ins_h,n.window[n.strstart+3-1]),o=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart)}while(0!=--n.prev_length);if(n.match_available=0,n.match_length=2,n.strstart++,a&&(ps(n,!1),0===n.strm.avail_out))return 1}else if(n.match_available){if(a=Ha(n,0,n.window[n.strstart-1]),a&&ps(n,!1),n.strstart++,n.lookahead--,0===n.strm.avail_out)return 1}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(a=Ha(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<2?n.strstart:2,r===Fi?(ps(n,!0),0===n.strm.avail_out?3:4):n.sym_next&&(ps(n,!1),0===n.strm.avail_out)?1:2};function Wa(n,r,o,a,l){this.good_length=n,this.max_lazy=r,this.nice_length=o,this.max_chain=a,this.func=l}const nm=[new Wa(0,0,0,0,kF),new Wa(4,4,8,4,MC),new Wa(4,5,16,8,MC),new Wa(4,6,32,32,MC),new Wa(4,4,16,16,tm),new Wa(8,16,32,32,tm),new Wa(8,16,128,128,tm),new Wa(8,32,128,256,tm),new Wa(32,128,258,1024,tm),new Wa(32,258,258,4096,tm)];function kC(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ir,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Jd(this.dyn_ltree),Jd(this.dyn_dtree),Jd(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Jd(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Jd(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const za=n=>{if(!n)return 1;const r=n.state;return!r||r.strm!==n||42!==r.status&&57!==r.status&&69!==r.status&&73!==r.status&&91!==r.status&&103!==r.status&&113!==r.status&&666!==r.status?1:0},Kn=n=>{if(za(n))return jh(n,Ga);n.total_in=n.total_out=0,n.data_type=PC;const r=n.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=2===r.wrap?57:r.wrap?42:113,n.adler=2===r.wrap?0:1,r.last_flush=-2,OF(r),$r},im=n=>{const r=Kn(n);return r===$r&&((o=n.state).window_size=2*o.w_size,Jd(o.head),o.max_lazy_match=nm[o.level].max_lazy,o.good_match=nm[o.level].good_length,o.nice_match=nm[o.level].nice_length,o.max_chain_length=nm[o.level].max_chain,o.strstart=0,o.block_start=0,o.lookahead=0,o.insert=0,o.match_length=o.prev_length=2,o.match_available=0,o.ins_h=0),r;var o},LF=(n,r,o,a,l,d)=>{if(!n)return Ga;let h=1;if(r===PF&&(r=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),l<1||l>9||o!==ir||a<8||a>15||r<0||r>9||d<0||d>o6||8===a&&1!==h)return jh(n,Ga);8===a&&(a=9);const p=new kC;return n.state=p,p.strm=n,p.status=42,p.wrap=h,p.gzhead=null,p.w_bits=a,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=l+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<l+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.sym_buf=p.lit_bufsize,p.sym_end=3*(p.lit_bufsize-1),p.level=r,p.strategy=d,p.method=o,im(n)};var Pc={deflateInit:(n,r)=>LF(n,r,ir,15,8,Bh),deflateInit2:LF,deflateReset:im,deflateResetKeep:Kn,deflateSetHeader:(n,r)=>za(n)||2!==n.state.wrap?Ga:(n.state.gzhead=r,$r),deflate:(n,r)=>{if(za(n)||r>r6||r<0)return n?jh(n,Ga):Ga;const o=n.state;if(!n.output||0!==n.avail_in&&!n.input||666===o.status&&r!==Fi)return jh(n,0===n.avail_out?nr:Ga);const a=o.last_flush;if(o.last_flush=r,0!==o.pending){if(jo(n),0===n.avail_out)return o.last_flush=-1,$r}else if(0===n.avail_in&&Hh(r)<=Hh(a)&&r!==Fi)return jh(n,nr);if(666===o.status&&0!==n.avail_in)return jh(n,nr);if(42===o.status&&0===o.wrap&&(o.status=113),42===o.status){let l=ir+(o.w_bits-8<<4)<<8,d=-1;if(d=o.strategy>=Vh||o.level<2?0:o.level<6?1:6===o.level?2:3,l|=d<<6,0!==o.strstart&&(l|=32),l+=31-l%31,aa(o,l),0!==o.strstart&&(aa(o,n.adler>>>16),aa(o,65535&n.adler)),n.adler=1,o.status=113,jo(n),0!==o.pending)return o.last_flush=-1,$r}if(57===o.status)if(n.adler=0,In(o,31),In(o,139),In(o,8),o.gzhead)In(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),In(o,255&o.gzhead.time),In(o,o.gzhead.time>>8&255),In(o,o.gzhead.time>>16&255),In(o,o.gzhead.time>>24&255),In(o,9===o.level?2:o.strategy>=Vh||o.level<2?4:0),In(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(In(o,255&o.gzhead.extra.length),In(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(n.adler=Cr(n.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=69;else if(In(o,0),In(o,0),In(o,0),In(o,0),In(o,0),In(o,9===o.level?2:o.strategy>=Vh||o.level<2?4:0),In(o,3),o.status=113,jo(n),0!==o.pending)return o.last_flush=-1,$r;if(69===o.status){if(o.gzhead.extra){let l=o.pending,d=(65535&o.gzhead.extra.length)-o.gzindex;for(;o.pending+d>o.pending_buf_size;){let p=o.pending_buf_size-o.pending;if(o.pending_buf.set(o.gzhead.extra.subarray(o.gzindex,o.gzindex+p),o.pending),o.pending=o.pending_buf_size,o.gzhead.hcrc&&o.pending>l&&(n.adler=Cr(n.adler,o.pending_buf,o.pending-l,l)),o.gzindex+=p,jo(n),0!==o.pending)return o.last_flush=-1,$r;l=0,d-=p}let h=new Uint8Array(o.gzhead.extra);o.pending_buf.set(h.subarray(o.gzindex,o.gzindex+d),o.pending),o.pending+=d,o.gzhead.hcrc&&o.pending>l&&(n.adler=Cr(n.adler,o.pending_buf,o.pending-l,l)),o.gzindex=0}o.status=73}if(73===o.status){if(o.gzhead.name){let l,d=o.pending;do{if(o.pending===o.pending_buf_size){if(o.gzhead.hcrc&&o.pending>d&&(n.adler=Cr(n.adler,o.pending_buf,o.pending-d,d)),jo(n),0!==o.pending)return o.last_flush=-1,$r;d=0}l=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,In(o,l)}while(0!==l);o.gzhead.hcrc&&o.pending>d&&(n.adler=Cr(n.adler,o.pending_buf,o.pending-d,d)),o.gzindex=0}o.status=91}if(91===o.status){if(o.gzhead.comment){let l,d=o.pending;do{if(o.pending===o.pending_buf_size){if(o.gzhead.hcrc&&o.pending>d&&(n.adler=Cr(n.adler,o.pending_buf,o.pending-d,d)),jo(n),0!==o.pending)return o.last_flush=-1,$r;d=0}l=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,In(o,l)}while(0!==l);o.gzhead.hcrc&&o.pending>d&&(n.adler=Cr(n.adler,o.pending_buf,o.pending-d,d))}o.status=103}if(103===o.status){if(o.gzhead.hcrc){if(o.pending+2>o.pending_buf_size&&(jo(n),0!==o.pending))return o.last_flush=-1,$r;In(o,255&n.adler),In(o,n.adler>>8&255),n.adler=0}if(o.status=113,jo(n),0!==o.pending)return o.last_flush=-1,$r}if(0!==n.avail_in||0!==o.lookahead||r!==oa&&666!==o.status){let l=0===o.level?kF(o,r):o.strategy===Vh?((d,h)=>{let p;for(;;){if(0===d.lookahead&&(Gh(d),0===d.lookahead)){if(h===oa)return 1;break}if(d.match_length=0,p=Ha(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,p&&(ps(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,h===Fi?(ps(d,!0),0===d.strm.avail_out?3:4):d.sym_next&&(ps(d,!1),0===d.strm.avail_out)?1:2})(o,r):o.strategy===MF?((d,h)=>{let p,m,g,v;const y=d.window;for(;;){if(d.lookahead<=258){if(Gh(d),d.lookahead<=258&&h===oa)return 1;if(0===d.lookahead)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(g=d.strstart-1,m=y[g],m===y[++g]&&m===y[++g]&&m===y[++g])){v=d.strstart+258;do{}while(m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&m===y[++g]&&g<v);d.match_length=258-(v-g),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(p=Ha(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(p=Ha(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),p&&(ps(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,h===Fi?(ps(d,!0),0===d.strm.avail_out?3:4):d.sym_next&&(ps(d,!1),0===d.strm.avail_out)?1:2})(o,r):nm[o.level].func(o,r);if(3!==l&&4!==l||(o.status=666),1===l||3===l)return 0===n.avail_out&&(o.last_flush=-1),$r;if(2===l&&(r===NF?i6(o):r!==r6&&(eO(o,0,0,!1),r===OC&&(Jd(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),jo(n),0===n.avail_out))return o.last_flush=-1,$r}return r!==Fi?$r:o.wrap<=0?NC:(2===o.wrap?(In(o,255&n.adler),In(o,n.adler>>8&255),In(o,n.adler>>16&255),In(o,n.adler>>24&255),In(o,255&n.total_in),In(o,n.total_in>>8&255),In(o,n.total_in>>16&255),In(o,n.total_in>>24&255)):(aa(o,n.adler>>>16),aa(o,65535&n.adler)),jo(n),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?$r:NC)},deflateEnd:n=>{if(za(n))return Ga;const r=n.state.status;return n.state=null,113===r?jh(n,Nc):$r},deflateSetDictionary:(n,r)=>{let o=r.length;if(za(n))return Ga;const a=n.state,l=a.wrap;if(2===l||1===l&&42!==a.status||a.lookahead)return Ga;if(1===l&&(n.adler=xv(n.adler,r,o,0)),a.wrap=0,o>=a.w_size){0===l&&(Jd(a.head),a.strstart=0,a.block_start=0,a.insert=0);let m=new Uint8Array(a.w_size);m.set(r.subarray(o-a.w_size,o),0),r=m,o=a.w_size}const d=n.avail_in,h=n.next_in,p=n.input;for(n.avail_in=o,n.next_in=0,n.input=r,Gh(a);a.lookahead>=3;){let m=a.strstart,g=a.lookahead-2;do{a.ins_h=Xr(a,a.ins_h,a.window[m+3-1]),a.prev[m&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=m,m++}while(--g);a.strstart=m,a.lookahead=2,Gh(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,n.next_in=h,n.input=p,n.avail_in=d,a.wrap=l,$r},deflateInfo:"pako deflate (from Nodeca project)"};const LC=(n,r)=>Object.prototype.hasOwnProperty.call(n,r);var xC={assign:function(n){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const o=r.shift();if(o){if("object"!=typeof o)throw new TypeError(o+"must be non-object");for(const a in o)LC(o,a)&&(n[a]=o[a])}}return n},flattenChunks:n=>{let r=0;for(let a=0,l=n.length;a<l;a++)r+=n[a].length;const o=new Uint8Array(r);for(let a=0,l=0,d=n.length;a<d;a++){let h=n[a];o.set(h,l),l+=h.length}return o}};let Fv=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Fv=!1}const Ul=new Uint8Array(256);for(let n=0;n<256;n++)Ul[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;Ul[254]=Ul[254]=1;var rm={string2buf:n=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(n);let r,o,a,l,d,h=n.length,p=0;for(l=0;l<h;l++)o=n.charCodeAt(l),55296==(64512&o)&&l+1<h&&(a=n.charCodeAt(l+1),56320==(64512&a)&&(o=65536+(o-55296<<10)+(a-56320),l++)),p+=o<128?1:o<2048?2:o<65536?3:4;for(r=new Uint8Array(p),d=0,l=0;d<p;l++)o=n.charCodeAt(l),55296==(64512&o)&&l+1<h&&(a=n.charCodeAt(l+1),56320==(64512&a)&&(o=65536+(o-55296<<10)+(a-56320),l++)),o<128?r[d++]=o:o<2048?(r[d++]=192|o>>>6,r[d++]=128|63&o):o<65536?(r[d++]=224|o>>>12,r[d++]=128|o>>>6&63,r[d++]=128|63&o):(r[d++]=240|o>>>18,r[d++]=128|o>>>12&63,r[d++]=128|o>>>6&63,r[d++]=128|63&o);return r},buf2string:(n,r)=>{const o=r||n.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(n.subarray(0,r));let a,l;const d=new Array(2*o);for(l=0,a=0;a<o;){let h=n[a++];if(h<128){d[l++]=h;continue}let p=Ul[h];if(p>4)d[l++]=65533,a+=p-1;else{for(h&=2===p?31:3===p?15:7;p>1&&a<o;)h=h<<6|63&n[a++],p--;p>1?d[l++]=65533:h<65536?d[l++]=h:(h-=65536,d[l++]=55296|h>>10&1023,d[l++]=56320|1023&h)}}return((h,p)=>{if(p<65534&&h.subarray&&Fv)return String.fromCharCode.apply(null,h.length===p?h:h.subarray(0,p));let m="";for(let g=0;g<p;g++)m+=String.fromCharCode(h[g]);return m})(d,l)},utf8border:(n,r)=>{(r=r||n.length)>n.length&&(r=n.length);let o=r-1;for(;o>=0&&128==(192&n[o]);)o--;return o<0||0===o?r:o+Ul[n[o]]>r?o:r}},Uv=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const xF=Object.prototype.toString,{Z_NO_FLUSH:rO,Z_SYNC_FLUSH:FC,Z_FULL_FLUSH:FF,Z_FINISH:UF,Z_OK:UC,Z_STREAM_END:u6,Z_DEFAULT_COMPRESSION:h6,Z_DEFAULT_STRATEGY:oO,Z_DEFLATED:p6}=em;function Vv(n){this.options=xC.assign({level:h6,method:p6,chunkSize:16384,windowBits:15,memLevel:8,strategy:oO},n||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Uv,this.strm.avail_out=0;let o=Pc.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(o!==UC)throw new Error(xl[o]);if(r.header&&Pc.deflateSetHeader(this.strm,r.header),r.dictionary){let a;if(a="string"==typeof r.dictionary?rm.string2buf(r.dictionary):"[object ArrayBuffer]"===xF.call(r.dictionary)?new Uint8Array(r.dictionary):r.dictionary,o=Pc.deflateSetDictionary(this.strm,a),o!==UC)throw new Error(xl[o]);this._dict_set=!0}}function sO(n,r){const o=new Vv(r);if(o.push(n,!0),o.err)throw o.msg||xl[o.err];return o.result}Vv.prototype.push=function(n,r){const o=this.strm,a=this.options.chunkSize;let l,d;if(this.ended)return!1;for(d=r===~~r?r:!0===r?UF:rO,o.input="string"==typeof n?rm.string2buf(n):"[object ArrayBuffer]"===xF.call(n)?new Uint8Array(n):n,o.next_in=0,o.avail_in=o.input.length;;)if(0===o.avail_out&&(o.output=new Uint8Array(a),o.next_out=0,o.avail_out=a),(d===FC||d===FF)&&o.avail_out<=6)this.onData(o.output.subarray(0,o.next_out)),o.avail_out=0;else{if(l=Pc.deflate(o,d),l===u6)return o.next_out>0&&this.onData(o.output.subarray(0,o.next_out)),l=Pc.deflateEnd(this.strm),this.onEnd(l),this.ended=!0,l===UC;if(0!==o.avail_out){if(d>0&&o.next_out>0)this.onData(o.output.subarray(0,o.next_out)),o.avail_out=0;else if(0===o.avail_in)break}else this.onData(o.output)}return!0},Vv.prototype.onData=function(n){this.chunks.push(n)},Vv.prototype.onEnd=function(n){n===UC&&(this.result=xC.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var f6={Deflate:Vv,deflate:sO,deflateRaw:function(n,r){return(r=r||{}).raw=!0,sO(n,r)},gzip:function(n,r){return(r=r||{}).gzip=!0,sO(n,r)},constants:em};const VC=16209;var m6=function(n,r){let o,a,l,d,h,p,m,g,v,y,b,C,N,R,A,D,M,x,j,W,q,ee,J,X;const Ce=n.state;o=n.next_in,J=n.input,a=o+(n.avail_in-5),l=n.next_out,X=n.output,d=l-(r-n.avail_out),h=l+(n.avail_out-257),p=Ce.dmax,m=Ce.wsize,g=Ce.whave,v=Ce.wnext,y=Ce.window,b=Ce.hold,C=Ce.bits,N=Ce.lencode,R=Ce.distcode,A=(1<<Ce.lenbits)-1,D=(1<<Ce.distbits)-1;e:do{C<15&&(b+=J[o++]<<C,C+=8,b+=J[o++]<<C,C+=8),M=N[b&A];t:for(;;){if(x=M>>>24,b>>>=x,C-=x,x=M>>>16&255,0===x)X[l++]=65535&M;else{if(!(16&x)){if(!(64&x)){M=N[(65535&M)+(b&(1<<x)-1)];continue t}if(32&x){Ce.mode=16191;break e}n.msg="invalid literal/length code",Ce.mode=VC;break e}j=65535&M,x&=15,x&&(C<x&&(b+=J[o++]<<C,C+=8),j+=b&(1<<x)-1,b>>>=x,C-=x),C<15&&(b+=J[o++]<<C,C+=8,b+=J[o++]<<C,C+=8),M=R[b&D];n:for(;;){if(x=M>>>24,b>>>=x,C-=x,x=M>>>16&255,!(16&x)){if(!(64&x)){M=R[(65535&M)+(b&(1<<x)-1)];continue n}n.msg="invalid distance code",Ce.mode=VC;break e}if(W=65535&M,x&=15,C<x&&(b+=J[o++]<<C,C+=8,C<x&&(b+=J[o++]<<C,C+=8)),W+=b&(1<<x)-1,W>p){n.msg="invalid distance too far back",Ce.mode=VC;break e}if(b>>>=x,C-=x,x=l-d,W>x){if(x=W-x,x>g&&Ce.sane){n.msg="invalid distance too far back",Ce.mode=VC;break e}if(q=0,ee=y,0===v){if(q+=m-x,x<j){j-=x;do{X[l++]=y[q++]}while(--x);q=l-W,ee=X}}else if(v<x){if(q+=m+v-x,x-=v,x<j){j-=x;do{X[l++]=y[q++]}while(--x);if(q=0,v<j){x=v,j-=x;do{X[l++]=y[q++]}while(--x);q=l-W,ee=X}}}else if(q+=v-x,x<j){j-=x;do{X[l++]=y[q++]}while(--x);q=l-W,ee=X}for(;j>2;)X[l++]=ee[q++],X[l++]=ee[q++],X[l++]=ee[q++],j-=3;j&&(X[l++]=ee[q++],j>1&&(X[l++]=ee[q++]))}else{q=l-W;do{X[l++]=X[q++],X[l++]=X[q++],X[l++]=X[q++],j-=3}while(j>2);j&&(X[l++]=X[q++],j>1&&(X[l++]=X[q++]))}break}}break}}while(o<a&&l<h);j=C>>3,o-=j,C-=j<<3,b&=(1<<C)-1,n.next_in=o,n.next_out=l,n.avail_in=o<a?a-o+5:5-(o-a),n.avail_out=l<h?h-l+257:257-(l-h),Ce.hold=b,Ce.bits=C};const VF=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),BF=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),g6=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),zh=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Bv=(n,r,o,a,l,d,h,p)=>{const m=p.bits;let g,v,y,b,C,N,R=0,A=0,D=0,M=0,x=0,j=0,W=0,q=0,ee=0,J=0,X=null;const Ce=new Uint16Array(16),Re=new Uint16Array(16);let ut,Nt,_n,Zt=null;for(R=0;R<=15;R++)Ce[R]=0;for(A=0;A<a;A++)Ce[r[o+A]]++;for(x=m,M=15;M>=1&&0===Ce[M];M--);if(x>M&&(x=M),0===M)return l[d++]=20971520,l[d++]=20971520,p.bits=1,0;for(D=1;D<M&&0===Ce[D];D++);for(x<D&&(x=D),q=1,R=1;R<=15;R++)if(q<<=1,q-=Ce[R],q<0)return-1;if(q>0&&(0===n||1!==M))return-1;for(Re[1]=0,R=1;R<15;R++)Re[R+1]=Re[R]+Ce[R];for(A=0;A<a;A++)0!==r[o+A]&&(h[Re[r[o+A]]++]=A);if(0===n?(X=Zt=h,N=20):1===n?(X=VF,Zt=BF,N=257):(X=g6,Zt=zh,N=0),J=0,A=0,R=D,C=d,j=x,W=0,y=-1,ee=1<<x,b=ee-1,1===n&&ee>852||2===n&&ee>592)return 1;for(;;){ut=R-W,h[A]+1<N?(Nt=0,_n=h[A]):h[A]>=N?(Nt=Zt[h[A]-N],_n=X[h[A]-N]):(Nt=96,_n=0),g=1<<R-W,v=1<<j,D=v;do{v-=g,l[C+(J>>W)+v]=ut<<24|Nt<<16|_n}while(0!==v);for(g=1<<R-1;J&g;)g>>=1;if(0!==g?(J&=g-1,J+=g):J=0,A++,0==--Ce[R]){if(R===M)break;R=r[o+h[A]]}if(R>x&&(J&b)!==y){for(0===W&&(W=x),C+=D,j=R-W,q=1<<j;j+W<M&&(q-=Ce[j+W],!(q<=0));)j++,q<<=1;if(ee+=1<<j,1===n&&ee>852||2===n&&ee>592)return 1;y=J&b,l[y]=x<<24|j<<16|C-d}}return 0!==J&&(l[C+J]=R-W<<24|64<<16),p.bits=x,0};const{Z_FINISH:aO,Z_BLOCK:jF,Z_TREES:Kh,Z_OK:Ka,Z_STREAM_END:cO,Z_NEED_DICT:HF,Z_STREAM_ERROR:Ps,Z_DATA_ERROR:GF,Z_MEM_ERROR:jv,Z_BUF_ERROR:_6,Z_DEFLATED:WF}=em,jC=16180,Hv=16190,Ms=16191,HC=16199,Wv=16200,Qn=16209,Qt=n=>(n>>>24&255)+(n>>>8&65280)+((65280&n)<<8)+((255&n)<<24);function Mc(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Vl=n=>{if(!n)return 1;const r=n.state;return!r||r.strm!==n||r.mode<jC||r.mode>16211?1:0},Qd=n=>{if(Vl(n))return Ps;const r=n.state;return n.total_in=n.total_out=r.total=0,n.msg="",r.wrap&&(n.adler=1&r.wrap),r.mode=jC,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,Ka},fs=n=>{if(Vl(n))return Ps;const r=n.state;return r.wsize=0,r.whave=0,r.wnext=0,Qd(n)},WC=(n,r)=>{let o;if(Vl(n))return Ps;const a=n.state;return r<0?(o=0,r=-r):(o=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Ps:(null!==a.window&&a.wbits!==r&&(a.window=null),a.wrap=o,a.wbits=r,fs(n))},eu=(n,r)=>{if(!n)return Ps;const o=new Mc;n.state=o,o.strm=n,o.window=null,o.mode=jC;const a=WC(n,r);return a!==Ka&&(n.state=null),a};let qh,zv,dO=!0;const v6=n=>{if(dO){qh=new Int32Array(512),zv=new Int32Array(32);let r=0;for(;r<144;)n.lens[r++]=8;for(;r<256;)n.lens[r++]=9;for(;r<280;)n.lens[r++]=7;for(;r<288;)n.lens[r++]=8;for(Bv(1,n.lens,0,288,qh,0,n.work,{bits:9}),r=0;r<32;)n.lens[r++]=5;Bv(2,n.lens,0,32,zv,0,n.work,{bits:5}),dO=!1}n.lencode=qh,n.lenbits=9,n.distcode=zv,n.distbits=5},zF=(n,r,o,a)=>{let l;const d=n.state;return null===d.window&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),a>=d.wsize?(d.window.set(r.subarray(o-d.wsize,o),0),d.wnext=0,d.whave=d.wsize):(l=d.wsize-d.wnext,l>a&&(l=a),d.window.set(r.subarray(o-a,o-a+l),d.wnext),(a-=l)?(d.window.set(r.subarray(o-a,o),0),d.wnext=a,d.whave=d.wsize):(d.wnext+=l,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=l))),0};var Bl={inflateReset:fs,inflateReset2:WC,inflateResetKeep:Qd,inflateInit:n=>eu(n,15),inflateInit2:eu,inflate:(n,r)=>{let o,a,l,d,h,p,m,g,v,y,b,C,N,R,A,D,M,x,j,W,q,ee,J=0;const X=new Uint8Array(4);let Ce,Re;const ut=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Vl(n)||!n.output||!n.input&&0!==n.avail_in)return Ps;o=n.state,o.mode===Ms&&(o.mode=16192),h=n.next_out,l=n.output,m=n.avail_out,d=n.next_in,a=n.input,p=n.avail_in,g=o.hold,v=o.bits,y=p,b=m,ee=Ka;e:for(;;)switch(o.mode){case jC:if(0===o.wrap){o.mode=16192;break}for(;v<16;){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}if(2&o.wrap&&35615===g){0===o.wbits&&(o.wbits=15),o.check=0,X[0]=255&g,X[1]=g>>>8&255,o.check=Cr(o.check,X,2,0),g=0,v=0,o.mode=16181;break}if(o.head&&(o.head.done=!1),!(1&o.wrap)||(((255&g)<<8)+(g>>8))%31){n.msg="incorrect header check",o.mode=Qn;break}if((15&g)!==WF){n.msg="unknown compression method",o.mode=Qn;break}if(g>>>=4,v-=4,q=8+(15&g),0===o.wbits&&(o.wbits=q),q>15||q>o.wbits){n.msg="invalid window size",o.mode=Qn;break}o.dmax=1<<o.wbits,o.flags=0,n.adler=o.check=1,o.mode=512&g?16189:Ms,g=0,v=0;break;case 16181:for(;v<16;){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}if(o.flags=g,(255&fr(o))!==WF){n.msg="unknown compression method",o.mode=Qn;break}if(57344&fr(o)){n.msg="unknown header flags set",o.mode=Qn;break}o.head&&(o.head.text=g>>8&1),512&fr(o)&&4&o.wrap&&(X[0]=255&g,X[1]=g>>>8&255,o.check=Cr(o.check,X,2,0)),g=0,v=0,o.mode=16182;case 16182:for(;v<32;){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}o.head&&(o.head.time=g),512&fr(o)&&4&o.wrap&&(X[0]=255&g,X[1]=g>>>8&255,X[2]=g>>>16&255,X[3]=g>>>24&255,o.check=Cr(o.check,X,4,0)),g=0,v=0,o.mode=16183;case 16183:for(;v<16;){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}o.head&&(o.head.xflags=255&g,o.head.os=g>>8),512&fr(o)&&4&o.wrap&&(X[0]=255&g,X[1]=g>>>8&255,o.check=Cr(o.check,X,2,0)),g=0,v=0,o.mode=16184;case 16184:if(1024&fr(o)){for(;v<16;){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}o.length=g,o.head&&(o.head.extra_len=g),512&fr(o)&&4&o.wrap&&(X[0]=255&g,X[1]=g>>>8&255,o.check=Cr(o.check,X,2,0)),g=0,v=0}else o.head&&(o.head.extra=null);o.mode=16185;case 16185:if(1024&fr(o)&&(C=o.length,C>p&&(C=p),C&&(o.head&&(q=o.head.extra_len-o.length,o.head.extra||(o.head.extra=new Uint8Array(o.head.extra_len)),o.head.extra.set(a.subarray(d,d+C),q)),512&fr(o)&&4&o.wrap&&(o.check=Cr(o.check,a,C,d)),p-=C,d+=C,o.length-=C),o.length))break e;o.length=0,o.mode=16186;case 16186:if(2048&fr(o)){if(0===p)break e;C=0;do{q=a[d+C++],o.head&&q&&o.length<65536&&(o.head.name+=String.fromCharCode(q))}while(q&&C<p);if(512&fr(o)&&4&o.wrap&&(o.check=Cr(o.check,a,C,d)),p-=C,d+=C,q)break e}else o.head&&(o.head.name=null);o.length=0,o.mode=16187;case 16187:if(4096&fr(o)){if(0===p)break e;C=0;do{q=a[d+C++],o.head&&q&&o.length<65536&&(o.head.comment+=String.fromCharCode(q))}while(q&&C<p);if(512&fr(o)&&4&o.wrap&&(o.check=Cr(o.check,a,C,d)),p-=C,d+=C,q)break e}else o.head&&(o.head.comment=null);o.mode=16188;case 16188:if(512&fr(o)){for(;v<16;){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}if(4&o.wrap&&g!==(65535&o.check)){n.msg="header crc mismatch",o.mode=Qn;break}g=0,v=0}o.head&&(o.head.hcrc=fr(o)>>9&1,o.head.done=!0),n.adler=o.check=0,o.mode=Ms;break;case 16189:for(;v<32;){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}n.adler=o.check=Qt(g),g=0,v=0,o.mode=Hv;case Hv:if(0===o.havedict)return n.next_out=h,n.avail_out=m,n.next_in=d,n.avail_in=p,o.hold=g,o.bits=v,HF;n.adler=o.check=1,o.mode=Ms;case Ms:if(r===jF||r===Kh)break e;case 16192:if(o.last){g>>>=7&v,v-=7&v,o.mode=16206;break}for(;v<3;){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}switch(o.last=1&g,g>>>=1,v-=1,3&g){case 0:o.mode=16193;break;case 1:if(v6(o),o.mode=HC,r===Kh){g>>>=2,v-=2;break e}break;case 2:o.mode=16196;break;case 3:n.msg="invalid block type",o.mode=Qn}g>>>=2,v-=2;break;case 16193:for(g>>>=7&v,v-=7&v;v<32;){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}if((65535&g)!=(g>>>16^65535)){n.msg="invalid stored block lengths",o.mode=Qn;break}if(o.length=65535&g,g=0,v=0,o.mode=16194,r===Kh)break e;case 16194:o.mode=16195;case 16195:if(C=o.length,C){if(C>p&&(C=p),C>m&&(C=m),0===C)break e;l.set(a.subarray(d,d+C),h),p-=C,d+=C,m-=C,h+=C,o.length-=C;break}o.mode=Ms;break;case 16196:for(;v<14;){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}if(o.nlen=257+(31&g),g>>>=5,v-=5,o.ndist=1+(31&g),g>>>=5,v-=5,o.ncode=4+(15&g),g>>>=4,v-=4,o.nlen>286||o.ndist>30){n.msg="too many length or distance symbols",o.mode=Qn;break}o.have=0,o.mode=16197;case 16197:for(;o.have<o.ncode;){for(;v<3;){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}o.lens[ut[o.have++]]=7&g,g>>>=3,v-=3}for(;o.have<19;)o.lens[ut[o.have++]]=0;if(o.lencode=o.lendyn,o.lenbits=7,Ce={bits:o.lenbits},ee=Bv(0,o.lens,0,19,o.lencode,0,o.work,Ce),o.lenbits=Ce.bits,ee){n.msg="invalid code lengths set",o.mode=Qn;break}o.have=0,o.mode=16198;case 16198:for(;o.have<o.nlen+o.ndist;){for(;J=o.lencode[g&(1<<o.lenbits)-1],A=J>>>24,D=J>>>16&255,M=65535&J,!(A<=v);){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}if(M<16)g>>>=A,v-=A,o.lens[o.have++]=M;else{if(16===M){for(Re=A+2;v<Re;){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}if(g>>>=A,v-=A,0===o.have){n.msg="invalid bit length repeat",o.mode=Qn;break}q=o.lens[o.have-1],C=3+(3&g),g>>>=2,v-=2}else if(17===M){for(Re=A+3;v<Re;){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}g>>>=A,v-=A,q=0,C=3+(7&g),g>>>=3,v-=3}else{for(Re=A+7;v<Re;){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}g>>>=A,v-=A,q=0,C=11+(127&g),g>>>=7,v-=7}if(o.have+C>o.nlen+o.ndist){n.msg="invalid bit length repeat",o.mode=Qn;break}for(;C--;)o.lens[o.have++]=q}}if(o.mode===Qn)break;if(0===o.lens[256]){n.msg="invalid code -- missing end-of-block",o.mode=Qn;break}if(o.lenbits=9,Ce={bits:o.lenbits},ee=Bv(1,o.lens,0,o.nlen,o.lencode,0,o.work,Ce),o.lenbits=Ce.bits,ee){n.msg="invalid literal/lengths set",o.mode=Qn;break}if(o.distbits=6,o.distcode=o.distdyn,Ce={bits:o.distbits},ee=Bv(2,o.lens,o.nlen,o.ndist,o.distcode,0,o.work,Ce),o.distbits=Ce.bits,ee){n.msg="invalid distances set",o.mode=Qn;break}if(o.mode=HC,r===Kh)break e;case HC:o.mode=Wv;case Wv:if(p>=6&&m>=258){n.next_out=h,n.avail_out=m,n.next_in=d,n.avail_in=p,o.hold=g,o.bits=v,m6(n,b),h=n.next_out,l=n.output,m=n.avail_out,d=n.next_in,a=n.input,p=n.avail_in,g=o.hold,v=o.bits,o.mode===Ms&&(o.back=-1);break}for(o.back=0;J=o.lencode[g&(1<<o.lenbits)-1],A=J>>>24,D=J>>>16&255,M=65535&J,!(A<=v);){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}if(D&&!(240&D)){for(x=A,j=D,W=M;J=o.lencode[W+((g&(1<<x+j)-1)>>x)],A=J>>>24,D=J>>>16&255,M=65535&J,!(x+A<=v);){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}g>>>=x,v-=x,o.back+=x}if(g>>>=A,v-=A,o.back+=A,o.length=M,0===D){o.mode=16205;break}if(32&D){o.back=-1,o.mode=Ms;break}if(64&D){n.msg="invalid literal/length code",o.mode=Qn;break}o.extra=15&D,o.mode=16201;case 16201:if(o.extra){for(Re=o.extra;v<Re;){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}o.length+=g&(1<<o.extra)-1,g>>>=o.extra,v-=o.extra,o.back+=o.extra}o.was=o.length,o.mode=16202;case 16202:for(;J=o.distcode[g&(1<<o.distbits)-1],A=J>>>24,D=J>>>16&255,M=65535&J,!(A<=v);){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}if(!(240&D)){for(x=A,j=D,W=M;J=o.distcode[W+((g&(1<<x+j)-1)>>x)],A=J>>>24,D=J>>>16&255,M=65535&J,!(x+A<=v);){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}g>>>=x,v-=x,o.back+=x}if(g>>>=A,v-=A,o.back+=A,64&D){n.msg="invalid distance code",o.mode=Qn;break}o.offset=M,o.extra=15&D,o.mode=16203;case 16203:if(o.extra){for(Re=o.extra;v<Re;){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}o.offset+=g&(1<<o.extra)-1,g>>>=o.extra,v-=o.extra,o.back+=o.extra}if(o.offset>o.dmax){n.msg="invalid distance too far back",o.mode=Qn;break}o.mode=16204;case 16204:if(0===m)break e;if(C=b-m,o.offset>C){if(C=o.offset-C,C>o.whave&&o.sane){n.msg="invalid distance too far back",o.mode=Qn;break}C>o.wnext?(C-=o.wnext,N=o.wsize-C):N=o.wnext-C,C>o.length&&(C=o.length),R=o.window}else R=l,N=h-o.offset,C=o.length;C>m&&(C=m),m-=C,o.length-=C;do{l[h++]=R[N++]}while(--C);0===o.length&&(o.mode=Wv);break;case 16205:if(0===m)break e;l[h++]=o.length,m--,o.mode=Wv;break;case 16206:if(o.wrap){for(;v<32;){if(0===p)break e;p--,g|=a[d++]<<v,v+=8}if(b-=m,n.total_out+=b,o.total+=b,4&o.wrap&&b&&(n.adler=o.check=fr(o)?Cr(o.check,l,b,h-b):xv(o.check,l,b,h-b)),b=m,4&o.wrap&&(fr(o)?g:Qt(g))!==o.check){n.msg="incorrect data check",o.mode=Qn;break}g=0,v=0}o.mode=16207;case 16207:if(o.wrap&&fr(o)){for(;v<32;){if(0===p)break e;p--,g+=a[d++]<<v,v+=8}if(4&o.wrap&&g!==(4294967295&o.total)){n.msg="incorrect length check",o.mode=Qn;break}g=0,v=0}o.mode=16208;case 16208:ee=cO;break e;case Qn:ee=GF;break e;case 16210:return jv;default:return Ps}return n.next_out=h,n.avail_out=m,n.next_in=d,n.avail_in=p,o.hold=g,o.bits=v,(o.wsize||b!==n.avail_out&&o.mode<Qn&&(o.mode<16206||r!==aO))&&zF(n,n.output,n.next_out,b-n.avail_out),y-=n.avail_in,b-=n.avail_out,n.total_in+=y,n.total_out+=b,o.total+=b,4&o.wrap&&b&&(n.adler=o.check=fr(o)?Cr(o.check,l,b,n.next_out-b):xv(o.check,l,b,n.next_out-b)),n.data_type=o.bits+(o.last?64:0)+(o.mode===Ms?128:0)+(o.mode===HC||16194===o.mode?256:0),(0===y&&0===b||r===aO)&&ee===Ka&&(ee=_6),ee},inflateEnd:n=>{if(Vl(n))return Ps;let r=n.state;return r.window&&(r.window=null),n.state=null,Ka},inflateGetHeader:(n,r)=>{if(Vl(n))return Ps;const o=n.state;return 2&o.wrap?(o.head=r,r.done=!1,Ka):Ps},inflateSetDictionary:(n,r)=>{const o=r.length;let a,l,d;return Vl(n)?Ps:(a=n.state,0!==a.wrap&&a.mode!==Hv?Ps:a.mode===Hv&&(l=1,l=xv(l,r,o,0),l!==a.check)?GF:(d=zF(n,r,o,o),d?(a.mode=16210,jv):(a.havedict=1,Ka)))},inflateInfo:"pako inflate (from Nodeca project)"},y6=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const KF=Object.prototype.toString,{Z_NO_FLUSH:b6,Z_FINISH:S6,Z_OK:Kv,Z_STREAM_END:uO,Z_NEED_DICT:qF,Z_STREAM_ERROR:hO,Z_DATA_ERROR:qv,Z_MEM_ERROR:ez}=em;function Yv(n){this.options=xC.assign({chunkSize:65536,windowBits:15,to:""},n||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,0===r.windowBits&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||n&&n.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&!(15&r.windowBits)&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Uv,this.strm.avail_out=0;let o=Bl.inflateInit2(this.strm,r.windowBits);if(o!==Kv)throw new Error(xl[o]);if(this.header=new y6,Bl.inflateGetHeader(this.strm,this.header),r.dictionary&&("string"==typeof r.dictionary?r.dictionary=rm.string2buf(r.dictionary):"[object ArrayBuffer]"===KF.call(r.dictionary)&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(o=Bl.inflateSetDictionary(this.strm,r.dictionary),o!==Kv)))throw new Error(xl[o])}function YF(n,r){const o=new Yv(r);if(o.push(n),o.err)throw o.msg||xl[o.err];return o.result}Yv.prototype.push=function(n,r){const o=this.strm,a=this.options.chunkSize,l=this.options.dictionary;let d,h,p;if(this.ended)return!1;for(h=r===~~r?r:!0===r?S6:b6,o.input="[object ArrayBuffer]"===KF.call(n)?new Uint8Array(n):n,o.next_in=0,o.avail_in=o.input.length;;){for(0===o.avail_out&&(o.output=new Uint8Array(a),o.next_out=0,o.avail_out=a),d=Bl.inflate(o,h),d===qF&&l&&(d=Bl.inflateSetDictionary(o,l),d===Kv?d=Bl.inflate(o,h):d===qv&&(d=qF));o.avail_in>0&&d===uO&&o.state.wrap>0&&0!==n[o.next_in];)Bl.inflateReset(o),d=Bl.inflate(o,h);switch(d){case hO:case qv:case qF:case ez:return this.onEnd(d),this.ended=!0,!1}if(p=o.avail_out,o.next_out&&(0===o.avail_out||d===uO))if("string"===this.options.to){let m=rm.utf8border(o.output,o.next_out),g=o.next_out-m,v=rm.buf2string(o.output,m);o.next_out=g,o.avail_out=a-g,g&&o.output.set(o.output.subarray(m,m+g),0),this.onData(v)}else this.onData(o.output.length===o.next_out?o.output:o.output.subarray(0,o.next_out));if(d!==Kv||0!==p){if(d===uO)return d=Bl.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(0===o.avail_in)break}}return!0},Yv.prototype.onData=function(n){this.chunks.push(n)},Yv.prototype.onEnd=function(n){n===Kv&&(this.result="string"===this.options.to?this.chunks.join(""):xC.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var tz={Inflate:Yv,inflate:YF,inflateRaw:function(n,r){return(r=r||{}).raw=!0,YF(n,r)},ungzip:YF,constants:em};const{deflate:nz}=f6,{inflate:C6}=tz;var $v=nz,T6=C6,om=function(n){return n[n.ONE_BYTE=0]="ONE_BYTE",n[n.TWO_BYTE=1]="TWO_BYTE",n}(om||{});class $F{constructor(){O(this,"_sequence",0),O(this,"_startTime",Date.now()),O(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const o={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const p=new Uint8Array(4);p.set([1,0,0,0]);const g={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[{id:0,length:4,data:p.buffer}]};o.commonPacketHeader.extension=1,o.extension=g,o.payload=this.compress(r),o.commonPacketHeader.length=8+(o.extension.length+2)+o.payload.byteLength}else o.commonPacketHeader.length=8+o.payload.byteLength;V("SHOW_DATASTREAM2_LOG")&&T.debug("send data header: ".concat(JSON.stringify(o.commonPacketHeader)));const a=new ArrayBuffer(o.commonPacketHeader.length),l=new Uint8Array(a),d=new DataView(a);let h=0;if(d.setUint16(h,o.commonPacketHeader.extension<<15|o.commonPacketHeader.reserved<<14|o.commonPacketHeader.length,!0),h+=2,d.setUint32(h,o.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,o.commonStreamHeader,!0),h+=2,o.extension){const p=this.serializeExtension(o.extension);l.set(new Uint8Array(p),h),h+=p.byteLength}if(l.set(new Uint8Array(o.payload),h),h+=o.payload.byteLength,h!==o.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const o=new DataView(r);let a=0;const l=o.getUint16(a,!0);a+=2;const d={length:16383&l,reserved:(16384&l)>>14,extension:(32768&l)>>15,sequence:o.getUint16(a+2,!0)<<16|o.getUint16(a,!0)};let h,p;if(a+=4,V("SHOW_DATASTREAM2_LOG")&&T.debug("receive data header: ".concat(JSON.stringify(d))),o.getUint16(a,!0),a+=2,d.extension){p=this.deserializeExtension(r.slice(a)),a+=2+p.length,h=r.slice(a);let m=!1;if(p.datas.length>0){const g=p.datas.find(v=>0===v.id);g&&(m=!(1&~new DataView(g.data).getUint32(0,!0)))}h=m?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:o,length:a,datas:l}=r,d=new ArrayBuffer(a+2),h=new Uint8Array(d),p=new DataView(d);let m=0;if(p.setUint8(m++,o),p.setUint8(m++,a),l.forEach(g=>{o?(p.setUint8(m++,g.id),p.setUint8(m++,g.length),h.set(new Uint8Array(g.data),m),m+=g.data.byteLength):(p.setUint8(m++,g.id|g.length<<4),h.set(new Uint8Array(g.data),m),m+=g.data.byteLength)}),m!==a+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(a+2));return d}deserializeExtension(r){const o=new DataView(r);let a=0;const l=o.getUint8(a);a++;const d=o.getUint8(a);a++;const h=l===om.TWO_BYTE,p=[],m=new DataView(r,2);let g=0;for(;g<d;){let v=0,y=0,b=new ArrayBuffer(0);h?(v=m.getUint8(g),g++,y=m.getUint8(g),g++):(v=15&m.getUint8(g),y=m.getUint8(g)>>4,g++),y>0&&(b=m.buffer.slice(g+2,g+2+y),g+=b.byteLength),p.push({id:v,length:y,data:b})}if(g!==d)throw Error("parse error");return{profile:l,length:d,datas:p}}decompress(r){return T6(new Uint8Array(r))}compress(r){return $v(new Uint8Array(r))}}const pO={name:"DataStream",create:(n,r)=>{const o=r?new ai(n):new Rs(n);return o.useDataStream(new $F),o}};class fO extends nn{constructor(r,o,a){super(),O(this,"ws",void 0),O(this,"requestId",1),O(this,"heartBeatTimer",void 0),O(this,"joinInfo",void 0),O(this,"clientId",void 0),O(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),O(this,"onClose",l=>{this.emit("close"),this.dispose()}),O(this,"onMessage",l=>{const d=JSON.parse(l.data);if(!d||"serverResponse"!==d.command||!d.requestId)return d&&"serverStatus"===d.command&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=r,this.clientId=o,this.ws=new P_("cross-channel-".concat(this.clientId),a),this.ws.on(Fe.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Fe.CONNECTED,this.onOpen),this.ws.on(Fe.ON_MESSAGE,this.onMessage),this.ws.on(Fe.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(r){const o=this.requestId++;return r.requestId=o,r.seq=o,this.ws.sendMessage(r),o}waitStatus(r){return new le((o,a)=>{const l=window.setTimeout(()=>{a(new z(k.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,d=>{window.clearTimeout(l),d.state&&0!==d.state?a(new z(k.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):o(void 0)}),this.once("dispose",()=>{window.clearTimeout(l),a(new z(k.WS_ABORT))})})}request(r){var o=this;return L(function*(){if("closed"===o.ws.state)throw new z(k.WS_DISCONNECT);"connected"!==o.ws.state&&(yield new le((p,m)=>{o.ws.once(Fe.CLOSED,()=>m(new z(k.WS_ABORT))),o.ws.once(Fe.CONNECTED,p)}));const l=o.sendMessage(r),d=new le((p,m)=>{const g=()=>{m(new z(k.WS_ABORT))};o.ws.once(Fe.RECONNECTING,g),o.ws.once(Fe.CLOSED,g),o.once("req_".concat(l),p),Ii(3e3).then(()=>{o.removeAllListeners("req_".concat(l)),o.ws.off(Fe.RECONNECTING,g),o.ws.off(Fe.CLOSED,g),m(new z(k.TIMEOUT,"cross channel ws request timeout"))})}),h=yield d;if(!h||200!==h.code)throw new z(k.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(h)));return h})()}connect(r){var o=this;return L(function*(){o.ws.removeAllListeners(Fe.REQUEST_NEW_URLS),o.ws.on(Fe.REQUEST_NEW_URLS,a=>{a(r)}),yield o.ws.init(r)})()}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const o=this.requestId++;return r.requestId=o,this.ws.sendMessage(r),o}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class qa extends nn{set state(r){r!==this._state&&(r!==ho.RELAY_STATE_FAILURE&&(this.errorCode=Rf.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,o,a,l,d){var h;super(),h=this,O(this,"joinInfo",void 0),O(this,"sid",void 0),O(this,"clientId",void 0),O(this,"cancelToken",Nr.CancelToken.source()),O(this,"workerToken",void 0),O(this,"requestId",0),O(this,"signal",void 0),O(this,"prevChannelMediaConfig",void 0),O(this,"httpRetryConfig",void 0),O(this,"_resolution",void 0),O(this,"_state",ho.RELAY_STATE_IDLE),O(this,"errorCode",Rf.RELAY_OK),O(this,"onStatus",p=>{T.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(p))),p&&p.command&&("onAudioPacketReceived"===p.command&&this.emit("event",bc.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===p.command&&this.emit("event",bc.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===p.command&&(this.errorCode=Rf.SRC_TOKEN_EXPIRED,this.state=ho.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===p.command&&(this.errorCode=Rf.DEST_TOKEN_EXPIRED,this.state=ho.RELAY_STATE_FAILURE))}),O(this,"onReconnect",L(function*(){T.debug("[".concat(h.clientId,"] ChannelMediaSocket disconnect, reconnecting")),h.emit("event",bc.NETWORK_DISCONNECTED),h.state=ho.RELAY_STATE_IDLE,h.prevChannelMediaConfig&&h.sendStartRelayMessage(h.prevChannelMediaConfig).catch(p=>{h.state!==ho.RELAY_STATE_IDLE&&(T.error("auto restart channel media relay failed",p.toString()),h.errorCode=Rf.SERVER_CONNECTION_LOST,h.state=ho.RELAY_STATE_FAILURE)})})),this.joinInfo=r,this.clientId=o,this.sid=Cf(),this.signal=new fO(this.joinInfo,this.clientId,a),this.httpRetryConfig=l,this._resolution=d}startChannelMediaRelay(r){var o=this;return L(function*(){if(o.state!==ho.RELAY_STATE_IDLE)throw new z(k.INVALID_OPERATION);o.state=ho.RELAY_STATE_CONNECTING,yield o.connect(),T.debug("[".concat(o.clientId,"] startChannelMediaRelay: connect success"));try{yield o.sendStartRelayMessage(r)}catch(a){throw a.data&&a.data.serverResponse&&"SetSourceChannel"===a.data.serverResponse.command?new z(k.CROSS_CHANNEL_FAILED_JOIN_SRC):a.data&&a.data.serverResponse&&"SetDestChannelStatus"===a.serverResponse.command?new z(k.CROSS_CHANNEL_FAILED_JOIN_DEST):a.data&&a.data.serverResponse&&"StartPacketTransfer"===a.serverResponse.command?new z(k.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):a}o.prevChannelMediaConfig=r})()}updateChannelMediaRelay(r){var o=this;return L(function*(){if(o.state!==ho.RELAY_STATE_RUNNING)throw new z(k.INVALID_OPERATION);yield o.sendUpdateMessage(r),o.prevChannelMediaConfig=r})()}setVideoProfile(r){var o=this;return L(function*(){if(o._resolution=r,o.state!==ho.RELAY_STATE_RUNNING)throw new z(k.INVALID_OPERATION);const a=o.genMessage(fn.SetVideoProfile);yield o.signal.request(a),T.debug("[".concat(o.clientId,"] startChannelMediaRelay: setVideoProfile success"))})()}stopChannelMediaRelay(){var r=this;return L(function*(){yield r.sendStopRelayMessage(),T.debug("[".concat(r.clientId,"] stopChannelMediaRelay: send stop message success")),r.state=ho.RELAY_STATE_IDLE,r.dispose()})()}dispose(){T.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Nr.CancelToken.source(),this.state=ho.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}connect(){var r=this;return L(function*(){const o=yield function p2(n,r,o){return gv.apply(this,arguments)}(r.joinInfo,r.cancelToken.token,r.httpRetryConfig);r.workerToken=o.workerToken,yield r.signal.connect(o.addressList),r.emit("event",bc.NETWORK_CONNECTED),r.signal.on("status",r.onStatus),r.signal.on("reconnecting",r.onReconnect)})()}sendStartRelayMessage(r){var o=this;return L(function*(){const a=o.genMessage(fn.StopPacketTransfer);yield o.signal.request(a),yield o.signal.waitStatus("Normal Quit"),T.debug("[".concat(o.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const l=o.genMessage(fn.SetSdkProfile,r);yield o.signal.request(l),T.debug("[".concat(o.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const d=o.genMessage(fn.SetSourceChannel,r);yield o.signal.request(d),yield o.signal.waitStatus("SetSourceChannelStatus"),o.emit("event",bc.PACKET_JOINED_SRC_CHANNEL),T.debug("[".concat(o.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const h=o.genMessage(fn.SetSourceUserId,r);yield o.signal.request(h),T.debug("[".concat(o.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const p=o.genMessage(fn.SetDestChannel,r);yield o.signal.request(p),yield o.signal.waitStatus("SetDestChannelStatus"),o.emit("event",bc.PACKET_JOINED_DEST_CHANNEL),T.debug("[".concat(o.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=o.genMessage(fn.StartPacketTransfer,r);yield o.signal.request(m),o.emit("event",bc.PACKET_SENT_TO_DEST_CHANNEL),o.state=ho.RELAY_STATE_RUNNING,T.debug("[".concat(o.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),o.setVideoProfile(o._resolution)})()}sendUpdateMessage(r){var o=this;return L(function*(){const a=o.genMessage(fn.UpdateDestChannel,r);yield o.signal.request(a),o.emit("event",bc.PACKET_UPDATE_DEST_CHANNEL),T.debug("[".concat(o.clientId,"] sendUpdateMessage: UpdateDestChannel success"))})()}sendStopRelayMessage(){var r=this;return L(function*(){const o=r.genMessage(fn.StopPacketTransfer);yield r.signal.request(o),T.debug("[".concat(r.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))})()}genMessage(r,o){const a=[],l=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ss,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.22.2"===h.sdkVersion&&(h.sdkVersion="0.0.1");let p=null,m=null;switch(r){case fn.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case fn.SetSourceChannel:if(m=o&&o.getSrcChannelMediaInfo(),!m)throw new z(k.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},h;case fn.SetSourceUserId:if(m=o&&o.getSrcChannelMediaInfo(),!m)throw new z(k.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:m.uid+""},h;case fn.SetDestChannel:if(p=o&&o.getDestChannelMediaInfo(),!p)throw new z(k.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(g=>{a.push(g.channelName),l.push(g.uid+""),d.push(g.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:a,uid:l,token:d},h;case fn.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case fn.Reconnect:return h.clientRequest={command:"Reconnect"},h;case fn.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case fn.UpdateDestChannel:if(p=o&&o.getDestChannelMediaInfo(),!p)throw new z(k.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(g=>{a.push(g.channelName),l.push(g.uid+""),d.push(g.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:l,token:d},h;case fn.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const sm={name:"ChannelMediaRelay",create:function(n){return new qa(n.joinInfo,n.clientId,n.websocketRetryConfig||Nn,n.httpRetryConfig||Nn,n.resolution)}};function mO(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function am(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?mO(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):mO(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}class I6 extends nn{constructor(r,o,a,l){super(),O(this,"spec",void 0),O(this,"token",void 0),O(this,"websocket",void 0),O(this,"pingpongTimer",void 0),O(this,"reconnectMode","retry"),O(this,"serviceMode",void 0),O(this,"reqId",0),O(this,"commandReqId",0),O(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),O(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(be.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Pa.TRANSCODE?1:2}),this.emit(vl.PUBLISH_STREAM_STATUS,h))}),this.spec=o,this.token=r,this.serviceMode=l,this.websocket=new P_("live-streaming",a),this.websocket.on(Fe.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Fe.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Fe.REQUEST_NEW_URLS,(d,h)=>{Gi(this,vl.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(Fe.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}request(r,o,a,l){var d=this;return L(function*(){d.reqId+=1,"request"===r&&(d.commandReqId+=1);const h=d.commandReqId,p=d.reqId;if(!p||!d.websocket)throw new z(k.UNEXPECTED_ERROR);const m=am({command:r,sdkVersion:"4.22.2"===Ss?"0.0.1":Ss,seq:p,requestId:p,allocate:a,cname:d.spec.cname,appId:d.spec.appId,sid:d.spec.sid,uid:d.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},o);if("closed"===d.websocket.state)throw new z(k.WS_DISCONNECT);const g=()=>new le((C,N)=>{d.websocket.once(Fe.CLOSED,()=>N(new z(k.WS_ABORT))),d.websocket.once(Fe.CONNECTED,C)});"connected"!==d.websocket.state&&(yield g()),m.clientRequest&&(m.clientRequest.workerToken=d.token);const v=new le((C,N)=>{const R=()=>{N(new z(k.WS_ABORT))};d.websocket.once(Fe.RECONNECTING,R),d.websocket.once(Fe.CLOSED,R),d.once("@".concat(p,"-").concat(d.spec.sid),A=>{C(A)})});l&&be.workerEvent(d.spec.sid,am(am({},l),{},{requestId:h,actionType:"request",payload:JSON.stringify(o.clientRequest),serverCode:0,code:0}));const y=Date.now();d.websocket.sendMessage(m);let b=null;try{b=yield v}catch(C){if("closed"===d.websocket.state)throw C;return yield g(),yield d.request(r,o,a)}return l&&be.workerEvent(d.spec.sid,am(am({},l),{},{requestId:h,actionType:"response",payload:JSON.stringify(b.serverResponse),serverCode:b.code,success:200===b.code,responseTime:Date.now()-y})),200!==b.code&&d.handleResponseError(b),b})()}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r="4.22.2"===Ss?"0.0.1":Ss;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case $n.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void T.warning("live stream response already exists stream");case $n.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case $n.LIVE_STREAM_RESPONSE_BAD_STREAM:case $n.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new z(k.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case $n.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===r.serverResponse.command)return;throw new z(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case $n.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new z(k.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case $n.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const o=new z(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(vl.WARNING,o,r.serverResponse.url)}case $n.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const o=new z(k.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(vl.WARNING,o,r.serverResponse.url)}case $n.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new z(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case $n.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new z(k.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case $n.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const o=new z(k.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(vl.WARNING,o,r.serverResponse.url)}case $n.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new z(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case $n.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new z(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case $n.LIVE_STREAM_RESPONSE_WORKER_LOST:case $n.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===r.serverResponse.command)return;throw new z(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case $n.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===r.serverResponse.command)return;if("UpdateTranscoding"===r.serverResponse.command||"ControlStream"===r.serverResponse.command)return new z(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new z(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case $n.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case $n.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case $n.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case $n.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new z(k.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(iS)},6e3)}}function tu(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}function Ir(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?tu(Object(o),!0).forEach(function(a){O(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):tu(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}class zC extends nn{constructor(r){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Nn,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Nn;super(),O(this,"onLiveStreamWarning",void 0),O(this,"onLiveStreamError",void 0),O(this,"spec",void 0),O(this,"retryTimeout",1e4),O(this,"connection",void 0),O(this,"httpRetryConfig",void 0),O(this,"wsRetryConfig",void 0),O(this,"streamingTasks",new Map),O(this,"isStartingStreamingTask",!1),O(this,"taskMutex",new Qi("live-streaming")),O(this,"cancelToken",Nr.CancelToken.source()),O(this,"transcodingConfig",void 0),O(this,"uapResponse",void 0),O(this,"lastTaskId",1),O(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=a,this.wsRetryConfig=o}setTranscodingConfig(r){var o=this;return L(function*(){const a=Ir(Ir({},EL),r);var p;66!==a.videoCodecProfile&&77!==a.videoCodecProfile&&100!==a.videoCodecProfile&&(T.debug("[".concat(o.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(a.videoCodecProfile," -> 100")),a.videoCodecProfile=100),a.transcodingUsers||(a.transcodingUsers=a.userConfigs),a.transcodingUsers&&(a.transcodingUsers=a.transcodingUsers.map(p=>Ir(Ir(Ir({},vL),p),{},{zOrder:p.zOrder?p.zOrder+1:1}))),pn((p=a).width)||Ut(p.width,"config.width",0,1e4),pn(p.height)||Ut(p.height,"config.height",0,1e4),pn(p.videoBitrate)||Ut(p.videoBitrate,"config.videoBitrate",1,1e6),pn(p.videoFrameRate)||Ut(p.videoFrameRate,"config.videoFrameRate"),pn(p.lowLatency)||pl(p.lowLatency,"config.lowLatency"),pn(p.audioSampleRate)||fi(p.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),pn(p.audioBitrate)||Ut(p.audioBitrate,"config.audioBitrate",1,128),pn(p.audioChannels)||fi(p.audioChannels,"config.audioChannels",[1,2,3,4,5]),pn(p.videoGop)||Ut(p.videoGop,"config.videoGop"),pn(p.videoCodecProfile)||fi(p.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),pn(p.userCount)||Ut(p.userCount,"config.userCount",0,17),pn(p.backgroundColor)||Ut(p.backgroundColor,"config.backgroundColor",0,16777215),pn(p.userConfigExtraInfo)||Pi(p.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),p.transcodingUsers&&!pn(p.transcodingUsers)&&(fl(p.transcodingUsers,"config.transcodingUsers"),p.transcodingUsers.forEach((m,g)=>{uS(m.uid),pn(m.x)||Ut(m.x,"transcodingUser[".concat(g,"].x"),0,1e4),pn(m.y)||Ut(m.y,"transcodingUser[".concat(g,"].y"),0,1e4),pn(m.width)||Ut(m.width,"transcodingUser[".concat(g,"].width"),0,1e4),pn(m.height)||Ut(m.height,"transcodingUser[".concat(g,"].height"),0,1e4),pn(m.zOrder)||Ut(m.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),pn(m.alpha)||Ut(m.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)})),pn(p.watermark)||pS(p.watermark,"watermark"),pn(p.backgroundImage)||pS(p.backgroundImage,"backgroundImage"),p.images&&!pn(p.images)&&(fl(p.images,"config.images"),p.images.forEach((m,g)=>{pS(m,"images[".concat(g,"]"))}));const l=[];a.images&&l.push(...a.images.map(p=>Ir(Ir(Ir({},hS),p),{},{zOrder:255}))),a.backgroundImage&&(l.push(Ir(Ir(Ir({},hS),a.backgroundImage),{},{zOrder:0})),delete a.backgroundImage),a.watermark&&(l.push(Ir(Ir(Ir({},hS),a.watermark),{},{zOrder:255})),delete a.watermark),a.images=l,a.transcodingUsers&&(a.userConfigs=a.transcodingUsers.map(p=>Ir({},p)),a.userCount=a.transcodingUsers.length,delete a.transcodingUsers);const d=(a.userConfigs||[]).map(p=>"number"==typeof p.uid?le.resolve(p.uid):rD(p.uid,o.spec,o.cancelToken.token,o.httpRetryConfig));if((yield le.all(d)).forEach((p,m)=>{a.userConfigs&&a.userConfigs[m]&&(a.userConfigs[m].uid=p)}),o.transcodingConfig=a,o.connection)try{var h;const p=yield o.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:o.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Md(h=o.streamingTasks).call(h)).map(m=>m.taskId).join("#")});T.debug("[".concat(o.spec.clientId,"] update live transcoding config success, code: ").concat(p.code,", config:"),JSON.stringify(o.transcodingConfig))}catch(p){if(!p.data||!p.data.retry)throw p;p.data.changeAddress&&o.connection.tryNextAddress(),o.streamingTasks.forEach(m=>{T.warning("[".concat(o.spec.clientId,"] live streaming receive error"),p.toString(),"try to republish",m.url),o.startLiveStreamingTask(m.url,m.mode,p).then(()=>{T.debug("[".concat(o.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(g=>{T.error("[".concat(o.spec.clientId,"] live streaming republish failed"),m.url,g.toString()),o.onLiveStreamError&&o.onLiveStreamError(m.url,g)})})}})()}startLiveStreamingTask(r,o,a){var l=this;return L(function*(){if(!l.transcodingConfig&&o===Pa.TRANSCODE)throw new z(k.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const d={command:"PublishStream",ts:Date.now(),url:r,uid:l.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};T.debug("[".concat(l.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(o));const h=yield l.taskMutex.lock();if(!l.connection&&a)return void h();if(l.streamingTasks.get(r)&&!a)return h(),new z(k.LIVE_STREAMING_TASK_CONFLICT).throw();try{l.connection||(l.connection=yield l.connect(o))}catch(m){throw h(),m}o===Pa.TRANSCODE&&(d.transcodingConfig=Ir({},l.transcodingConfig)),l.uapResponse&&l.uapResponse.vid&&(d.vid=l.uapResponse.vid),l.isStartingStreamingTask=!0;const p=l.lastTaskId++;try{const m=new le((v,y)=>{Ii(l.retryTimeout).then(()=>{if(a)return y(a);const b=l.statusError.get(r);return b?(l.statusError.delete(r),y(b)):void 0})}),g=yield le.race([l.connection.request("request",{clientRequest:d},!0,{url:r,command:"PublishStream",workerType:o===Pa.TRANSCODE?1:2,requestByUser:!a,tid:p.toString()}),m]);l.isStartingStreamingTask=!1,T.debug("[".concat(l.spec.clientId,"] live streaming started, code: ").concat(g.code)),l.streamingTasks.set(r,{clientRequest:d,mode:o,url:r,taskId:p}),h()}catch(m){if(h(),l.isStartingStreamingTask=!1,!m.data||!m.data.retry||a)throw m;return m.data.changeAddress?(l.connection.tryNextAddress(),yield l.startLiveStreamingTask(r,o,m)):yield l.startLiveStreamingTask(r,o,m)}})()}stopLiveStreamingTask(r){return new le((o,a)=>{const l=this.streamingTasks.get(r);if(!l||!this.connection)return new z(k.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=l.mode;l.abortTask=()=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),o()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:l.url}},!1,{url:r,command:"UnPublishStream",workerType:d===Pa.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),0===this.streamingTasks.size&&(this.connection&&this.connection.close(),this.connection=void 0),o()}).catch(a)})}resetAllTask(){var r;const o=Array.from(Md(r=this.streamingTasks).call(r));this.terminate();for(const a of o)this.startLiveStreamingTask(a.url,a.mode).catch(l=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,l)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Nr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}connect(r){var o=this;return L(function*(){if(o.connection)throw new z(k.UNEXPECTED_ERROR,"live streaming connection has already connected");const a=yield Gi(o,fS.REQUEST_WORKER_MANAGER_LIST,r);return o.uapResponse=a,o.connection=new I6(a.workerToken,o.spec,o.wsRetryConfig,r),o.connection.on(vl.WARNING,(l,d)=>o.onLiveStreamWarning&&o.onLiveStreamWarning(d,l)),o.connection.on(vl.PUBLISH_STREAM_STATUS,l=>o.handlePublishStreamServer(l)),o.connection.on(vl.REQUEST_NEW_ADDRESS,(l,d)=>{if(!o.connection)return d(new z(k.UNEXPECTED_ERROR,"can not get new live streaming address list"));Gi(o,fS.REQUEST_WORKER_MANAGER_LIST,r).then(h=>{o.uapResponse=h,l(h.addressList)}).catch(d)}),yield o.connection.init(a.addressList),o.connection})()}handlePublishStreamServer(r){const o=r.serverStatus&&r.serverStatus.url||"empty_url",a=this.streamingTasks.get(o),l=r.reason;switch(r.code){case $n.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case $n.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case $n.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case $n.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new z(k.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(a)return T.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(o,h);if(!this.isStartingStreamingTask)return;this.statusError.set(o,h)}case $n.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new z(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,l);return this.onLiveStreamWarning&&this.onLiveStreamWarning(o,h)}case $n.LIVE_STREAM_RESPONSE_WORKER_LOST:case $n.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Md(d=this.streamingTasks).call(d));for(const p of h)p.abortTask?p.abortTask():(T.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new z(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{T.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(m=>{T.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,m)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const XF={name:"LiveStreaming",create:function(n){return new zC(n.joinInfo,n.websocketRetryConfig||Nn,n.httpRetryConfig||Nn)}};function _O(n){let r={};e:for(;!yO(n);){let o=Lc(n);switch(o>>>3){case 0:break e;case 1:r.requestId=eU(n,Lc(n));break;case 2:r.requestType=Lc(n)>>>0;break;case 3:r.scorePorn=YC(n);break;case 4:r.scoreSexy=YC(n);break;case 5:r.scoreNeutral=YC(n);break;case 6:r.requestScene=Lc(n)>>>0;break;case 7:r.scene=Lc(n)>>>0;break;default:KC(n,7&o)}}return r}function vO(n,r){let o=n.service;void 0!==o&&(Ot(r,8),Ot(r,o));let a=n.vendor;void 0!==a&&(Ot(r,16),Ot(r,a));let l=n.token;void 0!==l&&(Ot(r,26),Ya(r,l));let d=n.callbackUrl;void 0!==d&&(Ot(r,34),Ya(r,d))}function JF(n){let r=Lc(n),o=n.limit;return n.limit=n.offset+r,o}function KC(n,r){switch(r){case 0:for(;128&tU(n););break;case 2:Xv(n,Lc(n));break;case 5:Xv(n,4);break;case 1:Xv(n,8);break;default:throw new Error("Unimplemented type: "+r)}}let EO=new Float32Array(1);new Uint8Array(EO.buffer);let cm=new Float64Array(1),Zr=new Uint8Array(cm.buffer);function lm(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let dm=[];function QF(){const n=dm.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}function w6(n){dm.push(n)}function Xv(n,r){if(n.offset+r>n.limit)throw new Error("Skip past limit");n.offset+=r}function yO(n){return n.offset>=n.limit}function jl(n,r){let o=n.bytes,a=n.offset,l=n.limit,d=a+r;if(d>o.length){let h=new Uint8Array(2*d);h.set(o),n.bytes=h}return n.offset=d,d>l&&(n.limit=d),a}function qC(n,r){let o=n.offset;if(o+r>n.limit)throw new Error("Read past limit");return n.offset+=r,o}function eU(n,r){let o=qC(n,r),a=String.fromCharCode,l=n.bytes,d="\ufffd",h="";for(let p=0;p<r;p++){let m,g,v,y,b=l[p+o];128&b?192==(224&b)?p+1>=r?h+=d:(m=l[p+o+1],128!=(192&m)?h+=d:(y=(31&b)<<6|63&m,y<128?h+=d:(h+=a(y),p++))):224==(240&b)?p+2>=r?h+=d:(m=l[p+o+1],g=l[p+o+2],32896!=(49344&(m|g<<8))?h+=d:(y=(15&b)<<12|(63&m)<<6|63&g,y<2048||y>=55296&&y<=57343?h+=d:(h+=a(y),p+=2))):240==(248&b)?p+3>=r?h+=d:(m=l[p+o+1],g=l[p+o+2],v=l[p+o+3],8421504!=(12632256&(m|g<<8|v<<16))?h+=d:(y=(7&b)<<18|(63&m)<<12|(63&g)<<6|63&v,y<65536||y>1114111?h+=d:(y-=65536,h+=a(55296+(y>>10),56320+(1023&y)),p+=3))):h+=d:h+=a(b)}return h}function Ya(n,r){let o=r.length,a=0;for(let h=0;h<o;h++){let p=r.charCodeAt(h);p>=55296&&p<=56319&&h+1<o&&(p=(p<<10)+r.charCodeAt(++h)-56613888),a+=p<128?1:p<2048?2:p<65536?3:4}Ot(n,a);let l=jl(n,a),d=n.bytes;for(let h=0;h<o;h++){let p=r.charCodeAt(h);p>=55296&&p<=56319&&h+1<o&&(p=(p<<10)+r.charCodeAt(++h)-56613888),p<128?d[l++]=p:(p<2048?d[l++]=p>>6&31|192:(p<65536?d[l++]=p>>12&15|224:(d[l++]=p>>18&7|240,d[l++]=p>>12&63|128),d[l++]=p>>6&63|128),d[l++]=63&p|128)}}function sz(n,r){let o=jl(n,r.limit),a=n.bytes,l=r.bytes;for(let d=0,h=r.limit;d<h;d++)a[d+o]=l[d]}function tU(n){return n.bytes[qC(n,1)]}function nU(n,r){let o=jl(n,1);n.bytes[o]=r}function YC(n){let r=qC(n,8),o=n.bytes;return Zr[0]=o[r++],Zr[1]=o[r++],Zr[2]=o[r++],Zr[3]=o[r++],Zr[4]=o[r++],Zr[5]=o[r++],Zr[6]=o[r++],Zr[7]=o[r++],cm[0]}function um(n,r){let o=jl(n,8),a=n.bytes;cm[0]=r,a[o++]=Zr[0],a[o++]=Zr[1],a[o++]=Zr[2],a[o++]=Zr[3],a[o++]=Zr[4],a[o++]=Zr[5],a[o++]=Zr[6],a[o++]=Zr[7]}function Lc(n){let r,o=0,a=0;do{r=tU(n),o<32&&(a|=(127&r)<<o),o+=7}while(128&r);return a}function Ot(n,r){for(r>>>=0;r>=128;)nU(n,127&r|128),r>>>=7;nU(n,r)}function ks(n,r){let o=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,l=r.high>>>24,d=0===l?0===a?o<16384?o<128?1:2:o<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:l<128?9:10,h=jl(n,d),p=n.bytes;switch(d){case 10:p[h+9]=l>>>7&1;case 9:p[h+8]=9!==d?128|l:127&l;case 8:p[h+7]=8!==d?a>>>21|128:a>>>21&127;case 7:p[h+6]=7!==d?a>>>14|128:a>>>14&127;case 6:p[h+5]=6!==d?a>>>7|128:a>>>7&127;case 5:p[h+4]=5!==d?128|a:127&a;case 4:p[h+3]=4!==d?o>>>21|128:o>>>21&127;case 3:p[h+2]=3!==d?o>>>14|128:o>>>14&127;case 2:p[h+1]=2!==d?o>>>7|128:o>>>7&127;case 1:p[h]=1!==d?128|o:127&o}}function hm(n,r){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,a)}return o}const R6=new Map([["moderation",1],["supervise",2]]);function iU(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}class Zv extends nn{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const o=this._connectionState;this._connectionState=r,this.emit(vi.CONNECTION_STATE_CHANGE,o,r)}get inspectType(){return this._inspectType}set inspectType(r){var o;this._inspectMode=Ue(o=r.map(a=>R6.get(a)||0)).call(o,(a,l)=>a+l),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),O(this,"name","AgoraRTCVideoContentInspect"),O(this,"_connectionState",qs.CONNECTING),O(this,"_innerConnectionState",void 0),O(this,"sequence",0),O(this,"inspectStartTime",void 0),O(this,"workerManagerConnection",void 0),O(this,"workerConnection",void 0),O(this,"workerMessageLengthLimit",void 0),O(this,"inspectIntervalMinimum",void 0),O(this,"qualityRatio",void 0),O(this,"_connectInfo",void 0),O(this,"_cancelTokenSource",Nr.CancelToken.source()),O(this,"_retryConfig",void 0),O(this,"wmSequence",0),O(this,"inspectInterval",void 0),O(this,"inspectTimer",null),O(this,"ossFilePrefix",void 0),O(this,"extraInfo",void 0),O(this,"_inspectType",void 0),O(this,"_inspectMode",void 0),O(this,"_quality",1),O(this,"qualityTimer",null),O(this,"_inspectId",void 0),O(this,"_needWorkUrlOnly",!1),O(this,"inspectImage",()=>{if(this.connectionState!==qs.CONNECTED)throw new z(k.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===qs.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Ct(5,"inspect-"),this.workerMessageLengthLimit=V("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=V("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=V("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new P_("worker-manager-"+this._inspectId,Nn),this.on(vi.STATE_CHANGE,(o,a)=>{this._innerConnectionState=o,T.debug("[".concat(this._inspectId,"] Inspect operation :").concat(os[o]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new P_("worker-"+this._inspectId,Nn),this.handleWorkerEvents()}init(r,o){var a=this;return L(function*(){a.emit(vi.STATE_CHANGE,os.CONNECT_AP),a._connectInfo=r;const l=a._cancelTokenSource.token;return a._retryConfig=o,new le((d,h)=>{a.on(vi.CONNECTION_STATE_CHANGE,(p,m)=>{m===qs.CONNECTED&&d()}),a.requestAP(r,l,o).then(p=>{a.connectWorkerManager(p)}).catch(p=>{h(p)})})})()}requestAP(r,o,a){var l=this;return L(function*(){const d=V("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),h=yield function(m,g,v,y){let{appId:b,areaCode:C,cname:N,sid:R,token:A,uid:D}=g;Wf++;const M="image_moderation_api",x={service_name:M,json_body:JSON.stringify({appId:b,areaCode:C,cname:N,command:"allocateEdge",requestId:Wf,seq:Wf,sid:R,token:A,ts:Date.now(),uid:D+""})};let j,W,q=m[0];return rs(L(function*(){j=Date.now();const ee=yield ta(q,{data:x,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(W=Date.now()-j,0!==ee.code){const Re=new z(k.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ee.code,{retry:!0,responseTime:W});throw T.error(Re.toString()),Re}const J=JSON.parse(ee.json_body);if(200!==J.code){const Re=new z(k.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(J.code,", reason: ").concat(J.reason),{code:J.code,responseTime:W});throw T.error(Re.toString()),Re}if(!J.servers||!Array.isArray(J.servers)||0===J.servers.length){const Re=new z(k.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:J.code,responseTime:W});throw T.error(Re.toString()),Re}const X=V("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Ce=V("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:J.servers.map(Re=>{let{address:ut,wss:Nt}=Re;if(ut&&Nt)return"wss://".concat(ut.replace(/\./g,"-"),".").concat(X,":").concat(Ce||Nt)}).filter(Re=>!!Re),workerToken:J.workerToken,vid:J.vid,responseTime:W}}),(ee,J)=>(be.apworkerEvent(R,{success:!0,sc:200,serviceName:M,responseDetail:JSON.stringify(ee.addressList),firstSuccess:0===J,responseTime:W,serverIp:m[J%m.length]}),!1),(ee,J)=>(be.apworkerEvent(R,{success:!1,sc:ee.data&&ee.data.code||200,serviceName:M,responseTime:W,serverIp:m[J%m.length]}),!!(ee.code!==k.OPERATION_ABORTED&&ee.code!==k.UNEXPECTED_RESPONSE||ee.data&&ee.data.retry)&&(q=m[(J+1)%m.length],!0)),y)}(d,r,o,a);l.emit(vi.STATE_CHANGE,os.AP_CONNECTED);const{addressList:p}=h;return l.wmSequence++,p})()}connectWorkerManager(r){var o=arguments,a=this;return L(function*(){a._needWorkUrlOnly=o.length>1&&void 0!==o[1]&&o[1],a.emit(vi.STATE_CHANGE,os.CONNECT_WORKER_MANAGER),yield a.workerManagerConnection.init(r,1e4)})()}connectWorker(r){var o=this;return L(function*(){yield o.workerConnection.init([r])})()}handleWorkerManagerEvents(){var r=this;this.workerManagerConnection.on(Fe.CONNECTED,L(function*(){r.emit(vi.STATE_CHANGE,os.WORKER_MANAGER_CONNECTED,r.workerManagerConnection.url),r.workerManagerConnection.sendMessage({appId:r._connectInfo.appId,cname:r._connectInfo.cname,uid:r._connectInfo.uid+"",sdkVersion:"4.22.2",sid:r._connectInfo.sid,seq:r.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(Fe.CLOSED,()=>{this._innerConnectionState<os.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Fe.FAILED,()=>{this._innerConnectionState<os.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Fe.RECONNECTING,()=>{this._innerConnectionState<os.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Fe.ON_MESSAGE,function(){var o=L(function*(a){r.emit(vi.STATE_CHANGE,os.GET_WORKER_MANAGER_RESPONSE);const l=r.workerManagerConnection.url;r.workerManagerConnection.close();const d=JSON.parse(a.data);if(200!==d.code)throw T.error("[".concat(r._inspectId,"] Unexpected code ").concat(d.code," from worker manager")),new z(k.UNEXPECTED_RESPONSE,"response code of worker is unexpected",d);if(!(d.serverResponse&&d.serverResponse.portWss&&l))throw T.error("[".concat(r._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(d))),new z(k.UNEXPECTED_RESPONSE,"response content of worker is unexpected",d);{const h=V("VIDEO_INSPECT_WORKER_PORT")||d.serverResponse.portWss,p=l.replace(/:\d+\/?$/,":".concat(h));r.emit(vi.STATE_CHANGE,os.CONNECT_WORKER,p),r._needWorkUrlOnly?r.emit(vi.REQUEST_NEW_WORKER_URL,p):yield r.connectWorker(p)}});return function(a){return o.apply(this,arguments)}}()),this.workerManagerConnection.on(Fe.WILL_RECONNECT,(o,a,l)=>{l(o)}),this.workerManagerConnection.on(Fe.REQUEST_NEW_URLS,(o,a)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o).catch(a)})}handleWorkerEvents(){var r=this;this.workerConnection.on(Fe.CONNECTED,L(function*(){r.emit(vi.STATE_CHANGE,os.WORKER_CONNECTED,r.workerConnection.url),r.connectionState=qs.CONNECTED})),this.workerConnection.on(Fe.ON_MESSAGE,function(){var o=L(function*(a){if(a.data instanceof ArrayBuffer){const d=function ZF(n){return function(o){let a={};e:for(;!yO(o);){let l=Lc(o);switch(l>>>3){case 0:break e;case 1:a.code=Lc(o);break;case 2:a.msg=eU(o,Lc(o));break;case 3:{let d=JF(o);a.data=_O(o),o.limit=d;break}default:KC(o,7&l)}}return a}({bytes:r=n,offset:0,limit:r.length});var r}(new Uint8Array(a.data));if(V("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&T.debug("[".concat(r._inspectId,"] Response message for worker of inspect content "),JSON.stringify(d)),200===d.code){if(Array.isArray(r.inspectType)&&1===r.inspectType.length&&"supervise"===r.inspectType[0])return void r.emit(vi.INSPECT_RESULT,void 0,void 0);if(d.data&&d.data.scorePorn&&d.data.scoreSexy&&d.data.scoreNeutral){var l;const h={porn:d.data.scorePorn,sexy:d.data.scoreSexy,neutral:d.data.scoreNeutral},p=Ue(l=Object.keys(h)).call(l,(g,v)=>h[g]>h[v]?g:v,"porn"),m=Object.keys(h).find(g=>g===p);r.emit(vi.INSPECT_RESULT,m)}else r.emit(vi.INSPECT_RESULT,void 0,new z(k.UNEXPECTED_RESPONSE,d.code+"","There is an unexpected data on message"))}else r.emit(vi.INSPECT_RESULT,void 0,new z(k.UNEXPECTED_RESPONSE,d.code+"",d.msg))}else T.error("[".concat(r._inspectId,"] Unexpected message type from worker")),r.emit(vi.INSPECT_RESULT,void 0,new z(k.UNEXPECTED_RESPONSE,"invalid worker message type"))});return function(a){return o.apply(this,arguments)}}()),this.workerConnection.on(Fe.CLOSED,()=>{this.connectionState=qs.CLOSED}),this.workerConnection.on(Fe.FAILED,()=>{this.connectionState=qs.CLOSED}),this.workerConnection.on(Fe.RECONNECTING,()=>{this.connectionState=this.connectionState===qs.CONNECTED?qs.RECONNECTING:qs.CONNECTING}),this.workerConnection.on(Fe.WILL_RECONNECT,(o,a,l)=>{"recover"===o&&l(o),l("tryNext")}),this.workerConnection.on(Fe.REQUEST_NEW_URLS,(o,a)=>{this.workerManagerConnection.close(),this.once(vi.REQUEST_NEW_WORKER_URL,l=>{o([l])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(l=>{this.connectWorkerManager(l,!0)}).catch(l=>{a(l)})})}requestToInspectImage(){var r=this;return L(function*(){r.sequence++;const o=Do(r,vi.CLIENT_LOCAL_VIDEO_TRACK),a={appId:r._connectInfo.appId,cname:r._connectInfo.cname,cid:r._connectInfo.cid,sid:r._connectInfo.sid,uid:r._connectInfo.uid,vid:r._connectInfo.vid};if(o){if(!o.isPlaying)return void r.emit(vi.INSPECT_RESULT,void 0,new z(k.INVALID_OPERATION,"Only the track being played can be inspected"));const l=yield r.generateRequestData(o,a);r.workerConnection.sendMessage(l,!0,!0)}else r.emit(vi.INSPECT_RESULT,void 0,new z(k.INVALID_OPERATION,"Only the track being published can be inspected"))})()}generateRequestData(r,o){var a=this;return L(function*(){let{appId:l,cname:d,cid:h,vid:p,sid:m,uid:g}=o;const v=Date.now(),y=yield r.getCurrentFrameImage("image/jpeg",a.quality),b=yield vx(y,l,d),C=a.sequence+"-"+h+"-"+g+"-"+v+"-"+Ct(12,""),N={appId:l,cid:h,cname:d,deviceId:"",elapse:iU(Number(v-a.inspectStartTime)),fileSize:b.byteLength,jpgEncryption:2,height:y.height,width:y.width,jpg:b,networkType:6,osType:7,requestId:C,sdkVersion:"4.22.2",sequence:a.sequence,sid:m,timestamp:iU(v),uid:g,vid:p,service:a._inspectMode,callbackData:a.extraInfo,ossFilePrefix:a.ossFilePrefix};void 0===a.extraInfo&&delete N.callbackData,void 0===a.ossFilePrefix&&delete N.ossFilePrefix;const R=function gO(n){let r=QF();return function(o,a){let l=o.appId;void 0!==l&&(Ot(a,10),Ya(a,l));let d=o.cid;void 0!==d&&(Ot(a,16),Ot(a,d));let h=o.cname;void 0!==h&&(Ot(a,26),Ya(a,h));let p=o.deviceId;void 0!==p&&(Ot(a,34),Ya(a,p));let m=o.elapse;void 0!==m&&(Ot(a,40),ks(a,m));let g=o.fileSize;void 0!==g&&(Ot(a,48),ks(a,lm(g)));let v=o.height;void 0!==v&&(Ot(a,56),ks(a,lm(v)));let y=o.jpg;void 0!==y&&(Ot(a,66),Ot(a,y.length),function(ca,Z){let oe=jl(ca,Z.length);ca.bytes.set(Z,oe)}(a,y));let b=o.networkType;void 0!==b&&(Ot(a,72),ks(a,lm(b)));let C=o.osType;void 0!==C&&(Ot(a,80),ks(a,lm(C)));let N=o.requestId;void 0!==N&&(Ot(a,90),Ya(a,N));let R=o.sdkVersion;void 0!==R&&(Ot(a,98),Ya(a,R));let A=o.sequence;void 0!==A&&(Ot(a,104),ks(a,lm(A)));let D=o.sid;void 0!==D&&(Ot(a,114),Ya(a,D));let M=o.timestamp;void 0!==M&&(Ot(a,120),ks(a,M));let x=o.uid;void 0!==x&&(Ot(a,128),Ot(a,x));let j=o.vid;void 0!==j&&(Ot(a,136),Ot(a,j));let W=o.width;void 0!==W&&(Ot(a,144),ks(a,lm(W)));let q=o.service;void 0!==q&&(Ot(a,152),Ot(a,q));let ee=o.callbackData;void 0!==ee&&(Ot(a,162),Ya(a,ee));let J=o.jpgEncryption;void 0!==J&&(Ot(a,168),Ot(a,J));let X=o.requestType;void 0!==X&&(Ot(a,176),Ot(a,X));let Ce=o.scorePorn;void 0!==Ce&&(Ot(a,185),um(a,Ce));let Re=o.scoreSexy;void 0!==Re&&(Ot(a,193),um(a,Re));let ut=o.scoreNeutral;void 0!==ut&&(Ot(a,201),um(a,ut));let Nt=o.scene;void 0!==Nt&&(Ot(a,208),Ot(a,Nt));let _n=o.ossFilePrefix;void 0!==_n&&(Ot(a,218),Ya(a,_n));let Zt=o.serviceVendor;if(void 0!==Zt)for(let ca of Zt){Ot(a,226);let Z=QF();vO(ca,Z),Ot(a,Z.limit),sz(a,Z),w6(Z)}}(n,r),function(o){let a=o.bytes,l=o.limit;return a.length===l?a:a.subarray(0,l)}(r)}(N);if(R.byteLength<a.workerMessageLengthLimit){if(V("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const A=function(D){for(var M=1;M<arguments.length;M++){var x=null!=arguments[M]?arguments[M]:{};M%2?hm(Object(x),!0).forEach(function(j){O(D,j,x[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(D,Object.getOwnPropertyDescriptors(x)):hm(Object(x)).forEach(function(j){Object.defineProperty(D,j,Object.getOwnPropertyDescriptor(x,j))})}return D}({},N);delete A.jpg,T.debug("[".concat(a._inspectId,"] Request message for worker of inspect content "),JSON.stringify(A))}return R}return a.quality=a.quality*a.qualityRatio,yield a.generateRequestData(r,{appId:l,cname:d,cid:h,vid:p,sid:m,uid:g})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Nr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=qs.CLOSED,this.emit(vi.STATE_CHANGE,os.CLOSED)}}const Jv={name:"ContentInspect",create:function(n){let{config:r}=n;return function(o){if(!o)throw new z(k.INVALID_PARAMS,"inspectConfig is necessary.");if(!o.inspectType||!Array.isArray(o.inspectType))throw new z(k.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const a=[...new Set(o.inspectType)];a.forEach(l=>{var d;if(!he(d=["supervise","moderation"]).call(d,l))throw new z(k.INVALID_PARAMS,"".concat(l," is not a valid inspect type."))}),o.inspectType=a}if(o&&o.extraInfo&&o.extraInfo.length>1024)throw new z(k.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new Zv(r)}};Lt("PROCESS_ID","process-".concat(Ct(8,""),"-").concat(Ct(4,""),"-").concat(Ct(4,""),"-").concat(Ct(4,""),"-").concat(Ct(12,""))),function(){let n;try{n=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void T.error("Error loading sdk config",r.message)}if(n)try{const r=JSON.parse(window.atob(n)),o=Date.now();T.debug("Loading global parameters from cache",r),Object.keys(r).forEach(a=>{if(Object.prototype.hasOwnProperty.call(Pn,a)){const{value:l,expires:d}=r[a];if(d&&d<=o)return;Rd[a]=l,Pn[a]=l}})}catch(r){T.error("Error loading mutableParamsCache: ".concat(n),r.message)}}(),Array.isArray(Rd.AREAS)&&Rd.AREAS.length>0&&Ah(Rd.AREAS,!0);const rU=(n,r,o)=>{T.debug("setParameter key:".concat(n,", value:").concat(JSON.stringify(r))),Lt(n,r,o)};cC(sm,!1),cC(XF,!1),cC(QW,!1),cC(Jv,!1),cC(pO,!1);const ei=function(n){const r=new nn,o=n,a={getListeners:r.getListeners.bind(r),on:(l,d)=>(l===Ys.SECURITY_POLICY_VIOLATION&&SF(d,!0),r.on.bind(r)(l,d)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return bF(bF({},o),a)}({__TRACK_LIST__:yh,VERSION:Ss,BUILD:_R,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:rU,getParameter:V,getSupportedCodec:function(){var n=L(function*(){let r={audio:[],video:[]};try{let o=new RTCPeerConnection;const a=yield(l=L(function*(d){let h;return ct().supportUnifiedPlan?(d.addTransceiver("video",{direction:"recvonly"}),d.addTransceiver("audio",{direction:"recvonly"}),h=(yield d.createOffer()).sdp):h=(yield d.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,h}),function(d){return l.apply(this,arguments)})(o);if(!a)return r;o.close(),o=null,r=function(l){const d={video:[],audio:[]};return l.match(/ VP8/i)&&d.video.push("VP8"),l.match(/ VP9/i)&&d.video.push("VP9"),l.match(/ AV1/i)&&d.video.push("AV1"),l.match(/ H264/i)&&d.video.push("H264"),l.match(/ H265/i)&&d.video.push("H265"),l.match(/ opus/i)&&d.audio.push("OPUS"),l.match(/ PCMU/i)&&d.audio.push("PCMU"),l.match(/ PCMA/i)&&d.audio.push("PCMA"),l.match(/ G722/i)&&d.audio.push("G722"),d}(a)}catch(o){throw new z(k.CREATE_OFFER_FAILED,o.toString&&o.toString()).print()}var l;return r});return function(){return n.apply(this,arguments)}}(),checkSystemRequirements:function(){const n=be.reportApiInvoke(null,{name:Yn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:st.TRACER});let r=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,p=window.WebSocket;r=!!(d&&h&&p),r&&rR()&&H1(75)&&(new d).close()}catch(d){return T.error("check system requirement failed: ",d),!1}let o=!1;const a=ot();a.name===wt.CHROME&&Number(a.version)>=58&&("WebKit"!==Hs.engine.name||function(){const d=ot();if(m_()){if(d.os===pi.MAC_OS)return!0;if(d.os===pi.IOS){const h=Hs.os.version&&Hs.os.version.split(".");if(h&&14===Number(h[0])&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(o=!0),(a.name===wt.FIREFOX&&Number(a.version)>=56||a.name===wt.OPERA&&Number(a.version)>=45||a.name===wt.SAFARI&&Number(a.version)>=11||"WebKit"===a.name&&(nt()||Ks())&&a.osVersion&&Number(a.osVersion.split(".")[0])>=11||eS()||ot().name===wt.QQ)&&(o=!0),T.debug("checkSystemRequirements, api:",r,"browser",o);const l=r&&o;return n.onSuccess(l),l},getDevices:function(n){return mo.enumerateDevices(!0,!0,n)},getMicrophones:function(n){return mo.getRecordingDevices(n)},getCameras:function(n){return mo.getCamerasDevices(n)},getElectronScreenSources:c5,getPlaybackDevices:function(n){return mo.getSpeakers(n)},createClient:function(){var n;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const o=Ct(5,"client-"),a=be.reportApiInvoke(null,{id:o,name:Yn.CREATE_CLIENT,options:[r],tag:st.TRACER});try{fi((l=r).codec,"config.codec",["vp8","vp9","av1","h264","h265"]),fi(l.mode,"config.mode",["rtc","live","p2p"]),void 0!==l.audioCodec&&fi(l.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==l.proxyServer&&Pi(l.proxyServer,"config.proxyServer",1,1e4),void 0!==l.turnServer&&dR(l.turnServer),void 0!==l.httpRetryConfig&&K1(l.httpRetryConfig),void 0!==l.websocketRetryConfig&&K1(l.websocketRetryConfig)}catch(l){throw a.onError(l),l}var l;return(Ws(16,0,!0)||zs(16,0,!0))&&("vp9"===r.codec&&(r.codec="vp8",T.debug("browser not support vp9, force use vp8")),Lt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===r.audioCodec&&(r.audioCodec="opus"),a.onSuccess(),new qH(Os(Os({forceWaitGatewayResponse:!0},r),{},{role:he(n=["rtc","p2p"]).call(n,r.mode)?"host":r.role||"audience"}),o)},createCameraVideoTrack:function(){var n=L(function*(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=V("CAMERA_CAPTURE_CONFIG"),a=Ct(8,"track-cam-"),l=be.reportApiInvoke(null,{id:a,tag:st.TRACER,name:Yn.CREATE_CAM_VIDEO_TRACK,options:[rn({},r),o]});o&&(r.encoderConfig=o);const d=tv(r);let h=null;T.info("start create camera video track with config",JSON.stringify(r),"trackId",a);try{h=(yield Gr({video:d},a)).getVideoTracks()[0]||null}catch(m){throw l.onError(m),m}if(!h){const m=new Y(k.UNEXPECTED_ERROR,"can not find track in media stream");return l.onError(m),m.throw(T)}r.optimizationMode&&zx(a,h,r,Cl(r.encoderConfig));const p=new VS(h,r,d,r.scalabiltyMode?pA(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,a);return l.onSuccess(p.getTrackId()),T.info("create camera video success, trackId:",a),p});return function(){return n.apply(this,arguments)}}(),createCustomVideoTrack:function(n){const r=Ct(8,"track-cus-"),o=be.reportApiInvoke(null,{id:r,tag:st.TRACER,name:Yn.CREATE_CUSTOM_VIDEO_TRACK,options:[n]}),a=new Ve(n.mediaStreamTrack,{width:n.width,height:n.height,frameRate:n.frameRate,bitrateMax:n.bitrateMax,bitrateMin:n.bitrateMin},n.scalabiltyMode?pA(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,r,[zt.CUSTOM_TRACK]);return o.onSuccess(a.getTrackId()),T.info("create custom video track success with config",n,"trackId",a.getTrackId()),a},createScreenVideoTrack:function(){var n=L(function*(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const a="object"==typeof o?l5(C=o):void 0;var C;a&&(o="auto");const l=Ct(8,"track-scr-v-"),d=be.reportApiInvoke(null,{id:l,tag:st.TRACER,name:Yn.CREATE_SCREEN_VIDEO_TRACK,options:[rn({},r),o]});r.encoderConfig?"string"==typeof r.encoderConfig||r.encoderConfig.width&&r.encoderConfig.height||(r.encoderConfig.width={max:1920},r.encoderConfig.height={max:1080}):r.encoderConfig="1080p_2";const h=function(C){const N={};C.screenSourceType&&(N.mediaSource=C.screenSourceType),C.extensionId&&lh()&&(N.extensionId=C.extensionId);const{displaySurface:R,selfBrowserSurface:A,surfaceSwitching:D,systemAudio:M}=C;(Gs(107)||Qb(107)||tR(93))&&(R&&(fi(R,"displaySurface",["browser","window","monitor"]),N.displaySurface=R),A?(fi(A,"selfBrowserSurface",["exclude","include"]),N.selfBrowserSurface=A):N.selfBrowserSurface="include",D&&(fi(D,"surfaceSwitching",["exclude","include"]),N.surfaceSwitching=D)),(Gs(105)||Qb(105)||tR(91))&&M&&(fi(M,"systemAudio",["exclude","include"]),N.systemAudio=M),C.electronScreenSourceId&&(N.sourceId=C.electronScreenSourceId);const x=C.encoderConfig?ox(C.encoderConfig):null;return N.mandatory={chromeMediaSource:"desktop",maxWidth:x?x.width:void 0,maxHeight:x?x.height:void 0},x&&(x.frameRate&&("number"==typeof x.frameRate?(N.mandatory.maxFrameRate=x.frameRate,N.mandatory.minFrameRate=x.frameRate):(N.mandatory.maxFrameRate=x.frameRate.max||x.frameRate.ideal||x.frameRate.exact||void 0,N.mandatory.minFrameRate=x.frameRate.min||x.frameRate.ideal||x.frameRate.exact||void 0),N.frameRate=x.frameRate),x.width&&(N.width=x.width),x.height&&(N.height=x.height)),N}(r);let p=null,m=null;const g=ct();if(!g.supportShareAudio&&"enable"===o){const C=new Y(k.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return d.onError(C),C.throw(T)}T.info("start create screen video track with config",r,"withAudio",o,"trackId",l);const v=g.supportShareAudio&&"disable"!==o;try{const C=yield Gr({screen:h,screenAudio:v?a||!0:void 0},l);p=C.getVideoTracks()[0]||null,m=C.getAudioTracks()[0]||null}catch(C){throw d.onError(C),C}if(!p){const C=new Y(k.UNEXPECTED_ERROR,"can not find track in media stream");return d.onError(C),C.throw(T)}if(!m&&"enable"===o){p&&p.stop();const C=new Y(k.SHARE_AUDIO_NOT_ALLOWED);return d.onError(C),C.throw(T)}r.optimizationMode||(r.optimizationMode="detail"),r.optimizationMode&&(zx(l,p,r,r.encoderConfig&&ox(r.encoderConfig)||void 0),r.encoderConfig&&"string"!=typeof r.encoderConfig&&(r.encoderConfig.bitrateMin=r.encoderConfig.bitrateMax));const y=new Ve(p,r.encoderConfig?ox(r.encoderConfig):{},r.scalabiltyMode?pA(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,l,[zt.SCREEN_TRACK]);if(!m)return d.onSuccess(y.getTrackId()),T.info("create screen video track success","video:",y.getTrackId()),y;const b=new Cn(m,void 0,Ct(8,"track-scr-a-"),!1);return d.onSuccess([y.getTrackId(),b.getTrackId()]),T.info("create screen video track success","video:",y.getTrackId(),"audio:",b.getTrackId()),[y,b]});return function(){return n.apply(this,arguments)}}(),createMicrophoneAndCameraTracks:function(){var n=L(function*(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=V("CAMERA_CAPTURE_CONFIG"),l=Ct(8,"track-mic-"),d=Ct(8,"track-cam-"),h=be.reportApiInvoke(null,{id:"".concat(l,"-").concat(d),tag:st.TRACER,name:Yn.CREATE_MIC_AND_CAM_TRACKS,options:[r,o,a]});a&&(o.encoderConfig=a);const p=tv(o),m=d5(r);let g=null,v=null;T.info("start create camera video track(".concat(d,") and microphone audio track(").concat(l,") with config, audio: ").concat(JSON.stringify(r),", video: ").concat(JSON.stringify(o)));try{const C=yield Gr({audio:m,video:p},"".concat(l,"-").concat(d));g=C.getAudioTracks()[0],v=C.getVideoTracks()[0]}catch(C){throw h.onError(C),C}if(!g||!v){const C=new Y(k.UNEXPECTED_ERROR,"can not find tracks in media stream");return h.onError(C),C.throw(T)}o.optimizationMode&&zx(d,v,o,Cl(o.encoderConfig));const y=new xS(g,r,m,l),b=new VS(v,o,p,o.scalabiltyMode?pA(o.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},o.optimizationMode,d);return h.onSuccess([y.getTrackId(),b.getTrackId()]),T.info("create camera video track(".concat(d,") and microphone audio track(").concat(l,") success")),[y,b]});return function(){return n.apply(this,arguments)}}(),createMicrophoneAudioTrack:function(){var n=L(function*(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=Ct(8,"track-mic-"),a=be.reportApiInvoke(null,{id:o,tag:st.TRACER,name:Yn.CREATE_MIC_AUDIO_TRACK,options:[r]}),l=d5(r);let d=null;T.info("start create microphone audio track with config",JSON.stringify(r),"trackId",o);try{d=(yield Gr({audio:l},o)).getAudioTracks()[0]||null}catch(p){throw a.onError(p),p}if(!d){const p=new Y(k.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(p),p.throw(T)}const h=new xS(d,r,l,o);return a.onSuccess(h.getTrackId()),T.info("create microphone audio track success, trackId:",o),h});return function(){return n.apply(this,arguments)}}(),createCustomAudioTrack:function(n){const r=Ct(8,"track-cus-"),o=be.reportApiInvoke(null,{id:r,tag:st.TRACER,name:Yn.CREATE_CUSTOM_AUDIO_TRACK,options:[n]}),a=new Cn(n.mediaStreamTrack,n.encoderConfig?fA(n.encoderConfig):{},r,!1);return T.info("create custom audio track success with config",n,"trackId",a.getTrackId()),o.onSuccess(a.getTrackId()),a},createBufferSourceAudioTrack:function(){var n=L(function*(r){var o;const{cacheOnlineFile:a,encoderConfig:l}=r;let{source:d}=r;const h={source:d instanceof AudioBuffer?"AudioBuffer":d instanceof File?null!==(o=File.name)&&void 0!==o?o:"File":d,cacheOnlineFile:a,encoderConfig:l},p=Ct(8,"track-buf-"),m=be.reportApiInvoke(null,{id:p,tag:st.TRACER,name:Yn.CREATE_BUFFER_AUDIO_TRACK,options:[h]});if(V("DISABLE_WEBAUDIO"))throw new Y(k.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");T.info("start create buffer source audio track with config",JSON.stringify(h),"trackId",p);const g=d;if(!(d instanceof AudioBuffer))try{d=yield(b=L(function*(C,N){let R=null;if("string"==typeof C){const D=UA.get(C);if(D)return T.debug("use cached audio resource: ",C),D;try{R=(yield rs(()=>Nr.get(C,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(M){throw new Y(k.FETCH_AUDIO_FILE_FAILED,M.toString())}}else R=yield new le((M,x)=>{const j=new FileReader;j.onload=W=>{W.target?M(W.target.result):x(new Y(k.READ_LOCAL_AUDIO_FILE_ERROR))},j.onerror=()=>{x(new Y(k.READ_LOCAL_AUDIO_FILE_ERROR))},j.readAsArrayBuffer(C)});const A=yield function(D){const M=Uf();return new le((x,j)=>{M.decodeAudioData(D,W=>{x(W)},W=>{j(new Y(k.DECODE_AUDIO_FILE_FAILED,W.toString()))})})}(R);return"string"==typeof C&&N&&UA.set(C,A),A}),function(C,N){return b.apply(this,arguments)})(d,a)}catch(b){return m.onError(b),b.throw(T)}var b;const v=new b5(d),y=new FS(g,v,l?fA(l):{},p);return T.info("create buffer source audio track success, trackId:",p),m.onSuccess(y.getTrackId()),y});return function(o){return n.apply(this,arguments)}}(),setAppType:function(n){if(T.debug("setAppType: ".concat(n)),!(Number.isInteger(n)&&n>=0))throw T.debug("Invalid appType"),new z(k.INVALID_PARAMS,"invalid app type",n);Lt("APP_TYPE",Math.floor(n))},setLogLevel:function(n){T.setLogLevel(n)},enableLogUpload:function(){V("USE_NEW_LOG")?Lt("UPLOAD_LOG",!0):T.enableLogUpload()},disableLogUpload:function(){V("USE_NEW_LOG")?Lt("UPLOAD_LOG",!1):T.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new lH},checkAudioTrackIsActive:function(){var n=L(function*(r){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const a=be.reportApiInvoke(null,{tag:st.TRACER,name:Yn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[o]});if(!(r instanceof Cn||r instanceof Dl)){const g=new z(k.INVALID_TRACK,"the parameter is not a audio track");return a.onError(g),g.throw()}o&&o<1e3&&(o=1e3);const l=r instanceof Cn?r.getTrackLabel():"remote_track",d=r.getVolumeLevel();let h=d,p=d;const m=Date.now();return new le(g=>{const v=setInterval(()=>{const y=r.getVolumeLevel();h=y>h?y:h,p=y<p?y:p;const b=h-p>1e-4,C=Date.now()-m;if(b||C>o){clearInterval(v);const N=b,R={duration:C,deviceLabel:l,maxVolumeLevel:h,result:N};T.info("[track-".concat(r.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(R))),a.onSuccess(R),g(N)}},200)})});return function(o){return n.apply(this,arguments)}}(),checkVideoTrackIsActive:function(){var n=L(function*(r){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const a=be.reportApiInvoke(null,{tag:st.TRACER,name:Yn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[o]});if(!(r instanceof Ve||r instanceof wh)){const b=new z(k.INVALID_TRACK,"the parameter is not a video track");return a.onError(b),b.throw()}o&&o<1e3&&(o=1e3);const l=r instanceof Ve?r.getTrackLabel():"remote_track",d=r.getMediaStreamTrack(!0),h=document.createElement("video");h.style.width="1px",h.style.height="1px",h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.controls=!1,($e()||m_())&&(h.style.opacity="0.01",h.style.position="fixed",h.style.left="0",h.style.top="0",document.body.appendChild(h)),h.srcObject=new MediaStream([d]),h.play();const p=document.createElement("canvas");p.width=160,p.height=120;let m=0,g=0;try{const b=Date.now();m=yield function(C,N,R){let D,M=0,x=null;return new le((j,W)=>{setTimeout(()=>{D&&(D(),j(M))},N),D=dx(()=>{!function q(){M>4&&D&&(D(),j(M));const ee=R.getContext("2d");if(!ee){const Ce=new z(k.UNEXPECTED_ERROR,"can not get canvas 2d context.");return T.error(Ce.toString()),void W(Ce)}ee.drawImage(C,0,0,160,120);const J=ee.getImageData(0,0,R.width,R.height),X=Math.floor(J.data.length/3);if(x){for(let Ce=0;Ce<X;Ce+=3)if(J.data[Ce]!==x[Ce])return M+=1,void(x=J.data);x=J.data}else x=J.data}()},30)})}(h,o,p),g=Date.now()-b}catch(b){throw a.onError(b),b}$W===wt.SAFARI&&(h.pause(),h.remove()),h.srcObject=null;const v=m>4,y={duration:g,changedPicNum:m,deviceLabel:l,result:v};return T.info("[track-".concat(r.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(y))),a.onSuccess(y),v});return function(o){return n.apply(this,arguments)}}(),setArea:Ah,audioElementPlayCenter:Wr,resumeAudioContext:function(){Wr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(n){$H.processExternalMediaAEC(n)},registerExtensions:function(n){const r=V("PLUGIN_INFO")||[];n.forEach(o=>{"name"in o&&!he(r).call(r,o.name)&&r.push(o.name);const a=o;a.__registered__=!0,a.logger.hookLog=T.extLog,a.reporter.hookApiInvoke=be.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach(l=>{a.parameters[l]=V(l)})}),rU("PLUGIN_INFO",r)},ChannelMediaRelayError:Rf,ChannelMediaRelayEvent:bc,ChannelMediaRelayState:ho,RemoteStreamFallbackType:VW,RemoteStreamType:UW,ConnectionDisconnectedReason:Rt,AudienceLatencyLevelType:Xj,AREAS:mt,preload:function(){var n=L(function*(r,o,a,l){return fC(r,o,a,l)});return function(o,a,l,d){return n.apply(this,arguments)}}()});return Object.defineProperties(ei,{onAudioAutoplayFailed:{get:()=>ko.onAudioAutoplayFailed,set:n=>{ko.onAudioAutoplayFailed=n}},onAutoplayFailed:{get:()=>ko.onAutoplayFailed,set:n=>{ko.onAutoplayFailed=n}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>ei._onSecurityPolicyViolation,set(n){ei._onSecurityPolicyViolation=n,SF(n)}},__CLIENT_LIST__:{get:()=>V("SHOW_GLOBAL_CLIENT_LIST")?Ad:[]}}),mo.on(Il.CAMERA_DEVICE_CHANGED,n=>{T.info("camera device changed",JSON.stringify(n)),ei.onCameraChanged&&ei.onCameraChanged(n),ei.safeEmit(Ys.CAMERA_CHANGED,n)}),mo.on(Il.RECORDING_DEVICE_CHANGED,n=>{T.info("microphone device changed",JSON.stringify(n)),ei.onMicrophoneChanged&&ei.onMicrophoneChanged(n),ei.safeEmit(Ys.MICROPHONE_CHANGED,n)}),mo.on(Il.PLAYOUT_DEVICE_CHANGED,n=>{T.debug("playout device changed",JSON.stringify(n)),ei.onPlaybackDeviceChanged&&ei.onPlaybackDeviceChanged(n),ei.safeEmit(Ys.PLAYBACK_DEVICE_CHANGED,n)}),Wr.onAutoplayFailed=()=>{T.info("detect audio element autoplay failed"),ko.onAudioAutoplayFailed&&ko.onAudioAutoplayFailed()},xt.on("autoplay-failed",()=>{T.info("detect webaudio autoplay failed"),ko.onAudioAutoplayFailed&&ko.onAudioAutoplayFailed(),ei.safeEmit(Ys.AUTOPLAY_FAILED)}),xt.on(wi.STATE_CHANGE,(n,r)=>{T.info("audio context state changed: ".concat(r," => ").concat(n)),ei.onAudioContextStateChanged&&ei.onAudioContextStateChanged(n,r),ei.safeEmit(Ys.AUDIO_CONTEXT_STATE_CHANGED,n,r)}),Se.on(ml.NETWORK_STATE_CHANGE,(n,r)=>{T.info("[network-indicator] network state changed, ".concat(r," => ").concat(n))}),window&&(window.__ARTC__=ei),ei}()},293:zl=>{function uE(L,Ci,eo,Gt,Pt,gt,ec){try{var Kl=L[gt](ec),Bc=Kl.value}catch(du){return void eo(du)}Kl.done?Ci(Bc):Promise.resolve(Bc).then(Gt,Pt)}zl.exports=function hE(L){return function(){var Ci=this,eo=arguments;return new Promise(function(Gt,Pt){var gt=L.apply(Ci,eo);function ec(Bc){uE(gt,Gt,Pt,ec,Kl,"next",Bc)}function Kl(Bc){uE(gt,Gt,Pt,ec,Kl,"throw",Bc)}ec(void 0)})}},zl.exports.__esModule=!0,zl.exports.default=zl.exports}},zl=>{zl(zl.s=803)}]);